<!doctype html><html lang=zh dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3988508441804851" crossorigin=anonymous></script><title>kubernetes搭建minio作为阿里OSS的Gateway | 八戒的技术博客</title>
<meta name=keywords content><meta name=description content='阿里的云的 OSS 并不是完全版本的 AWS S3 兼容。
我们如果需要用 S3 协议访问 OSS，就比较麻烦了。
所以搭建一个 minio 来做网关，代理OSS，minio 是基本兼容S3的，所以这样曲线救国，通过 S3 协议访问 minio 来访问最后端的 OSS
这里还有一段故事：
Minio 中间有一版是支持 oss 的，但是后来 oss 改了协议，所以现在的最新版本 minio 反而是不支持代理 oss 的，我们必须手动作出镜像，放到镜像库里，然后阿里 ACK 再使用
首先去下载那一版直接支持oss的
wget http://dl.minio.org.cn/server/minio/release/linux-amd64/archive/minio.RELEASE.2020-04-15T19-42-18Z 

chmod 755 minio.RELEASE.2020-04-15T19-42-18Z 
这个文件比较宝贵，给个本地备份链接下载：
minio.RELEASE.2020-04-15T19-42-18Z
然后在当前目录编辑 Dockerfile ，因为 K8S 和 OSS 同一地域，所以用 OSS 私网域名：
FROM alpine:3.12 

RUN apk add --update bash && rm -rf /var/cache/apk/*  

COPY minio.RELEASE.2020-04-15T19-42-18Z /data/minio.RELEASE.2020-04-15T19-42-18Z  

ENV MINIO_ACCESS_KEY=LTAI5tFFTbsxxxxxuLb  
ENV MINIO_SECRET_KEY=t78PyGnHZilxxxxxdxBCjvNgtVC5Y  

WORKDIR /data  
EXPOSE 9000  

CMD ["/data/minio.RELEASE.2020-04-15T19-42-18Z","gateway","oss","http://oss-cn-shanghai-internal.aliyuncs.com"] 
# CMD /bin/sh -c "while true; do echo hi; sleep 10; done"
注意上面，MINIO_ACCESS_KEY 和 MINIO_SECRET_KEY 对应的是阿里云 OSS的 AccessKey ID 和 AccessKey Secret'><meta name=author content><link rel=canonical href=https://rendoumi.com/posts/20211126-kubernetes_minio_oss_gateway/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.74dff769c849e7908342c626b27d92486e2c568e0a3c69bddd21ad6aad6674d3.css integrity="sha256-dN/3achJ55CDQsYmsn2SSG4sVo4KPGm93SGtaq1mdNM=" rel="preload stylesheet" as=style><link rel=icon href=https://rendoumi.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://rendoumi.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://rendoumi.com/favicon-32x32.png><link rel=apple-touch-icon href=https://rendoumi.com/apple-touch-icon.png><link rel=mask-icon href=https://rendoumi.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://rendoumi.com/posts/20211126-kubernetes_minio_oss_gateway/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://rendoumi.com/posts/20211126-kubernetes_minio_oss_gateway/"><meta property="og:site_name" content="八戒的技术博客"><meta property="og:title" content="kubernetes搭建minio作为阿里OSS的Gateway"><meta property="og:description" content='阿里的云的 OSS 并不是完全版本的 AWS S3 兼容。
我们如果需要用 S3 协议访问 OSS，就比较麻烦了。
所以搭建一个 minio 来做网关，代理OSS，minio 是基本兼容S3的，所以这样曲线救国，通过 S3 协议访问 minio 来访问最后端的 OSS
这里还有一段故事：
Minio 中间有一版是支持 oss 的，但是后来 oss 改了协议，所以现在的最新版本 minio 反而是不支持代理 oss 的，我们必须手动作出镜像，放到镜像库里，然后阿里 ACK 再使用
首先去下载那一版直接支持oss的
wget http://dl.minio.org.cn/server/minio/release/linux-amd64/archive/minio.RELEASE.2020-04-15T19-42-18Z chmod 755 minio.RELEASE.2020-04-15T19-42-18Z 这个文件比较宝贵，给个本地备份链接下载：
minio.RELEASE.2020-04-15T19-42-18Z
然后在当前目录编辑 Dockerfile ，因为 K8S 和 OSS 同一地域，所以用 OSS 私网域名：
FROM alpine:3.12 RUN apk add --update bash && rm -rf /var/cache/apk/* COPY minio.RELEASE.2020-04-15T19-42-18Z /data/minio.RELEASE.2020-04-15T19-42-18Z ENV MINIO_ACCESS_KEY=LTAI5tFFTbsxxxxxuLb ENV MINIO_SECRET_KEY=t78PyGnHZilxxxxxdxBCjvNgtVC5Y WORKDIR /data EXPOSE 9000 CMD ["/data/minio.RELEASE.2020-04-15T19-42-18Z","gateway","oss","http://oss-cn-shanghai-internal.aliyuncs.com"] # CMD /bin/sh -c "while true; do echo hi; sleep 10; done" 注意上面，MINIO_ACCESS_KEY 和 MINIO_SECRET_KEY 对应的是阿里云 OSS的 AccessKey ID 和 AccessKey Secret'><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-11-26T09:30:11+08:00"><meta property="article:modified_time" content="2021-11-26T09:30:11+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="kubernetes搭建minio作为阿里OSS的Gateway"><meta name=twitter:description content='阿里的云的 OSS 并不是完全版本的 AWS S3 兼容。
我们如果需要用 S3 协议访问 OSS，就比较麻烦了。
所以搭建一个 minio 来做网关，代理OSS，minio 是基本兼容S3的，所以这样曲线救国，通过 S3 协议访问 minio 来访问最后端的 OSS
这里还有一段故事：
Minio 中间有一版是支持 oss 的，但是后来 oss 改了协议，所以现在的最新版本 minio 反而是不支持代理 oss 的，我们必须手动作出镜像，放到镜像库里，然后阿里 ACK 再使用
首先去下载那一版直接支持oss的
wget http://dl.minio.org.cn/server/minio/release/linux-amd64/archive/minio.RELEASE.2020-04-15T19-42-18Z 

chmod 755 minio.RELEASE.2020-04-15T19-42-18Z 
这个文件比较宝贵，给个本地备份链接下载：
minio.RELEASE.2020-04-15T19-42-18Z
然后在当前目录编辑 Dockerfile ，因为 K8S 和 OSS 同一地域，所以用 OSS 私网域名：
FROM alpine:3.12 

RUN apk add --update bash && rm -rf /var/cache/apk/*  

COPY minio.RELEASE.2020-04-15T19-42-18Z /data/minio.RELEASE.2020-04-15T19-42-18Z  

ENV MINIO_ACCESS_KEY=LTAI5tFFTbsxxxxxuLb  
ENV MINIO_SECRET_KEY=t78PyGnHZilxxxxxdxBCjvNgtVC5Y  

WORKDIR /data  
EXPOSE 9000  

CMD ["/data/minio.RELEASE.2020-04-15T19-42-18Z","gateway","oss","http://oss-cn-shanghai-internal.aliyuncs.com"] 
# CMD /bin/sh -c "while true; do echo hi; sleep 10; done"
注意上面，MINIO_ACCESS_KEY 和 MINIO_SECRET_KEY 对应的是阿里云 OSS的 AccessKey ID 和 AccessKey Secret'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"所有文章","item":"https://rendoumi.com/posts/"},{"@type":"ListItem","position":2,"name":"kubernetes搭建minio作为阿里OSS的Gateway","item":"https://rendoumi.com/posts/20211126-kubernetes_minio_oss_gateway/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"kubernetes搭建minio作为阿里OSS的Gateway","name":"kubernetes搭建minio作为阿里OSS的Gateway","description":"阿里的云的 OSS 并不是完全版本的 AWS S3 兼容。\n我们如果需要用 S3 协议访问 OSS，就比较麻烦了。\n所以搭建一个 minio 来做网关，代理OSS，minio 是基本兼容S3的，所以这样曲线救国，通过 S3 协议访问 minio 来访问最后端的 OSS\n这里还有一段故事：\nMinio 中间有一版是支持 oss 的，但是后来 oss 改了协议，所以现在的最新版本 minio 反而是不支持代理 oss 的，我们必须手动作出镜像，放到镜像库里，然后阿里 ACK 再使用\n首先去下载那一版直接支持oss的\nwget http://dl.minio.org.cn/server/minio/release/linux-amd64/archive/minio.RELEASE.2020-04-15T19-42-18Z chmod 755 minio.RELEASE.2020-04-15T19-42-18Z 这个文件比较宝贵，给个本地备份链接下载：\nminio.RELEASE.2020-04-15T19-42-18Z\n然后在当前目录编辑 Dockerfile ，因为 K8S 和 OSS 同一地域，所以用 OSS 私网域名：\nFROM alpine:3.12 RUN apk add --update bash \u0026amp;\u0026amp; rm -rf /var/cache/apk/* COPY minio.RELEASE.2020-04-15T19-42-18Z /data/minio.RELEASE.2020-04-15T19-42-18Z ENV MINIO_ACCESS_KEY=LTAI5tFFTbsxxxxxuLb ENV MINIO_SECRET_KEY=t78PyGnHZilxxxxxdxBCjvNgtVC5Y WORKDIR /data EXPOSE 9000 CMD [\u0026#34;/data/minio.RELEASE.2020-04-15T19-42-18Z\u0026#34;,\u0026#34;gateway\u0026#34;,\u0026#34;oss\u0026#34;,\u0026#34;http://oss-cn-shanghai-internal.aliyuncs.com\u0026#34;] # CMD /bin/sh -c \u0026#34;while true; do echo hi; sleep 10; done\u0026#34; 注意上面，MINIO_ACCESS_KEY 和 MINIO_SECRET_KEY 对应的是阿里云 OSS的 AccessKey ID 和 AccessKey Secret\n","keywords":[],"articleBody":"阿里的云的 OSS 并不是完全版本的 AWS S3 兼容。\n我们如果需要用 S3 协议访问 OSS，就比较麻烦了。\n所以搭建一个 minio 来做网关，代理OSS，minio 是基本兼容S3的，所以这样曲线救国，通过 S3 协议访问 minio 来访问最后端的 OSS\n这里还有一段故事：\nMinio 中间有一版是支持 oss 的，但是后来 oss 改了协议，所以现在的最新版本 minio 反而是不支持代理 oss 的，我们必须手动作出镜像，放到镜像库里，然后阿里 ACK 再使用\n首先去下载那一版直接支持oss的\nwget http://dl.minio.org.cn/server/minio/release/linux-amd64/archive/minio.RELEASE.2020-04-15T19-42-18Z chmod 755 minio.RELEASE.2020-04-15T19-42-18Z 这个文件比较宝贵，给个本地备份链接下载：\nminio.RELEASE.2020-04-15T19-42-18Z\n然后在当前目录编辑 Dockerfile ，因为 K8S 和 OSS 同一地域，所以用 OSS 私网域名：\nFROM alpine:3.12 RUN apk add --update bash \u0026\u0026 rm -rf /var/cache/apk/* COPY minio.RELEASE.2020-04-15T19-42-18Z /data/minio.RELEASE.2020-04-15T19-42-18Z ENV MINIO_ACCESS_KEY=LTAI5tFFTbsxxxxxuLb ENV MINIO_SECRET_KEY=t78PyGnHZilxxxxxdxBCjvNgtVC5Y WORKDIR /data EXPOSE 9000 CMD [\"/data/minio.RELEASE.2020-04-15T19-42-18Z\",\"gateway\",\"oss\",\"http://oss-cn-shanghai-internal.aliyuncs.com\"] # CMD /bin/sh -c \"while true; do echo hi; sleep 10; done\" 注意上面，MINIO_ACCESS_KEY 和 MINIO_SECRET_KEY 对应的是阿里云 OSS的 AccessKey ID 和 AccessKey Secret\n打开阿里云网址，新建AccessKey ID 和 AccessKey Secret ，注意这东西只能看见一次，之后再也不能明文看了，所以第一次务必保存好！！！\nhttps://ram.console.aliyun.com/manage/ak\n然后还有 Dockerfile 的最后一行，八戒的习惯是保留一个死循环 shell，如果镜像 CMD 有问题，无法启动，就换成这个先启动，然后再进去调试。（经常有什么库错、链接搞不好需要修改）\ndocker build -t registry.cn-shanghai.aliyuncs.com/rendoumi/minio . 然后 push 上去\ndocker push registry.cn-shanghai.aliyuncs.com/rendoumi/minio 编写好Deployment和svc，如果想公开还可以写 ingress 向外暴露，自己公司用还是 port-forward 更安全\n--- apiVersion: apps/v1 kind: Deployment metadata: name: minio-deploy labels: app: minio spec: replicas: 1 selector: matchLabels: app: minio template: metadata: labels: app: minio spec: containers: - name: minio image: registry.cn-shanghai.aliyuncs.com/rendoumi/minio:latest ports: - containerPort: 9000 --- apiVersion: v1 kind: Service metadata: name: minio-svc labels: app: minio spec: ports: - name: http protocol: TCP port: 9000 targetPort: 9000 selector: app: minio type: ClusterIP 然后开转发：\nkubectl port-forward svc/minio-svc 9000:9000 \u0026 用浏览器访问 http://localhost:9000 就可以了，还得输入一遍密码\n这样就可以看到 OSS 的所有桶了\nMinio的官方命令行客户端是 mc，使用方法如下：\nwget https://dl.min.io/client/mc/release/linux-amd64/mc chmod 755 mc ./mc alias set minio http://minio-svc:9000 MINIO_ACCESS_KEY 和 MINIO_SECRET_KEY ./mc ls minio minio 跑在容器外进行 OSS 代理的方法，注意不同地方，OSS 的域名改为公网的了：\n#!/bin/sh export MINIO_ACCESS_KEY=LTAI5tFFTbsxxxxxuLb export MINIO_SECRET_KEY=t78PyGnHZilxxxxxdxBCjvNgtVC5Y nohup ./minio.RELEASE.2020-04-15T19-42-18Z gateway oss http://oss-cn-shanghai.aliyuncs.com \u003e/dev/null 2\u003e\u00261 \u0026 ","wordCount":"233","inLanguage":"zh","datePublished":"2021-11-26T09:30:11+08:00","dateModified":"2021-11-26T09:30:11+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://rendoumi.com/posts/20211126-kubernetes_minio_oss_gateway/"},"publisher":{"@type":"Organization","name":"八戒的技术博客","logo":{"@type":"ImageObject","url":"https://rendoumi.com/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://rendoumi.com/ accesskey=h title="八戒的技术博客 (Alt + H)">八戒的技术博客</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://rendoumi.com/ title=首页><span>首页</span></a></li><li><a href=https://rendoumi.com/posts/ title=文章><span>文章</span></a></li><li><a href=https://rendoumi.com/archives/ title=归档><span>归档</span></a></li><li><a href=https://blog.rendoumi.com title=生活><span>生活</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://rendoumi.com/search/ title=搜索><span>搜索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">kubernetes搭建minio作为阿里OSS的Gateway
<span class=entry-hint title=Draft><svg height="35" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h1><div class=post-meta><span title='2021-11-26 09:30:11 +0800 CST'>2021年11月26日</span></div></header><div class=post-content><p>阿里的云的 OSS 并不是完全版本的 AWS S3 兼容。</p><p>我们如果需要用 S3 协议访问 OSS，就比较麻烦了。</p><p>所以搭建一个 minio 来做网关，代理OSS，minio 是基本兼容S3的，所以这样曲线救国，通过 S3 协议访问 minio 来访问最后端的 OSS</p><p>这里还有一段故事：</p><p>Minio 中间有一版是支持 oss 的，但是后来 oss 改了协议，所以现在的最新版本 minio 反而是不支持代理 oss 的，我们必须手动作出镜像，放到镜像库里，然后阿里 ACK 再使用</p><p>首先去下载那一版直接支持oss的</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget http://dl.minio.org.cn/server/minio/release/linux-amd64/archive/minio.RELEASE.2020-04-15T19-42-18Z 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>chmod <span class=m>755</span> minio.RELEASE.2020-04-15T19-42-18Z 
</span></span></code></pre></div><p>这个文件比较宝贵，给个本地备份链接下载：</p><p><a href=minio.RELEASE.2020-04-15T19-42-18Z>minio.RELEASE.2020-04-15T19-42-18Z</a></p><p>然后在当前目录编辑 Dockerfile ，因为 K8S 和 OSS 同一地域，所以用 OSS 私网域名：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>FROM alpine:3.12 </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>RUN apk add --update bash &amp;&amp; rm -rf /var/cache/apk/*  </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>COPY minio.RELEASE.2020-04-15T19-42-18Z /data/minio.RELEASE.2020-04-15T19-42-18Z  </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>ENV MINIO_ACCESS_KEY</span><span class=o>=</span><span class=s>LTAI5tFFTbsxxxxxuLb  </span>
</span></span><span class=line><span class=cl><span class=na>ENV MINIO_SECRET_KEY</span><span class=o>=</span><span class=s>t78PyGnHZilxxxxxdxBCjvNgtVC5Y  </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>WORKDIR /data  </span>
</span></span><span class=line><span class=cl><span class=na>EXPOSE 9000  </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>CMD [&#34;/data/minio.RELEASE.2020-04-15T19-42-18Z&#34;,&#34;gateway&#34;,&#34;oss&#34;,&#34;http://oss-cn-shanghai-internal.aliyuncs.com&#34;] </span>
</span></span><span class=line><span class=cl><span class=c1># CMD /bin/sh -c &#34;while true; do echo hi; sleep 10; done&#34;</span>
</span></span></code></pre></div><p>注意上面，MINIO_ACCESS_KEY 和 MINIO_SECRET_KEY 对应的是阿里云 OSS的 AccessKey ID 和 AccessKey Secret</p><p>打开阿里云网址，新建AccessKey ID 和 AccessKey Secret ，注意这东西只能看见一次，之后再也不能明文看了，所以第一次务必保存好！！！</p><p><a href=https://ram.console.aliyun.com/manage/ak>https://ram.console.aliyun.com/manage/ak</a></p><p><img alt=image-20211126094340872 loading=lazy src=/posts/20211126-kubernetes_minio_oss_gateway/image-20211126094340872.png></p><p>然后还有 Dockerfile 的最后一行，八戒的习惯是保留一个死循环 shell，如果镜像 CMD 有问题，无法启动，就换成这个先启动，然后再进去调试。（经常有什么库错、链接搞不好需要修改）</p><p><code>docker build -t registry.cn-shanghai.aliyuncs.com/rendoumi/minio .</code></p><p>然后 push 上去</p><p><code>docker push registry.cn-shanghai.aliyuncs.com/rendoumi/minio</code></p><p>编写好Deployment和svc，如果想公开还可以写 ingress 向外暴露，自己公司用还是 port-forward 更安全</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>---</span>
</span></span><span class=line><span class=cl><span class=na>apiVersion: apps/v1 </span>
</span></span><span class=line><span class=cl><span class=na>kind: Deployment </span>
</span></span><span class=line><span class=cl><span class=na>metadata: </span>
</span></span><span class=line><span class=cl>  <span class=na>name: minio-deploy </span>
</span></span><span class=line><span class=cl>  <span class=na>labels: </span>
</span></span><span class=line><span class=cl>    <span class=na>app: minio </span>
</span></span><span class=line><span class=cl><span class=na>spec: </span>
</span></span><span class=line><span class=cl>  <span class=na>replicas: 1 </span>
</span></span><span class=line><span class=cl>  <span class=na>selector: </span>
</span></span><span class=line><span class=cl>    <span class=na>matchLabels: </span>
</span></span><span class=line><span class=cl>      <span class=na>app: minio </span>
</span></span><span class=line><span class=cl>  <span class=na>template: </span>
</span></span><span class=line><span class=cl>    <span class=na>metadata: </span>
</span></span><span class=line><span class=cl>      <span class=na>labels: </span>
</span></span><span class=line><span class=cl>        <span class=na>app: minio </span>
</span></span><span class=line><span class=cl>    <span class=na>spec: </span>
</span></span><span class=line><span class=cl>      <span class=na>containers: </span>
</span></span><span class=line><span class=cl>      <span class=na>- name: minio </span>
</span></span><span class=line><span class=cl>        <span class=na>image: registry.cn-shanghai.aliyuncs.com/rendoumi/minio:latest </span>
</span></span><span class=line><span class=cl>        <span class=na>ports: </span>
</span></span><span class=line><span class=cl>        <span class=na>- containerPort: 9000 </span>
</span></span><span class=line><span class=cl><span class=na>---</span>
</span></span><span class=line><span class=cl><span class=na>apiVersion: v1  </span>
</span></span><span class=line><span class=cl><span class=na>kind: Service  </span>
</span></span><span class=line><span class=cl><span class=na>metadata:  </span>
</span></span><span class=line><span class=cl> <span class=na>name: minio-svc  </span>
</span></span><span class=line><span class=cl> <span class=na>labels:  </span>
</span></span><span class=line><span class=cl>   <span class=na>app: minio  </span>
</span></span><span class=line><span class=cl><span class=na>spec:  </span>
</span></span><span class=line><span class=cl> <span class=na>ports:  </span>
</span></span><span class=line><span class=cl> <span class=na>- name: http  </span>
</span></span><span class=line><span class=cl>   <span class=na>protocol: TCP  </span>
</span></span><span class=line><span class=cl>   <span class=na>port: 9000  </span>
</span></span><span class=line><span class=cl>   <span class=na>targetPort: 9000  </span>
</span></span><span class=line><span class=cl> <span class=na>selector:  </span>
</span></span><span class=line><span class=cl>   <span class=na>app: minio  </span>
</span></span><span class=line><span class=cl> <span class=na>type: ClusterIP </span>
</span></span></code></pre></div><p>然后开转发：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl port-forward svc/minio-svc 9000:9000 <span class=p>&amp;</span>
</span></span></code></pre></div><p>用浏览器访问 http://localhost:9000 就可以了，还得输入一遍密码</p><p><img alt=image-20211126095040380 loading=lazy src=/posts/20211126-kubernetes_minio_oss_gateway/image-20211126095040380.png></p><p>这样就可以看到 OSS 的所有桶了</p><p><img alt=image-20211126095433603 loading=lazy src=/posts/20211126-kubernetes_minio_oss_gateway/image-20211126095433603.png></p><p>Minio的官方命令行客户端是 mc，使用方法如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget https://dl.min.io/client/mc/release/linux-amd64/mc 
</span></span><span class=line><span class=cl>chmod <span class=m>755</span> mc 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>./mc <span class=nb>alias</span> <span class=nb>set</span> minio http://minio-svc:9000 MINIO_ACCESS_KEY 和 MINIO_SECRET_KEY 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>./mc ls minio 
</span></span></code></pre></div><p>minio 跑在容器外进行 OSS 代理的方法，注意不同地方，OSS 的域名改为公网的了：</p><pre tabindex=0><code>#!/bin/sh
export MINIO_ACCESS_KEY=LTAI5tFFTbsxxxxxuLb 
export MINIO_SECRET_KEY=t78PyGnHZilxxxxxdxBCjvNgtVC5Y 
nohup ./minio.RELEASE.2020-04-15T19-42-18Z gateway oss http://oss-cn-shanghai.aliyuncs.com &gt;/dev/null 2&gt;&amp;1 &amp;
</code></pre></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>Copyright © 2020-2025 Zhang Ranrui. All Rights Reserved.</span><br>·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>