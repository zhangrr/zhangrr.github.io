<!doctype html><html lang=zh dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3988508441804851" crossorigin=anonymous></script><title>所有文章 | 八戒的技术博客</title>
<meta name=keywords content><meta name=description content="所有文章 - 八戒的技术博客"><meta name=author content="八戒"><link rel=canonical href=https://rendoumi.com/posts/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.5d8a858b4ad07d913988e10d3c3dbc8c171f45316a396de8a60d67f44840812d.css integrity="sha256-XYqFi0rQfZE5iOENPD28jBcfRTFqOW3opg1n9EhAgS0=" rel="preload stylesheet" as=style><link rel=icon href=https://rendoumi.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://rendoumi.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://rendoumi.com/favicon-32x32.png><link rel=apple-touch-icon href=https://rendoumi.com/apple-touch-icon.png><link rel=mask-icon href=https://rendoumi.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://rendoumi.com/posts/index.xml title=rss><link rel=alternate hreflang=zh href=https://rendoumi.com/posts/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://rendoumi.com/posts/"><meta property="og:site_name" content="八戒的技术博客"><meta property="og:title" content="所有文章"><meta property="og:description" content="专注于Linux运维技术"><meta property="og:locale" content="zh"><meta property="og:type" content="website"><meta property="og:image" content="https://rendoumi.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rendoumi.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="所有文章"><meta name=twitter:description content="专注于Linux运维技术"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"所有文章","item":"https://rendoumi.com/posts/"}]}</script></head><body class=list id=top><header class=header><nav class=nav><div class=logo><a href=https://rendoumi.com/ accesskey=h title="Home (Alt + H)"><img src=https://rendoumi.com/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://rendoumi.com/ title=首页><span>首页</span></a></li><li><a href=https://rendoumi.com/posts/ title=文章><span class=active>文章</span></a></li><li><a href=https://rendoumi.com/archives/ title=归档><span>归档</span></a></li><li><a href=https://blog.rendoumi.com title=生活><span>生活</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://rendoumi.com/search/ title=搜索><span>搜索</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://rendoumi.com/>主页</a></div><h1>所有文章
<a href=/posts/index.xml title=RSS aria-label=RSS><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>F5利用irule防爬虫
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>F5-Bigip利用irule防止爬虫的一法。
爬虫的请求：
GET /cms/rest.htm?method=ddky.cms.search.recommend.h5.o2o&amp;pageNo=1&amp;pageSize=6&amp;shopId=201790&amp;ordertypeId=0&amp;suite=1&amp;searchType=o2o&amp;searchPanel=1&amp;wd=%E6%B4%9B%E4%B8%81%E6%96%B0&amp;lat=22.520712193695&amp;lng=113.9233553732&amp;city=%E6%B7%B1%E5%9C%B3%E5%B8%82&amp;type=90&amp;unique=05685D2A5DAB8ABBD2E5E5B26E0C960F&amp;versionName=5.7.5&amp;plat=H5&amp;platform=H5&amp;t=2020-12-15%2014%3A19%3A11&amp;v=1.0&amp;sign=A6BD136BC1B6F91E5C7DD5A0DA03DD79&amp;callback=jsonp1 里面的t值是时间，t=2020-12-15%2014%3A19%3A11
但是有个问题，这个值一直不变了，那我们就利用这一点。如果T值跟当前时间对比，是3分钟前的，那就封！
F5的irule，直接return的是白名单：
when HTTP_REQUEST { set t [URI::decode [URI::query [HTTP::uri] t]] set before [clock scan "180 seconds ago" ] if { [IP::addr [IP::client_addr] equals 124.206.168.0/255.255.255.224]} { return} if { [IP::addr [IP::client_addr] equals 61.135.14.96/255.255.255.240]} { return} if { [IP::addr [IP::client_addr] equals 114.251.7.112/255.255.255.240]} { return} if { [string tolower [HTTP::uri]] contains "/cms/"} { if {$before > [clock scan $t]} { drop } } }</p></div><footer class=entry-footer><span title='2023-07-27 09:05:11 +0800 CST'>2023年27月</span>&nbsp;·&nbsp;<span>1 分钟</span>&nbsp;·&nbsp;<span>67 字</span>&nbsp;·&nbsp;<span>八戒</span></footer><a class=entry-link aria-label="post link to F5利用irule防爬虫" href=https://rendoumi.com/posts/20230727-f5_irule_t/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>绝版的elasticflow的安装
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>elasticflow 是个流量分析工具，通过对各种flow流量的抓取，分析数据，可以清晰的看到局域网中的流量。
网管的必备啊。首先要把sflow流量给发过来。(这里172.18.31.23是服务器端)
sflow collector 2 ip 172.18.31.23 description flow-server 拉取源代码：
git clone https://github.com/robcowart/elastiflow 启动集群
docker-compose up -d 这样整个数据会被清空，需要重新生成一遍，先把kibana的数据文件拉回来
wget https://raw.githubusercontent.com/robcowart/elastiflow/master/kibana/elastiflow.kibana.7.8.x.ndjson 然后登录http://172.18.31.23:5601
先到配置，导入 导入对象，选择elastiflow.kibana.7.8.x.ndjson文件上传 导入成功，导入了300多个对象 然后配置索引，应该不用配，直接选一个做default 这样就ok了，去dashboard的overview就能看到东西了 然后去修改一下shard策略，省得索引报黄色
PUT /_template/elastiflow-3.5.3
{
"index_patterns": "*", "settings": {
"number_of_shards": 1
}
}
PUT /_template/index_defaults {
"index_patterns": "*",
"settings": {
"number_of_shards": 1
}
}
PUT /_template/elastiflow-3.5.3
{
"index_patterns": "elastiflow-3.5.3-*", "settings": {
"number_of_shards": 1
}
} 查看一下：
curl -s -X GET 'http://localhost:9200/_cat/indices?v'
curl -s -X GET 'http://localhost:9200/_template'| jq</p></div><footer class=entry-footer><span title='2023-07-24 09:05:11 +0800 CST'>2023年24月</span>&nbsp;·&nbsp;<span>1 分钟</span>&nbsp;·&nbsp;<span>73 字</span>&nbsp;·&nbsp;<span>八戒</span></footer><a class=entry-link aria-label="post link to 绝版的elasticflow的安装" href=https://rendoumi.com/posts/20230724-elasticflow/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>如何在容器内安装字体文件
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>pod 容器内要用中文雅黑字体生成 jpg 图片，没办法，只能把字体给装进去
首先进入容器，确定容器的基底是什么，是yum、apt或者apk
通常都是用apk最小化安装的，这样做法如下：
apk update apk add --update ttf-dejavu fontconfig rm -rf /var/cache/apk/* mkdir /usr/share/fonts/chinese cp /usr/local/jre1.8.0_201/lib/fonts/simsun.ttc /usr/share/fonts/chinese mkfontscale && mkfontdir && fc-cache 这样就搞定了，当然这只是临时的。
要想长久就得修改Dockerfile，把文件拷进容器，然后同样得执行命令即可。</p></div><footer class=entry-footer><span title='2023-07-06 09:05:11 +0800 CST'>2023年6月</span>&nbsp;·&nbsp;<span>1 分钟</span>&nbsp;·&nbsp;<span>28 字</span>&nbsp;·&nbsp;<span>八戒</span></footer><a class=entry-link aria-label="post link to 如何在容器内安装字体文件" href=https://rendoumi.com/posts/20230706-fonts_in_pod/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>2023年获得的证书
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>2023年上半年经过努力，又考了3张证书，下半年继续努力奋斗……</p></div><footer class=entry-footer><span title='2023-06-30 09:05:11 +0800 CST'>2023年30月</span>&nbsp;·&nbsp;<span>1 分钟</span>&nbsp;·&nbsp;<span>1 字</span>&nbsp;·&nbsp;<span>八戒</span></footer><a class=entry-link aria-label="post link to 2023年获得的证书" href=https://rendoumi.com/posts/20230630-certificates/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Yapi集成进freeIPA进行统一认证
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>Freeipa接入Yapi.
vi my-api/config.json
... "ldapLogin": { "enable": true, "server": "ldap://ldap.bybon.cn", "baseDn": "uid=manager,cn=users,cn=accounts,dc=bybon,dc=cn", "bindPassword": "xxxxxxxx", "searchDn": "cn=users,cn=accounts,dc=bybon,dc=cn", "searchStandard": "mail", "emailPostfix": "@bybon.cn", "emailKey": "mail", "usernameKey": "displayName" } 这里需要修改一下，vi my-yapi/vendors/server/controllers/user.js
理由如下，登录的时候，yapi的逻辑是先判断用户邮件，把邮件中的用户名摘出来，然后加上配置中的邮件域。
这个逻辑在ldap中就不对了，改成如下格式，这样直接输入ldap用户名就可以登录了
/** * ldap登录 * @interface /user/login_by_ldap * @method * @category user * @foldnumber 10 * @param {String} email email名称，不能为空 * @param {String} password 密码，不能为空 * @returns {Object} * */ async getLdapAuth(ctx) { try { const { email, password } = ctx.request.body; //no const username = email.split(/\@/g)[0]; //1 const { info: ldapInfo } = await ldap.ldapQuery(email, password); //2 const emailPrefix = email.split(/\@/g)[0]; //3 const emailPostfix = yapi.WEBCONFIG.ldapLogin.emailPostfix; //zrr const emailPrefix = email.split(/\@/g)[0]; const emailPostfix = yapi.WEBCONFIG.ldapLogin.emailPostfix; const { info: ldapInfo } = await ldap.ldapQuery( (emailPostfix ? emailPrefix + emailPostfix : email),password); //zrr const emailParams = ldapInfo[yapi.WEBCONFIG.ldapLogin.emailKey || 'mail'] || (emailPostfix ? emailPrefix + emailPostfix : email); const username = ldapInfo[yapi.WEBCONFIG.ldapLogin.usernameKey] || emailPrefix;</p></div><footer class=entry-footer><span title='2023-04-12 09:05:11 +0800 CST'>2023年12月</span>&nbsp;·&nbsp;<span>1 分钟</span>&nbsp;·&nbsp;<span>140 字</span>&nbsp;·&nbsp;<span>八戒</span></footer><a class=entry-link aria-label="post link to Yapi集成进freeIPA进行统一认证" href=https://rendoumi.com/posts/20230412-freeipa_yapi/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Dell得Idrac临时license
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>新公司的dell服务器idrac居然没有license，无法远程，找了dell要了一个临时license给装上，其实装好系统就不会太用到了，记录一下，以后备用。
&lt;?xml version="1.0"?> &lt;!--Copyright (c) 2010-2011 Dell Inc. All Rights Reserved.--> &lt;lns:LicenseClass xmlns:ds="http://www.w3.org/2000/09/xmldsig#" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:lns="http://www.dell.com/2011/12G/licensing"> &lt;lns:LicenseData> &lt;lns:Schema lns:Vendor="Dell" lns:ID="iDRAC" lns:maxDepth="255" lns:SchemaVersion="2.0"/> &lt;lns:TransferableLicense>false&lt;/lns:TransferableLicense> &lt;lns:UTCdateSold>2011-09-20T16:10:37Z&lt;/lns:UTCdateSold> &lt;lns:EntitlementID>56r8irR7fV5w3MIxlJUFL9Ph_Lori_Matthews&lt;/lns:EntitlementID> &lt;lns:DeviceClass lns:ID="iDRAC"/> &lt;lns:ProductDescription> &lt;lns:lang_en>iDRAC7 Enterprise Evaluation License&lt;/lns:lang_en> &lt;lns:lang_es>iDRAC7 Enterprise Evaluation License&lt;/lns:lang_es> &lt;lns:lang_fr>iDRAC7 Enterprise Evaluation License&lt;/lns:lang_fr> &lt;lns:lang_de>iDRAC7 Enterprise Evaluation License&lt;/lns:lang_de> &lt;lns:lang_it>iDRAC7 Enterprise Evaluation License&lt;/lns:lang_it> &lt;lns:lang_ja>iDRAC7 Enterprise Evaluation License&lt;/lns:lang_ja> &lt;lns:lang_zh>iDRAC7 Enterprise Evaluation License&lt;/lns:lang_zh> &lt;/lns:ProductDescription> &lt;lns:LicenseTerm> &lt;lns:Evaluation lns:Duration="P30D"/> &lt;/lns:LicenseTerm> &lt;lns:DeviceInfo lns:ID="1" lns:VendorID="0x1912" lns:DeviceID="0x0011"/> &lt;lns:Feature lns:ID="1" lns:Description="License Management" lns:Enabled="true"/> &lt;lns:Feature lns:ID="2" lns:Description="RACADM" lns:Enabled="true"/> &lt;lns:Feature lns:ID="3" lns:Description="WSMAN" lns:Enabled="true"/> &lt;lns:Feature lns:ID="4" lns:Description="SNMP" lns:Enabled="true"/> &lt;lns:Feature lns:ID="5" lns:Description="Auto Discovery" lns:Enabled="true"/> &lt;lns:Feature lns:ID="6" lns:Description="USC Firmware Update" lns:Enabled="true"/> &lt;lns:Feature lns:ID="7" lns:Description="Update Package" lns:Enabled="true"/> &lt;lns:Feature lns:ID="8" lns:Description="USC Operating System Deployment" lns:Enabled="true"/> &lt;lns:Feature lns:ID="9" lns:Description="USC Device Configuration" lns:Enabled="true"/> &lt;lns:Feature lns:ID="10" lns:Description="USC Diagnostics" lns:Enabled="true"/> &lt;lns:Feature lns:ID="11" lns:Description="Power Budget" lns:Enabled="true"/> &lt;lns:Feature lns:ID="12" lns:Description="Power Monitoring" lns:Enabled="true"/> &lt;lns:Feature lns:ID="13" lns:Description="Virtual Media" lns:Enabled="true"/> &lt;lns:Feature lns:ID="14" lns:Description="Telnet" lns:Enabled="true"/> &lt;lns:Feature lns:ID="15" lns:Description="SMASH CLP" lns:Enabled="true"/> &lt;lns:Feature lns:ID="16" lns:Description="IPv6" lns:Enabled="true"/> &lt;lns:Feature lns:ID="17" lns:Description="Dynamic DNS" lns:Enabled="true"/> &lt;lns:Feature lns:ID="18" lns:Description="Dedicated NIC" lns:Enabled="true"/> &lt;lns:Feature lns:ID="19" lns:Description="Directory Services" lns:Enabled="true"/> &lt;lns:Feature lns:ID="20" lns:Description="Two-Factor Authentication" lns:Enabled="true"/> &lt;lns:Feature lns:ID="21" lns:Description="Single Sign-On" lns:Enabled="true"/> &lt;lns:Feature lns:ID="22" lns:Description="PK Authentication" lns:Enabled="true"/> &lt;lns:Feature lns:ID="23" lns:Description="Crash Screen Capture" lns:Enabled="true"/> &lt;lns:Feature lns:ID="24" lns:Description="Crash Video Capture" lns:Enabled="true"/> &lt;lns:Feature lns:ID="25" lns:Description="Boot Capture" lns:Enabled="true"/> &lt;lns:Feature lns:ID="26" lns:Description="Virtual Console" lns:Enabled="true"/> &lt;lns:Feature lns:ID="27" lns:Description="Virtual Flash Partitions" lns:Enabled="true"/> &lt;lns:Feature lns:ID="28" lns:Description="Console Collaboration" lns:Enabled="true"/> &lt;lns:Feature lns:ID="29" lns:Description="Device Monitoring" lns:Enabled="true"/> &lt;lns:Feature lns:ID="30" lns:Description="Remote Inventory" lns:Enabled="true"/> &lt;lns:Feature lns:ID="31" lns:Description="Storage Monitoring" lns:Enabled="true"/> &lt;lns:Feature lns:ID="32" lns:Description="Remote Firmware Update" lns:Enabled="true"/> &lt;lns:Feature lns:ID="33" lns:Description="Remote Firmware Configuration" lns:Enabled="true"/> &lt;lns:Feature lns:ID="34" lns:Description="Remote Inventory Export" lns:Enabled="true"/> &lt;lns:Feature lns:ID="35" lns:Description="Remote Operating System Deployment" lns:Enabled="true"/> &lt;lns:Feature lns:ID="36" lns:Description="Backup and Restore" lns:Enabled="true"/> &lt;lns:Feature lns:ID="37" lns:Description="Part Replacement" lns:Enabled="true"/> &lt;lns:Feature lns:ID="38" lns:Description="SSH" lns:Enabled="true"/> &lt;lns:Feature lns:ID="39" lns:Description="Remote File Share" lns:Enabled="true"/> &lt;lns:Feature lns:ID="40" lns:Description="Virtual Folders" lns:Enabled="true"/> &lt;lns:Feature lns:ID="41" lns:Description="Web GUI" lns:Enabled="true"/> &lt;lns:Feature lns:ID="42" lns:Description="Network Time Protocol" lns:Enabled="true"/> &lt;lns:Feature lns:ID="43" lns:Description="Email Alerts" lns:Enabled="true"/> &lt;lns:Feature lns:ID="44" lns:Description="Security Lockout" lns:Enabled="true"/> &lt;lns:Feature lns:ID="45" lns:Description="Remote Syslog" lns:Enabled="true"/> &lt;lns:Feature lns:ID="253" lns:Description="Integrated Dell Remote Access Controller 7 Enterprise" lns:Enabled="true"/> &lt;/lns:LicenseData> &lt;dsig:Signature xmlns:dsig="http://www.w3.org/2000/09/xmldsig#"> &lt;dsig:SignedInfo> &lt;dsig:CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/> &lt;dsig:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/> &lt;dsig:Reference URI=""> &lt;dsig:Transforms> &lt;dsig:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/> &lt;/dsig:Transforms> &lt;dsig:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/> &lt;dsig:DigestValue>DrtnjP0vUsyT+18jazjmiaGrvc0=&lt;/dsig:DigestValue> &lt;/dsig:Reference> &lt;/dsig:SignedInfo> &lt;dsig:SignatureValue>Qg4Omx1ZGrVllUPbg/X25aJxK5qlNCF/G04NLwXhbmpqoplSRkCCUgb+6TvVz9b3 Ut7sSa/WjA0mv+mbcqIENTAnpveIkIOQPR3mdjCBwX2cLYieV9nOIGobxqHU7o97 QjbSAkmTHcRo0PI6mP8tc7Od4WNWMZ48rrUBeOrVOr1EZeptPUbeaSofy4nvlzbC pcpzZLbjAITT157r9KiFe9joG2hCEClrQPO0ScXHgKXrAWrQE9wX7e2De4uCvJwI hGWpJzDQNJJZbsWhDoZJn/59G/KRjzxIHIzIpUt1XPPIGHl5yMXDaRFcIMES0RuJ SWZS8tt9E001Fr/8/jQNgA==&lt;/dsig:SignatureValue> &lt;dsig:KeyInfo> &lt;dsig:X509Data> &lt;dsig:X509Certificate>MIIDTjCCAjagAwIBAgIBATANBgkqhkiG9w0BAQUFADBRMRMwEQYDVQQKEwpEZWxs LCBJbmMuMSEwHwYDVQQLExhFbWJlZGRlZCBMaWNlbnNlIE1hbmFnZXIxFzAVBgNV BAMTDkNBIENlcnRpZmljYXRlMB4XDTEwMDEwMTAwMDAwMFoXDTM1MTIzMTIzNTk1 OVowVjETMBEGA1UEChMKRGVsbCwgSW5jLjEhMB8GA1UECxMYRW1iZWRkZWQgTGlj ZW5zZSBNYW5hZ2VyMRwwGgYDVQQDExNTaWduaW5nIENlcnRpZmljYXRlMIIBIjAN BgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqbRo2DZtkjxl5YtqD5ePYdzrWbkU YQJwVaWYe1tE7ZAdou5TLTsjPnaa1cLcPTexn+cq8YjukIVwkwJP7yJ5GkrYGUnf 0Q6unWWgwcgTStlpflz31e8AbxXqNYZEFvEktojYS0kAfiYES+H02GUU5PtV7B9Y BbtZEowU2DPuqRGG1FF8mAsp1vojcbQGx+nS2Of47oQJRrJlh28COXyf2w/+IRAz RmeYin+9pisfrT9fmlUtxa7sAAV/KZFRx8ED31YiktXgI/u/PNnHlchiCMaL6pzA HMBf115O7A2y6IZ9sXUHvH8V9QnDkWT1XHMn8GCW8HXOA5zA232OxiaRmQIDAQAB oywwKjAJBgNVHRMEAjAAMB0GA1UdDgQWBBQAoZ7yMjDHMAFtmmmO/zyz3BJ6hjAN BgkqhkiG9w0BAQUFAAOCAQEAHHgoOg57S+lAEejahdBE1HMwe6BF3b9bzUMCynn9 7buXa3cnRFO3H3674WKU6nBjv4nkT3qMyXwgi7MvXcu69msK4eM6QA8XeC7G1rD+ 2bb/ENR9R9Zo0BWLym/ij8uUA/BzX8hnbzWxN82+FMdY9WD4fJAJwJ5ZPEbU1Vfy 7wOWosHgDPXjeAhlhkxDQi6vlRTJdfED6tBY7iGD4AQXfzrHzAZpZlIvKbM2c54B 65wMSlqfEWMBDhT5qcwGCq82hmi7/sCtu9Z20g2s9F0fp4XlGX8L7l0hCa46zjay 37GffYsScEDFg/DmkIpcXnGzyx8l1msLzpj8Gt4zHhPlgA==&lt;/dsig:X509Certificate> &lt;/dsig:X509Data> &lt;/dsig:KeyInfo> &lt;/dsig:Signature>&lt;/lns:LicenseClass> 文件下载：iDRAC7_Ent_Trial.xml
...</p></div><footer class=entry-footer><span title='2023-04-06 09:05:11 +0800 CST'>2023年6月</span>&nbsp;·&nbsp;<span>2 分钟</span>&nbsp;·&nbsp;<span>357 字</span>&nbsp;·&nbsp;<span>八戒</span></footer><a class=entry-link aria-label="post link to Dell得Idrac临时license" href=https://rendoumi.com/posts/20230406-dell_idrac/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>利用graphviz描述语言绘图
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>graphviz是很强烈的描述语言绘图工具
安装：
apt install graphviz 或 yum install graphviz 生成png
dot -Tpng hn.gv -o hn.png vi hg.gv
digraph MyGraph {
compound = true
margin="0,0"
ranksep = 1
nodesep = 1
rankdir=LR
{rank=same;防火墙;日志审计}
subgraph cluster_app {
label="海南应用"
rankdir=LR
margin = 10
{rank=same;app01;app02}
app01 [label="app01\n内网：192.168.0.10"]
app02 [label="app02\n内网：192.168.0.11"]
storage01 [label="storage01\n内网：192.168.0.30"]
subgraph cluster_db {
style = dotted
label="数据库主/备"
{rank=same;db02;db01}
db01 [label="db01\n内网：192.168.0.20"]
db02 [label="db02\n内网：192.168.0.21"]
db01 -> db02 [dir=both]
}
app01 -> db01 [splines=true,lhead=cluster_db]
app02 -> db01 [splines=true,lhead=cluster_db]
app01 -> storage01
app02 -> storage01
}
​
...</p></div><footer class=entry-footer><span title='2023-04-03 09:05:11 +0800 CST'>2023年3月</span>&nbsp;·&nbsp;<span>1 分钟</span>&nbsp;·&nbsp;<span>135 字</span>&nbsp;·&nbsp;<span>八戒</span></footer><a class=entry-link aria-label="post link to 利用graphviz描述语言绘图" href=https://rendoumi.com/posts/20230403-graphviz/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>TrueNAS系统如何增加新硬盘
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>之前公司世纪互联和无锡的TureNAS现有硬盘都是38块，满配是60块，所以都需要扩容，扩满再增加22块。
TrueNAS的Raid是使用的RaidZ3，基于ZFS的，最多允许3块盘坏
首先会建立zpool，然后在zpool里面增加vdev，注意，vdev一旦增加，不可更改。
我们这里就犯了第一个错误，所有vdev的磁盘数量最好相等，所以第一次应该先增加30块盘，然后第二次再增加30块，这样两个vdev就是均衡的
现在我们这种状况，第一个vdev是38块，第二个vdev是22块，不对等了，会警告
具体添加步骤如下：
首先浪潮工程师到现场加盘，盘必须做好清除信息，用以下命令通过
dd if=/dev/zero of=/dev/da59 bs=1M count=32 然后插好盘后，必须重启Trunas，才能正常认出盘来，不能热插拔（很奇怪） Storage –> Pools –> 点击齿轮 –> Add Vdevs
然后选中所有左边的Available Disks，移到右边的Data VDevs 然后看最下面会立刻出红色警告，提示两个vdev的disks不对等
点击ADD VDEVS，会弹窗警告，选中Confirm，然后点Continue
会继续弹出一个警告窗，这回就明晰了，旧的数据不会破坏，然后继续选中Confirm，然后点ADD VDEVS
然后就会开始初始化硬盘
最后查看zpool，看到有两个RAIDZ3，就加好了</p></div><footer class=entry-footer><span title='2023-03-31 11:05:11 +0800 CST'>2023年31月</span>&nbsp;·&nbsp;<span>1 分钟</span>&nbsp;·&nbsp;<span>31 字</span>&nbsp;·&nbsp;<span>八戒</span></footer><a class=entry-link aria-label="post link to TrueNAS系统如何增加新硬盘" href=https://rendoumi.com/posts/20230331-truenas_adddisk/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>dell服务器idrac常用操作脚本
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>收录一下 dell 服务器 idrac 操作常用脚本
显示Raid卡硬盘
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid get controllers
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid get vdisks
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid get pdisks 清理Foreign磁盘状态
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm storage clearconfig:RAID.Integrated.1-1
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime
删除vdisk
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.5.14 racadm raid deletevd:Disk.Virtual.0:RAID.Integrated.1-1
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime
建立Raid0
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid createvd:RAID.Integrated.1-1 -rl r0 -wp wb -rp ra -name raid_0 -pdkey:Disk.Bay.0:Enclosure.Internal.0-1:RAID.Integrated.1-1
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime
建立Raid5
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid createvd:RAID.Integrated.1-1 -rl r5 -wp wb -rp ra -name raid_5 -pdkey:Disk.Bay.1:Enclosure.Internal.0-1:RAID.Integrated.1-1,Disk.Bay.2:Enclosure.Internal.0-1:RAID.Integrated.1-1,Disk.Bay.3:Enclosure.Internal.0-1:RAID.Integrated.1-1
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime
重启服务器
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm serveraction hardreset
设置硬盘第一启动，禁止F1/F2等待
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set BIOS.biosbootsettings.BootSeq HardDisk.List.1-1,NIC.Integrated.1-1-1
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set BIOS.MiscSettings.ErrPrompt Disabled
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.5.16 racadm jobqueue create BIOS.Setup.1-1 sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm serveraction hardreset
设置vnc
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.vncserver.enable Enabled
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.vncserver.Password calvin
设置idrac其他用户
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminUserName -i 4 newuser
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminPassword -i 4 123456
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminPrivilege -i 4 0x000001ff
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminEnable -i 4 1
改掉密码
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminPassword -i 4 987654
NTP的设置
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.ipv4static.dns1 8.8.8.8
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp1 0.asia.pool.ntp.org
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp2 1.asia.pool.ntp.org
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp3 2.asia.pool.ntp.org
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp1 129.250.35.250
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp2 180.211.88.50
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp3 202.112.29.82
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.NTPEnable Enabled
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.NTPMaxDist 16
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.time.timezone Japan
修改网卡启动为Legacy PXE
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm get nic.nicconfig.1 | grep Legacy
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set nic.nicconfig.1.legacybootproto PXE
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm get nic.nicconfig.1 | grep Legacy
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create NIC.Integrated.1-1-1
ipmitool -I lanplus -H $ip -U root -P calvin chassis power reset</p></div><footer class=entry-footer><span title='2023-03-31 09:05:11 +0800 CST'>2023年31月</span>&nbsp;·&nbsp;<span>3 分钟</span>&nbsp;·&nbsp;<span>490 字</span>&nbsp;·&nbsp;<span>八戒</span></footer><a class=entry-link aria-label="post link to dell服务器idrac常用操作脚本" href=https://rendoumi.com/posts/20230331-idrac_dell/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>TureNAS系统在浪潮定制系统上的安装
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>无锡浪潮TrueNAS系统的安装
这一版的浪潮定制NAS机器比较特别，没有任何Raid卡，配了Avago的一块pcie sas直通卡：搏通9400卡
然后是定制机，整体4U的高度，满配是60块16T的大盘，主板在机箱侧面立着，2块小盘做系统。
由于机房限制，无法直接从本地访问10.18.30.97，导致无法将本地文件挂入idrac的cdrom，只能曲线救国，在172.18.31.2建立一个nfs share，把光盘文件放进去
到 idrac 的 Remote control ， 再到Virtual media，配好nfs共享 ip: 172.18.31.2 path: /export/nfsshare
在remote image redirction中可以看到光盘文件，点击Start
然后重启，CDROM是第一启动媒介
开始安装，缺省会进入第一项进行安装
然后会报这个错，panic: AP #1 (PHY# 2) failed!
见了鬼了，唯一的地方可能是主板部分和博通卡冲突，我们重启进入BIOS，到SATA和sSATA的地方
把主板的SATA给关掉，禁止AHCI
同样关掉sSATA，也禁止AHCI
然后重启安装TrueNAS，这次就可以通过了 安装盘选择前两块SSD小盘，230G openbsd会自动将这两款小盘做成软Raid
提示会抹掉两块盘的所有数据
输入root的密码
选择Boot via BIOS
建立16G的swap空间
然后就开始安装，这里没什么动静，也没有进度条，会等很久
安装完成后会让你重启，然后出来配置界面
我们首先要配置第二项，Bonding端口 然后再配第一项的静态IP 再配第四项缺省路由 配完就http和https显示正确地址
输入地址：http://172.18.30.97 登录就完成安装了</p></div><footer class=entry-footer><span title='2023-03-30 10:05:11 +0800 CST'>2023年30月</span>&nbsp;·&nbsp;<span>1 分钟</span>&nbsp;·&nbsp;<span>49 字</span>&nbsp;·&nbsp;<span>八戒</span></footer><a class=entry-link aria-label="post link to TureNAS系统在浪潮定制系统上的安装" href=https://rendoumi.com/posts/20230330-truenas_install/></a></article><div class=pagination><ul class=pagination-list><li class="page-item first"><a class=page-link href=/posts/ aria-label="First Page"><span aria-hidden=true>&#9668;</span></a></li><li class="page-item prev"><a class=page-link href=/posts/page/22/ aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a class=page-link href=/posts/page/17/>17</a></li><li class=page-item><a class=page-link href=/posts/page/18/>18</a></li><li class=page-item><a class=page-link href=/posts/page/19/>19</a></li><li class=page-item><a class=page-link href=/posts/page/20/>20</a></li><li class=page-item><a class=page-link href=/posts/page/21/>21</a></li><li class=page-item><a class=page-link href=/posts/page/22/>22</a></li><li class="page-item active"><span class=page-link aria-current=page>23</span></li><li class=page-item><a class=page-link href=/posts/page/24/>24</a></li><li class="page-item next"><a class=page-link href=/posts/page/24/ aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class="page-item last"><a class=page-link href=/posts/page/37/ aria-label="Last Page"><span aria-hidden=true>&#9658;</span></a></li></ul><div class=total-pages>共 37 页</div></div></main><footer class=footer><span>Copyright © 2020-2025 Zhang Ranrui. All Rights Reserved.</span><br>·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>