<!doctype html><html lang=zh dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3988508441804851" crossorigin=anonymous></script><title>所有文章 | 八戒的技术博客</title>
<meta name=keywords content><meta name=description content="所有文章 - 八戒的技术博客"><meta name=author content><link rel=canonical href=https://rendoumi.com/posts/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.181dcf08b5d0ad7a24019e99c09910b83c66dc2a9b7be7a1215b3bb7af4cc829.css integrity="sha256-GB3PCLXQrXokAZ6ZwJkQuDxm3Cqbe+ehIVs7t69MyCk=" rel="preload stylesheet" as=style><link rel=icon href=https://rendoumi.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://rendoumi.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://rendoumi.com/favicon-32x32.png><link rel=apple-touch-icon href=https://rendoumi.com/apple-touch-icon.png><link rel=mask-icon href=https://rendoumi.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://rendoumi.com/posts/index.xml title=rss><link rel=alternate hreflang=zh href=https://rendoumi.com/posts/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://rendoumi.com/posts/"><meta property="og:site_name" content="八戒的技术博客"><meta property="og:title" content="所有文章"><meta property="og:locale" content="zh"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="所有文章"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"所有文章","item":"https://rendoumi.com/posts/"}]}</script></head><body class=list id=top><header class=header><nav class=nav><div class=logo><a href=https://rendoumi.com/ accesskey=h title="八戒的技术博客 (Alt + H)">八戒的技术博客</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://rendoumi.com/ title=首页><span>首页</span></a></li><li><a href=https://rendoumi.com/posts/ title=文章><span class=active>文章</span></a></li><li><a href=https://rendoumi.com/archives/ title=归档><span>归档</span></a></li><li><a href=https://blog.rendoumi.com title=生活><span>生活</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://rendoumi.com/search/ title=搜索><span>搜索</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>所有文章</h1></header><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>2023年获得的证书
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>2023年上半年经过努力，又考了3张证书，下半年继续努力奋斗……</p></div><footer class=entry-footer><span title='2023-06-30 09:05:11 +0800 CST'>2023年6月30日</span></footer><a class=entry-link aria-label="post link to 2023年获得的证书" href=https://rendoumi.com/posts/20230630-certificates/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Yapi集成进freeIPA进行统一认证
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>Freeipa接入Yapi.
vi my-api/config.json
... "ldapLogin": { "enable": true, "server": "ldap://ldap.bybon.cn", "baseDn": "uid=manager,cn=users,cn=accounts,dc=bybon,dc=cn", "bindPassword": "xxxxxxxx", "searchDn": "cn=users,cn=accounts,dc=bybon,dc=cn", "searchStandard": "mail", "emailPostfix": "@bybon.cn", "emailKey": "mail", "usernameKey": "displayName" } 这里需要修改一下，vi my-yapi/vendors/server/controllers/user.js
理由如下，登录的时候，yapi的逻辑是先判断用户邮件，把邮件中的用户名摘出来，然后加上配置中的邮件域。
这个逻辑在ldap中就不对了，改成如下格式，这样直接输入ldap用户名就可以登录了
/** * ldap登录 * @interface /user/login_by_ldap * @method * @category user * @foldnumber 10 * @param {String} email email名称，不能为空 * @param {String} password 密码，不能为空 * @returns {Object} * */ async getLdapAuth(ctx) { try { const { email, password } = ctx.request.body; //no const username = email.split(/\@/g)[0]; //1 const { info: ldapInfo } = await ldap.ldapQuery(email, password); //2 const emailPrefix = email.split(/\@/g)[0]; //3 const emailPostfix = yapi.WEBCONFIG.ldapLogin.emailPostfix; //zrr const emailPrefix = email.split(/\@/g)[0]; const emailPostfix = yapi.WEBCONFIG.ldapLogin.emailPostfix; const { info: ldapInfo } = await ldap.ldapQuery( (emailPostfix ? emailPrefix + emailPostfix : email),password); //zrr const emailParams = ldapInfo[yapi.WEBCONFIG.ldapLogin.emailKey || 'mail'] || (emailPostfix ? emailPrefix + emailPostfix : email); const username = ldapInfo[yapi.WEBCONFIG.ldapLogin.usernameKey] || emailPrefix;</p></div><footer class=entry-footer><span title='2023-04-12 09:05:11 +0800 CST'>2023年4月12日</span></footer><a class=entry-link aria-label="post link to Yapi集成进freeIPA进行统一认证" href=https://rendoumi.com/posts/20230412-freeipa_yapi/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Dell得Idrac临时license
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>新公司的dell服务器idrac居然没有license，无法远程，找了dell要了一个临时license给装上，其实装好系统就不会太用到了，记录一下，以后备用。
&lt;?xml version="1.0"?> &lt;!--Copyright (c) 2010-2011 Dell Inc. All Rights Reserved.--> &lt;lns:LicenseClass xmlns:ds="http://www.w3.org/2000/09/xmldsig#" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:lns="http://www.dell.com/2011/12G/licensing"> &lt;lns:LicenseData> &lt;lns:Schema lns:Vendor="Dell" lns:ID="iDRAC" lns:maxDepth="255" lns:SchemaVersion="2.0"/> &lt;lns:TransferableLicense>false&lt;/lns:TransferableLicense> &lt;lns:UTCdateSold>2011-09-20T16:10:37Z&lt;/lns:UTCdateSold> &lt;lns:EntitlementID>56r8irR7fV5w3MIxlJUFL9Ph_Lori_Matthews&lt;/lns:EntitlementID> &lt;lns:DeviceClass lns:ID="iDRAC"/> &lt;lns:ProductDescription> &lt;lns:lang_en>iDRAC7 Enterprise Evaluation License&lt;/lns:lang_en> &lt;lns:lang_es>iDRAC7 Enterprise Evaluation License&lt;/lns:lang_es> &lt;lns:lang_fr>iDRAC7 Enterprise Evaluation License&lt;/lns:lang_fr> &lt;lns:lang_de>iDRAC7 Enterprise Evaluation License&lt;/lns:lang_de> &lt;lns:lang_it>iDRAC7 Enterprise Evaluation License&lt;/lns:lang_it> &lt;lns:lang_ja>iDRAC7 Enterprise Evaluation License&lt;/lns:lang_ja> &lt;lns:lang_zh>iDRAC7 Enterprise Evaluation License&lt;/lns:lang_zh> &lt;/lns:ProductDescription> &lt;lns:LicenseTerm> &lt;lns:Evaluation lns:Duration="P30D"/> &lt;/lns:LicenseTerm> &lt;lns:DeviceInfo lns:ID="1" lns:VendorID="0x1912" lns:DeviceID="0x0011"/> &lt;lns:Feature lns:ID="1" lns:Description="License Management" lns:Enabled="true"/> &lt;lns:Feature lns:ID="2" lns:Description="RACADM" lns:Enabled="true"/> &lt;lns:Feature lns:ID="3" lns:Description="WSMAN" lns:Enabled="true"/> &lt;lns:Feature lns:ID="4" lns:Description="SNMP" lns:Enabled="true"/> &lt;lns:Feature lns:ID="5" lns:Description="Auto Discovery" lns:Enabled="true"/> &lt;lns:Feature lns:ID="6" lns:Description="USC Firmware Update" lns:Enabled="true"/> &lt;lns:Feature lns:ID="7" lns:Description="Update Package" lns:Enabled="true"/> &lt;lns:Feature lns:ID="8" lns:Description="USC Operating System Deployment" lns:Enabled="true"/> &lt;lns:Feature lns:ID="9" lns:Description="USC Device Configuration" lns:Enabled="true"/> &lt;lns:Feature lns:ID="10" lns:Description="USC Diagnostics" lns:Enabled="true"/> &lt;lns:Feature lns:ID="11" lns:Description="Power Budget" lns:Enabled="true"/> &lt;lns:Feature lns:ID="12" lns:Description="Power Monitoring" lns:Enabled="true"/> &lt;lns:Feature lns:ID="13" lns:Description="Virtual Media" lns:Enabled="true"/> &lt;lns:Feature lns:ID="14" lns:Description="Telnet" lns:Enabled="true"/> &lt;lns:Feature lns:ID="15" lns:Description="SMASH CLP" lns:Enabled="true"/> &lt;lns:Feature lns:ID="16" lns:Description="IPv6" lns:Enabled="true"/> &lt;lns:Feature lns:ID="17" lns:Description="Dynamic DNS" lns:Enabled="true"/> &lt;lns:Feature lns:ID="18" lns:Description="Dedicated NIC" lns:Enabled="true"/> &lt;lns:Feature lns:ID="19" lns:Description="Directory Services" lns:Enabled="true"/> &lt;lns:Feature lns:ID="20" lns:Description="Two-Factor Authentication" lns:Enabled="true"/> &lt;lns:Feature lns:ID="21" lns:Description="Single Sign-On" lns:Enabled="true"/> &lt;lns:Feature lns:ID="22" lns:Description="PK Authentication" lns:Enabled="true"/> &lt;lns:Feature lns:ID="23" lns:Description="Crash Screen Capture" lns:Enabled="true"/> &lt;lns:Feature lns:ID="24" lns:Description="Crash Video Capture" lns:Enabled="true"/> &lt;lns:Feature lns:ID="25" lns:Description="Boot Capture" lns:Enabled="true"/> &lt;lns:Feature lns:ID="26" lns:Description="Virtual Console" lns:Enabled="true"/> &lt;lns:Feature lns:ID="27" lns:Description="Virtual Flash Partitions" lns:Enabled="true"/> &lt;lns:Feature lns:ID="28" lns:Description="Console Collaboration" lns:Enabled="true"/> &lt;lns:Feature lns:ID="29" lns:Description="Device Monitoring" lns:Enabled="true"/> &lt;lns:Feature lns:ID="30" lns:Description="Remote Inventory" lns:Enabled="true"/> &lt;lns:Feature lns:ID="31" lns:Description="Storage Monitoring" lns:Enabled="true"/> &lt;lns:Feature lns:ID="32" lns:Description="Remote Firmware Update" lns:Enabled="true"/> &lt;lns:Feature lns:ID="33" lns:Description="Remote Firmware Configuration" lns:Enabled="true"/> &lt;lns:Feature lns:ID="34" lns:Description="Remote Inventory Export" lns:Enabled="true"/> &lt;lns:Feature lns:ID="35" lns:Description="Remote Operating System Deployment" lns:Enabled="true"/> &lt;lns:Feature lns:ID="36" lns:Description="Backup and Restore" lns:Enabled="true"/> &lt;lns:Feature lns:ID="37" lns:Description="Part Replacement" lns:Enabled="true"/> &lt;lns:Feature lns:ID="38" lns:Description="SSH" lns:Enabled="true"/> &lt;lns:Feature lns:ID="39" lns:Description="Remote File Share" lns:Enabled="true"/> &lt;lns:Feature lns:ID="40" lns:Description="Virtual Folders" lns:Enabled="true"/> &lt;lns:Feature lns:ID="41" lns:Description="Web GUI" lns:Enabled="true"/> &lt;lns:Feature lns:ID="42" lns:Description="Network Time Protocol" lns:Enabled="true"/> &lt;lns:Feature lns:ID="43" lns:Description="Email Alerts" lns:Enabled="true"/> &lt;lns:Feature lns:ID="44" lns:Description="Security Lockout" lns:Enabled="true"/> &lt;lns:Feature lns:ID="45" lns:Description="Remote Syslog" lns:Enabled="true"/> &lt;lns:Feature lns:ID="253" lns:Description="Integrated Dell Remote Access Controller 7 Enterprise" lns:Enabled="true"/> &lt;/lns:LicenseData> &lt;dsig:Signature xmlns:dsig="http://www.w3.org/2000/09/xmldsig#"> &lt;dsig:SignedInfo> &lt;dsig:CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/> &lt;dsig:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/> &lt;dsig:Reference URI=""> &lt;dsig:Transforms> &lt;dsig:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/> &lt;/dsig:Transforms> &lt;dsig:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/> &lt;dsig:DigestValue>DrtnjP0vUsyT+18jazjmiaGrvc0=&lt;/dsig:DigestValue> &lt;/dsig:Reference> &lt;/dsig:SignedInfo> &lt;dsig:SignatureValue>Qg4Omx1ZGrVllUPbg/X25aJxK5qlNCF/G04NLwXhbmpqoplSRkCCUgb+6TvVz9b3 Ut7sSa/WjA0mv+mbcqIENTAnpveIkIOQPR3mdjCBwX2cLYieV9nOIGobxqHU7o97 QjbSAkmTHcRo0PI6mP8tc7Od4WNWMZ48rrUBeOrVOr1EZeptPUbeaSofy4nvlzbC pcpzZLbjAITT157r9KiFe9joG2hCEClrQPO0ScXHgKXrAWrQE9wX7e2De4uCvJwI hGWpJzDQNJJZbsWhDoZJn/59G/KRjzxIHIzIpUt1XPPIGHl5yMXDaRFcIMES0RuJ SWZS8tt9E001Fr/8/jQNgA==&lt;/dsig:SignatureValue> &lt;dsig:KeyInfo> &lt;dsig:X509Data> &lt;dsig:X509Certificate>MIIDTjCCAjagAwIBAgIBATANBgkqhkiG9w0BAQUFADBRMRMwEQYDVQQKEwpEZWxs LCBJbmMuMSEwHwYDVQQLExhFbWJlZGRlZCBMaWNlbnNlIE1hbmFnZXIxFzAVBgNV BAMTDkNBIENlcnRpZmljYXRlMB4XDTEwMDEwMTAwMDAwMFoXDTM1MTIzMTIzNTk1 OVowVjETMBEGA1UEChMKRGVsbCwgSW5jLjEhMB8GA1UECxMYRW1iZWRkZWQgTGlj ZW5zZSBNYW5hZ2VyMRwwGgYDVQQDExNTaWduaW5nIENlcnRpZmljYXRlMIIBIjAN BgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqbRo2DZtkjxl5YtqD5ePYdzrWbkU YQJwVaWYe1tE7ZAdou5TLTsjPnaa1cLcPTexn+cq8YjukIVwkwJP7yJ5GkrYGUnf 0Q6unWWgwcgTStlpflz31e8AbxXqNYZEFvEktojYS0kAfiYES+H02GUU5PtV7B9Y BbtZEowU2DPuqRGG1FF8mAsp1vojcbQGx+nS2Of47oQJRrJlh28COXyf2w/+IRAz RmeYin+9pisfrT9fmlUtxa7sAAV/KZFRx8ED31YiktXgI/u/PNnHlchiCMaL6pzA HMBf115O7A2y6IZ9sXUHvH8V9QnDkWT1XHMn8GCW8HXOA5zA232OxiaRmQIDAQAB oywwKjAJBgNVHRMEAjAAMB0GA1UdDgQWBBQAoZ7yMjDHMAFtmmmO/zyz3BJ6hjAN BgkqhkiG9w0BAQUFAAOCAQEAHHgoOg57S+lAEejahdBE1HMwe6BF3b9bzUMCynn9 7buXa3cnRFO3H3674WKU6nBjv4nkT3qMyXwgi7MvXcu69msK4eM6QA8XeC7G1rD+ 2bb/ENR9R9Zo0BWLym/ij8uUA/BzX8hnbzWxN82+FMdY9WD4fJAJwJ5ZPEbU1Vfy 7wOWosHgDPXjeAhlhkxDQi6vlRTJdfED6tBY7iGD4AQXfzrHzAZpZlIvKbM2c54B 65wMSlqfEWMBDhT5qcwGCq82hmi7/sCtu9Z20g2s9F0fp4XlGX8L7l0hCa46zjay 37GffYsScEDFg/DmkIpcXnGzyx8l1msLzpj8Gt4zHhPlgA==&lt;/dsig:X509Certificate> &lt;/dsig:X509Data> &lt;/dsig:KeyInfo> &lt;/dsig:Signature>&lt;/lns:LicenseClass> 文件下载：iDRAC7_Ent_Trial.xml
...</p></div><footer class=entry-footer><span title='2023-04-06 09:05:11 +0800 CST'>2023年4月6日</span></footer><a class=entry-link aria-label="post link to Dell得Idrac临时license" href=https://rendoumi.com/posts/20230406-dell_idrac/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>利用graphviz描述语言绘图
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>graphviz是很强烈的描述语言绘图工具
安装：
apt install graphviz 或 yum install graphviz 生成png
dot -Tpng hn.gv -o hn.png vi hg.gv
digraph MyGraph {
compound = true
margin="0,0"
ranksep = 1
nodesep = 1
rankdir=LR
{rank=same;防火墙;日志审计}
subgraph cluster_app {
label="海南应用"
rankdir=LR
margin = 10
{rank=same;app01;app02}
app01 [label="app01\n内网：192.168.0.10"]
app02 [label="app02\n内网：192.168.0.11"]
storage01 [label="storage01\n内网：192.168.0.30"]
subgraph cluster_db {
style = dotted
label="数据库主/备"
{rank=same;db02;db01}
db01 [label="db01\n内网：192.168.0.20"]
db02 [label="db02\n内网：192.168.0.21"]
db01 -> db02 [dir=both]
}
app01 -> db01 [splines=true,lhead=cluster_db]
app02 -> db01 [splines=true,lhead=cluster_db]
app01 -> storage01
app02 -> storage01
}
​
...</p></div><footer class=entry-footer><span title='2023-04-03 09:05:11 +0800 CST'>2023年4月3日</span></footer><a class=entry-link aria-label="post link to 利用graphviz描述语言绘图" href=https://rendoumi.com/posts/20230403-graphviz/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>TrueNAS系统如何增加新硬盘
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>之前公司世纪互联和无锡的TureNAS现有硬盘都是38块，满配是60块，所以都需要扩容，扩满再增加22块。
TrueNAS的Raid是使用的RaidZ3，基于ZFS的，最多允许3块盘坏
首先会建立zpool，然后在zpool里面增加vdev，注意，vdev一旦增加，不可更改。
我们这里就犯了第一个错误，所有vdev的磁盘数量最好相等，所以第一次应该先增加30块盘，然后第二次再增加30块，这样两个vdev就是均衡的
现在我们这种状况，第一个vdev是38块，第二个vdev是22块，不对等了，会警告
具体添加步骤如下：
首先浪潮工程师到现场加盘，盘必须做好清除信息，用以下命令通过
dd if=/dev/zero of=/dev/da59 bs=1M count=32 然后插好盘后，必须重启Trunas，才能正常认出盘来，不能热插拔（很奇怪） Storage –> Pools –> 点击齿轮 –> Add Vdevs
然后选中所有左边的Available Disks，移到右边的Data VDevs 然后看最下面会立刻出红色警告，提示两个vdev的disks不对等
点击ADD VDEVS，会弹窗警告，选中Confirm，然后点Continue
会继续弹出一个警告窗，这回就明晰了，旧的数据不会破坏，然后继续选中Confirm，然后点ADD VDEVS
然后就会开始初始化硬盘
最后查看zpool，看到有两个RAIDZ3，就加好了</p></div><footer class=entry-footer><span title='2023-03-31 11:05:11 +0800 CST'>2023年3月31日</span></footer><a class=entry-link aria-label="post link to TrueNAS系统如何增加新硬盘" href=https://rendoumi.com/posts/20230331-truenas_adddisk/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>dell服务器idrac常用操作脚本
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>收录一下 dell 服务器 idrac 操作常用脚本
显示Raid卡硬盘
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid get controllers
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid get vdisks
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid get pdisks 清理Foreign磁盘状态
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm storage clearconfig:RAID.Integrated.1-1
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime
删除vdisk
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.5.14 racadm raid deletevd:Disk.Virtual.0:RAID.Integrated.1-1
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime
建立Raid0
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid createvd:RAID.Integrated.1-1 -rl r0 -wp wb -rp ra -name raid_0 -pdkey:Disk.Bay.0:Enclosure.Internal.0-1:RAID.Integrated.1-1
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime
建立Raid5
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid createvd:RAID.Integrated.1-1 -rl r5 -wp wb -rp ra -name raid_5 -pdkey:Disk.Bay.1:Enclosure.Internal.0-1:RAID.Integrated.1-1,Disk.Bay.2:Enclosure.Internal.0-1:RAID.Integrated.1-1,Disk.Bay.3:Enclosure.Internal.0-1:RAID.Integrated.1-1
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime
重启服务器
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm serveraction hardreset
设置硬盘第一启动，禁止F1/F2等待
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set BIOS.biosbootsettings.BootSeq HardDisk.List.1-1,NIC.Integrated.1-1-1
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set BIOS.MiscSettings.ErrPrompt Disabled
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.5.16 racadm jobqueue create BIOS.Setup.1-1 sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm serveraction hardreset
设置vnc
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.vncserver.enable Enabled
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.vncserver.Password calvin
设置idrac其他用户
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminUserName -i 4 newuser
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminPassword -i 4 123456
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminPrivilege -i 4 0x000001ff
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminEnable -i 4 1
改掉密码
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminPassword -i 4 987654
NTP的设置
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.ipv4static.dns1 8.8.8.8
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp1 0.asia.pool.ntp.org
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp2 1.asia.pool.ntp.org
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp3 2.asia.pool.ntp.org
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp1 129.250.35.250
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp2 180.211.88.50
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp3 202.112.29.82
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.NTPEnable Enabled
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.NTPMaxDist 16
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.time.timezone Japan
修改网卡启动为Legacy PXE
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm get nic.nicconfig.1 | grep Legacy
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set nic.nicconfig.1.legacybootproto PXE
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm get nic.nicconfig.1 | grep Legacy
sshpass -p "calvin" ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create NIC.Integrated.1-1-1
ipmitool -I lanplus -H $ip -U root -P calvin chassis power reset</p></div><footer class=entry-footer><span title='2023-03-31 09:05:11 +0800 CST'>2023年3月31日</span></footer><a class=entry-link aria-label="post link to dell服务器idrac常用操作脚本" href=https://rendoumi.com/posts/20230331-idrac_dell/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>TureNAS系统在浪潮定制系统上的安装
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>无锡浪潮TrueNAS系统的安装
这一版的浪潮定制NAS机器比较特别，没有任何Raid卡，配了Avago的一块pcie sas直通卡：搏通9400卡
然后是定制机，整体4U的高度，满配是60块16T的大盘，主板在机箱侧面立着，2块小盘做系统。
由于机房限制，无法直接从本地访问10.18.30.97，导致无法将本地文件挂入idrac的cdrom，只能曲线救国，在172.18.31.2建立一个nfs share，把光盘文件放进去
到 idrac 的 Remote control ， 再到Virtual media，配好nfs共享 ip: 172.18.31.2 path: /export/nfsshare
在remote image redirction中可以看到光盘文件，点击Start
然后重启，CDROM是第一启动媒介
开始安装，缺省会进入第一项进行安装
然后会报这个错，panic: AP #1 (PHY# 2) failed!
见了鬼了，唯一的地方可能是主板部分和博通卡冲突，我们重启进入BIOS，到SATA和sSATA的地方
把主板的SATA给关掉，禁止AHCI
同样关掉sSATA，也禁止AHCI
然后重启安装TrueNAS，这次就可以通过了 安装盘选择前两块SSD小盘，230G openbsd会自动将这两款小盘做成软Raid
提示会抹掉两块盘的所有数据
输入root的密码
选择Boot via BIOS
建立16G的swap空间
然后就开始安装，这里没什么动静，也没有进度条，会等很久
安装完成后会让你重启，然后出来配置界面
我们首先要配置第二项，Bonding端口 然后再配第一项的静态IP 再配第四项缺省路由 配完就http和https显示正确地址
输入地址：http://172.18.30.97 登录就完成安装了</p></div><footer class=entry-footer><span title='2023-03-30 10:05:11 +0800 CST'>2023年3月30日</span></footer><a class=entry-link aria-label="post link to TureNAS系统在浪潮定制系统上的安装" href=https://rendoumi.com/posts/20230330-truenas_install/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>GlusterFS的实际应用
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>特别注意 两台GFS主机172.18.30.18和172.18.30.36上面务必配置/etc/hosts，否则peer的时候会有问题
172.18.30.18 renhe-18-30-18
172.18.30.18 renhe-18-30-36
客户端安装 yum -y install epel-release 然后 yum install glusterfs-fuse 就可以了 挂载： mount.glusterfs 172.18.30.18:/borui-vol /data/br/nfs
fstab 自动挂载 172.18.30.18:/borui-vol /data/br/nfs glusterfs defaults,_netdev,backupvolfile-server=172.18.30.36 0 0
在172.18.30.18上建立新卷，因为只有2个节点，就必须force了 gluster volume create test-zhichi-vol replica 2 transport tcp 172.18.30.18:/glusterfs/test-zhichi-vol 172.18.30.36:/glusterfs/test-zhichi-vol force 启动 gluster volume start test-zhichi-vol
查看一下 gluster volume info test-zhichi-vol
查看卷信息(禁止查看inode，太多了) gluster volume status test-zhichi-vol detail gluster volume status test-zhichi-vol clients gluster volume status test-zhichi-vol mem gluster volume status test-zhichi-vol fd gluster volume status test-zhichi-vol inode 开启限额 gluster volume quota test-zhichi-vol enable gluster volume quota test-zhichi-vol limit-usage / 50GB gluster volume quota test-zhichi-vol list 限制IP访问 例如允许172.18.31.*网段的主机访问rep-volume：
...</p></div><footer class=entry-footer><span title='2023-03-30 09:05:11 +0800 CST'>2023年3月30日</span></footer><a class=entry-link aria-label="post link to GlusterFS的实际应用" href=https://rendoumi.com/posts/20230330-glusterfs/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>使用ipset来禁止国外的用户登录openvpn
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>突然来的个需求，要求屏蔽国外的用户登录公司的openvpn，防止滥用，搜了一下教程倒是真不少，问题不少都是要去下载那个无比大的ip地址库，好不容易找了一个可用的。
记录下来，备用，原理很简单，ipset建立一个china的hashset，不停添加条目，最后用iptalbes阻挡一下：
#!/bin/sh ipset create china hash:net hashsize 10000 maxelem 1000000 ipset add china 1.0.1.0/24 ...... ipset add china 91.234.36.0/24 iptables -I INPUT -m set --match-set china src -p udp -m udp --dport 1194 -j ACCEPT iptables -A INPUT -p udp --dport 1194 -j DROP 相应脚本的下载：
ipset-rules.txt</p></div><footer class=entry-footer><span title='2023-03-29 09:05:11 +0800 CST'>2023年3月29日</span></footer><a class=entry-link aria-label="post link to 使用ipset来禁止国外的用户登录openvpn" href=https://rendoumi.com/posts/20230329-ipset_block/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>核心交换机的配置过程
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>换了公司，也搞起了桌面运维，配置交换机的过程记录一下，其实很简单，就是命令记不住。
拿到一台华为交换机，重新初始化后，配置如下：
&lt;HUAWEI>dis cur !Software Version V200R008C00SPC500 # sysname HUAWEI # aaa authentication-scheme default authorization-scheme default accounting-scheme default domain default domain default_admin local-user admin password irreversible-cipher %^%#7:.iL]+u"4\j8ZFhGeg/-m.&"^0}kMznjk%>;BaUDO/'6m\X\=V8JGY:W;i,%^%# local-user admin service-type http # interface Vlanif1 # interface MEth0/0/1 # interface GigabitEthernet0/0/1 # interface NULL0 # user-interface con 0 authentication-mode password set authentication password cipher $1a$~!;$-JF0-W$Z>&lt;1.F]&lt;sF.R_NBj34CJ/JPe=/tZDMM(Ws3'9u%+$ user-interface vty 0 4 user-interface vty 16 20 # return 一、配名称 sysname BJ_FANGHENG_JIERU 二、配置登录用户 1、aaa local-user admin password irreversible-cipher abcdefg local-user admin privilege level 3 local-user admin service-type telnet terminal ssh 2、user-interface con 0 authentication-mode aaa 3、user-interface vty 0 4 authentication-mode aaa protocol inbound all 三、配置下联交换机端口 interface GigabitEthernet0/0/23 description == H3cSW --> 24 port link-type trunk port trunk allow-pass vlan 2 to 4094 四、配置上联交换机端口 interface GigabitEthernet0/0/24 description == RuijieRoute --> lan0 port link-type trunk port trunk allow-pass vlan 2 to 4094 五、配置vlan地址 vlan 11 vlan 100 vlan 11 interface Vlanif11 ip address 10.8.0.7 255.255.254.0 vlan 100 interface Vlanif100 ip address 192.168.10.7 255.255.255.0 六、配置缺省路由 ip route-static 0.0.0.0 0.0.0.0 10.8.0.1 七、批量配置端口 port-group group-member GigabitEthernet0/0/1 to GigabitEthernet0/0/23 port link-type access port default vlan 11 stp edged-port enable 八、lldp lldp enable 九、dhcp dhcp enable ip pool 11 gateway-list 10.8.0.1 network 10.8.0.0 mask 255.255.254.0 static-bind ip-address 10.8.0.4 mac-address 8005-88f1-fa62 dns-list 114.114.114.114 interface Vlanif11 description === Ke hu duan ip address 10.8.0.1 255.255.254.0 dhcp select global 十、telnet和ssh dsa local-key-pair create telnet server enable stelnet server enable ssh authentication-type default password 这样就完成了一台核心设备的简单配置
...</p></div><footer class=entry-footer><span title='2023-03-24 09:05:11 +0800 CST'>2023年3月24日</span></footer><a class=entry-link aria-label="post link to 核心交换机的配置过程" href=https://rendoumi.com/posts/20230324-huawei_switch/></a></article><div class=pagination><ul class=pagination-list><li class="page-item first"><a class=page-link href=/posts/ aria-label="First Page"><span aria-hidden=true>&#9668;</span></a></li><li class="page-item prev"><a class=page-link href=/posts/page/20/ aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a class=page-link href=/posts/page/17/>17</a></li><li class=page-item><a class=page-link href=/posts/page/18/>18</a></li><li class=page-item><a class=page-link href=/posts/page/19/>19</a></li><li class=page-item><a class=page-link href=/posts/page/20/>20</a></li><li class="page-item active"><span class=page-link aria-current=page>21</span></li><li class=page-item><a class=page-link href=/posts/page/22/>22</a></li><li class=page-item><a class=page-link href=/posts/page/23/>23</a></li><li class=page-item><a class=page-link href=/posts/page/24/>24</a></li><li class="page-item next"><a class=page-link href=/posts/page/22/ aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class="page-item last"><a class=page-link href=/posts/page/34/ aria-label="Last Page"><span aria-hidden=true>&#9658;</span></a></li></ul><div class=total-pages>共 34 页</div></div></main><footer class=footer><span>Copyright © 2020-2025 Zhang Ranrui. All Rights Reserved.</span><br>·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>