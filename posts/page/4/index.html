<!doctype html><html lang=zh dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3988508441804851" crossorigin=anonymous></script><title>æ‰€æœ‰æ–‡ç«  | å…«æˆ’çš„æŠ€æœ¯åšå®¢</title>
<meta name=keywords content><meta name=description content="æ‰€æœ‰æ–‡ç«  - å…«æˆ’çš„æŠ€æœ¯åšå®¢"><meta name=author content><link rel=canonical href=https://rendoumi.com/posts/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.5d8a858b4ad07d913988e10d3c3dbc8c171f45316a396de8a60d67f44840812d.css integrity="sha256-XYqFi0rQfZE5iOENPD28jBcfRTFqOW3opg1n9EhAgS0=" rel="preload stylesheet" as=style><link rel=icon href=https://rendoumi.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://rendoumi.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://rendoumi.com/favicon-32x32.png><link rel=apple-touch-icon href=https://rendoumi.com/apple-touch-icon.png><link rel=mask-icon href=https://rendoumi.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://rendoumi.com/posts/index.xml title=rss><link rel=alternate hreflang=zh href=https://rendoumi.com/posts/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://rendoumi.com/posts/"><meta property="og:site_name" content="å…«æˆ’çš„æŠ€æœ¯åšå®¢"><meta property="og:title" content="æ‰€æœ‰æ–‡ç« "><meta property="og:locale" content="zh"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="æ‰€æœ‰æ–‡ç« "><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"æ‰€æœ‰æ–‡ç« ","item":"https://rendoumi.com/posts/"}]}</script></head><body class=list id=top><header class=header><nav class=nav><div class=logo><a href=https://rendoumi.com/ accesskey=h title="å…«æˆ’çš„æŠ€æœ¯åšå®¢ (Alt + H)">å…«æˆ’çš„æŠ€æœ¯åšå®¢</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://rendoumi.com/ title=é¦–é¡µ><span>é¦–é¡µ</span></a></li><li><a href=https://rendoumi.com/posts/ title=æ–‡ç« ><span class=active>æ–‡ç« </span></a></li><li><a href=https://rendoumi.com/archives/ title=å½’æ¡£><span>å½’æ¡£</span></a></li><li><a href=https://blog.rendoumi.com title=ç”Ÿæ´»><span>ç”Ÿæ´»</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://rendoumi.com/search/ title=æœç´¢><span>æœç´¢</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>æ‰€æœ‰æ–‡ç« </h1></header><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>seaweedfsçš„s3è¿›é˜¶è¯•ç”¨æ–¹æ³•
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>SeaweedFS å·²ç»ç”¨docker composeçš„æ–¹å¼éƒ¨ç½²åœ¨ç”Ÿäº§ç¯å¢ƒå†…ä¸­äº†ï¼Œå¯¹å¤–åªå¼€æ”¾äº†ä¸€ä¸ªS3çš„ç«¯å£127.0.0.1:8333ï¼Œç„¶åå‰é¢å¥—ä¸ŠCaddyçš„httpsä»£ç†ï¼Œè¿™æ ·å¾ˆå®‰å…¨äº†ã€‚
é‚£è¿›é˜¶çš„è¦æ±‚åˆæ¥äº†ï¼š
ä¸€ã€S3çš„pre signedçš„URL ç”±äºç¨‹åºä¹‹å‰æ˜¯åœ¨AWSè·‘çš„ï¼Œæ‰€ä»¥ç”¨äº†S3çš„æœ€ä½³å®è·µï¼Œpre sign urlæ¥è¿›è¡Œä¸Šä¼ å’Œä¸‹è½½ï¼Œé‚£seaweedfsä¹Ÿæ˜¯å®Œå…¨æ”¯æŒçš„ï¼ŒåŸºæœ¬æ˜¯æ— ç¼ä¿®æ”¹
ç»™å‡ºéªŒè¯ç¨‹åºï¼š
import boto3 from botocore.client import Config # Configure the S3 client to point to your SeaweedFS S3 gateway s3_client = boto3.client( 's3', endpoint_url='https://s3.rendoumi.com', # Replace with your SeaweedFS S3 gateway address aws_access_key_id='aaaaaaaa', aws_secret_access_key='bbbbbbb', config=Config(signature_version='s3v4') ) bucket_name = 'myfiles' object_key = 'your-object-key' expiration_seconds = 3600 # URL valid for 1 hour # Generate a pre-signed URL for uploading (PUT) try: upload_url = s3_client.generate_presigned_url( 'put_object', Params={'Bucket': bucket_name, 'Key': object_key, 'ContentType': 'application/octet-stream'}, ExpiresIn=expiration_seconds ) print(f"Pre-signed URL for upload: {upload_url}") except Exception as e: print(f"Error generating upload URL: {e}") # Generate a pre-signed URL for downloading (GET) try: download_url = s3_client.generate_presigned_url( 'get_object', Params={'Bucket': bucket_name, 'Key': object_key}, ExpiresIn=expiration_seconds ) print(f"Pre-signed URL for download: {download_url}") except Exception as e: print(f"Error generating download URL: {e}") èƒ½çœ‹åˆ°ä¸´æ—¶ç”Ÿæˆçš„uploadçš„URLå’Œdownloadçš„URLï¼Œæ˜¯å®Œç¾æ”¯æŒçš„
...</p></div><footer class=entry-footer><span title='2025-09-17 09:01:11 +0800 CST'>2025å¹´9æœˆ17æ—¥</span></footer><a class=entry-link aria-label="post link to seaweedfsçš„s3è¿›é˜¶è¯•ç”¨æ–¹æ³•" href=https://rendoumi.com/posts/20250917-seaweedfs_prod/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Postgres pgbackrestå¤‡ä»½ä»¥åŠæŒ‡å®šæ—¶é—´ç‚¹æ¢å¤
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>æœ€è¿‘ç‹ æŠ˜è…¾äº†ä¸€é€špostgresçš„å¤‡ä»½ï¼Œè·ŸMySQLçš„é˜¿é‡ŒRDBæ¢å¤ä¸€æ ·ï¼Œå¦‚ä½•ä¸åœæ­¢æ•°æ®åº“æœåŠ¡ï¼Œæ¢å¤æŸä¸ªè¡¨çš„æ•°æ®åˆ°æŸä¸ªæ—¶é—´ç‚¹ï¼Œç„¶åæ”¾åˆ°å¦ä¸€ä¸ªè¡¨ä¸­å‘¢ï¼Ÿ
å…¶å®ç”¨ä¹‹å‰çš„walæ¢å¤ä¸€æ ·çš„ï¼Œå°±æ˜¯è¦æŠŠå½“å¤©å®ä¾‹çš„å…¨å¤‡ä»½å’Œwaléƒ½å¤åˆ¶åˆ°å¦å¤–ä¸€å°ä¸Šï¼Œç„¶åæ¢å¤ï¼Œå†æŠŠæ•°æ®ç»™dumpä¸‹æ¥ï¼Œå†å»ºä¸€ä¸ªæ–°è¡¨ï¼ŒæŠŠæ•°æ®å¯¼å›å»ã€‚
Postgresçš„walå’ŒPITRæ—¶é—´ç‚¹æ¢å¤
ç”¨pgbackrestæ„Ÿè§‰ä¼šå¥½ä¸€äº›ï¼Œå…¶å®éƒ½å·®ä¸å¤šï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š
ä¸€ã€å®‰è£…å¹¶é…ç½®pgbackrest apt install pgbackrest # å»ºç«‹å¤‡ä»½çš„å¤§æœ¬è¥ mkdir -p /var/lib/pgbackrest chmod 750 /var/lib/pgbackrest chown postgres:postgres /var/lib/pgbackrest # ç¼–è¾‘ /etc/pgbackrest.conf [global] repo1-path=/var/lib/pgbackrest repo1-retention-full=26 repo1-retention-archive=180 log-level-file=info log-level-console=info [global:archive-push] compress-level=3 [main] pg1-path=/var/lib/postgresql/13/main pg1-port=5432 è®²è§£ä¸€ä¸‹å‚æ•°
globalé‡Œé¢æ˜¯å…¨å±€é…ç½®
repo1-path=/var/lib/pgbackrest # pgBackRest å­˜å‚¨åº“è·¯å¾„ repo1-retention-full=26 # ä¿ç•™æœ€è¿‘çš„ 26 ä¸ªå…¨é‡å¤‡ä»½ï¼Œå¤§æ¦‚6ä¸ªæœˆï¼Œ180å¤© repo1-retention-archive=180 # ä¿ç•™æœ€è¿‘ 180 å¤©çš„ WAL æ—¥å¿— log-level-file=info # æ–‡ä»¶æ—¥å¿—çº§åˆ« log-level-console=info # æ§åˆ¶å°æ—¥å¿—çº§åˆ« global:archive-push è®¾ç½®çš„æ˜¯walå½’æ¡£çš„ä¿å­˜æ–¹å¼æ˜¯å‹ç¼©ä¿å­˜
mainéƒ¨åˆ†è®¾ç½®çš„æ˜¯è¦å¤‡ä»½çš„postgresæºçš„è·¯å¾„å’Œç«¯å£ï¼Œã€mainã€‘æ˜¯stanzaçš„åå­—
ä¸Šé¢çš„å¤‡ä»½å…¶å®æœ‰ä¸‰ç§å¤‡ä»½ï¼Œfullå’Œincrå’Œwalå¤‡ä»½ï¼Œé‚£å¦‚æœfullå’Œå¢é‡éƒ½æ²¡äº†ï¼Œåªè¦walè¿˜åœ¨ï¼Œé‚£ä¹ˆä¾ç„¶èƒ½æ¢å¤åˆ°180å¤©ä¹‹å†…çš„æŸä¸ªæ—¶é—´ç‚¹ã€‚walå¾ˆå ç©ºé—´ï¼Œfullä¹Ÿå¾ˆå ç©ºé—´ï¼Œä¸€å®šè¦ç®—å‡†äº†ã€‚
é‚£å…¶å®pgbackrestæ˜¯ç”¨postgresèº«ä»½å»æ‰§è¡Œå‘½ä»¤çš„ï¼Œæ‰€ä»¥ä¸ç”¨è®¤è¯èº«ä»½ã€‚
äºŒã€é…ç½®postgres vi /etc/postgresql/13/main/postgresql.conf # walå½’æ¡£æ–¹æ³•ï¼š #archive_mode = on #archive_command = 'cp %p /data/backup/%f' # pgbackrestå½’æ¡£æ–¹æ³•ï¼š archive_mode = on archive_command = 'pgbackrest --stanza=main archive-push %p' wal_level = replica #å¤‡ä»½çº§åˆ«æ˜¯å‰¯æœ¬ max_wal_senders = 3 #æœ€å¤šwalæ—¥å¿—å‘åˆ°3ä¸ªå®¢æˆ·ç«¯å» # éœ€è¦é‡å¯postgres systemctl restart postgresql ä¸‰ã€æµ‹è¯•pgbackrestçš„å¤‡ä»½åŠŸèƒ½ # å»ºç«‹ä¸€ä¸ªstanza sudo -u postgres pgbackrest --stanza=main --log-level-console=info stanza-create # æ£€æŸ¥ sudo -u postgres pgbackrest --stanza=main --log-level-console=info check # æŸ¥çœ‹ä¿¡æ¯ sudo -u postgres pgbackrest info ...</p></div><footer class=entry-footer><span title='2025-09-15 10:01:11 +0800 CST'>2025å¹´9æœˆ15æ—¥</span></footer><a class=entry-link aria-label="post link to Postgres pgbackrestå¤‡ä»½ä»¥åŠæŒ‡å®šæ—¶é—´ç‚¹æ¢å¤" href=https://rendoumi.com/posts/20250915-pgbackrest_restore/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>seaweed S3æœåŠ¡å•æœºç‰ˆæ­£å¼ç¯å¢ƒçš„éƒ¨ç½²
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>å…¬å¸è¦åšç³»ç»Ÿè¿ç§»ï¼Œä»AWSè¿ç§»åˆ°è‡ªå»ºæœºæˆ¿ï¼Œé‚£è¿ç§»çš„é¡¹ç›®å°±ä¸€å¤§å †ï¼ŒS3ä¹Ÿåœ¨å…¶ä¸­ä¹‹åˆ—ã€‚
æ‰¾æ¥æ‰¾å»ï¼Œç¬¬ä¸€é¦–é€‰çš„æ›¿ä»£è½¯ä»¶æ˜¯minioï¼Œå¯æ˜¯ä¸‡æ¶çš„minioå›¢é˜Ÿåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ï¼Œå·²ç»åå°ç§»é™¤äº† admin ç›¸å…³çš„æ“ä½œæƒé™
è¦æƒ³ç”¨å‘¢ï¼Œåªèƒ½ç”¨ä¸ªè€ç‰ˆæœ¬çš„ï¼šquay.io/minio/minio:RELEASE.2025-04-22T22-12-26Z
é‚£åªèƒ½å†æ‰¾äº†ï¼Œäºæ˜¯æ‰¾åˆ°äº†SeaweedFSï¼Œè¿™ä¸ªè½¯ä»¶å…¶å®æ˜¯ä¸ªå½»å¤´å½»å°¾çš„å•æ–‡ä»¶ï¼Œä½†æ˜¯åˆ†å¸ƒå¼å…¨é›†ç¾¤æ¶æ„
ç®€å•çš„è¯´ï¼Œå°±æ˜¯ä¸€ä¸ªè½¯ä»¶ï¼ŒåŒ…å«äº†10å‡ ç§åŠŸèƒ½ã€‚
è€Œæˆ‘ä»¬å‘¢ï¼Œå…¶å®å°±è¦å®ƒçš„ä¸€ä¸ªåŠŸèƒ½s3ï¼Œè€Œä¸”è¦ç”¨äºç”Ÿäº§ã€‚ç½‘ä¸Šä¸€å¤§å †çš„æ•™ç¨‹éƒ½æ˜¯å„ç§åˆ†å¸ƒå¼çš„éƒ¨ç½²ï¼Œå¦‚æœæœºå™¨è¶³å¤Ÿï¼Œå¤§å®¶å¯ä»¥å‚è€ƒç½‘ä¸Šæ•™ç¨‹ã€‚
æˆ‘ä»¬å•å°æœºå™¨ï¼Œç¡¬ç›˜åº•å±‚æ˜¯raid10ï¼Œç„¶åä¸Šå±‚å°±åªæä¾›s3ï¼Œè€Œä¸”è¦é…ç½®ç®€å•ï¼Œæ²¡æœ‰ä»€ä¹ˆå®‰å…¨é—®é¢˜ï¼Œè¿™å°æœºå™¨æ˜¯ç›´æ¥æš´éœ²å…¬ç½‘IPçš„ã€‚
é‚£æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯Docker composeï¼Œè€Œä¸”åªæ”¾å¼€s3çš„æŒ‡å®šç«¯å£ï¼š
services: seaweedfs-s3: image: chrislusf/seaweedfs container_name: seaweedfs-s3 volumes: - ./data:/data - ./config/config.json:/seaweedfs/config.json ports: - "127.0.0.1:8333:8333" # - "9333:9333" entrypoint: /bin/sh -c command: | "echo 'Starting SeaweedFS S3 server' && \ weed server -dir=/data -volume.max=120 -s3 -s3.config /seaweedfs/config.json" restart: unless-stopped ä»”ç»†è§£é‡Šä¸Šé¢çš„å‚æ•°ï¼š
ports åªå¼€äº† 127.0.0.1:8333 çš„S3ç«¯å£ï¼Œå…¶å®ƒéƒ½ä¸å¼€ï¼Œå¦‚æœéœ€è¦æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼Œå¯ä»¥ä¸´æ—¶æ‰“å¼€9333ç«¯å£æŸ¥çœ‹ï¼Œçœ‹å®Œå†å…³ -volume.max=120ï¼Œè¿™ä¸ªåŠ¡å¿…è¦æ³¨æ„ï¼Œseaweedæ˜¯åˆ†å·çš„ï¼Œä¸€ä¸ªå·æœ€å¤š30Gï¼Œç¼ºçœæ˜¯8ä¸ªå·ã€‚é‚£ç¼ºçœå°±æ˜¯åªæœ‰240Gçš„å®¹é‡ï¼Œæˆ‘ä»¬çš„ç¡¬ç›˜æ˜¯4Tçš„ï¼Œå‰©ä½™3.7TBï¼Œé‚£ç®—ä¸‹æ¥ï¼Œ30*120=3600G=3.6Tã€‚è¿™æ ·å°±å¯¹å‡†äº†ï¼Œè¿™ä¸ªå‚æ•°ä¸€å®šè¦æ ¹æ®ç”Ÿäº§çš„å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´. å¦å¤–è¿˜æŠŠconfig.jsonçš„é…ç½®æ–‡ä»¶ç»™mountå…¥dockerå·ä¸­äº†ï¼Œé…ç½®æ–‡ä»¶é‡Œæ”¾çš„å°±æ˜¯S3çš„IAMè®¿é—®æƒé™æ§åˆ¶ è¯¦ç»†çœ‹ä¸€ä¸‹config.json
{ "identities": [ { "name": "admin", "credentials": [ { "accessKey": "aaa", "secretKey": "bbb" } ], "actions": [ "Admin", "Read", "List", "Tagging", "Write" ] }, { "name": "goods", "credentials": [ { "accessKey": "ccc", "secretKey": "ddd" } ], "actions": [ "Read:goods", "Write:goods", "List:goods", "Tagging:goods", "Admin:goods" ] } ] } è§£é‡Šä¸€ä¸‹ï¼Œä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªadminç”¨æˆ·ï¼Œå¯ä»¥å¯¹æ‰€æœ‰s3è¿›è¡Œè¯»å†™å’Œç®¡ç†ã€‚
...</p></div><footer class=entry-footer><span title='2025-09-15 09:01:11 +0800 CST'>2025å¹´9æœˆ15æ—¥</span></footer><a class=entry-link aria-label="post link to seaweed S3æœåŠ¡å•æœºç‰ˆæ­£å¼ç¯å¢ƒçš„éƒ¨ç½²" href=https://rendoumi.com/posts/20250915-seeweed_single_deploy/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>ç”Ÿäº§ç¯å¢ƒElasticsearch 8å•èŠ‚ç‚¹Docker-composeçš„å®‰è£…æ–¹æ³•
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>è¦åœ¨ç”Ÿäº§ç¯å¢ƒå»ºä¸€å¥—Elasticsearch 8.0ï¼Œå•èŠ‚ç‚¹æ­é…Kibanaï¼Œç¡®å®æ˜¯å›°éš¾é‡é‡ï¼Œæ–°ç‰ˆæœ¬éœ€è¦TLSéªŒè¯äº†
ç°åœ¨è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹ï¼Œ2025å¹´9æœˆ2æ—¥ï¼ŒElasticsearchæœ€æ–°ç‰ˆæœ¬æ˜¯9.0ï¼Œåæ’¤2ä¸ªç‰ˆæœ¬æ˜¯8.18.6
é‚£å°±ç”¨è¿™ä¸ªç‰ˆæœ¬äº†ï¼Œç„¶åæ ¹æ®å®˜æ–¹çš„æ–‡æ¡£ä¼šæŠŠäººæç³Šæ¶‚çš„ã€‚
æ­£ç¡®çš„æ–¹æ³•å¦‚ä¸‹ï¼š
ä¸€ã€å»ºç«‹è‡ªç­¾çš„è¯ä¹¦ å…¶å®å¯ä»¥ç”¨ACMEçš„è¯ä¹¦ï¼Œä½†æ˜¯æ²¡æœ‰äººä¼šä¸‰ä¸ªæœˆå°±å»é‡å¯ä¸€ä¸‹ESçš„å®¹å™¨ï¼Œæ›´æ–°è¯ä¹¦å§ï¼
é‚£åªèƒ½é€‰æ‹©è‡ªå»ºCAï¼Œè‡ªç­¾ä¸€ä¸ªè¯ä¹¦äº†ï¼
å› ä¸ºæœ‰2ä¸ªpodï¼Œeså’Œkibanaï¼Œæ‰€ä»¥è¦ç­¾ä¸¤å¼ è¯ä¹¦ï¼Œç­¾è¯ä¹¦éšä¾¿ç”¨ESçš„ä¸€ä¸ªç‰ˆæœ¬å°±å¯ä»¥ï¼š
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.4.1-linux-x86_64.tar.gz tar -zxf elasticsearch-8.4.1-linux-x86_64.tar.gz cd elasticsearch-8.4.1/ ./bin/elasticsearch-certutil ca --pem # å¾—åˆ°CAè¯ä¹¦ï¼Œæ”¾åœ¨å½“å‰ç›®å½•caç›®å½•ä¸‹ unzip elastic-stack-ca.zip # ç”Ÿæˆç­¾å‘é…ç½®æ–‡ä»¶ cat &lt;&lt; EOF >instances.yml instances: - name: es01 dns: - es01 - localhost ip: - 127.0.0.1 - name: kibana dns: - kibana - localhost ip: - 127.0.0.1 EOF # ç­¾å‘2ä¸ªpodçš„è¯ä¹¦ ./bin/elasticsearch-certutil cert --ca-cert ca/ca.crt --ca-key ca/ca.key --pem --in instances.yml # å¾—åˆ°2å¼ è¯ä¹¦å’Œkey unzip certificate-bundle.zip # ç”Ÿæˆä¸¤ä¸ªç›®å½•ï¼Œes01å’Œkibana # å‡†å¤‡å¥½è¯ä¹¦ç›®å½• mkdir -p /data/elasticsearch/certs mv ca es01 kibana /data/elasticsearch/certs # å‡†å¤‡å¥½æŒä¹…åŒ–å· mkdir -p /data/elasticsearch/kibanadata mkdir -p /data/elasticsearch/esdata01 äºŒã€é…ç½®docker-compose.yaml 8.18.6ç‰ˆæœ¬çš„docker-compose.yamlæ–‡ä»¶ï¼Œä½äºï¼š/data/elasticsearch/docker-compose.yaml
...</p></div><footer class=entry-footer><span title='2025-09-02 09:01:11 +0800 CST'>2025å¹´9æœˆ2æ—¥</span></footer><a class=entry-link aria-label="post link to ç”Ÿäº§ç¯å¢ƒElasticsearch 8å•èŠ‚ç‚¹Docker-composeçš„å®‰è£…æ–¹æ³•" href=https://rendoumi.com/posts/20250902-elasticsearch_single_node_8_setup/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>AWSæ‰˜ç®¡çš„Valkeyæ•°æ®è½¬ç§»åˆ°ç¤¾åŒºRedis.ioå»
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>è¿™è¿˜çœŸæ˜¯ä¸ªå¤§æ´»ï¼Œè€—è´¹äº†æ•´æ•´ä¸€å¤©çš„æ—¶é—´ã€‚
ç©¶å…¶åŸå› æ ¹æœ¬å°±æ˜¯æ— è®ºAWSæ‰˜ç®¡çš„Valkeyè¿˜æ˜¯ç¤¾åŒºçš„Redis.ioï¼Œéƒ½æ˜¯è¢«é­”æ”¹è¿‡çš„é˜‰å‰²ç‰ˆï¼ŒçœŸæ˜¯æ— è¯­ä»–å¦ˆç»™æ— è¯­å¼€é—¨ï¼Œæ— è¯­åˆ°å®¶äº†ï¼
è¯´ä¸€ä¸‹è¯¦ç»†çš„è¿‡ç¨‹ï¼š
æ¥åˆ°è¿™ä¸ªä»»åŠ¡ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯åŒæ­¥è½¯ä»¶redis-Gunyu
https://github.com/mgtv-tech/redis-GunYu
ç»“æœæ˜¯å¤±è´¥ï¼ŒåŸå› å¾ˆå¥‡è‘©ï¼Œå› ä¸ºaws valkeyæ˜¯å¿…é¡»å¸¦tlsè¿æ¥çš„ï¼ŒGunyuä¸æ”¯æŒï¼Œæ”¾å¼ƒã€‚
ç„¶åæ‰¾åˆ°äº†redis-shake
https://tair-opensource.github.io/RedisShake
ç»“æœè¿˜æ˜¯å¤±è´¥ï¼Œç†ç”±æ˜¯ä¸æ”¯æŒPSyncï¼Œç”¨äº†scan_readerä¹Ÿå¤±è´¥
ç„¶åå°±åˆæƒ³åˆ°äº†ä¸‡èƒ½çš„ChatGPTå’ŒGoogleçš„Geminiï¼Œåˆ†åˆ«ç»™äº†2ä¸ªpythonç¨‹åºï¼Œä¹Ÿæ˜¯å¤±è´¥
åŸå› æ˜¯ä¸æ”¯æŒMigrateå‘½ä»¤ï¼Œè€Œä¸”valkeyæ˜¯åŸºäºredis 7.2æ”¹çš„ï¼Œè€ŒRedis.ioæ˜¯8.0ï¼Œå‘½ä»¤ä¸å…¼å®¹
èµ°æŠ•æ— è·¯ä¹‹ä¸‹æƒ³åˆ°äº†rdb-toolsï¼Œå…ˆæŠŠvalkeyåšä¸ªå¤‡ä»½ï¼Œæ”¾åˆ°S3æ¡¶é‡Œ
valeky-20250819-0001.rdb valeky-20250819-0002.rdb valeky-20250819-0003.rdb valeky-20250819-0004.rdb valeky-20250819-0005.rdb valeky-20250819-config.json cat valeky-20250819-config.json { "valeky-20250819/valeky-20250819-0002.rdb" : { "Slots" : "0-5496", "rdbSize" : "5234516" }, "valeky-20250819/valeky-20250819-0004.rdb" : { "Slots" : "5497-8375", "rdbSize" : "4340658" }, "valeky-20250819/valeky-20250819-0003.rdb" : { "Slots" : "10082-16383", "rdbSize" : "5962581" }, "valeky-20250819/valeky-20250819-0001.rdb" : { "Slots" : "8376", "rdbSize" : "2218" }, "valeky-20250819/valeky-20250819-0005.rdb" : { "Slots" : "8377-10081", "rdbSize" : "1540505" } } çœ‹èµ·æ¥æ˜¯5ä¸ªrdbå¤‡ä»½ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”redisä¸åŒçš„slots
ç”¨rdbæ¥è§£æå¤‡ä»½æ–‡ä»¶ï¼Œç»“æœå¤±è´¥ï¼Œå› ä¸ºä¸è®¤è¯†valkey rdbçš„ç‰ˆæœ¬ã€‚
æ²¡åŠæ³•äº†ï¼Œåˆæ‰¾åˆ°äº†è¿™ä¸ªè½¯ä»¶
https://github.com/HDT3213/rdb
ä¸‹è½½åï¼Œé¦–å…ˆæƒ³å¤„ç†æˆjsonæ–‡ä»¶ï¼Œç„¶åçŒå…¥åˆ°redis.io
./rdb-linux-amd64 -c json -o 0001.json valeky-20250819-0001.rdb å¤±è´¥ï¼Œå› ä¸ºjsonæ–‡ä»¶çŒå…¥çš„æ—¶å€™redis.ioåˆè¢«é˜‰å‰²äº†ï¼Œå‘½ä»¤ä¸æ”¯æŒ
...</p></div><footer class=entry-footer><span title='2025-08-20 09:01:11 +0800 CST'>2025å¹´8æœˆ20æ—¥</span></footer><a class=entry-link aria-label="post link to AWSæ‰˜ç®¡çš„Valkeyæ•°æ®è½¬ç§»åˆ°ç¤¾åŒºRedis.ioå»" href=https://rendoumi.com/posts/20250820-aws_valkey_to_redis_io/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Ocserv VPNçš„å®‰è£…å’Œä½¿ç”¨
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>ç”±äºiosçš„openvpnå¤§é™†åœ°åŒºæ— æ³•å®‰è£…ï¼Œè€Œå‘˜å·¥åˆéœ€è¦æ‰‹æœºæˆ–PCç™»å½•VPNè®¿é—®äº‘ä¸Šçš„èµ„æºï¼Œæ²¡åŠæ³•ï¼Œæ‰¾äº†åˆæ‰¾ï¼Œç»ˆäºï¼Œå‘ç°ciscoçš„vpnè¿˜æ˜¯èƒ½åœ¨è‹¹æœå¸‚åœºä¸‹è½½å®‰è£…çš„ï¼Œé‚£å°±è£…ä¸ªå¼€æºçš„Ocservå§ï¼Œåˆ«è¯´è¿˜æŒºå¥½ï¼Œèƒ½åˆ†ç»„æ§åˆ¶è·¯ç”±çš„å‘å¸ƒï¼Œéå¸¸ä¸é”™
è®°å½•ä¸€ä¸‹å®‰è£…é…ç½®è¿‡ç¨‹ï¼Œä½¿ç”¨Ubuntu 24.04çš„åº•ç‰ˆï¼š
apt update apt upgrade apt-cache show ocserv apt-get install -y ocserv ocserv --version å®‰è£…æ­¥éª¤å°±å¦‚ä¸Šï¼Œéå¸¸ç®€å•ï¼Œè·Ÿopenvpnä¸€æ ·ï¼Œé…ç½®æ–‡ä»¶å°±ä¸€ä¸ª /etc/ocserv/ocserv.conf, ç¼–è¾‘ä¸€ä¸‹ï¼š
# è®¤è¯æ–¹å¼ä¸ºç”¨æˆ·åå¯†ç è®¤è¯ auth = "plain[passwd=/etc/ocserv/passwd]" # å¼€æ”¾ç«¯å£ tcp-port = 443 udp-port = 443 # è¯ä¹¦ server-cert = /etc/ocserv/_.rendoumi.com.crt server-key = /etc/ocserv/_.rendoumi.com.key # æœ€å¤šç”¨æˆ·æ•° max-clients = 1024 # ç»‘å®šåŸŸå default-domain = m.rendoumi.com # åˆ†é…çš„åŠ¨æ€ipæ®µ ipv4-network = 10.8.12.0 ipv4-netmask = 255.255.255.0 # ä¸è·¯ç”± no-route = 10.0.0.0/255.0.0.0 no-route = 172.16.0.0/255.240.0.0 no-route = 192.168.0.0/255.255.0.0 # å‘å¸ƒè·¯ç”± route = 10.8.2.15/32 route = 10.10.247.234/32 route = 10.10.240.37/32 è¯´æ˜ï¼šç«¯å£å¼€åœ¨äº†443ç«¯å£ï¼Œè¯ä¹¦ç”¨çš„æ˜¯acmeçš„å…è´¹è¯ä¹¦ï¼ŒåŸŸåæ˜¯m.rendoumi.comï¼Œipæ®µæ˜¯10.8.12.0/24
...</p></div><footer class=entry-footer><span title='2025-08-19 09:01:11 +0800 CST'>2025å¹´8æœˆ19æ—¥</span></footer><a class=entry-link aria-label="post link to Ocserv VPNçš„å®‰è£…å’Œä½¿ç”¨" href=https://rendoumi.com/posts/20250819-oserv_vpn/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Vaultä½¿ç”¨AWSçš„federation_tokenè¿›è¡Œäº¤äº’
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>Vaultçš„ä½¿ç”¨ç»§ç»­æ·±å…¥ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯å…ˆæ‹¿åˆ°valutçš„root tokenï¼Œç„¶åç™»å½•è®¾ç½®awsçš„è®¤è¯ï¼ŒåŒæ—¶æŠŠawsçš„iam rootå‡­æ®çŒè¿›å»ï¼Œç„¶åwriteè¿›è¡Œè®ºè½¬ï¼Œè¿™æ ·å‡­æ®å°±åªå­˜åœ¨äºvaultä¹‹ä¸­äº†ï¼Œæ²¡æœ‰æ³„éœ²çš„å¯èƒ½ã€‚ç„¶åä»è¿™ä¸ªrootå‡­æ®å†æ´¾ç”Ÿæˆå„ç§ä½¿ç”¨æ—¶é•¿æœ‰é™åˆ¶çš„ä¸´æ—¶å‡­æ®ç”¨ã€‚
ä½†æ˜¯ï¼Œå˜¿å˜¿ï¼Œæˆ‘ååæ²¡æœ‰rootå‡­æ®ï¼Œå› ä¸ºæˆ‘æ˜¯å¤–é¢ç®¡ç†å‘˜ã€‚åªèƒ½ç”¨ federation_token è¿›è¡Œç™»å½•ã€‚
é‚£æ€ä¹ˆä½¿ç”¨å‘¢ï¼Ÿæ–¹æ³•å¦‚ä¸‹ï¼š
é¦–å…ˆåœ¨AWSçš„IAMå»ºç«‹ä¸¤ä¸ªpolicy
# Federator çš„policyï¼Œç”¨äºè·å¾—token { "Version": "2012-10-17", "Statement": [ { "Sid": "VisualEditor0", "Effect": "Allow", "Action": "sts:GetFederationToken", "Resource": "*" } ] } # Change-self-access-keys çš„policyï¼Œç”¨äºè½®è½¬key { "Version": "2012-10-17", "Statement": [ { "Effect": "Allow", "Action": [ "iam:ListUsers", "iam:GetAccountPasswordPolicy" ], "Resource": "*" }, { "Effect": "Allow", "Action": [ "iam:*AccessKey*", "iam:GetUser" ], "Resource": [ "arn:aws:iam::*:user/${aws:username}" ] } ] } ç„¶ååœ¨Vaultä¸­è®¾ç½®ä½¿ç”¨AWS secrets
vault secrets enable aws # awsä¸­éœ€è¦å¯¹åº”IAMçš„æƒé™ # è¦ä¹ˆæ˜¯çœŸæœ‰aws iamçš„ç”¨æˆ·ï¼›è¦ä¹ˆæ˜¯æœ‰ä¸€ä¸ªroleï¼Œå’Œå¯¹åº”çš„ä¸´æ—¶ç”¨æˆ·ï¼›äºŒé€‰ä¸€ vault write aws/config/root access_key=YYY \ secret_key=XXX region=us-east-1 \ sts_endpoint=https://sts.us-east-1.amazonaws.com sts_region=us-east-1 # è½®è½¬rootå‡­æ®ï¼Œè¿™æ ·rootå‡­æ®å°±åªå­˜åœ¨äºvaultä¸­äº† vault write -force aws/config/rotate-root ä½¿ç”¨æ–¹æ³•ï¼š
...</p></div><footer class=entry-footer><span title='2025-08-18 09:12:11 +0800 CST'>2025å¹´8æœˆ18æ—¥</span></footer><a class=entry-link aria-label="post link to Vaultä½¿ç”¨AWSçš„federation_tokenè¿›è¡Œäº¤äº’" href=https://rendoumi.com/posts/20250818-vault_sts_token/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>vaultä½¿ç”¨external secretç®¡ç†kubernetes secret
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>ä»Šå¤©æ˜¯2025å¹´8æœˆ15æ—¥ï¼Œå¤§å™©è€—å•Šï¼š external-secrets / external-secrets Link
â­ 5416 | ğŸ”€ 1032 | Go 97.6%
External Secrets Operator é¡¹ç›®æš‚åœå‘å¸ƒ ç”±äºç»´æŠ¤å›¢é˜Ÿè§„æ¨¡è¿‡å°ï¼ŒExternal Secrets Operator å†³å®šæš‚åœæ‰€æœ‰å®˜æ–¹ç‰ˆæœ¬å‘å¸ƒï¼Œç›´åˆ°é‡å»ºè¶³å¤Ÿçš„ç»´æŠ¤å›¢é˜Ÿã€‚
Key Takeaways é¡¹ç›®æš‚åœæ‰€æœ‰å®˜æ–¹ç‰ˆæœ¬å‘å¸ƒï¼ŒåŒ…æ‹¬æ–°åŠŸèƒ½ã€è¡¥ä¸å’Œå®¹å™¨é•œåƒã€‚ å°†ç»§ç»­å®¡æ ¸å’Œåˆå¹¶ç¤¾åŒºçš„ PRï¼Œä½†ä¸ä¼šæä¾› GitHub Discussionsã€Slack æˆ–é—®é¢˜è¯„è®ºçš„æ”¯æŒã€‚ éœ€è¦è‡³å°‘äº”åé•¿æœŸç»´æŠ¤è€…æ¥ç¡®ä¿é¡¹ç›®çš„å¯æŒç»­å‘å±•ã€‚ é¼“åŠ±ä¾èµ–è¯¥é¡¹ç›®çš„å…¬å¸æˆ–å›¢é˜Ÿç§¯æå‚ä¸è´¡çŒ®ã€‚ è´¡çŒ®è€…å¯é€šè¿‡å¡«å†™è¡¨å•æˆ–æŸ¥çœ‹æ²»ç†æ–‡æ¡£åŠ å…¥é¡¹ç›®ã€‚ å±…ç„¶æš‚åœå‘å¸ƒäº†ï¼Œé‚£å°±æŠ“ç´§æ—¶é—´æŠŠVaultè·Ÿå®ƒçš„é›†æˆè®°å½•ä¸‹æ¥ï¼š
ä¸€ã€é¦–å…ˆå¿…é¡»åœ¨é›†ç¾¤é‡Œå®‰è£…Vaultï¼Œç„¶åå®‰è£…external -secretsï¼Œéƒ½ç”¨helmè£…å³å¯ helm repo add hashicorp https://helm.releases.hashicorp.com helm repo update helm install vault hashicorp/vault --set "server.dev.enabled=true" --set "injector.enabled=true" --namespace default helm repo add external-secrets https://charts.external-secrets.io helm repo update helm install external-secrets external-secrets/external-secrets --namespace external-secrets --create-namespace --set installCRDs=true äºŒã€k8sæˆæƒï¼Œk8çš„æˆæƒä½“ç³»å°±æ˜¯ sa -> role -> rolebinding é‚£kubernetesä¼šæŠŠpodä¸­saçš„Tokenæ³¨å…¥åˆ°æ–‡ä»¶ï¼š/var/run/secrets/kubernetes.io/serviceaccount/token
...</p></div><footer class=entry-footer><span title='2025-08-15 09:01:11 +0800 CST'>2025å¹´8æœˆ15æ—¥</span></footer><a class=entry-link aria-label="post link to vaultä½¿ç”¨external secretç®¡ç†kubernetes secret" href=https://rendoumi.com/posts/20250815-vault_k8s/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>k3sçš„å®‰è£…
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>è¿™ç¯‡æ˜¯ä¸€ä¸ªå¤§æ°´è´´ï¼Œåªæ˜¯ä¸ºäº†è®°å½•k3sçš„å®‰è£…
è¿™ä¸ªä¸œè¥¿è¢«Rancherç”¨å¾—çº¯ç†Ÿï¼Œå…ˆæ­å»ºä¸€ä¸ªk3sé›†ç¾¤ï¼Œç„¶åå†å…¶ä¸Šè£…æ§åˆ¶è½¯ä»¶ï¼Œå†å»æ§åˆ¶å…¶å®ƒé›†ç¾¤ï¼Œéå¸¸å¥½çš„æƒ³æ³•ï¼Œå€¼å¾—å€Ÿé‰´
å®‰è£…å’Œåˆ é™¤éƒ½éå¸¸ç®€æ´ï¼Œå‡†å¤‡å·¥ä½œï¼š
apt update && apt upgrade -y # ä¸‰å°æœºå™¨åˆ†åˆ«è®¾ç½® hostnamectl set-hostname master hostnamectl set-hostname worker-1 hostnamectl set-hostname worker-2 # vi /etc/hosts 127.0.0.1 master # ä¸¤å¤–ä¸¤å°ä¹Ÿåˆ†åˆ«è®¾ç½® 127.0.0.1 worker-1 # ç¬¬3å° 127.0.0.1 worker-2 å‡†å¤‡å·¥ä½œéƒ½å¼„å¥½äº†ã€‚ä¸‹é¢å®‰è£…
curl -sfL https://get.k3s.io | sh - systemctl status k3s cat /var/lib/rancher/k3s/server/node-token # åŠ å…¥æ–°èŠ‚ç‚¹ curl -sfL https://get.k3s.io | K3S_URL=https://192.168.0.200:6443 K3S_TOKEN=&lt;your-token-here> INSTALL_K3S_EXEC="--node-ip=&lt;worker-ip>" sh - åˆ é™¤ä¹Ÿå°±ä¸€å¥
/usr/local/bin/k3s-uninstall.sh å¯ä»¥åå¤è¿›è¡Œå®‰è£…</p></div><footer class=entry-footer><span title='2025-08-08 09:11:11 +0800 CST'>2025å¹´8æœˆ8æ—¥</span></footer><a class=entry-link aria-label="post link to k3sçš„å®‰è£…" href=https://rendoumi.com/posts/20250808-k3s_install/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>æ¬§æ‹‰PageCacheçš„å†…æ ¸ç¼–è¯‘
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>æ¬§æ‹‰ Page Cache çš„å†…æ ¸ç¼–è¯‘ PageCacheæä¾›äº†ä¸€ç§é™åˆ¶page cacheçš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿå¯¹page cacheçš„æ€»é‡è¿›è¡Œæ§åˆ¶, å¢å¼ºç³»ç»Ÿåœ¨æ•°æ®åº“ç­‰page cacheå æ¯”è¾ƒé«˜åœºæ™¯ä¸‹çš„ç¨³å®šæ€§ï¼Œç§¯æé‡Šæ”¾ç¼“å­˜ã€‚
å®ƒæä¾›äº†ä»¥ä¸‹sysctlæ¥å£ï¼š
vm.pagecache_limit_ratioï¼špagecacheå ç³»ç»Ÿæ€»å†…å­˜çš„ç™¾åˆ†æ¯”ï¼Œ[0, 100]ï¼Œ0å’Œ100éƒ½è¡¨ç¤ºåŠŸèƒ½å…³é—­ã€‚ vm.pagecache_limit_reclaim_ratioï¼šé’ˆå¯¹pagecacheçœŸå®å›æ”¶çš„æ¯”ä¾‹ï¼Œåœ¨å®é™…å›æ”¶æ—¶ï¼Œæ€»æ˜¯æ¯”pagecache_limit_ratioçš„å¤šå›æ”¶ä¸€äº›ï¼Œé»˜è®¤æ¯”ä¾‹æ˜¯2%ã€‚ vm.pagecache_limit_ignore_dirtyï¼šåœ¨å›æ”¶æ—¶æ˜¯å¦å¿½ç•¥è„é¡µï¼Œé»˜è®¤å¿½ç•¥ã€‚å› ä¸ºå¯¹è„é¡µçš„å›æ”¶è¾ƒè€—æ—¶ã€‚ è¡¥ä¸æ˜¯åŸºäº openEuler-22.03-LTS çš„ï¼Œä¸é€‚ç”¨äº 24.03-LTSï¼Œä»£ç éƒ½å·²ä¸åŒäº†
ç¼–è¯‘è¿‡ç¨‹å¦‚ä¸‹ï¼š
ä¸€ã€å®‰è£…å¥½openEuler-22.03-LTSï¼Œç£ç›˜ç•™å¤Ÿç©ºé—´ï¼Œæœ€å°‘ç•™20G
äºŒã€å®‰è£…ç¼–è¯‘å·²ç»æ‰€éœ€è½¯ä»¶
dnf install -y rpm-build openssl-devel bc rsync gcc gcc-c++ flex bison m4 elfutils-libelf-devel dnf install -y python dnf install -y ncurses-devel dnf install -y dwarves ä¸‰ã€å®‰è£…å†…æ ¸æºä»£ç 
dnf install -y kernel-source ç°åœ¨æ˜¯2024å¹´11æœˆ4æ—¥ï¼Œå†…æ ¸ç‰ˆæœ¬æ˜¯ linux-5.10.0-60.139.0.166.oe2203.x86_64ï¼Œæ³¨æ„è¡¥ä¸çš„é€‚ç”¨èŒƒå›´
å››ã€æ‰“è¡¥ä¸
page.patch
å°†page.patch æ”¾åˆ° /usr/src
cd /usr/src/linux-5.10.0-60.139.0.166.oe2203.x86_64 patch -p1 &lt; ../page.patch äº”ã€ç¼–è¾‘å†…æ ¸ç‰ˆæœ¬å·ï¼ŒEXTRAVERSIONçš„ç‰ˆæœ¬å·è¦å¤§äºå½“å‰å†…æ ¸ç‰ˆæœ¬ï¼Œå¦åˆ™æ— æ³•å®‰è£…ã€‚å½“å‰æ˜¯166ï¼Œæ”¹æˆ+1ï¼Œ167
cd /usr/src/linux-5.10.0-60.139.0.166.oe2203.x86_64 vi Makefile # SPDX-License-Identifier: GPL-2.0 VERSION = 5 PATCHLEVEL = 10 SUBLEVEL = 0 EXTRAVERSION = -60.139.0.167.oe2203.x86_64 NAME = Kleptomaniac Octopus OPENEULER_MAJOR = 2203 OPENEULER_MINOR = 0 å…­ã€ç¼–è¯‘
...</p></div><footer class=entry-footer><span title='2025-08-08 09:01:11 +0800 CST'>2025å¹´8æœˆ8æ—¥</span></footer><a class=entry-link aria-label="post link to æ¬§æ‹‰PageCacheçš„å†…æ ¸ç¼–è¯‘" href=https://rendoumi.com/posts/20250808-openeuler_pagecache/></a></article><div class=pagination><ul class=pagination-list><li class="page-item first"><a class=page-link href=/posts/ aria-label="First Page"><span aria-hidden=true>&#9668;</span></a></li><li class="page-item prev"><a class=page-link href=/posts/page/3/ aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a class=page-link href=/posts/>1</a></li><li class=page-item><a class=page-link href=/posts/page/2/>2</a></li><li class=page-item><a class=page-link href=/posts/page/3/>3</a></li><li class="page-item active"><span class=page-link aria-current=page>4</span></li><li class=page-item><a class=page-link href=/posts/page/5/>5</a></li><li class=page-item><a class=page-link href=/posts/page/6/>6</a></li><li class=page-item><a class=page-link href=/posts/page/7/>7</a></li><li class=page-item><a class=page-link href=/posts/page/8/>8</a></li><li class="page-item next"><a class=page-link href=/posts/page/5/ aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class="page-item last"><a class=page-link href=/posts/page/36/ aria-label="Last Page"><span aria-hidden=true>&#9658;</span></a></li></ul><div class=total-pages>å…± 36 é¡µ</div></div></main><footer class=footer><span>Copyright Â© 2020-2025 Zhang Ranrui. All Rights Reserved.</span><br>Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>