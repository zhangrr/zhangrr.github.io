<!doctype html><html lang=zh dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3988508441804851" crossorigin=anonymous></script><title>所有文章 | 八戒的技术博客</title>
<meta name=keywords content><meta name=description content="所有文章 - 八戒的技术博客"><meta name=author content><link rel=canonical href=https://rendoumi.com/posts/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.5d8a858b4ad07d913988e10d3c3dbc8c171f45316a396de8a60d67f44840812d.css integrity="sha256-XYqFi0rQfZE5iOENPD28jBcfRTFqOW3opg1n9EhAgS0=" rel="preload stylesheet" as=style><link rel=icon href=https://rendoumi.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://rendoumi.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://rendoumi.com/favicon-32x32.png><link rel=apple-touch-icon href=https://rendoumi.com/apple-touch-icon.png><link rel=mask-icon href=https://rendoumi.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://rendoumi.com/posts/index.xml title=rss><link rel=alternate hreflang=zh href=https://rendoumi.com/posts/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://rendoumi.com/posts/"><meta property="og:site_name" content="八戒的技术博客"><meta property="og:title" content="所有文章"><meta property="og:locale" content="zh"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="所有文章"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"所有文章","item":"https://rendoumi.com/posts/"}]}</script></head><body class=list id=top><header class=header><nav class=nav><div class=logo><a href=https://rendoumi.com/ accesskey=h title="八戒的技术博客 (Alt + H)">八戒的技术博客</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://rendoumi.com/ title=首页><span>首页</span></a></li><li><a href=https://rendoumi.com/posts/ title=文章><span class=active>文章</span></a></li><li><a href=https://rendoumi.com/archives/ title=归档><span>归档</span></a></li><li><a href=https://blog.rendoumi.com title=生活><span>生活</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://rendoumi.com/search/ title=搜索><span>搜索</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>所有文章</h1></header><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>配置Minio+nginx的代理来开放桶内内容
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>同事有个需求，想开放个域名，给别的同事们下载文件用。
这个其实很建单，问题就是文件怎么放上去，sftp、ftp什么的都需要搭个服务器，其实最简单应该是webdav，但是放公网又不太安全。
本来考虑是用 oss 的桶，前面直接套个CDN，但是如果桶文件泄露被疯狂下载，也会付出银两。
最后做法是用 Minio 弄一个模拟的桶环境，前面配置上 Nginx，带宽限制到1M，这样就无所谓了。同事用另一台机器模拟S3的API往上面放文件供下载。
一、minio的安装
下载二进制文件，简单粗暴启动：
#!/bin/bash nohup /app/minio/minio server --address '0.0.0.0:9000' --console-address '0.0.0.0:9001' /app/bucket > /app/minio/minio.log 2>&amp;1 & 这样就启动了，然后网页打开 http://10.10.247.211:9000 ，就可以看到登录界面了
登录后，我们先建立一个Bucket，就叫做pub桶，把pub桶的策略改成public，这样nginx代理的时候才能直接访问到
然后我们上传个图片，BOMS3.0.png，然后去/app/bucket目录下看看
结果发现BOMS3.0.png居然是个目录，进去继续看
meta信息和若干的part，看来这是为多版本准备的，这就是为什么要策略是public的原因，不是就无法从9000访问。
二、安装配置nginx
server { listen 80; listen [::]:80; server_name supervisor-task.ddky.com; location / { return 301 https://supervisor-task.ddky.com$request_uri; } } server { listen 443 ssl; server_name supervisor_task.ddky.com; ssl_certificate /etc/nginx/cert/_.ddky.com.crt; ssl_certificate_key /etc/nginx/cert/_.ddky.com.key; ssl_session_timeout 5m; location / { rewrite ^/$ /pub/index.html break; proxy_pass http://10.10.247.211:9000/pub/; proxy_redirect off; } access_log /app/logs/access.log ; error_log /app/logs/error.log; } 主要就是要配置代理，代理到minio的9000端口
...</p></div><footer class=entry-footer><span title='2023-12-28 13:35:11 +0800 CST'>2023年12月28日</span></footer><a class=entry-link aria-label="post link to 配置Minio+nginx的代理来开放桶内内容" href=https://rendoumi.com/posts/20231228-minio_nginx/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>NFS的详细解释
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>NFS的SERVER分两部分： 1、RPC 主程序：rpcbind NFS 本质是一个 RPC 服务，而要启动任何一个 RPC 服务之前，都需要做好 port 的对应 (mapping) 的工作才行，这个工作其实就是『 rpcbind 』这个服务所负责的！也就是说， 在启动任何一个 RPC 服务之前，我们都需要启动 rpcbind 才行！ (在 CentOS 5.x 以前这个软件称为 portmap，在 CentOS 6.x 之后才称为 rpcbind 的！)
2、NFS 主程序：nfs-utils 就是提供 rpc.nfsd 及 rpc.mountd 这两个 NFS daemons 与其他相关 documents 与说明文件、执行文件等的软件！这个就是 NFS 服务所需要的主要软件！
安装服务端NFS Server yum install nfs-utils rpcbind -y sudo apt install nfs-kernel-server 客户端不提供服务，所以不用装rpcbind yum install nfs-utils sudo apt install nfs-common 将NFS和rpcbind加入开机启动 systemctl enable --now rpcbind systemctl enable --now nfs 客户端不用启用任何服务 服务端检查是否安装nfs： rpm -qa | grep nfs与 rpm -qa | grep rpcbind即可 停止服务端的nfs server的方法： systemctl stop nfs systemctl stop rpcbind 配置共享目录 在服务端配置一个共享目录
...</p></div><footer class=entry-footer><span title='2023-12-28 09:10:11 +0800 CST'>2023年12月28日</span></footer><a class=entry-link aria-label="post link to NFS的详细解释" href=https://rendoumi.com/posts/20231228-nfs_detail/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Kvm虚拟机挂载临时急救iso启动的方法
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>Kvm虚拟机挂载临时急救iso启动的方法： 首先去到宿主机
编辑虚机文件virsh edit vis-18-32-6
&lt;disk type='file' device='cdrom'> &lt;driver name='qemu' type='raw'/> &lt;target dev='hda' bus='ide'/> &lt;readonly/> &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/> &lt;/disk> 在target下面增加一行source：
&lt;disk type='file' device='cdrom'> &lt;driver name='qemu' type='raw'/> &lt;target dev='hda' bus='ide'/> &lt;source file="/export/kvm/systemrescuecd-x86-5.2.2.iso"/> &lt;readonly/> &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/> &lt;/disk> 再修改boot为cdrom，改回去则是hd
&lt;os> &lt;type arch='x86_64' machine='pc-i440fx-rhel7.0.0'>hvm&lt;/type> &lt;boot dev='cdrom'/> &lt;/os> 然后启动虚机就可以了。</p></div><footer class=entry-footer><span title='2023-12-28 09:08:11 +0800 CST'>2023年12月28日</span></footer><a class=entry-link aria-label="post link to Kvm虚拟机挂载临时急救iso启动的方法" href=https://rendoumi.com/posts/20231228-kvm_isoboot/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>shell脚本的一个好的帮助信息
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>Shell脚本好的帮助信息的例子 一个好的脚本，必须有好的帮助信息
给一个比较简洁的例子
#!/bin/bash
###
### my-script — does one thing well
###
### Usage:
### my-script &lt;input> &lt;output>
###
### Options:
### &lt;input> Input file to read.
### &lt;output> Output file to write. Use '-' for stdout.
### -h Show this message.
help() {
awk -F'### ' '/^###/ { print $2 }' "$0"
}
if [[ $# == 0 ]] || [[ "$1" == "-h" ]]; then
help
exit 1
fi
echo Hello World
以前丑陋的用法真是没法看！！！
...</p></div><footer class=entry-footer><span title='2023-12-28 09:05:11 +0800 CST'>2023年12月28日</span></footer><a class=entry-link aria-label="post link to shell脚本的一个好的帮助信息" href=https://rendoumi.com/posts/20231228-shell_prompt/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Nodejs禁止后台偷偷升级
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>Nodejs禁止后台偷偷升级 去到172.18.31.2上，会看到很多node进程
有病噻，系统都没有运行node程序。唯一的程序是nci-ansible-ui-quick-setup，在/export/server下，还没有运行，升级个茄子噻。
全杀掉，然后全局禁止升级即可
npm config set update-notifier false --global 第一次运行会有个提示，再运行就没有了。</p></div><footer class=entry-footer><span title='2023-12-28 09:03:11 +0800 CST'>2023年12月28日</span></footer><a class=entry-link aria-label="post link to Nodejs禁止后台偷偷升级" href=https://rendoumi.com/posts/20231228-nodejs_noupgrade/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Tomcat配置不当导致文件泄露
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>Tomcat配置不当导致文件泄露 说明：Tomcat由于配置不当会导致tomcat/conf log webapps work temp bin lib等信息暴露在游览器中 例如：
http://192.168.89.38:8080/conf/catalina.policy http://192.168.89.38:8080/conf/catalina.properties http://192.168.89.38:8080/conf/context.xml http://192.168.89.38:8080/conf/logging.properties http://192.168.89.38:8080/conf/server.xml http://192.168.89.38:8080/conf/tomcat-users.xml http://192.168.89.38:8080/conf/web.xml 修复方法：
将 /export/servers/tomcat 下的 server.xml &lt;Host name="localhost" appBase="" 改成 &lt;Host name="localhost" appBase="webapps" appBase千万不能为空 修改完后重启生效</p></div><footer class=entry-footer><span title='2023-12-28 09:00:11 +0800 CST'>2023年12月28日</span></footer><a class=entry-link aria-label="post link to Tomcat配置不当导致文件泄露" href=https://rendoumi.com/posts/20231228-tomcat_config/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>用fail2ban简简单单封掉ssh端口的试探
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>用fail2ban简简单单封掉ssh端口的试探 有人不停试探登录22端口的openssh服务，ip量很大的话，比如1000多ip论番来，会导致服务的Loadavg升高到7左右，系统进程内ssh达到1000多，很困扰
如果改掉sshd的缺省端口22，那么scp以及sftp的时候会带来很大麻烦
这种情况就装个fail2ban就好，注意，Centos 7现在用的是fiewalld，所以fail2ban可以用ufw或者iptables，建议用iptables，比较容易看
#安装 yum install -y epel-release yum install -y fail2ban 最主要的就是修改/etc/fail2ban/jail.conf
#vi /etc/fail2ban/jail.conf ...... [sshd-iptalbes] enabled = true filter = sshd port = 22 action = iptables[name=SSH, port=ssh, protocol=tcp] logpath = /var/log/secure maxretry = 3 bantime = 86400 ...... 注意上面用的是iptables，三次尝试失败就ban一天。</p></div><footer class=entry-footer><span title='2023-12-28 08:50:11 +0800 CST'>2023年12月28日</span></footer><a class=entry-link aria-label="post link to 用fail2ban简简单单封掉ssh端口的试探" href=https://rendoumi.com/posts/20231228-fail2ban/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>用logrotate解决catalinna.out过大的问题
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>用logrotate解决catalinna.out过大的问题 我们的tomcat的catalina.out基本运行一段时间后会出现文件过大的问题，处理一下。
前提是/export/servers/tomcat/下需要建立个软链接tomcat，指向现在正在用的tomcat版本
然后就可以用logrotate来解决catalina.out的日志轮转问题。这种方式比较简单。在/etc/logrotate.d/目录下新建一个名为tomcat的文件，
cat >/etc/logrotate.d/tomcat &lt;&lt;EOF /export/servers/tomcat/tomcat/logs/catalina.out{ copytruncate daily rotate 7 missingok compress } EOF 以上的配置说明：
/export/servers/tomcat/tomcat/logs/catalina.out{ # 要轮转的文件 copytruncate # 创建新的catalina.out副本后，truncate源catalina.out文件，会丢数据!!! daily # 每天进行catalina.out文件的轮转 rotate 7 # 至多保留7个副本 missingok # 如果要轮转的文件丢失了，继续轮转而不报错 compress # 使用压缩的方式（非常有用，节省硬盘空间；一个2~3GB的日志文件可以压缩成60MB左右） }
可以手工强制执行logrotate程序。在命令行运行：</p></div><footer class=entry-footer><span title='2023-12-28 08:45:11 +0800 CST'>2023年12月28日</span></footer><a class=entry-link aria-label="post link to 用logrotate解决catalinna.out过大的问题" href=https://rendoumi.com/posts/20231228-logrotate/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Rsync的日常使用方法
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>Rsync的基本参数 -a : 归档模式，递归拷贝，带属性。 -u : 同步时目标目录中如果某文件比源中文件时间要新，则保留不动。 -v : 详细显示信息 -z : 压缩 -h : 显示友好信息 -P : 显示传输进度百分比 -R : 使用相对路径，会保留源目录的目录结构。 -e : 使用ssh来传输 源如果没有/，代表连同目录以及目录下的文件，统统拷贝到目的去 源如果最后带/，意思是/*，代表只拷贝目录下的文件，不包括目录本身 如果参数中带-R，那无论源后面有无/，都按原有目录状态拷过去 -R 使用相对路径，会保留源目录的目录结构。 如rsync -av /foo/bar/baz.c remote::/tmp/，会将baz.c传到/tmp下， 而使用了-R，则在/tmp下的文件结构将会是foo/bar/baz.c。
下面两种用法一样：
rsync -auvPR --exclude 'upload' new 172.18.34.38::new/ rsync -auvPR --exclude 'upload' ./new 172.18.34.38::new/ 大规模传输细小文件的方法： find ./new -mindepth 6 -maxdepth 6 -type d -print0 | xargs -P 30 -n 60 -I % -0 rsync -auvPR % 172.18.34.38::new/ -print0 -0 find命令有一个特别的参数-print0，指定输出的文件列表以null分隔。然后，xargs命令的-0参数表示用null当作分隔符。 -I -I指定每一项命令行参数的替代字符串。
...</p></div><footer class=entry-footer><span title='2023-12-28 08:40:11 +0800 CST'>2023年12月28日</span></footer><a class=entry-link aria-label="post link to Rsync的日常使用方法" href=https://rendoumi.com/posts/20231228-rsync/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Megacli用来重建不知道正确槽位的Raid
<span class=entry-hint title=Draft><svg height="20" viewBox="0 -960 960 960" fill="currentcolor"><path d="M160-410v-60h3e2v60H160zm0-165v-60h470v60H160zm0-165v-60h470v60H160zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22-4.5 22.5T862.09-380L643-160H520zm3e2-263-37-37 37 37zM580-220h38l121-122-18-19-19-18-122 121v38zm141-141-19-18 37 37-18-19z"/></svg></span></h2></header><div class=entry-content><p>192.168.85.7上面有两个Raid
一个Raid1, 500G，应该是两块盘，现在丢了一块，正确的槽位不知道是哪一个 另一个是Raid0，4TB，运行正常
现在在一个新槽位上插了一块硬盘，但是槽位不对，没有自动rebuild，状态是unconfiged good.
首先查一下丢失的盘
/opt/MegaRAID/MegaCli/MegaCli64 -Pdgetmissing -a0
得到参数Array 0，Row 1
首先进行替换，新盘的id是32:2，替换掉Array0 Row1的盘
/opt/MegaRAID/MegaCli/MegaCli64 -PdReplaceMissing -PhysDrv [32:2] -Array0 -row1 -a0 然后强制这块新盘开始重建
/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -Start -PhysDrv [32:2] -a0 随时查看一下进度
/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -ShowProg -PhysDrv [32:2] -a0 上面已经走了5%了，走完就ok了。</p></div><footer class=entry-footer><span title='2023-12-27 16:54:11 +0800 CST'>2023年12月27日</span></footer><a class=entry-link aria-label="post link to Megacli用来重建不知道正确槽位的Raid" href=https://rendoumi.com/posts/20231227-megacli_rebuild/></a></article><div class=pagination><ul class=pagination-list><li class="page-item first"><a class=page-link href=/posts/ aria-label="First Page"><span aria-hidden=true>&#9668;</span></a></li><li class="page-item prev"><a class=page-link href=/posts/page/15/ aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a class=page-link href=/posts/page/9/>9</a></li><li class=page-item><a class=page-link href=/posts/page/10/>10</a></li><li class=page-item><a class=page-link href=/posts/page/11/>11</a></li><li class=page-item><a class=page-link href=/posts/page/12/>12</a></li><li class=page-item><a class=page-link href=/posts/page/13/>13</a></li><li class=page-item><a class=page-link href=/posts/page/14/>14</a></li><li class=page-item><a class=page-link href=/posts/page/15/>15</a></li><li class="page-item active"><span class=page-link aria-current=page>16</span></li><li class="page-item next"><a class=page-link href=/posts/page/17/ aria-label="Next Group"><span aria-hidden=true>&#187;</span></a></li><li class="page-item last"><a class=page-link href=/posts/page/34/ aria-label="Last Page"><span aria-hidden=true>&#9658;</span></a></li></ul><div class=total-pages>共 34 页</div></div></main><footer class=footer><span>Copyright © 2020-2025 Zhang Ranrui. All Rights Reserved.</span><br>·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>